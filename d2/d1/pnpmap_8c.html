<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: pnpmap.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>pnpmap.c File Reference</h1><code>#include "<a class="el" href="../../d1/d5/iop_8h-source.html">iop.h</a>"</code><br>
<code>#include "<a class="el" href="../../d1/d9/pnpcvrt_8h-source.html">pnpcvrt.h</a>"</code><br>
<code>#include "<a class="el" href="../../d2/d3/pbios_8h-source.html">pbios.h</a>"</code><br>

<p>
<a href="../../d3/d0/pnpmap_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">_EXCLUDED_PNPNODE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/struct__CLASSDATA.html">_CLASSDATA</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/struct__CLASS__DESCRIPTIONS__LIST.html">_CLASS_DESCRIPTIONS_LIST</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">_BIOS_DEVNODE_INFO</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a0">DebugPrint</a>(X)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a1">MULTIFUNCTION_KEY_NAME</a>&nbsp;&nbsp;&nbsp;L"\\Registry\\Machine\\HARDWARE\\DESCRIPTION\\System\\MultifunctionAdapter"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a2">ENUMROOT_KEY_NAME</a>&nbsp;&nbsp;&nbsp;L"\\Registry\\Machine\\System\\CurrentControlSet\\Enum\\Root"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a3">BIOSINFO_KEY_NAME</a>&nbsp;&nbsp;&nbsp;L"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Biosinfo\\PNPBios"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a4">BIOSINFO_VALUE_NAME</a>&nbsp;&nbsp;&nbsp;L"DisableNodes"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a5">DECODEINFO_VALUE_NAME</a>&nbsp;&nbsp;&nbsp;L"FullDecodeChipsetOverride"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a6">INSTANCE_ID_PREFIX</a>&nbsp;&nbsp;&nbsp;L"PnPBIOS_"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a>&nbsp;&nbsp;&nbsp;80</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a8">DEFAULT_VALUE_SIZE</a>&nbsp;&nbsp;&nbsp;80</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a9">DEFAULT_DEVICE_DESCRIPTION</a>&nbsp;&nbsp;&nbsp;L"Unknown device class"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(a)&nbsp;&nbsp;&nbsp;{ a, sizeof(a) - sizeof(UNICODE_NULL) }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a11">EXCLUDED_DEVICES_COUNT</a>&nbsp;&nbsp;&nbsp;(sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a18">ExcludedDevices</a>) / sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a18">ExcludedDevices</a>[0]))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a12">EXCLUDE_DISABLED_COUNT</a>&nbsp;&nbsp;&nbsp;(sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a19">ExcludeIfDisabled</a>) / sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a19">ExcludeIfDisabled</a>[0]))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a13">CLASSLIST_ENTRY</a>(a)&nbsp;&nbsp;&nbsp;{ a, sizeof(a) / sizeof(a[0]) }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a14">CLASSLIST_COUNT</a>&nbsp;&nbsp;&nbsp;( sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a33">ClassDescriptionsList</a>) / sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a33">ClassDescriptionsList</a>[0]) )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a15">DECODE_FLAGS</a></td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">_EXCLUDED_PNPNODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a16">EXCLUDED_PNPNODE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">_EXCLUDED_PNPNODE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a17">PEXCLUDED_PNPNODE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d0/struct__CLASSDATA.html">_CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a20">CLASSDATA</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">_BIOS_DEVNODE_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a34">BIOS_DEVNODE_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">_BIOS_DEVNODE_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a35">PBIOS_DEVNODE_INFO</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a36">PbBiosResourcesToNtResources</a> (IN ULONG <a class="el" href="../../d2/d7/hal_8h.html#a75">BusNumber</a>, IN ULONG SlotNumber, IN OUT PUCHAR *BiosData, OUT PIO_RESOURCE_REQUIREMENTS_LIST *ReturnedList, OUT PULONG ReturnedLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a37">PnPBiosExpandProductId</a> (PUCHAR CompressedId, PWCHAR ProductIDStr)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a38">PnPBiosIoResourceListToCmResourceList</a> (IN PIO_RESOURCE_REQUIREMENTS_LIST IoResourceList, OUT PCM_RESOURCE_LIST *CmResourceList, OUT ULONG *CmResourceListSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a39">PnPBiosExtractCompatibleIDs</a> (IN PUCHAR *DevNodeData, IN ULONG DevNodeDataLength, OUT PWSTR *CompatibleIDs, OUT ULONG *CompatibleIDsLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a40">PnPBiosTranslateInfo</a> (IN VOID *BiosInfo, IN ULONG BiosInfoLength, OUT <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a> *DevNodeInfoList, OUT ULONG *NumberNodes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a41">PnPBiosFindMatchingDevNode</a> (IN PWCHAR MapperName, IN PCM_RESOURCE_LIST ResourceList, IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a> DevNodeInfoList, IN ULONG NumberNodes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a42">PnPBiosEliminateDupes</a> (IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a> DevNodeInfoList, IN ULONG NumberNodes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a43">PnPBiosGetDescription</a> (IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a> DevNodeInfoEntry)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a44">PnPBiosWriteInfo</a> (IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a> DevNodeInfoList, IN ULONG NumberNodes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a45">PnPBiosCopyIoDecode</a> (IN HANDLE EnumRootKey, IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a> DevNodeInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a46">PnPBiosFreeDevNodeInfo</a> (IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a> DevNodeInfoList, IN ULONG NumberNodes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a47">PnPBiosCheckForHardwareDisabled</a> (IN PIO_RESOURCE_REQUIREMENTS_LIST IoResourceList, IN OUT PBOOLEAN Disabled)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a48">PnPBiosCheckForExclusion</a> (IN <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">PEXCLUDED_PNPNODE</a> ExclusionArray, IN ULONG ExclusionCount, IN PWCHAR PnpDeviceName, IN PWCHAR PnpCompatIds)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a49">PnPBiosMapper</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a50">PpFilterNtResource</a> (IN PWCHAR PnpDeviceName, PIO_RESOURCE_REQUIREMENTS_LIST ResReqList)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a51">ComPortDBAdd</a> (IN HANDLE DeviceParamKey, IN PWSTR <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a5">PortName</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a52">PnPBiosGetBiosInfo</a> (OUT PVOID *BiosInfo, OUT ULONG *BiosInfoLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a53">PnPBiosIgnoreNode</a> (PWCHAR PnpID, PWCHAR excludeNodes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a54">PnPGetDevnodeExcludeList</a> (OUT PKEY_VALUE_FULL_INFORMATION *ExcludeList)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a55">PnPCheckFixedIoOverrideDecodes</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a56">PnPBiosCheckForExclusion</a> (IN <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">EXCLUDED_PNPNODE</a> *Exclusions, IN ULONG ExclusionCount, IN PWCHAR PnpDeviceName, IN PWCHAR PnpCompatIds)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a57">PnPBiosCopyDeviceParamKey</a> (IN HANDLE EnumRootKey, IN PWCHAR SourcePath, IN PWCHAR DestinationPath)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a58">PnPBiosMapper</a> ()</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">EXCLUDED_PNPNODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a18">ExcludedDevices</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">EXCLUDED_PNPNODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a19">ExcludeIfDisabled</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a21">Class1Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a22">Class2Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a23">Class3Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a24">Class4Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a25">Class5Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a26">Class6Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a27">Class7Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a28">Class8Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a29">Class9Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a30">Class10Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a31">Class11Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a32">Class12Descriptions</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d9/struct__CLASS__DESCRIPTIONS__LIST.html">_CLASS_DESCRIPTIONS_LIST</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/pnpmap_8c.html#a33">ClassDescriptionsList</a> []</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a3" doxytag="pnpmap.c::BIOSINFO_KEY_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BIOSINFO_KEY_NAME&nbsp;&nbsp;&nbsp;L"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Biosinfo\\PNPBios"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00086">86</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00788">PnPCheckFixedIoOverrideDecodes()</a>, and <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00759">PnPGetDevnodeExcludeList()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="pnpmap.c::BIOSINFO_VALUE_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BIOSINFO_VALUE_NAME&nbsp;&nbsp;&nbsp;L"DisableNodes"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00087">87</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00759">PnPGetDevnodeExcludeList()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="pnpmap.c::CLASSLIST_COUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CLASSLIST_COUNT&nbsp;&nbsp;&nbsp;( sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a33">ClassDescriptionsList</a>) / sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a33">ClassDescriptionsList</a>[0]) )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00255">255</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02053">PnPBiosGetDescription()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="pnpmap.c::CLASSLIST_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CLASSLIST_ENTRY          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;{ a, sizeof(a) / sizeof(a[0]) }</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00231">231</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="pnpmap.c::DebugPrint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DebugPrint          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">X&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00074">74</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="pnpmap.c::DECODE_FLAGS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DECODE_FLAGS          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>( CM_RESOURCE_PORT_10_BIT_DECODE | \
                       CM_RESOURCE_PORT_12_BIT_DECODE | \
                       CM_RESOURCE_PORT_16_BIT_DECODE | \
                       CM_RESOURCE_PORT_POSITIVE_DECODE )
</div></pre>
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02663">PnPBiosCopyIoDecode()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="pnpmap.c::DECODEINFO_VALUE_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DECODEINFO_VALUE_NAME&nbsp;&nbsp;&nbsp;L"FullDecodeChipsetOverride"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00088">88</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00788">PnPCheckFixedIoOverrideDecodes()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="pnpmap.c::DEFAULT_DEVICE_DESCRIPTION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DEFAULT_DEVICE_DESCRIPTION&nbsp;&nbsp;&nbsp;L"Unknown device class"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00095">95</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02053">PnPBiosGetDescription()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="pnpmap.c::DEFAULT_STRING_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DEFAULT_STRING_SIZE&nbsp;&nbsp;&nbsp;80          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00092">92</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02089">PnPBiosCopyDeviceParamKey()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02663">PnPBiosCopyIoDecode()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01725">PnPBiosEliminateDupes()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00399">PnPBiosGetBiosInfo()</a>, and <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="pnpmap.c::DEFAULT_VALUE_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DEFAULT_VALUE_SIZE&nbsp;&nbsp;&nbsp;80          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00093">93</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02089">PnPBiosCopyDeviceParamKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="pnpmap.c::ENUMROOT_KEY_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ENUMROOT_KEY_NAME&nbsp;&nbsp;&nbsp;L"\\Registry\\Machine\\System\\CurrentControlSet\\Enum\\Root"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00083">83</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02663">PnPBiosCopyIoDecode()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01725">PnPBiosEliminateDupes()</a>, and <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="pnpmap.c::EXCLUDE_DISABLED_COUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EXCLUDE_DISABLED_COUNT&nbsp;&nbsp;&nbsp;(sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a19">ExcludeIfDisabled</a>) / sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a19">ExcludeIfDisabled</a>[0]))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00124">124</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="pnpmap.c::EXCLUDED_DEVICES_COUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EXCLUDED_DEVICES_COUNT&nbsp;&nbsp;&nbsp;(sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a18">ExcludedDevices</a>) / sizeof(<a class="el" href="../../d2/d1/pnpmap_8c.html#a18">ExcludedDevices</a>[0]))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00117">117</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="pnpmap.c::EXCLUSION_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EXCLUSION_ENTRY          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;{ a, sizeof(a) - sizeof(UNICODE_NULL) }</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00098">98</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="pnpmap.c::INSTANCE_ID_PREFIX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define INSTANCE_ID_PREFIX&nbsp;&nbsp;&nbsp;L"PnPBIOS_"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00090">90</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01725">PnPBiosEliminateDupes()</a>, and <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="pnpmap.c::MULTIFUNCTION_KEY_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MULTIFUNCTION_KEY_NAME&nbsp;&nbsp;&nbsp;L"\\Registry\\Machine\\HARDWARE\\DESCRIPTION\\System\\MultifunctionAdapter"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00082">82</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00399">PnPBiosGetBiosInfo()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a34" doxytag="pnpmap.c::BIOS_DEVNODE_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">_BIOS_DEVNODE_INFO</a>    <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="pnpmap.c::CLASSDATA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d0/struct__CLASSDATA.html">_CLASSDATA</a>  <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="pnpmap.c::EXCLUDED_PNPNODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">_EXCLUDED_PNPNODE</a>  <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">EXCLUDED_PNPNODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="pnpmap.c::PBIOS_DEVNODE_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">_BIOS_DEVNODE_INFO</a> * <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l03008">PnPBiosMapper()</a>, and <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">PnPBiosTranslateInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="pnpmap.c::PEXCLUDED_PNPNODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">_EXCLUDED_PNPNODE</a> * <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">PEXCLUDED_PNPNODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a51" doxytag="pnpmap.c::ComPortDBAdd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ComPortDBAdd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceParamKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>PortName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>, and <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02089">PnPBiosCopyDeviceParamKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="pnpmap.c::PbBiosResourcesToNtResources" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PbBiosResourcesToNtResources           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BusNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SlotNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PUCHAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>BiosData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PIO_RESOURCE_REQUIREMENTS_LIST *&nbsp;</td>
          <td class="mdname" nowrap> <em>ReturnedList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ReturnedLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="pnpmap.c::PnPBiosCheckForExclusion" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN PnPBiosCheckForExclusion           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">EXCLUDED_PNPNODE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Exclusions</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ExclusionCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>PnpDeviceName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>PnpCompatIds</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00835">835</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.
<p>
<pre class="fragment"><div>00841 {
00842     PWCHAR idPtr;
00843     ULONG exclusionIndex;
00844 
00845     <span class="keywordflow">for</span> (exclusionIndex = 0; exclusionIndex &lt; ExclusionCount; exclusionIndex++) {
00846 
00847         idPtr = PnpDeviceName;
00848 
00849         <span class="keywordflow">if</span> (RtlCompareMemory( idPtr,
00850                               Exclusions[ exclusionIndex ].Id,
00851                               Exclusions[ exclusionIndex ].IdLength) != Exclusions[ exclusionIndex ].IdLength )  {
00852 
00853             idPtr = PnpCompatIds;
00854 
00855             <span class="keywordflow">if</span> (idPtr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
00856 
00857                 <span class="keywordflow">while</span> (*idPtr != <span class="charliteral">'\0'</span>) {
00858 
00859                     <span class="keywordflow">if</span> (RtlCompareMemory( idPtr,
00860                                           Exclusions[ exclusionIndex ].Id,
00861                                           Exclusions[ exclusionIndex ].IdLength) == Exclusions[ exclusionIndex ].IdLength )  {
00862 
00863                         <span class="keywordflow">break</span>;
00864                     }
00865 
00866                     idPtr += 9;
00867                 }
00868 
00869                 <span class="keywordflow">if</span> (*idPtr == <span class="charliteral">'\0'</span>) {
00870 
00871                     idPtr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00872                 }
00873             }
00874         }
00875 
00876         <span class="keywordflow">if</span> (idPtr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
00877 
00878             <span class="keywordflow">break</span>;
00879         }
00880     }
00881 
00882     <span class="keywordflow">if</span> (exclusionIndex &lt; ExclusionCount) {
00883         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00884     }
00885 
00886     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00887 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="pnpmap.c::PnPBiosCheckForExclusion" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN PnPBiosCheckForExclusion           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">PEXCLUDED_PNPNODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ExclusionArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ExclusionCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>PnpDeviceName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>PnpCompatIds</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="pnpmap.c::PnPBiosCheckForHardwareDisabled" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosCheckForHardwareDisabled           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PIO_RESOURCE_REQUIREMENTS_LIST&nbsp;</td>
          <td class="mdname" nowrap> <em>IoResourceList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Disabled</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02852">2852</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">PnPBiosTranslateInfo()</a>.
<p>
<pre class="fragment"><div>02858                    :
02859 
02860     If <span class="keyword">this</span> device has been assigned one or more resources, and each resource has a length of zero, then <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
02861     hardware disabled.
02862 
02863 Arguments:
02864 
02865     IoResourceList - <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a> obtained from BIOS that we're about to map to a CmResourceList
02866 
02867     Disabled - Set to <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> deemed to be disabled
02868 
02869 Return Value:
02870 
02871     STATUS_SUCCESS <span class="keywordflow">if</span> no errors, otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate error.
02872 
02873 --*/
02874 {
02875     BOOLEAN ParsedResource = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02876     PIO_RESOURCE_DESCRIPTOR ioDescriptor;
02877     ULONG descIndex;
02878     <span class="comment">//</span>
02879     <span class="comment">// Since this routine is only used to translate the allocated resources</span>
02880     <span class="comment">// returned by the PnP BIOS, we can assume that there is only 1 alternative</span>
02881     <span class="comment">// list</span>
02882     <span class="comment">//</span>
02883 
02884     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(IoResourceList-&gt;AlternativeLists == 1);
02885     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Disabled != NULL);
02886 
02887     *Disabled = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02888 
02889     <span class="comment">//</span>
02890     <span class="comment">// Translate each resource descriptor, currently we only handle ports,</span>
02891     <span class="comment">// memory, interrupts, and dma.  The current implementation of the routine</span>
02892     <span class="comment">// which converts from ISA PnP Resource data to IO_RESOURCE_REQUIREMENTS</span>
02893     <span class="comment">// won't generate any other descriptor types given the data returned from</span>
02894     <span class="comment">// the BIOS.</span>
02895     <span class="comment">//</span>
02896 
02897     <span class="keywordflow">for</span> (descIndex = 0; descIndex &lt; IoResourceList-&gt;List[ 0 ].Count; descIndex++) {
02898 
02899         ioDescriptor = &amp;IoResourceList-&gt;List[ 0 ].Descriptors[ descIndex ];
02900 
02901         <span class="keywordflow">switch</span> (ioDescriptor-&gt;Type) {
02902 
02903         <span class="keywordflow">case</span> CmResourceTypePort:
02904             <span class="keywordflow">if</span> (ioDescriptor-&gt;u.Port.Length) {
02905                 <span class="keywordflow">return</span> STATUS_SUCCESS;
02906             }
02907             ParsedResource = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02908             <span class="keywordflow">break</span>;
02909 
02910         <span class="keywordflow">case</span> CmResourceTypeInterrupt:
02911             <span class="keywordflow">if</span> (ioDescriptor-&gt;u.Interrupt.MinimumVector != (ULONG)(-1)) {
02912                 <span class="keywordflow">return</span> STATUS_SUCCESS;
02913             }
02914             ParsedResource = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02915             <span class="keywordflow">break</span>;
02916 
02917         <span class="keywordflow">case</span> CmResourceTypeMemory:
02918             <span class="keywordflow">if</span> (ioDescriptor-&gt;u.Memory.Length) {
02919                 <span class="keywordflow">return</span> STATUS_SUCCESS;
02920             }
02921             ParsedResource = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02922             <span class="keywordflow">break</span>;
02923 
02924         <span class="keywordflow">case</span> CmResourceTypeDma:
02925             <span class="keywordflow">if</span> (ioDescriptor-&gt;u.Dma.MinimumChannel != (ULONG)(-1)) {
02926                 <span class="keywordflow">return</span> STATUS_SUCCESS;
02927             }
02928             ParsedResource = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02929             <span class="keywordflow">break</span>;
02930 
02931         <span class="keywordflow">default</span>:
02932             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02933                         <span class="stringliteral">"Unexpected ResourceType (%d) in I/O Descriptor\n"</span>,
02934                         ioDescriptor-&gt;Type) );
02935 
02936 <span class="preprocessor">#if DBG</span>
02937 <span class="preprocessor"></span>            <span class="comment">// DbgBreakPoint();</span>
02938 <span class="preprocessor">#endif</span>
02939 <span class="preprocessor"></span>            <span class="keywordflow">break</span>;
02940         }
02941     }
02942 
02943     <span class="keywordflow">if</span> (ParsedResource) {
02944         <span class="comment">//</span>
02945         <span class="comment">// at least one empty resource, no non-empty resources</span>
02946         <span class="comment">//</span>
02947         *Disabled = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02948     }
02949 
02950     <span class="keywordflow">return</span> STATUS_SUCCESS;
02951 
02952 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="pnpmap.c::PnPBiosCopyDeviceParamKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosCopyDeviceParamKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>EnumRootKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>SourcePath</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>DestinationPath</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02089">2089</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d2/d1/pnpmap_8c.html#a51">ComPortDBAdd()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00092">DEFAULT_STRING_SIZE</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00093">DEFAULT_VALUE_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08501">IopOpenDeviceParametersSubkey()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01104">IopOpenRegistryKeyEx()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01520">RtlCompareUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.
<p>
<pre class="fragment"><div>02096                    :
02097 
02098     <a class="code" href="../../d9/d0/cmdata_8h.html#a104a97">Copy</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Device Parameters key from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> firmware mapper node in
02099     DevNodeInfo-&gt;Replaces to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS mapper node represented by DevNodeInfo.
02100 
02101 Arguments:
02102 
02103     EnumRootKey - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to Enum\Root.
02104 
02105     SourcePath - Instance <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> of FW Mapper node relative to Enum\Root.
02106 
02107     DestinationKey - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> to destination instance key.
02108 
02109 Return Value:
02110 
02111     STATUS_SUCCESS <span class="keywordflow">if</span> no errors, otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate error.
02112 
02113 --*/
02114 {
02115     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                    status;
02116     UNICODE_STRING              sourceInstanceKeyName;
02117     HANDLE                      sourceInstanceKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02118 
02119     UNICODE_STRING              deviceParamKeyName;
02120     HANDLE                      sourceDeviceParamKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02121     HANDLE                      destinationDeviceParamKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02122     UNICODE_STRING              destinationInstanceKeyName;
02123 
02124     PKEY_VALUE_FULL_INFORMATION valueFullInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02125     ULONG                       valueFullInfoLength;
02126     ULONG                       resultLength;
02127 
02128     UNICODE_STRING              valueName;
02129 
02130     ULONG                       index;
02131 
02132     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;sourceInstanceKeyName, SourcePath );
02133 
02134     status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a7">IopOpenRegistryKeyEx</a>( &amp;sourceInstanceKey,
02135                                    EnumRootKey,
02136                                    &amp;sourceInstanceKeyName,
02137                                    KEY_ALL_ACCESS
02138                                    );
02139 
02140     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02141 
02142         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02143                     <span class="stringliteral">"PnPBiosCopyDeviceParamKey() - Could not open source instance key %S, status = %8.8X\n"</span>,
02144                     SourcePath,
02145                     status) );
02146 
02147         <span class="keywordflow">return</span> status;
02148     }
02149 
02150     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;deviceParamKeyName, REGSTR_KEY_DEVICEPARAMETERS);
02151 
02152     status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a7">IopOpenRegistryKeyEx</a>( &amp;sourceDeviceParamKey,
02153                                    sourceInstanceKey,
02154                                    &amp;deviceParamKeyName,
02155                                    KEY_ALL_ACCESS
02156                                    );
02157 
02158     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02159 
02160         <span class="keywordflow">if</span> (status != STATUS_OBJECT_NAME_NOT_FOUND) {
02161 
02162             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02163                         <span class="stringliteral">"PnPBiosCopyDeviceParamKey() - Could not open source device parameter key %S\\%S, status = %8.8X\n"</span>,
02164                         SourcePath,
02165                         deviceParamKeyName.Buffer,
02166                         status) );
02167         }
02168 
02169         <span class="keywordflow">goto</span> Cleanup;
02170     }
02171 
02172     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;destinationInstanceKeyName, DestinationPath);
02173 
02174     status = <a class="code" href="../../d9/d0/pnpiop_8h.html#a304">IopOpenDeviceParametersSubkey</a>( &amp;destinationDeviceParamKey,
02175                                             EnumRootKey,
02176                                             &amp;destinationInstanceKeyName,
02177                                             KEY_ALL_ACCESS );
02178 
02179     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02180 
02181         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02182                     <span class="stringliteral">"PnPBiosCopyDeviceParamKey() - Could not open destination device parameter key %S\\%S, status = %8.8X\n"</span>,
02183                     DestinationPath,
02184                     REGSTR_KEY_DEVICEPARAMETERS,
02185                     status) );
02186 
02187         <span class="keywordflow">goto</span> Cleanup;
02188     }
02189 
02190     valueFullInfoLength = <span class="keyword">sizeof</span>(KEY_VALUE_FULL_INFORMATION) + <a class="code" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a> + <a class="code" href="../../d2/d1/pnpmap_8c.html#a8">DEFAULT_VALUE_SIZE</a>;
02191     valueFullInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, valueFullInfoLength);
02192 
02193     <span class="keywordflow">if</span> (valueFullInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02194 
02195         <span class="keywordflow">goto</span> Cleanup;
02196     }
02197 
02198     <span class="keywordflow">for</span> (index = 0; ; index++) {
02199         status = ZwEnumerateValueKey( sourceDeviceParamKey,
02200                                       index,
02201                                       KeyValueFullInformation,
02202                                       valueFullInfo,
02203                                       valueFullInfoLength,
02204                                       &amp;resultLength );
02205 
02206         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02207             UNICODE_STRING  sourcePathString;
02208             UNICODE_STRING  serialPrefixString;
02209             UNICODE_STRING  portNameString;
02210 
02211             valueName.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)valueFullInfo-&gt;NameLength;
02212             valueName.MaximumLength = valueName.Length;
02213             valueName.Buffer = valueFullInfo-&gt;Name;
02214 
02215             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;sourcePathString, SourcePath);
02216             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;serialPrefixString, L<span class="stringliteral">"*PNP0501"</span>);
02217 
02218             <span class="keywordflow">if</span> (sourcePathString.Length &gt; serialPrefixString.Length) {
02219                 sourcePathString.Length = serialPrefixString.Length;
02220             }
02221 
02222             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a41">RtlCompareUnicodeString</a>(&amp;sourcePathString, &amp;serialPrefixString, TRUE) == 0) {
02223 
02224                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;portNameString, L<span class="stringliteral">"PortName"</span>);
02225 
02226                 <span class="keywordflow">if</span> (valueName.Length == 16 &amp;&amp;
02227                     <a class="code" href="../../d6/d6/nls_8c.html#a41">RtlCompareUnicodeString</a>(&amp;valueName, &amp;portNameString, TRUE) == 0)  {
02228 
02229                     <span class="comment">// ComPortDBRemove(SourcePath, &amp;unicodeValue);</span>
02230                     <a class="code" href="../../d2/d1/pnpmap_8c.html#a51">ComPortDBAdd</a>(destinationDeviceParamKey, (PWSTR)((PUCHAR)valueFullInfo + valueFullInfo-&gt;DataOffset));
02231                     <span class="keywordflow">continue</span>;
02232                 }
02233             }
02234 
02235             status = ZwSetValueKey( destinationDeviceParamKey,
02236                                     &amp;valueName,
02237                                     valueFullInfo-&gt;TitleIndex,
02238                                     valueFullInfo-&gt;Type,
02239                                     (PUCHAR)valueFullInfo + valueFullInfo-&gt;DataOffset,
02240                                     valueFullInfo-&gt;DataLength );
02241         } <span class="keywordflow">else</span> {
02242             <span class="keywordflow">if</span> (status == STATUS_BUFFER_OVERFLOW) {
02243                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( valueFullInfo );
02244 
02245                 valueFullInfoLength = resultLength;
02246                 valueFullInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, valueFullInfoLength);
02247 
02248                 <span class="keywordflow">if</span> (valueFullInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02249                     status = STATUS_NO_MEMORY;
02250                 } <span class="keywordflow">else</span> {
02251                     index--;
02252                     <span class="keywordflow">continue</span>;
02253                 }
02254             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status != STATUS_NO_MORE_ENTRIES)  {
02255                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02256                             <span class="stringliteral">"Could not enumerate under key %S\\%S, status = %8.8X\n"</span>,
02257                             SourcePath,
02258                             deviceParamKeyName.Buffer,
02259                             status) );
02260             } <span class="keywordflow">else</span> {
02261                 status = STATUS_SUCCESS;
02262             }
02263 
02264             <span class="keywordflow">break</span>;
02265         }
02266     }
02267 
02268 Cleanup:
02269     <span class="keywordflow">if</span> (sourceInstanceKey != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02270         ZwClose( sourceInstanceKey );
02271     }
02272 
02273     <span class="keywordflow">if</span> (sourceDeviceParamKey != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02274         ZwClose( sourceDeviceParamKey );
02275     }
02276 
02277     <span class="keywordflow">if</span> (destinationDeviceParamKey != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02278         ZwClose( destinationDeviceParamKey );
02279     }
02280 
02281     <span class="keywordflow">if</span> (valueFullInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02282         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( valueFullInfo );
02283     }
02284 
02285     <span class="keywordflow">return</span> status;
02286 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="pnpmap.c::PnPBiosCopyIoDecode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PnPBiosCopyIoDecode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>EnumRootKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DevNodeInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02663">2663</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d2/d1/pnpmap_8c.html#a15">DECODE_FLAGS</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00092">DEFAULT_STRING_SIZE</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00083">ENUMROOT_KEY_NAME</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01156">IopCreateRegistryKeyEx()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.
<p>
<pre class="fragment"><div>02667 {
02668     HANDLE                          deviceKey;
02669     WCHAR                           logConfKeyNameStr[<a class="code" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a>];
02670     UNICODE_STRING                  logConfKeyName;
02671     HANDLE                          logConfKey;
02672     UNICODE_STRING                  valueName;
02673     PKEY_VALUE_PARTIAL_INFORMATION  valueInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02674     ULONG                           valueInfoLength;
02675     ULONG                           returnedLength;
02676     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                        status;
02677     PCM_PARTIAL_RESOURCE_LIST       partialResourceList;
02678     PCM_PARTIAL_RESOURCE_DESCRIPTOR partialDescriptor;
02679     ULONG                           index;
02680     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>                          flags;
02681 
02682     <span class="keywordflow">if</span> (DevNodeInfo-&gt;Replaces == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || DevNodeInfo-&gt;BootConfig == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02683 
02684         <span class="comment">//</span>
02685         <span class="comment">// If we didn't find a FW Mapper created devnode then there is nothing</span>
02686         <span class="comment">// to do.</span>
02687         <span class="comment">//</span>
02688         <span class="keywordflow">return</span>;
02689     }
02690 
02691     <span class="comment">//</span>
02692     <span class="comment">// Search through the Boot Config and see if the device's I/O ports are</span>
02693     <span class="comment">// 16 bit decode.</span>
02694     <span class="comment">//</span>
02695 
02696     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DevNodeInfo-&gt;BootConfig-&gt;Count == 1);
02697 
02698     partialResourceList = &amp;DevNodeInfo-&gt;BootConfig-&gt;List[0].PartialResourceList;
02699 
02700     partialDescriptor = &amp;partialResourceList-&gt;PartialDescriptors[0];
02701 
02702     flags = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)~0;
02703 
02704 <span class="preprocessor">#define DECODE_FLAGS ( CM_RESOURCE_PORT_10_BIT_DECODE | \</span>
02705 <span class="preprocessor">                       CM_RESOURCE_PORT_12_BIT_DECODE | \</span>
02706 <span class="preprocessor">                       CM_RESOURCE_PORT_16_BIT_DECODE | \</span>
02707 <span class="preprocessor">                       CM_RESOURCE_PORT_POSITIVE_DECODE )</span>
02708 <span class="preprocessor"></span>
02709     <span class="keywordflow">for</span> ( index = 0; index &lt; partialResourceList-&gt;Count; index++ ) {
02710         <span class="keywordflow">if</span> (partialDescriptor-&gt;Type == CmResourceTypePort) {
02711             <span class="keywordflow">if</span> (flags == (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)~0) {
02712                 flags = partialDescriptor-&gt;Flags &amp; <a class="code" href="../../d2/d1/pnpmap_8c.html#a15">DECODE_FLAGS</a>;
02713             } <span class="keywordflow">else</span> {
02714                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(flags == (partialDescriptor-&gt;Flags &amp; DECODE_FLAGS));
02715             }
02716         }
02717         partialDescriptor++;
02718     }
02719 
02720     <span class="keywordflow">if</span> (!(flags &amp; (CM_RESOURCE_PORT_16_BIT_DECODE | CM_RESOURCE_PORT_POSITIVE_DECODE)))  {
02721         <span class="keywordflow">return</span>;
02722     }
02723 
02724     swprintf( logConfKeyNameStr,
02725               L<span class="stringliteral">"%s\\%s"</span>,
02726               DevNodeInfo-&gt;Replaces,
02727               REGSTR_KEY_LOGCONF
02728               );
02729 
02730     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;logConfKeyName, logConfKeyNameStr );
02731 
02732     status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a8">IopCreateRegistryKeyEx</a>( &amp;logConfKey,
02733                                      EnumRootKey,
02734                                      &amp;logConfKeyName,
02735                                      KEY_ALL_ACCESS,
02736                                      REG_OPTION_NON_VOLATILE,
02737                                      NULL
02738                                      );
02739 
02740     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02741 
02742         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02743                     <span class="stringliteral">"Could not open registry key %S\\%S\\%S, status = %8.8X\n"</span>,
02744                     ENUMROOT_KEY_NAME,
02745                     DevNodeInfo-&gt;Replaces,
02746                     REGSTR_KEY_LOGCONF,
02747                     status) );
02748 
02749         <span class="keywordflow">return</span>;
02750     }
02751 
02752     valueInfoLength = <span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <a class="code" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a>;
02753     valueInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, valueInfoLength);
02754 
02755     <span class="keywordflow">if</span> (valueInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
02756 
02757         ZwClose( logConfKey );
02758 
02759         <span class="keywordflow">return</span>;
02760     }
02761 
02762     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, REGSTR_VAL_BOOTCONFIG );
02763 
02764     status = ZwQueryValueKey( logConfKey,
02765                               &amp;valueName,
02766                               KeyValuePartialInformation,
02767                               valueInfo,
02768                               valueInfoLength,
02769                               &amp;returnedLength);
02770 
02771     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02772 
02773         <span class="keywordflow">if</span> (status == STATUS_BUFFER_TOO_SMALL || status == STATUS_BUFFER_OVERFLOW) {
02774 
02775             <span class="comment">//</span>
02776             <span class="comment">// The default buffer was too small, free it and reallocate</span>
02777             <span class="comment">// it to the required size.</span>
02778             <span class="comment">//</span>
02779             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( valueInfo );
02780 
02781             valueInfoLength = returnedLength;
02782             valueInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, valueInfoLength );
02783 
02784             <span class="keywordflow">if</span> (valueInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
02785 
02786                 status = ZwQueryValueKey( logConfKey,
02787                                           &amp;valueName,
02788                                           KeyValuePartialInformation,
02789                                           valueInfo,
02790                                           valueInfoLength,
02791                                           &amp;returnedLength );
02792 
02793                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02794                     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02795                                 <span class="stringliteral">"Could not query registry value %S\\%S\\LogConf\\BootConfig, status = %8.8X\n"</span>,
02796                                 ENUMROOT_KEY_NAME,
02797                                 DevNodeInfo-&gt;Replaces,
02798                                 status) );
02799 
02800                     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( valueInfo );
02801 
02802                     ZwClose( logConfKey );
02803 
02804                     <span class="keywordflow">return</span>;
02805                 }
02806             } <span class="keywordflow">else</span> {
02807 
02808                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02809                             <span class="stringliteral">"Could not allocate memory for BootConfig value\n"</span>
02810                             ) );
02811 
02812                 ZwClose( logConfKey );
02813 
02814                 <span class="keywordflow">return</span>;
02815             }
02816         }
02817     }
02818 
02819     partialResourceList = &amp;((PCM_RESOURCE_LIST)valueInfo-&gt;Data)-&gt;List[0].PartialResourceList;
02820 
02821     partialDescriptor = &amp;partialResourceList-&gt;PartialDescriptors[0];
02822 
02823     <span class="keywordflow">for</span> ( index = 0; index &lt; partialResourceList-&gt;Count; index++ ) {
02824         <span class="keywordflow">if</span> (partialDescriptor-&gt;Type == CmResourceTypePort) {
02825             partialDescriptor-&gt;Flags &amp;= ~<a class="code" href="../../d2/d1/pnpmap_8c.html#a15">DECODE_FLAGS</a>;
02826             partialDescriptor-&gt;Flags |= flags;
02827         }
02828         partialDescriptor++;
02829     }
02830 
02831     status = ZwSetValueKey( logConfKey,
02832                             &amp;valueName,
02833                             0,
02834                             REG_RESOURCE_LIST,
02835                             valueInfo-&gt;Data,
02836                             valueInfo-&gt;DataLength );
02837 
02838     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02839         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02840                     <span class="stringliteral">"Could not set registry value %S\\%S\\LogConf\\BootConfig, status = %8.8X\n"</span>,
02841                     ENUMROOT_KEY_NAME,
02842                     DevNodeInfo-&gt;Replaces,
02843                     status) );
02844     }
02845 
02846     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(valueInfo);
02847 
02848     ZwClose(logConfKey);
02849 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="pnpmap.c::PnPBiosEliminateDupes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosEliminateDupes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DevNodeInfoList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberNodes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01725">1725</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00092">DEFAULT_STRING_SIZE</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00083">ENUMROOT_KEY_NAME</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00090">INSTANCE_ID_PREFIX</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01104">IopOpenRegistryKeyEx()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01410">PnPBiosFindMatchingDevNode()</a>, and <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l03008">PnPBiosMapper()</a>.
<p>
<pre class="fragment"><div>01731                    :
01732 
01733     This routine enumerates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Firmware Mapper generated devices under
01734     Enum\Root.  Those that match entries in DevNodeInfoList have their registry
01735     key name stored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DevNodeInfoList entry so that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Firmare Mapper
01736     instance may be removed later.
01737 
01738 Arguments:
01739 
01740     DevNodeInfoList - Array of <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a> structures, one <span class="keywordflow">for</span> each device
01741         reported by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS.
01742 
01743     NumberNodes - Number of <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a> elements pointed to by
01744         DevNodeInfoList.
01745 
01746 Return Value:
01747 
01748     STATUS_SUCCESS <span class="keywordflow">if</span> no errors, otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate error.
01749 
01750 --*/
01751 {
01752     UNICODE_STRING                  enumRootKeyName, valueName;
01753     HANDLE                          enumRootKey;
01754     PKEY_BASIC_INFORMATION          deviceBasicInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01755     ULONG                           deviceBasicInfoLength;
01756     UNICODE_STRING                  deviceKeyName;
01757     HANDLE                          deviceKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01758     PKEY_BASIC_INFORMATION          instanceBasicInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01759     ULONG                           instanceBasicInfoLength;
01760     WCHAR                           logConfStr[<a class="code" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a>];
01761     UNICODE_STRING                  logConfKeyName;
01762     HANDLE                          logConfKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01763 
01764     PKEY_VALUE_PARTIAL_INFORMATION  valueInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01765     ULONG                           valueInfoLength;
01766     ULONG                           returnedLength;
01767 
01768     ULONG                           deviceIndex, instanceIndex;
01769     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                        status = STATUS_UNSUCCESSFUL;
01770 
01771     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;enumRootKeyName, ENUMROOT_KEY_NAME);
01772 
01773     status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a7">IopOpenRegistryKeyEx</a>( &amp;enumRootKey,
01774                                    NULL,
01775                                    &amp;enumRootKeyName,
01776                                    KEY_READ
01777                                    );
01778 
01779     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01780 
01781         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01782                     <span class="stringliteral">"Could not open registry key %S, status = %8.8X\n"</span>,
01783                     ENUMROOT_KEY_NAME,
01784                     status) );
01785 
01786         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01787     }
01788 
01789     deviceBasicInfoLength = <span class="keyword">sizeof</span>(KEY_BASIC_INFORMATION) + <a class="code" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a>;
01790     deviceBasicInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, deviceBasicInfoLength);
01791 
01792     instanceBasicInfoLength = <span class="keyword">sizeof</span>(KEY_BASIC_INFORMATION) + <a class="code" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a>;
01793     instanceBasicInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, instanceBasicInfoLength);
01794 
01795     valueInfoLength = <span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <a class="code" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a>;
01796     valueInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, valueInfoLength);
01797 
01798     <span class="keywordflow">if</span> (deviceBasicInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; instanceBasicInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; valueInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01799 
01800         <span class="keywordflow">for</span> (deviceIndex = 0; ; deviceIndex++) {
01801 
01802             status = ZwEnumerateKey( enumRootKey,
01803                                      deviceIndex,
01804                                      KeyBasicInformation,
01805                                      deviceBasicInfo,
01806                                      deviceBasicInfoLength,
01807                                      &amp;returnedLength);
01808 
01809             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01810 
01811                 <span class="keywordflow">if</span> (status != STATUS_NO_MORE_ENTRIES)  {
01812 
01813                     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01814                                 <span class="stringliteral">"Could not enumerate under key %S, status = %8.8X\n"</span>,
01815                                 ENUMROOT_KEY_NAME,
01816                                 status) );
01817                 } <span class="keywordflow">else</span> {
01818                     status = STATUS_SUCCESS;
01819                 }
01820                 <span class="keywordflow">break</span>;
01821             }
01822 
01823             <span class="keywordflow">if</span> (deviceBasicInfo-&gt;Name[0] != <span class="charliteral">'*'</span>) {
01824                 <span class="keywordflow">continue</span>;
01825             }
01826 
01827             deviceBasicInfo-&gt;Name[ deviceBasicInfo-&gt;NameLength / 2 ] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01828             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;deviceKeyName, deviceBasicInfo-&gt;Name);
01829 
01830             status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a7">IopOpenRegistryKeyEx</a>( &amp;deviceKey,
01831                                            enumRootKey,
01832                                            &amp;deviceKeyName,
01833                                            KEY_READ
01834                                            );
01835 
01836             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01837 
01838                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01839                             <span class="stringliteral">"Could not open registry key %S\\%S, status = %8.8X\n"</span>,
01840                             ENUMROOT_KEY_NAME,
01841                             deviceBasicInfo-&gt;Name,
01842                             status) );
01843                 <span class="keywordflow">break</span>;
01844             }
01845 
01846             <span class="keywordflow">for</span> (instanceIndex = 0; ; instanceIndex++) {
01847 
01848                 status = ZwEnumerateKey( deviceKey,
01849                                          instanceIndex,
01850                                          KeyBasicInformation,
01851                                          instanceBasicInfo,
01852                                          instanceBasicInfoLength,
01853                                          &amp;returnedLength);
01854 
01855                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01856 
01857                     <span class="keywordflow">if</span> (status != STATUS_NO_MORE_ENTRIES)  {
01858                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01859                                     <span class="stringliteral">"Could not enumerate under key %S\\%S, status = %8.8X\n"</span>,
01860                                     ENUMROOT_KEY_NAME,
01861                                     deviceBasicInfo-&gt;Name,
01862                                     status) );
01863                     } <span class="keywordflow">else</span> {
01864                         status = STATUS_SUCCESS;
01865                     }
01866                     <span class="keywordflow">break</span>;
01867                 }
01868 
01869                 <span class="keywordflow">if</span> (RtlCompareMemory( instanceBasicInfo-&gt;Name,
01870                                       INSTANCE_ID_PREFIX,
01871                                       <span class="keyword">sizeof</span>(INSTANCE_ID_PREFIX) - <span class="keyword">sizeof</span>(UNICODE_NULL)
01872                                       ) == (<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d1/pnpmap_8c.html#a6">INSTANCE_ID_PREFIX</a>) - <span class="keyword">sizeof</span>(UNICODE_NULL))) {
01873 
01874                     <span class="keywordflow">continue</span>;
01875                 }
01876 
01877                 instanceBasicInfo-&gt;Name[ instanceBasicInfo-&gt;NameLength / 2 ] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01878 
01879                 RtlCopyMemory( logConfStr,
01880                                instanceBasicInfo-&gt;Name,
01881                                instanceBasicInfo-&gt;NameLength );
01882 
01883                 logConfStr[ instanceBasicInfo-&gt;NameLength / 2 ] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span>;
01884 
01885                 RtlCopyMemory( &amp;logConfStr[ instanceBasicInfo-&gt;NameLength / 2 + 1 ],
01886                                REGSTR_KEY_LOGCONF,
01887                                <span class="keyword">sizeof</span>(REGSTR_KEY_LOGCONF) );
01888 
01889                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;logConfKeyName, logConfStr );
01890 
01891                 status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a7">IopOpenRegistryKeyEx</a>( &amp;logConfKey,
01892                                                deviceKey,
01893                                                &amp;logConfKeyName,
01894                                                KEY_READ
01895                                                );
01896 
01897                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01898 
01899                     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01900                                 <span class="stringliteral">"Could not open registry key %S\\%S\\%S, status = %8.8X\n"</span>,
01901                                 ENUMROOT_KEY_NAME,
01902                                 deviceBasicInfo-&gt;Name,
01903                                 logConfStr,
01904                                 status) );
01905                     <span class="keywordflow">continue</span>;
01906                 }
01907 
01908                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, REGSTR_VAL_BOOTCONFIG );
01909 
01910                 status = ZwQueryValueKey( logConfKey,
01911                                           &amp;valueName,
01912                                           KeyValuePartialInformation,
01913                                           valueInfo,
01914                                           valueInfoLength,
01915                                           &amp;returnedLength );
01916 
01917                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01918 
01919                     <span class="keywordflow">if</span> (status == STATUS_BUFFER_TOO_SMALL || status == STATUS_BUFFER_OVERFLOW) {
01920 
01921                         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( valueInfo );
01922 
01923                         valueInfoLength = returnedLength;
01924                         valueInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, valueInfoLength );
01925 
01926                         <span class="keywordflow">if</span> (valueInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01927 
01928                             status = ZwQueryValueKey( logConfKey,
01929                                                       &amp;valueName,
01930                                                       KeyValuePartialInformation,
01931                                                       valueInfo,
01932                                                       valueInfoLength,
01933                                                       &amp;returnedLength );
01934                         } <span class="keywordflow">else</span> {
01935                             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01936                                         <span class="stringliteral">"Error allocating memory for %S\\%S\\LogConf\\BootConfig value\n"</span>,
01937                                         ENUMROOT_KEY_NAME,
01938                                         deviceBasicInfo-&gt;Name) );
01939                             valueInfoLength = 0;
01940                             status = STATUS_NO_MEMORY;
01941 
01942                             <span class="keywordflow">break</span>;
01943                         }
01944 
01945                     } <span class="keywordflow">else</span> {
01946                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01947                                     <span class="stringliteral">"Error retrieving %S\\%S\\LogConf\\BootConfig size, status = %8.8X\n"</span>,
01948                                     ENUMROOT_KEY_NAME,
01949                                     deviceBasicInfo-&gt;Name,
01950                                     status) );
01951 
01952                         status = STATUS_UNSUCCESSFUL;
01953                     }
01954                 }
01955 
01956                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( status )) {
01957                     PCM_RESOURCE_LIST   resourceList;
01958                     LONG                matchingIndex;
01959 
01960                     resourceList = (PCM_RESOURCE_LIST)valueInfo-&gt;Data;
01961 
01962                     matchingIndex = <a class="code" href="../../d2/d1/pnpmap_8c.html#a41">PnPBiosFindMatchingDevNode</a>( deviceBasicInfo-&gt;Name,
01963                                                                 resourceList,
01964                                                                 DevNodeInfoList,
01965                                                                 NumberNodes );
01966 
01967                     <span class="keywordflow">if</span> (matchingIndex != -1) {
01968 
01969                         DevNodeInfoList[ matchingIndex ].Replaces = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool,
01970                                                                                     deviceBasicInfo-&gt;NameLength + instanceBasicInfo-&gt;NameLength + 2 * <span class="keyword">sizeof</span>(UNICODE_NULL));
01971 
01972                         <span class="keywordflow">if</span> (DevNodeInfoList[ matchingIndex ].Replaces != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01973 
01974                             RtlCopyMemory( DevNodeInfoList[ matchingIndex ].Replaces,
01975                                            deviceBasicInfo-&gt;Name,
01976                                            deviceBasicInfo-&gt;NameLength );
01977 
01978                             DevNodeInfoList[ matchingIndex ].Replaces[ deviceBasicInfo-&gt;NameLength / 2 ] = <span class="charliteral">'\\'</span>;
01979 
01980                             RtlCopyMemory( &amp;DevNodeInfoList[ matchingIndex ].Replaces[ deviceBasicInfo-&gt;NameLength / 2 + 1 ],
01981                                            instanceBasicInfo-&gt;Name,
01982                                            instanceBasicInfo-&gt;NameLength );
01983 
01984                             DevNodeInfoList[ matchingIndex ].Replaces[ (deviceBasicInfo-&gt;NameLength + instanceBasicInfo-&gt;NameLength) / 2 + 1 ] = <span class="charliteral">'\0'</span>;
01985 
01986                             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_INFORMATION,
01987                                         <span class="stringliteral">"Match found: %S\\%S%d replaces %S\n"</span>,
01988                                         DevNodeInfoList[ matchingIndex ].ProductId,
01989                                         INSTANCE_ID_PREFIX,
01990                                         DevNodeInfoList[ matchingIndex ].Handle,
01991                                         DevNodeInfoList[ matchingIndex ].Replaces) );
01992                         } <span class="keywordflow">else</span> {
01993                             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01994                                         <span class="stringliteral">"Error allocating memory for %S\\%S%d\\Replaces\n"</span>,
01995                                         DevNodeInfoList[ matchingIndex ].ProductId,
01996                                         INSTANCE_ID_PREFIX,
01997                                         DevNodeInfoList[ matchingIndex ].Handle) );
01998                         }
01999                     } <span class="keywordflow">else</span> {
02000                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_INFORMATION,
02001                                     <span class="stringliteral">"No matching PnP Bios DevNode found for FW Enumerated device %S\\%S\n"</span>,
02002                                     deviceBasicInfo-&gt;Name,
02003                                     instanceBasicInfo-&gt;Name) );
02004                     }
02005                 } <span class="keywordflow">else</span> {
02006                     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02007                                 <span class="stringliteral">"Error retrieving %S\\%S\\%S\\BootConfig, status = %8.8X\n"</span>,
02008                                 ENUMROOT_KEY_NAME,
02009                                 deviceBasicInfo-&gt;Name,
02010                                 logConfStr,
02011                                 status) );
02012                 }
02013 
02014                 ZwClose(logConfKey);
02015 
02016                 logConfKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02017             }
02018 
02019             ZwClose(deviceKey);
02020 
02021             deviceKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02022         }
02023     } <span class="keywordflow">else</span> {
02024         status = STATUS_NO_MEMORY;
02025     }
02026 
02027     <span class="keywordflow">if</span> (valueInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02028         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(valueInfo);
02029     }
02030 
02031     <span class="keywordflow">if</span> (instanceBasicInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02032         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(instanceBasicInfo);
02033     }
02034 
02035     <span class="keywordflow">if</span> (deviceBasicInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02036         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(deviceBasicInfo);
02037     }
02038 
02039     <span class="keywordflow">if</span> (logConfKey != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02040         ZwClose(logConfKey);
02041     }
02042 
02043     <span class="keywordflow">if</span> (deviceKey != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02044         ZwClose(deviceKey);
02045     }
02046 
02047     ZwClose(enumRootKey);
02048 
02049     <span class="keywordflow">return</span> status;
02050 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="pnpmap.c::PnPBiosExpandProductId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PnPBiosExpandProductId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>CompressedId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>ProductIDStr</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00687">687</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01026">PnPBiosExtractCompatibleIDs()</a>, and <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">PnPBiosTranslateInfo()</a>.
<p>
<pre class="fragment"><div>00693                    :
00694 
00695     This function expands a PnP Device <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> 4 byte compressed form into
00696     an 7 character unicode string.  The string <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> then NUL terminated.
00697 
00698 Arguments:
00699 
00700     CompressedId - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> 4 byte compressed Device <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> as defined in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00701         PnP Specification.
00702 
00703     ProductIDStr - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> 16 byte buffer in which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unicode string
00704         version of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> placed.
00705 
00706 
00707 Return Value:
00708 
00709     NONE.
00710 
00711 --*/
00712 {
00713     <span class="keyword">static</span> <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> HexDigits[16] = <span class="stringliteral">"0123456789ABCDEF"</span>;
00714 
00715     ProductIDStr[0] = (CompressedId[0] &gt;&gt; 2) + 0x40;
00716     ProductIDStr[1] = (((CompressedId[0] &amp; 0x03) &lt;&lt; 3) | (CompressedId[1] &gt;&gt; 5)) + 0x40;
00717     ProductIDStr[2] = (CompressedId[1] &amp; 0x1f) + 0x40;
00718     ProductIDStr[3] = HexDigits[CompressedId[2] &gt;&gt; 4];
00719     ProductIDStr[4] = HexDigits[CompressedId[2] &amp; 0x0F];
00720     ProductIDStr[5] = HexDigits[CompressedId[3] &gt;&gt; 4];
00721     ProductIDStr[6] = HexDigits[CompressedId[3] &amp; 0x0F];
00722     ProductIDStr[7] = 0x00;
00723 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="pnpmap.c::PnPBiosExtractCompatibleIDs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosExtractCompatibleIDs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUCHAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>DevNodeData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DevNodeDataLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PWSTR *&nbsp;</td>
          <td class="mdname" nowrap> <em>CompatibleIDs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT ULONG *&nbsp;</td>
          <td class="mdname" nowrap> <em>CompatibleIDsLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01026">1026</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d2/d3/pbios_8h-source.html#l00029">LARGE_RESOURCE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00687">PnPBiosExpandProductId()</a>, <a class="el" href="../../d2/d3/pbios_8h-source.html#l00030">SMALL_TAG_MASK</a>, <a class="el" href="../../d2/d3/pbios_8h-source.html#l00031">SMALL_TAG_SIZE_MASK</a>, <a class="el" href="../../d2/d3/pbios_8h-source.html#l00039">TAG_COMPATIBLE_ID</a>, <a class="el" href="../../d2/d3/pbios_8h-source.html#l00065">TAG_COMPLETE_END</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">PnPBiosTranslateInfo()</a>.
<p>
<pre class="fragment"><div>01032 {
01033     PWCHAR  idPtr;
01034     PUCHAR  currentPtr, endPtr;
01035     UCHAR   tagName;
01036     ULONG   increment;
01037     ULONG   compatibleCount;
01038 
01039     endPtr = &amp;(*DevNodeData)[DevNodeDataLength];
01040 
01041     compatibleCount = 0;
01042 
01043     <span class="keywordflow">for</span> (currentPtr = *DevNodeData; currentPtr &lt; endPtr; currentPtr += increment) {
01044 
01045         tagName = *currentPtr;
01046 
01047         <span class="keywordflow">if</span> (tagName == <a class="code" href="../../d1/d4/pbios_8h.html#a22">TAG_COMPLETE_END</a>)  {
01048 
01049             <span class="keywordflow">break</span>;
01050         }
01051 
01052         <span class="comment">//</span>
01053         <span class="comment">// Determine the size of the BIOS resource descriptor</span>
01054         <span class="comment">//</span>
01055 
01056         <span class="keywordflow">if</span> (!(tagName &amp; <a class="code" href="../../d1/d4/pbios_8h.html#a1">LARGE_RESOURCE_TAG</a>)) {
01057             increment = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(tagName &amp; <a class="code" href="../../d1/d4/pbios_8h.html#a3">SMALL_TAG_SIZE_MASK</a>);
01058             increment++;     <span class="comment">// length of small tag</span>
01059             tagName &amp;= <a class="code" href="../../d1/d4/pbios_8h.html#a2">SMALL_TAG_MASK</a>;
01060         } <span class="keywordflow">else</span> {
01061             increment = *(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> UNALIGNED *)(&amp;currentPtr[1]);
01062             increment += 3;     <span class="comment">// length of large tag</span>
01063         }
01064 
01065         <span class="keywordflow">if</span> (tagName == <a class="code" href="../../d1/d4/pbios_8h.html#a6">TAG_COMPATIBLE_ID</a>) {
01066 
01067             compatibleCount++;
01068         }
01069     }
01070 
01071     <span class="keywordflow">if</span> (compatibleCount == 0) {
01072         *CompatibleIDs = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01073         *CompatibleIDsLength = 0;
01074 
01075         <span class="keywordflow">return</span> STATUS_SUCCESS;
01076     }
01077 
01078     *CompatibleIDsLength = (compatibleCount * 9 + 1) * <span class="keyword">sizeof</span>(WCHAR);
01079     *CompatibleIDs = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, *CompatibleIDsLength);
01080 
01081     <span class="keywordflow">if</span> (*CompatibleIDs == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
01082 
01083         *CompatibleIDsLength = 0;
01084         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01085     }
01086 
01087     idPtr = *CompatibleIDs;
01088 
01089     <span class="keywordflow">for</span> (currentPtr = *DevNodeData; currentPtr &lt; endPtr; currentPtr += increment) {
01090 
01091         tagName = *currentPtr;
01092 
01093         <span class="keywordflow">if</span> (tagName == <a class="code" href="../../d1/d4/pbios_8h.html#a22">TAG_COMPLETE_END</a>)  {
01094 
01095             <span class="keywordflow">break</span>;
01096         }
01097 
01098         <span class="comment">//</span>
01099         <span class="comment">// Determine the size of the BIOS resource descriptor</span>
01100         <span class="comment">//</span>
01101 
01102         <span class="keywordflow">if</span> (!(tagName &amp; <a class="code" href="../../d1/d4/pbios_8h.html#a1">LARGE_RESOURCE_TAG</a>)) {
01103             increment = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(tagName &amp; <a class="code" href="../../d1/d4/pbios_8h.html#a3">SMALL_TAG_SIZE_MASK</a>);
01104             increment++;     <span class="comment">// length of small tag</span>
01105             tagName &amp;= <a class="code" href="../../d1/d4/pbios_8h.html#a2">SMALL_TAG_MASK</a>;
01106         } <span class="keywordflow">else</span> {
01107             increment = *(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> UNALIGNED *)(&amp;currentPtr[1]);
01108             increment += 3;     <span class="comment">// length of large tag</span>
01109         }
01110 
01111         <span class="keywordflow">if</span> (tagName == <a class="code" href="../../d1/d4/pbios_8h.html#a6">TAG_COMPATIBLE_ID</a>) {
01112 
01113             *idPtr = <span class="charliteral">'*'</span>;
01114             <a class="code" href="../../d2/d1/pnpmap_8c.html#a37">PnPBiosExpandProductId</a>(&amp;currentPtr[1], &amp;idPtr[1]);
01115             idPtr += 9;
01116         }
01117     }
01118 
01119     *idPtr++ = <span class="charliteral">'\0'</span>;  <span class="comment">// Extra NUL for REG_MULTI_SZ</span>
01120     *CompatibleIDsLength = (ULONG)(idPtr - *CompatibleIDs) * <span class="keyword">sizeof</span>(WCHAR);
01121 
01122     <span class="keywordflow">return</span> STATUS_SUCCESS;
01123 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="pnpmap.c::PnPBiosFindMatchingDevNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG PnPBiosFindMatchingDevNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>MapperName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCM_RESOURCE_LIST&nbsp;</td>
          <td class="mdname" nowrap> <em>ResourceList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DevNodeInfoList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberNodes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01410">1410</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01725">PnPBiosEliminateDupes()</a>.
<p>
<pre class="fragment"><div>01418                    :
01419 
01420     Given a list of resources <span class="keyword">this</span> routine finds an entry in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01421     DevNodeInfoList whose BootConfig resources match.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> match <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> defined as
01422     having at least overlapping I/O Ports or Memory Ranges.  If ResourceList doesn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a>
01423     include any I/O Ports or Memory Ranges then a match <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> defined as exactly
01424     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> same interrupts and/or DMA channels.
01425 
01426     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to find PnP BIOS reported devices which match devices
01427     created by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Firmware Mapper.
01428 
01429 Arguments:
01430 
01431     ResourceList - Pointer to CM_RESOURCE_LIST describing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resources
01432         currently used by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <span class="keywordflow">for</span> which a match <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being searched.
01433 
01434     DevNodeInfoList - Array of <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a> structures, one <span class="keywordflow">for</span> each device
01435         reported by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS.
01436 
01437     NumberNodes - Number of <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a> elements pointed to by
01438         DevNodeInfoList.
01439 
01440 
01441 Return Value:
01442 
01443     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entry in DevNodeInfoList whose BootConfig matches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resources
01444     listed in ResourceList.  If no <a class="code" href="../../d7/d1/genuedef_8c.html#a7">matching</a> entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> found then -1 <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
01445 
01446 --*/
01447 {
01448     PCM_PARTIAL_RESOURCE_LIST       sourceList;
01449     PCM_PARTIAL_RESOURCE_LIST       targetList;
01450     PCM_PARTIAL_RESOURCE_DESCRIPTOR sourceDescriptor;
01451     PCM_PARTIAL_RESOURCE_DESCRIPTOR targetDescriptor;
01452     ULONG                           nodeIndex, sourceIndex, targetIndex;
01453     LONG                            firstMatch = -1;
01454     LONG                            bestMatch = -1;
01455     ULONG                           numResourcesMatch;
01456     ULONG                           score, possibleScore, bestScore = 0;
01457     PWCHAR                          idPtr;
01458     BOOLEAN                         idsMatch;
01459     BOOLEAN                         bestIdsMatch = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01460 
01461 <span class="preprocessor">#if DEBUG_DUP_MATCH</span>
01462 <span class="preprocessor"></span>    <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>                            sourceMapping[256];
01463     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>                            targetMapping[256];
01464 <span class="preprocessor">#endif</span>
01465 <span class="preprocessor"></span>
01466     <span class="comment">//</span>
01467     <span class="comment">// In order to simplify the problem we assume there is only one list.  This</span>
01468     <span class="comment">// assumption holds true in the BootConfig structures generated by the</span>
01469     <span class="comment">// current firmware mapper.</span>
01470     <span class="comment">//</span>
01471     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( ResourceList-&gt;Count == 1 );
01472 
01473     sourceList = &amp;ResourceList-&gt;List[0].PartialResourceList;
01474 
01475 <span class="preprocessor">#if DEBUG_DUP_MATCH</span>
01476 <span class="preprocessor"></span>    <span class="comment">//</span>
01477     <span class="comment">// For debugging purposes we keep track of which resource entries map to</span>
01478     <span class="comment">// each other.  These relationships are stored in a fixed CHAR array, thus</span>
01479     <span class="comment">// the restriction on the number of descriptors.</span>
01480     <span class="comment">//</span>
01481     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( sourceList-&gt;Count &lt; 255 );
01482 <span class="preprocessor">#endif</span>
01483 <span class="preprocessor"></span>
01484     <span class="comment">//</span>
01485     <span class="comment">// Loop through each devnode and try and match it to the source resource</span>
01486     <span class="comment">// list.</span>
01487     <span class="comment">//</span>
01488     <span class="keywordflow">for</span> (nodeIndex = 0; nodeIndex &lt; NumberNodes; nodeIndex++) {
01489 
01490         <span class="keywordflow">if</span> (DevNodeInfoList[ nodeIndex ].BootConfig == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01491 
01492             <span class="keywordflow">continue</span>;
01493         }
01494 
01495         <span class="comment">//</span>
01496         <span class="comment">// We found at least one potential match.  Let's double check if</span>
01497         <span class="comment">// the PNP ids also match.  We use a lack of ID match to disqualify</span>
01498         <span class="comment">// entries which don't match at least I/O ports or memory.</span>
01499         <span class="comment">//</span>
01500 
01501         idPtr = DevNodeInfoList[ nodeIndex ].ProductId;
01502 
01503         <span class="keywordflow">if</span> (RtlCompareMemory( idPtr, MapperName, 12 ) != 12) {
01504 
01505             idPtr = DevNodeInfoList[ nodeIndex ].CompatibleIDs;
01506 
01507             <span class="keywordflow">if</span> (idPtr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01508 
01509                 <span class="keywordflow">while</span> (*idPtr != <span class="charliteral">'\0'</span>) {
01510 
01511                     <span class="keywordflow">if</span> (RtlCompareMemory( idPtr, MapperName, 12 ) == 12) {
01512 
01513                         <span class="keywordflow">break</span>;
01514                     }
01515 
01516                     idPtr += 9;
01517                 }
01518 
01519                 <span class="keywordflow">if</span> (*idPtr == <span class="charliteral">'\0'</span>) {
01520 
01521                     idPtr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01522                 }
01523             }
01524         }
01525 
01526         idsMatch = idPtr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01527 
01528         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( DevNodeInfoList[ nodeIndex ].BootConfig-&gt;Count == 1 );
01529 
01530         targetList = &amp;DevNodeInfoList[ nodeIndex ].BootConfig-&gt;List[0].PartialResourceList;
01531 
01532 <span class="preprocessor">#if DEBUG_DUP_MATCH</span>
01533 <span class="preprocessor"></span>        RtlFillMemory( sourceMapping, <span class="keyword">sizeof</span>(sourceMapping), -1 );
01534         RtlFillMemory( targetMapping, <span class="keyword">sizeof</span>(targetMapping), -1 );
01535 <span class="preprocessor">#endif</span>
01536 <span class="preprocessor"></span>
01537         numResourcesMatch = 0;
01538         possibleScore = 0;
01539         score = 0;
01540 
01541         <span class="comment">//</span>
01542         <span class="comment">// Loop through each source descriptor (resource) and try and match it</span>
01543         <span class="comment">// to one of this devnode's descriptors.</span>
01544         <span class="comment">//</span>
01545 
01546         <span class="keywordflow">for</span> (sourceIndex = 0; sourceIndex &lt; sourceList-&gt;Count; sourceIndex++) {
01547 
01548             sourceDescriptor = &amp;sourceList-&gt;PartialDescriptors[sourceIndex];
01549 
01550             <span class="comment">//</span>
01551             <span class="comment">// We are recalculating the possible score unnecessarily each time</span>
01552             <span class="comment">// we process a devnode.  We might save a small amount of time by</span>
01553             <span class="comment">// looping through the source descriptors once at the beginning but</span>
01554             <span class="comment">// its not clear it would make all that much difference given the</span>
01555             <span class="comment">// few devices reported by the BIOS.</span>
01556             <span class="comment">//</span>
01557 
01558             <span class="keywordflow">switch</span> (sourceDescriptor-&gt;Type) {
01559 
01560             <span class="keywordflow">case</span> CmResourceTypePort:
01561                 possibleScore += 0x1100;
01562                 <span class="keywordflow">break</span>;
01563 
01564             <span class="keywordflow">case</span> CmResourceTypeInterrupt:
01565                 possibleScore += 0x0001;
01566                 <span class="keywordflow">break</span>;
01567 
01568             <span class="keywordflow">case</span> CmResourceTypeMemory:
01569                 possibleScore += 0x1100;
01570                 <span class="keywordflow">break</span>;
01571 
01572             <span class="keywordflow">case</span> CmResourceTypeDma:
01573                 possibleScore += 0x0010;
01574                 <span class="keywordflow">break</span>;
01575 
01576             <span class="keywordflow">default</span>:
01577                 <span class="keywordflow">continue</span>;
01578             }
01579 
01580             <span class="comment">//</span>
01581             <span class="comment">// Try to find a resource in the target devnode which matches the</span>
01582             <span class="comment">// current source resource.</span>
01583             <span class="comment">//</span>
01584             <span class="keywordflow">for</span> (targetIndex = 0; targetIndex &lt; targetList-&gt;Count; targetIndex++) {
01585 
01586                 targetDescriptor = &amp;targetList-&gt;PartialDescriptors[targetIndex];
01587 
01588                 <span class="keywordflow">if</span> (sourceDescriptor-&gt;Type == targetDescriptor-&gt;Type) {
01589                     <span class="keywordflow">switch</span> (sourceDescriptor-&gt;Type) {
01590                     <span class="keywordflow">case</span> CmResourceTypePort:
01591                         <span class="keywordflow">if</span> ((sourceDescriptor-&gt;u.Port.Start.LowPart + sourceDescriptor-&gt;u.Port.Length) &lt;=
01592                              targetDescriptor-&gt;u.Port.Start.LowPart ||
01593                             (targetDescriptor-&gt;u.Port.Start.LowPart + targetDescriptor-&gt;u.Port.Length) &lt;=
01594                              sourceDescriptor-&gt;u.Port.Start.LowPart) {
01595                             <span class="keywordflow">continue</span>;
01596                         }
01597                         <span class="keywordflow">if</span> (sourceDescriptor-&gt;u.Port.Start.LowPart ==
01598                                 targetDescriptor-&gt;u.Port.Start.LowPart &amp;&amp;
01599                             sourceDescriptor-&gt;u.Port.Length ==
01600                                 targetDescriptor-&gt;u.Port.Length) {
01601 
01602                             score += 0x1100;
01603 
01604                         } <span class="keywordflow">else</span> {
01605 
01606                             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_INFORMATION,
01607                                         <span class="stringliteral">"Overlapping port resources, source = %4.4X-%4.4X, target = %4.4X-%4.4X\n"</span>,
01608                                         sourceDescriptor-&gt;u.Port.Start.LowPart,
01609                                         sourceDescriptor-&gt;u.Port.Start.LowPart + sourceDescriptor-&gt;u.Port.Length - 1,
01610                                         targetDescriptor-&gt;u.Port.Start.LowPart,
01611                                         targetDescriptor-&gt;u.Port.Start.LowPart + targetDescriptor-&gt;u.Port.Length - 1) );
01612 
01613                             score += 0x1000;
01614 
01615                         }
01616                         <span class="keywordflow">break</span>;
01617 
01618                     <span class="keywordflow">case</span> CmResourceTypeInterrupt:
01619                         <span class="keywordflow">if</span> (sourceDescriptor-&gt;u.Interrupt.Level !=
01620                             targetDescriptor-&gt;u.Interrupt.Level) {
01621                             <span class="keywordflow">continue</span>;
01622                         }
01623                         score += 0x0001;
01624                         <span class="keywordflow">break</span>;
01625 
01626                     <span class="keywordflow">case</span> CmResourceTypeMemory:
01627                         <span class="keywordflow">if</span> ((sourceDescriptor-&gt;u.Memory.Start.LowPart + sourceDescriptor-&gt;u.Memory.Length) &lt;=
01628                              targetDescriptor-&gt;u.Memory.Start.LowPart ||
01629                             (targetDescriptor-&gt;u.Memory.Start.LowPart + targetDescriptor-&gt;u.Memory.Length) &lt;=
01630                              sourceDescriptor-&gt;u.Memory.Start.LowPart) {
01631 
01632                             <span class="keywordflow">continue</span>;
01633                         }
01634                         <span class="keywordflow">if</span> (sourceDescriptor-&gt;u.Memory.Start.LowPart ==
01635                                 targetDescriptor-&gt;u.Memory.Start.LowPart &amp;&amp;
01636                             sourceDescriptor-&gt;u.Memory.Length ==
01637                                 targetDescriptor-&gt;u.Memory.Length) {
01638 
01639                             score += 0x1100;
01640 
01641                         } <span class="keywordflow">else</span> {
01642 
01643                             score += 0x1000;
01644 
01645                         }
01646                         <span class="keywordflow">break</span>;
01647 
01648                     <span class="keywordflow">case</span> CmResourceTypeDma:
01649                         <span class="keywordflow">if</span> (sourceDescriptor-&gt;u.Dma.Channel !=
01650                             targetDescriptor-&gt;u.Dma.Channel) {
01651 
01652                             <span class="keywordflow">continue</span>;
01653                         }
01654                         score += 0x0010;
01655                         <span class="keywordflow">break</span>;
01656 
01657                     }
01658                     <span class="keywordflow">break</span>;
01659                 }
01660             }
01661 
01662             <span class="keywordflow">if</span> (targetIndex &lt; targetList-&gt;Count) {
01663 <span class="preprocessor">#if DEBUG_DUP_MATCH</span>
01664 <span class="preprocessor"></span>                sourceMapping[sourceIndex] = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)targetIndex;
01665                 targetMapping[targetIndex] = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)sourceIndex;
01666 <span class="preprocessor">#endif</span>
01667 <span class="preprocessor"></span>                numResourcesMatch++;
01668             }
01669         }
01670 
01671         <span class="keywordflow">if</span> (numResourcesMatch != 0) {
01672             <span class="keywordflow">if</span> (firstMatch == -1) {
01673                 firstMatch = nodeIndex;
01674             }
01675 
01676             <span class="keywordflow">if</span> ((score &gt; bestScore) || (score == bestScore &amp;&amp; !bestIdsMatch &amp;&amp; idsMatch))  {
01677                 bestScore = score;
01678                 bestMatch = nodeIndex;
01679                 bestIdsMatch = idsMatch;
01680             }
01681         }
01682     }
01683 
01684     <span class="keywordflow">if</span> (bestMatch != -1) {
01685 
01686         <span class="keywordflow">if</span> (bestScore == possibleScore) {
01687 
01688             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_INFORMATION,
01689                         <span class="stringliteral">"Perfect match, score = %4.4X, possible = %4.4X, index = %d\n"</span>,
01690                         bestScore,
01691                         possibleScore,
01692                         bestMatch) );
01693 
01694             <span class="keywordflow">if</span> (possibleScore &lt; 0x1000 &amp;&amp; !bestIdsMatch) {
01695 
01696                 bestMatch = -1;
01697 
01698             }
01699 
01700         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (possibleScore &gt; 0x1000 &amp;&amp; bestScore &gt;= 0x1000) {
01701 
01702             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_INFORMATION,
01703                         <span class="stringliteral">"Best match is close enough, score = %4.4X, possible = %4.4X, index = %d\n"</span>,
01704                         bestScore,
01705                         possibleScore,
01706                         bestMatch) );
01707 
01708         } <span class="keywordflow">else</span>  {
01709 
01710             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_INFORMATION,
01711                         <span class="stringliteral">"Best match is less than threshold, score = %4.4X, possible = %4.4X, index = %d\n"</span>,
01712                         bestScore,
01713                         possibleScore,
01714                         bestMatch) );
01715 
01716             bestMatch = -1;
01717 
01718         }
01719     }
01720 
01721     <span class="keywordflow">return</span> bestMatch;
01722 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="pnpmap.c::PnPBiosFreeDevNodeInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosFreeDevNodeInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DevNodeInfoList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberNodes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02956">2956</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l03008">PnPBiosMapper()</a>.
<p>
<pre class="fragment"><div>02962                    :
02963 
02964     Free <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dynamically allocated DevNodeInfoList as well as any dynamically
02965     allocated dependent structures.
02966 
02967 Arguments:
02968 
02969     DevNodeInfoList - Array of <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a> structures, one <span class="keywordflow">for</span> each device
02970         reported by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS.
02971 
02972     NumberNodes - Number of <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a> elements pointed to by
02973         DevNodeInfoList.
02974 
02975 Return Value:
02976 
02977     STATUS_SUCCESS <span class="keywordflow">if</span> no errors, otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate error.
02978 
02979 --*/
02980 {
02981     ULONG   nodeIndex;
02982 
02983     <span class="keywordflow">for</span> (nodeIndex = 0; nodeIndex &lt; NumberNodes; nodeIndex++) {
02984 
02985         <span class="keywordflow">if</span> (DevNodeInfoList[nodeIndex].Replaces != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02986             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( DevNodeInfoList[nodeIndex].Replaces );
02987         }
02988 
02989         <span class="keywordflow">if</span> (DevNodeInfoList[nodeIndex].CompatibleIDs != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02990             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( DevNodeInfoList[nodeIndex].CompatibleIDs );
02991         }
02992 
02993         <span class="keywordflow">if</span> (DevNodeInfoList[nodeIndex].BootConfig != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02994             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( DevNodeInfoList[nodeIndex].BootConfig );
02995         }
02996 
02997         <span class="keywordflow">if</span> (DevNodeInfoList[nodeIndex].BasicConfig != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02998             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( DevNodeInfoList[nodeIndex].BasicConfig );
02999         }
03000     }
03001 
03002     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( DevNodeInfoList );
03003 
03004     <span class="keywordflow">return</span> STATUS_SUCCESS;
03005 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="pnpmap.c::PnPBiosGetBiosInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosGetBiosInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>BiosInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT ULONG *&nbsp;</td>
          <td class="mdname" nowrap> <em>BiosInfoLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00399">399</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00092">DEFAULT_STRING_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01104">IopOpenRegistryKeyEx()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00082">MULTIFUNCTION_KEY_NAME</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, and <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l03008">PnPBiosMapper()</a>.
<p>
<pre class="fragment"><div>00405                    :
00406 
00407     This function retrieves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PnP BIOS info accumulated by NTDETECT.COM and
00408     placed in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.
00409 
00410 Arguments:
00411 
00412     BiosInfo - Set to a dynamically allocated block of information retrieved
00413         from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PnP BIOS by NTDETECT.  This block should be freed <span class="keyword">using</span>
00414         <a class="code" href="../../d6/d3/cmwraper_8c.html#a26">ExFreePool</a>.  The contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> block are <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PnP BIOS
00415         Installation Check Structure followed by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DevNode Structures reported
00416         by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS.  The detailed <a class="code" href="../../d8/d0/rtbatcr_8c.html#a8">format</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> documented in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PnP BIOS spec.
00417 
00418     BiosInfoLength - Length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> block whose address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> stored in BiosInfo.
00419 
00420 
00421 Return Value:
00422 
00423     STATUS_SUCCESS <span class="keywordflow">if</span> no errors, otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate error.
00424 
00425 --*/
00426 {
00427     UNICODE_STRING                  multifunctionKeyName, biosKeyName, valueName;
00428     HANDLE                          multifunctionKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, biosKey = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00429     PKEY_BASIC_INFORMATION          keyBasicInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00430     ULONG                           keyBasicInfoLength;
00431     PKEY_VALUE_PARTIAL_INFORMATION  valueInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00432     ULONG                           valueInfoLength;
00433     ULONG                           returnedLength;
00434 
00435     PCM_FULL_RESOURCE_DESCRIPTOR    biosValue;
00436 
00437     ULONG                           index;
00438     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                        status = STATUS_UNSUCCESSFUL;
00439 
00440     <span class="comment">//</span>
00441     <span class="comment">// The PnP BIOS info is written to one of the subkeys under</span>
00442     <span class="comment">// MULTIFUNCTION_KEY_NAME.  The appropriate key is determined by</span>
00443     <span class="comment">// enumerating the subkeys and using the first one which has a value named</span>
00444     <span class="comment">// "Identifier" that is "PNP BIOS".</span>
00445     <span class="comment">//</span>
00446 
00447     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;multifunctionKeyName, MULTIFUNCTION_KEY_NAME);
00448 
00449     status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a7">IopOpenRegistryKeyEx</a>( &amp;multifunctionKey,
00450                                    NULL,
00451                                    &amp;multifunctionKeyName,
00452                                    KEY_READ
00453                                    );
00454 
00455     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00456 
00457         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
00458                     <span class="stringliteral">"Could not open %S, status = %8.8X\n"</span>,
00459                     MULTIFUNCTION_KEY_NAME,
00460                     status) );
00461 
00462         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00463     }
00464 
00465     <span class="comment">//</span>
00466     <span class="comment">// Allocate memory for key names returned from ZwEnumerateKey and values</span>
00467     <span class="comment">// returned from ZwQueryValueKey.</span>
00468     <span class="comment">//</span>
00469     keyBasicInfoLength = <span class="keyword">sizeof</span>(KEY_BASIC_INFORMATION) + <a class="code" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a>;
00470     keyBasicInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, keyBasicInfoLength + <span class="keyword">sizeof</span>(UNICODE_NULL));
00471 
00472     <span class="keywordflow">if</span> (keyBasicInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
00473 
00474         ZwClose( multifunctionKey );
00475 
00476         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00477     }
00478 
00479     valueInfoLength = <span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <a class="code" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a>;
00480     valueInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, valueInfoLength);
00481 
00482     <span class="keywordflow">if</span> (valueInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
00483 
00484         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( keyBasicInfo );
00485 
00486         ZwClose( multifunctionKey );
00487 
00488         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00489     }
00490 
00491     <span class="comment">//</span>
00492     <span class="comment">// Enumerate each key under HKLM\HARDWARE\\DESCRIPTION\\System\\MultifunctionAdapter</span>
00493     <span class="comment">// to locate the one representing the PnP BIOS information.</span>
00494     <span class="comment">//</span>
00495     <span class="keywordflow">for</span> (index = 0; ; index++) {
00496 
00497         status = ZwEnumerateKey( multifunctionKey,   <span class="comment">// handle of key to enumerate</span>
00498                                  index,              <span class="comment">// index of subkey to enumerate</span>
00499                                  KeyBasicInformation,
00500                                  keyBasicInfo,
00501                                  keyBasicInfoLength,
00502                                  &amp;returnedLength);
00503 
00504         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00505 
00506             <span class="keywordflow">if</span> (status != STATUS_NO_MORE_ENTRIES)  {
00507 
00508                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
00509                             <span class="stringliteral">"Could not enumerate under key %S, status = %8.8X\n"</span>,
00510                             MULTIFUNCTION_KEY_NAME,
00511                             status) );
00512             }
00513 
00514             <span class="keywordflow">break</span>;
00515         }
00516 
00517         <span class="comment">//</span>
00518         <span class="comment">// We found a subkey, NUL terminate the name and open the subkey.</span>
00519         <span class="comment">//</span>
00520         keyBasicInfo-&gt;Name[ keyBasicInfo-&gt;NameLength / 2 ] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00521 
00522         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;biosKeyName, keyBasicInfo-&gt;Name);
00523 
00524         status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a7">IopOpenRegistryKeyEx</a>( &amp;biosKey,
00525                                        multifunctionKey,
00526                                        &amp;biosKeyName,
00527                                        KEY_READ
00528                                        );
00529 
00530         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00531 
00532             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
00533                         <span class="stringliteral">"Could not open registry key %S\\%S, status = %8.8X\n"</span>,
00534                         MULTIFUNCTION_KEY_NAME,
00535                         keyBasicInfo-&gt;Name,
00536                         status) );
00537             <span class="keywordflow">break</span>;
00538         }
00539 
00540         <span class="comment">//</span>
00541         <span class="comment">// Now we need to check the Identifier value in the subkey to see if</span>
00542         <span class="comment">// it is PNP BIOS.</span>
00543         <span class="comment">//</span>
00544         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;valueName, L<span class="stringliteral">"Identifier"</span>);
00545 
00546         status = ZwQueryValueKey( biosKey,
00547                                   &amp;valueName,
00548                                   KeyValuePartialInformation,
00549                                   valueInfo,
00550                                   valueInfoLength,
00551                                   &amp;returnedLength);
00552 
00553 
00554         <span class="comment">// lets see if its the PNP BIOS identifier</span>
00555         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00556 
00557             <span class="keywordflow">if</span> (wcscmp((PWSTR)valueInfo-&gt;Data, L<span class="stringliteral">"PNP BIOS"</span>) == 0) {
00558 
00559                 <span class="comment">//</span>
00560                 <span class="comment">// We found the PnP BIOS subkey, retrieve the BIOS info which</span>
00561                 <span class="comment">// is stored in the "Configuration Data" value.</span>
00562                 <span class="comment">//</span>
00563                 <span class="comment">// We'll start off with our default value buffer and increase</span>
00564                 <span class="comment">// its size if necessary.</span>
00565                 <span class="comment">//</span>
00566 
00567                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;valueName, L<span class="stringliteral">"Configuration Data"</span>);
00568 
00569                 status = ZwQueryValueKey( biosKey,
00570                                           &amp;valueName,
00571                                           KeyValuePartialInformation,
00572                                           valueInfo,
00573                                           valueInfoLength,
00574                                           &amp;returnedLength);
00575 
00576                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00577 
00578                     <span class="keywordflow">if</span> (status == STATUS_BUFFER_TOO_SMALL || status == STATUS_BUFFER_OVERFLOW) {
00579 
00580                         <span class="comment">//</span>
00581                         <span class="comment">// The default buffer was too small, free it and reallocate</span>
00582                         <span class="comment">// it to the required size.</span>
00583                         <span class="comment">//</span>
00584                         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( valueInfo );
00585 
00586                         valueInfoLength = returnedLength;
00587                         valueInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, valueInfoLength );
00588 
00589                         <span class="keywordflow">if</span> (valueInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
00590 
00591                             status = ZwQueryValueKey( biosKey,
00592                                                       &amp;valueName,
00593                                                       KeyValuePartialInformation,
00594                                                       valueInfo,
00595                                                       valueInfoLength,
00596                                                       &amp;returnedLength );
00597                         } <span class="keywordflow">else</span> {
00598 
00599                             status = STATUS_NO_MEMORY;
00600                         }
00601                     }
00602                 }
00603 
00604                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00605 
00606                     <span class="comment">//</span>
00607                     <span class="comment">// We now have the PnP BIOS data but it is buried inside</span>
00608                     <span class="comment">// the resource structures.  Do some consistency checks and</span>
00609                     <span class="comment">// then extract it into its own buffer.</span>
00610                     <span class="comment">//</span>
00611 
00612                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(valueInfo-&gt;Type == REG_FULL_RESOURCE_DESCRIPTOR);
00613 
00614                     biosValue = (PCM_FULL_RESOURCE_DESCRIPTOR)valueInfo-&gt;Data;
00615 
00616                     <span class="comment">//</span>
00617                     <span class="comment">// BUGBUG - The WMI folks added another list so we should</span>
00618                     <span class="comment">// search for the PnPBIOS one, but for now the BIOS one is</span>
00619                     <span class="comment">// always first.</span>
00620                     <span class="comment">//</span>
00621                     <span class="comment">//ASSERT(biosValue-&gt;PartialResourceList.Count == 1);</span>
00622 
00623                     *BiosInfoLength = biosValue-&gt;PartialResourceList.PartialDescriptors[0].u.DeviceSpecificData.DataSize;
00624                     *BiosInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, *BiosInfoLength);
00625 
00626                     <span class="keywordflow">if</span> (*BiosInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00627 
00628                         RtlCopyMemory( *BiosInfo,
00629                                        &amp;biosValue-&gt;PartialResourceList.PartialDescriptors[1],
00630                                        *BiosInfoLength );
00631 
00632                         status = STATUS_SUCCESS;
00633 
00634                     } <span class="keywordflow">else</span> {
00635 
00636                         *BiosInfoLength = 0;
00637 
00638                         status = STATUS_NO_MEMORY;
00639                     }
00640 
00641                 } <span class="keywordflow">else</span> {
00642 
00643                     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
00644                                 <span class="stringliteral">"Error retrieving %S\\%S\\Configuration Data, status = %8.8X\n"</span>,
00645                                 MULTIFUNCTION_KEY_NAME,
00646                                 keyBasicInfo-&gt;Name,
00647                                 status) );
00648                 }
00649 
00650                 <span class="comment">//</span>
00651                 <span class="comment">// We found the PnP BIOS entry, so close the key handle and</span>
00652                 <span class="comment">// return.</span>
00653                 <span class="comment">//</span>
00654 
00655                 ZwClose(biosKey);
00656 
00657                 <span class="keywordflow">break</span>;
00658             }
00659         }
00660 
00661         <span class="comment">//</span>
00662         <span class="comment">// That wasn't it so close this handle and try the next subkey.</span>
00663         <span class="comment">//</span>
00664         ZwClose(biosKey);
00665     }
00666 
00667     <span class="comment">//</span>
00668     <span class="comment">// Cleanup the dynamically allocated temporary buffers.</span>
00669     <span class="comment">//</span>
00670 
00671     <span class="keywordflow">if</span> (valueInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00672 
00673         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(valueInfo);
00674     }
00675 
00676     <span class="keywordflow">if</span> (keyBasicInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00677 
00678         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(keyBasicInfo);
00679     }
00680 
00681     ZwClose(multifunctionKey);
00682 
00683     <span class="keywordflow">return</span> status;
00684 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="pnpmap.c::PnPBiosGetDescription" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWCHAR PnPBiosGetDescription           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DevNodeInfoEntry</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02053">2053</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d2/d1/pnpmap_8c.html#a33">ClassDescriptionsList</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00255">CLASSLIST_COUNT</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00095">DEFAULT_DEVICE_DESCRIPTION</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00128">_CLASSDATA::Description</a>, and <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00127">_CLASSDATA::Value</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.
<p>
<pre class="fragment"><div>02056 {
02057     ULONG       <span class="keyword">class</span>, subClass;
02058     LONG        index;
02059     <a class="code" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a>   *classDescriptions;
02060     LONG        descriptionCount;
02061 
02062     <span class="keyword">class </span>= DevNodeInfoEntry-&gt;TypeCode[0];
02063     subClass = (DevNodeInfoEntry-&gt;TypeCode[1] &lt;&lt; 8) | DevNodeInfoEntry-&gt;TypeCode[2];
02064 
02065     <span class="keywordflow">if</span> (<span class="keyword">class </span>&gt; 0 &amp;&amp; <span class="keyword">class </span>&lt; <a class="code" href="../../d2/d1/pnpmap_8c.html#a14">CLASSLIST_COUNT</a>) {
02066 
02067         classDescriptions = <a class="code" href="../../d2/d1/pnpmap_8c.html#a33">ClassDescriptionsList</a>[ <span class="keyword">class </span>].Descriptions;
02068         descriptionCount = <a class="code" href="../../d2/d1/pnpmap_8c.html#a33">ClassDescriptionsList</a>[ <span class="keyword">class </span>].<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
02069 
02070         <span class="comment">//</span>
02071         <span class="comment">// The last description entry is the default so there is no use</span>
02072         <span class="comment">// comparing it, if we get that far just use it.</span>
02073         <span class="comment">//</span>
02074         <span class="keywordflow">for</span> (index = 0; index &lt; (descriptionCount - 1); index++) {
02075 
02076             <span class="keywordflow">if</span> (subClass == classDescriptions[ index ].<a class="code" href="../../d0/d0/struct__CLASSDATA.html#o0">Value</a>)  {
02077 
02078                 <span class="keywordflow">break</span>;
02079             }
02080         }
02081 
02082         <span class="keywordflow">return</span> classDescriptions[ index ].<a class="code" href="../../d0/d0/struct__CLASSDATA.html#o1">Description</a>;
02083     }
02084 
02085     <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/pnpmap_8c.html#a9">DEFAULT_DEVICE_DESCRIPTION</a>;
02086 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="pnpmap.c::PnPBiosIgnoreNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN PnPBiosIgnoreNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>PnpID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>excludeNodes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00726">726</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.
<p>
<pre class="fragment"><div>00730 {
00731     BOOLEAN bRet=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00732     ULONG   keyLen;
00733     PWCHAR  pTmp;
00734 
00735     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (excludeNodes);
00736 
00737     <span class="comment">//</span>
00738     <span class="comment">//excludeNodes is multi-sz, so walk through each one and check it.</span>
00739     <span class="comment">//</span>
00740     pTmp=excludeNodes;
00741 
00742     <span class="keywordflow">while</span> (*pTmp != <span class="charliteral">'\0'</span>) {
00743 
00744         keyLen = wcslen (pTmp);
00745 
00746         <span class="keywordflow">if</span> (RtlCompareMemory (PnpID,pTmp,keyLen*<span class="keyword">sizeof</span> (WCHAR)) == keyLen*<span class="keyword">sizeof</span> (WCHAR)) {
00747             bRet=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00748             <span class="keywordflow">break</span>;
00749         }
00750         pTmp=pTmp+keyLen+1;
00751 
00752     }
00753 
00754 
00755     <span class="keywordflow">return</span> bRet;
00756 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="pnpmap.c::PnPBiosIoResourceListToCmResourceList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosIoResourceListToCmResourceList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PIO_RESOURCE_REQUIREMENTS_LIST&nbsp;</td>
          <td class="mdname" nowrap> <em>IoResourceList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCM_RESOURCE_LIST *&nbsp;</td>
          <td class="mdname" nowrap> <em>CmResourceList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT ULONG *&nbsp;</td>
          <td class="mdname" nowrap> <em>CmResourceListSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00890">890</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">PnPBiosTranslateInfo()</a>.
<p>
<pre class="fragment"><div>00897                    :
00898 
00899     Converts an IO_RESOURCE_REQUIREMENTS_LIST into a CM_RESOURCE_LIST.  This
00900     routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to convert <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list of resources currently being used by a
00901     device into a form suitable <span class="keywordflow">for</span> writing to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BootConfig registry value.
00902 
00903 Arguments:
00904 
00905     IoResourceList - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input list.
00906 
00907     CmResourceList - Pointer to a PCM_RESOURCE_LIST which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00908         dynamically allocated and filled in <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data from IoResourceList.
00909 
00910     CmResourceListSize - Pointer to a variable which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size in bytes
00911         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dynamically allocated *CmResourceList.
00912 
00913 Return Value:
00914 
00915     STATUS_SUCCESS <span class="keywordflow">if</span> no errors, otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate error.
00916 
00917 --*/
00918 {
00919     PCM_PARTIAL_RESOURCE_LIST       partialList;
00920     PCM_PARTIAL_RESOURCE_DESCRIPTOR partialDescriptor;
00921     PIO_RESOURCE_DESCRIPTOR         ioDescriptor;
00922     ULONG                           descIndex;
00923 
00924     <span class="comment">//</span>
00925     <span class="comment">// Since this routine is only used to translate the allocated resources</span>
00926     <span class="comment">// returned by the PnP BIOS, we can assume that there is only 1 alternative</span>
00927     <span class="comment">// list</span>
00928     <span class="comment">//</span>
00929 
00930     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(IoResourceList-&gt;AlternativeLists == 1);
00931 
00932     <span class="comment">//</span>
00933     <span class="comment">// Calculate the size of the translated list and allocate memory for it.</span>
00934     <span class="comment">//</span>
00935     *CmResourceListSize = <span class="keyword">sizeof</span>(CM_RESOURCE_LIST) +
00936                           (IoResourceList-&gt;AlternativeLists - 1) * <span class="keyword">sizeof</span>(CM_FULL_RESOURCE_DESCRIPTOR) +
00937                           (IoResourceList-&gt;List[0].Count - 1) * <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_DESCRIPTOR);
00938 
00939     *CmResourceList = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, *CmResourceListSize );
00940 
00941     <span class="keywordflow">if</span> (*CmResourceList == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00942 
00943         *CmResourceListSize = 0;
00944 
00945         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00946     }
00947 
00948     <span class="comment">//</span>
00949     <span class="comment">// Copy the header info from the requirements list to the resource list.</span>
00950     <span class="comment">//</span>
00951     (*CmResourceList)-&gt;Count = 1;
00952 
00953     (*CmResourceList)-&gt;List[ 0 ].InterfaceType = IoResourceList-&gt;InterfaceType;
00954     (*CmResourceList)-&gt;List[ 0 ].BusNumber = IoResourceList-&gt;BusNumber;
00955 
00956     partialList = &amp;(*CmResourceList)-&gt;List[ 0 ].PartialResourceList;
00957 
00958     partialList-&gt;Version = IoResourceList-&gt;List[ 0 ].Version;
00959     partialList-&gt;Revision = IoResourceList-&gt;List[ 0 ].Revision;
00960     partialList-&gt;Count = 0;
00961 
00962     <span class="comment">//</span>
00963     <span class="comment">// Translate each resource descriptor, currently we only handle ports,</span>
00964     <span class="comment">// memory, interrupts, and dma.  The current implementation of the routine</span>
00965     <span class="comment">// which converts from ISA PnP Resource data to IO_RESOURCE_REQUIREMENTS</span>
00966     <span class="comment">// won't generate any other descriptor types given the data returned from</span>
00967     <span class="comment">// the BIOS.</span>
00968     <span class="comment">//</span>
00969 
00970     partialDescriptor = &amp;partialList-&gt;PartialDescriptors[ 0 ];
00971     <span class="keywordflow">for</span> (descIndex = 0; descIndex &lt; IoResourceList-&gt;List[ 0 ].Count; descIndex++) {
00972 
00973         ioDescriptor = &amp;IoResourceList-&gt;List[ 0 ].Descriptors[ descIndex ];
00974 
00975         <span class="keywordflow">switch</span> (ioDescriptor-&gt;Type) {
00976 
00977         <span class="keywordflow">case</span> CmResourceTypePort:
00978             partialDescriptor-&gt;u.Port.Start = ioDescriptor-&gt;u.Port.MinimumAddress;
00979             partialDescriptor-&gt;u.Port.Length = ioDescriptor-&gt;u.Port.Length;
00980             <span class="keywordflow">break</span>;
00981 
00982         <span class="keywordflow">case</span> CmResourceTypeInterrupt:
00983             <span class="keywordflow">if</span> (ioDescriptor-&gt;u.Interrupt.MinimumVector == (ULONG)(IsNEC_98 ? 7 : 2) ) {
00984                 *CmResourceListSize -= <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_DESCRIPTOR);
00985                 <span class="keywordflow">continue</span>;
00986             }
00987             partialDescriptor-&gt;u.Interrupt.Level = ioDescriptor-&gt;u.Interrupt.MinimumVector;
00988             partialDescriptor-&gt;u.Interrupt.Vector = ioDescriptor-&gt;u.Interrupt.MinimumVector;
00989             partialDescriptor-&gt;u.Interrupt.Affinity = ~0;
00990             <span class="keywordflow">break</span>;
00991 
00992         <span class="keywordflow">case</span> CmResourceTypeMemory:
00993             partialDescriptor-&gt;u.Memory.Start = ioDescriptor-&gt;u.Memory.MinimumAddress;
00994             partialDescriptor-&gt;u.Memory.Length = ioDescriptor-&gt;u.Memory.Length;
00995             <span class="keywordflow">break</span>;
00996 
00997         <span class="keywordflow">case</span> CmResourceTypeDma:
00998             partialDescriptor-&gt;u.Dma.Channel = ioDescriptor-&gt;u.Dma.MinimumChannel;
00999             partialDescriptor-&gt;u.Dma.Port = 0;
01000             partialDescriptor-&gt;u.Dma.Reserved1 = 0;
01001             <span class="keywordflow">break</span>;
01002 
01003         <span class="keywordflow">default</span>:
01004             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01005                         <span class="stringliteral">"Unexpected ResourceType (%d) in I/O Descriptor\n"</span>,
01006                         ioDescriptor-&gt;Type) );
01007 
01008 <span class="preprocessor">#if DBG</span>
01009 <span class="preprocessor"></span>            <span class="comment">// DbgBreakPoint();</span>
01010 <span class="preprocessor">#endif</span>
01011 <span class="preprocessor"></span>            <span class="keywordflow">break</span>;
01012         }
01013 
01014         partialDescriptor-&gt;Type = ioDescriptor-&gt;Type;
01015         partialDescriptor-&gt;ShareDisposition = ioDescriptor-&gt;ShareDisposition;
01016         partialDescriptor-&gt;Flags = ioDescriptor-&gt;Flags;
01017         partialDescriptor++;
01018 
01019         partialList-&gt;Count++;
01020     }
01021 
01022     <span class="keywordflow">return</span> STATUS_SUCCESS;
01023 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="pnpmap.c::PnPBiosMapper" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosMapper           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l03008">3008</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d1/pnpmap_8c.html#a35">PBIOS_DEVNODE_INFO</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01725">PnPBiosEliminateDupes()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02956">PnPBiosFreeDevNodeInfo()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00399">PnPBiosGetBiosInfo()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">PnPBiosTranslateInfo()</a>, and <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>.
<p>
<pre class="fragment"><div>03011                    :
03012 
03013     Map <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information provided from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PnP BIOS and stored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry by
03014     NTDETECT into root enumerated devices.
03015 
03016 Arguments:
03017 
03018     NONE
03019 
03020 Return Value:
03021 
03022     STATUS_SUCCESS <span class="keywordflow">if</span> no errors, otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate error.
03023 
03024 --*/
03025 {
03026     PCM_RESOURCE_LIST   biosInfo;
03027     ULONG               length;
03028     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status;
03029     <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a>  devNodeInfoList;
03030     ULONG               numberNodes;
03031 
03032     status = <a class="code" href="../../d2/d1/pnpmap_8c.html#a52">PnPBiosGetBiosInfo</a>( &amp;biosInfo, &amp;length );
03033 
03034     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( status )) {
03035 
03036         <span class="keywordflow">return</span> status;
03037     }
03038 
03039     status = <a class="code" href="../../d2/d1/pnpmap_8c.html#a40">PnPBiosTranslateInfo</a>( biosInfo,
03040                                    length,
03041                                    &amp;devNodeInfoList,
03042                                    &amp;numberNodes );
03043 
03044     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( biosInfo );
03045 
03046     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( status )) {
03047 
03048         <span class="keywordflow">return</span> status;
03049     }
03050 
03051     status = <a class="code" href="../../d2/d1/pnpmap_8c.html#a42">PnPBiosEliminateDupes</a>( devNodeInfoList, numberNodes );
03052 
03053     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( status )) {
03054 
03055         status = <a class="code" href="../../d2/d1/pnpmap_8c.html#a44">PnPBiosWriteInfo</a>( devNodeInfoList, numberNodes );
03056 
03057     }
03058 
03059     <a class="code" href="../../d2/d1/pnpmap_8c.html#a46">PnPBiosFreeDevNodeInfo</a>( devNodeInfoList, numberNodes );
03060 
03061     <span class="keywordflow">return</span> status;
03062 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="pnpmap.c::PnPBiosMapper" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosMapper           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="pnpmap.c::PnPBiosTranslateInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosTranslateInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN VOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>BiosInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BiosInfoLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>DevNodeInfoList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT ULONG *&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberNodes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">1126</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00261">_BIOS_DEVNODE_INFO::Attributes</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00266">_BIOS_DEVNODE_INFO::BasicConfig</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00264">_BIOS_DEVNODE_INFO::BootConfig</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00268">_BIOS_DEVNODE_INFO::CompatibleIDs</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00270">_BIOS_DEVNODE_INFO::FirmwareDisabled</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00259">_BIOS_DEVNODE_INFO::Handle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d2/d1/pnpmap_8c.html#a35">PBIOS_DEVNODE_INFO</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02852">PnPBiosCheckForHardwareDisabled()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00687">PnPBiosExpandProductId()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01026">PnPBiosExtractCompatibleIDs()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00890">PnPBiosIoResourceListToCmResourceList()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00788">PnPCheckFixedIoOverrideDecodes()</a>, <a class="el" href="../../d0/d0/pnpcvrt_8h.html#a3">PpBiosResourcesToNtResources()</a>, <a class="el" href="../../d1/d9/pnpcvrt_8h-source.html#l00034">PPCONVERTFLAG_FORCE_FIXED_IO_16BIT_DECODE</a>, <a class="el" href="../../d1/d9/pnpcvrt_8h-source.html#l00033">PPCONVERTFLAG_SET_RESTART_LCPRI</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l03065">PpFilterNtResource()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00258">_BIOS_DEVNODE_INFO::ProductId</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00262">_BIOS_DEVNODE_INFO::Replaces</a>, and <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00260">_BIOS_DEVNODE_INFO::TypeCode</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l03008">PnPBiosMapper()</a>.
<p>
<pre class="fragment"><div>01134                    :
01135 
01136     Translates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> devnode info retrieved from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS.
01137 
01138 Arguments:
01139 
01140     BiosInfo - The PnP BIOS Installation Check Structure followed by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01141         DevNode Structures reported by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS.  The detailed <a class="code" href="../../d8/d0/rtbatcr_8c.html#a8">format</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01142         documented in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PnP BIOS spec.
01143 
01144     BiosInfoLength - Length in bytes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> block whose address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> stored in
01145         BiosInfo.
01146 
01147     DevNodeInfoList - Dynamically allocated array of <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a>
01148         structures, one <span class="keywordflow">for</span> each device reported by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS.  The information
01149         supplied by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS: device <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>, <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>, current resources, and supported
01150         configurations <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> converted into a more useful <a class="code" href="../../d8/d0/rtbatcr_8c.html#a8">format</a>.  For example <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01151         current resource allocation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> converted from ISA PnP descriptors into
01152         an IO_RESOURCE_REQUIREMENTS_LIST and then into a CM_RESOURCE_LIST <span class="keywordflow">for</span>
01153         storing into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BootConfig registry value.
01154 
01155     NumberNodes - Number of <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a> elements pointed to by
01156         DevNodeInfoList.
01157 
01158 Return Value:
01159 
01160     STATUS_SUCCESS <span class="keywordflow">if</span> no errors, otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate error.
01161 
01162 --*/
01163 {
01164     PCM_PNP_BIOS_INSTALLATION_CHECK biosInstallCheck;
01165     PCM_PNP_BIOS_DEVICE_NODE        devNodeHeader;
01166     <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a>              devNodeInfo;
01167     PKEY_VALUE_FULL_INFORMATION     excludeList=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01168 
01169     PIO_RESOURCE_REQUIREMENTS_LIST  tempResReqList;
01170 
01171     PUCHAR                          currentPtr;
01172     LONG                            lengthRemaining;
01173 
01174     LONG                            remainingNodeLength;
01175 
01176     ULONG                           numNodes;
01177     ULONG                           nodeIndex;
01178     PUCHAR                          configPtr;
01179     ULONG                           configListLength;
01180     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                        status;
01181     ULONG                           convertFlags = 0;
01182 
01183     <span class="comment">//</span>
01184     <span class="comment">// Make sure the data is at least large enough to hold the BIOS Installation</span>
01185     <span class="comment">// Check structure and check that the PnP signature is correct.</span>
01186     <span class="comment">//</span>
01187     <span class="keywordflow">if</span> (BiosInfoLength &lt; <span class="keyword">sizeof</span>(CM_PNP_BIOS_INSTALLATION_CHECK)) {
01188 
01189         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01190                     <span class="stringliteral">"BiosInfoLength (%d) is smaller than sizeof(PNPBIOS_INSTALLATION_CHECK) (%d)\n"</span>,
01191                     BiosInfoLength,
01192                     <span class="keyword">sizeof</span>(CM_PNP_BIOS_INSTALLATION_CHECK)) );
01193 
01194         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01195     }
01196 
01197     biosInstallCheck = (PCM_PNP_BIOS_INSTALLATION_CHECK)BiosInfo;
01198 
01199     <span class="keywordflow">if</span> (biosInstallCheck-&gt;Signature[0] != <span class="charliteral">'$'</span> ||
01200         biosInstallCheck-&gt;Signature[1] != <span class="charliteral">'P'</span> ||
01201         biosInstallCheck-&gt;Signature[2] != <span class="charliteral">'n'</span> ||
01202         biosInstallCheck-&gt;Signature[3] != <span class="charliteral">'P'</span>) {
01203 
01204         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01205     }
01206 
01207     <span class="comment">//</span>
01208     <span class="comment">// First scan the data and count the devnodes to determine the size of our</span>
01209     <span class="comment">// allocated data structures.</span>
01210     <span class="comment">//</span>
01211     currentPtr = (PUCHAR)BiosInfo + biosInstallCheck-&gt;Length;
01212     lengthRemaining = BiosInfoLength - biosInstallCheck-&gt;Length;
01213 
01214     <span class="keywordflow">for</span> (numNodes = 0; lengthRemaining &gt; <span class="keyword">sizeof</span>(CM_PNP_BIOS_DEVICE_NODE); numNodes++) {
01215 
01216         devNodeHeader = (PCM_PNP_BIOS_DEVICE_NODE)currentPtr;
01217 
01218         <span class="keywordflow">if</span> (devNodeHeader-&gt;Size &gt; lengthRemaining) {
01219 
01220             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01221                         <span class="stringliteral">"Node # %d, invalid size (%d), length remaining (%d)\n"</span>,
01222                         devNodeHeader-&gt;Node,
01223                         devNodeHeader-&gt;Size,
01224                         lengthRemaining) );
01225 
01226             <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01227         }
01228 
01229         currentPtr += devNodeHeader-&gt;Size;
01230         lengthRemaining -= devNodeHeader-&gt;Size;
01231     }
01232 
01233     <span class="comment">//</span>
01234     <span class="comment">// Allocate the list of translated devnodes.</span>
01235     <span class="comment">//</span>
01236     devNodeInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, numNodes * <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a>) );
01237 
01238     <span class="keywordflow">if</span> (devNodeInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01239 
01240         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01241     }
01242 
01243     <span class="comment">//</span>
01244     <span class="comment">// Should we force all fixed IO decodes to 16bit?</span>
01245     <span class="comment">//</span>
01246     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/pnpmap_8c.html#a55">PnPCheckFixedIoOverrideDecodes</a>()) {
01247 
01248         convertFlags |= <a class="code" href="../../d0/d0/pnpcvrt_8h.html#a1">PPCONVERTFLAG_FORCE_FIXED_IO_16BIT_DECODE</a>;
01249     }
01250 
01251     <span class="comment">//</span>
01252     <span class="comment">// Now scan the data translating the info for each devnode into an entry in</span>
01253     <span class="comment">// our devNodeInfo array.</span>
01254     <span class="comment">//</span>
01255 
01256     currentPtr = (PUCHAR)BiosInfo + biosInstallCheck-&gt;Length;
01257     lengthRemaining = BiosInfoLength - biosInstallCheck-&gt;Length;
01258 
01259     <span class="keywordflow">for</span> (nodeIndex = 0; nodeIndex &lt; numNodes; nodeIndex++) {
01260 
01261         devNodeHeader = (PCM_PNP_BIOS_DEVICE_NODE)currentPtr;
01262 
01263         <span class="keywordflow">if</span> (devNodeHeader-&gt;Size &gt; lengthRemaining) {
01264 
01265             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01266                         <span class="stringliteral">"Node # %d, invalid size (%d), length remaining (%d)\n"</span>,
01267                         devNodeHeader-&gt;Node,
01268                         devNodeHeader-&gt;Size,
01269                         lengthRemaining) );
01270 
01271             <span class="keywordflow">break</span>;
01272         }
01273 
01274         <span class="comment">//</span>
01275         <span class="comment">// We use the Product ID field as the DeviceID key name.  So we insert</span>
01276         <span class="comment">// an initial asterisk so we don't have to copy and mangle it later.</span>
01277         <span class="comment">//</span>
01278         devNodeInfo[nodeIndex].<a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html#o0">ProductId</a>[0] = <span class="charliteral">'*'</span>;
01279 
01280         <a class="code" href="../../d2/d1/pnpmap_8c.html#a37">PnPBiosExpandProductId</a>((PUCHAR)&amp;devNodeHeader-&gt;ProductId, &amp;devNodeInfo[nodeIndex].ProductId[1]);
01281 
01282         devNodeInfo[nodeIndex].<a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html#o0">ProductId</a>[9] = <span class="charliteral">'\0'</span>;  <span class="comment">// Extra NUL for REG_MULTI_SZ</span>
01283 
01284         <span class="comment">//</span>
01285         <span class="comment">// The handle is used as part of the Instance ID</span>
01286         devNodeInfo[nodeIndex].<a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html#o1">Handle</a> = devNodeHeader-&gt;Node;
01287 
01288         <span class="comment">//</span>
01289         <span class="comment">// The type code and attributes aren't currently used but are copied</span>
01290         <span class="comment">// for completeness.</span>
01291         <span class="comment">//</span>
01292         RtlCopyMemory( &amp;devNodeInfo[nodeIndex].TypeCode,
01293                        devNodeHeader-&gt;DeviceType,
01294                        <span class="keyword">sizeof</span>(devNodeInfo[nodeIndex].TypeCode) );
01295 
01296         devNodeInfo[nodeIndex].<a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html#o3">Attributes</a> = devNodeHeader-&gt;DeviceAttributes;
01297 
01298         <span class="comment">//</span>
01299         <span class="comment">// Replaces will eventually be set to the path of the Firmware</span>
01300         <span class="comment">// Enumerated devnode which duplicates this one (if a duplicate exists).</span>
01301         <span class="comment">//</span>
01302         devNodeInfo[nodeIndex].<a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html#o4">Replaces</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01303 
01304         <span class="comment">//</span>
01305         <span class="comment">// CompatibleIDs will be set to the list of compatible IDs.</span>
01306         <span class="comment">//</span>
01307         devNodeInfo[nodeIndex].<a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html#o9">CompatibleIDs</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01308 
01309         <span class="comment">//</span>
01310         <span class="comment">// Convert the allocated resources from ISA PnP resource descriptor</span>
01311         <span class="comment">// format to an IO_RESOURCE_REQUIREMENTS_LIST.</span>
01312         <span class="comment">//</span>
01313         configPtr = currentPtr + <span class="keyword">sizeof</span>(*devNodeHeader);
01314         remainingNodeLength = devNodeHeader-&gt;Size - <span class="keyword">sizeof</span>(*devNodeHeader);
01315 
01316         devNodeInfo[nodeIndex].<a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html#o5">BootConfig</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01317         devNodeInfo[nodeIndex].<a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html#o11">FirmwareDisabled</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01318 
01319         status = <a class="code" href="../../d0/d0/pnpcvrt_8h.html#a3">PpBiosResourcesToNtResources</a>( 0,            <span class="comment">/* BusNumber */</span>
01320                                                0,            <span class="comment">/* SlotNumber */</span>
01321                                                &amp;configPtr,   <span class="comment">/* BiosData */</span>
01322                                                convertFlags, <span class="comment">/* ConvertFlags */</span>
01323                                                &amp;tempResReqList, <span class="comment">/* ReturnedList */</span>
01324                                                &amp;configListLength);    <span class="comment">/* ReturnedLength */</span>
01325 
01326         remainingNodeLength = devNodeHeader-&gt;Size - (LONG)(configPtr - (PUCHAR)devNodeHeader);
01327 
01328         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( status )) {
01329 
01330             <span class="keywordflow">if</span> (tempResReqList != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01331 
01332                 <a class="code" href="../../d2/d1/pnpmap_8c.html#a50">PpFilterNtResource</a> (
01333                     devNodeInfo[nodeIndex].ProductId,
01334                     tempResReqList
01335                 );
01336 
01337                 <span class="comment">//</span>
01338                 <span class="comment">// Now we need to convert from a IO_RESOURCE_REQUIREMENTS_LIST to a</span>
01339                 <span class="comment">// CM_RESOURCE_LIST.</span>
01340                 <span class="comment">//</span>
01341                 status = <a class="code" href="../../d2/d1/pnpmap_8c.html#a38">PnPBiosIoResourceListToCmResourceList</a>( tempResReqList,
01342                                                                 &amp;devNodeInfo[nodeIndex].BootConfig,
01343                                                                 &amp;devNodeInfo[nodeIndex].BootConfigLength );
01344 
01345                 status = <a class="code" href="../../d2/d1/pnpmap_8c.html#a47">PnPBiosCheckForHardwareDisabled</a>(tempResReqList,&amp;devNodeInfo[nodeIndex].FirmwareDisabled);
01346 
01347                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( tempResReqList );
01348 
01349             }
01350 
01351         } <span class="keywordflow">else</span> {
01352 
01353             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01354                         <span class="stringliteral">"Error converting allocated resources for devnode # %d, status = %8.8X\n"</span>,
01355                         devNodeInfo[nodeIndex].Handle,
01356                         status) );
01357         }
01358 
01359         <span class="comment">//</span>
01360         <span class="comment">// Convert the supported resource configurations from ISA PnP resource</span>
01361         <span class="comment">// descriptor format to an IO_RESOURCE_REQUIREMENTS_LIST.</span>
01362         <span class="comment">//</span>
01363         status = <a class="code" href="../../d0/d0/pnpcvrt_8h.html#a3">PpBiosResourcesToNtResources</a>( 0,            <span class="comment">/* BusNumber */</span>
01364                                                0,            <span class="comment">/* SlotNumber */</span>
01365                                                &amp;configPtr,   <span class="comment">/* BiosData */</span>
01366                                                convertFlags | PPCONVERTFLAG_SET_RESTART_LCPRI, <span class="comment">/* ConvertFlags */</span>
01367                                                &amp;devNodeInfo[nodeIndex].BasicConfig, <span class="comment">/* ReturnedList */</span>
01368                                                &amp;devNodeInfo[nodeIndex].BasicConfigLength );  <span class="comment">/* ReturnedLength */</span>
01369 
01370         remainingNodeLength = devNodeHeader-&gt;Size - (LONG)(configPtr - (PUCHAR)devNodeHeader);
01371 
01372         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( status )) {
01373 
01374             devNodeInfo[nodeIndex].<a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html#o7">BasicConfig</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01375 
01376             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
01377                         <span class="stringliteral">"Error converting allowed resources for devnode # %d, status = %8.8X\n"</span>,
01378                         devNodeInfo[nodeIndex].Handle,
01379                         status) );
01380         } <span class="keywordflow">else</span> {
01381 
01382             <a class="code" href="../../d2/d1/pnpmap_8c.html#a50">PpFilterNtResource</a> (
01383                 devNodeInfo[nodeIndex].ProductId,
01384                 devNodeInfo[nodeIndex].BasicConfig
01385             );
01386         }
01387 
01388         <span class="comment">//</span>
01389         <span class="comment">// Convert the list of compatible IDs if present</span>
01390         <span class="comment">//</span>
01391 
01392         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(remainingNodeLength &gt;= 0);
01393 
01394         status = <a class="code" href="../../d2/d1/pnpmap_8c.html#a39">PnPBiosExtractCompatibleIDs</a>( &amp;configPtr,       <span class="comment">// BiosData</span>
01395                                               (ULONG)remainingNodeLength,
01396                                               &amp;devNodeInfo[nodeIndex].CompatibleIDs,
01397                                               &amp;devNodeInfo[nodeIndex].CompatibleIDsLength );
01398 
01399         currentPtr += devNodeHeader-&gt;Size;
01400         lengthRemaining -= devNodeHeader-&gt;Size;
01401 
01402     }
01403 
01404     *DevNodeInfoList = devNodeInfo;
01405     *NumberNodes = numNodes;
01406     <span class="keywordflow">return</span> STATUS_SUCCESS;
01407 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="pnpmap.c::PnPBiosWriteInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PnPBiosWriteInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">PBIOS_DEVNODE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DevNodeInfoList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberNodes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">2289</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00092">DEFAULT_STRING_SIZE</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00083">ENUMROOT_KEY_NAME</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00124">EXCLUDE_DISABLED_COUNT</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00117">EXCLUDED_DEVICES_COUNT</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00105">ExcludedDevices</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00119">ExcludeIfDisabled</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00090">INSTANCE_ID_PREFIX</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01156">IopCreateRegistryKeyEx()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l05902">IopDeleteKeyRecursive()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01104">IopOpenRegistryKeyEx()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00835">PnPBiosCheckForExclusion()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02089">PnPBiosCopyDeviceParamKey()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02663">PnPBiosCopyIoDecode()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02053">PnPBiosGetDescription()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00726">PnPBiosIgnoreNode()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00759">PnPGetDevnodeExcludeList()</a>, and <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l03008">PnPBiosMapper()</a>.
<p>
<pre class="fragment"><div>02295                    :
02296 
02297     Creates an entry under Enum\Root <span class="keywordflow">for</span> each DevNodeInfoList element.  Also
02298     removes any duplicate entries which were created by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Firmware Mapper.
02299 
02300     Note: Currently entries <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Keyboard, Mouse, and PCI bus are ignored.
02301 
02302 Arguments:
02303 
02304     DevNodeInfoList - Array of <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a> structures, one <span class="keywordflow">for</span> each device
02305         reported by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BIOS.
02306 
02307     NumberNodes - Number of <a class="code" href="../../d7/d3/struct__BIOS__DEVNODE__INFO.html">BIOS_DEVNODE_INFO</a> elements pointed to by
02308         DevNodeInfoList.
02309 
02310 Return Value:
02311 
02312     STATUS_SUCCESS <span class="keywordflow">if</span> no errors, otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate error.
02313 
02314 --*/
02315 {
02316     PKEY_VALUE_FULL_INFORMATION     excludeList=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02317 
02318     UNICODE_STRING                  enumRootKeyName;
02319     HANDLE                          enumRootKey;
02320     WCHAR                           instanceNameStr[<a class="code" href="../../d2/d1/pnpmap_8c.html#a7">DEFAULT_STRING_SIZE</a>];
02321     UNICODE_STRING                  instanceKeyName;
02322     HANDLE                          instanceKey;
02323     UNICODE_STRING                  controlKeyName;
02324     HANDLE                          controlKey;
02325     UNICODE_STRING                  logConfKeyName;
02326     HANDLE                          logConfKey;
02327 
02328     UNICODE_STRING                  valueName;
02329     ULONG                           dwordValue;
02330     ULONG                           disposition;
02331 
02332     PWCHAR                          descriptionStr;
02333     ULONG                           descriptionStrLength;
02334 
02335     ULONG                           nodeIndex;
02336     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                        status;
02337 
02338     BOOLEAN                         isNewDevice;
02339 
02340     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;enumRootKeyName, ENUMROOT_KEY_NAME);
02341 
02342     status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a7">IopOpenRegistryKeyEx</a>( &amp;enumRootKey,
02343                                    NULL,
02344                                    &amp;enumRootKeyName,
02345                                    KEY_ALL_ACCESS
02346                                    );
02347 
02348     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02349 
02350         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02351                     <span class="stringliteral">"Could not open registry key %S, status = %8.8X\n"</span>,
02352                     ENUMROOT_KEY_NAME,
02353                     status) );
02354 
02355         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
02356 
02357     }
02358 
02359     <span class="comment">//</span>
02360     <span class="comment">// Reasons why a node might be excluded (i.e not enumerated)</span>
02361     <span class="comment">// * included in ExcludedDevices array (non-conditional)</span>
02362     <span class="comment">// * included in CCS\Control\BiosInfo\PnpBios\DisableNodes via biosinfo.inf</span>
02363     <span class="comment">// * resources are disabled and device is included in the</span>
02364     <span class="comment">//   ExcludeIfDisabled array</span>
02365 
02366     <a class="code" href="../../d2/d1/pnpmap_8c.html#a54">PnPGetDevnodeExcludeList</a> (&amp;excludeList);
02367 
02368     <span class="keywordflow">for</span> (nodeIndex = 0; nodeIndex &lt; NumberNodes; nodeIndex++) {
02369 
02370         <span class="comment">//</span>
02371         <span class="comment">// Check if this node is in the 'ignore on this machine' list.</span>
02372         <span class="comment">//</span>
02373 
02374         <span class="keywordflow">if</span> ( excludeList &amp;&amp;
02375              <a class="code" href="../../d2/d1/pnpmap_8c.html#a53">PnPBiosIgnoreNode</a>( &amp;DevNodeInfoList[ nodeIndex ].ProductId[1],
02376                                 (PWCHAR)((PUCHAR)excludeList+excludeList-&gt;DataOffset))) {
02377             <span class="keywordflow">continue</span>;
02378         }
02379 
02380         <span class="comment">// Checking for nodes we always exclude</span>
02381         <span class="keywordflow">if</span> ( <a class="code" href="../../d2/d1/pnpmap_8c.html#a56">PnPBiosCheckForExclusion</a>( ExcludedDevices,
02382                                        EXCLUDED_DEVICES_COUNT,
02383                                        DevNodeInfoList[ nodeIndex ].ProductId,
02384                                        DevNodeInfoList[ nodeIndex ].CompatibleIDs)) {
02385             <span class="comment">//</span>
02386             <span class="comment">// If we are skipping the device, we need to first copy the decode</span>
02387             <span class="comment">// info that the BIOS supplied to the ntdetected device's Boot</span>
02388             <span class="comment">// Config which was generated by the FW mapper.</span>
02389             <span class="comment">//</span>
02390             <a class="code" href="../../d2/d1/pnpmap_8c.html#a45">PnPBiosCopyIoDecode</a>( enumRootKey, &amp;DevNodeInfoList[ nodeIndex ] );
02391 
02392             <span class="comment">//</span>
02393             <span class="comment">// Skip excluded devices, ie busses, mice and keyboards for now.</span>
02394             <span class="comment">//</span>
02395 
02396             <span class="keywordflow">continue</span>;
02397         }
02398 
02399         <span class="comment">// Checking for nodes we exclude if disabled</span>
02400         <span class="keywordflow">if</span> ( DevNodeInfoList[ nodeIndex ].FirmwareDisabled &amp;&amp;
02401              <a class="code" href="../../d2/d1/pnpmap_8c.html#a56">PnPBiosCheckForExclusion</a>( ExcludeIfDisabled,
02402                                        EXCLUDE_DISABLED_COUNT,
02403                                        DevNodeInfoList[ nodeIndex ].ProductId,
02404                                        NULL)) {
02405             <span class="keywordflow">continue</span>;
02406         }
02407 
02408         swprintf( instanceNameStr,
02409                   L<span class="stringliteral">"%s\\%s%d"</span>,
02410                   DevNodeInfoList[ nodeIndex ].ProductId,
02411                   INSTANCE_ID_PREFIX,
02412                   DevNodeInfoList[ nodeIndex ].Handle );
02413 
02414         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;instanceKeyName, instanceNameStr );
02415 
02416         status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a8">IopCreateRegistryKeyEx</a>( &amp;instanceKey,
02417                                          enumRootKey,
02418                                          &amp;instanceKeyName,
02419                                          KEY_ALL_ACCESS,
02420                                          REG_OPTION_NON_VOLATILE,
02421                                          &amp;disposition
02422                                          );
02423 
02424         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))  {
02425 
02426             isNewDevice = disposition == REG_CREATED_NEW_KEY;
02427 
02428             <span class="keywordflow">if</span> (isNewDevice) {
02429 
02430                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, L<span class="stringliteral">"DeviceDesc"</span> );
02431 
02432                 descriptionStr = <a class="code" href="../../d2/d1/pnpmap_8c.html#a43">PnPBiosGetDescription</a>( &amp;DevNodeInfoList[ nodeIndex ] );
02433                 descriptionStrLength = wcslen(descriptionStr) * 2 + <span class="keyword">sizeof</span>(UNICODE_NULL);
02434 
02435                 status = ZwSetValueKey( instanceKey,
02436                                         &amp;valueName,
02437                                         0,
02438                                         REG_SZ,
02439                                         descriptionStr,
02440                                         descriptionStrLength );
02441             }
02442 
02443             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, REGSTR_VAL_FIRMWAREIDENTIFIED );
02444             dwordValue = 1;
02445 
02446             status = ZwSetValueKey( instanceKey,
02447                                     &amp;valueName,
02448                                     0,
02449                                     REG_DWORD,
02450                                     &amp;dwordValue,
02451                                     <span class="keyword">sizeof</span>(dwordValue) );
02452 
02453             <span class="keywordflow">if</span> (isNewDevice)  {
02454 
02455                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, L<span class="stringliteral">"HardwareID"</span> );
02456 
02457                 status = ZwSetValueKey( instanceKey,
02458                                         &amp;valueName,
02459                                         0,
02460                                         REG_MULTI_SZ,
02461                                         DevNodeInfoList[ nodeIndex ].ProductId,
02462                                         <span class="keyword">sizeof</span>(DevNodeInfoList[ nodeIndex ].ProductId) );
02463 
02464                 <span class="keywordflow">if</span> (DevNodeInfoList[ nodeIndex ].CompatibleIDs != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02465 
02466                     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, L<span class="stringliteral">"CompatibleIDs"</span> );
02467 
02468                     status = ZwSetValueKey( instanceKey,
02469                                             &amp;valueName,
02470                                             0,
02471                                             REG_MULTI_SZ,
02472                                             DevNodeInfoList[ nodeIndex ].CompatibleIDs,
02473                                             DevNodeInfoList[ nodeIndex ].CompatibleIDsLength );
02474                 }
02475             }
02476 
02477             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, L<span class="stringliteral">"Replaces"</span> );
02478 
02479             <span class="keywordflow">if</span> (DevNodeInfoList[ nodeIndex ].Replaces != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02480 
02481                 status = ZwSetValueKey( instanceKey,
02482                                         &amp;valueName,
02483                                         0,
02484                                         REG_SZ,
02485                                         DevNodeInfoList[ nodeIndex ].Replaces,
02486                                         wcslen(DevNodeInfoList[ nodeIndex ].Replaces) * 2 + <span class="keyword">sizeof</span>(UNICODE_NULL) );
02487 
02488             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!isNewDevice) {
02489 
02490                 status = ZwDeleteValueKey( instanceKey,
02491                                            &amp;valueName );
02492             }
02493 
02494             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;controlKeyName, REGSTR_KEY_DEVICECONTROL );
02495 
02496             status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a8">IopCreateRegistryKeyEx</a>( &amp;controlKey,
02497                                              instanceKey,
02498                                              &amp;controlKeyName,
02499                                              KEY_ALL_ACCESS,
02500                                              REG_OPTION_VOLATILE,
02501                                              NULL
02502                                              );
02503 
02504             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))  {
02505 
02506                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, REGSTR_VAL_FIRMWAREMEMBER );
02507                 dwordValue = 1;
02508 
02509                 status = ZwSetValueKey( controlKey,
02510                                         &amp;valueName,
02511                                         0,
02512                                         REG_DWORD,
02513                                         &amp;dwordValue,
02514                                         <span class="keyword">sizeof</span>(dwordValue) );
02515 
02516                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, L<span class="stringliteral">"PnpBiosDeviceHandle"</span> );
02517                 dwordValue = DevNodeInfoList[ nodeIndex ].Handle;
02518 
02519                 status = ZwSetValueKey( controlKey,
02520                                         &amp;valueName,
02521                                         0,
02522                                         REG_DWORD,
02523                                         &amp;dwordValue,
02524                                         <span class="keyword">sizeof</span>(dwordValue) );
02525 
02526                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, REGSTR_VAL_FIRMWAREDISABLED );
02527                 dwordValue = DevNodeInfoList[ nodeIndex ].FirmwareDisabled;
02528 
02529                 status = ZwSetValueKey( controlKey,
02530                                         &amp;valueName,
02531                                         0,
02532                                         REG_DWORD,
02533                                         &amp;dwordValue,
02534                                         <span class="keyword">sizeof</span>(dwordValue) );
02535 
02536                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, L<span class="stringliteral">"PnpBiosDeviceHandle"</span> );
02537                 dwordValue = DevNodeInfoList[ nodeIndex ].Handle;
02538 
02539                 ZwClose( controlKey );
02540 
02541             } <span class="keywordflow">else</span> {
02542 
02543                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02544                             <span class="stringliteral">"Could not open registry key %S\\%S\\%S\\Control, status = %8.8X\n"</span>,
02545                             ENUMROOT_KEY_NAME,
02546                             DevNodeInfoList[ nodeIndex ].ProductId,
02547                             instanceNameStr,
02548                             status) );
02549 
02550                 ZwClose( instanceKey );
02551                 status = STATUS_UNSUCCESSFUL;
02552 
02553                 <span class="keywordflow">goto</span> Cleanup;
02554             }
02555 
02556             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;logConfKeyName, REGSTR_KEY_LOGCONF );
02557 
02558             status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a8">IopCreateRegistryKeyEx</a>( &amp;logConfKey,
02559                                            instanceKey,
02560                                            &amp;logConfKeyName,
02561                                            KEY_ALL_ACCESS,
02562                                            REG_OPTION_NON_VOLATILE,
02563                                            NULL
02564                                            );
02565 
02566             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status))  {
02567 
02568                 <span class="keywordflow">if</span> (DevNodeInfoList[ nodeIndex ].BootConfig != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02569 
02570                     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, REGSTR_VAL_BOOTCONFIG );
02571 
02572                     status = ZwSetValueKey( logConfKey,
02573                                             &amp;valueName,
02574                                             0,
02575                                             REG_RESOURCE_LIST,
02576                                             DevNodeInfoList[ nodeIndex ].BootConfig,
02577                                             DevNodeInfoList[ nodeIndex ].BootConfigLength );
02578 
02579                 }
02580 
02581                 <span class="keywordflow">if</span> (DevNodeInfoList[ nodeIndex ].BasicConfig != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02582 
02583                     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, REGSTR_VAL_BASICCONFIGVECTOR );
02584 
02585                     status = ZwSetValueKey( logConfKey,
02586                                             &amp;valueName,
02587                                             0,
02588                                             REG_RESOURCE_REQUIREMENTS_LIST,
02589                                             DevNodeInfoList[ nodeIndex ].BasicConfig,
02590                                             DevNodeInfoList[ nodeIndex ].BasicConfigLength );
02591 
02592                 }
02593 
02594                 ZwClose( logConfKey );
02595 
02596             } <span class="keywordflow">else</span> {
02597 
02598                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02599                             <span class="stringliteral">"Could not open registry key %S\\%S\\%S\\LogConf, status = %8.8X\n"</span>,
02600                             ENUMROOT_KEY_NAME,
02601                             DevNodeInfoList[ nodeIndex ].ProductId,
02602                             instanceNameStr,
02603                             status) );
02604 
02605                 ZwClose( instanceKey );
02606                 status = STATUS_UNSUCCESSFUL;
02607 
02608                 <span class="keywordflow">goto</span> Cleanup;
02609             }
02610 
02611             <span class="comment">//</span>
02612             <span class="comment">// If we are replacing a FW Mapper devnode we need to copy the</span>
02613             <span class="comment">// Device Parameters subkey.</span>
02614             <span class="comment">//</span>
02615             <span class="keywordflow">if</span> (isNewDevice &amp;&amp; DevNodeInfoList[ nodeIndex ].Replaces != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02616 
02617                 status = <a class="code" href="../../d2/d1/pnpmap_8c.html#a57">PnPBiosCopyDeviceParamKey</a>( enumRootKey,
02618                                                     DevNodeInfoList[ nodeIndex ].Replaces,
02619                                                     instanceNameStr );
02620             }
02621 
02622             ZwClose( instanceKey );
02623 
02624         } <span class="keywordflow">else</span> {
02625 
02626             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>( (MAPPER_ERROR,
02627                         <span class="stringliteral">"Could not open registry key %S\\%S\\%S, status = %8.8X\n"</span>,
02628                         ENUMROOT_KEY_NAME,
02629                         DevNodeInfoList[ nodeIndex ].ProductId,
02630                         instanceNameStr,
02631                         status) );
02632 
02633             ZwClose( instanceKey );
02634             status = STATUS_UNSUCCESSFUL;
02635 
02636             <span class="keywordflow">goto</span> Cleanup;
02637         }
02638 
02639         <span class="comment">//</span>
02640         <span class="comment">// Now check if the entry just written duplicates one written by the</span>
02641         <span class="comment">// Firmware Mapper.  If it does then remove the Firmware Mapper entry.</span>
02642         <span class="comment">//</span>
02643 
02644         <span class="keywordflow">if</span> (DevNodeInfoList[ nodeIndex ].Replaces != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02645 
02646             <a class="code" href="../../d9/d1/pnpsubs_8c.html#a41">IopDeleteKeyRecursive</a>( enumRootKey, DevNodeInfoList[ nodeIndex ].Replaces );
02647 
02648         }
02649     }
02650 
02651     status = STATUS_SUCCESS;
02652 
02653  Cleanup:
02654     ZwClose( enumRootKey );
02655 
02656     <span class="keywordflow">if</span> (excludeList) {
02657         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (excludeList);
02658     }
02659 
02660     <span class="keywordflow">return</span> status;
02661 }
<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="pnpmap.c::PnPCheckFixedIoOverrideDecodes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN PnPCheckFixedIoOverrideDecodes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00788">788</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00086">BIOSINFO_KEY_NAME</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00088">DECODEINFO_VALUE_NAME</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02546">IopGetRegistryValue()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01104">IopOpenRegistryKeyEx()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">PnPBiosTranslateInfo()</a>.
<p>
<pre class="fragment"><div>00791 {
00792     PKEY_VALUE_FULL_INFORMATION decodeFlagInfo=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00793     UNICODE_STRING biosKeyName;
00794     HANDLE  biosKey;
00795     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00796     BOOLEAN overrideDecodes = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00797 
00798     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;biosKeyName, BIOSINFO_KEY_NAME);
00799     status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a7">IopOpenRegistryKeyEx</a>( &amp;biosKey,
00800                                    NULL,
00801                                    &amp;biosKeyName,
00802                                    KEY_READ
00803                                    );
00804 
00805     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00806 
00807         <span class="comment">//</span>
00808         <span class="comment">// Don't really need to complain, likely not there.</span>
00809         <span class="comment">//</span>
00810         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00811     }
00812 
00813     status = <a class="code" href="../../d6/d5/ioep_8h.html#a52">IopGetRegistryValue</a>(biosKey, DECODEINFO_VALUE_NAME, &amp;decodeFlagInfo);
00814 
00815     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00816 
00817         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(decodeFlagInfo-&gt;Type == REG_DWORD);
00818         <span class="keywordflow">if</span> (decodeFlagInfo-&gt;DataLength == <span class="keyword">sizeof</span>(ULONG)) {
00819 
00820             overrideDecodes = (BOOLEAN) *((PULONG) decodeFlagInfo-&gt;Name);
00821         }
00822     }
00823 
00824     <span class="keywordflow">if</span> (decodeFlagInfo) {
00825 
00826         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(decodeFlagInfo);
00827     }
00828 
00829     ZwClose (biosKey);
00830 
00831     <span class="keywordflow">return</span> overrideDecodes;
00832 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="pnpmap.c::PnPGetDevnodeExcludeList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PnPGetDevnodeExcludeList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PKEY_VALUE_FULL_INFORMATION *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ExcludeList</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00759">759</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00086">BIOSINFO_KEY_NAME</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00087">BIOSINFO_VALUE_NAME</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02546">IopGetRegistryValue()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01104">IopOpenRegistryKeyEx()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.
<p>
<pre class="fragment"><div>00762 {
00763     UNICODE_STRING biosKeyName;
00764     HANDLE  biosKey;
00765     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00766 
00767     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;biosKeyName, BIOSINFO_KEY_NAME);
00768     status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a7">IopOpenRegistryKeyEx</a>( &amp;biosKey,
00769                                    NULL,
00770                                    &amp;biosKeyName,
00771                                    KEY_READ
00772                                    );
00773 
00774     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00775 
00776         <span class="comment">//</span>
00777         <span class="comment">// Don't really need to complain, likely not there.</span>
00778         <span class="comment">//</span>
00779         <span class="keywordflow">return</span>;
00780     }
00781 
00782     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d6/d5/ioep_8h.html#a52">IopGetRegistryValue</a> (biosKey,BIOSINFO_VALUE_NAME,ExcludeList);
00783 
00784     ZwClose (biosKey);
00785 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="pnpmap.c::PpFilterNtResource" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PpFilterNtResource           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>PnpDeviceName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PIO_RESOURCE_REQUIREMENTS_LIST&nbsp;</td>
          <td class="mdname" nowrap> <em>ResReqList</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l03065">3065</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
References <a class="el" href="../../d8/d2/i386init_8c-source.html#l00038">KeI386MachineType</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">PnPBiosTranslateInfo()</a>.
<p>
<pre class="fragment"><div>03069 {
03070     PIO_RESOURCE_LIST ioResourceList;
03071     PIO_RESOURCE_DESCRIPTOR ioResourceDescriptors;
03072 
03073     <span class="keywordflow">if</span> (ResReqList == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03074         <span class="keywordflow">return</span>;
03075     }
03076 
03077     <span class="keywordflow">if</span> (IsNEC_98) {
03078         <span class="keywordflow">return</span>;
03079     }
03080 
03081 <span class="preprocessor">#if 0 //_X86_</span>
03082 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/i386init_8c.html#a1">KeI386MachineType</a> == MACHINE_TYPE_EISA) {
03083 
03084         PCM_FULL_RESOURCE_DESCRIPTOR    fullDescriptor;
03085         PCM_PARTIAL_RESOURCE_DESCRIPTOR partialDescriptor;
03086         PUCHAR                          nextDescriptor;
03087         ULONG                           j;
03088         ULONG                           lastResourceIndex;
03089 
03090         fullDescriptor = &amp;ResourceList-&gt;List[0];
03091 
03092         <span class="keywordflow">for</span> (i = 0; i &lt; ResourceList-&gt;Count; i++) {
03093 
03094             partialResourceList = &amp;fullDescriptor-&gt;PartialResourceList;
03095 
03096             <span class="keywordflow">for</span> (j = 0; j &lt; partialResourceList-&gt;Count; j++) {
03097                 partialDescriptor = &amp;partialResourceList-&gt;PartialDescriptors[j];
03098 
03099                 <span class="keywordflow">if</span> (partialDescriptor-&gt;Type == CmResourceTypePort) {
03100                     <span class="keywordflow">if</span> (partialDescriptor-&gt;u.Port.Start.HighPart == 0 &amp;&amp;
03101                         (partialDescriptor-&gt;u.Port.Start.LowPart &amp; 0x00000300) == 0) {
03102                         partialDescriptor-&gt;Flags |= CM_RESOURCE_PORT_16_BIT_DECODE;
03103                     }
03104                 }
03105             }
03106 
03107             nextDescriptor = (PUCHAR)fullDescriptor + <span class="keyword">sizeof</span>(CM_FULL_RESOURCE_DESCRIPTOR);
03108 
03109             <span class="comment">//</span>
03110             <span class="comment">// account for any resource descriptors in addition to the single</span>
03111             <span class="comment">// imbedded one I've already accounted for (if there aren't any,</span>
03112             <span class="comment">// then I'll end up subtracting off the extra imbedded descriptor</span>
03113             <span class="comment">// from the previous step)</span>
03114             <span class="comment">//</span>
03115             <span class="comment">//</span>
03116             <span class="comment">// finally, account for any extra device specific data at the end of</span>
03117             <span class="comment">// the last partial resource descriptor (if any)</span>
03118             <span class="comment">//</span>
03119             <span class="keywordflow">if</span> (partialResourceList-&gt;Count &gt; 0) {
03120 
03121                 nextDescriptor += (partialResourceList-&gt;Count - 1) *
03122                      <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_DESCRIPTOR);
03123 
03124                 lastResourceIndex = partialResourceList-&gt;Count - 1;
03125 
03126                 <span class="keywordflow">if</span> (partialResourceList-&gt;PartialDescriptors[lastResourceIndex].Type ==
03127                           CmResourceTypeDeviceSpecific) {
03128 
03129                     nextDescriptor += partialResourceList-&gt;PartialDescriptors[lastResourceIndex].
03130                                u.DeviceSpecificData.DataSize;
03131                 }
03132             }
03133 
03134             fullDescriptor = (PCM_FULL_RESOURCE_DESCRIPTOR)nextDescriptor;
03135         }
03136     }
03137 <span class="preprocessor">#endif</span>
03138 <span class="preprocessor"></span>
03139     <span class="keywordflow">if</span> (RtlCompareMemory(PnpDeviceName,
03140                          L<span class="stringliteral">"*PNP06"</span>,
03141                          <span class="keyword">sizeof</span>(L<span class="stringliteral">"*PNP06"</span>) - <span class="keyword">sizeof</span>(WCHAR)) ==
03142                          <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP06"</span>) - <span class="keyword">sizeof</span>(WCHAR)) {
03143 
03144         ULONG i, j;
03145 
03146         ioResourceList = ResReqList-&gt;List;
03147 
03148         <span class="keywordflow">for</span> (j = 0; j &lt; ResReqList-&gt;AlternativeLists; j++) {
03149 
03150             ioResourceDescriptors = ioResourceList-&gt;Descriptors;
03151 
03152             <span class="keywordflow">for</span> (i = 0; i &lt; ioResourceList-&gt;Count; i++) {
03153 
03154                 <span class="keywordflow">if</span> (ioResourceDescriptors[i].Type == CmResourceTypePort) {
03155 
03156                     <span class="comment">//</span>
03157                     <span class="comment">// some bios asks for 1 too many io port for ide channel</span>
03158                     <span class="comment">//</span>
03159                     <span class="keywordflow">if</span> ((ioResourceDescriptors[i].u.Port.Length == 2) &amp;&amp;
03160                             (ioResourceDescriptors[i].u.Port.MaximumAddress.QuadPart ==
03161                             (ioResourceDescriptors[i].u.Port.MinimumAddress.QuadPart + 1))) {
03162 
03163                             ioResourceDescriptors[i].u.Port.Length = 1;
03164                         ioResourceDescriptors[i].u.Port.MaximumAddress =
03165                             ioResourceDescriptors[i].u.Port.MinimumAddress;
03166                     }
03167                 }
03168             }
03169 
03170             ioResourceList = (PIO_RESOURCE_LIST) (ioResourceDescriptors + ioResourceList-&gt;Count);
03171         }
03172     }
03173 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a30" doxytag="pnpmap.c::Class10Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a30">Class10Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Generic dock"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other dock"</span> },
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00211">211</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="pnpmap.c::Class11Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a31">Class11Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"386"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"486"</span> },
    { 0x0200, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Pentium"</span> },
    { 0x1000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Alpha"</span> },
    { 0x4000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Co-processor"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00216">216</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="pnpmap.c::Class12Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a32">Class12Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Firewire"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Access bus"</span> },
    { 0x0200, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"SSA"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other serial bus"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00224">224</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="pnpmap.c::Class1Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a21">Class1Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"SCSI Controller"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"IDE Controller"</span> },
    { 0x0200, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Floppy Controller"</span> },
    { 0x0300, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"IPI Controller"</span> },
    { 0x0400, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"RAID Controller"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other Mass Storage"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00131">131</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="pnpmap.c::Class2Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a22">Class2Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Ethernet"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Token ring"</span> },
    { 0x0200, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"FDDI"</span> },
    { 0x0300, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ATM"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other network"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00140">140</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="pnpmap.c::Class3Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a23">Class3Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"VGA"</span> },
    { 0x0001, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"SVGA"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"XGA"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other display"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00148">148</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="pnpmap.c::Class4Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a24">Class4Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Video device"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Audio device"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other multimedia"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00155">155</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="pnpmap.c::Class5Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a25">Class5Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"RAM memory"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Flash memory"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other memory"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00161">161</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="pnpmap.c::Class6Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a26">Class6Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"HOST / PCI"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCI / ISA"</span> },
    { 0x0200, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCI / EISA"</span> },
    { 0x0300, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCI / MCA"</span> },
    { 0x0400, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCI / PCI"</span> },
    { 0x0500, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCI / PCMCIA"</span> },
    { 0x0600, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"NuBus"</span> },
    { 0x0700, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Cardbus"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other bridge"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00167">167</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="pnpmap.c::Class7Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a27">Class7Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"XT Serial"</span> },
    { 0x0001, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"16450"</span> },
    { 0x0002, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"16550"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Parallel output only"</span> },
    { 0x0101, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"BiDi Parallel"</span> },
    { 0x0102, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ECP 1.x parallel"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other comm"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00179">179</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="pnpmap.c::Class8Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a28">Class8Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Generic 8259"</span> },
    { 0x0001, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ISA PIC"</span> },
    { 0x0002, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"EISA PIC"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Generic 8237"</span> },
    { 0x0101, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ISA DMA"</span> },
    { 0x0102, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"EISA DMA"</span> },
    { 0x0200, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Generic 8254"</span> },
    { 0x0201, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ISA timer"</span> },
    { 0x0202, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"EISA timer"</span> },
    { 0x0300, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Generic RTC"</span> },
    { 0x0301, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ISA RTC"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other system device"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00189">189</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="pnpmap.c::Class9Descriptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d0/struct__CLASSDATA.html">CLASSDATA</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a29">Class9Descriptions</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    { 0x0000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Keyboard"</span> },
    { 0x0100, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Digitizer"</span> },
    { 0x0200, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Mouse"</span> },
    { 0x8000, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Other input"</span> }
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00204">204</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="pnpmap.c::ClassDescriptionsList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="../../d8/d9/struct__CLASS__DESCRIPTIONS__LIST.html">_CLASS_DESCRIPTIONS_LIST</a>    <a class="el" href="../../d2/d1/pnpmap_8c.html#a33">ClassDescriptionsList</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02053">PnPBiosGetDescription()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="pnpmap.c::ExcludedDevices" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">EXCLUDED_PNPNODE</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a18">ExcludedDevices</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div>  {
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*PNP03"</span>),     
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*PNP0A"</span>),     
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*PNP0E"</span>),     
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*PNP0F"</span>),     
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*nEC13"</span>),     
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*nEC1E"</span>),     
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*nEC1F"</span>),     
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*IBM3780"</span>),   
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*IBM3781"</span>)    
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00105">105</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="pnpmap.c::ExcludeIfDisabled" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d8/struct__EXCLUDED__PNPNODE.html">EXCLUDED_PNPNODE</a> <a class="el" href="../../d2/d1/pnpmap_8c.html#a19">ExcludeIfDisabled</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*PNP0C01"</span>),   
    <a class="code" href="../../d2/d1/pnpmap_8c.html#a10">EXCLUSION_ENTRY</a>(L<span class="stringliteral">"*PNP0C02"</span>)    
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00119">119</a> of file <a class="el" href="../../d3/d0/pnpmap_8c-source.html">pnpmap.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:14 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
