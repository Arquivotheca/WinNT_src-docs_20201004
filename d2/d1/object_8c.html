<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: object.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>object.c File Reference</h1><code>#include "<a class="el" href="../../d4/d3/mscms_8h-source.html">mscms.h</a>"</code><br>

<p>
<a href="../../d3/d0/object_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a0">NUM_REQ_FNS</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a1">NUM_OPT_FNS</a>&nbsp;&nbsp;&nbsp;6</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a2">NUM_PS_FNS</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a3">AllocateHeapObject</a> (OBJECTTYPE objType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a4">FreeHeapObject</a> (HANDLE hObject)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a5">ValidHandle</a> (HANDLE hObject, OBJECTTYPE objType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a6">ValidProfile</a> (PPROFOBJ pProfObj)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a7">MemAlloc</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a8">MemReAlloc</a> (PVOID pMemory, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwNewSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a9">MemFree</a> (PVOID pMemory)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a10">MyCopyMemory</a> (<a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pDest, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pSrc, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a11">ConvertToUnicode</a> (PCSTR pszAnsiStr, PWSTR *ppwszUnicodeStr, BOOL bAllocate)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a12">ConvertToAnsi</a> (PCWSTR pwszUnicodeStr, PSTR *ppszAnsiStr, BOOL bAllocate)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a13">ValidColorMatchingModule</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cmmID, PTSTR pCMMDll)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PCMMOBJ&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cmmID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PCMMOBJ&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a15">GetPreferredCMM</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a> (PCMMOBJ pCMMObj)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="object.c::NUM_OPT_FNS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NUM_OPT_FNS&nbsp;&nbsp;&nbsp;6          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00025">25</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="object.c::NUM_PS_FNS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NUM_PS_FNS&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00026">26</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="object.c::NUM_REQ_FNS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NUM_REQ_FNS&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00024">24</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, and <a class="el" href="../../d3/d0/object_8c-source.html#l00477">ValidColorMatchingModule()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3" doxytag="object.c::AllocateHeapObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE AllocateHeapObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OBJECTTYPE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>objType</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00046">46</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00205">MemAlloc()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00149">RIP</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/color_8c-source.html#l00194">CreateMultiProfileTransform()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02694">InternalOpenColorProfile()</a>.
<p>
<pre class="fragment"><div>00049 {
00050     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    dwSize;
00051     POBJHEAD pObject;
00052 
00053     <span class="keywordflow">switch</span> (objType)
00054     {
00055     <span class="keywordflow">case</span> OBJ_PROFILE:
00056         dwSize = <span class="keyword">sizeof</span>(PROFOBJ);
00057         <span class="keywordflow">break</span>;
00058 
00059     <span class="keywordflow">case</span> OBJ_TRANSFORM:
00060         dwSize = <span class="keyword">sizeof</span>(TRANSFORMOBJ);
00061         <span class="keywordflow">break</span>;
00062 
00063     <span class="keywordflow">case</span> OBJ_CMM:
00064         dwSize = <span class="keyword">sizeof</span>(CMMOBJ);
00065         <span class="keywordflow">break</span>;
00066 
00067     <span class="keywordflow">default</span>:
00068         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a9">RIP</a>((__TEXT(<span class="stringliteral">"Allocating invalid object\n"</span>)));
00069         dwSize = 0;
00070         <span class="keywordflow">break</span>;
00071     }
00072 
00073     pObject = (POBJHEAD)<a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(dwSize);
00074 
00075     <span class="keywordflow">if</span> (!pObject)
00076     {
00077         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00078     }
00079 
00080     pObject-&gt;objType = objType;
00081 
00082     <span class="keywordflow">return</span>(PTRTOHDL(pObject));
00083 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="object.c::ConvertToAnsi" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ConvertToAnsi           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwszUnicodeStr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PSTR *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppszAnsiStr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bAllocate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00419">419</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00205">MemAlloc()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00260">MemFree()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d0/d7/profman_8c-source.html#l00962">AssociateColorProfileWithDeviceW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01182">DisassociateColorProfileFromDeviceW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01499">EnumColorProfilesW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l00359">GetColorDirectoryW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01996">GetStandardColorSpaceProfileW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l00565">InstallColorProfileW()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00919">RegisterCMMW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01785">SetStandardColorSpaceProfileW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l00754">UninstallColorProfileW()</a>, and <a class="el" href="../../d1/d3/color_8c-source.html#l01065">UnregisterCMMW()</a>.
<p>
<pre class="fragment"><div>00424 {
00425     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLen;                    <span class="comment">// length of Ansi string</span>
00426     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  bUsedDefaultChar;         <span class="comment">// if default characters were used in</span>
00427                                     <span class="comment">// converting Unicode to Ansi</span>
00428 
00429     dwLen = (lstrlenW(pwszUnicodeStr) + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>);
00430 
00431     <span class="comment">//</span>
00432     <span class="comment">// Allocate memory for Ansi string</span>
00433     <span class="comment">//</span>
00434 
00435     <span class="keywordflow">if</span> (bAllocate)
00436     {
00437         *ppszAnsiStr = (PSTR)<a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(dwLen);
00438         <span class="keywordflow">if</span> (! (*ppszAnsiStr))
00439         {
00440             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Error allocating memory for ANSI name\n"</span>)));
00441             SetLastError(ERROR_NOT_ENOUGH_MEMORY);
00442             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00443         }
00444     }
00445 
00446     <span class="comment">//</span>
00447     <span class="comment">// Convert Unicode string to Ansi</span>
00448     <span class="comment">//</span>
00449 
00450     <span class="keywordflow">if</span> (! WideCharToMultiByte(CP_ACP, 0, pwszUnicodeStr, -1, *ppszAnsiStr,
00451             dwLen, NULL, &amp;bUsedDefaultChar) || bUsedDefaultChar)
00452     {
00453         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Error converting to Ansi name\n"</span>)));
00454         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(*ppszAnsiStr);
00455         *ppszAnsiStr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00456         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00457     }
00458 
00459     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00460 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="object.c::ConvertToUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ConvertToUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszAnsiStr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PWSTR *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppwszUnicodeStr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bAllocate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00357">357</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00205">MemAlloc()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00260">MemFree()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d0/d7/profman_8c-source.html#l01499">EnumColorProfilesW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l00359">GetColorDirectoryW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l05853">GetScannerData()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01996">GetStandardColorSpaceProfileW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l05717">OpenScanner()</a>, and <a class="el" href="../../d0/d7/profman_8c-source.html#l05917">SetScannerData()</a>.
<p>
<pre class="fragment"><div>00362 {
00363     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLen;                    <span class="comment">// length of Unicode string</span>
00364 
00365     dwLen = (lstrlenA(pszAnsiStr) + 1) * <span class="keyword">sizeof</span>(WCHAR);
00366 
00367     <span class="comment">//</span>
00368     <span class="comment">// Allocate memory for Unicode string</span>
00369     <span class="comment">//</span>
00370 
00371     <span class="keywordflow">if</span> (bAllocate)
00372     {
00373         *ppwszUnicodeStr =  (PWSTR)<a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(dwLen);
00374         <span class="keywordflow">if</span> (! (*ppwszUnicodeStr))
00375         {
00376             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Error allocating memory for Unicode name\n"</span>)));
00377             SetLastError(ERROR_NOT_ENOUGH_MEMORY);
00378             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00379         }
00380     }
00381 
00382     <span class="comment">//</span>
00383     <span class="comment">// Convert Ansi string to Unicode</span>
00384     <span class="comment">//</span>
00385 
00386     <span class="keywordflow">if</span> (! MultiByteToWideChar(CP_ACP, 0, pszAnsiStr, -1,
00387             *ppwszUnicodeStr, dwLen))
00388     {
00389         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Error converting to Unicode name\n"</span>)));
00390         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(*ppwszUnicodeStr);
00391         *ppwszUnicodeStr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00392         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00393     }
00394 
00395     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00396 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="object.c::FreeHeapObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeHeapObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hObject</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00102">102</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00260">MemFree()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/color_8c-source.html#l00194">CreateMultiProfileTransform()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00363">DeleteColorTransform()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03053">FreeProfileObject()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, and <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>.
<p>
<pre class="fragment"><div>00105 {
00106     POBJHEAD pObject;
00107 
00108     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(hObject != NULL);
00109 
00110     pObject = (POBJHEAD)HDLTOPTR(hObject);
00111 
00112     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pObject-&gt;dwUseCount == 0);
00113 
00114     pObject-&gt;objType = 0;       <span class="comment">// in case the handle gets reused</span>
00115 
00116     <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>((PVOID)pObject);
00117 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="object.c::GetColorMatchingModule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PCMMOBJ GetColorMatchingModule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>cmmID</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00564">564</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d3/d0/object_8c-source.html#l00046">AllocateHeapObject()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d9/d5/mscmm_2icm32_8c-source.html#l00029">CMM_IDENT</a>, <a class="el" href="../../d9/d5/mscmm_2icm32_8c-source.html#l00032">CMM_VERSION</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00114">critsec</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00143">ERR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00102">FreeHeapObject()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00092">GetCurrentProcessId</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00036">gpCMMChain</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00057">gszCMMOptFns</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00039">gszCMMReqFns</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00108">gszDefaultCMM</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00083">gszICMatcher</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00070">gszPSFns</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00025">NUM_OPT_FNS</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00026">NUM_PS_FNS</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00024">NUM_REQ_FNS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02283">ConvertColorNameToIndex()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02409">ConvertIndexToColorName()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02540">CreateDeviceLinkProfile()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00194">CreateMultiProfileTransform()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02166">GetNamedProfileInfo()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02027">GetPS2ColorRenderingDictionary()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01887">GetPS2ColorRenderingIntent()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01744">GetPS2ColorSpaceArray()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02992">InternalCreateProfileFromLCS()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00375">IsColorProfileValid()</a>, and <a class="el" href="../../d1/d3/color_8c-source.html#l01122">SelectCMM()</a>.
<p>
<pre class="fragment"><div>00567 {
00568     HANDLE    hCMMObj;
00569     PCMMOBJ   pCMMObj = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00570     FARPROC   *ppTemp;
00571     HINSTANCE hInstance = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00572     HKEY      hkCMM = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00573     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     dwTaskID;
00574     TCHAR     szCMMID[5];
00575     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     dwType, bufSize, i;
00576     TCHAR     szBuffer[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00577     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>      rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;       <span class="comment">// Assume failure</span>
00578 
00579     <span class="comment">//</span>
00580     <span class="comment">// Check if we have already loaded this CMM</span>
00581     <span class="comment">//</span>
00582 
00583     dwTaskID = <a class="code" href="../../d4/d1/userk_8h.html#a19">GetCurrentProcessId</a>();
00584 
00585     EnterCriticalSection(&amp;critsec);     <span class="comment">// Critical section</span>
00586     pCMMObj = <a class="code" href="../../d1/d6/ntgdi_2icm_2mscms_2globals_8c.html#a0">gpCMMChain</a>;
00587 
00588     <span class="keywordflow">while</span> (pCMMObj)
00589     {
00590         <span class="keywordflow">if</span> ((pCMMObj-&gt;dwCMMID == cmmID) &amp;&amp; (pCMMObj-&gt;dwTaskID == dwTaskID))
00591         {
00592             pCMMObj-&gt;objHdr.dwUseCount++;
00593             <span class="keywordflow">break</span>;
00594         }
00595         pCMMObj = pCMMObj-&gt;pNext;
00596     }
00597     LeaveCriticalSection(&amp;critsec);     <span class="comment">// Critical section</span>
00598 
00599     <span class="keywordflow">if</span> (pCMMObj)
00600         <span class="keywordflow">return</span> pCMMObj;
00601 
00602     <span class="comment">//</span>
00603     <span class="comment">// CMM not already loaded - check to see if it is default CMM before</span>
00604     <span class="comment">// looking in the registry</span>
00605     <span class="comment">//</span>
00606 
00607     <span class="keywordflow">if</span> (cmmID == CMM_WINDOWS_DEFAULT)
00608     {
00609         hInstance = LoadLibrary(gszDefaultCMM);
00610         <span class="keywordflow">goto</span> AttemptedLoadingCMM;
00611     }
00612 
00613     <span class="comment">//</span>
00614     <span class="comment">// Not default CMM, look in the registry</span>
00615     <span class="comment">//</span>
00616 
00617     <span class="keywordflow">if</span> (RegOpenKey(HKEY_LOCAL_MACHINE, gszICMatcher, &amp;hkCMM) != ERROR_SUCCESS)
00618     {
00619         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00620     }
00621 
00622     <span class="comment">//</span>
00623     <span class="comment">// Make a string with the CMM ID</span>
00624     <span class="comment">//</span>
00625 
00626 <span class="preprocessor">#ifdef UNICODE</span>
00627 <span class="preprocessor"></span>    {
00628         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> temp = FIX_ENDIAN(cmmID);
00629 
00630         <span class="keywordflow">if</span> (!MultiByteToWideChar(CP_ACP, 0, (PSTR)&amp;temp, 4, szCMMID, 5))
00631         {
00632             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not convert cmmID %x to Unicode\n"</span>), temp));
00633             <span class="keywordflow">goto</span> EndGetColorMatchingModule;
00634         }
00635     }
00636 <span class="preprocessor">#else</span>
00637 <span class="preprocessor"></span>    <span class="keywordflow">for</span> (i=0; i&lt;4; i++)
00638     {
00639         szCMMID[i] = ((PSTR)&amp;cmmID)[3-i];
00640     }
00641 <span class="preprocessor">#endif</span>
00642 <span class="preprocessor"></span>    szCMMID[4] = <span class="charliteral">'\0'</span>;
00643 
00644     <span class="comment">//</span>
00645     <span class="comment">// Get the file name of the CMM dll if registered</span>
00646     <span class="comment">//</span>
00647 
00648     bufSize = <a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>;
00649     <span class="keywordflow">if</span> (RegQueryValueEx(hkCMM, (PTSTR)szCMMID, 0, &amp;dwType, (BYTE *)szBuffer, &amp;bufSize) !=
00650         ERROR_SUCCESS)
00651     {
00652         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"CMM %s not registered\n"</span>), szCMMID));
00653         <span class="keywordflow">goto</span> EndGetColorMatchingModule;
00654     }
00655 
00656     <span class="comment">//</span>
00657     <span class="comment">// Load the CMM</span>
00658     <span class="comment">//</span>
00659 
00660     hInstance = LoadLibrary(szBuffer);
00661 
00662 AttemptedLoadingCMM:
00663 
00664     <span class="keywordflow">if</span> (!hInstance)
00665     {
00666         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not load CMM %x\n"</span>), cmmID));
00667         <span class="keywordflow">goto</span> EndGetColorMatchingModule;
00668     }
00669 
00670     <span class="comment">//</span>
00671     <span class="comment">// Allocate a CMM object</span>
00672     <span class="comment">//</span>
00673 
00674     hCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a3">AllocateHeapObject</a>(OBJ_CMM);
00675     <span class="keywordflow">if</span> (!hCMMObj)
00676     {
00677         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a5">ERR</a>((__TEXT(<span class="stringliteral">"Could not allocate CMM object\n"</span>)));
00678         <span class="keywordflow">goto</span> EndGetColorMatchingModule;
00679     }
00680 
00681     pCMMObj = (PCMMOBJ)HDLTOPTR(hCMMObj);
00682 
00683     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pCMMObj != NULL);
00684 
00685     <span class="comment">//</span>
00686     <span class="comment">// Fill in the CMM object</span>
00687     <span class="comment">//</span>
00688 
00689     pCMMObj-&gt;objHdr.dwUseCount = 1;
00690     pCMMObj-&gt;dwCMMID = cmmID;
00691     pCMMObj-&gt;dwTaskID = dwTaskID;
00692     pCMMObj-&gt;hCMM = hInstance;
00693 
00694     ppTemp = (FARPROC *)&amp;pCMMObj-&gt;fns.pCMGetInfo;
00695     *ppTemp = GetProcAddress(hInstance, gszCMMReqFns[0]);
00696     ppTemp++;
00697 
00698     <span class="keywordflow">if</span> (!pCMMObj-&gt;fns.pCMGetInfo)
00699     {
00700         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a5">ERR</a>((__TEXT(<span class="stringliteral">"CMM does not export CMGetInfo\n"</span>)));
00701         <span class="keywordflow">goto</span> EndGetColorMatchingModule;
00702     }
00703 
00704     <span class="comment">//</span>
00705     <span class="comment">// Check if the CMM is the right version and reports the same ID</span>
00706     <span class="comment">//</span>
00707 
00708     <span class="keywordflow">if</span> (pCMMObj-&gt;fns.pCMGetInfo(CMM_VERSION) &lt; 0x00050000 ||
00709         pCMMObj-&gt;fns.pCMGetInfo(CMM_IDENT) != cmmID)
00710     {
00711         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a5">ERR</a>((__TEXT(<span class="stringliteral">"CMM not correct version or reports incorrect ID\n"</span>)));
00712         <span class="keywordflow">goto</span> EndGetColorMatchingModule;
00713     }
00714 
00715     <span class="comment">//</span>
00716     <span class="comment">// Load the remaining required functions</span>
00717     <span class="comment">//</span>
00718 
00719     <span class="keywordflow">for</span> (i=1; i&lt;<a class="code" href="../../d2/d1/object_8c.html#a0">NUM_REQ_FNS</a>; i++)
00720     {
00721         *ppTemp = GetProcAddress(hInstance, gszCMMReqFns[i]);
00722         <span class="keywordflow">if</span> (!*ppTemp)
00723         {
00724             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a5">ERR</a>((__TEXT(<span class="stringliteral">"CMM %s does not export %s\n"</span>), szCMMID, gszCMMReqFns[i]));
00725             <span class="keywordflow">goto</span> EndGetColorMatchingModule;
00726         }
00727         ppTemp++;
00728     }
00729 
00730     <span class="comment">//</span>
00731     <span class="comment">// Load the optional functions</span>
00732     <span class="comment">//</span>
00733 
00734     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d2/d1/object_8c.html#a1">NUM_OPT_FNS</a>; i++)
00735     {
00736         *ppTemp = GetProcAddress(hInstance, gszCMMOptFns[i]);
00737 
00738         <span class="comment">//</span>
00739         <span class="comment">// Even these functions are required for Windows default CMM</span>
00740         <span class="comment">//</span>
00741 
00742         <span class="keywordflow">if</span> (cmmID == CMM_WINDOWS_DEFAULT &amp;&amp; !*ppTemp)
00743         {
00744             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a5">ERR</a>((__TEXT(<span class="stringliteral">"Windows default CMM does not export %s\n"</span>), gszCMMOptFns[i]));
00745             <span class="keywordflow">goto</span> EndGetColorMatchingModule;
00746         }
00747         ppTemp++;
00748     }
00749 
00750     <span class="comment">//</span>
00751     <span class="comment">// Load the PS functions - these are optional even for the default CMM</span>
00752     <span class="comment">//</span>
00753 
00754     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d2/d1/object_8c.html#a2">NUM_PS_FNS</a>; i++)
00755     {
00756         *ppTemp = GetProcAddress(hInstance, gszPSFns[i]);
00757         ppTemp++;
00758     }
00759 
00760     <span class="comment">//</span>
00761     <span class="comment">// If any of the PS Level2 fns is not exported, do not use this CMM</span>
00762     <span class="comment">// for any of the PS Level 2 functionality</span>
00763     <span class="comment">//</span>
00764 
00765     <span class="keywordflow">if</span> (!pCMMObj-&gt;fns.pCMGetPS2ColorSpaceArray ||
00766         !pCMMObj-&gt;fns.pCMGetPS2ColorRenderingIntent ||
00767         !pCMMObj-&gt;fns.pCMGetPS2ColorRenderingDictionary)
00768     {
00769         pCMMObj-&gt;fns.pCMGetPS2ColorSpaceArray = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00770         pCMMObj-&gt;fns.pCMGetPS2ColorRenderingIntent = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00771         pCMMObj-&gt;fns.pCMGetPS2ColorRenderingDictionary = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00772         pCMMObj-&gt;dwFlags |= CMM_DONT_USE_PS2_FNS;
00773     }
00774 
00775     <span class="comment">//</span>
00776     <span class="comment">// Add the CMM object to the chain at the beginning</span>
00777     <span class="comment">//</span>
00778 
00779     EnterCriticalSection(&amp;critsec);     <span class="comment">// Critical section</span>
00780     pCMMObj-&gt;pNext = <a class="code" href="../../d1/d6/ntgdi_2icm_2mscms_2globals_8c.html#a0">gpCMMChain</a>;
00781     <a class="code" href="../../d1/d6/ntgdi_2icm_2mscms_2globals_8c.html#a0">gpCMMChain</a> = pCMMObj;
00782     LeaveCriticalSection(&amp;critsec);     <span class="comment">// Critical section</span>
00783 
00784     rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;                          <span class="comment">// Success!</span>
00785 
00786 EndGetColorMatchingModule:
00787 
00788     <span class="keywordflow">if</span> (!rc)
00789     {
00790         <span class="keywordflow">if</span> (pCMMObj)
00791         {
00792             pCMMObj-&gt;objHdr.dwUseCount--;   <span class="comment">// decrement before freeing</span>
00793             <a class="code" href="../../d2/d1/object_8c.html#a4">FreeHeapObject</a>(hCMMObj);
00794             pCMMObj = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00795         }
00796         <span class="keywordflow">if</span> (hInstance)
00797         {
00798             FreeLibrary(hInstance);
00799         }
00800     }
00801 
00802     <span class="keywordflow">if</span> (hkCMM)
00803     {
00804         RegCloseKey(hkCMM);
00805     }
00806 
00807     <span class="keywordflow">return</span> pCMMObj;
00808 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="object.c::GetPreferredCMM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PCMMOBJ GetPreferredCMM           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00826">826</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00114">critsec</a>, and <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00037">gpPreferredCMM</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02283">ConvertColorNameToIndex()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02409">ConvertIndexToColorName()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00194">CreateMultiProfileTransform()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02166">GetNamedProfileInfo()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02027">GetPS2ColorRenderingDictionary()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01887">GetPS2ColorRenderingIntent()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01744">GetPS2ColorSpaceArray()</a>, and <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>.
<p>
<pre class="fragment"><div>00828 {
00829     PCMMOBJ pCMMObj;
00830 
00831     EnterCriticalSection(&amp;critsec);     <span class="comment">// Critical section</span>
00832     pCMMObj = <a class="code" href="../../d1/d6/ntgdi_2icm_2mscms_2globals_8c.html#a1">gpPreferredCMM</a>;
00833 
00834     <span class="keywordflow">if</span> (pCMMObj)
00835     {
00836         <span class="comment">//</span>
00837         <span class="comment">// Increment use count</span>
00838         <span class="comment">//</span>
00839 
00840         pCMMObj-&gt;objHdr.dwUseCount++;
00841     }
00842     LeaveCriticalSection(&amp;critsec);     <span class="comment">// Critical section</span>
00843 
00844     <span class="keywordflow">return</span> pCMMObj;
00845 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="object.c::MemAlloc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID MemAlloc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dwSize</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00205">205</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/object_8c-source.html#l00046">AllocateHeapObject()</a>, <a class="el" href="../../d3/d8/ps2_8c-source.html#l04234">Ascii85Encode()</a>, <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00232">ColorSpaceControl()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00419">ConvertToAnsi()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00357">ConvertToUnicode()</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00763">CreateColorantArray()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l01372">CreateColSpArray()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l01287">CreateColSpProc()</a>, <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00091">CreateCRDControl()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l01341">CreateFloatString()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l00587">CreateHostLutCRD()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l00358">CreateHostRevTRCInputTable()</a>, <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00025">CreateINTENTControl()</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00186">CreateLutCRD()</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00877">CreateMatrixCRD()</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00487">CreateMonoCRD()</a>, <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00158">CreateProfCRDControl()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01499">EnumColorProfilesW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l00359">GetColorDirectoryW()</a>, <a class="el" href="../../d9/d7/aug98_2dll32_2csprof_8c-source.html#l00890">GetCPMediaWhitePoint()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l01331">GetCRDInputOutputArraySize()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l00138">GetHostCSA()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l00261">GetPS2CSA_DEFG()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l01087">GetPS2CSA_MONO_A()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l00927">GetPS2CSA_MONO_ABC()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l01954">GetPS2PreviewColorRenderingDictionary()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01996">GetStandardColorSpaceProfileW()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l00284">GetTRCData()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l04289">IGetDeviceData()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l02838">InternalAssociateColorProfileWithDevice()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>, <a class="el" href="../../d3/d8/ps2_8c-source.html#l00847">InternalGetPS2PreviewCRD()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02694">InternalOpenColorProfile()</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00799">IsSRGB()</a>, <a class="el" href="../../d9/d7/aug98_2dll32_2csprof_8c-source.html#l00080">LoadCP()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00168">OpenColorProfileW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l05717">OpenScanner()</a>, and <a class="el" href="../../d0/d6/ia64_2vunwind_8c-source.html#l00863">RtlVirtualUnwind()</a>.
<p>
<pre class="fragment"><div>00208 {
00209     <span class="keywordflow">if</span> (dwSize &gt; 0)
00210         <span class="keywordflow">return</span> (PVOID)GlobalAllocPtr(GHND | GMEM_ZEROINIT, dwSize);
00211     <span class="keywordflow">else</span>
00212         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00213 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="object.c::MemFree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MemFree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMemory</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00260">260</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
Referenced by <a class="el" href="../../d3/d8/ps2_8c-source.html#l04234">Ascii85Encode()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l00962">AssociateColorProfileWithDeviceW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l05801">CloseScanner()</a>, <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00232">ColorSpaceControl()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00419">ConvertToAnsi()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00357">ConvertToUnicode()</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00763">CreateColorantArray()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l01372">CreateColSpArray()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l01287">CreateColSpProc()</a>, <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00091">CreateCRDControl()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l01341">CreateFloatString()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l00587">CreateHostLutCRD()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l00358">CreateHostRevTRCInputTable()</a>, <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00025">CreateINTENTControl()</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00186">CreateLutCRD()</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00877">CreateMatrixCRD()</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00487">CreateMonoCRD()</a>, <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00158">CreateProfCRDControl()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01182">DisassociateColorProfileFromDeviceW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01499">EnumColorProfilesW()</a>, <a class="el" href="../../d9/d7/aug98_2dll32_2csprof_8c-source.html#l00212">FreeCP()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00102">FreeHeapObject()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03053">FreeProfileObject()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l00359">GetColorDirectoryW()</a>, <a class="el" href="../../d9/d7/aug98_2dll32_2csprof_8c-source.html#l00890">GetCPMediaWhitePoint()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l01331">GetCRDInputOutputArraySize()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l00138">GetHostCSA()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l00384">GetHostMatrixCSAorCRD()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l00261">GetPS2CSA_DEFG()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l01087">GetPS2CSA_MONO_A()</a>, <a class="el" href="../../d8/d2/aug98_2dll32_2getcsa_8c-source.html#l00927">GetPS2CSA_MONO_ABC()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l01954">GetPS2PreviewColorRenderingDictionary()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l05853">GetScannerData()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01996">GetStandardColorSpaceProfileW()</a>, <a class="el" href="../../d9/d4/aug98_2dll32_2profcrd_8c-source.html#l00284">GetTRCData()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l00565">InstallColorProfileW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l02838">InternalAssociateColorProfileWithDevice()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l03118">InternalDisassociateColorProfileFromDevice()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l03356">InternalEnumColorProfiles()</a>, <a class="el" href="../../d3/d8/ps2_8c-source.html#l00847">InternalGetPS2PreviewCRD()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02694">InternalOpenColorProfile()</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00799">IsSRGB()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00168">OpenColorProfileW()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00919">RegisterCMMW()</a>, <a class="el" href="../../d0/d6/ia64_2vunwind_8c-source.html#l00863">RtlVirtualUnwind()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l05917">SetScannerData()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l01785">SetStandardColorSpaceProfileW()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l02142">SpoolerCopyFileEvent()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l00754">UninstallColorProfileW()</a>, and <a class="el" href="../../d1/d3/color_8c-source.html#l01065">UnregisterCMMW()</a>.
<p>
<pre class="fragment"><div>00263 {
00264     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwErr;
00265 
00266     <span class="comment">//</span>
00267     <span class="comment">// GlobalFree() resets last error, we get and set around it so we don't</span>
00268     <span class="comment">// lose anything we have set.</span>
00269     <span class="comment">//</span>
00270 
00271     dwErr = GetLastError();
00272     GlobalFreePtr(pMemory);
00273     <span class="keywordflow">if</span> (dwErr)
00274     {
00275         SetLastError(dwErr);
00276     }
00277 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="object.c::MemReAlloc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID MemReAlloc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>pMemory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwNewSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00234">234</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03135">GrowProfile()</a>, and <a class="el" href="../../d0/d7/profman_8c-source.html#l02838">InternalAssociateColorProfileWithDevice()</a>.
<p>
<pre class="fragment"><div>00238 {
00239     <span class="keywordflow">return</span> (PVOID)GlobalReAllocPtr(pMemory, dwNewSize, GMEM_ZEROINIT);
00240 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="object.c::MyCopyMemory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MyCopyMemory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pDest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00300">300</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03228">AddTagTableEntry()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l03745">InsertInBuffer()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03586">MoveProfileData()</a>, and <a class="el" href="../../d0/d7/profman_8c-source.html#l04699">RemoveStringFromMultiSz()</a>.
<p>
<pre class="fragment"><div>00305 {
00306     <span class="comment">//</span>
00307     <span class="comment">// Make sure overlapping cases are handled</span>
00308     <span class="comment">//</span>
00309 
00310     <span class="keywordflow">if</span> ((pSrc &lt; pDest) &amp;&amp; ((pSrc + dwCount) &gt;= pDest))
00311     {
00312         <span class="comment">//</span>
00313         <span class="comment">// Overlapping case, copy in reverse</span>
00314         <span class="comment">//</span>
00315 
00316         pSrc += dwCount - 1;
00317         pDest += dwCount - 1;
00318 
00319         <span class="keywordflow">while</span> (dwCount--)
00320         {
00321             *pDest-- = *pSrc--;
00322         }
00323 
00324     }
00325     <span class="keywordflow">else</span>
00326     {
00327         <span class="keywordflow">while</span> (dwCount--)
00328         {
00329             *pDest++ = *pSrc++;
00330         }
00331     }
00332 
00333     <span class="keywordflow">return</span>;
00334 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="object.c::ReleaseColorMatchingModule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ReleaseColorMatchingModule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCMMOBJ&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pCMMObj</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00865">865</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, and <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00114">critsec</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02283">ConvertColorNameToIndex()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02409">ConvertIndexToColorName()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02540">CreateDeviceLinkProfile()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00194">CreateMultiProfileTransform()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00363">DeleteColorTransform()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02166">GetNamedProfileInfo()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02027">GetPS2ColorRenderingDictionary()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01887">GetPS2ColorRenderingIntent()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01744">GetPS2ColorSpaceArray()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02992">InternalCreateProfileFromLCS()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00375">IsColorProfileValid()</a>.
<p>
<pre class="fragment"><div>00868 {
00869     EnterCriticalSection(&amp;critsec);     <span class="comment">// Critical section</span>
00870 
00871     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pCMMObj-&gt;objHdr.dwUseCount &gt; 0);
00872 
00873     pCMMObj-&gt;objHdr.dwUseCount--;
00874 
00875     <span class="keywordflow">if</span> (pCMMObj-&gt;objHdr.dwUseCount == 0)
00876     {
00877         <span class="comment">//</span>
00878         <span class="comment">// Unloading the CMM everytime a transform is freed might not be</span>
00879         <span class="comment">// very efficient. So for now, I am not going to unload it. When</span>
00880         <span class="comment">// the app terminates, kernel should unload all dll's loaded by</span>
00881         <span class="comment">// this app</span>
00882         <span class="comment">//</span>
00883     }
00884     LeaveCriticalSection(&amp;critsec);     <span class="comment">// Critical section</span>
00885 
00886     <span class="keywordflow">return</span>;
00887 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="object.c::ValidColorMatchingModule" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ValidColorMatchingModule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cmmID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pCMMDll</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00477">477</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d5/mscmm_2icm32_8c-source.html#l00029">CMM_IDENT</a>, <a class="el" href="../../d9/d5/mscmm_2icm32_8c-source.html#l00032">CMM_VERSION</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00143">ERR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00039">gszCMMReqFns</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00024">NUM_REQ_FNS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/color_8c-source.html#l01391">InternalRegisterCMM()</a>.
<p>
<pre class="fragment"><div>00481 {
00482     HINSTANCE hInstance = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00483     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    (WINAPI *pfnCMGetInfo)(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
00484     FARPROC   pfnCMRequired;
00485     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     i;
00486     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>      rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;       <span class="comment">// Assume failure</span>
00487 
00488     <span class="comment">//</span>
00489     <span class="comment">// Load the CMM</span>
00490     <span class="comment">//</span>
00491 
00492     hInstance = LoadLibrary(pCMMDll);
00493 
00494     <span class="keywordflow">if</span> (!hInstance)
00495     {
00496         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not load CMM %s\n"</span>), pCMMDll));
00497         <span class="keywordflow">goto</span> EndValidColorMatchingModule;
00498     }
00499 
00500     (PVOID) pfnCMGetInfo = (PVOID) GetProcAddress(hInstance, gszCMMReqFns[0]);
00501 
00502     <span class="keywordflow">if</span> (!pfnCMGetInfo)
00503     {
00504         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a5">ERR</a>((__TEXT(<span class="stringliteral">"CMM does not export CMGetInfo\n"</span>)));
00505         <span class="keywordflow">goto</span> EndValidColorMatchingModule;
00506     }
00507 
00508     <span class="comment">//</span>
00509     <span class="comment">// Check if the CMM is the right version and reports the same ID</span>
00510     <span class="comment">//</span>
00511 
00512     <span class="keywordflow">if</span> ((pfnCMGetInfo(CMM_VERSION) &lt; 0x00050000) ||
00513         (pfnCMGetInfo(CMM_IDENT) != cmmID))
00514     {
00515         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a5">ERR</a>((__TEXT(<span class="stringliteral">"CMM %s not correct version or reports incorrect ID\n"</span>), pCMMDll));
00516         <span class="keywordflow">goto</span> EndValidColorMatchingModule;
00517     }
00518 
00519     <span class="comment">//</span>
00520     <span class="comment">// Check the remaining required functions is presented</span>
00521     <span class="comment">//</span>
00522 
00523     <span class="keywordflow">for</span> (i=1; i&lt;<a class="code" href="../../d2/d1/object_8c.html#a0">NUM_REQ_FNS</a>; i++)
00524     {
00525         pfnCMRequired = GetProcAddress(hInstance, gszCMMReqFns[i]);
00526         <span class="keywordflow">if</span> (!pfnCMRequired)
00527         {
00528             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a5">ERR</a>((__TEXT(<span class="stringliteral">"CMM %s does not export %s\n"</span>), pCMMDll, gszCMMReqFns[i]));
00529             <span class="keywordflow">goto</span> EndValidColorMatchingModule;
00530         }
00531     }
00532 
00533     rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00534 
00535 EndValidColorMatchingModule:
00536 
00537     <span class="keywordflow">if</span> (hInstance)
00538     {
00539         FreeLibrary(hInstance);
00540     }
00541 
00542     <span class="keywordflow">return</span> rc;
00543 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="object.c::ValidHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ValidHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OBJECTTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>objType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00138">138</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/color_8c-source.html#l00687">CheckBitmapBits()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00508">CheckColors()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00271">CloseColorProfile()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02283">ConvertColorNameToIndex()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02409">ConvertIndexToColorName()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02540">CreateDeviceLinkProfile()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00194">CreateMultiProfileTransform()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00363">DeleteColorTransform()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00773">GetCMMInfo()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00817">GetColorProfileElement()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00725">GetColorProfileElementTag()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00310">GetColorProfileFromHandle()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01577">GetColorProfileHeader()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00659">GetCountColorProfileElements()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02166">GetNamedProfileInfo()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02027">GetPS2ColorRenderingDictionary()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01887">GetPS2ColorRenderingIntent()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01744">GetPS2ColorSpaceArray()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00569">IsColorProfileTagPresent()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00375">IsColorProfileValid()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01267">SetColorProfileElement()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01422">SetColorProfileElementReference()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00986">SetColorProfileElementSize()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01652">SetColorProfileHeader()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00583">TranslateBitmapBits()</a>, and <a class="el" href="../../d1/d3/color_8c-source.html#l00439">TranslateColors()</a>.
<p>
<pre class="fragment"><div>00142 {
00143     POBJHEAD pObject;
00144     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc;
00145 
00146     <span class="keywordflow">if</span> (!hObject)
00147     {
00148         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00149     }
00150 
00151     pObject = (POBJHEAD)HDLTOPTR(hObject);
00152 
00153     rc = !IsBadReadPtr(pObject, <span class="keyword">sizeof</span>(DWORD)) &amp;&amp;
00154          (pObject-&gt;objType == objType);
00155 
00156     <span class="keywordflow">return</span> rc;
00157 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="object.c::ValidProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ValidProfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFOBJ&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pProfObj</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/object_8c-source.html#l00176">176</a> of file <a class="el" href="../../d3/d0/object_8c-source.html">object.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, and <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02283">ConvertColorNameToIndex()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02409">ConvertIndexToColorName()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02540">CreateDeviceLinkProfile()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l00194">CreateMultiProfileTransform()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00817">GetColorProfileElement()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00725">GetColorProfileElementTag()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01577">GetColorProfileHeader()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00659">GetCountColorProfileElements()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02166">GetNamedProfileInfo()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02027">GetPS2ColorRenderingDictionary()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01887">GetPS2ColorRenderingIntent()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01744">GetPS2ColorSpaceArray()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02694">InternalOpenColorProfile()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00569">IsColorProfileTagPresent()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00375">IsColorProfileValid()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01267">SetColorProfileElement()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01422">SetColorProfileElementReference()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00986">SetColorProfileElementSize()</a>.
<p>
<pre class="fragment"><div>00179 {
00180     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize = FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize);
00181 
00182     <span class="keywordflow">return</span> ((dwSize &lt;= pProfObj-&gt;dwMapSize) &amp;&amp;
00183             (HEADER(pProfObj)-&gt;phSignature == PROFILE_SIGNATURE) &amp;&amp;
00184             (dwSize &gt;= (<span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>))));
00185 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:58 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
