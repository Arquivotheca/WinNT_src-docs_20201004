<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: cmp.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cmp.h</h1><a href="../../d1/d2/cmp_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    cmp.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains the private (internal) header file for the</span>
00012 <span class="comment">    configuration manager.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Bryan M. Willman (bryanwi) 10-Sep-91</span>
00017 <span class="comment"></span>
00018 <span class="comment">Environment:</span>
00019 <span class="comment"></span>
00020 <span class="comment">    Kernel mode only.</span>
00021 <span class="comment"></span>
00022 <span class="comment">Revision History:</span>
00023 <span class="comment"></span>
00024 <span class="comment">    13-Jan-99 Dragos C. Sambotin (dragoss) - factoring the data structure declarations</span>
00025 <span class="comment">        in \nt\private\ntos\inc\cmdata.h :: to be available from outside.</span>
00026 <span class="comment">--*/</span>
00027 
00028 <span class="preprocessor">#ifndef _CMP_</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#define _CMP_</span>
00030 <span class="preprocessor"></span>
00031 <span class="preprocessor">#include "<a class="code" href="../../d9/d8/ntos_8h.html">ntos.h</a>"</span>
00032 <span class="preprocessor">#include "<a class="code" href="../../d6/d0/hive_8h.html">hive.h</a>"</span>
00033 <span class="preprocessor">#include "wchar.h"</span>
00034 <span class="preprocessor">#include "zwapi.h"</span>
00035 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00036 <span class="preprocessor">#include &lt;<a class="code" href="../../d6/d7/profiles_8h.html">profiles.h</a>&gt;</span>
00037 
00038 
00039 
00040 <span class="comment">// CM data structure declarations</span>
00041 <span class="comment">// file location: \nt\private\ntos\inc</span>
00042 <span class="preprocessor">#include "<a class="code" href="../../d9/d0/cmdata_8h.html">cmdata.h</a>"</span>
00043 
00044 <span class="comment">// this is to catch twice deletion of an entry from a list</span>
<a name="l00045"></a><a class="code" href="../../d1/d2/cmp_8h.html#a0">00045</a> <span class="preprocessor">#define _CM_ENTRYLIST_MANIPULATION</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#ifdef _CM_ENTRYLIST_MANIPULATION</span>
00047 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="../../d1/d2/cmp_8h.html#a1">00048</a> <span class="preprocessor">#define CmpRemoveEntryList(a)                                           \</span>
00049 <span class="preprocessor">    if(((a)-&gt;Flink != NULL) &amp;&amp; ((a)-&gt;Blink != NULL) ) { \</span>
00050 <span class="preprocessor">            RemoveEntryList(a);                                                 \</span>
00051 <span class="preprocessor">            (a)-&gt;Flink = (a)-&gt;Blink = NULL;                                 \</span>
00052 <span class="preprocessor">    }                                                                           </span>
00053 <span class="preprocessor"></span>
<a name="l00054"></a><a class="code" href="../../d1/d2/cmp_8h.html#a2">00054</a> <span class="preprocessor">#define CmpClearListEntry(a) (a)-&gt;Flink = (a)-&gt;Blink = NULL</span>
00055 <span class="preprocessor"></span>
00056 <span class="preprocessor">#else</span>
00057 <span class="preprocessor"></span><span class="preprocessor">#define CmpRemoveEntryList(a) RemoveEntryList(a)</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#define CmpClearListEntry(a) //nothing</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00060 <span class="preprocessor"></span>
00061 <span class="comment">// tracing registry calls support</span>
<a name="l00062"></a><a class="code" href="../../d1/d2/cmp_8h.html#a3">00062</a> <span class="preprocessor">#define _WMI_TRACING_REGISTRYCALLS</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#ifdef _WMI_TRACING_REGISTRYCALLS</span>
00064 <span class="preprocessor"></span>
00065 <span class="comment">//NTSTATUS</span>
00066 <span class="comment">//CmpWmiFireEvent(</span>
00067 <span class="comment">//    IN NTSTATUS Status,</span>
00068 <span class="comment">//    IN HANDLE KeyHandle,</span>
00069 <span class="comment">//    IN LONGLONG  ElapsedTime,</span>
00070 <span class="comment">//    IN PUNICODE_STRING KeyName,</span>
00071 <span class="comment">//    IN UCHAR Type</span>
00072 <span class="comment">//    );</span>
<a name="l00073"></a><a class="code" href="../../d1/d2/cmp_8h.html#a152">00073</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d1/d2/cmp_8h.html#a152">WmiUsePerfClock</a>;
<a name="l00074"></a><a class="code" href="../../d1/d2/cmp_8h.html#a153">00074</a> <span class="keyword">extern</span> <a class="code" href="../../d7/d9/cm_8h.html#a28">PCM_TRACE_NOTIFY_ROUTINE</a> <a class="code" href="../../d1/d2/cmp_8h.html#a153">CmpTraceRoutine</a>;
00075 
<a name="l00076"></a><a class="code" href="../../d1/d2/cmp_8h.html#a4">00076</a> <span class="preprocessor">#define CmpWmiFireEvent(Status,KeyHandle,ElapsedTime,KeyName,Type)  \</span>
00077 <span class="preprocessor">{                                                                   \</span>
00078 <span class="preprocessor">    PCM_TRACE_NOTIFY_ROUTINE TraceRoutine = CmpTraceRoutine;        \</span>
00079 <span class="preprocessor">    if( TraceRoutine != NULL ) {                                    \</span>
00080 <span class="preprocessor">        (*TraceRoutine)(Status,KeyHandle,ElapsedTime,KeyName,Type); \</span>
00081 <span class="preprocessor">    }                                                               \</span>
00082 <span class="preprocessor">}</span>
00083 <span class="preprocessor"></span>
<a name="l00084"></a><a class="code" href="../../d1/d2/cmp_8h.html#a5">00084</a> <span class="preprocessor">#define StartWmiCmTrace()\</span>
00085 <span class="preprocessor">    LARGE_INTEGER StartSystemTime;\</span>
00086 <span class="preprocessor">    LARGE_INTEGER EndSystemTime;\</span>
00087 <span class="preprocessor">    if (CmpTraceRoutine) {\</span>
00088 <span class="preprocessor">        if (WmiUsePerfClock) {\</span>
00089 <span class="preprocessor">            StartSystemTime = KeQueryPerformanceCounter(NULL);\</span>
00090 <span class="preprocessor">        }\</span>
00091 <span class="preprocessor">        else {\</span>
00092 <span class="preprocessor">            KeQuerySystemTime(&amp;StartSystemTime);\</span>
00093 <span class="preprocessor">        }\</span>
00094 <span class="preprocessor">    }</span>
00095 <span class="preprocessor"></span>
00096 
<a name="l00097"></a><a class="code" href="../../d1/d2/cmp_8h.html#a6">00097</a> <span class="preprocessor">#define EndWmiCmTrace(Status,Handle,KeyName,Type)\</span>
00098 <span class="preprocessor">    if (CmpTraceRoutine) {\</span>
00099 <span class="preprocessor">        try {\</span>
00100 <span class="preprocessor">            if (WmiUsePerfClock) {\</span>
00101 <span class="preprocessor">                EndSystemTime = KeQueryPerformanceCounter(NULL);\</span>
00102 <span class="preprocessor">            }\</span>
00103 <span class="preprocessor">            else {\</span>
00104 <span class="preprocessor">                KeQuerySystemTime(&amp;EndSystemTime);\</span>
00105 <span class="preprocessor">            }\</span>
00106 <span class="preprocessor">            CmpWmiFireEvent(Status,Handle,EndSystemTime.QuadPart - StartSystemTime.QuadPart,KeyName,Type);\</span>
00107 <span class="preprocessor">        } except (EXCEPTION_EXECUTE_HANDLER) {\</span>
00108 <span class="preprocessor">        }\</span>
00109 <span class="preprocessor">    }</span>
00110 <span class="preprocessor"></span>
00111 <span class="preprocessor">#else</span>
00112 <span class="preprocessor"></span><span class="preprocessor">#define StartWmiCmTrace()                           //nothing</span>
00113 <span class="preprocessor"></span><span class="preprocessor">#define EndWmiCmTrace(Status,Handle,KeyName,Type)   //nothing</span>
00114 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00115 <span class="preprocessor"></span>
00116 <span class="comment">//#define _WRITE_PROTECTED_VALUE_CACHE</span>
00117 <span class="preprocessor">#ifdef _WRITE_PROTECTED_VALUE_CACHE</span>
00118 <span class="preprocessor"></span>
00119 <span class="preprocessor">#define CmpMakeSpecialPoolReadOnly(PoolAddress) \</span>
00120 <span class="preprocessor">    { \</span>
00121 <span class="preprocessor">        if( !MmProtectSpecialPool( (PVOID) PoolAddress, PAGE_READONLY) ) \</span>
00122 <span class="preprocessor">        KdPrint(("[CmpMakeSpecialPoolReadOnly]: Failed to Mark SpecialPool %lx as ReadOnly", PoolAddress )); \</span>
00123 <span class="preprocessor">    }</span>
00124 <span class="preprocessor"></span>
00125 <span class="preprocessor">#define CmpMakeSpecialPoolReadWrite(PoolAddress) \</span>
00126 <span class="preprocessor">    { \</span>
00127 <span class="preprocessor">        if( !MmProtectSpecialPool( (PVOID) PoolAddress, PAGE_READWRITE) ) { \</span>
00128 <span class="preprocessor">           KdPrint(("[CmpMakeSpecialPoolReadWrite]: Failed to Mark SpecialPool %lx as ReadWrite", PoolAddress )); \</span>
00129 <span class="preprocessor">        } \</span>
00130 <span class="preprocessor">    }</span>
00131 <span class="preprocessor"></span><span class="preprocessor">#define CmpMakeValueCacheReadOnly(ValueCached,PoolAddress) \</span>
00132 <span class="preprocessor">    if(ValueCached) { \</span>
00133 <span class="preprocessor">        CmpMakeSpecialPoolReadOnly( PoolAddress );\</span>
00134 <span class="preprocessor">    }</span>
00135 <span class="preprocessor"></span>
00136 <span class="preprocessor">#define CmpMakeValueCacheReadWrite(ValueCached,PoolAddress) \</span>
00137 <span class="preprocessor">    if(ValueCached) { \</span>
00138 <span class="preprocessor">        CmpMakeSpecialPoolReadWrite( PoolAddress );\</span>
00139 <span class="preprocessor">    }</span>
00140 <span class="preprocessor"></span>
00141 <span class="preprocessor">#else</span>
<a name="l00142"></a><a class="code" href="../../d1/d2/cmp_8h.html#a7">00142</a> <span class="preprocessor"></span><span class="preprocessor">#define CmpMakeSpecialPoolReadOnly(a)  //nothing</span>
<a name="l00143"></a><a class="code" href="../../d1/d2/cmp_8h.html#a8">00143</a> <span class="preprocessor"></span><span class="preprocessor">#define CmpMakeSpecialPoolReadWrite(a)  //nothing</span>
<a name="l00144"></a><a class="code" href="../../d1/d2/cmp_8h.html#a9">00144</a> <span class="preprocessor"></span><span class="preprocessor">#define CmpMakeValueCacheReadOnly(a,b) //nothing</span>
<a name="l00145"></a><a class="code" href="../../d1/d2/cmp_8h.html#a10">00145</a> <span class="preprocessor"></span><span class="preprocessor">#define CmpMakeValueCacheReadWrite(a,b) //nothing</span>
00146 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00147 <span class="preprocessor"></span>
00148 <span class="comment">//#define _WRITE_PROTECTED_REGISTRY_POOL</span>
00149 
00150 <span class="preprocessor">#ifdef _WRITE_PROTECTED_REGISTRY_POOL</span>
00151 <span class="preprocessor"></span>
00152 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00153 <a class="code" href="../../d1/d2/cmp_8h.html#a12">HvpMarkBinReadWrite</a>(
00154     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00155     HCELL_INDEX Cell
00156     );
00157 
00158 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00159 <a class="code" href="../../d1/d2/cmp_8h.html#a11">HvpChangeBinAllocation</a>(
00160     <a class="code" href="../../d7/d4/struct__HBIN.html">PHBIN</a>       Bin,
00161     BOOLEAN     ReadOnly
00162     );
00163 
00164 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00165 <a class="code" href="../../d1/d2/cmp_8h.html#a13">CmpMarkAllBinsReadOnly</a>(
00166     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive
00167     );
00168 
00169 <span class="preprocessor">#else</span>
<a name="l00170"></a><a class="code" href="../../d1/d2/cmp_8h.html#a11">00170</a> <span class="preprocessor"></span><span class="preprocessor">#define HvpChangeBinAllocation(a,b) //nothing</span>
<a name="l00171"></a><a class="code" href="../../d1/d2/cmp_8h.html#a12">00171</a> <span class="preprocessor"></span><span class="preprocessor">#define HvpMarkBinReadWrite(a,b) //nothing</span>
<a name="l00172"></a><a class="code" href="../../d1/d2/cmp_8h.html#a13">00172</a> <span class="preprocessor"></span><span class="preprocessor">#define CmpMarkAllBinsReadOnly(a) //nothing</span>
00173 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00174 <span class="preprocessor"></span>
00175 <span class="preprocessor">#ifdef POOL_TAGGING</span>
00176 <span class="preprocessor"></span><span class="comment">//</span>
00177 <span class="comment">// Pool Tag</span>
00178 <span class="comment">//</span>
00179 <span class="preprocessor">#define  CM_POOL_TAG '  MC'</span>
00180 <span class="preprocessor"></span><span class="preprocessor">#define  CM_KCB_TAG  'bkMC'</span>
00181 <span class="preprocessor"></span><span class="preprocessor">#define  CM_POSTBLOCK_TAG  'bpMC'</span>
00182 <span class="preprocessor"></span><span class="preprocessor">#define  CM_NOTIFYBLOCK_TAG 'bnMC'</span>
00183 <span class="preprocessor"></span><span class="preprocessor">#define  CM_POSTEVENT_TAG 'epMC'</span>
00184 <span class="preprocessor"></span><span class="preprocessor">#define  CM_POSTAPC_TAG 'apMC'</span>
00185 <span class="preprocessor"></span>
00186 <span class="preprocessor">#ifdef _WANT_MACHINE_IDENTIFICATION</span>
00187 <span class="preprocessor"></span>
00188 <span class="preprocessor">#define CM_PARSEINI_TAG 'ipMC'</span>
00189 <span class="preprocessor"></span><span class="preprocessor">#define CM_GENINST_TAG  'igMC'</span>
00190 <span class="preprocessor"></span>
00191 <span class="preprocessor">#endif</span>
00192 <span class="preprocessor"></span>
00193 <span class="comment">//</span>
00194 <span class="comment">// Extra Tags for cache.</span>
00195 <span class="comment">// We may want to merge these tags later.</span>
00196 <span class="comment">//</span>
00197 <span class="preprocessor">#define  CM_CACHE_VALUE_INDEX_TAG 'IVMC'</span>
00198 <span class="preprocessor"></span><span class="preprocessor">#define  CM_CACHE_VALUE_TAG       'aVMC'</span>
00199 <span class="preprocessor"></span><span class="preprocessor">#define  CM_CACHE_INDEX_TAG       'nIMC'</span>
00200 <span class="preprocessor"></span><span class="preprocessor">#define  CM_CACHE_VALUE_DATA_TAG  'aDMC'</span>
00201 <span class="preprocessor"></span><span class="preprocessor">#define  CM_NAME_TAG              'bNMC'</span>
00202 <span class="preprocessor"></span>
00203 
00204 <span class="preprocessor">#define ExAllocatePool(a,b) ExAllocatePoolWithTag(a,b,CM_POOL_TAG)</span>
00205 <span class="preprocessor"></span><span class="preprocessor">#define ExAllocatePoolWithQuota(a,b) ExAllocatePoolWithQuotaTag(a,b,CM_POOL_TAG)</span>
00206 <span class="preprocessor"></span>
00207 PVOID
00208 <a class="code" href="../../d1/d2/cmp_8h.html#a14">CmpAllocateTag</a>(
00209     ULONG   Size,
00210     BOOLEAN UseForIo,
00211     ULONG   Tag
00212     );
00213 <span class="preprocessor">#else</span>
<a name="l00214"></a><a class="code" href="../../d1/d2/cmp_8h.html#a14">00214</a> <span class="preprocessor"></span><span class="preprocessor">#define CmpAllocateTag(a,b,c) CmpAllocate(a,b)</span>
00215 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00216 <span class="preprocessor"></span>
00217 <span class="comment">//</span>
00218 <span class="comment">// A variable so can turn on/off certain performance features.</span>
00219 <span class="comment">//</span>
<a name="l00220"></a><a class="code" href="../../d1/d2/cmp_8h.html#a154">00220</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d1/d2/cmp_8h.html#a154">CmpCacheOnFlag</a>;
00221 
<a name="l00222"></a><a class="code" href="../../d1/d2/cmp_8h.html#a15">00222</a> <span class="preprocessor">#define CM_CACHE_FAKE_KEY  0x00000001      // Create Fake key KCB</span>
00223 <span class="preprocessor"></span>
00224 <span class="comment">//</span>
00225 <span class="comment">// This lock protects the KCB cache, including the KCB structures,</span>
00226 <span class="comment">// NameBlock and Value Index.</span>
00227 <span class="comment">//</span>
00228 
<a name="l00229"></a><a class="code" href="../../d1/d2/cmp_8h.html#a155">00229</a> <span class="keyword">extern</span> <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="code" href="../../d1/d2/cmp_8h.html#a155">CmpKcbLock</a>;
<a name="l00230"></a><a class="code" href="../../d1/d2/cmp_8h.html#a16">00230</a> <span class="preprocessor">#define LOCK_KCB_TREE() ExAcquireFastMutexUnsafe(&amp;CmpKcbLock)</span>
<a name="l00231"></a><a class="code" href="../../d1/d2/cmp_8h.html#a17">00231</a> <span class="preprocessor"></span><span class="preprocessor">#define UNLOCK_KCB_TREE() ExReleaseFastMutexUnsafe(&amp;CmpKcbLock)</span>
00232 <span class="preprocessor"></span>
00233 <span class="comment">//</span>
00234 <span class="comment">// Logging.  CmLogLevel &lt;= level</span>
00235 <span class="comment">//           CmLogSelect anded bit mask select</span>
00236 <span class="comment">//</span>
00237 
00238 <span class="comment">//</span>
00239 <span class="comment">// Logging Levels:</span>
00240 <span class="comment">//</span>
00241 
<a name="l00242"></a><a class="code" href="../../d1/d2/cmp_8h.html#a18">00242</a> <span class="preprocessor">#define CML_BUGCHECK  1</span>
<a name="l00243"></a><a class="code" href="../../d1/d2/cmp_8h.html#a19">00243</a> <span class="preprocessor"></span><span class="preprocessor">#define CML_API       2</span>
<a name="l00244"></a><a class="code" href="../../d1/d2/cmp_8h.html#a20">00244</a> <span class="preprocessor"></span><span class="preprocessor">#define CML_API_ARGS  3</span>
<a name="l00245"></a><a class="code" href="../../d1/d2/cmp_8h.html#a21">00245</a> <span class="preprocessor"></span><span class="preprocessor">#define CML_WORKER    4</span>
<a name="l00246"></a><a class="code" href="../../d1/d2/cmp_8h.html#a22">00246</a> <span class="preprocessor"></span><span class="preprocessor">#define CML_MAJOR     5</span>
<a name="l00247"></a><a class="code" href="../../d1/d2/cmp_8h.html#a23">00247</a> <span class="preprocessor"></span><span class="preprocessor">#define CML_MINOR     6</span>
<a name="l00248"></a><a class="code" href="../../d1/d2/cmp_8h.html#a24">00248</a> <span class="preprocessor"></span><span class="preprocessor">#define CML_FLOW      7</span>
<a name="l00249"></a><a class="code" href="../../d1/d2/cmp_8h.html#a25">00249</a> <span class="preprocessor"></span><span class="preprocessor">#define CML_BIN       8</span>
00250 <span class="preprocessor"></span>
00251 <span class="comment">//</span>
00252 <span class="comment">// Logging selection sets:</span>
00253 <span class="comment">//</span>
00254 
<a name="l00255"></a><a class="code" href="../../d1/d2/cmp_8h.html#a26">00255</a> <span class="preprocessor">#define CMS_MAP             0x00000001</span>
<a name="l00256"></a><a class="code" href="../../d1/d2/cmp_8h.html#a27">00256</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_INIT            0x00000002</span>
<a name="l00257"></a><a class="code" href="../../d1/d2/cmp_8h.html#a28">00257</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_NTAPI           0x00000004</span>
<a name="l00258"></a><a class="code" href="../../d1/d2/cmp_8h.html#a29">00258</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_HIVE            0x00000008</span>
<a name="l00259"></a><a class="code" href="../../d1/d2/cmp_8h.html#a30">00259</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_IO              0x00000010</span>
<a name="l00260"></a><a class="code" href="../../d1/d2/cmp_8h.html#a31">00260</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_PARSE           0x00000020</span>
<a name="l00261"></a><a class="code" href="../../d1/d2/cmp_8h.html#a32">00261</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_SAVRES          0x00000040</span>
<a name="l00262"></a><a class="code" href="../../d1/d2/cmp_8h.html#a33">00262</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_CM              0x00000080</span>
<a name="l00263"></a><a class="code" href="../../d1/d2/cmp_8h.html#a34">00263</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_SEC             0x00000100</span>
<a name="l00264"></a><a class="code" href="../../d1/d2/cmp_8h.html#a35">00264</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_POOL            0x00000200</span>
<a name="l00265"></a><a class="code" href="../../d1/d2/cmp_8h.html#a36">00265</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_LOCKING         0x00000400</span>
<a name="l00266"></a><a class="code" href="../../d1/d2/cmp_8h.html#a37">00266</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_NOTIFY          0x00000800</span>
<a name="l00267"></a><a class="code" href="../../d1/d2/cmp_8h.html#a38">00267</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_EXCEPTION       0x00001000</span>
<a name="l00268"></a><a class="code" href="../../d1/d2/cmp_8h.html#a39">00268</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_INDEX           0x00002000</span>
<a name="l00269"></a><a class="code" href="../../d1/d2/cmp_8h.html#a40">00269</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_BIN_MAP         0x00004000</span>
00270 <span class="preprocessor"></span>
<a name="l00271"></a><a class="code" href="../../d1/d2/cmp_8h.html#a41">00271</a> <span class="preprocessor">#define CMS_MAP_ERROR       0x00010000</span>
<a name="l00272"></a><a class="code" href="../../d1/d2/cmp_8h.html#a42">00272</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_INIT_ERROR      0x00020000</span>
<a name="l00273"></a><a class="code" href="../../d1/d2/cmp_8h.html#a43">00273</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_NTAPI_ERROR     0x00040000</span>
<a name="l00274"></a><a class="code" href="../../d1/d2/cmp_8h.html#a44">00274</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_HIVE_ERROR      0x00080000</span>
<a name="l00275"></a><a class="code" href="../../d1/d2/cmp_8h.html#a45">00275</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_IO_ERROR        0x00100000</span>
<a name="l00276"></a><a class="code" href="../../d1/d2/cmp_8h.html#a46">00276</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_PARSE_ERROR     0x00200000</span>
<a name="l00277"></a><a class="code" href="../../d1/d2/cmp_8h.html#a47">00277</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_SAVRES_ERROR    0x00400000</span>
<a name="l00278"></a><a class="code" href="../../d1/d2/cmp_8h.html#a48">00278</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_CM_ERROR        0x00800000</span>
<a name="l00279"></a><a class="code" href="../../d1/d2/cmp_8h.html#a49">00279</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_SEC_ERROR       0x01000000</span>
<a name="l00280"></a><a class="code" href="../../d1/d2/cmp_8h.html#a50">00280</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_POOL_ERROR      0x02000000</span>
<a name="l00281"></a><a class="code" href="../../d1/d2/cmp_8h.html#a51">00281</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_LOCKING_ERROR   0x04000000</span>
<a name="l00282"></a><a class="code" href="../../d1/d2/cmp_8h.html#a52">00282</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_NOTIFY_ERROR    0x08000000</span>
<a name="l00283"></a><a class="code" href="../../d1/d2/cmp_8h.html#a53">00283</a> <span class="preprocessor"></span><span class="preprocessor">#define CMS_INDEX_ERROR     0x10000000</span>
00284 <span class="preprocessor"></span>
00285 
<a name="l00286"></a><a class="code" href="../../d1/d2/cmp_8h.html#a54">00286</a> <span class="preprocessor">#define CMS_DEFAULT         ((~(CMS_MAP)) &amp; 0xffffffff)</span>
00287 <span class="preprocessor"></span>
00288 <span class="preprocessor">#if DBG</span>
00289 <span class="preprocessor"></span><span class="keyword">extern</span>  ULONG <a class="code" href="../../d6/d3/cmwraper_8c.html#a5">CmLogLevel</a>;
00290 <span class="keyword">extern</span>  ULONG <a class="code" href="../../d6/d3/cmwraper_8c.html#a6">CmLogSelect</a>;
00291 <span class="preprocessor">#define CMLOG(level, select) if ((level &lt;= CmLogLevel) &amp;&amp; ((select) &amp; CmLogSelect))</span>
00292 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00293"></a><a class="code" href="../../d1/d2/cmp_8h.html#a55">00293</a> <span class="preprocessor"></span><span class="preprocessor">#define CMLOG(level, select) if (0) {}</span>
00294 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00295 <span class="preprocessor"></span>
00296 
<a name="l00297"></a><a class="code" href="../../d1/d2/cmp_8h.html#a56">00297</a> <span class="preprocessor">#define REGCHECKING 1</span>
00298 <span class="preprocessor"></span>
00299 <span class="preprocessor">#if DBG</span>
00300 <span class="preprocessor"></span>
00301 <span class="preprocessor">#if REGCHECKING</span>
00302 <span class="preprocessor"></span><span class="preprocessor">#define DCmCheckRegistry(a) if(HvHiveChecking) ASSERT(CmCheckRegistry(a, FALSE) == 0)</span>
00303 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00304 <span class="preprocessor"></span><span class="preprocessor">#define DCmCheckRegistry(a)</span>
00305 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00306 <span class="preprocessor"></span>
00307 <span class="preprocessor">#else</span>
<a name="l00308"></a><a class="code" href="../../d1/d2/cmp_8h.html#a57">00308</a> <span class="preprocessor"></span><span class="preprocessor">#define DCmCheckRegistry(a)</span>
00309 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00310 <span class="preprocessor"></span>
<a name="l00311"></a><a class="code" href="../../d1/d2/cmp_8h.html#a58">00311</a> <span class="preprocessor">#define REGISTRY_LOCK_CHECKING</span>
00312 <span class="preprocessor"></span>
00313 <span class="preprocessor">#ifdef  REGISTRY_LOCK_CHECKING</span>
00314 <span class="preprocessor"></span>ULONG
00315 <a class="code" href="../../d7/d7/ntapi_8c.html#a11">CmpCheckLockExceptionFilter</a>(
00316     IN PEXCEPTION_POINTERS ExceptionPointers
00317     );
00318 
<a name="l00319"></a><a class="code" href="../../d1/d2/cmp_8h.html#a59">00319</a> <span class="preprocessor">#define BEGIN_LOCK_CHECKPOINT                                               \</span>
00320 <span class="preprocessor">    {                                                                       \</span>
00321 <span class="preprocessor">        ULONG   LockCountBefore,LockCountAfter;                             \</span>
00322 <span class="preprocessor">        LockCountBefore = ExIsResourceAcquiredShared(&amp;CmpRegistryLock);     \</span>
00323 <span class="preprocessor">        LockCountBefore += ExIsResourceAcquiredExclusive(&amp;CmpRegistryLock); \</span>
00324 <span class="preprocessor">        try {</span>
<a name="l00325"></a><a class="code" href="../../d1/d2/cmp_8h.html#a60">00325</a> <span class="preprocessor"></span><span class="preprocessor">#define END_LOCK_CHECKPOINT                                                     \</span>
00326 <span class="preprocessor">        } except(CmpCheckLockExceptionFilter(GetExceptionInformation())) {}     \</span>
00327 <span class="preprocessor">        LockCountAfter = ExIsResourceAcquiredShared(&amp;CmpRegistryLock);          \</span>
00328 <span class="preprocessor">        LockCountAfter += ExIsResourceAcquiredExclusive(&amp;CmpRegistryLock);      \</span>
00329 <span class="preprocessor">        if( LockCountBefore != LockCountAfter ) {                               \</span>
00330 <span class="preprocessor">            KeBugCheckEx(REGISTRY_ERROR,13,LockCountBefore,LockCountAfter,0);   \</span>
00331 <span class="preprocessor">        }                                                                       \</span>
00332 <span class="preprocessor">    }</span>
00333 <span class="preprocessor"></span>
00334 <span class="preprocessor">#else</span>
00335 <span class="preprocessor"></span><span class="preprocessor">#define BEGIN_LOCK_CHECKPOINT              </span>
00336 <span class="preprocessor"></span><span class="preprocessor">#define END_LOCK_CHECKPOINT              </span>
00337 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00338 <span class="preprocessor"></span>
00339 <span class="preprocessor">#if DBG</span>
00340 <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_CM_LOCK_OWNED() \</span>
00341 <span class="preprocessor">    ASSERT(CmpTestRegistryLock() == TRUE)</span>
00342 <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_CM_LOCK_OWNED_EXCLUSIVE() \</span>
00343 <span class="preprocessor">    ASSERT(CmpTestRegistryLockExclusive() == TRUE)</span>
00344 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00345"></a><a class="code" href="../../d1/d2/cmp_8h.html#a61">00345</a> <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_CM_LOCK_OWNED()</span>
<a name="l00346"></a><a class="code" href="../../d1/d2/cmp_8h.html#a62">00346</a> <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_CM_LOCK_OWNED_EXCLUSIVE()</span>
00347 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00348 <span class="preprocessor"></span>
00349 <span class="preprocessor">#if DBG                                                                     </span>
00350 <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_PASSIVE_LEVEL()                                              \</span>
00351 <span class="preprocessor">    {                                                                       \</span>
00352 <span class="preprocessor">        KIRQL   Irql;                                                       \</span>
00353 <span class="preprocessor">        Irql = KeGetCurrentIrql();                                          \</span>
00354 <span class="preprocessor">        if( KeGetCurrentIrql() != PASSIVE_LEVEL ) {                         \</span>
00355 <span class="preprocessor">            DbgPrint("ASSERT_PASSIVE_LEVEL failed ... Irql = %lu\n",Irql);  \</span>
00356 <span class="preprocessor">            ASSERT( FALSE );                                                \</span>
00357 <span class="preprocessor">        }                                                                   \</span>
00358 <span class="preprocessor">    }</span>
00359 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00360"></a><a class="code" href="../../d1/d2/cmp_8h.html#a63">00360</a> <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_PASSIVE_LEVEL() </span>
00361 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00362 <span class="preprocessor"></span>
00363 <span class="preprocessor">#if defined(_CM_LDR_)</span>
00364 <span class="preprocessor"></span>
00365 <span class="comment">//</span>
00366 <span class="comment">// KeBugCheckEx() is not available to boot code.</span>
00367 <span class="comment">//</span>
00368 
00369 <span class="preprocessor">#define CM_BUGCHECK( Code, Parm1, Parm2, Parm3, Parm4 ) ASSERT(FALSE)</span>
00370 <span class="preprocessor"></span>
00371 <span class="preprocessor">#else</span>
00372 <span class="preprocessor"></span>
<a name="l00373"></a><a class="code" href="../../d1/d2/cmp_8h.html#a64">00373</a> <span class="preprocessor">#define CM_BUGCHECK( Code, Parm1, Parm2, Parm3, Parm4 ) \</span>
00374 <span class="preprocessor">    KeBugCheckEx( Code, Parm1, Parm2, Parm3, Parm4 )</span>
00375 <span class="preprocessor"></span>
00376 <span class="preprocessor">#endif</span>
00377 <span class="preprocessor"></span>
<a name="l00378"></a><a class="code" href="../../d1/d2/cmp_8h.html#a65">00378</a> <span class="preprocessor">#define VALIDATE_CELL_MAP(LINE,Map,Hive,Address)                                                    \</span>
00379 <span class="preprocessor">    if( Map == NULL ) {                                                                             \</span>
00380 <span class="preprocessor">            CM_BUGCHECK (REGISTRY_ERROR,11,(ULONG_PTR)(Hive),(ULONG)(Address),(ULONG)(LINE)) ;     \</span>
00381 <span class="preprocessor">    }</span>
00382 <span class="preprocessor"></span>
00383 <span class="preprocessor">#if DBG</span>
00384 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00385 <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>(
00386     IN PSECURITY_DESCRIPTOR SecurityDescriptor,
00387     IN PSZ TitleString
00388     );
00389 
00390 <span class="keyword">extern</span> BOOLEAN SepDumpSD;
00391 
00392 <span class="preprocessor">#define CmpDumpSecurityDescriptor(x,y) \</span>
00393 <span class="preprocessor">        { \</span>
00394 <span class="preprocessor">            SepDumpSD=TRUE;     \</span>
00395 <span class="preprocessor">            SepDumpSecurityDescriptor(x, y);  \</span>
00396 <span class="preprocessor">            SepDumpSD=FALSE;    \</span>
00397 <span class="preprocessor">        }</span>
00398 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00399 <span class="preprocessor"></span>
<a name="l00400"></a><a class="code" href="../../d1/d2/cmp_8h.html#a66">00400</a> <span class="preprocessor">#define CmpDumpSecurityDescriptor(x,y)</span>
00401 <span class="preprocessor"></span>
00402 <span class="preprocessor">#endif</span>
00403 <span class="preprocessor"></span>
00404 
00405 <span class="comment">//</span>
00406 <span class="comment">// misc stuff</span>
00407 <span class="comment">//</span>
00408 
<a name="l00409"></a><a class="code" href="../../d1/d2/cmp_8h.html#a156">00409</a> <span class="keyword">extern</span>  UNICODE_STRING  <a class="code" href="../../d6/d0/cmdat_8c.html#a33">CmRegistrySystemCloneName</a>;
00410 
00411 <span class="comment">//</span>
00412 <span class="comment">// Determines whether the Current Control Set used during booting</span>
00413 <span class="comment">// is cloned in order to fully preserve it for being saved</span>
00414 <span class="comment">// as the LKG Control Set.</span>
00415 <span class="comment">//</span>
00416 
<a name="l00417"></a><a class="code" href="../../d1/d2/cmp_8h.html#a67">00417</a> <span class="preprocessor">#define CLONE_CONTROL_SET FALSE</span>
00418 <span class="preprocessor"></span>
00419 
<a name="l00420"></a><a class="code" href="../../d1/d2/cmp_8h.html#a68">00420</a> <span class="preprocessor">#define NUMBER_TYPES (MaximumType + 1)</span>
00421 <span class="preprocessor"></span>
<a name="l00422"></a><a class="code" href="../../d1/d2/cmp_8h.html#a69">00422</a> <span class="preprocessor">#define CM_WRAP_LIMIT               0x7fffffff</span>
00423 <span class="preprocessor"></span>
00424 
00425 <span class="comment">//</span>
00426 <span class="comment">// Tuning and control constants</span>
00427 <span class="comment">//</span>
<a name="l00428"></a><a class="code" href="../../d1/d2/cmp_8h.html#a70">00428</a> <span class="preprocessor">#define CM_MAX_STASH           1024*1024        // If size of data for a set</span>
00429 <span class="preprocessor"></span>                                                <span class="comment">// is bigger than this,</span>
00430 
<a name="l00431"></a><a class="code" href="../../d1/d2/cmp_8h.html#a71">00431</a> <span class="preprocessor">#define CM_MAX_REASONABLE_VALUES    100         // If number of values for a</span>
00432 <span class="preprocessor"></span>                                                <span class="comment">// key is greater than this,</span>
00433                                                 <span class="comment">// round up value list size</span>
00434 
00435 
00436 <span class="comment">//</span>
00437 <span class="comment">// Limit on the number of layers of hive there may be.  We allow only</span>
00438 <span class="comment">// the master hive and hives directly linked into it for now, for currently</span>
00439 <span class="comment">// value is always 2..</span>
00440 <span class="comment">//</span>
00441 
<a name="l00442"></a><a class="code" href="../../d1/d2/cmp_8h.html#a72">00442</a> <span class="preprocessor">#define MAX_HIVE_LAYERS         2</span>
00443 <span class="preprocessor"></span>
00444 
00445 <span class="comment">//</span>
00446 <span class="comment">// structure used to create and sort ordered list of drivers to be loaded.</span>
00447 <span class="comment">// This is also used by the OS Loader when loading the boot drivers.</span>
00448 <span class="comment">// (Particularly the ErrorControl field)</span>
00449 <span class="comment">//</span>
00450 
<a name="l00451"></a><a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html">00451</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html">_BOOT_DRIVER_NODE</a> {
<a name="l00452"></a><a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html#o0">00452</a>     <a class="code" href="../../d4/d4/struct__BOOT__DRIVER__LIST__ENTRY.html">BOOT_DRIVER_LIST_ENTRY</a> <a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html#o0">ListEntry</a>;
<a name="l00453"></a><a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html#o1">00453</a>     UNICODE_STRING <a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html#o1">Group</a>;
<a name="l00454"></a><a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html#o2">00454</a>     UNICODE_STRING <a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html#o2">Name</a>;
<a name="l00455"></a><a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html#o3">00455</a>     ULONG <a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html#o3">Tag</a>;
<a name="l00456"></a><a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html#o4">00456</a>     ULONG <a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html#o4">ErrorControl</a>;
00457 } <a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html">BOOT_DRIVER_NODE</a>, *<a class="code" href="../../d5/d4/struct__BOOT__DRIVER__NODE.html">PBOOT_DRIVER_NODE</a>;
00458 
00459 <span class="comment">//</span>
00460 <span class="comment">// extern for object type pointer</span>
00461 <span class="comment">//</span>
00462 
<a name="l00463"></a><a class="code" href="../../d1/d2/cmp_8h.html#a159">00463</a> <span class="keyword">extern</span>  <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> <a class="code" href="../../d6/d0/cmdat_8c.html#a66">CmpKeyObjectType</a>;
00464 
00465 
00466 <span class="comment">//</span>
00467 <span class="comment">// Miscelaneous Hash routines</span>
00468 <span class="comment">//</span>
<a name="l00469"></a><a class="code" href="../../d1/d2/cmp_8h.html#a73">00469</a> <span class="preprocessor">#define RNDM_CONSTANT   314159269    </span><span class="comment">/* default value for "scrambling constant" */</span>
<a name="l00470"></a><a class="code" href="../../d1/d2/cmp_8h.html#a74">00470</a> <span class="preprocessor">#define RNDM_PRIME     1000000007    </span><span class="comment">/* prime number, also used for scrambling  */</span>
00471 
<a name="l00472"></a><a class="code" href="../../d1/d2/cmp_8h.html#a75">00472</a> <span class="preprocessor">#define HASH_KEY(_convkey_) ((RNDM_CONSTANT * (_convkey_)) % RNDM_PRIME)</span>
00473 <span class="preprocessor"></span>
<a name="l00474"></a><a class="code" href="../../d1/d2/cmp_8h.html#a76">00474</a> <span class="preprocessor">#define GET_HASH_INDEX(Key) HASH_KEY(Key) % CmpHashTableSize</span>
<a name="l00475"></a><a class="code" href="../../d1/d2/cmp_8h.html#a77">00475</a> <span class="preprocessor"></span><span class="preprocessor">#define GET_HASH_ENTRY(Table, Key) Table[GET_HASH_INDEX(Key)]</span>
00476 <span class="preprocessor"></span>
00477 <span class="comment">//</span>
00478 <span class="comment">// CM_KEY_BODY</span>
00479 <span class="comment">//</span>
00480 <span class="comment">//  Same structure used for KEY_ROOT and KEY objects.  This is the</span>
00481 <span class="comment">//  Cm defined part of the object.</span>
00482 <span class="comment">//</span>
00483 <span class="comment">//  This object represents an open instance, several of them could refer</span>
00484 <span class="comment">//  to a single key control block.</span>
00485 <span class="comment">//</span>
<a name="l00486"></a><a class="code" href="../../d1/d2/cmp_8h.html#a78">00486</a> <span class="preprocessor">#define KEY_BODY_TYPE           0x6b793032      // "ky02"</span>
00487 <span class="preprocessor"></span>
00488 <span class="keyword">struct </span><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html">_CM_NOTIFY_BLOCK</a>; <span class="comment">//forward</span>
00489 
<a name="l00490"></a><a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html">00490</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html">_CM_KEY_BODY</a> {
<a name="l00491"></a><a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html#o0">00491</a>     ULONG                   <a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html#o0">Type</a>;
<a name="l00492"></a><a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html#o1">00492</a>     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>   <a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html#o1">KeyControlBlock</a>;
<a name="l00493"></a><a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html#o2">00493</a>     <span class="keyword">struct </span><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html">_CM_NOTIFY_BLOCK</a> *<a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html#o2">NotifyBlock</a>;
<a name="l00494"></a><a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html#o3">00494</a>     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>               <a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html#o3">Process</a>; <span class="comment">// the owner process</span>
00495 <span class="preprocessor">#ifdef KCB_TO_KEYBODY_LINK</span>
00496 <span class="preprocessor"></span>    LIST_ENTRY              KeyBodyList; <span class="comment">// key_nodes using the same kcb</span>
00497 <span class="preprocessor">#endif</span>
00498 <span class="preprocessor"></span>} <a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html">CM_KEY_BODY</a>, *<a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html">PCM_KEY_BODY</a>;
00499 
00500 
00501 <span class="preprocessor">#ifdef KCB_TO_KEYBODY_LINK</span>
00502 <span class="preprocessor"></span>
00503 <span class="preprocessor">#define INIT_KCB_KEYBODY_LIST(kcb)                  \</span>
00504 <span class="preprocessor">    LOCK_KCB_TREE();                                \</span>
00505 <span class="preprocessor">    InitializeListHead(&amp;(kcb-&gt;KeyBodyListHead));    \</span>
00506 <span class="preprocessor">    UNLOCK_KCB_TREE()</span>
00507 <span class="preprocessor"></span>    
00508 <span class="preprocessor">#define ASSERT_KEYBODY_LIST_EMPTY(kcb)  ASSERT(IsListEmpty(&amp;(kcb-&gt;KeyBodyListHead)) == TRUE)</span>
00509 <span class="preprocessor"></span>
00510 <span class="preprocessor">#define ENLIST_KEYBODY_IN_KEYBODY_LIST(KeyBody)                                             \</span>
00511 <span class="preprocessor">    ASSERT( KeyBody-&gt;KeyControlBlock != NULL );                                             \</span>
00512 <span class="preprocessor">    LOCK_KCB_TREE();                                                                        \</span>
00513 <span class="preprocessor">    InsertTailList(&amp;(KeyBody-&gt;KeyControlBlock-&gt;KeyBodyListHead),&amp;(KeyBody-&gt;KeyBodyList));   \</span>
00514 <span class="preprocessor">    UNLOCK_KCB_TREE()</span>
00515 <span class="preprocessor"></span>
00516 <span class="preprocessor">#define DELIST_KEYBODY_FROM_KEYBODY_LIST(KeyBody)                                           \</span>
00517 <span class="preprocessor">    ASSERT( KeyBody-&gt;KeyControlBlock != NULL );                                             \</span>
00518 <span class="preprocessor">    ASSERT(IsListEmpty(&amp;(KeyBody-&gt;KeyControlBlock-&gt;KeyBodyListHead)) == FALSE);             \</span>
00519 <span class="preprocessor">    LOCK_KCB_TREE();                                                                        \</span>
00520 <span class="preprocessor">    RemoveEntryList(&amp;(KeyBody-&gt;KeyBodyList));                                               \</span>
00521 <span class="preprocessor">    UNLOCK_KCB_TREE()</span>
00522 <span class="preprocessor"></span>
00523 <span class="preprocessor">#else</span>
<a name="l00524"></a><a class="code" href="../../d1/d2/cmp_8h.html#a79">00524</a> <span class="preprocessor"></span><span class="preprocessor">#define INIT_KCB_KEYBODY_LIST(kcb)      //nothing</span>
<a name="l00525"></a><a class="code" href="../../d1/d2/cmp_8h.html#a80">00525</a> <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_KEYBODY_LIST_EMPTY(kcb)  //nothing</span>
<a name="l00526"></a><a class="code" href="../../d1/d2/cmp_8h.html#a81">00526</a> <span class="preprocessor"></span><span class="preprocessor">#define ENLIST_KEYBODY_IN_KEYBODY_LIST(KeyBody)     //nothing</span>
<a name="l00527"></a><a class="code" href="../../d1/d2/cmp_8h.html#a82">00527</a> <span class="preprocessor"></span><span class="preprocessor">#define DELIST_KEYBODY_FROM_KEYBODY_LIST(KeyBody)   //nothing</span>
00528 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00529 <span class="preprocessor"></span>
<a name="l00530"></a><a class="code" href="../../d1/d2/cmp_8h.html#a83">00530</a> <span class="preprocessor">#define ASSERT_KEY_OBJECT(x) ASSERT(((PCM_KEY_BODY)x)-&gt;Type == KEY_BODY_TYPE)</span>
<a name="l00531"></a><a class="code" href="../../d1/d2/cmp_8h.html#a84">00531</a> <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_NODE(x) ASSERT(((PCM_KEY_NODE)x)-&gt;Signature == CM_KEY_NODE_SIGNATURE)</span>
<a name="l00532"></a><a class="code" href="../../d1/d2/cmp_8h.html#a85">00532</a> <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_SECURITY(x) ASSERT(((PCM_KEY_SECURITY)x)-&gt;Signature == CM_KEY_SECURITY_SIGNATURE)</span>
00533 <span class="preprocessor"></span>
00534 <span class="comment">//</span>
00535 <span class="comment">// CM_POST_KEY_BODY</span>
00536 <span class="comment">//</span>
00537 <span class="comment">// A post block can have attached a keybody which has to be dereferenced </span>
00538 <span class="comment">// when the post block goes out of scope. This structure allows the </span>
00539 <span class="comment">// implementation of keybody "delayed dereferencing". (see CmpPostNotify for comments)</span>
00540 <span class="comment">//</span>
00541 
<a name="l00542"></a><a class="code" href="../../d6/d6/struct__CM__POST__KEY__BODY.html">00542</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d6/struct__CM__POST__KEY__BODY.html">_CM_POST_KEY_BODY</a> {
<a name="l00543"></a><a class="code" href="../../d6/d6/struct__CM__POST__KEY__BODY.html#o0">00543</a>     LIST_ENTRY                  <a class="code" href="../../d6/d6/struct__CM__POST__KEY__BODY.html#o0">KeyBodyList</a>;
<a name="l00544"></a><a class="code" href="../../d6/d6/struct__CM__POST__KEY__BODY.html#o1">00544</a>     <span class="keyword">struct </span><a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html">_CM_KEY_BODY</a>         *<a class="code" href="../../d6/d6/struct__CM__POST__KEY__BODY.html#o1">KeyBody</a>;        <span class="comment">// this key body object</span>
00545 } <a class="code" href="../../d6/d6/struct__CM__POST__KEY__BODY.html">CM_POST_KEY_BODY</a>, *<a class="code" href="../../d6/d6/struct__CM__POST__KEY__BODY.html">PCM_POST_KEY_BODY</a>;
00546 
00547 
00548 <span class="comment">//</span>
00549 <span class="comment">// CM_NOTIFY_BLOCK</span>
00550 <span class="comment">//</span>
00551 <span class="comment">//  A notify block tracks an active notification waiting for notification.</span>
00552 <span class="comment">//  Any one open instance (CM_KEY_BODY) will refer to at most one</span>
00553 <span class="comment">//  notify block.  A given key control block may have as many notify</span>
00554 <span class="comment">//  blocks refering to it as there are CM_KEY_BODYs refering to it.</span>
00555 <span class="comment">//  Notify blocks are attached to hives and sorted by length of name.</span>
00556 <span class="comment">//</span>
00557 
<a name="l00558"></a><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html">00558</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html">_CM_NOTIFY_BLOCK</a> {
<a name="l00559"></a><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o0">00559</a>     LIST_ENTRY                  <a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o0">HiveList</a>;        <span class="comment">// sorted list of notifies</span>
<a name="l00560"></a><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o1">00560</a>     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>       <a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o1">KeyControlBlock</a>; <span class="comment">// Open instance notify is on</span>
<a name="l00561"></a><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o2">00561</a>     <span class="keyword">struct </span><a class="code" href="../../d4/d4/struct__CM__KEY__BODY.html">_CM_KEY_BODY</a>         *<a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o2">KeyBody</a>;        <span class="comment">// our owning key handle object</span>
<a name="l00562"></a><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o3">00562</a>     ULONG                       <a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o3">Filter</a>;          <span class="comment">// Events of interest</span>
<a name="l00563"></a><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o4">00563</a>     LIST_ENTRY                  <a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o4">PostList</a>;        <span class="comment">// Posts to fill</span>
<a name="l00564"></a><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o5">00564</a>     <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a>    <a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o5">SubjectContext</a>;  <span class="comment">// Security stuff</span>
<a name="l00565"></a><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o6">00565</a>     BOOLEAN                     <a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o6">WatchTree</a>;
<a name="l00566"></a><a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o7">00566</a>     BOOLEAN                     <a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html#o7">NotifyPending</a>;
00567 } <a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html">CM_NOTIFY_BLOCK</a>, *<a class="code" href="../../d2/d6/struct__CM__NOTIFY__BLOCK.html">PCM_NOTIFY_BLOCK</a>;
00568 
00569 <span class="comment">//</span>
00570 <span class="comment">// CM_POST_BLOCK</span>
00571 <span class="comment">//</span>
00572 <span class="comment">//  Whenever a notify call is made, a post block is created and attached</span>
00573 <span class="comment">//  to the notify block.  Each time an event is posted against the notify,</span>
00574 <span class="comment">//  the waiter described by the post block is signaled.  (i.e. APC enqueued,</span>
00575 <span class="comment">//  event signalled, etc.)</span>
00576 <span class="comment">//</span>
00577 
00578 <span class="comment">//</span>
00579 <span class="comment">//  The NotifyType ULONG is a combination of POST_BLOCK_TYPE enum and flags </span>
00580 <span class="comment">//</span>
00581 
<a name="l00582"></a><a class="code" href="../../d1/d2/cmp_8h.html#a335">00582</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d1/d2/cmp_8h.html#a335">_POST_BLOCK_TYPE</a> {
00583     <a class="code" href="../../d1/d2/cmp_8h.html#a335a204">PostSynchronous</a> = 1,
00584     <a class="code" href="../../d1/d2/cmp_8h.html#a335a205">PostAsyncUser</a> = 2,
00585     <a class="code" href="../../d1/d2/cmp_8h.html#a335a206">PostAsyncKernel</a> = 3
00586 } <a class="code" href="../../d1/d2/cmp_8h.html#a166">POST_BLOCK_TYPE</a>;
00587 
<a name="l00588"></a><a class="code" href="../../d7/d6/struct__CM__SYNC__POST__BLOCK.html">00588</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d6/struct__CM__SYNC__POST__BLOCK.html">_CM_SYNC_POST_BLOCK</a> {
<a name="l00589"></a><a class="code" href="../../d7/d6/struct__CM__SYNC__POST__BLOCK.html#o0">00589</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a>                 <a class="code" href="../../d7/d6/struct__CM__SYNC__POST__BLOCK.html#o0">SystemEvent</a>;
<a name="l00590"></a><a class="code" href="../../d7/d6/struct__CM__SYNC__POST__BLOCK.html#o1">00590</a>     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                <a class="code" href="../../d7/d6/struct__CM__SYNC__POST__BLOCK.html#o1">Status</a>;
00591 } <a class="code" href="../../d7/d6/struct__CM__SYNC__POST__BLOCK.html">CM_SYNC_POST_BLOCK</a>, *<a class="code" href="../../d7/d6/struct__CM__SYNC__POST__BLOCK.html">PCM_SYNC_POST_BLOCK</a>;
00592 
<a name="l00593"></a><a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html">00593</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html">_CM_ASYNC_USER_POST_BLOCK</a> {
<a name="l00594"></a><a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o0">00594</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a>                 <a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o0">UserEvent</a>;
<a name="l00595"></a><a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o1">00595</a>     <a class="code" href="../../d1/d5/struct__KAPC.html">PKAPC</a>                   <a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o1">Apc</a>;
<a name="l00596"></a><a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o2">00596</a>     PIO_STATUS_BLOCK        <a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html#o2">IoStatusBlock</a>;
00597 } <a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html">CM_ASYNC_USER_POST_BLOCK</a>, *<a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html">PCM_ASYNC_USER_POST_BLOCK</a>;
00598 
<a name="l00599"></a><a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html">00599</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html">_CM_ASYNC_KERNEL_POST_BLOCK</a> {
<a name="l00600"></a><a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html#o0">00600</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a>                 <a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html#o0">Event</a>;
<a name="l00601"></a><a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html#o1">00601</a>     <a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">PWORK_QUEUE_ITEM</a>        <a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html#o1">WorkItem</a>;
<a name="l00602"></a><a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html#o2">00602</a>     <a class="code" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a>         <a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html#o2">QueueType</a>;
00603 } <a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html">CM_ASYNC_KERNEL_POST_BLOCK</a>, *<a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html">PCM_ASYNC_KERNEL_POST_BLOCK</a>;
00604 
<a name="l00605"></a><a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html">00605</a> <span class="keyword">typedef</span> <span class="keyword">union </span><a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html">_CM_POST_BLOCK_UNION</a> {
<a name="l00606"></a><a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o0">00606</a>     <a class="code" href="../../d7/d6/struct__CM__SYNC__POST__BLOCK.html">CM_SYNC_POST_BLOCK</a>  <a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o0">Sync</a>;
<a name="l00607"></a><a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o1">00607</a>     <a class="code" href="../../d1/d3/struct__CM__ASYNC__USER__POST__BLOCK.html">CM_ASYNC_USER_POST_BLOCK</a> <a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o1">AsyncUser</a>;
<a name="l00608"></a><a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o2">00608</a>     <a class="code" href="../../d0/d3/struct__CM__ASYNC__KERNEL__POST__BLOCK.html">CM_ASYNC_KERNEL_POST_BLOCK</a> <a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html#o2">AsyncKernel</a>;
00609 } <a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html">CM_POST_BLOCK_UNION</a>, *<a class="code" href="../../d5/d6/union__CM__POST__BLOCK__UNION.html">PCM_POST_BLOCK_UNION</a>;
00610 
<a name="l00611"></a><a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html">00611</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html">_CM_POST_BLOCK</a> {
00612 <span class="preprocessor">#if DBG</span>
00613 <span class="preprocessor"></span>    BOOLEAN                     TraceIntoDebugger;
00614 <span class="preprocessor">#endif</span>
<a name="l00615"></a><a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o0">00615</a> <span class="preprocessor"></span>    LIST_ENTRY                  <a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o0">NotifyList</a>;
<a name="l00616"></a><a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o1">00616</a>     LIST_ENTRY                  <a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o1">ThreadList</a>;
<a name="l00617"></a><a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o2">00617</a>     LIST_ENTRY                  <a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o2">CancelPostList</a>; <span class="comment">// slave notifications that are attached to this notification</span>
<a name="l00618"></a><a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o3">00618</a>     <span class="keyword">struct </span><a class="code" href="../../d6/d6/struct__CM__POST__KEY__BODY.html">_CM_POST_KEY_BODY</a>    *<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o3">PostKeyBody</a>; 
<a name="l00619"></a><a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o4">00619</a>     ULONG                       <a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o4">NotifyType</a>; 
<a name="l00620"></a><a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o5">00620</a>     <a class="code" href="../../d1/d2/cmp_8h.html#a174">PCM_POST_BLOCK_UNION</a>        <a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html#o5">u</a>;
00621 } <a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html">CM_POST_BLOCK</a>, *<a class="code" href="../../d4/d6/struct__CM__POST__BLOCK.html">PCM_POST_BLOCK</a>;
00622 
<a name="l00623"></a><a class="code" href="../../d1/d2/cmp_8h.html#a86">00623</a> <span class="preprocessor">#define REG_NOTIFY_POST_TYPE_MASK (0x0000FFFFL)   // mask for finding out the type of the post block</span>
00624 <span class="preprocessor"></span>
<a name="l00625"></a><a class="code" href="../../d1/d2/cmp_8h.html#a87">00625</a> <span class="preprocessor">#define REG_NOTIFY_MASTER_POST    (0x00010000L)   // The current post block is a master one</span>
00626 <span class="preprocessor"></span>
00627 <span class="comment">//</span>
00628 <span class="comment">// Usefull macros to manipulate the NotifyType field in CM_POST_BLOCK</span>
00629 <span class="comment">//</span>
<a name="l00630"></a><a class="code" href="../../d1/d2/cmp_8h.html#a88">00630</a> <span class="preprocessor">#define PostBlockType(_post_) ((POST_BLOCK_TYPE)( ((_post_)-&gt;NotifyType) &amp; REG_NOTIFY_POST_TYPE_MASK ))</span>
00631 <span class="preprocessor"></span>
<a name="l00632"></a><a class="code" href="../../d1/d2/cmp_8h.html#a89">00632</a> <span class="preprocessor">#define IsMasterPostBlock(_post_)           ( ((_post_)-&gt;NotifyType) &amp;   REG_NOTIFY_MASTER_POST )</span>
<a name="l00633"></a><a class="code" href="../../d1/d2/cmp_8h.html#a90">00633</a> <span class="preprocessor"></span><span class="preprocessor">#define SetMasterPostBlockFlag(_post_)      ( ((_post_)-&gt;NotifyType) |=  REG_NOTIFY_MASTER_POST )</span>
<a name="l00634"></a><a class="code" href="../../d1/d2/cmp_8h.html#a91">00634</a> <span class="preprocessor"></span><span class="preprocessor">#define ClearMasterPostBlockFlag(_post_)    ( ((_post_)-&gt;NotifyType) &amp;= ~REG_NOTIFY_MASTER_POST )</span>
00635 <span class="preprocessor"></span>
00636 <span class="comment">//</span>
00637 <span class="comment">// This lock protects the PostList(s) in Notification objects.</span>
00638 <span class="comment">// It is used to prevent attempts for simultaneous changes of </span>
00639 <span class="comment">// CancelPostList list in PostBlocks</span>
00640 <span class="comment">//</span>
00641 
<a name="l00642"></a><a class="code" href="../../d1/d2/cmp_8h.html#a177">00642</a> <span class="keyword">extern</span> <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="code" href="../../d1/d2/cmp_8h.html#a177">CmpPostLock</a>;
<a name="l00643"></a><a class="code" href="../../d1/d2/cmp_8h.html#a92">00643</a> <span class="preprocessor">#define LOCK_POST_LIST() ExAcquireFastMutexUnsafe(&amp;CmpPostLock)</span>
<a name="l00644"></a><a class="code" href="../../d1/d2/cmp_8h.html#a93">00644</a> <span class="preprocessor"></span><span class="preprocessor">#define UNLOCK_POST_LIST() ExReleaseFastMutexUnsafe(&amp;CmpPostLock)</span>
00645 <span class="preprocessor"></span>
00646 <span class="comment">// ----- Cm version of Hive structure (CMHIVE) -----</span>
00647 <span class="comment">//</span>
<a name="l00648"></a><a class="code" href="../../d9/d6/struct__CMHIVE.html">00648</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d6/struct__CMHIVE.html">_CMHIVE</a> {
<a name="l00649"></a><a class="code" href="../../d9/d6/struct__CMHIVE.html#o0">00649</a>     <a class="code" href="../../d7/d7/struct__HHIVE.html">HHIVE</a>           <a class="code" href="../../d9/d6/struct__CMHIVE.html#o0">Hive</a>;
<a name="l00650"></a><a class="code" href="../../d9/d6/struct__CMHIVE.html#o1">00650</a>     HANDLE          <a class="code" href="../../d9/d6/struct__CMHIVE.html#o1">FileHandles</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a42">HFILE_TYPE_MAX</a>];
<a name="l00651"></a><a class="code" href="../../d9/d6/struct__CMHIVE.html#o2">00651</a>     LIST_ENTRY      <a class="code" href="../../d9/d6/struct__CMHIVE.html#o2">NotifyList</a>;
<a name="l00652"></a><a class="code" href="../../d9/d6/struct__CMHIVE.html#o3">00652</a>     LIST_ENTRY      <a class="code" href="../../d9/d6/struct__CMHIVE.html#o3">HiveList</a>;           <span class="comment">// Used to find hives at shutdown</span>
<a name="l00653"></a><a class="code" href="../../d9/d6/struct__CMHIVE.html#o4">00653</a>     <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a>     <a class="code" href="../../d9/d6/struct__CMHIVE.html#o4">HiveLock</a>;           <span class="comment">// Used to synchronize operations on the hive (NotifyList and Flush)</span>
00654 } <a class="code" href="../../d9/d6/struct__CMHIVE.html">CMHIVE</a>, *<a class="code" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a>;
00655 
00656 <span class="comment">//</span>
00657 <span class="comment">// Hive locking support</span>
00658 <span class="comment">//</span>
00659 <span class="comment">//</span>
<a name="l00660"></a><a class="code" href="../../d1/d2/cmp_8h.html#a94">00660</a> <span class="preprocessor">#define CmLockHive(_hive_)  ASSERT( (_hive_)-&gt;HiveLock );\</span>
00661 <span class="preprocessor">                            ExAcquireFastMutexUnsafe((_hive_)-&gt;HiveLock)</span>
<a name="l00662"></a><a class="code" href="../../d1/d2/cmp_8h.html#a95">00662</a> <span class="preprocessor"></span><span class="preprocessor">#define CmUnlockHive(_hive_) ASSERT( (_hive_)-&gt;HiveLock );\</span>
00663 <span class="preprocessor">                             ExReleaseFastMutexUnsafe((_hive_)-&gt;HiveLock)</span>
00664 <span class="preprocessor"></span>
00665 
00666 <span class="comment">//</span>
00667 <span class="comment">// Macros</span>
00668 <span class="comment">//</span>
00669 
00670 <span class="comment">//</span>
00671 <span class="comment">// ----- CM_KEY_NODE -----</span>
00672 <span class="comment">//</span>
<a name="l00673"></a><a class="code" href="../../d1/d2/cmp_8h.html#a96">00673</a> <span class="preprocessor">#define CmpHKeyNameLen(Key) \</span>
00674 <span class="preprocessor">        (((Key)-&gt;Flags &amp; KEY_COMP_NAME) ? \</span>
00675 <span class="preprocessor">            CmpCompressedNameSize((Key)-&gt;Name,(Key)-&gt;NameLength) : \</span>
00676 <span class="preprocessor">            (Key)-&gt;NameLength)</span>
00677 <span class="preprocessor"></span>
<a name="l00678"></a><a class="code" href="../../d1/d2/cmp_8h.html#a97">00678</a> <span class="preprocessor">#define CmpNcbNameLen(Ncb) \</span>
00679 <span class="preprocessor">        (((Ncb)-&gt;Compressed) ? \</span>
00680 <span class="preprocessor">            CmpCompressedNameSize((Ncb)-&gt;Name,(Ncb)-&gt;NameLength) : \</span>
00681 <span class="preprocessor">            (Ncb)-&gt;NameLength)</span>
00682 <span class="preprocessor"></span>
<a name="l00683"></a><a class="code" href="../../d1/d2/cmp_8h.html#a98">00683</a> <span class="preprocessor">#define CmpHKeyNodeSize(Hive, KeyName) \</span>
00684 <span class="preprocessor">    (FIELD_OFFSET(CM_KEY_NODE, Name) + CmpNameSize(Hive, KeyName))</span>
00685 <span class="preprocessor"></span>
00686 
00687 <span class="comment">//</span>
00688 <span class="comment">// ----- CM_KEY_VALUE -----</span>
00689 <span class="comment">//</span>
00690 
00691 
<a name="l00692"></a><a class="code" href="../../d1/d2/cmp_8h.html#a99">00692</a> <span class="preprocessor">#define CmpValueNameLen(Value)                                       \</span>
00693 <span class="preprocessor">        (((Value)-&gt;Flags &amp; VALUE_COMP_NAME) ?                           \</span>
00694 <span class="preprocessor">            CmpCompressedNameSize((Value)-&gt;Name,(Value)-&gt;NameLength) :  \</span>
00695 <span class="preprocessor">            (Value)-&gt;NameLength)</span>
00696 <span class="preprocessor"></span>
<a name="l00697"></a><a class="code" href="../../d1/d2/cmp_8h.html#a100">00697</a> <span class="preprocessor">#define CmpHKeyValueSize(Hive, ValueName) \</span>
00698 <span class="preprocessor">    (FIELD_OFFSET(CM_KEY_VALUE, Name) + CmpNameSize(Hive, ValueName))</span>
00699 <span class="preprocessor"></span>
00700 
00701 <span class="comment">//</span>
00702 <span class="comment">// Communication area</span>
00703 <span class="comment">//</span>
00704 <span class="comment">//</span>
00705 <span class="comment">//  Protocol (server side):</span>
00706 <span class="comment">//      Wait for StartRegistryCommand event</span>
00707 <span class="comment">//      read message, do work</span>
00708 <span class="comment">//      signal EndRegistryCommand event</span>
00709 <span class="comment">//</span>
00710 <span class="comment">//  Protocal (client side):</span>
00711 <span class="comment">//      Acquire RegistryCommandMutex</span>
00712 <span class="comment">//      write message</span>
00713 <span class="comment">//      signal StartRegistryCommand</span>
00714 <span class="comment">//      wait for EndRegistryCommand</span>
00715 <span class="comment">//      Release RegistryCommandMutex</span>
00716 <span class="comment">//</span>
00717 
00718 
<a name="l00719"></a><a class="code" href="../../d1/d2/cmp_8h.html#a101">00719</a> <span class="preprocessor">#define REG_CMD_INIT                1</span>
<a name="l00720"></a><a class="code" href="../../d1/d2/cmp_8h.html#a102">00720</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_CMD_FLUSH_KEY           2</span>
<a name="l00721"></a><a class="code" href="../../d1/d2/cmp_8h.html#a103">00721</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_CMD_FILE_SET_SIZE       3</span>
<a name="l00722"></a><a class="code" href="../../d1/d2/cmp_8h.html#a104">00722</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_CMD_HIVE_OPEN           4</span>
<a name="l00723"></a><a class="code" href="../../d1/d2/cmp_8h.html#a105">00723</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_CMD_HIVE_CLOSE          5</span>
<a name="l00724"></a><a class="code" href="../../d1/d2/cmp_8h.html#a106">00724</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_CMD_SHUTDOWN            6</span>
<a name="l00725"></a><a class="code" href="../../d1/d2/cmp_8h.html#a107">00725</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_CMD_RENAME_HIVE         7</span>
<a name="l00726"></a><a class="code" href="../../d1/d2/cmp_8h.html#a108">00726</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_CMD_ADD_HIVE_LIST       8</span>
<a name="l00727"></a><a class="code" href="../../d1/d2/cmp_8h.html#a109">00727</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_CMD_REMOVE_HIVE_LIST    9</span>
<a name="l00728"></a><a class="code" href="../../d1/d2/cmp_8h.html#a110">00728</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_CMD_REFRESH_HIVE       10</span>
<a name="l00729"></a><a class="code" href="../../d1/d2/cmp_8h.html#a111">00729</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_CMD_HIVE_READ          11</span>
00730 <span class="preprocessor"></span>
00731 <span class="comment">//</span>
00732 <span class="comment">// WARNNOTE:    Why do we have such a random structure?</span>
00733 <span class="comment">//              change this to pass a pointer to a function specific struct</span>
00734 <span class="comment">//</span>
00735 
00736 
<a name="l00737"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html">00737</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html">_REGISTRY_COMMAND</a> {
<a name="l00738"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o0">00738</a>     ULONG       <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o0">Command</a>;
<a name="l00739"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o1">00739</a>     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o1">Hive</a>;
<a name="l00740"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o2">00740</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o2">Cell</a>;
<a name="l00741"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o3">00741</a>     ULONG       <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o3">FileType</a>;
<a name="l00742"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o4">00742</a>     ULONG       <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o4">FileSize</a>;
<a name="l00743"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o5">00743</a>     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o5">Status</a>;
<a name="l00744"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o6">00744</a>     POBJECT_ATTRIBUTES <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o6">FileAttributes</a>;
<a name="l00745"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o7">00745</a>     <a class="code" href="../../d1/d2/cmp_8h.html#a179">PCMHIVE</a>     <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o7">CmHive</a>;
<a name="l00746"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o8">00746</a>     PVOID       <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o8">Buffer</a>;
<a name="l00747"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o9">00747</a>     PVOID       <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o9">Offset</a>;
<a name="l00748"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o10">00748</a>     BOOLEAN     <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o10">Allocate</a>;
<a name="l00749"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o11">00749</a>     BOOLEAN     <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o11">SetupBoot</a>;
<a name="l00750"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o12">00750</a>     BOOLEAN     <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o12">RegistryLockAquired</a>;    <span class="comment">// needed to avoid recursivity deadlock with ZwCreate calls calling back into registry</span>
<a name="l00751"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o13">00751</a>     PUNICODE_STRING <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o13">NewName</a>;
<a name="l00752"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o14">00752</a>     POBJECT_NAME_INFORMATION <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o14">OldName</a>;
<a name="l00753"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o15">00753</a>     ULONG <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o15">NameInfoLength</a>;
<a name="l00754"></a><a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o16">00754</a>     <a class="code" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a> <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html#o16">ImpersonationContext</a>;
00755 } <a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html">REGISTRY_COMMAND</a>, *<a class="code" href="../../d4/d3/struct__REGISTRY__COMMAND.html">PREGISTRY_COMMAND</a>;
00756 
00757 
00758 <span class="comment">//</span>
00759 <span class="comment">// ----- Procedure Prototypes -----</span>
00760 <span class="comment">//</span>
00761 
00762 <span class="comment">//</span>
00763 <span class="comment">// Configuration Manager private procedure prototypes</span>
00764 <span class="comment">//</span>
00765 
<a name="l00766"></a><a class="code" href="../../d1/d2/cmp_8h.html#a112">00766</a> <span class="preprocessor">#define REG_OPTION_PREDEF_HANDLE (0x00000008L)</span>
<a name="l00767"></a><a class="code" href="../../d1/d2/cmp_8h.html#a113">00767</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_PREDEF_HANDLE_MASK   (0x80000000L)</span>
00768 <span class="preprocessor"></span>
<a name="l00769"></a><a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html">00769</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html">_CM_PARSE_CONTEXT</a> {
<a name="l00770"></a><a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o0">00770</a>     ULONG               <a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o0">TitleIndex</a>;
<a name="l00771"></a><a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o1">00771</a>     UNICODE_STRING      <a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o1">Class</a>;
<a name="l00772"></a><a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o2">00772</a>     ULONG               <a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o2">CreateOptions</a>;
<a name="l00773"></a><a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o3">00773</a>     ULONG               <a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o3">Disposition</a>;
<a name="l00774"></a><a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o4">00774</a>     BOOLEAN             <a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o4">CreateLink</a>;
<a name="l00775"></a><a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o5">00775</a>     <a class="code" href="../../d5/d5/struct__CM__KEY__REFERENCE.html">CM_KEY_REFERENCE</a>    <a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o5">ChildHive</a>;
<a name="l00776"></a><a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o6">00776</a>     HANDLE              <a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html#o6">PredefinedHandle</a>;
00777 } <a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html">CM_PARSE_CONTEXT</a>, *<a class="code" href="../../d3/d6/struct__CM__PARSE__CONTEXT.html">PCM_PARSE_CONTEXT</a>;
00778 
00779 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00780 <a class="code" href="../../d2/d2/cmparse_8c.html#a20">CmpParseKey</a>(
00781     IN PVOID ParseObject,
00782     IN PVOID ObjectType,
00783     IN OUT <a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState,
00784     IN KPROCESSOR_MODE AccessMode,
00785     IN ULONG Attributes,
00786     IN OUT PUNICODE_STRING CompleteName,
00787     IN OUT PUNICODE_STRING RemainingName,
00788     IN OUT PVOID Context OPTIONAL,
00789     IN PSECURITY_QUALITY_OF_SERVICE SecurityQos OPTIONAL,
00790     OUT PVOID *Object
00791     );
00792 
00793 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00794 <a class="code" href="../../d3/d2/cmparse2_8c.html#a1">CmpDoCreate</a>(
00795     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
00796     IN HCELL_INDEX Cell,
00797     IN <a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState,
00798     IN PUNICODE_STRING Name,
00799     IN KPROCESSOR_MODE AccessMode,
00800     IN PCM_PARSE_CONTEXT Context,
00801     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> ParentKcb,
00802     OUT PVOID *Object
00803     );
00804 
00805 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00806 <a class="code" href="../../d3/d2/cmparse2_8c.html#a2">CmpDoCreateChild</a>(
00807     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
00808     IN HCELL_INDEX ParentCell,
00809     IN PSECURITY_DESCRIPTOR ParentDescriptor OPTIONAL,
00810     IN <a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState,
00811     IN PUNICODE_STRING Name,
00812     IN KPROCESSOR_MODE AccessMode,
00813     IN PCM_PARSE_CONTEXT Context,
00814     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> ParentKcb,
00815     IN USHORT Flags,
00816     OUT PHCELL_INDEX KeyCell,
00817     OUT PVOID *Object
00818     );
00819 
00820 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00821 <a class="code" href="../../d5/d2/cmquery_8c.html#a0">CmpQueryKeyName</a>(
00822     IN PVOID Object,
00823     IN BOOLEAN HasObjectName,
00824     OUT POBJECT_NAME_INFORMATION ObjectNameInfo,
00825     IN ULONG Length,
00826     OUT PULONG ReturnLength
00827     );
00828 
00829 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00830 <a class="code" href="../../d1/d2/cmp_8h.html#a212">CmpDeleteKeyObject</a>(
00831     IN PVOID Object
00832     );
00833 
00834 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00835 <a class="code" href="../../d1/d2/cmp_8h.html#a213">CmpCloseKeyObject</a>(
00836     IN <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process OPTIONAL,
00837     IN PVOID Object,
00838     IN ACCESS_MASK GrantedAccess,
00839     IN ULONG ProcessHandleCount,
00840     IN ULONG SystemHandleCount
00841     );
00842 
00843 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00844 <a class="code" href="../../d7/d2/cmse_8c.html#a9">CmpSecurityMethod</a> (
00845     IN PVOID Object,
00846     IN <a class="code" href="../../d0/d5/se_8h.html#a19">SECURITY_OPERATION_CODE</a> OperationCode,
00847     IN PSECURITY_INFORMATION SecurityInformation,
00848     IN OUT PSECURITY_DESCRIPTOR SecurityDescriptor,
00849     IN OUT PULONG CapturedLength,
00850     IN OUT PSECURITY_DESCRIPTOR *ObjectsSecurityDescriptor,
00851     IN POOL_TYPE PoolType,
00852     IN PGENERIC_MAPPING GenericMapping
00853     );
00854 
<a name="l00855"></a><a class="code" href="../../d1/d2/cmp_8h.html#a114">00855</a> <span class="preprocessor">#define KCB_WORKER_CONTINUE     0</span>
<a name="l00856"></a><a class="code" href="../../d1/d2/cmp_8h.html#a115">00856</a> <span class="preprocessor"></span><span class="preprocessor">#define KCB_WORKER_DONE         1</span>
<a name="l00857"></a><a class="code" href="../../d1/d2/cmp_8h.html#a116">00857</a> <span class="preprocessor"></span><span class="preprocessor">#define KCB_WORKER_DELETE       2</span>
00858 <span class="preprocessor"></span>
00859 <span class="keyword">typedef</span>
00860 ULONG
<a name="l00861"></a><a class="code" href="../../d1/d2/cmp_8h.html#a184">00861</a> (*PKCB_WORKER_ROUTINE) (
00862     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> Current,
00863     PVOID                 <a class="code" href="../../d3/d1/threads_8h.html#a107">Context1</a>,
00864     PVOID                 <a class="code" href="../../d3/d1/threads_8h.html#a108">Context2</a>
00865     );
00866 
00867 
00868 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00869 <a class="code" href="../../d8/d2/cmsubs_8c.html#a21">CmpSearchKeyControlBlockTree</a>(
00870     <a class="code" href="../../d1/d2/cmp_8h.html#a184">PKCB_WORKER_ROUTINE</a> WorkerRoutine,
00871     PVOID               Context1,
00872     PVOID               Context2
00873     );
00874 
00875 <span class="comment">//</span>
00876 <span class="comment">// Wrappers</span>
00877 <span class="comment">//</span>
00878 
00879 PVOID
00880 <a class="code" href="../../d7/d3/cmwrapr_8c.html#a11">CmpAllocate</a>(
00881     ULONG   Size,
00882     BOOLEAN UseForIo
00883     );
00884 
00885 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00886 <a class="code" href="../../d7/d3/cmwrapr_8c.html#a12">CmpFree</a>(
00887     PVOID   MemoryBlock,
00888     ULONG   GlobalQuotaSize
00889     );
00890 
00891 BOOLEAN
00892 <a class="code" href="../../d6/d3/cmwraper_8c.html#a29">CmpFileSetSize</a>(
00893     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00894     ULONG       FileType,
00895     ULONG       FileSize
00896     );
00897 
00898 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00899 <a class="code" href="../../d7/d3/cmwrapr_8c.html#a13">CmpDoFileSetSize</a>(
00900     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00901     ULONG       FileType,
00902     ULONG       FileSize
00903     );
00904 
00905 BOOLEAN
00906 <a class="code" href="../../d7/d3/cmwrapr_8c.html#a16">CmpFileWrite</a>(
00907     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00908     ULONG       FileType,
00909     <a class="code" href="../../d0/d1/hivedata_8h.html#a66">PCMP_OFFSET_ARRAY</a> offsetArray,
00910     ULONG offsetArrayCount,
00911     PULONG      FileOffset
00912     );
00913 
00914 BOOLEAN
00915 <a class="code" href="../../d7/d3/cmwrapr_8c.html#a15">CmpFileRead</a> (
00916     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00917     ULONG       FileType,
00918     PULONG      FileOffset,
00919     PVOID       DataBuffer,
00920     ULONG       DataLength
00921     );
00922 
00923 BOOLEAN
00924 <a class="code" href="../../d7/d3/cmwrapr_8c.html#a17">CmpFileFlush</a> (
00925     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00926     ULONG       FileType
00927     );
00928 
00929 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00930 <a class="code" href="../../d7/d3/cmwrapr_8c.html#a14">CmpCreateEvent</a>(
00931     IN EVENT_TYPE  eventType,
00932     OUT PHANDLE eventHandle,
00933     OUT <a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a> *event
00934     );
00935 
00936 
00937 <span class="comment">//</span>
00938 <span class="comment">// Configuration Manager CM level registry functions</span>
00939 <span class="comment">//</span>
00940 
00941 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00942 <a class="code" href="../../d1/d2/cmp_8h.html#a224">CmDeleteKey</a>(
00943     IN PCM_KEY_BODY KeyBody
00944     );
00945 
00946 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00947 <a class="code" href="../../d1/d2/cmp_8h.html#a225">CmDeleteValueKey</a>(
00948     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
00949     IN UNICODE_STRING ValueName
00950     );
00951 
00952 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00953 <a class="code" href="../../d1/d2/cmp_8h.html#a226">CmEnumerateKey</a>(
00954     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
00955     IN ULONG Index,
00956     IN KEY_INFORMATION_CLASS KeyInformationClass,
00957     IN PVOID KeyInformation,
00958     IN ULONG Length,
00959     IN PULONG ResultLength
00960     );
00961 
00962 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00963 <a class="code" href="../../d1/d2/cmp_8h.html#a227">CmEnumerateValueKey</a>(
00964     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
00965     IN ULONG Index,
00966     IN KEY_VALUE_INFORMATION_CLASS KeyValueInformationClass,
00967     IN PVOID KeyValueInformation,
00968     IN ULONG Length,
00969     IN PULONG ResultLength
00970     );
00971 
00972 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00973 <a class="code" href="../../d1/d2/cmp_8h.html#a228">CmFlushKey</a>(
00974     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
00975     IN HCELL_INDEX Cell
00976     );
00977 
00978 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00979 <a class="code" href="../../d1/d2/cmp_8h.html#a229">CmQueryKey</a>(
00980     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
00981     IN KEY_INFORMATION_CLASS KeyInformationClass,
00982     IN PVOID KeyInformation,
00983     IN ULONG Length,
00984     IN PULONG ResultLength
00985     );
00986 
00987 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00988 <a class="code" href="../../d1/d2/cmp_8h.html#a230">CmQueryValueKey</a>(
00989     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
00990     IN UNICODE_STRING ValueName,
00991     IN KEY_VALUE_INFORMATION_CLASS KeyValueInformationClass,
00992     IN PVOID KeyValueInformation,
00993     IN ULONG Length,
00994     IN PULONG ResultLength
00995     );
00996 
00997 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00998 <a class="code" href="../../d1/d2/cmp_8h.html#a231">CmQueryMultipleValueKey</a>(
00999     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
01000     IN PKEY_VALUE_ENTRY ValueEntries,
01001     IN ULONG EntryCount,
01002     IN PVOID ValueBuffer,
01003     IN OUT PULONG BufferLength,
01004     IN OPTIONAL PULONG ResultLength
01005     );
01006 
01007 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01008 <a class="code" href="../../d1/d2/cmp_8h.html#a232">CmRenameValueKey</a>(
01009     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
01010     IN UNICODE_STRING SourceValueName,
01011     IN UNICODE_STRING TargetValueName,
01012     IN ULONG TargetIndex
01013     );
01014 
01015 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01016 <a class="code" href="../../d1/d2/cmp_8h.html#a233">CmReplaceKey</a>(
01017     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01018     IN HCELL_INDEX Cell,
01019     IN PUNICODE_STRING NewHiveName,
01020     IN PUNICODE_STRING OldFileName
01021     );
01022 
01023 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01024 <a class="code" href="../../d6/d2/cmsavres_8c.html#a14">CmRestoreKey</a>(
01025     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
01026     IN HANDLE  FileHandle,
01027     IN ULONG Flags
01028     );
01029 
01030 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01031 <a class="code" href="../../d6/d2/cmsavres_8c.html#a15">CmSaveKey</a>(
01032     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
01033     IN HANDLE  FileHandle
01034     );
01035 
01036 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01037 <a class="code" href="../../d6/d2/cmsavres_8c.html#a16">CmSaveMergedKeys</a>(
01038     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>    HighPrecedenceKcb,
01039     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>    LowPrecedenceKcb,
01040     IN HANDLE   FileHandle
01041     );
01042 
01043 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01044 <a class="code" href="../../d1/d2/cmp_8h.html#a237">CmSetValueKey</a>(
01045     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
01046     IN PUNICODE_STRING ValueName,
01047     IN ULONG Type,
01048     IN PVOID Data,
01049     IN ULONG DataSize
01050     );
01051 
01052 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01053 <a class="code" href="../../d1/d2/cmp_8h.html#a238">CmSetLastWriteTimeKey</a>(
01054     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
01055     IN PLARGE_INTEGER LastWriteTime
01056     );
01057 
01058 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01059 <a class="code" href="../../d1/d2/cmp_8h.html#a239">CmpNotifyChangeKey</a>(
01060     IN PCM_KEY_BODY     KeyBody,
01061     IN PCM_POST_BLOCK   PostBlock,
01062     IN ULONG            CompletionFilter,
01063     IN BOOLEAN          WatchTree,
01064     IN PVOID            Buffer,
01065     IN ULONG            BufferSize,
01066     IN PCM_POST_BLOCK   MasterPostBlock
01067     );
01068 
01069 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01070 <a class="code" href="../../d1/d2/cmp_8h.html#a240">CmLoadKey</a>(
01071     IN POBJECT_ATTRIBUTES TargetKey,
01072     IN POBJECT_ATTRIBUTES SourceFile,
01073     IN ULONG Flags
01074     );
01075 
01076 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01077 <a class="code" href="../../d1/d2/cmp_8h.html#a241">CmUnloadKey</a>(
01078     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01079     IN HCELL_INDEX Cell,
01080     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> Kcb
01081     );
01082 
01083 <span class="comment">//</span>
01084 <span class="comment">// Procedures private to CM</span>
01085 <span class="comment">//</span>
01086 
01087 BOOLEAN
01088 <a class="code" href="../../d3/d3/cmtredel_8c.html#a2">CmpMarkKeyDirty</a>(
01089     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01090     HCELL_INDEX Cell
01091     );
01092 
01093 BOOLEAN
01094 <a class="code" href="../../d1/d2/cmp_8h.html#a243">CmpDoFlushAll</a>(
01095     VOID
01096     );
01097 
<a name="l01098"></a><a class="code" href="../../d1/d2/cmp_8h.html#a185">01098</a> <span class="keyword">extern</span> BOOLEAN <a class="code" href="../../d1/d2/cmp_8h.html#a185">CmpLazyFlushPending</a>;
01099 
01100 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01101 <a class="code" href="../../d6/d3/cmwraper_8c.html#a11">CmpLazyFlush</a>(
01102     VOID
01103     );
01104 
01105 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01106 <a class="code" href="../../d1/d2/cmp_8h.html#a245">CmpQuotaWarningWorker</a>(
01107     IN PVOID WorkItem
01108     );
01109 
01110 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01111 <a class="code" href="../../d1/d2/cmp_8h.html#a246">CmpComputeGlobalQuotaAllowed</a>(
01112     VOID
01113     );
01114 
01115 BOOLEAN
01116 <a class="code" href="../../d1/d2/cmp_8h.html#a247">CmpClaimGlobalQuota</a>(
01117     IN ULONG    Size
01118     );
01119 
01120 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01121 <a class="code" href="../../d1/d2/cmp_8h.html#a248">CmpReleaseGlobalQuota</a>(
01122     IN ULONG    Size
01123     );
01124 
01125 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01126 <a class="code" href="../../d1/d2/cmp_8h.html#a249">CmpSetGlobalQuotaAllowed</a>(
01127     VOID
01128     );
01129 
01130 <span class="comment">//</span>
01131 <span class="comment">// security functions (cmse.c)</span>
01132 <span class="comment">//</span>
01133 
01134 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01135 <a class="code" href="../../d7/d2/cmse_8c.html#a10">CmpAssignSecurityDescriptor</a>(
01136     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01137     IN HCELL_INDEX Cell,
01138     IN <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a> Node,
01139     IN PSECURITY_DESCRIPTOR SecurityDescriptor
01140     );
01141 
01142 BOOLEAN
01143 <a class="code" href="../../d7/d2/cmse_8c.html#a11">CmpCheckCreateAccess</a>(
01144     IN PUNICODE_STRING RelativeName,
01145     IN PSECURITY_DESCRIPTOR Descriptor,
01146     IN <a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState,
01147     IN KPROCESSOR_MODE PreviousMode,
01148     IN ACCESS_MASK AdditionalAccess,
01149     OUT PNTSTATUS AccessStatus
01150     );
01151 
01152 BOOLEAN
01153 <a class="code" href="../../d7/d2/cmse_8c.html#a12">CmpCheckNotifyAccess</a>(
01154     IN PCM_NOTIFY_BLOCK NotifyBlock,
01155     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01156     IN <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a> Node
01157     );
01158 
01159 PSECURITY_DESCRIPTOR
01160 <a class="code" href="../../d7/d2/cmse_8c.html#a13">CmpHiveRootSecurityDescriptor</a>(
01161     VOID
01162     );
01163 
01164 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01165 <a class="code" href="../../d6/d3/cmwraper_8c.html#a12">CmpFreeSecurityDescriptor</a>(
01166     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01167     IN HCELL_INDEX Cell
01168     );
01169 
01170 
01171 <span class="comment">//</span>
01172 <span class="comment">// Access to the registry is serialized by a shared resource, CmpRegistryLock.</span>
01173 <span class="comment">//</span>
<a name="l01174"></a><a class="code" href="../../d1/d2/cmp_8h.html#a186">01174</a> <span class="keyword">extern</span> <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d1/d2/cmp_8h.html#a186">CmpRegistryLock</a>;
01175 
01176 <span class="preprocessor">#if 0</span>
01177 <span class="preprocessor"></span><span class="preprocessor">#define CmpLockRegistry() KeEnterCriticalRegion(); \</span>
01178 <span class="preprocessor">                          ExAcquireResourceShared(&amp;CmpRegistryLock, TRUE)</span>
01179 <span class="preprocessor"></span>
01180 <span class="preprocessor">#define CmpLockRegistryExclusive() KeEnterCriticalRegion(); \</span>
01181 <span class="preprocessor">                                   ExAcquireResourceExclusive(&amp;CmpRegistryLock,TRUE)</span>
01182 <span class="preprocessor"></span>
01183 <span class="preprocessor">#else</span>
01184 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01185 <a class="code" href="../../d0/d3/cmsubs3_8c.html#a4">CmpLockRegistryExclusive</a>(
01186     VOID
01187     );
01188 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01189 <a class="code" href="../../d6/d3/cmwraper_8c.html#a14">CmpLockRegistry</a>(
01190     VOID
01191     );
01192 <span class="preprocessor">#endif</span>
01193 <span class="preprocessor"></span>BOOLEAN
01194 <a class="code" href="../../d1/d3/cmsysini_8c.html#a57">CmpIsLastKnownGoodBoot</a>(
01195     VOID
01196     );
01197 
01198 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01199 <a class="code" href="../../d1/d2/cmp_8h.html#a258">CmpUnlockRegistry</a>(
01200     );
01201 
01202 <span class="preprocessor">#if DBG</span>
01203 <span class="preprocessor"></span>BOOLEAN
01204 <a class="code" href="../../d6/d3/cmwraper_8c.html#a17">CmpTestRegistryLock</a>(
01205     VOID
01206     );
01207 BOOLEAN
01208 <a class="code" href="../../d6/d3/cmwraper_8c.html#a18">CmpTestRegistryLockExclusive</a>(
01209     VOID
01210     );
01211 <span class="preprocessor">#endif</span>
01212 <span class="preprocessor"></span>
01213 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01214 <a class="code" href="../../d9/d2/cmsubs2_8c.html#a4">CmpQueryKeyData</a>(
01215     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01216     <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a> Node,
01217     KEY_INFORMATION_CLASS KeyInformationClass,
01218     PVOID KeyInformation,
01219     ULONG Length,
01220     PULONG ResultLength
01221     );
01222 
01223 
01224 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01225 <a class="code" href="../../d8/d2/cmsubs_8c.html#a25">CmpFreeKeyBody</a>(
01226     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01227     HCELL_INDEX Cell
01228     );
01229 
01230 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01231 <a class="code" href="../../d9/d2/cmsubs2_8c.html#a3">CmpFreeValue</a>(
01232     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01233     HCELL_INDEX Cell
01234     );
01235 
01236 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
01237 <a class="code" href="../../d1/d2/cmp_8h.html#a117">CmpFindValueByName</a>(
01238     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01239     <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a> KeyNode,
01240     PUNICODE_STRING Name
01241     );
01242 
<a name="l01243"></a><a class="code" href="../../d1/d2/cmp_8h.html#a117">01243</a> <span class="preprocessor">#define CmpFindValueByName(h,k,n) CmpFindNameInList(h,&amp;((k)-&gt;ValueList),n,NULL,NULL)</span>
01244 <span class="preprocessor"></span>
01245 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01246 <a class="code" href="../../d1/d2/cmp_8h.html#a263">CmpDeleteChildByName</a>(
01247     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
01248     HCELL_INDEX Cell,
01249     UNICODE_STRING  Name,
01250     PHCELL_INDEX    ChildCell
01251     );
01252 
01253 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01254 <a class="code" href="../../d3/d3/cmtredel_8c.html#a1">CmpFreeKeyByCell</a>(
01255     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01256     HCELL_INDEX Cell,
01257     BOOLEAN Unlink
01258     );
01259 
01260 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
01261 <a class="code" href="../../d4/d3/cmtree_8c.html#a0">CmpFindNameInList</a>(
01262     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
01263     IN <a class="code" href="../../d7/d9/struct__CHILD__LIST.html">PCHILD_LIST</a> ChildList,
01264     IN PUNICODE_STRING Name,
01265     IN OPTIONAL <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a> *ChildAddress,
01266     IN OPTIONAL PULONG ChildIndex
01267     );
01268 
01269 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
01270 <a class="code" href="../../d2/d3/cmtrecpy_8c.html#a13">CmpCopyCell</a>(
01271     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  SourceHive,
01272     HCELL_INDEX SourceCell,
01273     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  TargetHive,
01274     HSTORAGE_TYPE   Type
01275     );
01276 
01277 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
01278 <a class="code" href="../../d2/d3/cmtrecpy_8c.html#a12">CmpCopyValue</a>(
01279     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  SourceHive,
01280     HCELL_INDEX SourceValueCell,
01281     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  TargetHive,
01282     HSTORAGE_TYPE Type
01283     );
01284 
01285 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
01286 <a class="code" href="../../d2/d3/cmtrecpy_8c.html#a11">CmpCopyKeyPartial</a>(
01287     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  SourceHive,
01288     HCELL_INDEX SourceKeyCell,
01289     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  TargetHive,
01290     HCELL_INDEX Parent,
01291     BOOLEAN CopyValues
01292     );
01293 
01294 BOOLEAN
01295 <a class="code" href="../../d2/d3/cmtrecpy_8c.html#a10">CmpCopySyncTree</a>(
01296     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>                  SourceHive,
01297     HCELL_INDEX             SourceCell,
01298     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>                  TargetHive,
01299     HCELL_INDEX             TargetCell,
01300     BOOLEAN                 CopyVolatile,
01301     CMP_COPY_TYPE           CopyType
01302     );
01303 
01304 <span class="comment">//</span>
01305 <span class="comment">// BOOLEAN</span>
01306 <span class="comment">// CmpCopyTree(</span>
01307 <span class="comment">//    PHHIVE      SourceHive,</span>
01308 <span class="comment">//    HCELL_INDEX SourceCell,</span>
01309 <span class="comment">//    PHHIVE      TargetHive,</span>
01310 <span class="comment">//    HCELL_INDEX TargetCell</span>
01311 <span class="comment">//    );</span>
01312 <span class="comment">//</span>
01313 
<a name="l01314"></a><a class="code" href="../../d1/d2/cmp_8h.html#a118">01314</a> <span class="preprocessor">#define CmpCopyTree(s,c,t,l) CmpCopySyncTree(s,c,t,l,FALSE,Copy)</span>
01315 <span class="preprocessor"></span>
01316 <span class="comment">//</span>
01317 <span class="comment">// BOOLEAN</span>
01318 <span class="comment">// CmpCopyTreeEx(</span>
01319 <span class="comment">//    PHHIVE      SourceHive,</span>
01320 <span class="comment">//    HCELL_INDEX SourceCell,</span>
01321 <span class="comment">//    PHHIVE      TargetHive,</span>
01322 <span class="comment">//    HCELL_INDEX TargetCell,</span>
01323 <span class="comment">//    BOOLEAN     CopyVolatile</span>
01324 <span class="comment">//    );</span>
01325 <span class="comment">//</span>
01326 
<a name="l01327"></a><a class="code" href="../../d1/d2/cmp_8h.html#a119">01327</a> <span class="preprocessor">#define CmpCopyTreeEx(s,c,t,l,f) CmpCopySyncTree(s,c,t,l,f,Copy)</span>
01328 <span class="preprocessor"></span>
01329 <span class="comment">//</span>
01330 <span class="comment">// BOOLEAN</span>
01331 <span class="comment">// CmpSyncTrees(</span>
01332 <span class="comment">//   PHHIVE      SourceHive,</span>
01333 <span class="comment">//   HCELL_INDEX SourceCell,</span>
01334 <span class="comment">//   PHHIVE      TargetHive,</span>
01335 <span class="comment">//   HCELL_INDEX TargetCell,</span>
01336 <span class="comment">//   BOOLEAN     CopyVolatile);</span>
01337 <span class="comment">//</span>
01338 
<a name="l01339"></a><a class="code" href="../../d1/d2/cmp_8h.html#a120">01339</a> <span class="preprocessor">#define CmpSyncTrees(s,c,t,l,f) CmpCopySyncTree(s,c,t,l,f,Sync)</span>
01340 <span class="preprocessor"></span>
01341 
01342 <span class="comment">//</span>
01343 <span class="comment">// BOOLEAN</span>
01344 <span class="comment">// CmpMergeTrees(</span>
01345 <span class="comment">//   PHHIVE      SourceHive,</span>
01346 <span class="comment">//   HCELL_INDEX SourceCell,</span>
01347 <span class="comment">//   PHHIVE      TargetHive,</span>
01348 <span class="comment">//   HCELL_INDEX TargetCell);</span>
01349 <span class="comment">//</span>
01350 
<a name="l01351"></a><a class="code" href="../../d1/d2/cmp_8h.html#a121">01351</a> <span class="preprocessor">#define CmpMergeTrees(s,c,t,l) CmpCopySyncTree(s,c,t,l,FALSE,Merge)</span>
01352 <span class="preprocessor"></span>
01353 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01354 <a class="code" href="../../d3/d3/cmtredel_8c.html#a0">CmpDeleteTree</a>(
01355     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
01356     HCELL_INDEX Cell
01357     );
01358 
01359 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01360 <a class="code" href="../../d1/d3/cmsysini_8c.html#a50">CmpSetVersionData</a>(
01361     VOID
01362     );
01363 
01364 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01365 <a class="code" href="../../d1/d2/cmp_8h.html#a272">CmpInitializeHardwareConfiguration</a>(
01366     IN <a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a> LoaderBlock
01367     );
01368 
01369 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01370 <a class="code" href="../../d6/d1/config_2ppc_2init_8c.html#a0">CmpInitializeMachineDependentConfiguration</a>(
01371     IN <a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a> LoaderBlock
01372     );
01373 
01374 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01375 <a class="code" href="../../d1/d2/cmp_8h.html#a274">CmpInitializeRegistryNode</a>(
01376     IN <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> CurrentEntry,
01377     IN HANDLE ParentHandle,
01378     OUT PHANDLE NewHandle,
01379     IN INTERFACE_TYPE InterfaceType,
01380     IN ULONG BusNumber,
01381     IN PUSHORT DeviceIndexTable
01382     );
01383 
01384 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01385 <a class="code" href="../../d1/d2/cmp_8h.html#a275">CmpInitializeHive</a>(
01386     PCMHIVE         *CmHive,
01387     ULONG           OperationType,
01388     ULONG           HiveFlags,
01389     ULONG           FileType,
01390     PVOID           HiveData OPTIONAL,
01391     HANDLE          Primary,
01392     HANDLE          Alternate,
01393     HANDLE          Log,
01394     HANDLE          External,
01395     PUNICODE_STRING FileName
01396     );
01397 
01398 BOOLEAN
01399 <a class="code" href="../../d1/d2/cmp_8h.html#a276">CmpDestroyHive</a>(
01400     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01401     IN HCELL_INDEX Cell
01402     );
01403 
01404 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01405 <a class="code" href="../../d1/d2/cmp_8h.html#a277">CmpInitializeRegistryNames</a>(
01406     VOID
01407     );
01408 
01409 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01410 <a class="code" href="../../d8/d2/cmsubs_8c.html#a26">CmpInitializeCache</a>(
01411     VOID
01412     );
01413 
01414 <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>
01415 <a class="code" href="../../d8/d2/cmsubs_8c.html#a20">CmpCreateKeyControlBlock</a>(
01416     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
01417     HCELL_INDEX     Cell,
01418     <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a>    Node,
01419     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> ParentKcb,
01420     BOOLEAN FakeKey,
01421     PUNICODE_STRING KeyName
01422     );
01423 
01424 ULONG
01425 <a class="code" href="../../d8/d2/cmsubs_8c.html#a12">CmpSearchForOpenSubKeys</a>(
01426     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> SearchKey,
01427     IN SUBKEY_SEARCH_TYPE SearchType
01428     );
01429 
01430 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01431 <a class="code" href="../../d8/d2/cmsubs_8c.html#a22">CmpDereferenceKeyControlBlock</a>(
01432     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>   KeyControlBlock
01433     );
01434 
01435 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01436 <a class="code" href="../../d8/d2/cmsubs_8c.html#a24">CmpRemoveKeyControlBlock</a>(
01437     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>   KeyControlBlock
01438     );
01439 
01440 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01441 <a class="code" href="../../d6/d3/cmwraper_8c.html#a13">CmpReportNotify</a>(
01442     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> KeyControlBlock,
01443     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
01444     HCELL_INDEX     Cell,
01445     ULONG           NotifyMask
01446     );
01447 
01448 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01449 <a class="code" href="../../d1/d2/cmp_8h.html#a284">CmpPostNotify</a>(
01450     PCM_NOTIFY_BLOCK    NotifyBlock,
01451     PUNICODE_STRING     Name OPTIONAL,
01452     ULONG               Filter,
01453     NTSTATUS            Status,
01454     PLIST_ENTRY         ExternalKeyDeref OPTIONAL
01455     );
01456 
01457 <a class="code" href="../../d1/d2/cmp_8h.html#a176">PCM_POST_BLOCK</a>
01458 <a class="code" href="../../d7/d7/ntapi_8c.html#a37">CmpAllocatePostBlock</a>(
01459     IN POST_BLOCK_TYPE BlockType,
01460     IN ULONG           PostFlags,
01461     IN PCM_KEY_BODY    KeyBody,
01462     IN PCM_POST_BLOCK  MasterBlock 
01463     );
01464 
01465 <span class="comment">//</span>
01466 <span class="comment">//PCM_POST_BLOCK</span>
01467 <span class="comment">//CmpAllocateMasterPostBlock(</span>
01468 <span class="comment">//    IN POST_BLOCK_TYPE BlockType</span>
01469 <span class="comment">//     );</span>
01470 <span class="comment">//</span>
<a name="l01471"></a><a class="code" href="../../d1/d2/cmp_8h.html#a122">01471</a> <span class="preprocessor">#define CmpAllocateMasterPostBlock(b) CmpAllocatePostBlock(b,REG_NOTIFY_MASTER_POST,NULL,NULL)</span>
01472 <span class="preprocessor"></span>
01473 <span class="comment">//</span>
01474 <span class="comment">//PCM_POST_BLOCK</span>
01475 <span class="comment">//CmpAllocateSlavePostBlock(</span>
01476 <span class="comment">//    IN POST_BLOCK_TYPE BlockType,</span>
01477 <span class="comment">//    IN PCM_KEY_BODY     KeyBody,</span>
01478 <span class="comment">//    IN PCM_POST_BLOCK  MasterBlock</span>
01479 <span class="comment">//     );</span>
01480 <span class="comment">//</span>
<a name="l01481"></a><a class="code" href="../../d1/d2/cmp_8h.html#a123">01481</a> <span class="preprocessor">#define CmpAllocateSlavePostBlock(b,k,m) CmpAllocatePostBlock(b,0,k,m)</span>
01482 <span class="preprocessor"></span>
01483 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01484 <a class="code" href="../../d7/d7/ntapi_8c.html#a36">CmpFreePostBlock</a>(
01485     IN PCM_POST_BLOCK PostBlock
01486     );
01487 
01488 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01489 <a class="code" href="../../d1/d2/cmp_8h.html#a287">CmpPostApc</a>(
01490     <span class="keyword">struct</span> <a class="code" href="../../d1/d5/struct__KAPC.html">_KAPC</a> *Apc,
01491     PKNORMAL_ROUTINE *NormalRoutine,
01492     PVOID *NormalContext,
01493     PVOID *SystemArgument1,
01494     PVOID *SystemArgument2
01495     );
01496 
01497 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01498 <a class="code" href="../../d1/d2/cmp_8h.html#a288">CmpFlushNotify</a>(
01499     PCM_KEY_BODY    KeyBody
01500     );
01501 
01502 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01503 <a class="code" href="../../d1/d2/cmp_8h.html#a289">CmpPostApcRunDown</a>(
01504     <span class="keyword">struct</span> <a class="code" href="../../d1/d5/struct__KAPC.html">_KAPC</a> *Apc
01505     );
01506 
01507 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01508 <a class="code" href="../../d1/d2/cmp_8h.html#a290">CmpOpenHiveFiles</a>(
01509     PUNICODE_STRING     BaseName,
01510     PWSTR               Extension OPTIONAL,
01511     PHANDLE             Primary,
01512     PHANDLE             Secondary,
01513     PULONG              PrimaryDisposition,
01514     PULONG              SecondaryDispoition,
01515     BOOLEAN             CreateAllowed,
01516     BOOLEAN             MarkAsSystemHive,
01517     PULONG              ClusterSize
01518     );
01519 
01520 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01521 <a class="code" href="../../d6/d3/cmwraper_8c.html#a28">CmpLinkHiveToMaster</a>(
01522     PUNICODE_STRING LinkName,
01523     HANDLE RootDirectory,
01524     PCMHIVE CmHive,
01525     BOOLEAN Allocate,
01526     PSECURITY_DESCRIPTOR SecurityDescriptor
01527     );
01528 
01529 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01530 <a class="code" href="../../d5/d3/cmworker_8c.html#a20">CmpWorker</a>(
01531     IN OUT PREGISTRY_COMMAND Command
01532     );
01533 
01534 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01535 <a class="code" href="../../d1/d3/cmsysini_8c.html#a54">CmpSaveBootControlSet</a>(
01536      IN USHORT ControlSetNum
01537      );
01538 
01539 <span class="comment">//</span>
01540 <span class="comment">// checkout procedure</span>
01541 <span class="comment">//</span>
01542 
01543 
01544 ULONG
01545 <a class="code" href="../../d1/d2/cmp_8h.html#a294">CmCheckRegistry</a>(
01546     PCMHIVE CmHive,
01547     BOOLEAN Clean
01548     );
01549 
01550 BOOLEAN
01551 <a class="code" href="../../d6/d3/cmwraper_8c.html#a21">CmpValidateHiveSecurityDescriptors</a>(
01552     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive
01553     );
01554 
<a name="l01555"></a><a class="code" href="../../d1/d2/cmp_8h.html#a124">01555</a> <span class="preprocessor">#define SetUsed(Hive, Cell) \</span>
01556 <span class="preprocessor">    {                                               \</span>
01557 <span class="preprocessor">        PCELL_DATA  p;                              \</span>
01558 <span class="preprocessor">        p = HvGetCell(Hive, Cell);                  \</span>
01559 <span class="preprocessor">        CmpUsedStorage += HvGetCellSize(Hive, p);   \</span>
01560 <span class="preprocessor">    }</span>
01561 <span class="preprocessor"></span>
01562 <span class="comment">//</span>
01563 <span class="comment">// cmboot - functions for determining driver load lists</span>
01564 <span class="comment">//</span>
01565 
<a name="l01566"></a><a class="code" href="../../d1/d2/cmp_8h.html#a125">01566</a> <span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_DATABASE L"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\IDConfigDB"</span>
<a name="l01567"></a><a class="code" href="../../d1/d2/cmp_8h.html#a126">01567</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_CCS_HWPROFILE L"\\Registry\\Machine\\System\\CurrentControlSet\\Hardware Profiles"</span>
<a name="l01568"></a><a class="code" href="../../d1/d2/cmp_8h.html#a127">01568</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_CCS_CURRENT L"\\Registry\\Machine\\System\\CurrentControlSet\\Hardware Profiles\\Current"</span>
01569 <span class="preprocessor"></span><span class="comment">//</span>
01570 <span class="comment">// Alias table key names in IDConfigDB</span>
01571 <span class="comment">//</span>
<a name="l01572"></a><a class="code" href="../../d1/d2/cmp_8h.html#a128">01572</a> <span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_ALIAS L"Alias"</span>
<a name="l01573"></a><a class="code" href="../../d1/d2/cmp_8h.html#a129">01573</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_ACPI_ALIAS L"AcpiAlias"</span>
<a name="l01574"></a><a class="code" href="../../d1/d2/cmp_8h.html#a130">01574</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_HARDWARE_PROFILES L"Hardware Profiles"</span>
01575 <span class="preprocessor"></span>
01576 <span class="comment">//</span>
01577 <span class="comment">// Entries in the alias tables (value names)</span>
01578 <span class="comment">//</span>
<a name="l01579"></a><a class="code" href="../../d1/d2/cmp_8h.html#a131">01579</a> <span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_DOCKING_STATE L"DockingState"</span>
<a name="l01580"></a><a class="code" href="../../d1/d2/cmp_8h.html#a132">01580</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_CAPABILITIES L"Capabilities"</span>
<a name="l01581"></a><a class="code" href="../../d1/d2/cmp_8h.html#a133">01581</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_DOCKID L"DockID"</span>
<a name="l01582"></a><a class="code" href="../../d1/d2/cmp_8h.html#a134">01582</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_SERIAL_NUMBER L"SerialNumber"</span>
<a name="l01583"></a><a class="code" href="../../d1/d2/cmp_8h.html#a135">01583</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_ACPI_SERIAL_NUMBER L"AcpiSerialNumber"</span>
<a name="l01584"></a><a class="code" href="../../d1/d2/cmp_8h.html#a136">01584</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_PROFILE_NUMBER L"ProfileNumber"</span>
<a name="l01585"></a><a class="code" href="../../d1/d2/cmp_8h.html#a137">01585</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_ALIASABLE L"Aliasable"</span>
<a name="l01586"></a><a class="code" href="../../d1/d2/cmp_8h.html#a138">01586</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_CLONED L"Cloned"</span>
01587 <span class="preprocessor"></span><span class="comment">//</span>
01588 <span class="comment">// Entries in the profile tables.</span>
01589 <span class="comment">//</span>
<a name="l01590"></a><a class="code" href="../../d1/d2/cmp_8h.html#a139">01590</a> <span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_PRISTINE L"Pristine"</span>
<a name="l01591"></a><a class="code" href="../../d1/d2/cmp_8h.html#a140">01591</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_PREFERENCE_ORDER L"PreferenceOrder"</span>
<a name="l01592"></a><a class="code" href="../../d1/d2/cmp_8h.html#a141">01592</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_FRIENDLY_NAME L"FriendlyName"</span>
<a name="l01593"></a><a class="code" href="../../d1/d2/cmp_8h.html#a142">01593</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_CURRENT_DOCK_INFO L"CurrentDockInfo"</span>
<a name="l01594"></a><a class="code" href="../../d1/d2/cmp_8h.html#a143">01594</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_HW_PROFILE_GUID L"HwProfileGuid"</span>
01595 <span class="preprocessor"></span><span class="comment">//</span>
01596 <span class="comment">// Entries for the root Hardware Profiles key.</span>
01597 <span class="comment">//</span>
<a name="l01598"></a><a class="code" href="../../d1/d2/cmp_8h.html#a144">01598</a> <span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_DOCKED L"Docked"</span>
<a name="l01599"></a><a class="code" href="../../d1/d2/cmp_8h.html#a145">01599</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_UNDOCKED L"Undocked"</span>
<a name="l01600"></a><a class="code" href="../../d1/d2/cmp_8h.html#a146">01600</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HARDWARE_PROFILE_STR_UNKNOWN L"Unknown"</span>
01601 <span class="preprocessor"></span>
01602 <span class="comment">//</span>
01603 <span class="comment">// List structure used in config manager init</span>
01604 <span class="comment">//</span>
01605 
<a name="l01606"></a><a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html">01606</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html">_HIVE_LIST_ENTRY</a> {
<a name="l01607"></a><a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html#o0">01607</a>     PWSTR   <a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html#o0">Name</a>;
<a name="l01608"></a><a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html#o1">01608</a>     PWSTR   <a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html#o1">BaseName</a>;                       <span class="comment">// MACHINE or USER</span>
<a name="l01609"></a><a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html#o2">01609</a>     <a class="code" href="../../d1/d2/cmp_8h.html#a179">PCMHIVE</a> <a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html#o2">CmHive</a>;
<a name="l01610"></a><a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html#o3">01610</a>     ULONG   <a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html#o3">Flags</a>;
01611 } <a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html">HIVE_LIST_ENTRY</a>, *<a class="code" href="../../d9/d7/struct__HIVE__LIST__ENTRY.html">PHIVE_LIST_ENTRY</a>;
01612 
01613 <span class="comment">//</span>
01614 <span class="comment">// structure definitions shared with the boot loader</span>
01615 <span class="comment">// to select the hardware profile.</span>
01616 <span class="comment">//</span>
<a name="l01617"></a><a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html">01617</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html">_CM_HARDWARE_PROFILE</a> {
<a name="l01618"></a><a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html#o0">01618</a>     ULONG   <a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html#o0">NameLength</a>;
<a name="l01619"></a><a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html#o1">01619</a>     PWSTR   <a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html#o1">FriendlyName</a>;
<a name="l01620"></a><a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html#o2">01620</a>     ULONG   <a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html#o2">PreferenceOrder</a>;
<a name="l01621"></a><a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html#o3">01621</a>     ULONG   <a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html#o3">Id</a>;
<a name="l01622"></a><a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html#o4">01622</a>     ULONG   <a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html#o4">Flags</a>;
01623 } <a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html">CM_HARDWARE_PROFILE</a>, *<a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html">PCM_HARDWARE_PROFILE</a>;
01624 
<a name="l01625"></a><a class="code" href="../../d1/d2/cmp_8h.html#a147">01625</a> <span class="preprocessor">#define CM_HP_FLAGS_ALIASABLE  1</span>
<a name="l01626"></a><a class="code" href="../../d1/d2/cmp_8h.html#a148">01626</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HP_FLAGS_TRUE_MATCH 2</span>
<a name="l01627"></a><a class="code" href="../../d1/d2/cmp_8h.html#a149">01627</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HP_FLAGS_PRISTINE   4</span>
<a name="l01628"></a><a class="code" href="../../d1/d2/cmp_8h.html#a150">01628</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_HP_FLAGS_DUPLICATE  8</span>
01629 <span class="preprocessor"></span>
<a name="l01630"></a><a class="code" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html">01630</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html">_CM_HARDWARE_PROFILE_LIST</a> {
<a name="l01631"></a><a class="code" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html#o0">01631</a>     ULONG <a class="code" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html#o0">MaxProfileCount</a>;
<a name="l01632"></a><a class="code" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html#o1">01632</a>     ULONG <a class="code" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html#o1">CurrentProfileCount</a>;
<a name="l01633"></a><a class="code" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html#o2">01633</a>     <a class="code" href="../../d5/d3/struct__CM__HARDWARE__PROFILE.html">CM_HARDWARE_PROFILE</a> <a class="code" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html#o2">Profile</a>[1];
01634 } <a class="code" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html">CM_HARDWARE_PROFILE_LIST</a>, *<a class="code" href="../../d0/d4/struct__CM__HARDWARE__PROFILE__LIST.html">PCM_HARDWARE_PROFILE_LIST</a>;
01635 
<a name="l01636"></a><a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html">01636</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html">_CM_HARDWARE_PROFILE_ALIAS</a> {
<a name="l01637"></a><a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html#o0">01637</a>     ULONG   <a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html#o0">ProfileNumber</a>;
<a name="l01638"></a><a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html#o1">01638</a>     ULONG   <a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html#o1">DockState</a>;
<a name="l01639"></a><a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html#o2">01639</a>     ULONG   <a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html#o2">DockID</a>;
<a name="l01640"></a><a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html#o3">01640</a>     ULONG   <a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html#o3">SerialNumber</a>;
01641 } <a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html">CM_HARDWARE_PROFILE_ALIAS</a>, *<a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html">PCM_HARDWARE_PROFILE_ALIAS</a>;
01642 
<a name="l01643"></a><a class="code" href="../../d9/d3/struct__CM__HARDWARE__PROFILE__ALIAS__LIST.html">01643</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d3/struct__CM__HARDWARE__PROFILE__ALIAS__LIST.html">_CM_HARDWARE_PROFILE_ALIAS_LIST</a> {
<a name="l01644"></a><a class="code" href="../../d9/d3/struct__CM__HARDWARE__PROFILE__ALIAS__LIST.html#o0">01644</a>     ULONG <a class="code" href="../../d9/d3/struct__CM__HARDWARE__PROFILE__ALIAS__LIST.html#o0">MaxAliasCount</a>;
<a name="l01645"></a><a class="code" href="../../d9/d3/struct__CM__HARDWARE__PROFILE__ALIAS__LIST.html#o1">01645</a>     ULONG <a class="code" href="../../d9/d3/struct__CM__HARDWARE__PROFILE__ALIAS__LIST.html#o1">CurrentAliasCount</a>;
<a name="l01646"></a><a class="code" href="../../d9/d3/struct__CM__HARDWARE__PROFILE__ALIAS__LIST.html#o2">01646</a>     <a class="code" href="../../d8/d3/struct__CM__HARDWARE__PROFILE__ALIAS.html">CM_HARDWARE_PROFILE_ALIAS</a> <a class="code" href="../../d9/d3/struct__CM__HARDWARE__PROFILE__ALIAS__LIST.html#o2">Alias</a>[1];
01647 } <a class="code" href="../../d9/d3/struct__CM__HARDWARE__PROFILE__ALIAS__LIST.html">CM_HARDWARE_PROFILE_ALIAS_LIST</a>, *<a class="code" href="../../d9/d3/struct__CM__HARDWARE__PROFILE__ALIAS__LIST.html">PCM_HARDWARE_PROFILE_ALIAS_LIST</a>;
01648 
<a name="l01649"></a><a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html">01649</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html">_CM_HARDWARE_PROFILE_ACPI_ALIAS</a> {
<a name="l01650"></a><a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html#o0">01650</a>     ULONG   <a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html#o0">ProfileNumber</a>;
<a name="l01651"></a><a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html#o1">01651</a>     ULONG   <a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html#o1">DockState</a>;
<a name="l01652"></a><a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html#o2">01652</a>     ULONG   <a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html#o2">SerialLength</a>;
<a name="l01653"></a><a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html#o3">01653</a>     PCHAR   <a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html#o3">SerialNumber</a>;
01654 } <a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html">CM_HARDWARE_PROFILE_ACPI_ALIAS</a>, *<a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html">PCM_HARDWARE_PROFILE_ACPI_ALIAS</a>;
01655 
<a name="l01656"></a><a class="code" href="../../d7/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS__LIST.html">01656</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS__LIST.html">_CM_HARDWARE_PROFILE_ACPI_ALIAS_LIST</a> {
<a name="l01657"></a><a class="code" href="../../d7/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS__LIST.html#o0">01657</a>     ULONG   <a class="code" href="../../d7/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS__LIST.html#o0">MaxAliasCount</a>;
<a name="l01658"></a><a class="code" href="../../d7/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS__LIST.html#o1">01658</a>     ULONG   <a class="code" href="../../d7/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS__LIST.html#o1">CurrentAliasCount</a>;
<a name="l01659"></a><a class="code" href="../../d7/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS__LIST.html#o2">01659</a>     <a class="code" href="../../d6/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS.html">CM_HARDWARE_PROFILE_ACPI_ALIAS</a> <a class="code" href="../../d7/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS__LIST.html#o2">Alias</a>[1];
01660 } <a class="code" href="../../d7/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS__LIST.html">CM_HARDWARE_PROFILE_ACPI_ALIAS_LIST</a>, *<a class="code" href="../../d7/d3/struct__CM__HARDWARE__PROFILE__ACPI__ALIAS__LIST.html">PCM_HARDWARE_PROFILE_ACPI_ALIAS_LIST</a>;
01661 
01662 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
01663 <a class="code" href="../../d1/d2/cmp_8h.html#a296">CmpFindControlSet</a>(
01664      IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> SystemHive,
01665      IN HCELL_INDEX RootCell,
01666      IN PUNICODE_STRING SelectName,
01667      OUT PBOOLEAN AutoSelect
01668      );
01669 
01670 BOOLEAN
01671 <a class="code" href="../../d1/d2/cmp_8h.html#a297">CmpFindDrivers</a>(
01672     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01673     IN HCELL_INDEX ControlSet,
01674     IN SERVICE_LOAD_TYPE LoadType,
01675     IN PWSTR BootFileSystem OPTIONAL,
01676     IN PLIST_ENTRY DriverListHead
01677     );
01678 
01679 BOOLEAN
01680 <a class="code" href="../../d1/d2/cmp_8h.html#a298">CmpFindNLSData</a>(
01681     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01682     IN HCELL_INDEX ControlSet,
01683     OUT PUNICODE_STRING AnsiFilename,
01684     OUT PUNICODE_STRING OemFilename,
01685     OUT PUNICODE_STRING CaseTableFilename,
01686     OUT PUNICODE_STRING OemHalFilename
01687     );
01688 
01689 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
01690 <a class="code" href="../../d1/d2/cmp_8h.html#a299">CmpFindProfileOption</a>(
01691     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01692     IN HCELL_INDEX ControlSet,
01693     OUT PCM_HARDWARE_PROFILE_LIST *ProfileList,
01694     OUT PCM_HARDWARE_PROFILE_ALIAS_LIST *AliasList,
01695     OUT PULONG Timeout
01696     );
01697 
01698 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01699 <a class="code" href="../../d1/d2/cmp_8h.html#a300">CmpSetCurrentProfile</a>(
01700     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01701     IN HCELL_INDEX ControlSet,
01702     IN PCM_HARDWARE_PROFILE Profile
01703     );
01704 
01705 BOOLEAN
01706 <a class="code" href="../../d1/d2/cmp_8h.html#a301">CmpResolveDriverDependencies</a>(
01707     IN PLIST_ENTRY DriverListHead
01708     );
01709 
01710 BOOLEAN
01711 <a class="code" href="../../d1/d2/cmp_8h.html#a302">CmpSortDriverList</a>(
01712     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01713     IN HCELL_INDEX ControlSet,
01714     IN PLIST_ENTRY DriverListHead
01715     );
01716 
01717 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
01718 <a class="code" href="../../d1/d2/cmp_8h.html#a303">CmpFindSubKeyByName</a>(
01719     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
01720     <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a>    Parent,
01721     PUNICODE_STRING SearchName
01722     );
01723 
01724 <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>
01725 <a class="code" href="../../d1/d2/cmp_8h.html#a304">CmpFindSubKeyByNumber</a>(
01726     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
01727     <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a>    Parent,
01728     ULONG           Number
01729     );
01730 
01731 BOOLEAN
01732 <a class="code" href="../../d1/d2/cmp_8h.html#a305">CmpAddSubKey</a>(
01733     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
01734     HCELL_INDEX     Parent,
01735     HCELL_INDEX     Child
01736     );
01737 
01738 BOOLEAN
01739 <a class="code" href="../../d1/d2/cmp_8h.html#a306">CmpMarkIndexDirty</a>(
01740     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
01741     HCELL_INDEX     ParentKey,
01742     HCELL_INDEX     TargetKey
01743     );
01744 
01745 BOOLEAN
01746 <a class="code" href="../../d1/d2/cmp_8h.html#a307">CmpRemoveSubKey</a>(
01747     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>          Hive,
01748     HCELL_INDEX     ParentKey,
01749     HCELL_INDEX     TargetKey
01750     );
01751 
01752 BOOLEAN
01753 <a class="code" href="../../d2/d2/cmparse_8c.html#a21">CmpGetNextName</a>(
01754     IN OUT PUNICODE_STRING  RemainingName,
01755     OUT    PUNICODE_STRING  NextName,
01756     OUT    PBOOLEAN  Last
01757     );
01758 
01759 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01760 <a class="code" href="../../d1/d2/cmp_8h.html#a309">CmpAddToHiveFileList</a>(
01761     PCMHIVE CmHive
01762     );
01763 
01764 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01765 <a class="code" href="../../d1/d2/cmp_8h.html#a310">CmpRemoveFromHiveFileList</a>(
01766     );
01767 
01768 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01769 <a class="code" href="../../d1/d3/cmsysini_8c.html#a52">CmpInitHiveFromFile</a>(
01770     IN PUNICODE_STRING FileName,
01771     IN ULONG HiveFlags,
01772     OUT PCMHIVE *CmHive,
01773     IN OUT PBOOLEAN Allocate,
01774     IN OUT PBOOLEAN RegistryLocked
01775     );
01776 
01777 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01778 <a class="code" href="../../d6/d2/hwprofil_8c.html#a7">CmpCloneHwProfile</a> (
01779     IN HANDLE IDConfigDB,
01780     IN HANDLE Parent,
01781     IN HANDLE OldProfile,
01782     IN ULONG  OldProfileNumber,
01783     IN USHORT DockingState,
01784     OUT PHANDLE NewProfile,
01785     OUT PULONG  NewProfileNumber
01786     );
01787 
01788 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01789 <a class="code" href="../../d6/d2/hwprofil_8c.html#a8">CmpCreateHwProfileFriendlyName</a> (
01790     IN HANDLE IDConfigDB,
01791     IN ULONG  DockingState,
01792     IN ULONG  NewProfileNumber,
01793     OUT PUNICODE_STRING FriendlyName
01794     );
01795 
01796 <span class="keyword">typedef</span>
01797 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l01798"></a><a class="code" href="../../d1/d2/cmp_8h.html#a201">01798</a> (*PCM_ACPI_SELECTION_ROUTINE) (
01799     IN  <a class="code" href="../../d1/d2/cmp_8h.html#a192">PCM_HARDWARE_PROFILE_LIST</a> ProfileList,
01800     OUT PULONG ProfileIndexToUse, <span class="comment">// Set to -1 for none.</span>
01801     IN  PVOID Context
01802     );
01803 
01804 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01805 <a class="code" href="../../d6/d2/hwprofil_8c.html#a6">CmSetAcpiHwProfile</a> (
01806     IN  <a class="code" href="../../d9/d0/struct__PROFILE__ACPI__DOCKING__STATE.html">PPROFILE_ACPI_DOCKING_STATE</a> DockState,
01807     IN  <a class="code" href="../../d1/d2/cmp_8h.html#a201">PCM_ACPI_SELECTION_ROUTINE</a>,
01808     IN  PVOID Context,
01809     OUT PHANDLE NewProfile,
01810     OUT PBOOLEAN ProfileChanged
01811     );
01812 
01813 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01814 <a class="code" href="../../d6/d2/hwprofil_8c.html#a5">CmpAddAcpiAliasEntry</a> (
01815     IN HANDLE                       IDConfigDB,
01816     IN <a class="code" href="../../d9/d0/struct__PROFILE__ACPI__DOCKING__STATE.html">PPROFILE_ACPI_DOCKING_STATE</a>  NewDockState,
01817     IN ULONG                        ProfileNumber,
01818     IN PWCHAR                       nameBuffer,
01819     IN PVOID                        valueBuffer,
01820     IN ULONG                        valueBufferLength,
01821     IN BOOLEAN                      PreventDuplication
01822     );
01823 
01824 <span class="comment">//</span>
01825 <span class="comment">// Routines for handling registry compressed names</span>
01826 <span class="comment">//</span>
01827 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>
01828 <a class="code" href="../../d1/d2/cmp_8h.html#a316">CmpNameSize</a>(
01829     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01830     IN PUNICODE_STRING Name
01831     );
01832 
01833 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>
01834 <a class="code" href="../../d1/d2/cmp_8h.html#a317">CmpCopyName</a>(
01835     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01836     IN PWCHAR Destination,
01837     IN PUNICODE_STRING Source
01838     );
01839 
01840 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01841 <a class="code" href="../../d1/d2/cmp_8h.html#a318">CmpCopyCompressedName</a>(
01842     IN PWCHAR Destination,
01843     IN ULONG DestinationLength,
01844     IN PWCHAR Source,
01845     IN ULONG SourceLength
01846     );
01847 
01848 LONG
01849 <a class="code" href="../../d1/d2/cmp_8h.html#a319">CmpCompareCompressedName</a>(
01850     IN PUNICODE_STRING SearchName,
01851     IN PWCHAR CompressedName,
01852     IN ULONG NameLength
01853     );
01854 
01855 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>
01856 <a class="code" href="../../d1/d2/cmp_8h.html#a320">CmpCompressedNameSize</a>(
01857     IN PWCHAR Name,
01858     IN ULONG Length
01859     );
01860 
01861 
01862 <span class="preprocessor">#endif</span>
01863 <span class="preprocessor"></span>
01864 <span class="comment">//</span>
01865 <span class="comment">// ----- CACHED_DATA -----</span>
01866 <span class="comment">//</span>
01867 <span class="comment">// When values are not cached, List in ValueCache is the Hive cell index to the value list.</span>
01868 <span class="comment">// When they are cached, List will be pointer to the allocation.  We distinguish them by</span>
01869 <span class="comment">// marking the lowest bit in the variable to indicate it is a cached allocation.</span>
01870 <span class="comment">//</span>
01871 <span class="comment">// Note that the cell index for value list</span>
01872 <span class="comment">// is stored in the cached allocation.  It is not used now but may be in further performance</span>
01873 <span class="comment">// optimization.</span>
01874 <span class="comment">//</span>
01875 <span class="comment">// When value key and vaule data are cached, there is only one allocation for both.</span>
01876 <span class="comment">// Value data is appended that the end of value key.  DataCacheType indicates</span>
01877 <span class="comment">// whether data is cached and ValueKeySize tells how big is the value key (so</span>
01878 <span class="comment">// we can calculate the address of cached value data)</span>
01879 <span class="comment">//</span>
01880 <span class="comment">//</span>
01881 
01882 <a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html">PCM_NAME_CONTROL_BLOCK</a>
01883 <a class="code" href="../../d8/d2/cmsubs_8c.html#a14">CmpGetNameControlBlock</a>(
01884     PUNICODE_STRING NodeName
01885     );
01886 
01887 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01888 <a class="code" href="../../d8/d2/cmsubs_8c.html#a23">CmpDereferenceKeyControlBlockWithLock</a>(
01889     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>   KeyControlBlock
01890     );
01891 
01892 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01893 <a class="code" href="../../d8/d2/cmsubs_8c.html#a15">CmpCleanUpSubKeyInfo</a>(
01894     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>   KeyControlBlock
01895     );
01896 
01897 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01898 <a class="code" href="../../d8/d2/cmsubs_8c.html#a16">CmpCleanUpKcbValueCache</a>(
01899     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>   KeyControlBlock
01900     );
01901 
01902 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01903 <a class="code" href="../../d8/d2/cmsubs_8c.html#a17">CmpCleanUpKcbCacheWithLock</a>(
01904     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>   KeyControlBlock
01905     );
01906 
01907 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01908 <a class="code" href="../../d8/d2/cmsubs_8c.html#a19">CmpRemoveFromDelayedClose</a>(
01909     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> kcb
01910     );
01911 
01912 PUNICODE_STRING
01913 <a class="code" href="../../d8/d2/cmsubs_8c.html#a18">CmpConstructName</a>(
01914     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a> kcb
01915 );
01916 
01917 <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a>
01918 <a class="code" href="../../d4/d3/cmtree_8c.html#a1">CmpGetValueListFromCache</a>(
01919     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
01920     IN <a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html">PCACHED_CHILD_LIST</a> ChildList,
01921     IN OUT BOOLEAN    *IndexCached
01922 );
01923 
01924 <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">PCM_KEY_VALUE</a>
01925 <a class="code" href="../../d4/d3/cmtree_8c.html#a2">CmpGetValueKeyFromCache</a>(
01926     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>         Hive,
01927     IN <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a>     List,
01928     IN ULONG          Index,
01929     OUT <a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html">PPCM_CACHED_VALUE</a> *ContainingList,
01930     IN BOOLEAN        IndexCached,
01931     OUT BOOLEAN    *ValueCached
01932 );
01933 
01934 <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">PCM_KEY_VALUE</a>
01935 <a class="code" href="../../d4/d3/cmtree_8c.html#a3">CmpFindValueByNameFromCache</a>(
01936     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  Hive,
01937     IN <a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html">PCACHED_CHILD_LIST</a> ChildList,
01938     IN PUNICODE_STRING Name,
01939     OUT <a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html">PPCM_CACHED_VALUE</a> *ContainingList,
01940     OUT ULONG *Index,
01941     OUT BOOLEAN *ValueCached
01942     );
01943 
01944 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01945 <a class="code" href="../../d9/d2/cmsubs2_8c.html#a5">CmpQueryKeyValueData</a>(
01946     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01947     <a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html">PCM_CACHED_VALUE</a> *ContainingList,
01948     <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">PCM_KEY_VALUE</a> ValueKey,
01949     BOOLEAN       ValueCached,
01950     KEY_VALUE_INFORMATION_CLASS KeyValueInformationClass,
01951     PVOID KeyValueInformation,
01952     ULONG Length,
01953     PULONG ResultLength
01954     );
01955 
01956 BOOLEAN
01957 <a class="code" href="../../d8/d2/cmsubs_8c.html#a13">CmpReferenceKeyControlBlock</a>(
01958     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>   KeyControlBlock
01959     );
01960 
01961 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> 
01962 <a class="code" href="../../d2/d3/cmtrecpy_8c.html#a14">CmpInitializeKeyNameString</a>(<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a> Cell, 
01963                            PUNICODE_STRING KeyName,
01964                            WCHAR *NameBuffer
01965                            );
01966 
01967 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> 
01968 <a class="code" href="../../d2/d3/cmtrecpy_8c.html#a15">CmpInitializeValueNameString</a>(<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">PCM_KEY_VALUE</a> Cell, 
01969                              PUNICODE_STRING ValueName,
01970                              WCHAR *NameBuffer
01971                              );
01972 
01973 <span class="preprocessor">#ifdef KCB_TO_KEYBODY_LINK</span>
01974 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01975 CmpFlushNotifiesOnKeyBodyList(
01976     IN <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>   kcb
01977     );
01978 
01979 <span class="preprocessor">#endif</span>
01980 <span class="preprocessor"></span>
<a name="l01981"></a><a class="code" href="../../d1/d2/cmp_8h.html#a202">01981</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d1/d2/cmp_8h.html#a202">CmpHashTableSize</a>;
<a name="l01982"></a><a class="code" href="../../d1/d2/cmp_8h.html#a203">01982</a> <span class="keyword">extern</span> <a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html">PCM_KEY_HASH</a> *<a class="code" href="../../d1/d2/cmp_8h.html#a203">CmpCacheTable</a>;
01983 
01984 <span class="preprocessor">#ifdef _WANT_MACHINE_IDENTIFICATION</span>
01985 <span class="preprocessor"></span>
01986 BOOLEAN
01987 CmpGetBiosDateFromRegistry(
01988     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01989     IN HCELL_INDEX ControlSet,
01990     OUT PUNICODE_STRING Date
01991     );
01992 
01993 BOOLEAN
01994 CmpGetBiosinfoFileNameFromRegistry(
01995     IN <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a> Hive,
01996     IN HCELL_INDEX ControlSet,
01997     OUT PUNICODE_STRING InfName
01998     );
01999 
02000 
02001 <span class="preprocessor">#endif</span>
02002 <span class="preprocessor"></span>
02003 <span class="comment">// Utility macro to set the fields of an IO_STATUS_BLOCK.  On sundown, 32bit processes</span>
02004 <span class="comment">// will pass in a 32bit Iosb, and 64bit processes will pass in a 64bit Iosb.</span>
02005 <span class="preprocessor">#if defined(_WIN64)</span>
02006 <span class="preprocessor"></span>
02007 <span class="preprocessor">#define CmpSetIoStatus(Iosb, s, i, UseIosb32)                              \</span>
02008 <span class="preprocessor">if ((UseIosb32)) {                                                         \</span>
02009 <span class="preprocessor">    ((PIO_STATUS_BLOCK32)(Iosb))-&gt;Status = (NTSTATUS)(s);                  \</span>
02010 <span class="preprocessor">    ((PIO_STATUS_BLOCK32)(Iosb))-&gt;Information = (ULONG)(i);                \</span>
02011 <span class="preprocessor">}                                                                          \</span>
02012 <span class="preprocessor">else {                                                                     \</span>
02013 <span class="preprocessor">    (Iosb)-&gt;Status = (s);                                                  \</span>
02014 <span class="preprocessor">    (Iosb)-&gt;Information = (i);                                             \</span>
02015 <span class="preprocessor">}                                                                          \</span>
02016 <span class="preprocessor"></span>
02017 <span class="preprocessor"></span><span class="preprocessor">#else</span>
02018 <span class="preprocessor"></span>
<a name="l02019"></a><a class="code" href="../../d1/d2/cmp_8h.html#a151">02019</a> <span class="preprocessor">#define CmpSetIoStatus(Iosb, s, i, UseIosb32)                              \</span>
02020 <span class="preprocessor">(Iosb)-&gt;Status = (s);                                                      \</span>
02021 <span class="preprocessor">(Iosb)-&gt;Information = (i);                                                 \</span>
02022 <span class="preprocessor"></span>
02023 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02024 <span class="preprocessor"></span>                                                               
02025 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:28 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
