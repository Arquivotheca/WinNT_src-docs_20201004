<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rmvars.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>rmvars.c File Reference</h1><code>#include "<a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>"</code><br>

<p>
<a href="../../d3/d9/rmvars_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d0/rmvars_8c.html#a4">SepRmDbInitialization</a> (VOID)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d0/rmvars_8c.html#a0">SepRmLsaCallProcess</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d0/rmvars_8c.html#a1">SepRmDbLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">SEP_RM_STATE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d0/rmvars_8c.html#a2">SepRmState</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d0/rmvars_8c.html#a3">SepLogonSessions</a> = NULL</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a4" doxytag="rmvars.c::SepRmDbInitialization" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepRmDbInitialization           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">95</a> of file <a class="el" href="../../d3/d9/rmvars_8c-source.html">rmvars.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00088">_SEP_RM_STATE::AuditingEnabled</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02473">ExInitializeResource</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00089">_SEP_RM_STATE::OperationalMode</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01600">SeAnonymousAuthenticationId</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00041">SEP_LOGON_TRACK_ARRAY_SIZE</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00541">SepCreateLogonSessionTrack()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00229">SepLogonSessions</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00228">SepRmDbLock</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00227">SepRmState</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01599">SeSystemAuthenticationId</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l01275">SepRmInitPhase0()</a>.
<p>
<pre class="fragment"><div>00100                    :
00101 
00102     This function initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference monitor in-memory database.
00103 
00104 Arguments:
00105 
00106     None.
00107 
00108 Return Value:
00109 
00110     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> database successfully initialized.
00111     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> not successfully initialized.
00112 
00113 --*/
00114 {
00115     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00116     ULONG i;
00117 
00118 
00119     <span class="comment">//</span>
00120     <span class="comment">// Create the reference monitor database lock</span>
00121     <span class="comment">//</span>
00122     <span class="comment">// Use SepRmAcquireDbReadLock()</span>
00123     <span class="comment">//     SepRmAcquireDbWriteLock()</span>
00124     <span class="comment">//     SepRmReleaseDbReadLock()</span>
00125     <span class="comment">//     SepRmReleaseDbWriteLock()</span>
00126     <span class="comment">//</span>
00127     <span class="comment">// to gain access to the reference monitor database.</span>
00128     <span class="comment">//</span>
00129 
00130     <a class="code" href="../../d5/d8/ex_8h.html#a68">ExInitializeResource</a>(&amp;SepRmDbLock);
00131 
00132     <span class="comment">//</span>
00133     <span class="comment">// Initialize the Logon Session tracking array.</span>
00134     <span class="comment">//</span>
00135 
00136     <a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a> = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool,
00137                                               <span class="keyword">sizeof</span>( <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a> ) * SEP_LOGON_TRACK_ARRAY_SIZE,
00138                                               'SLeS'
00139                                               );
00140 
00141     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00142         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00143     }
00144 
00145     <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d1/d0/rmp_8h.html#a1">SEP_LOGON_TRACK_ARRAY_SIZE</a>;i++) {
00146 
00147         <a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a>[ i ] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00148     }
00149 
00150     <span class="comment">//</span>
00151     <span class="comment">// Now add in a record representing the system logon session.</span>
00152     <span class="comment">//</span>
00153 
00154     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d0/rmp_8h.html#a31">SepCreateLogonSessionTrack</a>( &amp;SeSystemAuthenticationId );
00155     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00156     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00157         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00158     }
00159 
00160     <span class="comment">//</span>
00161     <span class="comment">// Add one for the null session logon session</span>
00162     <span class="comment">//</span>
00163 
00164     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d0/rmp_8h.html#a31">SepCreateLogonSessionTrack</a>( &amp;SeAnonymousAuthenticationId );
00165     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00166     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00167         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00168     }
00169 
00170 
00171 
00172 
00173     <span class="comment">//</span>
00174     <span class="comment">// The correct RM state will be set when the local security policy</span>
00175     <span class="comment">// information is retrieved (by the LSA) and subsequently passed to</span>
00176     <span class="comment">// the reference monitor later on in initialization.  For now, initialize</span>
00177     <span class="comment">// the state to something that will work for the remainder of</span>
00178     <span class="comment">// system initialization.</span>
00179     <span class="comment">//</span>
00180 
00181     <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o4">AuditingEnabled</a> = 0;    <span class="comment">// auditing state disabled.</span>
00182     <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o5">OperationalMode</a> = LSA_MODE_PASSWORD_PROTECTED;
00183 
00184 
00185 
00186     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00187 
00188 
00189 }
}
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a3" doxytag="rmvars.c::SepLogonSessions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a>* <a class="el" href="../../d2/d0/rmvars_8c.html#a3">SepLogonSessions</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00082">82</a> of file <a class="el" href="../../d3/d9/rmvars_8c-source.html">rmvars.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00979">SeMarkLogonSessionForTerminationNotification()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00541">SepCreateLogonSessionTrack()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00655">SepDeleteLogonSessionTrack()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00384">SepDeReferenceLogonSession()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00278">SepReferenceLogonSession()</a>, and <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="rmvars.c::SepRmDbLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="el" href="../../d2/d0/rmvars_8c.html#a1">SepRmDbLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00064">64</a> of file <a class="el" href="../../d3/d9/rmvars_8c-source.html">rmvars.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="rmvars.c::SepRmLsaCallProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> <a class="el" href="../../d2/d0/rmvars_8c.html#a0">SepRmLsaCallProcess</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00046">46</a> of file <a class="el" href="../../d3/d9/rmvars_8c-source.html">rmvars.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>, and <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00466">SepRmCommandServerThreadInit()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="rmvars.c::SepRmState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">SEP_RM_STATE</a> <a class="el" href="../../d2/d0/rmvars_8c.html#a2">SepRmState</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00071">71</a> of file <a class="el" href="../../d3/d9/rmvars_8c-source.html">rmvars.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00309">SepRmCommandServerThread()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00466">SepRmCommandServerThreadInit()</a>, <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>, and <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">SeRmInitPhase1()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:29 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
