<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: inctlpan.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>inctlpan.c</h1><a href="../../d1/d1/inctlpan_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/***************************************************************************\</span>
00002 <span class="comment">*</span>
00003 <span class="comment">*  INCTLPAN.C</span>
00004 <span class="comment">*</span>
00005 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00006 <span class="comment">*</span>
00007 <span class="comment">*  Init Routines which are also used by Control Panel</span>
00008 <span class="comment">*</span>
00009 <span class="comment">*  -- Scalable Window Frame Support</span>
00010 <span class="comment">*</span>
00011 <span class="comment">*  exports from this module:</span>
00012 <span class="comment">*   &gt; SetCaretBlinkTime -- API called internally (kinda) by control panel</span>
00013 <span class="comment">*   &gt; SetKeyboardSpeed  -- called by LoadWindows &amp; SystemParametersInfo</span>
00014 <span class="comment">*   &gt; SetMinMaxInfo     -- called by LoadWindows &amp; SystemParemetersInfo</span>
00015 <span class="comment">*   &gt; SetWindowMetrics  -- called by LoadWindows &amp; SystemParametersInfo</span>
00016 <span class="comment">*</span>
00017 <span class="comment">\***************************************************************************/</span>
00018 
00019 <span class="preprocessor">#include "<a class="code" href="../../d0/d4/w32_2ntuser_2kernel_2precomp_8h.html">precomp.h</a>"</span>
00020 <span class="preprocessor">#pragma hdrstop</span>
00021 <span class="preprocessor"></span>
00022 __inline <span class="keywordtype">int</span>
<a name="l00023"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a4">00023</a> <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(
00024         PUNICODE_STRING pProfileUserName,
00025         UINT    idStr,
00026         <span class="keywordtype">int</span>     defValue
00027         )
00028 {
00029     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a2010">FastGetProfileIntFromID</a>(
00030             pProfileUserName, <a class="code" href="../../d4/d1/userk_8h.html#a718">PMAP_METRICS</a>, idStr, defValue);
00031 }
00032 
<a name="l00033"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a2">00033</a> <span class="keyword">static</span> CONST WORD <a class="code" href="../../d1/d1/inctlpan_8c.html#a2">sysBmpStyles</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a361">OBI_COUNT</a>][2] = {
00034 
00035     DFC_CAPTION,   DFCS_CAPTIONCLOSE,                               <span class="comment">// OBI_CLOSE</span>
00036     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_PUSHED,                 <span class="comment">// OBI_CLOSE_D</span>
00037     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_HOT,                    <span class="comment">// OBI_CLOSE_H</span>
00038     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_INACTIVE,               <span class="comment">// OBI_CLOSE_I</span>
00039     DFC_CAPTION,   DFCS_CAPTIONMIN,                                 <span class="comment">// OBI_REDUCE</span>
00040     DFC_CAPTION,   DFCS_CAPTIONMIN | DFCS_PUSHED,                   <span class="comment">// OBI_REDUCE_D</span>
00041     DFC_CAPTION,   DFCS_CAPTIONMIN | DFCS_HOT,                      <span class="comment">// OBI_REDUCE_H</span>
00042     DFC_CAPTION,   DFCS_CAPTIONMIN | DFCS_INACTIVE,                 <span class="comment">// OBI_REDUCE_I</span>
00043     DFC_CAPTION,   DFCS_CAPTIONRESTORE,                             <span class="comment">// OBI_RESTORE</span>
00044     DFC_CAPTION,   DFCS_CAPTIONRESTORE | DFCS_PUSHED,               <span class="comment">// OBI_RESTORE_D</span>
00045     DFC_CAPTION,   DFCS_CAPTIONRESTORE | DFCS_HOT,                  <span class="comment">// OBI_RESTORE_H</span>
00046     DFC_CAPTION,   DFCS_CAPTIONHELP,                                <span class="comment">// OBI_HELP</span>
00047     DFC_CAPTION,   DFCS_CAPTIONHELP | DFCS_PUSHED,                  <span class="comment">// OBI_HELP_D</span>
00048     DFC_CAPTION,   DFCS_CAPTIONHELP | DFCS_HOT,                     <span class="comment">// OBI_HELP_H</span>
00049     DFC_CAPTION,   DFCS_CAPTIONMAX,                                 <span class="comment">// OBI_ZOOM</span>
00050     DFC_CAPTION,   DFCS_CAPTIONMAX | DFCS_PUSHED,                   <span class="comment">// OBI_ZOOM_D</span>
00051     DFC_CAPTION,   DFCS_CAPTIONMAX | DFCS_HOT,                      <span class="comment">// OBI_ZOOM_H</span>
00052     DFC_CAPTION,   DFCS_CAPTIONMAX | DFCS_INACTIVE,                 <span class="comment">// OBI_ZOOM_I</span>
00053     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_INMENU,                 <span class="comment">// OBI_CLOSE_MBAR</span>
00054     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_INMENU | DFCS_PUSHED,   <span class="comment">// OBI_CLOSE_MBAR_D</span>
00055     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_INMENU | DFCS_HOT,      <span class="comment">// OBI_CLOSE_MBAR_H</span>
00056     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_INMENU | DFCS_INACTIVE, <span class="comment">// OBI_CLOSE_MBAR_I</span>
00057     DFC_CAPTION,   DFCS_CAPTIONMIN | DFCS_INMENU,                   <span class="comment">// OBI_REDUCE_MBAR</span>
00058     DFC_CAPTION,   DFCS_CAPTIONMIN | DFCS_INMENU | DFCS_PUSHED,     <span class="comment">// OBI_REDUCE_MBAR_D</span>
00059     DFC_CAPTION,   DFCS_CAPTIONMIN | DFCS_INMENU | DFCS_HOT,        <span class="comment">// OBI_REDUCE_MBAR_H</span>
00060     DFC_CAPTION,   DFCS_CAPTIONMIN | DFCS_INMENU | DFCS_INACTIVE,   <span class="comment">// OBI_REDUCE_MBAR_I</span>
00061     DFC_CAPTION,   DFCS_CAPTIONRESTORE | DFCS_INMENU,               <span class="comment">// OBI_RESTORE_MBAR</span>
00062     DFC_CAPTION,   DFCS_CAPTIONRESTORE | DFCS_INMENU | DFCS_PUSHED, <span class="comment">// OBI_RESTORE_MBAR_D</span>
00063     DFC_CAPTION,   DFCS_CAPTIONRESTORE | DFCS_INMENU | DFCS_HOT,    <span class="comment">// OBI_RESTORE_MBAR_H</span>
00064     DFC_CACHE,     DFCS_CACHEICON,                                  <span class="comment">// OBI_CAPICON1</span>
00065     DFC_CACHE,     DFCS_CACHEICON | DFCS_INACTIVE,                  <span class="comment">// OBI_CAPICON1_I</span>
00066     DFC_CACHE,     DFCS_CACHEICON,                                  <span class="comment">// OBI_CAPICON2</span>
00067     DFC_CACHE,     DFCS_CACHEICON | DFCS_INACTIVE,                  <span class="comment">// OBI_CAPICON2_I</span>
00068     DFC_CACHE,     DFCS_CACHEICON,                                  <span class="comment">// OBI_CAPICON3</span>
00069     DFC_CACHE,     DFCS_CACHEICON | DFCS_INACTIVE,                  <span class="comment">// OBI_CAPICON3_I</span>
00070     DFC_CACHE,     DFCS_CACHEICON,                                  <span class="comment">// OBI_CAPICON4</span>
00071     DFC_CACHE,     DFCS_CACHEICON | DFCS_INACTIVE,                  <span class="comment">// OBI_CAPICON4_I</span>
00072     DFC_CACHE,     DFCS_CACHEICON,                                  <span class="comment">// OBI_CAPICON5</span>
00073     DFC_CACHE,     DFCS_CACHEICON | DFCS_INACTIVE,                  <span class="comment">// OBI_CAPICON5_I</span>
00074     DFC_CACHE,     DFCS_CACHEBUTTONS,                               <span class="comment">// OBI_CAPBTNS</span>
00075     DFC_CACHE,     DFCS_CACHEBUTTONS | DFCS_INACTIVE,               <span class="comment">// OBI_CAPBTNS_I</span>
00076     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_INSMALL,                <span class="comment">// OBI_CLOSE_PAL</span>
00077     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_INSMALL | DFCS_PUSHED,  <span class="comment">// OBI_CLOSE_PAL_D</span>
00078     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_INSMALL | DFCS_HOT,     <span class="comment">// OBI_CLOSE_PAL_H</span>
00079     DFC_CAPTION,   DFCS_CAPTIONCLOSE | DFCS_INSMALL | DFCS_INACTIVE,<span class="comment">// OBI_CLOSE_PAL_I</span>
00080     DFC_SCROLL,    DFCS_SCROLLSIZEGRIP,                             <span class="comment">// OBI_NCGRIP</span>
00081     DFC_SCROLL,    DFCS_SCROLLUP,                                   <span class="comment">// OBI_UPARROW</span>
00082     DFC_SCROLL,    DFCS_SCROLLUP | DFCS_PUSHED | DFCS_FLAT,         <span class="comment">// OBI_UPARROW_D</span>
00083     DFC_SCROLL,    DFCS_SCROLLUP | DFCS_HOT,                        <span class="comment">// OBI_UPARROW_H</span>
00084     DFC_SCROLL,    DFCS_SCROLLUP | DFCS_INACTIVE,                   <span class="comment">// OBI_UPARROW_I</span>
00085     DFC_SCROLL,    DFCS_SCROLLDOWN,                                 <span class="comment">// OBI_DNARROW</span>
00086     DFC_SCROLL,    DFCS_SCROLLDOWN | DFCS_PUSHED | DFCS_FLAT,       <span class="comment">// OBI_DNARROW_D</span>
00087     DFC_SCROLL,    DFCS_SCROLLDOWN | DFCS_HOT,                      <span class="comment">// OBI_DNARROW_H</span>
00088     DFC_SCROLL,    DFCS_SCROLLDOWN | DFCS_INACTIVE,                 <span class="comment">// OBI_DNARROW_I</span>
00089     DFC_SCROLL,    DFCS_SCROLLRIGHT,                                <span class="comment">// OBI_RGARROW</span>
00090     DFC_SCROLL,    DFCS_SCROLLRIGHT | DFCS_PUSHED | DFCS_FLAT,      <span class="comment">// OBI_RGARROW_D</span>
00091     DFC_SCROLL,    DFCS_SCROLLRIGHT | DFCS_HOT,                     <span class="comment">// OBI_RGARROW_H</span>
00092     DFC_SCROLL,    DFCS_SCROLLRIGHT | DFCS_INACTIVE,                <span class="comment">// OBI_RGARROW_I</span>
00093     DFC_SCROLL,    DFCS_SCROLLLEFT,                                 <span class="comment">// OBI_LFARROW</span>
00094     DFC_SCROLL,    DFCS_SCROLLLEFT | DFCS_PUSHED | DFCS_FLAT,       <span class="comment">// OBI_LFARROW_D</span>
00095     DFC_SCROLL,    DFCS_SCROLLLEFT | DFCS_HOT,                      <span class="comment">// OBI_LFARROW_H</span>
00096     DFC_SCROLL,    DFCS_SCROLLLEFT | DFCS_INACTIVE,                 <span class="comment">// OBI_LFARROW_I</span>
00097     DFC_MENU,      DFCS_MENUARROW,                                  <span class="comment">// OBI_MENUARROW</span>
00098     DFC_MENU,      DFCS_MENUCHECK,                                  <span class="comment">// OBI_MENUCHECK</span>
00099     DFC_MENU,      DFCS_MENUBULLET,                                 <span class="comment">// OBI_MENUBULLET</span>
00100     DFC_MENU,      DFCS_MENUARROWUP,                                <span class="comment">// OBI_MENUARROWUP</span>
00101     DFC_MENU,      DFCS_MENUARROWUP | DFCS_HOT,                     <span class="comment">// OBI_MENUARROWUP_H</span>
00102     DFC_MENU,      DFCS_MENUARROWUP | DFCS_INACTIVE,                <span class="comment">// OBI_MENUARROWUP_I</span>
00103     DFC_MENU,      DFCS_MENUARROWDOWN,                              <span class="comment">// OBI_MENUARROWDOWN</span>
00104     DFC_MENU,      DFCS_MENUARROWDOWN | DFCS_HOT,                   <span class="comment">// OBI_MENUARROWDOWN_H</span>
00105     DFC_MENU,      DFCS_MENUARROWDOWN | DFCS_INACTIVE,              <span class="comment">// OBI_MENUARROWDOWN_I</span>
00106     DFC_BUTTON,    DFCS_BUTTONRADIOMASK,                            <span class="comment">// OBI_RADIOMASK</span>
00107     DFC_BUTTON,    DFCS_BUTTONCHECK,                                <span class="comment">// OBI_CHECK</span>
00108     DFC_BUTTON,    DFCS_BUTTONCHECK | DFCS_CHECKED,                 <span class="comment">// OBI_CHECK_C</span>
00109     DFC_BUTTON,    DFCS_BUTTONCHECK | DFCS_PUSHED,                  <span class="comment">// OBI_CHECK_D</span>
00110     DFC_BUTTON,    DFCS_BUTTONCHECK | DFCS_CHECKED | DFCS_PUSHED,   <span class="comment">// OBI_CHECK_CD</span>
00111     DFC_BUTTON,    DFCS_BUTTONCHECK | DFCS_CHECKED | DFCS_INACTIVE, <span class="comment">// OBI_CHECK_CDI</span>
00112     DFC_BUTTON,    DFCS_BUTTONRADIOIMAGE,                           <span class="comment">// OBI_RADIO</span>
00113     DFC_BUTTON,    DFCS_BUTTONRADIOIMAGE | DFCS_CHECKED,            <span class="comment">// OBI_RADIO_C</span>
00114     DFC_BUTTON,    DFCS_BUTTONRADIOIMAGE | DFCS_PUSHED,             <span class="comment">// OBI_RADIO_D</span>
00115     DFC_BUTTON,    DFCS_BUTTONRADIOIMAGE | DFCS_CHECKED | DFCS_PUSHED,  <span class="comment">// OBI_RADIO_CD</span>
00116     DFC_BUTTON,    DFCS_BUTTONRADIOIMAGE | DFCS_CHECKED | DFCS_INACTIVE,  <span class="comment">// OBI_RADIO_CDI</span>
00117     DFC_BUTTON,    DFCS_BUTTON3STATE,                               <span class="comment">// OBI_3STATE</span>
00118     DFC_BUTTON,    DFCS_BUTTON3STATE | DFCS_CHECKED,                <span class="comment">// OBI_3STATE_C</span>
00119     DFC_BUTTON,    DFCS_BUTTON3STATE | DFCS_PUSHED,                 <span class="comment">// OBI_3STATE_D</span>
00120     DFC_BUTTON,    DFCS_BUTTON3STATE | DFCS_CHECKED | DFCS_PUSHED,  <span class="comment">// OBI_3STATE_CD</span>
00121     DFC_BUTTON,    DFCS_BUTTON3STATE | DFCS_CHECKED | DFCS_INACTIVE,  <span class="comment">// OBI_3STATE_CDI</span>
00122     DFC_POPUPMENU, DFCS_CAPTIONCLOSE | DFCS_INMENU,                   <span class="comment">// OBI_CLOSE_POPUP</span>
00123     DFC_POPUPMENU, DFCS_CAPTIONRESTORE | DFCS_INMENU,                 <span class="comment">// OBI_RESTORE_POPUP</span>
00124     DFC_POPUPMENU, DFCS_CAPTIONMAX | DFCS_INMENU,                     <span class="comment">// OBI_ZOOM_POPUP</span>
00125     DFC_POPUPMENU, DFCS_CAPTIONMIN | DFCS_INMENU,                     <span class="comment">// OBI_REDUCE_POPUP</span>
00126     DFC_SCROLL,    DFCS_SCROLLSIZEGRIPRIGHT,                        <span class="comment">// OBI_NCGRIP_L</span>
00127     DFC_MENU,      DFCS_MENUARROWRIGHT                              <span class="comment">// OBI_MENUARROW_L</span>
00128 };
00129 
<a name="l00130"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a0">00130</a> <span class="preprocessor">#define DIVISOR 72</span>
<a name="l00131"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a1">00131</a> <span class="preprocessor"></span><span class="preprocessor">#define DU_BTNWIDTH       50  // D.U. of minimum button width in a message box</span>
00132 <span class="preprocessor"></span>
00133 <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d1/d1/inctlpan_8c.html#a5">xxxMB_FindLongestString</a>(HDC hdc);
00134 
00135 <span class="preprocessor">#ifdef LATER</span>
00136 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
00137 <span class="comment">\***************************************************************************/</span>
00138 
00139 WCHAR NibbleToChar(
00140     BYTE x)
00141 {
00142     WCHAR <span class="keyword">static</span> N2C[] =
00143       {
00144         <span class="charliteral">'0'</span>, <span class="charliteral">'1'</span>, <span class="charliteral">'2'</span>, <span class="charliteral">'3'</span>, <span class="charliteral">'4'</span>, <span class="charliteral">'5'</span>, <span class="charliteral">'6'</span>, <span class="charliteral">'7'</span>,
00145         <span class="charliteral">'8'</span>, <span class="charliteral">'9'</span>, <span class="charliteral">'A'</span>, <span class="charliteral">'B'</span>, <span class="charliteral">'C'</span>, <span class="charliteral">'D'</span>, <span class="charliteral">'E'</span>, <span class="charliteral">'F'</span>,
00146       };
00147 
00148     <span class="keywordflow">return</span> N2C[x];
00149 }
00150 
00151 <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> CharToNibble(
00152     WCHAR ch)
00153 {
00154     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> x = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)ch;
00155 
00156     <span class="keywordflow">return</span> x &gt;= <span class="charliteral">'0'</span> &amp;&amp; x &lt;= <span class="charliteral">'9'</span> ?
00157         x - <span class="charliteral">'0'</span> :
00158         ((10 + x - <span class="charliteral">'A'</span> ) &amp; 0x0f);
00159 }
00160 
00161 <span class="comment">/***************************************************************************\</span>
00162 <span class="comment">\***************************************************************************/</span>
00163 
00164 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> TextToBinary(
00165     LPBYTE pbyte,
00166     LPWSTR pwstr,
00167     <span class="keywordtype">int</span> length)
00168 {
00169     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> checksum = 0;
00170 
00171     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00172         <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> byte;
00173 
00174         byte = (CharToNibble(pwstr[0]) &lt;&lt; 4) | CharToNibble(pwstr[1]);
00175 
00176         <span class="keywordflow">if</span> (length == 0) {
00177             <span class="keywordflow">return</span> checksum == byte;
00178         }
00179 
00180         checksum += byte;
00181         *pbyte = byte;
00182 
00183         pwstr += 2;
00184         length--;
00185         pbyte++;
00186     }
00187 }
00188 
00189 <span class="keywordtype">void</span> BinaryToText(
00190     LPWSTR pwstr,
00191     LPBYTE pbyte,
00192     <span class="keywordtype">int</span> length)
00193 {
00194     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> checksum = 0;
00195 
00196     <span class="keywordflow">while</span> (length &gt; 0) {
00197         checksum += *pbyte;
00198 
00199         pwstr[0] = NibbleToChar((BYTE)((*pbyte &gt;&gt; 4) &amp; 0x0f));
00200         pwstr[1] = NibbleToChar((BYTE)(*pbyte &amp; 0x0f));
00201 
00202         pbyte++;
00203         pwstr += 2;
00204         length--;
00205     }
00206 
00207     pwstr[0] = NibbleToChar((BYTE)((checksum &gt;&gt; 4) &amp; 0x0f));
00208     pwstr[1] = NibbleToChar((BYTE)(checksum &amp; 0x0f));
00209     pwstr[2] = <span class="charliteral">'\0'</span>;
00210 }
00211 
00212 <span class="comment">/***************************************************************************\</span>
00213 <span class="comment">\***************************************************************************/</span>
00214 
00215 <span class="comment">// these are the exported apis.  The User* versions are for server use only</span>
00216 <span class="comment">// I didn't get them to work since no one calls them yet.</span>
00217 
00218 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> GetPrivateProfileStruct(
00219     LPWSTR szSection,
00220     LPWSTR szKey,
00221     LPWSTR lpStruct,
00222     DWORD uSizeStruct,
00223     LPWSTR szFile)
00224 {
00225     WCHAR szBuf[256];
00226     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  fAlloc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00227     LPSTR lpBuf, lpBufTemp;
00228     <span class="keywordtype">int</span>   nLen;
00229     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fError = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00230 
00231     nLen = uSizeStruct * 4 + 10;
00232     <span class="keywordflow">if</span> (nLen &gt; (WORD)<span class="keyword">sizeof</span>(szBuf)) {
00233         fAlloc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00234         lpBuf = (LPSTR)UserAllocPoolWithQuota(nLen, TAG_PROFILE);
00235         <span class="keywordflow">if</span> (lpBuf == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00236             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00237     } <span class="keywordflow">else</span> {
00238         lpBuf = (LPSTR)szBuf;
00239     }
00240 
00241     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a3">szFile</a> &amp;&amp; *<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a3">szFile</a>) {
00242         nLen = GetPrivateProfileString(szSection, szKey, NULL, lpBuf, nLen, szFile);
00243     } <span class="keywordflow">else</span> {
00244         nLen = GetProfileString(szSection, szKey, NULL, lpBuf, nLen);
00245     }
00246 
00247     <span class="keywordflow">if</span> (nLen == (<span class="keywordtype">int</span>)(uSizeStruct * 4 + 4)) {
00248         <span class="comment">/*</span>
00249 <span class="comment">         * decode the string</span>
00250 <span class="comment">         */</span>
00251         fError = TextToBinary(lpStruct, lpBufTemp, uSizeStruct);
00252     }
00253 
00254     <span class="keywordflow">if</span> (fAlloc)
00255         UserFreePool(lpBuf);
00256 
00257     <span class="keywordflow">return</span> fError;
00258 }
00259 
00260 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WritePrivateProfileStruct(
00261     LPWSTR szSection,
00262     LPWSTR szKey,
00263     LPWSTR lpStruct,
00264     WORD uSizeStruct,
00265     LPWSTR szFile)
00266 {
00267     LPWSTR lpBuf;
00268     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRet;
00269     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAlloc;
00270     WCHAR szBuf[256];
00271     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> checksum=0;
00272     <span class="keywordtype">int</span> allocsize = (uSizeStruct * 2 + 3) * <span class="keyword">sizeof</span>(WCHAR);
00273 
00274     <span class="comment">/* NULL lpStruct erases the the key */</span>
00275 
00276     <span class="keywordflow">if</span> (lpStruct == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00277         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a3">szFile</a> &amp;&amp; *<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a3">szFile</a>) {
00278             <span class="keywordflow">return</span> WritePrivateProfileString(szSection, szKey, (LPSTR)NULL, szFile);
00279         } <span class="keywordflow">else</span> {
00280             <span class="keywordflow">return</span> WriteProfileString(szSection, szKey, (LPSTR)NULL);
00281         }
00282     }
00283 
00284     fAlloc = (allocsize &gt; <span class="keyword">sizeof</span>(szBuf));
00285     <span class="keywordflow">if</span> (fAlloc) {
00286         lpBuf = (LPSTR)UserAllocPoolWithQuota(allocsize, TAG_PROFILE);
00287         <span class="keywordflow">if</span> (!lpBuf)
00288             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00289     } <span class="keywordflow">else</span> {
00290         lpBuf = (LPSTR)szBuf;
00291     }
00292 
00293     BinaryToText(lpBuf, lpStruct, uSizeStruct);
00294 
00295     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a3">szFile</a> &amp;&amp; *<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a3">szFile</a>) {
00296         bRet = WritePrivateProfileString(szSection, szKey, lpBuf, szFile);
00297     } <span class="keywordflow">else</span> {
00298         bRet = WriteProfileString(szSection, szKey, lpBuf);
00299     }
00300 
00301     <span class="keywordflow">if</span> (fAlloc)
00302         UserFreePool(lpBuf);
00303 
00304     <span class="keywordflow">return</span> bRet;
00305 }
00306 <span class="preprocessor">#endif</span>
00307 <span class="preprocessor"></span>
00308 <span class="comment">/***************************************************************************\</span>
00309 <span class="comment">*</span>
00310 <span class="comment">*  GetFrameControlMetrics</span>
00311 <span class="comment">*</span>
00312 <span class="comment">*  (cx = 0) is a code meaning cy is the obi of the "shared" bitmap</span>
00313 <span class="comment">*</span>
00314 <span class="comment">\***************************************************************************/</span>
<a name="l00315"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a6">00315</a> <span class="keywordtype">int</span> <a class="code" href="../../d1/d1/inctlpan_8c.html#a6">GetFrameControlMetrics</a>(
00316         UINT         obi,
00317         <span class="keywordtype">int</span>          cxMax )
00318 {
00319     <span class="keywordtype">int</span> cx, <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00320     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wType  = <a class="code" href="../../d1/d1/inctlpan_8c.html#a2">sysBmpStyles</a>[obi][0];
00321     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wState = <a class="code" href="../../d1/d1/inctlpan_8c.html#a2">sysBmpStyles</a>[obi][1];
00322     <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a> pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi + obi;
00323 
00324     <span class="keywordflow">switch</span> (wType) {
00325         <span class="keywordflow">case</span> DFC_SCROLL:
00326             <span class="keywordflow">if</span> (wState &amp; DFCS_SCROLLSIZEGRIP) {
00327                 cx = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVSCROLL);
00328                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYHSCROLL);
00329                 <span class="keywordflow">break</span>;
00330             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wState &amp; DFCS_SCROLLHORZ) {
00331                 cx = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXHSCROLL);
00332                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYHSCROLL);
00333             } <span class="keywordflow">else</span> {
00334                 cx = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVSCROLL);
00335                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYVSCROLL);
00336             }
00337             <span class="keywordflow">break</span>;
00338 
00339         <span class="keywordflow">case</span> DFC_MENU:
00340         <span class="keywordflow">case</span> DFC_POPUPMENU:
00341             <span class="keywordflow">if</span> (wState &amp; (DFCS_MENUARROWUP | DFCS_MENUARROWDOWN)) {
00342                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a144">gcyMenuScrollArrow</a>;
00343             } <span class="keywordflow">else</span> {
00344                 <span class="comment">/*</span>
00345 <span class="comment">                 * Add on proper space for space above underscore.</span>
00346 <span class="comment">                 * the 0xFFFE and -1 are to insure an ODD height</span>
00347 <span class="comment">                 */</span>
00348                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = ((<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a140">gcyMenuFontChar</a> + <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER)) &amp; 0xFFFE) - 1;
00349             }
00350             cx = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00351             <span class="keywordflow">break</span>;
00352 
00353         <span class="keywordflow">case</span> DFC_CAPTION:
00354             <span class="keywordflow">if</span> (wState &amp; DFCS_INSMALL) {
00355                 cx = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMSIZE);
00356                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMSIZE);
00357             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wState &amp; DFCS_INMENU) {
00358                 <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMENUSIZE)) &amp;&amp;
00359                     (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUSIZE))) {
00360                     cx = 0;
00361                     <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = obi - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a266">DOBI_MBAR</a>;
00362                     <span class="keywordflow">break</span>;
00363                 } <span class="keywordflow">else</span> {
00364                     cx = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMENUSIZE);
00365                     <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUSIZE);
00366                 }
00367             } <span class="keywordflow">else</span> {
00368                 cx = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE);
00369                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE);
00370             }
00371 
00372             cx -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
00373             <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> -= 2 * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
00374             <span class="keywordflow">break</span>;
00375 
00376         <span class="keywordflow">case</span> DFC_CACHE:
00377             <span class="keywordflow">if</span> (wState &amp; DFCS_CACHEBUTTONS) {
00378                 cx = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE) * 4;
00379                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE);
00380             } <span class="keywordflow">else</span>
00381                 cx = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE);
00382             <span class="keywordflow">break</span>;
00383 
00384         <span class="keywordflow">case</span> DFC_BUTTON:
00385             <span class="keywordflow">if</span> (((wState &amp; 0x00FF) &amp; DFCS_BUTTON3STATE) &amp;&amp; !(wState &amp; DFCS_CHECKED)) {
00386                 cx = 0;
00387                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = obi - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a265">DOBI_3STATE</a>;
00388             } <span class="keywordflow">else</span> {
00389                 cx = 13;
00390                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = 13;
00391             }
00392             <span class="keywordflow">break</span>;
00393     }
00394 
00395     pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a> = cx;
00396     pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a> = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00397 
00398     <span class="keywordflow">return</span>((cx &gt; cxMax) ? cx : cxMax);
00399 }
00400 
00401 
00402 <span class="comment">/***************************************************************************\</span>
00403 <span class="comment">*</span>
00404 <span class="comment">*  PackFrameControls</span>
00405 <span class="comment">*</span>
00406 <span class="comment">*  Given the dimensions that GetFrameControlMetrics has calculated, this</span>
00407 <span class="comment">*  arranges all the system bitmaps to fit within a bitmap of the given width</span>
00408 <span class="comment">*</span>
00409 <span class="comment">\***************************************************************************/</span>
00410 
<a name="l00411"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a7">00411</a> <span class="keywordtype">int</span> <a class="code" href="../../d1/d1/inctlpan_8c.html#a7">PackFrameControls</a>(<span class="keywordtype">int</span> cxMax, BOOL fRecord) {
00412     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    obi;
00413     <span class="keywordtype">int</span>     <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = 0;
00414     <span class="keywordtype">int</span>     x  = 0;
00415     <span class="keywordtype">int</span>     y  = 0;
00416 
00417 
00418     <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a> pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi;
00419 
00420     <span class="keywordflow">for</span> (obi = 0; obi &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a361">OBI_COUNT</a>; obi++, pOem++) {
00421         <span class="keywordflow">if</span> (pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>) {
00422             <span class="keywordflow">if</span> ((x + pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>) &gt; cxMax) {
00423                 y += <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00424                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = 0;
00425                 x = 0;
00426             }
00427 
00428             <span class="keywordflow">if</span> (fRecord) {
00429                 pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a> = x;
00430                 pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a> = y;
00431             }
00432 
00433             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> &lt; pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>)
00434                 <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>;
00435 
00436             x += pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>;
00437         }
00438     }
00439 
00440     <span class="keywordflow">return</span>(y + <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>);
00441 }
00442 
00443 
<a name="l00444"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a8">00444</a> <span class="keywordtype">void</span> <a class="code" href="../../d1/d1/inctlpan_8c.html#a8">DrawCaptionButtons</a>(
00445     <span class="keywordtype">int</span>          x,
00446     <span class="keywordtype">int</span>          y
00447     )
00448 {
00449     x += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
00450     y += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
00451 
00452     <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), x, y, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a271">OBI_REDUCE</a>);
00453     x += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE) - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
00454     <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), x, y, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a281">OBI_ZOOM</a>);
00455     x += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE);
00456     <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), x, y, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a267">OBI_CLOSE</a>);
00457     x += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE);
00458     <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), x, y, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a278">OBI_HELP</a>);
00459 }
00460 
00461 <span class="comment">/***************************************************************************\</span>
00462 <span class="comment">* CreateCaptionStrip</span>
00463 <span class="comment">*</span>
00464 <span class="comment">*</span>
00465 <span class="comment">\***************************************************************************/</span>
<a name="l00466"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a9">00466</a> HBITMAP <a class="code" href="../../d4/d1/userk_8h.html#a1843">CreateCaptionStrip</a>(VOID)
00467 {
00468     HBITMAP hbm;
00469 
00470     hbm = GreCreateCompatibleBitmap(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>,
00471                                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVIRTUALSCREEN),
00472                                     (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYCAPTION) - 1) * 2);
00473 
00474     <span class="keywordflow">if</span> (hbm)
00475         GreSetBitmapOwner(hbm, OBJECT_OWNER_PUBLIC);
00476 
00477     <span class="keywordflow">return</span> hbm;
00478 }
00479 
<a name="l00480"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a3">00480</a> <span class="keywordtype">int</span> <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>[5];
00481 
00482 <span class="comment">/***************************************************************************\</span>
00483 <span class="comment">*</span>
00484 <span class="comment">*  CreateBitmapStrip</span>
00485 <span class="comment">*</span>
00486 <span class="comment">*  This routine sets up either the color or monochrome strip bitmap -- a</span>
00487 <span class="comment">*  large horizontal bitmap which contains all of the system bitmaps.  By</span>
00488 <span class="comment">*  having all of these bitmaps in one long bitmap, we can have that one</span>
00489 <span class="comment">*  bitmap always selected in, speeding up paint time by not having to do</span>
00490 <span class="comment">*  a SelectBitmap() everytime we need to Blt one of the system bitmaps.</span>
00491 <span class="comment">*</span>
00492 <span class="comment">\***************************************************************************/</span>
00493 
<a name="l00494"></a><a class="code" href="../../d4/d1/userk_8h.html#a1860">00494</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1860">CreateBitmapStrip</a>(VOID)
00495 {
00496     <span class="keywordtype">int</span>     cxBmp = 0;
00497     <span class="keywordtype">int</span>     cyBmp = 0;
00498     <span class="keywordtype">int</span>     iCache = 0;
00499     HBITMAP hOldBitmap;
00500     HBITMAP hNewBmp;
00501     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    iType;
00502     RECT    rc;
00503     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    wBmpType;
00504     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>    wBmpStyle;
00505     <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a>  pOem;
00506 
00507     <span class="comment">/*</span>
00508 <span class="comment">     * Each OBI_ must have an entry in sysBmpStyles</span>
00509 <span class="comment">     */</span>
00510     UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a361">OBI_COUNT</a> == <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/inctlpan_8c.html#a2">sysBmpStyles</a>) / <span class="keyword">sizeof</span>(*<a class="code" href="../../d1/d1/inctlpan_8c.html#a2">sysBmpStyles</a>));
00511     UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a361">OBI_COUNT</a> == <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi) / <span class="keyword">sizeof</span>(*(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi)));
00512 
00513     <span class="comment">/*</span>
00514 <span class="comment">     * load all the bitmap dimensions into the OEMBITMAPINFO array oemInfo.bm</span>
00515 <span class="comment">     */</span>
00516     <span class="keywordflow">for</span> (iType = 0; iType &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a361">OBI_COUNT</a>; iType++)
00517         cxBmp = <a class="code" href="../../d1/d1/inctlpan_8c.html#a6">GetFrameControlMetrics</a>(iType, cxBmp);
00518 
00519     <span class="keywordflow">for</span> (iType = 0; iType &lt; 5; iType++)
00520         <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>[iType] = <a class="code" href="../../d1/d1/inctlpan_8c.html#a7">PackFrameControls</a>(cxBmp * (iType + 1), <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) * (iType + 1);
00521 
00522     cyBmp = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>[0], <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>[1], <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>[2], <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>[3], <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>[4]))));
00523     <span class="keywordflow">for</span> (iType = 0; cyBmp != <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>[iType]; iType++);
00524 
00525     cxBmp *= iType + 1;
00526     cyBmp = <a class="code" href="../../d1/d1/inctlpan_8c.html#a7">PackFrameControls</a>(cxBmp, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00527 
00528     hNewBmp = GreCreateCompatibleBitmap(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, cxBmp, cyBmp);
00529 
00530     <span class="keywordflow">if</span> (hNewBmp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00531         RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateBitmapStrip: failed to create bitmap"</span>);
00532         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00533     }
00534 
00535     GreSetBitmapOwner(hNewBmp, OBJECT_OWNER_PUBLIC);
00536 
00537     <span class="comment">/*</span>
00538 <span class="comment">     * Select in Bitmap Strip -- then delete old one if it exists</span>
00539 <span class="comment">     * Yanked for Chicago since these can now be paged</span>
00540 <span class="comment">     *    GDIMoveBitmap(hNewBmp);</span>
00541 <span class="comment">     */</span>
00542     hOldBitmap = GreSelectBitmap(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), hNewBmp);
00543 
00544     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a130">ghbmBits</a>) {
00545 <span class="preprocessor">#if DBG</span>
00546 <span class="preprocessor"></span>        <span class="comment">/*</span>
00547 <span class="comment">         * Don't assert if we're out of memory</span>
00548 <span class="comment">         */</span>
00549         <span class="keywordflow">if</span> (hOldBitmap != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00550             UserAssert(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a130">ghbmBits</a> == hOldBitmap);
00551         }
00552 <span class="preprocessor">#endif</span>
00553 <span class="preprocessor"></span>        GreDeleteObject(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a131">ghbmCaption</a>);
00554         GreDeleteObject(hOldBitmap);
00555     } <span class="keywordflow">else</span> {
00556        <span class="comment">/*</span>
00557 <span class="comment">        * hack to clear out display driver's font cache</span>
00558 <span class="comment">        */</span>
00559        GreExtTextOutW(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), 0, 0, 0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, (PWSTR)<a class="code" href="../../d1/d8/clglobal_8c.html#a14">szOneChar</a>, 1, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00560     }
00561 
00562     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a130">ghbmBits</a> = hNewBmp;
00563 
00564     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a131">ghbmCaption</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1843">CreateCaptionStrip</a>();
00565 
00566     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a131">ghbmCaption</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00567         RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateBitmapStrip: failed to create bitmap for caption"</span>);
00568         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00569     }
00570 
00571     <span class="comment">/*</span>
00572 <span class="comment">     * draw individual bitmaps into the strip bitmap and record the offsets</span>
00573 <span class="comment">     */</span>
00574     <span class="keywordflow">for</span> (pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi, iType = 0; iType &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a361">OBI_COUNT</a>; iType++, pOem++) {
00575         <span class="keywordflow">if</span> (!pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>) {
00576             *pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>];
00577         } <span class="keywordflow">else</span> {
00578             rc.left = pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a>;
00579             rc.top = pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>;
00580             rc.right = rc.left + pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>;
00581             rc.bottom = rc.top + pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>;
00582 
00583             wBmpType  = <a class="code" href="../../d1/d1/inctlpan_8c.html#a2">sysBmpStyles</a>[iType][0];
00584             wBmpStyle = <a class="code" href="../../d1/d1/inctlpan_8c.html#a2">sysBmpStyles</a>[iType][1];
00585 
00586             <span class="keywordflow">if</span> (wBmpType == DFC_CACHE) {
00587                 <span class="keywordflow">if</span> (wBmpStyle &amp; DFCS_CACHEBUTTONS) {
00588                     HBRUSH hbr;
00589                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a666">TestALPHA</a>(GRADIENTCAPTIONS)) {
00590                         hbr = (wBmpStyle &amp; DFCS_INACTIVE) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(GRADIENTINACTIVECAPTION) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(GRADIENTACTIVECAPTION);
00591                     } <span class="keywordflow">else</span> {
00592                         hbr = (wBmpStyle &amp; DFCS_INACTIVE) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(INACTIVECAPTION) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(ACTIVECAPTION);
00593                     }
00594                     <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), &amp;rc, hbr);
00595                     <a class="code" href="../../d1/d1/inctlpan_8c.html#a8">DrawCaptionButtons</a>(rc.left, rc.top);
00596                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(wBmpStyle &amp; DFCS_INACTIVE)) {
00597                     <span class="comment">/*</span>
00598 <span class="comment">                     * Setup Caption Cache Entry</span>
00599 <span class="comment">                     */</span>
00600                     UserAssert(iCache &lt; <a class="code" href="../../d4/d1/userk_8h.html#a6">CCACHEDCAPTIONS</a>);
00601                     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[iCache].<a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html#o0">spcursor</a>) {
00602                         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[iCache].spcursor));
00603                     }
00604                     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[iCache++].<a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html#o1">pOem</a> = pOem;
00605                 }
00606             } <span class="keywordflow">else</span> {
00607                 <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a14">DrawFrameControl</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), &amp;rc, wBmpType, wBmpStyle);
00608             }
00609         }
00610     }
00611 
00612     <span class="comment">/*</span>
00613 <span class="comment">     * Setup other frame metric dependent values.</span>
00614 <span class="comment">     */</span>
00615     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMENUCHECK) = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a330">OBI_MENUCHECK</a>].cx;
00616     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUCHECK) = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a330">OBI_MENUCHECK</a>].cy;
00617 
00618     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00619 }
00620 
00621 <span class="keywordtype">void</span>
<a name="l00622"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a11">00622</a> <a class="code" href="../../d1/d1/inctlpan_8c.html#a11">SetNCMetrics</a>(
00623         LPNONCLIENTMETRICS lpnc
00624         )
00625 {
00626     <span class="keywordtype">int</span> nMin;
00627 
00628     <span class="comment">/*</span>
00629 <span class="comment">     * Scroll metrics</span>
00630 <span class="comment">     */</span>
00631     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVSCROLL) = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYHSCROLL)   = (<span class="keywordtype">int</span>) lpnc-&gt;iScrollWidth;
00632     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYVSCROLL) = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXHSCROLL)   = (<span class="keywordtype">int</span>) lpnc-&gt;iScrollHeight;
00633     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYVTHUMB)  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXHTHUMB)    = (<span class="keywordtype">int</span>) lpnc-&gt;iScrollHeight;
00634 
00635     <span class="comment">/*</span>
00636 <span class="comment">     * Caption metrics</span>
00637 <span class="comment">     */</span>
00638     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE)            = (<span class="keywordtype">int</span>) lpnc-&gt;iCaptionWidth;
00639     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE)            = (<span class="keywordtype">int</span>) lpnc-&gt;iCaptionHeight;
00640     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYCAPTION)         = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00641 
00642     <span class="comment">/*</span>
00643 <span class="comment">     * Keep small icon square?</span>
00644 <span class="comment">     * ?? Should we allow rectangles?</span>
00645 <span class="comment">     */</span>
00646     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMICON)          = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE) - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE)) &amp; ~1;
00647     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMICON)          = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE) - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE)) &amp; ~1;
00648     nMin = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMICON), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMICON));
00649     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMICON)          = nMin;
00650     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMICON)          = nMin;
00651 
00652     <span class="comment">/*</span>
00653 <span class="comment">     * Small Caption metrics</span>
00654 <span class="comment">     */</span>
00655     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMSIZE)          = (<span class="keywordtype">int</span>) lpnc-&gt;iSmCaptionWidth;
00656     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMSIZE)          = (<span class="keywordtype">int</span>) lpnc-&gt;iSmCaptionHeight;
00657     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMCAPTION)       = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMSIZE) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00658 
00659     <span class="comment">/*</span>
00660 <span class="comment">     * Menu metrics</span>
00661 <span class="comment">     */</span>
00662     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMENUSIZE)        = (<span class="keywordtype">int</span>) lpnc-&gt;iMenuWidth;
00663     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUSIZE)        = (<span class="keywordtype">int</span>) lpnc-&gt;iMenuHeight;
00664     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENU)            = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUSIZE) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00665 
00666     <span class="comment">/*</span>
00667 <span class="comment">     * Border metrics</span>
00668 <span class="comment">     */</span>
00669     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder = (<span class="keywordtype">int</span>) lpnc-&gt;iBorderWidth;
00670 
00671     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFRAME)           = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE) + (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder+1)*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
00672     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYFRAME)           = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE) + (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder+1)*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00673 
00674     <span class="comment">/*</span>
00675 <span class="comment">     * Minimium tracking size is</span>
00676 <span class="comment">     *      Across:  Space for small icon, 4 chars &amp; space + 3 buttons + borders</span>
00677 <span class="comment">     *      Down:    Space for caption + borders</span>
00678 <span class="comment">     * Yes, we use CYSIZE.  This is because the width of any small icon</span>
00679 <span class="comment">     * is the same as the height, and the height is CYSIZE.</span>
00680 <span class="comment">     */</span>
00681     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINTRACK)    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE) + (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a132">gcxCaptionFontChar</a> * 4) + 2 * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE) +
00682             (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE) * 3) + (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZEFRAME) * 2);
00683     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINTRACK)    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYCAPTION) + (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZEFRAME) * 2);
00684 
00685     <span class="comment">/*</span>
00686 <span class="comment">     * Max track size</span>
00687 <span class="comment">     * Yeah, max track is bigger than maximized.  The reason why is the DOS</span>
00688 <span class="comment">     * box.  It has a normal sizing border plus the sunken edge around the</span>
00689 <span class="comment">     * client.  We need to make this big enough to allow the dos box to grow.</span>
00690 <span class="comment">     * When it hits its max size, it maximizes automatically.</span>
00691 <span class="comment">     */</span>
00692     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMAXTRACK)    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVIRTUALSCREEN) + (2 * (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZEFRAME) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE)));
00693     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMAXTRACK)    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYVIRTUALSCREEN) + (2 * (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZEFRAME) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE)));
00694 
00695     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMIN) = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINTRACK);
00696     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMIN) = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINTRACK);
00697 
00698     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINIMIZED) = 2*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYFIXEDFRAME) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE);
00699 
00700     <span class="comment">/*</span>
00701 <span class="comment">     * Desktop stuff--working area</span>
00702 <span class="comment">     */</span>
00703     bSetDevDragWidth(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>,
00704                      <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder + <a class="code" href="../../d4/d1/userk_8h.html#a740">BORDER_EXTRA</a>);
00705 
00706     <a class="code" href="../../d4/d5/rare_8c.html#a14">SetDesktopMetrics</a>();
00707 }
00708 
00709 
00710 
00711 <span class="comment">/***************************************************************************\</span>
00712 <span class="comment">*</span>
00713 <span class="comment">*  CreateFontFromWinIni() -</span>
00714 <span class="comment">*</span>
00715 <span class="comment">*  If lplf is NULL, we do a first time, default initialization.</span>
00716 <span class="comment">*  Otherwise, lplf is a pointer to the logfont we will use.</span>
00717 <span class="comment">*</span>
00718 <span class="comment">\***************************************************************************/</span>
<a name="l00719"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a12">00719</a> HFONT <a class="code" href="../../d4/d1/userk_8h.html#a1855">CreateFontFromWinIni</a>(
00720     PUNICODE_STRING pProfileUserName,
00721     LPLOGFONTW      lplf,
00722     UINT            idFont)
00723 {
00724     LOGFONTW <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
00725     HFONT   hFont;
00726 
00727     <span class="keywordflow">if</span> (lplf == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00728         <span class="keyword">static</span> CONST WCHAR szDefFont[] = TEXT(<span class="stringliteral">"MS Shell Dlg"</span>);
00729         <span class="comment">/*</span>
00730 <span class="comment">         * Fill logfont w/ 0 so we can check if values were filled in.</span>
00731 <span class="comment">         */</span>
00732         lplf = &amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
00733         RtlZeroMemory(&amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>));
00734         <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfCharSet = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a71">gSystemCPCharSet</a>;
00735 
00736         <a class="code" href="../../d4/d1/userk_8h.html#a2013">FastGetProfileValue</a>(pProfileUserName,<a class="code" href="../../d4/d1/userk_8h.html#a718">PMAP_METRICS</a>, (LPWSTR)UIntToPtr( idFont ), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, (LPBYTE)&amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>));
00737 
00738         <span class="comment">/*</span>
00739 <span class="comment">         * Default font is MS Shell Dlg</span>
00740 <span class="comment">         */</span>
00741         <span class="keywordflow">if</span> (! <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfFaceName[0]) {
00742             RtlCopyMemory(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfFaceName, szDefFont, <span class="keyword">sizeof</span>(szDefFont));
00743         }
00744 
00745         <span class="comment">/*</span>
00746 <span class="comment">         * Warning! these values are different then Win 95.  They did not have a True Type</span>
00747 <span class="comment">         * font so they would round up when they asked for a 6 pt font.  We have to ask</span>
00748 <span class="comment">         * for an 8 point font ICONFONT to be the same.</span>
00749 <span class="comment">         */</span>
00750         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfHeight) {
00751             <span class="keywordflow">switch</span> (idFont) {
00752                 <span class="keywordflow">case</span> STR_SMCAPTIONFONT:
00753                 <span class="keywordflow">case</span> STR_MINFONT:
00754                 <span class="keywordflow">case</span> STR_ICONFONT:
00755                 <span class="keywordflow">default</span>:
00756                     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfHeight = 8;
00757                     <span class="keywordflow">break</span>;
00758             }
00759         }
00760 
00761         <span class="comment">/*</span>
00762 <span class="comment">         * We need to convert the point size properly.  GDI expects a</span>
00763 <span class="comment">         * height in pixels, not points.</span>
00764 <span class="comment">         */</span>
00765         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfHeight &gt; 0) {
00766             <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfHeight = -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfHeight, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dmLogPixels, 72);
00767         }
00768 
00769         <span class="keywordflow">if</span> (! <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfWeight) {
00770             <span class="keywordflow">switch</span> (idFont) {
00771                 <span class="keywordflow">case</span> STR_CAPTIONFONT:
00772                 <span class="keywordflow">case</span> STR_MINFONT:
00773                     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfWeight = FW_BOLD;
00774                     <span class="keywordflow">break</span>;
00775 
00776                 <span class="keywordflow">default</span>:
00777                     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfWeight = FW_NORMAL;
00778                     <span class="keywordflow">break</span>;
00779             }
00780         }
00781 
00782         <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfOutPrecision = OUT_DEFAULT_PRECIS;
00783         <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfClipPrecision = CLIP_DEFAULT_PRECIS;
00784         <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfQuality = DEFAULT_QUALITY;
00785     }
00786 
00787 
00788     hFont = GreCreateFontIndirectW(lplf);
00789 
00790     <span class="keywordflow">if</span> (hFont) {
00791         LOGFONTW lfT;
00792 
00793         GreExtGetObjectW(hFont, <span class="keyword">sizeof</span>(LOGFONTW), &amp;lfT);
00794         <span class="keywordflow">if</span> (lfT.lfHeight != lplf-&gt;lfHeight) {
00795             <span class="comment">/*</span>
00796 <span class="comment">             * Couldn't find a font with the height that we</span>
00797 <span class="comment">             * wanted so use the system font instead.</span>
00798 <span class="comment">             */</span>
00799             GreDeleteObject(hFont);
00800             hFont = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00801         } <span class="keywordflow">else</span> {
00802             GreMarkUndeletableFont(hFont);
00803             GreSetLFONTOwner((HLFONT)hFont, OBJECT_OWNER_PUBLIC);
00804         }
00805     }
00806 
00807     <span class="keywordflow">if</span> (!hFont) {
00808         <span class="comment">/*</span>
00809 <span class="comment">         * We've tried to create the font from the app-supplied description.</span>
00810 <span class="comment">         * If failure, return NULL so that we don't change the previous</span>
00811 <span class="comment">         * font.</span>
00812 <span class="comment">         */</span>
00813         <span class="keywordflow">if</span> (lplf)
00814             hFont = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00815         <span class="keywordflow">else</span>
00816             hFont = <a class="code" href="../../d1/d8/clglobal_8c.html#a28">ghFontSys</a>;
00817     }
00818 
00819     <span class="keywordflow">return</span> hFont;
00820 }
00821 
00822 
00823 <span class="comment">/***************************************************************************\</span>
00824 <span class="comment">*</span>
00825 <span class="comment">\***************************************************************************/</span>
00826 
<a name="l00827"></a><a class="code" href="../../d4/d1/userk_8h.html#a1993">00827</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1993">UserSetFont</a>(
00828     PUNICODE_STRING pProfileUserName,
00829     LPLOGFONTW      lplf,
00830     UINT            idFont,
00831     HFONT*          phfont)
00832 {
00833     HFONT hNewFont;
00834 
00835     <span class="keywordflow">if</span> (hNewFont = <a class="code" href="../../d4/d1/userk_8h.html#a1855">CreateFontFromWinIni</a>(pProfileUserName, lplf, idFont)) {
00836         <span class="keywordflow">if</span> (*phfont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; *phfont != <a class="code" href="../../d1/d8/clglobal_8c.html#a28">ghFontSys</a>) {
00837             GreMarkDeletableFont(*phfont);
00838             GreDeleteObject(*phfont);
00839         }
00840 
00841         *phfont = hNewFont;
00842         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00843     }
00844     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00845 }
00846 
00847 <span class="comment">/***************************************************************************\</span>
00848 <span class="comment">*</span>
00849 <span class="comment">*  xxxSetNCFonts() -</span>
00850 <span class="comment">*</span>
00851 <span class="comment">*  Creates fonts to be used in the frame components:</span>
00852 <span class="comment">*          Caption</span>
00853 <span class="comment">*          Small caption</span>
00854 <span class="comment">*          Menu</span>
00855 <span class="comment">*          Minimized</span>
00856 <span class="comment">*          Icon</span>
00857 <span class="comment">*</span>
00858 <span class="comment">*  01-21-98    [SamerA]   Renamed to xxxSetNCFonts since it may leave the</span>
00859 <span class="comment">*                         critical section when a client LPK is installed.</span>
00860 <span class="comment">\***************************************************************************/</span>
<a name="l00861"></a><a class="code" href="../../d4/d1/userk_8h.html#a1859">00861</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1859">xxxSetNCFonts</a>(
00862     PUNICODE_STRING    pProfileUserName,
00863     LPNONCLIENTMETRICS lpnc)
00864 {
00865     HFONT      hOldFont;
00866     TEXTMETRIC tm;
00867     LOGFONTW   <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
00868     LPLOGFONTW lplf = (lpnc) ? &amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a> : 0;
00869 
00870     <span class="comment">/*</span>
00871 <span class="comment">     * Caption font</span>
00872 <span class="comment">     */</span>
00873     <span class="keywordflow">if</span> (lplf) {
00874        *lplf = lpnc-&gt;lfCaptionFont;
00875     }
00876 
00877     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1993">UserSetFont</a>(pProfileUserName,lplf, STR_CAPTIONFONT, &amp;<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hCaptionFont)) {
00878         RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxSetNCFonts failed for gpsi-&gt;hCaptionFont"</span>);
00879         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00880     }
00881 
00882     hOldFont = GreSelectFont(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hCaptionFont);
00883     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a132">gcxCaptionFontChar</a> = <a class="code" href="../../d9/d6/kernel_2server_8c.html#a72">GetCharDimensions</a>(
00884             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a133">gcyCaptionFontChar</a>);
00885 
00886     <span class="comment">/*</span>
00887 <span class="comment">     * Small caption font</span>
00888 <span class="comment">     */</span>
00889     <span class="keywordflow">if</span> (lplf) {
00890        *lplf = lpnc-&gt;lfSmCaptionFont;
00891     }
00892 
00893     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1993">UserSetFont</a>(pProfileUserName,lplf, STR_SMCAPTIONFONT, &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a134">ghSmCaptionFont</a>)) {
00894         RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxSetNCFonts failed for ghSmCaptionFont"</span>);
00895         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00896     }
00897 
00898     GreSelectFont(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a134">ghSmCaptionFont</a>);
00899     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a135">gcxSmCaptionFontChar</a> = <a class="code" href="../../d9/d6/kernel_2server_8c.html#a72">GetCharDimensions</a>(
00900             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a136">gcySmCaptionFontChar</a>);
00901 
00902     <span class="comment">/*</span>
00903 <span class="comment">     * Menu font</span>
00904 <span class="comment">     */</span>
00905     <span class="keywordflow">if</span> (lplf) {
00906        *lplf = lpnc-&gt;lfMenuFont;
00907     }
00908 
00909     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1993">UserSetFont</a>(pProfileUserName,lplf, STR_MENUFONT, &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a137">ghMenuFont</a>)) {
00910         RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxSetNCFonts failed for ghMenuFont"</span>);
00911         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00912     }
00913 
00914     <span class="comment">/*</span>
00915 <span class="comment">     * if ghMenuFont is selected in cached animation DC, select the new one.</span>
00916 <span class="comment">     */</span>
00917     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a146">gMenuState</a>.hdcAni != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00918         GreSelectFont(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a146">gMenuState</a>.hdcAni, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a137">ghMenuFont</a>);
00919     }
00920 
00921     GreSelectFont(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a137">ghMenuFont</a>);
00922     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a139">gcxMenuFontChar</a> = <a class="code" href="../../d9/d6/kernel_2server_8c.html#a72">GetCharDimensions</a>(
00923             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), &amp;tm, &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a140">gcyMenuFontChar</a>);
00924     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a141">gcxMenuFontOverhang</a> = tm.tmOverhang;
00925 
00926     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a> = tm.tmExternalLeading;
00927     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a144">gcyMenuScrollArrow</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a140">gcyMenuFontChar</a> + <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
00928     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a143">gcyMenuFontAscent</a> = tm.tmAscent;
00929 
00930     <span class="comment">/*</span>
00931 <span class="comment">     * We only use gcyMenuFontAscent in mndraw.c once, and in U.S. we</span>
00932 <span class="comment">     * always add on CYBORDER!  So calculate gcyMenuFontAscent+CYBORDER</span>
00933 <span class="comment">     * once only.</span>
00934 <span class="comment">     * Legacy NT4: For Korean version, don't add it on; the underline would</span>
00935 <span class="comment">     * be too low.</span>
00936 <span class="comment">     * NT5: according to #254327, Korean version now sees underline is</span>
00937 <span class="comment">     * too close to menu strings. Korean hack is pulled out so.</span>
00938 <span class="comment">     */</span>
00939     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a143">gcyMenuFontAscent</a> += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00940 
00941     <span class="comment">/*</span>
00942 <span class="comment">     * Default menu item font:  bolder version of menu font</span>
00943 <span class="comment">     */</span>
00944 
00945     <span class="comment">/*</span>
00946 <span class="comment">     * Create default menu font by bolding hMenuFont.  If this doesn't</span>
00947 <span class="comment">     * work, then fall back to using simulation.</span>
00948 <span class="comment">     */</span>
00949     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a138">ghMenuFontDef</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a138">ghMenuFontDef</a> != <a class="code" href="../../d1/d8/clglobal_8c.html#a28">ghFontSys</a>) {
00950         GreMarkDeletableFont(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a138">ghMenuFontDef</a>);
00951         GreDeleteObject(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a138">ghMenuFontDef</a>);
00952         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a138">ghMenuFontDef</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00953     }
00954 
00955     GreExtGetObjectW(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a137">ghMenuFont</a>, <span class="keyword">sizeof</span>(LOGFONTW), &amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>);
00956     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfWeight &lt; FW_BOLD) {
00957         <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfWeight += 200;
00958 
00959         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a138">ghMenuFontDef</a> = GreCreateFontIndirectW(&amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>);
00960         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a138">ghMenuFontDef</a>) {
00961             GreMarkUndeletableFont(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a138">ghMenuFontDef</a>);
00962             GreSetLFONTOwner((HLFONT)<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a138">ghMenuFontDef</a>, OBJECT_OWNER_PUBLIC);
00963         }
00964     }
00965 
00966     <span class="comment">/*</span>
00967 <span class="comment">     * Status Bar font</span>
00968 <span class="comment">     */</span>
00969     <span class="keywordflow">if</span> (lplf) {
00970        *lplf = lpnc-&gt;lfStatusFont;
00971     }
00972 
00973     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1993">UserSetFont</a>(pProfileUserName,lplf, STR_STATUSFONT, &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a147">ghStatusFont</a>)) {
00974         RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxSetNCFonts failed for ghStatusFont"</span>);
00975         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00976     }
00977 
00978     <span class="comment">/*</span>
00979 <span class="comment">     * Message Box font</span>
00980 <span class="comment">     */</span>
00981     <span class="keywordflow">if</span> (lplf) {
00982        *lplf = lpnc-&gt;lfMessageFont;
00983     }
00984 
00985     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1993">UserSetFont</a>(pProfileUserName,lplf, STR_MESSAGEFONT, &amp;<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hMsgFont)) {
00986         RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxSetNCFonts failed for gpsi-&gt;hMsgFont"</span>);
00987         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00988     }
00989 
00990     GreSelectFont(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hMsgFont);
00991     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cxMsgFontChar = <a class="code" href="../../d9/d6/kernel_2server_8c.html#a72">GetCharDimensions</a>(
00992             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cyMsgFontChar);
00993 
00994     <span class="comment">/*</span>
00995 <span class="comment">     * Recalculate length of the widest MessageBox button</span>
00996 <span class="comment">     * Make sure the width is no less than DU_BTNWIDTH dialog units MCostea #170582</span>
00997 <span class="comment">     */</span>
00998     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o16">wMaxBtnSize</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a852">XPixFromXDU</a>(<a class="code" href="../../d1/d1/inctlpan_8c.html#a1">DU_BTNWIDTH</a>, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cxMsgFontChar),
00999                             <a class="code" href="../../d1/d1/inctlpan_8c.html#a5">xxxMB_FindLongestString</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>()));
01000     GreSelectFont(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), hOldFont);
01001 
01002     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01003 }
01004 
01005 
01006 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l01007"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a15">01007</a> <a class="code" href="../../d1/d1/inctlpan_8c.html#a15">SetIconFonts</a>(
01008     PUNICODE_STRING pProfileUserName,
01009     LPICONMETRICS   lpicon)
01010 {
01011     LOGFONTW     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
01012     LPLOGFONTW   lplf = 0;
01013 
01014     <span class="keywordflow">if</span> (lpicon) {
01015         lplf = &amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
01016         <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a> = lpicon-&gt;lfFont;
01017     }
01018 
01019     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1993">UserSetFont</a>(pProfileUserName, lplf, STR_ICONFONT, &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a148">ghIconFont</a>);
01020 }
01021 
01022 <span class="comment">/***************************************************************************\</span>
01023 <span class="comment">* GetWindowMetrics</span>
01024 <span class="comment">*</span>
01025 <span class="comment">* Retrieve the current NC metrics.</span>
01026 <span class="comment">*</span>
01027 <span class="comment">*</span>
01028 <span class="comment">\***************************************************************************/</span>
01029 
<a name="l01030"></a><a class="code" href="../../d4/d1/userk_8h.html#a1854">01030</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a1854">GetWindowNCMetrics</a>(
01031     LPNONCLIENTMETRICS lpnc)
01032 {
01033     lpnc-&gt;cbSize           = <span class="keyword">sizeof</span>(NONCLIENTMETRICS);
01034     lpnc-&gt;iBorderWidth     = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder;
01035     lpnc-&gt;iScrollWidth     = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVSCROLL);
01036     lpnc-&gt;iScrollHeight    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYVSCROLL);
01037     lpnc-&gt;iCaptionWidth    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE);
01038     lpnc-&gt;iCaptionHeight   = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE);
01039     lpnc-&gt;iSmCaptionWidth  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMSIZE);
01040     lpnc-&gt;iSmCaptionHeight = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMSIZE);
01041     lpnc-&gt;iMenuWidth       = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMENUSIZE);
01042     lpnc-&gt;iMenuHeight      = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUSIZE);
01043 
01044     <span class="comment">/*</span>
01045 <span class="comment">     * Get the font info.</span>
01046 <span class="comment">     */</span>
01047     GreExtGetObjectW(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hCaptionFont,
01048                      <span class="keyword">sizeof</span>(LOGFONTW),
01049                      &amp;(lpnc-&gt;lfCaptionFont));
01050 
01051     GreExtGetObjectW(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a134">ghSmCaptionFont</a>,
01052                      <span class="keyword">sizeof</span>(LOGFONTW),
01053                      &amp;(lpnc-&gt;lfSmCaptionFont));
01054 
01055     GreExtGetObjectW(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a137">ghMenuFont</a>,
01056                      <span class="keyword">sizeof</span>(LOGFONTW),
01057                      &amp;(lpnc-&gt;lfMenuFont));
01058 
01059     GreExtGetObjectW(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a147">ghStatusFont</a>,
01060                      <span class="keyword">sizeof</span>(LOGFONTW),
01061                      &amp;(lpnc-&gt;lfStatusFont));
01062 
01063     GreExtGetObjectW(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hMsgFont,
01064                      <span class="keyword">sizeof</span>(LOGFONTW),
01065                      &amp;(lpnc-&gt;lfMessageFont));
01066 }
01067 
01068 <span class="comment">/***************************************************************************\</span>
01069 <span class="comment">*</span>
01070 <span class="comment">*  xxxSetWindowMetrics() -</span>
01071 <span class="comment">*</span>
01072 <span class="comment">*  creates system fonts and bitmaps and sets the system metrics based on the</span>
01073 <span class="comment">*  values of the given FRAMEMETRICS struct.  If NULL is passed in, the</span>
01074 <span class="comment">*  default values (found in WIN.INI) are used instead.</span>
01075 <span class="comment">*</span>
01076 <span class="comment">*  01-21-98   [SamerA]  Renamed to xxxSetWinowMetrics since it may leave the</span>
01077 <span class="comment">*                       critical section if an LPK is installed.</span>
01078 <span class="comment">\***************************************************************************/</span>
01079 
<a name="l01080"></a><a class="code" href="../../d4/d1/userk_8h.html#a1857">01080</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1857">xxxSetWindowNCMetrics</a>(
01081     PUNICODE_STRING    pProfileUserName,
01082     LPNONCLIENTMETRICS lpnc,
01083     BOOL               fSizeChange,
01084     <span class="keywordtype">int</span>                clNewBorder)
01085 {
01086     NONCLIENTMETRICS    nc;
01087     <span class="keywordtype">int</span>                 cxEdge4;
01088 
01089     <span class="keywordflow">if</span> (fSizeChange) {
01090         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1859">xxxSetNCFonts</a>(pProfileUserName, lpnc)) {
01091             RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxSetWindowNCMetrics failed in xxxSetNCFonts"</span>);
01092             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01093         }
01094 
01095         <span class="keywordflow">if</span> (lpnc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01096             <span class="keywordflow">if</span> (clNewBorder &lt; 0)
01097                 nc.iBorderWidth = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_BORDERWIDTH, 1);
01098             <span class="keywordflow">else</span>
01099                 nc.iBorderWidth = clNewBorder;
01100 
01101             nc.iScrollWidth     = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_SCROLLWIDTH, 16       );
01102             nc.iScrollHeight    = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_SCROLLHEIGHT, 16      );
01103             nc.iCaptionWidth    = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_CAPTIONWIDTH, 18      );
01104             nc.iCaptionHeight   = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_CAPTIONHEIGHT, 18     );
01105             nc.iSmCaptionWidth  = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_SMCAPTIONWIDTH, 13    );
01106             nc.iSmCaptionHeight = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_SMCAPTIONHEIGHT, 13   );
01107             nc.iMenuWidth       = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_MENUWIDTH, 18         );
01108             nc.iMenuHeight      = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_MENUHEIGHT, 18        );
01109 
01110             lpnc = &amp;nc;
01111         }
01112 
01113         <span class="comment">/*</span>
01114 <span class="comment">         * SANITY CHECK for metric values</span>
01115 <span class="comment">         */</span>
01116         cxEdge4 = 4 * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
01117 
01118         <span class="comment">/*</span>
01119 <span class="comment">         * Border</span>
01120 <span class="comment">         */</span>
01121         lpnc-&gt;iBorderWidth = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpnc-&gt;iBorderWidth, 1);
01122         lpnc-&gt;iBorderWidth = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(lpnc-&gt;iBorderWidth, 50);
01123 
01124         <span class="comment">/*</span>
01125 <span class="comment">         * Scrollbar</span>
01126 <span class="comment">         */</span>
01127         lpnc-&gt;iScrollWidth  = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpnc-&gt;iScrollWidth,  cxEdge4);
01128         lpnc-&gt;iScrollHeight = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpnc-&gt;iScrollHeight, 4 * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE));
01129 
01130         <span class="comment">/*</span>
01131 <span class="comment">         * Caption -- Buttons must be wide enough to draw edges, and text</span>
01132 <span class="comment">         * area must be tall enough to fit caption font with a border above</span>
01133 <span class="comment">         * and below.  If we have to reset the caption height, should we</span>
01134 <span class="comment">         * reset the button width as well?</span>
01135 <span class="comment">         */</span>
01136         lpnc-&gt;iCaptionWidth  = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpnc-&gt;iCaptionWidth,  cxEdge4);
01137         lpnc-&gt;iCaptionHeight = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpnc-&gt;iCaptionHeight, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a133">gcyCaptionFontChar</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE));
01138 
01139         <span class="comment">/*</span>
01140 <span class="comment">         * Small caption -- Buttons must be wide enough to draw edges, and</span>
01141 <span class="comment">         * text area must be tall enough to fit small caption font with a</span>
01142 <span class="comment">         * border above and below.  Again, if we have to reset the height,</span>
01143 <span class="comment">         * reset the width as well?</span>
01144 <span class="comment">         */</span>
01145         lpnc-&gt;iSmCaptionWidth  = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpnc-&gt;iSmCaptionWidth,  cxEdge4);
01146         lpnc-&gt;iSmCaptionHeight = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpnc-&gt;iSmCaptionHeight, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a136">gcySmCaptionFontChar</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE));
01147 
01148         <span class="comment">/*</span>
01149 <span class="comment">         * Menu -- Buttons must be wide enough to draw edges, and text</span>
01150 <span class="comment">         * area must be tall enough to fit menu font with underscore.</span>
01151 <span class="comment">         */</span>
01152         lpnc-&gt;iMenuWidth  = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpnc-&gt;iMenuWidth,  cxEdge4);
01153         lpnc-&gt;iMenuHeight = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpnc-&gt;iMenuHeight, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a140">gcyMenuFontChar</a> + <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a142">gcyMenuFontExternLeading</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE));
01154 
01155         <span class="comment">/*</span>
01156 <span class="comment">         * SET UP SYSTEM METRIC VALUES</span>
01157 <span class="comment">         */</span>
01158         <a class="code" href="../../d1/d1/inctlpan_8c.html#a11">SetNCMetrics</a>(lpnc);
01159     }
01160 
01161     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1860">CreateBitmapStrip</a>()) {
01162         RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateBitmapStrip failed"</span>);
01163         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01164     }
01165 
01166     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01167 }
01168 
01169 
<a name="l01170"></a><a class="code" href="../../d4/d1/userk_8h.html#a1856">01170</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a1856">SetMinMetrics</a>(
01171     PUNICODE_STRING    pProfileUserName,
01172     LPMINIMIZEDMETRICS lpmin)
01173 {
01174     MINIMIZEDMETRICS <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>;
01175 
01176     <span class="keywordflow">if</span> (!lpmin) {
01177 
01178         <span class="comment">/*</span>
01179 <span class="comment">         * Minimized</span>
01180 <span class="comment">         */</span>
01181         <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>.iWidth   = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_MINWIDTH,   154);
01182         <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>.iHorzGap = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_MINHORZGAP, 0);
01183         <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>.iVertGap = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_MINVERTGAP, 0);
01184         <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>.iArrange = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,STR_MINARRANGE, ARW_BOTTOMLEFT | ARW_RIGHT);
01185         lpmin = &amp;<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>;
01186     }
01187 
01188     <span class="comment">/*</span>
01189 <span class="comment">     * SANITY CHECK for metric values</span>
01190 <span class="comment">     */</span>
01191 
01192     <span class="comment">/*</span>
01193 <span class="comment">     * Minimized window -- Text area must be &gt;= 0, as must gap between</span>
01194 <span class="comment">     * windows horizontally and vertically.</span>
01195 <span class="comment">     */</span>
01196     lpmin-&gt;iWidth    = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpmin-&gt;iWidth, 0);
01197     lpmin-&gt;iHorzGap  = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpmin-&gt;iHorzGap, 0);
01198     lpmin-&gt;iVertGap  = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpmin-&gt;iVertGap, 0);
01199     lpmin-&gt;iArrange &amp;= ARW_VALID;
01200 
01201     <span class="comment">/*</span>
01202 <span class="comment">     * Minimized size</span>
01203 <span class="comment">     */</span>
01204     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINIMIZED) = 2*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME) + (<span class="keywordtype">int</span>) lpmin-&gt;iWidth;
01205     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINIMIZED) = 2*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYFIXEDFRAME) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE);
01206 
01207     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINSPACING) = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINIMIZED) + (<span class="keywordtype">int</span>) lpmin-&gt;iHorzGap;
01208     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINSPACING) = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINIMIZED) + (<span class="keywordtype">int</span>) lpmin-&gt;iVertGap;
01209 
01210     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(ARRANGE) = (<span class="keywordtype">int</span>) lpmin-&gt;iArrange;
01211 }
01212 
<a name="l01213"></a><a class="code" href="../../d4/d1/userk_8h.html#a1858">01213</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1858">SetIconMetrics</a>(
01214     PUNICODE_STRING pProfileUserName,
01215     LPICONMETRICS   lpicon)
01216 {
01217     ICONMETRICS icon;
01218 
01219     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d1/inctlpan_8c.html#a15">SetIconFonts</a>(pProfileUserName,lpicon)) {
01220         RIPMSG0(RIP_WARNING, <span class="stringliteral">"SetIconMetrics failed in SetIconFonts"</span>);
01221         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01222     }
01223 
01224     <span class="keywordflow">if</span> (!lpicon) {
01225 
01226         icon.iTitleWrap   = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,
01227                 STR_ICONTITLEWRAP, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01228 
01229         icon.iHorzSpacing = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,
01230                 STR_ICONHORZSPACING,
01231                 (GreGetDeviceCaps(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), LOGPIXELSX) * 75) / 96);
01232 
01233         icon.iVertSpacing = <a class="code" href="../../d1/d1/inctlpan_8c.html#a4">MetricGetID</a>(pProfileUserName,
01234                 STR_ICONVERTSPACING,
01235                 (GreGetDeviceCaps(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), LOGPIXELSY) * 75) / 96);
01236 
01237         lpicon = &amp;icon;
01238     }
01239 
01240     <span class="comment">/*</span>
01241 <span class="comment">     * SANITY CHECK for metric values</span>
01242 <span class="comment">     */</span>
01243     lpicon-&gt;iHorzSpacing = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpicon-&gt;iHorzSpacing, (<span class="keywordtype">int</span>)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXICON));
01244     lpicon-&gt;iVertSpacing = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(lpicon-&gt;iVertSpacing, (<span class="keywordtype">int</span>)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYICON));
01245 
01246     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXICONSPACING) = (<span class="keywordtype">int</span>) lpicon-&gt;iHorzSpacing;
01247     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYICONSPACING) = (<span class="keywordtype">int</span>) lpicon-&gt;iVertSpacing;
01248     <a class="code" href="../../d4/d1/userk_8h.html#a661">SET_OR_CLEAR_PUDF</a>(<a class="code" href="../../d4/d1/userk_8h.html#a642">PUDF_ICONTITLEWRAP</a>, lpicon-&gt;iTitleWrap);
01249 
01250     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01251 }
01252 
01253 <span class="comment">/***************************************************************************\</span>
01254 <span class="comment">* xxxMB_FindLongestString</span>
01255 <span class="comment">*</span>
01256 <span class="comment">* History:</span>
01257 <span class="comment">* 10-23-90 DarrinM      Ported from Win 3.0 sources.</span>
01258 <span class="comment">* 01-21-98 SamerA       Renamed to xxx since it may leave the crit sec if</span>
01259 <span class="comment">*                       a client LPK is installed</span>
01260 <span class="comment">\***************************************************************************/</span>
01261 
<a name="l01262"></a><a class="code" href="../../d1/d1/inctlpan_8c.html#a5">01262</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d1/d1/inctlpan_8c.html#a5">xxxMB_FindLongestString</a>(HDC hdc)
01263 {
01264     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wRetVal;
01265     <span class="keywordtype">int</span> i, iMaxLen = 0, iNewMaxLen;
01266     LPWSTR pszCurStr, szMaxStr;
01267     SIZE sizeOneChar;
01268     SIZE sizeMaxStr;
01269     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
01270 
01271     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a880">MAX_SEB_STYLES</a>; i++) {
01272         pszCurStr = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a406">GETGPSIMBPSTR</a>(i);
01273         <span class="keywordflow">if</span> ((iNewMaxLen = wcslen(pszCurStr)) &gt; iMaxLen) {
01274             iMaxLen = iNewMaxLen;
01275             szMaxStr = pszCurStr;
01276         }
01277     }
01278 
01279     <span class="comment">/*</span>
01280 <span class="comment">     * Find the longest string</span>
01281 <span class="comment">     */</span>
01282     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(ptiCurrent)) {
01283         <a class="code" href="../../d4/d1/userk_8h.html#a1412">xxxClientGetTextExtentPointW</a>(hdc, (PWSTR)<a class="code" href="../../d1/d8/clglobal_8c.html#a14">szOneChar</a>, 1, &amp;sizeOneChar);
01284     } <span class="keywordflow">else</span> {
01285         GreGetTextExtentW(hdc, (PWSTR)<a class="code" href="../../d1/d8/clglobal_8c.html#a14">szOneChar</a>, 1, &amp;sizeOneChar, GGTE_WIN3_EXTENT);
01286     }
01287     <a class="code" href="../../d4/d1/userk_8h.html#a1408">xxxPSMGetTextExtent</a>(hdc, szMaxStr, iMaxLen, &amp;sizeMaxStr);
01288     wRetVal = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(sizeMaxStr.cx + (sizeOneChar.cx * 2));
01289 
01290     <span class="keywordflow">return</span> wRetVal;
01291 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:21 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
