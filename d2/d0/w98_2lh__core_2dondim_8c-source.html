<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dondim.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dondim.c</h1><a href="../../d1/d1/w98_2lh__core_2dondim_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*</span>
00002 <span class="comment">        File:           LHDoNDim.c</span>
00003 <span class="comment"></span>
00004 <span class="comment">        Contains:       </span>
00005 <span class="comment"></span>
00006 <span class="comment">        Written by:     U. J. Krabbenhoeft</span>
00007 <span class="comment"></span>
00008 <span class="comment">        Copyright:      © 1993-1997 by Heidelberger Druckmaschinen AG, all rights reserved.</span>
00009 <span class="comment"></span>
00010 <span class="comment">        Version:        </span>
00011 <span class="comment">*/</span>
00012 
00013 <span class="preprocessor">#ifndef LHGeneralIncs_h</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#include "General.h"</span>
00015 <span class="preprocessor">#endif</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#ifndef LHDoNDim_h</span>
00018 <span class="preprocessor"></span><span class="preprocessor">#include "DoNDim.h"</span>
00019 <span class="preprocessor">#endif</span>
00020 <span class="preprocessor"></span>
<a name="l00021"></a><a class="code" href="../../d1/d1/w98_2lh__core_2dondim_8c.html#a0">00021</a> <span class="preprocessor">#define SHRINK_FACTOR 13</span>
00022 <span class="preprocessor"></span><span class="comment">/*</span>
00023 <span class="comment">#define FARBR_FILES 1</span>
00024 <span class="comment">#define FARBR_DEBUG 1</span>
00025 <span class="comment">#define FARBR_DEBUG0 1</span>
00026 <span class="comment">*/</span>
00027 <span class="preprocessor">#if FARBR_FILES</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#include "stdio.h"</span>
00029 <span class="preprocessor">#include "string.h"</span>
00030 <span class="keywordtype">void</span> WriteLuts( <span class="keywordtype">char</span> *theName,<span class="keywordtype">long</span> WordSize,<span class="keywordtype">long</span> aElutAdrSize,<span class="keywordtype">long</span> aElutWordSize,UINT16 *Elut,
00031                                 <span class="keywordtype">long</span> aXlutInDim,<span class="keywordtype">long</span> aXlutOutDim,<span class="keywordtype">long</span> aXlutAdrSize,<span class="keywordtype">long</span> aXlutWordSize,UINT16 *Xlut,
00032                                 <span class="keywordtype">long</span> aAlutAdrSize,<span class="keywordtype">long</span> aAlutWordSize,UINT16 *aus_lut);
00033 <span class="preprocessor">#endif</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#if UWEs_eigene_Umgebung</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
00037 <span class="preprocessor">#define DebugPrint printf</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define kThisFile kLHDoNDimID</span>
00041 <span class="preprocessor"></span><span class="comment">/*#include "DebugSpecial.h"*/</span>
00042 <span class="preprocessor">#else</span>
<a name="l00043"></a><a class="code" href="../../d1/d1/w98_2lh__core_2dondim_8c.html#a1">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define DebugPrint(x)</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00046 <span class="preprocessor"></span>
<a name="l00047"></a><a class="code" href="../../d1/d1/w98_2lh__core_2dondim_8c.html#a2">00047</a> <span class="preprocessor">#define CLIPPWord(x,a,b) ((x)&lt;(a)?(UINT16)(a):((x)&gt;(b)?(UINT16)(b):(UINT16)(x+.5)))</span>
<a name="l00048"></a><a class="code" href="../../d1/d1/w98_2lh__core_2dondim_8c.html#a3">00048</a> <span class="preprocessor"></span><span class="preprocessor">#define CLIPP(x,a,b) ((x)&lt;(a)?(a):((x)&gt;(b)?(b):(x)))</span>
00049 <span class="preprocessor"></span><span class="comment">/*#if 0*/</span>
00050 
00051 <span class="comment">/*ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ</span>
00052 <span class="comment">  ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ*/</span>
<a name="l00053"></a><a class="code" href="../../d1/d1/w98_2lh__core_2dondim_8c.html#a4">00053</a> <span class="preprocessor">#define Round(a) (((a)&gt;0.)?((a)+.5):((a)-.5))</span>
00054 <span class="preprocessor"></span>
00055 <span class="comment">/*ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ</span>
00056 <span class="comment">   DoOnlyMatrixForCube</span>
00057 <span class="comment">  ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ*/</span>
<a name="l00058"></a><a class="code" href="../../d1/d1/w98_2lh__core_2dondim_8c.html#a7">00058</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d1/w98_2lh__core_2dondim_8h.html#a3">DoOnlyMatrixForCube</a>( Matrix2D      *theMatrix, Ptr aXlut, <span class="keywordtype">long</span> aPointCount, <span class="keywordtype">long</span> gridPointsCube )
00059 {
00060     <span class="keyword">register</span> <span class="keywordtype">long</span>       ii,jj;
00061     <span class="keyword">register</span> <span class="keywordtype">long</span>       i;
00062     <span class="keyword">register</span> <span class="keywordtype">long</span>       aLong0;
00063     <span class="keyword">register</span> <span class="keywordtype">long</span>       aLong1;
00064     <span class="keyword">register</span> <span class="keywordtype">long</span>       aLong2;
00065     <span class="keyword">register</span> <span class="keywordtype">long</span>       theEnd;
00066     <span class="keyword">register</span> <span class="keywordtype">long</span>       aVal;
00067     <span class="keywordtype">long</span>                        aMatrix[3][3];
00068     <span class="keyword">register</span> <span class="keywordtype">double</span> aFactor,dVal;
00069     <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>     accu,aMax;
00070     <span class="keyword">register</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *theArr = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)aXlut;
00071     <span class="comment">/*   FILE *aSt; */</span>
00072  
00073     
00074 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
00075 <span class="preprocessor"></span>        <span class="keywordtype">long</span> err=0;
00076 <span class="preprocessor">#endif</span>
00077 <span class="preprocessor"></span>        <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"DoOnlyMatrixForCube"</span>)
00078         jj=aPointCount;
00079         theEnd = 3 * aPointCount;
00080         <span class="comment">/*for( i=1; i&lt;100; ++i)if( i*i*i == jj )break;*/</span>                  <span class="comment">/* calculate gridpoints*/</span>
00081         <span class="comment">/*if( i&lt;= 0 || i &gt;= 100 ) return;*/</span>
00082         i = gridPointsCube;
00083         aMax = 256 - 1;
00084         aFactor = 4096.*255./(256.*(i-1)/i);
00085         <span class="keywordflow">for</span>( ii=0; ii&lt;3; ii++){ 
00086                 <span class="keywordflow">for</span>( jj=0; jj&lt;3; jj++){ 
00087                         dVal = (*theMatrix)[ii][jj]*aFactor;
00088                         aMatrix[ii][jj] = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(dVal);
00089                 }
00090         }
00091 <span class="preprocessor">        #if FARBR_DEBUG</span>
00092 <span class="preprocessor"></span>    <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"theArr=(d)"</span>);<span class="keywordflow">for</span>(ii=0; ii&lt;3; ++ii) <span class="keywordflow">for</span>( jj=0; jj&lt;3; jj++) <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%f "</span>,aMatrix[ii][jj]); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00093 <span class="preprocessor">    #endif</span>
00094 <span class="preprocessor"></span>    <span class="comment">/*</span>
00095 <span class="comment">    aSt = fopen("Matrix","a");</span>
00096 <span class="comment">    for(ii=0; ii&lt;3; ++ii) for( jj=0; jj&lt;3; jj++) fprintf(aSt,"%f ",(*(aStructPtr-&gt;theMatrix))[ii][jj]); fprintf(aSt,"\n");</span>
00097 <span class="comment">    for(ii=0; ii&lt;3; ++ii) for( jj=0; jj&lt;3; jj++) fprintf(aSt,"%d ",aMatrix[ii][jj]); fprintf(aSt,"\n");</span>
00098 <span class="comment">        fclose(aSt);</span>
00099 <span class="comment">        */</span>
00100         <span class="keywordflow">for</span> (i = 0; i &lt; theEnd; i +=3){         <span class="comment">/* Schleife der Points */</span>
00101                aLong0=theArr[i+0];
00102                aLong1=theArr[i+1];
00103                aLong2=theArr[i+2];
00104                 <span class="keywordflow">for</span>( ii=0; ii&lt;3; ii++){ 
00105                                 aVal = aMatrix[ii][0] * aLong0;
00106                                 aVal += aMatrix[ii][1] * aLong1;
00107                                 aVal += aMatrix[ii][2] * aLong2;
00108                         <span class="keywordflow">if</span>( aVal &gt; 0) aVal = (aVal+2047)&gt;&gt;12;
00109                         <span class="keywordflow">else</span> aVal = (aVal-2047)&gt;&gt;12;
00110                         accu = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)<a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a2">CLIPP</a>(aVal,0,(<span class="keywordtype">long</span>)aMax);
00111                 theArr[i+ii] = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)accu;
00112                 }
00113 <span class="preprocessor">        #if FARBR_DEBUG</span>
00114 <span class="preprocessor"></span>        <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"i=%ld\n"</span>,i);
00115         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"theArr=(d)"</span>);<span class="keywordflow">for</span>(ii=0; ii&lt;3; ++ii) <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,theArr[i+ii]); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00116         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"ein_reg=(d)"</span>);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong0);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong1);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong2); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00117 <span class="preprocessor">        #endif</span>
00118 <span class="preprocessor"></span>        }
00119 
00120         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"DoOnlyMatrixForCube"</span>)
00121 }
00122 
00123 
<a name="l00124"></a><a class="code" href="../../d1/d1/w98_2lh__core_2dondim_8c.html#a5">00124</a> <span class="preprocessor">#define VAL_MAX 65536</span>
<a name="l00125"></a><a class="code" href="../../d1/d1/w98_2lh__core_2dondim_8c.html#a6">00125</a> <span class="preprocessor"></span><span class="preprocessor">#define VAL_MAXM1 (VAL_MAX-1)</span>
00126 <span class="preprocessor"></span>
00127 <span class="comment">/*ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ</span>
00128 <span class="comment">   DoMatrixForCube16</span>
00129 <span class="comment">  ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ*/</span>
<a name="l00130"></a><a class="code" href="../../d1/d1/w98_2lh__core_2dondim_8c.html#a8">00130</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d1/w98_2lh__core_2dondim_8h.html#a1">DoMatrixForCube16</a>( DoMatrixForCubeStructPtr aStructPtr )
00131 {
00132     <span class="keyword">register</span> <span class="keywordtype">long</span>       ii,jj;
00133     <span class="keyword">register</span> <span class="keywordtype">long</span>       i;
00134     <span class="comment">/*long                      aLong[3];*/</span>
00135     <span class="keyword">register</span> <span class="keywordtype">long</span>       aLong0;
00136     <span class="keyword">register</span> <span class="keywordtype">long</span>       aLong1;
00137     <span class="keyword">register</span> <span class="keywordtype">long</span>       aLong2;
00138     <span class="keyword">register</span> <span class="keywordtype">long</span>       theEnd;
00139     <span class="keyword">register</span> <span class="keywordtype">long</span>       <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>,<a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a>,aAlutShift,aElutOffset,aAlutOffset;
00140     <span class="keyword">register</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>      aElutAdrSize,separateEluts,separateAluts;
00141     <span class="keyword">register</span> <span class="keywordtype">long</span>       aVal;
00142     <span class="keywordtype">long</span>                        aMatrix[3][3];
00143     <span class="keyword">register</span> <span class="keywordtype">double</span> aFactor,dVal;
00144     <span class="keyword">register</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>      aMax;
00145     <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *ein_lut;
00146     <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *aus_lut;
00147     <span class="keyword">register</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *aus_lutByte;
00148     <span class="keyword">register</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> aAlutAdrSize;
00149     <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *theArr;
00150     <span class="keyword">register</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *theByteArr;
00151     <span class="keyword">register</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ko,ko0;
00152     <span class="keyword">register</span> <span class="keywordtype">long</span> aElutShiftRight;
00153     <span class="comment">/*   FILE *aSt;*/</span>
00154  
00155 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
00156 <span class="preprocessor"></span>        <span class="keywordtype">long</span> err=0;
00157 <span class="preprocessor">#endif</span>
00158 <span class="preprocessor"></span>        <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"DoMatrixForCube16"</span>)
00159 
00160     <span class="comment">/*DebugPrint("DoMatrixForCube16 with %d input pixels\n",aPointCount);*/</span>
00161         ein_lut = aStructPtr-&gt;ein_lut;
00162         aus_lut = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)aStructPtr-&gt;aus_lut;
00163         aus_lutByte = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)aus_lut;
00164         theArr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)aStructPtr-&gt;theArr;
00165         theByteArr = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)theArr;
00166         aAlutAdrSize = aStructPtr-&gt;aAlutAdrSize;
00167         aElutAdrSize = aStructPtr-&gt;aElutAdrSize;
00168         separateEluts = aStructPtr-&gt;separateEluts;
00169         separateAluts = aStructPtr-&gt;separateAluts;
00170         theEnd =  3*aStructPtr-&gt;aPointCount;
00171         aMax = aAlutAdrSize-1;
00172         
00173         <span class="keywordflow">for</span>( i=0; i&lt;33; i++) <span class="keywordflow">if</span>( (1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>&lt;&lt;i) == (<span class="keywordtype">long</span>)aElutAdrSize )<span class="keywordflow">break</span>;
00174         <span class="keywordflow">if</span>( i &gt; 32 ) <span class="keywordflow">return</span>;
00175         <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a> = 16-i;
00176         aElutShiftRight = aStructPtr-&gt;aElutWordSize - <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a> + 0; <span class="comment">/* use only 16 bit from elut*/</span>
00177         <span class="keywordflow">if</span>( aElutShiftRight &lt; 0 ) <span class="keywordflow">return</span>;
00178         <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> = 1&lt;&lt;<a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>;
00179         
00180         aFactor = 2*8. * aMax /(aStructPtr-&gt;gridPoints-1)*(<span class="keywordtype">double</span>)aStructPtr-&gt;gridPoints;
00181         <span class="keywordflow">for</span>( ii=0; ii&lt;3; ii++){ 
00182                 <span class="keywordflow">for</span>( jj=0; jj&lt;3; jj++){ 
00183                         dVal = (*(aStructPtr-&gt;theMatrix))[ii][jj]*aFactor;
00184                 aMatrix[ii][jj] = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(dVal);
00185                 }
00186         }
00187 <span class="preprocessor">        #if FARBR_DEBUG</span>
00188 <span class="preprocessor"></span>    <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"theArr=(d)"</span>);<span class="keywordflow">for</span>(ii=0; ii&lt;3; ++ii) <span class="keywordflow">for</span>( jj=0; jj&lt;3; jj++) <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%f "</span>,aMatrix[ii][jj]); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00189     <span class="comment">/*</span>
00190 <span class="comment">    aSt = fopen("Matrix","a");</span>
00191 <span class="comment">    for(ii=0; ii&lt;3; ++ii) for( jj=0; jj&lt;3; jj++) fprintf(aSt,"%f ",(*(aStructPtr-&gt;theMatrix))[ii][jj]); fprintf(aSt,"\n");</span>
00192 <span class="comment">    for(ii=0; ii&lt;3; ++ii) for( jj=0; jj&lt;3; jj++) fprintf(aSt,"%d ",aMatrix[ii][jj]); fprintf(aSt,"\n");</span>
00193 <span class="comment">        fclose(aSt);</span>
00194 <span class="comment">        */</span>
00195 <span class="preprocessor">    #endif</span>
00196 <span class="preprocessor"></span>    <span class="keywordflow">if</span>( aStructPtr-&gt;aBufferByteCount == 2 ){
00197                 aAlutShift = 16-aStructPtr-&gt;aAlutWordSize;
00198                 <span class="keywordflow">for</span> (i = 0; i &lt; theEnd; i +=3){         <span class="comment">/* Schleife der Points */</span>
00199         
00200                         aElutOffset = 0;
00201                         ko = (theArr[i+0]);
00202                         ko0 = ko - ( ko &gt;&gt; ( 16 - <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a> ));
00203                         ko = ko0 &amp; ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - 1 );
00204                         ko0 = ko0 &gt;&gt; <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>;
00205                         <span class="keywordflow">if</span>( ko0 &gt;= (aElutAdrSize-1) ){
00206                                 aLong0 = ein_lut[ ko0 + aElutOffset ]&lt;&lt;(<a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>-aElutShiftRight);
00207                         }
00208                         <span class="keywordflow">else</span>{
00209                                 ko0 += aElutOffset;
00210                         aLong0 = ( ein_lut[ ko0 ] * ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - ko ) + ein_lut[ ko0 + 1 ] * ko )&gt;&gt;aElutShiftRight;
00211                     }   
00212                         <span class="keywordflow">if</span>( separateEluts )aElutOffset += aElutAdrSize;
00213                         
00214                         ko = (theArr[i+1]);
00215                         ko0 = ko - ( ko &gt;&gt; ( 16 - <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a> ));
00216                         ko = ko0 &amp; ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - 1 );
00217                         ko0 = ko0 &gt;&gt; <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>;
00218                         <span class="keywordflow">if</span>( ko0 &gt;= (aElutAdrSize-1) ){
00219                                 aLong1 = ein_lut[ ko0 + aElutOffset ]&lt;&lt;(<a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>-aElutShiftRight);
00220                         }
00221                         <span class="keywordflow">else</span>{
00222                                 ko0 += aElutOffset;
00223                         aLong1 = ( ein_lut[ ko0 ] * ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - ko ) + ein_lut[ ko0 + 1 ] * ko )&gt;&gt;aElutShiftRight;
00224                     }   
00225                         <span class="keywordflow">if</span>( separateEluts )aElutOffset += aElutAdrSize;
00226                         
00227                         ko = (theArr[i+2]);
00228                         ko0 = ko - ( ko &gt;&gt; ( 16 - <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a> ));
00229                         ko = ko0 &amp; ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - 1 );
00230                         ko0 = ko0 &gt;&gt; <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>;
00231                         <span class="keywordflow">if</span>( ko0 &gt;= (aElutAdrSize-1) ){
00232                                 aLong2 = ein_lut[ ko0 + aElutOffset ]&lt;&lt;(<a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>-aElutShiftRight);
00233                         }
00234                         <span class="keywordflow">else</span>{
00235                                 ko0 += aElutOffset;
00236                         aLong2 = ( ein_lut[ ko0 ] * ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - ko ) + ein_lut[ ko0 + 1 ] * ko )&gt;&gt;aElutShiftRight;
00237                     }   
00238                                 
00239                         aLong0 = ( aLong0 +2 )&gt;&gt;2;             
00240                         aLong1 = ( aLong1 +2 )&gt;&gt;2;             
00241                         aLong2 = ( aLong2 +2 )&gt;&gt;2;             
00242                         aAlutOffset = 0;
00243                         <span class="keywordflow">for</span>( ii=0; ii&lt;3; ii++){ 
00244                                         aVal = aMatrix[ii][0] * aLong0;
00245                                         aVal += aMatrix[ii][1] * aLong1;
00246                                         aVal += aMatrix[ii][2] * aLong2;
00247                                 aVal = (aVal+((1&lt;&lt;9)-1))&gt;&gt;10;
00248                                 <span class="keywordflow">if</span>( aVal &lt; 0 ) aVal = 0;
00249                                 
00250                         ko0= ( aVal&gt;&gt; (3+2+3) );
00251                         <span class="keywordflow">if</span>( ko0 &gt;= (aAlutAdrSize-1) ){
00252                                 theArr[i+ii] = aus_lut[ (aAlutAdrSize-1) + aAlutOffset ] &lt;&lt;aAlutShift;
00253                         }
00254                         <span class="keywordflow">else</span>{
00255                                 ko0 += aAlutOffset;
00256                                 ko = ( aVal &amp; ((1&lt;&lt;(3+2+3))-1) );
00257                                 theArr[i+ii] = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aus_lut[ ko0 ] * ( (1&lt;&lt;(3+2+3)) - ko ) + aus_lut[ ko0 +1 ] * ko)&gt;&gt;((3+2+3)-aAlutShift));
00258                                 }
00259                         <span class="keywordflow">if</span>( separateAluts )aAlutOffset += aAlutAdrSize;
00260                         }
00261 <span class="preprocessor">                #if FARBR_DEBUG</span>
00262 <span class="preprocessor"></span>                <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"i=%ld\n"</span>,i);
00263                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"theArr=(d)"</span>);<span class="keywordflow">for</span>(ii=0; ii&lt;3; ++ii) <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,theArr[i+ii]); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00264                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"ein_reg=(d)"</span>);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong0);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong1);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong2); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00265 <span class="preprocessor">                #endif</span>
00266 <span class="preprocessor"></span>                }
00267         }
00268         <span class="keywordflow">else</span>{
00269                 aAlutShift = aStructPtr-&gt;aAlutWordSize - 8;
00270                 <span class="keywordflow">for</span> (i = 0; i &lt; theEnd; i +=3){         <span class="comment">/* Schleife der Points*/</span>
00271         
00272         
00273                         aElutOffset = 0;
00274                         ko = (theArr[i+0]);
00275                         ko0 = ko - ( ko &gt;&gt; ( 16 - <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a> ));
00276                         ko = ko0 &amp; ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - 1 );
00277                         ko0 = ko0 &gt;&gt; <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>;
00278                         <span class="keywordflow">if</span>( ko0 &gt;= (aElutAdrSize-1) ){
00279                                 aLong0 = ein_lut[ ko0 + aElutOffset ]&lt;&lt;(<a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>-aElutShiftRight);
00280                         }
00281                         <span class="keywordflow">else</span>{
00282                                 ko0 += aElutOffset;
00283                         aLong0 = ( ein_lut[ ko0 ] * ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - ko ) + ein_lut[ ko0 + 1 ] * ko )&gt;&gt;aElutShiftRight;
00284                     }   
00285                         <span class="keywordflow">if</span>( separateEluts )aElutOffset += aElutAdrSize;
00286                         
00287                         ko = (theArr[i+1]);
00288                         ko0 = ko - ( ko &gt;&gt; ( 16 - <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a> ));
00289                         ko = ko0 &amp; ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - 1 );
00290                         ko0 = ko0 &gt;&gt; <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>;
00291                         <span class="keywordflow">if</span>( ko0 &gt;= (aElutAdrSize-1) ){
00292                                 aLong1 = ein_lut[ ko0 + aElutOffset ]&lt;&lt;(<a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>-aElutShiftRight);
00293                         }
00294                         <span class="keywordflow">else</span>{
00295                                 ko0 += aElutOffset;
00296                         aLong1 = ( ein_lut[ ko0 ] * ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - ko ) + ein_lut[ ko0 + 1 ] * ko )&gt;&gt;aElutShiftRight;
00297                     }   
00298                         <span class="keywordflow">if</span>( separateEluts )aElutOffset += aElutAdrSize;
00299                         
00300                         ko = (theArr[i+2]);
00301                         ko0 = ko - ( ko &gt;&gt; ( 16 - <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a> ));
00302                         ko = ko0 &amp; ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - 1 );
00303                         ko0 = ko0 &gt;&gt; <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>;
00304                         <span class="keywordflow">if</span>( ko0 &gt;= (aElutAdrSize-1) ){
00305                                 aLong2 = ein_lut[ ko0 + aElutOffset ]&lt;&lt;(<a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a6">aElutShift</a>-aElutShiftRight);
00306                         }
00307                         <span class="keywordflow">else</span>{
00308                                 ko0 += aElutOffset;
00309                         aLong2 = ( ein_lut[ ko0 ] * ( <a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a7">aElutShiftNum</a> - ko ) + ein_lut[ ko0 + 1 ] * ko )&gt;&gt;aElutShiftRight;
00310                     }   
00311                        
00312                         aLong0 = ( aLong0 +2 )&gt;&gt;2;             
00313                         aLong1 = ( aLong1 +2 )&gt;&gt;2;             
00314                         aLong2 = ( aLong2 +2 )&gt;&gt;2;             
00315                         aAlutOffset = 0;
00316                         <span class="keywordflow">if</span>( aStructPtr-&gt;aAlutWordSize &gt; 8 ){
00317                                 <span class="keywordflow">for</span>( ii=0; ii&lt;3; ii++){ 
00318                                                 aVal = aMatrix[ii][0] * aLong0;
00319                                                 aVal += aMatrix[ii][1] * aLong1;
00320                                                 aVal += aMatrix[ii][2] * aLong2;
00321                                         aVal = (aVal+((1&lt;&lt;12)-1))&gt;&gt;13;
00322                                         <span class="keywordflow">if</span>( aVal &lt; 0 ) aVal = 0;
00323                                         
00324                                 ko0= (aVal+((1&lt;&lt;(3+2-1))-1)) &gt;&gt; (3+2);
00325                                 <span class="keywordflow">if</span>( ko0 &gt;= (aAlutAdrSize-1) ){
00326                                         theByteArr[i+ii] = aus_lut[ (aAlutAdrSize-1) + aAlutOffset ] &gt;&gt;aAlutShift;
00327                                 }
00328                                 <span class="keywordflow">else</span>{
00329                                         theByteArr[i+ii] = aus_lut[ ko0 + aAlutOffset ] &gt;&gt;aAlutShift;
00330                                         }
00331                                 <span class="keywordflow">if</span>( separateAluts )aAlutOffset += aAlutAdrSize;
00332                                 }
00333                         }
00334                         <span class="keywordflow">else</span>{
00335                                 <span class="keywordflow">for</span>( ii=0; ii&lt;3; ii++){ 
00336                                                 aVal = aMatrix[ii][0] * aLong0;
00337                                                 aVal += aMatrix[ii][1] * aLong1;
00338                                                 aVal += aMatrix[ii][2] * aLong2;
00339                                         aVal = (aVal+((1&lt;&lt;12)-1))&gt;&gt;13;
00340                                         <span class="keywordflow">if</span>( aVal &lt; 0 ) aVal = 0;
00341                                         
00342                                 ko0= (aVal+((1&lt;&lt;(3+2-1))-1)) &gt;&gt; (3+2);
00343                                 <span class="keywordflow">if</span>( ko0 &gt;= (aAlutAdrSize-1) ){
00344                                         theByteArr[i+ii] = aus_lutByte[ (aAlutAdrSize-1) + aAlutOffset ] ;
00345                                 }
00346                                 <span class="keywordflow">else</span>{
00347                                         theByteArr[i+ii] = aus_lutByte[ ko0 + aAlutOffset ] ;
00348                                         }
00349                                 <span class="keywordflow">if</span>( separateAluts )aAlutOffset += aAlutAdrSize;
00350                                 }
00351                         }
00352 <span class="preprocessor">                #if FARBR_DEBUG</span>
00353 <span class="preprocessor"></span>                <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"i=%ld\n"</span>,i);
00354                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"theArr=(d)"</span>);<span class="keywordflow">for</span>(ii=0; ii&lt;3; ++ii) <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,theArr[i+ii]); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00355                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"ein_reg=(d)"</span>);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong0);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong1);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong2); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00356 <span class="preprocessor">                #endif</span>
00357 <span class="preprocessor"></span>                }
00358         }
00359         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"DoMatrixForCube16"</span>)
00360 }
00361 
<a name="l00362"></a><a class="code" href="../../d1/d1/w98_2lh__core_2dondim_8c.html#a9">00362</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d1/w98_2lh__core_2dondim_8h.html#a2">DoOnlyMatrixForCube16</a>( Matrix2D    *theMatrix, Ptr aXlut, <span class="keywordtype">long</span> aPointCount, <span class="keywordtype">long</span> gridPointsCube )
00363 {
00364     <span class="keyword">register</span> <span class="keywordtype">long</span>       ii,jj;
00365     <span class="keyword">register</span> <span class="keywordtype">long</span>       i;
00366     <span class="keyword">register</span> <span class="keywordtype">long</span>       aLong0;
00367     <span class="keyword">register</span> <span class="keywordtype">long</span>       aLong1;
00368     <span class="keyword">register</span> <span class="keywordtype">long</span>       aLong2;
00369     <span class="keyword">register</span> <span class="keywordtype">long</span>       theEnd;
00370     <span class="keyword">register</span> <span class="keywordtype">long</span>       aVal;
00371     <span class="keywordtype">long</span>                        aMatrix[3][3];
00372     <span class="keyword">register</span> <span class="keywordtype">double</span> aFactor,dVal;
00373     <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>     accu,aMax;
00374     <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *theArr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)aXlut;
00375     <span class="comment">/*   FILE *aSt;*/</span>
00376  
00377     
00378 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
00379 <span class="preprocessor"></span>        <span class="keywordtype">long</span> err = 0;
00380 <span class="preprocessor">#endif</span>
00381 <span class="preprocessor"></span>        <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"DoOnlyMatrixForCube16"</span>)
00382         jj=aPointCount;
00383         theEnd = 3 * aPointCount;
00384         <span class="comment">/*for( i=1; i&lt;100; ++i)if( i*i*i == jj )break; */</span>  <span class="comment">/* calculate gridpoints*/</span>
00385         <span class="comment">/*if( i&lt;= 0 || i &gt;= 100 ) return;*/</span>
00386         i = gridPointsCube;
00387         aMax = <a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a6">VAL_MAXM1</a>;
00388         aFactor = 4096.;
00389         <span class="keywordflow">for</span>( ii=0; ii&lt;3; ii++){ 
00390                 <span class="keywordflow">for</span>( jj=0; jj&lt;3; jj++){ 
00391                         dVal = (*theMatrix)[ii][jj]*aFactor;
00392                         aMatrix[ii][jj] = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(dVal);
00393                 }
00394         }
00395 <span class="preprocessor">        #if FARBR_DEBUG</span>
00396 <span class="preprocessor"></span>    <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"theArr=(d)"</span>);<span class="keywordflow">for</span>(ii=0; ii&lt;3; ++ii) <span class="keywordflow">for</span>( jj=0; jj&lt;3; jj++) <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%f "</span>,aMatrix[ii][jj]); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00397 <span class="preprocessor">    #endif</span>
00398 <span class="preprocessor"></span>    <span class="comment">/*</span>
00399 <span class="comment">    aSt = fopen("Matrix","a");</span>
00400 <span class="comment">    for(ii=0; ii&lt;3; ++ii) for( jj=0; jj&lt;3; jj++) fprintf(aSt,"%f ",(*(aStructPtr-&gt;theMatrix))[ii][jj]); fprintf(aSt,"\n");</span>
00401 <span class="comment">    for(ii=0; ii&lt;3; ++ii) for( jj=0; jj&lt;3; jj++) fprintf(aSt,"%d ",aMatrix[ii][jj]); fprintf(aSt,"\n");</span>
00402 <span class="comment">        fclose(aSt);</span>
00403 <span class="comment">        */</span>
00404         <span class="keywordflow">for</span> (i = 0; i &lt; theEnd; i +=3){         <span class="comment">/* Schleife der Points */</span>
00405                aLong0=theArr[i+0];
00406                aLong1=theArr[i+1];
00407                aLong2=theArr[i+2];
00408                 <span class="keywordflow">for</span>( ii=0; ii&lt;3; ii++){ 
00409                                 aVal = aMatrix[ii][0] * aLong0;
00410                                 aVal += aMatrix[ii][1] * aLong1;
00411                                 aVal += aMatrix[ii][2] * aLong2;
00412                         <span class="keywordflow">if</span>( aVal &gt; 0) aVal = (aVal+2047)&gt;&gt;12;
00413                         <span class="keywordflow">else</span> aVal = (aVal-2047)&gt;&gt;12;
00414                         accu = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)<a class="code" href="../../d6/d3/lh__core_2calcnd3_8c.html#a2">CLIPP</a>(aVal,0,(<span class="keywordtype">long</span>)aMax);
00415                 theArr[i+ii] = accu;
00416                 }
00417 <span class="preprocessor">        #if FARBR_DEBUG</span>
00418 <span class="preprocessor"></span>        <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"i=%ld\n"</span>,i);
00419         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"theArr=(d)"</span>);<span class="keywordflow">for</span>(ii=0; ii&lt;3; ++ii) <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,theArr[i+ii]); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00420         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"ein_reg=(d)"</span>);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong0);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong1);<a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"%ld "</span>,aLong2); <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
00421 <span class="preprocessor">        #endif</span>
00422 <span class="preprocessor"></span>        }
00423         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"DoOnlyMatrixForCube16"</span>)
00424 }
00425 
00426 
00427 <span class="preprocessor">#if FARBR_FILES</span>
00428 <span class="preprocessor"></span><span class="keyword">static</span> FileCount = 0;
00429 <span class="keyword">static</span> FILE *stream1;
00430 
00431 <span class="comment">/*ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ</span>
00432 <span class="comment">   WriteLuts</span>
00433 <span class="comment">  ÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑÑ*/</span>
00434 <span class="keywordtype">void</span> WriteLuts( <span class="keywordtype">char</span> *theName,<span class="keywordtype">long</span> WordSize,<span class="keywordtype">long</span> aElutAdrSize,<span class="keywordtype">long</span> aElutWordSize,UINT16 *Elut,
00435                                 <span class="keywordtype">long</span> aXlutInDim,<span class="keywordtype">long</span> aXlutOutDim,<span class="keywordtype">long</span> aXlutAdrSize,<span class="keywordtype">long</span> aXlutWordSize,UINT16 *Xlut,
00436                                 <span class="keywordtype">long</span> aAlutAdrSize,<span class="keywordtype">long</span> aAlutWordSize,UINT16 *Alut)
00437 {
00438         <span class="keyword">register</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>,i,ii,l,lMax;
00439         <span class="keywordtype">char</span> <a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>[256];
00440         
00441         <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = aElutAdrSize*aXlutInDim;
00442     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(FileNameBuffer,<span class="stringliteral">"%s Elut%d"</span>,theName,FileCount);
00443     stream1=fopen(FileNameBuffer,<span class="stringliteral">"wb"</span>);             <span class="comment">/*  oeffne Schreibedatei            */</span>
00444     <span class="keywordflow">if</span>(stream1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>){
00445         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"Open %s failed \n"</span>,FileNameBuffer);
00446         <span class="keywordflow">return</span>;
00447     }
00448         lMax=0;
00449         <span class="keywordflow">if</span>( 2 == 2 ){ <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>; ++i)<span class="keywordflow">if</span>( lMax &lt; Elut[i] )lMax = Elut[i];}
00450         <span class="keywordflow">else</span>{ <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>; ++i)<span class="keywordflow">if</span>( lMax &lt; ((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)Elut)[i] )lMax = ((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)Elut)[i];}
00451         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(FileNameBuffer,<span class="stringliteral">"%s InputDimension=%d OutputDimension=%d AdrSize=%ld EndWert=%ld WordSize=%ld"</span>,
00452                         FileNameBuffer,aXlutInDim,aXlutInDim,aElutAdrSize,lMax,aElutWordSize);
00453         i=<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>( FileNameBuffer )+1;
00454         <span class="keywordflow">for</span>( ii=i; ii&lt;((i+15)/16)*16; ii++)<a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>[ii-1]=<span class="charliteral">' '</span>;
00455         <a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>[ii-1]=<span class="charliteral">'\0'</span>;
00456         l=fprintf(stream1,<span class="stringliteral">"%s\n"</span>,FileNameBuffer);
00457         
00458     <span class="keywordflow">if</span>(fwrite(Elut,<span class="keyword">sizeof</span>(UINT16),Size,stream1) != <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>){
00459             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"Write Error %s\n"</span>,FileNameBuffer);
00460             <span class="keywordflow">return</span>;
00461     }
00462     fclose(stream1);
00463     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = 1;
00464     <span class="keywordflow">for</span>( i=0; i&lt;aXlutInDim; ++i)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> *= aXlutAdrSize;                   <span class="comment">/* Calc aXlutAdrSize^aXlutInDim */</span>
00465         <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>*aXlutOutDim;
00466     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(FileNameBuffer,<span class="stringliteral">"DoNDim Xlut%d"</span>,FileCount);
00467     stream1=fopen(FileNameBuffer,<span class="stringliteral">"wb"</span>);             <span class="comment">/*  oeffne Schreibedatei            */</span>
00468     <span class="keywordflow">if</span>(stream1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>){
00469         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"Open %s failed \n"</span>,FileNameBuffer);
00470         <span class="keywordflow">return</span>;
00471     }
00472         lMax=0;
00473         <span class="keywordflow">if</span>( WordSize == 2 ){ <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>; ++i)<span class="keywordflow">if</span>( lMax &lt; Xlut[i] )lMax = Xlut[i];}
00474         <span class="keywordflow">else</span>{ <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>; ++i)<span class="keywordflow">if</span>( lMax &lt; ((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)Xlut)[i] )lMax = ((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)Xlut)[i];}
00475         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(FileNameBuffer,<span class="stringliteral">"%s InputDimension=%d OutputDimension=%d AdrSize=%ld EndWert=%ld WordSize=%ld"</span>,
00476                         FileNameBuffer,aXlutInDim,aXlutOutDim,aXlutAdrSize,lMax,aXlutWordSize);
00477         i=<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>( FileNameBuffer )+1;
00478         <span class="keywordflow">for</span>( ii=i; ii&lt;((i+15)/16)*16; ii++)<a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>[ii-1]=<span class="charliteral">' '</span>;
00479         <a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>[ii-1]=<span class="charliteral">'\0'</span>;
00480         l=fprintf(stream1,<span class="stringliteral">"%s\n"</span>,FileNameBuffer);
00481         
00482     <span class="keywordflow">if</span>(fwrite(Xlut,WordSize,Size,stream1) != <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>){
00483             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"Write Error %s\n"</span>,FileNameBuffer);
00484             <span class="keywordflow">return</span>;
00485     }
00486     fclose(stream1);
00487         <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = aAlutAdrSize*aXlutOutDim;
00488     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(FileNameBuffer,<span class="stringliteral">"DoNDim Alut%d"</span>,FileCount);
00489     stream1=fopen(FileNameBuffer,<span class="stringliteral">"wb"</span>);             <span class="comment">/*  oeffne Schreibedatei            */</span>
00490     <span class="keywordflow">if</span>(stream1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>){
00491         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"Open %s failed \n"</span>,FileNameBuffer);
00492         <span class="keywordflow">return</span>;
00493     }
00494         lMax=0;
00495         <span class="keywordflow">if</span>( WordSize == 2 ){ <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>; ++i)<span class="keywordflow">if</span>( lMax &lt; Alut[i] )lMax = Alut[i];}
00496         <span class="keywordflow">else</span>{ <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>; ++i)<span class="keywordflow">if</span>( lMax &lt; ((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)Alut)[i] )lMax = ((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)Alut)[i];}
00497         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(FileNameBuffer,<span class="stringliteral">"%s InputDimension=%d OutputDimension=%d AdrSize=%ld EndWert=%ld WordSize=%ld"</span>,
00498                         FileNameBuffer,aXlutOutDim,aXlutOutDim,aAlutAdrSize,lMax,aAlutWordSize);
00499         i=<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>( FileNameBuffer )+1;
00500         <span class="keywordflow">for</span>( ii=i; ii&lt;((i+15)/16)*16; ii++)<a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>[ii-1]=<span class="charliteral">' '</span>;
00501         <a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>[ii-1]=<span class="charliteral">'\0'</span>;
00502         l=fprintf(stream1,<span class="stringliteral">"%s\n"</span>,FileNameBuffer);
00503         
00504     <span class="keywordflow">if</span>(fwrite(Alut,WordSize,Size,stream1) != <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>){
00505             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"Write Error %s\n"</span>,FileNameBuffer);
00506             <span class="keywordflow">return</span>;
00507     }
00508     fclose(stream1);
00509     FileCount++;
00510 }
00511 <span class="preprocessor">#endif</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:46 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
