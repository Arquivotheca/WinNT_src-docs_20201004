<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: xcpt4.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>xcpt4.c</h1><a href="../../d1/d1/xcpt4_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1990  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    xcpt4.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implements user mode exception tests.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    David N. Cutler (davec) 18-Sep-1990</span>
00016 <span class="comment"></span>
00017 <span class="comment">Environment:</span>
00018 <span class="comment"></span>
00019 <span class="comment">    Kernel mode only.</span>
00020 <span class="comment"></span>
00021 <span class="comment">Revision History:</span>
00022 <span class="comment"></span>
00023 <span class="comment">--*/</span>
00024 
00025 <span class="preprocessor">#include "stdio.h"</span>
00026 <span class="preprocessor">#include "nt.h"</span>
00027 <span class="preprocessor">#include "ntrtl.h"</span>
00028 <span class="preprocessor">#include "setjmpex.h"</span>
00029 
00030 <span class="preprocessor">#include "float.h"</span>
00031 
00032 
00033 
00034 <span class="comment">//</span>
00035 <span class="comment">// Define switch constants.</span>
00036 <span class="comment">//</span>
00037 
<a name="l00038"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a0">00038</a> <span class="preprocessor">#define BLUE 0</span>
<a name="l00039"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a1">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define RED 1</span>
00040 <span class="preprocessor"></span>
00041 <span class="comment">//</span>
00042 <span class="comment">// Define function prototypes.</span>
00043 <span class="comment">//</span>
00044 
00045 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00046 <a class="code" href="../../d1/d1/xcpt4_8c.html#a21">addtwo</a> (
00047     IN LONG First,
00048     IN LONG Second,
00049     IN PLONG Place
00050     );
00051 
00052 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00053 <a class="code" href="../../d1/d1/xcpt4_8c.html#a3">bar1</a> (
00054     IN NTSTATUS Status,
00055     IN PLONG Counter
00056     );
00057 
00058 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00059 <a class="code" href="../../d1/d1/xcpt4_8c.html#a4">bar2</a> (
00060     IN PLONG BlackHole,
00061     IN PLONG BadAddress,
00062     IN PLONG Counter
00063     );
00064 
00065 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00066 <a class="code" href="../../d1/d1/xcpt4_8c.html#a5">dojump</a> (
00067     IN jmp_buf JumpBuffer,
00068     IN PLONG Counter
00069     );
00070 
00071 LONG
00072 <a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a>(
00073     IN LONG Value
00074     );
00075 
00076 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00077 <a class="code" href="../../d2/d3/utxcpt4_8c.html#a2">eret</a> (
00078     IN NTSTATUS Status,
00079     IN PLONG Counter
00080     );
00081 
00082 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00083 <a class="code" href="../../d1/d1/xcpt4_8c.html#a8">except1</a> (
00084     IN PLONG Counter
00085     );
00086 
00087 ULONG
00088 <a class="code" href="../../d1/d1/xcpt4_8c.html#a9">except2</a> (
00089     IN PEXCEPTION_POINTERS ExceptionPointers,
00090     IN PLONG Counter
00091     );
00092 
00093 ULONG
00094 <a class="code" href="../../d1/d1/xcpt4_8c.html#a10">except3</a> (
00095     IN PEXCEPTION_POINTERS ExceptionPointers,
00096     IN PLONG Counter
00097     );
00098 
00099 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00100 <a class="code" href="../../d1/d1/xcpt4_8c.html#a11">foo1</a> (
00101     IN NTSTATUS Status
00102     );
00103 
00104 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00105 <a class="code" href="../../d1/d1/xcpt4_8c.html#a12">foo2</a> (
00106     IN PLONG BlackHole,
00107     IN PLONG BadAddress
00108     );
00109 
00110 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00111 <a class="code" href="../../d2/d3/utxcpt4_8c.html#a4">fret</a> (
00112     IN PLONG Counter
00113     );
00114 
00115 BOOLEAN
00116 <a class="code" href="../../d2/d3/utxcpt4_8c.html#a7">Tkm</a> (
00117     VOID
00118     );
00119 
00120 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00121 <a class="code" href="../../d1/d1/xcpt4_8c.html#a15">Test61Part2</a> (
00122     IN OUT PULONG Counter
00123     );
00124 
00125 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00126 <a class="code" href="../../d1/d1/xcpt4_8c.html#a20">PerformFpTest</a>(
00127     VOID
00128     );
00129 
00130 <span class="keywordtype">double</span>
00131 <a class="code" href="../../d1/d1/xcpt4_8c.html#a17">SquareDouble</a> (
00132     IN <span class="keywordtype">double</span>   op
00133     );
00134 
00135 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00136 <a class="code" href="../../d1/d1/xcpt4_8c.html#a18">SquareDouble17E300</a> (
00137     OUT PVOID   ans
00138     );
00139 
00140 
00141 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00142 __cdecl
<a name="l00143"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a19">00143</a> <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(
00144     <span class="keywordtype">int</span> argc,
00145     <span class="keywordtype">char</span> *argv[]
00146     )
00147 
00148 {
00149 
00150     PLONG BadAddress;
00151     PCHAR BadByte;
00152     PLONG BlackHole;
00153     ULONG Index1;
00154     ULONG Index2 = <a class="code" href="../../d1/d1/xcpt4_8c.html#a1">RED</a>;
00155     jmp_buf JumpBuffer;
00156     LONG Counter;
00157     EXCEPTION_RECORD ExceptionRecord;
00158     <span class="keywordtype">double</span>  doubleresult;
00159 
00160     <span class="comment">//</span>
00161     <span class="comment">// Announce start of exception test.</span>
00162     <span class="comment">//</span>
00163 
00164     printf(<span class="stringliteral">"Start of exception test\n"</span>);
00165 
00166     <span class="comment">//</span>
00167     <span class="comment">// Initialize exception record.</span>
00168     <span class="comment">//</span>
00169 
00170     ExceptionRecord.ExceptionCode = STATUS_INTEGER_OVERFLOW;
00171     ExceptionRecord.ExceptionFlags = 0;
00172     ExceptionRecord.ExceptionRecord = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00173     ExceptionRecord.NumberParameters = 0;
00174 
00175     <span class="comment">//</span>
00176     <span class="comment">// Initialize pointers.</span>
00177     <span class="comment">//</span>
00178 
00179     BadAddress = (PLONG)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00180     BadByte = (PCHAR)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00181     BadByte += 1;
00182     BlackHole = &amp;Counter;
00183 
00184     <span class="comment">//</span>
00185     <span class="comment">// Simply try statement with a finally clause that is entered sequentially.</span>
00186     <span class="comment">//</span>
00187 
00188     printf(<span class="stringliteral">"    test1..."</span>);
00189     Counter = 0;
00190     <span class="keywordflow">try</span> {
00191         Counter += 1;
00192 
00193     } finally {
00194         <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00195             Counter += 1;
00196         }
00197     }
00198 
00199     <span class="keywordflow">if</span> (Counter != 2) {
00200         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00201 
00202     } <span class="keywordflow">else</span> {
00203         printf(<span class="stringliteral">"succeeded\n"</span>);
00204     }
00205 
00206     <span class="comment">//</span>
00207     <span class="comment">// Simple try statement with an exception clause that is never executed</span>
00208     <span class="comment">// because there is no exception raised in the try clause.</span>
00209     <span class="comment">//</span>
00210 
00211     printf(<span class="stringliteral">"    test2..."</span>);
00212     Counter = 0;
00213     <span class="keywordflow">try</span> {
00214         Counter += 1;
00215 
00216     } except (Counter) {
00217         Counter += 1;
00218     }
00219 
00220     <span class="keywordflow">if</span> (Counter != 1) {
00221         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00222 
00223     } <span class="keywordflow">else</span> {
00224         printf(<span class="stringliteral">"succeeded\n"</span>);
00225     }
00226 
00227     <span class="comment">//</span>
00228     <span class="comment">// Simple try statement with an exception handler that is never executed</span>
00229     <span class="comment">// because the exception expression continues execution.</span>
00230     <span class="comment">//</span>
00231 
00232     printf(<span class="stringliteral">"    test3..."</span>);
00233     Counter = 0;
00234     <span class="keywordflow">try</span> {
00235         Counter -= 1;
00236         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord);
00237 
00238     } except (Counter) {
00239         Counter -= 1;
00240     }
00241 
00242     <span class="keywordflow">if</span> (Counter != - 1) {
00243         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00244 
00245     } <span class="keywordflow">else</span> {
00246         printf(<span class="stringliteral">"succeeded\n"</span>);
00247     }
00248 
00249     <span class="comment">//</span>
00250     <span class="comment">// Simple try statement with an exception clause that is always executed.</span>
00251     <span class="comment">//</span>
00252 
00253     printf(<span class="stringliteral">"    test4..."</span>);
00254     Counter = 0;
00255     <span class="keywordflow">try</span> {
00256         Counter += 1;
00257         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
00258 
00259     } except (Counter) {
00260         Counter += 1;
00261     }
00262 
00263     <span class="keywordflow">if</span> (Counter != 2) {
00264         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00265 
00266     } <span class="keywordflow">else</span> {
00267         printf(<span class="stringliteral">"succeeded\n"</span>);
00268     }
00269 
00270     <span class="comment">//</span>
00271     <span class="comment">// Simple try statement with an exception clause that is always executed.</span>
00272     <span class="comment">//</span>
00273 
00274     printf(<span class="stringliteral">"    test5..."</span>);
00275     Counter = 0;
00276     <span class="keywordflow">try</span> {
00277         Counter += 1;
00278         *BlackHole += *BadAddress;
00279 
00280     } except (Counter) {
00281         Counter += 1;
00282     }
00283 
00284     <span class="keywordflow">if</span> (Counter != 2) {
00285         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00286 
00287     } <span class="keywordflow">else</span> {
00288         printf(<span class="stringliteral">"succeeded\n"</span>);
00289     }
00290 
00291     <span class="comment">//</span>
00292     <span class="comment">// Simply try statement with a finally clause that is entered as the</span>
00293     <span class="comment">// result of an exception.</span>
00294     <span class="comment">//</span>
00295 
00296     printf(<span class="stringliteral">"    test6..."</span>);
00297     Counter = 0;
00298     <span class="keywordflow">try</span> {
00299         <span class="keywordflow">try</span> {
00300             Counter += 1;
00301             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord);
00302 
00303         } finally {
00304             <span class="keywordflow">if</span> (abnormal_termination() != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00305                 Counter += 1;
00306             }
00307         }
00308 
00309     } except (Counter) {
00310         <span class="keywordflow">if</span> (Counter == 2) {
00311             Counter += 1;
00312         }
00313     }
00314 
00315     <span class="keywordflow">if</span> (Counter != 3) {
00316         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00317 
00318     } <span class="keywordflow">else</span> {
00319         printf(<span class="stringliteral">"succeeded\n"</span>);
00320     }
00321 
00322     <span class="comment">//</span>
00323     <span class="comment">// Simply try statement with a finally clause that is entered as the</span>
00324     <span class="comment">// result of an exception.</span>
00325     <span class="comment">//</span>
00326 
00327     printf(<span class="stringliteral">"    test7..."</span>);
00328     Counter = 0;
00329     <span class="keywordflow">try</span> {
00330         <span class="keywordflow">try</span> {
00331             Counter += 1;
00332             *BlackHole += *BadAddress;
00333 
00334         } finally {
00335             <span class="keywordflow">if</span> (abnormal_termination() != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00336                 Counter += 1;
00337             }
00338         }
00339 
00340     } except (Counter) {
00341         <span class="keywordflow">if</span> (Counter == 2) {
00342             Counter += 1;
00343         }
00344     }
00345 
00346     <span class="keywordflow">if</span> (Counter != 3) {
00347         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00348 
00349     } <span class="keywordflow">else</span> {
00350         printf(<span class="stringliteral">"succeeded\n"</span>);
00351     }
00352 
00353     <span class="comment">//</span>
00354     <span class="comment">// Simple try that calls a function which raises an exception.</span>
00355     <span class="comment">//</span>
00356 
00357     printf(<span class="stringliteral">"    test8..."</span>);
00358     Counter = 0;
00359     <span class="keywordflow">try</span> {
00360         Counter += 1;
00361         <a class="code" href="../../d1/d1/xcpt4_8c.html#a11">foo1</a>(STATUS_ACCESS_VIOLATION);
00362 
00363     } except ((GetExceptionCode() == STATUS_ACCESS_VIOLATION) ?
00364              <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00365         Counter += 1;
00366     }
00367 
00368     <span class="keywordflow">if</span> (Counter != 2) {
00369         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00370 
00371     } <span class="keywordflow">else</span> {
00372         printf(<span class="stringliteral">"succeeded\n"</span>);
00373     }
00374 
00375     <span class="comment">//</span>
00376     <span class="comment">// Simple try that calls a function which raises an exception.</span>
00377     <span class="comment">//</span>
00378 
00379     printf(<span class="stringliteral">"    test9..."</span>);
00380     Counter = 0;
00381     <span class="keywordflow">try</span> {
00382         Counter += 1;
00383         <a class="code" href="../../d1/d1/xcpt4_8c.html#a12">foo2</a>(BlackHole, BadAddress);
00384 
00385     } except ((GetExceptionCode() == STATUS_ACCESS_VIOLATION) ?
00386              <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00387         Counter += 1;
00388     }
00389 
00390     <span class="keywordflow">if</span> (Counter != 2) {
00391         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00392 
00393     } <span class="keywordflow">else</span> {
00394         printf(<span class="stringliteral">"succeeded\n"</span>);
00395     }
00396 
00397     <span class="comment">//</span>
00398     <span class="comment">// Simple try that calls a function which calls a function that</span>
00399     <span class="comment">// raises an exception. The first function has a finally clause</span>
00400     <span class="comment">// that must be executed for this test to work.</span>
00401     <span class="comment">//</span>
00402 
00403     printf(<span class="stringliteral">"    test10..."</span>);
00404     Counter = 0;
00405     <span class="keywordflow">try</span> {
00406         <a class="code" href="../../d1/d1/xcpt4_8c.html#a3">bar1</a>(STATUS_ACCESS_VIOLATION, &amp;Counter);
00407 
00408     } except ((GetExceptionCode() == STATUS_ACCESS_VIOLATION) ?
00409              <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00410         Counter -= 1;
00411     }
00412 
00413     <span class="keywordflow">if</span> (Counter != 98) {
00414         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00415 
00416     } <span class="keywordflow">else</span> {
00417         printf(<span class="stringliteral">"succeeded\n"</span>);
00418     }
00419 
00420     <span class="comment">//</span>
00421     <span class="comment">// Simple try that calls a function which calls a function that</span>
00422     <span class="comment">// raises an exception. The first function has a finally clause</span>
00423     <span class="comment">// that must be executed for this test to work.</span>
00424     <span class="comment">//</span>
00425 
00426     printf(<span class="stringliteral">"    test11..."</span>);
00427     Counter = 0;
00428     <span class="keywordflow">try</span> {
00429         <a class="code" href="../../d1/d1/xcpt4_8c.html#a4">bar2</a>(BlackHole, BadAddress, &amp;Counter);
00430 
00431     } except ((GetExceptionCode() == STATUS_ACCESS_VIOLATION) ?
00432              <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00433         Counter -= 1;
00434     }
00435 
00436     <span class="keywordflow">if</span> (Counter != 98) {
00437         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00438 
00439     } <span class="keywordflow">else</span> {
00440         printf(<span class="stringliteral">"succeeded\n"</span>);
00441     }
00442 
00443     <span class="comment">//</span>
00444     <span class="comment">// A try within an except</span>
00445     <span class="comment">//</span>
00446 
00447     printf(<span class="stringliteral">"    test12..."</span>);
00448     Counter = 0;
00449     <span class="keywordflow">try</span> {
00450         <a class="code" href="../../d1/d1/xcpt4_8c.html#a11">foo1</a>(STATUS_ACCESS_VIOLATION);
00451 
00452     } except ((GetExceptionCode() == STATUS_ACCESS_VIOLATION) ?
00453              <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00454         Counter += 1;
00455         <span class="keywordflow">try</span> {
00456             <a class="code" href="../../d1/d1/xcpt4_8c.html#a11">foo1</a>(STATUS_SUCCESS);
00457 
00458         } except ((GetExceptionCode() == STATUS_SUCCESS) ?
00459                  <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00460             <span class="keywordflow">if</span> (Counter != 1) {
00461                 printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00462 
00463             } <span class="keywordflow">else</span> {
00464                 printf(<span class="stringliteral">"succeeded..."</span>);
00465             }
00466 
00467             Counter += 1;
00468         }
00469     }
00470 
00471     <span class="keywordflow">if</span> (Counter != 2) {
00472         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00473 
00474     } <span class="keywordflow">else</span> {
00475         printf(<span class="stringliteral">"succeeded\n"</span>);
00476     }
00477 
00478     <span class="comment">//</span>
00479     <span class="comment">// A try within an except</span>
00480     <span class="comment">//</span>
00481 
00482     printf(<span class="stringliteral">"    test13..."</span>);
00483     Counter = 0;
00484     <span class="keywordflow">try</span> {
00485         <a class="code" href="../../d1/d1/xcpt4_8c.html#a12">foo2</a>(BlackHole, BadAddress);
00486 
00487     } except ((GetExceptionCode() == STATUS_ACCESS_VIOLATION) ?
00488              <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00489         Counter += 1;
00490         <span class="keywordflow">try</span> {
00491             <a class="code" href="../../d1/d1/xcpt4_8c.html#a11">foo1</a>(STATUS_SUCCESS);
00492 
00493         } except ((GetExceptionCode() == STATUS_SUCCESS) ?
00494                  <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00495             <span class="keywordflow">if</span> (Counter != 1) {
00496                 printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00497 
00498             } <span class="keywordflow">else</span> {
00499                 printf(<span class="stringliteral">"succeeded..."</span>);
00500             }
00501 
00502             Counter += 1;
00503         }
00504     }
00505 
00506     <span class="keywordflow">if</span> (Counter != 2) {
00507         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00508 
00509     } <span class="keywordflow">else</span> {
00510         printf(<span class="stringliteral">"succeeded\n"</span>);
00511     }
00512 
00513     <span class="comment">//</span>
00514     <span class="comment">// A goto from an exception clause that needs to pass</span>
00515     <span class="comment">// through a finally</span>
00516     <span class="comment">//</span>
00517 
00518     printf(<span class="stringliteral">"    test14..."</span>);
00519     Counter = 0;
00520     <span class="keywordflow">try</span> {
00521         <span class="keywordflow">try</span> {
00522             <a class="code" href="../../d1/d1/xcpt4_8c.html#a11">foo1</a>(STATUS_ACCESS_VIOLATION);
00523 
00524         } except ((GetExceptionCode() == STATUS_ACCESS_VIOLATION) ?
00525                  <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00526             Counter += 1;
00527             <span class="keywordflow">goto</span> t9;
00528         }
00529 
00530     } finally {
00531         Counter += 1;
00532     }
00533 
00534 t9:;
00535     <span class="keywordflow">if</span> (Counter != 2) {
00536         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00537 
00538     } <span class="keywordflow">else</span> {
00539         printf(<span class="stringliteral">"succeeded\n"</span>);
00540     }
00541 
00542     <span class="comment">//</span>
00543     <span class="comment">// A goto from an finally clause that needs to pass</span>
00544     <span class="comment">// through a finally</span>
00545     <span class="comment">//</span>
00546 
00547     printf(<span class="stringliteral">"    test15..."</span>);
00548     Counter = 0;
00549     <span class="keywordflow">try</span> {
00550         <span class="keywordflow">try</span> {
00551             Counter += 1;
00552 
00553         } finally {
00554             Counter += 1;
00555             <span class="keywordflow">goto</span> t10;
00556         }
00557 
00558     } finally {
00559         Counter += 1;
00560     }
00561 
00562 t10:;
00563     <span class="keywordflow">if</span> (Counter != 3) {
00564         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00565 
00566     } <span class="keywordflow">else</span> {
00567         printf(<span class="stringliteral">"succeeded\n"</span>);
00568     }
00569 
00570     <span class="comment">//</span>
00571     <span class="comment">// A goto from an exception clause that needs to pass</span>
00572     <span class="comment">// through a finally into the outer finally clause.</span>
00573     <span class="comment">//</span>
00574 
00575     printf(<span class="stringliteral">"    test16..."</span>);
00576     Counter = 0;
00577     <span class="keywordflow">try</span> {
00578         <span class="keywordflow">try</span> {
00579             <span class="keywordflow">try</span> {
00580                 Counter += 1;
00581                 <a class="code" href="../../d1/d1/xcpt4_8c.html#a11">foo1</a>(STATUS_INTEGER_OVERFLOW);
00582 
00583             } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
00584                 Counter += 1;
00585                 <span class="keywordflow">goto</span> t11;
00586             }
00587 
00588         } finally {
00589             Counter += 1;
00590         }
00591 t11:;
00592     } finally {
00593         Counter += 1;
00594     }
00595 
00596     <span class="keywordflow">if</span> (Counter != 4) {
00597         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00598 
00599     } <span class="keywordflow">else</span> {
00600         printf(<span class="stringliteral">"succeeded\n"</span>);
00601     }
00602 
00603     <span class="comment">//</span>
00604     <span class="comment">// A goto from an finally clause that needs to pass</span>
00605     <span class="comment">// through a finally into the outer finally clause.</span>
00606     <span class="comment">//</span>
00607 
00608     printf(<span class="stringliteral">"    test17..."</span>);
00609     Counter = 0;
00610     <span class="keywordflow">try</span> {
00611         <span class="keywordflow">try</span> {
00612             Counter += 1;
00613 
00614         } finally {
00615             Counter += 1;
00616             <span class="keywordflow">goto</span> t12;
00617         }
00618 t12:;
00619     } finally {
00620         Counter += 1;
00621     }
00622 
00623     <span class="keywordflow">if</span> (Counter != 3) {
00624         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00625 
00626     } <span class="keywordflow">else</span> {
00627         printf(<span class="stringliteral">"succeeded\n"</span>);
00628     }
00629 
00630     <span class="comment">//</span>
00631     <span class="comment">// A return from an except clause</span>
00632     <span class="comment">//</span>
00633 
00634     printf(<span class="stringliteral">"    test18..."</span>);
00635     Counter = 0;
00636     <span class="keywordflow">try</span> {
00637         Counter += 1;
00638         <a class="code" href="../../d2/d3/utxcpt4_8c.html#a2">eret</a>(STATUS_ACCESS_VIOLATION, &amp;Counter);
00639 
00640     } finally {
00641         Counter += 1;
00642     }
00643 
00644     <span class="keywordflow">if</span> (Counter != 4) {
00645         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00646 
00647     } <span class="keywordflow">else</span> {
00648         printf(<span class="stringliteral">"succeeded\n"</span>);
00649     }
00650 
00651     <span class="comment">//</span>
00652     <span class="comment">// A return from a finally clause</span>
00653     <span class="comment">//</span>
00654 
00655     printf(<span class="stringliteral">"    test19..."</span>);
00656     Counter = 0;
00657     <span class="keywordflow">try</span> {
00658         Counter += 1;
00659         <a class="code" href="../../d2/d3/utxcpt4_8c.html#a4">fret</a>(&amp;Counter);
00660 
00661     } finally {
00662         Counter += 1;
00663     }
00664 
00665     <span class="keywordflow">if</span> (Counter != 5) {
00666         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00667 
00668     } <span class="keywordflow">else</span> {
00669         printf(<span class="stringliteral">"succeeded\n"</span>);
00670     }
00671 
00672     <span class="comment">//</span>
00673     <span class="comment">// A simple set jump followed by a long jump.</span>
00674     <span class="comment">//</span>
00675 
00676     printf(<span class="stringliteral">"    test20..."</span>);
00677     Counter = 0;
00678     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/jumps_8c.html#a1">setjmp</a>(JumpBuffer) == 0) {
00679         Counter += 1;
00680         <a class="code" href="../../d5/d8/jumps_8c.html#a0">longjmp</a>(JumpBuffer, 1);
00681 
00682     } <span class="keywordflow">else</span> {
00683         Counter += 1;
00684     }
00685 
00686     <span class="keywordflow">if</span> (Counter != 2) {
00687         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00688 
00689     } <span class="keywordflow">else</span> {
00690         printf(<span class="stringliteral">"succeeded\n"</span>);
00691     }
00692 
00693     <span class="comment">//</span>
00694     <span class="comment">// A set jump followed by a long jump out of a finally clause that is</span>
00695     <span class="comment">// sequentially executed.</span>
00696     <span class="comment">//</span>
00697 
00698     printf(<span class="stringliteral">"    test21..."</span>);
00699     Counter = 0;
00700     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/jumps_8c.html#a1">setjmp</a>(JumpBuffer) == 0) {
00701         <span class="keywordflow">try</span> {
00702             Counter += 1;
00703 
00704         } finally {
00705             Counter += 1;
00706             <a class="code" href="../../d5/d8/jumps_8c.html#a0">longjmp</a>(JumpBuffer, 1);
00707         }
00708 
00709     } <span class="keywordflow">else</span> {
00710         Counter += 1;
00711     }
00712 
00713     <span class="keywordflow">if</span> (Counter != 3) {
00714         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00715 
00716     } <span class="keywordflow">else</span> {
00717         printf(<span class="stringliteral">"succeeded\n"</span>);
00718     }
00719 
00720     <span class="comment">//</span>
00721     <span class="comment">// A set jump within a try clause followed by a long jump out of a</span>
00722     <span class="comment">// finally clause that is sequentially executed.</span>
00723     <span class="comment">//</span>
00724 
00725     printf(<span class="stringliteral">"    test22..."</span>);
00726     Counter = 0;
00727     <span class="keywordflow">try</span> {
00728         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/jumps_8c.html#a1">setjmp</a>(JumpBuffer) == 0) {
00729             Counter += 1;
00730 
00731         } <span class="keywordflow">else</span> {
00732             Counter += 1;
00733         }
00734 
00735     } finally {
00736         Counter += 1;
00737         <span class="keywordflow">if</span> (Counter == 2) {
00738             Counter += 1;
00739             <a class="code" href="../../d5/d8/jumps_8c.html#a0">longjmp</a>(JumpBuffer, 1);
00740         }
00741     }
00742 
00743     <span class="keywordflow">if</span> (Counter != 5) {
00744         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00745 
00746     } <span class="keywordflow">else</span> {
00747         printf(<span class="stringliteral">"succeeded\n"</span>);
00748     }
00749 
00750     <span class="comment">//</span>
00751     <span class="comment">// A set jump followed by a try/except, followed by a try/finally where</span>
00752     <span class="comment">// the try body of the try/finally raises an exception that is handled</span>
00753     <span class="comment">// by the try/excecpt which causes the try/finally to do a long jump out</span>
00754     <span class="comment">// of a finally clause. This will create a collided unwind.</span>
00755     <span class="comment">//</span>
00756 
00757     printf(<span class="stringliteral">"    test23..."</span>);
00758     Counter = 0;
00759     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/jumps_8c.html#a1">setjmp</a>(JumpBuffer) == 0) {
00760         <span class="keywordflow">try</span> {
00761             <span class="keywordflow">try</span> {
00762                 Counter += 1;
00763                 <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
00764 
00765             } finally {
00766                 Counter += 1;
00767                 <a class="code" href="../../d5/d8/jumps_8c.html#a0">longjmp</a>(JumpBuffer, 1);
00768             }
00769 
00770         } except(<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
00771             Counter += 1;
00772         }
00773 
00774     } <span class="keywordflow">else</span> {
00775         Counter += 1;
00776     }
00777 
00778     <span class="keywordflow">if</span> (Counter != 3) {
00779         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00780 
00781     } <span class="keywordflow">else</span> {
00782         printf(<span class="stringliteral">"succeeded\n"</span>);
00783     }
00784 
00785     <span class="comment">//</span>
00786     <span class="comment">// A set jump followed by a try/except, followed by a several nested</span>
00787     <span class="comment">// try/finally's where the inner try body of the try/finally raises an</span>
00788     <span class="comment">// exception that is handled by the try/except which causes the</span>
00789     <span class="comment">// try/finally to do a long jump out of a finally clause. This will</span>
00790     <span class="comment">// create a collided unwind.</span>
00791     <span class="comment">//</span>
00792 
00793     printf(<span class="stringliteral">"    test24..."</span>);
00794     Counter = 0;
00795     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/jumps_8c.html#a1">setjmp</a>(JumpBuffer) == 0) {
00796         <span class="keywordflow">try</span> {
00797             <span class="keywordflow">try</span> {
00798                 <span class="keywordflow">try</span> {
00799                     <span class="keywordflow">try</span> {
00800                         Counter += 1;
00801                         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
00802 
00803                     } finally {
00804                         Counter += 1;
00805                     }
00806 
00807                 } finally {
00808                     Counter += 1;
00809                     <a class="code" href="../../d5/d8/jumps_8c.html#a0">longjmp</a>(JumpBuffer, 1);
00810                 }
00811 
00812             } finally {
00813                 Counter += 1;
00814             }
00815 
00816         } except(<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
00817             Counter += 1;
00818         }
00819 
00820     } <span class="keywordflow">else</span> {
00821         Counter += 1;
00822     }
00823 
00824     <span class="keywordflow">if</span> (Counter != 5) {
00825         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00826 
00827     } <span class="keywordflow">else</span> {
00828         printf(<span class="stringliteral">"succeeded\n"</span>);
00829     }
00830 
00831     <span class="comment">//</span>
00832     <span class="comment">// A set jump followed by a try/except, followed by a try/finally which</span>
00833     <span class="comment">// calls a subroutine which contains a try finally that raises an</span>
00834     <span class="comment">// exception that is handled to the try/except.</span>
00835     <span class="comment">//</span>
00836 
00837     printf(<span class="stringliteral">"    test25..."</span>);
00838     Counter = 0;
00839     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/jumps_8c.html#a1">setjmp</a>(JumpBuffer) == 0) {
00840         <span class="keywordflow">try</span> {
00841             <span class="keywordflow">try</span> {
00842                 <span class="keywordflow">try</span> {
00843                     Counter += 1;
00844                     <a class="code" href="../../d1/d1/xcpt4_8c.html#a5">dojump</a>(JumpBuffer, &amp;Counter);
00845 
00846                 } finally {
00847                     Counter += 1;
00848                 }
00849 
00850             } finally {
00851                 Counter += 1;
00852             }
00853 
00854         } except(<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
00855             Counter += 1;
00856         }
00857 
00858     } <span class="keywordflow">else</span> {
00859         Counter += 1;
00860     }
00861 
00862     <span class="keywordflow">if</span> (Counter != 7) {
00863         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00864 
00865     } <span class="keywordflow">else</span> {
00866         printf(<span class="stringliteral">"succeeded\n"</span>);
00867     }
00868 
00869     <span class="comment">//</span>
00870     <span class="comment">// A set jump followed by a try/except, followed by a try/finally which</span>
00871     <span class="comment">// calls a subroutine which contains a try finally that raises an</span>
00872     <span class="comment">// exception that is handled to the try/except.</span>
00873     <span class="comment">//</span>
00874 
00875     printf(<span class="stringliteral">"    test26..."</span>);
00876     Counter = 0;
00877     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/jumps_8c.html#a1">setjmp</a>(JumpBuffer) == 0) {
00878         <span class="keywordflow">try</span> {
00879             <span class="keywordflow">try</span> {
00880                 <span class="keywordflow">try</span> {
00881                     <span class="keywordflow">try</span> {
00882                         Counter += 1;
00883                         <a class="code" href="../../d1/d1/xcpt4_8c.html#a5">dojump</a>(JumpBuffer, &amp;Counter);
00884 
00885                     } finally {
00886                         Counter += 1;
00887                     }
00888 
00889                 } finally {
00890                     Counter += 1;
00891                     <a class="code" href="../../d5/d8/jumps_8c.html#a0">longjmp</a>(JumpBuffer, 1);
00892                 }
00893 
00894             } finally {
00895                 Counter += 1;
00896             }
00897 
00898         } except(<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
00899             Counter += 1;
00900         }
00901 
00902     } <span class="keywordflow">else</span> {
00903         Counter += 1;
00904     }
00905 
00906     <span class="keywordflow">if</span> (Counter != 8) {
00907         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00908 
00909     } <span class="keywordflow">else</span> {
00910         printf(<span class="stringliteral">"succeeded\n"</span>);
00911     }
00912 
00913     <span class="comment">//</span>
00914     <span class="comment">// Test nested exceptions.</span>
00915     <span class="comment">//</span>
00916 
00917     printf(<span class="stringliteral">"    test27..."</span>);
00918     Counter = 0;
00919     <span class="keywordflow">try</span> {
00920         <span class="keywordflow">try</span> {
00921             Counter += 1;
00922             <a class="code" href="../../d1/d1/xcpt4_8c.html#a8">except1</a>(&amp;Counter);
00923 
00924         } except(<a class="code" href="../../d1/d1/xcpt4_8c.html#a9">except2</a>(GetExceptionInformation(), &amp;Counter)) {
00925             Counter += 2;
00926         }
00927 
00928     } except(<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
00929         Counter += 3;
00930     }
00931 
00932     <span class="keywordflow">if</span> (Counter != 55) {
00933         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00934 
00935     } <span class="keywordflow">else</span> {
00936         printf(<span class="stringliteral">"succeeded\n"</span>);
00937     }
00938 
00939     <span class="comment">//</span>
00940     <span class="comment">// Simple try that causes an integer overflow exception.</span>
00941     <span class="comment">//</span>
00942 
00943     printf(<span class="stringliteral">"    test28..."</span>);
00944     Counter = 0;
00945     <span class="keywordflow">try</span> {
00946         Counter += 1;
00947         <a class="code" href="../../d1/d1/xcpt4_8c.html#a21">addtwo</a>(0x7fff0000, 0x10000, &amp;Counter);
00948 
00949     } except ((GetExceptionCode() == STATUS_INTEGER_OVERFLOW) ?
00950              <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00951         Counter += 1;
00952     }
00953 
00954     <span class="keywordflow">if</span> (Counter != 2) {
00955         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00956 
00957     } <span class="keywordflow">else</span> {
00958         printf(<span class="stringliteral">"succeeded\n"</span>);
00959     }
00960 
00961     <span class="comment">//</span>
00962     <span class="comment">// Simple try that raises an misaligned data exception.</span>
00963     <span class="comment">//</span>
00964 
00965 <span class="preprocessor">#ifndef i386</span>
00966 <span class="preprocessor"></span>    printf(<span class="stringliteral">"    test29..."</span>);
00967     Counter = 0;
00968     <span class="keywordflow">try</span> {
00969         Counter += 1;
00970         <a class="code" href="../../d1/d1/xcpt4_8c.html#a12">foo2</a>(BlackHole, (PLONG)BadByte);
00971 
00972     } except ((GetExceptionCode() == STATUS_DATATYPE_MISALIGNMENT) ?
00973              <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
00974         Counter += 1;
00975     }
00976 
00977     <span class="keywordflow">if</span> (Counter != 2) {
00978         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
00979 
00980     } <span class="keywordflow">else</span> {
00981         printf(<span class="stringliteral">"succeeded\n"</span>);
00982     }
00983 
00984 <span class="preprocessor">#endif</span>
00985 <span class="preprocessor"></span>
00986     <span class="comment">//</span>
00987     <span class="comment">// Continue from a try body with an exception clause in a loop.</span>
00988     <span class="comment">//</span>
00989 
00990     printf(<span class="stringliteral">"    test30..."</span>);
00991     Counter = 0;
00992     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
00993         <span class="keywordflow">try</span> {
00994             <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 0) {
00995                 <span class="keywordflow">continue</span>;
00996 
00997             } <span class="keywordflow">else</span> {
00998                 Counter += 1;
00999             }
01000 
01001         } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
01002             Counter += 40;
01003         }
01004 
01005         Counter += 2;
01006     }
01007 
01008     <span class="keywordflow">if</span> (Counter != 15) {
01009         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01010 
01011     } <span class="keywordflow">else</span> {
01012         printf(<span class="stringliteral">"succeeded\n"</span>);
01013     }
01014 
01015     <span class="comment">//</span>
01016     <span class="comment">// Continue from a try body with an finally clause in a loop.</span>
01017     <span class="comment">//</span>
01018 
01019     printf(<span class="stringliteral">"    test31..."</span>);
01020     Counter = 0;
01021     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01022         <span class="keywordflow">try</span> {
01023             <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 0) {
01024                 <span class="keywordflow">continue</span>;
01025 
01026             } <span class="keywordflow">else</span> {
01027                 Counter += 1;
01028             }
01029 
01030         } finally {
01031             Counter += 2;
01032         }
01033 
01034         Counter += 3;
01035     }
01036 
01037     <span class="keywordflow">if</span> (Counter != 40) {
01038         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01039 
01040     } <span class="keywordflow">else</span> {
01041         printf(<span class="stringliteral">"succeeded\n"</span>);
01042     }
01043 
01044     <span class="comment">//</span>
01045     <span class="comment">// Continue from doubly nested try body with an exception clause in a</span>
01046     <span class="comment">// loop.</span>
01047     <span class="comment">//</span>
01048 
01049     printf(<span class="stringliteral">"    test32..."</span>);
01050     Counter = 0;
01051     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01052         <span class="keywordflow">try</span> {
01053             <span class="keywordflow">try</span> {
01054                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 0) {
01055                     <span class="keywordflow">continue</span>;
01056 
01057                 } <span class="keywordflow">else</span> {
01058                     Counter += 1;
01059                 }
01060 
01061             } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
01062                 Counter += 10;
01063             }
01064 
01065             Counter += 2;
01066 
01067         } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
01068             Counter += 20;
01069         }
01070 
01071         Counter += 3;
01072     }
01073 
01074     <span class="keywordflow">if</span> (Counter != 30) {
01075         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01076 
01077     } <span class="keywordflow">else</span> {
01078         printf(<span class="stringliteral">"succeeded\n"</span>);
01079     }
01080 
01081     <span class="comment">//</span>
01082     <span class="comment">// Continue from doubly nested try body with an finally clause in a loop.</span>
01083     <span class="comment">//</span>
01084 
01085     printf(<span class="stringliteral">"    test33..."</span>);
01086     Counter = 0;
01087     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01088         <span class="keywordflow">try</span> {
01089             <span class="keywordflow">try</span> {
01090                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 0) {
01091                     <span class="keywordflow">continue</span>;
01092 
01093                 } <span class="keywordflow">else</span> {
01094                     Counter += 1;
01095                 }
01096 
01097             } finally {
01098                 Counter += 2;
01099             }
01100 
01101             Counter += 3;
01102 
01103         } finally {
01104             Counter += 4;
01105         }
01106 
01107         Counter += 5;
01108     }
01109 
01110     <span class="keywordflow">if</span> (Counter != 105) {
01111         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01112 
01113     } <span class="keywordflow">else</span> {
01114         printf(<span class="stringliteral">"succeeded\n"</span>);
01115     }
01116 
01117     <span class="comment">//</span>
01118     <span class="comment">// Continue from a finally clause in a loop.</span>
01119     <span class="comment">//</span>
01120 
01121     printf(<span class="stringliteral">"    test34..."</span>);
01122     Counter = 0;
01123     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01124         <span class="keywordflow">try</span> {
01125             <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 0) {
01126                 Counter += 1;
01127             }
01128 
01129         } finally {
01130             Counter += 2;
01131             <span class="keywordflow">continue</span>;
01132         }
01133 
01134         Counter += 4;
01135     }
01136 
01137     <span class="keywordflow">if</span> (Counter != 25) {
01138         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01139 
01140     } <span class="keywordflow">else</span> {
01141         printf(<span class="stringliteral">"succeeded\n"</span>);
01142     }
01143 
01144     <span class="comment">//</span>
01145     <span class="comment">// Continue from a doubly nested finally clause in a loop.</span>
01146     <span class="comment">//</span>
01147 
01148     printf(<span class="stringliteral">"    test35..."</span>);
01149     Counter = 0;
01150     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01151         <span class="keywordflow">try</span> {
01152             <span class="keywordflow">try</span> {
01153                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 0) {
01154                     Counter += 1;
01155                 }
01156 
01157             } finally {
01158                 Counter += 2;
01159                 <span class="keywordflow">continue</span>;
01160             }
01161 
01162             Counter += 4;
01163 
01164         } finally {
01165             Counter += 5;
01166         }
01167 
01168         Counter += 6;
01169     }
01170 
01171     <span class="keywordflow">if</span> (Counter != 75) {
01172         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01173 
01174     } <span class="keywordflow">else</span> {
01175         printf(<span class="stringliteral">"succeeded\n"</span>);
01176     }
01177 
01178     <span class="comment">//</span>
01179     <span class="comment">// Continue from a doubly nested finally clause in a loop.</span>
01180     <span class="comment">//</span>
01181 
01182     printf(<span class="stringliteral">"    test36..."</span>);
01183     Counter = 0;
01184     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01185         <span class="keywordflow">try</span> {
01186             <span class="keywordflow">try</span> {
01187                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 0) {
01188                     Counter += 1;
01189                 }
01190 
01191             } finally {
01192                 Counter += 2;
01193             }
01194 
01195             Counter += 4;
01196 
01197         } finally {
01198             Counter += 5;
01199             <span class="keywordflow">continue</span>;
01200         }
01201 
01202         Counter += 6;
01203     }
01204 
01205     <span class="keywordflow">if</span> (Counter != 115) {
01206         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01207 
01208     } <span class="keywordflow">else</span> {
01209         printf(<span class="stringliteral">"succeeded\n"</span>);
01210     }
01211 
01212     <span class="comment">//</span>
01213     <span class="comment">// Break from a try body with an exception clause in a loop.</span>
01214     <span class="comment">//</span>
01215 
01216     printf(<span class="stringliteral">"    test37..."</span>);
01217     Counter = 0;
01218     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01219         <span class="keywordflow">try</span> {
01220             <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01221                 <span class="keywordflow">break</span>;
01222 
01223             } <span class="keywordflow">else</span> {
01224                 Counter += 1;
01225             }
01226 
01227         } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
01228             Counter += 40;
01229         }
01230 
01231         Counter += 2;
01232     }
01233 
01234     <span class="keywordflow">if</span> (Counter != 3) {
01235         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01236 
01237     } <span class="keywordflow">else</span> {
01238         printf(<span class="stringliteral">"succeeded\n"</span>);
01239     }
01240 
01241     <span class="comment">//</span>
01242     <span class="comment">// Break from a try body with an finally clause in a loop.</span>
01243     <span class="comment">//</span>
01244 
01245     printf(<span class="stringliteral">"    test38..."</span>);
01246     Counter = 0;
01247     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01248         <span class="keywordflow">try</span> {
01249             <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01250                 <span class="keywordflow">break</span>;
01251 
01252             } <span class="keywordflow">else</span> {
01253                 Counter += 1;
01254             }
01255 
01256         } finally {
01257             Counter += 2;
01258         }
01259 
01260         Counter += 3;
01261     }
01262 
01263     <span class="keywordflow">if</span> (Counter != 8) {
01264         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01265 
01266     } <span class="keywordflow">else</span> {
01267         printf(<span class="stringliteral">"succeeded\n"</span>);
01268     }
01269 
01270     <span class="comment">//</span>
01271     <span class="comment">// Break from doubly nested try body with an exception clause in a</span>
01272     <span class="comment">// loop.</span>
01273     <span class="comment">//</span>
01274 
01275     printf(<span class="stringliteral">"    test39..."</span>);
01276     Counter = 0;
01277     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01278         <span class="keywordflow">try</span> {
01279             <span class="keywordflow">try</span> {
01280                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01281                     <span class="keywordflow">break</span>;
01282 
01283                 } <span class="keywordflow">else</span> {
01284                     Counter += 1;
01285                 }
01286 
01287             } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
01288                 Counter += 10;
01289             }
01290 
01291             Counter += 2;
01292 
01293         } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
01294             Counter += 20;
01295         }
01296 
01297         Counter += 3;
01298     }
01299 
01300     <span class="keywordflow">if</span> (Counter != 6) {
01301         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01302 
01303     } <span class="keywordflow">else</span> {
01304         printf(<span class="stringliteral">"succeeded\n"</span>);
01305     }
01306 
01307     <span class="comment">//</span>
01308     <span class="comment">// Break from doubly nested try body with an finally clause in a loop.</span>
01309     <span class="comment">//</span>
01310 
01311     printf(<span class="stringliteral">"    test40..."</span>);
01312     Counter = 0;
01313     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01314         <span class="keywordflow">try</span> {
01315             <span class="keywordflow">try</span> {
01316                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01317                     <span class="keywordflow">break</span>;
01318 
01319                 } <span class="keywordflow">else</span> {
01320                     Counter += 1;
01321                 }
01322 
01323             } finally {
01324                 Counter += 2;
01325             }
01326 
01327             Counter += 3;
01328 
01329         } finally {
01330             Counter += 4;
01331         }
01332 
01333         Counter += 5;
01334     }
01335 
01336     <span class="keywordflow">if</span> (Counter != 21) {
01337         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01338 
01339     } <span class="keywordflow">else</span> {
01340         printf(<span class="stringliteral">"succeeded\n"</span>);
01341     }
01342 
01343     <span class="comment">//</span>
01344     <span class="comment">// Break from a finally clause in a loop.</span>
01345     <span class="comment">//</span>
01346 
01347     printf(<span class="stringliteral">"    test41..."</span>);
01348     Counter = 0;
01349     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01350         <span class="keywordflow">try</span> {
01351             <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01352                 Counter += 1;
01353             }
01354 
01355         } finally {
01356             Counter += 2;
01357             <span class="keywordflow">break</span>;
01358         }
01359 
01360         Counter += 4;
01361     }
01362 
01363     <span class="keywordflow">if</span> (Counter != 2) {
01364         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01365 
01366     } <span class="keywordflow">else</span> {
01367         printf(<span class="stringliteral">"succeeded\n"</span>);
01368     }
01369 
01370     <span class="comment">//</span>
01371     <span class="comment">// Break from a doubly nested finally clause in a loop.</span>
01372     <span class="comment">//</span>
01373 
01374     printf(<span class="stringliteral">"    test42..."</span>);
01375     Counter = 0;
01376     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01377         <span class="keywordflow">try</span> {
01378             <span class="keywordflow">try</span> {
01379                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01380                     Counter += 1;
01381                 }
01382 
01383             } finally {
01384                 Counter += 2;
01385                 <span class="keywordflow">break</span>;
01386             }
01387 
01388             Counter += 4;
01389 
01390         } finally {
01391             Counter += 5;
01392         }
01393 
01394         Counter += 6;
01395     }
01396 
01397     <span class="keywordflow">if</span> (Counter != 7) {
01398         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01399 
01400     } <span class="keywordflow">else</span> {
01401         printf(<span class="stringliteral">"succeeded\n"</span>);
01402     }
01403 
01404     <span class="comment">//</span>
01405     <span class="comment">// Break from a doubly nested finally clause in a loop.</span>
01406     <span class="comment">//</span>
01407 
01408     printf(<span class="stringliteral">"    test43..."</span>);
01409     Counter = 0;
01410     <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01411         <span class="keywordflow">try</span> {
01412             <span class="keywordflow">try</span> {
01413                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01414                     Counter += 1;
01415                 }
01416 
01417             } finally {
01418                 Counter += 2;
01419             }
01420 
01421             Counter += 4;
01422 
01423         } finally {
01424             Counter += 5;
01425             <span class="keywordflow">break</span>;
01426         }
01427 
01428         Counter += 6;
01429     }
01430 
01431     <span class="keywordflow">if</span> (Counter != 11) {
01432         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01433 
01434     } <span class="keywordflow">else</span> {
01435         printf(<span class="stringliteral">"succeeded\n"</span>);
01436     }
01437 
01438     <span class="comment">//</span>
01439     <span class="comment">// Break from a try body with an exception clause in a switch.</span>
01440     <span class="comment">//</span>
01441 
01442     printf(<span class="stringliteral">"    test44..."</span>);
01443     Counter = 0;
01444     Index1 = 1;
01445     <span class="keywordflow">switch</span> (Index2) {
01446     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a0">BLUE</a>:
01447         Counter += 100;
01448         <span class="keywordflow">break</span>;
01449 
01450     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a1">RED</a>:
01451         <span class="keywordflow">try</span> {
01452             <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01453                 <span class="keywordflow">break</span>;
01454 
01455             } <span class="keywordflow">else</span> {
01456                 Counter += 1;
01457             }
01458 
01459         } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
01460             Counter += 40;
01461         }
01462 
01463         Counter += 2;
01464         <span class="keywordflow">break</span>;
01465     }
01466 
01467     <span class="keywordflow">if</span> (Counter != 0) {
01468         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01469 
01470     } <span class="keywordflow">else</span> {
01471         printf(<span class="stringliteral">"succeeded\n"</span>);
01472     }
01473 
01474     <span class="comment">//</span>
01475     <span class="comment">// Break from a try body with an finally clause in a switch.</span>
01476     <span class="comment">//</span>
01477 
01478     printf(<span class="stringliteral">"    test45..."</span>);
01479     Counter = 0;
01480     Index1 = 1;
01481     <span class="keywordflow">switch</span> (Index2) {
01482     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a0">BLUE</a>:
01483         Counter += 100;
01484         <span class="keywordflow">break</span>;
01485 
01486     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a1">RED</a>:
01487         <span class="keywordflow">try</span> {
01488             <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01489                 <span class="keywordflow">break</span>;
01490 
01491             } <span class="keywordflow">else</span> {
01492                 Counter += 1;
01493             }
01494 
01495         } finally {
01496             Counter += 2;
01497         }
01498 
01499         Counter += 3;
01500     }
01501 
01502     <span class="keywordflow">if</span> (Counter != 2) {
01503         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01504 
01505     } <span class="keywordflow">else</span> {
01506         printf(<span class="stringliteral">"succeeded\n"</span>);
01507     }
01508 
01509     <span class="comment">//</span>
01510     <span class="comment">// Break from doubly nested try body with an exception clause in a</span>
01511     <span class="comment">// switch.</span>
01512     <span class="comment">//</span>
01513 
01514     printf(<span class="stringliteral">"    test46..."</span>);
01515     Counter = 0;
01516     Index1 = 1;
01517     <span class="keywordflow">switch</span> (Index2) {
01518     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a0">BLUE</a>:
01519         Counter += 100;
01520         <span class="keywordflow">break</span>;
01521 
01522     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a1">RED</a>:
01523         <span class="keywordflow">try</span> {
01524             <span class="keywordflow">try</span> {
01525                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01526                     <span class="keywordflow">break</span>;
01527 
01528                 } <span class="keywordflow">else</span> {
01529                     Counter += 1;
01530                 }
01531 
01532             } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
01533                 Counter += 10;
01534             }
01535 
01536             Counter += 2;
01537 
01538         } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
01539             Counter += 20;
01540         }
01541 
01542         Counter += 3;
01543     }
01544 
01545     <span class="keywordflow">if</span> (Counter != 0) {
01546         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01547 
01548     } <span class="keywordflow">else</span> {
01549         printf(<span class="stringliteral">"succeeded\n"</span>);
01550     }
01551 
01552     <span class="comment">//</span>
01553     <span class="comment">// Break from doubly nested try body with an finally clause in a switch.</span>
01554     <span class="comment">//</span>
01555 
01556     printf(<span class="stringliteral">"    test47..."</span>);
01557     Counter = 0;
01558     Index1 = 1;
01559     <span class="keywordflow">switch</span> (Index2) {
01560     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a0">BLUE</a>:
01561         Counter += 100;
01562         <span class="keywordflow">break</span>;
01563 
01564     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a1">RED</a>:
01565         <span class="keywordflow">try</span> {
01566             <span class="keywordflow">try</span> {
01567                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01568                     <span class="keywordflow">break</span>;
01569 
01570                 } <span class="keywordflow">else</span> {
01571                     Counter += 1;
01572                 }
01573 
01574             } finally {
01575                 Counter += 2;
01576             }
01577 
01578             Counter += 3;
01579 
01580         } finally {
01581             Counter += 4;
01582         }
01583 
01584         Counter += 5;
01585     }
01586 
01587     <span class="keywordflow">if</span> (Counter != 6) {
01588         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01589 
01590     } <span class="keywordflow">else</span> {
01591         printf(<span class="stringliteral">"succeeded\n"</span>);
01592     }
01593 
01594     <span class="comment">//</span>
01595     <span class="comment">// Break from a finally clause in a switch.</span>
01596     <span class="comment">//</span>
01597 
01598     printf(<span class="stringliteral">"    test48..."</span>);
01599     Counter = 0;
01600     Index1 = 1;
01601     <span class="keywordflow">switch</span> (Index2) {
01602     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a0">BLUE</a>:
01603         Counter += 100;
01604         <span class="keywordflow">break</span>;
01605 
01606     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a1">RED</a>:
01607         <span class="keywordflow">try</span> {
01608             <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01609                 Counter += 1;
01610             }
01611 
01612         } finally {
01613             Counter += 2;
01614             <span class="keywordflow">break</span>;
01615         }
01616 
01617         Counter += 4;
01618     }
01619 
01620     <span class="keywordflow">if</span> (Counter != 3) {
01621         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01622 
01623     } <span class="keywordflow">else</span> {
01624         printf(<span class="stringliteral">"succeeded\n"</span>);
01625     }
01626 
01627     <span class="comment">//</span>
01628     <span class="comment">// Break from a doubly nested finally clause in a switch.</span>
01629     <span class="comment">//</span>
01630 
01631     printf(<span class="stringliteral">"    test49..."</span>);
01632     Counter = 0;
01633     Index1 = 1;
01634     <span class="keywordflow">switch</span> (Index2) {
01635     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a0">BLUE</a>:
01636         Counter += 100;
01637         <span class="keywordflow">break</span>;
01638 
01639     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a1">RED</a>:
01640         <span class="keywordflow">try</span> {
01641             <span class="keywordflow">try</span> {
01642                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01643                     Counter += 1;
01644                 }
01645 
01646             } finally {
01647                 Counter += 2;
01648                 <span class="keywordflow">break</span>;
01649             }
01650 
01651             Counter += 4;
01652 
01653         } finally {
01654             Counter += 5;
01655         }
01656 
01657         Counter += 6;
01658     }
01659 
01660     <span class="keywordflow">if</span> (Counter != 8) {
01661         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01662 
01663     } <span class="keywordflow">else</span> {
01664         printf(<span class="stringliteral">"succeeded\n"</span>);
01665     }
01666 
01667     <span class="comment">//</span>
01668     <span class="comment">// Break from a doubly nested finally clause in a switch.</span>
01669     <span class="comment">//</span>
01670 
01671     printf(<span class="stringliteral">"    test50..."</span>);
01672     Counter = 0;
01673     Index1 = 1;
01674     <span class="keywordflow">switch</span> (Index2) {
01675     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a0">BLUE</a>:
01676         Counter += 100;
01677         <span class="keywordflow">break</span>;
01678 
01679     <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a1">RED</a>:
01680         <span class="keywordflow">try</span> {
01681             <span class="keywordflow">try</span> {
01682                 <span class="keywordflow">if</span> ((Index1 &amp; 0x1) == 1) {
01683                     Counter += 1;
01684                 }
01685 
01686             } finally {
01687                 Counter += 2;
01688             }
01689 
01690             Counter += 4;
01691 
01692         } finally {
01693             Counter += 5;
01694             <span class="keywordflow">break</span>;
01695         }
01696 
01697         Counter += 6;
01698     }
01699 
01700     <span class="keywordflow">if</span> (Counter != 12) {
01701         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01702 
01703     } <span class="keywordflow">else</span> {
01704         printf(<span class="stringliteral">"succeeded\n"</span>);
01705     }
01706 
01707     <span class="comment">//</span>
01708     <span class="comment">// Leave from an if in a simple try/finally.</span>
01709     <span class="comment">//</span>
01710 
01711     printf(<span class="stringliteral">"    test51..."</span>);
01712     Counter = 0;
01713     <span class="keywordflow">try</span> {
01714         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a>(Counter) == Counter) {
01715             Counter += 3;
01716             leave;
01717 
01718         } <span class="keywordflow">else</span> {
01719             Counter += 100;
01720         }
01721 
01722     } finally {
01723         <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01724             Counter += 5;
01725         }
01726     }
01727 
01728     <span class="keywordflow">if</span> (Counter != 8) {
01729         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01730 
01731     } <span class="keywordflow">else</span> {
01732         printf(<span class="stringliteral">"succeeded\n"</span>);
01733     }
01734 
01735     <span class="comment">//</span>
01736     <span class="comment">// Leave from a loop in a simple try/finally.</span>
01737     <span class="comment">//</span>
01738 
01739     printf(<span class="stringliteral">"    test52..."</span>);
01740     Counter = 0;
01741     <span class="keywordflow">try</span> {
01742         <span class="keywordflow">for</span> (Index1 = 0; Index1 &lt; 10; Index1 += 1) {
01743             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a>(Index1) == Index1) {
01744                 Counter += 3;
01745                 leave;
01746             }
01747 
01748             Counter += 100;
01749         }
01750 
01751     } finally {
01752         <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01753             Counter += 5;
01754         }
01755     }
01756 
01757     <span class="keywordflow">if</span> (Counter != 8) {
01758         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01759 
01760     } <span class="keywordflow">else</span> {
01761         printf(<span class="stringliteral">"succeeded\n"</span>);
01762     }
01763 
01764     <span class="comment">//</span>
01765     <span class="comment">// Leave from a switch in a simple try/finally.</span>
01766     <span class="comment">//</span>
01767 
01768     printf(<span class="stringliteral">"    test53..."</span>);
01769     Counter = 0;
01770     <span class="keywordflow">try</span> {
01771         <span class="keywordflow">switch</span> (Index2) {
01772         <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a0">BLUE</a>:
01773             <span class="keywordflow">break</span>;
01774 
01775         <span class="keywordflow">case</span> <a class="code" href="../../d1/d1/xcpt4_8c.html#a1">RED</a>:
01776             Counter += 3;
01777             leave;
01778         }
01779 
01780         Counter += 100;
01781 
01782     } finally {
01783         <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01784             Counter += 5;
01785         }
01786     }
01787 
01788     <span class="keywordflow">if</span> (Counter != 8) {
01789         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01790 
01791     } <span class="keywordflow">else</span> {
01792         printf(<span class="stringliteral">"succeeded\n"</span>);
01793     }
01794 
01795     <span class="comment">//</span>
01796     <span class="comment">// Leave from an if in doubly nested try/finally followed by a leave</span>
01797     <span class="comment">// from an if in the outer try/finally.</span>
01798     <span class="comment">//</span>
01799 
01800     printf(<span class="stringliteral">"    test54..."</span>);
01801     Counter = 0;
01802     <span class="keywordflow">try</span> {
01803         <span class="keywordflow">try</span> {
01804             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a>(Counter) == Counter) {
01805                 Counter += 3;
01806                 leave;
01807 
01808             } <span class="keywordflow">else</span> {
01809                 Counter += 100;
01810             }
01811 
01812         } finally {
01813             <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01814                 Counter += 5;
01815             }
01816         }
01817 
01818         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a>(Counter) == Counter) {
01819             Counter += 3;
01820             leave;
01821 
01822          } <span class="keywordflow">else</span> {
01823             Counter += 100;
01824          }
01825 
01826 
01827     } finally {
01828         <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01829             Counter += 5;
01830         }
01831     }
01832 
01833     <span class="keywordflow">if</span> (Counter != 16) {
01834         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01835 
01836     } <span class="keywordflow">else</span> {
01837         printf(<span class="stringliteral">"succeeded\n"</span>);
01838     }
01839 
01840     <span class="comment">//</span>
01841     <span class="comment">// Leave from an if in doubly nested try/finally followed by a leave</span>
01842     <span class="comment">// from the finally of the outer try/finally.</span>
01843     <span class="comment">//</span>
01844 
01845     printf(<span class="stringliteral">"    test55..."</span>);
01846     Counter = 0;
01847     <span class="keywordflow">try</span> {
01848         <span class="keywordflow">try</span> {
01849             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a>(Counter) == Counter) {
01850                 Counter += 3;
01851                 leave;
01852 
01853             } <span class="keywordflow">else</span> {
01854                 Counter += 100;
01855             }
01856 
01857         } finally {
01858             <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01859                 Counter += 5;
01860                 leave;
01861             }
01862         }
01863 
01864         Counter += 100;
01865 
01866     } finally {
01867         <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01868             Counter += 5;
01869         }
01870     }
01871 
01872     <span class="keywordflow">if</span> (Counter != 13) {
01873         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01874 
01875     } <span class="keywordflow">else</span> {
01876         printf(<span class="stringliteral">"succeeded\n"</span>);
01877     }
01878 
01879     <span class="comment">//</span>
01880     <span class="comment">// Try/finally within the except clause of a try/except that is always</span>
01881     <span class="comment">// executed.</span>
01882     <span class="comment">//</span>
01883 
01884     printf(<span class="stringliteral">"    test56..."</span>);
01885     Counter = 0;
01886     <span class="keywordflow">try</span> {
01887         Counter += 1;
01888         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
01889 
01890     } except (Counter) {
01891         <span class="keywordflow">try</span> {
01892             Counter += 3;
01893 
01894         } finally {
01895             <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01896                 Counter += 5;
01897             }
01898         }
01899     }
01900 
01901     <span class="keywordflow">if</span> (Counter != 9) {
01902         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01903 
01904     } <span class="keywordflow">else</span> {
01905         printf(<span class="stringliteral">"succeeded\n"</span>);
01906     }
01907 
01908     <span class="comment">//</span>
01909     <span class="comment">// Try/finally within the finally clause of a try/finally.</span>
01910     <span class="comment">//</span>
01911 
01912     printf(<span class="stringliteral">"    test57..."</span>);
01913     Counter = 0;
01914     <span class="keywordflow">try</span> {
01915         Counter += 1;
01916 
01917     } finally {
01918         <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01919             <span class="keywordflow">try</span> {
01920                 Counter += 3;
01921 
01922             } finally {
01923                 <span class="keywordflow">if</span> (abnormal_termination() == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01924                     Counter += 5;
01925                 }
01926             }
01927         }
01928     }
01929 
01930     <span class="keywordflow">if</span> (Counter != 9) {
01931         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01932 
01933     } <span class="keywordflow">else</span> {
01934         printf(<span class="stringliteral">"succeeded\n"</span>);
01935     }
01936 
01937     <span class="comment">//</span>
01938     <span class="comment">// Try/except within the finally clause of a try/finally.</span>
01939     <span class="comment">//</span>
01940 <span class="comment">/*</span>
01941 <span class="comment">    printf("    test58...");</span>
01942 <span class="comment">    Counter = 0;</span>
01943 <span class="comment">    try {</span>
01944 <span class="comment">        Counter -= 1;</span>
01945 <span class="comment"></span>
01946 <span class="comment">    } finally {</span>
01947 <span class="comment">        try {</span>
01948 <span class="comment">            Counter += 2;</span>
01949 <span class="comment">            RtlRaiseStatus(STATUS_INTEGER_OVERFLOW);</span>
01950 <span class="comment"></span>
01951 <span class="comment">        } except (Counter) {</span>
01952 <span class="comment">            try {</span>
01953 <span class="comment">                Counter += 3;</span>
01954 <span class="comment"></span>
01955 <span class="comment">            } finally {</span>
01956 <span class="comment">                if (abnormal_termination() == FALSE) {</span>
01957 <span class="comment">                    Counter += 5;</span>
01958 <span class="comment">                }</span>
01959 <span class="comment">            }</span>
01960 <span class="comment">        }</span>
01961 <span class="comment">    }</span>
01962 <span class="comment"></span>
01963 <span class="comment">    if (Counter != 9) {</span>
01964 <span class="comment">        printf("failed, count = %d\n", Counter);</span>
01965 <span class="comment"></span>
01966 <span class="comment">    } else {</span>
01967 <span class="comment">        printf("succeeded\n");</span>
01968 <span class="comment">    }</span>
01969 <span class="comment">*/</span>
01970     <span class="comment">//</span>
01971     <span class="comment">// Try/except within the except clause of a try/except that is always</span>
01972     <span class="comment">// executed.</span>
01973     <span class="comment">//</span>
01974 
01975     printf(<span class="stringliteral">"    test59..."</span>);
01976     Counter = 0;
01977     <span class="keywordflow">try</span> {
01978         Counter += 1;
01979         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
01980 
01981     } except (Counter) {
01982         <span class="keywordflow">try</span> {
01983             Counter += 3;
01984             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
01985 
01986         } except(Counter - 3) {
01987             Counter += 5;
01988         }
01989     }
01990 
01991     <span class="keywordflow">if</span> (Counter != 9) {
01992         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
01993 
01994     } <span class="keywordflow">else</span> {
01995         printf(<span class="stringliteral">"succeeded\n"</span>);
01996     }
01997 
01998     <span class="comment">//</span>
01999     <span class="comment">// Try with a Try which exits the scope with a goto</span>
02000     <span class="comment">//</span>
02001 
02002     printf(<span class="stringliteral">"    test60..."</span>);
02003     Counter = 0;
02004     <span class="keywordflow">try</span> {
02005         <span class="keywordflow">try</span> {
02006             <span class="keywordflow">goto</span> outside;
02007 
02008         } except(1) {
02009             Counter += 1;
02010         }
02011 
02012 outside:
02013     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
02014 
02015     } except(1) {
02016         Counter += 3;
02017     }
02018 
02019     <span class="keywordflow">if</span> (Counter != 3) {
02020         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
02021     } <span class="keywordflow">else</span> {
02022         printf(<span class="stringliteral">"succeeded\n"</span>);
02023     }
02024 
02025     <span class="comment">//</span>
02026     <span class="comment">// Try/except which gets an exception from a subfunction within</span>
02027     <span class="comment">// a try/finally which has a try/except in the finally clause</span>
02028     <span class="comment">//</span>
02029 
02030     printf(<span class="stringliteral">"    test61..."</span>);
02031     Counter = 0;
02032     <span class="keywordflow">try</span> {
02033         <a class="code" href="../../d1/d1/xcpt4_8c.html#a15">Test61Part2</a> (&amp;Counter);
02034     } except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
02035         Counter += 11;
02036     }
02037 
02038     <span class="keywordflow">if</span> (Counter != 24) {
02039         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
02040 
02041     } <span class="keywordflow">else</span> {
02042         printf(<span class="stringliteral">"succeeded\n"</span>);
02043     }
02044 
02045     <span class="comment">//</span>
02046     <span class="comment">// Check for precision of floating point exception</span>
02047     <span class="comment">//</span>
02048 
02049     printf(<span class="stringliteral">"    test62..."</span>);
02050 
02051     <span class="comment">/* enable floating point overflow */</span>
02052     _controlfp(_controlfp(0,0) &amp; ~EM_OVERFLOW, _MCW_EM);
02053 
02054     Counter = 0;
02055     <span class="keywordflow">try</span> {
02056         doubleresult = <a class="code" href="../../d1/d1/xcpt4_8c.html#a17">SquareDouble</a> (1.7e300);
02057 
02058         <span class="keywordflow">try</span> {
02059             doubleresult = <a class="code" href="../../d1/d1/xcpt4_8c.html#a17">SquareDouble</a> (1.0);
02060 
02061         } except (1) {
02062             Counter += 3;
02063         }
02064 
02065     } except (1) {
02066         Counter += 1;
02067     }
02068 
02069     <span class="keywordflow">if</span> (Counter != 1) {
02070         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
02071 
02072     } <span class="keywordflow">else</span> {
02073         printf(<span class="stringliteral">"succeeded\n"</span>);
02074     }
02075 
02076     _clearfp ();
02077 
02078     <span class="comment">//</span>
02079     <span class="comment">// Callout for test #63 due to bogus compiler behaviour caused by test #62.</span>
02080     <span class="comment">//</span>
02081 
02082     <a class="code" href="../../d1/d1/xcpt4_8c.html#a20">PerformFpTest</a> ();
02083 
02084     <span class="comment">//</span>
02085     <span class="comment">// Announce end of exception test.</span>
02086     <span class="comment">//</span>
02087 
02088     printf(<span class="stringliteral">"End of exception test\n"</span>);
02089     <span class="keywordflow">return</span>;
02090 }
02091 
02092 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02093"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a20">02093</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a20">PerformFpTest</a>()
02094 {
02095     LONG Counter;
02096     <span class="keywordtype">double</span> doubleresult;
02097 
02098     <span class="comment">//</span>
02099     <span class="comment">// Check for precision of floating point exception in subfunction</span>
02100     <span class="comment">//</span>
02101 
02102     printf(<span class="stringliteral">"    test63..."</span>);
02103 
02104     Counter = 0;
02105     <span class="keywordflow">try</span> {
02106         <a class="code" href="../../d1/d1/xcpt4_8c.html#a18">SquareDouble17E300</a> ((PVOID) &amp;doubleresult);
02107 
02108         <span class="keywordflow">try</span> {
02109             <a class="code" href="../../d1/d1/xcpt4_8c.html#a18">SquareDouble17E300</a> ((PVOID) &amp;doubleresult);
02110 
02111         } except (1) {
02112             Counter += 3;
02113         }
02114 
02115     } except (1) {
02116         Counter += 1;
02117     }
02118 
02119     <span class="keywordflow">if</span> (Counter != 1) {
02120         printf(<span class="stringliteral">"failed, count = %d\n"</span>, Counter);
02121 
02122     } <span class="keywordflow">else</span> {
02123         printf(<span class="stringliteral">"succeeded\n"</span>);
02124     }
02125 
02126     _clearfp ();
02127 
02128 }
02129 
02130 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02131"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a21">02131</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a21">addtwo</a> (
02132     <span class="keywordtype">long</span> First,
02133     <span class="keywordtype">long</span> Second,
02134     <span class="keywordtype">long</span> *Place
02135     )
02136 
02137 {
02138 
02139     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
02140     *Place = First + Second;
02141     <span class="keywordflow">return</span>;
02142 }
02143 
02144 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02145"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a3">02145</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a3">bar1</a> (
02146     IN NTSTATUS Status,
02147     IN PLONG Counter
02148     )
02149 {
02150 
02151     <span class="keywordflow">try</span> {
02152         <a class="code" href="../../d1/d1/xcpt4_8c.html#a11">foo1</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
02153 
02154     } finally {
02155         <span class="keywordflow">if</span> (abnormal_termination() != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
02156             *Counter = 99;
02157 
02158         } <span class="keywordflow">else</span> {
02159             *Counter = 100;
02160         }
02161     }
02162 
02163     <span class="keywordflow">return</span>;
02164 }
02165 
02166 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02167"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a4">02167</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a4">bar2</a> (
02168     IN PLONG BlackHole,
02169     IN PLONG BadAddress,
02170     IN PLONG Counter
02171     )
02172 {
02173 
02174     <span class="keywordflow">try</span> {
02175         <a class="code" href="../../d1/d1/xcpt4_8c.html#a12">foo2</a>(BlackHole, BadAddress);
02176 
02177     } finally {
02178         <span class="keywordflow">if</span> (abnormal_termination() != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
02179             *Counter = 99;
02180 
02181         } <span class="keywordflow">else</span> {
02182             *Counter = 100;
02183         }
02184     }
02185 
02186     <span class="keywordflow">return</span>;
02187 }
02188 
02189 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02190"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a5">02190</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a5">dojump</a> (
02191     IN jmp_buf JumpBuffer,
02192     IN PLONG Counter
02193     )
02194 
02195 {
02196 
02197     <span class="keywordflow">try</span> {
02198         <span class="keywordflow">try</span> {
02199             *Counter += 1;
02200             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
02201 
02202         } finally {
02203             *Counter += 1;
02204         }
02205 
02206     } finally {
02207         *Counter += 1;
02208         <a class="code" href="../../d5/d8/jumps_8c.html#a0">longjmp</a>(JumpBuffer, 1);
02209     }
02210 }
02211 
02212 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02213"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a7">02213</a> <a class="code" href="../../d2/d3/utxcpt4_8c.html#a2">eret</a>(
02214     IN NTSTATUS Status,
02215     IN PLONG Counter
02216     )
02217 
02218 {
02219 
02220     <span class="keywordflow">try</span> {
02221         <span class="keywordflow">try</span> {
02222             <a class="code" href="../../d1/d1/xcpt4_8c.html#a11">foo1</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
02223 
02224         } except ((GetExceptionCode() == <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) ?
02225                  <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>) {
02226             *Counter += 1;
02227             <span class="keywordflow">return</span>;
02228         }
02229 
02230     } finally {
02231         *Counter += 1;
02232     }
02233 
02234     <span class="keywordflow">return</span>;
02235 }
02236 
02237 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02238"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a8">02238</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a8">except1</a> (
02239     IN PLONG Counter
02240     )
02241 
02242 {
02243 
02244     <span class="keywordflow">try</span> {
02245         *Counter += 5;
02246         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
02247 
02248     } except (<a class="code" href="../../d1/d1/xcpt4_8c.html#a10">except3</a>(GetExceptionInformation(), Counter)) {
02249         *Counter += 7;
02250     }
02251 
02252     *Counter += 9;
02253     <span class="keywordflow">return</span>;
02254 }
02255 
02256 ULONG
<a name="l02257"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a9">02257</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a9">except2</a> (
02258     IN PEXCEPTION_POINTERS ExceptionPointers,
02259     IN PLONG Counter
02260     )
02261 
02262 {
02263 
02264     PEXCEPTION_RECORD ExceptionRecord;
02265 
02266     ExceptionRecord = ExceptionPointers-&gt;ExceptionRecord;
02267     <span class="keywordflow">if</span> ((ExceptionRecord-&gt;ExceptionCode == STATUS_UNSUCCESSFUL) &amp;&amp;
02268        ((ExceptionRecord-&gt;ExceptionFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a29">EXCEPTION_NESTED_CALL</a>) == 0)) {
02269         *Counter += 11;
02270         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>;
02271 
02272     } <span class="keywordflow">else</span> {
02273         *Counter += 13;
02274         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>;
02275     }
02276 }
02277 
02278 ULONG
<a name="l02279"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a10">02279</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a10">except3</a> (
02280     IN PEXCEPTION_POINTERS ExceptionPointers,
02281     IN PLONG Counter
02282     )
02283 
02284 {
02285 
02286     PEXCEPTION_RECORD ExceptionRecord;
02287 
02288     ExceptionRecord = ExceptionPointers-&gt;ExceptionRecord;
02289     <span class="keywordflow">if</span> ((ExceptionRecord-&gt;ExceptionCode == STATUS_INTEGER_OVERFLOW) &amp;&amp;
02290        ((ExceptionRecord-&gt;ExceptionFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a29">EXCEPTION_NESTED_CALL</a>) == 0)) {
02291         *Counter += 17;
02292         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_UNSUCCESSFUL);
02293 
02294     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ExceptionRecord-&gt;ExceptionCode == STATUS_UNSUCCESSFUL) &amp;&amp;
02295         ((ExceptionRecord-&gt;ExceptionFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a29">EXCEPTION_NESTED_CALL</a>) != 0)) {
02296         *Counter += 19;
02297         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>;
02298     }
02299 
02300     *Counter += 23;
02301     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>;
02302 }
02303 
02304 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02305"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a11">02305</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a11">foo1</a> (
02306     IN NTSTATUS Status
02307     )
02308 
02309 {
02310 
02311     <span class="comment">//</span>
02312     <span class="comment">// Raise exception.</span>
02313     <span class="comment">//</span>
02314 
02315     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
02316     <span class="keywordflow">return</span>;
02317 }
02318 
02319 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02320"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a12">02320</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a12">foo2</a> (
02321     IN PLONG BlackHole,
02322     IN PLONG BadAddress
02323     )
02324 
02325 {
02326 
02327     <span class="comment">//</span>
02328     <span class="comment">// Raise exception.</span>
02329     <span class="comment">//</span>
02330 
02331     *BlackHole += *BadAddress;
02332     <span class="keywordflow">return</span>;
02333 }
02334 
02335 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02336"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a13">02336</a> <a class="code" href="../../d2/d3/utxcpt4_8c.html#a4">fret</a>(
02337     IN PLONG Counter
02338     )
02339 
02340 {
02341 
02342     <span class="keywordflow">try</span> {
02343         <span class="keywordflow">try</span> {
02344             *Counter += 1;
02345 
02346         } finally {
02347             *Counter += 1;
02348             <span class="keywordflow">return</span>;
02349         }
02350     } finally {
02351         *Counter += 1;
02352     }
02353 
02354     <span class="keywordflow">return</span>;
02355 }
02356 
02357 LONG
<a name="l02358"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a6">02358</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a6">Echo</a>(
02359     IN LONG Value
02360     )
02361 
02362 {
02363     <span class="keywordflow">return</span> Value;
02364 }
02365 
02366 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02367"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a15">02367</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a15">Test61Part2</a> (
02368     IN OUT PULONG Counter
02369     )
02370 {
02371 
02372     <span class="keywordflow">try</span> {
02373         *Counter -= 1;
02374         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_INTEGER_OVERFLOW);
02375     } finally {
02376         *Counter += 2;
02377         *Counter += 5;
02378         *Counter += 7;
02379     }
02380 }
02381 
02382 
02383 <span class="keywordtype">double</span>
<a name="l02384"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a17">02384</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a17">SquareDouble</a> (
02385     IN <span class="keywordtype">double</span>   op
02386     )
02387 {
02388     <span class="keywordflow">return</span> op * op;
02389 }
02390 
02391 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02392"></a><a class="code" href="../../d1/d1/xcpt4_8c.html#a18">02392</a> <a class="code" href="../../d1/d1/xcpt4_8c.html#a18">SquareDouble17E300</a> (
02393     OUT PVOID   output
02394     )
02395 {
02396     <span class="keywordtype">double</span>  ans;
02397 
02398     ans = <a class="code" href="../../d1/d1/xcpt4_8c.html#a17">SquareDouble</a> (1.7e300);
02399     *(<span class="keywordtype">double</span> *) output = ans;
02400 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:29 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
