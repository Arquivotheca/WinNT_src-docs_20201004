<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ioassert.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ioassert.c</h1><a href="../../d1/d5/ioassert_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1998  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    ioassert.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implements basic support for driver correctness checks (which</span>
00012 <span class="comment">    may be raised to debugger prompts, bugchecks, etc).</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Adrian J. Oney (adriao) 20-Apr-1998</span>
00017 <span class="comment"></span>
00018 <span class="comment">Environment:</span>
00019 <span class="comment"></span>
00020 <span class="comment">    Kernel mode</span>
00021 <span class="comment"></span>
00022 <span class="comment">Revision History:</span>
00023 <span class="comment"></span>
00024 <span class="comment">Known BUGBUGs:</span>
00025 <span class="comment"></span>
00026 <span class="comment">--*/</span>
00027 
00028 <span class="preprocessor">#include "<a class="code" href="../../d0/d6/iop_8h.html">iop.h</a>"</span>
00029 
00030 <span class="preprocessor">#if (( defined(_X86_) ) &amp;&amp; ( FPO ))</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#pragma optimize( "y", off )    // disable FPO for consistent stack traces</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00033 <span class="preprocessor"></span>
00034 <span class="preprocessor">#ifndef NO_SPECIAL_IRP</span>
00035 <span class="preprocessor"></span>
00036 <span class="preprocessor">#ifdef ALLOC_PRAGMA</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessTakeLock)</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessReleaseLock)</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessCheckUnderLock)</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessProcessParams)</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessProcessMessageText)</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessApplyControl)</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessThrowBugCheck)</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessPrintBuffer)</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessPrintParamData)</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessPrompt)</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessAddressToFileHeader)</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessPrintIrp)</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGEVRFY, IopDriverCorrectnessPrintIrpStack)</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#endif // ALLOC_PRAGMA</span>
00051 <span class="preprocessor"></span>
<a name="l00052"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a4">00052</a> PULONG            <a class="code" href="../../d1/d5/ioassert_8c.html#a4">IopDcControlCurrent</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
<a name="l00053"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a5">00053</a> LONG              <a class="code" href="../../d1/d5/ioassert_8c.html#a5">IopDcCurrentFrameSkips</a> = -1;
<a name="l00054"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a6">00054</a> KIRQL             <a class="code" href="../../d1/d5/ioassert_8c.html#a6">IopDcControlIrql</a>;
<a name="l00055"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a7">00055</a> KSPIN_LOCK        <a class="code" href="../../d1/d5/ioassert_8c.html#a7">IopDcControlLock</a>;
<a name="l00056"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a8">00056</a> ULONG             <a class="code" href="../../d1/d5/ioassert_8c.html#a8">IopDcControlInitial</a> = (ULONG) -1;
<a name="l00057"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a9">00057</a> ULONG             <a class="code" href="../../d1/d5/ioassert_8c.html#a9">IopDcControlOverride</a> = (ULONG) -1;
00058 
00059 <span class="preprocessor">#ifdef ALLOC_DATA_PRAGMA</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#pragma data_seg("PAGEVRFY$data")</span>
00061 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00062 <span class="preprocessor"></span>
00063 <span class="comment">//</span>
00064 <span class="comment">// When invoking the driver check macro's, pass Irps first, Routines second,</span>
00065 <span class="comment">// DevObj's third, and any Status's last...</span>
00066 <span class="comment">//</span>
<a name="l00067"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a10">00067</a> <a class="code" href="../../d8/d1/struct__DCPARAM__TYPE__ENTRY.html">DCPARAM_TYPE_ENTRY</a> <a class="code" href="../../d1/d5/ioassert_8c.html#a10">DcParamTable</a>[] = {
00068     { <a class="code" href="../../d2/d5/ioassert_8h.html#a7">DCPARAM_IRP</a>,     <span class="stringliteral">"Irp"</span>     },
00069     { <a class="code" href="../../d2/d5/ioassert_8h.html#a8">DCPARAM_ROUTINE</a>, <span class="stringliteral">"Routine"</span> },
00070     { <a class="code" href="../../d2/d5/ioassert_8h.html#a9">DCPARAM_DEVOBJ</a>,  <span class="stringliteral">"DevObj"</span>  },
00071     { <a class="code" href="../../d2/d5/ioassert_8h.html#a10">DCPARAM_STATUS</a>,  <span class="stringliteral">"Status"</span>  }
00072 };
00073 
<a name="l00074"></a><a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html">00074</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html">_DCERROR_MESSAGE</a> {
00075 
<a name="l00076"></a><a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html#o0">00076</a>     <a class="code" href="../../d2/d5/ioassert_8h.html#a31">DCERROR_ID</a>       <a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html#o0">MessageID</a>;
<a name="l00077"></a><a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html#o1">00077</a>     <a class="code" href="../../d6/d1/struct__DCERROR__CLASS.html">PCDCERROR_CLASS</a>  <a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html#o1">MessageClass</a>;
<a name="l00078"></a><a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html#o2">00078</a>     PSTR             <a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html#o2">MessageText</a>;
00079 
00080 } <a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html">DCERROR_MESSAGE</a>, *<a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html">PDCERROR_MESSAGE</a>;
00081 
00082 <span class="comment">//</span>
00083 <span class="comment">// These are the general "classifications" of errors, along with the default</span>
00084 <span class="comment">// flags that will be applied the first time this is hit.</span>
00085 <span class="comment">//</span>
00086 <span class="comment">// IopDcWdmDriverErrorFatal -</span>
00087 <span class="comment">//     Anything in this class will cause the IO verifier to bugcheck if no</span>
00088 <span class="comment">// debugger is present.</span>
00089 <span class="comment">//</span>
00090 <span class="comment">// IopDcWdmDriverErrorNonFatal -</span>
00091 <span class="comment">//     Anything in this class will not cause the IO verifier to bugcheck, but</span>
00092 <span class="comment">// will stop under the debugger.</span>
00093 <span class="comment">//</span>
00094 <span class="comment">// IopDcWdmDriverWarning -</span>
00095 <span class="comment">//     Anything in this class will beep but continue without breaking in.</span>
00096 <span class="comment">//</span>
00097 <span class="comment">// IopDcWdmDriverPostponed -</span>
00098 <span class="comment">//     Anything in this class will merely print and continue.</span>
00099 <span class="comment">//</span>
00100 <span class="comment">// IopDcWdmCoreError -</span>
00101 <span class="comment">//     Issue in a core component (kernel or hal)</span>
00102 <span class="comment">//</span>
<a name="l00103"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a13">00103</a> <a class="code" href="../../d6/d1/struct__DCERROR__CLASS.html">DCERROR_CLASS</a> <a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a> =
00104     { <a class="code" href="../../d2/d5/ioassert_8h.html#a1">DIAG_BEEP</a> | <a class="code" href="../../d2/d5/ioassert_8h.html#a4">DIAG_FATAL_ERROR</a> | <a class="code" href="../../d2/d5/ioassert_8h.html#a5">DIAG_WDM_ERROR</a>, <span class="stringliteral">"WDM DRIVER ERROR"</span> };
00105 
<a name="l00106"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a14">00106</a> <a class="code" href="../../d6/d1/struct__DCERROR__CLASS.html">DCERROR_CLASS</a> <a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a> =
00107     { <a class="code" href="../../d2/d5/ioassert_8h.html#a1">DIAG_BEEP</a> | <a class="code" href="../../d2/d5/ioassert_8h.html#a5">DIAG_WDM_ERROR</a>, <span class="stringliteral">"WDM DRIVER ERROR"</span> };
00108 
<a name="l00109"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a15">00109</a> <a class="code" href="../../d6/d1/struct__DCERROR__CLASS.html">DCERROR_CLASS</a> <a class="code" href="../../d1/d5/ioassert_8c.html#a15">IopDcWdmDriverWarning</a> =
00110     { <a class="code" href="../../d2/d5/ioassert_8h.html#a1">DIAG_BEEP</a> | <a class="code" href="../../d2/d5/ioassert_8h.html#a2">DIAG_ZAPPED</a>,    <span class="stringliteral">"WDM DRIVER WARNING"</span> };
00111 
<a name="l00112"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a16">00112</a> <a class="code" href="../../d6/d1/struct__DCERROR__CLASS.html">DCERROR_CLASS</a> <a class="code" href="../../d1/d5/ioassert_8c.html#a16">IopDcWdmDriverPostponed</a> = { <a class="code" href="../../d2/d5/ioassert_8h.html#a2">DIAG_ZAPPED</a>, <span class="stringliteral">"POSTPONED WDM DRIVER BUG"</span> };
00113 
<a name="l00114"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a17">00114</a> <a class="code" href="../../d6/d1/struct__DCERROR__CLASS.html">DCERROR_CLASS</a> <a class="code" href="../../d1/d5/ioassert_8c.html#a17">IopDcWdmCoreError</a> = { <a class="code" href="../../d2/d5/ioassert_8h.html#a1">DIAG_BEEP</a>, <span class="stringliteral">"CORE DRIVER ERROR"</span> };
00115 
00116 <span class="comment">//</span>
00117 <span class="comment">// This is the table of error messages. Note that we've numbered the error</span>
00118 <span class="comment">// message numbers continuously, so that they can be used as an indice into the</span>
00119 <span class="comment">// table. Also note these constants are published, so if asserts are removed</span>
00120 <span class="comment">// in the future, the current algorithm may need to be replaced by something</span>
00121 <span class="comment">// akin to a binary search (or perhaps padding will need to be added).</span>
00122 <span class="comment">//</span>
<a name="l00123"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a18">00123</a> <a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html">DCERROR_MESSAGE</a> <a class="code" href="../../d1/d5/ioassert_8c.html#a18">IopDcMessageTable</a>[<a class="code" href="../../d2/d5/ioassert_8h.html#a114a99">DCERROR_MAXIMUM</a> - <a class="code" href="../../d2/d5/ioassert_8h.html#a114a39">DCERROR_UNSPECIFIED</a>] = {
00124    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a39">DCERROR_UNSPECIFIED</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> },
00125    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a40">DCERROR_DELETE_WHILE_ATTACHED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00126      <span class="stringliteral">"A device is deleting itself while there is another device beneath it in "</span>
00127      <span class="stringliteral">"the driver stack. This may be because the caller has forgotten to call "</span>
00128      <span class="stringliteral">"IoDetachDevice first, or the lower driver may have incorrectly deleted "</span>
00129      <span class="stringliteral">"itself."</span> },
00130    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a41">DCERROR_DETACH_NOT_ATTACHED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00131      <span class="stringliteral">"Driver has attempted to detach from device object %DevObj, which is not "</span>
00132      <span class="stringliteral">"attached to anything. This may occur if detach was called twice on the "</span>
00133      <span class="stringliteral">"same device object."</span> },
00134    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a42">DCERROR_CANCELROUTINE_FORWARDED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00135      <span class="stringliteral">"A driver has called IoCallDriver without setting the CancelRoutine in "</span>
00136      <span class="stringliteral">"the Irp to NULL (Irp = %Irp )."</span> },
00137    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a43">DCERROR_NULL_DEVOBJ_FORWARDED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00138      <span class="stringliteral">"Caller has passed in NULL as a DeviceObject. This is fatal (Irp = %Irp )."</span>
00139      },
00140    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a44">DCERROR_QUEUED_IRP_FORWARDED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00141      <span class="stringliteral">"Caller is forwarding an IRP that is currently queued beneath it! The "</span>
00142      <span class="stringliteral">"code handling IRPs returning STATUS_PENDING in this driver appears to "</span>
00143      <span class="stringliteral">"be broken (Irp = %Irp )."</span> },
00144    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a45">DCERROR_NEXTIRPSP_DIRTY</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00145      <span class="stringliteral">"Caller has incorrectly forwarded an IRP (control field not zerod). The "</span>
00146      <span class="stringliteral">"driver should use IoCopyCurrentIrpStackLocationToNext or "</span>
00147      <span class="stringliteral">"IoSkipCurrentIrpStackLocation. (Irp = %Irp )"</span> },
00148    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a46">DCERROR_IRPSP_COPIED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00149      <span class="stringliteral">"Caller has manually copied the stack and has inadvertantly copied the "</span>
00150      <span class="stringliteral">"upper layer's completion routine. Please use "</span>
00151      <span class="stringliteral">"IoCopyCurrentIrpStackLocationToNext. (Irp = %Irp )."</span> },
00152    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a47">DCERROR_INSUFFICIENT_STACK_LOCATIONS</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00153      <span class="stringliteral">"This IRP is about to run out of stack locations. Someone may have "</span>
00154      <span class="stringliteral">"forwarded this IRP from another stack (Irp = %Irp )."</span> },
00155    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a48">DCERROR_QUEUED_IRP_COMPLETED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00156      <span class="stringliteral">"Caller is completing an IRP that is currently queued beneath it! The "</span>
00157      <span class="stringliteral">"code handling IRPs returning STATUS_PENDING in this driver appears to be "</span>
00158      <span class="stringliteral">"broken. (Irp = %Irp )"</span> },
00159    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a49">DCERROR_FREE_OF_INUSE_TRACKED_IRP</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00160      <span class="stringliteral">"Caller of IoFreeIrp is freeing an IRP that is still in use! (Original "</span>
00161      <span class="stringliteral">"Irp = %Irp1, Irp in usage is %Irp2 )"</span> },
00162    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a50">DCERROR_FREE_OF_INUSE_IRP</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00163      <span class="stringliteral">"Caller of IoFreeIrp is freeing an IRP that is still in use! (Irp = %Irp )"</span>
00164      },
00165    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a51">DCERROR_FREE_OF_THREADED_IRP</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00166      <span class="stringliteral">"Caller of IoFreeIrp is freeing an IRP that is still enqueued against a "</span>
00167      <span class="stringliteral">"thread! (Irp = %Irp )"</span> },
00168    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a52">DCERROR_REINIT_OF_ALLOCATED_IRP_WITH_QUOTA</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00169      <span class="stringliteral">"Caller of IoInitializeIrp has passed an IRP that was allocated with "</span>
00170      <span class="stringliteral">"IoAllocateIrp. This is illegal and unneccessary, and has caused a quota "</span>
00171      <span class="stringliteral">"leak. Check the documentation for IoReuseIrp if this IRP is being "</span>
00172      <span class="stringliteral">"recycled."</span> },
00173    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a53">DCERROR_PNP_IRP_BAD_INITIAL_STATUS</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00174      <span class="stringliteral">"Any PNP IRP must have status initialized to STATUS_NOT_SUPPORTED "</span>
00175      <span class="stringliteral">"(Irp = %Irp )."</span> },
00176    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a54">DCERROR_POWER_IRP_BAD_INITIAL_STATUS</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00177      <span class="stringliteral">"Any Power IRP must have status initialized to STATUS_NOT_SUPPORTED "</span>
00178      <span class="stringliteral">"(Irp = %Irp )."</span> },
00179    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a55">DCERROR_WMI_IRP_BAD_INITIAL_STATUS</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00180      <span class="stringliteral">"Any WMI IRP must have status initialized to STATUS_NOT_SUPPORTED "</span>
00181      <span class="stringliteral">"(Irp = %Irp )."</span> },
00182    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a56">DCERROR_SKIPPED_DEVICE_OBJECT</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00183      <span class="stringliteral">"Caller has forwarded an Irp while skipping a device object in the stack. "</span>
00184      <span class="stringliteral">"The caller is probably sending IRPs to the PDO instead of to the device "</span>
00185      <span class="stringliteral">"returned by IoAttachDeviceToDeviceStack (Irp = %Irp )."</span> },
00186    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a57">DCERROR_BOGUS_FUNC_TRASHED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00187      <span class="stringliteral">"Caller has trashed or has not properly copied IRP's stack (Irp = %Irp )."</span>
00188      },
00189    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a58">DCERROR_BOGUS_STATUS_TRASHED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00190      <span class="stringliteral">"Caller has changed the status field of an IRP it does not understand "</span>
00191      <span class="stringliteral">"(Irp = %Irp )."</span> },
00192    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a59">DCERROR_BOGUS_INFO_TRASHED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00193      <span class="stringliteral">"Caller has changed the information field of an IRP it does not "</span>
00194      <span class="stringliteral">"understand (Irp = %Irp )."</span> },
00195    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a60">DCERROR_PNP_FAILURE_FORWARDED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>, <span class="comment">// Grrr</span>
00196      <span class="stringliteral">"Non-successful non-STATUS_NOT_SUPPORTED IRP status for IRP_MJ_PNP is "</span>
00197      <span class="stringliteral">"being passed down stack (Irp = %Irp ). Failed PNP IRPs must be completed."</span>
00198      },
00199    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a61">DCERROR_PNP_IRP_STATUS_RESET</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00200      <span class="stringliteral">"Previously set IRP_MJ_PNP status has been converted to "</span>
00201      <span class="stringliteral">"STATUS_NOT_SUPPORTED. (Irp = %Irp )."</span> },
00202    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a62">DCERROR_PNP_IRP_NEEDS_FDO_HANDLING</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00203      <span class="stringliteral">"FDO caller has not handled a required IRP. The FDO must either fail the "</span>
00204      <span class="stringliteral">"IRP or set the IRP's status if it is not going change the IRP's status "</span>
00205      <span class="stringliteral">"using a completion routine. (Irp = %Irp )."</span> },
00206    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a63">DCERROR_PNP_IRP_FDO_HANDS_OFF</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00207      <span class="stringliteral">"FDO caller has responded to an IRP that is reserved for PDO use only. "</span>
00208      <span class="stringliteral">"Stop it. (Irp = %Irp )"</span> },
00209    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a64">DCERROR_POWER_FAILURE_FORWARDED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>, <span class="comment">// Grrr</span>
00210      <span class="stringliteral">"Non-successful non-STATUS_NOT_SUPPORTED IRP status for IRP_MJ_POWER is "</span>
00211      <span class="stringliteral">"being passed down stack (Irp = %Irp ). Failed POWER IRPs must be "</span>
00212      <span class="stringliteral">"completed."</span> },
00213    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a65">DCERROR_POWER_IRP_STATUS_RESET</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00214      <span class="stringliteral">"Previously set IRP_MJ_POWER status has been converted to "</span>
00215      <span class="stringliteral">"STATUS_NOT_SUPPORTED. (Irp = %Irp )."</span> },
00216    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a66">DCERROR_INVALID_STATUS</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00217      <span class="stringliteral">"Driver has returned a suspicious status. This is probably due to an "</span>
00218      <span class="stringliteral">"uninitiaized variable bug in the driver. (Irp = %Irp )"</span> },
00219    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a67">DCERROR_UNNECCESSARY_COPY</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a15">IopDcWdmDriverWarning</a>,
00220      <span class="stringliteral">"Caller has copied the Irp stack but not set a completion routine. "</span>
00221      <span class="stringliteral">"This is inefficient, use IoSkipCurrentIrpStackLocation instead "</span>
00222      <span class="stringliteral">"(Irp = %Irp )."</span> },
00223    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a68">DCERROR_SHOULDVE_DETACHED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00224      <span class="stringliteral">"An IRP dispatch handler has not properly detached from the stack below "</span>
00225      <span class="stringliteral">"it upon receiving a remove IRP. DeviceObject = %DevObj - Dispatch = "</span>
00226      <span class="stringliteral">"%Routine - Irp = %Irp"</span> },
00227    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a69">DCERROR_SHOULDVE_DELETED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00228      <span class="stringliteral">"An IRP dispatch handler has not properly deleted it's device object upon "</span>
00229      <span class="stringliteral">"receiving a remove IRP. DeviceObject = %DevObj - Dispatch = %Routine - "</span>
00230      <span class="stringliteral">"Irp = %Irp"</span> },
00231    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a70">DCERROR_MISSING_DISPATCH_FUNCTION</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00232      <span class="stringliteral">"This driver has not filled out a dispatch routine for a required IRP "</span>
00233      <span class="stringliteral">"major function (Irp = %Irp )."</span> },
00234    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a71">DCERROR_WMI_IRP_NOT_FORWARDED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00235      <span class="stringliteral">"IRP_MJ_SYSTEM_CONTROL has been completed by someone other than the "</span>
00236      <span class="stringliteral">"ProviderId. This IRP should either have been completed earlier or "</span>
00237      <span class="stringliteral">"should have been passed down (Irp = %Irp ). The IRP was targetted at "</span>
00238      <span class="stringliteral">"DeviceObject %DevObj"</span> },
00239    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a72">DCERROR_DELETED_PRESENT_PDO</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00240      <span class="stringliteral">"An IRP dispatch handler for a PDO has deleted it's device object, but "</span>
00241      <span class="stringliteral">"the hardware has not been reported as missing in a bus relations query. "</span>
00242      <span class="stringliteral">"DeviceObject = %DevObj - Dispatch = %Routine - Irp = %Irp "</span> },
00243    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a73">DCERROR_BUS_FILTER_ERRONEOUSLY_DETACHED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00244      <span class="stringliteral">"A Bus Filter's IRP dispatch handler has detached upon receiving a remove "</span>
00245      <span class="stringliteral">"IRP when the PDO is still alive. Bus Filters must clean up in "</span>
00246      <span class="stringliteral">"FastIoDetach callbacks. DeviceObject = %DevObj - Dispatch = %Routine - "</span>
00247      <span class="stringliteral">"Irp = %Irp"</span> },
00248    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a74">DCERROR_BUS_FILTER_ERRONEOUSLY_DELETED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00249      <span class="stringliteral">"An IRP dispatch handler for a bus filter has deleted it's device object, "</span>
00250      <span class="stringliteral">"but the PDO is still present! Bus filters must clean up in FastIoDetach "</span>
00251      <span class="stringliteral">"callbacks. DeviceObject = %DevObj - Dispatch = %Routine - Irp = %Irp"</span> },
00252    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a75">DCERROR_INCONSISTANT_STATUS</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00253      <span class="stringliteral">"An IRP dispatch handler ( %Routine ) has returned a status that is "</span>
00254      <span class="stringliteral">"inconsistent with the Irp's IoStatus.Status field. ( Irp = %Irp - "</span>
00255      <span class="stringliteral">"Irp-&gt;IoStatus.Status = %Status1 - returned = %Status2 )"</span> },
00256    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a76">DCERROR_UNINITIALIZED_STATUS</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00257      <span class="stringliteral">"An IRP dispatch handler has returned a status that is illegal "</span>
00258      <span class="stringliteral">"(0xFFFFFFFF). This is probably due to an uninitialized stack variable. "</span>
00259      <span class="stringliteral">"Please do an ln on address %lx and file a bug. (Irp = %Irp )"</span> },
00260    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a77">DCERROR_IRP_RETURNED_WITHOUT_COMPLETION</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00261      <span class="stringliteral">"An IRP dispatch handler has returned without passing down or completing "</span>
00262      <span class="stringliteral">"this Irp or someone forgot to return STATUS_PENDING. (Irp = %Irp )."</span> },
00263    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a78">DCERROR_COMPLETION_ROUTINE_PAGABLE</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00264      <span class="stringliteral">"IRP completion routines must be in nonpagable code, and this one is not: "</span>
00265      <span class="stringliteral">"%Routine. (Irp = %Irp )"</span> },
00266    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a79">DCERROR_PENDING_BIT_NOT_MIGRATED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00267      <span class="stringliteral">"A driver's completion routine ( %Routine ) has not marked the IRP "</span>
00268      <span class="stringliteral">"pending if the PendingReturned field was set in the IRP passed to it. "</span>
00269      <span class="stringliteral">"This may cause the OS to hang, especially if an error is returned by the "</span>
00270      <span class="stringliteral">" stack. (Irp = %Irp )"</span> },
00271    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a80">DCERROR_CANCELROUTINE_ON_FORWARDED_IRP</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00272      <span class="stringliteral">"A cancel routine has been set for an IRP that is currently being "</span>
00273      <span class="stringliteral">"processed by drivers lower in the stack, possibly stomping their cancel "</span>
00274      <span class="stringliteral">"routine (Irp = %Irp, Routine=%Routine )."</span> },
00275    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a81">DCERROR_PNP_IRP_NEEDS_PDO_HANDLING</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00276      <span class="stringliteral">"PDO has not responded to a required IRP (Irp = %Irp )"</span> },
00277    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a82">DCERROR_TARGET_RELATION_LIST_EMPTY</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00278      <span class="stringliteral">"PDO has forgotten to fill out the device relation list with the PDO for "</span>
00279      <span class="stringliteral">"the TargetDeviceRelation query (Irp = %Irp )"</span> },
00280    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a83">DCERROR_TARGET_RELATION_NEEDS_REF</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00281      <span class="stringliteral">"The code implementing the TargetDeviceRelation query has not called "</span>
00282      <span class="stringliteral">"ObReferenceObject on the PDO (Irp = %Irp )."</span> },
00283    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a84">DCERROR_BOGUS_PNP_IRP_COMPLETED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00284      <span class="stringliteral">"Caller has completed a IRP_MJ_PNP it didn't understand instead of "</span>
00285      <span class="stringliteral">"passing it down (Irp = %Irp )."</span> },
00286    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a85">DCERROR_SUCCESSFUL_PNP_IRP_NOT_FORWARDED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00287      <span class="stringliteral">"Caller has completed successful IRP_MJ_PNP instead of passing it down "</span>
00288      <span class="stringliteral">"(Irp = %Irp )."</span> },
00289    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a86">DCERROR_UNTOUCHED_PNP_IRP_NOT_FORWARDED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00290      <span class="stringliteral">"Caller has completed untouched IRP_MJ_PNP (instead of passing the irp "</span>
00291      <span class="stringliteral">"down) or non-PDO has failed the irp using illegal value of "</span>
00292      <span class="stringliteral">"STATUS_NOT_SUPPORTED. (Irp = %Irp )."</span> },
00293    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a87">DCERROR_BOGUS_POWER_IRP_COMPLETED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00294      <span class="stringliteral">"Caller has completed a IRP_MJ_POWER it didn't understand instead of "</span>
00295      <span class="stringliteral">"passing it down (Irp = %Irp )."</span> },
00296    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a88">DCERROR_SUCCESSFUL_POWER_IRP_NOT_FORWARDED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00297      <span class="stringliteral">"Caller has completed successful IRP_MJ_POWER instead of passing it down "</span>
00298      <span class="stringliteral">"(Irp = %Irp )."</span> },
00299    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a89">DCERROR_UNTOUCHED_POWER_IRP_NOT_FORWARDED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00300      <span class="stringliteral">"Caller has completed untouched IRP_MJ_POWER (instead of passing the irp "</span>
00301      <span class="stringliteral">"down) or non-PDO has failed the irp using illegal value of "</span>
00302      <span class="stringliteral">"STATUS_NOT_SUPPORTED. (Irp = %Irp )."</span> },
00303    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a90">DCERROR_PNP_QUERY_CAP_BAD_VERSION</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00304      <span class="stringliteral">"The version field of the query capabilities structure in a query "</span>
00305      <span class="stringliteral">"capabilities IRP was not properly initialized. (Irp = %Irp )."</span> },
00306    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a91">DCERROR_PNP_QUERY_CAP_BAD_SIZE</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00307      <span class="stringliteral">"The size field of the query capabilities structure in a query "</span>
00308      <span class="stringliteral">"capabilities IRP was not properly initialized. (Irp = %Irp )."</span> },
00309    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a92">DCERROR_PNP_QUERY_CAP_BAD_ADDRESS</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00310      <span class="stringliteral">"The address field of the query capabilities structure in a query "</span>
00311      <span class="stringliteral">"capabilities IRP was not properly initialized to -1. (Irp = %Irp )."</span> },
00312    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a93">DCERROR_PNP_QUERY_CAP_BAD_UI_NUM</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a14">IopDcWdmDriverErrorNonFatal</a>,
00313      <span class="stringliteral">"The UI Number field of the query capabilities structure in a query "</span>
00314      <span class="stringliteral">"capabilities IRP was not properly initialized to -1. (Irp = %Irp )."</span> },
00315    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a94">DCERROR_RESTRICTED_IRP</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00316      <span class="stringliteral">"A driver has sent an IRP that is restricted for system use only. "</span>
00317      <span class="stringliteral">"(Irp = %Irp )."</span> },
00318    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a95">DCERROR_REINIT_OF_ALLOCATED_IRP_WITHOUT_QUOTA</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a15">IopDcWdmDriverWarning</a>,
00319      <span class="stringliteral">"Caller of IoInitializeIrp has passed an IRP that was allocated with "</span>
00320      <span class="stringliteral">"IoAllocateIrp. This is illegal, unneccessary, and negatively impacts "</span>
00321      <span class="stringliteral">"performace in normal use. Check the documentation for IoReuseIrp if "</span>
00322      <span class="stringliteral">"this IRP is being recycled."</span> },
00323    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a96">DCERROR_UNFORWARDED_IRP_COMPLETED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a15">IopDcWdmDriverWarning</a>,
00324      <span class="stringliteral">"The caller of IoCompleteRequest is completing an IRP that has never "</span>
00325      <span class="stringliteral">"been forwarded via a call to IoCallDriver or PoCallDriver. This may "</span>
00326      <span class="stringliteral">"be a bug. (Irp = %Irp )."</span> },
00327    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a97">DCERROR_DISPATCH_CALLED_AT_BAD_IRQL</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00328      <span class="stringliteral">"A driver has forwarded an IRP at an IRQL that is illegal for this major"</span>
00329      <span class="stringliteral">" code. "</span>
00330      <span class="stringliteral">"(Irp = %Irp )."</span> },
00331    { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a98">DCERROR_BOGUS_MINOR_STATUS_TRASHED</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a13">IopDcWdmDriverErrorFatal</a>,
00332      <span class="stringliteral">"Caller has changed the status field of an IRP it does not understand "</span>
00333      <span class="stringliteral">"(Irp = %Irp )."</span> }
00334 };
00335 
<a name="l00336"></a><a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html">00336</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html">_DC_OVERRIDE_TABLE</a> {
00337 
<a name="l00338"></a><a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html#o0">00338</a>     <a class="code" href="../../d2/d5/ioassert_8h.html#a31">DCERROR_ID</a>       <a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html#o0">MessageID</a>;
<a name="l00339"></a><a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html#o1">00339</a>     PSTR             <a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html#o1">DriverName</a>;
<a name="l00340"></a><a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html#o2">00340</a>     <a class="code" href="../../d6/d1/struct__DCERROR__CLASS.html">PDCERROR_CLASS</a>   <a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html#o2">ReplacementClass</a>;
00341 
00342 } <a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html">DC_OVERRIDE_TABLE</a>, *<a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html">PDC_OVERRIDE_TABLE</a>;
00343 
00344 <span class="comment">//</span>
00345 <span class="comment">// This table contains things we've postponed.</span>
00346 <span class="comment">//</span>
<a name="l00347"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a21">00347</a> <a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html">DC_OVERRIDE_TABLE</a> <a class="code" href="../../d1/d5/ioassert_8c.html#a21">IopDcOverrideTable</a>[] = {
00348 
00349     <span class="comment">//</span>
00350     <span class="comment">// These exist because verifier.exe cannot specify kernels or hals. We still</span>
00351     <span class="comment">// want a mechanism to allow complaints.</span>
00352     <span class="comment">//</span>
00353     { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a39">DCERROR_UNSPECIFIED</a>, <span class="stringliteral">"HAL.DLL"</span>,      &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a17">IopDcWdmCoreError</a> },
00354     { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a39">DCERROR_UNSPECIFIED</a>, <span class="stringliteral">"NTOSKRNL.EXE"</span>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a17">IopDcWdmCoreError</a> },
00355     { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a39">DCERROR_UNSPECIFIED</a>, <span class="stringliteral">"NTKRNLMP.EXE"</span>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a17">IopDcWdmCoreError</a> },
00356     { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a39">DCERROR_UNSPECIFIED</a>, <span class="stringliteral">"NTKRNLPA.EXE"</span>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a17">IopDcWdmCoreError</a> },
00357     { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a39">DCERROR_UNSPECIFIED</a>, <span class="stringliteral">"NTKRPAMP.EXE"</span>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a17">IopDcWdmCoreError</a> },
00358 
00359     <span class="comment">//</span>
00360     <span class="comment">// ADRIAO BUGBUG 08/10/1999 -</span>
00361     <span class="comment">//     NDIS doesn't call the shutdown handlers at power-off because many are</span>
00362     <span class="comment">// unstable and that adds seconds to shutdown. This is an unsafe design as</span>
00363     <span class="comment">// the miniport, which owns an IRQ, may find it's ports drop out from under</span>
00364     <span class="comment">// it when the *parent* powers off.</span>
00365     <span class="comment">//</span>
00366     { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a88">DCERROR_SUCCESSFUL_POWER_IRP_NOT_FORWARDED</a>, <span class="stringliteral">"NDIS.SYS"</span>,
00367       &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a16">IopDcWdmDriverPostponed</a> },
00368 
00369     <span class="comment">//</span>
00370     <span class="comment">// ADRIAO BUGBUG 08/10/1999 -</span>
00371     <span class="comment">//     ACPI and PCI have to work together to handle wait-wake. In the</span>
00372     <span class="comment">// current design, ACPI.SYS gets an interface and does all the work itself.</span>
00373     <span class="comment">// The proper design should move the queueing to PCI, or tell PCI to leave</span>
00374     <span class="comment">// wait-wake IRPs alone for the given device. Cutting off any other bus</span>
00375     <span class="comment">// filters is a bad design.</span>
00376     <span class="comment">//</span>
00377     { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a88">DCERROR_SUCCESSFUL_POWER_IRP_NOT_FORWARDED</a>, <span class="stringliteral">"ACPI.SYS"</span>,
00378       &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a16">IopDcWdmDriverPostponed</a> },
00379 
00380     <span class="comment">//</span>
00381     <span class="comment">// ADRIAO BUGBUG 08/20/1999 -</span>
00382     <span class="comment">//     This is on QueryCapabilities, which PCMCIA caches but should not.</span>
00383     <span class="comment">// NeilSa has postponed this one till NT 5.1</span>
00384     <span class="comment">//</span>
00385     { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a85">DCERROR_SUCCESSFUL_PNP_IRP_NOT_FORWARDED</a>, <span class="stringliteral">"PCMCIA.SYS"</span>,
00386       &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a16">IopDcWdmDriverPostponed</a> },
00387 
00388     <span class="comment">//</span>
00389     <span class="comment">// ADRIAO BUGBUG 08/20/1999 -</span>
00390     <span class="comment">//     PCMCIA completes Queries for S-IRPs. NeilSa has postponed this one</span>
00391     <span class="comment">// till NT 5.1</span>
00392     <span class="comment">//</span>
00393     { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a88">DCERROR_SUCCESSFUL_POWER_IRP_NOT_FORWARDED</a>, <span class="stringliteral">"PCMCIA.SYS"</span>,
00394       &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a16">IopDcWdmDriverPostponed</a> },
00395 
00396     <span class="comment">//</span>
00397     <span class="comment">// ADRIAO BUGBUG 08/21/1999 -</span>
00398     <span class="comment">//     SCSIPORT doesn't forward S0 Irps if the system is already in S0.</span>
00399     <span class="comment">// Consider if a PDO succeeds a Query-S1 IRP and then waits for either a</span>
00400     <span class="comment">// Set to S1, a new Query, or a Set to S0 meaning no transition will take</span>
00401     <span class="comment">// place after all. A filter between SCSIPORT and the PDO could fail the</span>
00402     <span class="comment">// Query-S1 on the way up. SCSIPORT knows the system has decided to stay in</span>
00403     <span class="comment">// S0, but it cuts such knowledge off from the PDO. Luckily today's list of</span>
00404     <span class="comment">// likely PDO's don't have such logic though. PeterWie has postponed this</span>
00405     <span class="comment">// one till NT 5.1</span>
00406     <span class="comment">//</span>
00407     { <a class="code" href="../../d2/d5/ioassert_8h.html#a114a88">DCERROR_SUCCESSFUL_POWER_IRP_NOT_FORWARDED</a>, <span class="stringliteral">"SCSIPORT.SYS"</span>,
00408       &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a16">IopDcWdmDriverPostponed</a> }
00409 };
00410 
00411 <span class="preprocessor">#ifdef  ALLOC_DATA_PRAGMA</span>
00412 <span class="preprocessor"></span><span class="preprocessor">#pragma data_seg()</span>
00413 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00414 <span class="preprocessor"></span>
00415 PCHAR
00416 <a class="code" href="../../d9/d1/bugcheck_8c.html#a15">KeBugCheckUnicodeToAnsi</a>(
00417     IN PUNICODE_STRING UnicodeString,
00418     OUT PCHAR AnsiBuffer,
00419     IN ULONG MaxAnsiLength
00420     );
00421 
00422 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00423"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a100">00423</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a100">IopDriverCorrectnessTakeLock</a>(
00424     IN PULONG ControlNew,
00425     IN LONG   StackFramesToSkip
00426     )
00427 <span class="comment">/*++</span>
00428 <span class="comment"></span>
00429 <span class="comment">   Description:</span>
00430 <span class="comment"></span>
00431 <span class="comment">      Worker routine for KD_ASSERT_OUT, takes the assertion spinlock. We do</span>
00432 <span class="comment">      this because we *must* use a macro to instantiate a caller-specific</span>
00433 <span class="comment">      tag and we cannot pass in that value along with a variable printf style</span>
00434 <span class="comment">      debug output. Hence we must "pre-program" the output routine with the</span>
00435 <span class="comment">      breakpoint ID, and use a spinlock to protect ourselves</span>
00436 <span class="comment">--*/</span>
00437 {
00438     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d2/d5/ioassert_8h.html#a25">IovpInitCalled</a>);
00439     ExAcquireSpinLock( &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a7">IopDcControlLock</a>, &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a6">IopDcControlIrql</a> );
00440     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d1/d5/ioassert_8c.html#a4">IopDcControlCurrent</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ;
00441     <a class="code" href="../../d1/d5/ioassert_8c.html#a4">IopDcControlCurrent</a> = ControlNew ;
00442     <a class="code" href="../../d1/d5/ioassert_8c.html#a5">IopDcCurrentFrameSkips</a> = StackFramesToSkip ;
00443 }
00444 
00445 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00446"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a102">00446</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a102">IopDriverCorrectnessReleaseLock</a>(
00447     VOID
00448     )
00449 <span class="comment">/*++</span>
00450 <span class="comment"></span>
00451 <span class="comment">   Description:</span>
00452 <span class="comment"></span>
00453 <span class="comment">      Worker routine for KD_ASSERT_OUT, see IopDiagSetAssertLock</span>
00454 <span class="comment"></span>
00455 <span class="comment">--*/</span>
00456 {
00457     <a class="code" href="../../d1/d5/ioassert_8c.html#a4">IopDcControlCurrent</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ;
00458     <a class="code" href="../../d1/d5/ioassert_8c.html#a5">IopDcCurrentFrameSkips</a> = -1 ;
00459     ExReleaseSpinLock( &amp;<a class="code" href="../../d1/d5/ioassert_8c.html#a7">IopDcControlLock</a>, <a class="code" href="../../d1/d5/ioassert_8c.html#a6">IopDcControlIrql</a> );
00460 }
00461 
00462 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00463"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a101">00463</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a101">IopDriverCorrectnessCheckUnderLock</a>(
00464     IN <a class="code" href="../../d2/d5/ioassert_8h.html#a31">DCERROR_ID</a>    MessageID,
00465     IN ULONG         MessageParameterMask,
00466     ...
00467     )
00468 <span class="comment">/*++</span>
00469 <span class="comment"></span>
00470 <span class="comment">   Description:</span>
00471 <span class="comment"></span>
00472 <span class="comment">      This routine displays an assert and provides options for</span>
00473 <span class="comment">      removing the breakpoint, changing to just a text-out, etc.</span>
00474 <span class="comment"></span>
00475 <span class="comment">    This routine is used as part of a macro for providing "Zappable" traps -</span>
00476 <span class="comment">    IE, users get the option of changing how a specific instance of</span>
00477 <span class="comment">    WDM_DEBUG_OUT in the code is handled (default is spew and break, options</span>
00478 <span class="comment">    are spew or blow away for this boot).</span>
00479 <span class="comment"></span>
00480 <span class="comment">    Macro must call IopDiagSetAssertLock, IopDiagAssertPrintfUnderLock, and</span>
00481 <span class="comment">    IopDiagReleaseAssertLock in order</span>
00482 <span class="comment"></span>
00483 <span class="comment">    DCPARAM_IRP*(count)+DCPARAM_ROUTINE*(count)+DCPARAM_DEVOBJ*(count),</span>
00484 <span class="comment">        irp1,</span>
00485 <span class="comment">        irp2,</span>
00486 <span class="comment">        irp3,</span>
00487 <span class="comment">        routine1,</span>
00488 <span class="comment">        ..,</span>
00489 <span class="comment">        ..,</span>
00490 <span class="comment">        devobj1,</span>
00491 <span class="comment"></span>
00492 <span class="comment">    count can be a max of 3.</span>
00493 <span class="comment"></span>
00494 <span class="comment"></span>
00495 <span class="comment">   Arguments:</span>
00496 <span class="comment"></span>
00497 <span class="comment">      Control - if present, this variable determines whether we will</span>
00498 <span class="comment">                 actually do anything.</span>
00499 <span class="comment"></span>
00500 <span class="comment">                if DIAG_ZAPPED is set we will print the assert text and return.</span>
00501 <span class="comment">                if DIAG_CLEARED is set, we will neither print or stop.</span>
00502 <span class="comment">                if DIAG_BEEP is set, we will beep if not zapped.</span>
00503 <span class="comment"></span>
00504 <span class="comment">      StackFramesToSkip - If this parameter is -1, it is not used.</span>
00505 <span class="comment">                          Otherwise, the assertion code will attempt to walk</span>
00506 <span class="comment">                          back the appropriate number of frames and</span>
00507 <span class="comment">                          determine the caller to blame based on return</span>
00508 <span class="comment">                          address.</span>
00509 <span class="comment"></span>
00510 <span class="comment">      IrpToFlag      - IRP to print out failure data for if mishandling of</span>
00511 <span class="comment">                       this IRP was the source of the error.</span>
00512 <span class="comment"></span>
00513 <span class="comment">      AddressToFlag  - Address that the assert should be blaimed on. This</span>
00514 <span class="comment">                       should be null if StackFramesToSkip is not -1.</span>
00515 <span class="comment"></span>
00516 <span class="comment">      AssertionClass - Text describing the overall class of the assert</span>
00517 <span class="comment"></span>
00518 <span class="comment">      AssertionText  - Text specifically describing the assert. Carriage</span>
00519 <span class="comment">                       returns should not be embedded in the text, this</span>
00520 <span class="comment">                       routine will automatically ensure words are not split</span>
00521 <span class="comment">                       across the screen.</span>
00522 <span class="comment"></span>
00523 <span class="comment">   Notes:</span>
00524 <span class="comment"></span>
00525 <span class="comment">      The text will automagically be formatted and printed as such:</span>
00526 <span class="comment"></span>
00527 <span class="comment">      ASSERTION CLASS: ASSERTION TEXT ASSERTION TEXT ASSERTION</span>
00528 <span class="comment">                       TEXT ASSERTION TEXT ...</span>
00529 <span class="comment"></span>
00530 <span class="comment">--*/</span>
00531 
00532 {
00533     va_list arglist;
00534     UCHAR finalBuffer[512];
00535     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00536     <a class="code" href="../../d3/d0/struct__DC__CHECK__DATA.html">DC_CHECK_DATA</a> dcCheckData;
00537     PVOID dcParamArray[3*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d5/ioassert_8c.html#a10">DcParamTable</a>)/<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d1/struct__DCPARAM__TYPE__ENTRY.html">DCPARAM_TYPE_ENTRY</a>)];
00538     BOOLEAN exitAssertion;
00539 
00540     va_start(arglist, MessageParameterMask);
00541 
00542     <span class="comment">//</span>
00543     <span class="comment">// Determine what our basic policy towards this check will be and fill out</span>
00544     <span class="comment">// the dcCheckData structure as well as we can.</span>
00545     <span class="comment">//</span>
00546     <a class="code" href="../../d2/d5/ioassert_8h.html#a104">IopDriverCorrectnessProcessParams</a>(
00547         <a class="code" href="../../d1/d5/ioassert_8c.html#a4">IopDcControlCurrent</a>,
00548         <a class="code" href="../../d1/d5/ioassert_8c.html#a5">IopDcCurrentFrameSkips</a>,
00549         MessageID,
00550         MessageParameterMask,
00551         &amp;arglist,
00552         dcParamArray,
00553         &amp;dcCheckData
00554         );
00555 
00556     va_end(arglist);
00557 
00558     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d5/ioassert_8h.html#a105">IopDriverCorrectnessApplyControl</a>(&amp;dcCheckData)) {
00559 
00560         <span class="comment">//</span>
00561         <span class="comment">// Nothing to see here, just ignore the assert...</span>
00562         <span class="comment">//</span>
00563         <span class="keywordflow">return</span> STATUS_SUCCESS;
00564     }
00565 
00566     <span class="comment">//</span>
00567     <span class="comment">// We are going to express our disatifaction somehow. Expand out the</span>
00568     <span class="comment">// message we've prepared for this scenario.</span>
00569     <span class="comment">//</span>
00570     status = <a class="code" href="../../d2/d5/ioassert_8h.html#a103">IopDriverCorrectnessProcessMessageText</a>(
00571         <span class="keyword">sizeof</span>(finalBuffer),
00572         finalBuffer,
00573         &amp;dcCheckData
00574         );
00575 
00576     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00577 
00578         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(0);
00579 
00580         <span class="comment">//</span>
00581         <span class="comment">// Something went wrong with the index lookup!</span>
00582         <span class="comment">//</span>
00583         <span class="keywordflow">return</span> status;
00584     }
00585 
00586     <span class="keywordflow">do</span> {
00587 
00588         <a class="code" href="../../d2/d5/ioassert_8h.html#a107">IopDriverCorrectnessPrintBuffer</a>(&amp;dcCheckData);
00589         <a class="code" href="../../d2/d5/ioassert_8h.html#a108">IopDriverCorrectnessPrintParamData</a>(&amp;dcCheckData);
00590         <a class="code" href="../../d2/d5/ioassert_8h.html#a106">IopDriverCorrectnessThrowBugCheck</a>(&amp;dcCheckData);
00591         <a class="code" href="../../d2/d5/ioassert_8h.html#a111">IopDriverCorrectnessPrompt</a>(&amp;dcCheckData, &amp;exitAssertion);
00592 
00593     } <span class="keywordflow">while</span> (!exitAssertion);
00594 
00595     <span class="keywordflow">return</span> status;
00596 }
00597 
00598 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00599"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a104">00599</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a104">IopDriverCorrectnessProcessParams</a>(
00600     IN OUT PULONG          Control OPTIONAL,
00601     IN LONG                StackFramesToSkip,
00602     IN DCERROR_ID          MessageID,
00603     IN ULONG               MessageParameterMask,
00604     IN va_list *           MessageParameters,
00605     IN PVOID *             DcParamArray,
00606     OUT <a class="code" href="../../d3/d0/struct__DC__CHECK__DATA.html">PDC_CHECK_DATA</a>     DcCheckData
00607     )
00608 {
00609     PVOID returnAddress[1];
00610     PVOID baseOfImage, culpritAddress;
00611     ULONG stackHash;
00612     PLDR_DATA_TABLE_ENTRY dataTableEntry;
00613     PIMAGE_NT_HEADERS ntHeaders;
00614     ULONG i, currentMessageMask, paramType, maxParameterTypes, paramMask;
00615     ULONG tableIndex;
00616     <span class="keywordtype">char</span> ansiDriverName[81];
00617 
00618     tableIndex = MessageID - <a class="code" href="../../d2/d5/ioassert_8h.html#a114a39">DCERROR_UNSPECIFIED</a>;
00619 
00620     <span class="comment">//</span>
00621     <span class="comment">// Retrieve a pointer to the appropriate message text.</span>
00622     <span class="comment">//</span>
00623     <span class="keywordflow">if</span> (tableIndex &gt;= <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d5/ioassert_8c.html#a18">IopDcMessageTable</a>)/<span class="keyword">sizeof</span>(<a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html">DCERROR_MESSAGE</a>)) {
00624 
00625         <span class="comment">//</span>
00626         <span class="comment">// Bogus message index!</span>
00627         <span class="comment">//</span>
00628         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(0);
00629         tableIndex = 0;
00630     }
00631 
00632     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d1/d5/ioassert_8c.html#a18">IopDcMessageTable</a>[tableIndex].MessageID == MessageID);
00633 
00634     <span class="comment">//</span>
00635     <span class="comment">// OK, we're going to do *something*. Process the incoming parameters.</span>
00636     <span class="comment">//</span>
00637     maxParameterTypes = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d5/ioassert_8c.html#a10">DcParamTable</a>)/<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d1/struct__DCPARAM__TYPE__ENTRY.html">DCPARAM_TYPE_ENTRY</a>);
00638 
00639     <span class="comment">//</span>
00640     <span class="comment">// First we grab parameter off the stack and slot them appropriately into</span>
00641     <span class="comment">// our array of "things".</span>
00642     <span class="comment">//</span>
00643     <span class="comment">// The array is in groups of three for each possible member of a given type</span>
00644     <span class="comment">// (three irps, three routines, three device objects, etc). Items not</span>
00645     <span class="comment">// referenced in are set to NULL.</span>
00646     <span class="comment">//</span>
00647     currentMessageMask = MessageParameterMask;
00648 
00649     <span class="keywordflow">for</span>(paramType = 0; paramType &lt; maxParameterTypes; paramType++) {
00650 
00651         paramMask = <a class="code" href="../../d1/d5/ioassert_8c.html#a10">DcParamTable</a>[paramType].<a class="code" href="../../d8/d1/struct__DCPARAM__TYPE__ENTRY.html#o0">DcParamMask</a> ;
00652         <span class="keywordflow">for</span>(i=0; i&lt;3; i++) {
00653 
00654             <span class="keywordflow">if</span> (currentMessageMask&amp;(paramMask*3)) {
00655 
00656                 currentMessageMask -= paramMask;
00657                 DcParamArray[paramType*3+i] = va_arg(*MessageParameters, PVOID);
00658 
00659             } <span class="keywordflow">else</span> {
00660 
00661                 DcParamArray[paramType*3+i] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00662             }
00663         }
00664     }
00665 
00666     <span class="comment">//</span>
00667     <span class="comment">// If this fires, part of the MessageParameterMask was not understood,</span>
00668     <span class="comment">// probably a bug by the caller!</span>
00669     <span class="comment">//</span>
00670     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(currentMessageMask == 0);
00671 
00672     <span class="comment">//</span>
00673     <span class="comment">// Pre-init unhelpful answers...</span>
00674     <span class="comment">//</span>
00675     culpritAddress = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00676     DcCheckData-&gt;OffsetIntoImage = 0;
00677     DcCheckData-&gt;InVerifierList = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00678     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;DcCheckData-&gt;DriverName, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00679 
00680     <span class="comment">//</span>
00681     <span class="comment">// Blame caller if appropriate</span>
00682     <span class="comment">//</span>
00683     <span class="keywordflow">if</span> (StackFramesToSkip != -1) {
00684 
00685         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d2/ppc_2getcalr_8c.html#a1">RtlCaptureStackBackTrace</a>(StackFramesToSkip+2, 1, returnAddress,
00686            &amp;stackHash)==1) {
00687 
00688             culpritAddress = returnAddress[0];
00689         }
00690 
00691     } <span class="keywordflow">else</span> {
00692 
00693         <span class="comment">//</span>
00694         <span class="comment">// %Routine1</span>
00695         <span class="comment">//</span>
00696         culpritAddress = DcParamArray[3];
00697     }
00698 
00699     <span class="comment">//</span>
00700     <span class="comment">// Extract the culprit's name if possible...</span>
00701     <span class="comment">//</span>
00702     <span class="keywordflow">if</span> (culpritAddress) {
00703 
00704         baseOfImage = <a class="code" href="../../d2/d5/ioassert_8h.html#a112">IopDriverCorrectnessAddressToFileHeader</a>(
00705             (PVOID) culpritAddress,
00706             &amp;dataTableEntry
00707             );
00708 
00709         <span class="keywordflow">if</span> (baseOfImage != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00710 
00711             <span class="comment">//</span>
00712             <span class="comment">// If we found a match, drill into the dataTableEntry's to get</span>
00713             <span class="comment">//</span>
00714             <span class="comment">//</span>
00715             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d2/pagfault_8c.html#a26">MmIsAddressValid</a>(dataTableEntry-&gt;DllBase) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00716 
00717                 ntHeaders = <a class="code" href="../../d8/d9/imagedir_8c.html#a0">RtlImageNtHeader</a>(dataTableEntry-&gt;DllBase);
00718 
00719                 RtlCopyMemory(
00720                     &amp;DcCheckData-&gt;DriverName,
00721                     &amp;dataTableEntry-&gt;BaseDllName,
00722                     <span class="keyword">sizeof</span>(UNICODE_STRING)
00723                     );
00724 
00725                 DcCheckData-&gt;OffsetIntoImage = (PUCHAR) culpritAddress - (PUCHAR) baseOfImage;
00726             }
00727 
00728             <span class="comment">//</span>
00729             <span class="comment">// Now record whether this is in the verifying table.</span>
00730             <span class="comment">//</span>
00731             <span class="keywordflow">if</span> (!(dataTableEntry-&gt;Flags &amp; LDRP_IMAGE_VERIFYING)) {
00732 
00733                 DcCheckData-&gt;InVerifierList = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00734             }
00735         }
00736     }
00737 
00738     DcCheckData-&gt;CulpritAddress = culpritAddress;
00739     DcCheckData-&gt;DcParamArray = DcParamArray;
00740     DcCheckData-&gt;TableIndex = tableIndex;
00741     DcCheckData-&gt;MessageID = MessageID;
00742     DcCheckData-&gt;Control = Control;
00743     DcCheckData-&gt;AssertionClass = <a class="code" href="../../d1/d5/ioassert_8c.html#a18">IopDcMessageTable</a>[DcCheckData-&gt;TableIndex].<a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html#o1">MessageClass</a>;
00744 
00745     <span class="comment">//</span>
00746     <span class="comment">// Get an ANSI version of the driver name and root through the override</span>
00747     <span class="comment">// table.</span>
00748     <span class="comment">//</span>
00749     <a class="code" href="../../d9/d1/bugcheck_8c.html#a15">KeBugCheckUnicodeToAnsi</a>(
00750         &amp;DcCheckData-&gt;DriverName,
00751         ansiDriverName,
00752         <span class="keyword">sizeof</span>(ansiDriverName)
00753         );
00754 
00755     <span class="keywordflow">for</span>(i=0; i&lt;<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d5/ioassert_8c.html#a21">IopDcOverrideTable</a>)/<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html">DC_OVERRIDE_TABLE</a>); i++) {
00756 
00757         <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d5/ioassert_8c.html#a21">IopDcOverrideTable</a>[i].<a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html#o0">MessageID</a> == MessageID) ||
00758            (<a class="code" href="../../d1/d5/ioassert_8c.html#a21">IopDcOverrideTable</a>[i].<a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html#o0">MessageID</a> == <a class="code" href="../../d2/d5/ioassert_8h.html#a114a39">DCERROR_UNSPECIFIED</a>)) {
00759 
00760             <span class="keywordflow">if</span> (!_stricmp(ansiDriverName, <a class="code" href="../../d1/d5/ioassert_8c.html#a21">IopDcOverrideTable</a>[i].DriverName)) {
00761 
00762                 <span class="comment">//</span>
00763                 <span class="comment">// We have a match, override the error class. Note that as</span>
00764                 <span class="comment">// Control is not per-driver, but per assert, we null out</span>
00765                 <span class="comment">// the passed in Control so that we don't apply this override</span>
00766                 <span class="comment">// policy against every driver!</span>
00767                 <span class="comment">//</span>
00768                 DcCheckData-&gt;Control = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00769                 DcCheckData-&gt;AssertionClass = <a class="code" href="../../d1/d5/ioassert_8c.html#a21">IopDcOverrideTable</a>[i].<a class="code" href="../../d8/d0/struct__DC__OVERRIDE__TABLE.html#o2">ReplacementClass</a>;
00770             }
00771         }
00772     }
00773 }
00774 
00775 BOOLEAN
<a name="l00776"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a105">00776</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a105">IopDriverCorrectnessApplyControl</a>(
00777     IN OUT <a class="code" href="../../d3/d0/struct__DC__CHECK__DATA.html">PDC_CHECK_DATA</a>  DcCheckData
00778     )
00779 {
00780     ULONG assertionControl;
00781 
00782     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d5/ioassert_8c.html#a9">IopDcControlOverride</a>) {
00783 
00784         assertionControl = <a class="code" href="../../d1/d5/ioassert_8c.html#a9">IopDcControlOverride</a>;
00785 
00786     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (DcCheckData-&gt;Control) {
00787 
00788         <span class="comment">//</span>
00789         <span class="comment">// Initialize the control if appropo</span>
00790         <span class="comment">//</span>
00791         <span class="keywordflow">if</span> (!((*DcCheckData-&gt;Control)&amp;<a class="code" href="../../d2/d5/ioassert_8h.html#a0">DIAG_INITIALIZED</a>)) {
00792 
00793             *DcCheckData-&gt;Control |= (
00794                 <a class="code" href="../../d2/d5/ioassert_8h.html#a0">DIAG_INITIALIZED</a> | <a class="code" href="../../d1/d5/ioassert_8c.html#a8">IopDcControlInitial</a> |
00795                 DcCheckData-&gt;AssertionClass-&gt;ClassFlags );
00796         }
00797 
00798         assertionControl = *DcCheckData-&gt;Control;
00799 
00800     } <span class="keywordflow">else</span> {
00801 
00802         assertionControl =
00803             ( <a class="code" href="../../d1/d5/ioassert_8c.html#a8">IopDcControlInitial</a> | DcCheckData-&gt;AssertionClass-&gt;ClassFlags );
00804     }
00805 
00806     <span class="keywordflow">if</span> (assertionControl&amp;<a class="code" href="../../d2/d5/ioassert_8h.html#a3">DIAG_CLEARED</a>) {
00807 
00808         <span class="comment">//</span>
00809         <span class="comment">// If the breakpoint was cleared, then return, print/rip not.</span>
00810         <span class="comment">//</span>
00811         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00812     }
00813 
00814     <span class="keywordflow">if</span> ((!(assertionControl&amp;<a class="code" href="../../d2/d5/ioassert_8h.html#a6">DIAG_IGNORE_DRIVER_LIST</a>)) &amp;&amp;
00815         (!DcCheckData-&gt;InVerifierList)) {
00816 
00817         <span class="comment">//</span>
00818         <span class="comment">// Not of interest, skip this one.</span>
00819         <span class="comment">//</span>
00820         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00821     }
00822 
00823     <span class="comment">//</span>
00824     <span class="comment">// If there is no debugger, don't halt the machine. We are probably</span>
00825     <span class="comment">// ripping like mad and the user just wants to be able to boot.</span>
00826     <span class="comment">// The one exception is if DIAG_FATAL_ERROR is set. Then we shall</span>
00827     <span class="comment">// invoke the driver bugcheck...</span>
00828     <span class="comment">//</span>
00829     <span class="keywordflow">if</span> ((!<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a>) &amp;&amp; (!(assertionControl&amp;<a class="code" href="../../d2/d5/ioassert_8h.html#a4">DIAG_FATAL_ERROR</a>))) {
00830 
00831         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00832     }
00833 
00834     <span class="comment">//</span>
00835     <span class="comment">// Record our intentions and continue.</span>
00836     <span class="comment">//</span>
00837     DcCheckData-&gt;AssertionControl = assertionControl;
00838     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00839 }
00840 
00841 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00842"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a103">00842</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a103">IopDriverCorrectnessProcessMessageText</a>(
00843     IN ULONG               MaxOutputBufferSize,
00844     OUT PSTR               OutputBuffer,
00845     IN OUT <a class="code" href="../../d3/d0/struct__DC__CHECK__DATA.html">PDC_CHECK_DATA</a>  DcCheckData
00846     )
00847 {
00848     ULONG paramType, maxParameterTypes;
00849     ULONG arrayIndex, paramLength;
00850     PSTR messageHead, newMessage;
00851     LONG charsRemaining, length;
00852 
00853     <span class="comment">//</span>
00854     <span class="comment">// Get the message text.</span>
00855     <span class="comment">//</span>
00856     messageHead = <a class="code" href="../../d1/d5/ioassert_8c.html#a18">IopDcMessageTable</a>[DcCheckData-&gt;TableIndex].<a class="code" href="../../d7/d1/struct__DCERROR__MESSAGE.html#o2">MessageText</a>;
00857 
00858     <span class="comment">//</span>
00859     <span class="comment">// Now manually build out the message.</span>
00860     <span class="comment">//</span>
00861     newMessage = OutputBuffer;
00862     charsRemaining = (MaxOutputBufferSize/<span class="keyword">sizeof</span>(UCHAR))-1;
00863     maxParameterTypes = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d5/ioassert_8c.html#a10">DcParamTable</a>)/<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d1/struct__DCPARAM__TYPE__ENTRY.html">DCPARAM_TYPE_ENTRY</a>);
00864 
00865     <span class="keywordflow">while</span>(*messageHead != <span class="charliteral">'\0'</span>) {
00866 
00867         <span class="keywordflow">if</span> (charsRemaining &lt;= 0) {
00868 
00869             <span class="keywordflow">return</span> STATUS_BUFFER_OVERFLOW;
00870         }
00871 
00872         <span class="keywordflow">if</span> (*messageHead != <span class="charliteral">'%'</span>) {
00873 
00874             *newMessage = *messageHead;
00875             newMessage++;
00876             messageHead++;
00877             charsRemaining--;
00878 
00879         } <span class="keywordflow">else</span> {
00880 
00881             <span class="keywordflow">for</span>(paramType = 0; paramType &lt; maxParameterTypes; paramType++) {
00882 
00883                 paramLength = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(<a class="code" href="../../d1/d5/ioassert_8c.html#a10">DcParamTable</a>[paramType].DcParamName);
00884 
00885                 <span class="comment">//</span>
00886                 <span class="comment">// Do we have a match?</span>
00887                 <span class="comment">//</span>
00888                 <span class="comment">// N.B. - We don't do any case 'de-sensitizing' anywhere, so</span>
00889                 <span class="comment">//        everything's cases must match!</span>
00890                 <span class="comment">//</span>
00891                 <span class="keywordflow">if</span> (RtlCompareMemory(
00892                     messageHead+1,
00893                     <a class="code" href="../../d1/d5/ioassert_8c.html#a10">DcParamTable</a>[paramType].DcParamName,
00894                     paramLength*<span class="keyword">sizeof</span>(UCHAR)) == paramLength*<span class="keyword">sizeof</span>(UCHAR)) {
00895 
00896                     arrayIndex = paramType*3;
00897                     messageHead += (paramLength+1);
00898 
00899                     <span class="comment">//</span>
00900                     <span class="comment">// Was an index passed in (ie, "3rd" irp requested)?</span>
00901                     <span class="comment">//</span>
00902                     <span class="keywordflow">if</span> ((*messageHead &gt;= <span class="charliteral">'1'</span>) &amp;&amp; (*messageHead &lt;= <span class="charliteral">'3'</span>)) {
00903 
00904                         <span class="comment">//</span>
00905                         <span class="comment">// Adjust table index appropriately.</span>
00906                         <span class="comment">//</span>
00907                         arrayIndex += (*messageHead - <span class="charliteral">'1'</span>) ;
00908                         messageHead++;
00909                     }
00910 
00911                     length = _snprintf(
00912                         newMessage,
00913                         charsRemaining+1,
00914                         <span class="stringliteral">"%p"</span>,
00915                         DcCheckData-&gt;DcParamArray[arrayIndex]
00916                         );
00917 
00918                     <span class="keywordflow">if</span> (length == -1) {
00919 
00920                         <span class="keywordflow">return</span> STATUS_BUFFER_OVERFLOW;
00921                     }
00922 
00923                     charsRemaining -= length;
00924                     newMessage += length;
00925                     <span class="keywordflow">break</span>;
00926                 }
00927             }
00928 
00929             <span class="keywordflow">if</span> (paramType == maxParameterTypes) {
00930 
00931                 <span class="comment">//</span>
00932                 <span class="comment">// Either the message we looked up is malformed, we don't recognize</span>
00933                 <span class="comment">// the %thing it is talking about, or this is %%!</span>
00934                 <span class="comment">//</span>
00935                 *newMessage = *messageHead;
00936                 messageHead++;
00937                 newMessage++;
00938                 charsRemaining--;
00939 
00940                 <span class="keywordflow">if</span> (*messageHead == <span class="charliteral">'%'</span>) {
00941 
00942                     messageHead++;
00943                 }
00944             }
00945         }
00946     }
00947 
00948     <span class="comment">//</span>
00949     <span class="comment">// Null-terminate it (we have room because we took one off the buffer size</span>
00950     <span class="comment">// above).</span>
00951     <span class="comment">//</span>
00952     *newMessage = <span class="charliteral">'\0'</span>;
00953 
00954     DcCheckData-&gt;ClassText = DcCheckData-&gt;AssertionClass-&gt;MessageClassText;
00955     DcCheckData-&gt;AssertionText = OutputBuffer;
00956     <span class="keywordflow">return</span> STATUS_SUCCESS;
00957 }
00958 
00959 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00960"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a106">00960</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a106">IopDriverCorrectnessThrowBugCheck</a>(
00961     IN <a class="code" href="../../d3/d0/struct__DC__CHECK__DATA.html">PDC_CHECK_DATA</a> DcCheckData
00962     )
00963 {
00964     PVOID parameterArray[4];
00965     <span class="keywordtype">char</span> captionBuffer[256];
00966     <span class="keywordtype">char</span> ansiDriverName[81];
00967     UNICODE_STRING unicodeString;
00968 
00969     <span class="comment">//</span>
00970     <span class="comment">// Do not bugcheck if a kernel debugger is attached, nor if this isn't a</span>
00971     <span class="comment">// fatal error.</span>
00972     <span class="comment">//</span>
00973     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> || (!(DcCheckData-&gt;AssertionControl&amp;<a class="code" href="../../d2/d5/ioassert_8h.html#a4">DIAG_FATAL_ERROR</a>))) {
00974 
00975         <span class="keywordflow">return</span>;
00976     }
00977 
00978     <span class="comment">//</span>
00979     <span class="comment">// We are here because DIAG_FATAL_ERROR is set. We use</span>
00980     <span class="comment">// FATAL_UNHANDLED_HARD_ERROR so that we can give a</span>
00981     <span class="comment">// descriptive text string for the problem.</span>
00982     <span class="comment">//</span>
00983     parameterArray[0] = (PVOID) DcCheckData-&gt;MessageID;
00984     parameterArray[1] = DcCheckData-&gt;CulpritAddress;
00985     parameterArray[2] = DcCheckData-&gt;DcParamArray[0];
00986     parameterArray[3] = DcCheckData-&gt;DcParamArray[6];
00987 
00988     <a class="code" href="../../d9/d1/bugcheck_8c.html#a15">KeBugCheckUnicodeToAnsi</a>(
00989         &amp;DcCheckData-&gt;DriverName,
00990         ansiDriverName,
00991         <span class="keyword">sizeof</span>(ansiDriverName)
00992         );
00993 
00994     _snprintf(
00995         captionBuffer,
00996         <span class="keyword">sizeof</span>(captionBuffer),
00997         <span class="stringliteral">"IO SYSTEM VERIFICATION ERROR in %s (%s %x)\n[%s+%x at %p]\n"</span>,
00998         ansiDriverName,
00999         DcCheckData-&gt;ClassText,
01000         DcCheckData-&gt;MessageID,
01001         ansiDriverName,
01002         DcCheckData-&gt;OffsetIntoImage,
01003         DcCheckData-&gt;CulpritAddress
01004         );
01005 
01006     <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(
01007         FATAL_UNHANDLED_HARD_ERROR,
01008         DRIVER_VERIFIER_IOMANAGER_VIOLATION,
01009         (ULONG_PTR) parameterArray,
01010         (ULONG_PTR) captionBuffer,
01011         (ULONG_PTR) <span class="stringliteral">""</span> <span class="comment">// DcCheckData-&gt;AssertionText is too technical</span>
01012         );
01013 }
01014 
01015 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01016"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a107">01016</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a107">IopDriverCorrectnessPrintBuffer</a>(
01017     IN <a class="code" href="../../d3/d0/struct__DC__CHECK__DATA.html">PDC_CHECK_DATA</a> DcCheckData
01018     )
01019 {
01020     UCHAR buffer[82];
01021     UCHAR classBuf[81];
01022     UCHAR callerBuf[81+40];
01023     UCHAR ansiDriverName[81];
01024     LONG  lMargin, i, lMarginCur, rMargin=78;
01025     PSTR lineStart, lastWord, current, lMarginText;
01026 
01027     <span class="comment">//</span>
01028     <span class="comment">// Put down a carraige return</span>
01029     <span class="comment">//</span>
01030     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>) ;
01031 
01032     <span class="comment">//</span>
01033     <span class="comment">// Drop a banner if this is a fatal assert.</span>
01034     <span class="comment">//</span>
01035     <span class="keywordflow">if</span> (DcCheckData-&gt;AssertionControl&amp;<a class="code" href="../../d2/d5/ioassert_8h.html#a4">DIAG_FATAL_ERROR</a>) {
01036 
01037         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(
01038             <span class="stringliteral">"***********************************************************************\n"</span>
01039             <span class="stringliteral">"* THIS DRIVER BUG IS FATAL AND WILL CAUSE THE VERIFIER TO HALT        *\n"</span>
01040             <span class="stringliteral">"* WINDOWS (BUGCHECK) WHEN THE MACHINE IS NOT UNDER A KERNEL DEBUGGER! *\n"</span>
01041             <span class="stringliteral">"***********************************************************************\n"</span>
01042             <span class="stringliteral">"\n"</span>
01043             );
01044     }
01045 
01046     <span class="comment">//</span>
01047     <span class="comment">// Prepare left margin (ClassText)</span>
01048     <span class="comment">//</span>
01049     <span class="keywordflow">if</span> (DcCheckData-&gt;ClassText != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01050 
01051         lMargin = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(DcCheckData-&gt;ClassText)+2;
01052 
01053         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%s: "</span>, DcCheckData-&gt;ClassText);
01054 
01055     } <span class="keywordflow">else</span> {
01056 
01057         lMargin = 0;
01058     }
01059 
01060     <span class="keywordflow">if</span> (lMargin+1&gt;=rMargin) {
01061 
01062         lMargin=0;
01063     }
01064 
01065     <span class="keywordflow">for</span>(i=0; i&lt;lMargin; i++) classBuf[i] = <span class="charliteral">' '</span>;
01066     classBuf[lMargin] = <span class="charliteral">'\0'</span>;
01067     lMarginText = classBuf+lMargin;
01068     lMarginCur = lMargin;
01069 
01070     lineStart = lastWord = current = DcCheckData-&gt;AssertionText;
01071 
01072     <span class="comment">//</span>
01073     <span class="comment">// Print out culprit if we have him...</span>
01074     <span class="comment">//</span>
01075     <span class="keywordflow">if</span> (DcCheckData-&gt;CulpritAddress) {
01076 
01077         <span class="keywordflow">if</span> (DcCheckData-&gt;DriverName.Length) {
01078 
01079             <a class="code" href="../../d9/d1/bugcheck_8c.html#a15">KeBugCheckUnicodeToAnsi</a>(
01080                 &amp;DcCheckData-&gt;DriverName,
01081                 ansiDriverName,
01082                 <span class="keyword">sizeof</span>(ansiDriverName)
01083                 );
01084 
01085             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(callerBuf, <span class="stringliteral">"[%s @ 0x%p] "</span>,
01086                 ansiDriverName,
01087                 DcCheckData-&gt;CulpritAddress
01088                 );
01089 
01090         } <span class="keywordflow">else</span> {
01091 
01092             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(callerBuf, <span class="stringliteral">"[0x%p] "</span>, DcCheckData-&gt;CulpritAddress);
01093         }
01094 
01095         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%s"</span>, callerBuf);
01096         lMarginCur += <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(callerBuf);
01097     }
01098 
01099     <span class="comment">//</span>
01100     <span class="comment">// Format and print our assertion text</span>
01101     <span class="comment">//</span>
01102     <span class="keywordflow">while</span>(*current) {
01103 
01104         <span class="keywordflow">if</span> (*current == <span class="charliteral">' '</span>) {
01105 
01106             <span class="keywordflow">if</span> ((current - lineStart) &gt;= (rMargin-lMarginCur-1)) {
01107 
01108                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%s"</span>, lMarginText);
01109                 lMarginText = classBuf;
01110                 lMarginCur = lMargin;
01111 
01112                 <span class="keywordflow">if</span> ((lastWord-lineStart)&lt;rMargin) {
01113 
01114                     memcpy(buffer, lineStart, (ULONG)(lastWord-lineStart)*<span class="keyword">sizeof</span>(UCHAR));
01115                     buffer[lastWord-lineStart] = <span class="charliteral">'\0'</span>;
01116                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%s\n"</span>, buffer);
01117 
01118                 }
01119 
01120                 lineStart = lastWord+1;
01121             }
01122 
01123             lastWord = current;
01124         }
01125 
01126         current++;
01127     }
01128 
01129     <span class="keywordflow">if</span> ((current - lineStart) &gt;= (rMargin-lMarginCur-1)) {
01130 
01131         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%s"</span>, lMarginText);
01132         lMarginText = classBuf;
01133 
01134         <span class="keywordflow">if</span> ((lastWord-lineStart)&lt;rMargin) {
01135 
01136             memcpy(buffer, lineStart, (ULONG)(lastWord-lineStart)*<span class="keyword">sizeof</span>(UCHAR));
01137             buffer[lastWord-lineStart] = <span class="charliteral">'\0'</span>;
01138             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%s\n"</span>, buffer);
01139         }
01140 
01141         lineStart = lastWord+1;
01142     }
01143 
01144     <span class="keywordflow">if</span> (lineStart&lt;current) {
01145 
01146         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%s%s\n"</span>, lMarginText, lineStart);
01147     }
01148 }
01149 
01150 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01151"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a108">01151</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a108">IopDriverCorrectnessPrintParamData</a>(
01152     IN <a class="code" href="../../d3/d0/struct__DC__CHECK__DATA.html">PDC_CHECK_DATA</a> DcCheckData
01153     )
01154 {
01155     <span class="keywordflow">if</span> (DcCheckData-&gt;DcParamArray[0]) {
01156 
01157         <a class="code" href="../../d2/d5/ioassert_8h.html#a109">IopDriverCorrectnessPrintIrp</a>((<a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a>) DcCheckData-&gt;DcParamArray[0]);
01158     }
01159 }
01160 
01161 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01162"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a111">01162</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a111">IopDriverCorrectnessPrompt</a>(
01163     IN      <a class="code" href="../../d3/d0/struct__DC__CHECK__DATA.html">PDC_CHECK_DATA</a>  DcCheckData,
01164     OUT     PBOOLEAN        ExitAssertion
01165     )
01166 {
01167     <span class="keywordtype">char</span> response[2];
01168     ULONG assertionControl;
01169     BOOLEAN waitForInput;
01170 
01171     assertionControl = DcCheckData-&gt;AssertionControl;
01172 
01173     *ExitAssertion = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01174 
01175     <span class="comment">//</span>
01176     <span class="comment">// Vocalize if so ordered.</span>
01177     <span class="comment">//</span>
01178     <span class="keywordflow">if</span> (assertionControl&amp;<a class="code" href="../../d2/d5/ioassert_8h.html#a1">DIAG_BEEP</a>) {
01179 
01180         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%c"</span>, 7);
01181     }
01182 
01183     <span class="keywordflow">if</span> (assertionControl&amp;<a class="code" href="../../d2/d5/ioassert_8h.html#a2">DIAG_ZAPPED</a>) {
01184 
01185         <span class="keywordflow">return</span>;
01186     }
01187 
01188     <span class="comment">//</span>
01189     <span class="comment">// Wait for input...</span>
01190     <span class="comment">//</span>
01191     waitForInput = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01192     <span class="keywordflow">while</span>(waitForInput) {
01193 
01194         <span class="keywordflow">if</span> (DcCheckData-&gt;Control) {
01195 
01196             <a class="code" href="../../d0/d5/rtl_2debug_8c.html#a3">DbgPrompt</a>( <span class="stringliteral">"Break, Ignore, Zap, Remove, Disable all (bizrd)? "</span>, response, <span class="keyword">sizeof</span>( response ));
01197         } <span class="keywordflow">else</span> {
01198 
01199             <a class="code" href="../../d0/d5/rtl_2debug_8c.html#a3">DbgPrompt</a>( <span class="stringliteral">"Break, Ignore, Disable all (bid)? "</span>, response, <span class="keyword">sizeof</span>( response ));
01200         }
01201 
01202         <span class="keywordflow">switch</span> (response[0]) {
01203 
01204             <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:
01205             <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
01206                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Breaking in... (press g&lt;enter&gt; to return to assert menu)\n"</span>);
01207                 DbgBreakPoint();
01208                 waitForInput = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01209                 *ExitAssertion = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01210                 <span class="keywordflow">break</span>;
01211 
01212             <span class="keywordflow">case</span> <span class="charliteral">'I'</span>:
01213             <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
01214                 waitForInput = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01215                 <span class="keywordflow">break</span>;
01216 
01217             <span class="keywordflow">case</span> <span class="charliteral">'Z'</span>:
01218             <span class="keywordflow">case</span> <span class="charliteral">'z'</span>:
01219                 <span class="keywordflow">if</span> (DcCheckData-&gt;Control) {
01220 
01221                    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Breakpoint zapped (OS will print text and return)\n"</span>);
01222                    assertionControl |= <a class="code" href="../../d2/d5/ioassert_8h.html#a2">DIAG_ZAPPED</a>;
01223                    assertionControl &amp;=~ DIAG_BEEP;
01224                    waitForInput = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01225                 }
01226                 <span class="keywordflow">break</span>;
01227 
01228             <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
01229             <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
01230                 <a class="code" href="../../d1/d5/ioassert_8c.html#a9">IopDcControlOverride</a> = <a class="code" href="../../d2/d5/ioassert_8h.html#a3">DIAG_CLEARED</a>;
01231                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Verification asserts disabled.\n"</span>);
01232                 <span class="comment">//assertionControl |= DIAG_CLEARED;</span>
01233                 waitForInput = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01234                 <span class="keywordflow">break</span>;
01235 
01236             <span class="keywordflow">case</span> <span class="charliteral">'R'</span>:
01237             <span class="keywordflow">case</span> <span class="charliteral">'r'</span>:
01238                 <span class="keywordflow">if</span> (DcCheckData-&gt;Control) {
01239 
01240                    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Breakpoint removed\n"</span>) ;
01241                    assertionControl |= <a class="code" href="../../d2/d5/ioassert_8h.html#a3">DIAG_CLEARED</a>;
01242                    waitForInput = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01243                 }
01244                 <span class="keywordflow">break</span>;
01245         }
01246     }
01247 
01248     <span class="keywordflow">if</span> (DcCheckData-&gt;Control) {
01249         *DcCheckData-&gt;Control = assertionControl;
01250     }
01251 }
01252 
01253 PVOID
<a name="l01254"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a112">01254</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a112">IopDriverCorrectnessAddressToFileHeader</a>(
01255     IN PVOID Address,
01256     OUT PLDR_DATA_TABLE_ENTRY *DataTableEntry
01257     )
01258 
01259 <span class="comment">/*++</span>
01260 <span class="comment"></span>
01261 <span class="comment">Routine Description:</span>
01262 <span class="comment"></span>
01263 <span class="comment">    This function returns the base of an image that contains the</span>
01264 <span class="comment">    specified Address. An image contains the address if the address</span>
01265 <span class="comment">    is within the ImageBase, and the ImageBase plus the size of the</span>
01266 <span class="comment">    virtual image.</span>
01267 <span class="comment"></span>
01268 <span class="comment">Arguments:</span>
01269 <span class="comment"></span>
01270 <span class="comment">    Address - Supplies an address to resolve to a loader entry.</span>
01271 <span class="comment"></span>
01272 <span class="comment">    DataTableEntry - Suppies a pointer to a variable that receives the</span>
01273 <span class="comment">        address of the data table entry that describes the image.</span>
01274 <span class="comment"></span>
01275 <span class="comment">Return Value:</span>
01276 <span class="comment"></span>
01277 <span class="comment">    NULL - No image was found that contains the passed in address.</span>
01278 <span class="comment"></span>
01279 <span class="comment">    NON-NULL - Returns the base address of the image that contain the</span>
01280 <span class="comment">        address.</span>
01281 <span class="comment"></span>
01282 <span class="comment">--*/</span>
01283 
01284 {
01285 
01286     PLIST_ENTRY ModuleListHead;
01287     PLDR_DATA_TABLE_ENTRY Entry;
01288     PLIST_ENTRY Next;
01289     UINT_PTR Bounds;
01290     PVOID ReturnBase=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, Base;
01291 
01292     ModuleListHead = &amp;<a class="code" href="../../d1/d9/ps_8h.html#a56">PsLoadedModuleList</a>;
01293 
01294     <span class="comment">//</span>
01295     <span class="comment">// It would be nice if we could call MiLookupDataTableEntry, but it's</span>
01296     <span class="comment">// pageable, so we do what the bugcheck stuff does...</span>
01297     <span class="comment">//</span>
01298     Next = ModuleListHead-&gt;Flink;
01299     <span class="keywordflow">if</span> (Next != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01300         <span class="keywordflow">while</span> (Next != ModuleListHead) {
01301             Entry = CONTAINING_RECORD(Next,
01302                                       LDR_DATA_TABLE_ENTRY,
01303                                       InLoadOrderLinks);
01304 
01305             Next = Next-&gt;Flink;
01306             Base = Entry-&gt;DllBase;
01307             Bounds = (UINT_PTR)Base + Entry-&gt;SizeOfImage;
01308             <span class="keywordflow">if</span> ((UINT_PTR)Address &gt;= (UINT_PTR)Base &amp;&amp; (UINT_PTR)Address &lt; Bounds) {
01309                 *DataTableEntry = Entry;
01310                 ReturnBase = Base;
01311                 <span class="keywordflow">break</span>;
01312             }
01313         }
01314     }
01315 
01316     <span class="keywordflow">return</span> ReturnBase;
01317 }
01318 
01319 BOOLEAN
<a name="l01320"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a113">01320</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a113">IopIsMemoryRangeReadable</a>(
01321     IN PVOID Location,
01322     IN size_t Length
01323     )
01324 {
01325    <span class="keywordflow">while</span> (((ULONG_PTR)Location &amp; (<span class="keyword">sizeof</span>(ULONG_PTR)-1)) &amp;&amp; (Length &gt; 0)) {
01326 
01327         <span class="comment">//</span>
01328         <span class="comment">// Check to determine if the move will succeed before actually performing</span>
01329         <span class="comment">// the operation.</span>
01330         <span class="comment">//</span>
01331         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d2/pagfault_8c.html#a26">MmIsAddressValid</a>(Location)==<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01332             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
01333         }
01334 
01335         ((PCHAR) Location)++ ;
01336         Length-- ;
01337     }
01338 
01339     <span class="keywordflow">while</span> (Length &gt; (<span class="keyword">sizeof</span>(ULONG_PTR)-1)) {
01340 
01341         <span class="comment">//</span>
01342         <span class="comment">// Check to determine if the move will succeed before actually performing</span>
01343         <span class="comment">// the operation.</span>
01344         <span class="comment">//</span>
01345         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d2/pagfault_8c.html#a26">MmIsAddressValid</a>(Location)==<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01346             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
01347         }
01348         ((PCHAR) Location) += <span class="keyword">sizeof</span>(ULONG_PTR);
01349         Length -= <span class="keyword">sizeof</span>(ULONG_PTR);
01350 
01351     }
01352 
01353     <span class="keywordflow">while</span> (Length &gt; 0) {
01354 
01355         <span class="comment">//</span>
01356         <span class="comment">// Check to determine if the move will succeed before actually performing</span>
01357         <span class="comment">// the operation.</span>
01358         <span class="comment">//</span>
01359         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d2/pagfault_8c.html#a26">MmIsAddressValid</a>(Location)==<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01360             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01361         }
01362 
01363         ((PCHAR) Location)++ ;
01364         Length-- ;
01365     }
01366     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
01367 }
01368 
01369 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01370"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a109">01370</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a109">IopDriverCorrectnessPrintIrp</a>(
01371     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> IrpToFlag
01372     )
01373 {
01374     <a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html">PIO_STACK_LOCATION</a> irpSpCur ;
01375     <a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html">PIO_STACK_LOCATION</a> irpSpNxt ;
01376 
01377     <span class="comment">//</span>
01378     <span class="comment">// First see if we can touch the IRP header</span>
01379     <span class="comment">//</span>
01380     <span class="keywordflow">if</span>(!<a class="code" href="../../d2/d5/ioassert_8h.html#a113">IopIsMemoryRangeReadable</a>(IrpToFlag, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d2/struct__IRP.html">IRP</a>))) {
01381         <span class="keywordflow">return</span> ;
01382     }
01383 
01384     <span class="comment">//</span>
01385     <span class="comment">// OK, get the next two stack locations...</span>
01386     <span class="comment">//</span>
01387     irpSpNxt = <a class="code" href="../../d0/d5/io_8h.html#a230">IoGetNextIrpStackLocation</a>( IrpToFlag );
01388     irpSpCur = <a class="code" href="../../d0/d5/io_8h.html#a228">IoGetCurrentIrpStackLocation</a>( IrpToFlag );
01389 
01390     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/ioassert_8h.html#a113">IopIsMemoryRangeReadable</a>(irpSpNxt, 2*<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html">IO_STACK_LOCATION</a>))) {
01391 
01392         <span class="comment">//</span>
01393         <span class="comment">// Both are present, print the best one!</span>
01394         <span class="comment">//</span>
01395         <span class="keywordflow">if</span> (irpSpNxt-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o1">MinorFunction</a> == irpSpCur-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o1">MinorFunction</a>) {
01396 
01397             <span class="comment">//</span>
01398             <span class="comment">// Looks forwarded</span>
01399             <span class="comment">//</span>
01400             <a class="code" href="../../d2/d5/ioassert_8h.html#a110">IopDriverCorrectnessPrintIrpStack</a>(irpSpNxt) ;
01401         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (irpSpNxt-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o1">MinorFunction</a> == 0) {
01402 
01403             <span class="comment">//</span>
01404             <span class="comment">// Next location is probably currently zero'd</span>
01405             <span class="comment">//</span>
01406             <a class="code" href="../../d2/d5/ioassert_8h.html#a110">IopDriverCorrectnessPrintIrpStack</a>(irpSpCur) ;
01407         } <span class="keywordflow">else</span> {
01408             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Next:    &gt;"</span>) ;
01409             <a class="code" href="../../d2/d5/ioassert_8h.html#a110">IopDriverCorrectnessPrintIrpStack</a>(irpSpNxt) ;
01410             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Current:  "</span>) ;
01411             <a class="code" href="../../d2/d5/ioassert_8h.html#a110">IopDriverCorrectnessPrintIrpStack</a>(irpSpCur) ;
01412         }
01413     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/ioassert_8h.html#a113">IopIsMemoryRangeReadable</a>(irpSpCur, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/io_8h.html#a373">IO_STACK_LOCATION</a>))) {
01414 
01415         <a class="code" href="../../d2/d5/ioassert_8h.html#a110">IopDriverCorrectnessPrintIrpStack</a>(irpSpCur) ;
01416     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/ioassert_8h.html#a113">IopIsMemoryRangeReadable</a>(irpSpNxt, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/io_8h.html#a373">IO_STACK_LOCATION</a>))) {
01417 
01418         <a class="code" href="../../d2/d5/ioassert_8h.html#a110">IopDriverCorrectnessPrintIrpStack</a>(irpSpNxt) ;
01419     }
01420 }
01421 
<a name="l01422"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a22">01422</a> PCHAR <a class="code" href="../../d1/d5/ioassert_8c.html#a22">IrpMajorNames</a>[] = {
01423     <span class="stringliteral">"IRP_MJ_CREATE"</span>,                          <span class="comment">// 0x00</span>
01424     <span class="stringliteral">"IRP_MJ_CREATE_NAMED_PIPE"</span>,               <span class="comment">// 0x01</span>
01425     <span class="stringliteral">"IRP_MJ_CLOSE"</span>,                           <span class="comment">// 0x02</span>
01426     <span class="stringliteral">"IRP_MJ_READ"</span>,                            <span class="comment">// 0x03</span>
01427     <span class="stringliteral">"IRP_MJ_WRITE"</span>,                           <span class="comment">// 0x04</span>
01428     <span class="stringliteral">"IRP_MJ_QUERY_INFORMATION"</span>,               <span class="comment">// 0x05</span>
01429     <span class="stringliteral">"IRP_MJ_SET_INFORMATION"</span>,                 <span class="comment">// 0x06</span>
01430     <span class="stringliteral">"IRP_MJ_QUERY_EA"</span>,                        <span class="comment">// 0x07</span>
01431     <span class="stringliteral">"IRP_MJ_SET_EA"</span>,                          <span class="comment">// 0x08</span>
01432     <span class="stringliteral">"IRP_MJ_FLUSH_BUFFERS"</span>,                   <span class="comment">// 0x09</span>
01433     <span class="stringliteral">"IRP_MJ_QUERY_VOLUME_INFORMATION"</span>,        <span class="comment">// 0x0a</span>
01434     <span class="stringliteral">"IRP_MJ_SET_VOLUME_INFORMATION"</span>,          <span class="comment">// 0x0b</span>
01435     <span class="stringliteral">"IRP_MJ_DIRECTORY_CONTROL"</span>,               <span class="comment">// 0x0c</span>
01436     <span class="stringliteral">"IRP_MJ_FILE_SYSTEM_CONTROL"</span>,             <span class="comment">// 0x0d</span>
01437     <span class="stringliteral">"IRP_MJ_DEVICE_CONTROL"</span>,                  <span class="comment">// 0x0e</span>
01438     <span class="stringliteral">"IRP_MJ_INTERNAL_DEVICE_CONTROL"</span>,         <span class="comment">// 0x0f</span>
01439     <span class="stringliteral">"IRP_MJ_SHUTDOWN"</span>,                        <span class="comment">// 0x10</span>
01440     <span class="stringliteral">"IRP_MJ_LOCK_CONTROL"</span>,                    <span class="comment">// 0x11</span>
01441     <span class="stringliteral">"IRP_MJ_CLEANUP"</span>,                         <span class="comment">// 0x12</span>
01442     <span class="stringliteral">"IRP_MJ_CREATE_MAILSLOT"</span>,                 <span class="comment">// 0x13</span>
01443     <span class="stringliteral">"IRP_MJ_QUERY_SECURITY"</span>,                  <span class="comment">// 0x14</span>
01444     <span class="stringliteral">"IRP_MJ_SET_SECURITY"</span>,                    <span class="comment">// 0x15</span>
01445     <span class="stringliteral">"IRP_MJ_POWER"</span>,                           <span class="comment">// 0x16</span>
01446     <span class="stringliteral">"IRP_MJ_SYSTEM_CONTROL"</span>,                  <span class="comment">// 0x17</span>
01447     <span class="stringliteral">"IRP_MJ_DEVICE_CHANGE"</span>,                   <span class="comment">// 0x18</span>
01448     <span class="stringliteral">"IRP_MJ_QUERY_QUOTA"</span>,                     <span class="comment">// 0x19</span>
01449     <span class="stringliteral">"IRP_MJ_SET_QUOTA"</span>,                       <span class="comment">// 0x1a</span>
01450     <span class="stringliteral">"IRP_MJ_PNP"</span>,                             <span class="comment">// 0x1b</span>
01451     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01452     } ;
01453 
<a name="l01454"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a0">01454</a> <span class="preprocessor">#define MAX_NAMED_MAJOR_IRPS   0x1b</span>
01455 <span class="preprocessor"></span>
01456 
<a name="l01457"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a23">01457</a> PCHAR <a class="code" href="../../d7/d4/flunkirp_8c.html#a0">PnPIrpNames</a>[] = {
01458     <span class="stringliteral">"IRP_MN_START_DEVICE"</span>,                    <span class="comment">// 0x00</span>
01459     <span class="stringliteral">"IRP_MN_QUERY_REMOVE_DEVICE"</span>,             <span class="comment">// 0x01</span>
01460     <span class="stringliteral">"IRP_MN_REMOVE_DEVICE - "</span>,                <span class="comment">// 0x02</span>
01461     <span class="stringliteral">"IRP_MN_CANCEL_REMOVE_DEVICE"</span>,            <span class="comment">// 0x03</span>
01462     <span class="stringliteral">"IRP_MN_STOP_DEVICE"</span>,                     <span class="comment">// 0x04</span>
01463     <span class="stringliteral">"IRP_MN_QUERY_STOP_DEVICE"</span>,               <span class="comment">// 0x05</span>
01464     <span class="stringliteral">"IRP_MN_CANCEL_STOP_DEVICE"</span>,              <span class="comment">// 0x06</span>
01465     <span class="stringliteral">"IRP_MN_QUERY_DEVICE_RELATIONS"</span>,          <span class="comment">// 0x07</span>
01466     <span class="stringliteral">"IRP_MN_QUERY_INTERFACE"</span>,                 <span class="comment">// 0x08</span>
01467     <span class="stringliteral">"IRP_MN_QUERY_CAPABILITIES"</span>,              <span class="comment">// 0x09</span>
01468     <span class="stringliteral">"IRP_MN_QUERY_RESOURCES"</span>,                 <span class="comment">// 0x0A</span>
01469     <span class="stringliteral">"IRP_MN_QUERY_RESOURCE_REQUIREMENTS"</span>,     <span class="comment">// 0x0B</span>
01470     <span class="stringliteral">"IRP_MN_QUERY_DEVICE_TEXT"</span>,               <span class="comment">// 0x0C</span>
01471     <span class="stringliteral">"IRP_MN_FILTER_RESOURCE_REQUIREMENTS"</span>,    <span class="comment">// 0x0D</span>
01472     <span class="stringliteral">"INVALID_IRP_CODE"</span>,                       <span class="comment">//</span>
01473     <span class="stringliteral">"IRP_MN_READ_CONFIG"</span>,                     <span class="comment">// 0x0F</span>
01474     <span class="stringliteral">"IRP_MN_WRITE_CONFIG"</span>,                    <span class="comment">// 0x10</span>
01475     <span class="stringliteral">"IRP_MN_EJECT"</span>,                           <span class="comment">// 0x11</span>
01476     <span class="stringliteral">"IRP_MN_SET_LOCK"</span>,                        <span class="comment">// 0x12</span>
01477     <span class="stringliteral">"IRP_MN_QUERY_ID"</span>,                        <span class="comment">// 0x13</span>
01478     <span class="stringliteral">"IRP_MN_QUERY_PNP_DEVICE_STATE"</span>,          <span class="comment">// 0x14</span>
01479     <span class="stringliteral">"IRP_MN_QUERY_BUS_INFORMATION"</span>,           <span class="comment">// 0x15</span>
01480     <span class="stringliteral">"IRP_MN_DEVICE_USAGE_NOTIFICATION"</span>,       <span class="comment">// 0x16</span>
01481     <span class="stringliteral">"IRP_MN_SURPRISE_REMOVAL"</span>,                <span class="comment">// 0x17</span>
01482     <span class="stringliteral">"IRP_MN_QUERY_LEGACY_BUS_INFORMATION"</span>,    <span class="comment">// 0x18</span>
01483     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01484     } ;
01485 
<a name="l01486"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a1">01486</a> <span class="preprocessor">#define MAX_NAMED_PNP_IRP   0x18</span>
01487 <span class="preprocessor"></span>
<a name="l01488"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a24">01488</a> PCHAR <a class="code" href="../../d1/d5/ioassert_8c.html#a24">WmiIrpNames</a>[] = {
01489     <span class="stringliteral">"IRP_MN_QUERY_ALL_DATA"</span>,                  <span class="comment">// 0x00</span>
01490     <span class="stringliteral">"IRP_MN_QUERY_SINGLE_INSTANCE"</span>,           <span class="comment">// 0x01</span>
01491     <span class="stringliteral">"IRP_MN_CHANGE_SINGLE_INSTANCE"</span>,          <span class="comment">// 0x02</span>
01492     <span class="stringliteral">"IRP_MN_CHANGE_SINGLE_ITEM"</span>,              <span class="comment">// 0x03</span>
01493     <span class="stringliteral">"IRP_MN_ENABLE_EVENTS"</span>,                   <span class="comment">// 0x04</span>
01494     <span class="stringliteral">"IRP_MN_DISABLE_EVENTS"</span>,                  <span class="comment">// 0x05</span>
01495     <span class="stringliteral">"IRP_MN_ENABLE_COLLECTION"</span>,               <span class="comment">// 0x06</span>
01496     <span class="stringliteral">"IRP_MN_DISABLE_COLLECTION"</span>,              <span class="comment">// 0x07</span>
01497     <span class="stringliteral">"IRP_MN_REGINFO"</span>,                         <span class="comment">// 0x08</span>
01498     <span class="stringliteral">"IRP_MN_EXECUTE_METHOD"</span>,                  <span class="comment">// 0x09</span>
01499     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01500     } ;
01501 
<a name="l01502"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a2">01502</a> <span class="preprocessor">#define MAX_NAMED_WMI_IRP   0x9</span>
01503 <span class="preprocessor"></span>
<a name="l01504"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a25">01504</a> PCHAR <a class="code" href="../../d1/d5/ioassert_8c.html#a25">PowerIrpNames</a>[] = {
01505     <span class="stringliteral">"IRP_MN_WAIT_WAKE"</span>,                       <span class="comment">// 0x00</span>
01506     <span class="stringliteral">"IRP_MN_POWER_SEQUENCE"</span>,                  <span class="comment">// 0x01</span>
01507     <span class="stringliteral">"IRP_MN_SET_POWER"</span>,                       <span class="comment">// 0x02</span>
01508     <span class="stringliteral">"IRP_MN_QUERY_POWER"</span>,                     <span class="comment">// 0x03</span>
01509     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01510     } ;
01511 
<a name="l01512"></a><a class="code" href="../../d1/d5/ioassert_8c.html#a3">01512</a> <span class="preprocessor">#define MAX_NAMED_POWER_IRP 0x3</span>
01513 <span class="preprocessor"></span>
01514 
01515 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01516"></a><a class="code" href="../../d2/d5/ioassert_8h.html#a110">01516</a> <a class="code" href="../../d2/d5/ioassert_8h.html#a110">IopDriverCorrectnessPrintIrpStack</a>(
01517     IN <a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html">PIO_STACK_LOCATION</a> IrpSp
01518     )
01519 {
01520     <span class="keywordflow">if</span> ((IrpSp-&gt;MajorFunction==<a class="code" href="../../d0/d5/io_8h.html#a28">IRP_MJ_INTERNAL_DEVICE_CONTROL</a>)&amp;&amp;(IrpSp-&gt;MinorFunction == <a class="code" href="../../d0/d5/io_8h.html#a64">IRP_MN_SCSI_CLASS</a>)) {
01521 
01522          <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"IRP_MJ_SCSI"</span>) ;
01523 
01524     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IrpSp-&gt;MajorFunction&lt;=<a class="code" href="../../d1/d5/ioassert_8c.html#a0">MAX_NAMED_MAJOR_IRPS</a>) {
01525 
01526          <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<a class="code" href="../../d1/d5/ioassert_8c.html#a22">IrpMajorNames</a>[IrpSp-&gt;MajorFunction]) ;
01527 
01528     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IrpSp-&gt;MajorFunction==0xFF) {
01529 
01530          <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"IRP_MJ_BOGUS"</span>) ;
01531 
01532     } <span class="keywordflow">else</span> {
01533 
01534          <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"IRP_MJ_??"</span>) ;
01535     }
01536 
01537     <span class="keywordflow">switch</span>(IrpSp-&gt;MajorFunction) {
01538 
01539          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a36">IRP_MJ_SYSTEM_CONTROL</a>:
01540              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"."</span>) ;
01541              <span class="keywordflow">if</span> (IrpSp-&gt;MinorFunction&lt;=<a class="code" href="../../d1/d5/ioassert_8c.html#a2">MAX_NAMED_WMI_IRP</a>) {
01542 
01543                  <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<a class="code" href="../../d1/d5/ioassert_8c.html#a24">WmiIrpNames</a>[IrpSp-&gt;MinorFunction]) ;
01544              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IrpSp-&gt;MinorFunction==0xFF) {
01545 
01546                  <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"IRP_MN_BOGUS"</span>) ;
01547              } <span class="keywordflow">else</span> {
01548                  <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(Bogus)\n"</span>) ;
01549              }
01550              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>) ;
01551              <span class="keywordflow">break</span> ;
01552          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a40">IRP_MJ_PNP</a>:
01553              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"."</span>) ;
01554              <span class="keywordflow">if</span> (IrpSp-&gt;MinorFunction&lt;=<a class="code" href="../../d1/d5/ioassert_8c.html#a1">MAX_NAMED_PNP_IRP</a>) {
01555 
01556                  <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<a class="code" href="../../d7/d4/flunkirp_8c.html#a0">PnPIrpNames</a>[IrpSp-&gt;MinorFunction]) ;
01557              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IrpSp-&gt;MinorFunction==0xFF) {
01558 
01559                  <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"IRP_MN_BOGUS"</span>) ;
01560              } <span class="keywordflow">else</span> {
01561 
01562                  <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(Bogus)\n"</span>) ;
01563              }
01564              <span class="keywordflow">switch</span>(IrpSp-&gt;MinorFunction) {
01565                  <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a72">IRP_MN_QUERY_DEVICE_RELATIONS</a>:
01566 
01567                      <span class="keywordflow">switch</span>(IrpSp-&gt;Parameters.QueryDeviceRelations.Type) {
01568                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a602a412">BusRelations</a>:
01569                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(BusRelations)"</span>) ;
01570                              <span class="keywordflow">break</span> ;
01571                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a602a413">EjectionRelations</a>:
01572                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(EjectionRelations)"</span>) ;
01573                              <span class="keywordflow">break</span> ;
01574                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a602a414">PowerRelations</a>:
01575                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(PowerRelations)"</span>) ;
01576                              <span class="keywordflow">break</span> ;
01577                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a602a415">RemovalRelations</a>:
01578                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(RemovalRelations)"</span>) ;
01579                              <span class="keywordflow">break</span> ;
01580                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a602a416">TargetDeviceRelation</a>:
01581                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(TargetDeviceRelation)"</span>) ;
01582                              <span class="keywordflow">break</span> ;
01583                          <span class="keywordflow">default</span>:
01584                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(Bogus)\n"</span>) ;
01585                              <span class="keywordflow">break</span> ;
01586                      }
01587                      <span class="keywordflow">break</span> ;
01588                  <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a73">IRP_MN_QUERY_INTERFACE</a>:
01589                      <span class="keywordflow">break</span> ;
01590                  <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a77">IRP_MN_QUERY_DEVICE_TEXT</a>:
01591                      <span class="keywordflow">switch</span>(IrpSp-&gt;Parameters.QueryId.IdType) {
01592                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a605a426">DeviceTextDescription</a>:
01593                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(DeviceTextDescription)"</span>) ;
01594                              <span class="keywordflow">break</span> ;
01595                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a605a427">DeviceTextLocationInformation</a>:
01596                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(DeviceTextLocationInformation)"</span>) ;
01597                              <span class="keywordflow">break</span> ;
01598                          <span class="keywordflow">default</span>:
01599                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(Bogus)\n"</span>) ;
01600                              <span class="keywordflow">break</span> ;
01601                      }
01602                      <span class="keywordflow">break</span> ;
01603                  <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a80">IRP_MN_WRITE_CONFIG</a>:
01604                  <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a79">IRP_MN_READ_CONFIG</a>:
01605                      <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(WhichSpace=%x, Buffer=%x, Offset=%x, Length=%x)"</span>,
01606                          IrpSp-&gt;Parameters.ReadWriteConfig.WhichSpace,
01607                          IrpSp-&gt;Parameters.ReadWriteConfig.Buffer,
01608                          IrpSp-&gt;Parameters.ReadWriteConfig.Offset,
01609                          IrpSp-&gt;Parameters.ReadWriteConfig.Length
01610                          ) ;
01611                      <span class="keywordflow">break</span> ;
01612                  <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a82">IRP_MN_SET_LOCK</a>:
01613                      <span class="keywordflow">if</span> (IrpSp-&gt;Parameters.SetLock.Lock) <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(True)"</span>) ;
01614                      <span class="keywordflow">else</span> <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(False)"</span>) ;
01615                      <span class="keywordflow">break</span> ;
01616                  <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a83">IRP_MN_QUERY_ID</a>:
01617                      <span class="keywordflow">switch</span>(IrpSp-&gt;Parameters.QueryId.IdType) {
01618                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a604a421">BusQueryDeviceID</a>:
01619                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(BusQueryDeviceID)"</span>) ;
01620                              <span class="keywordflow">break</span> ;
01621                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a604a422">BusQueryHardwareIDs</a>:
01622                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(BusQueryHardwareIDs)"</span>) ;
01623                              <span class="keywordflow">break</span> ;
01624                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a604a423">BusQueryCompatibleIDs</a>:
01625                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(BusQueryCompatibleIDs)"</span>) ;
01626                              <span class="keywordflow">break</span> ;
01627                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a604a424">BusQueryInstanceID</a>:
01628                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(BusQueryInstanceID)"</span>) ;
01629                              <span class="keywordflow">break</span> ;
01630                          <span class="keywordflow">default</span>:
01631                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(Bogus)\n"</span>) ;
01632                              <span class="keywordflow">break</span> ;
01633                      }
01634                      <span class="keywordflow">break</span> ;
01635                  <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a85">IRP_MN_QUERY_BUS_INFORMATION</a>:
01636                      <span class="comment">// BUGBUG: Should print out</span>
01637                      <span class="keywordflow">break</span> ;
01638                  <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a86">IRP_MN_DEVICE_USAGE_NOTIFICATION</a>:
01639                      <span class="keywordflow">switch</span>(IrpSp-&gt;Parameters.UsageNotification.Type) {
01640                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a603a417">DeviceUsageTypeUndefined</a>:
01641                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(DeviceUsageTypeUndefined"</span>) ;
01642                              <span class="keywordflow">break</span> ;
01643                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a603a418">DeviceUsageTypePaging</a>:
01644                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(DeviceUsageTypePaging"</span>) ;
01645                              <span class="keywordflow">break</span> ;
01646                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a603a419">DeviceUsageTypeHibernation</a>:
01647                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(DeviceUsageTypeHibernation"</span>) ;
01648                              <span class="keywordflow">break</span> ;
01649                          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a603a420">DeviceUsageTypeDumpFile</a>:
01650                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(DeviceUsageTypeDumpFile"</span>) ;
01651                              <span class="keywordflow">break</span> ;
01652                          <span class="keywordflow">default</span>:
01653                              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(Bogus)\n"</span>) ;
01654                              <span class="keywordflow">break</span> ;
01655                      }
01656                      <span class="keywordflow">if</span> (IrpSp-&gt;Parameters.UsageNotification.InPath) {
01657                          <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">", InPath=TRUE)"</span>) ;
01658                      } <span class="keywordflow">else</span> {
01659                          <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">", InPath=FALSE)"</span>) ;
01660                      }
01661                      <span class="keywordflow">break</span> ;
01662                  <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a88">IRP_MN_QUERY_LEGACY_BUS_INFORMATION</a>:
01663                      <span class="comment">// BUGBUG: Should print out</span>
01664                      <span class="keywordflow">break</span> ;
01665                  <span class="keywordflow">default</span>:
01666                      <span class="keywordflow">break</span> ;
01667              }
01668              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>) ;
01669              <span class="keywordflow">break</span> ;
01670 
01671          <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/io_8h.html#a35">IRP_MJ_POWER</a>:
01672              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"."</span>) ;
01673              <span class="keywordflow">if</span> (IrpSp-&gt;MinorFunction&lt;=<a class="code" href="../../d1/d5/ioassert_8c.html#a3">MAX_NAMED_POWER_IRP</a>) {
01674 
01675                  <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<a class="code" href="../../d1/d5/ioassert_8c.html#a25">PowerIrpNames</a>[IrpSp-&gt;MinorFunction]) ;
01676              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IrpSp-&gt;MinorFunction==0xFF) {
01677 
01678                  <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"IRP_MN_BOGUS"</span>) ;
01679              } <span class="keywordflow">else</span> {
01680                  <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"(Bogus)\n"</span>) ;
01681              }
01682              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>) ;
01683              <span class="keywordflow">break</span> ;
01684 
01685          <span class="keywordflow">default</span>:
01686              <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>) ;
01687              <span class="keywordflow">break</span> ;
01688     }
01689 }
01690 <span class="preprocessor">#endif // NO_SPECIAL_IRP</span>
01691 <span class="preprocessor"></span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:28 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
