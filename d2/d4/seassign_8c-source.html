<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: seassign.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>seassign.c</h1><a href="../../d1/d5/seassign_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    Seassign.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This Module implements the SeAssignSecurity procedure.  For a description</span>
00012 <span class="comment">    of the pool allocation strategy please see the comments in semethod.c</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Gary Kimura     (GaryKi)    9-Nov-1989</span>
00017 <span class="comment"></span>
00018 <span class="comment">Environment:</span>
00019 <span class="comment"></span>
00020 <span class="comment">    Kernel Mode</span>
00021 <span class="comment"></span>
00022 <span class="comment">Revision History:</span>
00023 <span class="comment"></span>
00024 <span class="comment">    Richard Ward     (RichardW)  14-April-92</span>
00025 <span class="comment">    Robert Reichel   (RobertRe)  28-February-95</span>
00026 <span class="comment">        Added Compound ACEs</span>
00027 <span class="comment"></span>
00028 <span class="comment">--*/</span>
00029 
00030 
00031 <span class="preprocessor">#include "<a class="code" href="../../d6/d6/sep_8h.html">sep.h</a>"</span>
00032 <span class="preprocessor">#include "<a class="code" href="../../d8/d3/tokenp_8h.html">tokenp.h</a>"</span>
00033 <span class="preprocessor">#include "sertlp.h"</span>
00034 <span class="preprocessor">#include "zwapi.h"</span>
00035 <span class="preprocessor">#include "nturtl.h"</span>
00036 
00037 
00038 <span class="comment">//</span>
00039 <span class="comment">//  Local macros and procedures</span>
00040 <span class="comment">//</span>
00041 
00042 
00043 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00044 <a class="code" href="../../d1/d5/seassign_8c.html#a4">SepInheritAcl</a> (
00045     IN PACL Acl,
00046     IN BOOLEAN IsDirectoryObject,
00047     IN PSID OwnerSid,
00048     IN PSID GroupSid,
00049     IN PSID ServerSid OPTIONAL,
00050     IN PSID ClientSid OPTIONAL,
00051     IN PGENERIC_MAPPING GenericMapping,
00052     IN POOL_TYPE PoolType,
00053     OUT PACL *NewAcl
00054     );
00055 
00056 
00057 <span class="preprocessor">#ifdef ALLOC_PRAGMA</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,SeAssignSecurity)</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,SeAssignSecurityEx)</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,SeDeassignSecurity)</span>
00061 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,SepInheritAcl)</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,SeAssignWorldSecurityDescriptor)</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,SepDumpSecurityDescriptor)</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,SepPrintAcl)</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,SepPrintSid)</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,SepDumpTokenInfo)</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,SepSidTranslation)</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00069 <span class="preprocessor"></span>
00070 
00071 <span class="comment">//</span>
00072 <span class="comment">// These variables control whether security descriptors and token</span>
00073 <span class="comment">// information are dumped by their dump routines.  This allows</span>
00074 <span class="comment">// selective turning on and off of debugging output by both program</span>
00075 <span class="comment">// control and via the kernel debugger.</span>
00076 <span class="comment">//</span>
00077 
00078 <span class="preprocessor">#if DBG</span>
00079 <span class="preprocessor"></span>
00080 BOOLEAN SepDumpSD = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00081 BOOLEAN SepDumpToken = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00082 
00083 <span class="preprocessor">#endif</span>
00084 <span class="preprocessor"></span>
00085 
00086 
00087 
00088 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00089"></a><a class="code" href="../../d1/d5/seassign_8c.html#a1">00089</a> <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a> (
00090     IN PSECURITY_DESCRIPTOR ParentDescriptor OPTIONAL,
00091     IN PSECURITY_DESCRIPTOR ExplicitDescriptor OPTIONAL,
00092     OUT PSECURITY_DESCRIPTOR *NewDescriptor,
00093     IN BOOLEAN IsDirectoryObject,
00094     IN <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext,
00095     IN PGENERIC_MAPPING GenericMapping,
00096     IN POOL_TYPE PoolType
00097     )
00098 
00099 <span class="comment">/*++</span>
00100 <span class="comment"></span>
00101 <span class="comment">Routine Description:</span>
00102 <span class="comment"></span>
00103 <span class="comment">    This routine assumes privilege checking HAS NOT yet been performed</span>
00104 <span class="comment">    and so will be performed by this routine.</span>
00105 <span class="comment"></span>
00106 <span class="comment">    This procedure is used to build a security descriptor for a new object</span>
00107 <span class="comment">    given the security descriptor of its parent directory and any originally</span>
00108 <span class="comment">    requested security for the object.  The final security descriptor</span>
00109 <span class="comment">    returned to the caller may contain a mix of information, some explicitly</span>
00110 <span class="comment">    provided other from the new object's parent.</span>
00111 <span class="comment"></span>
00112 <span class="comment"></span>
00113 <span class="comment">    See RtlpNewSecurityObject for a descriptor of how the NewDescriptor is</span>
00114 <span class="comment">    built.</span>
00115 <span class="comment"></span>
00116 <span class="comment"></span>
00117 <span class="comment">Arguments:</span>
00118 <span class="comment"></span>
00119 <span class="comment">    ParentDescriptor - Optionally supplies the security descriptor of the</span>
00120 <span class="comment">        parent directory under which this new object is being created.</span>
00121 <span class="comment"></span>
00122 <span class="comment">    ExplicitDescriptor - Supplies the address of a pointer to the security</span>
00123 <span class="comment">        descriptor as specified by the user that is to be applied to</span>
00124 <span class="comment">        the new object.</span>
00125 <span class="comment"></span>
00126 <span class="comment">    NewDescriptor - Returns the actual security descriptor for the new</span>
00127 <span class="comment">        object that has been modified according to above rules.</span>
00128 <span class="comment"></span>
00129 <span class="comment">    IsDirectoryObject - Specifies if the new object is itself a directory</span>
00130 <span class="comment">        object.  A value of TRUE indicates the object is a container of other</span>
00131 <span class="comment">        objects.</span>
00132 <span class="comment"></span>
00133 <span class="comment">    SubjectContext - Supplies the security context of the subject creating the</span>
00134 <span class="comment">        object. This is used to retrieve default security information for the</span>
00135 <span class="comment">        new object, such as default owner, primary group, and discretionary</span>
00136 <span class="comment">        access control.</span>
00137 <span class="comment"></span>
00138 <span class="comment">    GenericMapping - Supplies a pointer to an array of access mask values</span>
00139 <span class="comment">        denoting the mapping between each generic right to non-generic rights.</span>
00140 <span class="comment"></span>
00141 <span class="comment">    PoolType - Specifies the pool type to use to when allocating a new</span>
00142 <span class="comment">        security descriptor.</span>
00143 <span class="comment"></span>
00144 <span class="comment">Return Value:</span>
00145 <span class="comment"></span>
00146 <span class="comment">    STATUS_SUCCESS - indicates the operation was successful.</span>
00147 <span class="comment"></span>
00148 <span class="comment">    STATUS_INVALID_OWNER - The owner SID provided as the owner of the</span>
00149 <span class="comment">        target security descriptor is not one the caller is authorized</span>
00150 <span class="comment">        to assign as the owner of an object.</span>
00151 <span class="comment"></span>
00152 <span class="comment">    STATUS_PRIVILEGE_NOT_HELD - The caller does not have the privilege</span>
00153 <span class="comment">        necessary to explicitly assign the specified system ACL.</span>
00154 <span class="comment">        SeSecurityPrivilege privilege is needed to explicitly assign</span>
00155 <span class="comment">        system ACLs to objects.</span>
00156 <span class="comment">--*/</span>
00157 
00158 {
00159     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00160     ULONG AutoInherit = 0;
00161     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00162 
00163 <span class="preprocessor">#if DBG</span>
00164 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ExplicitDescriptor) ) {
00165         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ExplicitDescriptor,
00166                                    <span class="stringliteral">"\nSeAssignSecurity: Input security descriptor = \n"</span>
00167                                  );
00168     }
00169 
00170     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ParentDescriptor )) {
00171         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ParentDescriptor,
00172                                    <span class="stringliteral">"\nSeAssignSecurity: Parent security descriptor = \n"</span>
00173                                  );
00174     }
00175 <span class="preprocessor">#endif // DBG</span>
00176 <span class="preprocessor"></span>
00177     <span class="comment">//</span>
00178     <span class="comment">// If the Parent SD was created via AutoInheritance,</span>
00179     <span class="comment">//  and this object is being created with no explicit descriptor,</span>
00180     <span class="comment">//  then we can safely create this object as AutoInherit.</span>
00181     <span class="comment">//</span>
00182 
00183     <span class="keywordflow">if</span> ( ParentDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00184 
00185         <span class="keywordflow">if</span> ( (ExplicitDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00186               (((PISECURITY_DESCRIPTOR)ExplicitDescriptor)-&gt;Control &amp; SE_DACL_PRESENT) == 0 ) &amp;&amp;
00187              (((PISECURITY_DESCRIPTOR)ParentDescriptor)-&gt;Control &amp; SE_DACL_AUTO_INHERITED) != 0 ) {
00188             AutoInherit |= SEF_DACL_AUTO_INHERIT;
00189         }
00190 
00191         <span class="keywordflow">if</span> ( (ExplicitDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00192              (((PISECURITY_DESCRIPTOR)ExplicitDescriptor)-&gt;Control &amp; SE_SACL_PRESENT) == 0 ) &amp;&amp;
00193              (((PISECURITY_DESCRIPTOR)ParentDescriptor)-&gt;Control &amp; SE_SACL_AUTO_INHERITED) != 0 ) {
00194             AutoInherit |= SEF_SACL_AUTO_INHERIT;
00195         }
00196 
00197     }
00198 
00199 
00200     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a76">RtlpNewSecurityObject</a> (
00201                     ParentDescriptor OPTIONAL,
00202                     ExplicitDescriptor OPTIONAL,
00203                     NewDescriptor,
00204                     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,   <span class="comment">// No object type</span>
00205                     IsDirectoryObject,
00206                     AutoInherit,
00207                     (HANDLE) SubjectContext,
00208                     GenericMapping );
00209 
00210 <span class="preprocessor">#if DBG</span>
00211 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00212         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( *NewDescriptor,
00213                                    <span class="stringliteral">"SeAssignSecurity: Final security descriptor = \n"</span>
00214                                  );
00215     }
00216 <span class="preprocessor">#endif</span>
00217 <span class="preprocessor"></span>
00218     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00219 
00220 
00221     <span class="comment">// RtlpNewSecurityObject always uses PagedPool.</span>
00222     UNREFERENCED_PARAMETER( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> );
00223 
00224 }
00225 
00226 
00227 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00228"></a><a class="code" href="../../d1/d5/seassign_8c.html#a2">00228</a> <a class="code" href="../../d1/d5/seassign_8c.html#a2">SeAssignSecurityEx</a> (
00229     IN PSECURITY_DESCRIPTOR ParentDescriptor OPTIONAL,
00230     IN PSECURITY_DESCRIPTOR ExplicitDescriptor OPTIONAL,
00231     OUT PSECURITY_DESCRIPTOR *NewDescriptor,
00232     IN GUID *ObjectType OPTIONAL,
00233     IN BOOLEAN IsDirectoryObject,
00234     IN ULONG AutoInheritFlags,
00235     IN <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext,
00236     IN PGENERIC_MAPPING GenericMapping,
00237     IN POOL_TYPE PoolType
00238     )
00239 
00240 <span class="comment">/*++</span>
00241 <span class="comment"></span>
00242 <span class="comment">Routine Description:</span>
00243 <span class="comment"></span>
00244 <span class="comment">    This routine assumes privilege checking HAS NOT yet been performed</span>
00245 <span class="comment">    and so will be performed by this routine.</span>
00246 <span class="comment"></span>
00247 <span class="comment">    This procedure is used to build a security descriptor for a new object</span>
00248 <span class="comment">    given the security descriptor of its parent directory and any originally</span>
00249 <span class="comment">    requested security for the object.  The final security descriptor</span>
00250 <span class="comment">    returned to the caller may contain a mix of information, some explicitly</span>
00251 <span class="comment">    provided other from the new object's parent.</span>
00252 <span class="comment"></span>
00253 <span class="comment"></span>
00254 <span class="comment">    See RtlpNewSecurityObject for a descriptor of how the NewDescriptor is</span>
00255 <span class="comment">    built.</span>
00256 <span class="comment"></span>
00257 <span class="comment"></span>
00258 <span class="comment">Arguments:</span>
00259 <span class="comment"></span>
00260 <span class="comment">    ParentDescriptor - Optionally supplies the security descriptor of the</span>
00261 <span class="comment">        parent directory under which this new object is being created.</span>
00262 <span class="comment"></span>
00263 <span class="comment">    ExplicitDescriptor - Supplies the address of a pointer to the security</span>
00264 <span class="comment">        descriptor as specified by the user that is to be applied to</span>
00265 <span class="comment">        the new object.</span>
00266 <span class="comment"></span>
00267 <span class="comment">    NewDescriptor - Returns the actual security descriptor for the new</span>
00268 <span class="comment">        object that has been modified according to above rules.</span>
00269 <span class="comment"></span>
00270 <span class="comment">    ObjectType - GUID of the object type being created.  If the object being</span>
00271 <span class="comment">        created has no GUID associated with it, then this argument is</span>
00272 <span class="comment">        specified as NULL.</span>
00273 <span class="comment"></span>
00274 <span class="comment">    IsDirectoryObject - Specifies if the new object is itself a directory</span>
00275 <span class="comment">        object.  A value of TRUE indicates the object is a container of other</span>
00276 <span class="comment">        objects.</span>
00277 <span class="comment"></span>
00278 <span class="comment">    AutoInheritFlags - Controls automatic inheritance of ACES from the Parent</span>
00279 <span class="comment">        Descriptor.  Valid values are a bits mask of the logical OR of</span>
00280 <span class="comment">        one or more of the following bits:</span>
00281 <span class="comment"></span>
00282 <span class="comment">        SEF_DACL_AUTO_INHERIT - If set, inherit ACEs from the</span>
00283 <span class="comment">            DACL ParentDescriptor are inherited to NewDescriptor in addition</span>
00284 <span class="comment">            to any explicit ACEs specified by the CreatorDescriptor.</span>
00285 <span class="comment"></span>
00286 <span class="comment">        SEF_SACL_AUTO_INHERIT - If set, inherit ACEs from the</span>
00287 <span class="comment">            SACL ParentDescriptor are inherited to NewDescriptor in addition</span>
00288 <span class="comment">            to any explicit ACEs specified by the CreatorDescriptor.</span>
00289 <span class="comment"></span>
00290 <span class="comment">        SEF_DEFAULT_DESCRIPTOR_FOR_OBJECT - If set, the CreatorDescriptor</span>
00291 <span class="comment">            is the default descriptor for ObjectType.  As such, the</span>
00292 <span class="comment">            CreatorDescriptor will be ignored if any ObjectType specific</span>
00293 <span class="comment">            ACEs are inherited from the parent.  If no such ACEs are inherited,</span>
00294 <span class="comment">            the CreatorDescriptor is handled as though this flag were not</span>
00295 <span class="comment">            specified.</span>
00296 <span class="comment"></span>
00297 <span class="comment">        SEF_AVOID_PRIVILEGE_CHECK - If set, no privilege checking is done by this</span>
00298 <span class="comment">            routine.  This flag is useful while implementing automatic inheritance</span>
00299 <span class="comment">            to avoid checking privileges on each child updated.</span>
00300 <span class="comment"></span>
00301 <span class="comment">    SubjectContext - Supplies the security context of the subject creating the</span>
00302 <span class="comment">        object. This is used to retrieve default security information for the</span>
00303 <span class="comment">        new object, such as default owner, primary group, and discretionary</span>
00304 <span class="comment">        access control.</span>
00305 <span class="comment"></span>
00306 <span class="comment">    GenericMapping - Supplies a pointer to an array of access mask values</span>
00307 <span class="comment">        denoting the mapping between each generic right to non-generic rights.</span>
00308 <span class="comment"></span>
00309 <span class="comment">    PoolType - Specifies the pool type to use to when allocating a new</span>
00310 <span class="comment">        security descriptor.</span>
00311 <span class="comment"></span>
00312 <span class="comment">Return Value:</span>
00313 <span class="comment"></span>
00314 <span class="comment">    STATUS_SUCCESS - indicates the operation was successful.</span>
00315 <span class="comment"></span>
00316 <span class="comment">    STATUS_INVALID_OWNER - The owner SID provided as the owner of the</span>
00317 <span class="comment">        target security descriptor is not one the caller is authorized</span>
00318 <span class="comment">        to assign as the owner of an object.</span>
00319 <span class="comment"></span>
00320 <span class="comment">    STATUS_PRIVILEGE_NOT_HELD - The caller does not have the privilege</span>
00321 <span class="comment">        necessary to explicitly assign the specified system ACL.</span>
00322 <span class="comment">        SeSecurityPrivilege privilege is needed to explicitly assign</span>
00323 <span class="comment">        system ACLs to objects.</span>
00324 <span class="comment">--*/</span>
00325 
00326 {
00327     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00328     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00329 
00330 <span class="preprocessor">#if DBG</span>
00331 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ExplicitDescriptor) ) {
00332         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ExplicitDescriptor,
00333                                    <span class="stringliteral">"\nSeAssignSecurityEx: Input security descriptor = \n"</span>
00334                                  );
00335     }
00336 
00337     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ParentDescriptor )) {
00338         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ParentDescriptor,
00339                                    <span class="stringliteral">"\nSeAssignSecurityEx: Parent security descriptor = \n"</span>
00340                                  );
00341     }
00342 <span class="preprocessor">#endif // DBG</span>
00343 <span class="preprocessor"></span>
00344 
00345     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a76">RtlpNewSecurityObject</a> (
00346                     ParentDescriptor OPTIONAL,
00347                     ExplicitDescriptor OPTIONAL,
00348                     NewDescriptor,
00349                     ObjectType,
00350                     IsDirectoryObject,
00351                     AutoInheritFlags,
00352                     (HANDLE) SubjectContext,
00353                     GenericMapping );
00354 
00355 <span class="preprocessor">#if DBG</span>
00356 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00357         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( *NewDescriptor,
00358                                    <span class="stringliteral">"SeAssignSecurityEx: Final security descriptor = \n"</span>
00359                                  );
00360     }
00361 <span class="preprocessor">#endif</span>
00362 <span class="preprocessor"></span>
00363     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00364 
00365 
00366     <span class="comment">// RtlpNewSecurityObject always uses PagedPool.</span>
00367     UNREFERENCED_PARAMETER( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> );
00368 
00369 }
00370 
00371 
00372 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00373"></a><a class="code" href="../../d1/d5/seassign_8c.html#a3">00373</a> <a class="code" href="../../d1/d5/seassign_8c.html#a3">SeDeassignSecurity</a> (
00374     IN OUT PSECURITY_DESCRIPTOR *SecurityDescriptor
00375     )
00376 
00377 <span class="comment">/*++</span>
00378 <span class="comment"></span>
00379 <span class="comment">Routine Description:</span>
00380 <span class="comment"></span>
00381 <span class="comment">    This routine deallocates the memory associated with a security descriptor</span>
00382 <span class="comment">    that was assigned using SeAssignSecurity.</span>
00383 <span class="comment"></span>
00384 <span class="comment"></span>
00385 <span class="comment">Arguments:</span>
00386 <span class="comment"></span>
00387 <span class="comment">    SecurityDescriptor - Supplies the address of a pointer to the security</span>
00388 <span class="comment">        descriptor  being deleted.</span>
00389 <span class="comment"></span>
00390 <span class="comment">Return Value:</span>
00391 <span class="comment"></span>
00392 <span class="comment">    STATUS_SUCCESS - The deallocation was successful.</span>
00393 <span class="comment"></span>
00394 <span class="comment">--*/</span>
00395 
00396 {
00397     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00398 
00399     <span class="keywordflow">if</span> ((*SecurityDescriptor) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00400         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (*SecurityDescriptor) );
00401     }
00402 
00403     <span class="comment">//</span>
00404     <span class="comment">//  And zero out the pointer to it for safety sake</span>
00405     <span class="comment">//</span>
00406 
00407     (*SecurityDescriptor) = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00408 
00409     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00410 
00411 }
00412 
00413 
00414 
00415 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00416"></a><a class="code" href="../../d1/d5/seassign_8c.html#a4">00416</a> <a class="code" href="../../d1/d5/seassign_8c.html#a4">SepInheritAcl</a> (
00417     IN PACL Acl,
00418     IN BOOLEAN IsDirectoryObject,
00419     IN PSID ClientOwnerSid,
00420     IN PSID ClientGroupSid,
00421     IN PSID ServerOwnerSid OPTIONAL,
00422     IN PSID ServerGroupSid OPTIONAL,
00423     IN PGENERIC_MAPPING GenericMapping,
00424     IN POOL_TYPE PoolType,
00425     OUT PACL *NewAcl
00426     )
00427 
00428 <span class="comment">/*++</span>
00429 <span class="comment"></span>
00430 <span class="comment">Routine Description:</span>
00431 <span class="comment"></span>
00432 <span class="comment">    This is a private routine that produces an inherited acl from</span>
00433 <span class="comment">    a parent acl according to the rules of inheritance</span>
00434 <span class="comment"></span>
00435 <span class="comment">Arguments:</span>
00436 <span class="comment"></span>
00437 <span class="comment">    Acl - Supplies the acl being inherited.</span>
00438 <span class="comment"></span>
00439 <span class="comment">    IsDirectoryObject - Specifies if the new acl is for a directory.</span>
00440 <span class="comment"></span>
00441 <span class="comment">    OwnerSid - Specifies the owner Sid to use.</span>
00442 <span class="comment"></span>
00443 <span class="comment">    GroupSid - Specifies the group SID to use.</span>
00444 <span class="comment"></span>
00445 <span class="comment">    ServerSid - Specifies the Server SID to use.</span>
00446 <span class="comment"></span>
00447 <span class="comment">    ClientSid - Specifies the Client SID to use.</span>
00448 <span class="comment"></span>
00449 <span class="comment">    GenericMapping - Specifies the generic mapping to use.</span>
00450 <span class="comment"></span>
00451 <span class="comment">    PoolType - Specifies the pool type for the new acl.</span>
00452 <span class="comment"></span>
00453 <span class="comment">    NewAcl - Receives a pointer to the new (inherited) acl.</span>
00454 <span class="comment"></span>
00455 <span class="comment">Return Value:</span>
00456 <span class="comment"></span>
00457 <span class="comment">    STATUS_SUCCESS - An inheritable ACL was successfully generated.</span>
00458 <span class="comment"></span>
00459 <span class="comment">    STATUS_NO_INHERITANCE - An inheritable ACL was not successfully generated.</span>
00460 <span class="comment">        This is a warning completion status.</span>
00461 <span class="comment"></span>
00462 <span class="comment">    STATUS_BAD_INHERITANCE_ACL - Indicates the acl built was not a valid ACL.</span>
00463 <span class="comment">        This can becaused by a number of things.  One of the more probable</span>
00464 <span class="comment">        causes is the replacement of a CreatorId with an SID that didn't fit</span>
00465 <span class="comment">        into the ACE or ACL.</span>
00466 <span class="comment"></span>
00467 <span class="comment">    STATUS_UNKNOWN_REVISION - Indicates the source ACL is a revision that</span>
00468 <span class="comment">        is unknown to this routine.</span>
00469 <span class="comment"></span>
00470 <span class="comment">--*/</span>
00471 
00472 {
00474 <span class="comment">//                                                                          //</span>
00475 <span class="comment">//   The logic in the ACL inheritance code must mirror the code for         //</span>
00476 <span class="comment">//   inheritance in the user mode runtime (in sertl.c). Do not make changes //</span>
00477 <span class="comment">//   here without also making changes in that module.                       //</span>
00478 <span class="comment">//                                                                          //</span>
00480 <span class="comment"></span>
00481 
00482     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00483     ULONG NewAclLength;
00484     BOOLEAN NewAclExplicitlyAssigned;
00485     ULONG NewGenericControl;
00486 
00487     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00488     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> ); <span class="comment">// RtlpInheritAcl assumes paged pool</span>
00489 
00490     <span class="comment">//</span>
00491     <span class="comment">//  First check if the acl is null</span>
00492     <span class="comment">//</span>
00493 
00494     <span class="keywordflow">if</span> (Acl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00495 
00496         <span class="keywordflow">return</span> STATUS_NO_INHERITANCE;
00497     }
00498 
00499     <span class="comment">//</span>
00500     <span class="comment">// Generating an inheritable ACL.</span>
00501     <span class="comment">//</span>
00502     <span class="comment">// Pass all parameters as though there is no auto inheritance.</span>
00503     <span class="comment">//</span>
00504 
00505     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a74">RtlpInheritAcl</a>(
00506                  Acl,
00507                  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,  <span class="comment">// No child ACL since no auto inheritance</span>
00508                  0,     <span class="comment">// No child control since no auto inheritance</span>
00509                  IsDirectoryObject,
00510                  <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <span class="comment">// Not AutoInherit since no auto inheritance</span>
00511                  <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <span class="comment">// Not DefaultDescriptor since no auto inheritance</span>
00512                  ClientOwnerSid,
00513                  ClientGroupSid,
00514                  ServerOwnerSid,
00515                  ServerGroupSid,
00516                  GenericMapping,
00517                  <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <span class="comment">// Isn't a SACL</span>
00518                  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,  <span class="comment">// No object GUID</span>
00519                  NewAcl,
00520                  &amp;NewAclExplicitlyAssigned,
00521                  &amp;NewGenericControl );
00522 
00523     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00524 }
00525 
00526 
00527 
00528 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00529"></a><a class="code" href="../../d1/d5/seassign_8c.html#a5">00529</a> <a class="code" href="../../d1/d5/seassign_8c.html#a5">SeAssignWorldSecurityDescriptor</a>(
00530     IN PSECURITY_DESCRIPTOR SecurityDescriptor,
00531     IN OUT PULONG Length,
00532     IN PSECURITY_INFORMATION SecurityInformation
00533     )
00534 
00535 <span class="comment">/*++</span>
00536 <span class="comment"></span>
00537 <span class="comment">Routine Description:</span>
00538 <span class="comment"></span>
00539 <span class="comment">    This routine is called by the I/O system to properly initialize a</span>
00540 <span class="comment">    security descriptor for a FAT file.  It will take a pointer to a</span>
00541 <span class="comment">    buffer containing an emptry security descriptor, and create in the</span>
00542 <span class="comment">    buffer a self-relative security descriptor with</span>
00543 <span class="comment"></span>
00544 <span class="comment">        Owner = WorldSid,</span>
00545 <span class="comment"></span>
00546 <span class="comment">        Group = WorldSid.</span>
00547 <span class="comment"></span>
00548 <span class="comment">    Thus, a FAT file is accessable to all.</span>
00549 <span class="comment"></span>
00550 <span class="comment">Arguments:</span>
00551 <span class="comment"></span>
00552 <span class="comment">    SecurityDescriptor - Supplies a pointer to a buffer in which will be</span>
00553 <span class="comment">        created a self-relative security descriptor as described above.</span>
00554 <span class="comment"></span>
00555 <span class="comment">    Length - The length in bytes of the buffer.  If the length is too</span>
00556 <span class="comment">        small, it will contain the minimum size required upon exit.</span>
00557 <span class="comment"></span>
00558 <span class="comment"></span>
00559 <span class="comment">Return Value:</span>
00560 <span class="comment"></span>
00561 <span class="comment">    STATUS_BUFFER_TOO_SMALL - The buffer was not big enough to contain</span>
00562 <span class="comment">        the requested information.</span>
00563 <span class="comment"></span>
00564 <span class="comment"></span>
00565 <span class="comment">--*/</span>
00566 
00567 {
00568 
00569     PCHAR Field;
00570     PCHAR Base;
00571     ULONG WorldSidLength;
00572     PISECURITY_DESCRIPTOR_RELATIVE ISecurityDescriptor;
00573     ULONG MinSize;
00574     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00575 
00576     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00577 
00578     <span class="keywordflow">if</span> ( !ARGUMENT_PRESENT( SecurityInformation )) {
00579 
00580         <span class="keywordflow">return</span>( STATUS_ACCESS_DENIED );
00581     }
00582 
00583     WorldSidLength = <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( <a class="code" href="../../d0/d5/se_8h.html#a42">SeWorldSid</a> );
00584 
00585     MinSize = <span class="keyword">sizeof</span>( SECURITY_DESCRIPTOR_RELATIVE ) + 2 * WorldSidLength;
00586 
00587     <span class="keywordflow">if</span> ( *Length &lt; MinSize ) {
00588 
00589         *Length = MinSize;
00590         <span class="keywordflow">return</span>( STATUS_BUFFER_TOO_SMALL );
00591     }
00592 
00593     *Length = MinSize;
00594 
00595     ISecurityDescriptor = (SECURITY_DESCRIPTOR_RELATIVE *)SecurityDescriptor;
00596 
00597     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a54">RtlCreateSecurityDescriptorRelative</a>( ISecurityDescriptor,
00598                                           SECURITY_DESCRIPTOR_REVISION );
00599 
00600     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00601         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00602     }
00603 
00604     Base = (PCHAR)(ISecurityDescriptor);
00605     Field =  Base + <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE);
00606 
00607     <span class="keywordflow">if</span> ( *SecurityInformation &amp; OWNER_SECURITY_INFORMATION ) {
00608 
00609         RtlCopyMemory( Field, <a class="code" href="../../d0/d5/se_8h.html#a42">SeWorldSid</a>, WorldSidLength );
00610         ISecurityDescriptor-&gt;Owner = RtlPointerToOffset(Base,Field);
00611         Field += WorldSidLength;
00612     }
00613 
00614     <span class="keywordflow">if</span> ( *SecurityInformation &amp; GROUP_SECURITY_INFORMATION ) {
00615 
00616         RtlCopyMemory( Field, <a class="code" href="../../d0/d5/se_8h.html#a42">SeWorldSid</a>, WorldSidLength );
00617         ISecurityDescriptor-&gt;Group = RtlPointerToOffset(Base,Field);
00618     }
00619 
00620     <span class="keywordflow">if</span> ( *SecurityInformation &amp; DACL_SECURITY_INFORMATION ) {
00621         RtlpSetControlBits( ISecurityDescriptor, SE_DACL_PRESENT );
00622     }
00623 
00624     <span class="keywordflow">if</span> ( *SecurityInformation &amp; SACL_SECURITY_INFORMATION ) {
00625         RtlpSetControlBits( ISecurityDescriptor, SE_SACL_PRESENT );
00626     }
00627 
00628     RtlpSetControlBits( ISecurityDescriptor, SE_SELF_RELATIVE );
00629 
00630     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00631 
00632 }
00633 
00634 
00635 
00636 
00637 
00638 
00639 
00640 
00641 <span class="comment">//</span>
00642 <span class="comment">//  BUGWARNING The following routines should be in a debug only kernel, since</span>
00643 <span class="comment">//  all they do is dump stuff to a debug terminal as appropriate.  The same</span>
00644 <span class="comment">//  goes for the declarations of the variables SepDumpSD and SepDumpToken</span>
00645 <span class="comment">//</span>
00646 
00647 
00648 
00649 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00650"></a><a class="code" href="../../d6/d6/sep_8h.html#a57">00650</a> <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>(
00651     IN PSECURITY_DESCRIPTOR SecurityDescriptor,
00652     IN PSZ TitleString
00653     )
00654 
00655 <span class="comment">/*++</span>
00656 <span class="comment"></span>
00657 <span class="comment">Routine Description:</span>
00658 <span class="comment"></span>
00659 <span class="comment">    Private routine to dump a security descriptor to the debug</span>
00660 <span class="comment">    screen.</span>
00661 <span class="comment"></span>
00662 <span class="comment">Arguments:</span>
00663 <span class="comment"></span>
00664 <span class="comment">    SecurityDescriptor - Supplies the security descriptor to be dumped.</span>
00665 <span class="comment"></span>
00666 <span class="comment">    TitleString - A null terminated string to print before dumping</span>
00667 <span class="comment">        the security descriptor.</span>
00668 <span class="comment"></span>
00669 <span class="comment"></span>
00670 <span class="comment">Return Value:</span>
00671 <span class="comment"></span>
00672 <span class="comment">    None.</span>
00673 <span class="comment"></span>
00674 <span class="comment"></span>
00675 <span class="comment">--*/</span>
00676 {
00677 <span class="preprocessor">#if DBG</span>
00678 <span class="preprocessor"></span>    PISECURITY_DESCRIPTOR ISecurityDescriptor;
00679     UCHAR Revision;
00680     SECURITY_DESCRIPTOR_CONTROL Control;
00681     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a>;
00682     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>;
00683     PACL Sacl;
00684     PACL <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>;
00685 
00686     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00687 
00688 
00689     <span class="keywordflow">if</span> (!SepDumpSD) {
00690         <span class="keywordflow">return</span>;
00691     }
00692 
00693     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT( SecurityDescriptor )) {
00694         <span class="keywordflow">return</span>;
00695     }
00696 
00697     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(TitleString);
00698 
00699     ISecurityDescriptor = ( PISECURITY_DESCRIPTOR )SecurityDescriptor;
00700 
00701     Revision = ISecurityDescriptor-&gt;Revision;
00702     Control  = ISecurityDescriptor-&gt;Control;
00703 
00704     <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a>    = RtlpOwnerAddrSecurityDescriptor( ISecurityDescriptor );
00705     <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>    = RtlpGroupAddrSecurityDescriptor( ISecurityDescriptor );
00706     Sacl     = RtlpSaclAddrSecurityDescriptor( ISecurityDescriptor );
00707     <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>     = RtlpDaclAddrSecurityDescriptor( ISecurityDescriptor );
00708 
00709     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\nSECURITY DESCRIPTOR\n"</span>);
00710 
00711     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Revision = %d\n"</span>,Revision);
00712 
00713     <span class="comment">//</span>
00714     <span class="comment">// Print control info</span>
00715     <span class="comment">//</span>
00716 
00717     <span class="keywordflow">if</span> (Control &amp; SE_OWNER_DEFAULTED) {
00718         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Owner defaulted\n"</span>);
00719     }
00720     <span class="keywordflow">if</span> (Control &amp; SE_GROUP_DEFAULTED) {
00721         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Group defaulted\n"</span>);
00722     }
00723     <span class="keywordflow">if</span> (Control &amp; SE_DACL_PRESENT) {
00724         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl present\n"</span>);
00725     }
00726     <span class="keywordflow">if</span> (Control &amp; SE_DACL_DEFAULTED) {
00727         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl defaulted\n"</span>);
00728     }
00729     <span class="keywordflow">if</span> (Control &amp; SE_SACL_PRESENT) {
00730         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sacl present\n"</span>);
00731     }
00732     <span class="keywordflow">if</span> (Control &amp; SE_SACL_DEFAULTED) {
00733         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sacl defaulted\n"</span>);
00734     }
00735     <span class="keywordflow">if</span> (Control &amp; SE_SELF_RELATIVE) {
00736         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Self relative\n"</span>);
00737     }
00738     <span class="keywordflow">if</span> (Control &amp; SE_DACL_UNTRUSTED) {
00739         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl untrusted\n"</span>);
00740     }
00741     <span class="keywordflow">if</span> (Control &amp; SE_SERVER_SECURITY) {
00742         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Server security\n"</span>);
00743     }
00744 
00745     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Owner "</span>);
00746     <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> );
00747 
00748     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Group "</span>);
00749     <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> );
00750 
00751     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sacl"</span>);
00752     <a class="code" href="../../d6/d6/sep_8h.html#a55">SepPrintAcl</a>( Sacl );
00753 
00754     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl"</span>);
00755     <a class="code" href="../../d6/d6/sep_8h.html#a55">SepPrintAcl</a>( <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> );
00756 <span class="preprocessor">#endif</span>
00757 <span class="preprocessor"></span>}
00758 
00759 
00760 
00761 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00762"></a><a class="code" href="../../d6/d6/sep_8h.html#a55">00762</a> <a class="code" href="../../d6/d6/sep_8h.html#a55">SepPrintAcl</a> (
00763     IN PACL Acl
00764     )
00765 
00766 <span class="comment">/*++</span>
00767 <span class="comment"></span>
00768 <span class="comment">Routine Description:</span>
00769 <span class="comment"></span>
00770 <span class="comment">    This routine dumps via (DbgPrint) an Acl for debug purposes.  It is</span>
00771 <span class="comment">    specialized to dump standard aces.</span>
00772 <span class="comment"></span>
00773 <span class="comment">Arguments:</span>
00774 <span class="comment"></span>
00775 <span class="comment">    Acl - Supplies the Acl to dump</span>
00776 <span class="comment"></span>
00777 <span class="comment">Return Value:</span>
00778 <span class="comment"></span>
00779 <span class="comment">    None</span>
00780 <span class="comment"></span>
00781 <span class="comment">--*/</span>
00782 
00783 
00784 {
00785 <span class="preprocessor">#if DBG</span>
00786 <span class="preprocessor"></span>    ULONG i;
00787     <a class="code" href="../../d4/d7/struct__KNOWN__ACE.html">PKNOWN_ACE</a> Ace;
00788     BOOLEAN KnownType;
00789 
00790     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00791 
00792     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"@ %8lx\n"</span>, Acl);
00793 
00794     <span class="comment">//</span>
00795     <span class="comment">//  Check if the Acl is null</span>
00796     <span class="comment">//</span>
00797 
00798     <span class="keywordflow">if</span> (Acl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00799 
00800         <span class="keywordflow">return</span>;
00801 
00802     }
00803 
00804     <span class="comment">//</span>
00805     <span class="comment">//  Dump the Acl header</span>
00806     <span class="comment">//</span>
00807 
00808     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Revision: %02x"</span>, Acl-&gt;AclRevision);
00809     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Size: %04x"</span>, Acl-&gt;AclSize);
00810     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" AceCount: %04x\n"</span>, Acl-&gt;AceCount);
00811 
00812     <span class="comment">//</span>
00813     <span class="comment">//  Now for each Ace we want do dump it</span>
00814     <span class="comment">//</span>
00815 
00816     <span class="keywordflow">for</span> (i = 0, Ace = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a1">FirstAce</a>(Acl);
00817          i &lt; Acl-&gt;AceCount;
00818          i++, Ace = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a2">NextAce</a>(Ace) ) {
00819 
00820         <span class="comment">//</span>
00821         <span class="comment">//  print out the ace header</span>
00822         <span class="comment">//</span>
00823 
00824         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n AceHeader: %08lx "</span>, *(PULONG)Ace);
00825 
00826         <span class="comment">//</span>
00827         <span class="comment">//  special case on the standard ace types</span>
00828         <span class="comment">//</span>
00829 
00830         <span class="keywordflow">if</span> ((Ace-&gt;Header.AceType == ACCESS_ALLOWED_ACE_TYPE) ||
00831             (Ace-&gt;Header.AceType == ACCESS_DENIED_ACE_TYPE) ||
00832             (Ace-&gt;Header.AceType == SYSTEM_AUDIT_ACE_TYPE) ||
00833             (Ace-&gt;Header.AceType == SYSTEM_ALARM_ACE_TYPE) ||
00834             (Ace-&gt;Header.AceType == ACCESS_ALLOWED_COMPOUND_ACE_TYPE)) {
00835 
00836             <span class="comment">//</span>
00837             <span class="comment">//  The following array is indexed by ace types and must</span>
00838             <span class="comment">//  follow the allowed, denied, audit, alarm seqeuence</span>
00839             <span class="comment">//</span>
00840 
00841             PCHAR AceTypes[] = { <span class="stringliteral">"Access Allowed"</span>,
00842                                  <span class="stringliteral">"Access Denied "</span>,
00843                                  <span class="stringliteral">"System Audit  "</span>,
00844                                  <span class="stringliteral">"System Alarm  "</span>,
00845                                  <span class="stringliteral">"Compound Grant"</span>,
00846                                };
00847 
00848             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(AceTypes[Ace-&gt;Header.AceType]);
00849             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n Access Mask: %08lx "</span>, Ace-&gt;Mask);
00850             KnownType = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00851 
00852         } <span class="keywordflow">else</span> {
00853 
00854             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Unknown Ace Type\n"</span>);
00855             KnownType = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00856         }
00857 
00858         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
00859 
00860         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" AceSize = %d\n"</span>,Ace-&gt;Header.AceSize);
00861 
00862         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Ace Flags = "</span>);
00863         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; OBJECT_INHERIT_ACE) {
00864             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"OBJECT_INHERIT_ACE\n"</span>);
00865             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00866         }
00867 
00868         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; CONTAINER_INHERIT_ACE) {
00869             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CONTAINER_INHERIT_ACE\n"</span>);
00870             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00871         }
00872 
00873         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; NO_PROPAGATE_INHERIT_ACE) {
00874             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"NO_PROPAGATE_INHERIT_ACE\n"</span>);
00875             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00876         }
00877 
00878         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; INHERIT_ONLY_ACE) {
00879             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"INHERIT_ONLY_ACE\n"</span>);
00880             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00881         }
00882 
00883 
00884         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; SUCCESSFUL_ACCESS_ACE_FLAG) {
00885             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SUCCESSFUL_ACCESS_ACE_FLAG\n"</span>);
00886             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"            "</span>);
00887         }
00888 
00889         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; FAILED_ACCESS_ACE_FLAG) {
00890             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"FAILED_ACCESS_ACE_FLAG\n"</span>);
00891             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"            "</span>);
00892         }
00893 
00894         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
00895 
00896         <span class="keywordflow">if</span> (KnownType != <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00897             <span class="keywordflow">continue</span>;
00898         }
00899 
00900         <span class="keywordflow">if</span> (Ace-&gt;Header.AceType != ACCESS_ALLOWED_COMPOUND_ACE_TYPE) {
00901             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Sid = "</span>);
00902             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(&amp;Ace-&gt;SidStart);
00903         } <span class="keywordflow">else</span> {
00904             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Server Sid = "</span>);
00905             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(RtlCompoundAceServerSid(Ace));
00906             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n Client Sid = "</span>);
00907             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(RtlCompoundAceClientSid( Ace ));
00908         }
00909     }
00910 <span class="preprocessor">#endif</span>
00911 <span class="preprocessor"></span>}
00912 
00913 
00914 
00915 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00916"></a><a class="code" href="../../d6/d6/sep_8h.html#a56">00916</a> <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(
00917     IN PSID Sid
00918     )
00919 
00920 <span class="comment">/*++</span>
00921 <span class="comment"></span>
00922 <span class="comment">Routine Description:</span>
00923 <span class="comment"></span>
00924 <span class="comment">    Prints a formatted Sid</span>
00925 <span class="comment"></span>
00926 <span class="comment">Arguments:</span>
00927 <span class="comment"></span>
00928 <span class="comment">    Sid - Provides a pointer to the sid to be printed.</span>
00929 <span class="comment"></span>
00930 <span class="comment"></span>
00931 <span class="comment">Return Value:</span>
00932 <span class="comment"></span>
00933 <span class="comment">    None.</span>
00934 <span class="comment"></span>
00935 <span class="comment">--*/</span>
00936 
00937 {
00938 <span class="preprocessor">#if DBG</span>
00939 <span class="preprocessor"></span>    UCHAR i;
00940     ULONG Tmp;
00941     PISID ISid;
00942     STRING AccountName;
00943     UCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[128];
00944 
00945     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00946 
00947     <span class="keywordflow">if</span> (Sid == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00948         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sid is NULL\n"</span>);
00949         <span class="keywordflow">return</span>;
00950     }
00951 
00952     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[0] = 0;
00953 
00954     AccountName.MaximumLength = 127;
00955     AccountName.Length = 0;
00956     AccountName.Buffer = (PVOID)&amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[0];
00957 
00958     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/sep_8h.html#a58">SepSidTranslation</a>( Sid, &amp;AccountName )) {
00959 
00960         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%s   "</span>, AccountName.Buffer );
00961     }
00962 
00963     ISid = (PISID)Sid;
00964 
00965     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"S-%lu-"</span>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ISid-&gt;Revision );
00966     <span class="keywordflow">if</span> (  (ISid-&gt;IdentifierAuthority.Value[0] != 0)  ||
00967           (ISid-&gt;IdentifierAuthority.Value[1] != 0)     ){
00968         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"0x%02hx%02hx%02hx%02hx%02hx%02hx"</span>,
00969                     (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ISid-&gt;IdentifierAuthority.Value[0],
00970                     (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ISid-&gt;IdentifierAuthority.Value[1],
00971                     (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ISid-&gt;IdentifierAuthority.Value[2],
00972                     (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ISid-&gt;IdentifierAuthority.Value[3],
00973                     (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ISid-&gt;IdentifierAuthority.Value[4],
00974                     (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ISid-&gt;IdentifierAuthority.Value[5] );
00975     } <span class="keywordflow">else</span> {
00976         Tmp = (ULONG)ISid-&gt;IdentifierAuthority.Value[5]          +
00977               (ULONG)(ISid-&gt;IdentifierAuthority.Value[4] &lt;&lt;  8)  +
00978               (ULONG)(ISid-&gt;IdentifierAuthority.Value[3] &lt;&lt; 16)  +
00979               (ULONG)(ISid-&gt;IdentifierAuthority.Value[2] &lt;&lt; 24);
00980         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lu"</span>, Tmp);
00981     }
00982 
00983 
00984     <span class="keywordflow">for</span> (i=0;i&lt;ISid-&gt;SubAuthorityCount ;i++ ) {
00985         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"-%lu"</span>, ISid-&gt;SubAuthority[i]);
00986     }
00987     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
00988 <span class="preprocessor">#endif</span>
00989 <span class="preprocessor"></span>}
00990 
00991 
00992 
00993 
00994 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00995"></a><a class="code" href="../../d6/d6/sep_8h.html#a59">00995</a> <a class="code" href="../../d6/d6/sep_8h.html#a59">SepDumpTokenInfo</a>(
00996     IN PACCESS_TOKEN Token
00997     )
00998 
00999 <span class="comment">/*++</span>
01000 <span class="comment"></span>
01001 <span class="comment">Routine Description:</span>
01002 <span class="comment"></span>
01003 <span class="comment">    Prints interesting information in a token.</span>
01004 <span class="comment"></span>
01005 <span class="comment">Arguments:</span>
01006 <span class="comment"></span>
01007 <span class="comment">    Token - Provides the token to be examined.</span>
01008 <span class="comment"></span>
01009 <span class="comment"></span>
01010 <span class="comment">Return Value:</span>
01011 <span class="comment"></span>
01012 <span class="comment">    None.</span>
01013 <span class="comment"></span>
01014 <span class="comment">--*/</span>
01015 
01016 {
01017 <span class="preprocessor">#if DBG</span>
01018 <span class="preprocessor"></span>    ULONG UserAndGroupCount;
01019     PSID_AND_ATTRIBUTES TokenSid;
01020     ULONG i;
01021     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> IToken;
01022 
01023     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01024 
01025     <span class="keywordflow">if</span> (!SepDumpToken) {
01026         <span class="keywordflow">return</span>;
01027     }
01028 
01029     IToken = (<a class="code" href="../../d8/d1/struct__TOKEN.html">TOKEN</a> *)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
01030 
01031     UserAndGroupCount = IToken-&gt;UserAndGroupCount;
01032 
01033     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n\nToken Address=%lx\n"</span>,IToken);
01034     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Token User and Groups Array:\n\n"</span>);
01035 
01036     <span class="keywordflow">for</span> ( i = 0 , TokenSid = IToken-&gt;UserAndGroups;
01037           i &lt; UserAndGroupCount ;
01038           i++, TokenSid++
01039         ) {
01040 
01041         <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( TokenSid-&gt;Sid );
01042 
01043         }
01044 
01045     <span class="keywordflow">if</span> ( IToken-&gt;RestrictedSids ) {
01046         UserAndGroupCount = IToken-&gt;RestrictedSidCount;
01047 
01048         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Restricted Sids Array:\n\n"</span>);
01049 
01050         <span class="keywordflow">for</span> ( i = 0 , TokenSid = IToken-&gt;RestrictedSids;
01051               i &lt; UserAndGroupCount ;
01052               i++, TokenSid++
01053             ) {
01054 
01055             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( TokenSid-&gt;Sid );
01056 
01057             }
01058     }
01059 <span class="preprocessor">#endif</span>
01060 <span class="preprocessor"></span>}
01061 
01062 
01063 
01064 BOOLEAN
<a name="l01065"></a><a class="code" href="../../d6/d6/sep_8h.html#a58">01065</a> <a class="code" href="../../d6/d6/sep_8h.html#a58">SepSidTranslation</a>(
01066     PSID Sid,
01067     PSTRING AccountName
01068     )
01069 
01070 <span class="comment">/*++</span>
01071 <span class="comment"></span>
01072 <span class="comment">Routine Description:</span>
01073 <span class="comment"></span>
01074 <span class="comment">    This routine translates well-known SIDs into English names.</span>
01075 <span class="comment"></span>
01076 <span class="comment">Arguments:</span>
01077 <span class="comment"></span>
01078 <span class="comment">    Sid - Provides the sid to be examined.</span>
01079 <span class="comment"></span>
01080 <span class="comment">    AccountName - Provides a string buffer in which to place the</span>
01081 <span class="comment">        translated name.</span>
01082 <span class="comment"></span>
01083 <span class="comment">Return Value:</span>
01084 <span class="comment"></span>
01085 <span class="comment">    None</span>
01086 <span class="comment"></span>
01087 <span class="comment">--*/</span>
01088 
01089 <span class="comment">// AccountName is expected to have a large maximum length</span>
01090 
01091 {
01092     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01093 
01094     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, <a class="code" href="../../d0/d5/se_8h.html#a42">SeWorldSid</a>)) {
01095         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"WORLD         "</span>);
01096         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01097     }
01098 
01099     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, <a class="code" href="../../d0/d5/se_8h.html#a43">SeLocalSid</a>)) {
01100         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"LOCAL         "</span>);
01101         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01102     }
01103 
01104     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, <a class="code" href="../../d0/d5/se_8h.html#a51">SeNetworkSid</a>)) {
01105         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"NETWORK       "</span>);
01106         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01107     }
01108 
01109     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, <a class="code" href="../../d0/d5/se_8h.html#a52">SeBatchSid</a>)) {
01110         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"BATCH         "</span>);
01111         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01112     }
01113 
01114     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, <a class="code" href="../../d0/d5/se_8h.html#a53">SeInteractiveSid</a>)) {
01115         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"INTERACTIVE   "</span>);
01116         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01117     }
01118 
01119     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, <a class="code" href="../../d0/d5/se_8h.html#a54">SeLocalSystemSid</a>)) {
01120         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"SYSTEM        "</span>);
01121         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01122     }
01123 
01124     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, <a class="code" href="../../d0/d5/se_8h.html#a44">SeCreatorOwnerSid</a>)) {
01125         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_OWNER "</span>);
01126         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01127     }
01128 
01129     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, <a class="code" href="../../d0/d5/se_8h.html#a45">SeCreatorGroupSid</a>)) {
01130         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_GROUP "</span>);
01131         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01132     }
01133 
01134     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, <a class="code" href="../../d0/d5/se_8h.html#a46">SeCreatorOwnerServerSid</a>)) {
01135         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_OWNER_SERVER "</span>);
01136         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01137     }
01138 
01139     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, <a class="code" href="../../d0/d5/se_8h.html#a47">SeCreatorGroupServerSid</a>)) {
01140         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_GROUP_SERVER "</span>);
01141         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01142     }
01143 
01144     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01145 }
01146 
01147 <span class="comment">//</span>
01148 <span class="comment">//  End debug only routines</span>
01149 <span class="comment">//</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:43 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
