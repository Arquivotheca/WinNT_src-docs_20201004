<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: adtp.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>adtp.h</h1><a href="../../d1/d5/adtp_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    adtp.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Auditing - Private Defines, Fuction Prototypes and Macro Functions</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Scott Birrell       (ScottBi)       November 6, 1991</span>
00016 <span class="comment"></span>
00017 <span class="comment">Environment:</span>
00018 <span class="comment"></span>
00019 <span class="comment">Revision History:</span>
00020 <span class="comment"></span>
00021 <span class="comment">--*/</span>
00022 
00023 <span class="preprocessor">#include "<a class="code" href="../../d8/d3/tokenp_8h.html">tokenp.h</a>"</span>
00024 
00025 <span class="comment">//</span>
00026 <span class="comment">// Audit Log Information</span>
00027 <span class="comment">//</span>
00028 
<a name="l00029"></a><a class="code" href="../../d1/d5/adtp_8h.html#a3">00029</a> POLICY_AUDIT_LOG_INFO <a class="code" href="../../d1/d5/adtp_8h.html#a3">SepAdtLogInformation</a>;
00030 
<a name="l00031"></a><a class="code" href="../../d1/d5/adtp_8h.html#a4">00031</a> <span class="keyword">extern</span> BOOLEAN <a class="code" href="../../d7/d4/adt_8h.html#a3">SepAdtAuditingEnabled</a>;
00032 
00033 <span class="comment">//</span>
00034 <span class="comment">// High and low water marks to control the length of the audit queue</span>
00035 <span class="comment">//</span>
00036 
<a name="l00037"></a><a class="code" href="../../d1/d5/adtp_8h.html#a5">00037</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d1/d5/adtp_8h.html#a5">SepAdtMaxListLength</a>;
<a name="l00038"></a><a class="code" href="../../d1/d5/adtp_8h.html#a6">00038</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d1/d5/adtp_8h.html#a6">SepAdtMinListLength</a>;
00039 
00040 <span class="comment">//</span>
00041 <span class="comment">// Structure used to query the above values from the registry</span>
00042 <span class="comment">//</span>
00043 
<a name="l00044"></a><a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">00044</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">_SEP_AUDIT_BOUNDS</a> {
00045 
<a name="l00046"></a><a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html#o0">00046</a>     ULONG <a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html#o0">UpperBound</a>;
<a name="l00047"></a><a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html#o1">00047</a>     ULONG <a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html#o1">LowerBound</a>;
00048 
00049 } <a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">SEP_AUDIT_BOUNDS</a>, *<a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">PSEP_AUDIT_BOUNDS</a>;
00050 
00051 
00052 <span class="comment">//</span>
00053 <span class="comment">// Number of events discarded</span>
00054 <span class="comment">//</span>
00055 
<a name="l00056"></a><a class="code" href="../../d1/d5/adtp_8h.html#a9">00056</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d1/d5/adtp_8h.html#a9">SepAdtCountEventsDiscarded</a>;
00057 
00058 
00059 <span class="comment">//</span>
00060 <span class="comment">// Number of events on the queue</span>
00061 <span class="comment">//</span>
00062 
<a name="l00063"></a><a class="code" href="../../d1/d5/adtp_8h.html#a10">00063</a> <span class="keyword">extern</span> ULONG <a class="code" href="../../d1/d5/adtp_8h.html#a10">SepAdtCurrentListLength</a>;
00064 
00065 
00066 <span class="comment">//</span>
00067 <span class="comment">// Flag to tell us that we're discarding audits</span>
00068 <span class="comment">//</span>
00069 
<a name="l00070"></a><a class="code" href="../../d1/d5/adtp_8h.html#a11">00070</a> <span class="keyword">extern</span> BOOLEAN <a class="code" href="../../d1/d5/adtp_8h.html#a11">SepAdtDiscardingAudits</a>;
00071 
00072 <span class="comment">//</span>
00073 <span class="comment">// Flag to tell us that we should crash if we miss</span>
00074 <span class="comment">// and audit.</span>
00075 <span class="comment">//</span>
00076 
<a name="l00077"></a><a class="code" href="../../d1/d5/adtp_8h.html#a12">00077</a> <span class="keyword">extern</span> BOOLEAN <a class="code" href="../../d1/d5/adtp_8h.html#a12">SepCrashOnAuditFail</a>;
00078 
00079 <span class="comment">//</span>
00080 <span class="comment">// Value name for verbose privilege auditing</span>
00081 <span class="comment">//</span>
00082 
<a name="l00083"></a><a class="code" href="../../d1/d5/adtp_8h.html#a0">00083</a> <span class="preprocessor">#define FULL_PRIVILEGE_AUDITING   L"FullPrivilegeAuditing"</span>
00084 <span class="preprocessor"></span>
00085 
00086 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00087 <a class="code" href="../../d1/d5/adtp_8h.html#a15">SepAdtSetAuditEventInformation</a>(
00088     IN OPTIONAL PBOOLEAN AuditingMode,
00089     IN OPTIONAL PPOLICY_AUDIT_EVENT_OPTIONS EventAuditingOptions
00090     );
00091 
00092 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00093 <a class="code" href="../../d1/d5/adtp_8h.html#a16">SepAdtGetAuditEventInformation</a>(
00094     OUT OPTIONAL PBOOLEAN AuditingMode,
00095     OUT OPTIONAL PPOLICY_AUDIT_EVENT_OPTIONS EventAuditingOptions
00096     );
00097 
00098 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00099 <a class="code" href="../../d1/d5/adtp_8h.html#a17">SepAdtSetAuditLogInformation</a>(
00100     IN PPOLICY_AUDIT_LOG_INFO AuditLogInformation
00101     );
00102 
00103 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00104 <a class="code" href="../../d1/d5/adtp_8h.html#a18">SepAdtMarshallAuditRecord</a>(
00105     IN PSE_ADT_PARAMETER_ARRAY AuditParameters,
00106     OUT PSE_ADT_PARAMETER_ARRAY *MarshalledAuditParameters,
00107     OUT PSEP_RM_LSA_MEMORY_TYPE RecordMemoryType
00108     );
00109 
00110 
00111 BOOLEAN
00112 <a class="code" href="../../d7/d6/sepaudit_8c.html#a9">SepAdtPrivilegeObjectAuditAlarm</a> (
00113     IN PUNICODE_STRING CapturedSubsystemName OPTIONAL,
00114     IN PVOID HandleId,
00115     IN PTOKEN ClientToken OPTIONAL,
00116     IN PTOKEN PrimaryToken,
00117     IN PVOID ProcessId,
00118     IN ACCESS_MASK DesiredAccess,
00119     IN PPRIVILEGE_SET CapturedPrivileges,
00120     IN BOOLEAN AccessGranted
00121     );
00122 
00123 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00124 <a class="code" href="../../d1/d5/adtp_8h.html#a20">SepAdtTraverseAuditAlarm</a>(
00125     IN PLUID OperationID,
00126     IN PVOID DirectoryObject,
00127     IN PSID UserSid,
00128     IN LUID AuthenticationId,
00129     IN ACCESS_MASK DesiredAccess,
00130     IN PPRIVILEGE_SET Privileges OPTIONAL,
00131     IN BOOLEAN AccessGranted,
00132     IN BOOLEAN GenerateAudit,
00133     IN BOOLEAN GenerateAlarm
00134     );
00135 
00136 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00137 <a class="code" href="../../d1/d5/adtp_8h.html#a21">SepAdtCreateInstanceAuditAlarm</a>(
00138     IN PLUID OperationID,
00139     IN PVOID Object,
00140     IN PSID UserSid,
00141     IN LUID AuthenticationId,
00142     IN ACCESS_MASK DesiredAccess,
00143     IN PPRIVILEGE_SET Privileges OPTIONAL,
00144     IN BOOLEAN AccessGranted,
00145     IN BOOLEAN GenerateAudit,
00146     IN BOOLEAN GenerateAlarm
00147     );
00148 
00149 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00150 <a class="code" href="../../d1/d5/adtp_8h.html#a22">SepAdtCreateObjectAuditAlarm</a>(
00151     IN PLUID OperationID,
00152     IN PUNICODE_STRING DirectoryName,
00153     IN PUNICODE_STRING ComponentName,
00154     IN PSID UserSid,
00155     IN LUID AuthenticationId,
00156     IN ACCESS_MASK DesiredAccess,
00157     IN BOOLEAN AccessGranted,
00158     IN BOOLEAN GenerateAudit,
00159     IN BOOLEAN GenerateAlarm
00160     );
00161 
00162 
00163 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00164 <a class="code" href="../../d7/d6/sepaudit_8c.html#a15">SepAdtHandleAuditAlarm</a>(
00165     IN PUNICODE_STRING Source,
00166     IN LUID OperationId,
00167     IN HANDLE <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a29">Handle</a>,
00168     IN PSID UserSid
00169     );
00170 
00171 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00172 <a class="code" href="../../d7/d6/sepaudit_8c.html#a10">SepAdtPrivilegedServiceAuditAlarm</a> (
00173     IN PUNICODE_STRING CapturedSubsystemName,
00174     IN PUNICODE_STRING CapturedServiceName,
00175     IN PTOKEN ClientToken OPTIONAL,
00176     IN PTOKEN PrimaryToken,
00177     IN PPRIVILEGE_SET CapturedPrivileges,
00178     IN BOOLEAN AccessGranted
00179     );
00180 
00181 
00182 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00183 <a class="code" href="../../d7/d6/sepaudit_8c.html#a13">SepAdtCloseObjectAuditAlarm</a>(
00184     IN PUNICODE_STRING CapturedSubsystemName,
00185     IN PVOID HandleId,
00186     IN PVOID Object,
00187     IN PSID UserSid,
00188     IN LUID AuthenticationId
00189     );
00190 
00191 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00192 <a class="code" href="../../d7/d6/sepaudit_8c.html#a14">SepAdtDeleteObjectAuditAlarm</a>(
00193     IN PUNICODE_STRING CapturedSubsystemName,
00194     IN PVOID HandleId,
00195     IN PVOID Object,
00196     IN PSID UserSid,
00197     IN LUID AuthenticationId
00198     );
00199 
00200 BOOLEAN
00201 <a class="code" href="../../d7/d6/sepaudit_8c.html#a11">SepAdtOpenObjectAuditAlarm</a> (
00202     IN PUNICODE_STRING CapturedSubsystemName,
00203     IN PVOID *HandleId OPTIONAL,
00204     IN PUNICODE_STRING CapturedObjectTypeName,
00205     IN PVOID Object OPTIONAL,
00206     IN PUNICODE_STRING CapturedObjectName OPTIONAL,
00207     IN PTOKEN ClientToken OPTIONAL,
00208     IN PTOKEN PrimaryToken,
00209     IN ACCESS_MASK DesiredAccess,
00210     IN ACCESS_MASK GrantedAccess,
00211     IN PLUID OperationId,
00212     IN PPRIVILEGE_SET CapturedPrivileges OPTIONAL,
00213     IN BOOLEAN ObjectCreated,
00214     IN BOOLEAN AccessGranted,
00215     IN BOOLEAN GenerateAudit,
00216     IN BOOLEAN GenerateAlarm,
00217     IN HANDLE ProcessID,
00218     IN POLICY_AUDIT_EVENT_TYPE AuditType,
00219     IN <a class="code" href="../../d7/d9/struct__IOBJECT__TYPE__LIST.html">PIOBJECT_TYPE_LIST</a> ObjectTypeList OPTIONAL,
00220     IN ULONG ObjectTypeListLength,
00221     IN PACCESS_MASK GrantedAccessArray OPTIONAL
00222     );
00223 
00224 BOOLEAN
00225 <a class="code" href="../../d7/d6/sepaudit_8c.html#a12">SepAdtOpenObjectForDeleteAuditAlarm</a>(
00226     IN PUNICODE_STRING CapturedSubsystemName,
00227     IN PVOID *HandleId,
00228     IN PUNICODE_STRING CapturedObjectTypeName,
00229     IN PVOID Object,
00230     IN PUNICODE_STRING CapturedObjectName,
00231     IN PTOKEN ClientToken OPTIONAL,
00232     IN PTOKEN PrimaryToken,
00233     IN ACCESS_MASK DesiredAccess,
00234     IN ACCESS_MASK GrantedAccess,
00235     IN PLUID OperationId,
00236     IN PPRIVILEGE_SET CapturedPrivileges OPTIONAL,
00237     IN BOOLEAN ObjectCreated,
00238     IN BOOLEAN AccessGranted,
00239     IN BOOLEAN GenerateAudit,
00240     IN BOOLEAN GenerateAlarm,
00241     IN HANDLE ProcessID
00242     );
00243 
00244 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00245 <a class="code" href="../../d7/d6/sepaudit_8c.html#a16">SepAdtObjectReferenceAuditAlarm</a>(
00246     IN PLUID OperationID OPTIONAL,
00247     IN PVOID Object,
00248     IN <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext,
00249     IN ACCESS_MASK DesiredAccess,
00250     IN PPRIVILEGE_SET Privileges OPTIONAL,
00251     IN BOOLEAN AccessGranted,
00252     IN BOOLEAN GenerateAudit,
00253     IN BOOLEAN GenerateAlarm
00254     );
00255 
00256 <span class="comment">//</span>
00257 <span class="comment">// BOOLEAN</span>
00258 <span class="comment">// SepAdtAuditThisEvent(</span>
00259 <span class="comment">//    IN POLICY_AUDIT_EVENT_TYPE AuditType,</span>
00260 <span class="comment">//    IN PBOOLEAN AccessGranted</span>
00261 <span class="comment">// );</span>
00262 <span class="comment">//</span>
00263 
<a name="l00264"></a><a class="code" href="../../d1/d5/adtp_8h.html#a1">00264</a> <span class="preprocessor">#define SepAdtAuditThisEvent(AuditType, AccessGranted)                  \</span>
00265 <span class="preprocessor">    (SepAdtAuditingEnabled &amp;&amp;                                           \</span>
00266 <span class="preprocessor">    ((SeAuditingState[AuditType].AuditOnSuccess &amp;&amp; *AccessGranted) ||   \</span>
00267 <span class="preprocessor">    (SeAuditingState[AuditType].AuditOnFailure &amp;&amp; !(*AccessGranted))))</span>
00268 <span class="preprocessor"></span>
<a name="l00269"></a><a class="code" href="../../d1/d5/adtp_8h.html#a2">00269</a> <span class="preprocessor">#define SepAdtAuditThisEventEx(AuditType, AccessGranted, AccessDenied ) \</span>
00270 <span class="preprocessor">    (SepAdtAuditingEnabled &amp;&amp;                                           \</span>
00271 <span class="preprocessor">    ((SeAuditingState[AuditType].AuditOnSuccess &amp;&amp; AccessGranted) ||    \</span>
00272 <span class="preprocessor">     (SeAuditingState[AuditType].AuditOnFailure &amp;&amp; AccessDenied)))</span>
00273 <span class="preprocessor"></span>
00274 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00275 <a class="code" href="../../d1/d5/adtp_8h.html#a30">SepAdtInitializeBounds</a>(
00276     VOID
00277     );
00278 
00279 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00280 <a class="code" href="../../d1/d5/adtp_8h.html#a31">SepAuditFailed</a>(
00281     VOID
00282     );
00283 
00284 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00285 <a class="code" href="../../d6/d6/sep_8h.html#a71">SepAdtInitializeCrashOnFail</a>(
00286     VOID
00287     );
00288 
00289 BOOLEAN
00290 <a class="code" href="../../d3/d5/seaudit_8c.html#a33">SepInitializePrivilegeFilter</a>(
00291     BOOLEAN Verbose
00292     );
00293 
00294 BOOLEAN
00295 <a class="code" href="../../d6/d6/sep_8h.html#a72">SepAdtInitializePrivilegeAuditing</a>(
00296     VOID
00297     );
00298 
00299 <span class="comment">// ----------------------------------------------------------------------</span>
00300 <span class="comment">// The following is used only temporarily for NT5.</span>
00301 <span class="comment">//</span>
00302 <span class="comment">// NT5 does not provide any facility to enable/disable auditing at</span>
00303 <span class="comment">// audit-event level. It only supports it at audit category level.</span>
00304 <span class="comment">// This creates problems if one wants to audit only certain specific</span>
00305 <span class="comment">// audit events of a category. The current design gives you all or none for</span>
00306 <span class="comment">// each category.</span>
00307 <span class="comment">//</span>
00308 <span class="comment">// Post NT5 auditing will provide a better/flexible design that wil address</span>
00309 <span class="comment">// this issue. For now, to delight some valuable customers, we provide this</span>
00310 <span class="comment">// hack / registry based solution. This solution will be removed post NT5.</span>
00311 <span class="comment">//</span>
00312 
00313 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00314 <a class="code" href="../../d1/d5/adtp_8h.html#a35">SepAdtInitializeAuditingOptions</a>(
00315     VOID
00316     );
00317 
<a name="l00318"></a><a class="code" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">00318</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">_SEP_AUDIT_OPTIONS</a>
00319 {
<a name="l00320"></a><a class="code" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html#o0">00320</a>     BOOLEAN <a class="code" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html#o0">DoNotAuditCloseObjectEvents</a>;
00321 } <a class="code" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">SEP_AUDIT_OPTIONS</a>;
00322 
<a name="l00323"></a><a class="code" href="../../d1/d5/adtp_8h.html#a14">00323</a> <span class="keyword">extern</span> <a class="code" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">SEP_AUDIT_OPTIONS</a> <a class="code" href="../../d1/d5/adtp_8h.html#a14">SepAuditOptions</a>;
00324 
00325 <span class="comment">// ----------------------------------------------------------------------</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:13 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
