<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ppc/exceptn.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>exceptn.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>
<code>#include "kxppc.h"</code><br>

<p>
<a href="../../d3/d8/ppc_2exceptn_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a0">_KXPPC_C_HEADER_</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a1">BREAK_INST</a>&nbsp;&nbsp;&nbsp;(TRAP_INSTR | TO_BREAKPOINT)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a2">DIVIDE_BREAKPOINT</a>&nbsp;&nbsp;&nbsp;(TRAP_INSTR | TO_DIVIDE_BY_ZERO)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a3">UDIVIDE_BREAKPOINT</a>&nbsp;&nbsp;&nbsp;(TRAP_INSTR | TO_UNCONDITIONAL_DIVIDE_BY_ZERO)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a4">KERNEL_BREAKPOINT_INSTRUCTION</a>&nbsp;&nbsp;&nbsp;(BREAK_INSTR | DEBUG_STOP_BREAKPOINT)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a5">KDDEBUG_BREAKPOINT</a>&nbsp;&nbsp;&nbsp;(BREAK_INSTR | BREAKIN_BREAKPOINT)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a8">KiEmulateDcbz</a> (IN OUT PEXCEPTION_RECORD ExceptionRecord, IN OUT PKEXCEPTION_FRAME ExceptionFrame, IN OUT PKTRAP_FRAME TrapFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a9">KeContextFromKframes</a> (IN PKTRAP_FRAME TrapFrame, IN PKEXCEPTION_FRAME ExceptionFrame, IN OUT PCONTEXT ContextFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a10">KeContextToKframes</a> (IN OUT PKTRAP_FRAME TrapFrame, IN OUT PKEXCEPTION_FRAME ExceptionFrame, IN PCONTEXT ContextFrame, IN ULONG ContextFlags, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a11">KiDispatchException</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PKEXCEPTION_FRAME ExceptionFrame, IN PKTRAP_FRAME TrapFrame, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode, IN BOOLEAN FirstChance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a12">KiCopyInformation</a> (IN OUT PEXCEPTION_RECORD ExceptionRecord1, IN PEXCEPTION_RECORD ExceptionRecord2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a13">KeRaiseUserException</a> (IN NTSTATUS ExceptionCode)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a6">KiEnableAlignmentFaultExceptions</a> = TRUE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a7">KiBreakPoints</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="ppc/exceptn.c::_KXPPC_C_HEADER_" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define _KXPPC_C_HEADER_          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00029">29</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ppc/exceptn.c::BREAK_INST" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define <a class="el" href="../../d0/d5/struct__BREAK__INST.html">BREAK_INST</a>&nbsp;&nbsp;&nbsp;(TRAP_INSTR | TO_BREAKPOINT)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00059">59</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ppc/exceptn.c::DIVIDE_BREAKPOINT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DIVIDE_BREAKPOINT&nbsp;&nbsp;&nbsp;(TRAP_INSTR | TO_DIVIDE_BY_ZERO)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00065">65</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ppc/exceptn.c::KDDEBUG_BREAKPOINT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KDDEBUG_BREAKPOINT&nbsp;&nbsp;&nbsp;(BREAK_INSTR | BREAKIN_BREAKPOINT)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00073">73</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ppc/exceptn.c::KERNEL_BREAKPOINT_INSTRUCTION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KERNEL_BREAKPOINT_INSTRUCTION&nbsp;&nbsp;&nbsp;(BREAK_INSTR | DEBUG_STOP_BREAKPOINT)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00072">72</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ppc/exceptn.c::UDIVIDE_BREAKPOINT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UDIVIDE_BREAKPOINT&nbsp;&nbsp;&nbsp;(TRAP_INSTR | TO_UNCONDITIONAL_DIVIDE_BY_ZERO)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00066">66</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00373">KiDispatchException()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a9" doxytag="ppc/exceptn.c::KeContextFromKframes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeContextFromKframes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00081">81</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00240">CONTEXT_CONTROL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00241">CONTEXT_FLOATING_POINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00242">CONTEXT_INTEGER</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, and <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00078">KiBreakPoints</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00457">Ke386SetIOPL()</a>, <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00412">KiDispatchException()</a>, <a class="el" href="../../d8/d6/alpha_2apcuser_8c-source.html#l00033">KiInitializeUserApc()</a>, <a class="el" href="../../d9/d5/alpha_2ipi_8c-source.html#l00081">KiSaveProcessorState()</a>, and <a class="el" href="../../d4/d9/psctx386_8c-source.html#l00046">PspGetContext()</a>.
<p>
<pre class="fragment"><div>00089                    :
00090 
00091     This routine moves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> selected contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified trap and exception frames
00092     frames into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context frame according to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context
00093     flags.
00094 
00095 Arguments:
00096 
00097     TrapFrame - Supplies a pointer to a trap frame from which <span class="keyword">volatile</span> context
00098         should be copied into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record.
00099 
00100     ExceptionFrame - Supplies a pointer to an exception frame from which context
00101         should be copied into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record.
00102 
00103     ContextFrame - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context frame that receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00104         context copied from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trap and exception frames.
00105 
00106 Return Value:
00107 
00108     None.
00109 
00110 --*/
00111 
00112 {
00113 
00114     <span class="comment">//</span>
00115     <span class="comment">// Set control information if specified.</span>
00116     <span class="comment">//</span>
00117 
00118     <span class="keywordflow">if</span> ((ContextFrame-&gt;ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) {
00119 
00120         <span class="comment">//</span>
00121         <span class="comment">// Set machine state, instr address, link, count registers</span>
00122         <span class="comment">//</span>
00123 
00124         ContextFrame-&gt;Msr = TrapFrame-&gt;Msr;
00125         ContextFrame-&gt;Iar = TrapFrame-&gt;Iar;
00126         ContextFrame-&gt;Lr  = TrapFrame-&gt;Lr;
00127         ContextFrame-&gt;Ctr = TrapFrame-&gt;Ctr;
00128     }
00129 
00130     <span class="comment">//</span>
00131     <span class="comment">// Set integer register contents if specified.</span>
00132     <span class="comment">//</span>
00133 
00134     <span class="keywordflow">if</span> ((ContextFrame-&gt;ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) {
00135 
00136         <span class="comment">//</span>
00137         <span class="comment">// Volatile integer regs in trap frame are 0..12</span>
00138         <span class="comment">//</span>
00139 
00140         RtlMoveMemory (&amp;ContextFrame-&gt;Gpr0, &amp;TrapFrame-&gt;Gpr0,
00141                        sizeof (ULONG) * 13);
00142 
00143         <span class="comment">//</span>
00144         <span class="comment">// Non-volatile integer regs in exception frame are 13..31</span>
00145         <span class="comment">//</span>
00146 
00147         RtlMoveMemory (&amp;ContextFrame-&gt;Gpr13, &amp;ExceptionFrame-&gt;Gpr13,
00148                        sizeof (ULONG) * 19);
00149 
00150         <span class="comment">//</span>
00151         <span class="comment">// The CR is made up of volatile and non-volatile fields,</span>
00152         <span class="comment">// but the entire CR is saved in the trap frame</span>
00153         <span class="comment">//</span>
00154 
00155         ContextFrame-&gt;Cr = TrapFrame-&gt;Cr;
00156 
00157         <span class="comment">//</span>
00158         <span class="comment">// Fixed Point Exception Register (XER) is part of the</span>
00159         <span class="comment">// integer state</span>
00160         <span class="comment">//</span>
00161 
00162         ContextFrame-&gt;Xer = TrapFrame-&gt;Xer;
00163     }
00164 
00165     <span class="comment">//</span>
00166     <span class="comment">// Set floating register contents if specified.</span>
00167     <span class="comment">//</span>
00168 
00169     <span class="keywordflow">if</span> ((ContextFrame-&gt;ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) {
00170 
00171         <span class="comment">//</span>
00172         <span class="comment">// Volatile floating point regs in trap frame are 0..13</span>
00173         <span class="comment">//</span>
00174 
00175         RtlMoveMemory(&amp;ContextFrame-&gt;Fpr0, &amp;TrapFrame-&gt;Fpr0,
00176                      <span class="keyword">sizeof</span>(DOUBLE) * (14));
00177 
00178         <span class="comment">//</span>
00179         <span class="comment">// Non-volatile floating point regs in exception frame are 14..31</span>
00180         <span class="comment">//</span>
00181 
00182         RtlMoveMemory(&amp;ContextFrame-&gt;Fpr14, &amp;ExceptionFrame-&gt;Fpr14,
00183                      <span class="keyword">sizeof</span>(DOUBLE) * (18));
00184 
00185         <span class="comment">//</span>
00186         <span class="comment">// Set floating point status and control register.</span>
00187         <span class="comment">//</span>
00188 
00189         ContextFrame-&gt;Fpscr = TrapFrame-&gt;Fpscr;
00190     }
00191 
00192     <span class="comment">//</span>
00193     <span class="comment">// Fetch Dr register contents if requested.  Values may be trash.</span>
00194     <span class="comment">//</span>
00195 
00196     <span class="keywordflow">if</span> ((ContextFrame-&gt;ContextFlags &amp; CONTEXT_DEBUG_REGISTERS) ==
00197         CONTEXT_DEBUG_REGISTERS) {
00198 
00199         ContextFrame-&gt;Dr0 = TrapFrame-&gt;Dr0;
00200         ContextFrame-&gt;Dr1 = TrapFrame-&gt;Dr1;
00201         ContextFrame-&gt;Dr2 = TrapFrame-&gt;Dr2;
00202         ContextFrame-&gt;Dr3 = TrapFrame-&gt;Dr3;
00203         ContextFrame-&gt;Dr6 = TrapFrame-&gt;Dr6;
00204         ContextFrame-&gt;Dr6 |= <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a7">KiBreakPoints</a>;
00205         ContextFrame-&gt;Dr5 = 0;            <span class="comment">// Zero initialize unused regs</span>
00206         ContextFrame-&gt;Dr4 = 0;
00207 
00208         <span class="comment">//</span>
00209         <span class="comment">// If it's a user mode frame, and the thread doesn't have DRs set,</span>
00210         <span class="comment">// and we just return the trash in the frame, we risk accidentally</span>
00211         <span class="comment">// making the thread active with trash values on a set.  Therefore,</span>
00212         <span class="comment">// Dr7 must be set to the number of available data address breakpoint</span>
00213         <span class="comment">// registers if we get a non-active user mode frame.</span>
00214         <span class="comment">//</span>
00215 
00216         <span class="keywordflow">if</span> (((TrapFrame-&gt;PreviousMode) != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp;
00217             (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;DebugActive)) {
00218 
00219             ContextFrame-&gt;Dr7 = TrapFrame-&gt;Dr7;
00220         } <span class="keywordflow">else</span> {
00221 
00222             ContextFrame-&gt;Dr7 = 0;
00223         }
00224     }
00225 
00226     <span class="keywordflow">return</span>;
00227 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ppc/exceptn.c::KeContextToKframes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeContextToKframes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00230">230</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00240">CONTEXT_CONTROL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00241">CONTEXT_FLOATING_POINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00242">CONTEXT_INTEGER</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00068">KeGetPcr</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00457">Ke386SetIOPL()</a>, <a class="el" href="../../d6/d3/raisexcp_8c-source.html#l00099">KiContinue()</a>, <a class="el" href="../../d6/d3/raisexcp_8c-source.html#l00037">KiContinuePreviousModeUser()</a>, <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00412">KiDispatchException()</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00057">KiInitializeContextThread()</a>, <a class="el" href="../../d6/d3/raisexcp_8c-source.html#l00208">KiRaiseException()</a>, <a class="el" href="../../d9/d5/alpha_2ipi_8c-source.html#l00031">KiRestoreProcessorState()</a>, and <a class="el" href="../../d4/d9/psctx386_8c-source.html#l00088">PspSetContext()</a>.
<p>
<pre class="fragment"><div>00240                    :
00241 
00242     This routine moves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> selected contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context frame into
00243     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified trap and exception frames according to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context
00244     flags.
00245 
00246 Arguments:
00247 
00248     TrapFrame - Supplies a pointer to a trap frame that receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">volatile</span>
00249         context from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record.
00250 
00251     ExceptionFrame - Supplies a pointer to an exception frame that receives
00252         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> nonvolatile context from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record.
00253 
00254     ContextFrame - Supplies a pointer to a context frame that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00255         context that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be copied into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trap and exception frames.
00256 
00257     ContextFlags - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> set of flags that specify which parts of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00258         context frame are to be copied into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trap and exception frames.
00259 
00260     PreviousMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode <span class="keywordflow">for</span> which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trap and exception
00261         frames are being built.
00262 
00263 Return Value:
00264 
00265     None.
00266 
00267 --*/
00268 
00269 {
00270 
00271     <span class="comment">//</span>
00272     <span class="comment">// Set control information if specified.</span>
00273     <span class="comment">//</span>
00274 
00275     <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>) {
00276 
00277         <span class="comment">//</span>
00278         <span class="comment">// Set instruction address, link, count, and machine state registers</span>
00279         <span class="comment">//</span>
00280 
00281         TrapFrame-&gt;Iar = ContextFrame-&gt;Iar;
00282         TrapFrame-&gt;Lr  = ContextFrame-&gt;Lr;
00283         TrapFrame-&gt;Ctr = ContextFrame-&gt;Ctr;
00284         TrapFrame-&gt;Msr = SANITIZE_MSR(ContextFrame-&gt;Msr, PreviousMode);
00285     }
00286 
00287     <span class="comment">//</span>
00288     <span class="comment">// Set integer registers contents if specified.</span>
00289     <span class="comment">//</span>
00290 
00291     <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a155">CONTEXT_INTEGER</a>) {
00292 
00293         <span class="comment">//</span>
00294         <span class="comment">// Volatile integer regs are 0..12</span>
00295         <span class="comment">//</span>
00296 
00297         RtlMoveMemory(&amp;TrapFrame-&gt;Gpr0, &amp;ContextFrame-&gt;Gpr0,
00298                      <span class="keyword">sizeof</span>(ULONG) * (13));
00299 
00300         <span class="comment">//</span>
00301         <span class="comment">// Non-volatile integer regs are 13..31</span>
00302         <span class="comment">//</span>
00303 
00304         RtlMoveMemory(&amp;ExceptionFrame-&gt;Gpr13, &amp;ContextFrame-&gt;Gpr13,
00305                      <span class="keyword">sizeof</span>(ULONG) * (19));
00306 
00307         <span class="comment">//</span>
00308         <span class="comment">// Copy the Condition Reg and Fixed Point Exception Reg</span>
00309         <span class="comment">//</span>
00310 
00311         TrapFrame-&gt;Cr = ContextFrame-&gt;Cr;
00312         TrapFrame-&gt;Xer = ContextFrame-&gt;Xer;
00313     }
00314 
00315     <span class="comment">//</span>
00316     <span class="comment">// Set floating register contents if specified.</span>
00317     <span class="comment">//</span>
00318 
00319     <span class="keywordflow">if</span> ((ContextFlags &amp; <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>) {
00320 
00321         <span class="comment">//</span>
00322         <span class="comment">// Volatile floating point regs are 0..13</span>
00323         <span class="comment">//</span>
00324 
00325         RtlMoveMemory(&amp;TrapFrame-&gt;Fpr0, &amp;ContextFrame-&gt;Fpr0,
00326                      <span class="keyword">sizeof</span>(DOUBLE) * (14));
00327 
00328         <span class="comment">//</span>
00329         <span class="comment">// Non-volatile floating point regs are 14..31</span>
00330         <span class="comment">//</span>
00331 
00332         RtlMoveMemory(&amp;ExceptionFrame-&gt;Fpr14, &amp;ContextFrame-&gt;Fpr14,
00333                      <span class="keyword">sizeof</span>(DOUBLE) * (18));
00334 
00335         <span class="comment">//</span>
00336         <span class="comment">// Set floating point status and control register.</span>
00337         <span class="comment">//</span>
00338 
00339         TrapFrame-&gt;Fpscr = SANITIZE_FPSCR(ContextFrame-&gt;Fpscr, PreviousMode);
00340     }
00341 
00342     <span class="comment">//</span>
00343     <span class="comment">// Set debug register state if specified.  If previous mode is user</span>
00344     <span class="comment">// mode (i.e. it's a user frame we're setting) and if effect will be to</span>
00345     <span class="comment">// cause at least one of the debug register enable bits in Dr7</span>
00346     <span class="comment">// to be set then set DebugActive to the enable bit mask.</span>
00347     <span class="comment">//</span>
00348 
00349     <span class="keywordflow">if</span> ((ContextFlags &amp; CONTEXT_DEBUG_REGISTERS) == CONTEXT_DEBUG_REGISTERS) {
00350 
00351         <span class="comment">//</span>
00352         <span class="comment">// Set the debug control register for the 601 and 604</span>
00353         <span class="comment">// indicating the number of address breakpoints supported.</span>
00354         <span class="comment">//</span>
00355 
00356         TrapFrame-&gt;Dr0 = SANITIZE_DRADDR(ContextFrame-&gt;Dr0, PreviousMode);
00357         TrapFrame-&gt;Dr1 = SANITIZE_DRADDR(ContextFrame-&gt;Dr1, PreviousMode);
00358         TrapFrame-&gt;Dr2 = SANITIZE_DRADDR(ContextFrame-&gt;Dr2, PreviousMode);
00359         TrapFrame-&gt;Dr3 = SANITIZE_DRADDR(ContextFrame-&gt;Dr3, PreviousMode);
00360         TrapFrame-&gt;Dr6 = SANITIZE_DR6(ContextFrame-&gt;Dr6, PreviousMode);
00361         TrapFrame-&gt;Dr7 = SANITIZE_DR7(ContextFrame-&gt;Dr7, PreviousMode);
00362 
00363         <span class="keywordflow">if</span> (PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00364               <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a1">KeGetPcr</a>()-&gt;DebugActive = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;DebugActive =
00365                                         (UCHAR)(TrapFrame-&gt;Dr7 &amp; DR7_ACTIVE);
00366         }
00367     }
00368 
00369     <span class="keywordflow">return</span>;
00370 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ppc/exceptn.c::KeRaiseUserException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS KeRaiseUserException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NTSTATUS&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ExceptionCode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00925">925</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02811">KeRaiseUserExceptionDispatcher</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, and <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>.
<p>
<pre class="fragment"><div>00931                    :
00932 
00933     This function causes an exception to be raised in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling thread's user-mode
00934     context. It does <span class="keyword">this</span> by editing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trap frame <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel was entered with to
00935     point to trampoline code that raises <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested exception.
00936 
00937 Arguments:
00938 
00939     ExceptionCode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status value to be used as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00940         code <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be raised.
00941 
00942 Return Value:
00943 
00944     The status value that should be returned by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.
00945 
00946 --*/
00947 
00948 {
00949     PKTRAP_FRAME TrapFrame;
00950     PULONG FnDesc;
00951 
00952     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetPreviousMode() == UserMode);
00953 
00954     TrapFrame = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;TrapFrame;
00955     FnDesc = (PULONG)<a class="code" href="../../d4/d9/ke_8h.html#a151">KeRaiseUserExceptionDispatcher</a>;
00956 
00957     TrapFrame-&gt;Iar = FnDesc[0];
00958     TrapFrame-&gt;Gpr2 = FnDesc[1];
00959 
00960     <span class="keywordflow">return</span>(ExceptionCode);
00961 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ppc/exceptn.c::KiCopyInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KiCopyInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00886">886</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">Ki386CheckDelayedNpxTrap()</a>, <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00412">KiDispatchException()</a>, <a class="el" href="../../d3/d1/byteem_8c-source.html#l00049">KiEmulateByteWord()</a>, <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00754">KiEmulateDcbz()</a>, <a class="el" href="../../d2/d3/alpha_2floatem_8c-source.html#l00296">KiEmulateFloating()</a>, <a class="el" href="../../d5/d4/alpha_2alignem_8c-source.html#l00160">KiEmulateReference()</a>, and <a class="el" href="../../d8/d6/alpha_2apcuser_8c-source.html#l00033">KiInitializeUserApc()</a>.
<p>
<pre class="fragment"><div>00893                    :
00894 
00895     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called from an exception filter to copy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00896     information from one exception record to another when an exception occurs.
00897 
00898 Arguments:
00899 
00900     ExceptionRecord1 - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> destination exception record.
00901 
00902     ExceptionRecord2 - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source exception record.
00903 
00904 Return Value:
00905 
00906     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00907 
00908 --*/
00909 
00910 {
00911 
00912     <span class="comment">//</span>
00913     <span class="comment">// Copy one exception record to another and return value that causes</span>
00914     <span class="comment">// an exception handler to be executed.</span>
00915     <span class="comment">//</span>
00916 
00917     RtlMoveMemory((PVOID)ExceptionRecord1,
00918                   (PVOID)ExceptionRecord2,
00919                   <span class="keyword">sizeof</span>(EXCEPTION_RECORD));
00920 
00921     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>;
00922 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ppc/exceptn.c::KiDispatchException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiDispatchException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>FirstChance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00373">373</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00239">CONTEXT_FULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00014">DATA_BUS_ERROR</a>, <a class="el" href="../../d7/d2/dbgkport_8c-source.html#l00099">DbgkForwardException()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d2/d8/mips_2exceptn_8c-source.html#l00036">DIVIDE_BREAKPOINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d8/mips_2exceptn_8c-source.html#l00035">KDDEBUG_BREAKPOINT</a>, <a class="el" href="../../d4/d8/4_2ia64_2kdtrap_8c-source.html#l00329">KdIsThisAKdTrap()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00081">KeContextFromKframes()</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00230">KeContextToKframes()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d2/d8/mips_2exceptn_8c-source.html#l00044">KERNEL_BREAKPOINT_INSTRUCTION</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02810">KeUserExceptionDispatcher</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00886">KiCopyInformation()</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00437">KiDebugRoutine</a>, <a class="el" href="../../d3/d1/byteem_8c-source.html#l00049">KiEmulateByteWord()</a>, <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00754">KiEmulateDcbz()</a>, <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00255">KiEmulateReference()</a>, <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00077">KiEnableAlignmentFaultExceptions</a>, <a class="el" href="../../d9/d4/trigger_8c-source.html#l00079">KiFloatingException()</a>, <a class="el" href="../../d1/d1/alpha_2buserror_8c-source.html#l00031">KiMachineCheck()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00025">KMODE_EXCEPTION_NOT_HANDLED</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d4/probe_8c-source.html#l00034">ProbeForWrite()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00098">RtlDispatchException()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00066">UDIVIDE_BREAKPOINT</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">Ki386CheckDelayedNpxTrap()</a>, <a class="el" href="../../d8/d6/alpha_2apcuser_8c-source.html#l00033">KiInitializeUserApc()</a>, and <a class="el" href="../../d6/d3/raisexcp_8c-source.html#l00208">KiRaiseException()</a>.
<p>
<pre class="fragment"><div>00383                    :
00384 
00385     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to dispatch an exception to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> proper mode and
00386     to cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception dispatcher to be called.
00387 
00388     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a data misalignment, <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first chance <span class="keywordflow">for</span>
00389     handling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread has enabled automatic
00390     alignment fixup, then an attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to emulate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unaligned
00391     reference.
00392 
00393     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a floating exception (N.B. the pseudo status
00394     STATUS_FLOAT_STACK_CHECK is used to signify <span class="keyword">this</span>), we convert <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00395     exception code to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> correct STATUS based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> FPSCR.
00396     It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> up to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handler to figure <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> what to <span class="keywordflow">do</span> to emulate/repair
00397     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation.
00398 
00399     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> neither a data misalignment nor a floating point
00400     exception and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00401     dispatcher <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called directly to process <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception. Otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00402     exception record, exception frame, and trap frame contents are copied
00403     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user mode stack. The contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception frame and trap
00404     are then modified such that when <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned, execution will
00405     commence in user mode in a routine which will call <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00406     dispatcher.
00407 
00408 Arguments:
00409 
00410     ExceptionRecord - Supplies a pointer to an exception record.
00411 
00412     ExceptionFrame - Supplies a pointer to an exception frame.
00413 
00414     TrapFrame - Supplies a pointer to a trap frame.
00415 
00416     PreviousMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous processor mode.
00417 
00418     FirstChance - Supplies a <span class="keywordtype">boolean</span> variable that specifies whether <span class="keyword">this</span>
00419         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first (TRUE) or second (FALSE) time that this exception has
00420         been processed.
00421 
00422 Return Value:
00423 
00424     None.
00425 
00426 --*/
00427 
00428 {
00429 
00430     CONTEXT ContextFrame;
00431     EXCEPTION_RECORD ExceptionRecord1;
00432     LONG Length;
00433     BOOLEAN UserApcPending;
00434 
00435     <span class="comment">//</span>
00436     <span class="comment">// If the exception is a data misalignment, this is the first chance for</span>
00437     <span class="comment">// handling the exception, and the current thread has enabled automatic</span>
00438     <span class="comment">// alignment fixup, then attempt to emulate the unaligned reference.</span>
00439     <span class="comment">//</span>
00440     <span class="comment">// We always emulate dcbz, even if the thread hasn't enabled automatic</span>
00441     <span class="comment">// alignment fixup.  This is because the hardware declares an alignment</span>
00442     <span class="comment">// fault if dcbz is attempted on noncached memory.</span>
00443     <span class="comment">//</span>
00444 
00445     <span class="keywordflow">if</span> (ExceptionRecord-&gt;ExceptionCode == STATUS_DATATYPE_MISALIGNMENT) {
00446         <span class="keywordflow">if</span> (FirstChance != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00447 
00448             <span class="comment">//</span>
00449             <span class="comment">// If alignment fault exceptions are not enabled, then no exception</span>
00450             <span class="comment">// should be raised and the data reference should be emulated.</span>
00451             <span class="comment">//</span>
00452 
00453             <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d8/alpha_2exceptn_8c.html#a1">KiEnableAlignmentFaultExceptions</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) ||
00454                 (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;AutoAlignment != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) ||
00455                 (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;AutoAlignment != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00456                 <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5/ppc_2alignem_8c.html#a18">KiEmulateReference</a>(ExceptionRecord, ExceptionFrame, TrapFrame) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00457                     <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;KeAlignmentFixupCount += 1;
00458                     <span class="keywordflow">goto</span> Handled2;
00459                 }
00460             } <span class="keywordflow">else</span> {
00461                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a8">KiEmulateDcbz</a>(ExceptionRecord, ExceptionFrame, TrapFrame) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00462                     <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;KeAlignmentFixupCount += 1;
00463                     <span class="keywordflow">goto</span> Handled2;
00464                 }
00465             }
00466         }
00467     }
00468 
00469     <span class="comment">//</span>
00470     <span class="comment">// If the exception is a breakpoint, then translate it to an appropriate</span>
00471     <span class="comment">// exception code if it is a division by zero or an integer overflow</span>
00472     <span class="comment">// caused by multiplication.</span>
00473     <span class="comment">//</span>
00474 
00475     <span class="keywordflow">if</span> (ExceptionRecord-&gt;ExceptionCode == STATUS_BREAKPOINT) {
00476 
00477         ULONG Instr = ExceptionRecord-&gt;ExceptionInformation[0];
00478 
00479         <span class="keywordflow">if</span> ((Instr &amp; 0xffe0ffff) == <a class="code" href="../../d1/d9/mips_2exceptn_8c.html#a2">DIVIDE_BREAKPOINT</a> ||
00480             (Instr &amp; 0xffe0ffff) == <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a3">UDIVIDE_BREAKPOINT</a>) {
00481             ExceptionRecord-&gt;ExceptionCode = STATUS_INTEGER_DIVIDE_BY_ZERO;
00482         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Instr == <a class="code" href="../../d1/d9/mips_2exceptn_8c.html#a1">KDDEBUG_BREAKPOINT</a>) {
00483             TrapFrame-&gt;Iar += 4;
00484         }
00485     }
00486 
00487     <span class="comment">//</span>
00488     <span class="comment">// If the exception is a floating point exception, then the</span>
00489     <span class="comment">// ExceptionCode was set to STATUS_FLOAT_STACK_CHECK.  We now sort</span>
00490     <span class="comment">// that out and set a more correct STATUS code.  We clear the</span>
00491     <span class="comment">// exception enable bit in the FPSCR of the exception being reported</span>
00492     <span class="comment">// to eliminate floating point exception recursion.</span>
00493     <span class="comment">//</span>
00494 
00495     <span class="keywordflow">if</span> (ExceptionRecord-&gt;ExceptionCode == STATUS_FLOAT_STACK_CHECK) {
00496 
00497         PFPSCR Fpscr = (PFPSCR)(&amp;TrapFrame-&gt;Fpscr);
00498 
00499         <span class="keywordflow">if</span> ((Fpscr-&gt;XE == 1) &amp;&amp; (Fpscr-&gt;XX == 1)) {
00500 
00501             ExceptionRecord-&gt;ExceptionCode = STATUS_FLOAT_INEXACT_RESULT;
00502             Fpscr-&gt;XE = 0;
00503 
00504         }
00505         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Fpscr-&gt;ZE == 1) &amp;&amp; (Fpscr-&gt;ZX == 1)) {
00506 
00507             ExceptionRecord-&gt;ExceptionCode = STATUS_FLOAT_DIVIDE_BY_ZERO;
00508             Fpscr-&gt;ZE = 0;
00509 
00510         }
00511         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Fpscr-&gt;UE == 1) &amp;&amp; (Fpscr-&gt;UX == 1)) {
00512 
00513             ExceptionRecord-&gt;ExceptionCode = STATUS_FLOAT_UNDERFLOW;
00514             Fpscr-&gt;UE = 0;
00515 
00516         }
00517 
00518         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Fpscr-&gt;OE == 1) &amp;&amp; (Fpscr-&gt;OX == 1)) {
00519 
00520             ExceptionRecord-&gt;ExceptionCode = STATUS_FLOAT_OVERFLOW;
00521             Fpscr-&gt;OE = 0;
00522 
00523         }
00524         <span class="keywordflow">else</span> {
00525 
00526             <span class="comment">// Must be some form of Invalid Operation</span>
00527 
00528             ExceptionRecord-&gt;ExceptionCode = STATUS_FLOAT_INVALID_OPERATION;
00529             Fpscr-&gt;VE = 0;
00530         }
00531     }
00532 
00533     <span class="comment">//</span>
00534     <span class="comment">// Move machine state from trap and exception frames to a context frame,</span>
00535     <span class="comment">// and increment the number of exceptions dispatched.</span>
00536     <span class="comment">//</span>
00537 
00538     ContextFrame.ContextFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a152">CONTEXT_FULL</a> | CONTEXT_DEBUG_REGISTERS;
00539     <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a9">KeContextFromKframes</a>(TrapFrame, ExceptionFrame, &amp;ContextFrame);
00540     <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;KeExceptionDispatchCount += 1;
00541 
00542     <span class="comment">//</span>
00543     <span class="comment">// Select the method of handling the exception based on the previous mode.</span>
00544     <span class="comment">//</span>
00545 
00546     <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00547 
00548         <span class="comment">//</span>
00549         <span class="comment">// Previous mode was kernel.</span>
00550         <span class="comment">//</span>
00551         <span class="comment">// If this is the first chance, the kernel debugger is active, and</span>
00552         <span class="comment">// the exception is a kernel breakpoint, then give the kernel debugger</span>
00553         <span class="comment">// a chance to handle the exception.</span>
00554         <span class="comment">//</span>
00555         <span class="comment">// If this is the first chance and the kernel debugger is not active</span>
00556         <span class="comment">// or does not handle the exception, then attempt to find a frame</span>
00557         <span class="comment">// handler to handle the exception.</span>
00558         <span class="comment">//</span>
00559         <span class="comment">// If this is the second chance or the exception is not handled, then</span>
00560         <span class="comment">// if the kernel debugger is active, then give the kernel debugger a</span>
00561         <span class="comment">// second chance to handle the exception. If the kernel debugger does</span>
00562         <span class="comment">// not handle the exception, then bug check.</span>
00563         <span class="comment">//</span>
00564 
00565         <span class="keywordflow">if</span> (FirstChance != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00566 
00567             <span class="comment">//</span>
00568             <span class="comment">// If the kernel debugger is active, the exception is a breakpoint,</span>
00569             <span class="comment">// and the breakpoint is handled by the kernel debugger, then give</span>
00570             <span class="comment">// the kernel debugger a chance to handle the exception.</span>
00571             <span class="comment">//</span>
00572 
00573             <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00574                ((ExceptionRecord-&gt;ExceptionCode == STATUS_BREAKPOINT) ||
00575                 (ExceptionRecord-&gt;ExceptionCode == STATUS_SINGLE_STEP))  &amp;&amp;
00576                (<a class="code" href="../../d3/d9/4_2ia64_2kdtrap_8c.html#a1">KdIsThisAKdTrap</a>(ExceptionRecord,
00577                                 &amp;ContextFrame,
00578                                 KernelMode) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00579 
00580                 <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a>) (TrapFrame,
00581                                        ExceptionFrame,
00582                                        ExceptionRecord,
00583                                        &amp;ContextFrame,
00584                                        <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>,
00585                                        <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00586 
00587                     <span class="keywordflow">goto</span> Handled1;
00588                 }
00589             }
00590 
00591             <span class="comment">//</span>
00592             <span class="comment">// This is the first chance to handle the exception.</span>
00593             <span class="comment">//</span>
00594 
00595             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a7">RtlDispatchException</a>(ExceptionRecord, &amp;ContextFrame) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00596                 <span class="keywordflow">goto</span> Handled1;
00597             }
00598         }
00599 
00600         <span class="comment">//</span>
00601         <span class="comment">// This is the second chance to handle the exception.</span>
00602         <span class="comment">//</span>
00603 
00604         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00605             <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a>) (TrapFrame,
00606                                    ExceptionFrame,
00607                                    ExceptionRecord,
00608                                    &amp;ContextFrame,
00609                                    PreviousMode,
00610                                    <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00611                 <span class="keywordflow">goto</span> Handled1;
00612             }
00613         }
00614 
00615         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(KMODE_EXCEPTION_NOT_HANDLED,
00616                      ExceptionRecord-&gt;ExceptionCode,
00617                      (ULONG)ExceptionRecord-&gt;ExceptionAddress,
00618                      ExceptionRecord-&gt;ExceptionInformation[0],
00619                      ExceptionRecord-&gt;ExceptionInformation[1]);
00620 
00621     } <span class="keywordflow">else</span> {
00622 
00623         <span class="comment">//</span>
00624         <span class="comment">// Previous mode was user.</span>
00625         <span class="comment">//</span>
00626         <span class="comment">// If this is the first chance, the kernel debugger is active, the</span>
00627         <span class="comment">// exception is a kernel breakpoint, and the current process is not</span>
00628         <span class="comment">// being debugged, or the current process is being debugged, but the</span>
00629         <span class="comment">// the breakpoint is not a kernel breakpoint instruction, then give</span>
00630         <span class="comment">// the kernel debugger a chance to handle the exception.</span>
00631         <span class="comment">//</span>
00632         <span class="comment">// If this is the first chance and the current process has a debugger</span>
00633         <span class="comment">// port, then send a message to the debugger port and wait for a reply.</span>
00634         <span class="comment">// If the debugger handles the exception, then continue execution. Else</span>
00635         <span class="comment">// transfer the exception information to the user stack, transition to</span>
00636         <span class="comment">// user mode, and attempt to dispatch the exception to a frame based</span>
00637         <span class="comment">// handler. If a frame based handler handles the exception, then continue</span>
00638         <span class="comment">// execution. Otherwise, execute the raise exception system service</span>
00639         <span class="comment">// which will call this routine a second time to process the exception.</span>
00640         <span class="comment">//</span>
00641         <span class="comment">// If this is the second chance and the current process has a debugger</span>
00642         <span class="comment">// port, then send a message to the debugger port and wait for a reply.</span>
00643         <span class="comment">// If the debugger handles the exception, then continue execution. Else</span>
00644         <span class="comment">// if the current process has a subsystem port, then send a message to</span>
00645         <span class="comment">// the subsystem port and wait for a reply. If the subsystem handles the</span>
00646         <span class="comment">// exception, then continue execution. Else terminate the thread.</span>
00647         <span class="comment">//</span>
00648 
00649         <span class="keywordflow">if</span> (FirstChance != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00650 
00651             <span class="comment">//</span>
00652             <span class="comment">// If the kernel debugger is active, the exception is a kernel</span>
00653             <span class="comment">// breakpoint, and the current process is not being debugged,</span>
00654             <span class="comment">// or the current process is being debugged, but the breakpoint</span>
00655             <span class="comment">// is not a kernel breakpoint instruction, then give the kernel</span>
00656             <span class="comment">// debugger a chance to handle the exception.</span>
00657             <span class="comment">//</span>
00658 
00659             <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00660                 ((ExceptionRecord-&gt;ExceptionCode == STATUS_BREAKPOINT) ||
00661                 (ExceptionRecord-&gt;ExceptionCode == STATUS_SINGLE_STEP)) &amp;&amp;
00662                 (<a class="code" href="../../d3/d9/4_2ia64_2kdtrap_8c.html#a1">KdIsThisAKdTrap</a>(ExceptionRecord,
00663                                 &amp;ContextFrame,
00664                                 UserMode) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp;
00665                ((<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;DebugPort == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00666                ((<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;DebugPort != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00667                (ExceptionRecord-&gt;ExceptionInformation[0] !=
00668                                             <a class="code" href="../../d1/d9/mips_2exceptn_8c.html#a5">KERNEL_BREAKPOINT_INSTRUCTION</a>)))) {
00669 
00670                <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a>) (TrapFrame,
00671                                       ExceptionFrame,
00672                                       ExceptionRecord,
00673                                       &amp;ContextFrame,
00674                                       <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>,
00675                                       <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00676 
00677                     <span class="keywordflow">goto</span> Handled1;
00678                 }
00679             }
00680 
00681             <span class="comment">//</span>
00682             <span class="comment">// This is the first chance to handle the exception.</span>
00683             <span class="comment">//</span>
00684 
00685             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d3/dbgk_8h.html#a5">DbgkForwardException</a>(ExceptionRecord, TRUE, FALSE)) {
00686                 TrapFrame-&gt;Fpscr = SANITIZE_FPSCR(TrapFrame-&gt;Fpscr, UserMode);
00687                 <span class="keywordflow">goto</span> Handled2;
00688             }
00689 
00690             <span class="comment">//</span>
00691             <span class="comment">// Transfer exception information to the user stack, transition</span>
00692             <span class="comment">// to user mode, and attempt to dispatch the exception to a frame</span>
00693             <span class="comment">// based handler.</span>
00694             <span class="comment">//</span>
00695             <span class="comment">// We are running on the kernel stack now.  On the user stack, we</span>
00696             <span class="comment">// build a stack frame containing the following:</span>
00697             <span class="comment">//</span>
00698             <span class="comment">//               |                                   |</span>
00699             <span class="comment">//               |-----------------------------------|</span>
00700             <span class="comment">//               |                                   |</span>
00701             <span class="comment">//               |   Stack frame header              |</span>
00702             <span class="comment">//               |                                   |</span>
00703             <span class="comment">//               |- - - - - - - - - - - - - - - - - -|</span>
00704             <span class="comment">//               |                                   |</span>
00705             <span class="comment">//               |   Exception record                |</span>
00706             <span class="comment">//               |                                   |</span>
00707             <span class="comment">//               |- - - - - - - - - - - - - - - - - -|</span>
00708             <span class="comment">//               |                                   |</span>
00709             <span class="comment">//               |   Context record                  |</span>
00710             <span class="comment">//               |                                   |</span>
00711             <span class="comment">//               |                                   |</span>
00712             <span class="comment">//               |                                   |</span>
00713             <span class="comment">//               |- - - - - - - - - - - - - - - - - -|</span>
00714             <span class="comment">//               |   Saved TOC for backtrack         |</span>
00715             <span class="comment">//               |- - - - - - - - - - - - - - - - - -|</span>
00716             <span class="comment">//               |                                   |</span>
00717             <span class="comment">//               |                                   |</span>
00718             <span class="comment">//               |   STK_SLACK_SPACE                 |</span>
00719             <span class="comment">//               |                                   |</span>
00720             <span class="comment">//               |                                   |</span>
00721             <span class="comment">//               |                                   |</span>
00722             <span class="comment">//               |- - - - - - - - - - - - - - - - - -|</span>
00723             <span class="comment">//               |                                   |</span>
00724             <span class="comment">//               |   User's stack frame              |</span>
00725             <span class="comment">//               |                                   |</span>
00726             <span class="comment">//               |                                   |</span>
00727             <span class="comment">//</span>
00728             <span class="comment">// This stack frame is for KiUserExceptionDispatcher, the assembly</span>
00729             <span class="comment">// langauge routine that effects transfer in user mode to</span>
00730             <span class="comment">// RtlDispatchException.  KiUserExceptionDispatcher is passed</span>
00731             <span class="comment">// pointers to the Exception Record and Context Record as</span>
00732             <span class="comment">// parameters.</span>
00733 
00734         repeat:
00735             <span class="keywordflow">try</span> {
00736 
00737                 <span class="comment">//</span>
00738                 <span class="comment">// Compute positions on user stack of items shown above</span>
00739                 <span class="comment">//</span>
00740 
00741                 ULONG Length = (<span class="keyword">sizeof</span> (STACK_FRAME_HEADER) + <span class="keyword">sizeof</span> (EXCEPTION_RECORD) +
00742                                 <span class="keyword">sizeof</span> (CONTEXT) + <span class="keyword">sizeof</span> (ULONG) + STK_SLACK_SPACE + 7) &amp; (~7);
00743 
00744                 ULONG UserStack = (ContextFrame.Gpr1 &amp; (~7)) - Length;
00745                 ULONG ExceptSlot = UserStack + <span class="keyword">sizeof</span> (STACK_FRAME_HEADER);
00746                 ULONG ContextSlot = ExceptSlot + <span class="keyword">sizeof</span> (EXCEPTION_RECORD);
00747                 ULONG TocSlot = ContextSlot + <span class="keyword">sizeof</span> (CONTEXT);
00748 
00749                 <span class="comment">//</span>
00750                 <span class="comment">// Probe user stack area for writeability and then transfer the</span>
00751                 <span class="comment">// exception record and context record to the user stack area.</span>
00752                 <span class="comment">//</span>
00753 
00754                 <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>((PCHAR) UserStack, ContextFrame.Gpr1 - UserStack, <span class="keyword">sizeof</span>(QUAD));
00755                 RtlMoveMemory((PVOID) ExceptSlot, ExceptionRecord, <span class="keyword">sizeof</span> (EXCEPTION_RECORD));
00756                 RtlMoveMemory((PVOID) ContextSlot, &amp;ContextFrame, <span class="keyword">sizeof</span> (CONTEXT));
00757 
00758                 <span class="comment">//</span>
00759                 <span class="comment">// Fill in TOC value as if it had been saved by prologue to</span>
00760                 <span class="comment">// KiUserExceptionDispatcher</span>
00761                 <span class="comment">//</span>
00762 
00763                 *((PULONG) TocSlot) = ContextFrame.Gpr2;
00764 
00765                 <span class="comment">//</span>
00766                 <span class="comment">// Set back chain from newly-constructed stack frame</span>
00767                 <span class="comment">//</span>
00768 
00769                 *((PULONG) UserStack) = ContextFrame.Gpr1;
00770 
00771                 <span class="comment">//</span>
00772                 <span class="comment">// Set address of exception record, context record,</span>
00773                 <span class="comment">// and the new stack pointer in the current trap frame.</span>
00774                 <span class="comment">//</span>
00775 
00776                 TrapFrame-&gt;Gpr1 = UserStack;        <span class="comment">// Stack pointer</span>
00777                 TrapFrame-&gt;Gpr3 = ExceptSlot;       <span class="comment">// First parameter</span>
00778                 TrapFrame-&gt;Gpr4 = ContextSlot;      <span class="comment">// Second parameter</span>
00779 
00780                 <span class="comment">//</span>
00781                 <span class="comment">// Sanitize the floating status register so a recursive</span>
00782                 <span class="comment">// exception will not occur.</span>
00783                 <span class="comment">//</span>
00784 
00785                 TrapFrame-&gt;Fpscr = SANITIZE_FPSCR(ContextFrame.Fpscr, UserMode);
00786 
00787                 <span class="comment">//</span>
00788                 <span class="comment">// Set the execution address and TOC pointer of the exception</span>
00789                 <span class="comment">// routine that will call the exception dispatcher and then return</span>
00790                 <span class="comment">// to the trap handler.  The trap handler will restore the exception</span>
00791                 <span class="comment">// and trap frame context and continue execution in the routine</span>
00792                 <span class="comment">// that will call the exception dispatcher.</span>
00793                 <span class="comment">//</span>
00794 
00795                 {
00796                     PULONG FnDesc = (PULONG) <a class="code" href="../../d4/d9/ke_8h.html#a150">KeUserExceptionDispatcher</a>;
00797                     TrapFrame-&gt;Iar = FnDesc[0];
00798                     TrapFrame-&gt;Gpr2 = FnDesc[1];
00799                 }
00800 
00801                 <span class="keywordflow">return</span>;
00802 
00803             <span class="comment">//</span>
00804             <span class="comment">// If an exception occurs, then copy the new exception information</span>
00805             <span class="comment">// to an exception record and handle the exception.</span>
00806             <span class="comment">//</span>
00807 
00808             } except (<a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a12">KiCopyInformation</a>(&amp;ExceptionRecord1,
00809                                (GetExceptionInformation())-&gt;ExceptionRecord)) {
00810 
00811                 <span class="comment">//</span>
00812                 <span class="comment">// If the exception is a stack overflow, then attempt</span>
00813                 <span class="comment">// to raise the stack overflow exception. Otherwise,</span>
00814                 <span class="comment">// the user's stack is not accessible, or is misaligned,</span>
00815                 <span class="comment">// and second chance processing is performed.</span>
00816                 <span class="comment">//</span>
00817 
00818                 <span class="keywordflow">if</span> (ExceptionRecord1.ExceptionCode == STATUS_STACK_OVERFLOW) {
00819                     ExceptionRecord1.ExceptionAddress = ExceptionRecord-&gt;ExceptionAddress;
00820                     RtlMoveMemory((PVOID)ExceptionRecord,
00821                                   &amp;ExceptionRecord1, <span class="keyword">sizeof</span>(EXCEPTION_RECORD));
00822                     <span class="keywordflow">goto</span> repeat;
00823                 }
00824             }
00825         }
00826 
00827         <span class="comment">//</span>
00828         <span class="comment">// This is the second chance to handle the exception.</span>
00829         <span class="comment">//</span>
00830 
00831         UserApcPending = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.UserApcPending;
00832         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d3/dbgk_8h.html#a5">DbgkForwardException</a>(ExceptionRecord, TRUE, TRUE)) {
00833             TrapFrame-&gt;Fpscr = SANITIZE_FPSCR(TrapFrame-&gt;Fpscr, UserMode);
00834             <span class="keywordflow">goto</span> Handled2;
00835 
00836         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/d3/dbgk_8h.html#a5">DbgkForwardException</a>(ExceptionRecord, FALSE, TRUE)) {
00837             <span class="comment">//</span>
00838             <span class="comment">// If a user APC was not previously pending and one is now</span>
00839             <span class="comment">// pending, then the thread has been terminated and the PC</span>
00840             <span class="comment">// must be forced to a legal address so an infinite loop does</span>
00841             <span class="comment">// not occur for the case where a jump to an unmapped address</span>
00842             <span class="comment">// occurred.</span>
00843             <span class="comment">//</span>
00844 
00845             <span class="keywordflow">if</span> ((UserApcPending == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp;
00846                 (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.UserApcPending != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00847 <span class="comment">// TEMPORARY .... PAT</span>
00848 <span class="comment">// Commenting out reference to USPCR (a known legal address ..</span>
00849 <span class="comment">//              TrapFrame-&gt;Iar = (ULONG)USPCR;</span>
00850             }
00851 
00852             TrapFrame-&gt;Fpscr = SANITIZE_FPSCR(TrapFrame-&gt;Fpscr, UserMode);
00853             <span class="keywordflow">goto</span> Handled2;
00854 
00855         } <span class="keywordflow">else</span> {
00856             ZwTerminateProcess(NtCurrentProcess(), ExceptionRecord-&gt;ExceptionCode);
00857             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(KMODE_EXCEPTION_NOT_HANDLED,
00858                          ExceptionRecord-&gt;ExceptionCode,
00859                          (ULONG)ExceptionRecord-&gt;ExceptionAddress,
00860                          ExceptionRecord-&gt;ExceptionInformation[0],
00861                          ExceptionRecord-&gt;ExceptionInformation[1]);
00862         }
00863     }
00864 
00865     <span class="comment">//</span>
00866     <span class="comment">// Move machine state from context frame to trap and exception frames and</span>
00867     <span class="comment">// then return to continue execution with the restored state.</span>
00868     <span class="comment">//</span>
00869 
00870 Handled1:
00871     <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a10">KeContextToKframes</a>(TrapFrame, ExceptionFrame, &amp;ContextFrame,
00872                        ContextFrame.ContextFlags, PreviousMode);
00873 
00874     <span class="comment">//</span>
00875     <span class="comment">// Exception was handled by the debugger or the associated subsystem</span>
00876     <span class="comment">// and state was modified, if necessary, using the get state and set</span>
00877     <span class="comment">// state capabilities. Therefore the context frame does not need to</span>
00878     <span class="comment">// be transfered to the trap and exception frames.</span>
00879     <span class="comment">//</span>
00880 
00881 Handled2:
00882     <span class="keywordflow">return</span>;
00883 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ppc/exceptn.c::KiEmulateDcbz" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiEmulateDcbz           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00754">754</a> of file <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html">ppc/alignem.c</a>.
<p>
References <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00121">AlFault</a>, <a class="el" href="../../d1/d2/ppc_8h-source.html#l01882">_DSISR::DataReg</a>, <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00118">DCBZ_INDEX_VALUE</a>, <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00102">_ALFAULT::Escape</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d2/ppc_8h-source.html#l01883">_DSISR::Index</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00886">KiCopyInformation()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00096">_ALFAULT::Valid</a>.
<p>
Referenced by <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00373">KiDispatchException()</a>.
<p>
<pre class="fragment"><div>00762                    :
00763 
00764     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to emulate a Data Cache Block <a class="code" href="../../d6/d6/ttime_8c.html#a0">Zero</a> instruction.
00765     The PowerPC hardware will raise an alignment exception <span class="keywordflow">if</span> a DCBZ <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00766     attempted on non-cached memory.   We need to emulate <span class="keyword">this</span> even in kernel
00767     mode so we can debug h/w problems by disabling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data cache.
00768 
00769 Arguments:
00770 
00771     ExceptionRecord - Supplies a pointer to an exception record.
00772 
00773     ExceptionFrame - Supplies a pointer to an exception frame.
00774 
00775     TrapFrame - Supplies a pointer to a trap frame.
00776 
00777 Return Value:
00778 
00779     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data reference <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successfully
00780     emulated. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00781 
00782 --*/
00783 
00784 {
00785 
00786     PUCHAR DataAddress;
00787     PVOID ExceptionAddress;
00788     <a class="code" href="../../d7/d9/struct__DSISR.html">DSISR</a> DsisrValue;
00789     ULONG TableIndex;
00790     ULONG DataRegNum;
00791     <a class="code" href="../../d0/d6/struct__ALFAULT.html">ALFAULT</a> Info;
00792 
00793     <span class="comment">//</span>
00794     <span class="comment">// Save the original exception address in case another exception</span>
00795     <span class="comment">// occurs.</span>
00796     <span class="comment">//</span>
00797 
00798     ExceptionAddress = ExceptionRecord-&gt;ExceptionAddress;
00799 
00800     <span class="comment">//</span>
00801     <span class="comment">// Any exception that occurs during the attempted emulation of the</span>
00802     <span class="comment">// unaligned reference causes the emulation to be aborted. The new</span>
00803     <span class="comment">// exception code and information is copied to the original exception</span>
00804     <span class="comment">// record and a value of FALSE is returned.</span>
00805     <span class="comment">//</span>
00806 
00807     <span class="keywordflow">try</span> {
00808 
00809         <span class="comment">//</span>
00810         <span class="comment">// The effective address of the reference from the DAR was saved</span>
00811         <span class="comment">// in the exception record. Check to make sure it is within the</span>
00812         <span class="comment">// user part of the address space. Alignment exceptions take</span>
00813         <span class="comment">// precedence over memory management exceptions (this is true</span>
00814         <span class="comment">// for PowerPC as well as MIPS) and the address could be a</span>
00815         <span class="comment">// system address.</span>
00816         <span class="comment">//</span>
00817 
00818         DataAddress = (PUCHAR) (ExceptionRecord-&gt;ExceptionInformation[1]);
00819 
00820         <span class="comment">//</span>
00821         <span class="comment">// Get information about the failing instruction from saved DSISR.</span>
00822         <span class="comment">//</span>
00823 
00824         DsisrValue = *(<a class="code" href="../../d7/d9/struct__DSISR.html">DSISR</a>*) &amp;(ExceptionRecord-&gt;ExceptionInformation[2]);
00825         TableIndex = DsisrValue.<a class="code" href="../../d7/d9/struct__DSISR.html#o2">Index</a>;
00826         DataRegNum = DsisrValue.<a class="code" href="../../d7/d9/struct__DSISR.html#o1">DataReg</a>;
00827         Info = <a class="code" href="../../d7/d5/ppc_2alignem_8c.html#a15">AlFault</a>[TableIndex];
00828 
00829         <span class="comment">//</span>
00830         <span class="comment">// If table entry is valid and does not indicate special processing</span>
00831         <span class="comment">// needed, and is a DCBZ instruction, emulate the execution of the </span>
00832         <span class="comment">// instruction</span>
00833         <span class="comment">//</span>
00834 
00835         <span class="keywordflow">if</span> (Info.<a class="code" href="../../d0/d6/struct__ALFAULT.html#o0">Valid</a> &amp;&amp; Info.<a class="code" href="../../d0/d6/struct__ALFAULT.html#o6">Escape</a> &amp;&amp; (TableIndex == <a class="code" href="../../d7/d5/ppc_2alignem_8c.html#a11">DCBZ_INDEX_VALUE</a>)) {
00836 
00837             <span class="comment">//</span>
00838             <span class="comment">// Data Cache Block Zero</span>
00839             <span class="comment">//</span>
00840             <span class="comment">//   A data cache block is 32 bytes long, we emulate this</span>
00841             <span class="comment">//   instruction by storing 8 zero integers a the address</span>
00842             <span class="comment">//   specified.</span>
00843             <span class="comment">//</span>
00844             <span class="comment">//   Note, dcbz zeros the block "containing" the address</span>
00845             <span class="comment">//   so we round down first.</span>
00846             <span class="comment">//</span>
00847 
00848             PULONG DcbAddress = (PULONG)((ULONG)DataAddress &amp; ~0x1f);
00849 
00850             *DcbAddress++ = 0;
00851             *DcbAddress++ = 0;
00852             *DcbAddress++ = 0;
00853             *DcbAddress++ = 0;
00854             *DcbAddress++ = 0;
00855             *DcbAddress++ = 0;
00856             *DcbAddress++ = 0;
00857             *DcbAddress++ = 0;
00858 
00859             <span class="comment">//</span>
00860             <span class="comment">// Bump instruction address to next instruction.</span>
00861             <span class="comment">//</span>
00862 
00863             TrapFrame-&gt;Iar += 4;
00864 
00865             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00866         }
00867 
00868     <span class="comment">//</span>
00869     <span class="comment">// If an exception occurs, then copy the new exception information to the</span>
00870     <span class="comment">// original exception record and handle the exception.</span>
00871     <span class="comment">//</span>
00872 
00873     } except (<a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a12">KiCopyInformation</a>(ExceptionRecord,
00874                                (GetExceptionInformation())-&gt;ExceptionRecord)) {
00875 
00876         <span class="comment">//</span>
00877         <span class="comment">// Preserve the original exception address.</span>
00878         <span class="comment">//</span>
00879 
00880         ExceptionRecord-&gt;ExceptionAddress = ExceptionAddress;
00881     }
00882 
00883     <span class="comment">//</span>
00884     <span class="comment">// Return a value of FALSE.</span>
00885     <span class="comment">//</span>
00886 
00887     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00888 }
}
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a7" doxytag="ppc/exceptn.c::KiBreakPoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d7/d0/psctxppc_8c.html#a1">KiBreakPoints</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00078">78</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00081">KeContextFromKframes()</a>, and <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00031">PspGetContext()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ppc/exceptn.c::KiEnableAlignmentFaultExceptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d2/d9/ppc_2exceptn_8c.html#a6">KiEnableAlignmentFaultExceptions</a> = TRUE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00053">53</a> of file <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html">ppc/exceptn.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:35 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
