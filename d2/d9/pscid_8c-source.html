<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: pscid.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>pscid.c</h1><a href="../../d1/d0/pscid_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">/*++</span>
00003 <span class="comment"></span>
00004 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00005 <span class="comment"></span>
00006 <span class="comment">Module Name:</span>
00007 <span class="comment"></span>
00008 <span class="comment">    pscid.c</span>
00009 <span class="comment"></span>
00010 <span class="comment">Abstract:</span>
00011 <span class="comment"></span>
00012 <span class="comment">    This module implements the Client ID related services.</span>
00013 <span class="comment"></span>
00014 <span class="comment"></span>
00015 <span class="comment">Author:</span>
00016 <span class="comment"></span>
00017 <span class="comment">    Mark Lucovsky (markl) 25-Apr-1989</span>
00018 <span class="comment">    Jim Kelly (JimK) 2-August-1990</span>
00019 <span class="comment"></span>
00020 <span class="comment">Revision History:</span>
00021 <span class="comment"></span>
00022 <span class="comment">--*/</span>
00023 
00024 <span class="preprocessor">#include "<a class="code" href="../../d8/d1/psp_8h.html">psp.h</a>"</span>
00025 
00026 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00027"></a><a class="code" href="../../d1/d0/pscid_8c.html#a0">00027</a> <a class="code" href="../../d1/d0/pscid_8c.html#a0">PsLookupProcessThreadByCid</a>(
00028     IN PCLIENT_ID Cid,
00029     OUT <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> *Process OPTIONAL,
00030     OUT <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> *Thread
00031     )
00032 
00033 <span class="comment">/*++</span>
00034 <span class="comment"></span>
00035 <span class="comment">Routine Description:</span>
00036 <span class="comment"></span>
00037 <span class="comment">    This function accepts The Client ID of a thread, and returns a</span>
00038 <span class="comment">    referenced pointer to the thread, and possibly a referenced pointer</span>
00039 <span class="comment">    to the process.</span>
00040 <span class="comment"></span>
00041 <span class="comment">Arguments:</span>
00042 <span class="comment"></span>
00043 <span class="comment">    Cid - Specifies the Client ID of the thread.</span>
00044 <span class="comment"></span>
00045 <span class="comment">    Process - If specified, returns a referenced pointer to the process</span>
00046 <span class="comment">        specified in the Cid.</span>
00047 <span class="comment"></span>
00048 <span class="comment">    Thread - Returns a referenced pointer to the thread specified in the</span>
00049 <span class="comment">        Cid.</span>
00050 <span class="comment"></span>
00051 <span class="comment">Return Value:</span>
00052 <span class="comment"></span>
00053 <span class="comment">    STATUS_SUCCESS - A process and thread were located based on the contents</span>
00054 <span class="comment">        of the Cid.</span>
00055 <span class="comment"></span>
00056 <span class="comment">    STATUS_INVALID_CID - The specified Cid is invalid.</span>
00057 <span class="comment"></span>
00058 <span class="comment">--*/</span>
00059 
00060 {
00061 
00062     <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a> CidEntry;
00063     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> lThread;
00064     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00065 
00066     CidEntry = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>(<a class="code" href="../../d6/d8/sysinfo_8c.html#a1">PspCidTable</a>, Cid-&gt;UniqueThread);
00067     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_CID;
00068     <span class="keywordflow">if</span> (CidEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00069         lThread = (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)CidEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o0">Object</a>;
00070         <span class="keywordflow">if</span> ((lThread != (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)<a class="code" href="../../d1/d9/ps_8h.html#a0">PSP_INVALID_ID</a>) &amp;&amp;
00071             (
00072              lThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o0">Type</a> == <a class="code" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a> &amp;&amp;
00073              lThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueProcess == Cid-&gt;UniqueProcess &amp;&amp;
00074              lThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o27">GrantedAccess</a>
00075             ) ) {
00076             <span class="keywordflow">if</span> (ARGUMENT_PRESENT(Process)) {
00077                 *Process = <a class="code" href="../../d1/d9/ps_8h.html#a17">THREAD_TO_PROCESS</a>(lThread);
00078                 <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(*Process);
00079             }
00080 
00081             <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(lThread);
00082             *Thread = lThread;
00083             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00084         }
00085 
00086         <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a>(<a class="code" href="../../d6/d8/sysinfo_8c.html#a1">PspCidTable</a>, CidEntry);
00087     }
00088 
00089     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00090 }
00091 
00092 
00093 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00094"></a><a class="code" href="../../d1/d0/pscid_8c.html#a1">00094</a> <a class="code" href="../../d1/d0/pscid_8c.html#a1">PsLookupProcessByProcessId</a>(
00095     IN HANDLE ProcessId,
00096     OUT <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> *Process
00097     )
00098 
00099 <span class="comment">/*++</span>
00100 <span class="comment"></span>
00101 <span class="comment">Routine Description:</span>
00102 <span class="comment"></span>
00103 <span class="comment">    This function accepts the process id of a process and returns a</span>
00104 <span class="comment">    referenced pointer to the process.</span>
00105 <span class="comment"></span>
00106 <span class="comment">Arguments:</span>
00107 <span class="comment"></span>
00108 <span class="comment">    ProcessId - Specifies the Process ID of the process.</span>
00109 <span class="comment"></span>
00110 <span class="comment">    Process - Returns a referenced pointer to the process specified by the</span>
00111 <span class="comment">        process id.</span>
00112 <span class="comment"></span>
00113 <span class="comment">Return Value:</span>
00114 <span class="comment"></span>
00115 <span class="comment">    STATUS_SUCCESS - A process was located based on the contents of</span>
00116 <span class="comment">        the process id.</span>
00117 <span class="comment"></span>
00118 <span class="comment">    STATUS_INVALID_PARAMETER - The process was not found.</span>
00119 <span class="comment"></span>
00120 <span class="comment">--*/</span>
00121 
00122 {
00123 
00124     <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a> CidEntry;
00125     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> lProcess;
00126     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00127 
00128     CidEntry = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>(<a class="code" href="../../d6/d8/sysinfo_8c.html#a1">PspCidTable</a>, ProcessId);
00129     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00130     <span class="keywordflow">if</span> (CidEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00131         lProcess = (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)CidEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o0">Object</a>;
00132         <span class="keywordflow">if</span> (lProcess != (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d1/d9/ps_8h.html#a0">PSP_INVALID_ID</a> &amp;&amp; lProcess-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o0">Pcb</a>.<a class="code" href="../../d5/d7/struct__KPROCESS.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o0">Type</a> == <a class="code" href="../../d4/d9/ke_8h.html#a402a160">ProcessObject</a> &amp;&amp; lProcess-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o54">GrantedAccess</a> ) {
00133             <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(lProcess);
00134             *Process = lProcess;
00135             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00136         }
00137 
00138         <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a>(<a class="code" href="../../d6/d8/sysinfo_8c.html#a1">PspCidTable</a>, CidEntry);
00139     }
00140 
00141     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00142 }
00143 
00144 
00145 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00146"></a><a class="code" href="../../d1/d0/pscid_8c.html#a2">00146</a> <a class="code" href="../../d1/d0/pscid_8c.html#a2">PsLookupThreadByThreadId</a>(
00147     IN HANDLE ThreadId,
00148     OUT <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> *Thread
00149     )
00150 
00151 <span class="comment">/*++</span>
00152 <span class="comment"></span>
00153 <span class="comment">Routine Description:</span>
00154 <span class="comment"></span>
00155 <span class="comment">    This function accepts the thread id of a thread and returns a</span>
00156 <span class="comment">    referenced pointer to the thread.</span>
00157 <span class="comment"></span>
00158 <span class="comment">Arguments:</span>
00159 <span class="comment"></span>
00160 <span class="comment">    ThreadId - Specifies the Thread ID of the thread.</span>
00161 <span class="comment"></span>
00162 <span class="comment">    Thread - Returns a referenced pointer to the thread specified by the</span>
00163 <span class="comment">        thread id.</span>
00164 <span class="comment"></span>
00165 <span class="comment">Return Value:</span>
00166 <span class="comment"></span>
00167 <span class="comment">    STATUS_SUCCESS - A thread was located based on the contents of</span>
00168 <span class="comment">        the thread id.</span>
00169 <span class="comment"></span>
00170 <span class="comment">    STATUS_INVALID_PARAMETER - The thread was not found.</span>
00171 <span class="comment"></span>
00172 <span class="comment">--*/</span>
00173 
00174 {
00175 
00176     <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a> CidEntry;
00177     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> lThread;
00178     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00179 
00180     CidEntry = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>(<a class="code" href="../../d6/d8/sysinfo_8c.html#a1">PspCidTable</a>, ThreadId);
00181     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00182     <span class="keywordflow">if</span> (CidEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00183         lThread = (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)CidEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o0">Object</a>;
00184         <span class="keywordflow">if</span> (lThread != (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)<a class="code" href="../../d1/d9/ps_8h.html#a0">PSP_INVALID_ID</a> &amp;&amp; lThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o0">Type</a> == <a class="code" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a> &amp;&amp; lThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o27">GrantedAccess</a> ) {
00185 
00186             <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(lThread);
00187             *Thread = lThread;
00188             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00189         }
00190 
00191         <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a>(<a class="code" href="../../d6/d8/sysinfo_8c.html#a1">PspCidTable</a>, CidEntry);
00192     }
00193 
00194     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00195 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:31 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
