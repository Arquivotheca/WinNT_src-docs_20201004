<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rmp.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>rmp.h</h1><a href="../../d1/d0/rmp_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    rmp.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Security Reference Monitor Private Data Types, Functions and Defines</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Scott Birrell       (ScottBi)       March 12, 1991</span>
00016 <span class="comment"></span>
00017 <span class="comment">Environment:</span>
00018 <span class="comment"></span>
00019 <span class="comment">Revision History:</span>
00020 <span class="comment"></span>
00021 <span class="comment">--*/</span>
00022 
00023 <span class="preprocessor">#include &lt;nt.h&gt;</span>
00024 <span class="preprocessor">#include &lt;ntlsa.h&gt;</span>
00025 <span class="preprocessor">#include "<a class="code" href="../../d6/d6/sep_8h.html">sep.h</a>"</span>
00026 
00027 
00029 <span class="comment">//                                                                           //</span>
00030 <span class="comment">//  Reference Monitor Private defines                                        //</span>
00031 <span class="comment">//                                                                           //</span>
00033 <span class="comment"></span>
00034 
00035 <span class="comment">//</span>
00036 <span class="comment">// Used to define the bounds of the array used to track logon session</span>
00037 <span class="comment">// reference counts.</span>
00038 <span class="comment">//</span>
00039 
<a name="l00040"></a><a class="code" href="../../d1/d0/rmp_8h.html#a0">00040</a> <span class="preprocessor">#define SEP_LOGON_TRACK_INDEX_MASK (0x0000000FL)</span>
<a name="l00041"></a><a class="code" href="../../d1/d0/rmp_8h.html#a1">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define SEP_LOGON_TRACK_ARRAY_SIZE (0x00000010L)</span>
00042 <span class="preprocessor"></span>
00043 
00044 
00045 
00046 
00048 <span class="comment">//                                                                           //</span>
00049 <span class="comment">//  Reference Monitor Private Macros                                         //</span>
00050 <span class="comment">//                                                                           //</span>
00052 <span class="comment"></span>
00053 <span class="comment">//</span>
00054 <span class="comment">//  acquire exclusive access to a token</span>
00055 <span class="comment">//</span>
00056 
<a name="l00057"></a><a class="code" href="../../d1/d0/rmp_8h.html#a2">00057</a> <span class="preprocessor">#define SepRmAcquireDbReadLock()  KeEnterCriticalRegion();         \</span>
00058 <span class="preprocessor">                                  ExAcquireResourceShared(&amp;SepRmDbLock, TRUE)</span>
00059 <span class="preprocessor"></span>
<a name="l00060"></a><a class="code" href="../../d1/d0/rmp_8h.html#a3">00060</a> <span class="preprocessor">#define SepRmAcquireDbWriteLock() KeEnterCriticalRegion();         \</span>
00061 <span class="preprocessor">                                  ExAcquireResourceExclusive(&amp;SepRmDbLock, TRUE)</span>
00062 <span class="preprocessor"></span>
<a name="l00063"></a><a class="code" href="../../d1/d0/rmp_8h.html#a4">00063</a> <span class="preprocessor">#define SepRmReleaseDbReadLock()  ExReleaseResource(&amp;SepRmDbLock); \</span>
00064 <span class="preprocessor">                                  KeLeaveCriticalRegion()</span>
00065 <span class="preprocessor"></span>
<a name="l00066"></a><a class="code" href="../../d1/d0/rmp_8h.html#a5">00066</a> <span class="preprocessor">#define SepRmReleaseDbWriteLock() ExReleaseResource(&amp;SepRmDbLock); \</span>
00067 <span class="preprocessor">                                  KeLeaveCriticalRegion()</span>
00068 <span class="preprocessor"></span>
00069 
00071 <span class="comment">//                                                                           //</span>
00072 <span class="comment">//  Reference Monitor Private Data Types                                     //</span>
00073 <span class="comment">//                                                                           //</span>
00075 <span class="comment"></span>
<a name="l00076"></a><a class="code" href="../../d1/d0/rmp_8h.html#a6">00076</a> <span class="preprocessor">#define SEP_RM_LSA_SHARED_MEMORY_SIZE ((ULONG) PAGE_SIZE)</span>
00077 <span class="preprocessor"></span>
00078 <span class="comment">//</span>
00079 <span class="comment">// Reference Monitor Private Global State Data Structure</span>
00080 <span class="comment">//</span>
00081 
<a name="l00082"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html">00082</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html">_SEP_RM_STATE</a> {
00083 
<a name="l00084"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o0">00084</a>     HANDLE <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o0">LsaInitEventHandle</a>;
<a name="l00085"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o1">00085</a>     HANDLE <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o1">LsaCommandPortHandle</a>;
<a name="l00086"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o2">00086</a>     HANDLE <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o2">SepRmThreadHandle</a>;
<a name="l00087"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o3">00087</a>     HANDLE <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o3">RmCommandPortHandle</a>;
<a name="l00088"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o4">00088</a>     ULONG <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o4">AuditingEnabled</a>;
<a name="l00089"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o5">00089</a>     LSA_OPERATIONAL_MODE <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o5">OperationalMode</a>;
<a name="l00090"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o6">00090</a>     HANDLE <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o6">LsaCommandPortSectionHandle</a>;
<a name="l00091"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o7">00091</a>     LARGE_INTEGER <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o7">LsaCommandPortSectionSize</a>;
<a name="l00092"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o8">00092</a>     PVOID <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o8">LsaViewPortMemory</a>;
<a name="l00093"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o9">00093</a>     PVOID <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o9">RmViewPortMemory</a>;
<a name="l00094"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o10">00094</a>     LONG <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o10">LsaCommandPortMemoryDelta</a>;
<a name="l00095"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o11">00095</a>     BOOLEAN <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o11">LsaCommandPortResourceInitialized</a>;
<a name="l00096"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o12">00096</a>     BOOLEAN <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o12">LsaCommandPortActive</a>;
<a name="l00097"></a><a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o13">00097</a>     <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o13">LsaCommandPortResource</a>;
00098 
00099 } <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html">SEP_RM_STATE</a>, *<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html">PSEP_RM_STATE</a>;
00100 
00101 <span class="comment">//</span>
00102 <span class="comment">// Reference Monitor Command Port Connection Info</span>
00103 <span class="comment">//</span>
00104 
<a name="l00105"></a><a class="code" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">00105</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">_SEP_RM_CONNECT_INFO</a> {
<a name="l00106"></a><a class="code" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html#o0">00106</a>     ULONG <a class="code" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html#o0">ConnectInfo</a>;
00107 } <a class="code" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">SEP_RM_CONNECT_INFO</a>;
00108 
<a name="l00109"></a><a class="code" href="../../d1/d0/rmp_8h.html#a12">00109</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">SEP_RM_CONNECT_INFO</a> *<a class="code" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">PSEP_RM_CONNECT_INFO</a>;
00110 
00111 
00112 <span class="comment">//</span>
00113 <span class="comment">// Reference Monitor Command Table Entry Format</span>
00114 <span class="comment">//</span>
00115 
<a name="l00116"></a><a class="code" href="../../d1/d0/rmp_8h.html#a7">00116</a> <span class="preprocessor">#define SEP_RM_COMMAND_MAX 4</span>
00117 <span class="preprocessor"></span>
<a name="l00118"></a><a class="code" href="../../d1/d0/rmp_8h.html#a13">00118</a> <span class="keyword">typedef</span> <a class="code" href="../../d0/d6/iop_8h.html#a145">VOID</a> (*SEP_RM_COMMAND_WORKER)( PRM_COMMAND_MESSAGE, PRM_REPLY_MESSAGE );
00119 
00120 
00121 
00122 <span class="comment">//</span>
00123 <span class="comment">// Each logon session active in the system has a corresponding record of</span>
00124 <span class="comment">// the following type...</span>
00125 <span class="comment">//</span>
00126 
<a name="l00127"></a><a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">00127</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">_SEP_LOGON_SESSION_REFERENCES</a> {
<a name="l00128"></a><a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">00128</a>     <span class="keyword">struct </span><a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">_SEP_LOGON_SESSION_REFERENCES</a> *<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
<a name="l00129"></a><a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o1">00129</a>     LUID <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o1">LogonId</a>;
<a name="l00130"></a><a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o2">00130</a>     ULONG <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o2">ReferenceCount</a>;
<a name="l00131"></a><a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o3">00131</a>     ULONG <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o3">Flags</a>;
00132 } <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">SEP_LOGON_SESSION_REFERENCES</a>, *<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a>;
00133 
<a name="l00134"></a><a class="code" href="../../d1/d0/rmp_8h.html#a8">00134</a> <span class="preprocessor">#define SEP_TERMINATION_NOTIFY  0x1</span>
00135 <span class="preprocessor"></span>
00136 <span class="comment">//</span>
00137 <span class="comment">// File systems interested in being notified when a logon session is being</span>
00138 <span class="comment">// terminated register a callback routine. The following data structure</span>
00139 <span class="comment">// describes the callback routines.</span>
00140 <span class="comment">//</span>
00141 <span class="comment">// The global list of callback routines is pointed to by SeFileSystemNotifyRoutines.</span>
00142 <span class="comment">// This list is protected by the RM database lock.</span>
00143 <span class="comment">//</span>
00144 
<a name="l00145"></a><a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">00145</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">_SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a> {
<a name="l00146"></a><a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o0">00146</a>     <span class="keyword">struct </span><a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">_SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a> *<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o0">Next</a>;
<a name="l00147"></a><a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o1">00147</a>     <a class="code" href="../../d0/d5/se_8h.html#a35">PSE_LOGON_SESSION_TERMINATED_ROUTINE</a> <a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o1">CallbackRoutine</a>;
00148 } <a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a>, *<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">PSEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a>;
00149 
00150 <span class="keyword">extern</span> <a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a>
<a name="l00151"></a><a class="code" href="../../d1/d0/rmp_8h.html#a18">00151</a> <a class="code" href="../../d9/d9/rmlogon_8c.html#a1">SeFileSystemNotifyRoutinesHead</a>;
00152 
00153 
00155 <span class="comment">//                                                                           //</span>
00156 <span class="comment">//  Reference Monitor Private Function Prototypes                            //</span>
00157 <span class="comment">//                                                                           //</span>
00159 <span class="comment"></span>
00160 BOOLEAN
00161 <a class="code" href="../../d2/d0/rmvars_8c.html#a4">SepRmDbInitialization</a>(
00162     VOID
00163     );
00164 
00165 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00166 <a class="code" href="../../d1/d0/rmp_8h.html#a24">SepRmCommandServerThread</a>(
00167     IN PVOID StartContext
00168     );
00169 
00170 BOOLEAN <a class="code" href="../../d1/d0/rmp_8h.html#a25">SepRmCommandServerThreadInit</a>(
00171     );
00172 
00173 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00174 <a class="code" href="../../d1/d0/rmp_8h.html#a26">SepRmComponentTestCommandWrkr</a>(
00175     IN PRM_COMMAND_MESSAGE CommandMessage,
00176     OUT PRM_REPLY_MESSAGE ReplyMessage
00177     );
00178 
00179 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00180 <a class="code" href="../../d1/d0/rmp_8h.html#a27">SepRmSetAuditEventWrkr</a>(
00181     IN PRM_COMMAND_MESSAGE CommandMessage,
00182     OUT PRM_REPLY_MESSAGE ReplyMessage
00183     );
00184 
00185 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00186 <a class="code" href="../../d1/d0/rmp_8h.html#a28">SepRmSendCommandToLsaWrkr</a>(
00187     IN PRM_COMMAND_MESSAGE CommandMessage,
00188     OUT PRM_REPLY_MESSAGE ReplyMessage
00189     );
00190 
00191 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00192 <a class="code" href="../../d1/d0/rmp_8h.html#a29">SepRmCreateLogonSessionWrkr</a>(
00193     IN PRM_COMMAND_MESSAGE CommandMessage,
00194     OUT PRM_REPLY_MESSAGE ReplyMessage
00195     );
00196 
00197 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00198 <a class="code" href="../../d1/d0/rmp_8h.html#a30">SepRmDeleteLogonSessionWrkr</a>(
00199     IN PRM_COMMAND_MESSAGE CommandMessage,
00200     OUT PRM_REPLY_MESSAGE ReplyMessage
00201     ) ;
00202 
00203 
00204 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00205 <a class="code" href="../../d1/d0/rmp_8h.html#a31">SepCreateLogonSessionTrack</a>(
00206     IN PLUID LogonId
00207     );
00208 
00209 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00210 <a class="code" href="../../d1/d0/rmp_8h.html#a32">SepDeleteLogonSessionTrack</a>(
00211     IN PLUID LogonId
00212     );
00213 
00214 
00215 
00216 
00217 
00218 
00220 <span class="comment">//                                                                           //</span>
00221 <span class="comment">// Reference Monitor Private Variables Declarations                          //</span>
00222 <span class="comment">// These variables are defined in rmvars.c                                   //</span>
00223 <span class="comment">//                                                                           //</span>
00225 <span class="comment"></span>
<a name="l00226"></a><a class="code" href="../../d1/d0/rmp_8h.html#a19">00226</a> <span class="keyword">extern</span> <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> <a class="code" href="../../d1/d0/rmp_8h.html#a19">SepRmLsaCallProcess</a>;
<a name="l00227"></a><a class="code" href="../../d1/d0/rmp_8h.html#a20">00227</a> <span class="keyword">extern</span> <a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html">SEP_RM_STATE</a> <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>;
<a name="l00228"></a><a class="code" href="../../d1/d0/rmp_8h.html#a21">00228</a> <span class="keyword">extern</span> <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d1/d0/rmp_8h.html#a21">SepRmDbLock</a>;
<a name="l00229"></a><a class="code" href="../../d1/d0/rmp_8h.html#a22">00229</a> <span class="keyword">extern</span> <a class="code" href="../../d1/d0/rmp_8h.html#a15">PSEP_LOGON_SESSION_REFERENCES</a> *<a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a>;
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:40 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
