<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: cmchek.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cmchek.c</h1><a href="../../d1/d0/cmchek_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    cmchek.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implements consistency checking for the registry.</span>
00012 <span class="comment">    This module can be linked standalone, cmchek2.c cannot.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Bryan M. Willman (bryanwi) 27-Jan-92</span>
00017 <span class="comment"></span>
00018 <span class="comment">Environment:</span>
00019 <span class="comment"></span>
00020 <span class="comment"></span>
00021 <span class="comment">Revision History:</span>
00022 <span class="comment"></span>
00023 <span class="comment">--*/</span>
00024 
00025 <span class="preprocessor">#include    "<a class="code" href="../../d1/d2/cmp_8h.html">cmp.h</a>"</span>
00026 
<a name="l00027"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a0">00027</a> <span class="preprocessor">#define     REG_MAX_PLAUSIBLE_KEY_SIZE \</span>
00028 <span class="preprocessor">                ((FIELD_OFFSET(CM_KEY_NODE, Name)) + \</span>
00029 <span class="preprocessor">                 (sizeof(WCHAR) * MAX_KEY_NAME_LENGTH) + 16)</span>
00030 <span class="preprocessor"></span>
00031 <span class="comment">//</span>
00032 <span class="comment">// Global data used to support checkout</span>
00033 <span class="comment">//</span>
<a name="l00034"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a1">00034</a> <span class="keyword">extern</span> ULONG   <a class="code" href="../../d1/d0/cmchek_8c.html#a1">CmpUsedStorage</a>;
00035 
<a name="l00036"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a2">00036</a> <span class="keyword">extern</span> <a class="code" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a2">CmpMasterHive</a>;
00037 
00038 <span class="comment">//</span>
00039 <span class="comment">// Private prototypes</span>
00040 <span class="comment">//</span>
00041 
00042 ULONG
00043 <a class="code" href="../../d1/d0/cmchek_8c.html#a16">CmpCheckRegistry2</a>(
00044     HCELL_INDEX Cell,
00045     HCELL_INDEX ParentCell
00046     );
00047 
00048 ULONG
00049 <a class="code" href="../../d1/d0/cmchek_8c.html#a17">CmpCheckKey</a>(
00050     HCELL_INDEX Cell,
00051     HCELL_INDEX ParentCell
00052     );
00053 
00054 ULONG
00055 <a class="code" href="../../d1/d0/cmchek_8c.html#a18">CmpCheckValueList</a>(
00056     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00057     <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a> List,
00058     ULONG       Count
00059     );
00060 
00061 <span class="preprocessor">#ifdef ALLOC_PRAGMA</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,CmCheckRegistry)</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,CmpCheckRegistry2)</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,CmpCheckKey)</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,CmpCheckValueList)</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00067 <span class="preprocessor"></span>
00068 <span class="comment">//</span>
00069 <span class="comment">// debug structures</span>
00070 <span class="comment">//</span>
00071 
00072 <span class="keyword">extern</span> <span class="keyword">struct </span>{
00073     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>;
00074     ULONG       <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00075 } <a class="code" href="../../d1/d0/cmchek_8c.html#a5">CmCheckRegistryDebug</a>;
00076 
00077 <span class="keyword">extern</span> <span class="keyword">struct </span>{
00078     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>;
00079     ULONG       <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00080 } <a class="code" href="../../d1/d0/cmchek_8c.html#a6">CmpCheckRegistry2Debug</a>;
00081 
00082 <span class="keyword">extern</span> <span class="keyword">struct </span>{
00083     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>;
00084     ULONG       <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00085     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00086     <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a>  <a class="code" href="../../d1/d0/cmchek_8c.html#a8">CellPoint</a>;
<a name="l00087"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a9">00087</a>     PVOID       <a class="code" href="../../d1/d0/cmchek_8c.html#a9">RootPoint</a>;
00088     ULONG       <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00089 } <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>;
00090 
00091 <span class="keyword">extern</span> <span class="keyword">struct </span>{
<a name="l00092"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a3">00092</a>     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>;
00093     ULONG       <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
<a name="l00094"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a12">00094</a>     <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a>  <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>;
<a name="l00095"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a10">00095</a>     ULONG       <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
<a name="l00096"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a7">00096</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
<a name="l00097"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a8">00097</a>     <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a>  <a class="code" href="../../d1/d0/cmchek_8c.html#a8">CellPoint</a>;
00098 } <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>;
00099 
00100 <span class="comment">//</span>
00101 <span class="comment">// globals private to check code</span>
00102 <span class="comment">//</span>
<a name="l00103"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a14">00103</a> <span class="keyword">extern</span> <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>;
<a name="l00104"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a15">00104</a> <span class="keyword">extern</span> BOOLEAN <a class="code" href="../../d1/d0/cmchek_8c.html#a15">CmpCheckClean</a>;
00105 
00106 
00107 ULONG
<a name="l00108"></a><a class="code" href="../../d1/d2/cmp_8h.html#a294">00108</a> <a class="code" href="../../d1/d2/cmp_8h.html#a294">CmCheckRegistry</a>(
00109     <a class="code" href="../../d9/d6/struct__CMHIVE.html">PCMHIVE</a> CmHive,
00110     BOOLEAN Clean
00111     )
00112 <span class="comment">/*++</span>
00113 <span class="comment"></span>
00114 <span class="comment">Routine Description:</span>
00115 <span class="comment"></span>
00116 <span class="comment">    Check consistency of the registry within a given hive.  Start from</span>
00117 <span class="comment">    root, and check that:</span>
00118 <span class="comment">        .   Each child key points back to its parent.</span>
00119 <span class="comment">        .   All allocated cells are refered to exactly once</span>
00120 <span class="comment">            (requires looking inside the hive structure...)</span>
00121 <span class="comment">            [This also detects space leaks.]</span>
00122 <span class="comment">        .   All allocated cells are reachable from the root.</span>
00123 <span class="comment"></span>
00124 <span class="comment">    NOTE:   Exactly 1 ref rule may change with security.</span>
00125 <span class="comment"></span>
00126 <span class="comment">Arguments:</span>
00127 <span class="comment"></span>
00128 <span class="comment">    CmHive - supplies a pointer to the CM hive control structure for the</span>
00129 <span class="comment">            hive of interest.</span>
00130 <span class="comment"></span>
00131 <span class="comment">    Clean   - if TRUE, references to volatile cells will be zapped</span>
00132 <span class="comment">              (done at startup only to avoid groveling hives twice.)</span>
00133 <span class="comment">              if FALSE, nothing will be changed.</span>
00134 <span class="comment"></span>
00135 <span class="comment">Return Value:</span>
00136 <span class="comment"></span>
00137 <span class="comment">    0 if Hive is OK.  Error return indicator if not.</span>
00138 <span class="comment"></span>
00139 <span class="comment">    RANGE:  3000 - 3999</span>
00140 <span class="comment"></span>
00141 <span class="comment">--*/</span>
00142 {
00143     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>  <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>;
00144     ULONG   rc = 0;
00145     ULONG   Storage;
00146 
00147     <span class="keywordflow">if</span> (CmHive == <a class="code" href="../../d1/d0/cmchek_8c.html#a2">CmpMasterHive</a>) {
00148         <span class="keywordflow">return</span>(0);
00149     }
00150 
00151     <a class="code" href="../../d1/d0/cmchek_8c.html#a1">CmpUsedStorage</a> = 0;
00152 
00153     <a class="code" href="../../d1/d0/cmchek_8c.html#a5">CmCheckRegistryDebug</a>.Hive = (<a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>)CmHive;
00154     <a class="code" href="../../d1/d0/cmchek_8c.html#a5">CmCheckRegistryDebug</a>.Status = 0;
00155 
00156 
00157     <span class="comment">//</span>
00158     <span class="comment">// check the underlying hive and get storage use</span>
00159     <span class="comment">//</span>
00160     <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a> = &amp;CmHive-&gt;<a class="code" href="../../d9/d6/struct__CMHIVE.html#o0">Hive</a>;
00161 
00162     rc = <a class="code" href="../../d9/d0/hivechek_8c.html#a9">HvCheckHive</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>, &amp;Storage);
00163     <span class="keywordflow">if</span> (rc != 0) {
00164         <a class="code" href="../../d1/d0/cmchek_8c.html#a5">CmCheckRegistryDebug</a>.Status = rc;
00165         <span class="keywordflow">return</span> rc;
00166     }
00167 
00168     <span class="comment">//</span>
00169     <span class="comment">// Call recursive helper to check out the values and subkeys</span>
00170     <span class="comment">//</span>
00171     <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a> = (<a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>)CmHive;
00172     <a class="code" href="../../d1/d0/cmchek_8c.html#a15">CmpCheckClean</a> = Clean;
00173     rc = <a class="code" href="../../d1/d0/cmchek_8c.html#a16">CmpCheckRegistry2</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>-&gt;<a class="code" href="../../d7/d7/struct__HHIVE.html#o8">BaseBlock</a>-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o8">RootCell</a>, <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>);
00174 
00175     <span class="comment">//</span>
00176     <span class="comment">// Validate all the security descriptors in the hive</span>
00177     <span class="comment">//</span>
00178     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d3/cmwraper_8c.html#a21">CmpValidateHiveSecurityDescriptors</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>)) {
00179         KdPrint((<span class="stringliteral">"CmCheckRegistry:"</span>));
00180         KdPrint((<span class="stringliteral">" CmpValidateHiveSecurityDescriptors failed\n"</span>));
00181         rc = 3040;
00182         <a class="code" href="../../d1/d0/cmchek_8c.html#a5">CmCheckRegistryDebug</a>.Status = rc;
00183     }
00184 
00185 <span class="preprocessor">#if 0</span>
00186 <span class="preprocessor"></span>    <span class="comment">//</span>
00187     <span class="comment">// Check allocated storage against used storage</span>
00188     <span class="comment">//</span>
00189     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a1">CmpUsedStorage</a> != Storage) {
00190         KdPrint((<span class="stringliteral">"CmCheckRegistry:"</span>));
00191         KdPrint((<span class="stringliteral">" Storage Used:%08lx  Allocated:%08lx\n"</span>, <a class="code" href="../../d6/d3/cmwraper_8c.html#a0">UsedStorage</a>, Storage));
00192         rc = 3042;
00193         <a class="code" href="../../d1/d0/cmchek_8c.html#a5">CmCheckRegistryDebug</a>.Status = rc;
00194     }
00195 <span class="preprocessor">#endif</span>
00196 <span class="preprocessor"></span>
00197     <span class="comment">//</span>
00198     <span class="comment">// Print a bit of a summary (make sure this data avail in all error cases)</span>
00199     <span class="comment">//</span>
00200     <span class="keywordflow">if</span> (rc &gt; 0) {
00201         KdPrint((<span class="stringliteral">"CmCheckRegistry Failed (%d): CmHive:%08lx\n"</span>, rc, CmHive));
00202         KdPrint((<span class="stringliteral">" Hive:%08lx Root:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>-&gt;<a class="code" href="../../d7/d7/struct__HHIVE.html#o8">BaseBlock</a>-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o8">RootCell</a>));
00203     }
00204 
00205     <span class="keywordflow">return</span> rc;
00206 }
00207 
00208 
00209 ULONG
<a name="l00210"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a16">00210</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a16">CmpCheckRegistry2</a>(
00211     HCELL_INDEX Cell,
00212     HCELL_INDEX ParentCell
00213     )
00214 <span class="comment">/*++</span>
00215 <span class="comment"></span>
00216 <span class="comment">Routine Description:</span>
00217 <span class="comment"></span>
00218 <span class="comment">    Check consistency of the registry, from a particular cell on down.</span>
00219 <span class="comment"></span>
00220 <span class="comment">        .   Check that the cell's value list, child key list, class,</span>
00221 <span class="comment">            security are OK.</span>
00222 <span class="comment">        .   Check that each value entry IN the list is OK.</span>
00223 <span class="comment">        .   Apply self to each child key list.</span>
00224 <span class="comment"></span>
00225 <span class="comment">Globals:</span>
00226 <span class="comment"></span>
00227 <span class="comment">    CmpCheckHive - hive we're working on</span>
00228 <span class="comment"></span>
00229 <span class="comment">    CmpCheckClean - flag TRUE -&gt; clean off volatiles, FALSE -&gt; don't</span>
00230 <span class="comment"></span>
00231 <span class="comment">Arguments:</span>
00232 <span class="comment"></span>
00233 <span class="comment">    Cell - HCELL_INDEX of subkey to work on.</span>
00234 <span class="comment"></span>
00235 <span class="comment">    ParentCell - expected value of parent cell for Cell, unless</span>
00236 <span class="comment">                 HCELL_NIL, in which case ignore.</span>
00237 <span class="comment"></span>
00238 <span class="comment">Return Value:</span>
00239 <span class="comment"></span>
00240 <span class="comment">    0 if Hive is OK.  Error return indicator if not.</span>
00241 <span class="comment"></span>
00242 <span class="comment">    RANGE:  4000 - 4999</span>
00243 <span class="comment"></span>
00244 <span class="comment">--*/</span>
00245 {
00246     ULONG       <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0;
00247     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> StartCell = <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00248     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> SubKey;
00249     ULONG       rc = 0;
00250     <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a>  pcell;
00251 
00252 
00253     <a class="code" href="../../d1/d0/cmchek_8c.html#a6">CmpCheckRegistry2Debug</a>.Hive = <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>;
00254     <a class="code" href="../../d1/d0/cmchek_8c.html#a6">CmpCheckRegistry2Debug</a>.Status = 0;
00255 
00256     <span class="comment">//</span>
00257     <span class="comment">// A jump to NewKey amounts to a virtual call to check the</span>
00258     <span class="comment">// next child cell. (a descent into the tree)</span>
00259     <span class="comment">//</span>
00260     <span class="comment">// Cell, ParentCell, Index, and globals are defined</span>
00261     <span class="comment">//</span>
00262     NewKey:
00263         rc = <a class="code" href="../../d1/d0/cmchek_8c.html#a17">CmpCheckKey</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>, ParentCell);
00264         <span class="keywordflow">if</span> (rc != 0) {
00265             KdPrint((<span class="stringliteral">"\tChild is list entry #%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>));
00266             <a class="code" href="../../d1/d0/cmchek_8c.html#a6">CmpCheckRegistry2Debug</a>.Status = rc;
00267             <span class="keywordflow">return</span> rc;
00268         }
00269 
00270         <span class="comment">//</span>
00271         <span class="comment">// save Index and check out children</span>
00272         <span class="comment">//</span>
00273         pcell = <a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>);
00274         pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o15">WorkVar</a> = <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00275 
00276         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>&lt;pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o5">SubKeyCounts</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a75">Stable</a>]; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++) {
00277 
00278             SubKey = <a class="code" href="../../d1/d2/cmp_8h.html#a304">CmpFindSubKeyByNumber</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>,
00279                                            (<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a>)<a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>,<a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>),
00280                                            <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>);
00281 
00282             <span class="comment">//</span>
00283             <span class="comment">// "recurse" onto child</span>
00284             <span class="comment">//</span>
00285             ParentCell = <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00286             <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a> = SubKey;
00287             <span class="keywordflow">goto</span> NewKey;
00288 
00289             ResumeKey:;                 <span class="comment">// A jump here is a virtual return</span>
00290                                         <span class="comment">// Cell, ParentCell and Index</span>
00291                                         <span class="comment">// must be defined</span>
00292         }
00293 
00294         <span class="comment">//</span>
00295         <span class="comment">// since we're here, we've checked out all the children</span>
00296         <span class="comment">// of the current cell.</span>
00297         <span class="comment">//</span>
00298         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a> == StartCell) {
00299 
00300             <span class="comment">//</span>
00301             <span class="comment">// we are done</span>
00302             <span class="comment">//</span>
00303             <span class="keywordflow">return</span> 0;
00304         }
00305 
00306         <span class="comment">//</span>
00307         <span class="comment">// "return" to "parent instance"</span>
00308         <span class="comment">//</span>
00309         pcell = <a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>);
00310         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o15">WorkVar</a>;
00311 
00312         <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a> = ParentCell;
00313 
00314         pcell = <a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>);
00315         ParentCell = pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o4">Parent</a>;
00316 
00317         <span class="keywordflow">goto</span> ResumeKey;
00318 }
00319 
00320 
00321 
00322 ULONG
<a name="l00323"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a17">00323</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a17">CmpCheckKey</a>(
00324     HCELL_INDEX Cell,
00325     HCELL_INDEX ParentCell
00326     )
00327 <span class="comment">/*++</span>
00328 <span class="comment"></span>
00329 <span class="comment">Routine Description:</span>
00330 <span class="comment"></span>
00331 <span class="comment">    Check consistency of the registry, for a particular cell</span>
00332 <span class="comment"></span>
00333 <span class="comment">        .   Check that the cell's value list, child key list, class,</span>
00334 <span class="comment">            security are OK.</span>
00335 <span class="comment">        .   Check that each value entry IN the list is OK.</span>
00336 <span class="comment"></span>
00337 <span class="comment">Globals:</span>
00338 <span class="comment"></span>
00339 <span class="comment">    CmpCheckHive - hive we're working on</span>
00340 <span class="comment"></span>
00341 <span class="comment">    CmpCheckClean - flag TRUE -&gt; clean off volatiles, FALSE -&gt; don't</span>
00342 <span class="comment"></span>
00343 <span class="comment">Arguments:</span>
00344 <span class="comment"></span>
00345 <span class="comment">    Cell - HCELL_INDEX of subkey to work on.</span>
00346 <span class="comment"></span>
00347 <span class="comment">    ParentCell - expected value of parent cell for Cell, unless</span>
00348 <span class="comment">                 HCELL_NIL, in which case ignore.</span>
00349 <span class="comment"></span>
00350 <span class="comment">Return Value:</span>
00351 <span class="comment"></span>
00352 <span class="comment">    0 if Hive is OK.  Error return indicator if not.</span>
00353 <span class="comment"></span>
00354 <span class="comment">    RANGE:  4000 - 4999</span>
00355 <span class="comment"></span>
00356 <span class="comment">--*/</span>
00357 {
00358     <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a>      pcell;
00359     ULONG           size;
00360     ULONG           usedlen;
00361     ULONG           ClassLength;
00362     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>     Class;
00363     ULONG           ValueCount;
00364     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>     ValueList;
00365     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>     Security;
00366     ULONG           rc = 0;
00367     ULONG           nrc = 0;
00368     ULONG           i;
00369     <a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html">PCM_KEY_INDEX</a>   Root;
00370     <a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html">PCM_KEY_INDEX</a>   Leaf;
00371     ULONG           SubCount;
00372 
00373     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Hive = <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>;
00374     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = 0;
00375     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Cell = <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00376     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.CellPoint = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00377     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.RootPoint = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00378     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Index = (ULONG)-1;
00379 
00380     <span class="comment">//</span>
00381     <span class="comment">// Check key itself</span>
00382     <span class="comment">//</span>
00383     <span class="keywordflow">if</span> (! <a class="code" href="../../d8/d0/hivecell_8c.html#a21">HvIsCellAllocated</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>)) {
00384         KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00385         KdPrint((<span class="stringliteral">"\tNot allocated\n"</span>));
00386         rc = 4010;
00387         <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00388         <span class="keywordflow">return</span> rc;
00389     }
00390     pcell = <a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>);
00391     <a class="code" href="../../d1/d2/cmp_8h.html#a124">SetUsed</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>);
00392 
00393     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.CellPoint = pcell;
00394 
00395     size = <a class="code" href="../../d8/d0/hivecell_8c.html#a15">HvGetCellSize</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, pcell);
00396     <span class="keywordflow">if</span> (size &gt; <a class="code" href="../../d1/d0/cmchek_8c.html#a0">REG_MAX_PLAUSIBLE_KEY_SIZE</a>) {
00397         KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00398         KdPrint((<span class="stringliteral">"\tImplausible size %lx\n"</span>, size));
00399         rc = 4020;
00400         <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00401         <span class="keywordflow">return</span> rc;
00402     }
00403     usedlen = FIELD_OFFSET(<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">CM_KEY_NODE</a>, <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>) + pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o16">NameLength</a>;
00404     <span class="keywordflow">if</span> (usedlen &gt; size) {
00405         KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00406         KdPrint((<span class="stringliteral">"\tKey is bigger than containing cell.\n"</span>));
00407         rc = 4030;
00408         <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00409         <span class="keywordflow">return</span> rc;
00410     }
00411     <span class="keywordflow">if</span> (pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o0">Signature</a> != <a class="code" href="../../d9/d0/cmdata_8h.html#a25">CM_KEY_NODE_SIGNATURE</a>) {
00412         KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00413         KdPrint((<span class="stringliteral">"\tNo key signature\n"</span>));
00414         rc = 4040;
00415         <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00416         <span class="keywordflow">return</span> rc;
00417     }
00418     <span class="keywordflow">if</span> (ParentCell != <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>) {
00419         <span class="keywordflow">if</span> (pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o4">Parent</a> != ParentCell) {
00420             KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00421             KdPrint((<span class="stringliteral">"\tWrong parent value.\n"</span>));
00422             rc = 4045;
00423             <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00424             <span class="keywordflow">return</span> rc;
00425         }
00426     }
00427     ClassLength = pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o17">ClassLength</a>;
00428     Class = pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o10">Class</a>;
00429     ValueCount = pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o7">ValueList</a>.<a class="code" href="../../d7/d9/struct__CHILD__LIST.html#o0">Count</a>;
00430     ValueList = pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o7">ValueList</a>.<a class="code" href="../../d7/d9/struct__CHILD__LIST.html#o1">List</a>;
00431     Security = pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o9">Security</a>;
00432 
00433     <span class="comment">//</span>
00434     <span class="comment">// Check simple non-empty cases</span>
00435     <span class="comment">//</span>
00436     <span class="keywordflow">if</span> (ClassLength &gt; 0) {
00437         <span class="keywordflow">if</span>( Class == <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a> ) {
00438             pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o17">ClassLength</a> = 0;
00439             <a class="code" href="../../d0/d2/hivesync_8c.html#a7">HvMarkCellDirty</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>);
00440             KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx has ClassLength = %lu and Class == HCELL_NIL\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>,ClassLength));
00441         } <span class="keywordflow">else</span> {
00442             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/hivecell_8c.html#a21">HvIsCellAllocated</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, Class) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00443                     KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00444                     KdPrint((<span class="stringliteral">"\tClass:%08lx - unallocated class\n"</span>, Class));
00445                     rc = 4080;
00446                     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00447                     <span class="keywordflow">return</span> rc;
00448                 } <span class="keywordflow">else</span> {
00449                     <a class="code" href="../../d1/d2/cmp_8h.html#a124">SetUsed</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, Class);
00450                 }
00451         }
00452     }
00453 
00454     <span class="keywordflow">if</span> (Security != <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>) {
00455         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/hivecell_8c.html#a21">HvIsCellAllocated</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, Security) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00456             KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00457             KdPrint((<span class="stringliteral">"\tSecurity:%08lx - unallocated security\n"</span>, Security));
00458             rc = 4090;
00459             <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00460             <span class="keywordflow">return</span> rc;
00461         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d1/hivedata_8h.html#a19">HvGetCellType</a>(Security) == <a class="code" href="../../d0/d1/hivedata_8h.html#a77a76">Volatile</a>) {
00462             <a class="code" href="../../d1/d2/cmp_8h.html#a124">SetUsed</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, Security);
00463         }
00464         <span class="comment">//</span>
00465         <span class="comment">// Else CmpValidateHiveSecurityDescriptors must do computation</span>
00466         <span class="comment">//</span>
00467     }
00468 
00469     <span class="comment">//</span>
00470     <span class="comment">// Check value list case</span>
00471     <span class="comment">//</span>
00472     <span class="keywordflow">if</span> (ValueCount &gt; 0) {
00473         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/hivecell_8c.html#a21">HvIsCellAllocated</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, ValueList) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00474             KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00475             KdPrint((<span class="stringliteral">"\tValueList:%08lx - unallocated valuelist\n"</span>, ValueList));
00476             rc = 4100;
00477             <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00478             <span class="keywordflow">return</span> rc;
00479         } <span class="keywordflow">else</span> {
00480             <a class="code" href="../../d1/d2/cmp_8h.html#a124">SetUsed</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, ValueList);
00481             pcell = <a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, ValueList);
00482             nrc = <a class="code" href="../../d1/d0/cmchek_8c.html#a18">CmpCheckValueList</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, pcell, ValueCount);
00483             <span class="keywordflow">if</span> (nrc != 0) {
00484                 KdPrint((<span class="stringliteral">"List was for CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00485                 rc = nrc;
00486                 <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.CellPoint = pcell;
00487                 <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00488                 <span class="keywordflow">return</span> rc;
00489             }
00490         }
00491     }
00492 
00493 
00494     <span class="comment">//</span>
00495     <span class="comment">// Check subkey list case</span>
00496     <span class="comment">//</span>
00497 
00498     pcell = <a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>);
00499     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.CellPoint = pcell;
00500     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d1/hivedata_8h.html#a19">HvGetCellType</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>) == <a class="code" href="../../d0/d1/hivedata_8h.html#a77a76">Volatile</a>) &amp;&amp;
00501         (pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o5">SubKeyCounts</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a75">Stable</a>] != 0))
00502     {
00503         KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00504         KdPrint((<span class="stringliteral">"\tVolatile Cell has Stable children\n"</span>));
00505         rc = 4108;
00506         <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00507         <span class="keywordflow">return</span> rc;
00508     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o5">SubKeyCounts</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a75">Stable</a>] &gt; 0) {
00509         <span class="keywordflow">if</span> (! <a class="code" href="../../d8/d0/hivecell_8c.html#a21">HvIsCellAllocated</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o6">SubKeyLists</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a75">Stable</a>])) {
00510             KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00511             KdPrint((<span class="stringliteral">"\tStableKeyList:%08lx - unallocated\n"</span>, pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o6">SubKeyLists</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a75">Stable</a>]));
00512             rc = 4110;
00513             <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00514             <span class="keywordflow">return</span> rc;
00515         } <span class="keywordflow">else</span> {
00516             <a class="code" href="../../d1/d2/cmp_8h.html#a124">SetUsed</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o6">SubKeyLists</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a75">Stable</a>]);
00517 
00518             <span class="comment">//</span>
00519             <span class="comment">// Prove that the index is OK</span>
00520             <span class="comment">//</span>
00521             Root = (<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html">PCM_KEY_INDEX</a>)<a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(
00522                                     <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>,
00523                                     pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o6">SubKeyLists</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a75">Stable</a>]
00524                                     );
00525             <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.RootPoint = Root;
00526             <span class="keywordflow">if</span> ((Root-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o0">Signature</a> == <a class="code" href="../../d9/d0/cmdata_8h.html#a19">CM_KEY_INDEX_LEAF</a>) ||
00527                 (Root-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o0">Signature</a> == <a class="code" href="../../d9/d0/cmdata_8h.html#a20">CM_KEY_FAST_LEAF</a>)) {
00528                 <span class="keywordflow">if</span> ((ULONG)Root-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o1">Count</a> != pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o5">SubKeyCounts</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a75">Stable</a>]) {
00529                     KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00530                     KdPrint((<span class="stringliteral">"\tBad Index count @%08lx\n"</span>, Root));
00531                     rc = 4120;
00532                     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00533                     <span class="keywordflow">return</span> rc;
00534                 }
00535             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Root-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o0">Signature</a> == <a class="code" href="../../d9/d0/cmdata_8h.html#a18">CM_KEY_INDEX_ROOT</a>) {
00536                 SubCount = 0;
00537                 <span class="keywordflow">for</span> (i = 0; i &lt; Root-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o1">Count</a>; i++) {
00538                     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Index = i;
00539                     <span class="keywordflow">if</span> (! <a class="code" href="../../d8/d0/hivecell_8c.html#a21">HvIsCellAllocated</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, Root-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o2">List</a>[i])) {
00540                         KdPrint((<span class="stringliteral">"CmpCheckKey: Hive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00541                         KdPrint((<span class="stringliteral">"\tBad Leaf Cell %08lx Root@%08lx\n"</span>, Root-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o2">List</a>[i], Root));
00542                         rc = 4130;
00543                         <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00544                         <span class="keywordflow">return</span> rc;
00545                     }
00546                     Leaf = (<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html">PCM_KEY_INDEX</a>)<a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>,
00547                                                     Root-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o2">List</a>[i]);
00548                     <span class="keywordflow">if</span> ((Leaf-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o0">Signature</a> != <a class="code" href="../../d9/d0/cmdata_8h.html#a19">CM_KEY_INDEX_LEAF</a>) &amp;&amp;
00549                         (Leaf-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o0">Signature</a> != <a class="code" href="../../d9/d0/cmdata_8h.html#a20">CM_KEY_FAST_LEAF</a>)) {
00550                         KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00551                         KdPrint((<span class="stringliteral">"\tBad Leaf Index @%08lx Root@%08lx\n"</span>, Leaf, Root));
00552                         rc = 4140;
00553                         <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00554                         <span class="keywordflow">return</span> rc;
00555                     }
00556                     <a class="code" href="../../d1/d2/cmp_8h.html#a124">SetUsed</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, Root-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o2">List</a>[i]);
00557                     SubCount += Leaf-&gt;<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o1">Count</a>;
00558                 }
00559                 <span class="keywordflow">if</span> (pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o5">SubKeyCounts</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a75">Stable</a>] != SubCount) {
00560                     KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00561                     KdPrint((<span class="stringliteral">"\tBad count in index, SubCount=%08lx\n"</span>, SubCount));
00562                     rc = 4150;
00563                     <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00564                     <span class="keywordflow">return</span> rc;
00565                 }
00566             } <span class="keywordflow">else</span> {
00567                 KdPrint((<span class="stringliteral">"CmpCheckKey: CmpCheckHive:%08lx Cell:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a14">CmpCheckHive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00568                 KdPrint((<span class="stringliteral">"\tBad Root index signature @%08lx\n"</span>, Root));
00569                 rc = 4120;
00570                 <a class="code" href="../../d1/d0/cmchek_8c.html#a11">CmpCheckKeyDebug</a>.Status = rc;
00571                 <span class="keywordflow">return</span> rc;
00572             }
00573         }
00574     }
00575     <span class="comment">//</span>
00576     <span class="comment">// force volatiles to be empty, if this is a load operation</span>
00577     <span class="comment">//</span>
00578     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a15">CmpCheckClean</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00579         pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o5">SubKeyCounts</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a76">Volatile</a>] = 0;
00580         pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>.<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o6">SubKeyLists</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a77a76">Volatile</a>] = <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>;
00581     }
00582 
00583     <span class="keywordflow">return</span> rc;
00584 }
00585 
00586 
00587 ULONG
<a name="l00588"></a><a class="code" href="../../d1/d0/cmchek_8c.html#a18">00588</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a18">CmpCheckValueList</a>(
00589     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      Hive,
00590     <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a> List,
00591     ULONG       Count
00592     )
00593 <span class="comment">/*++</span>
00594 <span class="comment"></span>
00595 <span class="comment">Routine Description:</span>
00596 <span class="comment"></span>
00597 <span class="comment">    Check consistency of a value list.</span>
00598 <span class="comment">        .   Each element allocated?</span>
00599 <span class="comment">        .   Each element have valid signature?</span>
00600 <span class="comment">        .   Data properly allocated?</span>
00601 <span class="comment"></span>
00602 <span class="comment">Arguments:</span>
00603 <span class="comment"></span>
00604 <span class="comment">    Hive - containing Hive.</span>
00605 <span class="comment"></span>
00606 <span class="comment">    List - pointer to an array of HCELL_INDEX entries.</span>
00607 <span class="comment"></span>
00608 <span class="comment">    Count - number of entries in list.</span>
00609 <span class="comment"></span>
00610 <span class="comment">Return Value:</span>
00611 <span class="comment"></span>
00612 <span class="comment">    0 if Hive is OK.  Error return indicator if not.</span>
00613 <span class="comment"></span>
00614 <span class="comment">    RANGE:  5000 - 5999</span>
00615 <span class="comment"></span>
00616 <span class="comment">--*/</span>
00617 {
00618     ULONG   i;
00619     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00620     <a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a> pcell;
00621     ULONG   size;
00622     ULONG   usedlen;
00623     ULONG   DataLength;
00624     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> Data;
00625     ULONG   rc = 0;
00626 
00627     <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Hive = <a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>;
00628     <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Status = 0;
00629     <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.List = <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>;
00630     <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Index = (ULONG)-1;
00631     <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Cell = 0;   <span class="comment">// NOT HCELL_NIL</span>
00632     <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.CellPoint = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00633 
00634     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>; i++) {
00635 
00636         <span class="comment">//</span>
00637         <span class="comment">// Check out value entry's refs.</span>
00638         <span class="comment">//</span>
00639         <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a> = <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o4">KeyList</a>[i];
00640         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a> == <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>) {
00641             KdPrint((<span class="stringliteral">"CmpCheckValueList: List:%08lx i:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>, i));
00642             KdPrint((<span class="stringliteral">"\tEntry is null\n"</span>));
00643             rc = 5010;
00644             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Status = rc;
00645             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Index = i;
00646             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Cell = <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00647             <span class="keywordflow">return</span> rc;
00648         }
00649         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/hivecell_8c.html#a21">HvIsCellAllocated</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00650             KdPrint((<span class="stringliteral">"CmpCheckValueList: List:%08lx i:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>, i));
00651             KdPrint((<span class="stringliteral">"\tEntry is not allocated\n"</span>));
00652             rc = 5020;
00653             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Status = rc;
00654             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Index = i;
00655             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Cell = <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00656             <span class="keywordflow">return</span> rc;
00657         } <span class="keywordflow">else</span> {
00658             <a class="code" href="../../d1/d2/cmp_8h.html#a124">SetUsed</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>);
00659         }
00660 
00661         <span class="comment">//</span>
00662         <span class="comment">// Check out the value entry itself</span>
00663         <span class="comment">//</span>
00664         pcell = <a class="code" href="../../d6/d0/hive_8h.html#a12">HvGetCell</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>);
00665         size = <a class="code" href="../../d8/d0/hivecell_8c.html#a15">HvGetCellSize</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>, pcell);
00666         <span class="keywordflow">if</span> (pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o1">KeyValue</a>.<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o0">Signature</a> != <a class="code" href="../../d9/d0/cmdata_8h.html#a34">CM_KEY_VALUE_SIGNATURE</a>) {
00667             KdPrint((<span class="stringliteral">"CmpCheckValueList: List:%08lx i:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>, i));
00668             KdPrint((<span class="stringliteral">"\tCell:%08lx - invalid value signature\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00669             rc = 5030;
00670             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Status = rc;
00671             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Index = i;
00672             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Cell = <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00673             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.CellPoint = pcell;
00674             <span class="keywordflow">return</span> rc;
00675         }
00676         usedlen = FIELD_OFFSET(<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">CM_KEY_VALUE</a>, <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>) + pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o1">KeyValue</a>.<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o1">NameLength</a>;
00677         <span class="keywordflow">if</span> (usedlen &gt; size) {
00678             KdPrint((<span class="stringliteral">"CmpCheckValueList: List:%08lx i:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>, i));
00679             KdPrint((<span class="stringliteral">"\tCell:%08lx - value bigger than containing cell\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>));
00680             rc = 5040;
00681             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Status = rc;
00682             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Index = i;
00683             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Cell = <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00684             <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.CellPoint = pcell;
00685             <span class="keywordflow">return</span> rc;
00686         }
00687 
00688         <span class="comment">//</span>
00689         <span class="comment">// Check out value entry's data</span>
00690         <span class="comment">//</span>
00691         DataLength = pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o1">KeyValue</a>.<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o2">DataLength</a>;
00692         <span class="keywordflow">if</span> (DataLength &lt; <a class="code" href="../../d9/d0/cmdata_8h.html#a35">CM_KEY_VALUE_SPECIAL_SIZE</a>) {
00693             Data = pcell-&gt;<a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>.<a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o1">KeyValue</a>.<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o3">Data</a>;
00694             <span class="keywordflow">if</span> ((DataLength == 0) &amp;&amp; (Data != <a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>)) {
00695                 KdPrint((<span class="stringliteral">"CmpCheckValueList: List:%08lx i:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>, i));
00696                 KdPrint((<span class="stringliteral">"\tCell:%08lx Data:%08lx - data not null\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>, Data));
00697                 rc = 5050;
00698                 <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Status = rc;
00699                 <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Index = i;
00700                 <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Cell = <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00701                 <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.CellPoint = pcell;
00702                 <span class="keywordflow">return</span> rc;
00703             }
00704             <span class="keywordflow">if</span> (DataLength &gt; 0) {
00705                 <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/hivecell_8c.html#a21">HvIsCellAllocated</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>, Data) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00706                     KdPrint((<span class="stringliteral">"CmpCheckValueList: List:%08lx i:%08lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>, i));
00707                     KdPrint((<span class="stringliteral">"\tCell:%08lx Data:%08lx - unallocated\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>, Data));
00708                     rc = 5060;
00709                     <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Status = rc;
00710                     <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Index = i;
00711                     <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.Cell = <a class="code" href="../../d1/d0/cmchek_8c.html#a7">Cell</a>;
00712                     <a class="code" href="../../d1/d0/cmchek_8c.html#a13">CmpCheckValueListDebug</a>.CellPoint = pcell;
00713                     <span class="keywordflow">return</span> rc;
00714                 } <span class="keywordflow">else</span> {
00715                     <a class="code" href="../../d1/d2/cmp_8h.html#a124">SetUsed</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a3">Hive</a>, Data);
00716                 }
00717             }
00718         }
00719     }
00720     <span class="keywordflow">return</span> rc;
00721 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:26 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
