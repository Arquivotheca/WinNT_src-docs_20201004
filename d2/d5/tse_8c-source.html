<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: tse.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>tse.c</h1><a href="../../d1/d6/tse_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00002 <span class="comment">// WARNING - WARNING - WARNING - WARNING - WARNING - WARNING - WARNING  //</span>
00003 <span class="comment">//                                                                      //</span>
00004 <span class="comment">// This test file is not current with the security implementation.      //</span>
00005 <span class="comment">// This file contains references to data types and APIs that do not     //</span>
00006 <span class="comment">// exist.                                                               //</span>
00007 <span class="comment">//                                                                      //</span>
00009 <span class="comment"></span>
00010 <span class="comment">/*++</span>
00011 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00012 <span class="comment"></span>
00013 <span class="comment">Module Name:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    tse.c</span>
00016 <span class="comment"></span>
00017 <span class="comment">Abstract:</span>
00018 <span class="comment"></span>
00019 <span class="comment">    Test program for the SE subcomponent of the NTOS project</span>
00020 <span class="comment"></span>
00021 <span class="comment">Author:</span>
00022 <span class="comment"></span>
00023 <span class="comment">    Gary Kimura     (garyki)    20-Nov-1989</span>
00024 <span class="comment"></span>
00025 <span class="comment">Revision History:</span>
00026 <span class="comment"></span>
00027 <span class="comment">--*/</span>
00028 
00029 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00030 
00031 <span class="preprocessor">#include "<a class="code" href="../../d6/d6/sep_8h.html">sep.h</a>"</span>
00032 <span class="preprocessor">#include &lt;zwapi.h&gt;</span>
00033 
00034 BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a0">SeTest</a>();
00035 
00036 <span class="preprocessor">#include "ttoken.c"</span>
00037 
00038 <span class="keywordtype">int</span>
<a name="l00039"></a><a class="code" href="../../d1/d6/tse_8c.html#a1">00039</a> <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(
00040     <span class="keywordtype">int</span> argc,
00041     <span class="keywordtype">char</span> *argv[]
00042     )
00043 {
00044     <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d8/d1/init_8h.html#a22">KiSystemStartup</a>();
00045 
00046     <a class="code" href="../../d4/d0/tex_8c.html#a2">TestFunction</a> = <a class="code" href="../../d1/d6/tse_8c.html#a0">SeTest</a>;
00047     <a class="code" href="../../d8/d1/init_8h.html#a22">KiSystemStartup</a>();
00048     <span class="keywordflow">return</span>( 0 );
00049 }
00050 
00051 
00052 BOOLEAN
<a name="l00053"></a><a class="code" href="../../d1/d6/tse_8c.html#a0">00053</a> <a class="code" href="../../d1/d6/tse_8c.html#a0">SeTest</a>()
00054 {
00055     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a2">TestMakeSystemToken</a>();
00056     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a3">TestTokenCopy</a>();
00057     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a4">TestTokenSize</a>();
00058     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a5">TestDefaultObjectMethod</a>();
00059     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a6">TestCaptureSecurityDescriptor</a>();
00060     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a7">TestAssignSecurity</a>();
00061     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a8">TestAccessCheck</a>();
00062     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a9">TestGenerateMessage</a>();
00063 
00064     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Start SeTest()\n"</span>);
00065 
00066     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a2">TestMakeSystemToken</a>()) {
00067         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestMakeSystemToken() Error\n"</span>);
00068         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00069     }
00070     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a3">TestTokenCopy</a>()) {
00071         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestTokenCopy() Error\n"</span>);
00072         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00073     }
00074     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a4">TestTokenSize</a>()) {
00075         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestTokenSize() Error\n"</span>);
00076         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00077     }
00078     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a5">TestDefaultObjectMethod</a>()) {
00079         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestDefaultObjectMethod() Error\n"</span>);
00080         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00081     }
00082     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a6">TestCaptureSecurityDescriptor</a>()) {
00083         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestCaptureSecurityDescriptor() Error\n"</span>);
00084         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00085     }
00086     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a7">TestAssignSecurity</a>()) {
00087         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestAssignSecurity() Error\n"</span>);
00088         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00089     }
00090     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a8">TestAccessCheck</a>()) {
00091         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestAccessCheck() Error\n"</span>);
00092         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00093     }
00094     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a9">TestGenerateMessage</a>()) {
00095         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestGenerateMessage() Error\n"</span>);
00096         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00097     }
00098 
00099     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"End SeTest()\n"</span>);
00100     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00101 }
00102 
00103 
00104 BOOLEAN
<a name="l00105"></a><a class="code" href="../../d1/d6/tse_8c.html#a2">00105</a> <a class="code" href="../../d1/d6/tse_8c.html#a2">TestMakeSystemToken</a>()
00106 {
00107     PACCESS_TOKEN <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00108 
00109     <span class="comment">//</span>
00110     <span class="comment">//  Make the system token</span>
00111     <span class="comment">//</span>
00112 
00113     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (PACCESS_TOKEN)<a class="code" href="../../d0/d5/se_8h.html#a153">SeMakeSystemToken</a>( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> );
00114 
00115     <span class="comment">//</span>
00116     <span class="comment">//  and check its contents</span>
00117     <span class="comment">//</span>
00118 
00119     <span class="keywordflow">if</span> (!SepIsSystemToken( <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>, ((ACCESS_TOKEN *)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> )) {
00120         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SepIsSystemToken Error\n"</span>);
00121         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00122     }
00123 
00124     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> );
00125 
00126     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00127 }
00128 
00129 
00130 BOOLEAN
<a name="l00131"></a><a class="code" href="../../d1/d6/tse_8c.html#a3">00131</a> <a class="code" href="../../d1/d6/tse_8c.html#a3">TestTokenCopy</a>()
00132 {
00133     PACCESS_TOKEN InToken;
00134     PACCESS_TOKEN OutToken;
00135 
00136     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00137 
00138     ULONG i;
00139 
00140     <span class="comment">//</span>
00141     <span class="comment">//  Allocate Buffers, and build a token</span>
00142     <span class="comment">//</span>
00143 
00144     InToken = (PACCESS_TOKEN)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 512);
00145     OutToken = (PACCESS_TOKEN)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 512);
00146 
00147     BuildToken( <a class="code" href="../../d4/d6/tsevars_8c.html#a66a58">Fred</a>, InToken );
00148 
00149     <span class="comment">//</span>
00150     <span class="comment">//  Make a copy of the token</span>
00151     <span class="comment">//</span>
00152 
00153     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = SeTokenCopy( InToken, OutToken, 512))) {
00154         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeTokenCopy Error: %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00155         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00156     }
00157 
00158     <span class="comment">//</span>
00159     <span class="comment">//  check both tokens for equality</span>
00160     <span class="comment">//</span>
00161 
00162     <span class="keywordflow">for</span> (i = 0; i &lt; ((ACCESS_TOKEN *)InToken)-&gt;Size; i += 1) {
00163         <span class="keywordflow">if</span> (*((PUCHAR)InToken + 1) != *((PUCHAR)OutToken + 1)) {
00164             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Token copy error\n"</span>);
00165             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00166         }
00167     }
00168 
00169     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( InToken );
00170     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( OutToken );
00171 
00172     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00173 }
00174 
00175 
00176 BOOLEAN
<a name="l00177"></a><a class="code" href="../../d1/d6/tse_8c.html#a4">00177</a> <a class="code" href="../../d1/d6/tse_8c.html#a4">TestTokenSize</a>()
00178 {
00179     PACCESS_TOKEN <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00180 
00181     <span class="comment">//</span>
00182     <span class="comment">//  Allocate and build a token</span>
00183     <span class="comment">//</span>
00184 
00185     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (PACCESS_TOKEN)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 512);
00186 
00187     BuildToken( <a class="code" href="../../d4/d6/tsevars_8c.html#a66a59">Wilma</a>, <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> );
00188 
00189     <span class="comment">//</span>
00190     <span class="comment">//  Get the token size</span>
00191     <span class="comment">//</span>
00192 
00193     <span class="keywordflow">if</span> (SeTokenSize(<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>) != ((ACCESS_TOKEN *)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;Size) {
00194         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeTokenSize error\n"</span>);
00195         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00196     }
00197 
00198     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> );
00199 
00200     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00201 }
00202 
00203 
00204 BOOLEAN
<a name="l00205"></a><a class="code" href="../../d1/d6/tse_8c.html#a5">00205</a> <a class="code" href="../../d1/d6/tse_8c.html#a5">TestDefaultObjectMethod</a>()
00206 {
00207     SECURITY_DESCRIPTOR SecurityDescriptor;
00208     PSECURITY_DESCRIPTOR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00209     PACL Acl;
00210     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00211     PSECURITY_DESCRIPTOR ObjectsSecurityDescriptor;
00212     ULONG Length;
00213 
00214     Acl = (PACL)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 1024 );
00215     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = (PSECURITY_DESCRIPTOR)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 1024 );
00216 
00217     BuildAcl( <a class="code" href="../../d4/d6/tsevars_8c.html#a66a58">Fred</a>, Acl, 1024 );
00218     DiscretionarySecurityDescriptor( &amp;SecurityDescriptor, Acl );
00219 
00220     ObjectsSecurityDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00221 
00222     <span class="comment">//</span>
00223     <span class="comment">//  Set the descriptor</span>
00224     <span class="comment">//</span>
00225 
00226     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d6/semethod_8c.html#a3">SeDefaultObjectMethod</a>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00227                                                  <a class="code" href="../../d0/d5/se_8h.html#a200a108">SetSecurityDescriptor</a>,
00228                                                  &amp;SecurityDescriptor,
00229                                                  0,
00230                                                  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00231                                                  &amp;ObjectsSecurityDescriptor,
00232                                                  <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> ))) {
00233 
00234         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeDefaultObjectMethod setting error: %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00235         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00236     }
00237 
00238     <span class="comment">//</span>
00239     <span class="comment">//  Query the descriptor</span>
00240     <span class="comment">//</span>
00241 
00242     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d6/semethod_8c.html#a3">SeDefaultObjectMethod</a>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00243                                                  <a class="code" href="../../d0/d5/se_8h.html#a200a109">QuerySecurityDescriptor</a>,
00244                                                  <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>,
00245                                                  AllAclInformation,
00246                                                  &amp;Length,
00247                                                  &amp;ObjectsSecurityDescriptor,
00248                                                  <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> ))) {
00249 
00250         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeDefaultObjectMethod reading error: %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00251         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00252     }
00253 
00254     <span class="comment">//</span>
00255     <span class="comment">//  Replace the descriptor</span>
00256     <span class="comment">//</span>
00257 
00258     BuildAcl( <a class="code" href="../../d4/d6/tsevars_8c.html#a66a59">Wilma</a>, Acl, 1024 );
00259 
00260     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d6/semethod_8c.html#a3">SeDefaultObjectMethod</a>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00261                                                  <a class="code" href="../../d0/d5/se_8h.html#a200a108">SetSecurityDescriptor</a>,
00262                                                  &amp;SecurityDescriptor,
00263                                                  AllAclInformation,
00264                                                  &amp;Length,
00265                                                  &amp;ObjectsSecurityDescriptor,
00266                                                  <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> ))) {
00267 
00268         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeDefaultObjectMethod reading error: %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00269         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00270     }
00271 
00272     <span class="comment">//</span>
00273     <span class="comment">//  Delete the descriptor</span>
00274     <span class="comment">//</span>
00275 
00276     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d6/semethod_8c.html#a3">SeDefaultObjectMethod</a>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00277                                                  <a class="code" href="../../d0/d5/se_8h.html#a200a110">DeleteSecurityDescriptor</a>,
00278                                                  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00279                                                  0,
00280                                                  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00281                                                  &amp;ObjectsSecurityDescriptor,
00282                                                  <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> ))) {
00283 
00284         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeDefaultObjectMethod deleting error: %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00285         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00286     }
00287 
00288     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(Acl);
00289     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>);
00290 
00291     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00292 }
00293 
00294 
00295 BOOLEAN
<a name="l00296"></a><a class="code" href="../../d1/d6/tse_8c.html#a6">00296</a> <a class="code" href="../../d1/d6/tse_8c.html#a6">TestCaptureSecurityDescriptor</a>()
00297 {
00298     SECURITY_DESCRIPTOR SecurityDescriptor;
00299     PACL Sacl;
00300     PACL <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>;
00301     PSECURITY_DESCRIPTOR NewDescriptor;
00302     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00303 
00304     Sacl = (PACL)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 1024 );
00305     <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> = (PACL)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 1024 );
00306     BuildAcl( <a class="code" href="../../d4/d6/tsevars_8c.html#a66a60">Pebbles</a>, Sacl, 1024 );
00307     BuildAcl( <a class="code" href="../../d4/d6/tsevars_8c.html#a66a61">Barney</a>, <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>, 1024 );
00308 
00309     DiscretionarySecurityDescriptor( &amp;SecurityDescriptor, <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> );
00310     SecurityDescriptor.SecurityInformationClass = AllAclInformation;
00311     SecurityDescriptor.SystemAcl = Sacl;
00312 
00313     <span class="comment">//</span>
00314     <span class="comment">//  Capture kernel mode and don't force</span>
00315     <span class="comment">//</span>
00316 
00317     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d5/se_2capture_8c.html#a1">SeCaptureSecurityDescriptor</a>( &amp;SecurityDescriptor,
00318                                                        <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>,
00319                                                        <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>,
00320                                                        <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00321                                                        &amp;NewDescriptor ))) {
00322         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeCapture Error, KernelMode, FALSE : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00323         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00324     }
00325 
00326     <span class="comment">//</span>
00327     <span class="comment">//  Capture kernel mode and force</span>
00328     <span class="comment">//</span>
00329 
00330     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d5/se_2capture_8c.html#a1">SeCaptureSecurityDescriptor</a>( &amp;SecurityDescriptor,
00331                                                        <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>,
00332                                                        <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>,
00333                                                        <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00334                                                        &amp;NewDescriptor ))) {
00335         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeCapture Error, KernelMode, TRUE : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00336         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00337     } <span class="keywordflow">else</span> {
00338         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( NewDescriptor );
00339     }
00340 
00341     <span class="comment">//</span>
00342     <span class="comment">//  Capture user mode</span>
00343     <span class="comment">//</span>
00344 
00345     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d5/se_2capture_8c.html#a1">SeCaptureSecurityDescriptor</a>( &amp;SecurityDescriptor,
00346                                                        <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>,
00347                                                        <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>,
00348                                                        <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00349                                                        &amp;NewDescriptor ))) {
00350         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeCapture Error, UserMode, FALSE : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00351         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00352     } <span class="keywordflow">else</span> {
00353         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( NewDescriptor );
00354     }
00355 
00356     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00357 }
00358 
00359 BOOLEAN
<a name="l00360"></a><a class="code" href="../../d1/d6/tse_8c.html#a7">00360</a> <a class="code" href="../../d1/d6/tse_8c.html#a7">TestAssignSecurity</a>()
00361 {
00362     SECURITY_DESCRIPTOR SecurityDescriptor;
00363     PACL Acl;
00364 
00365     PACCESS_TOKEN <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00366 
00367     GENERIC_MAPPING GenericMapping;
00368 
00369     PSECURITY_DESCRIPTOR NewDescriptor;
00370 
00371     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00372 
00373     Acl = (PACL)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 1024 );
00374     BuildAcl( <a class="code" href="../../d4/d6/tsevars_8c.html#a66a58">Fred</a>, Acl, 1024 );
00375 
00376     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (PACCESS_TOKEN)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 512 );
00377     BuildToken( <a class="code" href="../../d4/d6/tsevars_8c.html#a66a58">Fred</a>, <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> );
00378 
00379     DiscretionarySecurityDescriptor( &amp;SecurityDescriptor, Acl );
00380 
00381     <span class="comment">//</span>
00382     <span class="comment">//  Kernel mode, non dir, and no new</span>
00383     <span class="comment">//</span>
00384 
00385     NewDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00386     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00387                                             &amp;NewDescriptor,
00388                                             <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00389                                             <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00390                                             &amp;GenericMapping,
00391                                             <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ))) {
00392         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error NoNew, NoDir, Kernel : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00393         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00394     }
00395 
00396     <span class="comment">//</span>
00397     <span class="comment">//  Kernel mode, non dir, and new</span>
00398     <span class="comment">//</span>
00399 
00400     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00401                                             &amp;NewDescriptor,
00402                                             <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00403                                             <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00404                                             &amp;GenericMapping,
00405                                             <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ))) {
00406         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error New, NoDir, Kernel : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00407         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00408     }
00409 
00410     <span class="comment">//</span>
00411     <span class="comment">//  Kernel mode, dir, and no new</span>
00412     <span class="comment">//</span>
00413 
00414     NewDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00415     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00416                                             &amp;NewDescriptor,
00417                                             <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00418                                             <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00419                                             &amp;GenericMapping,
00420                                             <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ))) {
00421         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error NoNew, Dir, Kernel : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00422         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00423     }
00424 
00425     <span class="comment">//</span>
00426     <span class="comment">//  Kernel mode, dir, and new</span>
00427     <span class="comment">//</span>
00428 
00429     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00430                                             &amp;NewDescriptor,
00431                                             <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00432                                             <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00433                                             &amp;GenericMapping,
00434                                             <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ))) {
00435         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error New, Dir, Kernel : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00436         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00437     }
00438 
00439 
00440     <span class="comment">//</span>
00441     <span class="comment">//  User mode, non dir, and no new</span>
00442     <span class="comment">//</span>
00443 
00444     NewDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00445     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00446                                             &amp;NewDescriptor,
00447                                             <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00448                                             <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00449                                             &amp;GenericMapping,
00450                                             <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> ))) {
00451         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error NoNew, NoDir, User : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00452         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00453     }
00454 
00455     <span class="comment">//</span>
00456     <span class="comment">//  User mode, non dir, and new</span>
00457     <span class="comment">//</span>
00458 
00459     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00460                                             &amp;NewDescriptor,
00461                                             <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00462                                             <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00463                                             &amp;GenericMapping,
00464                                             <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> ))) {
00465         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error New, NoDir, User : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00466         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00467     }
00468 
00469     <span class="comment">//</span>
00470     <span class="comment">//  User mode, dir, and no new</span>
00471     <span class="comment">//</span>
00472 
00473     NewDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00474     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00475                                             &amp;NewDescriptor,
00476                                             <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00477                                             <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00478                                             &amp;GenericMapping,
00479                                             <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> ))) {
00480         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error NoNew, Dir, User : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00481         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00482     }
00483 
00484     <span class="comment">//</span>
00485     <span class="comment">//  User mode, dir, and new</span>
00486     <span class="comment">//</span>
00487 
00488     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00489                                             &amp;NewDescriptor,
00490                                             <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00491                                             <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00492                                             &amp;GenericMapping,
00493                                             <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> ))) {
00494         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error New, Dir, User : %8lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00495         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00496     }
00497 
00498     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00499 }
00500 
00501 
00502 BOOLEAN
<a name="l00503"></a><a class="code" href="../../d1/d6/tse_8c.html#a8">00503</a> <a class="code" href="../../d1/d6/tse_8c.html#a8">TestAccessCheck</a>()
00504 {
00505     SECURITY_DESCRIPTOR SecurityDescriptor;
00506     PACL Acl;
00507 
00508     PACCESS_TOKEN <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00509 
00510     Acl = (PACL)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 1024 );
00511     BuildAcl( <a class="code" href="../../d4/d6/tsevars_8c.html#a66a58">Fred</a>, Acl, 1024 );
00512 
00513     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (PACCESS_TOKEN)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, 512 );
00514     BuildToken( <a class="code" href="../../d4/d6/tsevars_8c.html#a66a58">Fred</a>, <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> );
00515 
00516     DiscretionarySecurityDescriptor( &amp;SecurityDescriptor, Acl );
00517 
00518     <span class="comment">//</span>
00519     <span class="comment">//  Test should be successful based on aces</span>
00520     <span class="comment">//</span>
00521 
00522     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d4/accessck_8c.html#a18">SeAccessCheck</a>( &amp;SecurityDescriptor,
00523                         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00524                         0x00000001,
00525                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00526                         <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> )) {
00527         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAccessCheck Error should allow access\n"</span>);
00528         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00529     }
00530 
00531     <span class="comment">//</span>
00532     <span class="comment">//  Test should be successful based on owner</span>
00533     <span class="comment">//</span>
00534 
00535     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d4/accessck_8c.html#a18">SeAccessCheck</a>( &amp;SecurityDescriptor,
00536                         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00537                         READ_CONTROL,
00538                         &amp;FredGuid,
00539                         <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> )) {
00540         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAccessCheck Error should allow owner\n"</span>);
00541         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00542     }
00543 
00544     <span class="comment">//</span>
00545     <span class="comment">//  Test should be unsuccessful based on aces</span>
00546     <span class="comment">//</span>
00547 
00548     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d4/accessck_8c.html#a18">SeAccessCheck</a>( &amp;SecurityDescriptor,
00549                        <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00550                        0x0000000f,
00551                        &amp;FredGuid,
00552                        <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> )) {
00553         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAccessCheck Error shouldn't allow access\n"</span>);
00554         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00555     }
00556 
00557     <span class="comment">//</span>
00558     <span class="comment">//  Test should be unsuccessful based on non owner</span>
00559     <span class="comment">//</span>
00560 
00561     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d4/accessck_8c.html#a18">SeAccessCheck</a>( &amp;SecurityDescriptor,
00562                        <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>,
00563                        READ_CONTROL,
00564                        &amp;BarneyGuid,
00565                        <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> )) {
00566         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAccessCheck Error shouldn't allow non owner access\n"</span>);
00567         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00568     }
00569 
00570     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00571 }
00572 
00573 
00574 BOOLEAN
<a name="l00575"></a><a class="code" href="../../d1/d6/tse_8c.html#a9">00575</a> <a class="code" href="../../d1/d6/tse_8c.html#a9">TestGenerateMessage</a>()
00576 {
00577     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00578 }
00579 
00580 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:05 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
