<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: transsub.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>transsub.c File Reference</h1><code>#include "<a class="el" href="../../d9/d2/w32_2ntuser_2imm_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d3/d4/transsub_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a0">TransSetOpenK</a> (HWND hWndApp, HIMC hImc, LPIMESTRUCT lpIme)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a1">TransSetOpenJ</a> (HWND hWndApp, HIMC hImc, LPIMESTRUCT lpIme)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a2">TransGetOpenK</a> (HWND hWndApp, HIMC hImc, LPIMESTRUCT lpIme, BOOL fAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a3">TransGetOpenJ</a> (HWND hWndApp, HIMC hImc, LPIMESTRUCT lpIme, BOOL fAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a4">TransMoveImeWindow</a> (HWND hWndApp, HIMC hImc, LPIMESTRUCT lpIme)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a5">TransSetConversionWindow</a> (HWND hWndApp, HIMC hImc, LPIMESTRUCT lpIme)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a6">TransSetConversionMode</a> (HIMC hImc, LPIMESTRUCT lpIme)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a7">TransGetMode</a> (HIMC hImc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a8">TransGetConversionMode</a> (HIMC hImc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a9">TransSetMode</a> (HIMC hImc, LPIMESTRUCT lpIme)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a10">TransSendVKey</a> (HWND hWndApp, HIMC hImc, LPIMESTRUCT lpIme, BOOL fAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a11">TransEnterWordRegisterMode</a> (HWND hWndApp, LPIMESTRUCT lpIme, BOOL fAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a12">TransSetConversionFontEx</a> (HWND hWndApp, HIMC hImc, LPIMESTRUCT lpIme, BOOL fAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a13">TransHanjaMode</a> (HWND hWndApp, HIMC hImc, LPIMESTRUCT lpIme)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a14">Get31ModeFrom40ModeJ</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fdwConversion)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a15">Get31ModeFrom40ModeK</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fdwConversion)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a16">TransVKDBEMode</a> (HIMC hImc, WPARAM wVKDBE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a17">SetFontForMCWVERTICAL</a> (HWND hWndApp, HIMC hImc, LPINPUTCONTEXT pInputContext, BOOL fVert)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a18">IsForegroundThread</a> (HWND)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a19">FixLogfont</a> (LPLOGFONTW lplfW, BOOL fVert)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a20">MySetCompFont</a> (HWND, HIMC, LPLOGFONTW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a21">MySetCompWindow</a> (HWND, HIMC, LPCOMPOSITIONFORM)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a22">MySetCandidateWindow</a> (HWND, HIMC, LPCANDIDATEFORM)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a23">MyPostImsMessage</a> (HWND hWndApp, WPARAM wParam, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a24">TranslateIMESubFunctions</a> (HWND hWndApp, LPIMESTRUCT lpIme, BOOL fAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a25">TransGetLevel</a> (HWND hWndApp)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/transsub_8c.html#a26">TransSetLevel</a> (HWND hWndApp, LPIMESTRUCT lpIme)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a19" doxytag="transsub.c::FixLogfont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL FixLogfont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPLOGFONTW&nbsp;</td>
          <td class="mdname" nowrap> <em>lplfW</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fVert</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01287">1287</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l01222">SetFontForMCWVERTICAL()</a>, and <a class="el" href="../../d3/d4/transsub_8c-source.html#l00989">TransSetConversionFontEx()</a>.
<p>
<pre class="fragment"><div>01288 {
01289     <span class="keywordtype">int</span> i;
01290 
01291     <span class="keywordflow">if</span> ( fVert ) {
01292     <span class="comment">//</span>
01293     <span class="comment">// convert the specified font to vertical writing font</span>
01294     <span class="comment">//</span>
01295         lplfW-&gt;lfEscapement = 2700;
01296         lplfW-&gt;lfOrientation = 2700;
01297         <span class="keywordflow">if</span> ((lplfW-&gt;lfCharSet == SHIFTJIS_CHARSET) &amp;&amp; (lplfW-&gt;lfFaceName[0] != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'@'</span>)) {
01298             <span class="keywordflow">for</span>(i=0;lplfW-&gt;lfFaceName[i];++i)    <span class="comment">// Search NULL</span>
01299             <span class="keywordflow">if</span> (i &gt; (LF_FACESIZE-2))         <span class="comment">// if not remain 2 char</span>
01300                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;                <span class="comment">// then error</span>
01301                                          <span class="comment">// Because insert @ char</span>
01302 
01303             <span class="keywordflow">for</span>( ; i&gt;=0 ; --i )                  <span class="comment">// Copy facename from tail</span>
01304                 lplfW-&gt;lfFaceName[i+1] = lplfW-&gt;lfFaceName[i];
01305 
01306             lplfW-&gt;lfFaceName[0] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'@'</span>;         <span class="comment">// insert @ character</span>
01307         }
01308     } <span class="keywordflow">else</span> {
01309     <span class="comment">//</span>
01310     <span class="comment">// convert the specified font to normal font</span>
01311     <span class="comment">//</span>
01312         lplfW-&gt;lfEscapement = 0;
01313         lplfW-&gt;lfOrientation = 0;
01314         <span class="keywordflow">if</span> ((lplfW-&gt;lfCharSet == SHIFTJIS_CHARSET) &amp;&amp; (lplfW-&gt;lfFaceName[0] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'@'</span>))
01315             lstrcpynW(lplfW-&gt;lfFaceName,&amp;(lplfW-&gt;lfFaceName[1]),LF_FACESIZE-1);
01316     }
01317     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01318 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="transsub.c::Get31ModeFrom40ModeJ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT Get31ModeFrom40ModeJ           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fdwConversion</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00734">734</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00710">TransGetConversionMode()</a>, and <a class="el" href="../../d3/d4/transsub_8c-source.html#l00575">TransSetConversionMode()</a>.
<p>
<pre class="fragment"><div>00735 {
00736     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> u31Mode = 0;
00737 
00738     <span class="comment">//</span>
00739     <span class="comment">// translate the 4.0 style mode to the 3.x style conversion mode</span>
00740     <span class="comment">//</span>
00741     <span class="keywordflow">if</span> (fdwConversion &amp; IME_CMODE_NATIVE) {
00742         <span class="keywordflow">if</span> (fdwConversion &amp; IME_CMODE_KATAKANA) {
00743             u31Mode |= IME_MODE_KATAKANA;
00744         } <span class="keywordflow">else</span> {
00745             u31Mode |= IME_MODE_HIRAGANA;
00746         }
00747     } <span class="keywordflow">else</span> {
00748         u31Mode |= IME_MODE_ALPHANUMERIC;
00749     }
00750 
00751     <span class="keywordflow">if</span> (fdwConversion &amp; IME_CMODE_FULLSHAPE) {
00752         u31Mode |= IME_MODE_DBCSCHAR;
00753     } <span class="keywordflow">else</span> {
00754         u31Mode |= JAPAN_IME_MODE_SBCSCHAR;
00755     }
00756 
00757     <span class="keywordflow">if</span> (fdwConversion &amp; IME_CMODE_ROMAN) {
00758         u31Mode |= IME_MODE_ROMAN;
00759     } <span class="keywordflow">else</span> {
00760         u31Mode |= IME_MODE_NOROMAN;
00761     }
00762 
00763     <span class="keywordflow">if</span> (fdwConversion &amp; IME_CMODE_CHARCODE) {
00764         u31Mode |= IME_MODE_CODEINPUT;
00765     } <span class="keywordflow">else</span> {
00766         u31Mode |= IME_MODE_NOCODEINPUT;
00767     }
00768 
00769     <span class="keywordflow">return</span> (u31Mode);
00770 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="transsub.c::Get31ModeFrom40ModeK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT Get31ModeFrom40ModeK           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fdwConversion</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00677">677</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00654">TransGetMode()</a>, and <a class="el" href="../../d3/d4/transsub_8c-source.html#l00780">TransSetMode()</a>.
<p>
<pre class="fragment"><div>00678 {
00679     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> u31Mode = 0;
00680 
00681     <span class="keywordflow">if</span> ( !(fdwConversion &amp; IME_CMODE_NATIVE) ) {
00682 
00683         u31Mode |= IME_MODE_ALPHANUMERIC;
00684     }
00685 
00686     <span class="keywordflow">if</span> ( !(fdwConversion &amp; IME_CMODE_FULLSHAPE) ) {
00687 
00688         u31Mode |= KOREA_IME_MODE_SBCSCHAR;
00689     }
00690 
00691     <span class="keywordflow">if</span> ( fdwConversion &amp; IME_CMODE_HANJACONVERT ) {
00692         u31Mode |= IME_MODE_HANJACONVERT;
00693     }
00694 
00695     <span class="keywordflow">return</span> u31Mode;
00696 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="transsub.c::IsForegroundThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL IsForegroundThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01198">1198</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00251">GetWindowThreadProcessId()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00450">TransSetConversionWindow()</a>, and <a class="el" href="../../d3/d4/transsub_8c-source.html#l00331">TransSetOpenJ()</a>.
<p>
<pre class="fragment"><div>01199 {
01200     HWND  hwndFG;
01201     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwThreadId;
01202 
01203     hwndFG = GetForegroundWindow();
01204     <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>( hwnd ) ) {
01205         dwThreadId = <a class="code" href="../../d3/d8/winmgrc_8c.html#a18">GetWindowThreadProcessId</a>( hwnd, NULL );
01206     } <span class="keywordflow">else</span> {
01207         dwThreadId = GetCurrentThreadId();
01208     }
01209     <span class="keywordflow">return</span> ( <a class="code" href="../../d3/d8/winmgrc_8c.html#a18">GetWindowThreadProcessId</a>(hwndFG,NULL) == dwThreadId );
01210 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="transsub.c::MyPostImsMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL MyPostImsMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01481">1481</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00027">ImmGetDefaultIMEWnd()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l01441">MySetCandidateWindow()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01328">MySetCompFont()</a>, and <a class="el" href="../../d3/d4/transsub_8c-source.html#l01396">MySetCompWindow()</a>.
<p>
<pre class="fragment"><div>01482 {
01483     HWND   hDefIMEWnd;
01484     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01485 
01486     hDefIMEWnd = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a4">ImmGetDefaultIMEWnd</a>(hWndApp);
01487     <span class="keywordflow">if</span> ( hDefIMEWnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01488         <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>( hDefIMEWnd, WM_IME_SYSTEM, wParam, lParam) ) {
01489             fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01490         }
01491     }
01492     <span class="keywordflow">return</span> fRet;
01493 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="transsub.c::MySetCandidateWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL MySetCandidateWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCANDIDATEFORM&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01441">1441</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00912">ImmGetAppCompatFlags()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00371">ImmLockIMC()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l02266">ImmSetCandidateWindow()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00383">ImmUnlockIMC()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01481">MyPostImsMessage()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00450">TransSetConversionWindow()</a>.
<p>
<pre class="fragment"><div>01442 {
01443     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01444     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCompat;
01445     PINPUTCONTEXT pInputContext;
01446 
01447     <span class="comment">// BOGUS!!</span>
01448     <span class="comment">// Some application call SendIMEMessage(IME_SETCONVERSIONWINDOW)</span>
01449     <span class="comment">// when the apps is handling WM_PAINT.</span>
01450     <span class="comment">// New Win95 IME try to draw the UI during calling ImmSetCandidateWindow,</span>
01451     <span class="comment">// and WM_PAINT will be sent in the API....</span>
01452     <span class="comment">// To avoid this thing, WINNLS makes the notification to IME and APPS later.</span>
01453     <span class="comment">// ........</span>
01454     <span class="keywordflow">if</span> ( (pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>(hImc)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01455         dwCompat = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a34">ImmGetAppCompatFlags</a>( hImc );
01456         <span class="keywordflow">if</span> ( dwCompat &amp; IMECOMPAT_UNSYNC31IMEMSG ) {
01457             memcpy( &amp;(pInputContext-&gt;cfCandForm[lpcaf-&gt;dwIndex]), lpcaf, <span class="keyword">sizeof</span>(CANDIDATEFORM));
01458             fRet = <a class="code" href="../../d2/d5/transsub_8c.html#a23">MyPostImsMessage</a>( hWndApp, IMS_SETCANDIDATEPOS, lpcaf-&gt;dwIndex );
01459         } <span class="keywordflow">else</span> {
01460             fRet = <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a44">ImmSetCandidateWindow</a>( hImc, lpcaf );
01461         }
01462         <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>( hImc );
01463     }
01464     <span class="keywordflow">return</span> fRet;
01465 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="transsub.c::MySetCompFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL MySetCompFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPLOGFONTW&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01328">1328</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00033">IMCF_UNICODE</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00912">ImmGetAppCompatFlags()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00689">ImmLockClientImc()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00371">ImmLockIMC()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00747">ImmUnlockClientImc()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00383">ImmUnlockIMC()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l03113">LFontAtoLFontW()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01481">MyPostImsMessage()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00166">TestICF</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l01222">SetFontForMCWVERTICAL()</a>, and <a class="el" href="../../d3/d4/transsub_8c-source.html#l00989">TransSetConversionFontEx()</a>.
<p>
<pre class="fragment"><div>01329 {
01330     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01331     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCompat;
01332     PINPUTCONTEXT pInputContext;
01333     <a class="code" href="../../d3/d0/structtagCLIENTIMC.html">PCLIENTIMC</a> pClientImc;
01334     LOGFONTW lfw;
01335     LPLOGFONTW lplfw = &amp;lfw;
01336     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fUnicode;
01337 
01338     <span class="comment">// BOGUS!!</span>
01339     <span class="comment">// Some application call SendIMEMessage(IME_SETCONVERSIONFONT)</span>
01340     <span class="comment">// when the apps is handling WM_PAINT.</span>
01341     <span class="comment">// New Win95 IME try to draw the UI during calling ImmSetCompositionFont,</span>
01342     <span class="comment">// and WM_PAINT will be sent in the API....</span>
01343     <span class="comment">// To avoid this thing, WINNLS makes the notification to IME and APPS later.</span>
01344     <span class="comment">// ........</span>
01345 
01346     <span class="keywordflow">if</span> ( (pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>(hImc)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01347         dwCompat = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a34">ImmGetAppCompatFlags</a>( hImc );
01348         pClientImc = <a class="code" href="../../d9/d0/immuser_8h.html#a43">ImmLockClientImc</a>(hImc);
01349         <span class="keywordflow">if</span> (pClientImc != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01350             fUnicode = <a class="code" href="../../d4/d0/immcli_8h.html#a21">TestICF</a>(pClientImc, IMCF_UNICODE);
01351 
01352             <a class="code" href="../../d9/d0/immuser_8h.html#a44">ImmUnlockClientImc</a>(pClientImc);
01353 
01354             <span class="keywordflow">if</span> ( fUnicode )
01355                 lplfw = &amp;(pInputContext-&gt;lfFont.W);
01356             <span class="keywordflow">else</span>
01357                 <a class="code" href="../../d4/d0/immcli_8h.html#a83">LFontAtoLFontW</a>( &amp;(pInputContext-&gt;lfFont.A), lplfw );
01358 
01359             <span class="keywordflow">if</span> ( RtlEqualMemory(lplfw, lplf, <span class="keyword">sizeof</span>(LOGFONTA)-LF_FACESIZE)
01360                  &amp;&amp; !lstrcmp(lplfw-&gt;lfFaceName, lplf-&gt;lfFaceName) ) {
01361 
01362                 <span class="comment">/*</span>
01363 <span class="comment">                 * Don't inform IME ahd UI when logfont is not changed.</span>
01364 <span class="comment">                 */</span>
01365                 lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01366 
01367             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( dwCompat &amp; IMECOMPAT_UNSYNC31IMEMSG ) {
01368 
01369                 memcpy( &amp;(pInputContext-&gt;lfFont.W), lplf, <span class="keyword">sizeof</span>(LOGFONT));
01370                 <span class="keywordflow">if</span> ( dwCompat &amp; IMECOMPAT_UNSYNC31IMEMSG2 )
01371                     <span class="comment">/*</span>
01372 <span class="comment">                     * BOGUS!! for PageMaker5J</span>
01373 <span class="comment">                     */</span>
01374                     lRet = <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>( hWndApp, WM_IME_SYSTEM, IMS_SETCOMPOSITIONFONT, 0 );
01375                 <span class="keywordflow">else</span>
01376                     lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a23">MyPostImsMessage</a>( hWndApp, IMS_SETCOMPOSITIONFONT, 0);
01377 
01378             } <span class="keywordflow">else</span> {
01379 
01380                 lRet = ImmSetCompositionFont( hImc, lplf );
01381 
01382             }
01383         }
01384         <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>( hImc );
01385     }
01386     <span class="keywordflow">return</span> lRet;
01387 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="transsub.c::MySetCompWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL MySetCompWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONFORM&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01396">1396</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00912">ImmGetAppCompatFlags()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00371">ImmLockIMC()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l02185">ImmSetCompositionWindow()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00383">ImmUnlockIMC()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01481">MyPostImsMessage()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00450">TransSetConversionWindow()</a>.
<p>
<pre class="fragment"><div>01401 {
01402     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01403     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCompat;
01404     PINPUTCONTEXT pInputContext;
01405 
01406     <span class="comment">// BOGUS!!</span>
01407     <span class="comment">// Some application call SendIMEMessage(IME_SETCONVERSIONWINDOW)</span>
01408     <span class="comment">// when the apps is handling WM_PAINT.</span>
01409     <span class="comment">// New Win95 IME try to draw the UI during calling ImmSetCompositionWindow,</span>
01410     <span class="comment">// and WM_PAINT will be sent in the API....</span>
01411     <span class="comment">// To avoid this thing, WINNLS makes the notification to IME and APPS later.</span>
01412     <span class="comment">// ........</span>
01413     <span class="keywordflow">if</span> ( (pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>(hImc)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01414         dwCompat = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a34">ImmGetAppCompatFlags</a>( hImc );
01415         <span class="keywordflow">if</span> ( dwCompat &amp; IMECOMPAT_UNSYNC31IMEMSG ) {
01416             memcpy( &amp;(pInputContext-&gt;cfCompForm), lpcof, <span class="keyword">sizeof</span>(COMPOSITIONFORM));
01417             <span class="keywordflow">if</span> ( dwCompat &amp; IMECOMPAT_UNSYNC31IMEMSG2 ) {
01418                 <span class="comment">/*</span>
01419 <span class="comment">                 * BOGUS!! for PageMaker5J</span>
01420 <span class="comment">                 */</span>
01421                 fRet = <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>( hWndApp, WM_IME_SYSTEM, IMS_SETCOMPOSITIONWINDOW, 0 );
01422             } <span class="keywordflow">else</span> {
01423                 fRet = <a class="code" href="../../d2/d5/transsub_8c.html#a23">MyPostImsMessage</a>( hWndApp, IMS_SETCOMPOSITIONWINDOW, 0 );
01424             }
01425         } <span class="keywordflow">else</span> {
01426             pInputContext-&gt;fdw31Compat |= F31COMPAT_CALLFROMWINNLS;
01427             fRet = <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a42">ImmSetCompositionWindow</a>( hImc, lpcof );
01428         }
01429         <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>( hImc );
01430     }
01431     <span class="keywordflow">return</span> fRet;
01432 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="transsub.c::SetFontForMCWVERTICAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetFontForMCWVERTICAL           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPINPUTCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>pInputContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fVert</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01222">1222</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01287">FixLogfont()</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00033">IMCF_UNICODE</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00689">ImmLockClientImc()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00747">ImmUnlockClientImc()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00098">lf</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01328">MySetCompFont()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d9/immcli_8h-source.html#l00166">TestICF</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00450">TransSetConversionWindow()</a>.
<p>
<pre class="fragment"><div>01223 {
01224     LOGFONTW <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
01225     <a class="code" href="../../d3/d0/structtagCLIENTIMC.html">PCLIENTIMC</a> pClientImc;
01226 
01227     <span class="keywordflow">if</span> ( pInputContext-&gt;fdwInit &amp; INIT_LOGFONT) {
01228     <span class="comment">//</span>
01229     <span class="comment">// If a font has ever been set, use it</span>
01230     <span class="comment">//</span>
01231         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsi;
01232 
01233         memcpy(&amp;lf,&amp;pInputContext-&gt;lfFont.W,<span class="keyword">sizeof</span>(LOGFONTW));
01234         <span class="comment">//</span>
01235         <span class="comment">// check if the input context is unicode</span>
01236         <span class="comment">//</span>
01237         pClientImc = <a class="code" href="../../d9/d0/immuser_8h.html#a43">ImmLockClientImc</a>( hImc );
01238         <span class="keywordflow">if</span> (pClientImc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01239             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01240         }
01241         fAnsi = ! <a class="code" href="../../d4/d0/immcli_8h.html#a21">TestICF</a>( pClientImc, IMCF_UNICODE );
01242         <a class="code" href="../../d9/d0/immuser_8h.html#a44">ImmUnlockClientImc</a>( pClientImc );
01243 
01244         <span class="keywordflow">if</span> ( fAnsi ) {
01245             <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> FaceNameA[ LF_FACESIZE ];
01246 
01247             <span class="comment">//</span>
01248             <span class="comment">// we need a temporary buffer because MultiByteToWideChar</span>
01249             <span class="comment">// doesn't allow us to specify src==dest.</span>
01250             <span class="comment">//</span>
01251             memcpy( FaceNameA, &amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfFaceName, LF_FACESIZE );
01252             MultiByteToWideChar( CP_ACP,
01253                                  0,
01254                                  FaceNameA,     <span class="comment">// src</span>
01255                                  LF_FACESIZE,   <span class="comment">// size of src</span>
01256                                  <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfFaceName, <span class="comment">// destination buffer</span>
01257                                  LF_FACESIZE ); <span class="comment">// size of destination buffer</span>
01258         }
01259     } <span class="keywordflow">else</span> {
01260     <span class="comment">//</span>
01261     <span class="comment">// system font should be used as the default font</span>
01262     <span class="comment">//</span>
01263         GetObjectW( GetStockObject(SYSTEM_FONT), <span class="keyword">sizeof</span>(lf), (LPVOID)&amp;lf );
01264     }
01265 
01266     <span class="comment">//</span>
01267     <span class="comment">// put/remove '@' from the font facename.</span>
01268     <span class="comment">// "@facename" means vertical writing font</span>
01269     <span class="comment">//</span>
01270     <span class="keywordflow">if</span> ( <a class="code" href="../../d2/d5/transsub_8c.html#a19">FixLogfont</a>( &amp;lf, fVert ) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ) {
01271        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01272     }
01273 
01274     <span class="keywordflow">return</span> <a class="code" href="../../d2/d5/transsub_8c.html#a20">MySetCompFont</a>( hWndApp, hImc, &amp;lf );
01275 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="transsub.c::TransEnterWordRegisterMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransEnterWordRegisterMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00932">932</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00575">ImmConfigureIMEA()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00707">ImmConfigureIMEW()</a>, <a class="el" href="../../d5/d0/layout_8c-source.html#l00468">ImmIsIME()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00933 {
00934     LRESULT lRet;
00935     HKL hkl = <a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0L);
00936 
00937     <span class="keywordflow">if</span> ( ! <a class="code" href="../../d4/d1/layout_8c.html#a20">ImmIsIME</a>(hkl) ) {
00938         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00939     }
00940 
00941     <span class="keywordflow">if</span> ( fAnsi ) {
00942     <span class="comment">//</span>
00943     <span class="comment">// ANSI</span>
00944     <span class="comment">//</span>
00945         REGISTERWORDA stReg = {<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>};
00946         LPSTR lpsz1, lpsz2;
00947 
00948         <span class="keywordflow">if</span> (lpIme-&gt;lParam1&amp;&amp;(lpsz1=GlobalLock((HGLOBAL)lpIme-&gt;lParam1))) {
00949             stReg.lpWord = lpsz1;
00950         }
00951         <span class="keywordflow">if</span> (lpIme-&gt;lParam2&amp;&amp;(lpsz2=GlobalLock((HGLOBAL)lpIme-&gt;lParam2))) {
00952             stReg.lpReading = lpsz2;
00953         }
00954         lRet = <a class="code" href="../../d6/d0/immime_8c.html#a16">ImmConfigureIMEA</a>(hkl,hWndApp,IME_CONFIG_REGISTERWORD, (LPVOID)&amp;stReg);
00955         <span class="keywordflow">if</span> (lpIme-&gt;lParam1 &amp;&amp; lpsz1)
00956             GlobalUnlock((HGLOBAL)lpIme-&gt;lParam1);
00957         <span class="keywordflow">if</span> (lpIme-&gt;lParam2 &amp;&amp; lpsz2)
00958             GlobalUnlock((HGLOBAL)lpIme-&gt;lParam2);
00959     } <span class="keywordflow">else</span> {
00960     <span class="comment">//</span>
00961     <span class="comment">// UNICODE</span>
00962     <span class="comment">//</span>
00963         REGISTERWORDW stReg = {<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>};
00964         LPWSTR lpsz1, lpsz2;
00965 
00966         <span class="keywordflow">if</span> (lpIme-&gt;lParam1&amp;&amp;(lpsz1=GlobalLock((HGLOBAL)lpIme-&gt;lParam1))) {
00967             stReg.lpWord = lpsz1;
00968         }
00969         <span class="keywordflow">if</span> (lpIme-&gt;lParam2&amp;&amp;(lpsz2=GlobalLock((HGLOBAL)lpIme-&gt;lParam2))) {
00970             stReg.lpReading = lpsz2;
00971         }
00972         lRet = <a class="code" href="../../d6/d0/immime_8c.html#a17">ImmConfigureIMEW</a>(hkl,hWndApp,IME_CONFIG_REGISTERWORD, (LPVOID)&amp;stReg);
00973         <span class="keywordflow">if</span> (lpIme-&gt;lParam1 &amp;&amp; lpsz1)
00974             GlobalUnlock((HGLOBAL)lpIme-&gt;lParam1);
00975         <span class="keywordflow">if</span> (lpIme-&gt;lParam2 &amp;&amp; lpsz2)
00976             GlobalUnlock((HGLOBAL)lpIme-&gt;lParam2);
00977     }
00978     <span class="keywordflow">return</span> lRet;
00979 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="transsub.c::TransGetConversionMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransGetConversionMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HIMC&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hImc</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00710">710</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00734">Get31ModeFrom40ModeJ()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01368">ImmGetConversionStatus()</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00711 {
00712     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fdwConversion, fdwSentence;
00713     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> u31Mode = 0;
00714 
00715     <span class="comment">//</span>
00716     <span class="comment">// get the 4.0 style conversion mode</span>
00717     <span class="comment">//</span>
00718     <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a29">ImmGetConversionStatus</a>( hImc, &amp;fdwConversion, &amp;fdwSentence);
00719     <span class="keywordflow">return</span> <a class="code" href="../../d2/d5/transsub_8c.html#a14">Get31ModeFrom40ModeJ</a>( fdwConversion );
00720 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="transsub.c::TransGetLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransGetLevel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hWndApp</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01099">1099</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l12915">NtUserGetAppImeLevel()</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00171">ImmGenerateMessage()</a>, <a class="el" href="../../d5/d2/ntuser_2imm_2input_8c-source.html#l00408">ImmPostMessages()</a>, and <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>01100 {
01101     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> lRet;
01102 
01103     <span class="keywordflow">if</span> ( (lRet = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a396">NtUserGetAppImeLevel</a>( hWndApp )) == 0 )
01104         lRet = 1;       <span class="comment">// default level</span>
01105 
01106     <span class="keywordflow">return</span> lRet;
01107 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="transsub.c::TransGetMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransGetMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HIMC&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hImc</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00654">654</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00677">Get31ModeFrom40ModeK()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01368">ImmGetConversionStatus()</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00655 {
00656     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fdwConversion, fdwSentence;
00657     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> u31Mode = 0;
00658 
00659     <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a29">ImmGetConversionStatus</a>( hImc, &amp;fdwConversion, &amp;fdwSentence);
00660     u31Mode= <a class="code" href="../../d2/d5/transsub_8c.html#a15">Get31ModeFrom40ModeK</a>( fdwConversion );
00661     <span class="comment">// HACK: To prevent 0 result from treating FALSE, we always set MSB</span>
00662     <span class="keywordflow">return</span> ( u31Mode | 0x80000000 );
00663 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="transsub.c::TransGetOpenJ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransGetOpenJ           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00399">399</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l00036">ImmGetCompositionStringA()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l00099">ImmGetCompositionStringW()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01494">ImmGetOpenStatus()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00400 {
00401     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00402     LRESULT lRet;
00403 
00404     lRet = <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a31">ImmGetOpenStatus</a>( hImc );
00405 
00406     <span class="comment">// lpIME-&gt;wCount is the length of the composition string.</span>
00407     <span class="keywordflow">if</span> ( fAnsi ) {
00408         <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>= <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a8">ImmGetCompositionStringA</a>( hImc, GCS_COMPSTR, NULL, 0L );
00409     } <span class="keywordflow">else</span> {
00410         <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>= <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a9">ImmGetCompositionStringW</a>( hImc, GCS_COMPSTR, NULL, 0L );
00411     }
00412     lpIme-&gt;wCount = ( <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> &gt; 0 ) ? <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> : 0;
00413 
00414     <span class="keywordflow">return</span> lRet;
00415     UNREFERENCED_PARAMETER(hWndApp);
00416 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="transsub.c::TransGetOpenK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransGetOpenK           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00373">373</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>, and <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00655">GetWindowRect()</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00374 {
00375     <span class="comment">// BUGBUG: We will use this function instead of ImmEscape().</span>
00376     RECT    rc;
00377     LPARAM  lTemp;
00378     LRESULT lRet;
00379 
00380     lTemp = lpIme-&gt;lParam2;
00381     <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>(hWndApp, &amp;rc);
00382     lpIme-&gt;lParam2 = MAKELONG(rc.top, rc.left);
00383     lRet = ImmEscape(<a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0), hImc, IME_GETOPEN, lpIme);
00384     lpIme-&gt;lParam2 = lTemp;
00385     <span class="keywordflow">return</span> (lRet);
00386     UNREFERENCED_PARAMETER(fAnsi);
00387 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="transsub.c::TransHanjaMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransHanjaMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01042">1042</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00152">GetInputContextThread</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00184">HIBYTE</a>, <a class="el" href="../../d0/d0/immuser_8h-source.html#l00070">tagIMEDPI::ImeInfo</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00793">ImmLockImeDpi()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00824">ImmUnlockImeDpi()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>01043 {
01044     <span class="comment">// BUGBUG: We will use this function instead of ImmEscape().</span>
01045     LRESULT lRet;
01046     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
01047     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwThreadId = <a class="code" href="../../d4/d0/immcli_8h.html#a15">GetInputContextThread</a>(hImc);
01048 
01049     <span class="keywordflow">if</span> (dwThreadId == 0) {
01050         RIPMSG1(RIP_WARNING,
01051               <span class="stringliteral">"TransHanjaMode: GetInputContextThread(%lx) failed."</span>, hImc);
01052         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01053     }
01054 
01055     pImeDpi = <a class="code" href="../../d9/d0/immuser_8h.html#a45">ImmLockImeDpi</a>(<a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(dwThreadId));
01056     <span class="keywordflow">if</span> (pImeDpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01057         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01058 
01059     <span class="comment">/*</span>
01060 <span class="comment">     * Check if we need ANSI/Unicode conversion</span>
01061 <span class="comment">     */</span>
01062     <span class="keywordflow">if</span> (pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>.fdwProperty &amp; IME_PROP_UNICODE) {
01063         WCHAR wUni;
01064         <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>  chAnsi[2];
01065         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i, dchSource;
01066 
01067         <span class="comment">//The 4th word of imestruct32 contains dchSource</span>
01068         dchSource = *((LPSTR)lpIme + 3 * <span class="keyword">sizeof</span>(WORD));
01069 
01070         chAnsi[0] = *((LPSTR)lpIme + dchSource);
01071         chAnsi[1] = *((LPSTR)lpIme + dchSource + 1);
01072 
01073         i = MultiByteToWideChar(CP_ACP, MB_PRECOMPOSED, chAnsi, 2, &amp;wUni, 1);
01074 
01075         <span class="keywordflow">if</span> (i)  {
01076            *((LPSTR)lpIme + dchSource)   = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)LOWORD(<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(wUni));
01077            *((LPSTR)lpIme + dchSource+1) = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)LOWORD(<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(wUni));
01078         }
01079         <span class="keywordflow">else</span> {
01080            <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
01081            <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01082         }
01083     }
01084 
01085     <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
01086 
01087     <span class="keywordflow">if</span> (lRet = ImmEscape(<a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0), hImc, IME_HANJAMODE, lpIme))
01088         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hWndApp, WM_IME_NOTIFY, IMN_OPENCANDIDATE, 1L);
01089     <span class="keywordflow">return</span> (lRet);
01090 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="transsub.c::TranslateIMESubFunctions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TranslateIMESubFunctions           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">54</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d4/d3/w32_2ntuser_2client_2nt6_2pch_8h-source.html#l00039">DestroyWindow</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00046">IGSC_DEFIMCFALLBACK</a>, <a class="el" href="../../d8/d5/w32_2ntuser_2imm_2context_8c-source.html#l00225">ImmGetSaveContext()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00025">NULL_HIMC</a>, <a class="el" href="../../d7/d2/kcodecnv_8c-source.html#l00647">TransCodeConvert()</a>, <a class="el" href="../../d7/d2/kcodecnv_8c-source.html#l00689">TransConvertList()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00932">TransEnterWordRegisterMode()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00710">TransGetConversionMode()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01099">TransGetLevel()</a>, <a class="el" href="../../d7/d2/kcodecnv_8c-source.html#l00723">TransGetMNTable()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00654">TransGetMode()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00399">TransGetOpenJ()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00373">TransGetOpenK()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01042">TransHanjaMode()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00425">TransMoveImeWindow()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00828">TransSendVKey()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00989">TransSetConversionFontEx()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00575">TransSetConversionMode()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00450">TransSetConversionWindow()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01116">TransSetLevel()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00780">TransSetMode()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00331">TransSetOpenJ()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00311">TransSetOpenK()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d8/clwinnls_8c-source.html#l00081">SendIMEMessageAll()</a>.
<p>
<pre class="fragment"><div>00058 {
00059     HIMC        hImc;
00060     LRESULT     lRet;
00061     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       dwLangID;
00062 
00063     hImc = <a class="code" href="../../d4/d0/immcli_8h.html#a72">ImmGetSaveContext</a>( hWndApp, IGSC_DEFIMCFALLBACK );
00064     <span class="keywordflow">if</span> ( hImc == <a class="code" href="../../d8/d0/immstruc_8h.html#a0">NULL_HIMC</a> ) {
00065         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00066     }
00067 
00068     dwLangID = PRIMARYLANGID(LANGIDFROMLCID(GetSystemDefaultLCID()));
00069 
00070     <span class="keywordflow">switch</span> (lpIme-&gt;fnc) {
00071     <span class="keywordflow">case</span> 0x03:  <span class="comment">// IME_QUERY, IME_GETIMECAPS: KOREAN &amp; JAPANESE</span>
00072         lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00073         <span class="keywordflow">break</span>;
00074 
00075     <span class="keywordflow">case</span> 0x04:  <span class="comment">// IME_SETOPEN: KOREAN &amp; JAPANESE</span>
00076         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN )
00077             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a0">TransSetOpenK</a>( hWndApp, hImc, lpIme );
00078         <span class="keywordflow">else</span>
00079             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a1">TransSetOpenJ</a>( hWndApp, hImc, lpIme );
00080         <span class="keywordflow">break</span>;
00081 
00082     <span class="keywordflow">case</span> 0x05:  <span class="comment">// IME_GETOPEN: KOREAN &amp; JAPANESE</span>
00083         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN )
00084             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a2">TransGetOpenK</a>( hWndApp, hImc, lpIme, fAnsi );
00085         <span class="keywordflow">else</span>
00086             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a3">TransGetOpenJ</a>( hWndApp, hImc, lpIme, fAnsi );
00087         <span class="keywordflow">break</span>;
00088 
00089     <span class="keywordflow">case</span> 0x06:  <span class="comment">// IME_ENABLEDOSIME, IME_ENABLE</span>
00090     <span class="comment">// internal functions are not supported</span>
00091         lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00092         <span class="keywordflow">break</span>;
00093 
00094     <span class="keywordflow">case</span> 0x07:  <span class="comment">// IME_GETVERSION: KOREAN &amp; JAPANESE</span>
00095         lRet = IMEVER_31;
00096         <span class="keywordflow">break</span>;
00097 
00098     <span class="keywordflow">case</span> 0x08:  <span class="comment">// IME_MOVEIMEWINDOW, IME_SETCONVERSIONWINDOW: KOREAN &amp; JAPANESE</span>
00099 
00100         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN ) {
00101             <span class="comment">//</span>
00102             <span class="comment">// IME_MOVEIMEWINDOW for KOREAN</span>
00103             <span class="comment">//</span>
00104             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a4">TransMoveImeWindow</a>(hWndApp, hImc, lpIme);
00105         } <span class="keywordflow">else</span> {
00106             <span class="comment">//</span>
00107             <span class="comment">// IME_MOVECONVERTWINDOW or IME_SETCONVERSIONWINDOW for JAPANESE</span>
00108             <span class="comment">//</span>
00109             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a5">TransSetConversionWindow</a>( hWndApp, hImc, lpIme );
00110         }
00111         <span class="keywordflow">break</span>;
00112 
00113 <span class="comment">//  case 0x09:  // undefined</span>
00114 
00115     <span class="keywordflow">case</span> 0x10:  <span class="comment">// IME_SETCONVERSIONMODE: JAPANESE</span>
00116         <span class="keywordflow">if</span> ( dwLangID == LANG_JAPANESE ) {
00117             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a6">TransSetConversionMode</a>( hImc, lpIme );
00118         } <span class="keywordflow">else</span> {
00119             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00120         }
00121         <span class="keywordflow">break</span>;
00122 
00123     <span class="keywordflow">case</span> 0x11:  <span class="comment">// IME_GETCONVERSIONMODE, IME_GETMODE: // KOREAN &amp; JAPANESE</span>
00124         <span class="comment">// Use hSaveIMC, If WINNSEnableIME(FALSE).</span>
00125         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN ) {
00126         <span class="comment">//</span>
00127         <span class="comment">// IME_GETMODE for KOREAN</span>
00128         <span class="comment">//</span>
00129             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a7">TransGetMode</a>( hImc );
00130         } <span class="keywordflow">else</span> {
00131         <span class="comment">//</span>
00132         <span class="comment">// IME_GETCONVERSIONMODE for JAPANESE</span>
00133         <span class="comment">//</span>
00134             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a8">TransGetConversionMode</a>( hImc );
00135         }
00136         <span class="keywordflow">break</span>;
00137 
00138     <span class="keywordflow">case</span> 0x12:  <span class="comment">// IME_SET_MODE, IME_SETFONT, IME_SETCONVERSIONFONT: KOREAN &amp; JAPANESE</span>
00139         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN ) {
00140             <span class="comment">//</span>
00141             <span class="comment">// IME_SET_MODE for KOREAN</span>
00142             <span class="comment">//</span>
00143             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a9">TransSetMode</a>( hImc, lpIme );
00144         } <span class="keywordflow">else</span> {
00145             <span class="comment">//</span>
00146             <span class="comment">// IME_SETCONVERSIONFONT for JAPANESE</span>
00147             <span class="comment">//</span>
00148             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;   <span class="comment">// should not be called. use SETCONVERSIONFONTEX instead</span>
00149         }
00150         <span class="keywordflow">break</span>;
00151 
00152     <span class="keywordflow">case</span> 0x13:  <span class="comment">// IME_SENDVKEY, IME_SENDKEY: JAPANESE only</span>
00153         <span class="keywordflow">if</span> ( dwLangID == LANG_JAPANESE ) {
00154             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a10">TransSendVKey</a>( hWndApp, hImc, lpIme, fAnsi );
00155         } <span class="keywordflow">else</span> {
00156             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00157         }
00158         <span class="keywordflow">break</span>;
00159 
00160 <span class="comment">//</span>
00161 <span class="comment">// internal sub functions are not supported</span>
00162 <span class="comment">//</span>
00163 <span class="comment">//  case 0x14: // IME_DESTROY, IME_DESTROYIME</span>
00164 <span class="comment">//  case 0x15: // IME_PRIVATE</span>
00165 <span class="comment">//  case 0x16: // IME_WINDOWUPDATE</span>
00166 <span class="comment">//  case 0x17: // IME_SELECT</span>
00167 
00168     <span class="keywordflow">case</span> 0x18: <span class="comment">// IME_ENTERWORDREGISTERMODE: JAPANESE only</span>
00169         <span class="keywordflow">if</span> ( dwLangID == LANG_JAPANESE ) {
00170             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a11">TransEnterWordRegisterMode</a>( hWndApp, lpIme, fAnsi);
00171         } <span class="keywordflow">else</span> {
00172             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00173         }
00174         <span class="keywordflow">break</span>;
00175 
00176     <span class="keywordflow">case</span> 0x19:  <span class="comment">// IME_SETCONVERSIONFONTEX: JAPANESE only</span>
00177         <span class="keywordflow">if</span> ( dwLangID == LANG_JAPANESE ) {
00178             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a12">TransSetConversionFontEx</a>( hWndApp, hImc, lpIme, fAnsi);
00179         } <span class="keywordflow">else</span> {
00180             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00181         }
00182         <span class="keywordflow">break</span>;
00183 
00184 <span class="comment">//</span>
00185 <span class="comment">// internal sub functions are not supported</span>
00186 <span class="comment">//</span>
00187 <span class="comment">//  case 0x1A: // IME_DBCSNAME</span>
00188 <span class="comment">//  case 0x1B: // IME_MAXKEY</span>
00189 <span class="comment">//  case 0x1C: // IME_WINNLS_SK</span>
00190 
00191     <span class="keywordflow">case</span> 0x20:  <span class="comment">// IME_CODECONVERT: KOREAN only</span>
00192         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN ) {
00193             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d3/kcodecnv_8c.html#a18">TransCodeConvert</a>( hImc, lpIme))
00194                 lRet = lpIme-&gt;wParam;
00195             <span class="keywordflow">else</span>
00196                 lRet = 0;
00197         } <span class="keywordflow">else</span> {
00198             lRet = 0;
00199         }
00200         <span class="keywordflow">break</span>;
00201 
00202     <span class="keywordflow">case</span> 0x21:  <span class="comment">// IME_CONVERTLIST: KOREAN only</span>
00203         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN ) {
00204             lRet = <a class="code" href="../../d6/d3/kcodecnv_8c.html#a19">TransConvertList</a>( hImc, lpIme);
00205         } <span class="keywordflow">else</span> {
00206             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00207         }
00208         <span class="keywordflow">break</span>;
00209 
00210 <span class="comment">//</span>
00211 <span class="comment">// internal sub functions and undefined sub functions are not supported</span>
00212 <span class="comment">//</span>
00213 <span class="comment">//  case 0x22:  // IME_INPUTKEYTOSEQUENCE</span>
00214 <span class="comment">//  case 0x23:  // IME_SEQUENCETOINTERNAL</span>
00215 <span class="comment">//  case 0x24:  // IME_QUERYIMEINFO</span>
00216 <span class="comment">//  case 0x25:  // IME_DIALOG</span>
00217 <span class="comment">//  case 0x26 - 0x2f:   // undefined</span>
00218 
00219     <span class="keywordflow">case</span> 0x30:  <span class="comment">// IME_AUTOMATA: KOREAN only</span>
00220         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN ) {
00221             lRet = ImmEscape(<a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0), hImc, IME_AUTOMATA, lpIme);
00222         } <span class="keywordflow">else</span> {
00223             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00224         }
00225         <span class="keywordflow">break</span>;
00226 
00227     <span class="keywordflow">case</span> 0x31:  <span class="comment">// IME_HANJAMODE: KOREAN only</span>
00228         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN ) {
00229             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a13">TransHanjaMode</a>( hWndApp,  hImc, lpIme);
00230         } <span class="keywordflow">else</span> {
00231             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00232         }
00233         <span class="keywordflow">break</span>;
00234 <span class="comment">//</span>
00235 <span class="comment">//  case 0x32 - 0x3f: // undefined</span>
00236 <span class="comment">//</span>
00237     <span class="keywordflow">case</span> 0x40:  <span class="comment">// IME_GETLEVEL: KOREAN only</span>
00238         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN ) {
00239             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a25">TransGetLevel</a>( hWndApp );
00240         } <span class="keywordflow">else</span> {
00241             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00242         }
00243         <span class="keywordflow">break</span>;
00244 
00245     <span class="keywordflow">case</span> 0x41:  <span class="comment">// IME_SETLEVEL: KOREAN only</span>
00246         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN ) {
00247             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a26">TransSetLevel</a>( hWndApp, lpIme);
00248         } <span class="keywordflow">else</span> {
00249             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00250         }
00251         <span class="keywordflow">break</span>;
00252 
00253     <span class="keywordflow">case</span> 0x42:  <span class="comment">// IME_GETMNTABLE: KOREAN only</span>
00254         <span class="keywordflow">if</span> ( dwLangID == LANG_KOREAN ) {
00255             lRet = <a class="code" href="../../d6/d3/kcodecnv_8c.html#a20">TransGetMNTable</a>( hImc, lpIme);
00256         } <span class="keywordflow">else</span> {
00257             lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00258         }
00259         <span class="keywordflow">break</span>;
00260 
00261 <span class="preprocessor">#if defined(PENAPI)</span>
00262 <span class="preprocessor"></span>    <span class="keywordflow">case</span> IME_SETUNDETERMINESTRING:
00263         lRet = FSetUndetermine( hImc, (HGLOBAL)lpIME-&gt;lParam1);
00264         <span class="keywordflow">break</span>;
00265 
00266     <span class="keywordflow">case</span> IME_SETCAPTURE:
00267         lRet = FEnablePenUi((HWND)lpIME-&gt;wParam, (lpIME-&gt;wParam != NULL));
00268         <span class="keywordflow">break</span>;
00269 <span class="preprocessor">#endif</span>
00270 <span class="preprocessor"></span>
00271 <span class="preprocessor">#ifdef LATER // IME_NOTIFYWOWTASKEXIT</span>
00272 <span class="preprocessor"></span>    <span class="keywordflow">case</span> IME_NOTIFYWOWTASKEXIT:
00273       <span class="comment">//</span>
00274       <span class="comment">// Destroy the default IME window of WOW 16bit</span>
00275       <span class="comment">// applications now. We should not wait for the</span>
00276       <span class="comment">// server wow thread clean up that will destroy the</span>
00277       <span class="comment">// IME window because usrsrv won't send WM_DESTROY</span>
00278       <span class="comment">// to non-server side window procedures. Some IMEs</span>
00279       <span class="comment">// must receive WM_DESTROY to free up 32 bit objects.</span>
00280       <span class="comment">//</span>
00281       <span class="comment">//  kksuzuka #7982:IME memory leak on WOW16 applications.</span>
00282       <span class="comment">//</span>
00283       PIMMTHREADINFO piti = PitiCurrent();
00284 
00285       <span class="keywordflow">if</span> ( piti != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; <a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>( piti-&gt;hwndDefaultIme ) ) {
00286           <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a3">DestroyWindow</a>( piti-&gt;hwndDefaultIme );
00287       }
00288       <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00289 <span class="preprocessor">#endif</span>
00290 <span class="preprocessor"></span>    <span class="keywordflow">default</span>:
00291         <span class="comment">//</span>
00292         <span class="comment">// private/internal/undefined functions are not supported</span>
00293         <span class="comment">//</span>
00294         lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00295         <span class="keywordflow">break</span>;
00296     }
00297 
00298     <span class="keywordflow">return</span> (lRet);
00299 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="transsub.c::TransMoveImeWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransMoveImeWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00425">425</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00593">ClientToScreen()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00143">GET_X_LPARAM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00147">GET_Y_LPARAM</a>, and <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00426 {
00427     <span class="comment">// BUGBUG: We will use this function instead of ImmEscape().</span>
00428     POINT   pt;
00429     LRESULT lRet;
00430 
00431     <span class="keywordflow">if</span> (lpIme-&gt;wParam == MCW_WINDOW)
00432     {
00433         pt.x = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(lpIme-&gt;lParam1);
00434         pt.y = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(lpIme-&gt;lParam1);
00435         <a class="code" href="../../d3/d9/client_2wow_8c.html#a23">ClientToScreen</a>(hWndApp, &amp;pt);
00436         lpIme-&gt;lParam1 = MAKELONG(pt.x, pt.y);
00437     }
00438     lRet = ImmEscape(<a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0), hImc, IME_MOVEIMEWINDOW, lpIme);
00439     <span class="keywordflow">return</span> (lRet);
00440 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="transsub.c::TransSendVKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransSendVKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00828">828</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00575">ImmConfigureIMEA()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00707">ImmConfigureIMEW()</a>, <a class="el" href="../../d8/d5/w32_2ntuser_2imm_2context_8c-source.html#l00201">ImmGetContext()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l01294">ImmNotifyIME()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01136">TransVKDBEMode()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00829 {
00830     LRESULT lRet;
00831 
00832     <span class="keywordflow">switch</span> (lpIme-&gt;wParam)
00833     {
00834         <span class="comment">// VK_DBE_xxx Support Check.</span>
00835         <span class="keywordflow">case</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(-1):
00836         <span class="keywordflow">case</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(0x0000ffff):   <span class="comment">// from WOW16</span>
00837             <span class="keywordflow">switch</span> (lpIme-&gt;wCount)
00838             {
00839                 <span class="keywordflow">case</span> VK_DBE_ALPHANUMERIC:
00840                 <span class="keywordflow">case</span> VK_DBE_KATAKANA:
00841                 <span class="keywordflow">case</span> VK_DBE_HIRAGANA:
00842                 <span class="keywordflow">case</span> VK_DBE_SBCSCHAR:
00843                 <span class="keywordflow">case</span> VK_DBE_DBCSCHAR:
00844                 <span class="keywordflow">case</span> VK_DBE_ROMAN:
00845                 <span class="keywordflow">case</span> VK_DBE_NOROMAN:
00846                 <span class="keywordflow">case</span> VK_DBE_CODEINPUT:
00847                 <span class="keywordflow">case</span> VK_DBE_NOCODEINPUT:
00848                 <span class="keywordflow">case</span> VK_DBE_ENTERWORDREGISTERMODE:
00849                 <span class="keywordflow">case</span> VK_DBE_ENTERIMECONFIGMODE:
00850                 <span class="keywordflow">case</span> VK_DBE_ENTERDLGCONVERSIONMODE:
00851                 <span class="keywordflow">case</span> VK_DBE_DETERMINESTRING:
00852                 <span class="keywordflow">case</span> VK_DBE_FLUSHSTRING:
00853                 <span class="keywordflow">case</span> VK_CONVERT:
00854                     lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00855                     <span class="keywordflow">break</span>;
00856 
00857                 <span class="keywordflow">default</span>:
00858                     lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00859                     <span class="keywordflow">break</span>;
00860             }
00861             <span class="keywordflow">break</span>;
00862 
00863         <span class="keywordflow">case</span> VK_DBE_ALPHANUMERIC:
00864         <span class="keywordflow">case</span> VK_DBE_KATAKANA:
00865         <span class="keywordflow">case</span> VK_DBE_HIRAGANA:
00866         <span class="keywordflow">case</span> VK_DBE_SBCSCHAR:
00867         <span class="keywordflow">case</span> VK_DBE_DBCSCHAR:
00868         <span class="keywordflow">case</span> VK_DBE_ROMAN:
00869         <span class="keywordflow">case</span> VK_DBE_NOROMAN:
00870         <span class="keywordflow">case</span> VK_DBE_CODEINPUT:
00871         <span class="keywordflow">case</span> VK_DBE_NOCODEINPUT:
00872             lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a16">TransVKDBEMode</a>(hImc, lpIme-&gt;wParam);
00873             <span class="keywordflow">break</span>;
00874 
00875         <span class="keywordflow">case</span> VK_DBE_ENTERWORDREGISTERMODE:
00876             {
00877             HKL hkl = <a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0L);
00878 
00879             <span class="keywordflow">if</span> ( fAnsi )
00880                 lRet = <a class="code" href="../../d6/d0/immime_8c.html#a16">ImmConfigureIMEA</a>(hkl, hWndApp, IME_CONFIG_REGISTERWORD, NULL);
00881             <span class="keywordflow">else</span>
00882                 lRet = <a class="code" href="../../d6/d0/immime_8c.html#a17">ImmConfigureIMEW</a>(hkl, hWndApp, IME_CONFIG_REGISTERWORD, NULL);
00883             }
00884             <span class="keywordflow">break</span>;
00885 
00886         <span class="keywordflow">case</span> VK_DBE_ENTERIMECONFIGMODE:
00887             {
00888                 HKL hkl = <a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0L);
00889                 <span class="keywordflow">if</span> (fAnsi)
00890                     lRet = <a class="code" href="../../d6/d0/immime_8c.html#a16">ImmConfigureIMEA</a>(hkl, hWndApp, IME_CONFIG_GENERAL, NULL);
00891                 <span class="keywordflow">else</span>
00892                     lRet = <a class="code" href="../../d6/d0/immime_8c.html#a17">ImmConfigureIMEW</a>(hkl, hWndApp, IME_CONFIG_GENERAL, NULL);
00893             }
00894             <span class="keywordflow">break</span>;
00895 
00896         <span class="keywordflow">case</span> VK_DBE_ENTERDLGCONVERSIONMODE:
00897 <span class="preprocessor">#if defined(PENAPI)</span>
00898 <span class="preprocessor"></span>            FInitPenUi(hIMC);
00899 <span class="preprocessor">#endif</span>
00900 <span class="preprocessor"></span>            lRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00901             <span class="keywordflow">break</span>;
00902 
00903         <span class="keywordflow">case</span> VK_DBE_DETERMINESTRING:
00904             <span class="comment">// Check there is the composition string or not.</span>
00905             lRet = <a class="code" href="../../d6/d0/immime_8c.html#a22">ImmNotifyIME</a>( <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a5">ImmGetContext</a>(hWndApp),
00906                                  NI_COMPOSITIONSTR,
00907                                  CPS_COMPLETE,
00908                                  0L);
00909             <span class="keywordflow">break</span>;
00910 
00911         <span class="keywordflow">case</span> VK_DBE_FLUSHSTRING:
00912             lRet = <a class="code" href="../../d6/d0/immime_8c.html#a22">ImmNotifyIME</a>( hImc, NI_COMPOSITIONSTR,CPS_CANCEL,0L);
00913             <span class="keywordflow">break</span>;
00914 
00915         <span class="keywordflow">case</span> VK_CONVERT:
00916             lRet = <a class="code" href="../../d6/d0/immime_8c.html#a22">ImmNotifyIME</a>( hImc, NI_COMPOSITIONSTR, CPS_CONVERT, 0L);
00917             <span class="keywordflow">break</span>;
00918 
00919         <span class="keywordflow">default</span>:
00920             <span class="keywordflow">break</span>;
00921     }
00922     <span class="keywordflow">return</span> lRet;
00923 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="transsub.c::TransSetConversionFontEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransSetConversionFontEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00989">989</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01287">FixLogfont()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00371">ImmLockIMC()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00383">ImmUnlockIMC()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01328">MySetCompFont()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00990 {
00991     LPINPUTCONTEXT pInputContext;
00992     LRESULT lRet;
00993     LPLOGFONTW lplf;
00994     LOGFONTW  lfw;
00995 
00996     pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>( hImc );
00997     <span class="keywordflow">if</span> ( pInputContext == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00998         <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00999     }
01000 
01001     lplf = (LPLOGFONTW)GlobalLock((HGLOBAL)lpIme-&gt;lParam1);
01002     <span class="keywordflow">if</span> ( lplf == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
01003     {
01004         <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>( hImc );
01005         <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01006     }
01007     <span class="keywordflow">if</span> ( fAnsi ) {
01008         memcpy( &amp;lfw, lplf, <span class="keyword">sizeof</span>(LOGFONTA) );
01009         MultiByteToWideChar( CP_ACP,
01010                              0,
01011                              (LPCSTR)lplf-&gt;lfFaceName,     <span class="comment">// src</span>
01012                              LF_FACESIZE,          <span class="comment">// size of src</span>
01013                              lfw.lfFaceName,       <span class="comment">// destination buffer</span>
01014                              LF_FACESIZE );        <span class="comment">// size of destination buffer</span>
01015     } <span class="keywordflow">else</span> {
01016         memcpy( &amp;lfw, lplf, <span class="keyword">sizeof</span>(LOGFONTW));
01017     }
01018     GlobalUnlock((HGLOBAL)lpIme-&gt;lParam1);
01019 
01020     <span class="keywordflow">if</span> (( pInputContext-&gt;fdw31Compat &amp; F31COMPAT_MCWVERTICAL)) {
01021         lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a19">FixLogfont</a>( &amp;lfw, TRUE);
01022     } <span class="keywordflow">else</span> {
01023         lRet = <a class="code" href="../../d2/d5/transsub_8c.html#a19">FixLogfont</a>( &amp;lfw, FALSE);
01024     }
01025     <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>( hImc );
01026 
01027     <span class="keywordflow">if</span> (lRet == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ) {
01028         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01029     }
01030 
01031     <span class="keywordflow">return</span> <a class="code" href="../../d2/d5/transsub_8c.html#a20">MySetCompFont</a>( hWndApp, hImc, &amp;lfw );
01032 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="transsub.c::TransSetConversionMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransSetConversionMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00575">575</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00734">Get31ModeFrom40ModeJ()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01368">ImmGetConversionStatus()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01402">ImmSetConversionStatus()</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00576 {
00577     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fdwConversion, fdwSentence, fdwNewConversion, fdwMask;
00578     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  uPrevMode;
00579     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  u31Mode;
00580 
00581     <span class="comment">//</span>
00582     <span class="comment">// Get current conversion mode and translate it to</span>
00583     <span class="comment">// the 3.1 style conversion mode.</span>
00584     <span class="comment">//</span>
00585     <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a29">ImmGetConversionStatus</a>( hImc, &amp;fdwConversion, &amp;fdwSentence);
00586     uPrevMode = <a class="code" href="../../d2/d5/transsub_8c.html#a14">Get31ModeFrom40ModeJ</a>( fdwConversion );
00587 
00588     <span class="comment">//</span>
00589     <span class="comment">// translate requested 3.1 conversion mode to 4.0 conversion mode</span>
00590     <span class="comment">//</span>
00591     fdwNewConversion = 0;
00592     u31Mode = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)lpIme-&gt;wParam;
00593 
00594     <span class="keywordflow">switch</span> ( u31Mode &amp; 0x07 ) {
00595     <span class="keywordflow">case</span> IME_MODE_ALPHANUMERIC:
00596         fdwNewConversion &amp;= ~IME_CMODE_LANGUAGE;
00597         <span class="keywordflow">break</span>;
00598     <span class="keywordflow">case</span> IME_MODE_KATAKANA:
00599         fdwNewConversion |= IME_CMODE_NATIVE|IME_CMODE_KATAKANA;
00600         <span class="keywordflow">break</span>;
00601     <span class="keywordflow">case</span> IME_MODE_HIRAGANA:
00602         fdwNewConversion |= IME_CMODE_NATIVE;
00603         <span class="keywordflow">break</span>;
00604     }
00605     <span class="keywordflow">if</span> ( !(u31Mode &amp; JAPAN_IME_MODE_SBCSCHAR) )
00606         fdwNewConversion |= IME_CMODE_FULLSHAPE;
00607 
00608     <span class="keywordflow">if</span> ( u31Mode &amp; IME_MODE_ROMAN )
00609         fdwNewConversion |= IME_CMODE_ROMAN;
00610 
00611     <span class="keywordflow">if</span> ( u31Mode &amp; IME_MODE_CODEINPUT )
00612         fdwNewConversion |= IME_CMODE_CHARCODE;
00613 
00614     <span class="comment">//</span>
00615     <span class="comment">// compute the mask bit. we need to compute this because</span>
00616     <span class="comment">// application may set only bit needed to be changed.</span>
00617     <span class="comment">//</span>
00618     fdwMask = 0;
00619     <span class="keywordflow">if</span> ( u31Mode &amp; (IME_MODE_ROMAN | IME_MODE_NOROMAN) )
00620         fdwMask |= IME_CMODE_ROMAN;
00621 
00622     <span class="keywordflow">if</span> ( u31Mode &amp; (IME_MODE_CODEINPUT|IME_MODE_NOCODEINPUT) )
00623         fdwMask |= IME_CMODE_CHARCODE;
00624 
00625     <span class="keywordflow">if</span> ( u31Mode &amp; 0x07 )
00626         fdwMask |= IME_CMODE_LANGUAGE;
00627 
00628     <span class="keywordflow">if</span> ( u31Mode &amp; (IME_MODE_DBCSCHAR|JAPAN_IME_MODE_SBCSCHAR) )
00629         fdwMask |= IME_CMODE_FULLSHAPE;
00630 
00631     <span class="comment">//</span>
00632     <span class="comment">// set the new mode</span>
00633     <span class="comment">//</span>
00634     fdwNewConversion = (fdwNewConversion &amp; fdwMask) | (fdwConversion &amp; ~fdwMask);
00635     <span class="keywordflow">if</span> ( <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a30">ImmSetConversionStatus</a>( hImc, fdwNewConversion, fdwSentence) ) {
00636         <span class="keywordflow">return</span> (LRESULT)uPrevMode;
00637     } <span class="keywordflow">else</span> {
00638         <span class="keywordflow">return</span> (LRESULT)0;
00639     }
00640 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="transsub.c::TransSetConversionWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransSetConversionWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00450">450</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00593">ClientToScreen()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00143">GET_X_LPARAM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00147">GET_Y_LPARAM</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00090">GetFocus()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00371">ImmLockIMC()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00383">ImmUnlockIMC()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01198">IsForegroundThread()</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00168">IsWndEqual</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00155">MapWindowPoints()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01441">MySetCandidateWindow()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01396">MySetCompWindow()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00670">ScreenToClient()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01222">SetFontForMCWVERTICAL()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00451 {
00452     LPINPUTCONTEXT pInputContext;
00453     COMPOSITIONFORM cof;
00454     CANDIDATEFORM   caf;
00455     POINT pt;
00456     RECT  rt;
00457     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>   i;
00458 
00459     <span class="keywordflow">if</span> ( ! <a class="code" href="../../d2/d5/transsub_8c.html#a18">IsForegroundThread</a>(NULL) &amp;&amp; !<a class="code" href="../../d3/d8/winmgrc_8c.html#a11">GetFocus</a>() ) {
00460         <span class="comment">//</span>
00461         <span class="comment">// For win95 compatibility, we need to return TRUE though we</span>
00462         <span class="comment">// didn't really succeed. PP4 calls us when it doesn't have</span>
00463         <span class="comment">// the input focus to check if IME is capable to do the specfied</span>
00464         <span class="comment">// MCW_xxx. Returning TRUE here will make such application happy.</span>
00465         <span class="comment">//</span>
00466         <span class="keywordflow">return</span> ( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00467     }
00468 
00469     pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>( hImc );
00470     <span class="keywordflow">if</span> ( pInputContext == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00471         <span class="keywordflow">return</span> ( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00472     }
00473 
00474     pt.x      = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(lpIme-&gt;lParam1);
00475     pt.y      = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(lpIme-&gt;lParam1);
00476     rt.left   = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(lpIme-&gt;lParam2);
00477     rt.top    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(lpIme-&gt;lParam2);
00478     rt.right  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(lpIme-&gt;lParam3);
00479     rt.bottom = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(lpIme-&gt;lParam3);
00480 
00481     cof.dwStyle = CFS_DEFAULT;
00482 
00483     <span class="keywordflow">if</span> ( lpIme-&gt;wParam &amp; MCW_HIDDEN ) {
00484         pInputContext-&gt;fdw31Compat |= F31COMPAT_MCWHIDDEN;
00485         <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>( pInputContext-&gt;hWnd, &amp;pt );
00486         <a class="code" href="../../d3/d8/winmgrc_8c.html#a15">MapWindowPoints</a>( HWND_DESKTOP, pInputContext-&gt;hWnd, (LPPOINT)&amp;rt, 2);
00487     } <span class="keywordflow">else</span> {
00488         pInputContext-&gt;fdw31Compat &amp;= ~F31COMPAT_MCWHIDDEN;
00489     }
00490 
00491     <span class="keywordflow">if</span> ( lpIme-&gt;wParam &amp; MCW_WINDOW) {
00492         <span class="keywordflow">if</span> ( !<a class="code" href="../../d4/d0/immcli_8h.html#a22">IsWndEqual</a>(hWndApp, pInputContext-&gt;hWnd)) {
00493             <a class="code" href="../../d3/d9/client_2wow_8c.html#a23">ClientToScreen</a>(hWndApp, &amp;pt);
00494             <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>(pInputContext-&gt;hWnd, &amp;pt);
00495             <span class="keywordflow">if</span> (lpIme-&gt;wParam &amp; MCW_RECT) {
00496                 cof.dwStyle = CFS_RECT;
00497                 <a class="code" href="../../d3/d8/winmgrc_8c.html#a15">MapWindowPoints</a>(hWndApp, HWND_DESKTOP, (LPPOINT)&amp;rt, 2);
00498                 <a class="code" href="../../d3/d8/winmgrc_8c.html#a15">MapWindowPoints</a>(HWND_DESKTOP, pInputContext-&gt;hWnd, (LPPOINT)&amp;rt, 2);
00499             } <span class="keywordflow">else</span> {
00500                 cof.dwStyle = CFS_POINT;
00501             }
00502         } <span class="keywordflow">else</span> {
00503             <span class="keywordflow">if</span> ( lpIme-&gt;wParam &amp; MCW_RECT) {
00504                 cof.dwStyle = CFS_RECT;
00505             } <span class="keywordflow">else</span> {
00506                 cof.dwStyle = CFS_POINT;
00507             }
00508         }
00509     }
00510 
00511     <span class="comment">// Because Chicago IME can not handle CFS_SCREEN. The points should be</span>
00512     <span class="comment">// converted to client point.</span>
00513     <span class="comment">// If these points are out of Client, HOW SHOULD WE DO????</span>
00514 
00515     <span class="keywordflow">if</span> ( lpIme-&gt;wParam &amp; MCW_SCREEN ) {
00516         <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>( pInputContext-&gt;hWnd, &amp;pt );
00517         <span class="keywordflow">if</span> ( lpIme-&gt;wParam &amp; CFS_RECT ) {
00518             cof.dwStyle = CFS_RECT;
00519             <a class="code" href="../../d3/d8/winmgrc_8c.html#a15">MapWindowPoints</a>( HWND_DESKTOP, pInputContext-&gt;hWnd, (LPPOINT)&amp;rt, 2 );
00520         }
00521         <span class="keywordflow">else</span> {
00522             cof.dwStyle = CFS_POINT;
00523         }
00524     }
00525 
00526     <span class="keywordflow">if</span> ( lpIme-&gt;wParam &amp; MCW_VERTICAL) {
00527         <span class="keywordflow">if</span> ( !(pInputContext-&gt;fdw31Compat &amp; F31COMPAT_MCWVERTICAL) ) {
00528             pInputContext-&gt;fdw31Compat |= F31COMPAT_MCWVERTICAL;
00529             <a class="code" href="../../d2/d5/transsub_8c.html#a17">SetFontForMCWVERTICAL</a>( hWndApp, hImc, pInputContext, TRUE);
00530         }
00531     } <span class="keywordflow">else</span> {
00532         <span class="keywordflow">if</span> (pInputContext-&gt;fdw31Compat &amp; F31COMPAT_MCWVERTICAL) {
00533             pInputContext-&gt;fdw31Compat &amp;= ~F31COMPAT_MCWVERTICAL;
00534             <a class="code" href="../../d2/d5/transsub_8c.html#a17">SetFontForMCWVERTICAL</a>( hWndApp, hImc, pInputContext, FALSE);
00535         }
00536     }
00537     cof.ptCurrentPos = pt;
00538     cof.rcArea       = rt;
00539 
00540 <span class="preprocessor">#if defined(PENAPI)</span>
00541 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( !FSetPosPenUi(&amp;cof) )
00542 <span class="preprocessor">#endif</span>
00543 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( !(pInputContext-&gt;fdw31Compat &amp; F31COMPAT_MCWHIDDEN) ) {
00544         <a class="code" href="../../d2/d5/transsub_8c.html#a21">MySetCompWindow</a>( hWndApp, hImc, (LPCOMPOSITIONFORM)&amp;cof );
00545     } <span class="keywordflow">else</span> {
00546         <span class="comment">// Hack for 3.1 Apps. We save the exlude area into IMC.</span>
00547         pInputContext-&gt;cfCompForm.ptCurrentPos = cof.ptCurrentPos;
00548         pInputContext-&gt;cfCompForm.rcArea       = cof.rcArea;
00549 
00550         <span class="keywordflow">for</span> ( i=0; i &lt; 4; i++ ) {
00551             <span class="keywordflow">if</span> ( pInputContext-&gt;cfCandForm[i].dwIndex != -1)
00552             {
00553                 caf.dwIndex = i;
00554                 caf.dwStyle = CFS_EXCLUDE;
00555                 caf.ptCurrentPos = pt;
00556                 caf.rcArea       = rt;
00557                 <a class="code" href="../../d2/d5/transsub_8c.html#a22">MySetCandidateWindow</a>( hWndApp, hImc, (LPCANDIDATEFORM)&amp;caf );
00558             }
00559         }
00560     }
00561     <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>( hImc );
00562     <span class="keywordflow">return</span> ( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00563 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="transsub.c::TransSetLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransSetLevel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01116">1116</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l12887">NtUserSetAppImeLevel()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>01117 {
01118     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLevel;
01119 
01120     dwLevel = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)lpIme-&gt;wParam;
01121     <span class="keywordflow">if</span> ( dwLevel &gt;= 1 &amp;&amp; dwLevel &lt;= 5 ) {
01122         <span class="keywordflow">if</span> ( <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a395">NtUserSetAppImeLevel</a>(hWndApp, dwLevel) ) {
01123             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01124         }
01125     }
01126     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01127 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="transsub.c::TransSetMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransSetMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00780">780</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00677">Get31ModeFrom40ModeK()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01368">ImmGetConversionStatus()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01402">ImmSetConversionStatus()</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00781 {
00782     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fdwConversion, fdwSentence, fdwNewConversion, fdwMask;
00783     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  uPrevMode;
00784     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  u31Mode;
00785 
00786     <span class="comment">//</span>
00787     <span class="comment">// Get current conversion mode and translate it to</span>
00788     <span class="comment">// the 3.1 style conversion mode.</span>
00789     <span class="comment">//</span>
00790     <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a29">ImmGetConversionStatus</a>( hImc, &amp;fdwConversion, &amp;fdwSentence);
00791     uPrevMode = <a class="code" href="../../d2/d5/transsub_8c.html#a15">Get31ModeFrom40ModeK</a>( fdwConversion );
00792 
00793     <span class="comment">//</span>
00794     <span class="comment">// translate requested 3.1 conversion mode to 4.0 conversion mode</span>
00795     <span class="comment">//</span>
00796     fdwNewConversion = 0;
00797     u31Mode = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)lpIme-&gt;wParam;
00798 
00799     <span class="keywordflow">if</span> ( !(u31Mode &amp; IME_MODE_ALPHANUMERIC) )
00800         fdwNewConversion |= IME_CMODE_HANGEUL;
00801     <span class="keywordflow">if</span> ( !(u31Mode &amp; KOREA_IME_MODE_SBCSCHAR) )
00802         fdwConversion |= IME_CMODE_FULLSHAPE;
00803 
00804     <span class="comment">//</span>
00805     <span class="comment">// In HWin3.1 there is no "not modification mode"</span>
00806     <span class="comment">//</span>
00807     fdwMask = IME_CMODE_LANGUAGE|IME_CMODE_FULLSHAPE|IME_CMODE_HANJACONVERT;
00808 
00809     <span class="comment">//</span>
00810     <span class="comment">// set the new mode</span>
00811     <span class="comment">//</span>
00812     fdwNewConversion = (fdwNewConversion &amp; fdwMask) | (fdwConversion &amp; ~fdwMask);
00813     <span class="keywordflow">if</span> ( <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a30">ImmSetConversionStatus</a>( hImc, fdwNewConversion, fdwSentence) ) {
00814         <span class="keywordflow">return</span> (LRESULT)uPrevMode;
00815     } <span class="keywordflow">else</span> {
00816         <span class="keywordflow">return</span> (LRESULT)0;
00817     }
00818     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00819 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="transsub.c::TransSetOpenJ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransSetOpenJ           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00331">331</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00090">GetFocus()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01494">ImmGetOpenStatus()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00371">ImmLockIMC()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l01294">ImmNotifyIME()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01525">ImmSetOpenStatus()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00383">ImmUnlockIMC()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l01198">IsForegroundThread()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00332 {
00333     LRESULT lRet;
00334 
00335     lRet = <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a31">ImmGetOpenStatus</a>( hImc );
00336     <span class="comment">//</span>
00337     <span class="comment">// if the owner thread of hIMC doesn't have the input focus,</span>
00338     <span class="comment">// we won't call UI.</span>
00339     <span class="comment">//</span>
00340     <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/d5/transsub_8c.html#a18">IsForegroundThread</a>( NULL ) &amp;&amp; !<a class="code" href="../../d3/d8/winmgrc_8c.html#a11">GetFocus</a>() ) {
00341         <span class="comment">//</span>
00342         <span class="comment">// this thread doesn't have focus.</span>
00343         <span class="comment">// let's update the input context and return without calling UI</span>
00344         <span class="comment">//</span>
00345         PINPUTCONTEXT pInputContext;
00346 
00347         <span class="keywordflow">if</span> ( (pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>(hImc)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00348             <span class="keywordflow">if</span> ( (pInputContext-&gt;fOpen &amp;&amp; ! lpIme-&gt;wParam ) ||
00349                  (!pInputContext-&gt;fOpen &amp;&amp;  lpIme-&gt;wParam ) )
00350             {
00351                 pInputContext-&gt;fOpen = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)lpIme-&gt;wParam;
00352                 <a class="code" href="../../d6/d0/immime_8c.html#a22">ImmNotifyIME</a>( hImc, NI_CONTEXTUPDATED, 0, IMC_SETOPENSTATUS);
00353             }
00354             <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>( hImc );
00355         }
00356     } <span class="keywordflow">else</span> {
00357         <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a32">ImmSetOpenStatus</a>( hImc, (BOOL)lpIme-&gt;wParam );
00358     }
00359     <span class="keywordflow">return</span> lRet;
00360     UNREFERENCED_PARAMETER(hWndApp);
00361 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="transsub.c::TransSetOpenK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransSetOpenK           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWndApp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPIMESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIme</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l00311">311</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d4/d7/client_8c-source.html#l04502">GetKeyboardLayout()</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00054">TranslateIMESubFunctions()</a>.
<p>
<pre class="fragment"><div>00312 {
00313     <span class="comment">// BUGBUG: We will use this function instead of ImmEscape().</span>
00314     LRESULT lRet;
00315 
00316     lRet = ImmEscape(<a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>(0), hImc, IME_SETOPEN, lpIme);
00317     <span class="keywordflow">return</span> (lRet);
00318     UNREFERENCED_PARAMETER(hWndApp);
00319 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="transsub.c::TransVKDBEMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT TransVKDBEMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HIMC&nbsp;</td>
          <td class="mdname" nowrap> <em>hImc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wVKDBE</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/transsub_8c-source.html#l01136">1136</a> of file <a class="el" href="../../d3/d4/transsub_8c-source.html">transsub.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01368">ImmGetConversionStatus()</a>, and <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01402">ImmSetConversionStatus()</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/transsub_8c-source.html#l00828">TransSendVKey()</a>.
<p>
<pre class="fragment"><div>01137 {
01138     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fdwConversion,fdwSentence;
01139 
01140     <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a29">ImmGetConversionStatus</a>(hImc, &amp;fdwConversion, &amp;fdwSentence);
01141 
01142     <span class="keywordflow">switch</span> (wVKDBE)
01143     {
01144         <span class="keywordflow">case</span> VK_DBE_ALPHANUMERIC:
01145             fdwConversion &amp;= ~IME_CMODE_LANGUAGE;
01146             <span class="keywordflow">break</span>;
01147 
01148         <span class="keywordflow">case</span> VK_DBE_KATAKANA:
01149             fdwConversion |= (IME_CMODE_JAPANESE | IME_CMODE_KATAKANA);
01150             <span class="keywordflow">break</span>;
01151 
01152         <span class="keywordflow">case</span> VK_DBE_HIRAGANA:
01153             fdwConversion &amp;= ~IME_CMODE_KATAKANA;
01154             fdwConversion |= IME_CMODE_JAPANESE;
01155             <span class="keywordflow">break</span>;
01156 
01157         <span class="keywordflow">case</span> VK_DBE_SBCSCHAR:
01158             fdwConversion &amp;= ~IME_CMODE_FULLSHAPE;
01159             <span class="keywordflow">break</span>;
01160 
01161         <span class="keywordflow">case</span> VK_DBE_DBCSCHAR:
01162             fdwConversion |= IME_CMODE_FULLSHAPE;
01163             <span class="keywordflow">break</span>;
01164 
01165         <span class="keywordflow">case</span> VK_DBE_ROMAN:
01166             fdwConversion |= IME_CMODE_ROMAN;
01167             <span class="keywordflow">break</span>;
01168 
01169         <span class="keywordflow">case</span> VK_DBE_NOROMAN:
01170             fdwConversion &amp;= ~IME_CMODE_ROMAN;
01171             <span class="keywordflow">break</span>;
01172 
01173         <span class="keywordflow">case</span> VK_DBE_CODEINPUT:
01174             fdwConversion |= IME_CMODE_CHARCODE;
01175             <span class="keywordflow">break</span>;
01176 
01177         <span class="keywordflow">case</span> VK_DBE_NOCODEINPUT:
01178             fdwConversion &amp;= ~IME_CMODE_CHARCODE;
01179             <span class="keywordflow">break</span>;
01180 
01181         <span class="keywordflow">default</span>:
01182             <span class="keywordflow">break</span>;
01183 
01184     }
01185 
01186     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a30">ImmSetConversionStatus</a>(hImc, fdwConversion, fdwSentence);
01187 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
