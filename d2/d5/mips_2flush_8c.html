<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mips/flush.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>flush.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d3/d4/mips_2flush_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a1">KiChangeColorPageTarget</a> (IN PULONG SignalDone, IN PVOID NewColor, IN PVOID OldColor, IN PVOID PageFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a2">KiSweepDcacheTarget</a> (IN PULONG SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a3">KiSweepIcacheTarget</a> (IN PULONG SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a4">KiSweepIcacheRangeTarget</a> (IN PULONG SignalDone, IN PVOID BaseAddress, IN PVOID Length, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a5">KiFlushIoBuffersTarget</a> (IN PULONG SignalDone, IN PVOID Mdl, IN PVOID ReadOperation, IN PVOID DmaOperation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a6">KeChangeColorPage</a> (IN PVOID NewColor, IN PVOID OldColor, IN ULONG PageFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a7">KeSweepDcache</a> (IN BOOLEAN AllProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a8">KeSweepIcache</a> (IN BOOLEAN AllProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a9">KeSweepIcacheRange</a> (IN BOOLEAN AllProcessors, IN PVOID BaseAddress, IN ULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a10">KeFlushIoBuffers</a> (IN <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a> Mdl, IN BOOLEAN ReadOperation, IN BOOLEAN DmaOperation)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mips_2flush_8c.html#a0">ChangeColor</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a6" doxytag="mips/flush.c::KeChangeColorPage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeChangeColorPage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>NewColor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>OldColor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PageFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00074">74</a> of file <a class="el" href="../../d3/d4/mips_2flush_8c-source.html">mips/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00027">ChangeColor</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00164">KiChangeColorPageTarget()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, and <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>.
<p>
<pre class="fragment"><div>00082                    :
00083 
00084     This routine changes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> color of a page.
00085 
00086 Arguments:
00087 
00088     NewColor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page aligned <span class="keyword">virtual</span> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> color
00089         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page to change.
00090 
00091     OldColor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page aligned <span class="keyword">virtual</span> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> old color
00092         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page to change.
00093 
00094     PageFrame - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page frame number of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> changed.
00095 
00096 Return Value:
00097 
00098     None.
00099 
00100 --*/
00101 
00102 {
00103 
00104     KIRQL OldIrql;
00105     KAFFINITY TargetProcessors;
00106 
00107     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= KiSynchIrql);
00108 
00109     <a class="code" href="../../d2/d5/mips_2flush_8c.html#a0">ChangeColor</a> += 1;
00110 
00111     <span class="comment">//</span>
00112     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00113     <span class="comment">//</span>
00114 
00115 <span class="preprocessor">#if !defined(NT_UP)</span>
00116 <span class="preprocessor"></span>
00117     OldIrql = KeRaiseIrqlToSynchLevel();
00118 
00119     <span class="comment">//</span>
00120     <span class="comment">// Compute the set of target processors and send the change color</span>
00121     <span class="comment">// parameters to the target processors, if any, for execution.</span>
00122     <span class="comment">//</span>
00123 
00124     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00125     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00126         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00127                         KiChangeColorPageTarget,
00128                         (PVOID)NewColor,
00129                         (PVOID)OldColor,
00130                         (PVOID)PageFrame);
00131     }
00132 
00133 <span class="preprocessor">#endif</span>
00134 <span class="preprocessor"></span>
00135     <span class="comment">//</span>
00136     <span class="comment">// Change the color of the page on the current processor.</span>
00137     <span class="comment">//</span>
00138 
00139     HalChangeColorPage(NewColor, OldColor, PageFrame);
00140 
00141     <span class="comment">//</span>
00142     <span class="comment">// Wait until all target processors have finished changing the color</span>
00143     <span class="comment">// of the page.</span>
00144     <span class="comment">//</span>
00145 
00146 <span class="preprocessor">#if !defined(NT_UP)</span>
00147 <span class="preprocessor"></span>
00148     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00149         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00150     }
00151 
00152     <span class="comment">//</span>
00153     <span class="comment">// Lower IRQL to its previous level and return.</span>
00154     <span class="comment">//</span>
00155 
00156     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00157 
00158 <span class="preprocessor">#endif</span>
00159 <span class="preprocessor"></span>
00160     <span class="keywordflow">return</span>;
00161 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="mips/flush.c::KeFlushIoBuffers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushIoBuffers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mdl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadOperation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>DmaOperation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00647">647</a> of file <a class="el" href="../../d3/d4/mips_2flush_8c-source.html">mips/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02496">DMA_READ_DCACHE_INVALIDATE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02497">DMA_READ_ICACHE_INVALIDATE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02498">DMA_WRITE_DCACHE_SNOOP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00301">KiDmaIoCoherency</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00508">KiFlushIoBuffersTarget()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00430">MDL_IO_PAGE_READ</a>.
<p>
<pre class="fragment"><div>00655                    :
00656 
00657     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O buffer specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory descriptor
00658     list from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data cache on all processors.
00659 
00660 Arguments:
00661 
00662     Mdl - Supplies a pointer to a memory descriptor list that describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00663         I/O buffer location.
00664 
00665     ReadOperation - Supplies a <span class="keywordtype">boolean</span> value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O
00666         operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a read into memory.
00667 
00668     DmaOperation - Supplies a <span class="keywordtype">boolean</span> value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O
00669         operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a DMA operation.
00670 
00671 Return Value:
00672 
00673     None.
00674 
00675 --*/
00676 
00677 {
00678 
00679     KIRQL OldIrql;
00680     KAFFINITY TargetProcessors;
00681 
00682     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= KiSynchIrql);
00683 
00684     <span class="comment">//</span>
00685     <span class="comment">// If the operation is a DMA operation, then check if the flush</span>
00686     <span class="comment">// can be avoided because the host system supports the right set</span>
00687     <span class="comment">// of cache coherency attributes. Otherwise, the flush can also</span>
00688     <span class="comment">// be avoided if the operation is a programmed I/O and not a page</span>
00689     <span class="comment">// read.</span>
00690     <span class="comment">//</span>
00691 
00692     <span class="keywordflow">if</span> (DmaOperation != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00693         <span class="keywordflow">if</span> (ReadOperation != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00694             <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/kernldat_8c.html#a34">KiDmaIoCoherency</a> &amp; <a class="code" href="../../d4/d9/ke_8h.html#a41">DMA_READ_ICACHE_INVALIDATE</a>) != 0) {
00695 
00696                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((KiDmaIoCoherency &amp; DMA_READ_DCACHE_INVALIDATE) != 0);
00697 
00698                 <span class="keywordflow">return</span>;
00699 
00700             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((Mdl-&gt;MdlFlags &amp; <a class="code" href="../../d0/d9/ntosdef_8h.html#a18">MDL_IO_PAGE_READ</a>) == 0) &amp;&amp;
00701                 ((<a class="code" href="../../d5/d9/kernldat_8c.html#a34">KiDmaIoCoherency</a> &amp; <a class="code" href="../../d4/d9/ke_8h.html#a40">DMA_READ_DCACHE_INVALIDATE</a>) != 0)) {
00702                 <span class="keywordflow">return</span>;
00703             }
00704 
00705         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/kernldat_8c.html#a34">KiDmaIoCoherency</a> &amp; <a class="code" href="../../d4/d9/ke_8h.html#a42">DMA_WRITE_DCACHE_SNOOP</a>) != 0) {
00706             <span class="keywordflow">return</span>;
00707         }
00708 
00709     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Mdl-&gt;MdlFlags &amp; <a class="code" href="../../d0/d9/ntosdef_8h.html#a18">MDL_IO_PAGE_READ</a>) == 0) {
00710         <span class="keywordflow">return</span>;
00711     }
00712 
00713     <span class="comment">//</span>
00714     <span class="comment">// Either the operation is a DMA operation and the right coherency</span>
00715     <span class="comment">// atributes are not supported by the host system, or the operation</span>
00716     <span class="comment">// is programmed I/O and a page read.</span>
00717     <span class="comment">//</span>
00718     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00719     <span class="comment">//</span>
00720 
00721     OldIrql = KeRaiseIrqlToSynchLevel();
00722 
00723     <span class="comment">//</span>
00724     <span class="comment">// Compute the set of target processors, and send the flush I/O</span>
00725     <span class="comment">// parameters to the target processors, if any, for execution.</span>
00726     <span class="comment">//</span>
00727 
00728 <span class="preprocessor">#if !defined(NT_UP)</span>
00729 <span class="preprocessor"></span>
00730     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00731     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00732         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00733                         KiFlushIoBuffersTarget,
00734                         (PVOID)Mdl,
00735                         (PVOID)((ULONG)ReadOperation),
00736                         (PVOID)((ULONG)DmaOperation));
00737     }
00738 
00739 <span class="preprocessor">#endif</span>
00740 <span class="preprocessor"></span>
00741     <span class="comment">//</span>
00742     <span class="comment">// Flush I/O buffer on current processor.</span>
00743     <span class="comment">//</span>
00744 
00745     HalFlushIoBuffers(Mdl, ReadOperation, DmaOperation);
00746 
00747     <span class="comment">//</span>
00748     <span class="comment">// Wait until all target processors have finished flushing the</span>
00749     <span class="comment">// specified I/O buffer.</span>
00750     <span class="comment">//</span>
00751 
00752 <span class="preprocessor">#if !defined(NT_UP)</span>
00753 <span class="preprocessor"></span>
00754     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00755         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00756     }
00757 
00758 <span class="preprocessor">#endif</span>
00759 <span class="preprocessor"></span>
00760     <span class="comment">//</span>
00761     <span class="comment">// Lower IRQL to its previous level and return.</span>
00762     <span class="comment">//</span>
00763 
00764     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00765     <span class="keywordflow">return</span>;
00766 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="mips/flush.c::KeSweepDcache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepDcache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>AllProcessors</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00215">215</a> of file <a class="el" href="../../d3/d4/mips_2flush_8c-source.html">mips/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00156">KiSweepDcacheTarget()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00221                    :
00222 
00223     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data cache on all processors that are currently
00224     running threads which are children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00225     data cache on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00226 
00227 Arguments:
00228 
00229     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which data
00230         caches are flushed.
00231 
00232 Return Value:
00233 
00234     None.
00235 
00236 --*/
00237 
00238 {
00239 
00240     KIRQL OldIrql;
00241     KAFFINITY TargetProcessors;
00242 
00243     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= KiSynchIrql);
00244 
00245     <span class="comment">//</span>
00246     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00247     <span class="comment">//</span>
00248 
00249 <span class="preprocessor">#if !defined(NT_UP)</span>
00250 <span class="preprocessor"></span>
00251     OldIrql = KeRaiseIrqlToSynchLevel();
00252 
00253     <span class="comment">//</span>
00254     <span class="comment">// Compute the set of target processors and send the sweep parameters</span>
00255     <span class="comment">// to the target processors, if any, for execution.</span>
00256     <span class="comment">//</span>
00257 
00258     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00259     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00260         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00261                         KiSweepDcacheTarget,
00262                         NULL,
00263                         NULL,
00264                         NULL);
00265     }
00266 
00267 <span class="preprocessor">#endif</span>
00268 <span class="preprocessor"></span>
00269     <span class="comment">//</span>
00270     <span class="comment">// Sweep the data cache on the current processor.</span>
00271     <span class="comment">//</span>
00272 
00273     HalSweepDcache();
00274 
00275     <span class="comment">//</span>
00276     <span class="comment">// Wait until all target processors have finished sweeping the their</span>
00277     <span class="comment">// data cache.</span>
00278     <span class="comment">//</span>
00279 
00280 <span class="preprocessor">#if !defined(NT_UP)</span>
00281 <span class="preprocessor"></span>
00282     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00283         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00284     }
00285 
00286     <span class="comment">//</span>
00287     <span class="comment">// Lower IRQL to its previous level and return.</span>
00288     <span class="comment">//</span>
00289 
00290     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00291 
00292 <span class="preprocessor">#endif</span>
00293 <span class="preprocessor"></span>
00294     <span class="keywordflow">return</span>;
00295 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="mips/flush.c::KeSweepIcache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepIcache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>AllProcessors</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00343">343</a> of file <a class="el" href="../../d3/d4/mips_2flush_8c-source.html">mips/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00287">KiSweepIcacheTarget()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00349                    :
00350 
00351     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> instruction cache on all processors that are
00352     currently running threads which are children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or
00353     flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> instruction cache on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00354 
00355 Arguments:
00356 
00357     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which instruction
00358         caches are flushed.
00359 
00360 Return Value:
00361 
00362     None.
00363 
00364 --*/
00365 
00366 {
00367 
00368     KIRQL OldIrql;
00369     KAFFINITY TargetProcessors;
00370 
00371     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= KiSynchIrql);
00372 
00373     <span class="comment">//</span>
00374     <span class="comment">// Raise IRQL to synchrnization level to prevent a context switch.</span>
00375     <span class="comment">//</span>
00376 
00377 <span class="preprocessor">#if !defined(NT_UP)</span>
00378 <span class="preprocessor"></span>
00379     OldIrql = KeRaiseIrqlToSynchLevel();
00380 
00381     <span class="comment">//</span>
00382     <span class="comment">// Compute the set of target processors and send the sweep parameters</span>
00383     <span class="comment">// to the target processors, if any, for execution.</span>
00384     <span class="comment">//</span>
00385 
00386     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00387     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00388         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00389                         KiSweepIcacheTarget,
00390                         NULL,
00391                         NULL,
00392                         NULL);
00393     }
00394 
00395 <span class="preprocessor">#endif</span>
00396 <span class="preprocessor"></span>
00397     <span class="comment">//</span>
00398     <span class="comment">// Sweep the instruction cache on the current processor.</span>
00399     <span class="comment">//</span>
00400 
00401     HalSweepIcache();
00402     HalSweepDcache();
00403 
00404     <span class="comment">//</span>
00405     <span class="comment">// Wait until all target processors have finished sweeping the their</span>
00406     <span class="comment">// instruction cache.</span>
00407     <span class="comment">//</span>
00408 
00409 <span class="preprocessor">#if !defined(NT_UP)</span>
00410 <span class="preprocessor"></span>
00411     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00412         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00413     }
00414 
00415     <span class="comment">//</span>
00416     <span class="comment">// Lower IRQL to its previous level and return.</span>
00417     <span class="comment">//</span>
00418 
00419     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00420 
00421 <span class="preprocessor">#endif</span>
00422 <span class="preprocessor"></span>
00423     <span class="keywordflow">return</span>;
00424 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="mips/flush.c::KeSweepIcacheRange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepIcacheRange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00474">474</a> of file <a class="el" href="../../d3/d4/mips_2flush_8c-source.html">mips/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00588">KiSweepIcacheRangeTarget()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00033">Offset</a>.
<p>
<pre class="fragment"><div>00482                    :
00483 
00484     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> an range of <span class="keyword">virtual</span> addresses from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary
00485     instruction cache on all processors that are currently running threads
00486     which are children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range of <span class="keyword">virtual</span>
00487     addresses from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary instruction cache on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host
00488     configuration.
00489 
00490 Arguments:
00491 
00492     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which instruction
00493         caches are flushed.
00494 
00495     BaseAddress - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed.
00496 
00497     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base
00498         address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified.
00499 
00500 Return Value:
00501 
00502     None.
00503 
00504 --*/
00505 
00506 {
00507 
00508     ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
00509     KIRQL OldIrql;
00510     KAFFINITY TargetProcessors;
00511 
00512     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= KiSynchIrql);
00513 
00514     <span class="comment">//</span>
00515     <span class="comment">// If the length of the range is greater than the size of the primary</span>
00516     <span class="comment">// instruction cache, then set the length of the flush to the size of</span>
00517     <span class="comment">// the primary instruction cache and set the base address of zero.</span>
00518     <span class="comment">//</span>
00519     <span class="comment">// N.B. It is assumed that the size of the primary instruction and</span>
00520     <span class="comment">//      data caches are the same.</span>
00521     <span class="comment">//</span>
00522 
00523     <span class="keywordflow">if</span> (Length &gt; PCR-&gt;FirstLevelIcacheSize) {
00524         BaseAddress = (PVOID)0;
00525         Length = PCR-&gt;FirstLevelIcacheSize;
00526     }
00527 
00528     <span class="comment">//</span>
00529     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00530     <span class="comment">//</span>
00531 
00532 <span class="preprocessor">#if !defined(NT_UP)</span>
00533 <span class="preprocessor"></span>
00534     OldIrql = KeRaiseIrqlToSynchLevel();
00535 
00536     <span class="comment">//</span>
00537     <span class="comment">// Compute the set of target processors, and send the sweep range</span>
00538     <span class="comment">// parameters to the target processors, if any, for execution.</span>
00539     <span class="comment">//</span>
00540 
00541     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00542     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00543         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00544                         KiSweepIcacheRangeTarget,
00545                         (PVOID)BaseAddress,
00546                         (PVOID)Length,
00547                         NULL);
00548     }
00549 
00550 <span class="preprocessor">#endif</span>
00551 <span class="preprocessor"></span>
00552     <span class="comment">//</span>
00553     <span class="comment">// Flush the specified range of virtual addresses from the primary</span>
00554     <span class="comment">// instruction cache.</span>
00555     <span class="comment">//</span>
00556 
00557     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = (ULONG)BaseAddress &amp; PCR-&gt;IcacheAlignment;
00558     HalSweepIcacheRange((PVOID)((ULONG)BaseAddress &amp; ~PCR-&gt;IcacheAlignment),
00559                         (Offset + Length + PCR-&gt;IcacheAlignment) &amp; ~PCR-&gt;IcacheAlignment);
00560 
00561     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = (ULONG)BaseAddress &amp; PCR-&gt;DcacheAlignment;
00562     HalSweepDcacheRange((PVOID)((ULONG)BaseAddress &amp; ~PCR-&gt;DcacheAlignment),
00563                         (Offset + Length + PCR-&gt;DcacheAlignment) &amp; ~PCR-&gt;DcacheAlignment);
00564 
00565     <span class="comment">//</span>
00566     <span class="comment">// Wait until all target processors have finished sweeping the specified</span>
00567     <span class="comment">// range of addresses from the instruction cache.</span>
00568     <span class="comment">//</span>
00569 
00570 <span class="preprocessor">#if !defined(NT_UP)</span>
00571 <span class="preprocessor"></span>
00572     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00573         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00574     }
00575 
00576     <span class="comment">//</span>
00577     <span class="comment">// Lower IRQL to its previous level and return.</span>
00578     <span class="comment">//</span>
00579 
00580     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00581 
00582 <span class="preprocessor">#endif</span>
00583 <span class="preprocessor"></span>
00584     <span class="keywordflow">return</span>;
00585 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="mips/flush.c::KiChangeColorPageTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiChangeColorPageTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>NewColor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>OldColor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>PageFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00164">164</a> of file <a class="el" href="../../d3/d4/mips_2flush_8c-source.html">mips/flush.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00074">KeChangeColorPage()</a>.
<p>
<pre class="fragment"><div>00173                    :
00174 
00175     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> changing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> color of a page.
00176 
00177 Arguments:
00178 
00179     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00180         requested operation has been performed.
00181 
00182     NewColor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page aligned <span class="keyword">virtual</span> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> color
00183         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page to change.
00184 
00185     OldColor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page aligned <span class="keyword">virtual</span> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> old color
00186         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page to change.
00187 
00188     PageFrame - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page frame number of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> changed.
00189 
00190 Return Value:
00191 
00192     None.
00193 
00194 --*/
00195 
00196 {
00197 
00198 
00199     <span class="comment">//</span>
00200     <span class="comment">// Change the color of the page on the current processor and clear</span>
00201     <span class="comment">// change color packet address to signal the source to continue.</span>
00202     <span class="comment">//</span>
00203 
00204 <span class="preprocessor">#if !defined(NT_UP)</span>
00205 <span class="preprocessor"></span>
00206     HalChangeColorPage(NewColor, OldColor, (ULONG)PageFrame);
00207     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00208 
00209 <span class="preprocessor">#endif</span>
00210 <span class="preprocessor"></span>
00211     <span class="keywordflow">return</span>;
00212 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="mips/flush.c::KiFlushIoBuffersTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushIoBuffersTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Mdl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadOperation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DmaOperation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00769">769</a> of file <a class="el" href="../../d3/d4/mips_2flush_8c-source.html">mips/flush.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>.
<p>
<pre class="fragment"><div>00778                    :
00779 
00780     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> flushing an I/O buffer on target
00781     processors.
00782 
00783 Arguments:
00784 
00785     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00786         requested operation has been performed.
00787 
00788     Mdl - Supplies a pointer to a memory descriptor list that describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00789         I/O buffer location.
00790 
00791     ReadOperation - Supplies a <span class="keywordtype">boolean</span> value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O
00792         operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a read into memory.
00793 
00794     DmaOperation - Supplies a <span class="keywordtype">boolean</span> value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O
00795         operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a DMA operation.
00796 
00797 Return Value:
00798 
00799     None.
00800 
00801 --*/
00802 
00803 {
00804 
00805     <span class="comment">//</span>
00806     <span class="comment">// Flush the specified I/O buffer on the current processor.</span>
00807     <span class="comment">//</span>
00808 
00809 <span class="preprocessor">#if !defined(NT_UP)</span>
00810 <span class="preprocessor"></span>
00811     HalFlushIoBuffers((<a class="code" href="../../d6/d7/struct__MDL.html">PMDL</a>)Mdl,
00812                       (BOOLEAN)((ULONG)ReadOperation),
00813                       (BOOLEAN)((ULONG)DmaOperation));
00814 
00815     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00816 
00817 <span class="preprocessor">#endif</span>
00818 <span class="preprocessor"></span>
00819     <span class="keywordflow">return</span>;
00820 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mips/flush.c::KiSweepDcacheTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSweepDcacheTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="mips/flush.c::KiSweepIcacheRangeTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSweepIcacheRangeTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00588">588</a> of file <a class="el" href="../../d3/d4/mips_2flush_8c-source.html">mips/flush.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>, and <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00033">Offset</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00474">KeSweepIcacheRange()</a>.
<p>
<pre class="fragment"><div>00597                    :
00598 
00599     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> sweeping a range of addresses from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00600     instruction cache.
00601     processors.
00602 
00603 Arguments:
00604 
00605     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00606         requested operation has been performed.
00607 
00608     BaseAddress - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed.
00609 
00610     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base
00611         address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified.
00612 
00613     Parameter3 - Not used.
00614 
00615 Return Value:
00616 
00617     None.
00618 
00619 --*/
00620 
00621 {
00622 
00623     ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
00624 
00625     <span class="comment">//</span>
00626     <span class="comment">// Sweep the specified instruction cache range on the current processor.</span>
00627     <span class="comment">//</span>
00628 
00629 <span class="preprocessor">#if !defined(NT_UP)</span>
00630 <span class="preprocessor"></span>
00631     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = (ULONG)(BaseAddress) &amp; PCR-&gt;IcacheAlignment;
00632     HalSweepIcacheRange((PVOID)((ULONG)(BaseAddress) &amp; ~PCR-&gt;IcacheAlignment),
00633                         (Offset + (ULONG)Length + PCR-&gt;IcacheAlignment) &amp; ~PCR-&gt;IcacheAlignment);
00634 
00635     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = (ULONG)(BaseAddress) &amp; PCR-&gt;DcacheAlignment;
00636     HalSweepDcacheRange((PVOID)((ULONG)(BaseAddress) &amp; ~PCR-&gt;DcacheAlignment),
00637                         (Offset + (ULONG)Length + PCR-&gt;DcacheAlignment) &amp; ~PCR-&gt;DcacheAlignment);
00638 
00639     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00640 
00641 <span class="preprocessor">#endif</span>
00642 <span class="preprocessor"></span>
00643     <span class="keywordflow">return</span>;
00644 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mips/flush.c::KiSweepIcacheTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSweepIcacheTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a0" doxytag="mips/flush.c::ChangeColor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d2/d5/mips_2flush_8c.html#a0">ChangeColor</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00027">27</a> of file <a class="el" href="../../d3/d4/mips_2flush_8c-source.html">mips/flush.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/clres_8c-source.html#l03203">ChangeDibColors()</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00074">KeChangeColorPage()</a>, and <a class="el" href="../../d5/d0/genmips_8c-source.html#l00130">main()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:43 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
