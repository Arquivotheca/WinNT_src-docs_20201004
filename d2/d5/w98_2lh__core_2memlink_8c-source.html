<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: memlink.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>memlink.c</h1><a href="../../d1/d6/w98_2lh__core_2memlink_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*</span>
00002 <span class="comment">        File:           MemLink.c</span>
00003 <span class="comment"></span>
00004 <span class="comment">        Contains:       </span>
00005 <span class="comment">                creation of mem based profiles</span>
00006 <span class="comment"></span>
00007 <span class="comment">        Written by:     U. J. Krabbenhoeft</span>
00008 <span class="comment"></span>
00009 <span class="comment">        Copyright:      © 1993-1997 by Heidelberger Druckmaschinen AG, all rights reserved.</span>
00010 <span class="comment"></span>
00011 <span class="comment">        Version:        </span>
00012 <span class="comment">*/</span>
00013 
00014 <span class="preprocessor">#ifndef LHGeneralIncs_h</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#include "General.h"</span>
00016 <span class="preprocessor">#endif</span>
00017 <span class="preprocessor"></span>
00018 <span class="preprocessor">#if __IS_MSDOS</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#include &lt;wtypes.h&gt;</span>
00020 <span class="preprocessor">#include &lt;winbase.h&gt;</span>
00021 <span class="preprocessor">#include &lt;windowsX.h&gt;</span>
00022 <span class="preprocessor">#ifdef RenderInt</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#include "Windef.h"</span>
00024 <span class="preprocessor">#endif</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00026 <span class="preprocessor"></span>
00027 <span class="preprocessor">#ifndef MemLink_h</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#include "MemLink.h"</span>
00029 <span class="preprocessor">#endif</span>
00030 <span class="preprocessor"></span>
00031 <span class="preprocessor">#if !__IS_MSDOS &amp;&amp; !__IS_MAC</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;time.h&gt;</span>
00033 <span class="preprocessor">#endif</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define kThisFile kLHCMRuntimeID</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00038 <span class="preprocessor"></span>
00039 
00040 <span class="preprocessor">#ifndef IntelMode</span>
<a name="l00041"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a0">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define CMHelperICC2int16Const(a, b)                                                                                                                            \</span>
00042 <span class="preprocessor">                  (*((UINT16 *)(a))) = (UINT16)(b);</span>
<a name="l00043"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a1">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define CMHelperICC2int32Const(a, b)                                                                                                                            \</span>
00044 <span class="preprocessor">                  (*((UINT32 *)(a))) = (UINT32)(b);</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#define CMHelperICC2int16Const(a, b)                                                                                                                            \</span>
00047 <span class="preprocessor">                  (*((UINT16 *)(a))) = (((UINT16)(b)&gt;&gt;8)         | ((UINT16)((UINT8 )(b)) &lt;&lt; 8));</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#define CMHelperICC2int32Const(a, b)                                                                                                                            \</span>
00049 <span class="preprocessor">                  (*((UINT32 *)(a))) = (((UINT32)(b)&gt;&gt;24)         | ((UINT32)(0x0ff0000&amp;(UINT32)(b)) &gt;&gt; 8) | \</span>
00050 <span class="preprocessor">                        ((UINT32)(0x0ff00&amp;(UINT32)(b)) &lt;&lt; 8) | ((UINT32)(0x0ff&amp;(UINT32)(b)) &lt;&lt; 24));</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00052 <span class="preprocessor"></span>
<a name="l00053"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a6">00053</a> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a6">MyAdd_NL_Header</a>( UINT32 theSize, <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>       *linkHeader,
00054                                                  UINT32 aIntent, UINT32 aClass, UINT32 aColorSpace, UINT32 aConnectionSpace )
00055 {
00056         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00057 <span class="preprocessor">#if ! __IS_MSDOS</span>
00058 <span class="preprocessor"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   secs;
00059 <span class="preprocessor">#endif</span>
00060 <span class="preprocessor"></span>        <a class="code" href="../../d5/d7/structDateTimeRec.html">DateTimeRec</a>                             datetimeRec;
00061         <span class="comment">/*icHeader      linkHeader; */</span>
00062 
00063 <span class="preprocessor">#if __IS_MSDOS</span>
00064 <span class="preprocessor"></span>        SYSTEMTIME aSystemTime;
00065         GetLocalTime( (SYSTEMTIME *)&amp;aSystemTime);
00066         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o0">year</a>         = aSystemTime.wYear;   datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o1">month</a>        = aSystemTime.wMonth;
00067         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o2">day</a>          = aSystemTime.wDay;    datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o3">hour</a>         = aSystemTime.wHour;
00068         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o4">minute</a>       = aSystemTime.wMinute; datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o5">second</a>       = aSystemTime.wSecond;
00069 <span class="preprocessor">#else</span>
00070 <span class="preprocessor"></span><span class="preprocessor">#if __IS_MAC</span>
00071 <span class="preprocessor"></span>        <a class="code" href="../../d7/d9/w98_2lh__open_2general_8h.html#a90">GetDateTime</a>(&amp;secs);
00072         <a class="code" href="../../d7/d9/w98_2lh__open_2general_8h.html#a91">SecondsToDate</a>(secs, &amp;datetimeRec);<span class="comment">/* Secs2Date  (link.*)=(.*); CMHelperICC2int32(\&amp;(\1),\2); */</span>
00073 <span class="preprocessor">#else</span>
00074 <span class="preprocessor"></span>    <span class="keyword">struct </span>tm* loctime;
00075     time_t long_time;
00076     time( &amp;long_time );                <span class="comment">/* Get time as long integer. */</span>
00077         loctime = localtime(&amp;long_time);
00078         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o0">year</a>         = loctime-&gt;tm_year;    datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o1">month</a>       = loctime-&gt;tm_mon+1;
00079         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o2">day</a>          = loctime-&gt;tm_mday;    datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o3">hour</a>        = loctime-&gt;tm_hour;
00080         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o4">minute</a>       = loctime-&gt;tm_min;             datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o5">second</a>      = loctime-&gt;tm_sec;
00081 <span class="preprocessor">#endif</span>
00082 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00083 <span class="preprocessor"></span>        
00084         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o0">size</a>                               ), theSize);            <span class="comment">/* This is the total size of the CMProfileRef */</span>
00085         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o1">cmmId</a>                              ), 'Win ');                                                     <span class="comment">/* CMM signature,  Registered with ICC consortium  */</span>
00086         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o2">version</a>                    ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a1">icVersionNumber</a>);                            <span class="comment">/* Version of CMProfile format */</span>
00087         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a>                ), aClass);                                     <span class="comment">/* input, display, output, devicelink, abstract, or color conversion profile type */</span>
00088         
00089         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a>                 ), aColorSpace);        <span class="comment">/* color space of data = dataColorSpace of first profile*/</span>
00090 
00091         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>                                ), aConnectionSpace);   <span class="comment">/* profile connection color space = dataColorSpace of last profile*/</span>
00092         
00093         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a6">CMHelperICC2int16</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o0">year</a>                               ), &amp;datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o0">year</a>);                                  <span class="comment">/* date and time of profile creation */</span>
00094         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a6">CMHelperICC2int16</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o1">month</a>                              ), &amp;datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o1">month</a>); 
00095         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a6">CMHelperICC2int16</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o2">day</a>                                ), &amp;datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o2">day</a>);   
00096         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a6">CMHelperICC2int16</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o3">hours</a>                              ), &amp;datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o3">hour</a>);  
00097         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a6">CMHelperICC2int16</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o4">minutes</a>                    ), &amp;datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o4">minute</a>);        
00098         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a6">CMHelperICC2int16</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o5">seconds</a>                    ), &amp;datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o5">second</a>);        
00099         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o7">magic</a>                              ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a0">icMagicNumber</a>);                                      <span class="comment">/* 'acsp' constant ICC file ID */</span>
00100         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o8">platform</a>                   ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a130">icSigMicrosoft</a>);                                     <span class="comment">/* primary profile platform, Registered with ICC consortium */</span>
00101         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o9">flags</a>                              ), 0);                                                          <span class="comment">/* profile flags */</span>
00102         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o10">manufacturer</a>               ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a130">icSigMicrosoft</a>);                                                     <span class="comment">/* Registered with ICC consortium */</span>
00103         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o11">model</a>                              ), 0);                                                          <span class="comment">/* Registered with ICC consortium */</span>
00104         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o12">attributes</a>[0]              ), 0);                                                          <span class="comment">/* Attributes like paper type */</span>
00105         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o12">attributes</a>[1]              ), 0);
00106         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o13">renderingIntent</a>    ), aIntent );                                                           <span class="comment">/* preferred rendering intent of tagged object */</span>
00107         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o14">illuminant</a>.<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a>               ), 0.9642 * 65536);                                     <span class="comment">/* profile illuminant */</span>
00108         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o14">illuminant</a>.<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a>               ), 1.0000 * 65536);
00109         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o14">illuminant</a>.<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a>               ), 0.8249 * 65536);
00110         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o16">creator</a>                    ), 'UJK ');
00111                 
00112         <span class="keywordflow">return</span> err;
00113 }
00114 
00115 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a14">MyAdd_NL_HeaderMS</a>       ( UINT32 theSize, <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>      *linkHeader, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> aIntent, icColorSpaceSignature sCS, icColorSpaceSignature dCS );
00116 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a14">MyAdd_NL_HeaderMS</a>       ( UINT32 theSize, <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>      *linkHeader, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> aIntent, icColorSpaceSignature sCS, icColorSpaceSignature dCS )
00117 {
00118         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00119 <span class="preprocessor">#if ! __IS_MSDOS</span>
00120 <span class="preprocessor"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   secs;
00121 <span class="preprocessor">#endif</span>
00122 <span class="preprocessor"></span>        <a class="code" href="../../d5/d7/structDateTimeRec.html">DateTimeRec</a>                             datetimeRec;
00123         <span class="comment">/*icHeader      linkHeader; */</span>
00124 
00125 <span class="preprocessor">#if __IS_MSDOS</span>
00126 <span class="preprocessor"></span>        SYSTEMTIME aSystemTime;
00127         GetLocalTime( (SYSTEMTIME *)&amp;aSystemTime);
00128         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o0">year</a>         = aSystemTime.wYear;   datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o1">month</a>        = aSystemTime.wMonth;
00129         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o2">day</a>          = aSystemTime.wDay;    datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o3">hour</a>         = aSystemTime.wHour;
00130         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o4">minute</a>       = aSystemTime.wMinute; datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o5">second</a>       = aSystemTime.wSecond;
00131 <span class="preprocessor">#else</span>
00132 <span class="preprocessor"></span><span class="preprocessor">#if __IS_MAC</span>
00133 <span class="preprocessor"></span>        <a class="code" href="../../d7/d9/w98_2lh__open_2general_8h.html#a90">GetDateTime</a>(&amp;secs);
00134         <a class="code" href="../../d7/d9/w98_2lh__open_2general_8h.html#a91">SecondsToDate</a>(secs, &amp;datetimeRec);<span class="comment">/* Secs2Date  (link.*)=(.*); CMHelperICC2int32(\&amp;(\1),\2); */</span>
00135 <span class="preprocessor">#else</span>
00136 <span class="preprocessor"></span>    <span class="keyword">struct </span>tm* loctime;
00137     time_t long_time;
00138     time( &amp;long_time );                <span class="comment">/* Get time as long integer. */</span>
00139         loctime = localtime(&amp;long_time);
00140         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o0">year</a>         = loctime-&gt;tm_year;    datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o1">month</a>       = loctime-&gt;tm_mon+1;
00141         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o2">day</a>          = loctime-&gt;tm_mday;    datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o3">hour</a>        = loctime-&gt;tm_hour;
00142         datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o4">minute</a>       = loctime-&gt;tm_min;             datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o5">second</a>      = loctime-&gt;tm_sec;
00143 <span class="preprocessor">#endif</span>
00144 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00145 <span class="preprocessor"></span>        
00146         
00147         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o0">size</a>                                = theSize;              <span class="comment">/* This is the total size of the CMProfileRef */</span>
00148         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o1">cmmId</a>                               = 'Win ';                                                       <span class="comment">/* CMM signature,  Registered with ICC consortium  */</span>
00149         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o2">version</a>                     = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a1">icVersionNumber</a>;                              <span class="comment">/* Version of CMProfile format */</span>
00150         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a>                 = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a125">icSigLinkClass</a>;                                       <span class="comment">/* input, display, output, devicelink, abstract, or color conversion profile type */</span>
00151         
00152         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a>                  = sCS;  <span class="comment">/* color space of data = dataColorSpace of first profile*/</span>
00153 
00154         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>                                 = dCS;  <span class="comment">/* profile connection color space = dataColorSpace of last profile*/</span>
00155         
00156         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o0">year</a>                   = datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o0">year</a>;                                     <span class="comment">/* date and time of profile creation */</span>
00157         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o1">month</a>                  = datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o1">month</a>;    
00158         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o2">day</a>                    = datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o2">day</a>;      
00159         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o3">hours</a>                  = datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o3">hour</a>;     
00160         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o4">minutes</a>                = datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o4">minute</a>;   
00161         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o6">date</a>.<a class="code" href="../../d8/d1/structicDateTimeNumber.html#o5">seconds</a>                = datetimeRec.<a class="code" href="../../d5/d7/structDateTimeRec.html#o5">second</a>;   
00162         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o7">magic</a>                               = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a0">icMagicNumber</a>;                                        <span class="comment">/* 'acsp' constant ICC file ID */</span>
00163         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o8">platform</a>                    = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a130">icSigMicrosoft</a>;                                       <span class="comment">/* primary profile platform, Registered with ICC consortium */</span>
00164         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o9">flags</a>                               = 0;                                                            <span class="comment">/* profile flags */</span>
00165         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o10">manufacturer</a>                = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a130">icSigMicrosoft</a>;                                                       <span class="comment">/* Registered with ICC consortium */</span>
00166         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o11">model</a>                               = 0;                                                            <span class="comment">/* Registered with ICC consortium */</span>
00167         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o12">attributes</a>[0]               = 0;                                                            <span class="comment">/* Attributes like paper type */</span>
00168         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o12">attributes</a>[1]               = 0;
00169         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o13">renderingIntent</a>             = aIntent ;                                                             <span class="comment">/* preferred rendering intent of tagged object */</span>
00170         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o14">illuminant</a>.<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a>                = (<span class="keywordtype">long</span>)(0.9642 * 65536);                                       <span class="comment">/* profile illuminant */</span>
00171         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o14">illuminant</a>.<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a>                = (<span class="keywordtype">long</span>)(1.0000 * 65536);
00172         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o14">illuminant</a>.<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a>                = (<span class="keywordtype">long</span>)(0.8249 * 65536);
00173         linkHeader-&gt;<a class="code" href="../../d1/d2/structicHeader.html#o16">creator</a>                             = 'UJK ';
00174 
00175         <span class="keywordflow">return</span> err;
00176 }
00177 
<a name="l00178"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a8">00178</a> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a7">MyAdd_NL_DescriptionTag</a> ( <a class="code" href="../../d6/d8/structLHTextDescriptionType.html">LHTextDescriptionType</a> *descPtr, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *theText )
00179 {
00180         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                                             thePtr;
00181         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00182         
00183         theText[theText[0]] = 0x00;
00184         
00185         <span class="comment">/*descPtr = (LHTextDescriptionType*)NewPtrClear( theSize );      */</span>
00186         <span class="keywordflow">if</span> (descPtr == 0)
00187                 <span class="keywordflow">return</span> -1;
00188         
00189         <span class="comment">/*------------------------------------------------------------------------ ASCII */</span>
00190         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(descPtr-&gt;<a class="code" href="../../d6/d8/structLHTextDescriptionType.html#o0">typeDescriptor</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a99">icSigTextDescriptionType</a>);
00191         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(descPtr-&gt;<a class="code" href="../../d6/d8/structLHTextDescriptionType.html#o1">reserved</a> ), 0);
00192         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(descPtr-&gt;<a class="code" href="../../d6/d8/structLHTextDescriptionType.html#o2">ASCIICount</a>     ), (<span class="keywordtype">long</span>)theText[0]);
00193         thePtr = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>) &amp;descPtr-&gt;<a class="code" href="../../d6/d8/structLHTextDescriptionType.html#o3">ASCIIName</a>[0];
00194         <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a10">BlockMove</a>(&amp;theText[1], thePtr, theText[0]);
00195         thePtr += theText[0];
00196         
00197         <span class="comment">/*------------------------------------------------------------------------ Unicode */</span>
00199         <span class="comment">/*thePtr+=sizeof(unsigned long); */</span>
00200         *thePtr++ = 0;
00201         *thePtr++ = 0;
00202         *thePtr++ = 0;
00203         *thePtr++ = 0;
00205         <span class="comment">/*thePtr+=sizeof(unsigned long); */</span>
00206         *thePtr++ = 0;
00207         *thePtr++ = 0;
00208         *thePtr++ = 0;
00209         *thePtr++ = 0;
00210         <span class="comment">/*BlockMove(&amp;theText[1], thePtr, theText[0]);           //Unicode string  */</span>
00211         <span class="comment">/*thePtr += theText[0]; */</span>
00212         
00213         <span class="comment">/*------------------------------------------------------------------------ Macintosh */</span>
00216         *thePtr++ = 0;
00217         *thePtr++ = 0;
00218         <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a10">BlockMove</a>(&amp;theText[0], thePtr, theText[0]+1);   
00219         <span class="keywordflow">return</span> err;
00220 }
00221 
<a name="l00222"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a9">00222</a> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>    ( <a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *descPtr, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *aColor )
00223 {
00224         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00225         
00226         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(descPtr-&gt;<a class="code" href="../../d9/d6/structicXYZType.html#o0">base</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a107">icSigXYZType</a>);
00227         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>*)&amp;(descPtr-&gt;<a class="code" href="../../d9/d6/structicXYZType.html#o0">base</a> )+1, 0);
00228         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a7">CMHelperICC2int32</a>(&amp;(descPtr-&gt;<a class="code" href="../../d9/d6/structicXYZType.html#o1">data</a>.<a class="code" href="../../d7/d6/structicXYZArray.html#o0">data</a>[0].<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a>      ), &amp;aColor-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a>);
00229         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a7">CMHelperICC2int32</a>(&amp;(descPtr-&gt;<a class="code" href="../../d9/d6/structicXYZType.html#o1">data</a>.<a class="code" href="../../d7/d6/structicXYZArray.html#o0">data</a>[0].<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a>      ), &amp;aColor-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a>);
00230         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a7">CMHelperICC2int32</a>(&amp;(descPtr-&gt;<a class="code" href="../../d9/d6/structicXYZType.html#o1">data</a>.<a class="code" href="../../d7/d6/structicXYZArray.html#o0">data</a>[0].<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a>      ), &amp;aColor-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a>);
00231         <span class="keywordflow">return</span> err;
00232 }
00233 
<a name="l00234"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a10">00234</a> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a9">MyAdd_NL_CurveTag</a>       ( <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> *descPtr, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> Gamma )
00235 {
00236         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00237         
00238         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(descPtr-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o0">base</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a87">icSigCurveType</a>);
00239         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>*)&amp;(descPtr-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o0">base</a> )+1, 0);
00240         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(descPtr-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o1">curve</a>.<a class="code" href="../../d4/d1/structicCurve.html#o0">count</a> ), 1);
00241         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a6">CMHelperICC2int16</a>(&amp;(descPtr-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o1">curve</a>.<a class="code" href="../../d4/d1/structicCurve.html#o1">data</a>[0] ), &amp;Gamma );
00242         <span class="keywordflow">return</span> err;
00243 }
00244 
<a name="l00245"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a11">00245</a> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a10">MyAdd_NL_CopyrightTag</a>           ( <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *copyrightText, <a class="code" href="../../d7/d8/structLHTextType.html">LHTextType</a> *aLHTextType )
00246 {
00247     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                       err=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00248 
00249     copyrightText[copyrightText[0]] = 0x00;
00250     <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aLHTextType-&gt;<a class="code" href="../../d7/d8/structLHTextType.html#o0">base</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a98">icSigTextType</a>);
00251         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>*)&amp;(aLHTextType-&gt;<a class="code" href="../../d7/d8/structLHTextType.html#o0">base</a> )+1, 0);
00252     <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a10">BlockMove</a>(&amp;copyrightText[1], &amp;aLHTextType-&gt;<a class="code" href="../../d7/d8/structLHTextType.html#o2">text</a>[0], copyrightText[0]);
00253 
00254 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
00255 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( err &amp;&amp; DebugCheck(kThisFile, kDebugErrorInfo) )
00256         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"¥ MyAdd_NL_CopyrightTag-Error: result = %d\n"</span>,err);
00257 <span class="preprocessor">#endif</span>
00258 <span class="preprocessor"></span>    <span class="keywordflow">return</span> err;
00259 }
00260 
00261 <span class="comment">/* ______________________________________________________________________</span>
00262 <span class="comment">    CMError</span>
00263 <span class="comment">    Fill_mft1_InputTable        ( Ptr                           theElut,</span>
00264 <span class="comment">                              icLut8*           lutPtr,</span>
00265 <span class="comment">                              CMMModelPtr       modelData)</span>
00266 <span class="comment"></span>
00267 <span class="comment">    Abstract:</span>
00268 <span class="comment">        Fill mft1 inputTable with the data from the given E-Lut.</span>
00269 <span class="comment"></span>
00270 <span class="comment">    Params:</span>
00271 <span class="comment">        theElut         (in)            Reference to E-Lut.</span>
00272 <span class="comment">        tempLutPtr      (in/out)        Reference to icLut8.</span>
00273 <span class="comment"></span>
00274 <span class="comment">    Return:</span>
00275 <span class="comment">        noErr           successful</span>
00276 <span class="comment">        System or result code if an error occurs.</span>
00277 <span class="comment">   _____________________________________________________________________ */</span>
00278 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a12">Fill_mft1_InputTable</a>(   Ptr                     theElut,
00279                                         <a class="code" href="../../d8/d2/structicLut8.html">icLut8</a>*         lutPtr,
00280                                         CMMModelPtr     modelData);
00281 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a12">Fill_mft1_InputTable</a>(   Ptr                     theElut,
00282                                         <a class="code" href="../../d8/d2/structicLut8.html">icLut8</a>*         lutPtr,
00283                                         CMMModelPtr     modelData)
00284 {
00285     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                       err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00286     <span class="keywordtype">long</span>                        i;
00287     <span class="keywordtype">long</span>                        j;
00288     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       factor;
00289     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       round;
00290     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       shift;
00291     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       ulAux;
00292     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>      *wordElut = (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>*)theElut;
00293     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       newScale = 255;
00294     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       oldScale = ((1U&lt;&lt; modelData-&gt;lutParam.inputLutWordSize) * (lutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o2">clutPoints</a>-1)) / lutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o2">clutPoints</a>;
00295 
00296     <span class="keywordflow">if</span>( modelData-&gt;currentCall == <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a94a89">kCMMNewLinkProfile</a> ){
00297                 oldScale = 1&lt;&lt; modelData-&gt;lutParam.inputLutWordSize;
00298         }
00299         factor = (newScale &lt;&lt; 24) / oldScale;
00300     round  = (1&lt;&lt;(24-1))-1;
00301     shift  = 24;
00302 
00303     ulAux = ~( (1&lt;&lt; (32-modelData-&gt;lutParam.inputLutWordSize))-1);
00304         <span class="keywordflow">while</span> (factor &amp; ulAux ) <span class="comment">/* stay within 16 bits to prevent product overflow */</span>
00305     {
00306         factor &gt;&gt;= 1;
00307         round  &gt;&gt;= 1;
00308         shift   -= 1;
00309     }
00310 
00311     <span class="keywordflow">for</span> (i=0; i&lt;(<span class="keywordtype">long</span>)lutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o0">inputChan</a>; i++)
00312     {
00313         <span class="keywordflow">for</span> (j=0; j&lt; 256; j++)
00314         {
00315             ulAux    = ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)*wordElut * factor + round) &gt;&gt; shift;
00316             lutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o13">data</a>[i * 256 + j] = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)(ulAux );
00317             wordElut++;
00318         }
00319     }
00320     <span class="keywordflow">return</span> err;
00321 }
00322 
00323 <span class="comment">/* ______________________________________________________________________</span>
00324 <span class="comment">    CMError</span>
00325 <span class="comment">    Fill_mft1_OutputTable       ( Ptr                   theAlut,</span>
00326 <span class="comment">                              icLut8*   lutPtr,</span>
00327 <span class="comment">                              long                      offset,</span>
00328 <span class="comment">                              CMMModelPtr       modelData)</span>
00329 <span class="comment"></span>
00330 <span class="comment">    Abstract:</span>
00331 <span class="comment">        Fill mft1 outputTable with the data from the given A-Lut.</span>
00332 <span class="comment"></span>
00333 <span class="comment">    Params:</span>
00334 <span class="comment">        theAlut (in)            Reference to A-Lut.</span>
00335 <span class="comment">        lutPtr  (in/out)        Reference to icLut8.</span>
00336 <span class="comment">        offset  (in)            starting position for outputTable within icLut8</span>
00337 <span class="comment"></span>
00338 <span class="comment">    Return:</span>
00339 <span class="comment">        noErr           successful</span>
00340 <span class="comment">        System or  result code if an error occurs.</span>
00341 <span class="comment">   _____________________________________________________________________ */</span>
00342 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a13">Fill_mft1_OutputTable</a>(  Ptr                     theAlut,
00343                                         <a class="code" href="../../d8/d2/structicLut8.html">icLut8</a>*         lutPtr,
00344                                         <span class="keywordtype">long</span>            offset,
00345                                         CMMModelPtr     modelData);
00346 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a13">Fill_mft1_OutputTable</a>(  Ptr                     theAlut,
00347                                         <a class="code" href="../../d8/d2/structicLut8.html">icLut8</a>*         lutPtr,
00348                                         <span class="keywordtype">long</span>            offset,
00349                                         CMMModelPtr     modelData)
00350 {
00351     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>       err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00352     <span class="keywordtype">long</span>        i;
00353     <span class="keywordtype">long</span>        j;
00354     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>*      byteAlut = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>*)theAlut;
00355     <span class="keywordtype">long</span>        numOfAlutEntries = modelData-&gt;lutParam.outputLutEntryCount;
00356     <span class="keywordtype">short</span>       step = numOfAlutEntries / 256;
00357 
00358     <span class="keywordflow">for</span> (i=0; i&lt;(<span class="keywordtype">long</span>)lutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o1">outputChan</a>; i++)
00359     {
00360         <span class="keywordflow">for</span> (j=0; j&lt;256; j++)
00361         {
00362             byteAlut = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>*)theAlut + (j * (numOfAlutEntries-1)) / 255 ;
00363             lutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o13">data</a>[offset + i * 256 + j] = *byteAlut;
00364         }
00365                 theAlut +=  numOfAlutEntries;
00366     }
00367     <span class="keywordflow">return</span> err;
00368 }
00369 
00370 <span class="comment">/* ______________________________________________________________________</span>
00371 <span class="comment">    CMError</span>
00372 <span class="comment">    Fill_mft2_InputTable        ( Ptr                           theElut,</span>
00373 <span class="comment">                              icLut16*          lutPtr,</span>
00374 <span class="comment">                              CMMModelPtr       modelData)</span>
00375 <span class="comment"></span>
00376 <span class="comment">    Abstract:</span>
00377 <span class="comment">        Fill mft2 inputTable with the data from the given E-Lut.</span>
00378 <span class="comment"></span>
00379 <span class="comment">    Params:</span>
00380 <span class="comment">        theElut         (in)            Reference to E-Lut.</span>
00381 <span class="comment">        tempLutPtr      (in/out)        Reference to icLut8.</span>
00382 <span class="comment"></span>
00383 <span class="comment">    Return:</span>
00384 <span class="comment">        noErr           successful</span>
00385 <span class="comment">        System or  result code if an error occurs.</span>
00386 <span class="comment">   _____________________________________________________________________ */</span>
00387 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a14">Fill_mft2_InputTable</a>(   Ptr                             theElut,
00388                                         <a class="code" href="../../d6/d2/structicLut16.html">icLut16</a>*                lutPtr,
00389                                         CMMModelPtr     modelData);
00390 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a14">Fill_mft2_InputTable</a>(   Ptr                             theElut,
00391                                         <a class="code" href="../../d6/d2/structicLut16.html">icLut16</a>*                lutPtr,
00392                                         CMMModelPtr     modelData)
00393 {
00394     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                       err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00395     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       factor;
00396     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       round;
00397     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       shift;
00398     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       ulAux;
00399     <span class="keywordtype">long</span>                        i;
00400     <span class="keywordtype">long</span>                        j;
00401     <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*                     wordElut = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)theElut;
00402     <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*                     wordData = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)lutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o15">data</a>;
00403     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       newScale = 65535;
00404 
00405     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>       oldScale = ( (1&lt;&lt;modelData-&gt;lutParam.inputLutWordSize) * (modelData-&gt;lutParam.colorLutGridPoints-1)) / modelData-&gt;lutParam.colorLutGridPoints;
00406 
00407     <span class="keywordflow">if</span>( modelData-&gt;currentCall == <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a94a89">kCMMNewLinkProfile</a> ){
00408                 oldScale = 1&lt;&lt; modelData-&gt;lutParam.inputLutWordSize;
00409         }
00410         factor = (newScale &lt;&lt; 15) / oldScale;
00411     round  = (1&lt;&lt;(15-1))-1;
00412     shift  = 15;
00413 
00414     <span class="keywordflow">while</span> (factor &amp; 0xFFFF0000) <span class="comment">/* stay within 16 bits to prevent product overflow */</span>
00415     {
00416         factor &gt;&gt;= 1;
00417         round  &gt;&gt;= 1;
00418         shift   -= 1;
00419     }
00420 
00421      <span class="keywordflow">for</span> (i=0; i&lt;(<span class="keywordtype">long</span>)lutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o0">inputChan</a>; i++)
00422     {
00423         <span class="keywordflow">for</span> (j=0; j&lt; (<span class="keywordtype">long</span>)lutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o13">inputEnt</a>; j++)
00424         {
00425             ulAux    = ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)*wordElut * factor + round) &gt;&gt; shift;
00426                         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a0">CMHelperICC2int16Const</a>( wordData, ulAux );
00427                         wordData++;
00428             wordElut++;
00429         }
00430     }
00431     <span class="keywordflow">return</span> err;
00432 }
00433 <span class="comment">/* ______________________________________________________________________</span>
00434 <span class="comment">    CMError</span>
00435 <span class="comment">    Fill_mft2_OutputTable       ( Ptr                           theAlut,</span>
00436 <span class="comment">                              icLut16*          lutPtr,</span>
00437 <span class="comment">                              long                              offset,</span>
00438 <span class="comment">                              CMMModelPtr       modelData )</span>
00439 <span class="comment"></span>
00440 <span class="comment">    Abstract:</span>
00441 <span class="comment">        Fill mft2 outputTable with the data from the given A-Lut.</span>
00442 <span class="comment"></span>
00443 <span class="comment">    Params:</span>
00444 <span class="comment">        theAlut (in)            Reference to A-Lut.</span>
00445 <span class="comment">        lutPtr  (in/out)        Reference to icLut8.</span>
00446 <span class="comment">        offset  (in)            starting position for outputTable within CMLut8Type</span>
00447 <span class="comment"></span>
00448 <span class="comment">    Return:</span>
00449 <span class="comment">        noErr           successful</span>
00450 <span class="comment">        System or  result code if an error occurs.</span>
00451 <span class="comment">   _____________________________________________________________________ */</span>
00452 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a15">Fill_mft2_OutputTable</a>(  Ptr                     theAlut,
00453                                         <a class="code" href="../../d6/d2/structicLut16.html">icLut16</a>*        lutPtr,
00454                                         <span class="keywordtype">long</span>            offset,
00455                                         CMMModelPtr     modelData );
00456 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a15">Fill_mft2_OutputTable</a>(  Ptr                     theAlut,
00457                                         <a class="code" href="../../d6/d2/structicLut16.html">icLut16</a>*        lutPtr,
00458                                         <span class="keywordtype">long</span>            offset,
00459                                         CMMModelPtr     modelData )
00460 {
00461     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>       err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00462     <span class="keywordtype">long</span>        i;
00463     <span class="keywordtype">long</span>        j;
00464     <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*     wordAlut = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)theAlut;
00465     <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*     wordData = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)lutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o15">data</a> + offset;
00466 
00467     modelData = modelData;
00468     <span class="keywordflow">for</span> (i=0; i&lt;(<span class="keywordtype">long</span>)lutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o1">outputChan</a>; i++)
00469     {
00470         <span class="keywordflow">for</span> (j=0; j&lt;(<span class="keywordtype">long</span>)lutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o14">outputEnt</a>; j++)
00471         {
00472             <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a0">CMHelperICC2int16Const</a>( wordData, *wordAlut );
00473                         wordData++;
00474             wordAlut++;
00475         }
00476     }
00477     <span class="keywordflow">return</span> err;
00478 }
00479 
00480 <span class="comment">/* ______________________________________________________________________</span>
00481 <span class="comment">    CMError</span>
00482 <span class="comment">    Fill_mft2_ColorTable        ( Ptr                   theAlut,</span>
00483 <span class="comment">                              icLut16*          lutPtr,</span>
00484 <span class="comment">                              long                      offset,</span>
00485 <span class="comment">                              long                      count )</span>
00486 <span class="comment"></span>
00487 <span class="comment">    Abstract:</span>
00488 <span class="comment">        Fill mft2 outputTable with the data from the given A-Lut.</span>
00489 <span class="comment"></span>
00490 <span class="comment">    Params:</span>
00491 <span class="comment">        theAlut (in)            Reference to A-Lut.</span>
00492 <span class="comment">        lutPtr  (in/out)        Reference to icLut8.</span>
00493 <span class="comment">        offset  (in)            starting position for outputTable within CMLut8Type</span>
00494 <span class="comment"></span>
00495 <span class="comment">    Return:</span>
00496 <span class="comment">        noErr           successful</span>
00497 <span class="comment">        System or  result code if an error occurs.</span>
00498 <span class="comment">   _____________________________________________________________________ */</span>
00499 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a16">Fill_mft2_ColorTable</a>(   Ptr                     theClut,
00500                                         <a class="code" href="../../d6/d2/structicLut16.html">icLut16</a>*        lutPtr,
00501                                         <span class="keywordtype">long</span>            offset,
00502                                         <span class="keywordtype">long</span>            count );
00503 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a16">Fill_mft2_ColorTable</a>(   Ptr                     theClut,
00504                                         <a class="code" href="../../d6/d2/structicLut16.html">icLut16</a>*        lutPtr,
00505                                         <span class="keywordtype">long</span>            offset,
00506                                         <span class="keywordtype">long</span>            count )
00507 {
00508     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>       err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00509     <span class="keywordtype">long</span>        i;
00510     <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*     wordClut = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)theClut;
00511     <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*     wordData = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)lutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o15">data</a> + offset;
00512 
00513     <span class="keywordflow">for</span> ( i=0; i&lt;count; i++)
00514     {
00515         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a0">CMHelperICC2int16Const</a>( wordData, *wordClut );
00516                 wordData++;
00517         wordClut++;
00518     }
00519     <span class="keywordflow">return</span> err;
00520 }
00521 
<a name="l00522"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a17">00522</a> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a12">MyAdd_NL_AToB0Tag_mft1</a>( CMMModelPtr cw, <a class="code" href="../../d9/d2/structicLut8Type.html">icLut8Type</a> *lutPtr, <span class="keywordtype">long</span> colorLutSize )
00523 {
00524         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err;
00525         <a class="code" href="../../d8/d2/structicLut8.html">icLut8</a>                  *tempLutPtr;
00526         <span class="keywordtype">long</span>                    offset;
00527         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  inputChannels;
00528         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  outputChannels;
00529         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  gridPoints;
00530         
00531         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"Add_NL_AToB0Tag_mft1"</span>)
00532 
00533         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(cw-&gt;lutParam.inputLut);
00534         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(cw-&gt;lutParam.colorLut);
00535         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(cw-&gt;lutParam.outputLut);
00536         
00537         inputChannels  = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.colorLutInDim;
00538         outputChannels = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.colorLutOutDim;
00539         gridPoints         = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.colorLutGridPoints;
00540         
00541         tempLutPtr      = &amp;lutPtr-&gt;<a class="code" href="../../d9/d2/structicLut8Type.html#o1">lut</a>;
00542         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(lutPtr-&gt;<a class="code" href="../../d9/d2/structicLut8Type.html#o0">base</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a91">icSigLut8Type</a>);
00543         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>*)&amp;(lutPtr-&gt;<a class="code" href="../../d9/d2/structicLut8Type.html#o0">base</a> )+1, 0);
00544         tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o0">inputChan</a>   = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)inputChannels;
00545         tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o1">outputChan</a>  = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)outputChannels;
00546         tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o2">clutPoints</a>  = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)gridPoints;
00547         tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o4">e00</a> = tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o5">e01</a> = tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o6">e02</a> = 0;
00548         tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o7">e10</a> = tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o8">e11</a> = tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o9">e12</a> = 0;
00549         tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o10">e20</a> = tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o11">e21</a> = tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o12">e22</a> = 0;
00550         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o4">e00</a>        ), 0x10000);
00551         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o8">e11</a>        ), 0x10000);
00552         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o12">e22</a>        ), 0x10000);
00553 
00554         err = <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a12">Fill_mft1_InputTable</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(cw-&gt;lutParam.inputLut), tempLutPtr, cw);
00555         <span class="keywordflow">if</span> (err)
00556                 <span class="keywordflow">goto</span> CleanupAndExit;
00557 
00558         offset = 256 * inputChannels;
00559         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>( <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(cw-&gt;lutParam.colorLut), &amp; tempLutPtr-&gt;<a class="code" href="../../d8/d2/structicLut8.html#o13">data</a>[0] + offset, colorLutSize);
00560 
00561         offset = offset + colorLutSize;
00562         err = <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a13">Fill_mft1_OutputTable</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(cw-&gt;lutParam.outputLut),  tempLutPtr, offset, cw);
00563         <span class="keywordflow">if</span> (err)
00564                 <span class="keywordflow">goto</span> CleanupAndExit;
00565 
00566 CleanupAndExit:
00567 
00568 <span class="preprocessor">        #ifdef DEBUG_OUTPUT</span>
00569 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( err  )
00570                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"¥ MyAdd_NL_AToB0Tag_mft1-Error: result = %d\n"</span>,err);
00571 <span class="preprocessor">        #endif</span>
00572 <span class="preprocessor"></span>        <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(cw-&gt;lutParam.inputLut);
00573         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(cw-&gt;lutParam.colorLut);
00574         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(cw-&gt;lutParam.outputLut);
00575         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"Add_NL_AToB0Tag_mft1"</span>)
00576         <span class="keywordflow">return</span> err;
00577 }
00578 
00579 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a> <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a7">GetSizes</a>( CMMModelPtr cw, UINT32 *clutSize );
00580 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a> <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a7">GetSizes</a>( CMMModelPtr cw, UINT32 *clutSize )
00581 {
00582         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  inputChannels;
00583         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  outputChannels;
00584         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  gridPoints;
00585         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  colorLutSize;
00586         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  i,theSize;
00587 
00588         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(cw-&gt;lutParam.inputLut);
00589         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(cw-&gt;lutParam.colorLut);
00590         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(cw-&gt;lutParam.outputLut);
00591         
00592         inputChannels  = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.colorLutInDim;
00593         outputChannels = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.colorLutOutDim;
00594         gridPoints         = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.colorLutGridPoints;
00595         
00596         colorLutSize = outputChannels;
00597         <span class="keywordflow">for</span>(i = 0; i &lt; inputChannels; i++)
00598                 colorLutSize *= gridPoints;
00599 
00600         <span class="keywordflow">if</span> ( cw-&gt;lutParam.colorLutWordSize != 8){
00601                 theSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>) + <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>) + (4 * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)) + (9 * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a33">Fixed</a>))                   <span class="comment">/* typeDescriptor...matrix */</span>
00602                                         + 2 * <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a185">icUInt16Number</a>)                                                                                                            <span class="comment">/* inputLutEntryCount outputLutEntryCount*/</span>
00603                                         + (inputChannels * cw-&gt;lutParam.inputLutEntryCount * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>))                            <span class="comment">/* inputTable */</span>
00604                                         + (outputChannels * cw-&gt;lutParam.outputLutEntryCount * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>))                          <span class="comment">/* CLUT */</span>
00605                                         + colorLutSize * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);                                                                                                                                                <span class="comment">/* outputTable */</span>
00606         }
00607         <span class="keywordflow">else</span>{
00608                 theSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>) + <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>) + (4 * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)) + (9 * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a33">Fixed</a>))                   <span class="comment">/* typeDescriptor...matrix */</span>
00609                                         + (inputChannels * 256 * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>))                                                                                         <span class="comment">/* inputTable */</span>
00610                                         + (outputChannels * 256 * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>))                                                                                        <span class="comment">/* CLUT */</span>
00611                                         + colorLutSize;                                                                                                                                         <span class="comment">/* outputTable */</span>
00612         }
00613         *clutSize = colorLutSize;
00614         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(cw-&gt;lutParam.inputLut);
00615         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(cw-&gt;lutParam.colorLut);
00616         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(cw-&gt;lutParam.outputLut);
00617         <span class="keywordflow">return</span> theSize;
00618 }
00619 
<a name="l00620"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a19">00620</a> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a13">MyAdd_NL_AToB0Tag_mft2</a>( CMMModelPtr cw, <a class="code" href="../../d7/d2/structicLut16Type.html">icLut16Type</a> *lutPtr, <span class="keywordtype">long</span> colorLutSize )
00621 {
00622         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err;
00623         <a class="code" href="../../d6/d2/structicLut16.html">icLut16</a>                 *tempLutPtr;
00624         <span class="keywordtype">long</span>                    offset;
00625         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  inputChannels;
00626         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  outputChannels;
00627         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  gridPoints;
00628         
00629         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"Add_NL_AToB0Tag_mft2"</span>)
00630 
00631         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(cw-&gt;lutParam.inputLut);
00632         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(cw-&gt;lutParam.colorLut);
00633         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(cw-&gt;lutParam.outputLut);
00634         
00635         inputChannels  = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.colorLutInDim;
00636         outputChannels = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.colorLutOutDim;
00637         gridPoints         = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.colorLutGridPoints;
00638         
00639         tempLutPtr      = &amp;lutPtr-&gt;<a class="code" href="../../d7/d2/structicLut16Type.html#o1">lut</a>;
00640         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(lutPtr-&gt;<a class="code" href="../../d7/d2/structicLut16Type.html#o0">base</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a90">icSigLut16Type</a>);
00641         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>*)&amp;(lutPtr-&gt;<a class="code" href="../../d7/d2/structicLut16Type.html#o0">base</a> )+1, 0);
00642         tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o0">inputChan</a>   = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)inputChannels;
00643         tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o1">outputChan</a>  = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)outputChannels;
00644         tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o2">clutPoints</a>  = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)((gridPoints&gt;255)?255:gridPoints);
00645         tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o4">e00</a> = tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o5">e01</a> = tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o6">e02</a> = 0;
00646         tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o7">e10</a> = tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o8">e11</a> = tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o9">e12</a> = 0;
00647         tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o10">e20</a> = tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o11">e21</a> = tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o12">e22</a> = 0;
00648         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o4">e00</a>        ), 0x10000);
00649         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o8">e11</a>        ), 0x10000);
00650         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o12">e22</a>        ), 0x10000);
00651 
00652         tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o13">inputEnt</a>    = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.inputLutEntryCount;
00653         tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o14">outputEnt</a>   = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.outputLutEntryCount;
00654         err = <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a14">Fill_mft2_InputTable</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(cw-&gt;lutParam.inputLut), tempLutPtr, cw);
00655         <span class="keywordflow">if</span> (err)
00656                 <span class="keywordflow">goto</span> CleanupAndExit;
00657 
00658         offset = cw-&gt;lutParam.inputLutEntryCount * inputChannels;
00659         <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a16">Fill_mft2_ColorTable</a>( (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(cw-&gt;lutParam.colorLut), tempLutPtr, offset, colorLutSize);
00660 
00661         offset = offset + colorLutSize;
00662         err = <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a15">Fill_mft2_OutputTable</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(cw-&gt;lutParam.outputLut),  tempLutPtr, offset, cw);
00663         <span class="keywordflow">if</span> (err)
00664                 <span class="keywordflow">goto</span> CleanupAndExit;
00665 
00666         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a0">CMHelperICC2int16Const</a>(&amp;(tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o13">inputEnt</a>   ), (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.inputLutEntryCount);
00667         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a0">CMHelperICC2int16Const</a>(&amp;(tempLutPtr-&gt;<a class="code" href="../../d6/d2/structicLut16.html#o14">outputEnt</a>  ), (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)cw-&gt;lutParam.outputLutEntryCount);
00668 
00669 CleanupAndExit:
00670 
00671 <span class="preprocessor">        #ifdef DEBUG_OUTPUT</span>
00672 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( err  )
00673                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"¥ MyAdd_NL_AToB0Tag_mft2-Error: result = %d\n"</span>,err);
00674 <span class="preprocessor">        #endif</span>
00675 <span class="preprocessor"></span>        <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(cw-&gt;lutParam.inputLut);
00676         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(cw-&gt;lutParam.colorLut);
00677         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(cw-&gt;lutParam.outputLut);
00678         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"Add_NL_AToB0Tag_mft2"</span>)
00679         <span class="keywordflow">return</span> err;
00680 }
00681 
00682 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a4">MyGetColorSpaces</a>(       <a class="code" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a>      *profileSet,
00683                                                         UINT32                          *sCS,
00684                                                         UINT32                          *dCS );
00685 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a4">MyGetColorSpaces</a>(       <a class="code" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a>      *profileSet,
00686                                                         UINT32                          *sCS,
00687                                                         UINT32                          *dCS )
00688 {
00689         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                                         err;
00690         <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>                                        profHeader;
00691 
00692         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"MyGetColorSpaces"</span>)
00693         
00694         err = CMGetProfileHeader(profileSet-&gt;profileSet[0], (<a class="code" href="../../d1/d2/structicHeader.html">CMCoreProfileHeader</a> *)&amp;profHeader);
00695         if (err)
00696                 goto CleanupAndExit;
00697         *sCS = profHeader.colorSpace;
00698 
00699         err = CMGetProfileHeader(profileSet-&gt;profileSet[profileSet-&gt;count-1], (<a class="code" href="../../d1/d2/structicHeader.html">CMCoreProfileHeader</a> *)&amp;profHeader);
00700         if (err)
00701                 goto CleanupAndExit;
00702         *dCS = profHeader.colorSpace;
00703 
00704 CleanupAndExit:
00705         LH_END_PROC("MyAdd_NL_SequenceDescTag")
00706         return err;
00707 }
00708 <span class="comment">/* ______________________________________________________________________</span>
00709 <span class="comment">        CMError</span>
00710 <span class="comment">        MyAdd_NL_SequenceDescTag        ( CMProfileRef           linkProfile,</span>
00711 <span class="comment">                                                          CMConcatProfileSet *profileSet )</span>
00712 <span class="comment"></span>
00713 <span class="comment">        Abstract:</span>
00714 <span class="comment">                Create the ProfileSequenceDescTag for the NewDeviceLink CMProfileRef.</span>
00715 <span class="comment">                Copy the data from the profiles in profileSet</span>
00716 <span class="comment"></span>
00717 <span class="comment">        Params:</span>
00718 <span class="comment">                linkProfile     (in/out)        Reference to new profile.</span>
00719 <span class="comment">                profileSet      (in)            Reference to CMConcatProfileSet.</span>
00720 <span class="comment">                </span>
00721 <span class="comment">        Return:</span>
00722 <span class="comment">                noErr           successful</span>
00723 <span class="comment">                System or  result code if an error occurs.</span>
00724 <span class="comment">   _____________________________________________________________________ */</span>
<a name="l00725"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a21">00725</a> CMError MyAdd_NL_SequenceDescTag(       <a class="code" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a>                      *profileSet,
00726                                                                         <a class="code" href="../../d8/d3/structicProfileSequenceDescType.html">icProfileSequenceDescType</a>       *pSeqPtr,
00727                                                                         <span class="keywordtype">long</span>                                            *aSize )
00728 {
00729         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                                         err;
00730         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                                           aOSerr;
00731         <span class="comment">/*icProfileSequenceDescType*    pSeqPtr         = nil;*/</span>
00732         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                                                     thePtr          = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00733         <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>                                        profHeader;
00734         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                                          loop;
00735         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                                          technology;
00736         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                                          elementSize;
00737         <a class="code" href="../../d4/d4/structicSignatureType.html">icSignatureType</a>                         theSignature;
00738         <a class="code" href="../../d0/d5/structicTextDescriptionType.html">icTextDescriptionType</a>*          descPtr         = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00739         <span class="keywordtype">char</span>                                            descPtrNull[90]={0};
00740 
00741         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"MyAdd_NL_SequenceDescTag"</span>)
00742         
00743         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(((<a class="code" href="../../d0/d5/structicTextDescriptionType.html">icTextDescriptionType</a>*)descPtrNull)-&gt;base ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a99">icSigTextDescriptionType</a> );
00744         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>*)&amp;((<a class="code" href="../../d0/d5/structicTextDescriptionType.html">icTextDescriptionType</a>*)descPtrNull)-&gt;base )+1, 0);
00745         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(((icTextDescriptionType*)descPtrNull)-&gt;desc.count ), 1 );
00746         <span class="comment">/*pSeqPtr =  (icProfileSequenceDescType*)SmartNewPtrClear(5000, &amp;aOSerr);</span>
00747 <span class="comment">        err = aOSerr;</span>
00748 <span class="comment">        if (err)</span>
00749 <span class="comment">                goto CleanupAndExit;*/</span>
00750         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(pSeqPtr-&gt;base ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a94">icSigProfileSequenceDescType</a>);
00751         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>*)&amp;(pSeqPtr-&gt;base )+1, 0);
00752         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(pSeqPtr-&gt;desc.count ), profileSet-&gt;count );
00753         thePtr = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)( (SIZE_T)&amp;(pSeqPtr-&gt;desc.count) + <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>) ) ;             
00754         
00755         <span class="keywordflow">for</span> (loop = 0; loop &lt; (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>)profileSet-&gt;count; loop++)
00756         {
00757                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a0">CMGetProfileHeader</a>(profileSet-&gt;profileSet[loop], (<a class="code" href="../../d1/d2/structicHeader.html">CMCoreProfileHeader</a> *)&amp;profHeader);
00758                 <span class="keywordflow">if</span> (err)
00759                         <span class="keywordflow">goto</span> CleanupAndExit;
00760                 <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(thePtr, profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o10">manufacturer</a>);
00761                 thePtr += <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>);
00762                 <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(thePtr, profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o11">model</a>);
00763                 thePtr += <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>);
00764                 <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(thePtr, profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o12">attributes</a>[0]);
00765                 thePtr += <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>);
00766                 <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(thePtr, profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o12">attributes</a>[1]);
00767                 thePtr += <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>);
00768                 
00769                 <span class="comment">/* ----------------------------------------------------------------- icSigTechnologyTag */</span>
00770                 technology = 0;
00771                 <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(profileSet-&gt;profileSet[loop], <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a59">icSigTechnologyTag</a>, &amp;elementSize, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
00772                 {
00773                         <span class="keywordflow">if</span> (elementSize == <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a59">icSigTechnologyTag</a>))
00774                         {
00775                                 <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(profileSet-&gt;profileSet[loop], <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a59">icSigTechnologyTag</a>, &amp;elementSize, &amp;theSignature) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
00776                                         technology = theSignature.<a class="code" href="../../d4/d4/structicSignatureType.html#o1">signature</a>;
00777                         }
00778                 }
00779                 *((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>*)thePtr) = technology;                                                                        <span class="comment">/* signature */</span>
00780                 thePtr += <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>);
00781                 
00782                 <span class="comment">/* ----------------------------------------------------------------- icSigDeviceMfgDescTag */</span>
00783                 <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(profileSet-&gt;profileSet[loop], <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a30">icSigDeviceMfgDescTag</a>, &amp;elementSize, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
00784                 {
00785                         descPtr = (icTextDescriptionType*)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(elementSize,&amp;aOSerr);
00786                         err = aOSerr;
00787                         <span class="keywordflow">if</span> (err)
00788                                 <span class="keywordflow">goto</span> CleanupAndExit;
00789                         <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(profileSet-&gt;profileSet[loop], <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a30">icSigDeviceMfgDescTag</a>, &amp;elementSize, descPtr) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
00790                         {
00791                                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>( descPtr, thePtr, elementSize);
00792                                 thePtr += elementSize;
00793                         }
00794                         descPtr = (icTextDescriptionType*)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)descPtr);
00795                 } <span class="keywordflow">else</span>
00796                 {
00797                         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>( descPtrNull, thePtr, <span class="keyword">sizeof</span>(descPtrNull));
00798                         thePtr += <span class="keyword">sizeof</span>(descPtrNull);
00799                 }
00800                 <span class="comment">/* ----------------------------------------------------------------- icSigDeviceModelDescTag */</span>
00801                 <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(profileSet-&gt;profileSet[loop], <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a31">icSigDeviceModelDescTag</a>, &amp;elementSize, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
00802                 {
00803                         descPtr = (icTextDescriptionType*)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(elementSize,&amp;aOSerr);
00804                         err = aOSerr;
00805                         <span class="keywordflow">if</span> (err)
00806                                 <span class="keywordflow">goto</span> CleanupAndExit;
00807                         <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(profileSet-&gt;profileSet[loop], <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a31">icSigDeviceModelDescTag</a>, &amp;elementSize, descPtr) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
00808                         {
00809                                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>( descPtr, thePtr, elementSize);
00810                                 thePtr += elementSize;
00811                         }
00812                         descPtr =  (icTextDescriptionType*)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)descPtr);
00813                 } <span class="keywordflow">else</span>
00814                 {
00815                         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>( descPtrNull, thePtr, <span class="keyword">sizeof</span>(descPtrNull));
00816                         thePtr += <span class="keyword">sizeof</span>(descPtrNull);
00817                 }
00818                 <span class="comment">/* ----------------------------------------------------------------- */</span>
00819         }
00820 
00821    <span class="comment">//Sundown safe truncation</span>
00822         *aSize = (LONG)((ULONG_PTR)thePtr - (ULONG_PTR)pSeqPtr);
00823         
00824 CleanupAndExit:
00825         descPtr = (icTextDescriptionType*)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)descPtr);
00826         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"MyAdd_NL_SequenceDescTag"</span>)
00827         <span class="keywordflow">return</span> err;
00828 }
00829 
00830 
00831 <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a22">MakeXYZNumber</a>( <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *x );
00832 <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a22">MakeXYZNumber</a>( <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *x )
00833 {
00834         <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> ret;
00835         ret.<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a> = x-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a>&gt;&gt;14;
00836         ret.<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a> = x-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a>&gt;&gt;14;
00837         ret.<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a> = x-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a>&gt;&gt;14;
00838         <span class="keywordflow">return</span> ret;
00839 }
00840 
00841 <span class="keywordtype">void</span>  <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a5">MakeMyDoubleXYZ</a>( <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *x, <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> *ret );
00842 <span class="keywordtype">void</span>  <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a5">MakeMyDoubleXYZ</a>( <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *x, <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> *ret )
00843 {
00844         ret-&gt;<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o0">X</a> = x-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a>/(<span class="keywordtype">double</span>)(1&lt;&lt;30);
00845         ret-&gt;<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o1">Y</a> = x-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a>/(<span class="keywordtype">double</span>)(1&lt;&lt;30);
00846         ret-&gt;<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o2">Z</a> = x-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a>/(<span class="keywordtype">double</span>)(1&lt;&lt;30);
00847 }
00848 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>  <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a24">doubMatrixInvert</a>(      <span class="keywordtype">double</span>  inpMat[3][3],
00849                                                 <span class="keywordtype">double</span>  outMat[3][3] );
00850 <span class="keywordtype">void</span>  <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a25">TransposeMatrix</a>(  <span class="keywordtype">double</span>  inpMat[3][3] );
00851 <span class="keywordtype">void</span>  <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a25">TransposeMatrix</a>(  <span class="keywordtype">double</span>  inpMat[3][3] )
00852 {
00853         <span class="keywordtype">long</span> i,j;
00854         <span class="keywordtype">double</span> sav;
00855         <span class="keywordflow">for</span>( i=0; i&lt; 3; i++ ){
00856                 <span class="keywordflow">for</span>( j=i+1; j&lt; 3; j++ ){
00857                         sav                      =  inpMat[i][j];
00858                         inpMat[i][j] =  inpMat[j][i];
00859                         inpMat[j][i] =  sav;
00860                 }
00861         }
00862 
00863 }
<a name="l00864"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a2">00864</a> <span class="preprocessor">#define Round(a) (((a)&gt;0.)?((a)+.5):((a)-.5))</span>
00865 <span class="preprocessor"></span>
00866 <span class="keywordtype">double</span> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a26">GetMatrixedVal</a>( <span class="keywordtype">double</span> m[3][3], <span class="keywordtype">long</span> color, <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> *aXYZ );
00867 <span class="keywordtype">double</span> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a26">GetMatrixedVal</a>( <span class="keywordtype">double</span> m[3][3], <span class="keywordtype">long</span> color, <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> *aXYZ )
00868 {
00869         <span class="keywordtype">double</span> tmp;
00870         tmp = m[color][0] * aXYZ-&gt;<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o0">X</a>;
00871         tmp+= m[color][1] * aXYZ-&gt;<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o1">Y</a>;
00872         tmp+= m[color][2] * aXYZ-&gt;<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o2">Z</a>;
00873         <span class="keywordflow">return</span> tmp;
00874 }
00875 
00876 <span class="keywordtype">void</span> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a27">NormalizeColor</a>( <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *r, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *g, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *b, <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> *Illuminant, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resR, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resG, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resB );
00877 <span class="keywordtype">void</span> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a27">NormalizeColor</a>( <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *r, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *g, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *b, <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> *Illuminant, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resR, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resG, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resB )
00878 {
00879         <span class="keywordtype">double</span>  factorX,factorY,factorZ;
00880         <span class="keywordtype">double</span> inMat[3][3];
00881         
00882         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a5">MakeMyDoubleXYZ</a>( r, (<a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a>*)&amp;inMat[0][0] );
00883         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a5">MakeMyDoubleXYZ</a>( g, (<a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a>*)&amp;inMat[1][0] );
00884         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a5">MakeMyDoubleXYZ</a>( b, (<a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a>*)&amp;inMat[2][0] );
00885 
00886         factorX = inMat[0][0] + inMat[1][0] + inMat[2][0];
00887         factorY = inMat[0][1] + inMat[1][1] + inMat[2][1];
00888         factorZ = inMat[0][2] + inMat[1][2] + inMat[2][2];
00889 
00890         factorX = Illuminant-&gt;<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o0">X</a> / factorX * 65536;
00891         factorY = Illuminant-&gt;<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o1">Y</a> / factorY * 65536;
00892         factorZ = Illuminant-&gt;<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o2">Z</a> / factorZ * 65536;
00893 
00894         resR-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[0][0] * factorX);                   <span class="comment">/* red primary */</span>
00895         resR-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[0][1] * factorY);
00896         resR-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[0][2] * factorZ);
00897         resG-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[1][0] * factorX);                   <span class="comment">/* green primary */</span>
00898         resG-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[1][1] * factorY);
00899         resG-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[1][2] * factorZ);
00900         resB-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[2][0] * factorX);                   <span class="comment">/* blue primary */</span>
00901         resB-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[2][1] * factorY);
00902         resB-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[2][2] * factorZ);
00903 }
00904 
00905 <span class="keywordtype">void</span> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a28">NormalizeWithWhiteAdaption</a>( <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *r, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *g, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *b, <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> *Illuminant, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resR, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resG, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resB );
00906 <span class="keywordtype">void</span> <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a28">NormalizeWithWhiteAdaption</a>( <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *r, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *g, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *b, <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> *Illuminant, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resR, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resG, <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> *resB )
00907 {
00908         <span class="keywordtype">double</span>  factorR,factorG,factorB;
00909         <span class="keywordtype">double</span> inMat[3][3];
00910         <span class="keywordtype">double</span> outMat[3][3];
00911 
00912         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a5">MakeMyDoubleXYZ</a>( r, (<a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a>*)&amp;inMat[0][0] );
00913         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a5">MakeMyDoubleXYZ</a>( g, (<a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a>*)&amp;inMat[1][0] );
00914         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a5">MakeMyDoubleXYZ</a>( b, (<a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a>*)&amp;inMat[2][0] );
00915 
00916         <span class="keywordflow">if</span>( !<a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a24">doubMatrixInvert</a>(inMat, outMat) )
00917         {
00918                 <span class="keywordflow">return</span> ;
00919         }
00920 
00921         <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a25">TransposeMatrix</a>( outMat );
00922 
00923         factorR =  <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a26">GetMatrixedVal</a>( outMat, 0, Illuminant )*65536;
00924         factorG =  <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a26">GetMatrixedVal</a>( outMat, 1, Illuminant )*65536;
00925         factorB =  <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a26">GetMatrixedVal</a>( outMat, 2, Illuminant )*65536;
00926 
00927         resR-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[0][0] * factorR);                   <span class="comment">/* red primary */</span>
00928         resR-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[0][1] * factorR);
00929         resR-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[0][2] * factorR);
00930         resG-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[1][0] * factorG);                   <span class="comment">/* green primary */</span>
00931         resG-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[1][1] * factorG);
00932         resG-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[1][2] * factorG);
00933         resB-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[2][0] * factorB);                   <span class="comment">/* blue primary */</span>
00934         resB-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[2][1] * factorB);
00935         resB-&gt;<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a> = (<span class="keywordtype">long</span>)<a class="code" href="../../d0/d1/lh__core_2dondim_8c.html#a4">Round</a>(inMat[2][2] * factorB);
00936 }
00937 
00938 <span class="preprocessor">#ifdef WRITE_PROFILE</span>
00939 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a26">WriteProf</a>( Ptr name, <a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *theProf, <span class="keywordtype">long</span> currentSize );
00940 <span class="preprocessor">#endif</span>
00941 <span class="preprocessor"></span>
<a name="l00942"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a3">00942</a> <span class="preprocessor">#define MyTagCount 9</span>
00943 <span class="preprocessor"></span>
00944 <span class="preprocessor">#if __IS_MSDOS &amp;&amp; defined(RenderInt)</span>
00945 <span class="preprocessor"></span><a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a1">MyNewAbstract</a>( LPLOGCOLORSPACEA lpColorSpace, <a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> **theProf )
00946 {
00947         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
00948         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
00949 <span class="preprocessor">#ifdef __MWERKS__</span>
00950 <span class="preprocessor"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   theText[] = <span class="stringliteral">"\pLogColorSpProfile   "</span>;
00951         <span class="keywordtype">char</span>                    copyrightText[] = <span class="stringliteral">"\p©1996 by Heidelberger Druckmaschinen AG  U.J.K."</span>;
00952 <span class="preprocessor">#elif __IS_MSDOS</span>
00953 <span class="preprocessor"></span>        <span class="keywordtype">char</span>                    theText[] = <span class="stringliteral">"\030LogColorSpProfile      "</span>;
00954         <span class="keywordtype">char</span>                    copyrightText[] = <span class="stringliteral">"\060©1996 by Heidelberger Druckmaschinen AG  U.J.K."</span>;
00955 <span class="preprocessor">#else</span>
00956 <span class="preprocessor"></span>        <span class="keywordtype">char</span>                    theText[] = <span class="stringliteral">"\030LogColorSpProfile      "</span>;
00957         <span class="keywordtype">char</span>                    copyrightText[] = <span class="stringliteral">"\060©1996 by Heidelberger Druckmaschinen AG  U.J.K."</span>;
00958 <span class="preprocessor">#endif</span>
00959 <span class="preprocessor"></span>        <a class="code" href="../../d6/d3/structicProfile.html">icProfile</a>               *aProf=0;
00960         <span class="keywordtype">long</span>                    theTagTabSize;
00961         <span class="keywordtype">long</span>                    theHeaderSize;
00962         <span class="keywordtype">long</span>                    theDescSize;
00963         <span class="keywordtype">long</span>                    theMediaSize;
00964         <span class="keywordtype">long</span>                    theEndPointSize;
00965         <span class="keywordtype">long</span>                    theTRCSize;
00966         <span class="keywordtype">long</span>                    theCopyRightSize;
00967         <span class="keywordtype">long</span>                    currentSize=0;
00968         <span class="keywordtype">long</span>                    theTotalSize=0;
00969         <a class="code" href="../../d5/d4/structicTag.html">icTag</a>                   aTag;
00970         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   aIntent;
00971 
00972         <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a>     rXYZ,gXYZ,bXYZ;
00973         <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> D50XYZ = { 0.9642, 1.0000, 0.8249 };
00974         <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> D50 = { (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(D50XYZ.<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o0">X</a> * 65536), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(D50XYZ.<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o1">Y</a> * 65536), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(D50XYZ.<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o2">Z</a> * 65536)};
00975         theHeaderSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>);
00976         theDescSize   =                                                                           <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)                        <span class="comment">/* type descriptor */</span>
00977                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* reserved */</span>
00978                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* ASCII length */</span>
00979                                                                                                                 + theText[0]                            <span class="comment">/* ASCII profile description */</span>
00980                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* Unicode code */</span>
00981                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* Unicode character count */</span>
00982                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)        <span class="comment">/* Macintosh script code */</span>
00983                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)         <span class="comment">/* Macintosh string length */</span>
00984                                                                                                                 + 67                                            <span class="comment">/* Macintosh string */</span>
00985                                                                                                                 ;
00986         theCopyRightSize   =                                                              <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)                        <span class="comment">/* type descriptor */</span>
00987                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* reserved */</span>
00988                                                                                                                 + copyrightText[0]                      <span class="comment">/* ASCII profile description */</span>
00989                                                                                                                 ;
00990         theMediaSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> );;
00991         theEndPointSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> );;
00992         theTRCSize = 4*((<span class="keyword">sizeof</span>( <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> ) +3)/4);
00993 
00994         theTagTabSize = <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a3">MyTagCount</a> * <span class="keyword">sizeof</span>( <a class="code" href="../../d5/d4/structicTag.html">icTag</a> ) + <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> );
00995         
00996         theTotalSize = theHeaderSize + theTagTabSize + theDescSize + theCopyRightSize
00997                 + theMediaSize + 3*theEndPointSize + 3*theTRCSize;
00998         aProf = (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *)GlobalAllocPtr( GHND, theTotalSize );
00999         <span class="keywordflow">if</span>( aProf == 0 ){
01000                 err = GetLastError();
01001                 <span class="keywordflow">goto</span> CleanupAndExit;
01002         }
01003 
01004         <span class="keywordflow">switch</span>( lpColorSpace-&gt;lcsIntent ){
01005           <span class="keywordflow">case</span> <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a21">LCS_GM_BUSINESS</a>:
01006                 aIntent = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a144">icSaturation</a>;
01007                 <span class="keywordflow">break</span>;
01008           <span class="keywordflow">case</span> <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a22">LCS_GM_GRAPHICS</a>:
01009                 aIntent = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a143">icRelativeColorimetric</a>;
01010                 <span class="keywordflow">break</span>;
01011           <span class="keywordflow">case</span> LCS_GM_ABS_COLORIMETRIC:
01012                 aIntent = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a>;
01013                 <span class="keywordflow">break</span>;
01014           <span class="keywordflow">default</span>:
01015                 aIntent = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a142">icPerceptual</a>;
01016                 <span class="keywordflow">break</span>;
01017         }
01018         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a6">MyAdd_NL_Header</a>(theTotalSize, (<a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>*)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), aIntent, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a122">icSigInputClass</a>, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a114">icSigRgbData</a>, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a109">icSigXYZData</a> );
01019         <span class="keywordflow">if</span> (err)
01020                 <span class="keywordflow">goto</span> CleanupAndExit;
01021                 
01022         <span class="comment">/*----------------------------------------------------------------------------------------- cmProfileDescriptionTag */</span>
01023         currentSize = theHeaderSize + theTagTabSize;
01024         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o0">count</a> ), <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a3">MyTagCount</a>);
01025 
01026         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a44">icSigProfileDescriptionTag</a>);
01027         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize);
01028         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theDescSize);
01029         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[0] = aTag;
01030         err =<a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a7">MyAdd_NL_DescriptionTag</a>    ( (<a class="code" href="../../d6/d8/structLHTextDescriptionType.html">LHTextDescriptionType</a> *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)theText );
01031         <span class="keywordflow">if</span> (err)
01032                 <span class="keywordflow">goto</span> CleanupAndExit;
01033         currentSize += theDescSize;
01034 
01035         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a39">icSigMediaWhitePointTag</a>);
01036         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01037         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theMediaSize);
01038         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[1] = aTag;
01039         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>((<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), &amp;D50);
01040         currentSize += theMediaSize;
01041 
01042         <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a27">NormalizeColor</a>( (<a class="code" href="../../d8/d6/structicXYZNumber.html">icXYZNumber</a>*)&amp;lpColorSpace-&gt;lcsEndpoints.ciexyzRed,
01043                                         (<a class="code" href="../../d8/d6/structicXYZNumber.html">icXYZNumber</a>*)&amp;lpColorSpace-&gt;lcsEndpoints.ciexyzGreen,
01044                                         (<a class="code" href="../../d8/d6/structicXYZNumber.html">icXYZNumber</a>*)&amp;lpColorSpace-&gt;lcsEndpoints.ciexyzBlue,
01045                                         &amp;D50XYZ,
01046                                         &amp;rXYZ,
01047                                         &amp;gXYZ,
01048                                         &amp;bXYZ );
01049         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a55">icSigRedColorantTag</a>);
01050         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01051         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theEndPointSize);
01052         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[2] = aTag;
01053         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>((<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), &amp;rXYZ );
01054         currentSize += theEndPointSize;
01055 
01056         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a34">icSigGreenColorantTag</a>);
01057         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01058         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theEndPointSize);
01059         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[3] = aTag;
01060         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>((<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), &amp;gXYZ );
01061         currentSize += theEndPointSize;
01062 
01063         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a21">icSigBlueColorantTag</a>);
01064         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01065         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theEndPointSize);
01066         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[4] = aTag;
01067         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>((<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), &amp;bXYZ );
01068         currentSize += theEndPointSize;
01069 
01070         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a56">icSigRedTRCTag</a>);
01071         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01072         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), <span class="keyword">sizeof</span>( <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> ));
01073         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[5] = aTag;
01074         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a9">MyAdd_NL_CurveTag</a>((icCurveType  *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(lpColorSpace-&gt;lcsGammaRed&gt;&gt;8) );
01075         currentSize += theTRCSize;
01076 
01077         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a35">icSigGreenTRCTag</a>);
01078         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01079         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), <span class="keyword">sizeof</span>( icCurveType ));
01080         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[6] = aTag;
01081         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a9">MyAdd_NL_CurveTag</a>((icCurveType  *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(lpColorSpace-&gt;lcsGammaGreen&gt;&gt;8) );
01082         currentSize += theTRCSize;
01083 
01084         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a22">icSigBlueTRCTag</a>);
01085         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01086         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), <span class="keyword">sizeof</span>( icCurveType ));
01087         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[7] = aTag;
01088         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a9">MyAdd_NL_CurveTag</a>((icCurveType  *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(lpColorSpace-&gt;lcsGammaBlue&gt;&gt;8) );
01089         currentSize += theTRCSize;
01090 
01091         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a29">icSigCopyrightTag</a>);
01092         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01093         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theCopyRightSize);
01094         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[8] = aTag;
01095         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a10">MyAdd_NL_CopyrightTag</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)copyrightText, (<a class="code" href="../../d7/d8/structLHTextType.html">LHTextType</a> *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize));
01096         <span class="keywordflow">if</span> (err)
01097                 <span class="keywordflow">goto</span> CleanupAndExit;
01098         currentSize += theCopyRightSize;
01099                 
01100         *theProf = aProf;
01101 <span class="preprocessor">#ifdef WRITE_PROFILE</span>
01102 <span class="preprocessor"></span>        <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a26">WriteProf</a>( <span class="stringliteral">"MyNewAbstract.pf"</span>, aProf, currentSize );
01103 <span class="preprocessor">#endif</span>
01104 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01105         
01106 CleanupAndExit:
01107         <span class="keywordflow">if</span>( aProf )GlobalFreePtr( aProf );
01108         <span class="keywordflow">return</span> err;
01109 }
01110 
01111 
01112 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a0">MyNewAbstractW</a>( LPLOGCOLORSPACEW        lpColorSpace, <a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> **theProf )
01113 {
01114         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
01115         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
01116 <span class="preprocessor">#ifdef __MWERKS__</span>
01117 <span class="preprocessor"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   theText[] = <span class="stringliteral">"\pLogColorSpProfile   "</span>;
01118         <span class="keywordtype">char</span>                    copyrightText[] = <span class="stringliteral">"\p©1996 by Heidelberger Druckmaschinen AG  U.J.K."</span>;
01119 <span class="preprocessor">#elif __IS_MSDOS</span>
01120 <span class="preprocessor"></span>        <span class="keywordtype">char</span>                    theText[] = <span class="stringliteral">"\030LogColorSpProfile      "</span>;
01121         <span class="keywordtype">char</span>                    copyrightText[] = <span class="stringliteral">"\060©1996 by Heidelberger Druckmaschinen AG  U.J.K."</span>;
01122 <span class="preprocessor">#else</span>
01123 <span class="preprocessor"></span>        <span class="keywordtype">char</span>                    theText[] = <span class="stringliteral">"\030LogColorSpProfile      "</span>;
01124         <span class="keywordtype">char</span>                    copyrightText[] = <span class="stringliteral">"\060©1996 by Heidelberger Druckmaschinen AG  U.J.K."</span>;
01125 <span class="preprocessor">#endif</span>
01126 <span class="preprocessor"></span>        <a class="code" href="../../d6/d3/structicProfile.html">icProfile</a>               *aProf=0;
01127         <span class="keywordtype">long</span>                    theTagTabSize;
01128         <span class="keywordtype">long</span>                    theHeaderSize;
01129         <span class="keywordtype">long</span>                    theDescSize;
01130         <span class="keywordtype">long</span>                    theMediaSize;
01131         <span class="keywordtype">long</span>                    theEndPointSize;
01132         <span class="keywordtype">long</span>                    theTRCSize;
01133         <span class="keywordtype">long</span>                    theCopyRightSize;
01134         <span class="keywordtype">long</span>                    currentSize=0;
01135         <span class="keywordtype">long</span>                    theTotalSize=0;
01136         <a class="code" href="../../d5/d4/structicTag.html">icTag</a>                   aTag;
01137         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>   aIntent;
01138 
01139         <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a>     rXYZ,gXYZ,bXYZ;
01140         <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> D50XYZ = { 0.9642, 1.0000, 0.8249 };
01141         <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> D50 = { (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(D50XYZ.<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o0">X</a> * 65536), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(D50XYZ.<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o1">Y</a> * 65536), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(D50XYZ.<a class="code" href="../../d5/d1/structMyDoubleXYZ.html#o2">Z</a> * 65536)};
01142         theHeaderSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>);
01143         theDescSize   =                                                                           <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)                        <span class="comment">/* type descriptor */</span>
01144                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* reserved */</span>
01145                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* ASCII length */</span>
01146                                                                                                                 + theText[0]                            <span class="comment">/* ASCII profile description */</span>
01147                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* Unicode code */</span>
01148                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* Unicode character count */</span>
01149                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)        <span class="comment">/* Macintosh script code */</span>
01150                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)         <span class="comment">/* Macintosh string length */</span>
01151                                                                                                                 + 67                                            <span class="comment">/* Macintosh string */</span>
01152                                                                                                                 ;
01153         theCopyRightSize   =                                                              <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)                        <span class="comment">/* type descriptor */</span>
01154                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* reserved */</span>
01155                                                                                                                 + copyrightText[0]                      <span class="comment">/* ASCII profile description */</span>
01156                                                                                                                 ;
01157         theMediaSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> );;
01158         theEndPointSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> );;
01159         theTRCSize = 4*((<span class="keyword">sizeof</span>( <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> ) +3)/4);
01160 
01161         theTagTabSize = <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a3">MyTagCount</a> * <span class="keyword">sizeof</span>( <a class="code" href="../../d5/d4/structicTag.html">icTag</a> ) + <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> );
01162         
01163         theTotalSize = theHeaderSize + theTagTabSize + theDescSize + theCopyRightSize
01164                 + theMediaSize + 3*theEndPointSize + 3*theTRCSize;
01165         aProf = (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *)GlobalAllocPtr( GHND, theTotalSize );
01166         <span class="keywordflow">if</span>( aProf == 0 ){
01167                 err = GetLastError();
01168                 <span class="keywordflow">goto</span> CleanupAndExit;
01169         }
01170 
01171         <span class="keywordflow">switch</span>( lpColorSpace-&gt;lcsIntent ){
01172           <span class="keywordflow">case</span> <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a21">LCS_GM_BUSINESS</a>:
01173                 aIntent = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a144">icSaturation</a>;
01174                 <span class="keywordflow">break</span>;
01175           <span class="keywordflow">case</span> <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a22">LCS_GM_GRAPHICS</a>:
01176                 aIntent = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a143">icRelativeColorimetric</a>;
01177                 <span class="keywordflow">break</span>;
01178           <span class="keywordflow">case</span> <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a22">LCS_GM_GRAPHICS</a>+1:
01179                 aIntent = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a>;
01180                 <span class="keywordflow">break</span>;
01181           <span class="keywordflow">default</span>:
01182                 aIntent = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a142">icPerceptual</a>;
01183                 <span class="keywordflow">break</span>;
01184         }
01185         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a6">MyAdd_NL_Header</a>(theTotalSize, (<a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>*)((Ptr)aProf+currentSize), aIntent, icSigInputClass, icSigRgbData, icSigXYZData );
01186         <span class="keywordflow">if</span> (err)
01187                 <span class="keywordflow">goto</span> CleanupAndExit;
01188                 
01189         <span class="comment">/*----------------------------------------------------------------------------------------- cmProfileDescriptionTag */</span>
01190         currentSize = theHeaderSize + theTagTabSize;
01191         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o0">count</a> ), MyTagCount);
01192 
01193         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), icSigProfileDescriptionTag);
01194         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize);
01195         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theDescSize);
01196         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[0] = aTag;
01197         err =<a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a7">MyAdd_NL_DescriptionTag</a>    ( (<a class="code" href="../../d6/d8/structLHTextDescriptionType.html">LHTextDescriptionType</a> *)((Ptr)aProf+currentSize), (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)theText );
01198         <span class="keywordflow">if</span> (err)
01199                 <span class="keywordflow">goto</span> CleanupAndExit;
01200         currentSize += theDescSize;
01201 
01202         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), icSigMediaWhitePointTag);
01203         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01204         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theMediaSize);
01205         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[1] = aTag;
01206         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>((<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *)((Ptr)aProf+currentSize), &amp;D50);
01207         currentSize += theMediaSize;
01208 
01209         <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a27">NormalizeColor</a>( (<a class="code" href="../../d8/d6/structicXYZNumber.html">icXYZNumber</a>*)&amp;lpColorSpace-&gt;lcsEndpoints.ciexyzRed,
01210                                         (<a class="code" href="../../d8/d6/structicXYZNumber.html">icXYZNumber</a>*)&amp;lpColorSpace-&gt;lcsEndpoints.ciexyzGreen,
01211                                         (<a class="code" href="../../d8/d6/structicXYZNumber.html">icXYZNumber</a>*)&amp;lpColorSpace-&gt;lcsEndpoints.ciexyzBlue,
01212                                         &amp;D50XYZ,
01213                                         &amp;rXYZ,
01214                                         &amp;gXYZ,
01215                                         &amp;bXYZ );
01216         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), icSigRedColorantTag);
01217         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01218         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theEndPointSize);
01219         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[2] = aTag;
01220         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>((<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *)((Ptr)aProf+currentSize), &amp;rXYZ );
01221         currentSize += theEndPointSize;
01222 
01223         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), icSigGreenColorantTag);
01224         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01225         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theEndPointSize);
01226         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[3] = aTag;
01227         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>((<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *)((Ptr)aProf+currentSize), &amp;gXYZ );
01228         currentSize += theEndPointSize;
01229 
01230         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), icSigBlueColorantTag);
01231         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01232         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theEndPointSize);
01233         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[4] = aTag;
01234         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>((<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *)((Ptr)aProf+currentSize), &amp;bXYZ );
01235         currentSize += theEndPointSize;
01236 
01237         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), icSigRedTRCTag);
01238         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01239         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), <span class="keyword">sizeof</span>( <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> ));
01240         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[5] = aTag;
01241         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a9">MyAdd_NL_CurveTag</a>((<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a>  *)((Ptr)aProf+currentSize), (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(lpColorSpace-&gt;lcsGammaRed&gt;&gt;8) );
01242         currentSize += theTRCSize;
01243 
01244         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), icSigGreenTRCTag);
01245         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01246         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), <span class="keyword">sizeof</span>( <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> ));
01247         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[6] = aTag;
01248         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a9">MyAdd_NL_CurveTag</a>((<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a>  *)((Ptr)aProf+currentSize), (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(lpColorSpace-&gt;lcsGammaGreen&gt;&gt;8) );
01249         currentSize += theTRCSize;
01250 
01251         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), icSigBlueTRCTag);
01252         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01253         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), <span class="keyword">sizeof</span>( <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> ));
01254         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[7] = aTag;
01255         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a9">MyAdd_NL_CurveTag</a>((<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a>  *)((Ptr)aProf+currentSize), (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(lpColorSpace-&gt;lcsGammaBlue&gt;&gt;8) );
01256         currentSize += theTRCSize;
01257 
01258         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), icSigCopyrightTag);
01259         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01260         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theCopyRightSize);
01261         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[8] = aTag;
01262         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a10">MyAdd_NL_CopyrightTag</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)copyrightText, (<a class="code" href="../../d7/d8/structLHTextType.html">LHTextType</a> *)((Ptr)aProf+currentSize));
01263         <span class="keywordflow">if</span> (err)
01264                 <span class="keywordflow">goto</span> CleanupAndExit;
01265         currentSize += theCopyRightSize;
01266                 
01267         *theProf = aProf;
01268 <span class="preprocessor">#ifdef WRITE_PROFILE</span>
01269 <span class="preprocessor"></span>        <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a26">WriteProf</a>( <span class="stringliteral">"MyNewAbstractW.pf"</span>, aProf, currentSize );
01270 <span class="preprocessor">#endif</span>
01271 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01272         
01273 CleanupAndExit:
01274         <span class="keywordflow">if</span>( aProf )GlobalFreePtr( aProf );
01275         <span class="keywordflow">return</span> err;
01276 }
01277 <span class="preprocessor">#endif</span>
01278 <span class="preprocessor"></span>
<a name="l01279"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a4">01279</a> <span class="preprocessor">#define MyTagCountLink 5</span>
<a name="l01280"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a5">01280</a> <span class="preprocessor"></span><span class="preprocessor">#define LINK_BUFFER_MAX 3000</span>
01281 <span class="preprocessor"></span>
<a name="l01282"></a><a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a29">01282</a> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a6">DeviceLinkFill</a>( CMMModelPtr cw,
01283                                                 <a class="code" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *profileSet,
01284                                                 <a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> **theProf,
01285                                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> aIntent )
01286 {
01287         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
01288         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
01289 <span class="preprocessor">#ifdef __MWERKS__</span>
01290 <span class="preprocessor"></span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   theText[] = <span class="stringliteral">"\pDeviceLink profile  "</span>;
01291         <span class="keywordtype">char</span>                    copyrightText[] = <span class="stringliteral">"\p©1996 by Heidelberger Druckmaschinen AG  U.J.K."</span>;
01292 <span class="preprocessor">#elif __IS_MSDOS</span>
01293 <span class="preprocessor"></span>        <span class="keywordtype">char</span>                    theText[] = <span class="stringliteral">"\030DeviceLink profile     "</span>;
01294         <span class="keywordtype">char</span>                    copyrightText[] = <span class="stringliteral">"\060©1996 by Heidelberger Druckmaschinen AG  U.J.K."</span>;
01295 <span class="preprocessor">#else</span>
01296 <span class="preprocessor"></span>        <span class="keywordtype">char</span>                    theText[] = <span class="stringliteral">"\030DeviceLink profile     "</span>;
01297         <span class="keywordtype">char</span>                    copyrightText[] = <span class="stringliteral">"\060©1996 by Heidelberger Druckmaschinen AG  U.J.K."</span>;
01298 <span class="preprocessor">#endif</span>
01299 <span class="preprocessor"></span>        <a class="code" href="../../d6/d3/structicProfile.html">icProfile</a>               *aProf=0;
01300         <span class="keywordtype">long</span>                    theTagTabSize;
01301         <span class="keywordtype">long</span>                    theHeaderSize;
01302         <span class="keywordtype">long</span>                    theDescSize;
01303         <span class="keywordtype">long</span>                    theMediaSize;
01304         <span class="keywordtype">long</span>                    theSequenceDescSize;
01305         <span class="keywordtype">long</span>                    theA2B0Size;
01306         <span class="keywordtype">long</span>                    theCopyRightSize;
01307         <span class="keywordtype">long</span>                    currentSize=0;
01308         <span class="keywordtype">long</span>                    theTotalSize=0;
01309         <a class="code" href="../../d5/d4/structicTag.html">icTag</a>                   aTag;
01310         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  sCS,dCS,clutSize;
01311         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                             aPtr=0;
01312 
01313         <a class="code" href="../../d5/d1/structMyDoubleXYZ.html">MyDoubleXYZ</a> D50XYZ = { 0.9642, 1.0000, 0.8249 };
01314         <a class="code" href="../../d8/d6/structicXYZNumber.html">MyXYZNumber</a> D50 = { (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(0.9642 * 65536), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(1.0000 * 65536), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)(0.8249 * 65536)};
01315         theHeaderSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>);
01316         theDescSize   =                                                                           <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)                        <span class="comment">/* type descriptor */</span>
01317                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* reserved */</span>
01318                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* ASCII length */</span>
01319                                                                                                                 + theText[0]                            <span class="comment">/* ASCII profile description */</span>
01320                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* Unicode code */</span>
01321                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* Unicode character count */</span>
01322                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)        <span class="comment">/* Macintosh script code */</span>
01323                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)         <span class="comment">/* Macintosh string length */</span>
01324                                                                                                                 + 67                                            <span class="comment">/* Macintosh string */</span>
01325                                                                                                                 ;
01326         theCopyRightSize   =                                                              <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)                        <span class="comment">/* type descriptor */</span>
01327                                                                                                                 + <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)         <span class="comment">/* reserved */</span>
01328                                                                                                                 + copyrightText[0]                      <span class="comment">/* ASCII profile description */</span>
01329                                                                                                                 ;
01330         theMediaSize = <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> );;
01331 
01332         theTagTabSize = <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a4">MyTagCountLink</a> * <span class="keyword">sizeof</span>( <a class="code" href="../../d5/d4/structicTag.html">icTag</a> ) + <span class="keyword">sizeof</span>( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> );
01333         
01334         *theProf = 0;
01335         
01336         <span class="keywordflow">if</span>( cw-&gt;hasNamedColorProf != <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a16">NoNamedColorProfile</a> ){
01337                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>;
01338                 <span class="keywordflow">goto</span> CleanupAndExit;
01339         }
01340         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a4">MyGetColorSpaces</a>( profileSet, &amp;sCS, &amp;dCS );
01341         <span class="keywordflow">if</span> (err)
01342                 <span class="keywordflow">goto</span> CleanupAndExit;
01343                 
01344         aProf = (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a6">SmartNewPtrClear</a>( <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a5">LINK_BUFFER_MAX</a>, &amp;aOSerr );
01345         err = aOSerr;
01346         <span class="keywordflow">if</span> (err)
01347                 <span class="keywordflow">goto</span> CleanupAndExit;
01348 
01349         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a6">MyAdd_NL_Header</a>(theTotalSize, (<a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>*)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), aIntent, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a125">icSigLinkClass</a>, sCS, dCS );
01350         <span class="keywordflow">if</span> (err)
01351                 <span class="keywordflow">goto</span> CleanupAndExit;
01352                 
01353         <span class="comment">/*----------------------------------------------------------------------------------------- cmProfileDescriptionTag */</span>
01354         currentSize = theHeaderSize + theTagTabSize;
01355         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o0">count</a> ), <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a4">MyTagCountLink</a>);
01356 
01357         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a44">icSigProfileDescriptionTag</a>);
01358         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize);
01359         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theDescSize);
01360         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[0] = aTag;
01361         err =<a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a7">MyAdd_NL_DescriptionTag</a>    ( (<a class="code" href="../../d6/d8/structLHTextDescriptionType.html">LHTextDescriptionType</a> *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)theText );
01362         <span class="keywordflow">if</span> (err)
01363                 <span class="keywordflow">goto</span> CleanupAndExit;
01364         currentSize += theDescSize;
01365         currentSize = ( currentSize + 3 ) &amp; ~ 3;
01366 
01367         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a39">icSigMediaWhitePointTag</a>);
01368         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01369         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theMediaSize);
01370         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[1] = aTag;
01371         <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a8">MyAdd_NL_ColorantTag</a>((<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a> *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), &amp;D50);
01372         currentSize += theMediaSize;
01373         currentSize = ( currentSize + 3 ) &amp; ~ 3;
01374 
01375         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a29">icSigCopyrightTag</a>);
01376         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01377         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theCopyRightSize);
01378         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[2] = aTag;
01379         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a10">MyAdd_NL_CopyrightTag</a>( (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)copyrightText, (<a class="code" href="../../d7/d8/structLHTextType.html">LHTextType</a> *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize));
01380         <span class="keywordflow">if</span> (err)
01381                 <span class="keywordflow">goto</span> CleanupAndExit;
01382         currentSize += theCopyRightSize;
01383         currentSize = ( currentSize + 3 ) &amp; ~ 3;
01384                 
01385         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a11">MyAdd_NL_SequenceDescTag</a>( profileSet, (<a class="code" href="../../d8/d3/structicProfileSequenceDescType.html">icProfileSequenceDescType</a> *)((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf+currentSize), &amp;theSequenceDescSize );
01386         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a45">icSigProfileSequenceDescTag</a>);
01387         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01388         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theSequenceDescSize);
01389         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[3] = aTag;
01390         currentSize += theSequenceDescSize;
01391         currentSize = ( currentSize + 3 ) &amp; ~ 3;
01392 
01393     theA2B0Size = <a class="code" href="../../d0/d7/w98_2mscmm_2memprof_8h.html#a7">GetSizes</a>( (<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>)cw, &amp;clutSize );
01394 
01395         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o0">sig</a> ), <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>);
01396         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o1">offset</a> ), currentSize );
01397         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>(&amp;(aTag.<a class="code" href="../../d5/d4/structicTag.html#o2">size</a> ), theA2B0Size);
01398         aProf-&gt;<a class="code" href="../../d6/d3/structicProfile.html#o3">tagList</a>.<a class="code" href="../../d7/d4/structicTagList.html#o1">tags</a>[4] = aTag;
01399 
01400 <span class="preprocessor">#if __IS_MSDOS</span>
01401 <span class="preprocessor"></span>        aPtr = GlobalAllocPtr( GHND, theA2B0Size+currentSize );
01402         <span class="keywordflow">if</span>( aPtr == 0 ){
01403                 err = GetLastError();
01404                 <span class="keywordflow">goto</span> CleanupAndExit;
01405         }
01406 <span class="preprocessor">#else   </span>
01407 <span class="preprocessor"></span>        aPtr =  <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>( theA2B0Size+currentSize, &amp;aOSerr );
01408         err = aOSerr;
01409         <span class="keywordflow">if</span>( err ){
01410                 <span class="keywordflow">goto</span> CleanupAndExit;
01411         }
01412 <span class="preprocessor">#endif</span>
01413 <span class="preprocessor"></span>
01414 
01415         <span class="keywordflow">if</span> ( cw-&gt;lutParam.colorLutWordSize == 8 )
01416         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a12">MyAdd_NL_AToB0Tag_mft1</a>( (<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>)cw, (<a class="code" href="../../d9/d2/structicLut8Type.html">icLut8Type</a> *)(aPtr+currentSize), clutSize );
01417     <span class="keywordflow">else</span>
01418         err = <a class="code" href="../../d3/d6/w98_2lh__core_2memlink_8h.html#a13">MyAdd_NL_AToB0Tag_mft2</a>( (<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>)cw, (<a class="code" href="../../d7/d2/structicLut16Type.html">icLut16Type</a> *)(aPtr+currentSize), clutSize );
01419 
01420         <span class="keywordflow">if</span> (err)
01421                 <span class="keywordflow">goto</span> CleanupAndExit;
01422 
01423         <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a10">BlockMove</a>( (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf, aPtr, currentSize );
01424         aProf = (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>( (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf );
01425 
01426         <a class="code" href="../../d0/d6/lh__core_2memlink_8c.html#a1">CMHelperICC2int32Const</a>( aPtr, theA2B0Size+currentSize );
01427 
01428         *theProf = (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *)aPtr;
01429 <span class="preprocessor">#ifdef WRITE_PROFILE</span>
01430 <span class="preprocessor"></span>        <a class="code" href="../../d9/d6/w98_2mscmm_2icm32_8c.html#a26">WriteProf</a>( <span class="stringliteral">"DeviceLinkFill.pf"</span>, (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *)aPtr, theA2B0Size+currentSize );
01431 <span class="preprocessor">#endif</span>
01432 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01433         
01434 CleanupAndExit:
01435         *theProf = (<a class="code" href="../../d6/d3/structicProfile.html">icProfile</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>( (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aProf );
01436 <span class="preprocessor">#if __IS_MSDOS</span>
01437 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( aPtr )GlobalFreePtr( aPtr );
01438 <span class="preprocessor">#else</span>
01439 <span class="preprocessor"></span>        aPtr = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>( (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)aPtr );
01440 <span class="preprocessor">#endif</span>
01441 <span class="preprocessor"></span>        <span class="keywordflow">return</span> err;
01442 }
01443 
01444 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:43 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
