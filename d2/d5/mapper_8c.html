<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mapper.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>mapper.c File Reference</h1><code>#include "<a class="el" href="../../d1/d5/iop_8h-source.html">iop.h</a>"</code><br>

<p>
<a href="../../d3/d4/mapper_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">_FIRMWARE_CONFIGURATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/struct__DEVICE__EXTENSION.html">_DEVICE_EXTENSION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">_FIRMWARE_IDENT_TO_PNP_ID</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d6/struct__MAPPER__SEED.html">_MAPPER_SEED</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d6/struct__KEY__SEED.html">_KEY_SEED</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a0">OPTIONS_NONE</a>&nbsp;&nbsp;&nbsp;0x00000000</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a1">OPTIONS_INSERT_PNP_ID</a>&nbsp;&nbsp;&nbsp;0x00000001</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a2">OPTIONS_INSERT_DEVICEDESC</a>&nbsp;&nbsp;&nbsp;0x00000002</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a3">OPTIONS_INSERT_COMPATIBLE_IDS</a>&nbsp;&nbsp;&nbsp;0x00000004</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a4">OPTIONS_INSERT_PHANTOM_MARKER</a>&nbsp;&nbsp;&nbsp;0x00000008</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a5">KEY_SEED_REQUIRED</a>&nbsp;&nbsp;&nbsp;0x00000000</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a6">KEY_SEED_DEVICE_PARAMETERS</a>&nbsp;&nbsp;&nbsp;0x00000001</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a7">PS2_KEYBOARD_COMPATIBLE_ID</a>&nbsp;&nbsp;&nbsp;L"PS2_KEYBOARD"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a8">PS2_MOUSE_COMPATIBLE_ID</a>&nbsp;&nbsp;&nbsp;L"PS2_MOUSE"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a9">DebugPrint</a>(X)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a10">CONTROLLER_TYPES_COUNT</a>&nbsp;&nbsp;&nbsp;(sizeof(controllerTypes) / sizeof(controllerTypes[0]))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a11">SEED_BUFFER_SIZE</a>&nbsp;&nbsp;&nbsp;(512 * sizeof(WCHAR))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a12">ENUM_KEY_BUFFER_SIZE</a>&nbsp;&nbsp;&nbsp;(1024 * sizeof(WCHAR))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a13">INSTANCE_BUFFER_SIZE</a>&nbsp;&nbsp;&nbsp;(256 * sizeof(WCHAR))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a14">COMPORT_DB_MERGE_SIZE</a>&nbsp;&nbsp;&nbsp;32</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">_FIRMWARE_CONFIGURATION</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a15">FIRMWARE_CONFIGURATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">_FIRMWARE_CONFIGURATION</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a16">PFIRMWARE_CONFIGURATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d3/struct__DEVICE__EXTENSION.html">_DEVICE_EXTENSION</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a17">DEVICE_EXTENSION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d3/struct__DEVICE__EXTENSION.html">_DEVICE_EXTENSION</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a18">PDEVICE_EXTENSION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">_FIRMWARE_IDENT_TO_PNP_ID</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a19">FIRMWARE_IDENT_TO_PNP_ID</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">_FIRMWARE_IDENT_TO_PNP_ID</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a20">PFIRMWARE_IDENT_TO_PNP_ID</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d6/struct__MAPPER__SEED.html">_MAPPER_SEED</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a21">MAPPER_SEED</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d6/struct__MAPPER__SEED.html">_MAPPER_SEED</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a22">PMAPPER_SEED</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d6/struct__KEY__SEED.html">_KEY_SEED</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a23">KEY_SEED</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d6/struct__KEY__SEED.html">_KEY_SEED</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a24">PKEY_SEED</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">PFIRMWARE_IDENT_TO_PNP_ID</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a36">MapperFindIdentMatch</a> (<a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">PFIRMWARE_IDENT_TO_PNP_ID</a> IdentTable, PWCHAR <a class="el" href="../../d0/d0/tdetach_8c.html#a0">String</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a37">MapperTranslatePnPId</a> (<a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> PeripheralType, PKEY_VALUE_FULL_INFORMATION Identifier)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a38">MapperPeripheralCallback</a> (IN PVOID Context, IN PUNICODE_STRING PathName, IN INTERFACE_TYPE BusType, IN ULONG <a class="el" href="../../d2/d7/hal_8h.html#a75">BusNumber</a>, IN PKEY_VALUE_FULL_INFORMATION *BusInformation, IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> ControllerType, IN ULONG ControllerNumber, IN PKEY_VALUE_FULL_INFORMATION *ControllerInformation, IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> PeripheralType, IN ULONG PeripheralNumber, IN PKEY_VALUE_FULL_INFORMATION *PeripheralInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a39">MapperCallback</a> (IN PVOID Context, IN PUNICODE_STRING PathName, IN INTERFACE_TYPE BusType, IN ULONG <a class="el" href="../../d2/d7/hal_8h.html#a75">BusNumber</a>, IN PKEY_VALUE_FULL_INFORMATION *BusInformation, IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> ControllerType, IN ULONG ControllerNumber, IN PKEY_VALUE_FULL_INFORMATION *ControllerInformation, IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> PeripheralType, IN ULONG PeripheralNumber, IN PKEY_VALUE_FULL_INFORMATION *PeripheralInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a40">MapperMarkKey</a> (IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, IN PUNICODE_STRING PathName, IN <a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a> FirmwareEntry)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a41">MapperSeedKey</a> (IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, IN PUNICODE_STRING PathName, IN <a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a> FirmwareEntry, IN BOOLEAN DeviceIsPhantom)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PCM_RESOURCE_LIST&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a42">MapperAdjustResourceList</a> (IN PCM_RESOURCE_LIST ResourceList, IN PWCHAR PnPId, IN OUT PULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a43">ComPortDBAdd</a> (IN HANDLE DeviceParamKey, IN PWSTR <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a5">PortName</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a44">MapperProcessFirmwareTree</a> (IN BOOLEAN OnlyProcessSerialPorts)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a45">MapperFreeList</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a46">MapperConstructRootEnumTree</a> (IN BOOLEAN CreatePhantomDevices)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a47">MapperPhantomizeDetectedComPorts</a> (VOID)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d3/struct__DEVICE__EXTENSION.html">DEVICE_EXTENSION</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a25">MapperDeviceExtension</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">FIRMWARE_IDENT_TO_PNP_ID</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a26">KeyboardMap</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">FIRMWARE_IDENT_TO_PNP_ID</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a27">PointerMap</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d7/d6/struct__MAPPER__SEED.html">MAPPER_SEED</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a28">MapperValueSeed</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d6/struct__KEY__SEED.html">KEY_SEED</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a29">MapperKeySeed</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a30">SerialId</a> = L"*PNP0501"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a31">SerialIdNEC</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a32">ParallelId</a> = L"*PNP0400"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a33">ParallelIdNEC</a> = L"*nEC1401"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a34">FloppyId</a> = L"*PNP0700"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/mapper_8c.html#a35">ATAId</a> = L"*PNP0600"</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a14" doxytag="mapper.c::COMPORT_DB_MERGE_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define COMPORT_DB_MERGE_SIZE&nbsp;&nbsp;&nbsp;32          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01955">ComPortDBAdd()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="mapper.c::CONTROLLER_TYPES_COUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CONTROLLER_TYPES_COUNT&nbsp;&nbsp;&nbsp;(sizeof(controllerTypes) / sizeof(controllerTypes[0]))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01009">MapperProcessFirmwareTree()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="mapper.c::DebugPrint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DebugPrint          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">X&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00272">272</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="mapper.c::ENUM_KEY_BUFFER_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ENUM_KEY_BUFFER_SIZE&nbsp;&nbsp;&nbsp;(1024 * sizeof(WCHAR))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01600">MapperConstructRootEnumTree()</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l02060">MapperPhantomizeDetectedComPorts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="mapper.c::INSTANCE_BUFFER_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define INSTANCE_BUFFER_SIZE&nbsp;&nbsp;&nbsp;(256 * sizeof(WCHAR))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01600">MapperConstructRootEnumTree()</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l02060">MapperPhantomizeDetectedComPorts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="mapper.c::KEY_SEED_DEVICE_PARAMETERS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KEY_SEED_DEVICE_PARAMETERS&nbsp;&nbsp;&nbsp;0x00000001          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00106">106</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="mapper.c::KEY_SEED_REQUIRED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KEY_SEED_REQUIRED&nbsp;&nbsp;&nbsp;0x00000000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00105">105</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mapper.c::OPTIONS_INSERT_COMPATIBLE_IDS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OPTIONS_INSERT_COMPATIBLE_IDS&nbsp;&nbsp;&nbsp;0x00000004          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00091">91</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mapper.c::OPTIONS_INSERT_DEVICEDESC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OPTIONS_INSERT_DEVICEDESC&nbsp;&nbsp;&nbsp;0x00000002          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00090">90</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="mapper.c::OPTIONS_INSERT_PHANTOM_MARKER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OPTIONS_INSERT_PHANTOM_MARKER&nbsp;&nbsp;&nbsp;0x00000008          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00092">92</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="mapper.c::OPTIONS_INSERT_PNP_ID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OPTIONS_INSERT_PNP_ID&nbsp;&nbsp;&nbsp;0x00000001          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00089">89</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="mapper.c::OPTIONS_NONE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OPTIONS_NONE&nbsp;&nbsp;&nbsp;0x00000000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00088">88</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="mapper.c::PS2_KEYBOARD_COMPATIBLE_ID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS2_KEYBOARD_COMPATIBLE_ID&nbsp;&nbsp;&nbsp;L"PS2_KEYBOARD"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00148">148</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="mapper.c::PS2_MOUSE_COMPATIBLE_ID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS2_MOUSE_COMPATIBLE_ID&nbsp;&nbsp;&nbsp;L"PS2_MOUSE"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00149">149</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="mapper.c::SEED_BUFFER_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEED_BUFFER_SIZE&nbsp;&nbsp;&nbsp;(512 * sizeof(WCHAR))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a17" doxytag="mapper.c::DEVICE_EXTENSION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d3/struct__DEVICE__EXTENSION.html">_DEVICE_EXTENSION</a>  <a class="el" href="../../d8/d3/struct__DEVICE__EXTENSION.html">DEVICE_EXTENSION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="mapper.c::FIRMWARE_CONFIGURATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">_FIRMWARE_CONFIGURATION</a>  <a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">FIRMWARE_CONFIGURATION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00658">MapperCallback()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="mapper.c::FIRMWARE_IDENT_TO_PNP_ID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">_FIRMWARE_IDENT_TO_PNP_ID</a>  <a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">FIRMWARE_IDENT_TO_PNP_ID</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="mapper.c::KEY_SEED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d6/struct__KEY__SEED.html">_KEY_SEED</a>  <a class="el" href="../../d6/d6/struct__KEY__SEED.html">KEY_SEED</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="mapper.c::MAPPER_SEED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d6/struct__MAPPER__SEED.html">_MAPPER_SEED</a>  <a class="el" href="../../d7/d6/struct__MAPPER__SEED.html">MAPPER_SEED</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="mapper.c::PDEVICE_EXTENSION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d3/struct__DEVICE__EXTENSION.html">_DEVICE_EXTENSION</a> * <a class="el" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="mapper.c::PFIRMWARE_CONFIGURATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">_FIRMWARE_CONFIGURATION</a> * <a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00658">MapperCallback()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01600">MapperConstructRootEnumTree()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01549">MapperFreeList()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00535">MapperPeripheralCallback()</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l02060">MapperPhantomizeDetectedComPorts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="mapper.c::PFIRMWARE_IDENT_TO_PNP_ID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">_FIRMWARE_IDENT_TO_PNP_ID</a> * <a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">PFIRMWARE_IDENT_TO_PNP_ID</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00367">MapperFindIdentMatch()</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l00402">MapperTranslatePnPId()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="mapper.c::PKEY_SEED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d6/struct__KEY__SEED.html">_KEY_SEED</a> * <a class="el" href="../../d6/d6/struct__KEY__SEED.html">PKEY_SEED</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="mapper.c::PMAPPER_SEED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d6/struct__MAPPER__SEED.html">_MAPPER_SEED</a> * <a class="el" href="../../d7/d6/struct__MAPPER__SEED.html">PMAPPER_SEED</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a43" doxytag="mapper.c::ComPortDBAdd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ComPortDBAdd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceParamKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>PortName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l01955">1955</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a14">COMPORT_DB_MERGE_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01156">IopCreateRegistryKeyEx()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d4/d8/ulpc_8h-source.html#l00032">PortName</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01520">RtlCompareUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01959 {
01960     UNICODE_STRING                  portNameString;
01961     UNICODE_STRING                  portPrefixString;
01962     UNICODE_STRING                  comDBName;
01963     UNICODE_STRING                  valueName;
01964     PKEY_VALUE_PARTIAL_INFORMATION  valueInfo;
01965     ULONG                           valueInfoLength;
01966     ULONG                           returnedLength;
01967     HANDLE                          comDBKey;
01968     ULONG                           portNo;
01969     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                        status;
01970 
01971     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;portNameString, PortName);
01972 
01973     <span class="keywordflow">if</span> (portNameString.Length &gt; 3 * <span class="keyword">sizeof</span>(WCHAR)) {
01974         portNameString.Length = 3 * <span class="keyword">sizeof</span>(WCHAR);
01975     }
01976 
01977     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;portPrefixString, L<span class="stringliteral">"COM"</span>);
01978 
01979     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a41">RtlCompareUnicodeString</a>(&amp;portNameString, &amp;portPrefixString, TRUE) == 0) {
01980         portNo = _wtol(&amp;PortName[3]);
01981 
01982         <span class="keywordflow">if</span> (portNo &gt; 0 &amp;&amp; portNo &lt;= 256) {
01983 
01984 <span class="preprocessor">#if UMODETEST</span>
01985 <span class="preprocessor"></span>            <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;comDBName, L<span class="stringliteral">"\\Registry\\Machine\\System\\TestControlSet\\Control\\COM Name Arbiter"</span>);
01986 <span class="preprocessor">#else</span>
01987 <span class="preprocessor"></span>            <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;comDBName, L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\COM Name Arbiter"</span>);
01988 <span class="preprocessor">#endif</span>
01989 <span class="preprocessor"></span>
01990             status = <a class="code" href="../../d9/d1/pnpsubs_8c.html#a8">IopCreateRegistryKeyEx</a>( &amp;comDBKey,
01991                                              NULL,
01992                                              &amp;comDBName,
01993                                              KEY_ALL_ACCESS,
01994                                              REG_OPTION_NON_VOLATILE,
01995                                              NULL
01996                                              );
01997 
01998             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01999 
02000                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;valueName, L<span class="stringliteral">"ComDB Merge"</span>);
02001 
02002 <span class="preprocessor">#define COMPORT_DB_MERGE_SIZE    32           //  256 / 8</span>
02003 <span class="preprocessor"></span>
02004                 valueInfoLength = <span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <a class="code" href="../../d2/d5/mapper_8c.html#a14">COMPORT_DB_MERGE_SIZE</a>;
02005                 valueInfo = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, valueInfoLength);
02006 
02007                 <span class="keywordflow">if</span> (valueInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02008 
02009                     status = ZwQueryValueKey( comDBKey,
02010                                               &amp;valueName,
02011                                               KeyValuePartialInformation,
02012                                               valueInfo,
02013                                               valueInfoLength,
02014                                               &amp;returnedLength);
02015 
02016                     <span class="keywordflow">if</span> (status == STATUS_OBJECT_NAME_NOT_FOUND) {
02017 
02018                         valueInfo-&gt;Type = REG_BINARY;
02019                         valueInfo-&gt;DataLength = <a class="code" href="../../d2/d5/mapper_8c.html#a14">COMPORT_DB_MERGE_SIZE</a>;
02020                         RtlZeroMemory(valueInfo-&gt;Data, valueInfo-&gt;DataLength);
02021                         status = STATUS_SUCCESS;
02022                     }
02023 
02024                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02025                         portNo--;
02026                         valueInfo-&gt;Data[ portNo / 8 ] |= 1 &lt;&lt; (portNo % 8);
02027 
02028                         status = ZwSetValueKey( comDBKey,
02029                                                 &amp;valueName,
02030                                                 0,
02031                                                 valueInfo-&gt;Type,
02032                                                 valueInfo-&gt;Data,
02033                                                 valueInfo-&gt;DataLength );
02034 
02035                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status));
02036                     }
02037 
02038                     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(valueInfo);
02039                 }
02040 
02041                 ZwClose(comDBKey);
02042             }
02043         }
02044     }
02045 
02046     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;valueName, L<span class="stringliteral">"PortName"</span> );
02047 
02048     status = ZwSetValueKey( DeviceParamKey,
02049                             &amp;valueName,
02050                             0,
02051                             REG_SZ,
02052                             PortName,
02053                             (wcslen(PortName) + 1) * <span class="keyword">sizeof</span>(WCHAR) );
02054 
02055     <span class="keywordflow">return</span> status;
02056 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="mapper.c::MapperAdjustResourceList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PCM_RESOURCE_LIST MapperAdjustResourceList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCM_RESOURCE_LIST&nbsp;</td>
          <td class="mdname" nowrap> <em>ResourceList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>PnPId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l01803">1803</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00231">FloppyId</a>, <a class="el" href="../../d8/d2/i386init_8c-source.html#l00038">KeI386MachineType</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01091">MapperMarkKey()</a>.
<p>
<pre class="fragment"><div>01808 {
01809     PCM_PARTIAL_RESOURCE_LIST       partialResourceList;
01810     PCM_PARTIAL_RESOURCE_DESCRIPTOR problemPartialDescriptors;
01811     PCM_PARTIAL_RESOURCE_DESCRIPTOR partialDescriptors;
01812     PCM_RESOURCE_LIST               newResourceList;
01813     ULONG                           i;
01814 
01815     newResourceList = ResourceList;
01816 
01817 <span class="preprocessor">#if _X86_</span>
01818 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/i386init_8c.html#a1">KeI386MachineType</a> == MACHINE_TYPE_EISA) {
01819 
01820         PCM_FULL_RESOURCE_DESCRIPTOR    fullDescriptor;
01821         PCM_PARTIAL_RESOURCE_DESCRIPTOR partialDescriptor;
01822         PUCHAR                          nextDescriptor;
01823         ULONG                           j;
01824         ULONG                           lastResourceIndex;
01825 
01826         fullDescriptor = &amp;ResourceList-&gt;List[0];
01827 
01828         <span class="keywordflow">for</span> (i = 0; i &lt; ResourceList-&gt;Count; i++) {
01829 
01830             partialResourceList = &amp;fullDescriptor-&gt;PartialResourceList;
01831 
01832             <span class="keywordflow">for</span> (j = 0; j &lt; partialResourceList-&gt;Count; j++) {
01833                 partialDescriptor = &amp;partialResourceList-&gt;PartialDescriptors[j];
01834 
01835                 <span class="keywordflow">if</span> (partialDescriptor-&gt;Type == CmResourceTypePort) {
01836                     <span class="keywordflow">if</span> (partialDescriptor-&gt;u.Port.Start.HighPart == 0 &amp;&amp;
01837                         (partialDescriptor-&gt;u.Port.Start.LowPart &amp; 0x00000300) == 0) {
01838                         partialDescriptor-&gt;Flags |= CM_RESOURCE_PORT_16_BIT_DECODE;
01839                     }
01840                 }
01841             }
01842 
01843             nextDescriptor = (PUCHAR)fullDescriptor + <span class="keyword">sizeof</span>(CM_FULL_RESOURCE_DESCRIPTOR);
01844 
01845             <span class="comment">//</span>
01846             <span class="comment">// account for any resource descriptors in addition to the single</span>
01847             <span class="comment">// imbedded one I've already accounted for (if there aren't any,</span>
01848             <span class="comment">// then I'll end up subtracting off the extra imbedded descriptor</span>
01849             <span class="comment">// from the previous step)</span>
01850             <span class="comment">//</span>
01851             <span class="comment">//</span>
01852             <span class="comment">// finally, account for any extra device specific data at the end of</span>
01853             <span class="comment">// the last partial resource descriptor (if any)</span>
01854             <span class="comment">//</span>
01855             <span class="keywordflow">if</span> (partialResourceList-&gt;Count &gt; 0) {
01856 
01857                 nextDescriptor += (partialResourceList-&gt;Count - 1) *
01858                      <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_DESCRIPTOR);
01859 
01860                 lastResourceIndex = partialResourceList-&gt;Count - 1;
01861 
01862                 <span class="keywordflow">if</span> (partialResourceList-&gt;PartialDescriptors[lastResourceIndex].Type ==
01863                           CmResourceTypeDeviceSpecific) {
01864 
01865                     nextDescriptor += partialResourceList-&gt;PartialDescriptors[lastResourceIndex].
01866                                u.DeviceSpecificData.DataSize;
01867                 }
01868             }
01869 
01870             fullDescriptor = (PCM_FULL_RESOURCE_DESCRIPTOR)nextDescriptor;
01871         }
01872     }
01873 <span class="preprocessor">#endif</span>
01874 <span class="preprocessor"></span>
01875     <span class="keywordflow">if</span> (wcscmp(PnPId, FloppyId) == 0) {
01876 
01877         <span class="keywordflow">if</span> (ResourceList-&gt;Count == 1) {
01878 
01879             partialResourceList = &amp;ResourceList-&gt;List-&gt;PartialResourceList;
01880 
01881             partialDescriptors = partialResourceList-&gt;PartialDescriptors;
01882 
01883             <span class="comment">//</span>
01884             <span class="comment">// Look for the one and only one 8 byte port resource</span>
01885             <span class="comment">//</span>
01886             problemPartialDescriptors = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01887             <span class="keywordflow">for</span> (i=0; i&lt;partialResourceList-&gt;Count; i++) {
01888 
01889                 <span class="keywordflow">if</span> ((partialDescriptors[i].Type == CmResourceTypePort) &amp;&amp;
01890                     (partialDescriptors[i].u.Port.Length == 8)) {
01891 
01892                     <span class="keywordflow">if</span> (problemPartialDescriptors == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01893 
01894                         problemPartialDescriptors = partialDescriptors + i;
01895                     } <span class="keywordflow">else</span> {
01896 
01897                         problemPartialDescriptors = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01898                         <span class="keywordflow">break</span>;
01899                     }
01900                 }
01901             }
01902 
01903             <span class="keywordflow">if</span> (problemPartialDescriptors) {
01904 
01905                 problemPartialDescriptors-&gt;u.Port.Length = 6;
01906 
01907                 newResourceList = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a> (
01908                                       NonPagedPool,
01909                                       *Size + <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_DESCRIPTOR)
01910                                       );
01911                 <span class="keywordflow">if</span> (newResourceList) {
01912 
01913                     RtlMoveMemory (
01914                         newResourceList,
01915                         ResourceList,
01916                         *Size
01917                         );
01918 
01919                     <span class="comment">//</span>
01920                     <span class="comment">// pick out the new partial resource descriptor</span>
01921                     <span class="comment">//</span>
01922                     partialDescriptors = newResourceList-&gt;List-&gt;
01923                                              PartialResourceList.PartialDescriptors;
01924                     partialDescriptors += newResourceList-&gt;List-&gt;PartialResourceList.Count;
01925 
01926                     RtlMoveMemory (
01927                         partialDescriptors,
01928                         problemPartialDescriptors,
01929                         <span class="keyword">sizeof</span>(*partialDescriptors)
01930                         );
01931 
01932                     partialDescriptors-&gt;u.Port.Start.QuadPart += 7;
01933                     partialDescriptors-&gt;u.Port.Length = 1;
01934 
01935                     <span class="comment">//</span>
01936                     <span class="comment">// we got one more now</span>
01937                     <span class="comment">//</span>
01938                     newResourceList-&gt;List-&gt;PartialResourceList.Count++;
01939                     *<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> += <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_DESCRIPTOR);
01940 
01941                     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (ResourceList);
01942 
01943                 } <span class="keywordflow">else</span> {
01944 
01945                     newResourceList = ResourceList;
01946                 }
01947             }
01948         }
01949     }
01950 
01951     <span class="keywordflow">return</span> newResourceList;
01952 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="mapper.c::MapperCallback" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS MapperCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>PathName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN INTERFACE_TYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>BusType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BusNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEY_VALUE_FULL_INFORMATION *&nbsp;</td>
          <td class="mdname" nowrap> <em>BusInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ControllerType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ControllerNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEY_VALUE_FULL_INFORMATION *&nbsp;</td>
          <td class="mdname" nowrap> <em>ControllerInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PeripheralType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PeripheralNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEY_VALUE_FULL_INFORMATION *&nbsp;</td>
          <td class="mdname" nowrap> <em>PeripheralInformation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00658">658</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d3/d6/hal_8h-source.html#l01170">BusNumber</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00049">_FIRMWARE_CONFIGURATION::BusNumber</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00048">_FIRMWARE_CONFIGURATION::BusType</a>, <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00051">_FIRMWARE_CONFIGURATION::ControllerNumber</a>, <a class="el" href="../../d4/d9/arcinst_8h.html#a174a65">ControllerType</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00050">_FIRMWARE_CONFIGURATION::ControllerType</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a200">DiskController</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a15">FIRMWARE_CONFIGURATION</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00073">_DEVICE_EXTENSION::FirmwareList</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a213">FloppyDiskPeripheral</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00059">_FIRMWARE_CONFIGURATION::Identifier</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00057">_FIRMWARE_CONFIGURATION::IdentifierLength</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00058">_FIRMWARE_CONFIGURATION::IdentifierType</a>, <a class="el" href="../../d0/d5/io_8h.html#a599a403">IoQueryDeviceConfigurationData</a>, <a class="el" href="../../d3/d2/io_2query_8c-source.html#l00070">IoQueryDeviceDescription()</a>, <a class="el" href="../../d0/d5/io_8h.html#a599a402">IoQueryDeviceIdentifier</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a209">KeyboardController</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a219">KeyboardPeripheral</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00535">MapperPeripheralCallback()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00402">MapperTranslatePnPId()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00047">_FIRMWARE_CONFIGURATION::Next</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a207">ParallelController</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00225">ParallelIdNEC</a>, <a class="el" href="../../d7/d7/fs__rec_8h.html#a14">PDEVICE_EXTENSION</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00053">_FIRMWARE_CONFIGURATION::PeripheralNumber</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00052">_FIRMWARE_CONFIGURATION::PeripheralType</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a16">PFIRMWARE_CONFIGURATION</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00060">_FIRMWARE_CONFIGURATION::PnPId</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a208">PointerController</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a218">PointerPeripheral</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00056">_FIRMWARE_CONFIGURATION::ResourceDescriptor</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00055">_FIRMWARE_CONFIGURATION::ResourceDescriptorSize</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00208">SerialIdNEC</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01009">MapperProcessFirmwareTree()</a>.
<p>
<pre class="fragment"><div>00674                    :
00675 
00676     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to acquire firmware tree information about
00677     pointer devices in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
00678 
00679 Arguments:
00680 
00681     Context               - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d7/d1/genuedef_8c.html#a6">extension</a>.
00682     PathName              - unicode registry <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>.
00683     BusType               - Internal, Isa, ...
00684     <a class="code" href="../../d2/d7/hal_8h.html#a75">BusNumber</a>             - Which bus <span class="keywordflow">if</span> we are on a multibus system.
00685     BusInformation        - Configuration information about <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bus. Not Used.
00686     <a class="code" href="../../d4/d9/arcinst_8h.html#a174a65">ControllerType</a>        - serial or ata disk.
00687     ControllerNumber      - Which controller <span class="keywordflow">if</span> there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> more than one
00688                             controller in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
00689     ControllerInformation - Array of pointers to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> three pieces of
00690                             registry information.
00691     <a class="code" href="../../d4/d9/arcinst_8h.html#a174a66">PeripheralType</a>        - Undefined <span class="keywordflow">for</span> <span class="keyword">this</span> call.
00692     PeripheralNumber      - Undefined <span class="keywordflow">for</span> <span class="keyword">this</span> call.
00693     PeripheralInformation - Undefined <span class="keywordflow">for</span> <span class="keyword">this</span> call.
00694 
00695 Return Value:
00696 
00697     STATUS_SUCCESS <span class="keywordflow">if</span> everything went ok, or STATUS_INSUFFICIENT_RESOURCES
00698     <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> couldn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> map <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base csr or acquire <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device object, or
00699     all of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource information couldn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> be acquired.
00700 
00701 --*/
00702 
00703 {
00704     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a>               deviceExtension = Context;
00705     PCM_FULL_RESOURCE_DESCRIPTOR    controllerData;
00706     PKEY_VALUE_FULL_INFORMATION     information;
00707     <a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a>         firmwareEntry;
00708     <a class="code" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>              peripheralType;
00709     PUCHAR                          buffer;
00710     PUCHAR                          identifier;
00711     ULONG                           dataLength;
00712 
00713     <span class="comment">//</span>
00714     <span class="comment">// If entry is found, but there is no information just return</span>
00715     <span class="comment">//</span>
00716 
00717     <span class="keywordflow">if</span> (!(information = ControllerInformation[<a class="code" href="../../d0/d5/io_8h.html#a599a403">IoQueryDeviceConfigurationData</a>])) {
00718 
00719         <span class="keywordflow">return</span> STATUS_SUCCESS;
00720     }
00721 
00722     <span class="keywordflow">if</span> (!(dataLength = information-&gt;DataLength)) {
00723 
00724         <span class="keywordflow">return</span> STATUS_SUCCESS;
00725     }
00726 
00727     <span class="comment">//</span>
00728     <span class="comment">// Setup to capture the information from the firmware tree</span>
00729     <span class="comment">//</span>
00730 
00731     firmwareEntry = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">FIRMWARE_CONFIGURATION</a>));
00732     <span class="keywordflow">if</span> (!firmwareEntry) {
00733 
00734         <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;
00735     }
00736     RtlZeroMemory(firmwareEntry, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">FIRMWARE_CONFIGURATION</a>));
00737 
00738     <span class="comment">//</span>
00739     <span class="comment">// Save information concerning the controller</span>
00740     <span class="comment">//</span>
00741 
00742     firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o3">ControllerType</a>   = <a class="code" href="../../d4/d9/arcinst_8h.html#a174a65">ControllerType</a>;
00743     firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o4">ControllerNumber</a> = ControllerNumber;
00744     firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o2">BusNumber</a> = <a class="code" href="../../d2/d7/hal_8h.html#a75">BusNumber</a>;
00745     firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o1">BusType</a>   = BusType;
00746 
00747     <span class="comment">//</span>
00748     <span class="comment">// Save the resource descriptor</span>
00749     <span class="comment">//</span>
00750 
00751     buffer = firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o9">ResourceDescriptor</a> = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool,
00752                                                                 dataLength);
00753 
00754     <span class="keywordflow">if</span> (!buffer) {
00755         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(firmwareEntry);
00756         <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;
00757     }
00758 
00759     <span class="comment">//</span>
00760     <span class="comment">// Save the configuration information on this controller.</span>
00761     <span class="comment">//</span>
00762 
00763     controllerData = (PCM_FULL_RESOURCE_DESCRIPTOR)
00764         ((PUCHAR)information + information-&gt;DataOffset);
00765     RtlMoveMemory(buffer, controllerData, dataLength);
00766     firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o8">ResourceDescriptorSize</a> = dataLength;
00767 
00768     <span class="comment">//</span>
00769     <span class="comment">// If there is a device identifier save it.</span>
00770     <span class="comment">//</span>
00771 
00772     <span class="keywordflow">if</span> (information = ControllerInformation[<a class="code" href="../../d0/d5/io_8h.html#a599a402">IoQueryDeviceIdentifier</a>]) {
00773         PWCHAR ptr;
00774 
00775         <span class="keywordflow">if</span> (dataLength = information-&gt;DataLength) {
00776 
00777             ptr = (PWCHAR) ((PUCHAR)information + information-&gt;DataOffset);
00778             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/arcinst_8h.html#a174a65">ControllerType</a> == <a class="code" href="../../d1/d9/arc_8h.html#a315a207">ParallelController</a>) {
00779                 PWCHAR tmpChar;
00780 
00781                 <span class="comment">//</span>
00782                 <span class="comment">// Some extra mapping is performed here to</span>
00783                 <span class="comment">// translate the firmware names to LPT names.</span>
00784                 <span class="comment">//</span>
00785 
00786                 *ptr++ = (WCHAR) <span class="charliteral">'L'</span>;
00787                 *ptr++ = (WCHAR) <span class="charliteral">'P'</span>;
00788                 *ptr++ = (WCHAR) <span class="charliteral">'T'</span>;
00789 
00790                 <span class="comment">//</span>
00791                 <span class="comment">// Find the number.</span>
00792                 <span class="comment">//</span>
00793 
00794                 tmpChar = ptr;
00795                 <span class="keywordflow">while</span> (*tmpChar) {
00796                     <span class="keywordflow">if</span> ((*tmpChar &gt;= (WCHAR) <span class="charliteral">'0'</span>) &amp;&amp;
00797                         (*tmpChar &lt;= (WCHAR) <span class="charliteral">'9'</span>)) {
00798                         <span class="keywordflow">break</span>;
00799                     }
00800                     tmpChar++;
00801                 }
00802 
00803                 <span class="keywordflow">if</span> (*tmpChar) {
00804                     <span class="keywordflow">while</span> (*tmpChar) {
00805                         *ptr++ = *tmpChar++;
00806                     }
00807                     *ptr = (WCHAR) 0;
00808 
00809                     <span class="comment">//</span>
00810                     <span class="comment">// Update the datalength to be 4 wchars and eos and</span>
00811                     <span class="comment">// restore the pointer.</span>
00812                     <span class="comment">//</span>
00813 
00814                     ptr = (PWCHAR) ((PUCHAR)information + information-&gt;DataOffset);
00815                     dataLength = 10;
00816                 } <span class="keywordflow">else</span> {
00817                     dataLength = 0;
00818                     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
00819                                 <span class="stringliteral">"Mapper: no parallel port number!\n"</span>));
00820                 }
00821             }
00822 
00823             <span class="keywordflow">if</span> (dataLength) {
00824                 firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a> = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool,
00825                                                            dataLength);
00826                 <span class="keywordflow">if</span> (firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>) {
00827 
00828                     <span class="comment">//</span>
00829                     <span class="comment">// Move the data</span>
00830                     <span class="comment">//</span>
00831 
00832                     firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o11">IdentifierType</a> = information-&gt;Type;
00833                     firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o10">IdentifierLength</a> = dataLength;
00834                     RtlMoveMemory(firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>, ptr, dataLength);
00835                 }
00836             }
00837         }
00838     }
00839 
00840     <span class="comment">//</span>
00841     <span class="comment">// For some controllers, search the peripheral information</span>
00842     <span class="comment">//</span>
00843 
00844     <span class="keywordflow">switch</span> (<a class="code" href="../../d4/d9/arcinst_8h.html#a174a65">ControllerType</a>) {
00845     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>:
00846     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a207">ParallelController</a>:
00847         <span class="comment">//</span>
00848         <span class="comment">// Don't look for a peripheral.</span>
00849         <span class="comment">//</span>
00850         peripheralType = (<a class="code" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>) 0;
00851         <span class="keywordflow">break</span>;
00852     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a200">DiskController</a>:
00853         peripheralType = <a class="code" href="../../d1/d9/arc_8h.html#a315a213">FloppyDiskPeripheral</a>;
00854         <span class="keywordflow">break</span>;
00855     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a209">KeyboardController</a>:
00856         peripheralType = <a class="code" href="../../d1/d9/arc_8h.html#a315a219">KeyboardPeripheral</a>;
00857         <span class="keywordflow">break</span>;
00858     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a208">PointerController</a>:
00859         peripheralType = <a class="code" href="../../d1/d9/arc_8h.html#a315a218">PointerPeripheral</a>;
00860         <span class="keywordflow">break</span>;
00861     <span class="keywordflow">default</span>:
00862         peripheralType = (<a class="code" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>) 0;
00863         <span class="keywordflow">break</span>;
00864     }
00865 
00866     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_REGISTRY,
00867                 <span class="stringliteral">"Mapper: registry location is\n %ws\n"</span>,
00868                 PathName-&gt;Buffer));
00869 
00870     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_INFORMATION,
00871                 <span class="stringliteral">"Mapper: ControllerInformation[] -\n\tIdent: %x -\n\tData: %x -\n\tInformation: %x\n"</span>,
00872                 ControllerInformation[0],
00873                 ControllerInformation[1],
00874                 ControllerInformation[2]));
00875 
00876     <span class="keywordflow">if</span> (peripheralType) {
00877         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00878                     <span class="stringliteral">"Mapper: searching for peripheral type %d\n"</span>,
00879                     peripheralType));
00880 
00881         <a class="code" href="../../d2/d3/io_2query_8c.html#a6">IoQueryDeviceDescription</a>(&amp;BusType,
00882                                  &amp;BusNumber,
00883                                  &amp;ControllerType,
00884                                  &amp;ControllerNumber,
00885                                  &amp;peripheralType,
00886                                  NULL,
00887                                  MapperPeripheralCallback,
00888                                  firmwareEntry);
00889     }
00890 
00891     <span class="comment">//</span>
00892     <span class="comment">// firmwareEntry-&gt;PnPId will be NULL if there are no peripherals of this</span>
00893     <span class="comment">// type in the tree or if the peripheral's description doesn't match one of</span>
00894     <span class="comment">// those in our table.</span>
00895     <span class="comment">//</span>
00896     <span class="comment">// firmwareEntry-&gt;PeripheralType will be equal to peripheralType if we found</span>
00897     <span class="comment">// one of the proper type regardless of whether or not it is in the table.</span>
00898     <span class="comment">//</span>
00899     <span class="comment">// So this test just ensures that we fallback to the controller IDs in the</span>
00900     <span class="comment">// case were there is no peripheral entry.  If there is a peripheral entry</span>
00901     <span class="comment">// that we don't understand we will suppress the entire node.</span>
00902     <span class="comment">//</span>
00903     <span class="comment">// This prevents creating devices with hw ids of bogus as we were seeing on</span>
00904     <span class="comment">// the SGI x86 ARC machines.</span>
00905     <span class="comment">//</span>
00906 
00907     <span class="keywordflow">if</span> (!firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o13">PnPId</a> &amp;&amp; firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o5">PeripheralType</a> == 0) {
00908 
00909         <span class="comment">//</span>
00910         <span class="comment">// Attempt to get PnPId from the controller type.</span>
00911         <span class="comment">//</span>
00912 
00913         firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o13">PnPId</a> = <a class="code" href="../../d2/d5/mapper_8c.html#a37">MapperTranslatePnPId</a>(ControllerType, NULL);
00914 
00915         <span class="keywordflow">if</span> (!firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o13">PnPId</a>) {
00916             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00917                         <span class="stringliteral">"Mapper: NO PnP Id for\n ==&gt; %ws\n"</span>,
00918                         PathName-&gt;Buffer));
00919         }
00920     }
00921 
00922     <span class="comment">// NEC98 needs DeviceId which differs with the other H/W.</span>
00923     <span class="keywordflow">if</span> (IsNEC_98){
00924 
00925         <span class="keywordflow">switch</span> (<a class="code" href="../../d4/d9/arcinst_8h.html#a174a65">ControllerType</a>) {
00926         <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>:{
00927             ULONG   i,j;
00928             PWSTR   serialFirmwareName;
00929             serialFirmwareName = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, <span class="keyword">sizeof</span>(USHORT)*10);
00930             <span class="keywordflow">if</span> (!serialFirmwareName) {
00931                 <span class="keywordflow">if</span> (buffer)
00932                     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(buffer);
00933                 <span class="keywordflow">if</span> (firmwareEntry) {
00934                     <span class="keywordflow">if</span> (firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>)
00935                         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>);
00936                     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(firmwareEntry);
00937                 }
00938                 <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;
00939             }
00940             <span class="keywordflow">for</span> (
00941                 i = 0;
00942                 i &lt; controllerData-&gt;PartialResourceList.Count;
00943                 i++
00944                 ) {
00945                 PCM_PARTIAL_RESOURCE_DESCRIPTOR partial =
00946                     &amp;controllerData-&gt;PartialResourceList.PartialDescriptors[i];
00947 
00948                 <span class="keywordflow">if</span> (partial-&gt;Type == CmResourceTypeDeviceSpecific) {
00949                     PCM_SERIAL_DEVICE_DATA sDeviceData;
00950 
00951                     sDeviceData = (PCM_SERIAL_DEVICE_DATA)(partial + 1);
00952 
00953                     swprintf(serialFirmwareName, L<span class="stringliteral">"*nEC%04X\0"</span>, sDeviceData-&gt;Revision);
00954                     j = 0;
00955                     <span class="keywordflow">while</span> (<a class="code" href="../../d2/d5/mapper_8c.html#a31">SerialIdNEC</a>[j]) {
00956                         <span class="keywordflow">if</span> (!wcscmp(serialFirmwareName, SerialIdNEC[j])) {
00957                             firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o13">PnPId</a> = <a class="code" href="../../d2/d5/mapper_8c.html#a31">SerialIdNEC</a>[j];
00958                         }
00959                         j++;
00960                     }
00961                 }
00962 
00963             }
00964             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(serialFirmwareName);
00965             <span class="keywordflow">break</span>;
00966         }
00967         <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a207">ParallelController</a>:
00968             firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o13">PnPId</a> = <a class="code" href="../../d2/d5/mapper_8c.html#a33">ParallelIdNEC</a>;
00969             <span class="keywordflow">break</span>;
00970         <span class="keywordflow">default</span>:
00971             <span class="keywordflow">break</span>;
00972         }
00973     }
00974 
00975     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00976                 <span class="stringliteral">"Mapper: constructed name %d_%d_%d_%d_%d_%d\n"</span>,
00977                 firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o1">BusType</a>,
00978                 firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o2">BusNumber</a>,
00979                 firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o3">ControllerType</a>,
00980                 firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o4">ControllerNumber</a>,
00981                 firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o5">PeripheralType</a>,
00982                 firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o6">PeripheralNumber</a>));
00983 
00984     <span class="keywordflow">if</span> (firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o13">PnPId</a>) {
00985 
00986         <span class="comment">//</span>
00987         <span class="comment">// Link into chain of entries.</span>
00988         <span class="comment">//</span>
00989 
00990         firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o0">Next</a> = deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o46">FirmwareList</a>;
00991         deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o46">FirmwareList</a> = firmwareEntry;
00992     } <span class="keywordflow">else</span> {
00993 
00994         <span class="comment">//</span>
00995         <span class="comment">// No map found - don't remember this entry.</span>
00996         <span class="comment">//</span>
00997 
00998         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(buffer);
00999         <span class="keywordflow">if</span>(firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>) {
01000             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>);
01001         }
01002         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(firmwareEntry);
01003     }
01004     <span class="keywordflow">return</span> STATUS_SUCCESS;
01005 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="mapper.c::MapperConstructRootEnumTree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MapperConstructRootEnumTree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CreatePhantomDevices</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l01600">1600</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d3/d4/mapper_8c-source.html#l00049">_FIRMWARE_CONFIGURATION::BusNumber</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00048">_FIRMWARE_CONFIGURATION::BusType</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00051">_FIRMWARE_CONFIGURATION::ControllerNumber</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00050">_FIRMWARE_CONFIGURATION::ControllerType</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a12">ENUM_KEY_BUFFER_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00073">_DEVICE_EXTENSION::FirmwareList</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00059">_FIRMWARE_CONFIGURATION::Identifier</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a13">INSTANCE_BUFFER_SIZE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00122">MapperDeviceExtension</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01549">MapperFreeList()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01091">MapperMarkKey()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00061">_FIRMWARE_CONFIGURATION::NewlyCreated</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00047">_FIRMWARE_CONFIGURATION::Next</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d7/fs__rec_8h.html#a14">PDEVICE_EXTENSION</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00053">_FIRMWARE_CONFIGURATION::PeripheralNumber</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00052">_FIRMWARE_CONFIGURATION::PeripheralType</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a16">PFIRMWARE_CONFIGURATION</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00060">_FIRMWARE_CONFIGURATION::PnPId</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00056">_FIRMWARE_CONFIGURATION::ResourceDescriptor</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01821">RtlAppendUnicodeToString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>.
<p>
<pre class="fragment"><div>01606                    :
01607 
01608     This routine walks through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list of firmware entries
01609     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d7/d1/genuedef_8c.html#a6">extension</a> and migrates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information into
01610     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root enumerator's tree in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.
01611 
01612 Arguments:
01613 
01614     CreatePhantomDevices - If non-zero, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device instances are created
01615         as <span class="stringliteral">"phantoms"</span> (i.e., they are marked with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="stringliteral">"Phantom"</span> value entry so
01616         that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root enumerator will ignore them).  The <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> time these device
01617         instance registry keys will ever turn into real live devnodes <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01618         <span class="keyword">class </span>installer (in response to DIF_FIRSTTIMESETUP or DIF_DETECT)
01619         decides that these devices aren'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> duplicates of any PnP-enumerated
01620         devnodes, and subsequently registers and installs them.
01621 
01622 Return Value:
01623 
01624     None
01625 
01626 --*/
01627 
01628 {
01629 <span class="preprocessor">#define ENUM_KEY_BUFFER_SIZE (1024 * sizeof(WCHAR))</span>
01630 <span class="preprocessor"></span><span class="preprocessor">#define INSTANCE_BUFFER_SIZE (256 * sizeof(WCHAR))</span>
01631 <span class="preprocessor"></span>    UNICODE_STRING          enumKey;
01632     <a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a> firmwareEntry;
01633     OBJECT_ATTRIBUTES       objectAttributes;
01634     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                status;
01635     BOOLEAN                 keyPresent;
01636     PWCHAR                  registryBase;
01637     PWCHAR                  instanceBuffer;
01638     HANDLE                  handle;
01639     ULONG                   disposition;
01640     PVOID                   buffer;
01641     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a>       DeviceExtension = &amp;<a class="code" href="../../d2/d5/mapper_8c.html#a25">MapperDeviceExtension</a>;
01642 
01643     <span class="comment">//</span>
01644     <span class="comment">// allocate space needed for the registry path into the root</span>
01645     <span class="comment">// enumerator tree.  Note, limited size on path length.</span>
01646     <span class="comment">//</span>
01647 
01648     buffer = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, ENUM_KEY_BUFFER_SIZE);
01649 
01650     <span class="keywordflow">if</span> (!buffer) {
01651         <a class="code" href="../../d9/d0/pnpiop_8h.html#a340">MapperFreeList</a>();
01652         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
01653                     <span class="stringliteral">"Mapper: could not allocate memory for registry update\n"</span>));
01654         <span class="keywordflow">return</span>;
01655     }
01656 
01657     instanceBuffer = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, INSTANCE_BUFFER_SIZE);
01658     <span class="keywordflow">if</span> (!instanceBuffer) {
01659         <a class="code" href="../../d9/d0/pnpiop_8h.html#a340">MapperFreeList</a>();
01660         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(buffer);
01661         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
01662                     <span class="stringliteral">"Mapper: could not allocate memory for instance buffer\n"</span>));
01663         <span class="keywordflow">return</span>;
01664     }
01665 
01666     InitializeObjectAttributes(&amp;objectAttributes,
01667                                &amp;enumKey,
01668                                OBJ_CASE_INSENSITIVE,
01669                                NULL,
01670                                NULL);
01671 
01672 <span class="preprocessor">#if UMODETEST</span>
01673 <span class="preprocessor"></span>    registryBase = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Registry\\Machine\\System\\TestControlSet\\Enum\\Root\\"</span>;
01674 <span class="preprocessor">#else</span>
01675 <span class="preprocessor"></span>    registryBase = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Enum\\Root\\"</span>;
01676 <span class="preprocessor">#endif</span>
01677 <span class="preprocessor"></span>
01678     firmwareEntry = DeviceExtension-&gt;FirmwareList;
01679     <span class="keywordflow">while</span> (firmwareEntry) {
01680 
01681         <span class="comment">//</span>
01682         <span class="comment">// Construct the base for the path for this entry.</span>
01683         <span class="comment">//</span>
01684 
01685 
01686         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;enumKey, NULL);
01687         enumKey.MaximumLength = <a class="code" href="../../d2/d5/mapper_8c.html#a12">ENUM_KEY_BUFFER_SIZE</a>;
01688         enumKey.Buffer = buffer;
01689         RtlZeroMemory(buffer, ENUM_KEY_BUFFER_SIZE);
01690         <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;enumKey, registryBase);
01691         <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;enumKey, firmwareEntry-&gt;PnPId);
01692 
01693         <span class="comment">//</span>
01694         <span class="comment">// Build the pnp Key.</span>
01695         <span class="comment">//</span>
01696 
01697         status = ZwCreateKey(&amp;handle,
01698                              KEY_READ | KEY_WRITE,
01699                              &amp;objectAttributes,
01700                              0,
01701                              NULL,
01702                              REG_OPTION_NON_VOLATILE,
01703                              &amp;disposition);
01704 
01705         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01706 
01707             <span class="comment">//</span>
01708             <span class="comment">// Do not need the handle, so close it</span>
01709             <span class="comment">// Remember if the key was present prior to call</span>
01710             <span class="comment">//</span>
01711 
01712             ZwClose(handle);
01713             keyPresent = (disposition == REG_OPENED_EXISTING_KEY) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01714             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_INFORMATION,
01715                         <span class="stringliteral">"Mapper: Key was %s\n"</span>,
01716                         keyPresent ? <span class="stringliteral">"Present"</span> : <span class="stringliteral">"Created"</span>));
01717 
01718             <span class="comment">//</span>
01719             <span class="comment">// Construct the instance name.</span>
01720             <span class="comment">//</span>
01721 
01722             RtlZeroMemory(instanceBuffer, INSTANCE_BUFFER_SIZE);
01723             swprintf(instanceBuffer,
01724                      L<span class="stringliteral">"\\%d_%d_%d_%d_%d_%d"</span>,
01725                      firmwareEntry-&gt;BusType,
01726                      firmwareEntry-&gt;BusNumber,
01727                      firmwareEntry-&gt;ControllerType,
01728                      firmwareEntry-&gt;ControllerNumber,
01729                      firmwareEntry-&gt;PeripheralType,
01730                      firmwareEntry-&gt;PeripheralNumber);
01731             <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;enumKey, instanceBuffer);
01732 
01733             status = ZwCreateKey(&amp;handle,
01734                                  KEY_READ | KEY_WRITE,
01735                                  &amp;objectAttributes,
01736                                  0,
01737                                  NULL,
01738                                  REG_OPTION_NON_VOLATILE,
01739                                  &amp;disposition);
01740 
01741             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01742 
01743                 <span class="keywordflow">if</span> (firmwareEntry-&gt;ResourceDescriptor) {
01744                     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_INFORMATION,
01745                                 <span class="stringliteral">"Mapper: firmware entry has resources %x\n"</span>,
01746                                 firmwareEntry-&gt;ResourceDescriptor));
01747                 }
01748 
01749                 <span class="keywordflow">if</span> (firmwareEntry-&gt;Identifier) {
01750                     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_INFORMATION,
01751                                 <span class="stringliteral">"Mapper: firmware entry has identifier %x\n"</span>,
01752                                 firmwareEntry-&gt;Identifier));
01753                 }
01754 
01755                 <span class="comment">//</span>
01756                 <span class="comment">// Only if this is a new entry do we see the key.</span>
01757                 <span class="comment">//</span>
01758 
01759                 <span class="keywordflow">if</span> (disposition == REG_CREATED_NEW_KEY) {
01760 
01761                     <span class="comment">//</span>
01762                     <span class="comment">// Remember the fact that the key was newly-created for the</span>
01763                     <span class="comment">// PnP BIOS case where we need to come along and "phantomize"</span>
01764                     <span class="comment">// all newly-created ntdetect COM ports.</span>
01765                     <span class="comment">//</span>
01766 
01767                     firmwareEntry-&gt;NewlyCreated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01768 
01769                     <span class="comment">//</span>
01770                     <span class="comment">// Create enough information to get pnp to</span>
01771                     <span class="comment">// install drivers</span>
01772                     <span class="comment">//</span>
01773 
01774                     <a class="code" href="../../d2/d5/mapper_8c.html#a41">MapperSeedKey</a>(handle,
01775                                   &amp;enumKey,
01776                                   firmwareEntry,
01777                                   CreatePhantomDevices
01778                                  );
01779                 }
01780                 <a class="code" href="../../d2/d5/mapper_8c.html#a40">MapperMarkKey</a>(handle,
01781                               &amp;enumKey,
01782                               firmwareEntry);
01783                 ZwClose(handle);
01784 
01785             } <span class="keywordflow">else</span> {
01786                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
01787                             <span class="stringliteral">"Mapper: create of instance key failed %x\n"</span>,
01788                             status));
01789             }
01790 
01791         } <span class="keywordflow">else</span> {
01792             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
01793                         <span class="stringliteral">"Mapper: create pnp key failed %x\n"</span>,
01794                         status));
01795         }
01796 
01797         firmwareEntry = firmwareEntry-&gt;Next;
01798     }
01799     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(instanceBuffer);
01800 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="mapper.c::MapperFindIdentMatch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">PFIRMWARE_IDENT_TO_PNP_ID</a> MapperFindIdentMatch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">PFIRMWARE_IDENT_TO_PNP_ID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IdentTable</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>String</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00367">367</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d3/d4/mapper_8c-source.html#l00080">_FIRMWARE_IDENT_TO_PNP_ID::FirmwareName</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a20">PFIRMWARE_IDENT_TO_PNP_ID</a>, and <a class="el" href="../../d5/d8/talloc_8c-source.html#l00027">String</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00402">MapperTranslatePnPId()</a>.
<p>
<pre class="fragment"><div>00374                    :
00375 
00376     Given a table of strings to match, find <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> match <span class="keywordflow">for</span>
00377     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> identifier given.
00378 
00379 Arguments:
00380 
00381 Return Value:
00382 
00383     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ident table entry <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> match <span class="keywordflow">if</span> found
00384     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <span class="keywordflow">if</span> not found.
00385 
00386 --*/
00387 
00388 {
00389     <a class="code" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">PFIRMWARE_IDENT_TO_PNP_ID</a> entry;
00390 
00391     entry = IdentTable;
00392     <span class="keywordflow">while</span> (entry-&gt;<a class="code" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html#o0">FirmwareName</a>) {
00393         <span class="keywordflow">if</span> (!wcscmp(String, entry-&gt;<a class="code" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html#o0">FirmwareName</a>)) {
00394             <span class="keywordflow">return</span> entry;
00395         }
00396         entry++;
00397     }
00398     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00399 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="mapper.c::MapperFreeList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MapperFreeList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l01549">1549</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00073">_DEVICE_EXTENSION::FirmwareList</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00059">_FIRMWARE_CONFIGURATION::Identifier</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00122">MapperDeviceExtension</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00047">_FIRMWARE_CONFIGURATION::Next</a>, <a class="el" href="../../d7/d7/fs__rec_8h.html#a14">PDEVICE_EXTENSION</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a16">PFIRMWARE_CONFIGURATION</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l00056">_FIRMWARE_CONFIGURATION::ResourceDescriptor</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l01600">MapperConstructRootEnumTree()</a>.
<p>
<pre class="fragment"><div>01555                    :
01556 
01557     This routine walks through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list of firmware entries
01558     and frees all allocated memory.
01559 
01560 Arguments:
01561 
01562     None
01563 
01564 Return Value:
01565 
01566     None
01567 
01568 --*/
01569 
01570 {
01571     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a>       deviceExtension = &amp;<a class="code" href="../../d2/d5/mapper_8c.html#a25">MapperDeviceExtension</a>;
01572     <a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a> tempEntry;
01573     <a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a> firmwareEntry;
01574 
01575     firmwareEntry = deviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o46">FirmwareList</a>;
01576     <span class="keywordflow">while</span> (firmwareEntry) {
01577 
01578         <span class="comment">//</span>
01579         <span class="comment">// free allocated structures associated with the firmware entry</span>
01580         <span class="comment">//</span>
01581 
01582         <span class="keywordflow">if</span> (firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o9">ResourceDescriptor</a>) {
01583             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o9">ResourceDescriptor</a>);
01584         }
01585         <span class="keywordflow">if</span> (firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>) {
01586             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>);
01587         }
01588 
01589         <span class="comment">//</span>
01590         <span class="comment">// free this entry and move to the next</span>
01591         <span class="comment">//</span>
01592 
01593         tempEntry = firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o0">Next</a>;
01594         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(firmwareEntry);
01595         firmwareEntry = tempEntry;
01596     }
01597 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="mapper.c::MapperMarkKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MapperMarkKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>PathName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FirmwareEntry</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l01091">1091</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d1/d1/pri__bld_2pnpsubs_8c-source.html#l04279">IopCmResourcesToIoResources()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01803">MapperAdjustResourceList()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01821">RtlAppendUnicodeToString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01600">MapperConstructRootEnumTree()</a>.
<p>
<pre class="fragment"><div>01099                    :
01100 
01101     Record in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root <span class="keyword">enum</span> key that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> firmware mapper found <span class="keyword">this</span> entry.
01102     Migrate configuration information entries.
01103 
01104 Arguments:
01105 
01106     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>   - handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key
01107     PathName - base <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> name to <span class="keyword">this</span> key
01108     FirmwareEntry - information from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> firmware tree.
01109 
01110 Return Value:
01111 
01112     None
01113 
01114 --*/
01115 
01116 {
01117     OBJECT_ATTRIBUTES objectAttributes;
01118     PCM_RESOURCE_LIST resourceList;
01119     UNICODE_STRING    unicodeName;
01120     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>          status;
01121     HANDLE            subKeyHandle;
01122     PWCHAR            wcptr;
01123     ULONG             disposition;
01124     ULONG             buffer;
01125     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>            originalLength;
01126 
01127     <span class="comment">//</span>
01128     <span class="comment">// Mark that this entry was in the firmware tree.</span>
01129     <span class="comment">//</span>
01130 
01131     buffer = 1;
01132     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;unicodeName, REGSTR_VAL_FIRMWAREIDENTIFIED);
01133 
01134     ZwSetValueKey(Handle,
01135                   &amp;unicodeName,
01136                   0,
01137                   REG_DWORD,
01138                   &amp;buffer,
01139                   <span class="keyword">sizeof</span>(ULONG));
01140 
01141     <span class="comment">//</span>
01142     <span class="comment">// Create the control subkey</span>
01143     <span class="comment">//</span>
01144 
01145     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_INFORMATION,
01146                 <span class="stringliteral">"Mapper: marking existing key\n"</span>));
01147     originalLength = PathName-&gt;Length;
01148     wcptr = (PWCHAR) ((PUCHAR)PathName-&gt;Buffer + PathName-&gt;Length);
01149     wcptr++; <span class="comment">// locate eos</span>
01150 
01151     <span class="comment">//</span>
01152     <span class="comment">// Build the volatile control key</span>
01153     <span class="comment">//</span>
01154 
01155     InitializeObjectAttributes(&amp;objectAttributes,
01156                                PathName,
01157                                OBJ_CASE_INSENSITIVE,
01158                                NULL,
01159                                NULL);
01160     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(PathName, L<span class="stringliteral">"\\Control"</span>);
01161     status = ZwCreateKey(&amp;subKeyHandle,
01162                          KEY_READ | KEY_WRITE,
01163                          &amp;objectAttributes,
01164                          0,
01165                          NULL,
01166                          REG_OPTION_VOLATILE,
01167                          &amp;disposition);
01168 
01169     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01170 
01171         <span class="comment">//</span>
01172         <span class="comment">// Create the found by firmware volatile.</span>
01173         <span class="comment">//</span>
01174 
01175         buffer = 1;
01176         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;unicodeName, REGSTR_VAL_FIRMWAREMEMBER);
01177 
01178         ZwSetValueKey(subKeyHandle,
01179                       &amp;unicodeName,
01180                       0,
01181                       REG_DWORD,
01182                       &amp;buffer,
01183                       <span class="keyword">sizeof</span>(ULONG));
01184         ZwClose(subKeyHandle);
01185 
01186     } <span class="keywordflow">else</span> {
01187 
01188         <span class="comment">//</span>
01189         <span class="comment">// ignore failures</span>
01190         <span class="comment">//</span>
01191 
01192         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
01193                     <span class="stringliteral">"Mapper: failed to mark control key %x\n"</span>,
01194                     status));
01195     }
01196 
01197     <span class="comment">//</span>
01198     <span class="comment">// if there is a resource descriptor, restore path and open LogConf key.</span>
01199     <span class="comment">//</span>
01200 
01201     <span class="keywordflow">if</span> (FirmwareEntry-&gt;ResourceDescriptor) {
01202         PathName-&gt;Length = originalLength;
01203         *wcptr = (WCHAR) 0;
01204 
01205         InitializeObjectAttributes(&amp;objectAttributes,
01206                                    PathName,
01207                                    OBJ_CASE_INSENSITIVE,
01208                                    NULL,
01209                                    NULL);
01210         <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(PathName, L<span class="stringliteral">"\\LogConf"</span>);
01211         status = ZwCreateKey(&amp;subKeyHandle,
01212                              KEY_READ | KEY_WRITE,
01213                              &amp;objectAttributes,
01214                              0,
01215                              NULL,
01216                              REG_OPTION_VOLATILE,
01217                              &amp;disposition);
01218 
01219         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01220             ULONG size;
01221 
01222             <span class="comment">//</span>
01223             <span class="comment">// two entries need to be made:</span>
01224             <span class="comment">// BootConfig:REG_RESOURCE_LIST</span>
01225             <span class="comment">// BasicConfigVector:REG_RESOURCE_REQUIREMENTS_LIST</span>
01226             <span class="comment">//</span>
01227 
01228             size = <span class="keyword">sizeof</span>(CM_RESOURCE_LIST) -
01229                    <span class="keyword">sizeof</span>(CM_FULL_RESOURCE_DESCRIPTOR) +
01230                    FirmwareEntry-&gt;ResourceDescriptorSize;
01231 
01232             resourceList = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, size);
01233 
01234             <span class="keywordflow">if</span> (resourceList) {
01235                 PIO_RESOURCE_REQUIREMENTS_LIST reqList;
01236 
01237                 resourceList-&gt;Count = 1;
01238                 RtlMoveMemory(&amp;resourceList-&gt;List[0],
01239                               FirmwareEntry-&gt;ResourceDescriptor,
01240                               FirmwareEntry-&gt;ResourceDescriptorSize);
01241 
01242                 resourceList = <a class="code" href="../../d2/d5/mapper_8c.html#a42">MapperAdjustResourceList</a> (
01243                                    resourceList,
01244                                    FirmwareEntry-&gt;PnPId,
01245                                    &amp;size
01246                                    );
01247 
01248                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;unicodeName,
01249                                      L<span class="stringliteral">"BootConfig"</span>);
01250                 ZwSetValueKey(subKeyHandle,
01251                               &amp;unicodeName,
01252                               0,
01253                               REG_RESOURCE_LIST,
01254                               resourceList,
01255                               size);
01256 <span class="preprocessor">#if 0</span>
01257 <span class="preprocessor"></span>                <span class="comment">//</span>
01258                 <span class="comment">// Now do the resource requirements list.</span>
01259                 <span class="comment">//</span>
01260 
01261                 reqList = <a class="code" href="../../d0/d2/pri__bld_2pnpsubs_8c.html#a28">IopCmResourcesToIoResources</a>(0, resourceList);
01262 
01263                 <span class="keywordflow">if</span> (reqList) {
01264                     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;unicodeName,
01265                                          L<span class="stringliteral">"BasicConfigVector"</span>);
01266                     ZwSetValueKey(subKeyHandle,
01267                                   &amp;unicodeName,
01268                                   0,
01269                                   REG_RESOURCE_REQUIREMENTS_LIST,
01270                                   reqList,
01271                                   reqList-&gt;ListSize);
01272                     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(reqList);
01273                 }
01274 <span class="preprocessor">#endif</span>
01275 <span class="preprocessor"></span>                <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(resourceList);
01276             }
01277         } <span class="keywordflow">else</span> {
01278 
01279             <span class="comment">//</span>
01280             <span class="comment">// ignore errors</span>
01281             <span class="comment">//</span>
01282 
01283             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
01284                         <span class="stringliteral">"Mapper: failed to update logconf key %x\n"</span>,
01285                         status));
01286         }
01287     }
01288 
01289     <span class="comment">//</span>
01290     <span class="comment">// Restore path passed in.</span>
01291     <span class="comment">//</span>
01292 
01293     PathName-&gt;Length = originalLength;
01294     *wcptr = (WCHAR) 0;
01295 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="mapper.c::MapperPeripheralCallback" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS MapperPeripheralCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>PathName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN INTERFACE_TYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>BusType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BusNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEY_VALUE_FULL_INFORMATION *&nbsp;</td>
          <td class="mdname" nowrap> <em>BusInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ControllerType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ControllerNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEY_VALUE_FULL_INFORMATION *&nbsp;</td>
          <td class="mdname" nowrap> <em>ControllerInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PeripheralType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PeripheralNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEY_VALUE_FULL_INFORMATION *&nbsp;</td>
          <td class="mdname" nowrap> <em>PeripheralInformation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00535">535</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00059">_FIRMWARE_CONFIGURATION::Identifier</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00057">_FIRMWARE_CONFIGURATION::IdentifierLength</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00058">_FIRMWARE_CONFIGURATION::IdentifierType</a>, <a class="el" href="../../d0/d5/io_8h.html#a599a402">IoQueryDeviceIdentifier</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00402">MapperTranslatePnPId()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00053">_FIRMWARE_CONFIGURATION::PeripheralNumber</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00052">_FIRMWARE_CONFIGURATION::PeripheralType</a>, <a class="el" href="../../d4/d9/arcinst_8h.html#a174a66">PeripheralType</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a16">PFIRMWARE_CONFIGURATION</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l00060">_FIRMWARE_CONFIGURATION::PnPId</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00658">MapperCallback()</a>.
<p>
<pre class="fragment"><div>00551                    :
00552 
00553     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to acquire firmware tree information about
00554     pointer devices in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
00555 
00556 Arguments:
00557 
00558     Context               - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d7/d1/genuedef_8c.html#a6">extension</a>.
00559     PathName              - unicode registry <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>.
00560     BusType               - Internal, Isa, ...
00561     <a class="code" href="../../d2/d7/hal_8h.html#a75">BusNumber</a>             - Which bus <span class="keywordflow">if</span> we are on a multibus system.
00562     BusInformation        - Configuration information about <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bus. Not Used.
00563     <a class="code" href="../../d4/d9/arcinst_8h.html#a174a65">ControllerType</a>        - serial or ata disk.
00564     ControllerNumber      - Which controller <span class="keywordflow">if</span> there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> more than one
00565                             controller in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
00566     ControllerInformation - Array of pointers to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> three pieces of
00567                             registry information.
00568     <a class="code" href="../../d4/d9/arcinst_8h.html#a174a66">PeripheralType</a>        - Undefined <span class="keywordflow">for</span> <span class="keyword">this</span> call.
00569     PeripheralNumber      - Undefined <span class="keywordflow">for</span> <span class="keyword">this</span> call.
00570     PeripheralInformation - Undefined <span class="keywordflow">for</span> <span class="keyword">this</span> call.
00571 
00572 Return Value:
00573 
00574     STATUS_SUCCESS <span class="keywordflow">if</span> everything went ok, or STATUS_INSUFFICIENT_RESOURCES
00575     <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> couldn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> map <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base csr or acquire <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device object, or
00576     all of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resource information couldn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> be acquired.
00577 
00578 --*/
00579 
00580 {
00581     <a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a>     firmwareEntry = Context;
00582     PKEY_VALUE_FULL_INFORMATION information;
00583     ULONG                       dataLength;
00584     PWCHAR                      ptr;
00585     PVOID                       temp;
00586 
00587     <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_REGISTRY,
00588                 <span class="stringliteral">"Mapper: peripheral registry location is\n %ws\n"</span>,
00589                 PathName-&gt;Buffer));
00590 
00591     <span class="keywordflow">if</span> (!ControllerInformation) {
00592         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_VERBOSE,
00593                     <span class="stringliteral">"Mapper: No component information\n"</span>));
00594     }
00595     <span class="keywordflow">if</span> (!PeripheralInformation) {
00596         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_VERBOSE,
00597                     <span class="stringliteral">"Mapper: No peripheral information\n"</span>));
00598         <span class="keywordflow">return</span> STATUS_SUCCESS;
00599     }
00600 
00601     <span class="comment">//</span>
00602     <span class="comment">// Map the PnP Id for this device.</span>
00603     <span class="comment">//</span>
00604 
00605     <span class="keywordflow">if</span> (PeripheralInformation[<a class="code" href="../../d0/d5/io_8h.html#a599a402">IoQueryDeviceIdentifier</a>]) {
00606         information = PeripheralInformation[<a class="code" href="../../d0/d5/io_8h.html#a599a402">IoQueryDeviceIdentifier</a>];
00607         firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o13">PnPId</a> = <a class="code" href="../../d2/d5/mapper_8c.html#a37">MapperTranslatePnPId</a>(PeripheralType, information);
00608 
00609         <span class="keywordflow">if</span> (firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o13">PnPId</a>) {
00610             <span class="comment">//</span>
00611             <span class="comment">// Remember the peripheral's identifier (if it has one, and it's a REG_SZ value)</span>
00612             <span class="comment">// for use as the default PnP device description.</span>
00613             <span class="comment">//</span>
00614 
00615             <span class="keywordflow">if</span> (((dataLength = information-&gt;DataLength) &gt; <span class="keyword">sizeof</span>(WCHAR)) &amp;&amp;
00616                 (information-&gt;Type == REG_SZ)) {
00617 
00618                 ptr = (PWCHAR) ((PUCHAR)information + information-&gt;DataOffset);
00619 
00620                 <span class="keywordflow">if</span> (*ptr) {
00621                     temp = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, dataLength);
00622                     <span class="keywordflow">if</span> (temp) {
00623 
00624                         <span class="comment">//</span>
00625                         <span class="comment">// If there's already an identifier here (from the peripheral's</span>
00626                         <span class="comment">// controller) then wipe it out.</span>
00627                         <span class="comment">//</span>
00628 
00629                         <span class="keywordflow">if</span>(firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>) {
00630                             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>);
00631                         }
00632 
00633                         <span class="comment">//</span>
00634                         <span class="comment">// Move the data</span>
00635                         <span class="comment">//</span>
00636 
00637                         firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a> = temp;
00638                         firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o11">IdentifierType</a> = information-&gt;Type;
00639                         firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o10">IdentifierLength</a> = dataLength;
00640                         RtlMoveMemory(firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o12">Identifier</a>, ptr, dataLength);
00641                     }
00642                 }
00643             }
00644         }
00645     }
00646 
00647     <span class="comment">//</span>
00648     <span class="comment">// Save the ordinals for the peripheral type and number</span>
00649     <span class="comment">//</span>
00650 
00651     firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o5">PeripheralType</a> = <a class="code" href="../../d4/d9/arcinst_8h.html#a174a66">PeripheralType</a>;
00652     firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o6">PeripheralNumber</a> = PeripheralNumber;
00653 
00654     <span class="keywordflow">return</span> STATUS_SUCCESS;
00655 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="mapper.c::MapperPhantomizeDetectedComPorts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MapperPhantomizeDetectedComPorts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l02060">2060</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d3/d4/mapper_8c-source.html#l00049">_FIRMWARE_CONFIGURATION::BusNumber</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00048">_FIRMWARE_CONFIGURATION::BusType</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00051">_FIRMWARE_CONFIGURATION::ControllerNumber</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00050">_FIRMWARE_CONFIGURATION::ControllerType</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a12">ENUM_KEY_BUFFER_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00073">_DEVICE_EXTENSION::FirmwareList</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a13">INSTANCE_BUFFER_SIZE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00122">MapperDeviceExtension</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00061">_FIRMWARE_CONFIGURATION::NewlyCreated</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00047">_FIRMWARE_CONFIGURATION::Next</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d7/fs__rec_8h.html#a14">PDEVICE_EXTENSION</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00053">_FIRMWARE_CONFIGURATION::PeripheralNumber</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00052">_FIRMWARE_CONFIGURATION::PeripheralType</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a16">PFIRMWARE_CONFIGURATION</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00060">_FIRMWARE_CONFIGURATION::PnPId</a>, <a class="el" href="../../d3/d4/i386_2kdcpuapi_8c-source.html#l00297">regValue()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01821">RtlAppendUnicodeToString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>.
<p>
<pre class="fragment"><div>02065                    :
02066 
02067     This routine turns all newly-created firmware/ntdetect COM ports into
02068     phantoms.
02069 
02070 Arguments:
02071 
02072     None
02073 
02074 Return Value:
02075 
02076     None
02077 
02078 --*/
02079 {
02080     <a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a> firmwareEntry;
02081     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                status;
02082     PWCHAR                  registryBase;
02083     PWCHAR                  instanceBuffer;
02084     HANDLE                  handle;
02085     PWCHAR                  buffer;
02086     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a>       DeviceExtension = &amp;<a class="code" href="../../d2/d5/mapper_8c.html#a25">MapperDeviceExtension</a>;
02087     UNICODE_STRING          enumKey;
02088     OBJECT_ATTRIBUTES       objectAttributes;
02089     UNICODE_STRING          unicodeName;
02090     ULONG                   <a class="code" href="../../d2/d5/i386_2kdcpuapi_8c.html#a6">regValue</a>;
02091 
02092     <span class="comment">//</span>
02093     <span class="comment">// allocate space needed for the registry path into the root</span>
02094     <span class="comment">// enumerator tree.  Note, limited size on path length.</span>
02095     <span class="comment">//</span>
02096 
02097     buffer = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, ENUM_KEY_BUFFER_SIZE);
02098 
02099     <span class="keywordflow">if</span> (!buffer) {
02100         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
02101                     <span class="stringliteral">"Mapper: could not allocate memory for registry update\n"</span>));
02102         <span class="keywordflow">return</span>;
02103     }
02104 
02105     instanceBuffer = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, INSTANCE_BUFFER_SIZE);
02106     <span class="keywordflow">if</span> (!instanceBuffer) {
02107         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(buffer);
02108         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
02109                     <span class="stringliteral">"Mapper: could not allocate memory for instance buffer\n"</span>));
02110         <span class="keywordflow">return</span>;
02111     }
02112 
02113     InitializeObjectAttributes(&amp;objectAttributes,
02114                                &amp;enumKey,
02115                                OBJ_CASE_INSENSITIVE,
02116                                NULL,
02117                                NULL);
02118 
02119 <span class="preprocessor">#if UMODETEST</span>
02120 <span class="preprocessor"></span>    registryBase = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Registry\\Machine\\System\\TestControlSet\\Enum\\Root\\"</span>;
02121 <span class="preprocessor">#else</span>
02122 <span class="preprocessor"></span>    registryBase = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Enum\\Root\\"</span>;
02123 <span class="preprocessor">#endif</span>
02124 <span class="preprocessor"></span>
02125     firmwareEntry = DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o46">FirmwareList</a>;
02126     <span class="keywordflow">while</span> (firmwareEntry) {
02127 
02128         <span class="comment">//</span>
02129         <span class="comment">// Construct the base for the path for this entry.</span>
02130         <span class="comment">//</span>
02131 
02132 
02133         <span class="keywordflow">if</span> ((firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o3">ControllerType</a> == <a class="code" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>) &amp;&amp;
02134             firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o14">NewlyCreated</a>) {
02135 
02136             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;enumKey, NULL);
02137             enumKey.MaximumLength = <a class="code" href="../../d2/d5/mapper_8c.html#a12">ENUM_KEY_BUFFER_SIZE</a>;
02138             enumKey.Buffer = buffer;
02139             RtlZeroMemory(buffer, ENUM_KEY_BUFFER_SIZE);
02140             <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;enumKey, registryBase);
02141             <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;enumKey, firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o13">PnPId</a>);
02142 
02143             <span class="comment">//</span>
02144             <span class="comment">// Construct the instance name.</span>
02145             <span class="comment">//</span>
02146 
02147             RtlZeroMemory(instanceBuffer, INSTANCE_BUFFER_SIZE);
02148             swprintf(instanceBuffer,
02149                      L<span class="stringliteral">"\\%d_%d_%d_%d_%d_%d"</span>,
02150                      firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o1">BusType</a>,
02151                      firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o2">BusNumber</a>,
02152                      firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o3">ControllerType</a>,
02153                      firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o4">ControllerNumber</a>,
02154                      firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o5">PeripheralType</a>,
02155                      firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o6">PeripheralNumber</a>);
02156             <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(&amp;enumKey, instanceBuffer);
02157 
02158             status = ZwOpenKey(&amp;handle,
02159                                KEY_READ | KEY_WRITE,
02160                                &amp;objectAttributes
02161                               );
02162 
02163             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02164 
02165                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;unicodeName, REGSTR_VAL_PHANTOM);
02166                 <a class="code" href="../../d2/d5/i386_2kdcpuapi_8c.html#a6">regValue</a> = 1;
02167                 ZwSetValueKey(handle,
02168                               &amp;unicodeName,
02169                               0,
02170                               REG_DWORD,
02171                               &amp;regValue,
02172                               <span class="keyword">sizeof</span>(regValue)
02173                              );
02174 
02175                 ZwClose(handle);
02176             }
02177         }
02178 
02179         firmwareEntry = firmwareEntry-&gt;<a class="code" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html#o0">Next</a>;
02180     }
02181 
02182     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (buffer);
02183     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a> (instanceBuffer);
02184 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="mapper.c::MapperProcessFirmwareTree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MapperProcessFirmwareTree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>OnlyProcessSerialPorts</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l01009">1009</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a10">CONTROLLER_TYPES_COUNT</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a200">DiskController</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a213">FloppyDiskPeripheral</a>, <a class="el" href="../../d3/d2/io_2query_8c-source.html#l00070">IoQueryDeviceDescription()</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a209">KeyboardController</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00658">MapperCallback()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00122">MapperDeviceExtension</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a207">ParallelController</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a208">PointerController</a>, and <a class="el" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>.
<p>
<pre class="fragment"><div>01015                    :
01016 
01017     Query <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> firmware tree to know what
01018     system board devices were located.  This will cause a FirmwareList
01019     to be created on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device extention passed.
01020 
01021 Arguments:
01022 
01023     OnlyProcessSerialPorts - <span class="keywordflow">if</span> non-zero, then we'll <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> look at serial ports.
01024         This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done on ACPI machines where, in general, we don'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> want to pay
01025         attention to ntdetect/firmware information (but we have to <span class="keywordflow">for</span> serial
01026         ports so that legacy add-in ISA serial ports and modems are detected
01027         automatically as in previous versions of NT as well as Win9x).
01028 
01029 Return Value:
01030 
01031     None
01032 
01033 --*/
01034 
01035 {
01036     INTERFACE_TYPE     interfaceType;
01037     ULONG              index;
01038     <a class="code" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> sc;
01039     <a class="code" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> controllerTypes[] = { <a class="code" href="../../d1/d9/arc_8h.html#a315a208">PointerController</a>,
01040                                              <a class="code" href="../../d1/d9/arc_8h.html#a315a209">KeyboardController</a>,
01041                                              <a class="code" href="../../d1/d9/arc_8h.html#a315a207">ParallelController</a>,
01042                                              <a class="code" href="../../d1/d9/arc_8h.html#a315a200">DiskController</a>,
01043                                              <a class="code" href="../../d1/d9/arc_8h.html#a315a213">FloppyDiskPeripheral</a>,
01044                                              <a class="code" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>   <span class="comment">// must be last</span>
01045                                            };
01046 <span class="preprocessor">#define CONTROLLER_TYPES_COUNT (sizeof(controllerTypes) / sizeof(controllerTypes[0]))</span>
01047 <span class="preprocessor"></span>
01048     <span class="comment">//</span>
01049     <span class="comment">// Locate all firmware controller information and save its resource usage.</span>
01050     <span class="comment">//</span>
01051     <span class="comment">// BUGBUG (lonnym)--it's pretty inefficient to be going through all</span>
01052     <span class="comment">// interface types, when we really only care about a very small subset of</span>
01053     <span class="comment">// non-PnP buses (e.g., ISA, EISA, maybe Internal).</span>
01054     <span class="comment">//</span>
01055 
01056     <span class="keywordflow">for</span> (interfaceType = 0; interfaceType &lt; MaximumInterfaceType; interfaceType++) {
01057 
01058         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_VERBOSE,
01059                     <span class="stringliteral">"Mapper: searching on interface ===&gt; %d\n"</span>,
01060                     interfaceType));
01061 
01062         <span class="keywordflow">if</span>(OnlyProcessSerialPorts) {
01063 
01064             <span class="comment">//</span>
01065             <span class="comment">// Start out at the last element of the array, so we only process</span>
01066             <span class="comment">// SerialControllers.</span>
01067             <span class="comment">//</span>
01068 
01069             index = <a class="code" href="../../d2/d5/mapper_8c.html#a10">CONTROLLER_TYPES_COUNT</a> - 1;
01070         } <span class="keywordflow">else</span> {
01071             index = 0;
01072         }
01073 
01074         <span class="keywordflow">for</span> ( ; index &lt; <a class="code" href="../../d2/d5/mapper_8c.html#a10">CONTROLLER_TYPES_COUNT</a>; index++) {
01075             sc = controllerTypes[index];
01076 
01077             <a class="code" href="../../d2/d3/io_2query_8c.html#a6">IoQueryDeviceDescription</a>(&amp;interfaceType,
01078                                      NULL,
01079                                      &amp;sc,
01080                                      NULL,
01081                                      NULL,
01082                                      NULL,
01083                                      MapperCallback,
01084                                      &amp;MapperDeviceExtension);
01085         }
01086     }
01087 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="mapper.c::MapperSeedKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MapperSeedKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>PathName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d6/d2/struct__FIRMWARE__CONFIGURATION.html">PFIRMWARE_CONFIGURATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FirmwareEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceIsPhantom</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">1298</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00109">_KEY_SEED::Attribute</a>, <a class="el" href="../../d2/d1/pnpmap_8c.html#a51">ComPortDBAdd()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00096">_MAPPER_SEED::DwordValueContent</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08501">IopOpenDeviceParametersSubkey()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00106">KEY_SEED_DEVICE_PARAMETERS</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a219">KeyboardPeripheral</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00108">_KEY_SEED::KeyName</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00194">MapperKeySeed</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00176">MapperValueSeed</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00097">_MAPPER_SEED::Options</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00110">_KEY_SEED::Options</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00091">OPTIONS_INSERT_COMPATIBLE_IDS</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00090">OPTIONS_INSERT_DEVICEDESC</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00092">OPTIONS_INSERT_PHANTOM_MARKER</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00089">OPTIONS_INSERT_PNP_ID</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a207">ParallelController</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a24">PKEY_SEED</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a22">PMAPPER_SEED</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a218">PointerPeripheral</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00148">PS2_KEYBOARD_COMPATIBLE_ID</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00149">PS2_MOUSE_COMPATIBLE_ID</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01821">RtlAppendUnicodeToString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a11">SEED_BUFFER_SIZE</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00094">_MAPPER_SEED::ValueName</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l00095">_MAPPER_SEED::ValueType</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01600">MapperConstructRootEnumTree()</a>.
<p>
<pre class="fragment"><div>01307                    :
01308 
01309     This routine seeds a registry key with enough information
01310     to get PnP to run <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">class </span>installer on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> devnode.
01311 
01312 Arguments:
01313 
01314     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>          - handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key
01315 
01316     PathName        - base <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> name to this key
01317 
01318     FirmwareEntry   - information from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> firmware tree
01319 
01320     DeviceIsPhantom - if non-zero, add "Phantom" value entry so <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root
01321         enumerator will skip this device instance (i.e., not turn it into a
01322         devnode)
01323 
01324 Return Value:
01325 
01326     None
01327 
01328 --*/
01329 
01330 {
01331 <span class="preprocessor">#define SEED_BUFFER_SIZE (512 * sizeof(WCHAR))</span>
01332 <span class="preprocessor"></span>    UNICODE_STRING    unicodeName;
01333     UNICODE_STRING    unicodeValue;
01334     OBJECT_ATTRIBUTES objectAttributes;
01335     <a class="code" href="../../d7/d6/struct__MAPPER__SEED.html">PMAPPER_SEED</a>      valueSeed;
01336     <a class="code" href="../../d6/d6/struct__KEY__SEED.html">PKEY_SEED</a>         keySeed;
01337     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>          status;
01338     HANDLE            subKeyHandle;
01339     PWCHAR            pnpid;
01340     PWCHAR            buffer;
01341     PWCHAR            wcptr;
01342     ULONG             disposition;
01343     ULONG             size;
01344     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>            originalLength;
01345 
01346     buffer = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, SEED_BUFFER_SIZE);
01347     <span class="keywordflow">if</span> (!buffer) {
01348         <span class="keywordflow">return</span>;
01349     }
01350     RtlZeroMemory(buffer, SEED_BUFFER_SIZE);
01351 
01352     <span class="comment">//</span>
01353     <span class="comment">// Create subkeys.</span>
01354     <span class="comment">//</span>
01355 
01356     originalLength = PathName-&gt;Length;
01357     wcptr = (PWCHAR) ((PUCHAR)PathName-&gt;Buffer + PathName-&gt;Length);
01358 
01359     <span class="keywordflow">for</span> (keySeed = <a class="code" href="../../d2/d5/mapper_8c.html#a29">MapperKeySeed</a>; keySeed-&gt;<a class="code" href="../../d6/d6/struct__KEY__SEED.html#o0">KeyName</a>; keySeed++) {
01360 
01361         <span class="comment">//</span>
01362         <span class="comment">// Reset the base path for the next key to seed.</span>
01363         <span class="comment">//</span>
01364 
01365         *wcptr = (WCHAR) 0;
01366         PathName-&gt;Length = originalLength;
01367         <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>(PathName, keySeed-&gt;KeyName);
01368 
01369         <span class="comment">//</span>
01370         <span class="comment">// Only build a device parameters key if there is something</span>
01371         <span class="comment">// to put in the key (i.e., this is a serial or parallel port).</span>
01372         <span class="comment">//</span>
01373 
01374         <span class="keywordflow">if</span> (keySeed-&gt;Options &amp; <a class="code" href="../../d2/d5/mapper_8c.html#a6">KEY_SEED_DEVICE_PARAMETERS</a>) {
01375             <span class="keywordflow">if</span> (((FirmwareEntry-&gt;ControllerType != <a class="code" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>) &amp;&amp; (FirmwareEntry-&gt;ControllerType != <a class="code" href="../../d1/d9/arc_8h.html#a315a207">ParallelController</a>)) ||
01376                 !FirmwareEntry-&gt;Identifier) {
01377                 <span class="keywordflow">continue</span>;
01378             }
01379 
01380             status = <a class="code" href="../../d9/d0/pnpiop_8h.html#a304">IopOpenDeviceParametersSubkey</a>( &amp;subKeyHandle,
01381                                                     NULL,
01382                                                     PathName,
01383                                                     KEY_READ | KEY_WRITE
01384                                                     );
01385             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01386                 status = STATUS_SUCCESS;
01387             } <span class="keywordflow">else</span> {
01388                 status = STATUS_UNSUCCESSFUL;
01389             }
01390         } <span class="keywordflow">else</span> {
01391 
01392             <span class="comment">//</span>
01393             <span class="comment">// need to construct this key.</span>
01394             <span class="comment">//</span>
01395 
01396             InitializeObjectAttributes(&amp;objectAttributes,
01397                                        PathName,
01398                                        OBJ_CASE_INSENSITIVE,
01399                                        NULL,
01400                                        NULL);
01401             status = ZwCreateKey(&amp;subKeyHandle,
01402                                  KEY_READ | KEY_WRITE,
01403                                  &amp;objectAttributes,
01404                                  0,
01405                                  NULL,
01406                                  keySeed-&gt;Attribute,
01407                                  &amp;disposition);
01408         }
01409 
01410         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01411 
01412             <span class="comment">//</span>
01413             <span class="comment">// Check to see if this is the parameters key and</span>
01414             <span class="comment">// migrate the parameter information.</span>
01415             <span class="comment">//</span>
01416 
01417             <span class="keywordflow">if</span> (keySeed-&gt;Options &amp; <a class="code" href="../../d2/d5/mapper_8c.html#a6">KEY_SEED_DEVICE_PARAMETERS</a>) {
01418 
01419                 <span class="keywordflow">if</span> (FirmwareEntry-&gt;ControllerType == <a class="code" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>)  {
01420 
01421                     <a class="code" href="../../d2/d1/pnpmap_8c.html#a51">ComPortDBAdd</a>(subKeyHandle, (PWSTR)FirmwareEntry-&gt;Identifier);
01422                 } <span class="keywordflow">else</span> {
01423                     <span class="comment">//</span>
01424                     <span class="comment">// to get here there must be identifier information</span>
01425                     <span class="comment">// in the FirmwareEntry, so that check is not performed.</span>
01426                     <span class="comment">//</span>
01427                     <span class="comment">// NOTE: this will only happen once - when the key is</span>
01428                     <span class="comment">// created -- perhaps this needs to happen on every</span>
01429                     <span class="comment">// boot.</span>
01430                     <span class="comment">//</span>
01431 
01432                     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;unicodeName,
01433                                         L<span class="stringliteral">"PortName"</span>);
01434                     ZwSetValueKey(subKeyHandle,
01435                                 &amp;unicodeName,
01436                                 0,
01437                                 FirmwareEntry-&gt;IdentifierType,
01438                                 FirmwareEntry-&gt;Identifier,
01439                                 FirmwareEntry-&gt;IdentifierLength);
01440                 }
01441             }
01442             ZwClose(subKeyHandle);
01443         } <span class="keywordflow">else</span> {
01444 
01445             <span class="comment">//</span>
01446             <span class="comment">// ignore failures</span>
01447             <span class="comment">//</span>
01448 
01449             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
01450                         <span class="stringliteral">"Mapper: failed to build control key %x\n"</span>,
01451                         status));
01452         }
01453     }
01454 
01455     <span class="comment">//</span>
01456     <span class="comment">// Undo the mangling of the path name performed in the loop above.</span>
01457     <span class="comment">//</span>
01458 
01459     *wcptr = (WCHAR) 0;
01460     PathName-&gt;Length = originalLength;
01461 
01462     <span class="comment">//</span>
01463     <span class="comment">// Create values.</span>
01464     <span class="comment">//</span>
01465 
01466     pnpid = FirmwareEntry-&gt;PnPId;
01467     <span class="keywordflow">for</span> (valueSeed = <a class="code" href="../../d2/d5/mapper_8c.html#a28">MapperValueSeed</a>; valueSeed-&gt;<a class="code" href="../../d7/d6/struct__MAPPER__SEED.html#o0">ValueName</a>; valueSeed++) {
01468 
01469         <span class="keywordflow">if</span> (valueSeed-&gt;ValueType == REG_DWORD) {
01470 
01471             <span class="keywordflow">if</span> ((valueSeed-&gt;Options == <a class="code" href="../../d2/d5/mapper_8c.html#a4">OPTIONS_INSERT_PHANTOM_MARKER</a>) &amp;&amp;
01472                 !DeviceIsPhantom) {
01473 
01474                 <span class="comment">//</span>
01475                 <span class="comment">// Device isn't a phantom--we don't want to mark it as such.</span>
01476                 <span class="comment">//</span>
01477 
01478                 <span class="keywordflow">continue</span>;
01479             }
01480 
01481             size = <span class="keyword">sizeof</span>(ULONG);
01482             RtlMoveMemory(buffer, &amp;valueSeed-&gt;DwordValueContent, size);
01483 
01484         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (valueSeed-&gt;Options == <a class="code" href="../../d2/d5/mapper_8c.html#a1">OPTIONS_INSERT_PNP_ID</a>) {
01485 
01486             size = (wcslen(pnpid) + 2) * <span class="keyword">sizeof</span>(WCHAR); <span class="comment">// eos multi_sz</span>
01487             <span class="keywordflow">if</span> (FirmwareEntry-&gt;BusType == Eisa) {
01488 
01489                 <span class="comment">//</span>
01490                 <span class="comment">// need a mult_sz of EISA\PNPblah *PNPblah</span>
01491                 <span class="comment">//</span>
01492 
01493                 RtlZeroMemory(buffer, SEED_BUFFER_SIZE);
01494                 wcptr = pnpid;
01495                 wcptr++;
01496                 swprintf(buffer, L<span class="stringliteral">"EISA\\%s"</span>, wcptr);
01497 
01498                 wcptr = buffer;
01499                 <span class="keywordflow">while</span> (*wcptr) {
01500                     wcptr++;
01501                 }
01502                 wcptr++; <span class="comment">// step past eos for 1st string</span>
01503 
01504                 RtlMoveMemory(wcptr, pnpid, size);
01505 
01506                 size += (ULONG)((PUCHAR)wcptr - (PUCHAR)buffer);
01507             } <span class="keywordflow">else</span> {
01508                 RtlMoveMemory(buffer, pnpid, size - <span class="keyword">sizeof</span>(WCHAR));
01509                 buffer[size / <span class="keyword">sizeof</span>(WCHAR) - 1] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01510             }
01511         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (valueSeed-&gt;Options == <a class="code" href="../../d2/d5/mapper_8c.html#a3">OPTIONS_INSERT_COMPATIBLE_IDS</a>) {
01512             <span class="keywordflow">if</span> (FirmwareEntry-&gt;PeripheralType == <a class="code" href="../../d1/d9/arc_8h.html#a315a219">KeyboardPeripheral</a>)  {
01513                 size = <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d5/mapper_8c.html#a7">PS2_KEYBOARD_COMPATIBLE_ID</a>);
01514                 RtlMoveMemory(buffer, PS2_KEYBOARD_COMPATIBLE_ID, size);
01515             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (FirmwareEntry-&gt;PeripheralType == <a class="code" href="../../d1/d9/arc_8h.html#a315a218">PointerPeripheral</a> &amp;&amp;
01516                        (wcscmp(pnpid, L<span class="stringliteral">"*PNP0F0E"</span>) == 0 ||
01517                         wcscmp(pnpid, L<span class="stringliteral">"*PNP0F03"</span>) == 0 ||
01518                         wcscmp(pnpid, L<span class="stringliteral">"*PNP0F12"</span>) == 0)) {
01519                 size = <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d5/mapper_8c.html#a8">PS2_MOUSE_COMPATIBLE_ID</a>);
01520                 RtlMoveMemory(buffer, PS2_MOUSE_COMPATIBLE_ID, size);
01521             } <span class="keywordflow">else</span> {
01522                 <span class="keywordflow">continue</span>;
01523             }
01524             buffer[size / 2] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;  <span class="comment">// 2nd NUL for MULTI_SZ</span>
01525             size += <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>);
01526         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (valueSeed-&gt;Options == <a class="code" href="../../d2/d5/mapper_8c.html#a2">OPTIONS_INSERT_DEVICEDESC</a>) {
01527             size = FirmwareEntry-&gt;IdentifierLength;
01528             RtlMoveMemory(buffer, FirmwareEntry-&gt;Identifier, size);
01529         } <span class="keywordflow">else</span> {
01530             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR, <span class="stringliteral">"Mapper: NO VALUE TYPE!\n"</span>));
01531             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
01532             <span class="keywordflow">continue</span>;
01533         }
01534 
01535         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;unicodeName,
01536                              valueSeed-&gt;ValueName);
01537         ZwSetValueKey(Handle,
01538                       &amp;unicodeName,
01539                       0,
01540                       valueSeed-&gt;ValueType,
01541                       buffer,
01542                       size);
01543     }
01544     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(buffer);
01545 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="mapper.c::MapperTranslatePnPId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWSTR MapperTranslatePnPId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PeripheralType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PKEY_VALUE_FULL_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Identifier</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00402">402</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
References <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a200">DiskController</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a212">DiskPeripheral</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a213">FloppyDiskPeripheral</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00231">FloppyId</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a209">KeyboardController</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00129">KeyboardMap</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a219">KeyboardPeripheral</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00367">MapperFindIdentMatch()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a207">ParallelController</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00223">ParallelId</a>, <a class="el" href="../../d4/d9/arcinst_8h.html#a174a66">PeripheralType</a>, <a class="el" href="../../d2/d5/mapper_8c.html#a20">PFIRMWARE_IDENT_TO_PNP_ID</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00081">_FIRMWARE_IDENT_TO_PNP_ID::PnPId</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a208">PointerController</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00156">PointerMap</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a218">PointerPeripheral</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l00206">SerialId</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00658">MapperCallback()</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l00535">MapperPeripheralCallback()</a>.
<p>
<pre class="fragment"><div>00409                    :
00410 
00411     Given <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> peripheral <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> and a location in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> firmware tree
00412     <span class="keyword">this</span> routine will determine <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PnP Id to be used when constructing
00413     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root enumeration portion of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.
00414 
00415 Arguments:
00416 
00417     <a class="code" href="../../d4/d9/arcinst_8h.html#a174a66">PeripheralType</a> - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of item being translated (keyboard, mouse, etc)
00418     PathName       - the registry path name into the firmware tree for
00419                      this device.
00420 
00421 Return Value:
00422 
00423     A pointer to the PnP Id string if a map is found.
00424 
00425 --*/
00426 
00427 {
00428     <a class="code" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">PFIRMWARE_IDENT_TO_PNP_ID</a> identMap;
00429     PWSTR identifierString;
00430     PWSTR idStr;
00431 
00432     <span class="keywordflow">if</span> (Identifier) {
00433         identifierString = (PWSTR)((PUCHAR)Identifier + Identifier-&gt;DataOffset);
00434         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00435                     <span class="stringliteral">"Mapper: identifier = %ws\n\tType = "</span>,
00436                     identifierString));
00437     }
00438 
00439     idStr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00440     <span class="keywordflow">switch</span> (<a class="code" href="../../d4/d9/arcinst_8h.html#a174a66">PeripheralType</a>) {
00441     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a200">DiskController</a>:
00442         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00443                     <span class="stringliteral">"%s (%d)\n"</span>,
00444                     <span class="stringliteral">"DiskController"</span>,
00445                     PeripheralType));
00446         idStr = <a class="code" href="../../d2/d5/mapper_8c.html#a34">FloppyId</a>;
00447         <span class="keywordflow">break</span>;
00448 
00449     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a204">SerialController</a>:
00450         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00451                     <span class="stringliteral">"%s (%d)\n"</span>,
00452                     <span class="stringliteral">"SerialController"</span>,
00453                     PeripheralType));
00454         idStr = <a class="code" href="../../d2/d5/mapper_8c.html#a30">SerialId</a>;
00455         <span class="keywordflow">break</span>;
00456 
00457     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a207">ParallelController</a>:
00458         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00459                     <span class="stringliteral">"%s (%d)\n"</span>,
00460                     <span class="stringliteral">"ParallelController"</span>,
00461                     PeripheralType));
00462         idStr = <a class="code" href="../../d2/d5/mapper_8c.html#a32">ParallelId</a>;
00463         <span class="keywordflow">break</span>;
00464 
00465     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a208">PointerController</a>:
00466         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00467                     <span class="stringliteral">"%s (%d)\n"</span>,
00468                     <span class="stringliteral">"PointerController"</span>,
00469                     PeripheralType));
00470         idStr = <a class="code" href="../../d2/d5/mapper_8c.html#a27">PointerMap</a>[0].<a class="code" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html#o1">PnPId</a>;
00471         <span class="keywordflow">break</span>;
00472 
00473     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a209">KeyboardController</a>:
00474         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00475                     <span class="stringliteral">"%s (%d)\n"</span>,
00476                     <span class="stringliteral">"KeyboardController"</span>,
00477                     PeripheralType));
00478         idStr = <a class="code" href="../../d2/d5/mapper_8c.html#a26">KeyboardMap</a>[0].<a class="code" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html#o1">PnPId</a>;
00479         <span class="keywordflow">break</span>;
00480 
00481     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a212">DiskPeripheral</a>:
00482         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00483                     <span class="stringliteral">"%s (%d)\n"</span>,
00484                     <span class="stringliteral">"DiskPeripheral"</span>,
00485                     PeripheralType));
00486         <span class="keywordflow">break</span>;
00487 
00488     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a213">FloppyDiskPeripheral</a>:
00489         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00490                     <span class="stringliteral">"%s (%d)\n"</span>,
00491                     <span class="stringliteral">"FloppyDiskPeripheral"</span>,
00492                     PeripheralType));
00493         idStr = <a class="code" href="../../d2/d5/mapper_8c.html#a34">FloppyId</a>;
00494         <span class="keywordflow">break</span>;
00495 
00496     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a218">PointerPeripheral</a>:
00497         identMap = <a class="code" href="../../d2/d5/mapper_8c.html#a36">MapperFindIdentMatch</a>(PointerMap, identifierString);
00498         <span class="keywordflow">if</span> (identMap) {
00499             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00500                         <span class="stringliteral">"%ws\n"</span>,
00501                         identMap-&gt;<a class="code" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html#o1">PnPId</a>));
00502             idStr = identMap-&gt;<a class="code" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html#o1">PnPId</a>;
00503         } <span class="keywordflow">else</span> {
00504             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
00505                         <span class="stringliteral">"Mapper: No pointer match found\n"</span>));
00506         }
00507         <span class="keywordflow">break</span>;
00508 
00509     <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a219">KeyboardPeripheral</a>:
00510         identMap = <a class="code" href="../../d2/d5/mapper_8c.html#a36">MapperFindIdentMatch</a>(KeyboardMap, identifierString);
00511 
00512         <span class="keywordflow">if</span> (identMap) {
00513             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_PNP_ID,
00514                         <span class="stringliteral">"%ws\n"</span>,
00515                         identMap-&gt;<a class="code" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html#o1">PnPId</a>));
00516             idStr = identMap-&gt;<a class="code" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html#o1">PnPId</a>;
00517         } <span class="keywordflow">else</span> {
00518             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
00519                         <span class="stringliteral">"Mapper: No keyboard match found\n"</span>));
00520         }
00521 
00522         <span class="keywordflow">break</span>;
00523 
00524     <span class="keywordflow">default</span>:
00525         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>((MAPPER_ERROR,
00526                     <span class="stringliteral">"Mapper: Unknown device (%d)\n"</span>,
00527                     PeripheralType));
00528         <span class="keywordflow">break</span>;
00529     }
00530     <span class="keywordflow">return</span> idStr;
00531 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a35" doxytag="mapper.c::ATAId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWSTR <a class="el" href="../../d2/d5/mapper_8c.html#a35">ATAId</a> = L"*PNP0600"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00238">238</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="mapper.c::FloppyId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWSTR <a class="el" href="../../d2/d5/mapper_8c.html#a34">FloppyId</a> = L"*PNP0700"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00231">231</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01803">MapperAdjustResourceList()</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l00402">MapperTranslatePnPId()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="mapper.c::KeyboardMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">FIRMWARE_IDENT_TO_PNP_ID</a> <a class="el" href="../../d2/d5/mapper_8c.html#a26">KeyboardMap</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"XT_83KEY"</span>,        <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0300"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCAT_86KEY"</span>,      <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0301"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCXT_84KEY"</span>,      <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0302"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"XT_84KEY"</span>,        <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0302"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"101-KEY"</span>,         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0303"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"OLI_83KEY"</span>,       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0304"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ATT_301"</span>,         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0304"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"OLI_102KEY"</span>,      <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0305"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"OLI_86KEY"</span>,       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0306"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"OLI_A101_102KEY"</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0309"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ATT_302"</span>,         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP030a"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCAT_ENHANCED"</span>,   <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP030b"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PC98_106KEY"</span>,     <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*nEC1300"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PC98_LaptopKEY"</span>,  <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*nEC1300"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PC98_N106KEY"</span>,    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0303"</span>,
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00129">129</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00402">MapperTranslatePnPId()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="mapper.c::MapperDeviceExtension" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d3/struct__DEVICE__EXTENSION.html">DEVICE_EXTENSION</a> <a class="el" href="../../d2/d5/mapper_8c.html#a25">MapperDeviceExtension</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00122">122</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01600">MapperConstructRootEnumTree()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01549">MapperFreeList()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l02060">MapperPhantomizeDetectedComPorts()</a>, and <a class="el" href="../../d3/d4/mapper_8c-source.html#l01009">MapperProcessFirmwareTree()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="mapper.c::MapperKeySeed" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d6/struct__KEY__SEED.html">KEY_SEED</a> <a class="el" href="../../d2/d5/mapper_8c.html#a29">MapperKeySeed</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Control"</span>,           REG_OPTION_VOLATILE,     <a class="code" href="../../d2/d5/mapper_8c.html#a5">KEY_SEED_REQUIRED</a>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\LogConf"</span>,           REG_OPTION_NON_VOLATILE, <a class="code" href="../../d2/d5/mapper_8c.html#a5">KEY_SEED_REQUIRED</a>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">""</span>,                    REG_OPTION_NON_VOLATILE, <a class="code" href="../../d2/d5/mapper_8c.html#a6">KEY_SEED_DEVICE_PARAMETERS</a>,
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0, 0
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00194">194</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="mapper.c::MapperValueSeed" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d7/d6/struct__MAPPER__SEED.html">MAPPER_SEED</a> <a class="el" href="../../d2/d5/mapper_8c.html#a28">MapperValueSeed</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    REGSTR_VAL_HARDWAREID,         REG_MULTI_SZ, 0, <a class="code" href="../../d2/d5/mapper_8c.html#a1">OPTIONS_INSERT_PNP_ID</a>,
    REGSTR_VAL_COMPATIBLEIDS,      REG_MULTI_SZ, 0, <a class="code" href="../../d2/d5/mapper_8c.html#a3">OPTIONS_INSERT_COMPATIBLE_IDS</a>,
    REGSTR_VAL_FIRMWAREIDENTIFIED, REG_DWORD,    1, <a class="code" href="../../d2/d5/mapper_8c.html#a0">OPTIONS_NONE</a>,
    REGSTR_VAL_DEVDESC,            REG_SZ,       0, <a class="code" href="../../d2/d5/mapper_8c.html#a2">OPTIONS_INSERT_DEVICEDESC</a>,
    REGSTR_VAL_PHANTOM,            REG_DWORD,    1, <a class="code" href="../../d2/d5/mapper_8c.html#a4">OPTIONS_INSERT_PHANTOM_MARKER</a>,
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0, 0, 0
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00176">176</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="mapper.c::ParallelId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWSTR <a class="el" href="../../d2/d5/mapper_8c.html#a32">ParallelId</a> = L"*PNP0400"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00223">223</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00402">MapperTranslatePnPId()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="mapper.c::ParallelIdNEC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWSTR <a class="el" href="../../d2/d5/mapper_8c.html#a33">ParallelIdNEC</a> = L"*nEC1401"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00225">225</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00658">MapperCallback()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="mapper.c::PointerMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d7/d2/struct__FIRMWARE__IDENT__TO__PNP__ID.html">FIRMWARE_IDENT_TO_PNP_ID</a> <a class="el" href="../../d2/d5/mapper_8c.html#a27">PointerMap</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PS2 MOUSE"</span>,                        <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0F0E"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"SERIAL MOUSE"</span>,                     <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0F0C"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MICROSOFT PS2 MOUSE"</span>,              <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0F03"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"LOGITECH PS2 MOUSE"</span>,               <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0F12"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MICROSOFT INPORT MOUSE"</span>,           <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0F02"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MICROSOFT SERIAL MOUSE"</span>,           <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0F01"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MICROSOFT BALLPOINT SERIAL MOUSE"</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0F09"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"LOGITECH SERIAL MOUSE"</span>,            <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0F08"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MICROSOFT BUS MOUSE"</span>,              <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*PNP0F00"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"NEC PC-9800 BUS MOUSE"</span>,            <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*nEC1F00"</span>,
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00156">156</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00402">MapperTranslatePnPId()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="mapper.c::SerialId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWSTR <a class="el" href="../../d2/d5/mapper_8c.html#a30">SerialId</a> = L"*PNP0501"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00206">206</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00402">MapperTranslatePnPId()</a>, and <a class="el" href="../../d1/d7/udfdata_8c-source.html#l01022">UdfSerial32()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="mapper.c::SerialIdNEC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWSTR <a class="el" href="../../d2/d5/mapper_8c.html#a31">SerialIdNEC</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {         
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*nEC1500"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*nEC1501"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*nEC1502"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*nEC1503"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*nEC8071"</span>,
    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"*nEC0C01"</span>,
     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d4/mapper_8c-source.html#l00208">208</a> of file <a class="el" href="../../d3/d4/mapper_8c-source.html">mapper.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mapper_8c-source.html#l00658">MapperCallback()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:36 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
