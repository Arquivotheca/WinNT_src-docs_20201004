<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: lfsstruc.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>lfsstruc.h</h1><a href="../../d1/d4/lfsstruc_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++ BUILD Version: 0000    // Increment this if a change has global effects</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    LfsStruc.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module defines the data structures that make up the major internal</span>
00012 <span class="comment">    part of the Log File Service.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Brian Andrew    [BrianAn]   13-June-1991</span>
00017 <span class="comment"></span>
00018 <span class="comment">Revision History:</span>
00019 <span class="comment"></span>
00020 <span class="comment">--*/</span>
00021 
00022 <span class="preprocessor">#ifndef _LFSSTRUC_</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define _LFSSTRUC_</span>
00024 <span class="preprocessor"></span>
<a name="l00025"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a24">00025</a> <span class="keyword">typedef</span> PVOID <a class="code" href="../../d4/d3/struct__BCB.html">PBCB</a>;     <span class="comment">//**** Bcb's are now part of the cache module</span>
00026 
00027 
00028 <span class="comment">//</span>
00029 <span class="comment">//  Log Context Block.  A pointer to this structure is returned to the user</span>
00030 <span class="comment">//  when a client is reading a particular set of log records from the log</span>
00031 <span class="comment">//  file.</span>
00032 <span class="comment">//</span>
00033 
<a name="l00034"></a><a class="code" href="../../d5/d9/struct__LCB.html">00034</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d9/struct__LCB.html">_LCB</a> {
00035 
00036     <span class="comment">//</span>
00037     <span class="comment">//  The type and size of this record (must be LFS_NTC_LCB)</span>
00038     <span class="comment">//</span>
00039 
00040     <a class="code" href="../../d0/d7/lfs_2nodetype_8h.html#a7">NODE_TYPE_CODE</a> <a class="code" href="../../d5/d9/struct__LCB.html#o0">NodeTypeCode</a>;
00041     <a class="code" href="../../d0/d7/lfs_2nodetype_8h.html#a9">NODE_BYTE_SIZE</a> <a class="code" href="../../d5/d9/struct__LCB.html#o1">NodeByteSize</a>;
00042 
00043     <span class="comment">//</span>
00044     <span class="comment">//  Log record header.  This is the mapped log record header and bcb</span>
00045     <span class="comment">//  for the record header of the current Lsn.</span>
00046     <span class="comment">//</span>
00047 
<a name="l00048"></a><a class="code" href="../../d5/d9/struct__LCB.html#o2">00048</a>     <span class="keyword">struct </span><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html">_LFS_RECORD_HEADER</a> *<a class="code" href="../../d5/d9/struct__LCB.html#o2">RecordHeader</a>;
<a name="l00049"></a><a class="code" href="../../d5/d9/struct__LCB.html#o3">00049</a>     <a class="code" href="../../d5/d5/cc_8h.html#a110">PBCB</a> <a class="code" href="../../d5/d9/struct__LCB.html#o3">RecordHeaderBcb</a>;
00050 
00051     <span class="comment">//</span>
00052     <span class="comment">//  Context Mode.  This is the mode governing the log record lookup.  We</span>
00053     <span class="comment">//  can look backwards via the ClientUndoNextLsn or ClientPreviousLsn.</span>
00054     <span class="comment">//  We can also look forwards by walking through all the log records and</span>
00055     <span class="comment">//  comparing ClientId fields.</span>
00056     <span class="comment">//</span>
00057 
<a name="l00058"></a><a class="code" href="../../d5/d9/struct__LCB.html#o4">00058</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a15">LFS_CONTEXT_MODE</a> <a class="code" href="../../d5/d9/struct__LCB.html#o4">ContextMode</a>;
00059 
00060     <span class="comment">//</span>
00061     <span class="comment">//  Client Id.  This is the client ID for the log records being returned.</span>
00062     <span class="comment">//</span>
00063 
<a name="l00064"></a><a class="code" href="../../d5/d9/struct__LCB.html#o5">00064</a>     <a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html">LFS_CLIENT_ID</a> <a class="code" href="../../d5/d9/struct__LCB.html#o5">ClientId</a>;
00065 
00066     <span class="comment">//</span>
00067     <span class="comment">//  Log record pointer.  This is the address returned to the user as the</span>
00068     <span class="comment">//  log record referred to by CurrentLsn.  If we allocated a buffer to</span>
00069     <span class="comment">//  hold the record, we need to deallocate it as necessary.</span>
00070     <span class="comment">//</span>
00071     <span class="comment">//  This field is either the actual mapped log record or a pointer to</span>
00072     <span class="comment">//  an auxilary buffer allocated by the Lfs.</span>
00073     <span class="comment">//</span>
00074 
<a name="l00075"></a><a class="code" href="../../d5/d9/struct__LCB.html#o6">00075</a>     PVOID <a class="code" href="../../d5/d9/struct__LCB.html#o6">CurrentLogRecord</a>;
<a name="l00076"></a><a class="code" href="../../d5/d9/struct__LCB.html#o7">00076</a>     BOOLEAN <a class="code" href="../../d5/d9/struct__LCB.html#o7">AuxilaryBuffer</a>;
00077 
00078 } <a class="code" href="../../d5/d9/struct__LCB.html">LCB</a>, *<a class="code" href="../../d5/d9/struct__LCB.html">PLCB</a>;
00079 
00080 
00081 <span class="comment">//</span>
00082 <span class="comment">//  Lfcb synchronization.  This is the synchronization structure used by the Lfcb.</span>
00083 <span class="comment">//</span>
00084 
<a name="l00085"></a><a class="code" href="../../d2/d0/struct__LFCB__SYNC.html">00085</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d0/struct__LFCB__SYNC.html">_LFCB_SYNC</a> {
00086 
00087     <span class="comment">//</span>
00088     <span class="comment">//  Principal Lfcb Resource.</span>
00089     <span class="comment">//</span>
00090 
<a name="l00091"></a><a class="code" href="../../d2/d0/struct__LFCB__SYNC.html#o0">00091</a>     <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d2/d0/struct__LFCB__SYNC.html#o0">Resource</a>;
00092 
00093     <span class="comment">//</span>
00094     <span class="comment">//  Notification Event.  This event is set to the Signalled state when</span>
00095     <span class="comment">//  pages are flushed to the cache file.  Any waiters will then check</span>
00096     <span class="comment">//  to see if the Lsn they're waiting for made it to disk.</span>
00097     <span class="comment">//</span>
00098 
<a name="l00099"></a><a class="code" href="../../d2/d0/struct__LFCB__SYNC.html#o1">00099</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="code" href="../../d2/d0/struct__LFCB__SYNC.html#o1">Event</a>;
00100 
00101     <span class="comment">//</span>
00102     <span class="comment">//  User Count.  Number of clients using this structure.  We will deallocate</span>
00103     <span class="comment">//  when all clients are gone.</span>
00104     <span class="comment">//</span>
00105 
<a name="l00106"></a><a class="code" href="../../d2/d0/struct__LFCB__SYNC.html#o2">00106</a>     ULONG <a class="code" href="../../d2/d0/struct__LFCB__SYNC.html#o2">UserCount</a>;
00107 
00108     <span class="comment">//</span>
00109     <span class="comment">//  Mutant to guard Lcb spare list</span>
00110     <span class="comment">//</span>
00111 
<a name="l00112"></a><a class="code" href="../../d2/d0/struct__LFCB__SYNC.html#o3">00112</a>     <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="code" href="../../d2/d0/struct__LFCB__SYNC.html#o3">SpareListMutex</a>; 
00113 
00114 } <a class="code" href="../../d2/d0/struct__LFCB__SYNC.html">LFCB_SYNC</a>, *<a class="code" href="../../d2/d0/struct__LFCB__SYNC.html">PLFCB_SYNC</a>;
00115 
00116 
00117 <span class="comment">//</span>
00118 <span class="comment">//  Log Client Structure.  The Lfs allocates one of these for each active</span>
00119 <span class="comment">//  client.  The address of this structure will be returned to the user</span>
00120 <span class="comment">//  as a log handle.</span>
00121 <span class="comment">//</span>
00122 
<a name="l00123"></a><a class="code" href="../../d6/d9/struct__LCH.html">00123</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d9/struct__LCH.html">_LCH</a> {
00124 
00125     <span class="comment">//</span>
00126     <span class="comment">//  The type and size of this record (must be LFS_NTC_LCH)</span>
00127     <span class="comment">//</span>
00128 
<a name="l00129"></a><a class="code" href="../../d6/d9/struct__LCH.html#o0">00129</a>     <a class="code" href="../../d0/d7/lfs_2nodetype_8h.html#a7">NODE_TYPE_CODE</a> <a class="code" href="../../d6/d9/struct__LCH.html#o0">NodeTypeCode</a>;
<a name="l00130"></a><a class="code" href="../../d6/d9/struct__LCH.html#o1">00130</a>     <a class="code" href="../../d0/d7/lfs_2nodetype_8h.html#a9">NODE_BYTE_SIZE</a> <a class="code" href="../../d6/d9/struct__LCH.html#o1">NodeByteSize</a>;
00131 
00132     <span class="comment">//</span>
00133     <span class="comment">//  Links for all the client handles on an Lfcb.</span>
00134     <span class="comment">//</span>
00135 
<a name="l00136"></a><a class="code" href="../../d6/d9/struct__LCH.html#o2">00136</a>     LIST_ENTRY <a class="code" href="../../d6/d9/struct__LCH.html#o2">LchLinks</a>;
00137 
00138     <span class="comment">//</span>
00139     <span class="comment">//  Log File Control Block.  This is the log file for this log handle.</span>
00140     <span class="comment">//</span>
00141 
<a name="l00142"></a><a class="code" href="../../d6/d9/struct__LCH.html#o3">00142</a>     <span class="keyword">struct </span><a class="code" href="../../d1/d0/struct__LFCB.html">_LFCB</a> *<a class="code" href="../../d6/d9/struct__LCH.html#o3">Lfcb</a>;
00143 
00144     <span class="comment">//</span>
00145     <span class="comment">//  Client Id.  This refers to the client record for this client in the</span>
00146     <span class="comment">//  Lfs restart area.</span>
00147     <span class="comment">//</span>
00148 
<a name="l00149"></a><a class="code" href="../../d6/d9/struct__LCH.html#o4">00149</a>     <a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html">LFS_CLIENT_ID</a> <a class="code" href="../../d6/d9/struct__LCH.html#o4">ClientId</a>;
00150 
00151     <span class="comment">//</span>
00152     <span class="comment">//  The following is the number of bytes this client has asked to</span>
00153     <span class="comment">//  have reserved in the log file.  It includes the space</span>
00154     <span class="comment">//  for the log record headers.</span>
00155     <span class="comment">//</span>
00156 
<a name="l00157"></a><a class="code" href="../../d6/d9/struct__LCH.html#o5">00157</a>     LONGLONG <a class="code" href="../../d6/d9/struct__LCH.html#o5">ClientUndoCommitment</a>;
00158 
00159     <span class="comment">//</span>
00160     <span class="comment">//  Byte offset in the client array.</span>
00161     <span class="comment">//</span>
00162 
<a name="l00163"></a><a class="code" href="../../d6/d9/struct__LCH.html#o6">00163</a>     ULONG <a class="code" href="../../d6/d9/struct__LCH.html#o6">ClientArrayByteOffset</a>;
00164 
00165     <span class="comment">//</span>
00166     <span class="comment">//  Pointer to the resource in the Lfcb.  We access the resource with</span>
00167     <span class="comment">//  this pointer for the times when the lfcb has been deleted.</span>
00168     <span class="comment">//</span>
00169 
<a name="l00170"></a><a class="code" href="../../d6/d9/struct__LCH.html#o7">00170</a>     <a class="code" href="../../d1/d4/lfsstruc_8h.html#a28">PLFCB_SYNC</a> <a class="code" href="../../d6/d9/struct__LCH.html#o7">Sync</a>;
00171 
00172 } <a class="code" href="../../d6/d9/struct__LCH.html">LCH</a>, *<a class="code" href="../../d6/d9/struct__LCH.html">PLCH</a>;
00173 
00174 
00175 <span class="comment">//</span>
00176 <span class="comment">//  Log Buffer Control Block.  A buffer control block is associated with</span>
00177 <span class="comment">//  each of the log buffers.  They are used to serialize access to the</span>
00178 <span class="comment">//  log file.</span>
00179 <span class="comment">//</span>
00180 
<a name="l00181"></a><a class="code" href="../../d4/d9/struct__LBCB.html">00181</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d9/struct__LBCB.html">_LBCB</a> {
00182 
00183     <span class="comment">//</span>
00184     <span class="comment">//  The type and size of this record (must be LFS_NTC_LBCB)</span>
00185     <span class="comment">//</span>
00186 
<a name="l00187"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o0">00187</a>     <a class="code" href="../../d0/d7/lfs_2nodetype_8h.html#a7">NODE_TYPE_CODE</a> <a class="code" href="../../d4/d9/struct__LBCB.html#o0">NodeTypeCode</a>;
<a name="l00188"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o1">00188</a>     <a class="code" href="../../d0/d7/lfs_2nodetype_8h.html#a9">NODE_BYTE_SIZE</a> <a class="code" href="../../d4/d9/struct__LBCB.html#o1">NodeByteSize</a>;
00189 
00190     <span class="comment">//</span>
00191     <span class="comment">//  Buffer Block Links.  These fields are used to link the buffer blocks</span>
00192     <span class="comment">//  together.</span>
00193     <span class="comment">//</span>
00194 
<a name="l00195"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o2">00195</a>     LIST_ENTRY <a class="code" href="../../d4/d9/struct__LBCB.html#o2">WorkqueLinks</a>;
<a name="l00196"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o3">00196</a>     LIST_ENTRY <a class="code" href="../../d4/d9/struct__LBCB.html#o3">ActiveLinks</a>;
00197 
00198     <span class="comment">//</span>
00199     <span class="comment">//  Log file position and length.  This is the location in the log file to write</span>
00200     <span class="comment">//  out this buffer.</span>
00201     <span class="comment">//</span>
00202 
<a name="l00203"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o4">00203</a>     LONGLONG <a class="code" href="../../d4/d9/struct__LBCB.html#o4">FileOffset</a>;
<a name="l00204"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o5">00204</a>     LONGLONG <a class="code" href="../../d4/d9/struct__LBCB.html#o5">Length</a>;
00205 
00206     <span class="comment">//</span>
00207     <span class="comment">//  Sequence number.  This is the sequence number for log records which</span>
00208     <span class="comment">//  begin on this page.</span>
00209     <span class="comment">//</span>
00210 
<a name="l00211"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o6">00211</a>     LONGLONG <a class="code" href="../../d4/d9/struct__LBCB.html#o6">SeqNumber</a>;
00212 
00213     <span class="comment">//</span>
00214     <span class="comment">//  Next Offset.  This is the next offset to write a log record in the</span>
00215     <span class="comment">//  this log page.  Stored as a large integer to facilitate large</span>
00216     <span class="comment">//  integer operations.</span>
00217     <span class="comment">//</span>
00218 
<a name="l00219"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o7">00219</a>     LONGLONG <a class="code" href="../../d4/d9/struct__LBCB.html#o7">BufferOffset</a>;
00220 
00221     <span class="comment">//</span>
00222     <span class="comment">//  Buffer.  This field points to the buffer containing the log page</span>
00223     <span class="comment">//  for this block.  For a log record page this is a pointer to</span>
00224     <span class="comment">//  a pinned cache buffer, for a log restart page, this is a pointer</span>
00225     <span class="comment">//  to an auxilary buffer.</span>
00226     <span class="comment">//</span>
00227 
<a name="l00228"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o8">00228</a>     PVOID <a class="code" href="../../d4/d9/struct__LBCB.html#o8">PageHeader</a>;
00229 
00230     <span class="comment">//</span>
00231     <span class="comment">//  Bcb for Log Page Block.  This is the Bcb for the pinned data.</span>
00232     <span class="comment">//  If this buffer block describes an Lfs restart area, this field is NULL.</span>
00233     <span class="comment">//</span>
00234 
<a name="l00235"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o9">00235</a>     <a class="code" href="../../d5/d5/cc_8h.html#a110">PBCB</a> <a class="code" href="../../d4/d9/struct__LBCB.html#o9">LogPageBcb</a>;
00236 
00237     <span class="comment">//</span>
00238     <span class="comment">//  Last Lsn.  This is the Lsn for the last log record on this page.  We delay</span>
00239     <span class="comment">//  writing it until the page is flushed, storing it here instead.</span>
00240     <span class="comment">//</span>
00241 
<a name="l00242"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o10">00242</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d4/d9/struct__LBCB.html#o10">LastLsn</a>;
00243 
00244     <span class="comment">//</span>
00245     <span class="comment">//  Last complete Lsn.  This is the Lsn for the last log record which ends</span>
00246     <span class="comment">//  on this page.</span>
00247     <span class="comment">//</span>
00248 
<a name="l00249"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o11">00249</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d4/d9/struct__LBCB.html#o11">LastEndLsn</a>;
00250 
00251     <span class="comment">//</span>
00252     <span class="comment">//  Page Flags.  These are the flags associated with this log page.</span>
00253     <span class="comment">//  We store them in the Lbcb until the page is written.  They flags</span>
00254     <span class="comment">//  to use are the same as in the log record page header.</span>
00255     <span class="comment">//</span>
00256     <span class="comment">//      LOG_PAGE_LOG_RECORD_END     -   Page contains the end of a log record</span>
00257     <span class="comment">//      LOG_PAGE_PACKED             -   Page contains packed log records</span>
00258     <span class="comment">//      LOG_PAGE_TAIL_COPY          -   Page is a copy of the log file end</span>
00259     <span class="comment">//</span>
00260 
<a name="l00261"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o12">00261</a>     ULONG <a class="code" href="../../d4/d9/struct__LBCB.html#o12">Flags</a>;
00262 
00263     <span class="comment">//</span>
00264     <span class="comment">//  Lbcb flags.  These are flags used to describe this Lbcb.</span>
00265     <span class="comment">//</span>
00266     <span class="comment">//      LBCB_LOG_WRAPPED            -   Lbcb has wrapped the log file</span>
00267     <span class="comment">//      LBCB_ON_ACTIVE_QUEUE        -   Lbcb is on the active queue</span>
00268     <span class="comment">//      LBCB_NOT_EMPTY              -   Page has existing log record</span>
00269     <span class="comment">//      LBCB_FLUSH_COPY             -   Write copy of this page first</span>
00270     <span class="comment">//      LBCB_RESTART_LBCB           -   This Lbcb contains a restart page</span>
00271     <span class="comment">//</span>
00272 
<a name="l00273"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o13">00273</a>     ULONG <a class="code" href="../../d4/d9/struct__LBCB.html#o13">LbcbFlags</a>;
00274 
00275     <span class="comment">//</span>
00276     <span class="comment">//  This is the thread which has locked the log page.</span>
00277     <span class="comment">//</span>
00278 
<a name="l00279"></a><a class="code" href="../../d4/d9/struct__LBCB.html#o14">00279</a>     <a class="code" href="../../d5/d8/ex_8h.html#a121">ERESOURCE_THREAD</a> <a class="code" href="../../d4/d9/struct__LBCB.html#o14">ResourceThread</a>;
00280 
00281 } <a class="code" href="../../d4/d9/struct__LBCB.html">LBCB</a>, *<a class="code" href="../../d4/d9/struct__LBCB.html">PLBCB</a>;
00282 
<a name="l00283"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a0">00283</a> <span class="preprocessor">#define LBCB_LOG_WRAPPED                        (0x00000001)</span>
<a name="l00284"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a1">00284</a> <span class="preprocessor"></span><span class="preprocessor">#define LBCB_ON_ACTIVE_QUEUE                    (0x00000002)</span>
<a name="l00285"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a2">00285</a> <span class="preprocessor"></span><span class="preprocessor">#define LBCB_NOT_EMPTY                          (0x00000004)</span>
<a name="l00286"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a3">00286</a> <span class="preprocessor"></span><span class="preprocessor">#define LBCB_FLUSH_COPY                         (0x00000008)</span>
<a name="l00287"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a4">00287</a> <span class="preprocessor"></span><span class="preprocessor">#define LBCB_RESTART_LBCB                       (0x00000020)</span>
00288 <span class="preprocessor"></span>
00289 
00290 <span class="comment">//</span>
00291 <span class="comment">//  Log file data.  This data structure is used on a per-log file basis.</span>
00292 <span class="comment">//</span>
00293 
<a name="l00294"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a40">00294</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d1/d4/lfsstruc_8h.html#a40">_LFS_IO_STATE</a> {
00295 
00296     <a class="code" href="../../d1/d4/lfsstruc_8h.html#a40a38">LfsNoIoInProgress</a> = 0,
00297     <a class="code" href="../../d1/d4/lfsstruc_8h.html#a40a39">LfsClientThreadIo</a>
00298 
00299 } <a class="code" href="../../d1/d4/lfsstruc_8h.html#a33">LFS_IO_STATE</a>;
00300 
<a name="l00301"></a><a class="code" href="../../d1/d0/struct__LFCB.html">00301</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d0/struct__LFCB.html">_LFCB</a> {
00302 
00303     <span class="comment">//</span>
00304     <span class="comment">//  The type and size of this record (must be LFS_NTC_LFCB)</span>
00305     <span class="comment">//</span>
00306 
<a name="l00307"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o0">00307</a>     <a class="code" href="../../d0/d7/lfs_2nodetype_8h.html#a7">NODE_TYPE_CODE</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o0">NodeTypeCode</a>;
<a name="l00308"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o1">00308</a>     <a class="code" href="../../d0/d7/lfs_2nodetype_8h.html#a9">NODE_BYTE_SIZE</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o1">NodeByteSize</a>;
00309 
00310     <span class="comment">//</span>
00311     <span class="comment">//  Lfcb Links.  The following links the file control blocks to the</span>
00312     <span class="comment">//  global data structure.</span>
00313     <span class="comment">//</span>
00314 
<a name="l00315"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o2">00315</a>     LIST_ENTRY <a class="code" href="../../d1/d0/struct__LFCB.html#o2">LfcbLinks</a>;
00316 
00317     <span class="comment">//</span>
00318     <span class="comment">//  Lch Links.  The following links all of the handles for the Lfcb.</span>
00319     <span class="comment">//</span>
00320 
<a name="l00321"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o3">00321</a>     LIST_ENTRY <a class="code" href="../../d1/d0/struct__LFCB.html#o3">LchLinks</a>;
00322 
00323     <span class="comment">//</span>
00324     <span class="comment">//</span>
00325     <span class="comment">//  File Object.  This is the file object for the log file.</span>
00326     <span class="comment">//</span>
00327 
<a name="l00328"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o4">00328</a>     <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o4">FileObject</a>;
00329 
00330     <span class="comment">//</span>
00331     <span class="comment">//  Log File Size.  This is the size of the log file.</span>
00332     <span class="comment">//  The second value is the size proposed by this open.</span>
00333     <span class="comment">//</span>
00334 
<a name="l00335"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o5">00335</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o5">FileSize</a>;
00336 
00337     <span class="comment">//</span>
00338     <span class="comment">//  System page size and masks.</span>
00339     <span class="comment">//</span>
00340 
<a name="l00341"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o6">00341</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o6">SystemPageSize</a>;
<a name="l00342"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o7">00342</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o7">SystemPageMask</a>;
<a name="l00343"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o8">00343</a>     LONG <a class="code" href="../../d1/d0/struct__LFCB.html#o8">SystemPageInverseMask</a>;
00344 
00345     <span class="comment">//</span>
00346     <span class="comment">//  Log page size, masks and shift count to do multiplication and division</span>
00347     <span class="comment">//  of log pages.</span>
00348     <span class="comment">//</span>
00349 
<a name="l00350"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o9">00350</a>     LONGLONG  <a class="code" href="../../d1/d0/struct__LFCB.html#o9">LogPageSize</a>;
<a name="l00351"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o10">00351</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o10">LogPageMask</a>;
<a name="l00352"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o11">00352</a>     LONG <a class="code" href="../../d1/d0/struct__LFCB.html#o11">LogPageInverseMask</a>;
<a name="l00353"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o12">00353</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o12">LogPageShift</a>;
00354 
00355     <span class="comment">//</span>
00356     <span class="comment">//  First log page.  This is the offset in the file of the first</span>
00357     <span class="comment">//  log page with log records.</span>
00358     <span class="comment">//</span>
00359 
<a name="l00360"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o13">00360</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o13">FirstLogPage</a>;
00361 
00362     <span class="comment">//</span>
00363     <span class="comment">//  Next log page offset.  This is the offset of the next log page to use.</span>
00364     <span class="comment">//  If we are reusing this page we store the offset to begin with.</span>
00365     <span class="comment">//</span>
00366 
<a name="l00367"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o14">00367</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o14">NextLogPage</a>;
<a name="l00368"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o15">00368</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o15">ReusePageOffset</a>;
00369 
00370     <span class="comment">//</span>
00371     <span class="comment">//  Data Offset.  This is the offset within a log page of the data that</span>
00372     <span class="comment">//  appears on that page.  This will be the actual restart data for</span>
00373     <span class="comment">//  an Lfs restart page, or the beginning of log record data for a log</span>
00374     <span class="comment">//  record page.</span>
00375     <span class="comment">//</span>
00376 
<a name="l00377"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o16">00377</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o16">RestartDataOffset</a>;
<a name="l00378"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o17">00378</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o17">LogPageDataOffset</a>;
00379 
00380     <span class="comment">//</span>
00381     <span class="comment">//  Data Size.  This is the amount of data that may be stored on a</span>
00382     <span class="comment">//  log page.  It is included here because it is frequently used.  It</span>
00383     <span class="comment">//  is simply the log page size minus the data offset.</span>
00384     <span class="comment">//</span>
00385 
<a name="l00386"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o18">00386</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o18">RestartDataSize</a>;
<a name="l00387"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o19">00387</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o19">LogPageDataSize</a>;
00388 
00389     <span class="comment">//</span>
00390     <span class="comment">//  Record header size.  This is the size to use for the record headers</span>
00391     <span class="comment">//  when reading the log file.</span>
00392     <span class="comment">//</span>
00393 
<a name="l00394"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o20">00394</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o20">RecordHeaderLength</a>;
00395 
00396     <span class="comment">//</span>
00397     <span class="comment">//  Sequence number.  This is the number of times we have cycled through</span>
00398     <span class="comment">//  the log file.  The wrap sequence number is used to confirm that we</span>
00399     <span class="comment">//  have gone through the entire file at least once.  When we write a</span>
00400     <span class="comment">//  log record page for an Lsn with this sequence number, then we have</span>
00401     <span class="comment">//  cycled through the file.</span>
00402     <span class="comment">//</span>
00403 
<a name="l00404"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o21">00404</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o21">SeqNumber</a>;
<a name="l00405"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o22">00405</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o22">SeqNumberForWrap</a>;
<a name="l00406"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o23">00406</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o23">SeqNumberBits</a>;
<a name="l00407"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o24">00407</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o24">FileDataBits</a>;
00408 
00409     <span class="comment">//</span>
00410     <span class="comment">//  Buffer Block Links.  The following links the buffer blocks for this</span>
00411     <span class="comment">//  log file.</span>
00412     <span class="comment">//</span>
00413 
<a name="l00414"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o25">00414</a>     LIST_ENTRY <a class="code" href="../../d1/d0/struct__LFCB.html#o25">LbcbWorkque</a>;
<a name="l00415"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o26">00415</a>     LIST_ENTRY <a class="code" href="../../d1/d0/struct__LFCB.html#o26">LbcbActive</a>;
00416 
<a name="l00417"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o27">00417</a>     <a class="code" href="../../d1/d4/lfsstruc_8h.html#a32">PLBCB</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o27">ActiveTail</a>;
<a name="l00418"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o28">00418</a>     <a class="code" href="../../d1/d4/lfsstruc_8h.html#a32">PLBCB</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o28">PrevTail</a>;
00419 
00420     <span class="comment">//</span>
00421     <span class="comment">//  The enumerated type indicates if there is an active write for</span>
00422     <span class="comment">//  this log file and whether it is being done by an Lfs or</span>
00423     <span class="comment">//  client thread.</span>
00424     <span class="comment">//</span>
00425 
<a name="l00426"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o29">00426</a>     <a class="code" href="../../d1/d4/lfsstruc_8h.html#a33">LFS_IO_STATE</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o29">LfsIoState</a>;
00427 
00428     <span class="comment">//</span>
00429     <span class="comment">//  Current Restart Area.  The following is the in-memory image of the</span>
00430     <span class="comment">//  next restart area.  We also store a pointer to the client data</span>
00431     <span class="comment">//  array in the restart area.  The client array offset is from the start of</span>
00432     <span class="comment">//  the restart area.</span>
00433     <span class="comment">//</span>
00434 
<a name="l00435"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o30">00435</a>     <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html">PLFS_RESTART_AREA</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o30">RestartArea</a>;
<a name="l00436"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o31">00436</a>     <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html">PLFS_CLIENT_RECORD</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o31">ClientArray</a>;
<a name="l00437"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o32">00437</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o32">ClientArrayOffset</a>;
<a name="l00438"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o33">00438</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o33">ClientNameOffset</a>;
00439 
00440     <span class="comment">//</span>
00441     <span class="comment">//  Restart Area size.  This is the usable size of the restart area.</span>
00442     <span class="comment">//</span>
00443 
<a name="l00444"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o34">00444</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o34">RestartAreaSize</a>;
<a name="l00445"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o35">00445</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o35">LogClients</a>;
00446 
00447     <span class="comment">//</span>
00448     <span class="comment">//  Initial Restart area.  If true, then the in-memory restart area is to</span>
00449     <span class="comment">//  be written to the first position on the disk.</span>
00450     <span class="comment">//</span>
00451 
<a name="l00452"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o36">00452</a>     BOOLEAN <a class="code" href="../../d1/d0/struct__LFCB.html#o36">InitialRestartArea</a>;
00453 
00454     <span class="comment">//</span>
00455     <span class="comment">//  The following pseudo Lsn's are used to track when restart areas</span>
00456     <span class="comment">//  are flushed to the disk.</span>
00457     <span class="comment">//</span>
00458 
<a name="l00459"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o37">00459</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o37">NextRestartLsn</a>;
<a name="l00460"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o38">00460</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o38">LastFlushedRestartLsn</a>;
00461 
00462     <span class="comment">//</span>
00463     <span class="comment">//  The following is the earliest Lsn we will guarantee is still in the</span>
00464     <span class="comment">//  log file.</span>
00465     <span class="comment">//</span>
00466 
<a name="l00467"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o39">00467</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o39">OldestLsn</a>;
00468 
00469     <span class="comment">//</span>
00470     <span class="comment">//  The following is the file offset of the oldest Lsn in the system.</span>
00471     <span class="comment">//  We redundantly store it in this form since we will be constantly</span>
00472     <span class="comment">//  checking if a new log record will write over part of the file</span>
00473     <span class="comment">//  we are trying to maintain.</span>
00474     <span class="comment">//</span>
00475 
<a name="l00476"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o40">00476</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o40">OldestLsnOffset</a>;
00477 
00478     <span class="comment">//</span>
00479     <span class="comment">//  Last Flushed Lsn.  The following is the last Lsn guaranteed to</span>
00480     <span class="comment">//  be flushed to the disk.</span>
00481     <span class="comment">//</span>
00482 
<a name="l00483"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o41">00483</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o41">LastFlushedLsn</a>;
00484 
00485     <span class="comment">//</span>
00486     <span class="comment">//</span>
00487     <span class="comment">//  The following fields are used to track current usage in the log file.</span>
00488     <span class="comment">//</span>
00489     <span class="comment">//      TotalAvailable - is the total number of bytes available for</span>
00490     <span class="comment">//          log records.  It is the number of log pages times the</span>
00491     <span class="comment">//          data size of each page.</span>
00492     <span class="comment">//</span>
00493     <span class="comment">//      TotalAvailInPages - is the total number of bytes in the log</span>
00494     <span class="comment">//          pages for log records.  This is TotalAvailable without</span>
00495     <span class="comment">//          subtracting the size of the page headers.</span>
00496     <span class="comment">//</span>
00497     <span class="comment">//      TotalUndoCommitment - is the number of bytes reserved for</span>
00498     <span class="comment">//          possible abort operations.  This includes space for</span>
00499     <span class="comment">//          log record headers as well.</span>
00500     <span class="comment">//</span>
00501     <span class="comment">//      MaxCurrentAvail - is the maximum available in all pages</span>
00502     <span class="comment">//          subtracting the page header and any reserved tail.</span>
00503     <span class="comment">//</span>
00504     <span class="comment">//      CurrentAvailable - is the total number of bytes available in</span>
00505     <span class="comment">//          unused pages in the log file.</span>
00506     <span class="comment">//</span>
00507     <span class="comment">//      ReservedLogPageSize - is the number of bytes on a page available</span>
00508     <span class="comment">//          for reservation.</span>
00509     <span class="comment">//</span>
00510 
<a name="l00511"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o42">00511</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o42">TotalAvailable</a>;
<a name="l00512"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o43">00512</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o43">TotalAvailInPages</a>;
<a name="l00513"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o44">00513</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o44">TotalUndoCommitment</a>;
<a name="l00514"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o45">00514</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o45">MaxCurrentAvail</a>;
<a name="l00515"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o46">00515</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o46">CurrentAvailable</a>;
00516 
<a name="l00517"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o47">00517</a>     LONGLONG <a class="code" href="../../d1/d0/struct__LFCB.html#o47">ReservedLogPageSize</a>;
00518 
00519     <span class="comment">//</span>
00520     <span class="comment">//  The following fields are used to store information about the</span>
00521     <span class="comment">//  update sequence arrays.</span>
00522     <span class="comment">//</span>
00523 
<a name="l00524"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o48">00524</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o48">RestartUsaOffset</a>;
<a name="l00525"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o49">00525</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o49">RestartUsaArraySize</a>;
00526 
<a name="l00527"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o50">00527</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o50">LogRecordUsaOffset</a>;
<a name="l00528"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o51">00528</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o51">LogRecordUsaArraySize</a>;
00529 
00530     <span class="comment">//</span>
00531     <span class="comment">//  Major and minor version numbers.</span>
00532     <span class="comment">//</span>
00533 
<a name="l00534"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o52">00534</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o52">MajorVersion</a>;
<a name="l00535"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o53">00535</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o53">MinorVersion</a>;
00536 
00537     <span class="comment">//</span>
00538     <span class="comment">//  Log File Flags.</span>
00539     <span class="comment">//</span>
00540     <span class="comment">//      LFCB_LOG_WRAPPED        -   We found an Lbcb which wraps the log file</span>
00541     <span class="comment">//      LFCB_MULTIPLE_PAGE_IO   -   Write multiple pages if possible</span>
00542     <span class="comment">//      LFCB_NO_LAST_LSN        -   There are no log records to return</span>
00543     <span class="comment">//      LFCB_PACK_LOG           -   Pack the records into the pages</span>
00544     <span class="comment">//      LFCB_REUSE_TAIL         -   We will be reusing the tail of the log file after restart</span>
00545     <span class="comment">//      LFCB_NO_OLDEST_LSN      -   There is no oldest page being reserved</span>
00546     <span class="comment">//</span>
00547 
<a name="l00548"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o54">00548</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o54">Flags</a>;
00549 
00550     <span class="comment">//</span>
00551     <span class="comment">//  The following are the spare Lbcb's for the volume and a field with</span>
00552     <span class="comment">//  the count for these.</span>
00553     <span class="comment">//</span>
00554 
<a name="l00555"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o55">00555</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o55">SpareLbcbCount</a>;
<a name="l00556"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o56">00556</a>     LIST_ENTRY <a class="code" href="../../d1/d0/struct__LFCB.html#o56">SpareLbcbList</a>;
00557 
00558     <span class="comment">//</span>
00559     <span class="comment">//  The following are sparse LCB's to be used rather than having to allocate</span>
00560     <span class="comment">//  then when reading log records</span>
00561     <span class="comment">//</span>
00562 
<a name="l00563"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o57">00563</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o57">SpareLcbCount</a>;
<a name="l00564"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o58">00564</a>     LIST_ENTRY <a class="code" href="../../d1/d0/struct__LFCB.html#o58">SpareLcbList</a>;
00565 
00566     <span class="comment">//</span>
00567     <span class="comment">//  The following structure synchronizes access to this structure.</span>
00568     <span class="comment">//</span>
00569 
<a name="l00570"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o59">00570</a>     <a class="code" href="../../d1/d4/lfsstruc_8h.html#a28">PLFCB_SYNC</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o59">Sync</a>;
00571 
00572     <span class="comment">//</span>
00573     <span class="comment">//  Count of waiters wanting access to flush the Lfcb.</span>
00574     <span class="comment">//</span>
00575 
<a name="l00576"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o60">00576</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o60">Waiters</a>;
00577 
00578     <span class="comment">//</span>
00579     <span class="comment">//  On-disk value for OpenLogCount.  This is the value we will stuff into</span>
00580     <span class="comment">//  the client handles.</span>
00581     <span class="comment">//</span>
00582 
<a name="l00583"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o61">00583</a>     ULONG <a class="code" href="../../d1/d0/struct__LFCB.html#o61">CurrentOpenLogCount</a>;
00584 
00585     <span class="comment">//</span>
00586     <span class="comment">//  Maintain the flush range for this file.</span>
00587     <span class="comment">//</span>
00588 
<a name="l00589"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o62">00589</a>     <a class="code" href="../../d5/d1/struct__LFS__WRITE__DATA.html">PLFS_WRITE_DATA</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o62">UserWriteData</a>;
00590 
<a name="l00591"></a><a class="code" href="../../d1/d0/struct__LFCB.html#o63">00591</a>     <a class="code" href="../../d1/d4/lfsstruc_8h.html#a32">PLBCB</a> <a class="code" href="../../d1/d0/struct__LFCB.html#o63">PageToDirty</a>;
00592 
00593 <span class="preprocessor">#ifdef BRIANDBG</span>
00594 <span class="preprocessor"></span>    <a class="code" href="../../d5/d8/ex_8h.html#a121">ERESOURCE_THREAD</a> LfsIoThread;
00595 <span class="preprocessor">#endif</span>
00596 <span class="preprocessor"></span>
00597 } <a class="code" href="../../d1/d0/struct__LFCB.html">LFCB</a>, *<a class="code" href="../../d1/d0/struct__LFCB.html">PLFCB</a>;
00598 
<a name="l00599"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a5">00599</a> <span class="preprocessor">#define LFCB_LOG_WRAPPED                (0x00000001)</span>
<a name="l00600"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a6">00600</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_MULTIPLE_PAGE_IO           (0x00000002)</span>
<a name="l00601"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a7">00601</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_NO_LAST_LSN                (0x00000004)</span>
<a name="l00602"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a8">00602</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_PACK_LOG                   (0x00000008)</span>
<a name="l00603"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a9">00603</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_REUSE_TAIL                 (0x00000010)</span>
<a name="l00604"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a10">00604</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_NO_OLDEST_LSN              (0x00000020)</span>
<a name="l00605"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a11">00605</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_LOG_FILE_CORRUPT           (0x00000040)</span>
<a name="l00606"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a12">00606</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_FINAL_SHUTDOWN             (0x00000080)</span>
<a name="l00607"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a13">00607</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_READ_FIRST_RESTART         (0x00000100)</span>
<a name="l00608"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a14">00608</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_READ_SECOND_RESTART        (0x00000200)</span>
00609 <span class="preprocessor"></span>
<a name="l00610"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a15">00610</a> <span class="preprocessor">#define LFCB_RESERVE_LBCB_COUNT         (5)</span>
<a name="l00611"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a16">00611</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_MAX_LBCB_COUNT             (25)</span>
00612 <span class="preprocessor"></span>
<a name="l00613"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a17">00613</a> <span class="preprocessor">#define LFCB_RESERVE_LCB_COUNT          (5)</span>
<a name="l00614"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a18">00614</a> <span class="preprocessor"></span><span class="preprocessor">#define LFCB_MAX_LCB_COUNT              (25)</span>
00615 <span class="preprocessor"></span>
00616 
00617 <span class="comment">//</span>
00618 <span class="comment">//  Global Log Data.  The following structure has only one instance and</span>
00619 <span class="comment">//  maintains global information for the entire logging service.</span>
00620 <span class="comment">//</span>
00621 
<a name="l00622"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html">00622</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d0/struct__LFS__DATA.html">_LFS_DATA</a> {
00623 
00624     <span class="comment">//</span>
00625     <span class="comment">//  The type and size of this record (must be LFS_NTC_DATA)</span>
00626     <span class="comment">//</span>
00627 
<a name="l00628"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o0">00628</a>     <a class="code" href="../../d0/d7/lfs_2nodetype_8h.html#a7">NODE_TYPE_CODE</a> <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o0">NodeTypeCode</a>;
<a name="l00629"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o1">00629</a>     <a class="code" href="../../d0/d7/lfs_2nodetype_8h.html#a9">NODE_BYTE_SIZE</a> <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o1">NodeByteSize</a>;
00630 
00631     <span class="comment">//</span>
00632     <span class="comment">//  The following field links all of the Log File Control Blocks for</span>
00633     <span class="comment">//  the logging system.</span>
00634     <span class="comment">//</span>
00635 
<a name="l00636"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o2">00636</a>     LIST_ENTRY <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o2">LfcbLinks</a>;
00637 
00638     <span class="comment">//</span>
00639     <span class="comment">//  Flag field.</span>
00640     <span class="comment">//</span>
00641 
<a name="l00642"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o3">00642</a>     ULONG <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o3">Flags</a>;
00643 
00644     <span class="comment">//</span>
00645     <span class="comment">//  The following mutex controls access to this structure.</span>
00646     <span class="comment">//</span>
00647 
<a name="l00648"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o4">00648</a>     <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o4">LfsDataLock</a>;
00649 
00650     <span class="comment">//</span>
00651     <span class="comment">//  Allocated buffers for reading spanning log records in low memory case.</span>
00652     <span class="comment">//  Flags indicate which buffers owned.</span>
00653     <span class="comment">//      LFS_BUFFER1_OWNED</span>
00654     <span class="comment">//      LFS_BUFFER2_OWNED</span>
00655     <span class="comment">//</span>
00656 
<a name="l00657"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o5">00657</a>     PVOID <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o5">Buffer1</a>;
<a name="l00658"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o6">00658</a>     PVOID <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o6">Buffer2</a>;
<a name="l00659"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o7">00659</a>     <a class="code" href="../../d5/d8/ex_8h.html#a121">ERESOURCE_THREAD</a> <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o7">BufferOwner</a>;
<a name="l00660"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o8">00660</a>     ULONG <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o8">BufferFlags</a>;
00661 
<a name="l00662"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o9">00662</a>     <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o9">BufferLock</a>;
<a name="l00663"></a><a class="code" href="../../d5/d0/struct__LFS__DATA.html#o10">00663</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="code" href="../../d5/d0/struct__LFS__DATA.html#o10">BufferNotification</a>;
00664 
00665 } <a class="code" href="../../d5/d0/struct__LFS__DATA.html">LFS_DATA</a>, *<a class="code" href="../../d5/d0/struct__LFS__DATA.html">PLFS_DATA</a>;
00666 
<a name="l00667"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a19">00667</a> <span class="preprocessor">#define LFS_DATA_INIT_FAILED                (0x00000001)</span>
<a name="l00668"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a20">00668</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_DATA_INITIALIZED                (0x00000002)</span>
00669 <span class="preprocessor"></span>
<a name="l00670"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a21">00670</a> <span class="preprocessor">#define LFS_BUFFER1_OWNED                   (0x00000001)</span>
<a name="l00671"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a22">00671</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_BUFFER2_OWNED                   (0x00000002)</span>
00672 <span class="preprocessor"></span>
<a name="l00673"></a><a class="code" href="../../d1/d4/lfsstruc_8h.html#a23">00673</a> <span class="preprocessor">#define LFS_BUFFER_SIZE                     (0x10000)</span>
00674 <span class="preprocessor"></span><span class="preprocessor">#endif // _LFSSTRUC_</span>
00675 <span class="preprocessor"></span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:38 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
