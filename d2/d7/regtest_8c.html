<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: regtest.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>regtest.c File Reference</h1><code>#include "stdio.h"</code><br>
<code>#include "nt.h"</code><br>

<p>
<a href="../../d3/d6/regtest_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d7/regtest_8c.html#a0">MAX_VALUE</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen</a> (PUCHAR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d7/regtest_8c.html#a3">main</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d7/regtest_8c.html#a4">DoTest</a> (HANDLE RootKey)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>UCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d7/regtest_8c.html#a1">ValueBuffer</a> [MAX_VALUE]</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="regtest.c::MAX_VALUE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_VALUE&nbsp;&nbsp;&nbsp;256          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d6/regtest_8c-source.html#l00033">33</a> of file <a class="el" href="../../d3/d6/regtest_8c-source.html">regtest.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/regtest_8c-source.html#l00045">DoTest()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a4" doxytag="regtest.c::DoTest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoTest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>RootKey</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d6/regtest_8c-source.html#l00045">45</a> of file <a class="el" href="../../d3/d6/regtest_8c-source.html">regtest.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d3/d6/regtest_8c-source.html#l00033">MAX_VALUE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, <a class="el" href="../../d0/d9/tcmpmem_8c-source.html#l00037">String1</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, <a class="el" href="../../d7/d5/ttime_8c-source.html#l00047">Time</a>, and <a class="el" href="../../d2/d0/hivedmp_8c-source.html#l00060">ValueBuffer</a>.
<p>
<pre class="fragment"><div>00048 {
00049     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> rc;
00050     STRING <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>;
00051     UCHAR Value1[] = <span class="stringliteral">"This string is value 1."</span>;
00052     UCHAR Value2[] = <span class="stringliteral">"Value 2 is represented by this string."</span>;
00053     HANDLE Handle1;
00054     HANDLE Handle2;
00055     ULONG ValueLength;
00056     ULONG Type;
00057     LARGE_INTEGER <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>;
00058 
00059     <span class="comment">//</span>
00060     <span class="comment">// Create parent node</span>
00061     <span class="comment">//</span>
00062 
00063     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part1\n"</span>);
00064     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(&amp;String1,  <span class="stringliteral">"Test1"</span>);
00065     rc = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(
00066         RootKey,
00067         &amp;String1,
00068         0,
00069         NULL,
00070         GENERIC_READ|GENERIC_WRITE,
00071         &amp;Handle1
00072         );
00073 
00074     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00075         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"1:CreateKey failed rc  = %08lx"</span>, rc);
00076         <span class="keywordflow">return</span>;
00077     }
00078 
00079     <span class="comment">//</span>
00080     <span class="comment">// Set data into parent</span>
00081     <span class="comment">//</span>
00082 
00083     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part2\n"</span>);
00084     rc = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00085         Handle1,
00086         1,              <span class="comment">// type</span>
00087         Value1,
00088         <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(Value1)
00089         );
00090 
00091     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00092         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"2:SetValueKey failed rc  = %08lx"</span>, rc);
00093         <span class="keywordflow">return</span>;
00094     }
00095 
00096     <span class="comment">//</span>
00097     <span class="comment">// Query and compare data from parent</span>
00098     <span class="comment">//</span>
00099 
00100     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part2b\n"</span>);
00101     ValueLength = <a class="code" href="../../d2/d7/regtest_8c.html#a0">MAX_VALUE</a>;
00102     rc = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00103         Handle1,
00104         &amp;Type,
00105         ValueBuffer,
00106         &amp;ValueLength,
00107         &amp;Time
00108         );
00109 
00110     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00111         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"2b:QueryValueKey failed rc  = %08lx"</span>, rc);
00112         <span class="keywordflow">return</span>;
00113     }
00114 
00115     <span class="keywordflow">if</span> (ValueLength != (ULONG)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(Value1)) {
00116         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"2b1:Wrong value length\n"</span>);
00117         <span class="keywordflow">return</span>;
00118     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RtlCompareMemory(
00119                 ValueBuffer, Value1, ValueLength) != ValueLength) {
00120         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"2b2:Wrong value\n"</span>);
00121         <span class="keywordflow">return</span>;
00122     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Type != 1) {
00123         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"2b3:Wrong type\n"</span>);
00124         <span class="keywordflow">return</span>;
00125     }
00126 
00127 
00128     <span class="comment">//</span>
00129     <span class="comment">// Close parent</span>
00130     <span class="comment">//</span>
00131 
00132     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part3\n"</span>);
00133     NtCloseKey(Handle1);
00134 
00135     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00136         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"3:CloseKey failed rc  = %08lx"</span>, rc);
00137         <span class="keywordflow">return</span>;
00138     }
00139 
00140 
00141     <span class="comment">//</span>
00142     <span class="comment">// Reopen parent</span>
00143     <span class="comment">//</span>
00144 
00145     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part4\n"</span>);
00146     rc = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00147         RootKey,
00148         &amp;String1,
00149         0,
00150         GENERIC_READ|GENERIC_WRITE,
00151         &amp;Handle1
00152         );
00153 
00154     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00155         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"4:OpenKey failed rc  = %08lx"</span>, rc);
00156         <span class="keywordflow">return</span>;
00157     }
00158 
00159     <span class="comment">//</span>
00160     <span class="comment">// Create child</span>
00161     <span class="comment">//</span>
00162 
00163     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part5\n"</span>);
00164     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(&amp;String1,  <span class="stringliteral">"Test2"</span>);
00165     rc = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(
00166         Handle1,
00167         &amp;String1,
00168         0,
00169         NULL,
00170         GENERIC_READ|GENERIC_WRITE,
00171         &amp;Handle2
00172         );
00173 
00174     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00175         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"5:CreateKey failed rc  = %08lx"</span>, rc);
00176         <span class="keywordflow">return</span>;
00177     }
00178 
00179 
00180     <span class="comment">//</span>
00181     <span class="comment">// Set data into child</span>
00182     <span class="comment">//</span>
00183 
00184     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part6\n"</span>);
00185     rc = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00186         Handle2,
00187         2,              <span class="comment">// type</span>
00188         Value2,
00189         <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(Value2)
00190         );
00191 
00192     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00193         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"6:SetValueKey failed rc  = %08lx"</span>, rc);
00194         <span class="keywordflow">return</span>;
00195     }
00196 
00197 
00198     <span class="comment">//</span>
00199     <span class="comment">// Query and compare data from child</span>
00200     <span class="comment">//</span>
00201 
00202     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part7\n"</span>);
00203     ValueLength = <a class="code" href="../../d2/d7/regtest_8c.html#a0">MAX_VALUE</a>;
00204     rc = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00205         Handle2,
00206         &amp;Type,
00207         ValueBuffer,
00208         &amp;ValueLength,
00209         &amp;Time
00210         );
00211 
00212     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00213         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"7:QueryValueKey failed rc  = %08lx"</span>, rc);
00214         <span class="keywordflow">return</span>;
00215     }
00216 
00217     <span class="keywordflow">if</span> (ValueLength != (ULONG)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(Value2)) {
00218         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"7.1:Wrong value length\n"</span>);
00219         <span class="keywordflow">return</span>;
00220     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RtlCompareMemory(
00221                 ValueBuffer, Value2, ValueLength) != ValueLength) {
00222         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"7.2:Wrong value\n"</span>);
00223         <span class="keywordflow">return</span>;
00224     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Type != 2) {
00225         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"7.3:Wrong type\n"</span>);
00226         <span class="keywordflow">return</span>;
00227     }
00228 
00229 
00230     <span class="comment">//</span>
00231     <span class="comment">// Query and compare data from parent again</span>
00232     <span class="comment">//</span>
00233 
00234     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part8\n"</span>);
00235     ValueLength = <a class="code" href="../../d2/d7/regtest_8c.html#a0">MAX_VALUE</a>;
00236     rc = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00237         Handle1,
00238         &amp;Type,
00239         ValueBuffer,
00240         &amp;ValueLength,
00241         &amp;Time
00242         );
00243 
00244     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00245         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"8:QueryValueKey failed rc  = %08lx"</span>, rc);
00246         <span class="keywordflow">return</span>;
00247     }
00248 
00249     <span class="keywordflow">if</span> (ValueLength != (ULONG)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(Value1)) {
00250         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"8.1:Wrong value length\n"</span>);
00251         <span class="keywordflow">return</span>;
00252     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RtlCompareMemory(
00253                 ValueBuffer, Value1, ValueLength) != ValueLength) {
00254         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"8.2:Wrong value\n"</span>);
00255         <span class="keywordflow">return</span>;
00256     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Type != 1) {
00257         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"8.3:Wrong type\n"</span>);
00258         <span class="keywordflow">return</span>;
00259     }
00260 
00261 
00262     <span class="comment">//</span>
00263     <span class="comment">// Reset parent data</span>
00264     <span class="comment">//</span>
00265 
00266     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part9\n"</span>);
00267     rc = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00268         Handle1,
00269         1,              <span class="comment">// type</span>
00270         Value2,
00271         <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(Value2)
00272         );
00273 
00274     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00275         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"9:SetValueKey failed rc  = %08lx"</span>, rc);
00276         <span class="keywordflow">return</span>;
00277     }
00278 
00279 
00280     <span class="comment">//</span>
00281     <span class="comment">// Query and compare reset data</span>
00282     <span class="comment">//</span>
00283 
00284     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part10\n"</span>);
00285     ValueLength = <a class="code" href="../../d2/d7/regtest_8c.html#a0">MAX_VALUE</a>;
00286     rc = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00287         Handle1,
00288         &amp;Type,
00289         ValueBuffer,
00290         &amp;ValueLength,
00291         &amp;Time
00292         );
00293 
00294     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00295         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"10:QueryValueKey failed rc  = %08lx"</span>, rc);
00296         <span class="keywordflow">return</span>;
00297     }
00298 
00299     <span class="keywordflow">if</span> (ValueLength != (ULONG)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(Value2)) {
00300         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"10.1:Wrong value length\n"</span>);
00301         <span class="keywordflow">return</span>;
00302     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RtlCompareMemory(
00303                 ValueBuffer, Value2, ValueLength) != ValueLength) {
00304         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"10.2:Wrong value\n"</span>);
00305         <span class="keywordflow">return</span>;
00306     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Type != 1) {
00307         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"10.3:Wrong type\n"</span>);
00308         <span class="keywordflow">return</span>;
00309     }
00310 
00311     <span class="comment">//</span>
00312     <span class="comment">// Close off handles and return</span>
00313     <span class="comment">//</span>
00314 
00315     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part11\n"</span>);
00316     rc = NtCloseKey(Handle1);
00317 
00318     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00319         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"11:CloseKey failed rc  = %08lx"</span>, rc);
00320         <span class="keywordflow">return</span>;
00321     }
00322 
00323     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Part12\n"</span>);
00324     rc = NtCloseKey(Handle2);
00325     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(rc)) {
00326         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"12:CloseKey failed rc  = %08lx"</span>, rc);
00327         <span class="keywordflow">return</span>;
00328     }
00329 
00330     <span class="keywordflow">return</span>;
00331 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="regtest.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/editreg_8c-source.html#l02460">2460</a> of file <a class="el" href="../../d3/d4/editreg_8c-source.html">editreg.c</a>.
<p>
References <a class="el" href="../../d3/d4/editreg_8c-source.html#l01771">ChangeMemberState()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00157">CHDIR</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00269">CommandHelp</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00226">CommandMap</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00184">Commands</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00155">CREATE</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l02210">CreateFtMember()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00308">CurrentDirectory</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00160">DDEBUG</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00338">Debug</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00122">DEFAULT_TYPE</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00162">DELKEY</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00163">DELVALUE</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00154">DIR</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00903">Directory()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00164">DIRLONG</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l01597">DiskDump()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00169">DISKREG</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00172">DRIVERS</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00168">DUMP</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00354">DumpControl</a>, <a class="el" href="../../d0/d1/fedefs_8h-source.html#l00051">exit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l01990">FixDisk()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00170">FIXDISK</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00352">ForceDump</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00453">FtCreateKey()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00411">FtDeleteKey()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00557">FtDeleteValue()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00357">FtOpenKey()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00602">FtSetValue()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00110">FUDGE</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l01120">GetArgumentString()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l01355">GetCommand()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l02163">GetDiskInfo()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00158">HELP</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00167">INBYTE</a>, <a class="el" href="../../d2/d5/editreg_8c.html#a88a56">InBytes</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00175">INIT</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00165">INLONG</a>, <a class="el" href="../../d2/d5/editreg_8c.html#a88a58">InLongs</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00166">INSHORT</a>, <a class="el" href="../../d2/d5/editreg_8c.html#a88a57">InShorts</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00153">INVALID</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00966">List()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00156">LIST</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00176">MAKEFT</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l01523">NotImplemented()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00173">ORPHAN</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l01924">OrphanMember()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l01233">ParseArgumentNumeric()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00159">QUIT</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00174">REGEN</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l01957">RegenerateMember()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00116">REGISTRY_BASE</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00171">RESTORE</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l01891">RestoreOrphan()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00161">SETVALUE</a>, <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00076">type</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00046">TypeNames</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00060">TypeNumbers</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00332">Version</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d3/d4/editreg_8c-source.html#l00302">WorkingDirectory</a>.
<p>
<pre class="fragment"><div>02464                    :
02465 
02466     The <a class="code" href="../../d3/d9/arcinst_8c.html#a19">main</a> entry point <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user process.
02467     This process will prompt <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> action desired.  This
02468     includes starting performance, stopping performance, and retreiving
02469     performance data collected by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> FT driver.
02470 
02471 Arguments:
02472 
02473     Command line:
02474         No options.
02475 
02476 Return Value:
02477 
02478     NONE
02479 
02480 --*/
02481 
02482 {
02483     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
02484     BOOLEAN  batch;
02485     PUCHAR   argumentString;
02486     <span class="keywordtype">int</span>      commandCode;
02487     HANDLE   keyHandle;
02488 
02489 
02490     status = <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;keyHandle, REGISTRY_BASE);
02491 
02492     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02493 
02494         printf(<span class="stringliteral">"readreg: Unable to open registry base (0x%x)\n"</span>, status);
02495         <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(1);
02496     }
02497 
02498     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(CurrentDirectory,
02499             REGISTRY_BASE);
02500 
02501     <span class="comment">//</span>
02502     <span class="comment">// See if we are connected to CON</span>
02503     <span class="comment">//</span>
02504 
02505     batch = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02506 <span class="comment">//  batch = (BOOLEAN)(!isatty(0));</span>
02507 
02508     <span class="keywordflow">if</span> (!batch) {
02509         printf(<span class="stringliteral">"FT registry edit utility.  %s:\n"</span>, Version);
02510     }
02511 
02512     <span class="keywordflow">while</span>(1) {
02513         <span class="keywordflow">while</span> ((commandCode = <a class="code" href="../../d2/d5/editreg_8c.html#a74">GetCommand</a>(batch,
02514                                          &amp;argumentString)) == <a class="code" href="../../d2/d5/editreg_8c.html#a8">INVALID</a>) {
02515 
02516             <span class="comment">//</span>
02517             <span class="comment">// Continue until we get a valid command.</span>
02518             <span class="comment">//</span>
02519 
02520         }
02521 
02522         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>) {
02523             printf(<span class="stringliteral">"Command code == %d, argumentString = %s\n"</span>,
02524                    commandCode,
02525                    (argumentString == NULL) ? <span class="stringliteral">"(none)"</span> : argumentString);
02526         }
02527 
02528         <span class="keywordflow">switch</span> (commandCode) {
02529 
02530         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a19">DIRLONG</a>:
02531 
02532             <a class="code" href="../../d2/d5/editreg_8c.html#a68">Directory</a>(keyHandle, (BOOLEAN) TRUE);
02533             <span class="keywordflow">break</span>;
02534 
02535         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a9">DIR</a>:
02536 
02537             <a class="code" href="../../d2/d5/editreg_8c.html#a68">Directory</a>(keyHandle, (BOOLEAN) FALSE);
02538             <span class="keywordflow">break</span>;
02539 
02540         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a10">CREATE</a>:
02541         {
02542             ULONG   index;
02543             PUCHAR  keyClass;
02544             BOOLEAN classAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02545 
02546             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02547                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02548                                                    <span class="stringliteral">"Key Name = "</span>, 
02549                                                    (BOOLEAN) FALSE);
02550             }
02551 
02552             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02553                 <span class="keywordflow">break</span>;
02554             }
02555 
02556             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(WorkingDirectory,
02557                     <span class="stringliteral">"%s\\%s"</span>,
02558                     CurrentDirectory,
02559                     argumentString);
02560 
02561             argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02562                                                <span class="stringliteral">"Key Class = "</span>,
02563                                                (BOOLEAN) FALSE);
02564 
02565             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02566                 keyClass = <span class="stringliteral">"Default Class"</span>;
02567             } <span class="keywordflow">else</span> {
02568                 keyClass = (PUCHAR) malloc(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(argumentString) + FUDGE);
02569                 classAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02570 
02571                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(keyClass,
02572                         <span class="stringliteral">"%s"</span>,
02573                         argumentString);
02574             }
02575 
02576             argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02577                                                <span class="stringliteral">"Index = "</span>,
02578                                                (BOOLEAN) TRUE);
02579 
02580             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02581                 index = 1;
02582             } <span class="keywordflow">else</span> {
02583                 index = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
02584             }
02585 
02586             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>) {
02587                 printf(<span class="stringliteral">"Creating key %s, index %d with class %s\n"</span>,
02588                        WorkingDirectory,
02589                        index,
02590                        keyClass);
02591             }
02592 
02593             status = <a class="code" href="../../d2/d5/editreg_8c.html#a61">FtCreateKey</a>(WorkingDirectory,
02594                                  keyClass,
02595                                  index);
02596 
02597             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02598 
02599                 printf(<span class="stringliteral">"Could not create key %s (0x%x).\n"</span>,
02600                        WorkingDirectory,
02601                        status);
02602             }
02603 
02604             <span class="keywordflow">if</span> (classAllocated == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02605                 free(keyClass);
02606             }
02607 
02608             <span class="keywordflow">break</span>;
02609         }
02610 
02611         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a11">LIST</a>:
02612 
02613             <a class="code" href="../../d2/d5/editreg_8c.html#a69">List</a>(keyHandle,
02614                  argumentString);
02615             <span class="keywordflow">break</span>;
02616 
02617         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a12">CHDIR</a>:
02618 
02619             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(keyHandle);
02620 
02621             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02622 
02623                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02624                                                    <span class="stringliteral">"New location = "</span>,
02625                                                    (BOOLEAN) TRUE);
02626             }
02627 
02628             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02629 
02630                 <span class="keywordflow">if</span> (*argumentString == <span class="charliteral">'\\'</span>) {
02631 
02632                     <span class="comment">//</span>
02633                     <span class="comment">// Root relative string.</span>
02634                     <span class="comment">// Use text provided (i.e. %s is to avoid user crashing</span>
02635                     <span class="comment">// by putting %s in the string).</span>
02636                     <span class="comment">//</span>
02637 
02638                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(WorkingDirectory,
02639                             <span class="stringliteral">"%s"</span>,
02640                             argumentString);
02641 
02642                 } <span class="keywordflow">else</span> {
02643 
02644                     <span class="keywordflow">while</span> ((*argumentString == <span class="charliteral">'.'</span>) &amp;&amp;
02645                            (*(argumentString + 1) == <span class="charliteral">'.'</span>)) {
02646 
02647                         <span class="keywordflow">if</span> ((*(argumentString + 2) == <span class="charliteral">'\\'</span>) ||
02648                             (*(argumentString + 2) == <span class="charliteral">'\0'</span>)) {
02649 
02650                             PUCHAR cptr = <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>;
02651 
02652                             <span class="comment">//</span>
02653                             <span class="comment">// move argumentString past ".."</span>
02654                             <span class="comment">//</span>
02655 
02656                             argumentString += 2;
02657 
02658                             <span class="comment">//</span>
02659                             <span class="comment">// Find end of current directory.</span>
02660                             <span class="comment">//</span>
02661 
02662                             <span class="keywordflow">while</span> (*cptr != <span class="charliteral">'\0'</span>) {
02663                                 cptr++;
02664                             }
02665 
02666                             <span class="comment">//</span>
02667                             <span class="comment">// Backup to last component.</span>
02668                             <span class="comment">//</span>
02669 
02670                             <span class="keywordflow">while</span> (*cptr != <span class="charliteral">'\\'</span>) {
02671                                 cptr--;
02672                             }
02673 
02674                             <span class="keywordflow">if</span> (cptr == <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>) {
02675 
02676                                 <span class="comment">//</span>
02677                                 <span class="comment">// Cannot backup anymore.  Continue parsing</span>
02678                                 <span class="comment">// argument.</span>
02679                                 <span class="comment">//</span>
02680 
02681                                 <span class="keywordflow">continue</span>;
02682                             }
02683 
02684                             <span class="comment">//</span>
02685                             <span class="comment">// Remove component from path.</span>
02686                             <span class="comment">//</span>
02687 
02688                             *cptr = <span class="charliteral">'\0'</span>;
02689 
02690                             <span class="keywordflow">if</span> (*argumentString == <span class="charliteral">'\0'</span>) {
02691 
02692                                 <span class="comment">//</span>
02693                                 <span class="comment">// All done with argument.</span>
02694                                 <span class="comment">//</span>
02695 
02696                                 <span class="keywordflow">break</span>;
02697                             }
02698 
02699                             <span class="comment">//</span>
02700                             <span class="comment">// Step around backslash.</span>
02701                             <span class="comment">//</span>
02702 
02703                             argumentString++;
02704 
02705                         } <span class="keywordflow">else</span> {
02706 
02707                             <span class="comment">//</span>
02708                             <span class="comment">// Assume it is a real name.</span>
02709                             <span class="comment">//</span>
02710 
02711                             <span class="keywordflow">break</span>;
02712                         }
02713                     }
02714 
02715                     <span class="keywordflow">if</span> (*argumentString != <span class="charliteral">'\0'</span>) {
02716                         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(WorkingDirectory,
02717                                 <span class="stringliteral">"%s\\%s"</span>,
02718                                 CurrentDirectory,
02719                                 argumentString);
02720                     } <span class="keywordflow">else</span> {
02721                         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(WorkingDirectory,
02722                                 <span class="stringliteral">"%s"</span>,
02723                                 CurrentDirectory);
02724                     }
02725                 }
02726 
02727                 status = <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;keyHandle,
02728                                    WorkingDirectory);
02729 
02730                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02731 
02732                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(CurrentDirectory,
02733                             <span class="stringliteral">"%s"</span>,
02734                             WorkingDirectory);
02735                 } <span class="keywordflow">else</span> {
02736 
02737                     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;keyHandle,
02738                                      CurrentDirectory);
02739 
02740                     <span class="comment">//</span>
02741                     <span class="comment">// No error checks because this was opened once before.</span>
02742                     <span class="comment">//</span>
02743                 }
02744 
02745             }
02746 
02747             <span class="keywordflow">break</span>;
02748 
02749         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a13">HELP</a>:
02750         {
02751             <span class="keywordtype">int</span> i;
02752 
02753             printf(<span class="stringliteral">"Valid commands are:\n"</span>);
02754 
02755             <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d2/d5/editreg_8c.html#a43">Commands</a>[i] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; i++) {
02756                 printf(<span class="stringliteral">"  %10s  - %s\n"</span>,
02757                        Commands[i],
02758                        CommandHelp[CommandMap[i]]);
02759             }
02760             <span class="keywordflow">break</span>;
02761         }
02762 
02763         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a14">QUIT</a>:
02764 
02765             <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(0);
02766             <span class="keywordflow">break</span>;
02767 
02768         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a15">DDEBUG</a>:
02769 
02770             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02771 
02772                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>) {
02773 
02774                     printf(<span class="stringliteral">"Debug turned off.\n"</span>);
02775                     <a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> = 0;
02776                 } <span class="keywordflow">else</span> {
02777 
02778                     <a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> = 1;
02779                 }
02780             } <span class="keywordflow">else</span> {
02781 
02782                 <a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> = atoi(argumentString);
02783                 printf(<span class="stringliteral">"Debug set to %d\n"</span>, Debug);
02784             }
02785             <span class="keywordflow">break</span>;
02786 
02787         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a16">SETVALUE</a>:
02788         {
02789             <span class="keywordtype">int</span>    i;
02790             BOOLEAN convertToUnicode = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02791             PUCHAR valueName;
02792             PUCHAR valueData;
02793             ULONG  valueLength;
02794             ULONG  valueWord;
02795             PVOID  valuePtr;
02796             ULONG  <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a3">DEFAULT_TYPE</a>;
02797             STRING         valueString;
02798             UNICODE_STRING unicodeValue;
02799             BOOLEAN dataAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02800             BOOLEAN unicodeAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02801 
02802             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02803 
02804                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02805                                                    <span class="stringliteral">"Value Name = "</span>,
02806                                                    (BOOLEAN) FALSE);
02807             }
02808 
02809             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02810 
02811                 <span class="keywordflow">break</span>;
02812             }
02813 
02814             valueName = (PUCHAR) malloc(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(argumentString) + FUDGE);
02815 
02816             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(valueName,
02817                     <span class="stringliteral">"%s"</span>,
02818                     argumentString);
02819 
02820             <span class="comment">//</span>
02821             <span class="comment">// print a help banner on type and get the type.</span>
02822             <span class="comment">//</span>
02823 
02824             <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d2/d5/editreg_8c.html#a39">TypeNames</a>[i] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; i++) {
02825 
02826                 printf(<span class="stringliteral">"%d - %s\n"</span>, TypeNumbers[i], TypeNames[i]);
02827             }
02828             printf(<span class="stringliteral">"# - Other numbers are user defined\n"</span>);
02829             argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02830                                                <span class="stringliteral">"Numeric value for type = "</span>,
02831                                                (BOOLEAN) TRUE);
02832 
02833             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02834                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
02835             }
02836 
02837             <span class="keywordflow">switch</span>(<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>)
02838             {
02839             <span class="keywordflow">default</span>:
02840             <span class="keywordflow">case</span> REG_SZ:
02841                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> == REG_SZ) {
02842                     convertToUnicode = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02843                     printf(<span class="stringliteral">"Typed in string will be converted to unicode...\n"</span>);
02844                     argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02845                                                        <span class="stringliteral">"Value Data = "</span>,
02846                                                        (BOOLEAN) FALSE);
02847                 } <span class="keywordflow">else</span> {
02848                     printf(<span class="stringliteral">"For now the data must be typed in...\n"</span>);
02849                     argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02850                                                        <span class="stringliteral">"Value Data = "</span>,
02851                                                        (BOOLEAN) FALSE);
02852                 }
02853 
02854                 <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02855                     valueData = <span class="stringliteral">"Default Data"</span>;
02856                     valueLength = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(valueData);
02857                 } <span class="keywordflow">else</span> {
02858                     valueData = (PUCHAR) malloc(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(argumentString) + FUDGE);
02859                     dataAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02860                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(valueData,
02861                             <span class="stringliteral">"%s"</span>,
02862                             argumentString);
02863                     <span class="keywordflow">if</span> (convertToUnicode == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02864                         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(&amp;valueString,
02865                                       valueData);
02866                         <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeValue,
02867                                                      &amp;valueString,
02868                                                      (BOOLEAN) TRUE);
02869                         unicodeAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02870                         valueLength = unicodeValue.Length + 2;
02871                     } <span class="keywordflow">else</span> {
02872                         valueLength = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(valueData);
02873                     }
02874                 }
02875 
02876                 <span class="keywordflow">break</span>;
02877 
02878             <span class="keywordflow">case</span> REG_DWORD:
02879                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02880                                                    <span class="stringliteral">"Value Data Word = "</span>,
02881                                                    (BOOLEAN) TRUE);
02882                 <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02883                     valueWord = 0;
02884                 } <span class="keywordflow">else</span> {
02885                     valueWord = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
02886                 }
02887 
02888                 valueLength = <span class="keyword">sizeof</span>(ULONG);
02889                 <span class="keywordflow">break</span>;
02890             }
02891 
02892             <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>) {
02893 
02894             <span class="keywordflow">case</span> REG_DWORD:
02895                 valuePtr = (PVOID) &amp;valueWord;
02896                 <span class="keywordflow">break</span>;
02897 
02898             <span class="keywordflow">case</span> REG_SZ:
02899                 valuePtr = (PVOID) unicodeValue.Buffer;
02900                 <span class="keywordflow">break</span>;
02901 
02902             <span class="keywordflow">default</span>:
02903                 valuePtr = (PVOID) valueData;
02904                 <span class="keywordflow">break</span>;
02905             }
02906             status = <a class="code" href="../../d2/d5/editreg_8c.html#a63">FtSetValue</a>(keyHandle,
02907                                 valueName,
02908                                 valuePtr,
02909                                 valueLength,
02910                                 type);
02911 
02912             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02913                 printf(<span class="stringliteral">"Could not set value %s (0x%x).\n"</span>, valueName, status);
02914             }
02915 
02916             free(valueName);
02917             <span class="keywordflow">if</span> (dataAllocated == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02918                 free(valueData);
02919             }
02920             <span class="keywordflow">if</span> (unicodeAllocated == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02921                 <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeValue);
02922             }
02923             <span class="keywordflow">break</span>;
02924         }
02925 
02926         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a17">DELKEY</a>:
02927         {
02928             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02929 
02930                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02931                                                    <span class="stringliteral">"Key Name = "</span>,
02932                                                    (BOOLEAN) TRUE);
02933             }
02934 
02935             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02936 
02937                 <span class="keywordflow">break</span>;
02938             }
02939 
02940             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(WorkingDirectory,
02941                     <span class="stringliteral">"%s\\%s"</span>,
02942                     CurrentDirectory,
02943                     argumentString);
02944 
02945             status = <a class="code" href="../../d2/d5/editreg_8c.html#a60">FtDeleteKey</a>(WorkingDirectory);
02946 
02947             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02948                 printf(<span class="stringliteral">"Unable to delete key %s (0x%x)\n"</span>,
02949                        WorkingDirectory,
02950                        status);
02951             }
02952 
02953             <span class="keywordflow">break</span>;
02954         }
02955 
02956         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a18">DELVALUE</a>:
02957         {
02958             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02959 
02960                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02961                                                    <span class="stringliteral">"Key Name = "</span>,
02962                                                    (BOOLEAN) TRUE);
02963             }
02964 
02965             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02966 
02967                 <span class="keywordflow">break</span>;
02968             }
02969 
02970             status = <a class="code" href="../../d2/d5/editreg_8c.html#a62">FtDeleteValue</a>(keyHandle,
02971                                    argumentString);
02972 
02973             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02974 
02975                 printf(<span class="stringliteral">"Unable to delete value %s (0x%x)\n"</span>,
02976                        argumentString,
02977                        status);
02978             }
02979             <span class="keywordflow">break</span>;
02980         }
02981 
02982         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a20">INLONG</a>:
02983             <a class="code" href="../../d2/d5/editreg_8c.html#a55">DumpControl</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a88a58">InLongs</a>;
02984             <span class="keywordflow">break</span>;
02985 
02986         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a21">INSHORT</a>:
02987             <a class="code" href="../../d2/d5/editreg_8c.html#a55">DumpControl</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a88a57">InShorts</a>;
02988             <span class="keywordflow">break</span>;
02989 
02990         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a22">INBYTE</a>:
02991             <a class="code" href="../../d2/d5/editreg_8c.html#a55">DumpControl</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a88a56">InBytes</a>;
02992             <span class="keywordflow">break</span>;
02993 
02994         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a23">DUMP</a>:
02995 
02996             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a54">ForceDump</a>) {
02997                 <a class="code" href="../../d2/d5/editreg_8c.html#a54">ForceDump</a> = 0;
02998             } <span class="keywordflow">else</span> {
02999                 <a class="code" href="../../d2/d5/editreg_8c.html#a54">ForceDump</a>++;
03000             }
03001             <span class="keywordflow">break</span>;
03002 
03003         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a24">DISKREG</a>:
03004             <a class="code" href="../../d2/d5/editreg_8c.html#a77">DiskDump</a>();
03005             <span class="keywordflow">break</span>;
03006 
03007         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a25">FIXDISK</a>:
03008             <a class="code" href="../../d2/d5/editreg_8c.html#a82">FixDisk</a>();
03009             <span class="keywordflow">break</span>;
03010 
03011         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a26">RESTORE</a>:
03012         {
03013             ULONG <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
03014             ULONG group;
03015             ULONG member;
03016 
03017             printf(<span class="stringliteral">"FT types that can be restored are:\n"</span>);
03018             printf(<span class="stringliteral">"\t%d - for Mirrors\n"</span>, Mirror);
03019             printf(<span class="stringliteral">"\t%d - for Stripes with parity\n"</span>, StripeWithParity);
03020 
03021             <span class="comment">//</span>
03022             <span class="comment">// Get the type</span>
03023             <span class="comment">//</span>
03024 
03025             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03026                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03027                                                    <span class="stringliteral">"FT volume type = "</span>,
03028                                                    (BOOLEAN) TRUE);
03029             }
03030             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03031                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03032             } <span class="keywordflow">else</span> {
03033                 <span class="keywordflow">break</span>;
03034             }
03035 
03036             <span class="comment">//</span>
03037             <span class="comment">// Get the group</span>
03038             <span class="comment">//</span>
03039 
03040             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03041                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03042                                                    <span class="stringliteral">"FT group number = "</span>,
03043                                                    (BOOLEAN) TRUE);
03044             }
03045             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03046                 group = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03047             } <span class="keywordflow">else</span> {
03048                 <span class="keywordflow">break</span>;
03049             }
03050 
03051             <span class="comment">//</span>
03052             <span class="comment">// Get the member</span>
03053             <span class="comment">//</span>
03054 
03055             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03056                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03057                                                    <span class="stringliteral">"FT member number = "</span>,
03058                                                    (BOOLEAN) TRUE);
03059             }
03060             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03061                 member = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03062             } <span class="keywordflow">else</span> {
03063                 <span class="keywordflow">break</span>;
03064             }
03065 
03066             <a class="code" href="../../d2/d5/editreg_8c.html#a79">RestoreOrphan</a>(type, group, member);
03067             <span class="keywordflow">break</span>;
03068         }
03069 
03070         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a27">DRIVERS</a>:
03071             <a class="code" href="../../d2/d5/editreg_8c.html#a75">NotImplemented</a>();
03072             <span class="comment">// ListDrivers();</span>
03073             <span class="keywordflow">break</span>;
03074 
03075         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a28">ORPHAN</a>:
03076         {
03077             ULONG <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
03078             ULONG group;
03079             ULONG member;
03080 
03081             printf(<span class="stringliteral">"FT types that can be orphaned are:\n"</span>);
03082             printf(<span class="stringliteral">"\t%d - for Mirrors\n"</span>, Mirror);
03083             printf(<span class="stringliteral">"\t%d - for Stripes with parity\n"</span>, StripeWithParity);
03084 
03085             <span class="comment">//</span>
03086             <span class="comment">// Get the type</span>
03087             <span class="comment">//</span>
03088 
03089             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03090                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03091                                                    <span class="stringliteral">"FT volume type = "</span>,
03092                                                    (BOOLEAN) TRUE);
03093             }
03094             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03095                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03096             } <span class="keywordflow">else</span> {
03097                 <span class="keywordflow">break</span>;
03098             }
03099 
03100             <span class="comment">//</span>
03101             <span class="comment">// Get the group</span>
03102             <span class="comment">//</span>
03103 
03104             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03105                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03106                                                    <span class="stringliteral">"FT group number = "</span>,
03107                                                    (BOOLEAN) TRUE);
03108             }
03109             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03110                 group = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03111             } <span class="keywordflow">else</span> {
03112                 <span class="keywordflow">break</span>;
03113             }
03114 
03115             <span class="comment">//</span>
03116             <span class="comment">// Get the member</span>
03117             <span class="comment">//</span>
03118 
03119             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03120                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03121                                                    <span class="stringliteral">"FT member number = "</span>,
03122                                                    (BOOLEAN) TRUE);
03123             }
03124             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03125                 member = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03126             } <span class="keywordflow">else</span> {
03127                 <span class="keywordflow">break</span>;
03128             }
03129 
03130             <a class="code" href="../../d2/d5/editreg_8c.html#a80">OrphanMember</a>(type, group, member);
03131             <span class="keywordflow">break</span>;
03132         }
03133 
03134         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a29">REGEN</a>:
03135         {
03136             ULONG <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
03137             ULONG group;
03138             ULONG member;
03139 
03140             printf(<span class="stringliteral">"FT types that can be regenerated are:\n"</span>);
03141             printf(<span class="stringliteral">"\t%d - for Mirrors\n"</span>, Mirror);
03142             printf(<span class="stringliteral">"\t%d - for Stripes with parity\n"</span>, StripeWithParity);
03143 
03144             <span class="comment">//</span>
03145             <span class="comment">// Get the type</span>
03146             <span class="comment">//</span>
03147 
03148             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03149                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03150                                                    <span class="stringliteral">"FT volume type = "</span>,
03151                                                    (BOOLEAN) TRUE);
03152             }
03153             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03154                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03155             } <span class="keywordflow">else</span> {
03156                 <span class="keywordflow">break</span>;
03157             }
03158 
03159             <span class="comment">//</span>
03160             <span class="comment">// Get the group</span>
03161             <span class="comment">//</span>
03162 
03163             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03164                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03165                                                    <span class="stringliteral">"FT group number = "</span>,
03166                                                    (BOOLEAN) TRUE);
03167             }
03168             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03169                 group = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03170             } <span class="keywordflow">else</span> {
03171                 <span class="keywordflow">break</span>;
03172             }
03173 
03174             <span class="comment">//</span>
03175             <span class="comment">// Get the member</span>
03176             <span class="comment">//</span>
03177 
03178             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03179                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03180                                                    <span class="stringliteral">"FT member number = "</span>,
03181                                                    (BOOLEAN) TRUE);
03182             }
03183             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03184                 member = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03185             } <span class="keywordflow">else</span> {
03186                 <span class="keywordflow">break</span>;
03187             }
03188 
03189             <a class="code" href="../../d2/d5/editreg_8c.html#a81">RegenerateMember</a>(type, group, member);
03190             <span class="keywordflow">break</span>;
03191         }
03192 
03193         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a30">INIT</a>:
03194         {
03195             ULONG <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
03196             ULONG group;
03197             ULONG member;
03198 
03199             printf(<span class="stringliteral">"Only stripes with parity are initialized.\n"</span>);
03200 
03201             <span class="comment">//</span>
03202             <span class="comment">// Get the group</span>
03203             <span class="comment">//</span>
03204 
03205             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03206                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03207                                                <span class="stringliteral">"Parity stripe group number = "</span>,
03208                                                (BOOLEAN) TRUE);
03209             }
03210             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03211                 group = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03212             } <span class="keywordflow">else</span> {
03213                 <span class="keywordflow">break</span>;
03214             }
03215 
03216             <a class="code" href="../../d2/d5/editreg_8c.html#a78">ChangeMemberState</a>(StripeWithParity,
03217                               group,
03218                               0,
03219                               Initializing);
03220             <span class="keywordflow">break</span>;
03221         }
03222 
03223         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a31">MAKEFT</a>:
03224         {
03225             ULONG <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
03226             ULONG group;
03227             ULONG member;
03228             ULONG disk;
03229             ULONG partition;
03230             PDISK_CONFIG_HEADER configHeader;
03231             BOOLEAN doUpdate = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03232 
03233             configHeader = <a class="code" href="../../d2/d5/editreg_8c.html#a83">GetDiskInfo</a>();
03234             <span class="keywordflow">if</span> (configHeader == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03235                 <span class="keywordflow">break</span>;
03236             }
03237             printf(<span class="stringliteral">"\t%d for Mirrors\n"</span>, Mirror);
03238             printf(<span class="stringliteral">"\t%d for Stripe Set\n"</span>, Stripe);
03239             printf(<span class="stringliteral">"\t%d for Stripe with parity\n"</span>, StripeWithParity);
03240             printf(<span class="stringliteral">"\t%d for Volume Set\n"</span>, VolumeSet);
03241 
03242             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03243                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03244                                                    <span class="stringliteral">"Which FT set to create? "</span>,
03245                                                    (BOOLEAN) TRUE);
03246             }
03247             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03248                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03249             } <span class="keywordflow">else</span> {
03250                 <span class="keywordflow">break</span>;
03251             }
03252 
03253             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03254                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03255                                                    <span class="stringliteral">"Please give an FT group # - "</span>,
03256                                                    (BOOLEAN) TRUE);
03257             }
03258             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03259                 group = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03260             } <span class="keywordflow">else</span> {
03261                 <span class="keywordflow">break</span>;
03262             }
03263 
03264             <span class="keywordflow">for</span> (member = 0; <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; member++) {
03265                 printf(<span class="stringliteral">"Information for member %d\n"</span>, member);
03266 
03267                 <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03268                     argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03269                                                        <span class="stringliteral">"Disk Number = "</span>,
03270                                                        (BOOLEAN) TRUE);
03271                 }
03272 
03273                 <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03274                     disk = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03275                 } <span class="keywordflow">else</span> {
03276                     <span class="keywordflow">break</span>;
03277                 }
03278 
03279                 <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03280                     argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03281                                                        <span class="stringliteral">"Partition Number = "</span>,
03282                                                        (BOOLEAN) TRUE);
03283                 }
03284 
03285                 <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03286                     partition = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03287                 } <span class="keywordflow">else</span> {
03288                     <span class="keywordflow">break</span>;
03289                 }
03290 
03291                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a84">CreateFtMember</a>(configHeader, disk, partition, type, group, member) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
03292                     printf(<span class="stringliteral">"Failed to change member state\n"</span>);
03293                     printf(<span class="stringliteral">"No update will be made\n"</span>);
03294                     doUpdate = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03295                     <span class="keywordflow">break</span>;
03296                 }
03297             }
03298             <span class="keywordflow">if</span> (doUpdate == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
03299                 PDISK_REGISTRY diskRegistry;
03300                 diskRegistry = (PDISK_REGISTRY)
03301                              ((PUCHAR) configHeader + configHeader-&gt;DiskInformationOffset);
03302                 DiskRegistrySet(diskRegistry);
03303             }
03304             free(configHeader);
03305             <span class="keywordflow">break</span>;
03306         }
03307 
03308         <span class="keywordflow">default</span>:
03309 
03310             printf(<span class="stringliteral">"WDF homer?!?\n"</span>);
03311             <span class="keywordflow">break</span>;
03312         }
03313     }
03314 } <span class="comment">// main</span>
} <span class="comment">// main</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="regtest.c::strlen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int strlen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUCHAR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d6/almisc_8c-source.html#l00684">AlAddMenuItem()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l00424">AlAddSystemPartition()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l01150">AlCombinePaths()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l01113">AlStrDup()</a>, <a class="el" href="../../d6/d6/strings_8c-source.html#l00046">CharLowerA()</a>, <a class="el" href="../../d6/d6/strings_8c-source.html#l00119">CharUpperA()</a>, <a class="el" href="../../d8/d6/uclient_8c-source.html#l00033">ClientThread()</a>, <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html#l05032">CMConvNameToIndex()</a>, <a class="el" href="../../d1/d9/cmboot_8c-source.html#l01082">CmpFindControlSet()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02025">CmpFindPattern()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00987">CmpGetAddRegInfData()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01703">CmpGetInfData()</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00465">CmpInitializeMachineDependentConfiguration()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01623">CmpMatchAcpiCreatorIdRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01288">CmpMatchAcpiOemTableIdRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00957">CmpMatchOemIdRule()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l00853">CmpMatchPointerRule()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l01264">CmpOpenRegKey()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00744">CmpParseInfBuffer()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01369">CmpProcessForSimpleStringSub()</a>, <a class="el" href="../../d4/d9/w32_2ntcon_2fullscr_2vga_2misc_8c-source.html#l00031">ConvertOutputToOem()</a>, <a class="el" href="../../d1/d4/rtl_2debug_8c-source.html#l00241">DbgPrompt()</a>, <a class="el" href="../../d3/d6/regtest_8c-source.html#l00045">DoTest()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02059">ECInsertText()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00570">EnterNew()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00749">EnumRegisterWordProcA()</a>, <a class="el" href="../../d5/d4/logger_8c-source.html#l00062">ExCreateDebugLogTag()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03060">ExpGetProcessInformation()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00064">ExpSystemErrorHandler()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00669">FileOpenHookProc()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00208">FixupDdeExecuteIfNecessary()</a>, <a class="el" href="../../d2/d5/fmtexp_8c-source.html#l00724">FmtQueryFatPartitionList()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l00094">GetExeName()</a>, <a class="el" href="../../d2/d9/client_2help_8c-source.html#l00060">HFill()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00575">ImmConfigureIMEA()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00539">ImmEnumRegisterWordA()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00849">ImmEscapeA()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00999">ImmEscapeW()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l01841">ImmGetConversionListA()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00469">ImmGetRegisterWordStyleW()</a>, <a class="el" href="../../d5/d0/layout_8c-source.html#l00407">ImmInstallIMEA()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00025">ImmRegisterWordA()</a>, <a class="el" href="../../d7/d6/regword_8c-source.html#l00211">ImmUnregisterWordA()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01618">InnerGrayStringAorW()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l02619">InternalGetCompositionStringW()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l01047">IopCreateArcNames()</a>, <a class="el" href="../../d2/d4/ioassert_8c-source.html#l01016">IopDriverCorrectnessPrintBuffer()</a>, <a class="el" href="../../d2/d4/ioassert_8c-source.html#l00842">IopDriverCorrectnessProcessMessageText()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08928">IopInitializeBootLogging()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l03612">IopReassignSystemRoot()</a>, <a class="el" href="../../d5/d5/netboot_8c-source.html#l01982">IopSetupRemoteBootCard()</a>, <a class="el" href="../../d6/d1/fekbdcom_8c-source.html#l00199">KbdLayerRealDllFileForWBT()</a>, <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00036">KdInitSystem()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00097">KeGetBugMessageText()</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l03113">LFontAtoLFontW()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00486">LowQueryPathFromComponent()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l02460">main()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00282">MainWndProc()</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00367">MakeInstSpecificAtom()</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00191">MBToWCSEx()</a>, <a class="el" href="../../d6/d5/memprint_8c-source.html#l00250">MemPrint()</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l01554">MESSAGECALL()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l04464">MiSnapThunk()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l02720">MLPasteText()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01309">MLReplaceSel()</a>, <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00222">MLSetHandle()</a>, <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html#l00046">MyNewDeviceLink()</a>, <a class="el" href="../../d3/d1/oemxlate_8c-source.html#l00217">OemToCharW()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l01418">PrintFile()</a>, <a class="el" href="../../d3/d6/class_8c-source.html#l01645">ReferenceClass()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00613">RtlAppendAsciizToString()</a>, <a class="el" href="../../d2/d1/rtlinit_8c-source.html#l00030">RtlCaptureAnsiString()</a>, <a class="el" href="../../d2/d1/rtlinit_8c-source.html#l00095">RtlCaptureLargeAnsiString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00102">RtlInitAnsiString()</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00608">RtlInitLargeAnsiString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00632">RtlInt64ToUnicodeString()</a>, <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00433">RtlIntegerToUnicodeString()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l01725">SearchFile()</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l01330">SepTransceivePipe()</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l01293">SepWritePipe()</a>, <a class="el" href="../../d9/d0/userver_8c-source.html#l00037">ServerHandleConnectionRequest()</a>, <a class="el" href="../../d9/d0/userver_8c-source.html#l00173">ServerThread()</a>, <a class="el" href="../../d3/d0/client_2cmdline_8c-source.html#l01220">SetConsoleTitleA()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01157">SLPasteText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01225">SLReplaceSel()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00449">StringLength()</a>, <a class="el" href="../../d2/d9/client_2help_8c-source.html#l01116">WinHelpW()</a>, <a class="el" href="../../d0/d1/usrbench_8c-source.html#l00268">WndProc()</a>, <a class="el" href="../../d7/d9/wsprintf_8c-source.html#l00168">wvsprintfA()</a>, <a class="el" href="../../d7/d9/wsprintf_8c-source.html#l00638">wvsprintfW()</a>, and <a class="el" href="../../d8/d1/drivesup_8c-source.html#l01243">xHalIoAssignDriveLetters()</a>.    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a1" doxytag="regtest.c::ValueBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d2/d7/regtest_8c.html#a1">ValueBuffer</a>[MAX_VALUE]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d6/regtest_8c-source.html#l00034">34</a> of file <a class="el" href="../../d3/d6/regtest_8c-source.html">regtest.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:28 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
