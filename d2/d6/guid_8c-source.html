<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: guid.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>guid.c</h1><a href="../../d1/d7/guid_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1996  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    guid.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This Module implements the guid manipulation functions.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    George Shaw (GShaw) 9-Oct-1996</span>
00016 <span class="comment"></span>
00017 <span class="comment">Environment:</span>
00018 <span class="comment"></span>
00019 <span class="comment">    Pure Runtime Library Routine</span>
00020 <span class="comment"></span>
00021 <span class="comment">Revision History:</span>
00022 <span class="comment"></span>
00023 <span class="comment">--*/</span>
00024 
00025 <span class="preprocessor">#include "nt.h"</span>
00026 <span class="preprocessor">#include "<a class="code" href="../../d5/d9/ntrtlp_8h.html">ntrtlp.h</a>"</span>
00027 
00028 <span class="preprocessor">#if defined(ALLOC_PRAGMA) &amp;&amp; defined(NTOS_KERNEL_RUNTIME)</span>
00029 <span class="preprocessor"></span><span class="keyword">static</span>
00030 <span class="keywordtype">int</span>
00031 __cdecl
00032 <a class="code" href="../../d1/d7/guid_8c.html#a3">ScanHexFormat</a>(
00033     IN <span class="keyword">const</span> WCHAR* Buffer,
00034     IN ULONG MaximumLength,
00035     IN <span class="keyword">const</span> WCHAR* Format,
00036     ...);
00037 
00038 <span class="preprocessor">#pragma alloc_text(PAGE, RtlStringFromGUID)</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, ScanHexFormat)</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, RtlGUIDFromString)</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#endif // ALLOC_PRAGMA &amp;&amp; NTOS_KERNEL_RUNTIME</span>
00042 <span class="preprocessor"></span>
<a name="l00043"></a><a class="code" href="../../d1/d7/guid_8c.html#a1">00043</a> <span class="keyword">extern</span> <span class="keyword">const</span> WCHAR <a class="code" href="../../d1/d7/guid_8c.html#a1">GuidFormat</a>[];
00044 
<a name="l00045"></a><a class="code" href="../../d1/d7/guid_8c.html#a0">00045</a> <span class="preprocessor">#define GUID_STRING_SIZE 38</span>
00046 <span class="preprocessor"></span>
00047 
00048 NTSYSAPI
00049 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00050 NTAPI
<a name="l00051"></a><a class="code" href="../../d1/d7/guid_8c.html#a2">00051</a> <a class="code" href="../../d1/d7/guid_8c.html#a2">RtlStringFromGUID</a>(
00052     IN REFGUID Guid,
00053     OUT PUNICODE_STRING GuidString
00054     )
00055 <span class="comment">/*++</span>
00056 <span class="comment"></span>
00057 <span class="comment">Routine Description:</span>
00058 <span class="comment"></span>
00059 <span class="comment">    Constructs the standard string version of a GUID, in the form:</span>
00060 <span class="comment">    "{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}".</span>
00061 <span class="comment"></span>
00062 <span class="comment">Arguments:</span>
00063 <span class="comment"></span>
00064 <span class="comment">    Guid -</span>
00065 <span class="comment">        Contains the GUID to translate.</span>
00066 <span class="comment"></span>
00067 <span class="comment">    GuidString -</span>
00068 <span class="comment">        Returns a string that represents the textual format of the GUID.</span>
00069 <span class="comment">        Caller must call RtlFreeUnicodeString to free the buffer when done with</span>
00070 <span class="comment">        it.</span>
00071 <span class="comment"></span>
00072 <span class="comment">Return Value:</span>
00073 <span class="comment"></span>
00074 <span class="comment">    NTSTATUS - Returns STATUS_SUCCESS if the user string was succesfully</span>
00075 <span class="comment">    initialized.</span>
00076 <span class="comment"></span>
00077 <span class="comment">--*/</span>
00078 {
00079     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
00080     GuidString-&gt;Length = <a class="code" href="../../d8/d0/pnpioapi_8c.html#a28">GUID_STRING_SIZE</a> * <span class="keyword">sizeof</span>(WCHAR);
00081     GuidString-&gt;MaximumLength = GuidString-&gt;Length + <span class="keyword">sizeof</span>(UNICODE_NULL);
00082     <span class="keywordflow">if</span> (!(GuidString-&gt;Buffer = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a49">RtlAllocateStringRoutine</a>(GuidString-&gt;MaximumLength))) {
00083         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00084     }
00085     swprintf(GuidString-&gt;Buffer, <a class="code" href="../../d1/d7/guid_8c.html#a1">GuidFormat</a>, Guid-&gt;Data1, Guid-&gt;Data2, Guid-&gt;Data3, Guid-&gt;Data4[0], Guid-&gt;Data4[1], Guid-&gt;Data4[2], Guid-&gt;Data4[3], Guid-&gt;Data4[4], Guid-&gt;Data4[5], Guid-&gt;Data4[6], Guid-&gt;Data4[7]);
00086     <span class="keywordflow">return</span> STATUS_SUCCESS;
00087 }
00088 
00089 
00090 <span class="keyword">static</span>
00091 <span class="keywordtype">int</span>
00092 __cdecl
<a name="l00093"></a><a class="code" href="../../d1/d7/guid_8c.html#a3">00093</a> <a class="code" href="../../d1/d7/guid_8c.html#a3">ScanHexFormat</a>(
00094     IN <span class="keyword">const</span> WCHAR* Buffer,
00095     IN ULONG MaximumLength,
00096     IN <span class="keyword">const</span> WCHAR* Format,
00097     ...)
00098 <span class="comment">/*++</span>
00099 <span class="comment"></span>
00100 <span class="comment">Routine Description:</span>
00101 <span class="comment"></span>
00102 <span class="comment">    Scans a source Buffer and places values from that buffer into the parameters</span>
00103 <span class="comment">    as specified by Format.</span>
00104 <span class="comment"></span>
00105 <span class="comment">Arguments:</span>
00106 <span class="comment"></span>
00107 <span class="comment">    Buffer -</span>
00108 <span class="comment">        Contains the source buffer which is to be scanned.</span>
00109 <span class="comment"></span>
00110 <span class="comment">    MaximumLength -</span>
00111 <span class="comment">        Contains the maximum length in characters for which Buffer is searched.</span>
00112 <span class="comment">        This implies that Buffer need not be UNICODE_NULL terminated.</span>
00113 <span class="comment"></span>
00114 <span class="comment">    Format -</span>
00115 <span class="comment">        Contains the format string which defines both the acceptable string format</span>
00116 <span class="comment">        contained in Buffer, and the variable parameters which follow.</span>
00117 <span class="comment"></span>
00118 <span class="comment">Return Value:</span>
00119 <span class="comment"></span>
00120 <span class="comment">    Returns the number of parameters filled if the end of the Buffer is reached,</span>
00121 <span class="comment">    else -1 on an error.</span>
00122 <span class="comment"></span>
00123 <span class="comment">--*/</span>
00124 {
00125     va_list ArgList;
00126     <span class="keywordtype">int</span>     FormatItems;
00127 
00128     va_start(ArgList, Format);
00129     <span class="keywordflow">for</span> (FormatItems = 0;;) {
00130         <span class="keywordflow">switch</span> (*Format) {
00131         <span class="keywordflow">case</span> 0:
00132             <span class="keywordflow">return</span> (MaximumLength &amp;&amp; *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>) ? -1 : FormatItems;
00133         <span class="keywordflow">case</span> <span class="charliteral">'%'</span>:
00134             Format++;
00135             <span class="keywordflow">if</span> (*Format != <span class="charliteral">'%'</span>) {
00136                 ULONG   Number;
00137                 <span class="keywordtype">int</span>     Width;
00138                 <span class="keywordtype">int</span>     Long;
00139                 PVOID   Pointer;
00140 
00141                 <span class="keywordflow">for</span> (Long = 0, Width = 0;; Format++) {
00142                     <span class="keywordflow">if</span> ((*Format &gt;= <span class="charliteral">'0'</span>) &amp;&amp; (*Format &lt;= <span class="charliteral">'9'</span>)) {
00143                         Width = Width * 10 + *Format - <span class="charliteral">'0'</span>;
00144                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*Format == <span class="charliteral">'l'</span>) {
00145                         Long++;
00146                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*Format == <span class="charliteral">'X'</span>) || (*Format == <span class="charliteral">'x'</span>)) {
00147                         <span class="keywordflow">break</span>;
00148                     }
00149                 }
00150                 Format++;
00151                 <span class="keywordflow">for</span> (Number = 0; Width--; <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++, MaximumLength--) {
00152                     <span class="keywordflow">if</span> (!MaximumLength)
00153                         <span class="keywordflow">return</span> -1;
00154                     Number *= 16;
00155                     <span class="keywordflow">if</span> ((*<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> &gt;= <span class="charliteral">'0'</span>) &amp;&amp; (*<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> &lt;= <span class="charliteral">'9'</span>)) {
00156                         Number += (*<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - <span class="charliteral">'0'</span>);
00157                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> &gt;= <span class="charliteral">'a'</span>) &amp;&amp; (*<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> &lt;= <span class="charliteral">'f'</span>)) {
00158                         Number += (*<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - <span class="charliteral">'a'</span> + 10);
00159                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> &gt;= <span class="charliteral">'A'</span>) &amp;&amp; (*<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> &lt;= <span class="charliteral">'F'</span>)) {
00160                         Number += (*<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - <span class="charliteral">'A'</span> + 10);
00161                     } <span class="keywordflow">else</span> {
00162                         <span class="keywordflow">return</span> -1;
00163                     }
00164                 }
00165                 Pointer = va_arg(ArgList, PVOID);
00166                 <span class="keywordflow">if</span> (Long) {
00167                     *(PULONG)Pointer = Number;
00168                 } <span class="keywordflow">else</span> {
00169                     *(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)Pointer = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Number;
00170                 }
00171                 FormatItems++;
00172                 <span class="keywordflow">break</span>;
00173             }
00174             <span class="comment">/* no break */</span>
00175         <span class="keywordflow">default</span>:
00176             <span class="keywordflow">if</span> (!MaximumLength || (*<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> != *Format)) {
00177                 <span class="keywordflow">return</span> -1;
00178             }
00179             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++;
00180             MaximumLength--;
00181             Format++;
00182             <span class="keywordflow">break</span>;
00183         }
00184     }
00185 }
00186 
00187 
00188 NTSYSAPI
00189 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00190 NTAPI
<a name="l00191"></a><a class="code" href="../../d1/d7/guid_8c.html#a4">00191</a> <a class="code" href="../../d1/d7/guid_8c.html#a4">RtlGUIDFromString</a>(
00192     IN PUNICODE_STRING GuidString,
00193     OUT GUID* Guid
00194     )
00195 <span class="comment">/*++</span>
00196 <span class="comment"></span>
00197 <span class="comment">Routine Description:</span>
00198 <span class="comment"></span>
00199 <span class="comment">    Retrieves a the binary format of a textual GUID presented in the standard</span>
00200 <span class="comment">    string version of a GUID: "{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}".</span>
00201 <span class="comment"></span>
00202 <span class="comment">Arguments:</span>
00203 <span class="comment"></span>
00204 <span class="comment">    GuidString -</span>
00205 <span class="comment">        Place from which to retrieve the textual form of the GUID.</span>
00206 <span class="comment"></span>
00207 <span class="comment">    Guid -</span>
00208 <span class="comment">        Place in which to put the binary form of the GUID.</span>
00209 <span class="comment"></span>
00210 <span class="comment">Return Value:</span>
00211 <span class="comment"></span>
00212 <span class="comment">    Returns STATUS_SUCCESS if the buffer contained a valid GUID, else</span>
00213 <span class="comment">    STATUS_INVALID_PARAMETER if the string was invalid.</span>
00214 <span class="comment"></span>
00215 <span class="comment">--*/</span>
00216 {
00217     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>    Data4[8];
00218     <span class="keywordtype">int</span>       <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00219 
00220     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
00221     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/guid_8c.html#a3">ScanHexFormat</a>(GuidString-&gt;Buffer, GuidString-&gt;Length / <span class="keyword">sizeof</span>(WCHAR), <a class="code" href="../../d1/d7/guid_8c.html#a1">GuidFormat</a>, &amp;Guid-&gt;Data1, &amp;Guid-&gt;Data2, &amp;Guid-&gt;Data3, &amp;Data4[0], &amp;Data4[1], &amp;Data4[2], &amp;Data4[3], &amp;Data4[4], &amp;Data4[5], &amp;Data4[6], &amp;Data4[7]) == -1) {
00222         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00223     }
00224     <span class="keywordflow">for</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 0; <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> &lt; <span class="keyword">sizeof</span>(Data4)/<span class="keyword">sizeof</span>(Data4[0]); <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>++) {
00225         Guid-&gt;Data4[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>] = (UCHAR)Data4[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>];
00226     }
00227     <span class="keywordflow">return</span> STATUS_SUCCESS;
00228 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:13 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
