<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mips/chandler.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>chandler.c File Reference</h1><code>#include "nt.h"</code><br>

<p>
<a href="../../d3/d5/mips_2chandler_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/mips_2chandler_8c.html#a0">__C_ExecuteExceptionFilter</a> (PEXCEPTION_POINTERS ExceptionPointers, EXCEPTION_FILTER ExceptionFilter, ULONG EstablisherFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/mips_2chandler_8c.html#a1">__C_ExecuteTerminationHandler</a> (BOOLEAN AbnormalTermination, TERMINATION_HANDLER TerminationHandler, ULONG EstablisherFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>EXCEPTION_DISPOSITION&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/mips_2chandler_8c.html#a2">__C_specific_handler</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PVOID EstablisherFrame, IN OUT PCONTEXT ContextRecord, IN OUT PDISPATCHER_CONTEXT DispatcherContext)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="mips/chandler.c::__C_ExecuteExceptionFilter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG __C_ExecuteExceptionFilter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PEXCEPTION_POINTERS&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionPointers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>EXCEPTION_FILTER&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFilter</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>EstablisherFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="mips/chandler.c::__C_ExecuteTerminationHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID __C_ExecuteTerminationHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AbnormalTermination</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TERMINATION_HANDLER&nbsp;</td>
          <td class="mdname" nowrap> <em>TerminationHandler</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>EstablisherFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mips/chandler.c::__C_specific_handler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> EXCEPTION_DISPOSITION __C_specific_handler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>EstablisherFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PDISPATCHER_CONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>DispatcherContext</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/mips_2chandler_8c-source.html#l00049">49</a> of file <a class="el" href="../../d3/d5/mips_2chandler_8c-source.html">mips/chandler.c</a>.
<p>
References <a class="el" href="../../d3/d6/ppc_2chandler_8c.html#a0">__C_ExecuteExceptionFilter()</a>, <a class="el" href="../../d3/d6/ppc_2chandler_8c.html#a1">__C_ExecuteTerminationHandler()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00059">ExceptionContinueExecution</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00060">ExceptionContinueSearch</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00737">RtlUnwind2()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00058                    :
00059 
00060     This function scans <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> scope tables associated with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00061     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> and calls exception and termination handlers as necessary.
00062 
00063 Arguments:
00064 
00065     ExceptionRecord - Supplies a pointer to an exception record.
00066 
00067     EstablisherFrame - Supplies a pointer to frame of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> establisher function.
00068 
00069     ContextRecord - Supplies a pointer to a context record.
00070 
00071     DispatcherContext - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception dispatcher or
00072         unwind dispatcher context.
00073 
00074 Return Value:
00075 
00076     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> handled by one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception filter <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a>, then
00077     there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no <span class="keywordflow">return</span> from <span class="keyword">this</span> routine and <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a19">RtlUnwind</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called. Otherwise,
00078     an exception disposition value of <span class="keywordflow">continue</span> execution or <span class="keywordflow">continue</span> search <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00079     returned.
00080 
00081 --*/
00082 
00083 {
00084 
00085     ULONG ControlPc;
00086     EXCEPTION_FILTER ExceptionFilter;
00087     EXCEPTION_POINTERS ExceptionPointers;
00088     PRUNTIME_FUNCTION FunctionEntry;
00089     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00090     PSCOPE_TABLE ScopeTable;
00091     ULONG TargetPc;
00092     TERMINATION_HANDLER TerminationHandler;
00093     LONG Value;
00094 
00095     <span class="comment">//</span>
00096     <span class="comment">// Get address of where control left the establisher, the address of the</span>
00097     <span class="comment">// function table entry that describes the function, and the address of</span>
00098     <span class="comment">// the scope table.</span>
00099     <span class="comment">//</span>
00100 
00101     ControlPc = DispatcherContext-&gt;ControlPc;
00102     FunctionEntry = DispatcherContext-&gt;FunctionEntry;
00103     ScopeTable = (PSCOPE_TABLE)(FunctionEntry-&gt;HandlerData);
00104 
00105     <span class="comment">//</span>
00106     <span class="comment">// If an unwind is not in progress, then scan the scope table and call</span>
00107     <span class="comment">// the appropriate exception filter routines. Otherwise, scan the scope</span>
00108     <span class="comment">// table and call the appropriate termination handlers using the target</span>
00109     <span class="comment">// PC obtained from the context record.</span>
00110     <span class="comment">// are called.</span>
00111     <span class="comment">//</span>
00112 
00113     <span class="keywordflow">if</span> (IS_DISPATCHING(ExceptionRecord-&gt;ExceptionFlags)) {
00114 
00115         <span class="comment">//</span>
00116         <span class="comment">// Scan the scope table and call the appropriate exception filter</span>
00117         <span class="comment">// routines.</span>
00118         <span class="comment">//</span>
00119 
00120         ExceptionPointers.ExceptionRecord = ExceptionRecord;
00121         ExceptionPointers.ContextRecord = ContextRecord;
00122         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; ScopeTable-&gt;Count; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00123             <span class="keywordflow">if</span> ((ControlPc &gt;= ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].BeginAddress) &amp;&amp;
00124                 (ControlPc &lt; ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].EndAddress) &amp;&amp;
00125                 (ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].JumpTarget != 0)) {
00126 
00127                 <span class="comment">//</span>
00128                 <span class="comment">// Call the exception filter routine.</span>
00129                 <span class="comment">//</span>
00130 
00131                 ExceptionFilter =
00132                     (EXCEPTION_FILTER)ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].HandlerAddress;
00133                 Value = <a class="code" href="../../d3/d6/ppc_2chandler_8c.html#a0">__C_ExecuteExceptionFilter</a>(&amp;ExceptionPointers,
00134                                                    ExceptionFilter,
00135                                                    (ULONG)EstablisherFrame);
00136 
00137                 <span class="comment">//</span>
00138                 <span class="comment">// If the return value is less than zero, then dismiss the</span>
00139                 <span class="comment">// exception. Otherwise, if the value is greater than zero,</span>
00140                 <span class="comment">// then unwind to the target exception handler. Otherwise,</span>
00141                 <span class="comment">// continue the search for an exception filter.</span>
00142                 <span class="comment">//</span>
00143 
00144                 <span class="keywordflow">if</span> (Value &lt; 0) {
00145                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a36">ExceptionContinueExecution</a>;
00146 
00147                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Value &gt; 0) {
00148                     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a12">RtlUnwind2</a>(EstablisherFrame,
00149                                (PVOID)ScopeTable-&gt;ScopeRecord[Index].JumpTarget,
00150                                ExceptionRecord,
00151                                (PVOID)ExceptionRecord-&gt;ExceptionCode,
00152                                ContextRecord);
00153                 }
00154             }
00155         }
00156 
00157     } <span class="keywordflow">else</span> {
00158 
00159         <span class="comment">//</span>
00160         <span class="comment">// Scan the scope table and call the appropriate termination handler</span>
00161         <span class="comment">// routines.</span>
00162         <span class="comment">//</span>
00163 
00164         TargetPc = ContextRecord-&gt;Fir;
00165         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; ScopeTable-&gt;Count; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00166             <span class="keywordflow">if</span> ((ControlPc &gt;= ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].BeginAddress) &amp;&amp;
00167                 (ControlPc &lt; ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].EndAddress)) {
00168 
00169                 <span class="comment">//</span>
00170                 <span class="comment">// If the target PC is within the same scope the control PC</span>
00171                 <span class="comment">// is within, then this is an uplevel goto out of an inner try</span>
00172                 <span class="comment">// scope or a long jump back into a try scope. Terminate the</span>
00173                 <span class="comment">// scan termination handlers.</span>
00174                 <span class="comment">//</span>
00175                 <span class="comment">// N.B. The target PC can be just beyond the end of the scope,</span>
00176                 <span class="comment">//      in which case it is a leave from the scope.</span>
00177                 <span class="comment">//</span>
00178 
00179 
00180                 <span class="keywordflow">if</span> ((TargetPc &gt;= ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].BeginAddress) &amp;&amp;
00181                    (TargetPc &lt;= ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].EndAddress)) {
00182                     <span class="keywordflow">break</span>;
00183 
00184                 } <span class="keywordflow">else</span> {
00185 
00186                     <span class="comment">//</span>
00187                     <span class="comment">// If the scope table entry describes an exception filter</span>
00188                     <span class="comment">// and the associated exception handler is the target of</span>
00189                     <span class="comment">// the unwind, then terminate the scan for termination</span>
00190                     <span class="comment">// handlers. Otherwise, if the scope table entry describes</span>
00191                     <span class="comment">// a termination handler, then record the address of the</span>
00192                     <span class="comment">// end of the scope as the new control PC address and call</span>
00193                     <span class="comment">// the termination handler.</span>
00194                     <span class="comment">//</span>
00195 
00196                     <span class="keywordflow">if</span> (ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].JumpTarget != 0) {
00197                         <span class="keywordflow">if</span> (TargetPc == ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].JumpTarget) {
00198                             <span class="keywordflow">break</span>;
00199                         }
00200 
00201                     } <span class="keywordflow">else</span> {
00202                         DispatcherContext-&gt;ControlPc =
00203                                 ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].EndAddress + 4;
00204                         TerminationHandler =
00205                             (TERMINATION_HANDLER)ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].HandlerAddress;
00206                         <a class="code" href="../../d3/d6/ppc_2chandler_8c.html#a1">__C_ExecuteTerminationHandler</a>(TRUE,
00207                                                       TerminationHandler,
00208                                                       (ULONG)EstablisherFrame);
00209                     }
00210                 }
00211             }
00212         }
00213     }
00214 
00215     <span class="comment">//</span>
00216     <span class="comment">// Continue search for exception or termination handlers.</span>
00217     <span class="comment">//</span>
00218 
00219     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a37">ExceptionContinueSearch</a>;
00220 }
}
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:03 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
