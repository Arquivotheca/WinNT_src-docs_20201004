<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rtl/alpha/context.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>context.c File Reference</h1><code>#include &lt;nt.h&gt;</code><br>
<code>#include &lt;ntrtl.h&gt;</code><br>
<code>#include &lt;alphaops.h&gt;</code><br>

<p>
<a href="../../d3/d5/rtl_2alpha_2context_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/rtl_2alpha_2context_8c.html#a0">RtlInitializeContext</a> (IN HANDLE Process, OUT PCONTEXT Context, IN PVOID Parameter OPTIONAL, IN PVOID InitialPc OPTIONAL, IN PVOID InitialSp OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/rtl_2alpha_2context_8c.html#a1">RtlRemoteCall</a> (HANDLE Process, HANDLE Thread, PVOID CallSite, ULONG ArgumentCount, PULONG_PTR Arguments, BOOLEAN PassContext, BOOLEAN AlreadySuspended)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="rtl/alpha/context.c::RtlInitializeContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RtlInitializeContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID Parameter&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID InitialPc&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID InitialSp&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/rtl_2alpha_2context_8c-source.html#l00034">34</a> of file <a class="el" href="../../d3/d5/rtl_2alpha_2context_8c-source.html">rtl/alpha/context.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00239">CONTEXT_FULL</a>, and <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00563">RtlRaiseStatus()</a>.
<p>
<pre class="fragment"><div>00044                    :
00045 
00046     This function initializes a context structure so that <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> can be used in
00047     a subsequent call to <a class="code" href="../../d2/d8/ps_2create_8c.html#a10">NtCreateThread</a>.
00048 
00049 Arguments:
00050 
00051     Process - Supplies an open handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target process. This argument
00052         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored by <span class="keyword">this</span> function.
00053 
00054     Context - Supplies a pointer to a context record that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be initialized.
00055 
00056     Parameter - Supplies an initial value <span class="keywordflow">for</span> <span class="keyword">register</span> A0.
00057 
00058     InitialPc - Supplies an initial program counter value.
00059 
00060     InitialSp - Supplies an initial stack pointer value.
00061 
00062 Return Value:
00063 
00064     Raises STATUS_BAD_INITIAL_STACK <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of InitialSp <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not properly
00065            aligned.
00066 
00067     Raises STATUS_BAD_INITIAL_PC <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of InitialPc <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not properly
00068            aligned.
00069 
00070 --*/
00071 
00072 {
00073 
00074     <span class="comment">//</span>
00075     <span class="comment">// Check for proper initial stack and PC alignment.</span>
00076     <span class="comment">//</span>
00077 
00078     <span class="keywordflow">if</span> (((ULONG_PTR)InitialSp &amp; 0xF) != 0) {
00079         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_BAD_INITIAL_STACK);
00080     }
00081     <span class="keywordflow">if</span> (((ULONG_PTR)InitialPc &amp; 0x3) != 0) {
00082         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(STATUS_BAD_INITIAL_PC);
00083     }
00084 
00085     <span class="comment">//</span>
00086     <span class="comment">// Initialize the integer registers to contain their register number</span>
00087     <span class="comment">// (they must be initialized and using register numbers instead of 0</span>
00088     <span class="comment">// can be useful for debugging). Integer registers a0, ra, gp, and sp</span>
00089     <span class="comment">// are set later.</span>
00090     <span class="comment">//</span>
00091 
00092     Context-&gt;IntV0 = 0;
00093     Context-&gt;IntT0 = 1;
00094     Context-&gt;IntT1 = 2;
00095     Context-&gt;IntT2 = 3;
00096     Context-&gt;IntT3 = 4;
00097     Context-&gt;IntT4 = 5;
00098     Context-&gt;IntT5 = 6;
00099     Context-&gt;IntT6 = 7;
00100     Context-&gt;IntT7 = 8;
00101     Context-&gt;IntS0 = 9;
00102     Context-&gt;IntS1 = 10;
00103     Context-&gt;IntS2 = 11;
00104     Context-&gt;IntS3 = 12;
00105     Context-&gt;IntS4 = 13;
00106     Context-&gt;IntS5 = 14;
00107     Context-&gt;IntFp = 15;
00108     Context-&gt;IntA1 = 17;
00109     Context-&gt;IntA2 = 18;
00110     Context-&gt;IntA3 = 19;
00111     Context-&gt;IntA4 = 20;
00112     Context-&gt;IntA5 = 21;
00113     Context-&gt;IntT8 = 22;
00114     Context-&gt;IntT9 = 23;
00115     Context-&gt;IntT10 = 24;
00116     Context-&gt;IntT11 = 25;
00117     Context-&gt;IntT12 = 27;
00118     Context-&gt;IntAt = 28;
00119 
00120     <span class="comment">//</span>
00121     <span class="comment">// Initialize the floating point registers to contain the integer value</span>
00122     <span class="comment">// of their register number (they must be initialized and using register</span>
00123     <span class="comment">// numbers instead of 0 can be useful for debugging).</span>
00124     <span class="comment">//</span>
00125 
00126     Context-&gt;FltF0 = 0;
00127     Context-&gt;FltF1 = 1;
00128     Context-&gt;FltF2 = 2;
00129     Context-&gt;FltF3 = 3;
00130     Context-&gt;FltF4 = 4;
00131     Context-&gt;FltF5 = 5;
00132     Context-&gt;FltF6 = 6;
00133     Context-&gt;FltF7 = 7;
00134     Context-&gt;FltF8 = 8;
00135     Context-&gt;FltF9 = 9;
00136     Context-&gt;FltF10 = 10;
00137     Context-&gt;FltF11 = 11;
00138     Context-&gt;FltF12 = 12;
00139     Context-&gt;FltF13 = 13;
00140     Context-&gt;FltF14 = 14;
00141     Context-&gt;FltF15 = 15;
00142     Context-&gt;FltF16 = 16;
00143     Context-&gt;FltF17 = 17;
00144     Context-&gt;FltF18 = 18;
00145     Context-&gt;FltF19 = 19;
00146     Context-&gt;FltF20 = 20;
00147     Context-&gt;FltF21 = 21;
00148     Context-&gt;FltF22 = 22;
00149     Context-&gt;FltF23 = 23;
00150     Context-&gt;FltF24 = 24;
00151     Context-&gt;FltF25 = 25;
00152     Context-&gt;FltF26 = 26;
00153     Context-&gt;FltF27 = 27;
00154     Context-&gt;FltF28 = 28;
00155     Context-&gt;FltF29 = 29;
00156     Context-&gt;FltF30 = 30;
00157     Context-&gt;FltF31 = 0;
00158 
00159     <span class="comment">//</span>
00160     <span class="comment">// Initialize the control registers.</span>
00161     <span class="comment">//</span>
00162     <span class="comment">// Gp: will be set in LdrpInitialize at thread startup.</span>
00163     <span class="comment">// Ra: some debuggers compare for 1 as a top-of-stack indication.</span>
00164     <span class="comment">//</span>
00165     <span class="comment">// N.B. On 32-bit systems, ULONG becomes canonical longword with the</span>
00166     <span class="comment">//      (ULONGLONG)(LONG) cast.</span>
00167     <span class="comment">//</span>
00168 
00169     Context-&gt;IntGp = 0;
00170     Context-&gt;IntSp = (ULONGLONG)(LONG_PTR)InitialSp;
00171     Context-&gt;IntRa = 1;
00172     Context-&gt;Fir = (ULONGLONG)(LONG_PTR)InitialPc;
00173 
00174     <span class="comment">//</span>
00175     <span class="comment">// Set default Alpha floating point control register values.</span>
00176     <span class="comment">//</span>
00177 
00178     Context-&gt;Fpcr = (ULONGLONG)0;
00179     ((PFPCR)(&amp;Context-&gt;Fpcr))-&gt;DynamicRoundingMode = ROUND_TO_NEAREST;
00180     Context-&gt;SoftFpcr = (ULONGLONG)0;
00181 
00182     Context-&gt;Psr = 0;
00183     Context-&gt;ContextFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a152">CONTEXT_FULL</a>;
00184 
00185     <span class="comment">//</span>
00186     <span class="comment">// Set the initial context of the thread in a machine specific way.</span>
00187     <span class="comment">//</span>
00188 
00189     Context-&gt;IntA0 = (ULONGLONG)(LONG_PTR)Parameter;
00190 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="rtl/alpha/context.c::RtlRemoteCall" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlRemoteCall           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>CallSite</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ArgumentCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Arguments</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>PassContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AlreadySuspended</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/rtl_2alpha_2context_8c-source.html#l00193">193</a> of file <a class="el" href="../../d3/d5/rtl_2alpha_2context_8c-source.html">rtl/alpha/context.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00239">CONTEXT_FULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00151">NtGetContextThread()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00138">NtResumeThread()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00352">NtSetContextThread()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00033">NtSuspendThread()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00231">NtWriteVirtualMemory()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00205                    :
00206 
00207     This function calls a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> in another thread/process by <span class="keyword">using</span>
00208     NtGetContext and NtSetContext. Parameters are passed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target
00209     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> via <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> nonvolatile registers (s0 - s5).
00210 
00211 Arguments:
00212 
00213     Process - Supplies an open handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target process.
00214 
00215     Thread - Supplies an open handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target thread within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target
00216         process.
00217 
00218     CallSite - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> to call in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target
00219         process.
00220 
00221     ArgumentCount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of parameters to pass to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00222         target <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a>.
00223 
00224     Arguments - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array of parameters to pass.
00225 
00226     PassContext - Supplies a <span class="keywordtype">boolean</span> value that determines whether a parameter
00227         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be passed that points to a context record. This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00228         ignored on MIPS and Alpha hosts.
00229 
00230     AlreadySuspended - Supplies a <span class="keywordtype">boolean</span> value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00231         target thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already in a suspended or waiting state.
00232 
00233 Return Value:
00234 
00235     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> - <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> value.
00236 
00237 --*/
00238 
00239 {
00240 
00241     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00242     CONTEXT Context;
00243     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00244     ULONGLONG NewSp;
00245 
00246     <span class="keywordflow">if</span> ((ArgumentCount &gt; 6) ||
00247         (PassContext &amp;&amp; (ArgumentCount &gt; 5))) {
00248         <span class="keywordflow">return</span>(STATUS_INVALID_PARAMETER);
00249     }
00250 
00251     <span class="comment">//</span>
00252     <span class="comment">// If necessary, suspend the target thread before getting the thread's</span>
00253     <span class="comment">// current state.</span>
00254     <span class="comment">//</span>
00255 
00256     <span class="keywordflow">if</span> (AlreadySuspended == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00257         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/psspnd_8c.html#a0">NtSuspendThread</a>(Thread, NULL);
00258         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00259             <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00260         }
00261     }
00262 
00263     <span class="comment">//</span>
00264     <span class="comment">// Get the current state of the target thread.</span>
00265     <span class="comment">//</span>
00266 
00267     Context.ContextFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a152">CONTEXT_FULL</a>;
00268     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d0/psctx_8c.html#a2">NtGetContextThread</a>(Thread, &amp;Context);
00269     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00270         <span class="keywordflow">if</span> (AlreadySuspended == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00271             <a class="code" href="../../d1/d2/psspnd_8c.html#a1">NtResumeThread</a>(Thread, NULL);
00272         }
00273         <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00274     }
00275 
00276     <span class="keywordflow">if</span> (AlreadySuspended) {
00277         Context.IntV0 = STATUS_ALERTED;
00278     }
00279 
00280     <span class="comment">//</span>
00281     <span class="comment">// Pass the parameters to the other thread via the non-volatile registers</span>
00282     <span class="comment">// s0 - s5. The context record is passed on the stack of the target thread.</span>
00283     <span class="comment">//</span>
00284 
00285     NewSp = Context.IntSp - <span class="keyword">sizeof</span>(CONTEXT);
00286     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d5/readwrt_8c.html#a10">NtWriteVirtualMemory</a>(Process, (PVOID)NewSp, &amp;Context,
00287                                   <span class="keyword">sizeof</span>(CONTEXT), NULL);
00288     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00289         <span class="keywordflow">if</span> (AlreadySuspended == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00290             <a class="code" href="../../d1/d2/psspnd_8c.html#a1">NtResumeThread</a>(Thread, NULL);
00291         }
00292         <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00293     }
00294 
00295     <span class="comment">//</span>
00296     <span class="comment">// N.B. On 32-bit system each ULONG argument is converted to canonical</span>
00297     <span class="comment">//      form with the (ULONGLONG)(LONG) cast as required by the calling</span>
00298     <span class="comment">//      standard.</span>
00299     <span class="comment">//</span>
00300 
00301     Context.IntSp = NewSp;
00302 
00303     <span class="keywordflow">if</span> (PassContext) {
00304         Context.IntS0 = NewSp;
00305         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; ArgumentCount; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00306             (&amp;Context.IntS1)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = (ULONGLONG)(LONG_PTR)Arguments[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00307         }
00308 
00309     } <span class="keywordflow">else</span> {
00310         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; ArgumentCount; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00311             (&amp;Context.IntS0)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = (ULONGLONG)(LONG_PTR)Arguments[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00312         }
00313     }
00314 
00315     <span class="comment">//</span>
00316     <span class="comment">// Set the address of the target code into FIR and set the thread context</span>
00317     <span class="comment">// to cause the target procedure to be executed.</span>
00318     <span class="comment">//</span>
00319     <span class="comment">// N.B. The PVOID CallSite is stored as a canonical longword in order</span>
00320     <span class="comment">//      for Fir to be a valid 64-bit address.</span>
00321     <span class="comment">//</span>
00322 
00323     Context.Fir = (ULONGLONG)(LONG_PTR)CallSite;
00324     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d0/psctx_8c.html#a3">NtSetContextThread</a>(Thread, &amp;Context);
00325     <span class="keywordflow">if</span> (AlreadySuspended == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00326         <a class="code" href="../../d1/d2/psspnd_8c.html#a1">NtResumeThread</a>(Thread, NULL);
00327     }
00328     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00329 }
}
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:16 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
