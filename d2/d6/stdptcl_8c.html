<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: stdptcl.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>stdptcl.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d3/d5/stdptcl_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a0">ClStartAdvise</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a1">SvSpontAdvise</a> (<a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a> psi, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a2">ClRespAdviseAck</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a3">SvStartAdviseUpdate</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cLinksToGo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a4">ClSpontAdviseData</a> (<a class="el" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a> pci, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a5">SvRespAdviseDataAck</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a6">ClStartUnadvise</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a7">CloseTransaction</a> (<a class="el" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> pci, ATOM atom)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a8">SvSpontUnadvise</a> (<a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a> psi, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a9">ClRespUnadviseAck</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a10">MaybeTranslateExecuteData</a> (HANDLE hDDE, BOOL fUnicodeFrom, BOOL fUnicodeTo, BOOL fFreeSource)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a11">ClStartExecute</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a12">SvSpontExecute</a> (<a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a> psi, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a13">ClRespExecuteAck</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a14">ClStartPoke</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a15">SvSpontPoke</a> (<a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a> psi, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a16">ClRespPokeAck</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a17">ClStartRequest</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a18">SvSpontRequest</a> (<a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a> psi, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a19">ClRespRequestData</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a> (<a class="el" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a> pci, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a21">SpontaneousServerMessage</a> (<a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a> psi, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a22">AllocAndSetDDEData</a> (LPBYTE pSrc, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb, WORD wStatus, WORD wFmt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a> (HWND hwndTo, UINT msgIn, UINT msgOut, HWND hwndFrom, LPARAM lParam, UINT_PTR uiLo, UINT_PTR uiHi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a24">ExtractDDEDataInfo</a> (HANDLE hDDE, LPWORD pwStatus, LPWORD pwFmt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a25">TransactionComplete</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi, HDDEDATA hData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/stdptcl_8c.html#a26">UnpackAndFreeDDEMLDataHandle</a> (HDDEDATA hData, BOOL fExec)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a22" doxytag="stdptcl.c::AllocAndSetDDEData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE AllocAndSetDDEData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>pSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>wStatus</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>wFmt</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01479">1479</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00125">UserGlobalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00019">tagDDE_DATA::wFmt</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00018">tagDDE_DATA::wStatus</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00067">ClStartAdvise()</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00024">DdeClientTransaction()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01207">SvSpontRequest()</a>.
<p>
<pre class="fragment"><div>01484 {
01485     HANDLE hDDE;
01486     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOff;
01487     <a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a> pdde;
01488     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fCopyIt;
01489 
01490     <span class="keywordflow">if</span> (cb == -1) {
01491         hDDE = (HANDLE)pSrc;
01492         cb = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)GlobalSize(hDDE);
01493         fCopyIt = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01494     } <span class="keywordflow">else</span> {
01495         hDDE = <a class="code" href="../../d6/d0/usercli_8h.html#a3">UserGlobalAlloc</a>(GMEM_DDESHARE | GMEM_MOVEABLE | GMEM_ZEROINIT,
01496                 (wFmt ? (cb + 4) : cb));
01497         fCopyIt = (pSrc != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01498     }
01499     <span class="keywordflow">if</span> (hDDE == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01500         <span class="keywordflow">return</span>(0);
01501     }
01502     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDE, pdde);
01503     <span class="keywordflow">if</span> (pdde == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01504         <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(hDDE);
01505         <span class="keywordflow">return</span> (0);
01506     }
01507     <span class="keywordflow">if</span> (wFmt) {
01508         pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o0">wStatus</a> = wStatus;
01509         pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o1">wFmt</a> = wFmt;
01510         cbOff = 4;
01511     } <span class="keywordflow">else</span> {
01512         cbOff = 0;
01513     }
01514     <span class="keywordflow">if</span> (fCopyIt) {
01515         RtlCopyMemory((PBYTE)pdde + cbOff, pSrc, cb);
01516     }
01517     <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
01518 
01519     <span class="keywordflow">return</span> (hDDE);
01520 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="stdptcl.c::CloseTransaction" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void CloseTransaction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pci</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ATOM&nbsp;</td>
          <td class="mdname" nowrap> <em>atom</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00599">599</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00121">tagXACT_INFO::next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00221">tagCONV_INFO::pxiIn</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00222">tagCONV_INFO::pxiOut</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00640">SvSpontUnadvise()</a>.
<p>
<pre class="fragment"><div>00602 {
00603     <a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi;
00604     <a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxiD;
00605 
00606     pxi = pci-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a>;
00607 
00608     <span class="keywordflow">while</span> (pxi &amp;&amp; (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a> == atom)) {
00609         pxiD = pxi;
00610         pxi  = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>;
00611         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxiD);
00612     }
00613     pci-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a> = pxi;
00614 
00615     <span class="keywordflow">if</span> (pxi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00616         pci-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o10">pxiIn</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00617         <span class="keywordflow">return</span>;
00618     }
00619 
00620     <span class="keywordflow">while</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>) {
00621         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a> == atom) {
00622             pxiD = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>;
00623             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a> = pxiD-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>;
00624             <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxiD);
00625         } <span class="keywordflow">else</span>
00626             pxi = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>;
00627     }
00628     pci-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o10">pxiIn</a> = pxi;
00629 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="stdptcl.c::ClRespAdviseAck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClRespAdviseAck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pxi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00190">190</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d3/d1/util_8c-source.html#l00023">AddLink()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00642">FreeDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00025">GATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00132">tagXACT_INFO::hDDESent</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00215">tagCONV_INFO::laService</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00031">MONLINK</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d0/d4/ddemlcli_8h.html#a73">PCL_CONV_INFO</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01396">SpontaneousClientMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00219">tagCONV_INFO::state</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01624">TransactionComplete()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00885">UnlinkTransaction()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">UnpackDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00129">tagXACT_INFO::wStatus</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00128">tagXACT_INFO::wType</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00067">ClStartAdvise()</a>.
<p>
<pre class="fragment"><div>00194 {
00195     UINT_PTR uiLo, uiHi;
00196 
00197     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00198         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> != WM_DDE_ACK) {
00199             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
00200         }
00201 
00202         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_ACK, lParam, &amp;uiLo, &amp;uiHi);
00203 <span class="preprocessor">#if DBG</span>
00204 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d4/ddemlcli_8h.html#a52">GATOM</a>)uiHi != pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>) {
00205             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
00206         }
00207 <span class="preprocessor">#endif</span>
00208 <span class="preprocessor"></span>
00209         GlobalDeleteAtom((ATOM)uiHi); <span class="comment">// message copy</span>
00210 
00211         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_ADVACKRCVD;
00212         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> = (WORD)uiLo;
00213 
00214         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> &amp; DDE_FACK) {
00215             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/util_8c.html#a0">AddLink</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>,
00216                     (WORD)((pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a> &lt;&lt; 12) &amp; (DDE_FACKREQ | DDE_FDEFERUPD)))) {
00217                 <span class="comment">//</span>
00218                 <span class="comment">// only server side reports links on local conversations.</span>
00219                 <span class="comment">//</span>
00220                 <span class="keywordflow">if</span> (!(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_ISLOCAL)) {
00221                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a4">MONLINK</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, TRUE, (WORD)uiLo &amp; DDE_FDEFERUPD,
00222                             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o4">laService</a>, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>,
00223                             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>, FALSE, (HCONV)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>,
00224                             (HCONV)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>);
00225                 }
00226             } <span class="keywordflow">else</span> {
00227                 pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> = 0;  <span class="comment">// memory failure - fake a NACK.</span>
00228             }
00229         } <span class="keywordflow">else</span> {
00230             <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>);  <span class="comment">// Nack free.</span>
00231         }
00232 
00233         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a25">TransactionComplete</a>(pxi,
00234                 (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> &amp; DDE_FACK) ? (HDDEDATA)1L : (HDDEDATA)0L)) {
00235             <span class="keywordflow">goto</span> Cleanup;
00236         }
00237     } <span class="keywordflow">else</span> {
00238 Cleanup:
00239         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// pxi copy</span>
00240         <a class="code" href="../../d0/d1/xact_8c.html#a11">UnlinkTransaction</a>(pxi);
00241         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxi);
00242     }
00243     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00244         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a>(msg, lParam);
00245     }
00246     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00247 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="stdptcl.c::ClRespExecuteAck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClRespExecuteAck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pxi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00958">958</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00137">DestroyHandle()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00642">FreeDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00132">tagXACT_INFO::hDDESent</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00124">tagXACT_INFO::hXact</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01396">SpontaneousClientMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01624">TransactionComplete()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00885">UnlinkTransaction()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">UnpackDDElParam()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00129">tagXACT_INFO::wStatus</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00852">ClStartExecute()</a>.
<p>
<pre class="fragment"><div>00962 {
00963     UINT_PTR uiLo, uiHi;
00964 
00965     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00966         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> != WM_DDE_ACK) {
00967             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
00968         }
00969 
00970         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_ACK, lParam, &amp;uiLo, &amp;uiHi);
00971         <span class="keywordflow">if</span> (uiHi != HandleToUlong(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>)) {
00972             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
00973         }
00974 
00975         <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>((HANDLE)uiHi);
00976 
00977         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_EXECACKRCVD;
00978         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> = (WORD)uiLo;
00979 
00980         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a25">TransactionComplete</a>(pxi, (HDDEDATA)(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> &amp; DDE_FACK ? 1 : 0))) {
00981             <span class="keywordflow">goto</span> Cleanup;
00982         }
00983     } <span class="keywordflow">else</span> {
00984 Cleanup:
00985         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// pxi copy</span>
00986         <a class="code" href="../../d0/d1/xact_8c.html#a11">UnlinkTransaction</a>(pxi);
00987         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>) {
00988             <a class="code" href="../../d3/d8/handles_8c.html#a7">DestroyHandle</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>);
00989         }
00990         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxi);
00991     }
00992     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00993         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a>(msg, lParam);
00994     }
00995     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00996 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="stdptcl.c::ClRespPokeAck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClRespPokeAck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pxi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01116">1116</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00137">DestroyHandle()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00491">FreeDDEData()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00642">FreeDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00025">GATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00132">tagXACT_INFO::hDDESent</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00124">tagXACT_INFO::hXact</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01396">SpontaneousClientMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01624">TransactionComplete()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00885">UnlinkTransaction()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">UnpackDDElParam()</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00129">tagXACT_INFO::wStatus</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01012">ClStartPoke()</a>.
<p>
<pre class="fragment"><div>01120 {
01121     UINT_PTR uiLo, uiHi;
01122 
01123     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
01124         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> != WM_DDE_ACK) {
01125             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
01126         }
01127 
01128         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_ACK, lParam, &amp;uiLo, &amp;uiHi);
01129         <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d4/ddemlcli_8h.html#a52">GATOM</a>)uiHi != pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>) {
01130             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
01131         }
01132 
01133         GlobalDeleteAtom((ATOM)uiHi); <span class="comment">// message copy</span>
01134 
01135         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_POKEACKRCVD;
01136         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> = (WORD)uiLo;
01137 
01138         <span class="keywordflow">if</span> (!((WORD)uiLo &amp; DDE_FACK)) {
01139             <span class="comment">//</span>
01140             <span class="comment">// NACKs make it our business to free the poked data.</span>
01141             <span class="comment">//</span>
01142             <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>, FALSE, TRUE);
01143         }
01144 
01145         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a25">TransactionComplete</a>(pxi,
01146                 (HDDEDATA)(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> &amp; DDE_FACK ? 1 : 0))) {
01147             <span class="keywordflow">goto</span> Cleanup;
01148         }
01149     } <span class="keywordflow">else</span> {
01150 Cleanup:
01151         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// pxi copy</span>
01152         <a class="code" href="../../d0/d1/xact_8c.html#a11">UnlinkTransaction</a>(pxi);
01153         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>) {
01154             <a class="code" href="../../d3/d8/handles_8c.html#a7">DestroyHandle</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>);
01155         }
01156         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxi);
01157     }
01158     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
01159         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a>(msg, lParam);
01160     }
01161     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01162 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="stdptcl.c::ClRespRequestData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClRespRequestData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pxi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">1294</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00362">ClSpontAdviseData()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01591">ExtractDDEDataInfo()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00491">FreeDDEData()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00642">FreeDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00025">GATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00133">tagXACT_INFO::hDDEResult</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01396">SpontaneousClientMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01624">TransactionComplete()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00885">UnlinkTransaction()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">UnpackDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00129">tagXACT_INFO::wStatus</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01176">ClStartRequest()</a>.
<p>
<pre class="fragment"><div>01298 {
01299     UINT_PTR uiLo, uiHi;
01300     WORD wFmt, wStatus;
01301     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
01302 
01303     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
01304         <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
01305         <span class="keywordflow">case</span> WM_DDE_DATA:
01306             <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_DATA, lParam, (PUINT_PTR)&amp;pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a>, &amp;uiHi);
01307             <span class="keywordflow">if</span> (!pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a>) {
01308                 <span class="comment">// must be an advise data message with NODATA.</span>
01309                 <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a4">ClSpontAdviseData</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, lParam));
01310             }
01311             <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d6/stdptcl_8c.html#a24">ExtractDDEDataInfo</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a>, &amp;wStatus, &amp;wFmt)) {
01312                 <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a4">ClSpontAdviseData</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, lParam));
01313             }
01314             <span class="keywordflow">if</span> (!(wStatus &amp; DDE_FREQUESTED)) {
01315                 <span class="comment">// must be advise data</span>
01316                 <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a4">ClSpontAdviseData</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, lParam));
01317             }
01318             <span class="keywordflow">if</span> (wStatus &amp; DDE_FACKREQ) {
01319 
01320                 <span class="comment">// if DDE_FRELEASE is not set, and this is a synchronous</span>
01321                 <span class="comment">// transaction, we need to make a copy here so the user</span>
01322                 <span class="comment">// can free at his leisure.</span>
01323 
01324                 <span class="comment">// reuse uiHi - message copy</span>
01325                 dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>,
01326                         WM_DDE_DATA, WM_DDE_ACK, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, 0,
01327                         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a> == wFmt &amp;&amp; pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a> == (GATOM)uiHi ?
01328                             DDE_FACK : 0, uiHi);
01329                 <span class="keywordflow">if</span> (dwError) {
01330                     <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
01331                 }
01332             } <span class="keywordflow">else</span> {
01333                 GlobalDeleteAtom((GATOM)uiHi);     <span class="comment">// message copy</span>
01334             }
01335             <span class="keywordflow">if</span> (wFmt != pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a> || (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a52">GATOM</a>)uiHi != pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>) {
01336                 <span class="comment">/*</span>
01337 <span class="comment">                 * BOGUS returned data!  Just free it and make it look like</span>
01338 <span class="comment">                 * a NACK</span>
01339 <span class="comment">                 */</span>
01340                 <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a>, FALSE, TRUE);
01341                 pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a> = 0;
01342                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a25">TransactionComplete</a>(pxi, 0)) {
01343                     <span class="keywordflow">goto</span> Cleanup;
01344                 }
01345             } <span class="keywordflow">else</span> {
01346                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a25">TransactionComplete</a>(pxi, (HDDEDATA)-1)) {
01347                     <span class="keywordflow">goto</span> Cleanup;
01348                 }
01349             }
01350             <span class="keywordflow">break</span>;
01351 
01352         <span class="keywordflow">case</span> WM_DDE_ACK:
01353             <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_ACK, lParam, &amp;uiLo, &amp;uiHi);
01354             <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d4/ddemlcli_8h.html#a52">GATOM</a>)uiHi != pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>) {
01355                 <span class="keywordflow">return</span>(<a class="code" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
01356             }
01357             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_DATARCVD;
01358             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> = (WORD)uiLo;
01359             GlobalDeleteAtom((GATOM)uiHi); <span class="comment">// message copy</span>
01360             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a25">TransactionComplete</a>(pxi, 0)) {
01361                 <span class="keywordflow">goto</span> Cleanup;
01362             }
01363             <span class="keywordflow">break</span>;
01364 
01365         <span class="keywordflow">default</span>:
01366             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
01367         }
01368 
01369     } <span class="keywordflow">else</span> {
01370 
01371 Cleanup:
01372         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// pxi copy</span>
01373         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a>) {
01374             <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a>, FALSE, TRUE);  <span class="comment">// free message data</span>
01375         }
01376         <a class="code" href="../../d0/d1/xact_8c.html#a11">UnlinkTransaction</a>(pxi);
01377         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxi);
01378     }
01379     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
01380         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a>(msg, lParam);
01381     }
01382     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01383 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="stdptcl.c::ClRespUnadviseAck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClRespUnadviseAck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pxi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00719">719</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00225">tagCONV_INFO::aLinks</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00226">tagCONV_INFO::cLinks</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00137">DestroyHandle()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00642">FreeDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00025">GATOM</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00464">GlobalToLocalAtom()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00124">tagXACT_INFO::hXact</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00147">tagADVISE_LINK::laItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00024">LATOM</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01396">SpontaneousClientMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01624">TransactionComplete()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00885">UnlinkTransaction()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">UnpackDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00148">tagADVISE_LINK::wFmt</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00129">tagXACT_INFO::wStatus</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00561">ClStartUnadvise()</a>.
<p>
<pre class="fragment"><div>00723 {
00724     UINT_PTR uiLo, uiHi;
00725     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> al;
00726     <a class="code" href="../../d2/d8/structtagADVISE__LINK.html">PADVISE_LINK</a> aLink;
00727     <span class="keywordtype">int</span> iLink;
00728 
00729     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00730         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> != WM_DDE_ACK) {
00731             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
00732         }
00733 
00734         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_ACK, lParam, &amp;uiLo, &amp;uiHi);
00735         <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d4/ddemlcli_8h.html#a52">GATOM</a>)uiHi != pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>) {
00736             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a20">SpontaneousClientMessage</a>((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
00737         }
00738 
00739         al = <a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>((ATOM)uiHi);
00740         <span class="keywordflow">for</span> (aLink = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o14">aLinks</a>, iLink = 0;
00741                 iLink &lt; pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>;
00742                     ) {
00743             <span class="keywordflow">if</span> (aLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o1">laItem</a> == al &amp;&amp;
00744                     (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a> == 0 || aLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o2">wFmt</a> == pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>)) {
00745                 DeleteAtom(al);  <span class="comment">// aLink copy</span>
00746                 <span class="keywordflow">if</span> (--pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>) {
00747                     memmove((LPSTR)aLink, (LPSTR)(aLink + 1),
00748                             <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d8/structtagADVISE__LINK.html">ADVISE_LINK</a>) * (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a> - iLink));
00749                 }
00750             } <span class="keywordflow">else</span> {
00751                 aLink++;
00752                 iLink++;
00753             }
00754         }
00755         DeleteAtom(al);  <span class="comment">// local copy</span>
00756         GlobalDeleteAtom((ATOM)uiHi);   <span class="comment">// message copy</span>
00757 
00758         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_UNADVACKRCVD;
00759         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> = (WORD)uiLo;
00760         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a25">TransactionComplete</a>(pxi, (HDDEDATA)1)) {
00761             <span class="keywordflow">goto</span> Cleanup;
00762         }
00763     } <span class="keywordflow">else</span> {
00764 Cleanup:
00765         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>);   <span class="comment">// pxi copy</span>
00766         <a class="code" href="../../d0/d1/xact_8c.html#a11">UnlinkTransaction</a>(pxi);
00767         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>) {
00768             <a class="code" href="../../d3/d8/handles_8c.html#a7">DestroyHandle</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>);
00769         }
00770         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxi);
00771     }
00772     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00773         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a>(msg, lParam);
00774     }
00775     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00776 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="stdptcl.c::ClSpontAdviseData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClSpontAdviseData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pci</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00362">362</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00225">tagCONV_INFO::aLinks</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00231">tagCL_CONV_INFO::ci</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00226">tagCONV_INFO::cLinks</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00024">DoCallback()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00491">FreeDDEData()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00642">FreeDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00025">GATOM</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00464">GlobalToLocalAtom()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00214">tagCONV_INFO::hConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00094">InternalCreateDataHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00147">tagADVISE_LINK::laItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00024">LATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00070">NORMAL_HSZ_FROM_LATOM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d0/d4/ddemlcli_8h.html#a62">PADVISE_LINK</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01708">UnpackAndFreeDDEMLDataHandle()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">UnpackDDElParam()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00148">tagADVISE_LINK::wFmt</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00019">tagDDE_DATA::wFmt</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00018">tagDDE_DATA::wStatus</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00149">tagADVISE_LINK::wType</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">ClRespRequestData()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01396">SpontaneousClientMessage()</a>.
<p>
<pre class="fragment"><div>00365 {
00366     UINT_PTR uiHi;
00367     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
00368     HANDLE hDDE = 0;
00369     HDDEDATA hData, hDataReturn;
00370     <a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a> pdde;
00371     WORD wFmt;
00372     WORD wStatus;
00373     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> la;
00374     <a class="code" href="../../d2/d8/structtagADVISE__LINK.html">PADVISE_LINK</a> paLink;
00375     <span class="keywordtype">int</span> iLink;
00376 
00377     <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_DATA, lParam, (PUINT_PTR)&amp;hDDE, &amp;uiHi);
00378     UserAssert(!hDDE || GlobalSize(hDDE));
00379     wFmt = 0;
00380     wStatus = 0;
00381     hDataReturn = 0;
00382     la = <a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>((GATOM)uiHi);
00383     <span class="keywordflow">if</span> (hDDE) {
00384         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDE, pdde);
00385         <span class="keywordflow">if</span> (pdde == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00386             hData = 0;
00387         } <span class="keywordflow">else</span> {
00388             wFmt = pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o1">wFmt</a>;
00389             wStatus = pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o0">wStatus</a>;
00390             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
00391 
00392             <span class="comment">/*</span>
00393 <span class="comment">             * if data is coming in, create a data handle for the app</span>
00394 <span class="comment">             */</span>
00395             hData = <a class="code" href="../../d0/d9/hdata_8c.html#a2">InternalCreateDataHandle</a>(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, (LPBYTE)hDDE,
00396                     (DWORD)-1, 0, HDATA_NOAPPFREE | HDATA_READONLY, 0, 0);
00397         }
00398         <span class="keywordflow">if</span> (hData) {
00399             hDataReturn = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a127">DoCallback</a>(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, XTYP_ADVDATA,
00400                     wFmt, pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>,
00401                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>),
00402                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(la),
00403                     hData, 0, 0);
00404             <span class="keywordflow">if</span> (hDataReturn != CBR_BLOCK) {
00405                 <a class="code" href="../../d2/d6/stdptcl_8c.html#a26">UnpackAndFreeDDEMLDataHandle</a>(hData, FALSE);
00406                 <span class="keywordflow">if</span> (((ULONG_PTR)hDataReturn &amp; DDE_FACK) || !(wStatus &amp; DDE_FACKREQ)) {
00407                     <span class="comment">/*</span>
00408 <span class="comment">                     * Nacked Advise data with fAckReq set is server's</span>
00409 <span class="comment">                     * responsibility to free!</span>
00410 <span class="comment">                     */</span>
00411                     <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(hDDE, FALSE, TRUE);
00412                 }
00413             }
00414         }
00415     } <span class="keywordflow">else</span> {
00416         <span class="comment">/*</span>
00417 <span class="comment">         * WARM LINK CASE</span>
00418 <span class="comment">         *</span>
00419 <span class="comment">         * Search through the client's link info to find what formats this</span>
00420 <span class="comment">         * puppy is on. We let the client know for each format being supported</span>
00421 <span class="comment">         * on this item that is warm-linked. The last hDataReturn determines</span>
00422 <span class="comment">         * the ACK returned - for lack of a better method.</span>
00423 <span class="comment">         */</span>
00424         <span class="keywordflow">for</span> (paLink = pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o14">aLinks</a>, iLink = 0; iLink &lt; pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>; iLink++, paLink++) {
00425             <span class="keywordflow">if</span> ((paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o1">laItem</a> == la) &amp;&amp; (paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o3">wType</a> &amp; DDE_FDEFERUPD)) {
00426                 hDataReturn = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a127">DoCallback</a>(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, XTYP_ADVDATA,
00427                         paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o2">wFmt</a>, pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>,
00428                         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>),
00429                         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(la),
00430                         0, 0, 0);
00431                 <span class="keywordflow">if</span> (hDataReturn == CBR_BLOCK) {
00432                     DeleteAtom(la);
00433                     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00434                 }
00435             }
00436         }
00437     }
00438     DeleteAtom(la);
00439     <span class="keywordflow">if</span> (hDataReturn == CBR_BLOCK) {
00440         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00441     }
00442 
00443     <span class="keywordflow">if</span> (wStatus &amp; DDE_FACKREQ) {
00444 
00445         (ULONG_PTR)hDataReturn &amp;= ~DDE_FACKRESERVED;
00446         <span class="comment">// reuse uiHi</span>
00447         <span class="keywordflow">if</span> (dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, WM_DDE_DATA,
00448                 WM_DDE_ACK, pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, lParam, (UINT_PTR)hDataReturn, uiHi)) {
00449             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
00450         }
00451     } <span class="keywordflow">else</span> {
00452         GlobalDeleteAtom((ATOM)uiHi); <span class="comment">// data message copy</span>
00453         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a>(WM_DDE_DATA, lParam); <span class="comment">// not reused so free it.</span>
00454     }
00455     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00456 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="stdptcl.c::ClStartAdvise" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClStartAdvise           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pxi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00067">67</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01479">AllocAndSetDDEData()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00190">ClRespAdviseAck()</a>, <a class="el" href="../../d6/d4/ddetrack_8h.html#a23">DDE_DATA</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00118">FNRESPONSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00132">tagXACT_INFO::hDDESent</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00490">IncGlobalAtomCount()</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00846">LinkTransaction()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00125">tagXACT_INFO::pfnResponse</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00116">PXACT_INFO</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00128">tagXACT_INFO::wType</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00024">DdeClientTransaction()</a>, and <a class="el" href="../../d7/d4/connect_8c-source.html#l00409">DdeReconnect()</a>.
<p>
<pre class="fragment"><div>00069 {
00070     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
00071 
00072     <span class="comment">//</span>
00073     <span class="comment">// protocol quirk: DDE_FRELEASE is always assumed set in a WM_DDE_ADVISE</span>
00074     <span class="comment">// message. We set it here just in case the dork on the other end</span>
00075     <span class="comment">// pays attention to it.</span>
00076     <span class="comment">//</span>
00077     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a> = <a class="code" href="../../d2/d6/stdptcl_8c.html#a22">AllocAndSetDDEData</a>(NULL, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d2/structtagDDE__DATA.html">DDE_DATA</a>),
00078             (WORD)(((pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a> &lt;&lt; 12) &amp; (DDE_FDEFERUPD | DDE_FACKREQ)) | DDE_FRELEASE),
00079             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>);
00080     <span class="keywordflow">if</span> (!pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>) {
00081         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_MEMORY_ERROR);
00082         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00083     }
00084 
00085     <a class="code" href="../../d4/d2/hsz_8c.html#a14">IncGlobalAtomCount</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// message copy</span>
00086     dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, 0, WM_DDE_ADVISE,
00087             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, 0, HandleToUlong(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>), pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>);
00088     <span class="keywordflow">if</span> (dwError) {
00089         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
00090         <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>);
00091         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a> = 0;
00092         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// message copy</span>
00093         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00094     }
00095 
00096     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_ADVSENT;
00097     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o4">pfnResponse</a> = (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a58">FNRESPONSE</a>)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a143">ClRespAdviseAck</a>;
00098     <a class="code" href="../../d0/d1/xact_8c.html#a10">LinkTransaction</a>(pxi);
00099     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00100 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="stdptcl.c::ClStartExecute" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClStartExecute           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pxi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00852">852</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00958">ClRespExecuteAck()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00200">tagCL_INSTANCE_INFO::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00118">FNRESPONSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00132">tagXACT_INFO::hDDESent</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00206">IIF_UNICODE</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00846">LinkTransaction()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00791">MaybeTranslateExecuteData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00125">tagXACT_INFO::pfnResponse</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00219">tagCONV_INFO::state</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00024">DdeClientTransaction()</a>.
<p>
<pre class="fragment"><div>00854 {
00855     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
00856 
00857     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a> = <a class="code" href="../../d2/d6/stdptcl_8c.html#a10">MaybeTranslateExecuteData</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>,
00858             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o16">flags</a> &amp; IIF_UNICODE,
00859             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_UNICODE_EXECUTE,
00860             TRUE);
00861 
00862     dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, 0, WM_DDE_EXECUTE,
00863             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, 0, 0, HandleToUlong(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>));
00864     <span class="keywordflow">if</span> (dwError) {
00865         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
00866         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00867     }
00868     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_EXECSENT;
00869     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o4">pfnResponse</a> = (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a58">FNRESPONSE</a>)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a151">ClRespExecuteAck</a>;
00870     <a class="code" href="../../d0/d1/xact_8c.html#a10">LinkTransaction</a>(pxi);
00871     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00872 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="stdptcl.c::ClStartPoke" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClStartPoke           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pxi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01012">1012</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01116">ClRespPokeAck()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00118">FNRESPONSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00132">tagXACT_INFO::hDDESent</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00490">IncGlobalAtomCount()</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00846">LinkTransaction()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00125">tagXACT_INFO::pfnResponse</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00024">DdeClientTransaction()</a>.
<p>
<pre class="fragment"><div>01014 {
01015     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
01016 
01017     <a class="code" href="../../d4/d2/hsz_8c.html#a14">IncGlobalAtomCount</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// message copy</span>
01018     dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, 0, WM_DDE_POKE,
01019             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, 0, HandleToUlong(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>), pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>);
01020     <span class="keywordflow">if</span> (dwError) {
01021         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
01022         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// message copy</span>
01023         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01024     }
01025 
01026     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_POKESENT;
01027     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o4">pfnResponse</a> = (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a58">FNRESPONSE</a>)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a154">ClRespPokeAck</a>;
01028     <a class="code" href="../../d0/d1/xact_8c.html#a10">LinkTransaction</a>(pxi);
01029     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01030 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="stdptcl.c::ClStartRequest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClStartRequest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pxi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01176">1176</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">ClRespRequestData()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00118">FNRESPONSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00490">IncGlobalAtomCount()</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00846">LinkTransaction()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00125">tagXACT_INFO::pfnResponse</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00024">DdeClientTransaction()</a>.
<p>
<pre class="fragment"><div>01178 {
01179     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
01180 
01181     <a class="code" href="../../d4/d2/hsz_8c.html#a14">IncGlobalAtomCount</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// message copy</span>
01182     dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, 0, WM_DDE_REQUEST,
01183             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, 0, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>);
01184     <span class="keywordflow">if</span> (dwError) {
01185         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
01186         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// message copy</span>
01187         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01188     }
01189 
01190     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_REQSENT;
01191     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o4">pfnResponse</a> = (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a58">FNRESPONSE</a>)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a157">ClRespRequestData</a>;
01192     <a class="code" href="../../d0/d1/xact_8c.html#a10">LinkTransaction</a>(pxi);
01193     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01194 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="stdptcl.c::ClStartUnadvise" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ClStartUnadvise           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pxi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00561">561</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00719">ClRespUnadviseAck()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00118">FNRESPONSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00490">IncGlobalAtomCount()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00215">tagCONV_INFO::laService</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00846">LinkTransaction()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00031">MONLINK</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00125">tagXACT_INFO::pfnResponse</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00219">tagCONV_INFO::state</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00024">DdeClientTransaction()</a>.
<p>
<pre class="fragment"><div>00563 {
00564     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
00565 
00566     <a class="code" href="../../d4/d2/hsz_8c.html#a14">IncGlobalAtomCount</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// message copy</span>
00567     dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, 0, WM_DDE_UNADVISE,
00568             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, 0, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>);
00569     <span class="keywordflow">if</span> (dwError) {
00570         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
00571         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// message copy</span>
00572         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00573     }
00574 
00575     <span class="comment">//</span>
00576     <span class="comment">// only server side reports links on local conversations.</span>
00577     <span class="comment">//</span>
00578     <span class="keywordflow">if</span> (!(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_ISLOCAL)) {
00579         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a4">MONLINK</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, FALSE, 0,
00580                 pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o4">laService</a>, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>,
00581                 pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>, FALSE, (HCONV)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>,
00582                 (HCONV)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>);
00583     }
00584     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_UNADVSENT;
00585     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o4">pfnResponse</a> = (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a58">FNRESPONSE</a>)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a149">ClRespUnadviseAck</a>;
00586     <a class="code" href="../../d0/d1/xact_8c.html#a10">LinkTransaction</a>(pxi);
00587     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00588 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="stdptcl.c::ExtractDDEDataInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ExtractDDEDataInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hDDE</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pwStatus</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pwFmt</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01591">1591</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00019">tagDDE_DATA::wFmt</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00018">tagDDE_DATA::wStatus</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">ClRespRequestData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00112">SvSpontAdvise()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01042">SvSpontPoke()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01207">SvSpontRequest()</a>.
<p>
<pre class="fragment"><div>01595 {
01596     <a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a> pdde;
01597 
01598     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDE, pdde);
01599     <span class="keywordflow">if</span> (pdde == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01600         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01601     }
01602     *pwStatus = pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o0">wStatus</a>;
01603     *pwFmt = pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o1">wFmt</a>;
01604     <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
01605     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01606 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="stdptcl.c::MaybeTranslateExecuteData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE MaybeTranslateExecuteData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hDDE</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fUnicodeFrom</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fUnicodeTo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fFreeSource</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00791">791</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00125">UserGlobalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00852">ClStartExecute()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00885">SvSpontExecute()</a>.
<p>
<pre class="fragment"><div>00796 {
00797     PSTR pstr;
00798     PWSTR pwstr;
00799     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb;
00800     HANDLE hDDEnew;
00801 
00802     <span class="keywordflow">if</span> (fUnicodeFrom &amp;&amp; !fUnicodeTo) {
00803         <span class="comment">// translate data from UNICODE to ANSII</span>
00804         cb = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(GlobalSize(hDDE) &gt;&gt; 1);
00805         hDDEnew = <a class="code" href="../../d6/d0/usercli_8h.html#a3">UserGlobalAlloc</a>(GMEM_DDESHARE | GMEM_MOVEABLE, cb);
00806         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDEnew, pstr);
00807         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDE, pwstr);
00808         <span class="keywordflow">if</span> (pstr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; pwstr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00809             WCSToMB(pwstr, -1, &amp;pstr, cb, FALSE);
00810         }
00811         <span class="keywordflow">if</span> (pwstr) {
00812             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
00813         }
00814         <span class="keywordflow">if</span> (pstr) {
00815             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDEnew);
00816         }
00817     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fUnicodeFrom &amp;&amp; fUnicodeTo) {
00818         <span class="comment">// translate data from ANSII to UNICODE</span>
00819         cb = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(GlobalSize(hDDE) &lt;&lt; 1);
00820         hDDEnew = <a class="code" href="../../d6/d0/usercli_8h.html#a3">UserGlobalAlloc</a>(GMEM_DDESHARE | GMEM_MOVEABLE, cb);
00821         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDEnew, pwstr);
00822         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDE, pstr);
00823         <span class="keywordflow">if</span> (pwstr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; pstr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00824             MBToWCS(pstr, -1, &amp;pwstr, cb, FALSE);
00825         }
00826         <span class="keywordflow">if</span> (pstr) {
00827             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
00828         }
00829         <span class="keywordflow">if</span> (pwstr) {
00830             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDEnew);
00831         }
00832     } <span class="keywordflow">else</span> {
00833         <span class="keywordflow">return</span> (hDDE); <span class="comment">// no translation needed.</span>
00834     }
00835     <span class="keywordflow">if</span> (fFreeSource) {
00836         <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(hDDE);
00837     }
00838     <span class="keywordflow">return</span> (hDDEnew);
00839 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="stdptcl.c::PackAndPostMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> PackAndPostMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwndTo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msgIn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msgOut</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwndFrom</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>uiLo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>uiHi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">1534</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00058">CheckDDECritIn</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00059">CheckDDECritOut</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00061">FAIL_POST</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00064">FAILNOFREE_POST</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00642">FreeDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00666">ReuseDDElParam()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">ClRespRequestData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00362">ClSpontAdviseData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00067">ClStartAdvise()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00852">ClStartExecute()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01012">ClStartPoke()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01176">ClStartRequest()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00561">ClStartUnadvise()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00112">SvSpontAdvise()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00885">SvSpontExecute()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01042">SvSpontPoke()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01207">SvSpontRequest()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00640">SvSpontUnadvise()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00263">SvStartAdviseUpdate()</a>.
<p>
<pre class="fragment"><div>01542 {
01543     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> retval;
01544 
01545     lParam = <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a10">ReuseDDElParam</a>(lParam, msgIn, msgOut, uiLo, uiHi);
01546     <span class="keywordflow">if</span> (!lParam) {
01547         <span class="keywordflow">return</span> (DMLERR_MEMORY_ERROR);
01548     }
01549     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a8">CheckDDECritIn</a>;
01550     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
01551     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a9">CheckDDECritOut</a>;
01552 
01553     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(hwndTo, msgOut, (WPARAM)hwndFrom, lParam);
01554     <span class="keywordflow">switch</span> (retval) {
01555     <span class="keywordflow">case</span> <a class="code" href="../../d6/d4/ddetrack_8h.html#a17">FAIL_POST</a>:
01556 <span class="preprocessor">#if (FAIL_POST != FALSE)</span>
01557 <span class="preprocessor"></span><span class="preprocessor">#error FAIL_POST must be defined as PostMessage's failure return value.</span>
01558 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
01559 <span class="preprocessor"></span>        <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a>(msgOut, lParam);
01560         RIPMSG0(RIP_WARNING, <span class="stringliteral">"PostMessage failed."</span>);
01561         <span class="comment">/* Fall through */</span>
01562 
01563     <span class="keywordflow">case</span> <a class="code" href="../../d6/d4/ddetrack_8h.html#a20">FAILNOFREE_POST</a>:
01564         retval = DMLERR_POSTMSG_FAILED;
01565         <span class="keywordflow">break</span>;
01566 
01567     <span class="keywordflow">default</span>:
01568 <span class="preprocessor">#if (FAKE_POST != TRUE)</span>
01569 <span class="preprocessor"></span><span class="preprocessor">#error FAKE_POST must be defined as PostMessage's success return value.</span>
01570 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
01571 <span class="preprocessor"></span>        UserAssert(retval == TRUE);
01572         retval = 0;
01573     }
01574 
01575     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
01576     <span class="keywordflow">return</span> (retval);
01577 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="stdptcl.c::SpontaneousClientMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SpontaneousClientMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pci</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01396">1396</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00231">tagCL_CONV_INFO::ci</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00362">ClSpontAdviseData()</a>, <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00714">DumpDDEMessage()</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d7/d4/connect_8c-source.html#l01109">ShutdownConversation()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00219">tagCONV_INFO::state</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00190">ClRespAdviseAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00958">ClRespExecuteAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01116">ClRespPokeAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">ClRespRequestData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00719">ClRespUnadviseAck()</a>, and <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00782">ProcessSyncDDEMessage()</a>.
<p>
<pre class="fragment"><div>01400 {
01401     <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
01402     <span class="keywordflow">case</span> WM_DDE_DATA:
01403         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a4">ClSpontAdviseData</a>(pci, lParam));
01404         <span class="keywordflow">break</span>;
01405 
01406     <span class="keywordflow">default</span>:
01407         <a class="code" href="../../d3/d4/ddemlwp_8c.html#a7">DumpDDEMessage</a>(!(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_INTRA_PROCESS), msg, lParam);
01408         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a113">ShutdownConversation</a>((<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)pci, TRUE);
01409         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01410     }
01411 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="stdptcl.c::SpontaneousServerMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SpontaneousServerMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>psi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01424">1424</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00237">tagSVR_CONV_INFO::ci</a>, <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00714">DumpDDEMessage()</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00219">tagCONV_INFO::state</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00112">SvSpontAdvise()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00885">SvSpontExecute()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01042">SvSpontPoke()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01207">SvSpontRequest()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00640">SvSpontUnadvise()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00782">ProcessSyncDDEMessage()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00470">SvRespAdviseDataAck()</a>.
<p>
<pre class="fragment"><div>01428 {
01429     <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
01430     <span class="keywordflow">case</span> WM_DDE_ADVISE:
01431         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a1">SvSpontAdvise</a>(psi, lParam));
01432         <span class="keywordflow">break</span>;
01433 
01434     <span class="keywordflow">case</span> WM_DDE_UNADVISE:
01435         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a8">SvSpontUnadvise</a>(psi, lParam));
01436         <span class="keywordflow">break</span>;
01437 
01438     <span class="keywordflow">case</span> WM_DDE_EXECUTE:
01439         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a12">SvSpontExecute</a>(psi, lParam));
01440         <span class="keywordflow">break</span>;
01441 
01442     <span class="keywordflow">case</span> WM_DDE_POKE:
01443         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a15">SvSpontPoke</a>(psi, lParam));
01444         <span class="keywordflow">break</span>;
01445 
01446     <span class="keywordflow">case</span> WM_DDE_REQUEST:
01447         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a18">SvSpontRequest</a>(psi, lParam));
01448         <span class="keywordflow">break</span>;
01449 
01450     <span class="keywordflow">default</span>:
01451         <a class="code" href="../../d3/d4/ddemlwp_8c.html#a7">DumpDDEMessage</a>(!(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_INTRA_PROCESS), msg, lParam);
01452 
01453         <span class="comment">/*</span>
01454 <span class="comment">         * It use to call ShutdownConversation here. Don't call it</span>
01455 <span class="comment">         * anymore. Fix for bugs: 49063, 70906</span>
01456 <span class="comment">         */</span>
01457         <span class="comment">//ShutdownConversation((PCONV_INFO)psi, TRUE);</span>
01458         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01459     }
01460 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="stdptcl.c::SvRespAdviseDataAck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SvRespAdviseDataAck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pxi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00470">470</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00153">ADVST_WAITING</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00225">tagCONV_INFO::aLinks</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00226">tagCONV_INFO::cLinks</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00016">DDEMLAlloc</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00491">FreeDDEData()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00642">FreeDDElParam()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00025">GATOM</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00464">GlobalToLocalAtom()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00132">tagXACT_INFO::hDDESent</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00147">tagADVISE_LINK::laItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00024">LATOM</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01424">SpontaneousServerMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00150">tagADVISE_LINK::state</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00885">UnlinkTransaction()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">UnpackDDElParam()</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00611">UpdateLinkIfChanged()</a>, and <a class="el" href="../../d0/d4/ddemlcli_8h.html#a59">XACT_INFO</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00263">SvStartAdviseUpdate()</a>, and <a class="el" href="../../d1/d0/xact_8c-source.html#l00611">UpdateLinkIfChanged()</a>.
<p>
<pre class="fragment"><div>00474 {
00475     UINT_PTR uiLo, uiHi;
00476     <span class="keywordtype">int</span> iLink;
00477     <a class="code" href="../../d2/d8/structtagADVISE__LINK.html">PADVISE_LINK</a> paLink;
00478     <a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxiNew;
00479     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> la;
00480     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSwapped;
00481 <span class="preprocessor">#if DBG</span>
00482 <span class="preprocessor"></span>    <span class="keywordtype">int</span> cLinks;
00483 <span class="preprocessor">#endif</span>
00484 <span class="preprocessor"></span>
00485     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00486         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> != WM_DDE_ACK) {
00487             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a21">SpontaneousServerMessage</a>((<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
00488         }
00489         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_ACK, lParam, &amp;uiLo, &amp;uiHi);
00490         <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d4/ddemlcli_8h.html#a52">GATOM</a>)uiHi != pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>) {
00491             RIPMSG0(RIP_ERROR, <span class="stringliteral">"DDE Protocol violation: Data ACK had wrong item"</span>);
00492             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a21">SpontaneousServerMessage</a>((<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>, msg, lParam));
00493         }
00494 
00495         GlobalDeleteAtom((ATOM)uiHi); <span class="comment">// message copy</span>
00496         <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a>(WM_DDE_ACK, lParam);
00497 
00498         <span class="keywordflow">if</span> (!((uiLo &amp; DDE_FACK) &amp;&amp; pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>)) {
00499             <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>, FALSE, TRUE);
00500         }
00501 
00502 <span class="preprocessor">        #if DBG</span>
00503 <span class="preprocessor"></span>        <span class="comment">/*</span>
00504 <span class="comment">         * Rememeber the number of links so we can assert if they change during the loop below</span>
00505 <span class="comment">         */</span>
00506         cLinks = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>;
00507 <span class="preprocessor">        #endif</span>
00508 <span class="preprocessor"></span>        <span class="comment">/*</span>
00509 <span class="comment">         * locate link info and clear ADVST_WAITING bit</span>
00510 <span class="comment">         */</span>
00511         la = <a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>((GATOM)uiHi);
00512         paLink = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o14">aLinks</a>;
00513         <span class="keywordflow">for</span> (iLink = 0; iLink &lt; pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>; iLink++, paLink++) {
00514             <span class="keywordflow">if</span> (paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o1">laItem</a> == la &amp;&amp;
00515                     paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o4">state</a> &amp; <a class="code" href="../../d0/d4/ddemlcli_8h.html#a47">ADVST_WAITING</a>) {
00516                 paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o4">state</a> &amp;= ~<a class="code" href="../../d0/d4/ddemlcli_8h.html#a47">ADVST_WAITING</a>;
00517                 <span class="comment">/*</span>
00518 <span class="comment">                 * We have to allocate pxiNew because it may become linked</span>
00519 <span class="comment">                 * into pcoi-&gt;pxiIn.</span>
00520 <span class="comment">                 */</span>
00521                 pxiNew = (<a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a0">DDEMLAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d0/structtagXACT__INFO.html">XACT_INFO</a>));
00522 
00523                 <span class="keywordflow">if</span> (pxiNew &amp;&amp; !<a class="code" href="../../d0/d1/xact_8c.html#a8">UpdateLinkIfChanged</a>(paLink, pxiNew, pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>,
00524                         &amp;pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o14">aLinks</a>[pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a> - 1], &amp;fSwapped,
00525                         CADV_LATEACK)) {
00526                     <span class="comment">/*</span>
00527 <span class="comment">                     * Not used, free it.</span>
00528 <span class="comment">                     */</span>
00529                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxiNew);
00530                 }
00531                 <span class="keywordflow">break</span>;
00532             }
00533         }
00534 <span class="preprocessor">        #if DBG</span>
00535 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (cLinks != pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>) {
00536             RIPMSG1(RIP_ERROR, <span class="stringliteral">"SvRespAdviseDataAck: cLinks changed. pxi:%#p"</span>, pxi);
00537         }
00538 <span class="preprocessor">        #endif</span>
00539 <span class="preprocessor"></span>
00540         DeleteAtom(la);
00541     }
00542     GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// pxi copy</span>
00543     <a class="code" href="../../d0/d1/xact_8c.html#a11">UnlinkTransaction</a>(pxi);
00544     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxi);
00545     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00546 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="stdptcl.c::SvSpontAdvise" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SvSpontAdvise           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>psi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00112">112</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d3/d1/util_8c-source.html#l00023">AddLink()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00191">tagCL_INSTANCE_INFO::afCmd</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00237">tagSVR_CONV_INFO::ci</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00024">DoCallback()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01591">ExtractDDEDataInfo()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00025">GATOM</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00464">GlobalToLocalAtom()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00214">tagCONV_INFO::hConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00215">tagCONV_INFO::laService</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00024">LATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00031">MONLINK</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00070">NORMAL_HSZ_FROM_LATOM</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d0/d4/ddemlcli_8h.html#a75">PSVR_CONV_INFO</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">UnpackDDElParam()</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01424">SpontaneousServerMessage()</a>.
<p>
<pre class="fragment"><div>00115 {
00116     UINT_PTR uiHi;
00117     HANDLE hDDE;
00118     WORD wFmt, wStatus;
00119     ULONG_PTR dwRet = 0;
00120     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
00121     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> la;
00122 
00123     <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_ADVISE, lParam, (PUINT_PTR)&amp;hDDE, &amp;uiHi);
00124     <span class="keywordflow">if</span> (psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o7">afCmd</a> &amp; CBF_FAIL_ADVISES) {
00125         <span class="keywordflow">goto</span> Ack;
00126     }
00127 
00128     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d6/stdptcl_8c.html#a24">ExtractDDEDataInfo</a>(hDDE, &amp;wStatus, &amp;wFmt)) {
00129         <span class="keywordflow">goto</span> Ack;
00130     }
00131 
00132     <span class="keywordflow">if</span> (wStatus &amp; DDE_FDEFERUPD) {
00133         wStatus &amp;= ~DDE_FACKREQ;   <span class="comment">// warm links shouldn't have this flag set</span>
00134     }
00135 
00136     la = <a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>((GATOM)uiHi);
00137     dwRet = (ULONG_PTR)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a127">DoCallback</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>,
00138         XTYP_ADVSTART,
00139         wFmt, psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>,
00140         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>),
00141         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(la),
00142         (HDDEDATA)0, 0, 0);
00143     DeleteAtom(la);
00144 
00145     <span class="comment">// check CBR_BLOCK case</span>
00146 
00147     <span class="keywordflow">if</span> (dwRet == (ULONG_PTR)CBR_BLOCK) {
00148         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00149     }
00150 
00151     <span class="keywordflow">if</span> (dwRet) {
00152         <span class="comment">//</span>
00153         <span class="comment">// If we fail to add the link internally, dwRet == 0 -&gt; NACK</span>
00154         <span class="comment">//</span>
00155         dwRet = <a class="code" href="../../d2/d2/util_8c.html#a0">AddLink</a>((<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)psi, (GATOM)uiHi, wFmt,
00156                 (WORD)(wStatus &amp; (WORD)(DDE_FDEFERUPD | DDE_FACKREQ)));
00157         <span class="keywordflow">if</span> (dwRet) {
00158             <a class="code" href="../../d0/d4/ddemlcli_8h.html#a4">MONLINK</a>(psi-&gt;ci.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, TRUE, wStatus &amp; DDE_FDEFERUPD, psi-&gt;ci.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o4">laService</a>,
00159                     psi-&gt;ci.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>, (GATOM)uiHi, wFmt, TRUE,
00160                     (HCONV)psi-&gt;ci.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, (HCONV)psi-&gt;ci.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>);
00161         }
00162     }
00163 
00164 Ack:
00165     <span class="keywordflow">if</span> (dwRet) {
00166         <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(hDDE); <span class="comment">// hOptions - NACK -&gt; HE frees it.</span>
00167     }
00168     <span class="comment">// IncGlobalAtomCount((GATOM)uiHi);         // message copy - reuse</span>
00169     dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(psi-&gt;ci.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, WM_DDE_ADVISE, WM_DDE_ACK,
00170             psi-&gt;ci.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, lParam, dwRet ? DDE_FACK : 0, uiHi);
00171     <span class="keywordflow">if</span> (dwError) {
00172         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;ci.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
00173         GlobalDeleteAtom((ATOM)uiHi); <span class="comment">// message copy</span>
00174     }
00175 
00176     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00177 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="stdptcl.c::SvSpontExecute" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SvSpontExecute           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>psi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00885">885</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00191">tagCL_INSTANCE_INFO::afCmd</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00237">tagSVR_CONV_INFO::ci</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00024">DoCallback()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00200">tagCL_INSTANCE_INFO::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00214">tagCONV_INFO::hConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00206">IIF_UNICODE</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00094">InternalCreateDataHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00791">MaybeTranslateExecuteData()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00070">NORMAL_HSZ_FROM_LATOM</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00219">tagCONV_INFO::state</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01708">UnpackAndFreeDDEMLDataHandle()</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01424">SpontaneousServerMessage()</a>.
<p>
<pre class="fragment"><div>00888 {
00889     HANDLE hDDE, hDDEx;
00890     ULONG_PTR dwRet = 0;
00891     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
00892     HDDEDATA hData = 0;
00893 
00894     hDDEx = hDDE = (HANDLE)lParam; <span class="comment">// UnpackDDElParam(msg, lParam, NULL, &amp;hDDE);</span>
00895     <span class="keywordflow">if</span> (psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o7">afCmd</a> &amp; CBF_FAIL_EXECUTES) {
00896         <span class="keywordflow">goto</span> Ack;
00897     }
00898 
00899     <span class="comment">/*</span>
00900 <span class="comment">     * Note that if unicode translation is needed, we use the translated</span>
00901 <span class="comment">     * handle for the callback and then destroy it but the ACK is always</span>
00902 <span class="comment">     * the original hDDE so that the protocol isn't violated:</span>
00903 <span class="comment">     *</span>
00904 <span class="comment">     * DDE COMMANDMENT #324: Thou shalt pass back the exact same data</span>
00905 <span class="comment">     * handle in an execute ACK that you were given by the execute</span>
00906 <span class="comment">     * message.</span>
00907 <span class="comment">     */</span>
00908     hDDEx = <a class="code" href="../../d2/d6/stdptcl_8c.html#a10">MaybeTranslateExecuteData</a>(hDDE,
00909             psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_UNICODE_EXECUTE,
00910             psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o16">flags</a> &amp; IIF_UNICODE,
00911             FALSE);
00912 
00913     hData = <a class="code" href="../../d0/d9/hdata_8c.html#a2">InternalCreateDataHandle</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, (LPBYTE)hDDEx, (DWORD)-1, 0,
00914         HDATA_EXECUTE | HDATA_READONLY | HDATA_NOAPPFREE, 0, 0);
00915     <span class="keywordflow">if</span> (!hData) {
00916         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_MEMORY_ERROR);
00917         <span class="keywordflow">goto</span> Ack;
00918     }
00919 
00920     dwRet = (ULONG_PTR)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a127">DoCallback</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>,
00921             XTYP_EXECUTE, 0, psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>,
00922             <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>), 0, hData, 0, 0);
00923     <a class="code" href="../../d2/d6/stdptcl_8c.html#a26">UnpackAndFreeDDEMLDataHandle</a>(hData, TRUE);
00924 
00925     <span class="keywordflow">if</span> (dwRet == (ULONG_PTR)CBR_BLOCK) {
00926         <span class="keywordflow">if</span> (hDDEx != hDDE) {
00927             <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(hDDEx);
00928         }
00929         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00930     }
00931 
00932 Ack:
00933     dwRet &amp;= ~DDE_FACKRESERVED;
00934     dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, WM_DDE_EXECUTE,
00935             WM_DDE_ACK, psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, lParam, (DWORD)dwRet, HandleToUlong(hDDE));
00936     <span class="keywordflow">if</span> (dwError) {
00937         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
00938     }
00939 
00940     <span class="keywordflow">if</span> (hDDEx != hDDE) {
00941         <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(hDDEx);
00942     }
00943 
00944     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00945 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="stdptcl.c::SvSpontPoke" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SvSpontPoke           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>psi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01042">1042</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00191">tagCL_INSTANCE_INFO::afCmd</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00237">tagSVR_CONV_INFO::ci</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00024">DoCallback()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01591">ExtractDDEDataInfo()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00491">FreeDDEData()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00025">GATOM</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00464">GlobalToLocalAtom()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00214">tagCONV_INFO::hConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00094">InternalCreateDataHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00024">LATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00070">NORMAL_HSZ_FROM_LATOM</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01708">UnpackAndFreeDDEMLDataHandle()</a>, and <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">UnpackDDElParam()</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01424">SpontaneousServerMessage()</a>.
<p>
<pre class="fragment"><div>01045 {
01046     UINT_PTR uiHi;
01047     HANDLE hDDE = 0;
01048     HDDEDATA hData;
01049     ULONG_PTR dwRet = 0;
01050     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
01051     WORD wFmt, wStatus;
01052     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> al;
01053 
01054     <span class="comment">// See what we have</span>
01055 
01056     <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a>(WM_DDE_DATA, lParam, (PUINT_PTR)&amp;hDDE, &amp;uiHi);
01057 
01058     <span class="keywordflow">if</span> (!(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o7">afCmd</a> &amp; CBF_FAIL_POKES)) {
01059         <span class="keywordflow">if</span> (!hDDE) {
01060             <span class="keywordflow">goto</span> Ack;
01061         }
01062         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d6/stdptcl_8c.html#a24">ExtractDDEDataInfo</a>(hDDE, &amp;wStatus, &amp;wFmt)) {
01063             <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(hDDE, FALSE, TRUE);             <span class="comment">// free message data</span>
01064             <span class="keywordflow">goto</span> Ack;
01065         }
01066 
01067         hData = <a class="code" href="../../d0/d9/hdata_8c.html#a2">InternalCreateDataHandle</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, (LPBYTE)hDDE, (DWORD)-1, 0,
01068                 HDATA_NOAPPFREE | HDATA_READONLY, 0, 0);
01069         <span class="keywordflow">if</span> (!hData) {
01070             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_MEMORY_ERROR);
01071             <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(hDDE, FALSE, TRUE);       <span class="comment">// free message data</span>
01072             <span class="keywordflow">goto</span> Ack;                             <span class="comment">// Nack it.</span>
01073             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01074         }
01075 
01076         al = <a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>((GATOM)uiHi);
01077             dwRet = (ULONG_PTR)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a127">DoCallback</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, XTYP_POKE,
01078                     wFmt, psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>,
01079                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>),
01080                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(al),
01081                     hData, 0, 0);
01082         DeleteAtom(al);
01083         <a class="code" href="../../d2/d6/stdptcl_8c.html#a26">UnpackAndFreeDDEMLDataHandle</a>(hData, FALSE);
01084     }
01085     <span class="keywordflow">if</span> (dwRet == (ULONG_PTR)CBR_BLOCK) {
01086 
01087         <span class="comment">// Note: this code makes an app that return s CBR_BLOCK unable to</span>
01088         <span class="comment">// access the data after the callback return .</span>
01089 
01090         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01091     }
01092     <span class="keywordflow">if</span> (dwRet &amp; DDE_FACK) {
01093         <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(hDDE, FALSE, TRUE);
01094     }
01095 
01096 Ack:
01097     dwRet &amp;= ~DDE_FACKRESERVED;
01098     dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, WM_DDE_POKE, WM_DDE_ACK,
01099             psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, lParam, dwRet, uiHi);
01100     <span class="keywordflow">if</span> (dwError) {
01101         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
01102     }
01103     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01104 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="stdptcl.c::SvSpontRequest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SvSpontRequest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>psi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01207">1207</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00191">tagCL_INSTANCE_INFO::afCmd</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01479">AllocAndSetDDEData()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00237">tagSVR_CONV_INFO::ci</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00660">CopyDDEData()</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00024">DoCallback()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01591">ExtractDDEDataInfo()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00025">GATOM</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00464">GlobalToLocalAtom()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00214">tagCONV_INFO::hConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00024">LATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00070">NORMAL_HSZ_FROM_LATOM</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01708">UnpackAndFreeDDEMLDataHandle()</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01424">SpontaneousServerMessage()</a>.
<p>
<pre class="fragment"><div>01210 {
01211     HANDLE hDDE = 0;
01212     HDDEDATA hDataRet;
01213     WORD wFmt, wStatus;
01214     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
01215     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> la;
01216 
01217     <span class="keywordflow">if</span> (psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o7">afCmd</a> &amp; CBF_FAIL_REQUESTS) {
01218         <span class="keywordflow">goto</span> Nack;
01219     }
01220     <span class="comment">// See what we have</span>
01221 
01222     <span class="comment">// UnpackDDElParam(lParam, WM_DDE_REQUEST, .... Requests arn't packed</span>
01223     wFmt = LOWORD(lParam);
01224     la = <a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>((GATOM)HIWORD(lParam));
01225     hDataRet = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a127">DoCallback</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, XTYP_REQUEST,
01226             wFmt, psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>,
01227             <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>),
01228             <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(la),
01229             (HDDEDATA)0, 0, 0);
01230     DeleteAtom(la);
01231 
01232     <span class="keywordflow">if</span> (hDataRet == CBR_BLOCK) {
01233         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01234     }
01235 
01236     <span class="keywordflow">if</span> (hDataRet) {
01237 
01238         hDDE = <a class="code" href="../../d2/d6/stdptcl_8c.html#a26">UnpackAndFreeDDEMLDataHandle</a>(hDataRet, FALSE);
01239         <span class="keywordflow">if</span> (!hDDE) {
01240             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_DLL_USAGE);
01241             <span class="keywordflow">goto</span> Nack;
01242         }
01243         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d6/stdptcl_8c.html#a24">ExtractDDEDataInfo</a>(hDDE, &amp;wStatus, &amp;wFmt)) {
01244             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_DLL_USAGE);
01245             <span class="keywordflow">goto</span> Nack;
01246         }
01247         <span class="keywordflow">if</span> (!(wStatus &amp; DDE_FRELEASE)) {
01248             <span class="comment">// Its APPOWNED or relayed from another server - only safe</span>
01249             <span class="comment">// thing to do is use a copy.</span>
01250             hDDE = <a class="code" href="../../d0/d9/hdata_8c.html#a13">CopyDDEData</a>(hDDE, FALSE);
01251             <span class="keywordflow">if</span> (!hDDE) {
01252                 <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_MEMORY_ERROR);
01253                 <span class="keywordflow">goto</span> Nack;
01254             }
01255         }
01256 
01257         <span class="comment">// Keep it simple, DDEML servers never ask for acks from requests.</span>
01258 
01259         wStatus = DDE_FRELEASE | DDE_FREQUESTED;
01260         <a class="code" href="../../d2/d6/stdptcl_8c.html#a22">AllocAndSetDDEData</a>((LPBYTE)hDDE, (DWORD)-1, wStatus, wFmt);
01261 
01262         <span class="comment">// just reuse HIWORD(lParam) (aItem) - message copy</span>
01263         <span class="keywordflow">if</span> (dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, WM_DDE_REQUEST,
01264                 WM_DDE_DATA, psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, 0, HandleToUlong(hDDE), HIWORD(lParam))) {
01265             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
01266             GlobalDeleteAtom(HIWORD(lParam)); <span class="comment">// message copy</span>
01267         }
01268 
01269     } <span class="keywordflow">else</span> {
01270 Nack:
01271         <span class="comment">// just reuse HIWORD(lParam) (aItem) - message copy</span>
01272         dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, WM_DDE_REQUEST,
01273                 WM_DDE_ACK, psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, 0, 0, HIWORD(lParam));
01274         <span class="keywordflow">if</span> (dwError) {
01275             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
01276             GlobalDeleteAtom(HIWORD(lParam)); <span class="comment">// message copy</span>
01277         }
01278     }
01279 
01280     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01281 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="stdptcl.c::SvSpontUnadvise" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SvSpontUnadvise           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>psi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00640">640</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d0/d4/ddemlcli_8h.html#a61">ADVISE_LINK</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00191">tagCL_INSTANCE_INFO::afCmd</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00225">tagCONV_INFO::aLinks</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00237">tagSVR_CONV_INFO::ci</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00226">tagCONV_INFO::cLinks</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00599">CloseTransaction()</a>, <a class="el" href="../../d3/d1/util_8c-source.html#l00123">DeleteLinkCount()</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00024">DoCallback()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00025">GATOM</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00464">GlobalToLocalAtom()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00214">tagCONV_INFO::hConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00147">tagADVISE_LINK::laItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00215">tagCONV_INFO::laService</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00024">LATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00031">MONLINK</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00070">NORMAL_HSZ_FROM_LATOM</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00146">tagADVISE_LINK::pLinkCount</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00148">tagADVISE_LINK::wFmt</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01424">SpontaneousServerMessage()</a>.
<p>
<pre class="fragment"><div>00643 {
00644     ULONG_PTR dwRet = 0;
00645     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
00646     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> iLink;
00647     <a class="code" href="../../d2/d8/structtagADVISE__LINK.html">PADVISE_LINK</a> aLink;
00648     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> la;
00649 
00650     la = <a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>((GATOM)HIWORD(lParam));
00651 
00652     <a class="code" href="../../d2/d6/stdptcl_8c.html#a7">CloseTransaction</a>(&amp;psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>, HIWORD(lParam));
00653 
00654     <span class="keywordflow">for</span> (aLink = psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o14">aLinks</a>, iLink = 0; iLink &lt; psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>;) {
00655 
00656         <span class="keywordflow">if</span> (la == 0 || aLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o1">laItem</a> == la &amp;&amp;
00657                 (LOWORD(lParam) == 0 || LOWORD(lParam) == aLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o2">wFmt</a>)) {
00658 
00659             <span class="keywordflow">if</span> (!(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o7">afCmd</a> &amp; CBF_FAIL_ADVISES)) {
00660                 <span class="comment">/*</span>
00661 <span class="comment">                 * Only do the callbacks if he wants them.</span>
00662 <span class="comment">                 */</span>
00663                 dwRet = (ULONG_PTR)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a127">DoCallback</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>,
00664                     (WORD)XTYP_ADVSTOP, aLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o2">wFmt</a>, psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>,
00665                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>),
00666                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(la),
00667                     (HDDEDATA)0, 0L, 0L);
00668                 <span class="keywordflow">if</span> (dwRet == (ULONG_PTR)CBR_BLOCK) {
00669                     DeleteAtom(la);
00670                     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00671                 }
00672             }
00673             <span class="comment">/*</span>
00674 <span class="comment">             * Notify any DDESPY apps.</span>
00675 <span class="comment">             */</span>
00676             <a class="code" href="../../d0/d4/ddemlcli_8h.html#a4">MONLINK</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, TRUE, 0, psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o4">laService</a>,
00677                     psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>, HIWORD(lParam), aLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o2">wFmt</a>, TRUE,
00678                     (HCONV)psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, (HCONV)psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>);
00679             <span class="comment">/*</span>
00680 <span class="comment">             * Remove link info</span>
00681 <span class="comment">             */</span>
00682             DeleteAtom(aLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o1">laItem</a>);  <span class="comment">// aLink copy</span>
00683             <a class="code" href="../../d2/d2/util_8c.html#a1">DeleteLinkCount</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, aLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o0">pLinkCount</a>);
00684             <span class="keywordflow">if</span> (--psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>) {
00685                 memmove((LPSTR)aLink, (LPSTR)(aLink + 1),
00686                         <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d8/structtagADVISE__LINK.html">ADVISE_LINK</a>) * (psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a> - iLink));
00687             }
00688         } <span class="keywordflow">else</span> {
00689             aLink++;
00690             iLink++;
00691         }
00692     }
00693 
00694     DeleteAtom(la);
00695 
00696     <span class="comment">/*</span>
00697 <span class="comment">     * Now ACK the unadvise message.</span>
00698 <span class="comment">     */</span>
00699     dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, 0,
00700             WM_DDE_ACK, psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, 0, DDE_FACK, HIWORD(lParam));
00701     <span class="keywordflow">if</span> (dwError) {
00702         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
00703         GlobalDeleteAtom((ATOM)HIWORD(lParam));      <span class="comment">// message copy</span>
00704         <span class="comment">// FreeDDElParam(WM_DDE_UNADVISE, lParam);   // no unpack needed</span>
00705     }
00706 
00707     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00708 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="stdptcl.c::SvStartAdviseUpdate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SvStartAdviseUpdate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pxi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cLinksToGo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00263">263</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00058">CheckDDECritIn</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00024">DoCallback()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00118">FNRESPONSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00464">GlobalToLocalAtom()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00214">tagCONV_INFO::hConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00132">tagXACT_INFO::hDDESent</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00490">IncGlobalAtomCount()</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00416">InternalFreeDataHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00024">LATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00846">LinkTransaction()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00070">NORMAL_HSZ_FROM_LATOM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d6/d4/ddetrack_8h.html#a24">PDDE_DATA</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00125">tagXACT_INFO::pfnResponse</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00470">SvRespAdviseDataAck()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01708">UnpackAndFreeDDEMLDataHandle()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00019">tagDDE_DATA::wFmt</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00018">tagDDE_DATA::wStatus</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00128">tagXACT_INFO::wType</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00611">UpdateLinkIfChanged()</a>.
<p>
<pre class="fragment"><div>00266 {
00267     HDDEDATA hData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00268     <a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a> pdde;
00269     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwError;
00270     HANDLE hDDE;
00271     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> al;
00272 
00273     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a8">CheckDDECritIn</a>;
00274 
00275     <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a> &amp; DDE_FDEFERUPD) {
00276         hDDE = 0;
00277     } <span class="keywordflow">else</span> {
00278         al = <a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>);
00279         hData = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a127">DoCallback</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>,
00280                            XTYP_ADVREQ,
00281                            pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>,
00282                            pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>,
00283                            <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>),
00284                            <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(al),
00285                            (HDDEDATA)0,
00286                            MAKELONG(cLinksToGo, 0),
00287                            0);
00288         DeleteAtom(al);
00289         <span class="keywordflow">if</span> (!hData) {
00290             <span class="comment">// app doesn't honor the advise.</span>
00291             <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>); <span class="comment">// reuse pxi</span>
00292         }
00293         hDDE = <a class="code" href="../../d2/d6/stdptcl_8c.html#a26">UnpackAndFreeDDEMLDataHandle</a>(hData, FALSE);
00294         <span class="keywordflow">if</span> (!hDDE) {
00295 
00296             <span class="comment">/*</span>
00297 <span class="comment">             * failed - must be execute type data</span>
00298 <span class="comment">             */</span>
00299             <a class="code" href="../../d0/d9/hdata_8c.html#a8">InternalFreeDataHandle</a>(hData, FALSE);
00300             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_DLL_USAGE);
00301             <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00302         }
00303         <span class="comment">/*</span>
00304 <span class="comment">         * Set fAckReq bit apropriately - note APPOWNED handles will already</span>
00305 <span class="comment">         * have the fAckReq bit set so this will not change their state.</span>
00306 <span class="comment">         */</span>
00307         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDE, pdde);
00308         <span class="keywordflow">if</span> (pdde == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00309             <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00310         }
00311         <span class="keywordflow">if</span> (pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o1">wFmt</a> != pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>) {
00312 
00313             <span class="comment">/*</span>
00314 <span class="comment">             * bogus data - wrong format!</span>
00315 <span class="comment">             */</span>
00316             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
00317             <a class="code" href="../../d0/d9/hdata_8c.html#a8">InternalFreeDataHandle</a>(hData, FALSE);
00318             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_DLL_USAGE);
00319             <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00320         }
00321         <span class="keywordflow">if</span> (!(pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o0">wStatus</a> &amp; DDE_FRELEASE)) {
00322             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a> |= DDE_FACKREQ; <span class="comment">// dare not allow neither flag set!</span>
00323         }
00324         pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o0">wStatus</a> |= (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a> &amp; DDE_FACKREQ);
00325         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
00326     }
00327 
00328     <a class="code" href="../../d4/d2/hsz_8c.html#a14">IncGlobalAtomCount</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// message copy</span>
00329     dwError = <a class="code" href="../../d2/d6/stdptcl_8c.html#a23">PackAndPostMessage</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, 0, WM_DDE_DATA,
00330             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, 0, HandleToUlong(hDDE), pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>);
00331     <span class="keywordflow">if</span> (dwError) {
00332         <span class="keywordflow">if</span> (hData) {
00333             <a class="code" href="../../d0/d9/hdata_8c.html#a8">InternalFreeDataHandle</a>(hData, FALSE);
00334         }
00335         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, dwError);
00336         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// message copy</span>
00337         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00338     }
00339 
00340     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a> = XST_ADVDATASENT;
00341     <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a> &amp; DDE_FACKREQ) {
00342         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a> = hDDE;
00343         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o4">pfnResponse</a> = (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a58">FNRESPONSE</a>)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a146">SvRespAdviseDataAck</a>;
00344         <a class="code" href="../../d0/d1/xact_8c.html#a10">LinkTransaction</a>(pxi);
00345         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>); <span class="comment">// prevents reuse - since its queued.</span>
00346     } <span class="keywordflow">else</span> {
00347         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>); <span class="comment">// causes pxi to be reused for next advdata message.</span>
00348     }
00349 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="stdptcl.c::TransactionComplete" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL TransactionComplete           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pxi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDDEDATA&nbsp;</td>
          <td class="mdname" nowrap> <em>hData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01624">1624</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00137">DestroyHandle()</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00024">DoCallback()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00130">tagXACT_INFO::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00464">GlobalToLocalAtom()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00214">tagCONV_INFO::hConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00133">tagXACT_INFO::hDDEResult</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00124">tagXACT_INFO::hXact</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00094">InternalCreateDataHandle()</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00416">InternalFreeDataHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00024">LATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00070">NORMAL_HSZ_FROM_LATOM</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00140">TID_TIMEOUT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00885">UnlinkTransaction()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00129">tagXACT_INFO::wStatus</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00138">XIF_ABANDONED</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00137">XIF_COMPLETE</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00136">XIF_SYNCHRONOUS</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00190">ClRespAdviseAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00958">ClRespExecuteAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01116">ClRespPokeAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">ClRespRequestData()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00719">ClRespUnadviseAck()</a>.
<p>
<pre class="fragment"><div>01627 {
01628     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> al;
01629     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fMustFree;
01630 
01631     <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a> &amp; <a class="code" href="../../d0/d4/ddemlcli_8h.html#a45">XIF_ABANDONED</a>) {
01632         UserAssert(!(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a> &amp; XIF_SYNCHRONOUS));
01633         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01634     }
01635     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a> |= <a class="code" href="../../d0/d4/ddemlcli_8h.html#a44">XIF_COMPLETE</a>;
01636     <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a> &amp; <a class="code" href="../../d0/d4/ddemlcli_8h.html#a43">XIF_SYNCHRONOUS</a>) {
01637         <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, WM_TIMER, TID_TIMEOUT, 0);
01638         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01639     } <span class="keywordflow">else</span> {
01640         <span class="keywordflow">if</span> (hData == (HDDEDATA)(-1)) {
01641             fMustFree = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01642             hData = <a class="code" href="../../d0/d9/hdata_8c.html#a2">InternalCreateDataHandle</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>,
01643                 (LPBYTE)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a>, (DWORD)-1, 0,
01644                 HDATA_NOAPPFREE | HDATA_READONLY, 0, 0);
01645         } <span class="keywordflow">else</span> {
01646             fMustFree = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01647         }
01648         al = <a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>);
01649 
01650         <span class="keywordflow">if</span> (!(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> &amp; DDE_FACK)) {
01651             <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> &amp; DDE_FBUSY) {
01652                 <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_BUSY);
01653             } <span class="keywordflow">else</span> {
01654                 <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_NOTPROCESSED);
01655             }
01656         }
01657 
01658         <span class="comment">/*</span>
01659 <span class="comment">         * During the callback the app may disconnect or otherwise kill</span>
01660 <span class="comment">         * this conversation so we unlink the pxi FIRST so cleanup code</span>
01661 <span class="comment">         * doesn't destroy it before this transaction code exits.</span>
01662 <span class="comment">         */</span>
01663         <a class="code" href="../../d0/d1/xact_8c.html#a11">UnlinkTransaction</a>(pxi);
01664 
01665         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a127">DoCallback</a>(
01666             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>,
01667             (WORD)XTYP_XACT_COMPLETE,
01668             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>,
01669             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>,
01670             <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>),
01671             (HSZ)al,
01672             hData,
01673             HandleToUlong(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>),
01674             (DWORD)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a>);
01675         DeleteAtom(al);
01676         <span class="keywordflow">if</span> (fMustFree) {
01677             <a class="code" href="../../d0/d9/hdata_8c.html#a8">InternalFreeDataHandle</a>(hData, FALSE);
01678             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a> = 0;
01679         }
01680 
01681         <span class="comment">/*</span>
01682 <span class="comment">         * during the callback is the only time the app has to access the</span>
01683 <span class="comment">         * transaction information.   pxi-&gt;hXact will be invalid once he</span>
01684 <span class="comment">         * returns.</span>
01685 <span class="comment">         */</span>
01686         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>) {
01687             <a class="code" href="../../d3/d8/handles_8c.html#a7">DestroyHandle</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>);
01688             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a> = 0;
01689         }
01690         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01691     }
01692 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="stdptcl.c::UnpackAndFreeDDEMLDataHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE UnpackAndFreeDDEMLDataHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDDEDATA&nbsp;</td>
          <td class="mdname" nowrap> <em>hData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fExec</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01708">1708</a> of file <a class="el" href="../../d3/d5/stdptcl_8c-source.html">stdptcl.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00058">CheckDDECritIn</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00137">DestroyHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00257">tagDDEMLDATA::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00256">tagDDEMLDATA::hDDE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00112">HINST_ANY</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00108">HTYPE_DATA_HANDLE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d4/ddemlcli_8h.html#a82">PDDEMLDATA</a>, and <a class="el" href="../../d4/d7/handles_8c-source.html#l00204">ValidateCHandle()</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00362">ClSpontAdviseData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00885">SvSpontExecute()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01042">SvSpontPoke()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01207">SvSpontRequest()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00263">SvStartAdviseUpdate()</a>.
<p>
<pre class="fragment"><div>01711 {
01712     <a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a> pdd;
01713     HANDLE hDDE;
01714 
01715     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a8">CheckDDECritIn</a>;
01716 
01717     <span class="keywordflow">if</span> (hData == 0) {
01718         <span class="keywordflow">return</span> (0);
01719     }
01720     pdd = (<a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)hData, HTYPE_DATA_HANDLE,
01721             HINST_ANY);
01722     <span class="keywordflow">if</span> (pdd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01723         <span class="keywordflow">return</span> (0);
01724     }
01725     <span class="keywordflow">if</span> (!fExec &amp;&amp; pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; HDATA_EXECUTE) {
01726         <span class="keywordflow">return</span> (0);
01727     }
01728 
01729     hDDE = pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>;
01730     <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; HDATA_APPOWNED) {
01731         <span class="keywordflow">return</span> (hDDE); <span class="comment">// don't destroy appowned data handles</span>
01732     }
01733     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pdd);
01734     <a class="code" href="../../d3/d8/handles_8c.html#a7">DestroyHandle</a>((HANDLE)hData);
01735     <span class="keywordflow">return</span> (hDDE);
01736 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:40 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
