<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: api.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>api.c File Reference</h1><code>#include "<a class="el" href="../../d3/d3/w32_2ntuser_2server_2precomp_8h-source.html">precomp.h</a>"</code><br>
<code>#include "<a class="el" href="../../d1/d9/ntuser_8h-source.html">ntuser.h</a>"</code><br>
<code>#include &lt;winsta.h&gt;</code><br>
<code>#include &lt;wstmsg.h&gt;</code><br>

<p>
<a href="../../d3/d7/api_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html">_WIN32WINSTATION_DISPATCH</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a0">SESSION_ROOT</a>&nbsp;&nbsp;&nbsp;L"\\Sessions"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a1">MAX_SESSION_PATH</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a2">API_W32WINSTATIONTERMINATE</a>&nbsp;&nbsp;&nbsp;12</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a3">W32WinStationDumpReconnectInfo</a>(p, b)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef NTSTATUS(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a16">PWIN32WINSTATION_API</a> )(IN OUT PWINSTATION_APIMSG ApiMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html">_WIN32WINSTATION_DISPATCH</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a17">WIN32WINSTATION_DISPATCH</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html">_WIN32WINSTATION_DISPATCH</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a18">PWIN32WINSTATION_DISPATCH</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a21">CsrPopulateDosDevices</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a22">CleanupSessionObjectDirectories</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a23">CsrQueryApiPort</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a24">CtxInitUser32</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a25">DrChangeDisplaySettings</a> (WINSTATIONDORECONNECTMSG *)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a26">W32WinStationDoConnect</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a27">W32WinStationDoDisconnect</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a28">W32WinStationDoReconnect</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a29">W32WinStationExitWindows</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a30">W32WinStationTerminate</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a31">W32WinStationNtSecurity</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a32">W32WinStationDoMessage</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a33">W32WinStationThinwireStats</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a34">W32WinStationShadowSetup</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a35">W32WinStationShadowStart</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a36">W32WinStationShadowStop</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a37">W32WinStationShadowCleanup</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a38">W32WinStationPassthruEnable</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a39">W32WinStationPassthruDisable</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a40">W32WinStationBroadcastSystemMessage</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a41">W32WinStationSendWindowMessage</a> (IN OUT PWINSTATION_APIMSG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a42">TerminalServerRequestThread</a> (PVOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a43">Win32CommandChannelThread</a> (PVOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a44">RemoteDoMessage</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a45">MultiUserSpoolerInit</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a46">RemoteDoBroadcastSystemMessage</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a47">RemoteDoSendWindowMessage</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a48">WinStationAPIInit</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a49">TerminalServerRequestThread</a> (IN PVOID ThreadParameter)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a50">W32WinStationDoConnect</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a51">W32WinStationDoDisconnect</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a52">W32WinStationDoReconnect</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a53">W32WinStationExitWindows</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a54">W32WinStationTerminate</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a55">W32WinStationNtSecurity</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a56">W32WinStationDoMessage</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a57">W32WinStationBroadcastSystemMessage</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a58">W32WinStationSendWindowMessage</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a59">W32WinStationThinwireStats</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a60">W32WinStationShadowSetup</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a61">W32WinStationShadowStart</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a62">W32WinStationShadowStop</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a63">W32WinStationShadowCleanup</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a64">W32WinStationPassthruEnable</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a65">W32WinStationPassthruDisable</a> (PWINSTATION_APIMSG pMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a66">CleanupSessionObjectDirectories</a> (VOID)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a4">gHRes</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a5">gVRes</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a6">gColorDepth</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a7">ghportLPC</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a8">gbExitInProgress</a> = FALSE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a9">G_IcaVideoChannel</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a10">G_IcaMouseChannel</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a11">G_IcaKeyboardChannel</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a12">G_IcaBeepChannel</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a13">G_IcaCommandChannel</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a14">G_IcaThinwireChannel</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a15">G_WinStationName</a> [WINSTATIONNAME_LENGTH]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html">WIN32WINSTATION_DISPATCH</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a19">Win32WinStationDispatch</a> [SMWinStationMaxApiNumber]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/api_8c.html#a20">g_hDoMessageEvent</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a2" doxytag="api.c::API_W32WINSTATIONTERMINATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define API_W32WINSTATIONTERMINATE&nbsp;&nbsp;&nbsp;12          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00120">120</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00279">TerminalServerRequestThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="api.c::MAX_SESSION_PATH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_SESSION_PATH&nbsp;&nbsp;&nbsp;256          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00024">24</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="api.c::SESSION_ROOT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SESSION_ROOT&nbsp;&nbsp;&nbsp;L"\\Sessions"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00023">23</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="api.c::W32WinStationDumpReconnectInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define W32WinStationDumpReconnectInfo          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">p,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00500">500</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00718">W32WinStationDoReconnect()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a16" doxytag="api.c::PWIN32WINSTATION_API" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef NTSTATUS(* <a class="el" href="../../d2/d8/api_8c.html#a16">PWIN32WINSTATION_API</a>)(IN OUT PWINSTATION_APIMSG ApiMsg)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00065">65</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="api.c::PWIN32WINSTATION_DISPATCH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html">_WIN32WINSTATION_DISPATCH</a> * <a class="el" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html">PWIN32WINSTATION_DISPATCH</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00279">TerminalServerRequestThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="api.c::WIN32WINSTATION_DISPATCH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html">_WIN32WINSTATION_DISPATCH</a>  <a class="el" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html">WIN32WINSTATION_DISPATCH</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a66" doxytag="api.c::CleanupSessionObjectDirectories" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CleanupSessionObjectDirectories           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l01169">1169</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00056">MAX_SESSION_PATH</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00414">NtMakeTemporaryObject()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00144">NtOpenDirectoryObject()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00247">NtOpenSymbolicLinkObject()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00229">NtQueryDirectoryObject()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00057">SESSION_ROOT</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01171 {
01172     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>          <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01173     OBJECT_ATTRIBUTES Attributes;
01174     UNICODE_STRING    UnicodeString;
01175     HANDLE            LinkHandle;
01176     POBJECT_DIRECTORY_INFORMATION DirInfo;
01177     BOOLEAN           RestartScan;
01178     UCHAR             DirInfoBuffer[ 4096 ];
01179     WCHAR             szSessionString [ <a class="code" href="../../d8/d9/dllinit_8c.html#a1">MAX_SESSION_PATH</a> ];
01180     ULONG             Context = 0;
01181     ULONG             ReturnedLength;
01182     HANDLE            DosDevicesDirectory;
01183     HANDLE            *HandleArray;
01184     ULONG             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = 100;
01185     ULONG             i, <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 0;
01186 
01187     swprintf(szSessionString,L<span class="stringliteral">"%ws\\%ld\\DosDevices"</span>,SESSION_ROOT,NtCurrentPeb()-&gt;SessionId);
01188 
01189     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, szSessionString);
01190 
01191     InitializeObjectAttributes(&amp;Attributes,
01192                                &amp;UnicodeString,
01193                                OBJ_CASE_INSENSITIVE,
01194                                NULL,
01195                                NULL);
01196 
01197     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a1">NtOpenDirectoryObject</a>(&amp;DosDevicesDirectory,
01198                                    DIRECTORY_ALL_ACCESS,
01199                                    &amp;Attributes);
01200 
01201     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01202         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"NtOpenDirectoryObject failed with Status %lx\n"</span>, Status));
01203         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01204     }
01205 
01206 Restart:
01207     HandleArray = (HANDLE *)LocalAlloc(LPTR, Size * <span class="keyword">sizeof</span>(HANDLE));
01208 
01209     <span class="keywordflow">if</span> (HandleArray == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01210 
01211         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(DosDevicesDirectory);
01212         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01213     }
01214 
01215     RestartScan = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01216     DirInfo = (POBJECT_DIRECTORY_INFORMATION)&amp;DirInfoBuffer;
01217 
01218     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01219         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a2">NtQueryDirectoryObject</a>( DosDevicesDirectory,
01220                                          (PVOID)DirInfo,
01221                                          <span class="keyword">sizeof</span>(DirInfoBuffer),
01222                                          TRUE,
01223                                          RestartScan,
01224                                          &amp;Context,
01225                                          &amp;ReturnedLength);
01226 
01227         <span class="comment">/*</span>
01228 <span class="comment">         *  Check the status of the operation.</span>
01229 <span class="comment">         */</span>
01230         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01231 
01232             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_NO_MORE_ENTRIES) {
01233                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01234             }
01235             <span class="keywordflow">break</span>;
01236         }
01237 
01238         <span class="keywordflow">if</span> (!wcscmp(DirInfo-&gt;TypeName.Buffer, L<span class="stringliteral">"SymbolicLink"</span>)) {
01239 
01240             <span class="keywordflow">if</span> ( <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> &gt;= <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> ) {
01241 
01242                 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> ; i++) {
01243                     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a> (HandleArray[i]);
01244                 }
01245                 <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> += 20;
01246                 <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 0;
01247                 LocalFree(HandleArray);
01248                 <span class="keywordflow">goto</span> Restart;
01249 
01250             }
01251 
01252             InitializeObjectAttributes( &amp;Attributes,
01253                                         &amp;DirInfo-&gt;Name,
01254                                         OBJ_CASE_INSENSITIVE,
01255                                         DosDevicesDirectory,
01256                                         NULL);
01257 
01258             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/oblink_8c.html#a6">NtOpenSymbolicLinkObject</a>( &amp;LinkHandle,
01259                                                SYMBOLIC_LINK_ALL_ACCESS,
01260                                                &amp;Attributes);
01261 
01262             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01263 
01264                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a2">NtMakeTemporaryObject</a>( LinkHandle );
01265 
01266                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01267                     HandleArray[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>] = LinkHandle;
01268                     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>++;
01269                 }
01270             }
01271 
01272         }
01273         RestartScan = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01274      }
01275 
01276      <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> ; i++) {
01277 
01278          <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a> (HandleArray[i]);
01279 
01280      }
01281 
01282      LocalFree(HandleArray);
01283 
01284      <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(DosDevicesDirectory);
01285 
01286      <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01287 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="api.c::CleanupSessionObjectDirectories" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CleanupSessionObjectDirectories           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00818">W32WinStationTerminate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="api.c::CsrPopulateDosDevices" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CsrPopulateDosDevices           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="api.c::CsrQueryApiPort" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE CsrQueryApiPort           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00357">UserClientConnect()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="api.c::CtxInitUser32" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL CtxInitUser32           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d7/clinit_8c-source.html#l01729">1729</a> of file <a class="el" href="../../d7/d7/clinit_8c-source.html">clinit.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00056">gfServerProcess</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03362">ghbrBlack</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03361">ghbrWhite</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00101">ghdcBits2</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a545">InitClientDrawing()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00293">ISREMOTESESSION</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00307">LoadCursorsAndIcons()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00378">RW_RegisterControls()</a>, <a class="el" href="../../d0/d4/ddemlcli_8h.html#a94">RW_RegisterDDEML()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/client_8c-source.html#l02154">CommonCreateWindowStation()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>.
<p>
<pre class="fragment"><div>01731 {
01732     <span class="comment">/*</span>
01733 <span class="comment">     * Only do once.</span>
01734 <span class="comment">     */</span>
01735     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || !<a class="code" href="../../d6/d0/usercli_8h.html#a30">ISREMOTESESSION</a>())
01736         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01737 
01738     <a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a> = CreateCompatibleDC(NULL);
01739 
01740     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a26">ghdcBits2</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01741         RIPMSG0(RIP_WARNING, <span class="stringliteral">"Could not allocate ghdcBits2"</span>);
01742         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01743     }
01744 
01745     <span class="comment">/*</span>
01746 <span class="comment">     * Get things we need from Gdi.</span>
01747 <span class="comment">     */</span>
01748     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1134">ghbrWhite</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01749         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1134">ghbrWhite</a> = GetStockObject(WHITE_BRUSH);
01750 
01751     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1135">ghbrBlack</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01752         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1135">ghbrBlack</a> = GetStockObject(BLACK_BRUSH);
01753 
01754     UserAssert(ghbrWhite != NULL &amp;&amp; ghbrBlack != NULL);
01755 
01756     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a545">InitClientDrawing</a>()) {
01757         RIPMSG0(RIP_WARNING, <span class="stringliteral">"InitClientDrawing failed"</span>);
01758         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01759     }
01760 
01761     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a8">gfServerProcess</a>) {
01762         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d8/clinit_8c.html#a19">LoadCursorsAndIcons</a>()) {
01763             RIPMSG0(RIP_WARNING, <span class="stringliteral">"LoadCursorsAndIcons failed"</span>);
01764             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01765         }
01766     }
01767 
01768     <span class="comment">/*</span>
01769 <span class="comment">     * Register the control classes.</span>
01770 <span class="comment">     */</span>
01771     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d8/clinit_8c.html#a20">RW_RegisterControls</a>())
01772         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01773 
01774     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d4/ddemlcli_8h.html#a94">RW_RegisterDDEML</a>())
01775         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01776 
01777     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01778 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="api.c::DrChangeDisplaySettings" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DrChangeDisplaySettings           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">WINSTATIONDORECONNECTMSG *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/dynres_8c-source.html#l00033">33</a> of file <a class="el" href="../../d1/d3/dynres_8c-source.html">dynres.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d1/d3/dynres_8c-source.html#l00076">DrGetDeviceName()</a>, <a class="el" href="../../d1/d3/dynres_8c-source.html#l00097">DrSetDevMode()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09380">NtUserChangeDisplaySettings()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00035 {
00036     DEVMODEW devmodew;
00037     UNICODE_STRING ustrDeviceName;
00038     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00039 
00040 
00041     <span class="comment">//BUGBUG Reconnecting at a resolution different than the orignal connection</span>
00042     <span class="comment">// is not functional on Hydra 5</span>
00043     <span class="keywordflow">return</span> STATUS_NOT_IMPLEMENTED;
00044 
00045 <span class="preprocessor">#if DBG</span>
00046 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\nDrChangeDisplaySettings - Entering...\n"</span>);
00047 <span class="preprocessor">#endif</span>
00048 <span class="preprocessor"></span>
00049     <span class="comment">// Setup DEVMODE for Display settings change</span>
00050 
00051     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d4/dynres_8c.html#a2">DrSetDevMode</a>(pDoReconnectMessage, &amp;devmodew);
00052 
00053     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status))
00054         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00055 
00056     <span class="comment">// Get device name from reconnect message</span>
00057 
00058     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d4/dynres_8c.html#a1">DrGetDeviceName</a>(&amp;ustrDeviceName,pDoReconnectMessage);
00059 
00060     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status))
00061         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00062 
00063     <span class="comment">// Change display settings for every desktop</span>
00064 
00065     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a322">NtUserChangeDisplaySettings</a>(&amp;ustrDeviceName,
00066                                          &amp;devmodew,
00067                                          NULL,
00068                                          (CDS_RESET | CDS_GLOBAL),
00069                                          NULL);
00070 
00071     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00072 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="api.c::MultiUserSpoolerInit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS MultiUserSpoolerInit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="api.c::RemoteDoBroadcastSystemMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RemoteDoBroadcastSystemMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/server_2sendmsg_8c-source.html#l00089">89</a> of file <a class="el" href="../../d5/d5/server_2sendmsg_8c-source.html">server/sendmsg.c</a>.
<p>
References <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01760">BroadcastSystemMessage()</a>, and <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l01012">W32WinStationBroadcastSystemMessage()</a>.
<p>
<pre class="fragment"><div>00091 {
00092     LONG rc;
00093     WINSTATIONBROADCASTSYSTEMMSG     *pmsg;
00094     LPARAM      tmpLPARAM;
00095     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    status;
00096 
00097 
00098     pmsg = &amp;(pMsg-&gt;u.bMsg);
00099 
00100     <span class="keywordflow">if</span> ( pmsg-&gt;bufferSize )
00101     {
00102         <span class="comment">// we have a databuffer, set the lParam to our copied data buffer</span>
00103         tmpLPARAM = (LPARAM)pmsg-&gt;dataBuffer;
00104     }
00105     <span class="keywordflow">else</span>
00106     {
00107         tmpLPARAM = pmsg-&gt;lParam ;
00108     }
00109 
00110     rc = <a class="code" href="../../d5/d9/cltxt_8h.html#a35">BroadcastSystemMessage</a>( pmsg-&gt;dwFlags, &amp;pmsg-&gt;dwRecipients,
00111                     pmsg-&gt;uiMessage, pmsg-&gt;wParam, tmpLPARAM );
00112 
00113     status = STATUS_SUCCESS;
00114 
00115     pmsg-&gt;Response = rc;
00116 
00117     <span class="keywordflow">return</span> status ;
00118 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="api.c::RemoteDoMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RemoteDoMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d3/icamsg_8c-source.html#l00068">68</a> of file <a class="el" href="../../d7/d3/icamsg_8c-source.html">icamsg.c</a>.
<p>
References <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00054">tagCTXHARDERRORINFO::ClientId</a>, <a class="el" href="../../d7/d1/usersrv_8h.html#a38">CTXHARDERRORINFO</a>, <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00063">tagCTXHARDERRORINFO::DoNotWait</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00201">EnterCrit</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00191">g_hDoMessageEvent</a>, <a class="el" href="../../d7/d3/icamsg_8c-source.html#l00050">ghMessageThread</a>, <a class="el" href="../../d7/d3/icamsg_8c-source.html#l00051">gidMessageThread</a>, <a class="el" href="../../d7/d3/icamsg_8c-source.html#l00049">gpchiList</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00062">tagCTXHARDERRORINFO::hEvent</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00202">LeaveCrit</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00055">tagCTXHARDERRORINFO::MessageId</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00064">tagCTXHARDERRORINFO::pchiNext</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00057">tagCTXHARDERRORINFO::pMessage</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00061">tagCTXHARDERRORINFO::pResponse</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00056">tagCTXHARDERRORINFO::pTitle</a>, <a class="el" href="../../d7/d3/icamsg_8c-source.html#l00167">RemoteMessageThread()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00058">tagCTXHARDERRORINFO::Style</a>, and <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00059">tagCTXHARDERRORINFO::Timeout</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00996">W32WinStationDoMessage()</a>.
<p>
<pre class="fragment"><div>00070 {
00071     WINSTATIONSENDMESSAGEMSG * pSMsg = &amp;pMsg-&gt;u.SendMessage;
00072     <a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html">PCTXHARDERRORINFO</a> pchi;
00073     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00074 
00075     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();        <span class="comment">// to synchronize heap calls</span>
00076 
00077     <span class="comment">/*</span>
00078 <span class="comment">     *  Create list entry</span>
00079 <span class="comment">     */</span>
00080     <span class="keywordflow">if</span> ((pchi = (<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html">PCTXHARDERRORINFO</a>)LocalAlloc(LPTR, <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html">CTXHARDERRORINFO</a>))) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00081         <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00082         <span class="keywordflow">return</span> (STATUS_NO_MEMORY);
00083     }
00084     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o2">pTitle</a> = LocalAlloc(LPTR, pSMsg-&gt;TitleLength + <span class="keyword">sizeof</span>(TCHAR))) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00085         LocalFree(pchi);
00086         <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00087         <span class="keywordflow">return</span> (STATUS_NO_MEMORY);
00088     }
00089     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o3">pMessage</a> = LocalAlloc(LPTR, pSMsg-&gt;MessageLength + <span class="keyword">sizeof</span>(TCHAR))) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00090         LocalFree(pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o2">pTitle</a>);
00091         LocalFree(pchi);
00092         <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00093         <span class="keywordflow">return</span> (STATUS_NO_MEMORY);
00094     }
00095 
00096     <span class="comment">/*</span>
00097 <span class="comment">     * Initialize</span>
00098 <span class="comment">     */</span>
00099     pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o0">ClientId</a>  = pMsg-&gt;h.ClientId;
00100     pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o1">MessageId</a> = pMsg-&gt;MessageId;
00101     pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o5">Timeout</a>   = pSMsg-&gt;Timeout;
00102     pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o7">pResponse</a> = pSMsg-&gt;pResponse;
00103     pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o8">hEvent</a>    = pSMsg-&gt;hEvent;
00104     pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o9">DoNotWait</a> = pSMsg-&gt;DoNotWait;
00105     pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o4">Style</a>     = pSMsg-&gt;Style;
00106 
00107     pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o2">pTitle</a>[pSMsg-&gt;TitleLength/<span class="keyword">sizeof</span>(TCHAR)] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00108     RtlMoveMemory(pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o2">pTitle</a>, pSMsg-&gt;pTitle, pSMsg-&gt;TitleLength);
00109 
00110     pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o3">pMessage</a>[pSMsg-&gt;MessageLength/<span class="keyword">sizeof</span>(TCHAR)] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00111     RtlMoveMemory(pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o3">pMessage</a>, pSMsg-&gt;pMessage, pSMsg-&gt;MessageLength);
00112 
00113     <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteDoMessage: pchi-&gt;pTitle   - %S\n"</span>, pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o2">pTitle</a>));
00114     <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteDoMessage: pchi-&gt;pMessage - %S\n"</span>, pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o3">pMessage</a>));
00115 
00116     <span class="comment">/*</span>
00117 <span class="comment">     * Link in at head</span>
00118 <span class="comment">     */</span>
00119     pchi-&gt;<a class="code" href="../../d5/d1/structtagCTXHARDERRORINFO.html#o10">pchiNext</a> = <a class="code" href="../../d6/d4/icamsg_8c.html#a2">gpchiList</a>;
00120     <a class="code" href="../../d6/d4/icamsg_8c.html#a2">gpchiList</a> = pchi;
00121 
00122     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00123 
00124     <span class="comment">/*</span>
00125 <span class="comment">     *  Start message thread if not running, otherwise signal thread</span>
00126 <span class="comment">     */</span>
00127     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d4/icamsg_8c.html#a3">ghMessageThread</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00128         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteDoMessage: starting RemoteMessageThread ...\n"</span>));
00129         
00130         <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d4/icamsg_8c.html#a3">ghMessageThread</a> = CreateThread(NULL, 4096,
00131                                       (LPTHREAD_START_ROUTINE)RemoteMessageThread,
00132                                       (LPVOID) NULL,
00133                                       0, &amp;gidMessageThread)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00134 
00135             <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteDoMessage: cannot start RemoteMessageThread, error %u\n"</span>,
00136                     GetLastError()));
00137         }
00138     } <span class="keywordflow">else</span> {
00139         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a20">g_hDoMessageEvent</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00140             <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00141         }
00142         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(g_hDoMessageEvent, NULL);
00143         
00144         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00145             <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteDoMessage: Error NtSetEvent failed, Status=%x, rc=%u\n"</span>,
00146                     Status, GetLastError()));
00147             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00148         }
00149     }
00150 
00151     <span class="keywordflow">return</span> STATUS_SUCCESS;
00152 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="api.c::RemoteDoSendWindowMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RemoteDoSendWindowMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/server_2sendmsg_8c-source.html#l00123">123</a> of file <a class="el" href="../../d5/d5/server_2sendmsg_8c-source.html">server/sendmsg.c</a>.
<p>
References <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, and <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l01028">W32WinStationSendWindowMessage()</a>.
<p>
<pre class="fragment"><div>00125 {
00126     LONG rc;
00127     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00128 
00129 
00130     WINSTATIONSENDWINDOWMSG  *pmsg;
00131     LPARAM  tmpLPARAM;
00132 
00133     pmsg = &amp;(pMsg-&gt;u.sMsg);
00134 
00135     <span class="keywordflow">if</span> ( pmsg-&gt;bufferSize )
00136     {
00137         <span class="comment">// we have a databuffer, set the lParam to our copied data buffer</span>
00138         tmpLPARAM = (LPARAM)pmsg-&gt;dataBuffer;
00139     }
00140     <span class="keywordflow">else</span>
00141     {
00142         tmpLPARAM = (LPARAM)pmsg-&gt;lParam;
00143     }
00144 
00145     <span class="comment">//</span>
00146     <span class="comment">// No need to worry about disconnected sessions (desktop), since msg is sent to a specific hwnd.</span>
00147     <span class="comment">// I have verified this imperically.</span>
00148     <span class="comment">//</span>
00149 
00150     rc = (LONG)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>( pmsg-&gt;hWnd, pmsg-&gt;Msg,
00151                     pmsg-&gt;wParam, tmpLPARAM  );
00152 
00153     status = STATUS_SUCCESS;
00154 
00155     pmsg-&gt;Response = rc;
00156 
00157     <span class="keywordflow">return</span> status ;
00158 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="api.c::TerminalServerRequestThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS TerminalServerRequestThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ThreadParameter</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00279">279</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d3/d7/api_8c-source.html#l00120">API_W32WINSTATIONTERMINATE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d4/d8/ulpc_8h-source.html#l00049">DynamicQos</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00040">ghportLPC</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00043">NtConnectPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00395">NtRequestWaitReplyPort()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d8/ulpc_8h-source.html#l00032">PortName</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00068">_WIN32WINSTATION_DISPATCH::pWin32ApiProc</a>, <a class="el" href="../../d2/d8/api_8c.html#a18">PWIN32WINSTATION_DISPATCH</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00122">Win32WinStationDispatch</a>.
<p>
<pre class="fragment"><div>00281 {
00282     PTEB                        Teb;
00283     UNICODE_STRING              <a class="code" href="../../d3/d9/ulpc_8h.html#a2">PortName</a>;
00284     SECURITY_QUALITY_OF_SERVICE <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>;
00285     WINSTATIONAPI_CONNECT_INFO  info;
00286     ULONG                       ConnectInfoLength;
00287     WINSTATION_APIMSG           ApiMsg;
00288     <a class="code" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html">PWIN32WINSTATION_DISPATCH</a>   pDispatch;
00289     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00290     REMOTE_PORT_VIEW            ServerView;
00291     HANDLE                      CsrStartHandle, hevtTermSrvInit;
00292 
00293     <span class="comment">/*</span>
00294 <span class="comment">     * Initialize GDI accelerators.  Identify this thread as a server thread.</span>
00295 <span class="comment">     */</span>
00296     Teb = NtCurrentTeb();
00297     Teb-&gt;GdiClientPID = 4; <span class="comment">// PID_SERVERLPC</span>
00298     Teb-&gt;GdiClientTID = HandleToUlong(Teb-&gt;ClientId.UniqueThread);
00299 
00300     <span class="comment">/*</span>
00301 <span class="comment">     *  Connect to user</span>
00302 <span class="comment">     */</span>
00303 
00304     hevtTermSrvInit = CreateEvent(NULL, TRUE, FALSE,
00305                                   L<span class="stringliteral">"Global\\TermSrvReadyEvent"</span>);
00306 
00307     UserAssert(hevtTermSrvInit != NULL);
00308 <span class="preprocessor">#if DBG</span>
00309 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (hevtTermSrvInit == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00310         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"ERROR: could not create TermSrvReadyEvent !!!\n"</span>));
00311     }
00312 <span class="preprocessor">#endif</span>
00313 <span class="preprocessor"></span>
00314     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>(hevtTermSrvInit, FALSE, NULL);
00315 
00316     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hevtTermSrvInit);
00317 
00318     <span class="comment">/*</span>
00319 <span class="comment">     *  Connect to terminal server API port</span>
00320 <span class="comment">     */</span>
00321     <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>.ImpersonationLevel = SecurityImpersonation;
00322     <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>.ContextTrackingMode = SECURITY_DYNAMIC_TRACKING;
00323     <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>.EffectiveOnly = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00324 
00325     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;PortName, L<span class="stringliteral">"\\SmSsWinStationApiPort"</span>);
00326 
00327     <span class="comment">/*</span>
00328 <span class="comment">     * Init the REMOTE_VIEW structure</span>
00329 <span class="comment">     */</span>
00330     ServerView.Length = <span class="keyword">sizeof</span>(ServerView);
00331     ServerView.ViewSize = 0;
00332     ServerView.ViewBase = 0;
00333 
00334     <span class="comment">/*</span>
00335 <span class="comment">     * Fill in the ConnectInfo structure with our access request mask</span>
00336 <span class="comment">     */</span>
00337     info.Version = CITRIX_WINSTATIONAPI_VERSION;
00338     info.RequestedAccess = 0; <span class="comment">// BUGBUG should ask for ALL access</span>
00339     ConnectInfoLength = <span class="keyword">sizeof</span>(WINSTATIONAPI_CONNECT_INFO);
00340 
00341     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d6/lpcconn_8c.html#a1">NtConnectPort</a>( &amp;ghportLPC,
00342                             &amp;PortName,
00343                             &amp;DynamicQos,
00344                             NULL, <span class="comment">// ClientView</span>
00345                             &amp;ServerView,
00346                             NULL, <span class="comment">// Max message length [select default]</span>
00347                             (PVOID)&amp;info,
00348                             &amp;ConnectInfoLength);
00349 
00350     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00351         RIPMSG0(RIP_WARNING, <span class="stringliteral">"TerminalServerRequestThread: Failed to connect to LPC port"</span>);
00352         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00353     }
00354 
00355     RtlZeroMemory(&amp;ApiMsg, <span class="keyword">sizeof</span>(ApiMsg));
00356 
00357     <span class="comment">//</span>
00358     <span class="comment">// Terminal Server calls into Session Manager to create a new Hydra session.</span>
00359     <span class="comment">// The session manager creates and resume a new session and returns to Terminal</span>
00360     <span class="comment">// server the session id of the new session. There is a race condition where</span>
00361     <span class="comment">// CSR can resume and call into terminal server before terminal server can</span>
00362     <span class="comment">// store the session id in its internal structure. To prevent this CSR will</span>
00363     <span class="comment">// wait here on a named event which will be set by Terminal server once it</span>
00364     <span class="comment">// gets the sessionid for the newly created session</span>
00365     <span class="comment">//</span>
00366 
00367     <span class="keywordflow">if</span> (NtCurrentPeb()-&gt;SessionId != 0) {
00368 
00369         CsrStartHandle = CreateEvent(NULL, TRUE, FALSE, L<span class="stringliteral">"CsrStartEvent"</span>);
00370 
00371         <span class="keywordflow">if</span> (!CsrStartHandle) {
00372 
00373             RIPMSG1(RIP_WARNING, <span class="stringliteral">"TerminalServerRequestThread: Failed to create 'CsrStartEvent' with Status 0x%x"</span>,
00374                     Status);
00375 
00376             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00377 
00378         } <span class="keywordflow">else</span> {
00379 
00380             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>(CsrStartHandle, FALSE, NULL);
00381 
00382             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(CsrStartHandle);
00383             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00384                 <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"TerminalServerRequestThread: Wait for object 'CsrStartEvent' failed Status=0x%x\n"</span>,
00385                         Status));
00386             }
00387         }
00388     }
00389 
00390     <span class="keywordflow">for</span> (;;) {
00391 
00392         <span class="comment">/*</span>
00393 <span class="comment">         * Initialize LPC message fields</span>
00394 <span class="comment">         */</span>
00395         ApiMsg.h.u1.s1.DataLength     = <span class="keyword">sizeof</span>(ApiMsg) - <span class="keyword">sizeof</span>(PORT_MESSAGE);
00396         ApiMsg.h.u1.s1.TotalLength    = <span class="keyword">sizeof</span>(ApiMsg);
00397         ApiMsg.h.u2.s2.Type           = 0; <span class="comment">// Kernel will fill in message type</span>
00398         ApiMsg.h.u2.s2.DataInfoOffset = 0;
00399         ApiMsg.ApiNumber              = SMWinStationGetSMCommand;
00400 
00401         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/lpcsend_8c.html#a1">NtRequestWaitReplyPort</a>(ghportLPC,
00402                                         (PPORT_MESSAGE)&amp;ApiMsg,
00403                                         (PPORT_MESSAGE)&amp;ApiMsg);
00404 
00405         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00406             <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"TerminalServerRequestThread wait failed with Status %lx\n"</span>,
00407                    Status));
00408             <span class="keywordflow">break</span>;
00409         }
00410 
00411         <span class="keywordflow">if</span> (ApiMsg.ApiNumber &gt;= SMWinStationMaxApiNumber ) {
00412 
00413             <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"TerminalServerRequestThread Bad API number %d\n"</span>,
00414                    ApiMsg.ApiNumber));
00415 
00416             ApiMsg.ReturnedStatus = STATUS_NOT_IMPLEMENTED;
00417 
00418         } <span class="keywordflow">else</span> {
00419 
00420             <span class="comment">/*</span>
00421 <span class="comment">             * We must VALIDATE which ones are implemented here</span>
00422 <span class="comment">             */</span>
00423             pDispatch = &amp;<a class="code" href="../../d2/d8/api_8c.html#a19">Win32WinStationDispatch</a>[ApiMsg.ApiNumber];
00424 
00425             <span class="keywordflow">if</span> (pDispatch-&gt;<a class="code" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html#o0">pWin32ApiProc</a>) {
00426 
00427                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRestoreDesktop = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00428                 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00429                 USERTHREAD_USEDESKTOPINFO utudi;
00430 
00431                 <span class="comment">/*</span>
00432 <span class="comment">                 * For all the win32k callouts with the exception of</span>
00433 <span class="comment">                 * terminate set this thread to the current desktop</span>
00434 <span class="comment">                 */</span>
00435                 <span class="keywordflow">if</span> (ApiMsg.ApiNumber != <a class="code" href="../../d2/d8/api_8c.html#a2">API_W32WINSTATIONTERMINATE</a>) {
00436                     utudi.hThread = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00437                     utudi.drdRestore.pdeskRestore = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00438                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00439                                                         UserThreadUseActiveDesktop,
00440                                                         &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00441 
00442                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00443                         bRestoreDesktop = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00444                     }
00445                 }
00446 
00447                 <span class="comment">/*</span>
00448 <span class="comment">                 * Call the API</span>
00449 <span class="comment">                 */</span>
00450                 ApiMsg.ReturnedStatus = (pDispatch-&gt;<a class="code" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html#o0">pWin32ApiProc</a>)(&amp;ApiMsg);
00451 
00452                 <span class="keywordflow">if</span> (bRestoreDesktop) {
00453                     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00454                                                UserThreadUseDesktop,
00455                                                &amp;utudi,
00456                                                <span class="keyword">sizeof</span>(utudi));
00457                 }
00458 
00459             } <span class="keywordflow">else</span> {
00460                 <span class="comment">// This control API is not implemented in WIN32</span>
00461                 ApiMsg.ReturnedStatus = STATUS_NOT_IMPLEMENTED;
00462             }
00463         }
00464     }
00465 
00466     ExitThread(0);
00467 
00468     <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00469 
00470     UNREFERENCED_PARAMETER(ThreadParameter);
00471 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="api.c::TerminalServerRequestThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS TerminalServerRequestThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00212">WinStationAPIInit()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="api.c::W32WinStationBroadcastSystemMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationBroadcastSystemMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l01012">1012</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/server_2sendmsg_8c-source.html#l00089">RemoteDoBroadcastSystemMessage()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01014 {
01015 
01016     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01017     
01018     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d6/server_2sendmsg_8c.html#a1">RemoteDoBroadcastSystemMessage</a>(pMsg);
01019     
01020     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01021         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteDoBroadcastSystemMessage(): failed with status 0x%lx\n"</span>, Status));
01022     }
01023 
01024     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01025 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="api.c::W32WinStationBroadcastSystemMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationBroadcastSystemMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="api.c::W32WinStationDoConnect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationDoConnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00504">504</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d2/d8/api_8c.html#a21">CsrPopulateDosDevices()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l01729">CtxInitUser32()</a>, <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1139">DOCONNECTDATA</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00056">G_IcaBeepChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00057">G_IcaCommandChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00055">G_IcaKeyboardChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00054">G_IcaMouseChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00058">G_IcaThinwireChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00053">G_IcaVideoChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00059">G_WinStationName</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00038">gColorDepth</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00036">gHRes</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00931">gSessionId</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00037">gVRes</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d2/d8/api_8c.html#a45">MultiUserSpoolerInit()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00138">NtResumeThread()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l00521">NtUserRemoteConnect()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d1/rtlexec_8c-source.html#l01241">RtlCreateUserThread()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00138">ThreadHandle</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00500">W32WinStationDumpReconnectInfo</a>, and <a class="el" href="../../d2/d8/api_8c.html#a43">Win32CommandChannelThread()</a>.
<p>
<pre class="fragment"><div>00506 {
00507     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00508     WINSTATIONDOCONNECTMSG* m = &amp;pMsg-&gt;u.DoConnect;
00509     WCHAR                   DisplayDriverName[10];
00510     CLIENT_ID               ClientId;
00511     HANDLE                  <a class="code" href="../../d2/d1/cttoken_8c.html#a63">ThreadHandle</a>;
00512     KPRIORITY               Priority;
00513     <a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html">DOCONNECTDATA</a>           DoConnectData;
00514     WINSTATIONDORECONNECTMSG mDoReconnect;
00515 
00516     UserAssert(gulConnectCount == 0);
00517 
00518     <span class="comment">/*</span>
00519 <span class="comment">     * Populate the sessions \DosDevices from</span>
00520 <span class="comment">     * the current consoles settings</span>
00521 <span class="comment">     */</span>
00522     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/api_8c.html#a21">CsrPopulateDosDevices</a>();
00523     <span class="keywordflow">if</span>( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
00524         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"CsrPopulateDosDevices failed with Status %lx\n"</span>, Status));
00525         <span class="keywordflow">goto</span> Exit;
00526     }
00527 
00528 
00529     <a class="code" href="../../d2/d8/api_8c.html#a9">G_IcaVideoChannel</a>    = m-&gt;hIcaVideoChannel;
00530     <a class="code" href="../../d2/d8/api_8c.html#a10">G_IcaMouseChannel</a>    = m-&gt;hIcaMouseChannel;
00531     <a class="code" href="../../d2/d8/api_8c.html#a11">G_IcaKeyboardChannel</a> = m-&gt;hIcaKeyboardChannel;
00532     <a class="code" href="../../d2/d8/api_8c.html#a12">G_IcaBeepChannel</a>     = m-&gt;hIcaBeepChannel;
00533     <a class="code" href="../../d2/d8/api_8c.html#a13">G_IcaCommandChannel</a>  = m-&gt;hIcaCommandChannel;
00534     <a class="code" href="../../d2/d8/api_8c.html#a14">G_IcaThinwireChannel</a> = m-&gt;hIcaThinwireChannel;
00535 
00536     memset(G_WinStationName, 0, <span class="keyword">sizeof</span>(G_WinStationName));
00537     memcpy(G_WinStationName, m-&gt;WinStationName,
00538             <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<span class="keyword">sizeof</span>(G_WinStationName), <span class="keyword">sizeof</span>(m-&gt;WinStationName)));
00539 
00540     <span class="comment">/*</span>
00541 <span class="comment">     * This must be 8 unicode characters (file name) plus two zero wide characters.</span>
00542 <span class="comment">     */</span>
00543     memset(DisplayDriverName, 0, <span class="keyword">sizeof</span>(DisplayDriverName));
00544     memcpy(DisplayDriverName, m-&gt;DisplayDriverName, <span class="keyword">sizeof</span>(DisplayDriverName) - 2);
00545 
00546     <span class="comment">/*</span>
00547 <span class="comment">     * Give the information to the WIN32 driver.</span>
00548 <span class="comment">     */</span>
00549     memset(&amp;DoConnectData, 0, <span class="keyword">sizeof</span>(DoConnectData));
00550 
00551     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o0">fMouse</a>          = m-&gt;fMouse;
00552     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o5">IcaBeepChannel</a>  = <a class="code" href="../../d2/d8/api_8c.html#a12">G_IcaBeepChannel</a>;
00553     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o4">IcaVideoChannel</a> = <a class="code" href="../../d2/d8/api_8c.html#a9">G_IcaVideoChannel</a>;
00554     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o6">IcaMouseChannel</a> = <a class="code" href="../../d2/d8/api_8c.html#a10">G_IcaMouseChannel</a>;
00555     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o13">fEnableWindowsKey</a> = m-&gt;fEnableWindowsKey;;
00556 
00557     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o7">IcaKeyboardChannel</a>        = <a class="code" href="../../d2/d8/api_8c.html#a11">G_IcaKeyboardChannel</a>;
00558     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o8">IcaThinwireChannel</a>        = <a class="code" href="../../d2/d8/api_8c.html#a14">G_IcaThinwireChannel</a>;
00559     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o12">fClientDoubleClickSupport</a> = m-&gt;fClientDoubleClickSupport;
00560 
00561     <span class="comment">/*</span>
00562 <span class="comment">     * Give the information to the keyboard type/subtype/number of functions.</span>
00563 <span class="comment">     */</span>
00564     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o19">ClientKeyboardType</a>.Type        = m-&gt;KeyboardType;
00565     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o19">ClientKeyboardType</a>.SubType     = m-&gt;KeyboardSubType;
00566     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o19">ClientKeyboardType</a>.FunctionKey = m-&gt;KeyboardFunctionKey;
00567 
00568     memcpy(DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o9">WinStationName</a>, G_WinStationName,
00569             <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<span class="keyword">sizeof</span>(G_WinStationName), <span class="keyword">sizeof</span>(DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o9">WinStationName</a>)));
00570 
00571     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o18">drProtocolType</a> = m-&gt;ProtocolType;
00572     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o16">drPelsHeight</a> = m-&gt;VRes;
00573     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o15">drPelsWidth</a> = m-&gt;HRes;
00574     DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o14">drBitsPerPel</a> = m-&gt;ColorDepth;
00575     <span class="comment">//BUGBUG DoConnectData.drDisplayFrequency is no yet setup</span>
00576 
00577     <span class="comment">// We set here the WINSTATIONDORECONNECTMSG that we will be using latter</span>
00578     <span class="comment">// In the call to DrChangeDisplaySettings(), because we want to trace the display</span>
00579     <span class="comment">// resolution information, prior to call NtUserRemoteConnect().</span>
00580 
00581     mDoReconnect.ProtocolType = m-&gt;ProtocolType;
00582     mDoReconnect.HRes = m-&gt;HRes;
00583     mDoReconnect.VRes = m-&gt;VRes;
00584     mDoReconnect.ColorDepth = m-&gt;ColorDepth;
00585 
00586     <a class="code" href="../../d2/d8/api_8c.html#a3">W32WinStationDumpReconnectInfo</a>(&amp;mDoReconnect, FALSE);
00587 
00588     <span class="comment">/* Give winstation protocol name */</span>
00589     memset(DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o10">ProtocolName</a>, 0, <span class="keyword">sizeof</span>(DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o10">ProtocolName</a>));
00590     memcpy(DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o10">ProtocolName</a>, m-&gt;ProtocolName, <span class="keyword">sizeof</span>(DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o10">ProtocolName</a>) - 2);
00591 
00592     <span class="comment">/* Give winstation audio drver name */</span>
00593     memset(DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o11">AudioDriverName</a>, 0, <span class="keyword">sizeof</span>(DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o11">AudioDriverName</a>));
00594     memcpy(DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o11">AudioDriverName</a>, m-&gt;AudioDriverName, <span class="keyword">sizeof</span>(DoConnectData.<a class="code" href="../../d3/d8/struct__DOCONNECTDATA.html#o11">AudioDriverName</a>) - 2);
00595 
00596     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a77">NtUserRemoteConnect</a>(&amp;DoConnectData,
00597                                 <span class="keyword">sizeof</span>(DisplayDriverName),
00598                                 DisplayDriverName);
00599 
00600     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00601         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"NtUserRemoteConnect failed with Status %lx\n"</span>, Status));
00602         <span class="keywordflow">goto</span> Exit;
00603     }
00604     
00605     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d2/rtlexec_8c.html#a13">RtlCreateUserThread</a>( NtCurrentProcess(),
00606                                   NULL,
00607                                   TRUE,
00608                                   0L,
00609                                   0L,
00610                                   0L,
00611                                   Win32CommandChannelThread,
00612                                   NULL,
00613                                   &amp;ThreadHandle,
00614                                   &amp;ClientId );
00615 
00616     UserAssert(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00617     
00618     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00619         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RtlCreateUserThread failed with Status %lx\n"</span>, Status));
00620         <span class="keywordflow">goto</span> Exit;
00621     }
00622 
00623     <span class="comment">/*</span>
00624 <span class="comment">     *  Add thread to server thread pool</span>
00625 <span class="comment">     */</span>
00626     <span class="keywordflow">if</span> (CsrAddStaticServerThread(ThreadHandle, &amp;ClientId, 0) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00627         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"CsrAddStaticServerThread failed\n"</span>));
00628         <span class="keywordflow">goto</span> Exit;
00629     }
00630 
00631     <span class="comment">/*</span>
00632 <span class="comment">     * Boost priority of thread</span>
00633 <span class="comment">     */</span>
00634     Priority = THREAD_BASE_PRIORITY_MAX;
00635 
00636     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d1/psquery_8c.html#a21">NtSetInformationThread</a>(ThreadHandle, ThreadBasePriority,
00637                                     &amp;Priority, <span class="keyword">sizeof</span>(Priority));
00638 
00639     UserAssert(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00640     
00641     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00642         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"NtSetInformationThread failed with Status %lx\n"</span>, Status));
00643         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00644         <span class="keywordflow">goto</span> Exit;
00645     }
00646 
00647     <span class="comment">/*</span>
00648 <span class="comment">     * Resume the thread now that we've initialized things.</span>
00649 <span class="comment">     */</span>
00650     <a class="code" href="../../d1/d2/psspnd_8c.html#a1">NtResumeThread</a>(ThreadHandle, NULL);
00651 
00652     <span class="keywordflow">if</span> (CsrConnectToUser() == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00653         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"CsrConnectToUser failed\n"</span>));
00654         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00655         <span class="keywordflow">goto</span> Exit;
00656     }
00657     
00658     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d8/api_8c.html#a24">CtxInitUser32</a>()) {
00659         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"CtxInitUser32 failed\n"</span>));
00660         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00661         <span class="keywordflow">goto</span> Exit;
00662     }
00663 
00664     <span class="comment">/*</span>
00665 <span class="comment">     * Create the Spooler service thread</span>
00666 <span class="comment">     */</span>
00667     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a327">gSessionId</a> != 0) {
00668         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/api_8c.html#a45">MultiUserSpoolerInit</a>();
00669     }
00670 
00671     <span class="comment">/*</span>
00672 <span class="comment">     * Save the resolution</span>
00673 <span class="comment">     */</span>
00674     <a class="code" href="../../d2/d8/api_8c.html#a4">gHRes</a>       = mDoReconnect.HRes;
00675     <a class="code" href="../../d2/d8/api_8c.html#a5">gVRes</a>       = mDoReconnect.VRes;
00676     <a class="code" href="../../d2/d8/api_8c.html#a6">gColorDepth</a> = mDoReconnect.ColorDepth;
00677 
00678 
00679 Exit:
00680 
00681 <span class="preprocessor">#if DBG</span>
00682 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00683         gulConnectCount++;
00684     }
00685 <span class="preprocessor">#endif // DBG</span>
00686 <span class="preprocessor"></span>
00687     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00688 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="api.c::W32WinStationDoConnect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationDoConnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="api.c::W32WinStationDoDisconnect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationDoDisconnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00692">692</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00059">G_WinStationName</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00694 {
00695     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00696 
00697     memset(G_WinStationName, 0, <span class="keyword">sizeof</span>(G_WinStationName));
00698 
00699     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_XXXREMOTEDISCONNECT);
00700 
00701     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00702         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"xxxRemoteDisconnect failed with Status %lx\n"</span>, Status));
00703     }
00704 
00705 <span class="preprocessor">#if DBG</span>
00706 <span class="preprocessor"></span>    <span class="keywordflow">else</span> {
00707         gulConnectCount--;
00708     }
00709 <span class="preprocessor">#endif // DBG</span>
00710 <span class="preprocessor"></span>
00711     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00712 
00713     UNREFERENCED_PARAMETER(pMsg);
00714 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="api.c::W32WinStationDoDisconnect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationDoDisconnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="api.c::W32WinStationDoMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationDoMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00996">996</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d7/d3/icamsg_8c-source.html#l00068">RemoteDoMessage()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00998 {
00999     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01000 
01001     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d4/icamsg_8c.html#a11">RemoteDoMessage</a>(pMsg);
01002 
01003     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01004         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteDoMessage failed with Status %lx\n"</span>, Status));
01005     }
01006 
01007     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01008 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="api.c::W32WinStationDoMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationDoMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="api.c::W32WinStationDoReconnect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationDoReconnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00718">718</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1141">DORECONNECTDATA</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00059">G_WinStationName</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00038">gColorDepth</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00036">gHRes</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00037">gVRes</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04526">NtUserCallOneParam()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00500">W32WinStationDumpReconnectInfo</a>.
<p>
<pre class="fragment"><div>00720 {
00721     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00722     <a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html">DORECONNECTDATA</a>             DoReconnectData;
00723     WINSTATIONDORECONNECTMSG*   m = &amp;pMsg-&gt;u.DoReconnect;
00724 
00725     UserAssert(gulConnectCount == 0);
00726 
00727 
00728     memset(&amp;DoReconnectData, 0, <span class="keyword">sizeof</span>(DoReconnectData));
00729 
00730     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o0">fMouse</a> = m-&gt;fMouse;
00731     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o4">fEnableWindowsKey</a> = m-&gt;fEnableWindowsKey;
00732     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o3">fClientDoubleClickSupport</a> = m-&gt;fClientDoubleClickSupport;
00733 
00734     memcpy(G_WinStationName, m-&gt;WinStationName,
00735            <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<span class="keyword">sizeof</span>(G_WinStationName), <span class="keyword">sizeof</span>(m-&gt;WinStationName)));
00736 
00737     memcpy(DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o2">WinStationName</a>, G_WinStationName,
00738            <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<span class="keyword">sizeof</span>(G_WinStationName), <span class="keyword">sizeof</span>(DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o2">WinStationName</a>)));
00739 
00740     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o9">drProtocolType</a> = m-&gt;ProtocolType;
00741     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o7">drPelsHeight</a> = m-&gt;VRes;
00742     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o6">drPelsWidth</a> = m-&gt;HRes;
00743     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o5">drBitsPerPel</a> = m-&gt;ColorDepth;
00744     <span class="keywordflow">if</span> ((m-&gt;fDynamicReconnect) &amp;&amp; (<a class="code" href="../../d2/d8/api_8c.html#a4">gHRes</a> != m-&gt;HRes || <a class="code" href="../../d2/d8/api_8c.html#a5">gVRes</a> != m-&gt;VRes || <a class="code" href="../../d2/d8/api_8c.html#a6">gColorDepth</a> != m-&gt;ColorDepth ) ) {
00745        DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o10">fChangeDisplaySettings</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00746     }<span class="keywordflow">else</span>{
00747        DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o10">fChangeDisplaySettings</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00748     }
00749     <span class="comment">//BUGBUG DoReconnectData.drDisplayFrequency is no yet setup</span>
00750     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o8">drDisplayFrequency</a> = 0;
00751 
00752     <span class="comment">/*</span>
00753 <span class="comment">     * Give the information to the keyboard type/subtype/number of functions.</span>
00754 <span class="comment">     */</span>
00755     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o11">ClientKeyboardType</a>.Type        = m-&gt;KeyboardType;
00756     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o11">ClientKeyboardType</a>.SubType     = m-&gt;KeyboardSubType;
00757     DoReconnectData.<a class="code" href="../../d4/d8/struct__DORECONNECTDATA.html#o11">ClientKeyboardType</a>.FunctionKey = m-&gt;KeyboardFunctionKey;
00758 
00759     <a class="code" href="../../d2/d8/api_8c.html#a3">W32WinStationDumpReconnectInfo</a>( m, TRUE);
00760 
00761     <span class="comment">/*</span>
00762 <span class="comment">     * Give the information to the WIN32 driver.</span>
00763 <span class="comment">     */</span>
00764 
00765     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a174">NtUserCallOneParam</a>((ULONG_PTR)&amp;DoReconnectData,
00766                                           SFI_XXXREMOTERECONNECT);
00767 
00768     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00769         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"xxxRemoteReconnect failed with Status %lx\n"</span>, Status));
00770     }<span class="keywordflow">else</span>{
00771 
00772     <span class="comment">/*</span>
00773 <span class="comment">     * Save the resolution</span>
00774 <span class="comment">     */</span>
00775         <a class="code" href="../../d2/d8/api_8c.html#a4">gHRes</a>       = m-&gt;HRes;
00776         <a class="code" href="../../d2/d8/api_8c.html#a5">gVRes</a>       = m-&gt;VRes;
00777         <a class="code" href="../../d2/d8/api_8c.html#a6">gColorDepth</a> = m-&gt;ColorDepth;
00778 
00779 <span class="preprocessor">#if DBG</span>
00780 <span class="preprocessor"></span>        gulConnectCount++;
00781 <span class="preprocessor">#endif // DBG</span>
00782 <span class="preprocessor"></span>    }
00783 
00784 
00785     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00786 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="api.c::W32WinStationDoReconnect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationDoReconnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="api.c::W32WinStationExitWindows" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationExitWindows           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00790">790</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00931">gSessionId</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00792 {
00793     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00794     WINSTATIONEXITWINDOWSMSG*   m = &amp;pMsg-&gt;u.ExitWindows;
00795 
00796     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a327">gSessionId</a> == 0) {
00797         <span class="comment">//BUGBUG v-nicbd: I am just wondering why it would be meaningless for the console. (?)</span>
00798         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"W32WinStationExitWindows meaningless for main session\n"</span>));
00799         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00800     }
00801 
00802     UserAssert(gulConnectCount &lt;= 1);
00803 
00804     <span class="comment">/*</span>
00805 <span class="comment">     *  Tell winlogon to logoff</span>
00806 <span class="comment">     */</span>
00807     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_REMOTELOGOFF);
00808 
00809     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00810         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteLogoff failed with Status %lx\n"</span>, Status));
00811     }
00812 
00813     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00814 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="api.c::W32WinStationExitWindows" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationExitWindows           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="api.c::W32WinStationNtSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationNtSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00979">979</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00981 {
00982     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00983 
00984     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_REMOTENTSECURITY);
00985 
00986     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00987         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteNtSecurity failed with Status %lx\n"</span>, Status));
00988     }
00989 
00990     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00991     UNREFERENCED_PARAMETER(pMsg);
00992 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="api.c::W32WinStationNtSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationNtSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a65" doxytag="api.c::W32WinStationPassthruDisable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationPassthruDisable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l01152">1152</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01154 {
01155     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01156 
01157     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_REMOTEPASSTHRUDISABLE);
01158 
01159     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01160         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemotePassthruDisable failed with Status %lx\n"</span>, Status));
01161     }
01162 
01163     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01164     UNREFERENCED_PARAMETER(pMsg);
01165 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="api.c::W32WinStationPassthruDisable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationPassthruDisable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a64" doxytag="api.c::W32WinStationPassthruEnable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationPassthruEnable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l01135">1135</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01137 {
01138     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01139 
01140     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_XXXREMOTEPASSTHRUENABLE);
01141 
01142     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01143         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"xxxRemotePassthruEnable failed with Status %lx\n"</span>, Status));
01144     }
01145 
01146     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01147     UNREFERENCED_PARAMETER(pMsg);
01148 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="api.c::W32WinStationPassthruEnable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationPassthruEnable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="api.c::W32WinStationSendWindowMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationSendWindowMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l01028">1028</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/server_2sendmsg_8c-source.html#l00123">RemoteDoSendWindowMessage()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01030 {
01031 
01032     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01033     
01034     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d6/server_2sendmsg_8c.html#a2">RemoteDoSendWindowMessage</a>(pMsg);
01035 
01036     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01037         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteDoSendWindowMessage failed with Status 0x%lx\n"</span>, Status));
01038     }
01039 
01040     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01041 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="api.c::W32WinStationSendWindowMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationSendWindowMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a63" doxytag="api.c::W32WinStationShadowCleanup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationShadowCleanup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l01116">1116</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04648">NtUserCallTwoParam()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01118 {
01119     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01120     WINSTATIONSHADOWCLEANUPMSG* m = &amp;pMsg-&gt;u.ShadowCleanup;
01121 
01122     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a180">NtUserCallTwoParam</a>((ULONG_PTR)m-&gt;pThinwireData,
01123                                           (ULONG_PTR)m-&gt;ThinwireDataLength,
01124                                           SFI_REMOTESHADOWCLEANUP);
01125 
01126     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01127         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteShadowCleanup failed with Status %lx\n"</span>, Status));
01128     }
01129 
01130     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01131 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="api.c::W32WinStationShadowCleanup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationShadowCleanup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a60" doxytag="api.c::W32WinStationShadowSetup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationShadowSetup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l01063">1063</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01065 {
01066     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01067     WINSTATIONSHADOWSETUPMSG* m = &amp;pMsg-&gt;u.ShadowSetup;
01068 
01069     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_XXXREMOTESHADOWSETUP);
01070 
01071     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01072         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"xxxRemoteShadowSetup failed with Status %lx\n"</span>, Status));
01073     }
01074 
01075     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01076 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="api.c::W32WinStationShadowSetup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationShadowSetup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a61" doxytag="api.c::W32WinStationShadowStart" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationShadowStart           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l01080">1080</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04648">NtUserCallTwoParam()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01082 {
01083     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01084     WINSTATIONSHADOWSTARTMSG* m = &amp;pMsg-&gt;u.ShadowStart;
01085 
01086     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a180">NtUserCallTwoParam</a>((ULONG_PTR)m-&gt;pThinwireData,
01087                                           (ULONG_PTR)m-&gt;ThinwireDataLength,
01088                                           SFI_REMOTESHADOWSTART);
01089 
01090     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01091         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteShadowStart failed with Status %lx\n"</span>, Status));
01092     }
01093 
01094     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01095 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="api.c::W32WinStationShadowStart" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationShadowStart           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a62" doxytag="api.c::W32WinStationShadowStop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationShadowStop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l01099">1099</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01101 {
01102     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01103     WINSTATIONSHADOWSTOPMSG* m = &amp;pMsg-&gt;u.ShadowStop;
01104 
01105     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_XXXREMOTESHADOWSTOP);
01106 
01107     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01108         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"xxxRemoteShadowStop failed with Status %lx\n"</span>, Status));
01109     }
01110 
01111     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01112 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="api.c::W32WinStationShadowStop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationShadowStop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="api.c::W32WinStationTerminate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationTerminate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00818">818</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00162">BHE_FORCE</a>, <a class="el" href="../../d8/d7/w32_2ntuser_2server_2harderr_8c-source.html#l01906">BoostHardError()</a>, <a class="el" href="../../d2/d8/api_8c.html#a22">CleanupSessionObjectDirectories()</a>, <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00191">g_hDoMessageEvent</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00056">G_IcaBeepChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00057">G_IcaCommandChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00055">G_IcaKeyboardChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00054">G_IcaMouseChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00058">G_IcaThinwireChannel</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00053">G_IcaVideoChannel</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00948">gbExitInProgress</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00044">gdwHardErrorThreadId</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00040">ghportLPC</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d3/command_8c-source.html#l00028">WinStationIcaApiPort</a>.
<p>
<pre class="fragment"><div>00820 {
00821     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00822     HANDLE   hevtShutDown;
00823     HANDLE   hevtRitExited, hevtRitStuck;
00824 
00825 <span class="keyword">extern</span> HANDLE <a class="code" href="../../d4/d4/command_8c.html#a2">WinStationIcaApiPort</a>;
00826 
00827     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a340">gbExitInProgress</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00828 
00829     <span class="comment">/*</span>
00830 <span class="comment">     * Get rid of hard error thread</span>
00831 <span class="comment">     */</span>
00832 
00833     
00834     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a12">gdwHardErrorThreadId</a> != 0) {
00835 
00836         <a class="code" href="../../d7/d1/usersrv_8h.html#a53">BoostHardError</a>(-1, BHE_FORCE);
00837 
00838         <span class="comment">/*</span>
00839 <span class="comment">         * Poll (!!?) for hard error thread completion.  The thread does</span>
00840 <span class="comment">         * not exit.</span>
00841 <span class="comment">         */</span>
00842         <span class="keywordflow">while</span> (<a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a12">gdwHardErrorThreadId</a> != 0) {
00843             <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"Waiting for hard error thread to stop...\n"</span>));
00844 
00845             Sleep(3 * 1000);
00846         }
00847 
00848         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"Stopped hard error thread\n"</span>));
00849     }
00850 
00851     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a20">g_hDoMessageEvent</a>)
00852         <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(g_hDoMessageEvent, NULL);
00853 
00854     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a10">G_IcaMouseChannel</a>) {
00855         CloseHandle(G_IcaMouseChannel);
00856         <a class="code" href="../../d2/d8/api_8c.html#a10">G_IcaMouseChannel</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00857     }
00858 
00859     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a11">G_IcaKeyboardChannel</a>) {
00860         CloseHandle(G_IcaKeyboardChannel);
00861         <a class="code" href="../../d2/d8/api_8c.html#a11">G_IcaKeyboardChannel</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00862     }
00863 
00864     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a13">G_IcaCommandChannel</a>) {
00865         CloseHandle(G_IcaCommandChannel);
00866         <a class="code" href="../../d2/d8/api_8c.html#a13">G_IcaCommandChannel</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00867     }
00868 
00869     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a9">G_IcaVideoChannel</a>) {
00870         CloseHandle(G_IcaVideoChannel);
00871         <a class="code" href="../../d2/d8/api_8c.html#a9">G_IcaVideoChannel</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00872     }
00873     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a12">G_IcaBeepChannel</a>) {
00874         CloseHandle(G_IcaBeepChannel);
00875         <a class="code" href="../../d2/d8/api_8c.html#a12">G_IcaBeepChannel</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00876     }
00877     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a14">G_IcaThinwireChannel</a>) {
00878         CloseHandle(G_IcaThinwireChannel);
00879         <a class="code" href="../../d2/d8/api_8c.html#a14">G_IcaThinwireChannel</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00880     }
00881     
00882     hevtShutDown = OpenEvent(EVENT_ALL_ACCESS,
00883                              FALSE,
00884                              L<span class="stringliteral">"EventShutDownCSRSS"</span>);
00885 
00886     <span class="keywordflow">if</span> (hevtShutDown == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00887         <span class="comment">/*</span>
00888 <span class="comment">         * This case is for cached sessions where RIT and Destiop thread have</span>
00889 <span class="comment">         * not been created.</span>
00890 <span class="comment">         */</span>
00891         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"W32WinStationTerminate terminating CSRSS ...\n"</span>));
00892 
00893         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/api_8c.html#a22">CleanupSessionObjectDirectories</a>();
00894 
00895         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a7">ghportLPC</a>) {
00896             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(ghportLPC);
00897             <a class="code" href="../../d2/d8/api_8c.html#a7">ghportLPC</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00898         }
00899 
00900         <span class="keywordflow">return</span> 0;
00901     }
00902 
00903     hevtRitExited = CreateEvent(NULL,
00904                                 FALSE,
00905                                 FALSE,
00906                                 L<span class="stringliteral">"EventRitExited"</span>);
00907 
00908     UserAssert(hevtRitExited != NULL);
00909 
00910     hevtRitStuck = CreateEvent(NULL,
00911                                FALSE,
00912                                FALSE,
00913                                L<span class="stringliteral">"EventRitStuck"</span>);
00914 
00915     UserAssert(hevtRitStuck != NULL);
00916     
00917     <span class="comment">/*</span>
00918 <span class="comment">     * RIT is created. Signal this event that starts the</span>
00919 <span class="comment">     * cleanup in win32k</span>
00920 <span class="comment">     */</span>
00921     SetEvent(hevtShutDown);
00922 
00923     <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"EventShutDownCSRSS set in CSRSS ...\n"</span>));
00924 
00925     
00926     <span class="keywordflow">while</span> (1) {
00927 
00928         HANDLE arHandles[2] = {hevtRitExited, hevtRitStuck};
00929         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  result;
00930         
00931         result = WaitForMultipleObjects(2, arHandles, FALSE, INFINITE);
00932 
00933         <span class="keywordflow">switch</span> (result) {
00934         <span class="keywordflow">case</span> WAIT_OBJECT_0:
00935             <span class="keywordflow">goto</span> RITExited;
00936         
00937         <span class="keywordflow">case</span> WAIT_OBJECT_0 + 1:
00938             
00939             <span class="comment">/*</span>
00940 <span class="comment">             * The RIT is stucked because there are still GUI threads</span>
00941 <span class="comment">             * assigned to desktops. One reason for this is that winlogon</span>
00942 <span class="comment">             * died w/o calling ExitWindowsEx.</span>
00943 <span class="comment">             */</span>
00944             UserAssert(ghportLPC != NULL);
00945 
00946             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a7">ghportLPC</a>) {
00947                 <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(ghportLPC);
00948                 <a class="code" href="../../d2/d8/api_8c.html#a7">ghportLPC</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00949             }
00950             <span class="keywordflow">break</span>;
00951         <span class="keywordflow">default</span>:
00952             UserAssert(0);
00953             <span class="keywordflow">break</span>;
00954         }
00955     }
00956     
00957 RITExited:
00958 
00959     <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"EventRitExited set in CSRSS ...\n"</span>));
00960 
00961     CloseHandle(hevtRitExited);
00962     CloseHandle(hevtRitStuck);
00963 
00964     CloseHandle(hevtShutDown);
00965 
00966     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/api_8c.html#a22">CleanupSessionObjectDirectories</a>();
00967 
00968     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/api_8c.html#a7">ghportLPC</a>) {
00969         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(ghportLPC);
00970         <a class="code" href="../../d2/d8/api_8c.html#a7">ghportLPC</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00971     }
00972 
00973     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00974     UNREFERENCED_PARAMETER(pMsg);
00975 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="api.c::W32WinStationTerminate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationTerminate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a59" doxytag="api.c::W32WinStationThinwireStats" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationThinwireStats           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWINSTATION_APIMSG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pMsg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l01045">1045</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04526">NtUserCallOneParam()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01047 {
01048     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01049     WINSTATIONTHINWIRESTATSMSG* m = &amp;pMsg-&gt;u.ThinwireStats;
01050 
01051     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a174">NtUserCallOneParam</a>((ULONG_PTR)&amp;m-&gt;Stats,
01052                                           SFI_REMOTETHINWIRESTATS);
01053 
01054     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01055         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"RemoteThinwireStats failed with Status %lx\n"</span>, Status));
01056     }
01057 
01058     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01059 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="api.c::W32WinStationThinwireStats" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS W32WinStationThinwireStats           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PWINSTATION_APIMSG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="api.c::Win32CommandChannelThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS Win32CommandChannelThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="api.c::WinStationAPIInit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS WinStationAPIInit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00212">212</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00931">gSessionId</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00138">NtResumeThread()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d1/rtlexec_8c-source.html#l01241">RtlCreateUserThread()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d8/api_8c.html#a42">TerminalServerRequestThread()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00138">ThreadHandle</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.
<p>
<pre class="fragment"><div>00214 {
00215     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00216     CLIENT_ID ClientId;
00217     HANDLE    <a class="code" href="../../d2/d1/cttoken_8c.html#a63">ThreadHandle</a>;
00218     KPRIORITY Priority;
00219 
00220 <span class="preprocessor">#if DBG</span>
00221 <span class="preprocessor"></span>    <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Inited = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00222 <span class="preprocessor">#endif</span>
00223 <span class="preprocessor"></span>
00224     UserAssert(Inited == FALSE);
00225 
00226     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a327">gSessionId</a> = NtCurrentPeb()-&gt;SessionId;
00227 
00228 <span class="preprocessor">#if DBG</span>
00229 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Inited)
00230         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"WinStationAPIInit called twice !!!\n"</span>));
00231 
00232     Inited = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00233 <span class="preprocessor">#endif</span>
00234 <span class="preprocessor"></span>
00235     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d2/rtlexec_8c.html#a13">RtlCreateUserThread</a>(NtCurrentProcess(),
00236                               NULL,
00237                               TRUE,
00238                               0L,
00239                               0L,
00240                               0L,
00241                               TerminalServerRequestThread,
00242                               NULL,
00243                               &amp;ThreadHandle,
00244                               &amp;ClientId);
00245 
00246     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00247         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"WinStationAPIInit: failed to create TerminalServerRequestThread\n"</span>));
00248         <span class="keywordflow">goto</span> Exit;
00249     }
00250     <span class="comment">/*</span>
00251 <span class="comment">     *  Add thread to server thread pool</span>
00252 <span class="comment">     */</span>
00253     CsrAddStaticServerThread(ThreadHandle, &amp;ClientId, 0);
00254 
00255     <span class="comment">/*</span>
00256 <span class="comment">     * Boost priority of ICA SRV Request thread</span>
00257 <span class="comment">     */</span>
00258     Priority = THREAD_BASE_PRIORITY_MAX;
00259 
00260     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d1/psquery_8c.html#a21">NtSetInformationThread</a>(ThreadHandle, ThreadBasePriority,
00261                                  &amp;Priority, <span class="keyword">sizeof</span>(Priority));
00262 
00263     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00264         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"WinStationAPIInit: failed to set thread priority\n"</span>));
00265         <span class="keywordflow">goto</span> Exit;
00266     }
00267 
00268     <span class="comment">/*</span>
00269 <span class="comment">     * Resume the thread now that we've initialized things.</span>
00270 <span class="comment">     */</span>
00271     <a class="code" href="../../d1/d2/psspnd_8c.html#a1">NtResumeThread</a>(ThreadHandle, NULL);
00272 
00273 
00274 Exit:
00275     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00276 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a20" doxytag="api.c::g_hDoMessageEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d6/d4/icamsg_8c.html#a6">g_hDoMessageEvent</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00191">191</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d3/icamsg_8c-source.html#l00068">RemoteDoMessage()</a>, <a class="el" href="../../d7/d3/icamsg_8c-source.html#l00167">RemoteMessageThread()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00818">W32WinStationTerminate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="api.c::G_IcaBeepChannel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d2/d8/api_8c.html#a12">G_IcaBeepChannel</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00056">56</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00818">W32WinStationTerminate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="api.c::G_IcaCommandChannel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d4/d4/command_8c.html#a1">G_IcaCommandChannel</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00057">57</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00818">W32WinStationTerminate()</a>, and <a class="el" href="../../d5/d3/command_8c-source.html#l00035">Win32CommandChannelThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="api.c::G_IcaKeyboardChannel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d2/d8/api_8c.html#a11">G_IcaKeyboardChannel</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00055">55</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00818">W32WinStationTerminate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="api.c::G_IcaMouseChannel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d2/d8/api_8c.html#a10">G_IcaMouseChannel</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00054">54</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00818">W32WinStationTerminate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="api.c::G_IcaThinwireChannel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d2/d8/api_8c.html#a14">G_IcaThinwireChannel</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00058">58</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00818">W32WinStationTerminate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="api.c::G_IcaVideoChannel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d4/d4/command_8c.html#a0">G_IcaVideoChannel</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00053">53</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00818">W32WinStationTerminate()</a>, and <a class="el" href="../../d5/d3/command_8c-source.html#l00035">Win32CommandChannelThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="api.c::G_WinStationName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d2/d8/api_8c.html#a15">G_WinStationName</a>[WINSTATIONNAME_LENGTH]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00059">59</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l00692">W32WinStationDoDisconnect()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00718">W32WinStationDoReconnect()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="api.c::gbExitInProgress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d6/d4/icamsg_8c.html#a0">gbExitInProgress</a> = FALSE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00042">42</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="api.c::gColorDepth" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d2/d8/api_8c.html#a6">gColorDepth</a> = 0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00038">38</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00718">W32WinStationDoReconnect()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="api.c::ghportLPC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d2/d8/api_8c.html#a7">ghportLPC</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00040">40</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00279">TerminalServerRequestThread()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00818">W32WinStationTerminate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="api.c::gHRes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d2/d8/api_8c.html#a4">gHRes</a> = 0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00036">36</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00718">W32WinStationDoReconnect()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="api.c::gVRes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d2/d8/api_8c.html#a5">gVRes</a> = 0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00037">37</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00504">W32WinStationDoConnect()</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00718">W32WinStationDoReconnect()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="api.c::Win32WinStationDispatch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d8/struct__WIN32WINSTATION__DISPATCH.html">WIN32WINSTATION_DISPATCH</a> <a class="el" href="../../d2/d8/api_8c.html#a19">Win32WinStationDispatch</a>[SMWinStationMaxApiNumber]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
    <a class="code" href="../../d2/d8/api_8c.html#a26">W32WinStationDoConnect</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a27">W32WinStationDoDisconnect</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a28">W32WinStationDoReconnect</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a29">W32WinStationExitWindows</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a30">W32WinStationTerminate</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a31">W32WinStationNtSecurity</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a32">W32WinStationDoMessage</a>,
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a33">W32WinStationThinwireStats</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a34">W32WinStationShadowSetup</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a35">W32WinStationShadowStart</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a36">W32WinStationShadowStop</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a37">W32WinStationShadowCleanup</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a38">W32WinStationPassthruEnable</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a39">W32WinStationPassthruDisable</a>,
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 
    <a class="code" href="../../d2/d8/api_8c.html#a40">W32WinStationBroadcastSystemMessage</a>,
    <a class="code" href="../../d2/d8/api_8c.html#a41">W32WinStationSendWindowMessage</a>,
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00122">122</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/api_8c-source.html#l00279">TerminalServerRequestThread()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:53 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
