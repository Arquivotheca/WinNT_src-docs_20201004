<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: directio.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>directio.c File Reference</h1><code>#include "<a class="el" href="../../d7/d2/w32_2ntcon_2server_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d3/d7/directio_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a0">TranslateInputToOem</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN OUT PINPUT_RECORD InputRecords, IN ULONG NumRecords)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a1">TranslateInputToUnicode</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN OUT PINPUT_RECORD InputRecords, IN ULONG NumRecords)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a2">DirectReadWaitRoutine</a> (IN PLIST_ENTRY WaitQueue, IN PCSR_THREAD WaitingThread, IN PCSR_API_MSG WaitReplyMessage, IN PVOID WaitParameter, IN PVOID SatisfyParameter1, IN PVOID SatisfyParameter2, IN ULONG WaitFlags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a3">SrvGetConsoleInput</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a4">SrvWriteConsoleInput</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a5">SB_TranslateOutputToOem</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN OUT PCHAR_INFO OutputBuffer, IN COORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a6">SB_TranslateOutputToOemUnicode</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN OUT PCHAR_INFO OutputBuffer, IN COORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a7">SB_TranslateOutputToUnicode</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN OUT PCHAR_INFO OutputBuffer, IN COORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a8">SB_TranslateOutputToAnsiUnicode</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN OUT PCHAR_INFO OutputBuffer, IN COORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a9">FE_TranslateOutputToAnsiUnicodeInternal</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN OUT PCHAR_INFO OutputBuffer, IN COORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN OUT PCHAR_INFO OutputBufferR, IN BOOL fRealUnicodeToFalseUnicode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a10">FE_TranslateOutputToAnsiUnicode</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN OUT PCHAR_INFO OutputBuffer, IN COORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN OUT PCHAR_INFO OutputBufferR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a11">TranslateOutputToPaddingUnicode</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN OUT PCHAR_INFO OutputBuffer, IN COORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN OUT PCHAR_INFO OutputBufferR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a12">SrvReadConsoleOutput</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a13">SrvWriteConsoleOutput</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a14">SrvReadConsoleOutputString</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a15">SrvWriteConsoleOutputString</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a16">SrvFillConsoleOutput</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d8/directio_8c.html#a17">SrvCreateConsoleScreenBuffer</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="directio.c::DirectReadWaitRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN DirectReadWaitRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLIST_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitQueue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitParameter</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SatisfyParameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SatisfyParameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l00267">267</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00229">_CONSOLE_GETCONSOLEINPUT_MSG::BufPtr</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00023">_DIRECT_READ_DATA::Console</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00110">CONSOLE_CTRL_BREAK_SEEN</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00109">CONSOLE_CTRL_C_SEEN</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00348">ConsoleLocked</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00267">DirectReadWaitRoutine()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a23">FE_TranslateInputToOem()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00231">_CONSOLE_GETCONSOLEINPUT_MSG::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00306">HANDLE_CLOSING</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00025">_DIRECT_READ_DATA::HandleIndex</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00223">INPUT_RECORD_BUFFER_SIZE</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00066">_INPUT_READ_HANDLE_DATA::InputHandleFlags</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00022">_DIRECT_READ_DATA::InputInfo</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00318">_HANDLE_DATA::InputReadData</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00112">LockReadCount</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00230">_CONSOLE_GETCONSOLEINPUT_MSG::NumRecords</a>, <a class="el" href="../../d3/d8/directio_8h.html#a1">PDIRECT_READ_DATA</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00024">_DIRECT_READ_DATA::ProcessData</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00065">_INPUT_READ_HANDLE_DATA::ReadCount</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00959">ReadInputBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00228">_CONSOLE_GETCONSOLEINPUT_MSG::Record</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a22">TranslateInputToOem()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00232">_CONSOLE_GETCONSOLEINPUT_MSG::Unicode</a>, and <a class="el" href="../../d0/d3/input_8h-source.html#l00113">UnlockReadCount</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l00267">DirectReadWaitRoutine()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l00556">SrvGetConsoleInput()</a>.
<p>
<pre class="fragment"><div>00279                    :
00280 
00281     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to complete a direct read that blocked in
00282     <a class="code" href="../../d8/d5/consrv_8h.html#a136">ReadInputBuffer</a>.  The context of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> read was saved in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DirectReadData
00283     structure.  This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called when events have been written to
00284     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> writing thread.
00285 
00286 Arguments:
00287 
00288     WaitQueue - Pointer to queue containing wait block.
00289 
00290     WaitingThread - Pointer to waiting thread.
00291 
00292     WaitReplyMessage - Pointer to reply message to <span class="keywordflow">return</span> to dll when
00293         read <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> completed.
00294 
00295     DirectReadData - Context of read.
00296 
00297     SatisfyParameter1 - Unused.
00298 
00299     SatisfyParameter2 - Unused.
00300 
00301     WaitFlags - Flags indicating status of wait.
00302 
00303 Return Value:
00304 
00305 --*/
00306 
00307 {
00308     <a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html">PCONSOLE_GETCONSOLEINPUT_MSG</a> a;
00309     PINPUT_RECORD <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00310     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00311     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00312     <a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html">PDIRECT_READ_DATA</a> DirectReadData;
00313     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00314     BOOLEAN RetVal = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00315 <span class="preprocessor">#if defined(FE_SB)</span>
00316 <span class="preprocessor"></span>    BOOLEAN fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00317     PDWORD  nLength;
00318 <span class="preprocessor">#endif</span>
00319 <span class="preprocessor"></span>
00320     a = (<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html">PCONSOLE_GETCONSOLEINPUT_MSG</a>)&amp;WaitReplyMessage-&gt;u.ApiMessageData;
00321     DirectReadData = (<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html">PDIRECT_READ_DATA</a>) WaitParameter;
00322 
00323     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(DirectReadData-&gt;<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o2">ProcessData</a>,
00324                                         DirectReadData-&gt;<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o3">HandleIndex</a>,
00325                                         &amp;HandleData
00326                                        );
00327     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00328 
00329     <span class="comment">//</span>
00330     <span class="comment">// see if this routine was called by CloseInputHandle.  if it</span>
00331     <span class="comment">// was, see if this wait block corresponds to the dying handle.</span>
00332     <span class="comment">// if it doesn't, just return.</span>
00333     <span class="comment">//</span>
00334 
00335     <span class="keywordflow">if</span> (SatisfyParameter1 != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00336         SatisfyParameter1 != HandleData) {
00337         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00338     }
00339 
00340     <span class="comment">//</span>
00341     <span class="comment">// if ctrl-c or ctrl-break was seen, ignore it.</span>
00342     <span class="comment">//</span>
00343 
00344     <span class="keywordflow">if</span> ((ULONG_PTR)SatisfyParameter2 &amp; (<a class="code" href="../../d9/d3/input_8h.html#a23">CONSOLE_CTRL_C_SEEN</a> | <a class="code" href="../../d9/d3/input_8h.html#a24">CONSOLE_CTRL_BREAK_SEEN</a>)) {
00345         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00346     }
00347 
00348     Console = DirectReadData-&gt;<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o1">Console</a>;
00349 
00350 <span class="preprocessor">#if defined(FE_SB)</span>
00351 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console) &amp;&amp; !a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>) {
00352         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
00353             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a> == 1) {
00354                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o2">Record</a>[0];
00355                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte;
00356                 <span class="keywordflow">if</span> (!(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE))
00357                     RtlZeroMemory(&amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
00358                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00359             }
00360         }
00361     }
00362 <span class="preprocessor">#endif</span>
00363 <span class="preprocessor"></span>
00364     <span class="comment">//</span>
00365     <span class="comment">// this routine should be called by a thread owning the same</span>
00366     <span class="comment">// lock on the same console as we're reading from.</span>
00367     <span class="comment">//</span>
00368 
00369     <span class="keywordflow">try</span> {
00370         <a class="code" href="../../d9/d3/input_8h.html#a25">LockReadCount</a>(HandleData);
00371         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o1">ReadCount</a>);
00372         HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o1">ReadCount</a> -= 1;
00373         <a class="code" href="../../d9/d3/input_8h.html#a26">UnlockReadCount</a>(HandleData);
00374 
00375         <span class="comment">//</span>
00376         <span class="comment">// see if called by CsrDestroyProcess or CsrDestroyThread</span>
00377         <span class="comment">// via CsrNotifyWaitBlock.   if so, just decrement the ReadCount</span>
00378         <span class="comment">// and return.</span>
00379         <span class="comment">//</span>
00380 
00381         <span class="keywordflow">if</span> (WaitFlags &amp; CSR_PROCESS_TERMINATING) {
00382             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_THREAD_IS_TERMINATING;
00383             leave;
00384         }
00385 
00386         <span class="comment">//</span>
00387         <span class="comment">// We must see if we were woken up because the handle is being</span>
00388         <span class="comment">// closed.  if so, we decrement the read count.  if it goes to</span>
00389         <span class="comment">// zero, we wake up the close thread.  otherwise, we wake up any</span>
00390         <span class="comment">// other thread waiting for data.</span>
00391         <span class="comment">//</span>
00392 
00393         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o2">InputHandleFlags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a51">HANDLE_CLOSING</a>) {
00394             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (SatisfyParameter1 == HandleData);
00395             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_ALERTED;
00396             leave;
00397         }
00398 
00399         <span class="comment">//</span>
00400         <span class="comment">// if we get to here, this routine was called either by the input</span>
00401         <span class="comment">// thread or a write routine.  both of these callers grab the</span>
00402         <span class="comment">// current console lock.</span>
00403         <span class="comment">//</span>
00404 
00405         <span class="comment">//</span>
00406         <span class="comment">// this routine should be called by a thread owning the same</span>
00407         <span class="comment">// lock on the same console as we're reading from.</span>
00408         <span class="comment">//</span>
00409 
00410         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d1/d7/server_8h.html#a63">ConsoleLocked</a>(Console));
00411 
00412         <span class="comment">//</span>
00413         <span class="comment">// if the read buffer is contained within the message, we need to</span>
00414         <span class="comment">// reset the buffer pointer because the message copied from the</span>
00415         <span class="comment">// stack to heap space when the wait block was created.</span>
00416         <span class="comment">//</span>
00417 
00418         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a> &lt;= <a class="code" href="../../d5/d5/conmsg_8h.html#a7">INPUT_RECORD_BUFFER_SIZE</a>) {
00419             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o2">Record</a>;
00420         } <span class="keywordflow">else</span> {
00421             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o3">BufPtr</a>;
00422         }
00423 <span class="preprocessor">#if defined(FE_SB)</span>
00424 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console) ) {
00425             Console-&gt;ReadConInpNumBytesUnicode = a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>;
00426             <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>) {
00427                 <span class="comment">/*</span>
00428 <span class="comment">                 * ASCII : a-&gt;NumRecords is ASCII byte count</span>
00429 <span class="comment">                 */</span>
00430                 <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
00431                     <span class="comment">/*</span>
00432 <span class="comment">                     * Saved DBCS Traling byte</span>
00433 <span class="comment">                     */</span>
00434                     <span class="keywordflow">if</span> (Console-&gt;ReadConInpNumBytesUnicode != 1) {
00435                         Console-&gt;ReadConInpNumBytesUnicode--;
00436                         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++;
00437                         fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00438                         nLength = &amp;Console-&gt;ReadConInpNumBytesUnicode;
00439                     }
00440                     <span class="keywordflow">else</span> {
00441                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Console-&gt;ReadConInpNumBytesUnicode==1);
00442                     }
00443                 }
00444                 <span class="keywordflow">else</span> {
00445                     nLength = &amp;Console-&gt;ReadConInpNumBytesUnicode;
00446                 }
00447             }
00448             <span class="keywordflow">else</span> {
00449                 nLength = &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>;
00450             }
00451         }
00452         <span class="keywordflow">else</span> {
00453             nLength = &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>;
00454         }
00455         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a25">ReadInputBuffer</a>(DirectReadData-&gt;<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o0">InputInfo</a>,
00456                                  Buffer,
00457                                  nLength,
00458                                  !!(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE),
00459                                  !(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOWAIT),
00460                                  FALSE,
00461                                  Console,
00462                                  HandleData,
00463                                  WaitReplyMessage,
00464                                  DirectReadWaitRoutine,
00465                                  &amp;DirectReadData,
00466                                  <span class="keyword">sizeof</span>(DirectReadData),
00467                                  TRUE,
00468                                  a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>
00469                                 );
00470 <span class="preprocessor">#else</span>
00471 <span class="preprocessor"></span>        <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a25">ReadInputBuffer</a>(DirectReadData-&gt;<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o0">InputInfo</a>,
00472                                  Buffer,
00473                                  &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>,
00474                                  !!(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE),
00475                                  !(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOWAIT),
00476                                  FALSE,
00477                                  Console,
00478                                  HandleData,
00479                                  WaitReplyMessage,
00480                                  DirectReadWaitRoutine,
00481                                  &amp;DirectReadData,
00482                                  <span class="keyword">sizeof</span>(DirectReadData),
00483                                  TRUE
00484                                 );
00485 <span class="preprocessor">#endif</span>
00486 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
00487             RetVal = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00488         }
00489     } finally {
00490 
00491         <span class="comment">//</span>
00492         <span class="comment">// if the read was completed (status != wait), free the direct read</span>
00493         <span class="comment">// data.</span>
00494         <span class="comment">//</span>
00495 
00496         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
00497             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_SUCCESS &amp;&amp; !a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>) {
00498 <span class="preprocessor">#if defined(FE_SB)</span>
00499 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console) ) {
00500                     <span class="keywordflow">if</span> (fAddDbcsLead &amp;&amp;
00501                         HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
00502                         a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>--;
00503                     }
00504                     a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a23">FE_TranslateInputToOem</a>(
00505                                         Console,
00506                                         Buffer,
00507                                         a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>,
00508                                         Console-&gt;ReadConInpNumBytesUnicode,
00509                                         a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE ?
00510                                             NULL :
00511                                             &amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte);
00512                     <span class="keywordflow">if</span> (fAddDbcsLead &amp;&amp;
00513                         HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
00514                         *(<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-1) = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte;
00515                         <span class="keywordflow">if</span> (!(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE))
00516                             RtlZeroMemory(&amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
00517                         a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>++;
00518                         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>--;
00519                     }
00520                 }
00521                 <span class="keywordflow">else</span> {
00522                     <a class="code" href="../../d6/d8/dispatch_8h.html#a22">TranslateInputToOem</a>(Console,
00523                                          Buffer,
00524                                          a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>,
00525                                          Console-&gt;ReadConInpNumBytesUnicode,
00526                                          a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE ?
00527                                              NULL :
00528                                              &amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte
00529                                         );
00530                 }
00531 <span class="preprocessor">#else</span>
00532 <span class="preprocessor"></span>                <a class="code" href="../../d6/d8/dispatch_8h.html#a22">TranslateInputToOem</a>(Console,
00533                                      Buffer,
00534                                      a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>
00535                                     );
00536 <span class="preprocessor">#endif</span>
00537 <span class="preprocessor"></span>            }
00538             WaitReplyMessage-&gt;ReturnValue = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00539             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(DirectReadData);
00540         }
00541     }
00542 
00543     <span class="keywordflow">return</span> RetVal;
00544 
00545     <span class="comment">//</span>
00546     <span class="comment">// satisfy the unreferenced parameter warnings.</span>
00547     <span class="comment">//</span>
00548 
00549     UNREFERENCED_PARAMETER(WaitQueue);
00550     UNREFERENCED_PARAMETER(WaitingThread);
00551     UNREFERENCED_PARAMETER(SatisfyParameter2);
00552 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="directio.c::FE_TranslateOutputToAnsiUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FE_TranslateOutputToAnsiUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBufferR</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01174">1174</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/directio_8c-source.html#l01115">FE_TranslateOutputToAnsiUnicodeInternal()</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">SrvWriteConsoleOutput()</a>.
<p>
<pre class="fragment"><div>01181 {
01182     <span class="keywordflow">return</span> <a class="code" href="../../d2/d8/directio_8c.html#a9">FE_TranslateOutputToAnsiUnicodeInternal</a>(Console,
01183                                                    OutputBuffer,
01184                                                    Size,
01185                                                    OutputBufferR,
01186                                                    TRUE
01187                                                    );
01188 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="directio.c::FE_TranslateOutputToAnsiUnicodeInternal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FE_TranslateOutputToAnsiUnicodeInternal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBufferR</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fRealUnicodeToFalseUnicode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01115">1115</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">RealUnicodeToFalseUnicode()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00018">UNICODE_DBCS_PADDING</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03111">UNICODE_SPACE</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l01174">FE_TranslateOutputToAnsiUnicode()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l01191">TranslateOutputToPaddingUnicode()</a>.
<p>
<pre class="fragment"><div>01123 {
01124     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
01125     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"TranslateOutputToAnsiUnicode\n"</span>));
01126 
01127     <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y; i++) {
01128         <span class="keywordflow">for</span> (j=0; j &lt; <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X; j++) {
01129             WCHAR wch = OutputBuffer-&gt;Char.UnicodeChar;
01130 
01131             <span class="keywordflow">if</span> (fRealUnicodeToFalseUnicode) {
01132                 <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a42">RealUnicodeToFalseUnicode</a>(&amp;OutputBuffer-&gt;Char.UnicodeChar,
01133                                           1,
01134                                           Console-&gt;OutputCP
01135                                          );
01136             }
01137 
01138             <span class="keywordflow">if</span> (OutputBufferR) {
01139                 OutputBufferR-&gt;Attributes = OutputBuffer-&gt;Attributes &amp; ~COMMON_LVB_SBCSDBCS;
01140                 <span class="keywordflow">if</span> (IsConsoleFullWidth(Console-&gt;hDC,
01141                                        Console-&gt;OutputCP,OutputBuffer-&gt;Char.UnicodeChar)) {
01142                     <span class="keywordflow">if</span> (j == <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X-1){
01143                         OutputBufferR-&gt;Char.UnicodeChar = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a>;
01144                     }
01145                     <span class="keywordflow">else</span>{
01146                         OutputBufferR-&gt;Char.UnicodeChar = OutputBuffer-&gt;Char.UnicodeChar;
01147                         OutputBufferR-&gt;Attributes |= COMMON_LVB_LEADING_BYTE;
01148                         OutputBufferR++;
01149                         OutputBufferR-&gt;Char.UnicodeChar = <a class="code" href="../../d0/d3/dbcs_8h.html#a0">UNICODE_DBCS_PADDING</a>;
01150                         OutputBufferR-&gt;Attributes = OutputBuffer-&gt;Attributes &amp; ~COMMON_LVB_SBCSDBCS;
01151                         OutputBufferR-&gt;Attributes |= COMMON_LVB_TRAILING_BYTE;
01152                     }
01153                 }
01154                 <span class="keywordflow">else</span>{
01155                     OutputBufferR-&gt;Char.UnicodeChar = OutputBuffer-&gt;Char.UnicodeChar;
01156                 }
01157                 OutputBufferR++;
01158             }
01159 
01160             <span class="keywordflow">if</span> (IsConsoleFullWidth(Console-&gt;hDC,
01161                                    Console-&gt;OutputCP,
01162                                    wch)) {
01163                 <span class="keywordflow">if</span> (j != <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X-1){
01164                     j++;
01165                 }
01166             }
01167             OutputBuffer++;
01168         }
01169     }
01170     <span class="keywordflow">return</span> STATUS_SUCCESS;
01171 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="directio.c::SB_TranslateOutputToAnsiUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SB_TranslateOutputToAnsiUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01093">1093</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">RealUnicodeToFalseUnicode()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">SrvWriteConsoleOutput()</a>.
<p>
<pre class="fragment"><div>01099 {
01100     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
01101     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"TranslateOutputToAnsiUnicode\n"</span>));
01102 
01103     j = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X * <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y;
01104 
01105     <span class="keywordflow">for</span> (i=0;i&lt;j;i++,OutputBuffer++) {
01106         <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a42">RealUnicodeToFalseUnicode</a>(&amp;OutputBuffer-&gt;Char.UnicodeChar,
01107                                 1,
01108                                 Console-&gt;OutputCP
01109                                 );
01110     }
01111     <span class="keywordflow">return</span> STATUS_SUCCESS;
01112 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="directio.c::SB_TranslateOutputToOem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SB_TranslateOutputToOem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l00801">801</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00026">USACP</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01489">WcharToChar()</a>, and <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00026">WINDOWSCP</a>.
<p>
<pre class="fragment"><div>00808 {
00809     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
00810     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> Codepage;
00811     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"SB_TranslateOutputToOem(Console=%lx, OutputBuffer=%lx)\n"</span>,
00812             Console, OutputBuffer));
00813 
00814     j = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X * <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y;
00815 
00816     <span class="keywordflow">if</span> ((Console-&gt;CurrentScreenBuffer-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
00817             ((Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) == 0)) {
00818 <span class="preprocessor">#if defined(FE_SB)</span>
00819 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00820             Console-&gt;OutputCP != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a> ) {
00821                 Codepage = <a class="code" href="../../d0/d3/dbcs_8h.html#a5">USACP</a>;
00822         }
00823         <span class="keywordflow">else</span>
00824 <span class="preprocessor">#endif</span>
00825 <span class="preprocessor"></span>        <span class="comment">// we have UnicodeOem characters</span>
00826         Codepage = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>;
00827     } <span class="keywordflow">else</span> {
00828         <span class="comment">// we have real Unicode characters</span>
00829         Codepage = Console-&gt;OutputCP;    <span class="comment">// BUG FIX by KazuM Jun.2.97</span>
00830     }
00831 
00832     <span class="keywordflow">for</span> (i=0;i&lt;j;i++,OutputBuffer++) {
00833         OutputBuffer-&gt;Char.AsciiChar = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a40">WcharToChar</a>(Codepage,
00834                 OutputBuffer-&gt;Char.UnicodeChar);
00835     }
00836     <span class="keywordflow">return</span> STATUS_SUCCESS;
00837 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="directio.c::SB_TranslateOutputToOemUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SB_TranslateOutputToOemUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l00924">924</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
<pre class="fragment"><div>00930 {
00931     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
00932     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"SB_TranslateOutputToOemUnicode\n"</span>));
00933 
00934     j = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X * <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y;
00935 
00936     <span class="keywordflow">for</span> (i=0;i&lt;j;i++,OutputBuffer++) {
00937         <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a43">FalseUnicodeToRealUnicode</a>(&amp;OutputBuffer-&gt;Char.UnicodeChar,
00938                                 1,
00939                                 Console-&gt;OutputCP
00940                                 );
00941     }
00942     <span class="keywordflow">return</span> STATUS_SUCCESS;
00943 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="directio.c::SB_TranslateOutputToUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SB_TranslateOutputToUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l00976">976</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01469">CharToWchar()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00026">USACP</a>, and <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00026">WINDOWSCP</a>.
<p>
<pre class="fragment"><div>00983 {
00984     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
00985     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> Codepage;
00986     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"SB_TranslateOutputToUnicode %lx %lx (%lx,%lx)\n"</span>,
00987             Console, OutputBuffer, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y));
00988 
00989     j = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X * <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y;
00990 
00991     <span class="keywordflow">if</span> ((Console-&gt;CurrentScreenBuffer-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
00992             ((Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) == 0)) {
00993 <span class="preprocessor">#if defined(FE_SB)</span>
00994 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00995             (Console-&gt;OutputCP != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>) ) {
00996                 Codepage = <a class="code" href="../../d0/d3/dbcs_8h.html#a5">USACP</a>;
00997         }
00998         <span class="keywordflow">else</span>
00999 <span class="preprocessor">#endif</span>
01000 <span class="preprocessor"></span>        <span class="comment">// we want UnicodeOem characters</span>
01001         Codepage = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>;
01002     } <span class="keywordflow">else</span> {
01003         <span class="comment">// we want real Unicode characters</span>
01004         Codepage = Console-&gt;OutputCP;    <span class="comment">// BUG FIX by KazuM Jun.2.97</span>
01005     }
01006     <span class="keywordflow">for</span> (i = 0; i &lt; j; i++, OutputBuffer++) {
01007 <span class="preprocessor">#if defined(FE_SB)</span>
01008 <span class="preprocessor"></span>        OutputBuffer-&gt;Char.UnicodeChar = SB_CharToWchar(
01009                 Codepage, OutputBuffer-&gt;Char.AsciiChar);
01010 <span class="preprocessor">#else</span>
01011 <span class="preprocessor"></span>        OutputBuffer-&gt;Char.UnicodeChar = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a39">CharToWchar</a>(
01012                 Codepage, OutputBuffer-&gt;Char.AsciiChar);
01013 <span class="preprocessor">#endif</span>
01014 <span class="preprocessor"></span>    }
01015     <span class="keywordflow">return</span> STATUS_SUCCESS;
01016 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="directio.c::SrvCreateConsoleScreenBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvCreateConsoleScreenBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">1607</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01390">AllocateIoHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00161">_SCREEN_INFORMATION::Attributes</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00132">CON_FACENAME</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00130">CON_FAMILY</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00135">CON_FONTCODEPAGE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00133">CON_FONTSIZE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00134">CON_FONTWEIGHT</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00149">CONSOLE_GRAPHICS_BUFFER</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00298">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00299">CONSOLE_INHERITABLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d8/d7/share_8c-source.html#l00025">ConsoleAddShare()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00203">_CONSOLE_CREATESCREENBUFFER_MSG::ConsoleHandle</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00250">CURSOR_SMALL_SIZE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">DBGOUTPUT</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00204">_CONSOLE_CREATESCREENBUFFER_MSG::DesiredAccess</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00207">_CONSOLE_CREATESCREENBUFFER_MSG::Flags</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01455">FreeIoHandle()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01021">FreeScreenBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00208">_CONSOLE_CREATESCREENBUFFER_MSG::GraphicsBufferInfo</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00211">_CONSOLE_CREATESCREENBUFFER_MSG::Handle</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00209">_CONSOLE_CREATESCREENBUFFER_MSG::hMutex</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00339">INDEX_TO_HANDLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00205">_CONSOLE_CREATESCREENBUFFER_MSG::InheritHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01307">InitializeOutputHandle()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01155">InsertScreenBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00210">_CONSOLE_CREATESCREENBUFFER_MSG::lpBitmap</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00157">_SCREEN_INFORMATION::ShareAccess</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00206">_CONSOLE_CREATESCREENBUFFER_MSG::ShareMode</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01614                    :
01615 
01616     This routine creates a screen buffer and returns a handle to <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
01617 
01618 Arguments:
01619 
01620     ApiMessageData - Points to parameter structure.
01621 
01622 Return Value:
01623 
01624 --*/
01625 
01626 {
01627     <a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html">PCONSOLE_CREATESCREENBUFFER_MSG</a> a = (<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html">PCONSOLE_CREATESCREENBUFFER_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01628     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01629     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01630     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
01631     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01632     <a class="code" href="../../d8/d6/struct__CONSOLE__SHARE__ACCESS.html">PCONSOLE_SHARE_ACCESS</a> ShareAccess;
01633     CHAR_INFO Fill;
01634     COORD WindowSize;
01635     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
01636     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData;
01637     ULONG HandleType;
01638     <span class="keywordtype">int</span> FontIndex;
01639 
01640     <a class="code" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>((<span class="stringliteral">"SrvCreateConsoleScreenBuffer\n"</span>));
01641     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o0">ConsoleHandle</a>,
01642                          &amp;Console
01643                         );
01644     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01645         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01646     }
01647 
01648     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o4">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>) {
01649         <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o5">GraphicsBufferInfo</a>.lpBitMapInfo, a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o5">GraphicsBufferInfo</a>.dwBitMapInfoLength, <span class="keyword">sizeof</span>(BYTE))) {
01650             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01651             <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01652         }
01653     }
01654 
01655     <span class="keywordflow">try</span> {
01656         <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = (HANDLE) -1;
01657         ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
01658         HandleType = (a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o4">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>) ?
01659                       <a class="code" href="../../d1/d7/server_8h.html#a48">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a> : <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>;
01660         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o2">InheritHandle</a>)
01661             HandleType |= <a class="code" href="../../d1/d7/server_8h.html#a49">CONSOLE_INHERITABLE</a>;
01662         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a28">AllocateIoHandle</a>(ProcessData,
01663                                   HandleType,
01664                                   &amp;Handle
01665                                  );
01666         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01667             leave;
01668         }
01669         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(ProcessData,
01670                                      Handle,
01671                                      &amp;HandleData
01672                                     );
01673         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01674         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01675             leave;
01676         }
01677 
01678         <span class="comment">//</span>
01679         <span class="comment">// create new screen buffer</span>
01680         <span class="comment">//</span>
01681 
01682         Fill.Char.UnicodeChar = (WCHAR)<span class="charliteral">' '</span>;
01683         Fill.Attributes = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a>;
01684         WindowSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>);
01685         WindowSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>);
01686         FontIndex = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a25">FindCreateFont</a>(<a class="code" href="../../d8/d5/consrv_8h.html#a26">CON_FAMILY</a>(Console),
01687                                    <a class="code" href="../../d8/d5/consrv_8h.html#a28">CON_FACENAME</a>(Console),
01688                                    <a class="code" href="../../d8/d5/consrv_8h.html#a29">CON_FONTSIZE</a>(Console),
01689                                    <a class="code" href="../../d8/d5/consrv_8h.html#a30">CON_FONTWEIGHT</a>(Console),
01690                                    <a class="code" href="../../d8/d5/consrv_8h.html#a31">CON_FONTCODEPAGE</a>(Console)
01691                                   );
01692         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a42">CreateScreenBuffer</a>(&amp;ScreenInfo,WindowSize,
01693                                     FontIndex,
01694                                     WindowSize,
01695                                     Fill,Fill,Console,
01696                                     a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o4">Flags</a>,&amp;a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o5">GraphicsBufferInfo</a>,
01697                                     &amp;a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o7">lpBitmap</a>,&amp;a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o6">hMutex</a>,
01698                                     CURSOR_SMALL_SIZE, 
01699                                     NULL);
01700         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01701             leave;
01702         }
01703         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a26">InitializeOutputHandle</a>(HandleData,ScreenInfo);
01704         ShareAccess = &amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o4">ShareAccess</a>;
01705 
01706         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/share_8c.html#a0">ConsoleAddShare</a>(a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o1">DesiredAccess</a>,
01707                                  a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o3">ShareMode</a>,
01708                                  ShareAccess,
01709                                  HandleData
01710                                 );
01711         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01712             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;RefCount--;
01713             <a class="code" href="../../d6/d2/output_8c.html#a46">FreeScreenBuffer</a>(ScreenInfo);
01714             leave;
01715         }
01716         <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a22">InsertScreenBuffer</a>(Console, ScreenInfo);
01717         a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o8">Handle</a> = <a class="code" href="../../d1/d7/server_8h.html#a57">INDEX_TO_HANDLE</a>(Handle);
01718     } finally {
01719         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) &amp;&amp; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> != (HANDLE)-1) {
01720             <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a29">FreeIoHandle</a>(ProcessData,
01721                          Handle
01722                         );
01723         }
01724         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01725     }
01726     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01727     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01728 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="directio.c::SrvFillConsoleOutput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvFillConsoleOutput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01568">1568</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00295">_CONSOLE_FILLCONSOLEOUTPUT_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00299">_CONSOLE_FILLCONSOLEOUTPUT_MSG::Element</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00298">_CONSOLE_FILLCONSOLEOUTPUT_MSG::ElementType</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00075">FillOutput</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00300">_CONSOLE_FILLCONSOLEOUTPUT_MSG::Length</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00296">_CONSOLE_FILLCONSOLEOUTPUT_MSG::OutputHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00297">_CONSOLE_FILLCONSOLEOUTPUT_MSG::WriteCoord</a>.
<p>
<pre class="fragment"><div>01572 {
01573     <a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html">PCONSOLE_FILLCONSOLEOUTPUT_MSG</a> a = (<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html">PCONSOLE_FILLCONSOLEOUTPUT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01574     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01575     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01576     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01577 
01578     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o0">ConsoleHandle</a>,
01579                          &amp;Console
01580                         );
01581     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01582         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01583     }
01584     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01585                                  a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o1">OutputHandle</a>,
01586                                  CONSOLE_OUTPUT_HANDLE,
01587                                  GENERIC_WRITE,
01588                                  &amp;HandleData
01589                                 );
01590     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01591         a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o5">Length</a> = 0;
01592     } <span class="keywordflow">else</span> {
01593         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
01594                           a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o4">Element</a>,
01595                           a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o2">WriteCoord</a>,
01596                           a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o3">ElementType</a>,
01597                           &amp;a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o5">Length</a>
01598                          );
01599     }
01600     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01601     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01602     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01603 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="directio.c::SrvGetConsoleInput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleInput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l00556">556</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00229">_CONSOLE_GETCONSOLEINPUT_MSG::BufPtr</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00023">_DIRECT_READ_DATA::Console</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00226">_CONSOLE_GETCONSOLEINPUT_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d3/d8/directio_8h.html#a0">DIRECT_READ_DATA</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00267">DirectReadWaitRoutine()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00231">_CONSOLE_GETCONSOLEINPUT_MSG::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00340">HANDLE_TO_INDEX</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00025">_DIRECT_READ_DATA::HandleIndex</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00223">INPUT_RECORD_BUFFER_SIZE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00227">_CONSOLE_GETCONSOLEINPUT_MSG::InputHandle</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00022">_DIRECT_READ_DATA::InputInfo</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00230">_CONSOLE_GETCONSOLEINPUT_MSG::NumRecords</a>, <a class="el" href="../../d4/d7/directio_8h-source.html#l00024">_DIRECT_READ_DATA::ProcessData</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l00959">ReadInputBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00228">_CONSOLE_GETCONSOLEINPUT_MSG::Record</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a22">TranslateInputToOem()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00232">_CONSOLE_GETCONSOLEINPUT_MSG::Unicode</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00563                    :
00564 
00565     This routine reads or peeks input events.  In both cases, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> events
00566     are copied to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user's buffer.  In <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> read <span class="keywordflow">case</span> they are removed
00567     from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer and in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> peek <span class="keywordflow">case</span> they are not.
00568 
00569 Arguments:
00570 
00571     m - message containing api parameters
00572 
00573     ReplyStatus - Indicates whether to reply to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dll port.
00574 
00575 Return Value:
00576 
00577 --*/
00578 
00579 {
00580     <a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html">PCONSOLE_GETCONSOLEINPUT_MSG</a> a = (<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html">PCONSOLE_GETCONSOLEINPUT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00581     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00582     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00583     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00584     PINPUT_RECORD <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00585     <a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html">DIRECT_READ_DATA</a> DirectReadData;
00586 <span class="preprocessor">#ifdef FE_SB</span>
00587 <span class="preprocessor"></span>    BOOLEAN fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00588     PDWORD  nLength;
00589 <span class="preprocessor">#endif</span>
00590 <span class="preprocessor"></span>
00591     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; ~CONSOLE_READ_VALID) {
00592         <span class="keywordflow">return</span> (ULONG)STATUS_INVALID_PARAMETER;
00593     }
00594 
00595     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o0">ConsoleHandle</a>,
00596                          &amp;Console
00597                         );
00598     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00599         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00600     }
00601     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00602                                  a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o1">InputHandle</a>,
00603                                  CONSOLE_INPUT_HANDLE,
00604                                  GENERIC_READ,
00605                                  &amp;HandleData
00606                                 );
00607     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00608         a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a> = 0;
00609     } <span class="keywordflow">else</span> {
00610 
00611         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a> &lt;= <a class="code" href="../../d5/d5/conmsg_8h.html#a7">INPUT_RECORD_BUFFER_SIZE</a>) {
00612             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o2">Record</a>;
00613         } <span class="keywordflow">else</span> {
00614             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o3">BufPtr</a>;
00615             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o3">BufPtr</a>, a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>, <span class="keyword">sizeof</span>(*Buffer))) {
00616                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00617                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00618             }
00619         }
00620 
00621         <span class="comment">//</span>
00622         <span class="comment">// if we're reading, wait for data.  if we're peeking, don't.</span>
00623         <span class="comment">//</span>
00624 
00625         DirectReadData.<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o0">InputInfo</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer;
00626         DirectReadData.<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o1">Console</a> = Console;
00627         DirectReadData.<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o2">ProcessData</a> = <a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>();
00628         DirectReadData.<a class="code" href="../../d8/d5/struct__DIRECT__READ__DATA.html#o3">HandleIndex</a> = <a class="code" href="../../d1/d7/server_8h.html#a58">HANDLE_TO_INDEX</a>(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o1">InputHandle</a>);
00629 <span class="preprocessor">#if defined(FE_SB)</span>
00630 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_CP(Console) ) {
00631             Console-&gt;ReadConInpNumBytesUnicode = a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>;
00632             <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>) {
00633                 <span class="comment">/*</span>
00634 <span class="comment">                 * ASCII : a-&gt;NumRecords is ASCII byte count</span>
00635 <span class="comment">                 */</span>
00636                 <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte.Event.KeyEvent.uChar.AsciiChar) {
00637                     <span class="comment">/*</span>
00638 <span class="comment">                     * Saved DBCS Traling byte</span>
00639 <span class="comment">                     */</span>
00640                     *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte;
00641                     <span class="keywordflow">if</span> (!(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE))
00642                         RtlZeroMemory(&amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte,<span class="keyword">sizeof</span>(INPUT_RECORD));
00643 
00644                     <span class="keywordflow">if</span> (Console-&gt;ReadConInpNumBytesUnicode == 1) {
00645                         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00646                         <span class="keywordflow">return</span> STATUS_SUCCESS;
00647                     }
00648                     <span class="keywordflow">else</span> {
00649                         Console-&gt;ReadConInpNumBytesUnicode--;
00650                         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++;
00651                         fAddDbcsLead = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00652                         nLength = &amp;Console-&gt;ReadConInpNumBytesUnicode;
00653                     }
00654                 }
00655                 <span class="keywordflow">else</span> {
00656                     nLength = &amp;Console-&gt;ReadConInpNumBytesUnicode;
00657                 }
00658             }
00659             <span class="keywordflow">else</span> {
00660                 nLength = &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>;
00661             }
00662         }
00663         <span class="keywordflow">else</span> {
00664             nLength = &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>;
00665         }
00666         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a25">ReadInputBuffer</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
00667                                  Buffer,
00668                                  nLength,
00669                                  !!(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE),
00670                                  !(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOWAIT),
00671                                  FALSE,
00672                                  Console,
00673                                  HandleData,
00674                                  m,
00675                                  DirectReadWaitRoutine,
00676                                  &amp;DirectReadData,
00677                                  <span class="keyword">sizeof</span>(DirectReadData),
00678                                  FALSE,
00679                                  a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>
00680                                 );
00681         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
00682             *ReplyStatus = CsrReplyPending;
00683         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>) {
00684             a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a22">TranslateInputToOem</a>(Console,
00685                                                 Buffer,
00686                                                 fAddDbcsLead ?
00687                                                     a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>-1 :
00688                                                     a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>,
00689                                                 Console-&gt;ReadConInpNumBytesUnicode,
00690                                                 a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE ?
00691                                                     NULL :
00692                                                     &amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;ReadConInpDbcsLeadByte
00693                                                );
00694             <span class="keywordflow">if</span> (fAddDbcsLead)
00695             {
00696                 a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>++;
00697                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>--;
00698             }
00699         }
00700 <span class="preprocessor">#else</span>
00701 <span class="preprocessor"></span>        <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a25">ReadInputBuffer</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
00702                                  Buffer,
00703                                  &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>,
00704                                  !!(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOREMOVE),
00705                                  !(a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> &amp; CONSOLE_READ_NOWAIT),
00706                                  FALSE,
00707                                  Console,
00708                                  HandleData,
00709                                  m,
00710                                  DirectReadWaitRoutine,
00711                                  &amp;DirectReadData,
00712                                  <span class="keyword">sizeof</span>(DirectReadData),
00713                                  FALSE
00714                                 );
00715         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
00716             *ReplyStatus = CsrReplyPending;
00717         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a>) {
00718             <a class="code" href="../../d6/d8/dispatch_8h.html#a22">TranslateInputToOem</a>(Console,
00719                                  Buffer,
00720                                  a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a>
00721                                 );
00722         }
00723 <span class="preprocessor">#endif</span>
00724 <span class="preprocessor"></span>    }
00725     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00726     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00727 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="directio.c::SrvReadConsoleOutput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvReadConsoleOutput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01207">1207</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00249">_CONSOLE_READCONSOLEOUTPUT_MSG::BufPtr</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00248">_CONSOLE_READCONSOLEOUTPUT_MSG::Char</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00250">_CONSOLE_READCONSOLEOUTPUT_MSG::CharRegion</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00246">_CONSOLE_READCONSOLEOUTPUT_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">DBGOUTPUT</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00247">_CONSOLE_READCONSOLEOUTPUT_MSG::OutputHandle</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01623">ReadScreenBuffer()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d9/w32_2ntcon_2fullscr_2vga_2misc_8c-source.html#l00086">TranslateOutputToOem()</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a16">TranslateOutputToOemUnicode()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00251">_CONSOLE_READCONSOLEOUTPUT_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>01211 {
01212     <a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html">PCONSOLE_READCONSOLEOUTPUT_MSG</a> a = (<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html">PCONSOLE_READCONSOLEOUTPUT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01213     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01214     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01215     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01216     PCHAR_INFO <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01217 
01218     <a class="code" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>((<span class="stringliteral">"SrvReadConsoleOutput\n"</span>));
01219     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o0">ConsoleHandle</a>,
01220                          &amp;Console
01221                         );
01222     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01223         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01224     }
01225     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01226                                  a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o1">OutputHandle</a>,
01227                                  CONSOLE_OUTPUT_HANDLE,
01228                                  GENERIC_READ,
01229                                  &amp;HandleData
01230                                 );
01231     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01232         <span class="comment">//</span>
01233         <span class="comment">// a region of zero size is indicated by the right and bottom</span>
01234         <span class="comment">// coordinates being less than the left and top.</span>
01235         <span class="comment">//</span>
01236 
01237         a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Left-1);
01238         a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Top-1);
01239     }
01240     <span class="keywordflow">else</span> {
01241         COORD <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
01242 
01243         <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Right - a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Left + 1);
01244         <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Bottom - a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Top + 1);
01245 
01246         <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X == 1) &amp;&amp; (<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y == 1)) {
01247             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = &amp;a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o2">Char</a>;
01248         }
01249         <span class="keywordflow">else</span> {
01250             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o3">BufPtr</a>;
01251             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o3">BufPtr</a>, <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X * <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y, <span class="keyword">sizeof</span>(*Buffer))) {
01252                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01253                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01254             }
01255         }
01256 
01257         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a52">ReadScreenBuffer</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
01258                                   Buffer,
01259                                   &amp;a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01260                                  );
01261         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o5">Unicode</a>) {
01262             <a class="code" href="../../d3/d0/w32_2ntcon_2fullscr_2vga_2misc_8c.html#a1">TranslateOutputToOem</a>(Console,
01263                                   Buffer,
01264                                   BufferSize
01265                                  );
01266         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
01267                 !(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN)) {
01268             <a class="code" href="../../d6/d8/dispatch_8h.html#a16">TranslateOutputToOemUnicode</a>(Console,
01269                                         Buffer,
01270                                         BufferSize
01271 #<span class="keywordflow">if</span> defined(FE_SB)
01272                                         ,
01273                                         TRUE
01274 #endif
01275                                        );
01276         }
01277     }
01278     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01279     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01280     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01281 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="directio.c::SrvReadConsoleOutputString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvReadConsoleOutputString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01448">1448</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00280">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::BufPtr</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00269">CONSOLE_ASCII</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00275">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00281">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::NumRecords</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00276">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::OutputHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00277">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::ReadCoord</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00279">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::String</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00278">_CONSOLE_READCONSOLEOUTPUTSTRING_MSG::StringType</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01452 {
01453     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01454     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01455     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01456     PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01457     <a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html">PCONSOLE_READCONSOLEOUTPUTSTRING_MSG</a> a = (<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html">PCONSOLE_READCONSOLEOUTPUTSTRING_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01458     ULONG nSize;
01459 
01460     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o0">ConsoleHandle</a>,
01461                          &amp;Console
01462                         );
01463     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01464         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01465     }
01466     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01467                                  a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o1">OutputHandle</a>,
01468                                  CONSOLE_OUTPUT_HANDLE,
01469                                  GENERIC_READ,
01470                                  &amp;HandleData
01471                                 );
01472     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01473 
01474         <span class="comment">//</span>
01475         <span class="comment">// a region of zero size is indicated by the right and bottom</span>
01476         <span class="comment">// coordinates being less than the left and top.</span>
01477         <span class="comment">//</span>
01478 
01479         a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a> = 0;
01480     } <span class="keywordflow">else</span> {
01481         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o3">StringType</a> == <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>)
01482             nSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>);
01483         <span class="keywordflow">else</span>
01484             nSize = <span class="keyword">sizeof</span>(WORD);
01485         <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>*nSize) &gt; <span class="keyword">sizeof</span>(a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o4">String</a>)) {
01486             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>;
01487             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>, a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>, nSize)) {
01488                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01489                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01490             }
01491         }
01492         <span class="keywordflow">else</span> {
01493             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o4">String</a>;
01494         }
01495         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a54">ReadOutputString</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
01496                                 Buffer,
01497                                 a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o2">ReadCoord</a>,
01498                                 a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o3">StringType</a>,
01499                                 &amp;a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>
01500                                );
01501     }
01502     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01503     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01504     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01505 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="directio.c::SrvWriteConsoleInput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvWriteConsoleInput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l00730">730</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00242">_CONSOLE_WRITECONSOLEINPUT_MSG::Append</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00239">_CONSOLE_WRITECONSOLEINPUT_MSG::BufPtr</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00026">CONSOLE_INPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00236">_CONSOLE_WRITECONSOLEINPUT_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00223">INPUT_RECORD_BUFFER_SIZE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00237">_CONSOLE_WRITECONSOLEINPUT_MSG::InputHandle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00240">_CONSOLE_WRITECONSOLEINPUT_MSG::NumRecords</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01410">PrependInputBuffer()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00238">_CONSOLE_WRITECONSOLEINPUT_MSG::Record</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a19">TranslateInputToUnicode()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00241">_CONSOLE_WRITECONSOLEINPUT_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01522">WriteInputBuffer()</a>.
<p>
<pre class="fragment"><div>00734 {
00735     <a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html">PCONSOLE_WRITECONSOLEINPUT_MSG</a> a = (<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html">PCONSOLE_WRITECONSOLEINPUT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00736     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00737     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00738     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00739     PINPUT_RECORD <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00740 
00741     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o0">ConsoleHandle</a>,
00742                          &amp;Console
00743                         );
00744     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00745         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00746     }
00747     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00748                                  a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o1">InputHandle</a>,
00749                                  CONSOLE_INPUT_HANDLE,
00750                                  GENERIC_WRITE,
00751                                  &amp;HandleData
00752                                 );
00753     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00754         a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> = 0;
00755     } <span class="keywordflow">else</span> {
00756         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> &lt;= <a class="code" href="../../d5/d5/conmsg_8h.html#a7">INPUT_RECORD_BUFFER_SIZE</a>) {
00757             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o2">Record</a>;
00758         } <span class="keywordflow">else</span> {
00759             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o3">BufPtr</a>;
00760             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o3">BufPtr</a>, a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a>, <span class="keyword">sizeof</span>(*Buffer))) {
00761                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00762                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00763             }
00764         }
00765         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o5">Unicode</a>) {
00766 <span class="preprocessor">#if defined(FE_SB)</span>
00767 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a19">TranslateInputToUnicode</a>(Console,
00768                                     Buffer,
00769                                     a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a>,
00770                                     &amp;HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;WriteConInpDbcsLeadByte[0]
00771                                    );
00772 <span class="preprocessor">#else</span>
00773 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a19">TranslateInputToUnicode</a>(Console,
00774                                     Buffer,
00775                                     a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a>
00776                                    );
00777 <span class="preprocessor">#endif</span>
00778 <span class="preprocessor"></span>        }
00779         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o6">Append</a>) {
00780             a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a30">WriteInputBuffer</a>(Console,
00781                                              HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
00782                                              Buffer,
00783                                              a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a>
00784                                             );
00785         } <span class="keywordflow">else</span> {
00786             a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a29">PrependInputBuffer</a>(Console,
00787                                              HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
00788                                              Buffer,
00789                                              a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a>
00790                                             );
00791 
00792         }
00793     }
00794     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00795     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00796     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00797 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="directio.c::SrvWriteConsoleOutput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvWriteConsoleOutput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01284">1284</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">_SCREEN_INFORMATION::BufferInfo</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00258">_CONSOLE_WRITECONSOLEOUTPUT_MSG::BufPtr</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00257">_CONSOLE_WRITECONSOLEOUTPUT_MSG::Char</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00259">_CONSOLE_WRITECONSOLEOUTPUT_MSG::CharRegion</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00380">CONSOLE_CLIENTPROCESSHANDLE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00255">_CONSOLE_WRITECONSOLEOUTPUT_MSG::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00041">DBGOUTPUT</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01174">FE_TranslateOutputToAnsiUnicode()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00154">_SCREEN_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00188">_CONSOLE_INFORMATION::FullScreenFlags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00132">_CONSOLE_INFORMATION::InputBuffer</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00030">_INPUT_INFORMATION::InputMode</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00102">NtReadVirtualMemory()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00256">_CONSOLE_WRITECONSOLEOUTPUT_MSG::OutputHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00261">_CONSOLE_WRITECONSOLEOUTPUT_MSG::ReadVM</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01093">SB_TranslateOutputToAnsiUnicode()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00212">TEXT_VALID_HINT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a13">TranslateOutputToAnsiUnicode()</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00146">TranslateOutputToUnicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00260">_CONSOLE_WRITECONSOLEOUTPUT_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01706">WriteScreenBuffer()</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
<pre class="fragment"><div>01288 {
01289     <a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html">PCONSOLE_WRITECONSOLEOUTPUT_MSG</a> a = (<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html">PCONSOLE_WRITECONSOLEOUTPUT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01290     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenBufferInformation;
01291     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01292     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01293     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01294     PCHAR_INFO <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01295 <span class="preprocessor">#if defined(FE_SB)</span>
01296 <span class="preprocessor"></span>    PCHAR_INFO TransBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01297 <span class="preprocessor">#endif</span>
01298 <span class="preprocessor"></span>
01299     <a class="code" href="../../d8/d5/consrv_8h.html#a3">DBGOUTPUT</a>((<span class="stringliteral">"SrvWriteConsoleOutput\n"</span>));
01300     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o0">ConsoleHandle</a>,
01301                          &amp;Console
01302                         );
01303     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01304         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01305     }
01306     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01307                                  a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o1">OutputHandle</a>,
01308                                  CONSOLE_OUTPUT_HANDLE,
01309                                  GENERIC_WRITE,
01310                                  &amp;HandleData
01311                                 );
01312     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01313 
01314         <span class="comment">//</span>
01315         <span class="comment">// a region of zero size is indicated by the right and bottom</span>
01316         <span class="comment">// coordinates being less than the left and top.</span>
01317         <span class="comment">//</span>
01318 
01319         a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Left-1);
01320         a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Top-1);
01321     } <span class="keywordflow">else</span> {
01322 
01323         COORD <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;
01324         ULONG NumBytes;
01325 
01326         <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Right - a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Left + 1);
01327         <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Bottom - a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Top + 1);
01328         NumBytes = <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X * <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y * <span class="keyword">sizeof</span>(*Buffer);
01329 
01330         <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X == 1) &amp;&amp; (<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y == 1)) {
01331             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o2">Char</a>;
01332         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o6">ReadVM</a>) {
01333             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = <a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),NumBytes);
01334             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01335                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01336                 <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
01337             }
01338             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d5/readwrt_8c.html#a9">NtReadVirtualMemory</a>(<a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
01339                                          a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a>,
01340                                          Buffer,
01341                                          NumBytes,
01342                                          NULL
01343                                         );
01344             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01345                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Buffer);
01346                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01347                 <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
01348             }
01349         } <span class="keywordflow">else</span> {
01350             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a>;
01351             <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a>, NumBytes, <span class="keyword">sizeof</span>(BYTE))) {
01352                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01353                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01354             }
01355         }
01356         ScreenBufferInformation = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
01357 
01358         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o5">Unicode</a>) {
01359             <a class="code" href="../../d6/d8/dispatch_8h.html#a11">TranslateOutputToUnicode</a>(Console,
01360                                      Buffer,
01361                                      BufferSize
01362                                     );
01363 <span class="preprocessor">#if defined(FE_SB)</span>
01364 <span class="preprocessor"></span>            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a53">WriteScreenBuffer</a>(ScreenBufferInformation,
01365                                        Buffer,
01366                                        &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01367                                       );
01368 <span class="preprocessor">#endif</span>
01369 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
01370                 ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) == 0)) {
01371 <span class="preprocessor">#if defined(FE_SB)</span>
01372 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console)) {
01373                 TransBuffer = (PCHAR_INFO)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_DBCS_TAG ),(<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.Y * <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>.X) * 2 * <span class="keyword">sizeof</span>(CHAR_INFO));
01374                 <span class="keywordflow">if</span> (TransBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01375                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01376                     <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
01377                 }
01378                 <a class="code" href="../../d6/d8/dispatch_8h.html#a14">FE_TranslateOutputToAnsiUnicode</a>(Console,
01379                                             Buffer,
01380                                             BufferSize,
01381                                             &amp;TransBuffer[0]
01382                                            );
01383                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a53">WriteScreenBuffer</a>(ScreenBufferInformation,
01384                                             &amp;TransBuffer[0],
01385                                             &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01386                                            );
01387                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBuffer);
01388             }
01389             <span class="keywordflow">else</span> {
01390                 <a class="code" href="../../d6/d8/dispatch_8h.html#a15">SB_TranslateOutputToAnsiUnicode</a>(Console,
01391                                                 Buffer,
01392                                                 BufferSize
01393                                                );
01394                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a53">WriteScreenBuffer</a>(ScreenBufferInformation,
01395                                             Buffer,
01396                                             &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01397                                            );
01398             }
01399 <span class="preprocessor">#else</span>
01400 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a13">TranslateOutputToAnsiUnicode</a>(Console,
01401                                         Buffer,
01402                                         BufferSize
01403                                        );
01404 <span class="preprocessor">#endif</span>
01405 <span class="preprocessor"></span>        }
01406 <span class="preprocessor">#if defined(FE_SB)</span>
01407 <span class="preprocessor"></span>        <span class="keywordflow">else</span>
01408 <span class="preprocessor">#endif</span>
01409 <span class="preprocessor"></span>        <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a53">WriteScreenBuffer</a>(ScreenBufferInformation,
01410                                     Buffer,
01411                                     &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01412                                    );
01413 
01414         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o6">ReadVM</a>) {
01415             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Buffer);
01416         }
01417         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01418 
01419             <span class="comment">//</span>
01420             <span class="comment">// cause screen to be updated</span>
01421             <span class="comment">//</span>
01422 
01423 <span class="preprocessor">#if defined(FE_SB)</span>
01424 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(Console) &amp;&amp;
01425                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; CONSOLE_JUST_VDM_UNREGISTERED ){
01426                 <span class="keywordtype">int</span> MouseRec;
01427                 MouseRec = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o4">InputMode</a>;
01428                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o4">InputMode</a> &amp;= ~ENABLE_MOUSE_INPUT;
01429                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
01430                 <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenBufferInformation,&amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a> );
01431                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.Flags |= <a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
01432                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.<a class="code" href="../../d7/d2/struct__INPUT__INFORMATION.html#o4">InputMode</a> = MouseRec;
01433             }
01434             <span class="keywordflow">else</span>
01435 <span class="preprocessor">#endif</span>
01436 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenBufferInformation,
01437                           &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>
01438                          );
01439         }
01440     }
01441     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01442     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01443     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01444 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="directio.c::SrvWriteConsoleOutputString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvWriteConsoleOutputString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01508">1508</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d4/d3/struct__HANDLE__DATA.html#o5">_HANDLE_DATA::Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00290">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::BufPtr</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00269">CONSOLE_ASCII</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00027">CONSOLE_OUTPUT_HANDLE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00395">CONSOLE_PERPROCESSDATA</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00285">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::ConsoleHandle</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01536">DereferenceIoHandle()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00291">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::NumRecords</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00286">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::OutputHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00289">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::String</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00288">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::StringType</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00287">_CONSOLE_WRITECONSOLEOUTPUTSTRING_MSG::WriteCoord</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00039">WriteOutputString</a>.
<p>
<pre class="fragment"><div>01512 {
01513     <a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html">PCONSOLE_WRITECONSOLEOUTPUTSTRING_MSG</a> a = (<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html">PCONSOLE_WRITECONSOLEOUTPUTSTRING_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01514     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01515     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01516     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01517     PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01518     ULONG nSize;
01519 
01520     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o0">ConsoleHandle</a>,
01521                          &amp;Console
01522                         );
01523     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01524         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01525     }
01526     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01527                                  a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o1">OutputHandle</a>,
01528                                  CONSOLE_OUTPUT_HANDLE,
01529                                  GENERIC_WRITE,
01530                                  &amp;HandleData
01531                                 );
01532     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01533         a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a> = 0;
01534     } <span class="keywordflow">else</span> {
01535         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o2">WriteCoord</a>.X &lt; 0 ||
01536             a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o2">WriteCoord</a>.Y &lt; 0) {
01537             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01538         } <span class="keywordflow">else</span> {
01539             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o3">StringType</a> == <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>)
01540                 nSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>);
01541             <span class="keywordflow">else</span>
01542                 nSize = <span class="keyword">sizeof</span>(WORD);
01543             <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>*nSize) &gt; <span class="keyword">sizeof</span>(a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o4">String</a>)) {
01544                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>;
01545                 <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>, a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>, nSize)) {
01546                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01547                     <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01548                 }
01549             }
01550             <span class="keywordflow">else</span> {
01551                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o4">String</a>;
01552             }
01553             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a2">WriteOutputString</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
01554                                      Buffer,
01555                                      a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o2">WriteCoord</a>,
01556                                      a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o3">StringType</a>,
01557                                      &amp;a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a>,
01558                                      NULL
01559                                     );
01560         }
01561     }
01562     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01563     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01564     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01565 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="directio.c::TranslateInputToOem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS TranslateInputToOem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PINPUT_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>InputRecords</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumRecords</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l00045">45</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01489">WcharToChar()</a>.
<p>
<pre class="fragment"><div>00050 {
00051     ULONG i;
00052 
00053     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"TranslateInputToOem\n"</span>));
00054     <span class="keywordflow">for</span> (i=0;i&lt;NumRecords;i++) {
00055         <span class="keywordflow">if</span> (InputRecords[i].EventType == KEY_EVENT) {
00056             InputRecords[i].Event.KeyEvent.uChar.AsciiChar = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a40">WcharToChar</a>(
00057                     Console-&gt;CP, InputRecords[i].Event.KeyEvent.uChar.UnicodeChar);
00058         }
00059     }
00060 <span class="preprocessor">#if defined(FE_SB)</span>
00061 <span class="preprocessor"></span>    <span class="keywordflow">return</span> NumRecords;
00062 <span class="preprocessor">#else</span>
00063 <span class="preprocessor"></span>    <span class="keywordflow">return</span> STATUS_SUCCESS;
00064 <span class="preprocessor">#endif</span>
00065 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="directio.c::TranslateInputToUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS TranslateInputToUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PINPUT_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>InputRecords</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumRecords</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l00165">165</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01469">CharToWchar()</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>.
<p>
<pre class="fragment"><div>00170 {
00171     ULONG i;
00172     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"TranslateInputToUnicode\n"</span>));
00173     <span class="keywordflow">for</span> (i=0;i&lt;NumRecords;i++) {
00174         <span class="keywordflow">if</span> (InputRecords[i].EventType == KEY_EVENT) {
00175 <span class="preprocessor">#if defined(FE_SB)</span>
00176 <span class="preprocessor"></span>            InputRecords[i].Event.KeyEvent.uChar.UnicodeChar = SB_CharToWchar(
00177                     Console-&gt;CP, InputRecords[i].Event.KeyEvent.uChar.AsciiChar);
00178 <span class="preprocessor">#else</span>
00179 <span class="preprocessor"></span>            InputRecords[i].Event.KeyEvent.uChar.UnicodeChar = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a39">CharToWchar</a>(
00180                     Console-&gt;CP, InputRecords[i].Event.KeyEvent.uChar.AsciiChar);
00181 <span class="preprocessor">#endif</span>
00182 <span class="preprocessor"></span>        }
00183     }
00184 <span class="preprocessor">#if defined(FE_SB)</span>
00185 <span class="preprocessor"></span>    <span class="keywordflow">return</span> i;
00186 <span class="preprocessor">#else</span>
00187 <span class="preprocessor"></span>    <span class="keywordflow">return</span> STATUS_SUCCESS;
00188 <span class="preprocessor">#endif</span>
00189 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="directio.c::TranslateOutputToPaddingUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS TranslateOutputToPaddingUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCHAR_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBufferR</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/directio_8c-source.html#l01191">1191</a> of file <a class="el" href="../../d3/d7/directio_8c-source.html">directio.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01115">FE_TranslateOutputToAnsiUnicodeInternal()</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
<pre class="fragment"><div>01197 {
01198     <span class="keywordflow">return</span> <a class="code" href="../../d2/d8/directio_8c.html#a9">FE_TranslateOutputToAnsiUnicodeInternal</a>(Console,
01199                                                    OutputBuffer,
01200                                                    Size,
01201                                                    OutputBufferR,
01202                                                    FALSE
01203                                                    );
01204 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:27 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
