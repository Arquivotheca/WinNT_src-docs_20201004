<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: fileinfo.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>fileinfo.c File Reference</h1><code>#include "UdfProcs.h"</code><br>

<p>
<a href="../../d5/d2/fileinfo_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a0">BugCheckFileId</a>&nbsp;&nbsp;&nbsp;(UDFS_BUG_CHECK_FILEINFO)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a1">Dbg</a>&nbsp;&nbsp;&nbsp;(UDFS_DEBUG_LEVEL_FILEINFO)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>INLINE ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a2">UdfGetExtraFileAttributes</a> (IN <a class="el" href="../../d2/d9/struct__CCB.html">PCCB</a> Ccb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a3">UdfQueryBasicInfo</a> (IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext, IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb, IN <a class="el" href="../../d2/d9/struct__CCB.html">PCCB</a> Ccb, IN OUT PFILE_BASIC_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a4">UdfQueryStandardInfo</a> (IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext, IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb, IN OUT PFILE_STANDARD_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a5">UdfQueryInternalInfo</a> (IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext, IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb, IN OUT PFILE_INTERNAL_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a6">UdfQueryEaInfo</a> (IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext, IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb, IN OUT PFILE_EA_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a7">UdfQueryPositionInfo</a> (IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext, IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject, IN OUT PFILE_POSITION_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a8">UdfQueryNameInfo</a> (IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext, IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject, IN OUT PFILE_NAME_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a9">UdfQueryAlternateNameInfo</a> (IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext, IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb, IN <a class="el" href="../../d2/d9/struct__CCB.html">PCCB</a> Ccb, IN OUT PFILE_NAME_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a10">UdfQueryNetworkInfo</a> (IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext, IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb, IN <a class="el" href="../../d2/d9/struct__CCB.html">PCCB</a> Ccb, IN OUT PFILE_NETWORK_OPEN_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a11">UdfCommonQueryInfo</a> (IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext, IN <a class="el" href="../../d0/d2/struct__IRP.html">PIRP</a> <a class="el" href="../../d0/d6/iop_8h.html#a35">Irp</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a12">UdfCommonSetInfo</a> (IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext, IN <a class="el" href="../../d0/d2/struct__IRP.html">PIRP</a> <a class="el" href="../../d0/d6/iop_8h.html#a35">Irp</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a13">UdfFastQueryBasicInfo</a> (IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject, IN BOOLEAN Wait, IN OUT PFILE_BASIC_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, OUT PIO_STATUS_BLOCK IoStatus, IN <a class="el" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a14">UdfFastQueryStdInfo</a> (IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject, IN BOOLEAN Wait, IN OUT PFILE_STANDARD_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, OUT PIO_STATUS_BLOCK IoStatus, IN <a class="el" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/fileinfo_8c.html#a15">UdfFastQueryNetworkInfo</a> (IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject, IN BOOLEAN Wait, OUT PFILE_NETWORK_OPEN_INFORMATION <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, OUT PIO_STATUS_BLOCK IoStatus, IN <a class="el" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="fileinfo.c::BugCheckFileId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BugCheckFileId&nbsp;&nbsp;&nbsp;(UDFS_BUG_CHECK_FILEINFO)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00028">28</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="fileinfo.c::Dbg" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define Dbg&nbsp;&nbsp;&nbsp;(UDFS_DEBUG_LEVEL_FILEINFO)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00034">34</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="fileinfo.c::UdfCommonQueryInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS UdfCommonQueryInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IrpContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d2/struct__IRP.html">PIRP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Irp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00156">156</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d2/struct__IRP.html#o7">_IRP::AssociatedIrp</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l01130">CCB_FLAG_OPEN_BY_ID</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l01061">FCB_STATE_INITIALIZED</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00986">_FCB::FcbState</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l02494">_IO_STACK_LOCATION::FileObject</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l01091">_CCB::Flags</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l03252">IoGetCurrentIrpStackLocation</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01635">_IRP::IoStatus</a>, <a class="el" href="../../d1/d5/iop_8h-source.html#l00130">Irp</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l02069">_IO_STACK_LOCATION::Parameters</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01533">UdfAcquireFileShared</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00809">UdfCompleteRequest()</a>, <a class="el" href="../../d7/d2/filobsup_8c-source.html#l00133">UdfDecodeFileObject()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01232">UdfQueryAlternateNameInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00875">UdfQueryBasicInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01057">UdfQueryEaInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01009">UdfQueryInternalInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01158">UdfQueryNameInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01429">UdfQueryNetworkInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01105">UdfQueryPositionInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00936">UdfQueryStandardInfo()</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01539">UdfReleaseFile</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00760">UdfVerifyFcbOperation()</a>, <a class="el" href="../../d3/d8/udfprocs_8h.html#a263a116">UserDirectoryOpen</a>, and <a class="el" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a>.
<p>
Referenced by <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00218">UdfFsdDispatch()</a>, and <a class="el" href="../../d1/d7/fspdisp_8c-source.html#l00038">UdfFspDispatch()</a>.
<p>
<pre class="fragment"><div>00163                    :
00164 
00165     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> common routine <span class="keywordflow">for</span> query <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> information called by both <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00166     fsd and fsp threads.
00167 
00168 Arguments:
00169 
00170     <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a> to process.
00171 
00172 Return Value:
00173 
00174     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - The <span class="keywordflow">return</span> status <span class="keywordflow">for</span> <span class="keyword">this</span> operation.
00175 
00176 --*/
00177 
00178 {
00179     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00180     <a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html">PIO_STACK_LOCATION</a> IrpSp = <a class="code" href="../../d0/d5/io_8h.html#a228">IoGetCurrentIrpStackLocation</a>( Irp );
00181 
00182     ULONG Length;
00183     FILE_INFORMATION_CLASS FileInformationClass;
00184     PFILE_ALL_INFORMATION <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00185 
00186     <a class="code" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a> TypeOfOpen;
00187     <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb;
00188     <a class="code" href="../../d2/d9/struct__CCB.html">PCCB</a> Ccb;
00189 
00190     BOOLEAN ReleaseFcb = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00191 
00192     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00193 
00194     <span class="comment">//</span>
00195     <span class="comment">//  Reference our input parameters to make things easier</span>
00196     <span class="comment">//</span>
00197 
00198     Length = IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o11">Parameters</a>.QueryFile.Length;
00199     FileInformationClass = IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o11">Parameters</a>.QueryFile.FileInformationClass;
00200     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a>-&gt;<a class="code" href="../../d0/d2/struct__IRP.html#o7">AssociatedIrp</a>.SystemBuffer;
00201 
00202     <span class="comment">//</span>
00203     <span class="comment">//  Decode the file object</span>
00204     <span class="comment">//</span>
00205 
00206     TypeOfOpen = <a class="code" href="../../d3/d8/udfprocs_8h.html#a174">UdfDecodeFileObject</a>( IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o28">FileObject</a>, &amp;Fcb, &amp;Ccb );
00207 
00208     <span class="comment">//</span>
00209     <span class="comment">//  Use a try-finally to facilitate cleanup.</span>
00210     <span class="comment">//</span>
00211 
00212     <span class="keywordflow">try</span> {
00213 
00214         <span class="comment">//</span>
00215         <span class="comment">//  We only support query on file and directory handles.</span>
00216         <span class="comment">//</span>
00217 
00218         <span class="keywordflow">switch</span> (TypeOfOpen) {
00219 
00220         <span class="keywordflow">case</span> <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a116">UserDirectoryOpen</a> :
00221         <span class="keywordflow">case</span> <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a> :
00222 
00223             <span class="comment">//</span>
00224             <span class="comment">//  Acquire shared access to this file.</span>
00225             <span class="comment">//</span>
00226 
00227             <a class="code" href="../../d3/d8/udfprocs_8h.html#a80">UdfAcquireFileShared</a>( IrpContext, Fcb );
00228             ReleaseFcb = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00229 
00230             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o10">FcbState</a>, FCB_STATE_INITIALIZED ));
00231             
00232             <span class="comment">//</span>
00233             <span class="comment">//  Make sure the Fcb is in a usable condition.  This will raise</span>
00234             <span class="comment">//  an error condition if the volume is unusable</span>
00235             <span class="comment">//</span>
00236 
00237             <a class="code" href="../../d8/d5/udfs_2verfysup_8c.html#a6">UdfVerifyFcbOperation</a>( IrpContext, Fcb );
00238 
00239             <span class="comment">//</span>
00240             <span class="comment">//  Based on the information class we'll do different</span>
00241             <span class="comment">//  actions.  Each of hte procedures that we're calling fills</span>
00242             <span class="comment">//  up the output buffer, if possible.  They will raise the</span>
00243             <span class="comment">//  status STATUS_BUFFER_OVERFLOW for an insufficient buffer.</span>
00244             <span class="comment">//  This is considered a somewhat unusual case and is handled</span>
00245             <span class="comment">//  more cleanly with the exception mechanism rather than</span>
00246             <span class="comment">//  testing a return status value for each call.</span>
00247             <span class="comment">//</span>
00248 
00249             <span class="keywordflow">switch</span> (FileInformationClass) {
00250 
00251             <span class="keywordflow">case</span> FileAllInformation:
00252 
00253                 <span class="comment">//</span>
00254                 <span class="comment">//  We don't allow this operation on a file opened by file Id.</span>
00255                 <span class="comment">//</span>
00256 
00257                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Ccb-&gt;<a class="code" href="../../d2/d9/struct__CCB.html#o2">Flags</a>, CCB_FLAG_OPEN_BY_ID )) {
00258 
00259                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00260                     <span class="keywordflow">break</span>;
00261                 }
00262 
00263                 <span class="comment">//</span>
00264                 <span class="comment">//  In this case go ahead and call the individual routines to</span>
00265                 <span class="comment">//  fill in the buffer.  Only the name routine will</span>
00266                 <span class="comment">//  pointer to the output buffer and then call the</span>
00267                 <span class="comment">//  individual routines to fill in the buffer.</span>
00268                 <span class="comment">//</span>
00269 
00270                 Length -= (<span class="keyword">sizeof</span>( FILE_ACCESS_INFORMATION ) +
00271                            <span class="keyword">sizeof</span>( FILE_MODE_INFORMATION ) +
00272                            <span class="keyword">sizeof</span>( FILE_ALIGNMENT_INFORMATION ));
00273 
00274                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a3">UdfQueryBasicInfo</a>( IrpContext, Fcb, Ccb, &amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;BasicInformation, &amp;Length );
00275                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a4">UdfQueryStandardInfo</a>( IrpContext, Fcb, &amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;StandardInformation, &amp;Length );
00276                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a5">UdfQueryInternalInfo</a>( IrpContext, Fcb, &amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;InternalInformation, &amp;Length );
00277                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a6">UdfQueryEaInfo</a>( IrpContext, Fcb, &amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;EaInformation, &amp;Length );
00278                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a7">UdfQueryPositionInfo</a>( IrpContext, IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o28">FileObject</a>, &amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;PositionInformation, &amp;Length );
00279                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d3/fileinfo_8c.html#a8">UdfQueryNameInfo</a>( IrpContext, IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o28">FileObject</a>, &amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;NameInformation, &amp;Length );
00280 
00281                 <span class="keywordflow">break</span>;
00282 
00283             <span class="keywordflow">case</span> FileBasicInformation:
00284 
00285                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a3">UdfQueryBasicInfo</a>( IrpContext, Fcb, Ccb, (PFILE_BASIC_INFORMATION) Buffer, &amp;Length );
00286                 <span class="keywordflow">break</span>;
00287 
00288             <span class="keywordflow">case</span> FileStandardInformation:
00289 
00290                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a4">UdfQueryStandardInfo</a>( IrpContext, Fcb, (PFILE_STANDARD_INFORMATION) Buffer, &amp;Length );
00291                 <span class="keywordflow">break</span>;
00292 
00293             <span class="keywordflow">case</span> FileInternalInformation:
00294 
00295                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a5">UdfQueryInternalInfo</a>( IrpContext, Fcb, (PFILE_INTERNAL_INFORMATION) Buffer, &amp;Length );
00296                 <span class="keywordflow">break</span>;
00297 
00298             <span class="keywordflow">case</span> FileEaInformation:
00299 
00300                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a6">UdfQueryEaInfo</a>( IrpContext, Fcb, (PFILE_EA_INFORMATION) Buffer, &amp;Length );
00301                 <span class="keywordflow">break</span>;
00302 
00303             <span class="keywordflow">case</span> FilePositionInformation:
00304 
00305                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a7">UdfQueryPositionInfo</a>( IrpContext, IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o28">FileObject</a>, (PFILE_POSITION_INFORMATION) Buffer, &amp;Length );
00306                 <span class="keywordflow">break</span>;
00307 
00308             <span class="keywordflow">case</span> FileNameInformation:
00309 
00310                 <span class="comment">//</span>
00311                 <span class="comment">//  We don't allow this operation on a file opened by file Id.</span>
00312                 <span class="comment">//</span>
00313 
00314                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Ccb-&gt;<a class="code" href="../../d2/d9/struct__CCB.html#o2">Flags</a>, CCB_FLAG_OPEN_BY_ID )) {
00315 
00316                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d3/fileinfo_8c.html#a8">UdfQueryNameInfo</a>( IrpContext, IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o28">FileObject</a>, (PFILE_NAME_INFORMATION) Buffer, &amp;Length );
00317 
00318                 } <span class="keywordflow">else</span> {
00319 
00320                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00321                 }
00322 
00323                 <span class="keywordflow">break</span>;
00324 
00325             <span class="keywordflow">case</span> FileAlternateNameInformation:
00326 
00327                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Ccb-&gt;<a class="code" href="../../d2/d9/struct__CCB.html#o2">Flags</a>, CCB_FLAG_OPEN_BY_ID )) {
00328 
00329                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d3/fileinfo_8c.html#a9">UdfQueryAlternateNameInfo</a>( IrpContext, Fcb, Ccb, (PFILE_NAME_INFORMATION) Buffer, &amp;Length );
00330 
00331                 } <span class="keywordflow">else</span> {
00332 
00333                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00334                 }
00335 
00336                 <span class="keywordflow">break</span>;
00337 
00338             <span class="keywordflow">case</span> FileNetworkOpenInformation:
00339 
00340                 <a class="code" href="../../d4/d3/fileinfo_8c.html#a10">UdfQueryNetworkInfo</a>( IrpContext, Fcb, Ccb, (PFILE_NETWORK_OPEN_INFORMATION) Buffer, &amp;Length );
00341                 <span class="keywordflow">break</span>;
00342 
00343             <span class="keywordflow">default</span> :
00344 
00345                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00346             }
00347 
00348             <span class="keywordflow">break</span>;
00349 
00350         <span class="keywordflow">default</span> :
00351 
00352             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00353         }
00354 
00355         <span class="comment">//</span>
00356         <span class="comment">//  Set the information field to the number of bytes actually filled in</span>
00357         <span class="comment">//  and then complete the request</span>
00358         <span class="comment">//</span>
00359 
00360         <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a>-&gt;<a class="code" href="../../d0/d2/struct__IRP.html#o9">IoStatus</a>.Information = IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o11">Parameters</a>.QueryFile.Length - Length;
00361 
00362     } finally {
00363 
00364         <span class="comment">//</span>
00365         <span class="comment">//  Release the file.</span>
00366         <span class="comment">//</span>
00367 
00368         <span class="keywordflow">if</span> (ReleaseFcb) {
00369 
00370             <a class="code" href="../../d3/d8/udfprocs_8h.html#a82">UdfReleaseFile</a>( IrpContext, Fcb );
00371         }
00372     }
00373 
00374     <span class="comment">//</span>
00375     <span class="comment">//  Complete the request if we didn't raise.</span>
00376     <span class="comment">//</span>
00377 
00378     <a class="code" href="../../d3/d8/udfprocs_8h.html#a129">UdfCompleteRequest</a>( IrpContext, Irp, Status );
00379 
00380     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00381 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="fileinfo.c::UdfCommonSetInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS UdfCommonSetInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IrpContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d2/struct__IRP.html">PIRP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Irp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00385">385</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d1/d4/io_8h-source.html#l01194">_DEVICE_OBJECT::AlignmentRequirement</a>, <a class="el" href="../../d0/d2/struct__IRP.html#o7">_IRP::AssociatedIrp</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01535">_FILE_OBJECT::CurrentByteOffset</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l02488">_IO_STACK_LOCATION::DeviceObject</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l02494">_IO_STACK_LOCATION::FileObject</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01533">_FILE_OBJECT::Flags</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01493">FO_NO_INTERMEDIATE_BUFFERING</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l03252">IoGetCurrentIrpStackLocation</a>, <a class="el" href="../../d1/d5/iop_8h-source.html#l00130">Irp</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l02069">_IO_STACK_LOCATION::Parameters</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l00436">try_leave</a>, <a class="el" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01533">UdfAcquireFileShared</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00809">UdfCompleteRequest()</a>, <a class="el" href="../../d7/d2/filobsup_8c-source.html#l00133">UdfDecodeFileObject()</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01567">UdfLockFcb</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01539">UdfReleaseFile</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01577">UdfUnlockFcb</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00760">UdfVerifyFcbOperation()</a>, and <a class="el" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a>.
<p>
Referenced by <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00218">UdfFsdDispatch()</a>, and <a class="el" href="../../d1/d7/fspdisp_8c-source.html#l00038">UdfFspDispatch()</a>.
<p>
<pre class="fragment"><div>00392                    :
00393 
00394     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> common routine <span class="keywordflow">for</span> set <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> information called by both <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00395     fsd and fsp threads.  We <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> support operations which set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> position.
00396 
00397 Arguments:
00398 
00399     <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a> to process.
00400 
00401 Return Value:
00402 
00403     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - The <span class="keywordflow">return</span> status <span class="keywordflow">for</span> <span class="keyword">this</span> operation.
00404 
00405 --*/
00406 
00407 {
00408     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00409 
00410     <a class="code" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a> TypeOfOpen;
00411     <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb;
00412     <a class="code" href="../../d2/d9/struct__CCB.html">PCCB</a> Ccb;
00413 
00414     <a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html">PIO_STACK_LOCATION</a> IrpSp = <a class="code" href="../../d0/d5/io_8h.html#a228">IoGetCurrentIrpStackLocation</a>( Irp );
00415 
00416     PFILE_POSITION_INFORMATION <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00417 
00418     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00419 
00420     <span class="comment">//</span>
00421     <span class="comment">//  Decode the file object</span>
00422     <span class="comment">//</span>
00423 
00424     TypeOfOpen = <a class="code" href="../../d3/d8/udfprocs_8h.html#a174">UdfDecodeFileObject</a>( IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o28">FileObject</a>, &amp;Fcb, &amp;Ccb );
00425 
00426     <span class="comment">//</span>
00427     <span class="comment">//  We only support a SetPositionInformation on a user file.</span>
00428     <span class="comment">//</span>
00429 
00430     <span class="keywordflow">if</span> ((TypeOfOpen != <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a>) ||
00431         (IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o11">Parameters</a>.QueryFile.FileInformationClass != FilePositionInformation)) {
00432 
00433         <a class="code" href="../../d3/d8/udfprocs_8h.html#a129">UdfCompleteRequest</a>( IrpContext, Irp, Status );
00434         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00435     }
00436 
00437     <span class="comment">//</span>
00438     <span class="comment">//  Acquire shared access to this file.</span>
00439     <span class="comment">//</span>
00440 
00441     <a class="code" href="../../d3/d8/udfprocs_8h.html#a80">UdfAcquireFileShared</a>( IrpContext, Fcb );
00442 
00443     <span class="keywordflow">try</span> {
00444 
00445         <span class="comment">//</span>
00446         <span class="comment">//  Make sure the Fcb is in a usable condition.  This</span>
00447         <span class="comment">//  will raise an error condition if the fcb is unusable</span>
00448         <span class="comment">//</span>
00449 
00450         <a class="code" href="../../d8/d5/udfs_2verfysup_8c.html#a6">UdfVerifyFcbOperation</a>( IrpContext, Fcb );
00451 
00452         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a>-&gt;<a class="code" href="../../d0/d2/struct__IRP.html#o7">AssociatedIrp</a>.SystemBuffer;
00453 
00454         <span class="comment">//</span>
00455         <span class="comment">//  Check if the file does not use intermediate buffering.  If it</span>
00456         <span class="comment">//  does not use intermediate buffering then the new position we're</span>
00457         <span class="comment">//  supplied must be aligned properly for the device</span>
00458         <span class="comment">//</span>
00459 
00460         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o28">FileObject</a>-&gt;<a class="code" href="../../d9/d1/struct__FILE__OBJECT.html#o18">Flags</a>, FO_NO_INTERMEDIATE_BUFFERING ) &amp;&amp;
00461             ((<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;CurrentByteOffset.LowPart &amp; IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o57">DeviceObject</a>-&gt;<a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html#o17">AlignmentRequirement</a>) != 0)) {
00462 
00463             <a class="code" href="../../d3/d8/udfprocs_8h.html#a64">try_leave</a>( NOTHING );
00464         }
00465 
00466         <span class="comment">//</span>
00467         <span class="comment">//  The input parameter is fine so set the current byte offset and</span>
00468         <span class="comment">//  complete the request</span>
00469         <span class="comment">//</span>
00470 
00471         <span class="comment">//</span>
00472         <span class="comment">//  Lock the Fcb to provide synchronization.</span>
00473         <span class="comment">//</span>
00474 
00475         <a class="code" href="../../d3/d8/udfprocs_8h.html#a90">UdfLockFcb</a>( IrpContext, Fcb );
00476         IrpSp-&gt;<a class="code" href="../../d2/d5/struct__IO__STACK__LOCATION.html#o28">FileObject</a>-&gt;<a class="code" href="../../d9/d1/struct__FILE__OBJECT.html#o20">CurrentByteOffset</a> = <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;CurrentByteOffset;
00477         <a class="code" href="../../d3/d8/udfprocs_8h.html#a91">UdfUnlockFcb</a>( IrpContext, Fcb );
00478 
00479         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00480 
00481     } finally {
00482 
00483         <a class="code" href="../../d3/d8/udfprocs_8h.html#a82">UdfReleaseFile</a>( IrpContext, Fcb );
00484     }
00485 
00486     <span class="comment">//</span>
00487     <span class="comment">//  Complete the request if there was no raise.</span>
00488     <span class="comment">//</span>
00489 
00490     <a class="code" href="../../d3/d8/udfprocs_8h.html#a129">UdfCompleteRequest</a>( IrpContext, Irp, Status );
00491     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00492 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="fileinfo.c::UdfFastQueryBasicInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN UdfFastQueryBasicInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FileObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PFILE_BASIC_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PIO_STATUS_BLOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>IoStatus</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceObject</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00496">496</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00184">_TIMESTAMP_BUNDLE::AccessTime</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d7/udfdata_8h-source.html#l00358">ASSERT_FILE_OBJECT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00183">_TIMESTAMP_BUNDLE::CreationTime</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02474">ExAcquireResourceShared</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02393">ExReleaseResource</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l01061">FCB_STATE_INITIALIZED</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00986">_FCB::FcbState</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00992">_FCB::FileAttributes</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l01772">FsRtlEnterFileSystem</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l01795">FsRtlExitFileSystem</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00185">_TIMESTAMP_BUNDLE::ModificationTime</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l01044">_FCB::Timestamps</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a>, <a class="el" href="../../d7/d2/filobsup_8c-source.html#l00133">UdfDecodeFileObject()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00042">UdfGetExtraFileAttributes()</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00760">UdfVerifyFcbOperation()</a>, <a class="el" href="../../d3/d8/udfprocs_8h.html#a263a116">UserDirectoryOpen</a>, and <a class="el" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a>.
<p>
<pre class="fragment"><div>00506                    :
00507 
00508     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> fast query call <span class="keywordflow">for</span> basic <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> information.
00509 
00510 Arguments:
00511 
00512     FileObject - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> object used in <span class="keyword">this</span> operation
00513 
00514     Wait - Indicates <span class="keywordflow">if</span> we are allowed to wait <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information
00515 
00516     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output buffer to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> basic information
00517 
00518     IoStatus - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">final</span> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation
00519 
00520 Return Value:
00521 
00522     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation succeeded and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller
00523         needs to take <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordtype">long</span> route.
00524 
00525 --*/
00526 
00527 {
00528     BOOLEAN Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00529     <a class="code" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a> TypeOfOpen;
00530 
00531     <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb;
00532     <a class="code" href="../../d2/d9/struct__CCB.html">PCCB</a> Ccb;
00533 
00534     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00535 
00536     <a class="code" href="../../d1/d8/udfdata_8h.html#a34">ASSERT_FILE_OBJECT</a>( FileObject );
00537 
00538     <a class="code" href="../../d1/d8/fsrtl_8h.html#a48">FsRtlEnterFileSystem</a>();
00539 
00540     <span class="comment">//</span>
00541     <span class="comment">//  Decode the file object to find the type of open and the data</span>
00542     <span class="comment">//  structures.</span>
00543     <span class="comment">//</span>
00544 
00545     TypeOfOpen = <a class="code" href="../../d3/d8/udfprocs_8h.html#a174">UdfDecodeFileObject</a>( FileObject, &amp;Fcb, &amp;Ccb );
00546 
00547     <span class="comment">//</span>
00548     <span class="comment">//  We only support this request on user file or directory objects.</span>
00549     <span class="comment">//</span>
00550 
00551     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o10">FcbState</a>, FCB_STATE_INITIALIZED ));
00552     
00553     <span class="keywordflow">if</span> (TypeOfOpen != <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a> &amp;&amp; TypeOfOpen != <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a116">UserDirectoryOpen</a>) {
00554 
00555         <a class="code" href="../../d1/d8/fsrtl_8h.html#a49">FsRtlExitFileSystem</a>();
00556         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00557     }
00558 
00559     <span class="comment">//</span>
00560     <span class="comment">//  Acquire the file shared to access the Fcb.</span>
00561     <span class="comment">//</span>
00562 
00563     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d8/ex_8h.html#a69">ExAcquireResourceShared</a>( Fcb-&gt;Resource, Wait )) {
00564 
00565         <a class="code" href="../../d1/d8/fsrtl_8h.html#a49">FsRtlExitFileSystem</a>();
00566         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00567     }
00568 
00569     <span class="comment">//</span>
00570     <span class="comment">//  Use a try-finally to facilitate cleanup.</span>
00571     <span class="comment">//</span>
00572 
00573     <span class="keywordflow">try</span> {
00574 
00575         <span class="comment">//</span>
00576         <span class="comment">//  Only deal with 'good' Fcb's.</span>
00577         <span class="comment">//</span>
00578 
00579         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/udfs_2verfysup_8c.html#a6">UdfVerifyFcbOperation</a>( NULL, Fcb )) {
00580 
00581             <span class="comment">//</span>
00582             <span class="comment">//  Fill in the input buffer from the Fcb fields.</span>
00583             <span class="comment">//</span>
00584 
00585             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;CreationTime = Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o19">Timestamps</a>.<a class="code" href="../../d4/d1/struct__TIMESTAMP__BUNDLE.html#o0">CreationTime</a>;
00586             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;LastWriteTime =
00587             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;ChangeTime =  Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o19">Timestamps</a>.<a class="code" href="../../d4/d1/struct__TIMESTAMP__BUNDLE.html#o2">ModificationTime</a>;
00588             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;LastAccessTime = Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o19">Timestamps</a>.<a class="code" href="../../d4/d1/struct__TIMESTAMP__BUNDLE.html#o1">AccessTime</a>;
00589 
00590             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileAttributes = Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o11">FileAttributes</a> | <a class="code" href="../../d4/d3/fileinfo_8c.html#a2">UdfGetExtraFileAttributes</a>( Ccb );
00591 
00592             <span class="comment">//</span>
00593             <span class="comment">//  Update the IoStatus block with the size of this data.</span>
00594             <span class="comment">//</span>
00595 
00596             IoStatus-&gt;Status = STATUS_SUCCESS;
00597             IoStatus-&gt;Information = <span class="keyword">sizeof</span>( FILE_BASIC_INFORMATION );
00598 
00599             Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00600         }
00601 
00602     } finally {
00603 
00604         <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>( Fcb-&gt;Resource );
00605 
00606         <a class="code" href="../../d1/d8/fsrtl_8h.html#a49">FsRtlExitFileSystem</a>();
00607     }
00608 
00609     <span class="keywordflow">return</span> Result;
00610 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="fileinfo.c::UdfFastQueryNetworkInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN UdfFastQueryNetworkInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FileObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PFILE_NETWORK_OPEN_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PIO_STATUS_BLOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>IoStatus</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceObject</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00740">740</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00184">_TIMESTAMP_BUNDLE::AccessTime</a>, <a class="el" href="../../d2/d7/udfdata_8h-source.html#l00358">ASSERT_FILE_OBJECT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00183">_TIMESTAMP_BUNDLE::CreationTime</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02474">ExAcquireResourceShared</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02393">ExReleaseResource</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00992">_FCB::FileAttributes</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l01772">FsRtlEnterFileSystem</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l01795">FsRtlExitFileSystem</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00185">_TIMESTAMP_BUNDLE::ModificationTime</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l01044">_FCB::Timestamps</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a>, <a class="el" href="../../d7/d2/filobsup_8c-source.html#l00133">UdfDecodeFileObject()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00042">UdfGetExtraFileAttributes()</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00760">UdfVerifyFcbOperation()</a>, <a class="el" href="../../d3/d8/udfprocs_8h.html#a263a116">UserDirectoryOpen</a>, and <a class="el" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a>.
<p>
<pre class="fragment"><div>00750                    :
00751 
00752     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> fast query call <span class="keywordflow">for</span> network <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> information.
00753 
00754 Arguments:
00755 
00756     FileObject - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> object used in <span class="keyword">this</span> operation
00757 
00758     Wait - Indicates <span class="keywordflow">if</span> we are allowed to wait <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information
00759 
00760     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output buffer to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> basic information
00761 
00762     IoStatus - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">final</span> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation
00763 
00764 Return Value:
00765 
00766     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation succeeded and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller
00767         needs to take <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordtype">long</span> route.
00768 
00769 --*/
00770 
00771 {
00772     BOOLEAN Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00773     <a class="code" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a> TypeOfOpen;
00774 
00775     <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb;
00776     <a class="code" href="../../d2/d9/struct__CCB.html">PCCB</a> Ccb;
00777 
00778     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00779 
00780     <a class="code" href="../../d1/d8/udfdata_8h.html#a34">ASSERT_FILE_OBJECT</a>( FileObject );
00781 
00782     <a class="code" href="../../d1/d8/fsrtl_8h.html#a48">FsRtlEnterFileSystem</a>();
00783 
00784     <span class="comment">//</span>
00785     <span class="comment">//  Decode the file object to find the type of open and the data</span>
00786     <span class="comment">//  structures.</span>
00787     <span class="comment">//</span>
00788 
00789     TypeOfOpen = <a class="code" href="../../d3/d8/udfprocs_8h.html#a174">UdfDecodeFileObject</a>( FileObject, &amp;Fcb, &amp;Ccb );
00790 
00791     <span class="comment">//</span>
00792     <span class="comment">//  We only support this request on user file or directory objects.</span>
00793     <span class="comment">//</span>
00794 
00795     <span class="keywordflow">if</span> (TypeOfOpen != <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a> &amp;&amp; TypeOfOpen != <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a116">UserDirectoryOpen</a>) {
00796 
00797         <a class="code" href="../../d1/d8/fsrtl_8h.html#a49">FsRtlExitFileSystem</a>();
00798         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00799     }
00800 
00801     <span class="comment">//</span>
00802     <span class="comment">//  Acquire the file shared to access the Fcb.</span>
00803     <span class="comment">//</span>
00804 
00805     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d8/ex_8h.html#a69">ExAcquireResourceShared</a>( Fcb-&gt;Resource, Wait )) {
00806 
00807         <a class="code" href="../../d1/d8/fsrtl_8h.html#a49">FsRtlExitFileSystem</a>();
00808         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00809     }
00810 
00811     <span class="comment">//</span>
00812     <span class="comment">//  Use a try-finally to facilitate cleanup.</span>
00813     <span class="comment">//</span>
00814 
00815     <span class="keywordflow">try</span> {
00816 
00817         <span class="comment">//</span>
00818         <span class="comment">//  Only deal with 'good' Fcb's.</span>
00819         <span class="comment">//</span>
00820 
00821         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/udfs_2verfysup_8c.html#a6">UdfVerifyFcbOperation</a>( NULL, Fcb )) {
00822 
00823             <span class="comment">//</span>
00824             <span class="comment">//  Fill in the input buffer from the Fcb fields.</span>
00825             <span class="comment">//</span>
00826 
00827             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;CreationTime = Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o19">Timestamps</a>.<a class="code" href="../../d4/d1/struct__TIMESTAMP__BUNDLE.html#o0">CreationTime</a>;
00828             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;LastWriteTime =
00829             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;ChangeTime =  Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o19">Timestamps</a>.<a class="code" href="../../d4/d1/struct__TIMESTAMP__BUNDLE.html#o2">ModificationTime</a>;
00830             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;LastAccessTime = Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o19">Timestamps</a>.<a class="code" href="../../d4/d1/struct__TIMESTAMP__BUNDLE.html#o1">AccessTime</a>;
00831 
00832             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileAttributes = Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o11">FileAttributes</a> | <a class="code" href="../../d4/d3/fileinfo_8c.html#a2">UdfGetExtraFileAttributes</a>( Ccb );
00833 
00834             <span class="comment">//</span>
00835             <span class="comment">//  Check whether this is a directory.</span>
00836             <span class="comment">//</span>
00837 
00838             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o11">FileAttributes</a>, FILE_ATTRIBUTE_DIRECTORY )) {
00839 
00840                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;AllocationSize.QuadPart =
00841                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;EndOfFile.QuadPart = 0;
00842 
00843             } <span class="keywordflow">else</span> {
00844 
00845                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;AllocationSize.QuadPart = Fcb-&gt;AllocationSize.QuadPart;
00846                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;EndOfFile.QuadPart = Fcb-&gt;FileSize.QuadPart;
00847             }
00848 
00849             <span class="comment">//</span>
00850             <span class="comment">//  Update the IoStatus block with the size of this data.</span>
00851             <span class="comment">//</span>
00852 
00853             IoStatus-&gt;Status = STATUS_SUCCESS;
00854             IoStatus-&gt;Information = <span class="keyword">sizeof</span>( FILE_NETWORK_OPEN_INFORMATION );
00855 
00856             Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00857         }
00858 
00859     } finally {
00860 
00861         <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>( Fcb-&gt;Resource );
00862 
00863         <a class="code" href="../../d1/d8/fsrtl_8h.html#a49">FsRtlExitFileSystem</a>();
00864     }
00865 
00866     <span class="keywordflow">return</span> Result;
00867 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="fileinfo.c::UdfFastQueryStdInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN UdfFastQueryStdInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FileObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PFILE_STANDARD_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PIO_STATUS_BLOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>IoStatus</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceObject</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00614">614</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d2/d7/udfdata_8h-source.html#l00358">ASSERT_FILE_OBJECT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02474">ExAcquireResourceShared</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02393">ExReleaseResource</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00992">_FCB::FileAttributes</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l01772">FsRtlEnterFileSystem</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l01795">FsRtlExitFileSystem</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l01050">_FCB::LinkCount</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a>, <a class="el" href="../../d7/d2/filobsup_8c-source.html#l00201">UdfFastDecodeFileObject()</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00760">UdfVerifyFcbOperation()</a>, <a class="el" href="../../d3/d8/udfprocs_8h.html#a263a116">UserDirectoryOpen</a>, and <a class="el" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a>.
<p>
<pre class="fragment"><div>00624                    :
00625 
00626     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> fast query call <span class="keywordflow">for</span> standard <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> information.
00627 
00628 Arguments:
00629 
00630     FileObject - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> object used in <span class="keyword">this</span> operation
00631 
00632     Wait - Indicates <span class="keywordflow">if</span> we are allowed to wait <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information
00633 
00634     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output buffer to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> basic information
00635 
00636     IoStatus - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">final</span> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation
00637 
00638 Return Value:
00639 
00640     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation succeeded and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller
00641         needs to take <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordtype">long</span> route.
00642 
00643 --*/
00644 
00645 {
00646     BOOLEAN Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00647     <a class="code" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a> TypeOfOpen;
00648 
00649     <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb;
00650 
00651     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00652 
00653     <a class="code" href="../../d1/d8/udfdata_8h.html#a34">ASSERT_FILE_OBJECT</a>( FileObject );
00654 
00655     <a class="code" href="../../d1/d8/fsrtl_8h.html#a48">FsRtlEnterFileSystem</a>();
00656 
00657     <span class="comment">//</span>
00658     <span class="comment">//  Decode the file object to find the type of open and the data</span>
00659     <span class="comment">//  structures.</span>
00660     <span class="comment">//</span>
00661 
00662     TypeOfOpen = <a class="code" href="../../d3/d8/udfprocs_8h.html#a175">UdfFastDecodeFileObject</a>( FileObject, &amp;Fcb );
00663 
00664     <span class="comment">//</span>
00665     <span class="comment">//  We only support this request on initialized user file or directory objects.</span>
00666     <span class="comment">//</span>
00667 
00668     <span class="keywordflow">if</span> (TypeOfOpen != <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a> &amp;&amp; TypeOfOpen != <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a116">UserDirectoryOpen</a>) {
00669 
00670         <a class="code" href="../../d1/d8/fsrtl_8h.html#a49">FsRtlExitFileSystem</a>();
00671         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00672     }
00673 
00674     <span class="comment">//</span>
00675     <span class="comment">//  Acquire the file shared to access the Fcb.</span>
00676     <span class="comment">//</span>
00677 
00678     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d8/ex_8h.html#a69">ExAcquireResourceShared</a>( Fcb-&gt;Resource, Wait )) {
00679 
00680         <a class="code" href="../../d1/d8/fsrtl_8h.html#a49">FsRtlExitFileSystem</a>();
00681         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00682     }
00683 
00684     <span class="comment">//</span>
00685     <span class="comment">//  Use a try-finally to facilitate cleanup.</span>
00686     <span class="comment">//</span>
00687 
00688     <span class="keywordflow">try</span> {
00689 
00690         <span class="comment">//</span>
00691         <span class="comment">//  Only deal with 'good' Fcb's.</span>
00692         <span class="comment">//</span>
00693 
00694         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/udfs_2verfysup_8c.html#a6">UdfVerifyFcbOperation</a>( NULL, Fcb )) {
00695 
00696             <span class="comment">//</span>
00697             <span class="comment">//  Check whether this is a directory.</span>
00698             <span class="comment">//</span>
00699 
00700             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o11">FileAttributes</a>, FILE_ATTRIBUTE_DIRECTORY )) {
00701 
00702                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;AllocationSize.QuadPart =
00703                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;EndOfFile.QuadPart = 0;
00704 
00705                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;Directory = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00706 
00707             } <span class="keywordflow">else</span> {
00708 
00709                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;AllocationSize.QuadPart = Fcb-&gt;AllocationSize.QuadPart;
00710                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;EndOfFile.QuadPart = Fcb-&gt;FileSize.QuadPart;
00711 
00712                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;Directory = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00713             }
00714 
00715             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;NumberOfLinks = Fcb-&gt;<a class="code" href="../../d7/d9/struct__FCB.html#o20">LinkCount</a>;
00716             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;DeletePending = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00717 
00718             <span class="comment">//</span>
00719             <span class="comment">//  Update the IoStatus block with the size of this data.</span>
00720             <span class="comment">//</span>
00721 
00722             IoStatus-&gt;Status = STATUS_SUCCESS;
00723             IoStatus-&gt;Information = <span class="keyword">sizeof</span>( FILE_STANDARD_INFORMATION );
00724 
00725             Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00726         }
00727 
00728     } finally {
00729 
00730         <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>( Fcb-&gt;Resource );
00731 
00732         <a class="code" href="../../d1/d8/fsrtl_8h.html#a49">FsRtlExitFileSystem</a>();
00733     }
00734 
00735     <span class="keywordflow">return</span> Result;
00736 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="fileinfo.c::UdfGetExtraFileAttributes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INLINE ULONG UdfGetExtraFileAttributes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d9/struct__CCB.html">PCCB</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Ccb</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00042">42</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00496">UdfFastQueryBasicInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00740">UdfFastQueryNetworkInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00875">UdfQueryBasicInfo()</a>, and <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01429">UdfQueryNetworkInfo()</a>.
<p>
<pre class="fragment"><div>00048                    :
00049 
00050     Safely figure <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> extra name-based <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> attributes given a context block.
00051 
00052 Arguments:
00053 
00054     Ccb - a context block to examine.
00055 
00056 Return Value:
00057 
00058     ULONG - <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> attributes <span class="keywordflow">for</span> a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> based on how <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> was opened (seperate from
00059         those based on the object that was opened).
00060 
00061 --*/
00062 
00063 {
00064     <span class="keywordflow">return</span> ( Ccb-&gt;Lcb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>? Ccb-&gt;Lcb-&gt;FileAttributes : 0 );
00065 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="fileinfo.c::UdfQueryAlternateNameInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS UdfQueryAlternateNameInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IrpContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Fcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d9/struct__CCB.html">PCCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Ccb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PFILE_NAME_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01232">1232</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00501">BooleanFlagOn</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d0/d7/udf_8h-source.html#l00205">BYTE_COUNT_8_DOT_3</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l01666">_DIR_ENUM_CONTEXT::CaseObjectName</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00810">_LCB::FileName</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00790">_LCB::Flags</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00814">LCB_FLAG_IGNORE_CASE</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00815">LCB_FLAG_SHORT_NAME</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d7/udfstruc_8h-source.html#l00770">_LCB::ParentFcb</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l00436">try_leave</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01533">UdfAcquireFileShared</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00099">UdfCleanupDirContext()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00726">UdfFindDirEntry()</a>, <a class="el" href="../../d6/d4/namesup_8c-source.html#l00389">UdfGenerate8dot3Name()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00060">UdfInitializeDirContext()</a>, <a class="el" href="../../d6/d4/namesup_8c-source.html#l00176">UdfIs8dot3Name()</a>, and <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01539">UdfReleaseFile</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00156">UdfCommonQueryInfo()</a>.
<p>
<pre class="fragment"><div>01242                    :
01243 
01244     This routine performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query alternate name information function.
01245     We lookup <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dirent <span class="keywordflow">for</span> <span class="keyword">this</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> and then check <span class="keywordflow">if</span> there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a
01246     <span class="keywordtype">short</span> name.
01247 
01248 Arguments:
01249 
01250     Fcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Fcb being queried, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> has been verified.
01251 
01252     Ccb - Ccb <span class="keywordflow">for</span> <span class="keyword">this</span> open handle.
01253 
01254     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to
01255         be returned.
01256 
01257     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer in bytes, and receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01258         remaining bytes free in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer upon <span class="keywordflow">return</span>.
01259 
01260 Return Value:
01261 
01262     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - STATUS_SUCCESS <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> whole name would fit into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user buffer,
01263                STATUS_OBJECT_NAME_NOT_FOUND <span class="keywordflow">if</span> we can'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> <span class="keywordflow">return</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name,
01264                STATUS_BUFFER_OVERFLOW otherwise.
01265 
01266 --*/
01267 
01268 {
01269     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01270 
01271     <a class="code" href="../../d5/d5/struct__DIR__ENUM__CONTEXT.html">DIR_ENUM_CONTEXT</a> DirContext;
01272 
01273     <a class="code" href="../../d5/d9/struct__LCB.html">PLCB</a> Lcb;
01274     
01275     <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> ParentFcb;
01276     BOOLEAN ReleaseParentFcb = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01277 
01278     BOOLEAN CleanupDirContext = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01279     BOOLEAN Result;
01280 
01281     PUNICODE_STRING ShortName;
01282 
01283     UNICODE_STRING LocalShortName;
01284     WCHAR LocalShortNameBuffer[ <a class="code" href="../../d9/d7/udf_8h.html#a11">BYTE_COUNT_8_DOT_3</a> / <span class="keyword">sizeof</span>(WCHAR) ];
01285     
01286     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01287 
01288     <span class="comment">//</span>
01289     <span class="comment">//  Initialize the buffer length to zero.</span>
01290     <span class="comment">//</span>
01291 
01292     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileNameLength = 0;
01293 
01294     <span class="comment">//</span>
01295     <span class="comment">//  If there was no associated Lcb then there is no short name.</span>
01296     <span class="comment">//</span>
01297 
01298     Lcb = Ccb-&gt;Lcb;
01299     
01300     <span class="keywordflow">if</span> (Lcb == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01301 
01302         <span class="keywordflow">return</span> STATUS_OBJECT_NAME_NOT_FOUND;
01303     }
01304 
01305     <span class="comment">//</span>
01306     <span class="comment">//  Use a try-finally to cleanup the structures.</span>
01307     <span class="comment">//</span>
01308 
01309     <span class="keywordflow">try</span> {
01310 
01311         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Lcb-&gt;<a class="code" href="../../d5/d9/struct__LCB.html#o13">Flags</a>, LCB_FLAG_SHORT_NAME )) {
01312 
01313             <span class="comment">//</span>
01314             <span class="comment">//  This caller opened the file by a generated short name, so simply hand it back.</span>
01315             <span class="comment">//</span>
01316 
01317             ShortName = &amp;Lcb-&gt;<a class="code" href="../../d5/d9/struct__LCB.html#o16">FileName</a>;
01318         
01319         } <span class="keywordflow">else</span> {
01320 
01321             <span class="comment">//</span>
01322             <span class="comment">//  The open occured by a regular name.  Now, if this name is already 8.3 legal then</span>
01323             <span class="comment">//  there is no short name.</span>
01324             <span class="comment">//</span>
01325 
01326             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/udfprocs_8h.html#a178">UdfIs8dot3Name</a>( IrpContext, Lcb-&gt;<a class="code" href="../../d5/d9/struct__LCB.html#o16">FileName</a> )) {
01327 
01328                 <a class="code" href="../../d3/d8/udfprocs_8h.html#a64">try_leave</a>( Status = STATUS_OBJECT_NAME_NOT_FOUND );
01329             }
01330 
01331             <span class="comment">//</span>
01332             <span class="comment">//  This name has a generated short name.  In order to calculate this name we have to</span>
01333             <span class="comment">//  retrieve the FID for this file, since UDF specifies that a short name is uniquified</span>
01334             <span class="comment">//  with a CRC of the original in-FID byte representation of the filename.</span>
01335             <span class="comment">//</span>
01336             <span class="comment">//  N.B.: if this is a common operation, we may wish to cache the CRC in the Lcb.</span>
01337             <span class="comment">//</span>
01338 
01339             ParentFcb = Lcb-&gt;<a class="code" href="../../d5/d9/struct__LCB.html#o9">ParentFcb</a>;
01340             <a class="code" href="../../d3/d8/udfprocs_8h.html#a80">UdfAcquireFileShared</a>( IrpContext, ParentFcb );
01341             ReleaseParentFcb = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01342 
01343             <span class="comment">//</span>
01344             <span class="comment">//  Now go find the FID for this filename in the parent.</span>
01345             <span class="comment">//</span>
01346 
01347             <a class="code" href="../../d3/d8/udfprocs_8h.html#a167">UdfInitializeDirContext</a>( IrpContext, &amp;DirContext );
01348             CleanupDirContext = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01349 
01350             Result = <a class="code" href="../../d3/d8/udfprocs_8h.html#a172">UdfFindDirEntry</a>( IrpContext,
01351                                       ParentFcb,
01352                                       &amp;Lcb-&gt;<a class="code" href="../../d5/d9/struct__LCB.html#o16">FileName</a>,
01353                                       <a class="code" href="../../d5/d5/cc_8h.html#a59">BooleanFlagOn</a>( Lcb-&gt;<a class="code" href="../../d5/d9/struct__LCB.html#o13">Flags</a>, LCB_FLAG_IGNORE_CASE ),
01354                                       FALSE,
01355                                       &amp;DirContext );
01356             
01357             <span class="comment">//</span>
01358             <span class="comment">//  We should always be able to find this entry, but don't bugcheck because</span>
01359             <span class="comment">//  we screwed this up.</span>
01360             <span class="comment">//</span>
01361             
01362             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Result );
01363             
01364             <span class="keywordflow">if</span> (!Result) {
01365                 
01366                 <a class="code" href="../../d3/d8/udfprocs_8h.html#a64">try_leave</a>( Status = STATUS_OBJECT_NAME_NOT_FOUND );
01367             }
01368 
01369             <span class="comment">//</span>
01370             <span class="comment">//  Build the local unicode string to use and fill it in.</span>
01371             <span class="comment">//</span>
01372 
01373             ShortName = &amp;LocalShortName;
01374 
01375             LocalShortName.Buffer = LocalShortNameBuffer;
01376             LocalShortName.Length = 0;
01377             LocalShortName.MaximumLength = <span class="keyword">sizeof</span>( LocalShortNameBuffer );
01378 
01379             <a class="code" href="../../d3/d8/udfprocs_8h.html#a180">UdfGenerate8dot3Name</a>( IrpContext,
01380                                   &amp;DirContext.<a class="code" href="../../d5/d5/struct__DIR__ENUM__CONTEXT.html#o9">CaseObjectName</a>,
01381                                   ShortName );
01382         }
01383         
01384         <span class="comment">//</span>
01385         <span class="comment">//  We now have the short name.  We have left it in Unicode form so copy it directly.</span>
01386         <span class="comment">//</span>
01387 
01388         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileNameLength = ShortName-&gt;Length;
01389 
01390         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileNameLength + <span class="keyword">sizeof</span>( ULONG ) &gt; *Length) {
01391 
01392             <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileNameLength = *Length - <span class="keyword">sizeof</span>( ULONG );
01393             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
01394         }
01395 
01396         RtlCopyMemory( <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileName, ShortName-&gt;Buffer, <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileNameLength );
01397 
01398     } finally {
01399 
01400         <span class="keywordflow">if</span> (CleanupDirContext) {
01401 
01402             <a class="code" href="../../d3/d8/udfprocs_8h.html#a168">UdfCleanupDirContext</a>( IrpContext, &amp;DirContext );
01403         }
01404 
01405         <span class="keywordflow">if</span> (ReleaseParentFcb) {
01406 
01407             <a class="code" href="../../d3/d8/udfprocs_8h.html#a82">UdfReleaseFile</a>( IrpContext, ParentFcb );
01408         }
01409     }
01410 
01411     <span class="comment">//</span>
01412     <span class="comment">//  Reduce the available bytes by the amount stored into this buffer.</span>
01413     <span class="comment">//</span>
01414 
01415     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_OBJECT_NAME_NOT_FOUND) {
01416 
01417         *Length -= <span class="keyword">sizeof</span>( ULONG ) + <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileNameLength;
01418     }
01419 
01420     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01421 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="fileinfo.c::UdfQueryBasicInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UdfQueryBasicInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IrpContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Fcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d9/struct__CCB.html">PCCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Ccb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PFILE_BASIC_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00875">875</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00042">UdfGetExtraFileAttributes()</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00156">UdfCommonQueryInfo()</a>.
<p>
<pre class="fragment"><div>00885             :
00886 
00887     This routine performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query basic information function <span class="keywordflow">for</span> Udfs
00888 
00889 Arguments:
00890 
00891     Fcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Fcb being queried, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> has been verified
00892     
00893     Ccb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Ccb associated with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> fileobject being queried
00894 
00895     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to
00896         be returned
00897 
00898     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer in bytes, and receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00899         remaining bytes free in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer upon <span class="keywordflow">return</span>.
00900 
00901 Return Value:
00902 
00903     None
00904 
00905 --*/
00906 
00907 {
00908     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00909 
00910     <span class="comment">//</span>
00911     <span class="comment">//  We support all times on Udfs.</span>
00912     <span class="comment">//</span>
00913 
00914     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;CreationTime = Fcb-&gt;Timestamps.CreationTime;
00915     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;LastWriteTime =
00916     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;ChangeTime =  Fcb-&gt;Timestamps.ModificationTime;
00917     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;LastAccessTime = Fcb-&gt;Timestamps.AccessTime;
00918 
00919     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileAttributes = Fcb-&gt;FileAttributes | <a class="code" href="../../d4/d3/fileinfo_8c.html#a2">UdfGetExtraFileAttributes</a>( Ccb );
00920 
00921     <span class="comment">//</span>
00922     <span class="comment">//  Update the length and status output variables</span>
00923     <span class="comment">//</span>
00924 
00925     *Length -= <span class="keyword">sizeof</span>( FILE_BASIC_INFORMATION );
00926 
00927     <span class="keywordflow">return</span>;
00928 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="fileinfo.c::UdfQueryEaInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UdfQueryEaInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IrpContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Fcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PFILE_EA_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01057">1057</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00156">UdfCommonQueryInfo()</a>.
<p>
<pre class="fragment"><div>01066                    :
01067 
01068     This routine performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query Ea information function <span class="keywordflow">for</span> Udfs.
01069 
01070 Arguments:
01071 
01072     Fcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Fcb being queried, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> has been verified
01073 
01074     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to
01075         be returned
01076 
01077     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer in bytes, and receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01078         remaining bytes free in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer upon <span class="keywordflow">return</span>.
01079 
01080 Return Value:
01081 
01082     None
01083 
01084 --*/
01085 
01086 {
01087     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01088 
01089     <span class="comment">//</span>
01090     <span class="comment">//  No Ea's on Udfs volumes.  At least not that our EA support would understand.</span>
01091     <span class="comment">//</span>
01092 
01093     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;EaSize = 0;
01094     *Length -= <span class="keyword">sizeof</span>( FILE_EA_INFORMATION );
01095 
01096     <span class="keywordflow">return</span>;
01097 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="fileinfo.c::UdfQueryInternalInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UdfQueryInternalInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IrpContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Fcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PFILE_INTERNAL_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01009">1009</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00156">UdfCommonQueryInfo()</a>.
<p>
<pre class="fragment"><div>01018                    :
01019 
01020     This routine performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query internal information function <span class="keywordflow">for</span> Udfs.
01021 
01022 Arguments:
01023 
01024     Fcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Fcb being queried, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> has been verified
01025 
01026     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to
01027         be returned
01028 
01029     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer in bytes, and receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01030         remaining bytes free in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer upon <span class="keywordflow">return</span>.
01031 
01032 Return Value:
01033 
01034     None
01035 
01036 --*/
01037 
01038 {
01039     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01040 
01041     <span class="comment">//</span>
01042     <span class="comment">//  Index number is the file Id number in the Fcb.</span>
01043     <span class="comment">//</span>
01044 
01045     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;IndexNumber = Fcb-&gt;FileId;
01046     *Length -= <span class="keyword">sizeof</span>( FILE_INTERNAL_INFORMATION );
01047 
01048     <span class="keywordflow">return</span>;
01049 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="fileinfo.c::UdfQueryNameInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS UdfQueryNameInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IrpContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FileObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PFILE_NAME_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01158">1158</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00156">UdfCommonQueryInfo()</a>.
<p>
<pre class="fragment"><div>01167                    :
01168 
01169     This routine performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query name information function <span class="keywordflow">for</span> Udfs.
01170 
01171 Arguments:
01172 
01173     FileObject - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> object containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name.
01174 
01175     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to
01176         be returned
01177 
01178     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer in bytes, and receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01179         remaining bytes free in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer upon <span class="keywordflow">return</span>.
01180 
01181 Return Value:
01182 
01183     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - STATUS_BUFFER_OVERFLOW <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire name can'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> be copied.
01184 
01185 --*/
01186 
01187 {
01188     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01189     ULONG LengthToCopy;
01190 
01191     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01192 
01193     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(*Length &gt;= <span class="keyword">sizeof</span>(ULONG));
01194     
01195     <span class="comment">//</span>
01196     <span class="comment">//  Simply copy the name in the file object to the user's buffer.</span>
01197     <span class="comment">//</span>
01198 
01199     <span class="comment">//</span>
01200     <span class="comment">//  Place the size of the filename in the user's buffer and reduce the remaining</span>
01201     <span class="comment">//  size to match.</span>
01202     <span class="comment">//</span>
01203 
01204     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileNameLength = LengthToCopy = FileObject-&gt;FileName.Length;
01205     *Length -= <span class="keyword">sizeof</span>(ULONG);
01206 
01207     <span class="keywordflow">if</span> (LengthToCopy &gt; *Length) {
01208 
01209         LengthToCopy = *Length;
01210         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
01211     }
01212 
01213     RtlCopyMemory( <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileName, FileObject-&gt;FileName.Buffer, LengthToCopy );
01214 
01215     <span class="comment">//</span>
01216     <span class="comment">//  Reduce the available bytes by the amount stored into this buffer.  In the overflow</span>
01217     <span class="comment">//  case, this simply drops to zero.  The returned filenamelength will indicate to the</span>
01218     <span class="comment">//  caller how much space is required.</span>
01219     <span class="comment">//</span>
01220 
01221     *Length -= LengthToCopy;
01222 
01223     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01224 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="fileinfo.c::UdfQueryNetworkInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UdfQueryNetworkInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IrpContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Fcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d9/struct__CCB.html">PCCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Ccb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PFILE_NETWORK_OPEN_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01429">1429</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00042">UdfGetExtraFileAttributes()</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00156">UdfCommonQueryInfo()</a>.
<p>
<pre class="fragment"><div>01439             :
01440 
01441     This routine performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query network open information function <span class="keywordflow">for</span> Udfs.
01442 
01443 Arguments:
01444 
01445     Fcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Fcb being queried, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> has been verified
01446 
01447     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to
01448         be returned
01449 
01450     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer in bytes, and receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01451         remaining bytes free in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer upon <span class="keywordflow">return</span>.
01452 
01453 Return Value:
01454 
01455     None
01456 
01457 --*/
01458 
01459 {
01460     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01461 
01462     <span class="comment">//</span>
01463     <span class="comment">//  We support all times on Udfs.</span>
01464     <span class="comment">//</span>
01465 
01466     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;CreationTime = Fcb-&gt;Timestamps.CreationTime;
01467     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;LastWriteTime =
01468     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;ChangeTime =  Fcb-&gt;Timestamps.ModificationTime;
01469     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;LastAccessTime = Fcb-&gt;Timestamps.AccessTime;
01470 
01471     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;FileAttributes = Fcb-&gt;FileAttributes | <a class="code" href="../../d4/d3/fileinfo_8c.html#a2">UdfGetExtraFileAttributes</a>( Ccb );
01472 
01473     <span class="comment">//</span>
01474     <span class="comment">//  We get the sizes from the header.  Return a size of zero</span>
01475     <span class="comment">//  for all directories.</span>
01476     <span class="comment">//</span>
01477 
01478     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Fcb-&gt;FileAttributes, FILE_ATTRIBUTE_DIRECTORY )) {
01479 
01480         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;AllocationSize.QuadPart =
01481         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;EndOfFile.QuadPart = 0;
01482 
01483     } <span class="keywordflow">else</span> {
01484 
01485         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;AllocationSize.QuadPart = Fcb-&gt;AllocationSize.QuadPart;
01486         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;EndOfFile.QuadPart = Fcb-&gt;FileSize.QuadPart;
01487     }
01488 
01489     <span class="comment">//</span>
01490     <span class="comment">//  Update the length and status output variables</span>
01491     <span class="comment">//</span>
01492 
01493     *Length -= <span class="keyword">sizeof</span>( FILE_NETWORK_OPEN_INFORMATION );
01494 
01495     <span class="keywordflow">return</span>;
01496 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="fileinfo.c::UdfQueryPositionInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UdfQueryPositionInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IrpContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FileObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PFILE_POSITION_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01105">1105</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00156">UdfCommonQueryInfo()</a>.
<p>
<pre class="fragment"><div>01114                    :
01115 
01116     This routine performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query position information function <span class="keywordflow">for</span> Udfs.
01117 
01118 Arguments:
01119 
01120     FileObject - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a> object being queried
01121 
01122     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to
01123         be returned
01124 
01125     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer in bytes, and receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01126         remaining bytes free in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer upon <span class="keywordflow">return</span>.
01127 
01128 Return Value:
01129 
01130     None
01131 
01132 --*/
01133 
01134 {
01135     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01136 
01137     <span class="comment">//</span>
01138     <span class="comment">//  Get the current position found in the file object.</span>
01139     <span class="comment">//</span>
01140 
01141     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;CurrentByteOffset = FileObject-&gt;CurrentByteOffset;
01142 
01143     <span class="comment">//</span>
01144     <span class="comment">//  Update the length and status output variables</span>
01145     <span class="comment">//</span>
01146 
01147     *Length -= <span class="keyword">sizeof</span>( FILE_POSITION_INFORMATION );
01148 
01149     <span class="keywordflow">return</span>;
01150 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="fileinfo.c::UdfQueryStandardInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UdfQueryStandardInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>IrpContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d9/struct__FCB.html">PFCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Fcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PFILE_STANDARD_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00936">936</a> of file <a class="el" href="../../d5/d2/fileinfo_8c-source.html">fileinfo.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00156">UdfCommonQueryInfo()</a>.
<p>
<pre class="fragment"><div>00944                    :
00945 
00946     This routine performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query standard information function <span class="keywordflow">for</span> Udfs.
00947 
00948 Arguments:
00949 
00950     Fcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Fcb being queried, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> has been verified
00951 
00952     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to
00953         be returned
00954 
00955     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer in bytes, and receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00956         remaining bytes free in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer upon <span class="keywordflow">return</span>.
00957 
00958 Return Value:
00959 
00960     None
00961 
00962 --*/
00963 
00964 {
00965     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00966 
00967     <span class="comment">//</span>
00968     <span class="comment">//  Delete is never pending on a readonly file.</span>
00969     <span class="comment">//</span>
00970 
00971     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;NumberOfLinks = Fcb-&gt;LinkCount;
00972     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;DeletePending = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00973 
00974     <span class="comment">//</span>
00975     <span class="comment">//  We get the sizes from the header.  Return a size of zero</span>
00976     <span class="comment">//  for all directories.</span>
00977     <span class="comment">//</span>
00978 
00979     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( Fcb-&gt;FileAttributes, FILE_ATTRIBUTE_DIRECTORY )) {
00980 
00981         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;AllocationSize.QuadPart =
00982         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;EndOfFile.QuadPart = 0;
00983 
00984         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;Directory = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00985 
00986     } <span class="keywordflow">else</span> {
00987 
00988         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;AllocationSize.QuadPart = Fcb-&gt;AllocationSize.QuadPart;
00989         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;EndOfFile.QuadPart = Fcb-&gt;FileSize.QuadPart;
00990 
00991         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-&gt;Directory = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00992     }
00993 
00994     <span class="comment">//</span>
00995     <span class="comment">//  Update the length and status output variables</span>
00996     <span class="comment">//</span>
00997 
00998     *Length -= <span class="keyword">sizeof</span>( FILE_STANDARD_INFORMATION );
00999 
01000     <span class="keywordflow">return</span>;
01001 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:39 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
