<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: comboini.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>comboini.c</h1><a href="../../d3/d4/comboini_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/**************************** Module Header ********************************\</span>
00002 <span class="comment">* Module Name: comboini.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* All the (one time) initialization/destruction code used for combo boxes</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 12-05-90 IanJa        Ported</span>
00010 <span class="comment">* 01-Feb-1991 mikeke    Added Revalidation code</span>
00011 <span class="comment">* 20-Jan-1992 IanJa     ANSI/UNIOCDE netralization</span>
00012 <span class="comment">\***************************************************************************/</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00015 <span class="preprocessor">#pragma hdrstop</span>
00016 <span class="preprocessor"></span>
<a name="l00017"></a><a class="code" href="../../d3/d4/comboini_8c.html#a1">00017</a> <span class="keyword">extern</span> <a class="code" href="../../d2/d4/struct__LOOKASIDE.html">LOOKASIDE</a> <a class="code" href="../../d1/d4/combo_8c.html#a0">ComboboxLookaside</a>;
00018 
<a name="l00019"></a><a class="code" href="../../d3/d4/comboini_8c.html#a0">00019</a> <span class="preprocessor">#define RECALC_CYDROP   -1</span>
00020 <span class="preprocessor"></span>
00021 <span class="keywordtype">void</span> <a class="code" href="../../d3/d4/comboini_8c.html#a2">xxxCBSetDroppedSize</a>(<a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> pcbox, LPRECT lprc);
00022 
00023 <span class="comment">/***************************************************************************\</span>
00024 <span class="comment">* CBNcCreateHandler</span>
00025 <span class="comment">*</span>
00026 <span class="comment">* Allocates space for the CBOX structure and sets the window to point to it.</span>
00027 <span class="comment">*</span>
00028 <span class="comment">* History:</span>
00029 <span class="comment">\***************************************************************************/</span>
00030 
<a name="l00031"></a><a class="code" href="../../d6/d0/usercli_8h.html#a670">00031</a> LONG <a class="code" href="../../d6/d0/usercli_8h.html#a670">CBNcCreateHandler</a>(
00032     <a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> pcbox,
00033     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00034 {
00035     <span class="comment">/*</span>
00036 <span class="comment">     * Save the style bits so that we have them when we create the client area</span>
00037 <span class="comment">     * of the combo box window.</span>
00038 <span class="comment">     */</span>
00039     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o25">styleSave</a> = pwnd-&gt;style &amp; (WS_VSCROLL | WS_HSCROLL);
00040 
00041     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a685">CBFOWNERDRAW</a>))
00042         <span class="comment">// Add in CBS_HASSTRINGS if the style is implied...</span>
00043         <a class="code" href="../../d4/d1/userk_8h.html#a1628">SetWindowState</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a689">CBFHASSTRINGS</a>);
00044 
00045     UserAssert(<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a641">WFVSCROLL</a>) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a640">WFHSCROLL</a>));
00046     UserAssert(<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a640">WFHSCROLL</a>) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a644">WFBORDER</a>));
00047     <a class="code" href="../../d4/d1/userk_8h.html#a1629">ClearWindowState</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a641">WFVSCROLL</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a640">WFHSCROLL</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a644">WFBORDER</a>);
00048 
00049     <span class="comment">//</span>
00050     <span class="comment">// If the window is 4.0 compatible or has a CLIENTEDGE, draw the combo</span>
00051     <span class="comment">// in 3D.  Otherwise, use a flat border.</span>
00052     <span class="comment">//</span>
00053     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a621">WEFCLIENTEDGE</a>))
00054         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o20">f3DCombo</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00055 
00056     <a class="code" href="../../d4/d1/userk_8h.html#a1629">ClearWindowState</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a622">WEFEDGEMASK</a>);
00057 
00058     <span class="keywordflow">return</span> (LONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00059 }
00060 
00061 <span class="comment">/***************************************************************************\</span>
00062 <span class="comment">* xxxCBCreateHandler</span>
00063 <span class="comment">*</span>
00064 <span class="comment">* Creates all the child controls within the combo box</span>
00065 <span class="comment">* Returns -1 if error</span>
00066 <span class="comment">*</span>
00067 <span class="comment">* History:</span>
00068 <span class="comment">\***************************************************************************/</span>
00069 
<a name="l00070"></a><a class="code" href="../../d6/d0/usercli_8h.html#a671">00070</a> LRESULT <a class="code" href="../../d6/d0/usercli_8h.html#a671">xxxCBCreateHandler</a>(
00071     <a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> pcbox,
00072     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00073 {
00074     LONG lStyleT;
00075     RECT rcList;
00076     HWND hwndList;
00077     HWND hwndEdit;
00078     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> lExStyle;
00079 
00080     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00081 
00082     <span class="comment">/*</span>
00083 <span class="comment">     * Don't lock the combobox window: this would prevent WM_FINALDESTROY</span>
00084 <span class="comment">     * being sent to it, so pwnd and pcbox wouldn't get freed (zombies)</span>
00085 <span class="comment">     * until thread cleanup. (IanJa)  LATER: change name from spwnd to pwnd.</span>
00086 <span class="comment">     * Lock(&amp;pcbox-&gt;spwnd, pwnd); - caused a 'catch-22'</span>
00087 <span class="comment">     */</span>
00088     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o1">spwndParent</a>), <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent));
00089 
00090     <span class="comment">/*</span>
00091 <span class="comment">     * Break out the style bits so that we will be able to create the listbox</span>
00092 <span class="comment">     * and editcontrol windows.</span>
00093 <span class="comment">     */</span>
00094 
00095     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a679">CBFDROPDOWNLIST</a>) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a679">CBFDROPDOWNLIST</a>)) {
00096         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a60">SDROPDOWNLIST</a>;
00097         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o21">fNoEdit</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00098     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a678">CBFDROPDOWN</a>))
00099         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a61">SDROPDOWN</a>;
00100     <span class="keywordflow">else</span>
00101         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a59">SSIMPLE</a>;
00102 
00103     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o23">fRtoLReading</a> = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a625">WEFRTLREADING</a>) != 0);
00104     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o22">fRightAlign</a>  = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a624">WEFRIGHT</a>) != 0);
00105 
00106     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a693">CBFUPPERCASE</a>))
00107         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o19">fCase</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a64">UPPERCASE</a>;
00108     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a694">CBFLOWERCASE</a>))
00109         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o19">fCase</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a65">LOWERCASE</a>;
00110     <span class="keywordflow">else</span>
00111         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o19">fCase</a> = 0;
00112 
00113     <span class="comment">// Listbox item flags.</span>
00114     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a684">CBFOWNERDRAWVAR</a>))
00115         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o16">OwnerDraw</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a63">OWNERDRAWVAR</a>;
00116     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a683">CBFOWNERDRAWFIXED</a>)) {
00117         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o16">OwnerDraw</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a62">OWNERDRAWFIXED</a>;
00118     }
00119 
00120     <span class="comment">/*</span>
00121 <span class="comment">     * Get the size of the combo box rectangle.</span>
00122 <span class="comment">     */</span>
00123     <span class="comment">// Get control sizes.</span>
00124     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o4">cxCombo</a> = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00125     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o7">cyDrop</a>  = <a class="code" href="../../d3/d4/comboini_8c.html#a0">RECALC_CYDROP</a>;
00126     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o6">cxDrop</a>  = 0;
00127     <a class="code" href="../../d6/d0/usercli_8h.html#a672">xxxCBCalcControlRects</a>(pcbox, &amp;rcList);
00128 
00129     <span class="comment">//</span>
00130     <span class="comment">// We need to do this because listboxes, as of VER40, have stopped</span>
00131     <span class="comment">// reinflating themselves by CXBORDER and CYBORDER.</span>
00132     <span class="comment">//</span>
00133     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>))
00134         <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcList, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00135 
00136     <span class="comment">/*</span>
00137 <span class="comment">     * Note that we have to create the listbox before the editcontrol since the</span>
00138 <span class="comment">     * editcontrol code looks for and saves away the listbox pwnd and the</span>
00139 <span class="comment">     * listbox pwnd will be NULL if we don't create it first.  Also, hack in</span>
00140 <span class="comment">     * some special +/- values for the listbox size due to the way we create</span>
00141 <span class="comment">     * listboxes with borders.</span>
00142 <span class="comment">     */</span>
00143     lStyleT = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o25">styleSave</a>;
00144 
00145     lStyleT |= WS_CHILD | WS_VISIBLE | LBS_NOTIFY | <a class="code" href="../../d6/d0/usercli_8h.html#a67">LBS_COMBOBOX</a> | WS_CLIPSIBLINGS;
00146 
00147     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>))
00148         lStyleT |= WS_DISABLED;
00149     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a690">CBFNOINTEGRALHEIGHT</a>))
00150         lStyleT |= LBS_NOINTEGRALHEIGHT;
00151     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a688">CBFSORT</a>))
00152         lStyleT |= LBS_SORT;
00153     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a689">CBFHASSTRINGS</a>))
00154         lStyleT |= LBS_HASSTRINGS;
00155     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a691">CBFDISABLENOSCROLL</a>))
00156         lStyleT |= LBS_DISABLENOSCROLL;
00157 
00158     <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o16">OwnerDraw</a> == <a class="code" href="../../d6/d0/usercli_8h.html#a63">OWNERDRAWVAR</a>)
00159         lStyleT |= LBS_OWNERDRAWVARIABLE;
00160     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o16">OwnerDraw</a> == <a class="code" href="../../d6/d0/usercli_8h.html#a62">OWNERDRAWFIXED</a>)
00161         lStyleT |= LBS_OWNERDRAWFIXED;
00162 
00163     <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a57">SDROPPABLE</a>)
00164         lStyleT |= WS_BORDER;
00165 
00166     lExStyle = pwnd-&gt;ExStyle &amp; (WS_EX_RIGHT | WS_EX_RTLREADING | WS_EX_LEFTSCROLLBAR);
00167     hwndList = <a class="code" href="../../d6/d0/usercli_8h.html#a624">_CreateWindowEx</a>(lExStyle |
00168             ((pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a57">SDROPPABLE</a>) ? WS_EX_TOOLWINDOW : WS_EX_CLIENTEDGE),
00169             MAKEINTRESOURCE(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a81">ICLS_COMBOLISTBOX</a>]), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lStyleT,
00170             rcList.left, rcList.top, rcList.right - rcList.left,
00171             rcList.bottom - rcList.top,
00172             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd), (HMENU)<a class="code" href="../../d6/d0/usercli_8h.html#a54">CBLISTBOXID</a>, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;hModule, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00173             0);
00174     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>), <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndList));
00175 
00176     <span class="keywordflow">if</span> (!pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>) {
00177         <span class="keywordflow">return</span> -1;
00178     }
00179 
00180     <span class="comment">/*</span>
00181 <span class="comment">     * Create either the edit control or the static text rectangle.</span>
00182 <span class="comment">     */</span>
00183     <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o21">fNoEdit</a>) {
00184 
00185         <span class="comment">/*</span>
00186 <span class="comment">         * No editcontrol so we will draw text directly into the combo box</span>
00187 <span class="comment">         * window.</span>
00188 <span class="comment">         */</span>
00189         <span class="comment">/*</span>
00190 <span class="comment">         * Don't lock the combobox window: this would prevent WM_FINALDESTROY</span>
00191 <span class="comment">         * being sent to it, so pwnd and pcbox wouldn't get freed (zombies)</span>
00192 <span class="comment">         * until thread cleanup. (IanJa)  LATER: change name from spwnd to pwnd.</span>
00193 <span class="comment">         * Lock(&amp;(pcbox-&gt;spwndEdit), pcbox-&gt;spwnd); - caused a 'catch-22'</span>
00194 <span class="comment">         */</span>
00195         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a> = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>;
00196     } <span class="keywordflow">else</span> {
00197         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCsFlags;
00198 
00199         lStyleT = WS_CHILD | WS_VISIBLE | ES_COMBOBOX | ES_NOHIDESEL;
00200         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>))
00201             lStyleT |= WS_DISABLED;
00202         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a686">CBFAUTOHSCROLL</a>))
00203             lStyleT |= ES_AUTOHSCROLL;
00204         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a687">CBFOEMCONVERT</a>))
00205             lStyleT |= ES_OEMCONVERT;
00206         <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o19">fCase</a>)
00207             lStyleT |= (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o19">fCase</a> &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a64">UPPERCASE</a>) ? ES_UPPERCASE : ES_LOWERCASE;
00208 
00209         <span class="comment">/*</span>
00210 <span class="comment">         * Edit control need to know whether original CreateWindow*() call</span>
00211 <span class="comment">         * was ANSI or Unicode.</span>
00212 <span class="comment">         */</span>
00213         dwCsFlags = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a581">WFANSICREATOR</a>) ? CW_FLAGS_ANSI : 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00214         <span class="keywordflow">if</span> (lExStyle &amp; WS_EX_RIGHT)
00215             lStyleT |= ES_RIGHT;
00216 
00217         hwndEdit = <a class="code" href="../../d6/d0/usercli_8h.html#a624">_CreateWindowEx</a>(lExStyle,
00218             MAKEINTRESOURCE(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a69">ICLS_EDIT</a>]), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lStyleT,
00219             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.left, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.top,
00220             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.right - pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.left, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.bottom -
00221             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.top, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd), (HMENU)<a class="code" href="../../d6/d0/usercli_8h.html#a55">CBEDITID</a>,
00222             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;hModule, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00223             dwCsFlags);
00224         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>), <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndEdit));
00225     }
00226     <span class="keywordflow">if</span> (!pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>)
00227         <span class="keywordflow">return</span> -1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00228 
00229     <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a57">SDROPPABLE</a>) {
00230 
00231         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a237">NtUserShowWindow</a>(hwndList, SW_HIDE);
00232         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a227">NtUserSetParent</a>(hwndList, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00233 
00234         <span class="comment">// We need to do this so dropped size works right</span>
00235         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>))
00236             <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcList, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00237 
00238         <a class="code" href="../../d3/d4/comboini_8c.html#a2">xxxCBSetDroppedSize</a>(pcbox, &amp;rcList);
00239     }
00240 
00241     <span class="comment">/*</span>
00242 <span class="comment">     * return anything as long as it's not -1L (-1L == error)</span>
00243 <span class="comment">     */</span>
00244     <span class="keywordflow">return</span> (LRESULT)pwnd;
00245 }
00246 
00247 <span class="comment">/***************************************************************************\</span>
00248 <span class="comment">* xxxCBCalcControlRects</span>
00249 <span class="comment">*</span>
00250 <span class="comment">* History:</span>
00251 <span class="comment">\***************************************************************************/</span>
00252 
<a name="l00253"></a><a class="code" href="../../d6/d0/usercli_8h.html#a672">00253</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a672">xxxCBCalcControlRects</a>(<a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> pcbox, LPRECT lprcList)
00254 {
00255     HDC hdc;
00256     HANDLE hOldFont = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00257     <span class="keywordtype">int</span>             dyEdit, dxEdit;
00258     MEASUREITEMSTRUCT mis;
00259     SIZE size;
00260     HWND hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>);
00261     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndParent;
00262 
00263     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>);
00264 
00265     <span class="comment">/*</span>
00266 <span class="comment">     * Determine height of the edit control.  We can use this info to center</span>
00267 <span class="comment">     * the button with recpect to the edit/static text window.  For example</span>
00268 <span class="comment">     * this will be useful if owner draw and this window is tall.</span>
00269 <span class="comment">     */</span>
00270     hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a250">NtUserGetDC</a>(hwnd);
00271     <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o24">hFont</a>) {
00272         hOldFont = SelectObject(hdc, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o24">hFont</a>);
00273     }
00274 
00275     <span class="comment">// Add on CYEDGE just for some extra space in the edit field/static item.</span>
00276     <span class="comment">// It's really only for static text items, but we want static &amp; editable</span>
00277     <span class="comment">// controls to be the same height.</span>
00278     GetTextExtentPoint(hdc, <a class="code" href="../../d1/d8/clglobal_8c.html#a14">szOneChar</a>, 1, &amp;size);
00279     dyEdit = size.cy + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
00280 
00281     <span class="keywordflow">if</span> (hOldFont) {
00282         SelectObject(hdc, hOldFont);
00283     }
00284 
00285     <span class="comment">/*</span>
00286 <span class="comment">     * IanJa: was ReleaseDC(pcbox-&gt;hwnd, hdc);</span>
00287 <span class="comment">     */</span>
00288     <a class="code" href="../../d6/d0/usercli_8h.html#a211">NtUserReleaseDC</a>(hwnd, hdc);
00289 
00290     <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o16">OwnerDraw</a>) {
00291         <span class="comment">// This is an ownerdraw combo.  Have the owner tell us how tall this</span>
00292         <span class="comment">// item is.</span>
00293         <span class="keywordtype">int</span> iOwnerDrawHeight;
00294 
00295         <span class="keywordflow">if</span> (iOwnerDrawHeight = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.bottom - pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.top) {
00296             dyEdit = iOwnerDrawHeight;
00297         } <span class="keywordflow">else</span> {
00298             <span class="comment">/*</span>
00299 <span class="comment">             * No height has been defined yet for the static text window.  Send</span>
00300 <span class="comment">             * a measure item message to the parent</span>
00301 <span class="comment">             */</span>
00302             mis.CtlType = ODT_COMBOBOX;
00303             mis.CtlID = PtrToUlong(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>);
00304             mis.itemID = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)-1;
00305             mis.itemHeight = dyEdit;
00306             mis.itemData = 0;
00307 
00308             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o1">spwndParent</a>, &amp;tlpwndParent);
00309             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o1">spwndParent</a>), WM_MEASUREITEM, mis.CtlID, (LPARAM)&amp;mis);
00310             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
00311 
00312             dyEdit = mis.itemHeight;
00313         }
00314     }
00315     <span class="comment">/*</span>
00316 <span class="comment">     * Set the initial width to be the combo box rect.  Later we will shorten it</span>
00317 <span class="comment">     * if there is a dropdown button.</span>
00318 <span class="comment">     */</span>
00319     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a> = 2*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYFIXEDFRAME) + dyEdit;
00320     dxEdit = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o4">cxCombo</a> - (2 * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME));
00321 
00322     <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o7">cyDrop</a> == <a class="code" href="../../d3/d4/comboini_8c.html#a0">RECALC_CYDROP</a>)
00323     {
00324         <span class="comment">// recompute the max height of the dropdown listbox -- full window</span>
00325         <span class="comment">// size MINUS edit/static height</span>
00326         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o7">cyDrop</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>((pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top) - pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a>, 0);
00327 
00328         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>) &amp;&amp; (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o7">cyDrop</a> == 23))
00329             <span class="comment">// This is VC++ 2.1's debug/release dropdown that they made super</span>
00330             <span class="comment">// small -- let's make 'em a wee bit bigger so the world can</span>
00331             <span class="comment">// continue to spin -- jeffbog -- 4/19/95 -- B#10029</span>
00332             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o7">cyDrop</a> = 28;
00333     }
00334 
00335     <span class="comment">/*</span>
00336 <span class="comment">     * Determine the rectangles for each of the windows...  1.  Pop down button 2.</span>
00337 <span class="comment">     * Edit control or generic window for static text or ownerdraw...  3.  List</span>
00338 <span class="comment">     * box</span>
00339 <span class="comment">     */</span>
00340 
00341     <span class="comment">// Is there a button?</span>
00342     <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a57">SDROPPABLE</a>) {
00343         <span class="comment">// Determine button's rectangle.</span>
00344         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>.top = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
00345         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>.bottom = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
00346         <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o22">fRightAlign</a>) {
00347             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>.left  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME);
00348             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>.right = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>.left + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVSCROLL);
00349         } <span class="keywordflow">else</span> {
00350             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>.right = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o4">cxCombo</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
00351             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>.left  = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>.right - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVSCROLL);
00352         }
00353 
00354         <span class="comment">// Reduce the width of the edittext window to make room for the button.</span>
00355         dxEdit = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(dxEdit - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXVSCROLL), 0);
00356 
00357     } <span class="keywordflow">else</span> {
00358 
00359         <span class="comment">/*</span>
00360 <span class="comment">         * No button so make the rectangle 0 so that a point in rect will always</span>
00361 <span class="comment">         * return false.</span>
00362 <span class="comment">         */</span>
00363         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a35">SetRectEmpty</a>(&amp;pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>);
00364     }
00365 
00366     <span class="comment">/*</span>
00367 <span class="comment">     * So now, the edit rect is really the item area.</span>
00368 <span class="comment">     */</span>
00369     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.left      = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME);
00370     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.right     = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.left + dxEdit;
00371     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.top       = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYFIXEDFRAME);
00372     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.bottom    = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.top + dyEdit;
00373 
00374     <span class="comment">// Is there a right-aligned button?</span>
00375     <span class="keywordflow">if</span> ((pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a57">SDROPPABLE</a>) &amp;&amp; (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o22">fRightAlign</a>)) {
00376         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.right   = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o4">cxCombo</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
00377         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.left    = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.right - dxEdit;
00378     }
00379 
00380     lprcList-&gt;left          = 0;
00381     lprcList-&gt;top           = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a>;
00382     lprcList-&gt;right         = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o6">cxDrop</a>, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o4">cxCombo</a>);
00383     lprcList-&gt;bottom        = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a> + pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o7">cyDrop</a>;
00384 }
00385 
00386 <span class="comment">/***************************************************************************\</span>
00387 <span class="comment">* xxxCBNcDestroyHandler</span>
00388 <span class="comment">*</span>
00389 <span class="comment">* Destroys the combobox and frees up all memory used by it</span>
00390 <span class="comment">*</span>
00391 <span class="comment">* History:</span>
00392 <span class="comment">\***************************************************************************/</span>
00393 
<a name="l00394"></a><a class="code" href="../../d6/d0/usercli_8h.html#a673">00394</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a673">xxxCBNcDestroyHandler</a>(
00395     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00396     <a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> pcbox)
00397 {
00398     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00399 
00400     <span class="comment">/*</span>
00401 <span class="comment">     * If there is no pcbox, there is nothing to clean up.</span>
00402 <span class="comment">     */</span>
00403     <span class="keywordflow">if</span> (pcbox != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00404 
00405         <span class="comment">/*</span>
00406 <span class="comment">         * Destroy the list box here so that it'll send WM_DELETEITEM messages</span>
00407 <span class="comment">         * before the combo box turns into a zombie.</span>
00408 <span class="comment">         */</span>
00409         <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00410             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a159">NtUserDestroyWindow</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>));
00411             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>);
00412         }
00413 
00414         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00415         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o1">spwndParent</a>);
00416 
00417         <span class="comment">/*</span>
00418 <span class="comment">         * If there is no editcontrol, spwndEdit is the combobox window which</span>
00419 <span class="comment">         * isn't locked (that would have caused a 'catch-22').</span>
00420 <span class="comment">         */</span>
00421         <span class="keywordflow">if</span> (pwnd != pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>) {
00422             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>);
00423         }
00424 
00425         <span class="comment">/*</span>
00426 <span class="comment">         * Since a pointer and a handle to a fixed local object are the same.</span>
00427 <span class="comment">         */</span>
00428         <a class="code" href="../../d6/d0/usercli_8h.html#a408">FreeLookasideEntry</a>(&amp;<a class="code" href="../../d1/d4/combo_8c.html#a0">ComboboxLookaside</a>, pcbox);
00429     }
00430 
00431     <span class="comment">/*</span>
00432 <span class="comment">     * Set the window's fnid status so that we can ignore rogue messages</span>
00433 <span class="comment">     */</span>
00434     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a284">NtUserSetWindowFNID</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a226">FNID_CLEANEDUP_BIT</a>);
00435 }
00436 
00437 <span class="comment">/***************************************************************************\</span>
00438 <span class="comment">* xxxCBSetFontHandler</span>
00439 <span class="comment">*</span>
00440 <span class="comment">* History:</span>
00441 <span class="comment">\***************************************************************************/</span>
00442 
<a name="l00443"></a><a class="code" href="../../d6/d0/usercli_8h.html#a680">00443</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a680">xxxCBSetFontHandler</a>(
00444     <a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> pcbox,
00445     HANDLE hFont,
00446     BOOL fRedraw)
00447 {
00448     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndEdit;
00449     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndList;
00450 
00451     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>);
00452 
00453     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>, &amp;tlpwndEdit);
00454     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>, &amp;tlpwndList);
00455 
00456     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o24">hFont</a> = hFont;
00457 
00458     <span class="keywordflow">if</span> (!pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o21">fNoEdit</a> &amp;&amp; pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>) {
00459         <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>, WM_SETFONT, (WPARAM)hFont, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00460     }
00461 
00462     <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>, WM_SETFONT, (WPARAM)hFont, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00463 
00464     <span class="comment">// Recalculate the layout of controls.  This will hide the listbox also.</span>
00465     <a class="code" href="../../d6/d0/usercli_8h.html#a669">xxxCBPosition</a>(pcbox);
00466 
00467     <span class="keywordflow">if</span> (fRedraw) {
00468         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00469 <span class="comment">// LATER UpdateWindow(HW(pcbox-&gt;spwnd));</span>
00470     }
00471 
00472     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndList);
00473     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndEdit);
00474 }
00475 
00476 <span class="comment">/***************************************************************************\</span>
00477 <span class="comment">* xxxCBSetEditItemHeight</span>
00478 <span class="comment">*</span>
00479 <span class="comment">* Sets the height of the edit/static item of a combo box.</span>
00480 <span class="comment">*</span>
00481 <span class="comment">* History:</span>
00482 <span class="comment">* 06-27-91 DarrinM      Ported from Win 3.1.</span>
00483 <span class="comment">\***************************************************************************/</span>
00484 
<a name="l00485"></a><a class="code" href="../../d6/d0/usercli_8h.html#a682">00485</a> LONG <a class="code" href="../../d6/d0/usercli_8h.html#a682">xxxCBSetEditItemHeight</a>(
00486     <a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> pcbox,
00487     <span class="keywordtype">int</span> dyEdit)
00488 {
00489     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndEdit;
00490     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndList;
00491 
00492     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>);
00493 
00494     <span class="keywordflow">if</span> (dyEdit &gt; 255) {
00495         RIPERR0(ERROR_INVALID_EDIT_HEIGHT, RIP_VERBOSE, <span class="stringliteral">""</span>);
00496         <span class="keywordflow">return</span> CB_ERR;
00497     }
00498 
00499     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.bottom = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.top + dyEdit;
00500     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a> = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.bottom + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYFIXEDFRAME);
00501 
00502     <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a57">SDROPPABLE</a>) {
00503         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o3">buttonrc</a>.bottom = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
00504     }
00505 
00506     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>, &amp;tlpwndEdit);
00507     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>, &amp;tlpwndList);
00508 
00509 
00510     <span class="comment">/*</span>
00511 <span class="comment">     * Reposition the editfield.</span>
00512 <span class="comment">     * Don't let spwndEdit or List of NULL go through; if someone adjusts</span>
00513 <span class="comment">     * the height on a NCCREATE; same as not having</span>
00514 <span class="comment">     * HW instead of HWq but we don't go to the kernel.</span>
00515 <span class="comment">     */</span>
00516     <span class="keywordflow">if</span> (!pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o21">fNoEdit</a> &amp;&amp; pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>) {
00517         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a111">NtUserMoveWindow</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>), pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.left, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.top,
00518             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.right-pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.left, dyEdit, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00519     }
00520 
00521     <span class="comment">/*</span>
00522 <span class="comment">     * Reposition the list and combobox windows.</span>
00523 <span class="comment">     */</span>
00524     <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o10">CBoxStyle</a> == <a class="code" href="../../d6/d0/usercli_8h.html#a59">SSIMPLE</a>) {
00525         <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a> != 0) {
00526             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a111">NtUserMoveWindow</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>), 0, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a>, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o4">cxCombo</a>,
00527                 pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o7">cyDrop</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00528 
00529             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a115">NtUserSetWindowPos</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>), HWND_TOP, 0, 0,
00530                 pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o4">cxCombo</a>, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a> +
00531                 pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top,
00532                 SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE);
00533         }
00534     } <span class="keywordflow">else</span> {
00535         <span class="keywordflow">if</span> (pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00536             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a111">NtUserMoveWindow</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>), pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left,
00537                 pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top + pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a>,
00538                 <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o6">cxDrop</a>, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o4">cxCombo</a>), pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o7">cyDrop</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00539         }
00540 
00541         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a115">NtUserSetWindowPos</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>), HWND_TOP, 0, 0,
00542             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o4">cxCombo</a>, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a>,
00543             SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE);
00544     }
00545 
00546     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndList);
00547     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndEdit);
00548 
00549     <span class="keywordflow">return</span> CB_OKAY;
00550 }
00551 
00552 
00553 <span class="comment">/***************************************************************************\</span>
00554 <span class="comment">* xxxCBSizeHandler</span>
00555 <span class="comment">*</span>
00556 <span class="comment">* Recalculates the sizes of the internal controls in response to a</span>
00557 <span class="comment">* resizing of the combo box window.  The app must size the combo box to its</span>
00558 <span class="comment">* maximum open/dropped down size.</span>
00559 <span class="comment">*</span>
00560 <span class="comment">* History:</span>
00561 <span class="comment">\***************************************************************************/</span>
00562 
<a name="l00563"></a><a class="code" href="../../d6/d0/usercli_8h.html#a681">00563</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a681">xxxCBSizeHandler</a>(
00564     <a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> pcbox)
00565 {
00566     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>);
00567 
00568     <span class="comment">/*</span>
00569 <span class="comment">     * Assume listbox is visible since the app should size it to its maximum</span>
00570 <span class="comment">     * visible size.</span>
00571 <span class="comment">     */</span>
00572     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o4">cxCombo</a> = pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00573     <span class="comment">// only recalc cyDrop if the drop down is not TOTALLY nuked by the sizing</span>
00574     <span class="comment">// -- Visio 1.0 -- B#13112</span>
00575     <span class="keywordflow">if</span> (((pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o0">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top) - pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o5">cyCombo</a>) &gt; 0)
00576         pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o7">cyDrop</a> = <a class="code" href="../../d3/d4/comboini_8c.html#a0">RECALC_CYDROP</a>;
00577 
00578     <span class="comment">// Reposition everything.</span>
00579     <a class="code" href="../../d6/d0/usercli_8h.html#a669">xxxCBPosition</a>(pcbox);
00580 }
00581 
00582 <span class="comment">/***************************************************************************\</span>
00583 <span class="comment">*</span>
00584 <span class="comment">*  CBPosition()</span>
00585 <span class="comment">*</span>
00586 <span class="comment">*  Repositions components of edit control.</span>
00587 <span class="comment">*</span>
00588 <span class="comment">\***************************************************************************/</span>
<a name="l00589"></a><a class="code" href="../../d6/d0/usercli_8h.html#a669">00589</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a669">xxxCBPosition</a>(<a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> pcbox)
00590 {
00591     RECT rcList;
00592 
00593     <span class="comment">// Calculate placement of components--button, item, list</span>
00594     <a class="code" href="../../d6/d0/usercli_8h.html#a672">xxxCBCalcControlRects</a>(pcbox, &amp;rcList);
00595 
00596     <span class="keywordflow">if</span> (!pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o21">fNoEdit</a> &amp;&amp; pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>) {
00597         <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndEdit;
00598 
00599         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>, &amp;tlpwndEdit);
00600         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a111">NtUserMoveWindow</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o8">spwndEdit</a>), pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.left, pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.top,
00601             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.right - pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.left,
00602             pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.bottom - pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o2">editrc</a>.top, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00603         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndEdit);
00604     }
00605 
00606     <span class="comment">// Recalculate drop height &amp; width</span>
00607     <a class="code" href="../../d3/d4/comboini_8c.html#a2">xxxCBSetDroppedSize</a>(pcbox, &amp;rcList);
00608 }
00609 
00610 <span class="comment">/***************************************************************************\</span>
00611 <span class="comment">*</span>
00612 <span class="comment">*  CBSetDroppedSize()</span>
00613 <span class="comment">*</span>
00614 <span class="comment">*  Compute the drop down window's width and max height</span>
00615 <span class="comment">*</span>
00616 <span class="comment">\***************************************************************************/</span>
<a name="l00617"></a><a class="code" href="../../d3/d4/comboini_8c.html#a2">00617</a> <span class="keywordtype">void</span> <a class="code" href="../../d3/d4/comboini_8c.html#a2">xxxCBSetDroppedSize</a>(<a class="code" href="../../d7/d9/structtagCBox.html">PCBOX</a> pcbox, LPRECT lprc)
00618 {
00619     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndList;
00620 
00621     pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o15">fLBoxVisible</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00622     <a class="code" href="../../d6/d0/usercli_8h.html#a667">xxxCBHideListBoxWindow</a>(pcbox, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00623 
00624     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>, &amp;tlpwndList);
00625     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a111">NtUserMoveWindow</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pcbox-&gt;<a class="code" href="../../d7/d9/structtagCBox.html#o9">spwndList</a>), lprc-&gt;left, lprc-&gt;top,
00626         lprc-&gt;right - lprc-&gt;left, lprc-&gt;bottom - lprc-&gt;top, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00627     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndList);
00628 
00629 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:32 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
