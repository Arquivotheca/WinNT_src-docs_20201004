<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: i386/ldtsup.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ldtsup.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d5/d2/i386_2ldtsup_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/i386_2ldtsup_8c.html#a0">KiLoadLdtr</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/i386_2ldtsup_8c.html#a1">KiFlushDescriptors</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/i386_2ldtsup_8c.html#a2">Ki386LoadTargetLdtr</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/i386_2ldtsup_8c.html#a3">Ki386FlushTargetDescriptors</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/i386_2ldtsup_8c.html#a4">Ke386SetLdtProcess</a> (IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process, IN PLDT_ENTRY Ldt, IN ULONG Limit)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/i386_2ldtsup_8c.html#a5">Ke386SetDescriptorProcess</a> (IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process, IN ULONG <a class="el" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>, IN LDT_ENTRY LdtEntry)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="i386/ldtsup.c::Ke386SetDescriptorProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID Ke386SetDescriptorProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Offset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LDT_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>LdtEntry</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00255">255</a> of file <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html">i386/ldtsup.c</a>.
<p>
References <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00360">Ki386FlushTargetDescriptors()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l07821">MmLockPagedPool()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l07869">MmUnlockPagedPool()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00033">Offset</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l01235">NtSetLdtEntries()</a>, and <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00503">PspSetLdtInformation()</a>.
<p>
<pre class="fragment"><div>00262                    :
00263 
00264     The specified LdtEntry (which could be 0, not present, etc) will be
00265     edited into the specified Offset in the Ldt of the specified Process.
00266     This will be synchronzied accross all the processors executing the
00267     process.  The edit will take affect on all processors before the call
00268     returns.
00269 
00270     N.B.
00271 
00272     Editing an Ldt descriptor requires stalling all processors active
00273     for the process, to prevent accidental loading of descriptors in
00274     an inconsistent state.
00275 
00276 Arguments:
00277 
00278     Process - Pointer to <a class="code" href="../../d5/d7/struct__KPROCESS.html">KPROCESS</a> object describing the process for
00279         which the descriptor edit is to be performed.
00280 
00281     Offset - Byte offset into the Ldt of the descriptor to edit.
00282         Must be 0 mod 8.
00283 
00284     LdtEntry - Value to edit into the descriptor in hardware format.
00285         No checking is done on the validity of this item.
00286 
00287 Return Value:
00288 
00289     none.
00290 
00291 --*/
00292 
00293 {
00294 
00295     PLDT_ENTRY Ldt;
00296     KIRQL OldIrql;
00297     PKPRCB Prcb;
00298     KAFFINITY TargetProcessors;
00299 
00300     <span class="comment">//</span>
00301     <span class="comment">// Compute address of descriptor to edit.</span>
00302     <span class="comment">//</span>
00303 
00304     Ldt =
00305         (PLDT_ENTRY)
00306          ((Process-&gt;LdtDescriptor.HighWord.Bytes.BaseHi &lt;&lt; 24) |
00307          ((Process-&gt;LdtDescriptor.HighWord.Bytes.BaseMid &lt;&lt; 16) &amp; 0xff0000) |
00308          (Process-&gt;LdtDescriptor.BaseLow &amp; 0xffff));
00309     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> / 8;
00310     <a class="code" href="../../d5/d6/iosup_8c.html#a87">MmLockPagedPool</a>(&amp;Ldt[Offset], <span class="keyword">sizeof</span>(LDT_ENTRY));
00311     <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00312 
00313 <span class="preprocessor">#ifdef NT_UP</span>
00314 <span class="preprocessor"></span>
00315     <span class="comment">//</span>
00316     <span class="comment">// Edit the Ldt.</span>
00317     <span class="comment">//</span>
00318 
00319     Ldt[<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>] = LdtEntry;
00320 
00321 <span class="preprocessor">#else</span>
00322 <span class="preprocessor"></span>
00323     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00324     TargetProcessors = Process-&gt;ActiveProcessors &amp; ~Prcb-&gt;SetMember;
00325     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00326         KiIpiSendSynchronousPacket(
00327             Prcb,
00328             TargetProcessors,
00329             Ki386FlushTargetDescriptors,
00330             (PVOID)&amp;Prcb-&gt;ReverseStall,
00331             NULL,
00332             NULL);
00333 
00334         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00335     }
00336 
00337     <span class="comment">//</span>
00338     <span class="comment">// All target processors have flushed the segment descriptors and</span>
00339     <span class="comment">// are waiting to proceed. Edit the ldt on the current processor,</span>
00340     <span class="comment">// then continue the execution of target processors.</span>
00341     <span class="comment">//</span>
00342 
00343     Ldt[<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>] = LdtEntry;
00344     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00345         Prcb-&gt;ReverseStall += 1;
00346     }
00347 
00348 <span class="preprocessor">#endif</span>
00349 <span class="preprocessor"></span>
00350     <span class="comment">//</span>
00351     <span class="comment">// Restore IRQL and release the context swap lock.</span>
00352     <span class="comment">//</span>
00353 
00354     <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00355     <a class="code" href="../../d5/d6/iosup_8c.html#a88">MmUnlockPagedPool</a>(&amp;Ldt[Offset], <span class="keyword">sizeof</span>(LDT_ENTRY));
00356     <span class="keywordflow">return</span>;
00357 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="i386/ldtsup.c::Ke386SetLdtProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID Ke386SetLdtProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLDT_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>Ldt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Limit</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00063">63</a> of file <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html">i386/ldtsup.c</a>.
<p>
References <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00221">Ki386LoadTargetLdtr()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d4/d3/i386_2ldtsup_8c.html#a0">KiLoadLdtr()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">KiLockContextSwap</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">KiUnlockContextSwap</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l01235">NtSetLdtEntries()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00503">PspSetLdtInformation()</a>, and <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00308">PspSetLdtSize()</a>.
<p>
<pre class="fragment"><div>00070                    :
00071 
00072     The specified LDT (which may be null) will be <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> active Ldt of
00073     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified process, <span class="keywordflow">for</span> all threads thereof, on whichever
00074     processors they are running.  The change will take effect before <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00075     call returns.
00076 
00077     An Ldt address of <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> or a Limit of 0 will cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process to
00078     receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> Ldt.
00079 
00080     This function <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> exists on i386 and i386 compatible processors.
00081 
00082     No checking <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> validity of Ldt entries.
00083 
00084 
00085     N.B.
00086 
00087     While a single Ldt structure can be shared amoung processes, any
00088     edits to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Ldt of one of those processes will <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be <span class="keyword">synchronized</span>
00089     <span class="keywordflow">for</span> that process.  Thus, processes other than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> one <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> change <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00090     applied to may not see <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> change correctly.
00091 
00092 Arguments:
00093 
00094     Process - Pointer to <a class="code" href="../../d5/d7/struct__KPROCESS.html">KPROCESS</a> object describing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process <span class="keywordflow">for</span>
00095         which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Ldt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be set.
00096 
00097     Ldt - Pointer to an array of LDT_ENTRYs (that is, a pointer to an
00098         Ldt.)
00099 
00100     Limit - Ldt limit (must be 0 mod 8)
00101 
00102 Return Value:
00103 
00104     None.
00105 
00106 --*/
00107 
00108 {
00109 
00110     KGDTENTRY LdtDescriptor;
00111     BOOLEAN LocalProcessor;
00112     KIRQL OldIrql;
00113     PKPRCB Prcb;
00114     KAFFINITY TargetProcessors;
00115 
00116     <span class="comment">//</span>
00117     <span class="comment">// Compute the contents of the Ldt descriptor</span>
00118     <span class="comment">//</span>
00119 
00120     if ((Ldt == NULL) || (Limit == 0)) {
00121 
00122         <span class="comment">//</span>
00123         <span class="comment">//  Set up an empty descriptor</span>
00124         <span class="comment">//</span>
00125 
00126         LdtDescriptor.LimitLow = 0;
00127         LdtDescriptor.BaseLow = 0;
00128         LdtDescriptor.HighWord.Bytes.BaseMid = 0;
00129         LdtDescriptor.HighWord.Bytes.Flags1 = 0;
00130         LdtDescriptor.HighWord.Bytes.Flags2 = 0;
00131         LdtDescriptor.HighWord.Bytes.BaseHi = 0;
00132 
00133     } <span class="keywordflow">else</span> {
00134 
00135         <span class="comment">//</span>
00136         <span class="comment">// Insure that the unfilled fields of the selector are zero</span>
00137         <span class="comment">// N.B.  If this is not done, random values appear in the high</span>
00138         <span class="comment">//       portion of the Ldt limit.</span>
00139         <span class="comment">//</span>
00140 
00141         LdtDescriptor.HighWord.Bytes.Flags1 = 0;
00142         LdtDescriptor.HighWord.Bytes.Flags2 = 0;
00143 
00144         <span class="comment">//</span>
00145         <span class="comment">//  Set the limit and base</span>
00146         <span class="comment">//</span>
00147 
00148         LdtDescriptor.LimitLow = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) ((ULONG) Limit - 1);
00149         LdtDescriptor.BaseLow = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)  ((ULONG) Ldt &amp; 0xffff);
00150         LdtDescriptor.HighWord.Bytes.BaseMid = (UCHAR) (((ULONG)Ldt &amp; 0xff0000) &gt;&gt; 16);
00151         LdtDescriptor.HighWord.Bytes.BaseHi =  (UCHAR) (((ULONG)Ldt &amp; 0xff000000) &gt;&gt; 24);
00152 
00153         <span class="comment">//</span>
00154         <span class="comment">//  Type is LDT, DPL = 0</span>
00155         <span class="comment">//</span>
00156 
00157         LdtDescriptor.HighWord.Bits.Type = TYPE_LDT;
00158         LdtDescriptor.HighWord.Bits.Dpl = DPL_SYSTEM;
00159 
00160         <span class="comment">//</span>
00161         <span class="comment">// Make it present</span>
00162         <span class="comment">//</span>
00163 
00164         LdtDescriptor.HighWord.Bits.Pres = 1;
00165 
00166     }
00167 
00168     <span class="comment">//</span>
00169     <span class="comment">// Acquire the context swap lock so a context switch cannot occur.</span>
00170     <span class="comment">//</span>
00171 
00172     <a class="code" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(&amp;OldIrql);
00173 
00174     <span class="comment">//</span>
00175     <span class="comment">// Set the Ldt fields in the process object.</span>
00176     <span class="comment">//</span>
00177 
00178     Process-&gt;LdtDescriptor = LdtDescriptor;
00179 
00180     <span class="comment">//</span>
00181     <span class="comment">// Tell all processors active for this process to reload their LDTs</span>
00182     <span class="comment">//</span>
00183 
00184 <span class="preprocessor">#ifdef NT_UP</span>
00185 <span class="preprocessor"></span>
00186     <a class="code" href="../../d4/d3/i386_2ldtsup_8c.html#a0">KiLoadLdtr</a>();
00187 
00188 <span class="preprocessor">#else</span>
00189 <span class="preprocessor"></span>
00190     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00191     TargetProcessors = Process-&gt;ActiveProcessors &amp; ~Prcb-&gt;SetMember;
00192     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00193         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00194                         Ki386LoadTargetLdtr,
00195                         NULL,
00196                         NULL,
00197                         NULL);
00198     }
00199 
00200     <a class="code" href="../../d4/d3/i386_2ldtsup_8c.html#a0">KiLoadLdtr</a>();
00201     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00202 
00203         <span class="comment">//</span>
00204         <span class="comment">//  Stall until target processor(s) release us</span>
00205         <span class="comment">//</span>
00206 
00207         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00208     }
00209 
00210 <span class="preprocessor">#endif</span>
00211 <span class="preprocessor"></span>
00212     <span class="comment">//</span>
00213     <span class="comment">// Restore IRQL and release the context swap lock.</span>
00214     <span class="comment">//</span>
00215 
00216     <a class="code" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql);
00217     <span class="keywordflow">return</span>;
00218 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="i386/ldtsup.c::Ki386FlushTargetDescriptors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID Ki386FlushTargetDescriptors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00360">360</a> of file <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html">i386/ldtsup.c</a>.
<p>
References <a class="el" href="../../d4/d3/i386_2ldtsup_8c.html#a1">KiFlushDescriptors()</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00255">Ke386SetDescriptorProcess()</a>.
<p>
<pre class="fragment"><div>00369                    :
00370 
00371     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> segment descriptors on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current processor.
00372 
00373 Arguments:
00374 
00375     Argument - pointer to a _KIPI_FLUSH_DESCRIPTOR structure.
00376 
00377     ReadyFlag - pointer to flag to syncroize with
00378 
00379 Return Value:
00380 
00381     none.
00382 
00383 --*/
00384 
00385 {
00386     <span class="comment">//</span>
00387     <span class="comment">// Flush the segment descriptors on the current processor and signal that</span>
00388     <span class="comment">// the descriptors have been flushed.</span>
00389     <span class="comment">//</span>
00390 
00391     <a class="code" href="../../d4/d3/i386_2ldtsup_8c.html#a1">KiFlushDescriptors</a>();
00392     KiIpiSignalPacketDoneAndStall (SignalDone, Proceed);
00393     <span class="keywordflow">return</span>;
00394 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="i386/ldtsup.c::Ki386LoadTargetLdtr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID Ki386LoadTargetLdtr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00221">221</a> of file <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html">i386/ldtsup.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>, and <a class="el" href="../../d4/d3/i386_2ldtsup_8c.html#a0">KiLoadLdtr()</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00063">Ke386SetLdtProcess()</a>.
<p>
<pre class="fragment"><div>00229                    :
00230 
00231     Reload local Ldt <span class="keyword">register</span> and clear signal bit in TargetProcessor mask
00232 
00233 Arguments:
00234 
00235     Argument - pointer to a ipi packet structure.
00236     ReadyFlag - Pointer to flag to be set once LDTR has been reloaded
00237 
00238 Return Value:
00239 
00240     none.
00241 
00242 --*/
00243 {
00244 
00245     <span class="comment">//</span>
00246     <span class="comment">// Reload the LDTR register from currently active process object</span>
00247     <span class="comment">//</span>
00248 
00249     <a class="code" href="../../d4/d3/i386_2ldtsup_8c.html#a0">KiLoadLdtr</a>();
00250     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00251     <span class="keywordflow">return</span>;
00252 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="i386/ldtsup.c::KiFlushDescriptors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushDescriptors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00360">Ki386FlushTargetDescriptors()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="i386/ldtsup.c::KiLoadLdtr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiLoadLdtr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00063">Ke386SetLdtProcess()</a>, and <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00221">Ki386LoadTargetLdtr()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:32 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
