<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: tpalette.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>tpalette.c</h1><a href="../../d3/d4/tpalette_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*</span>
00002 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00003 <span class="comment">*/</span>
00004 
00005 <span class="preprocessor">#include &lt;windows.h&gt;</span>
00006 <span class="preprocessor">#include &lt;string.h&gt;</span>
00007 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00008 <span class="preprocessor">#include "..\..\inc\conapi.h"</span>
<a name="l00009"></a><a class="code" href="../../d3/d4/tpalette_8c.html#a0">00009</a> <span class="preprocessor">#define FOREGROUND_WHITE (FOREGROUND_BLUE | FOREGROUND_GREEN | FOREGROUND_RED)</span>
00010 <span class="preprocessor"></span>
00011 
00012 
<a name="l00013"></a><a class="code" href="../../d3/d4/tpalette_8c.html#a1">00013</a> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d3/d4/tpalette_8c.html#a1">MyPalette</a>[64] =
00014        { 0,   0,   0x80,0 ,       <span class="comment">// 1</span>
00015          0,   0x80,0,   0 ,       <span class="comment">// 2</span>
00016          0,   0,   0,   0 ,       <span class="comment">// 0</span>
00017          0,   0x80,0x80,0 ,       <span class="comment">// 3</span>
00018          0x80,0,   0,   0 ,       <span class="comment">// 4</span>
00019          0x80,0,   0x80,0 ,       <span class="comment">// 5</span>
00020          0x80,0x80,0,   0 ,       <span class="comment">// 6</span>
00021          0xC0,0xC0,0xC0,0 ,       <span class="comment">// 7</span>
00022          0x80,0x80,0x80,0 ,       <span class="comment">// 8</span>
00023          0,   0,   0xFF,0 ,       <span class="comment">// 9</span>
00024          0,   0xFF,0,   0 ,       <span class="comment">// 10</span>
00025          0,   0xFF,0xFF,0 ,       <span class="comment">// 11</span>
00026          0xFF,0,   0,   0 ,       <span class="comment">// 12</span>
00027          0xFF,0,   0xFF,0 ,       <span class="comment">// 13</span>
00028          0xFF,0xFF,0,   0 ,       <span class="comment">// 14</span>
00029          0xFF,0xFF,0xFF,0 };      <span class="comment">// 15</span>
00030 
00031 
00032 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00033"></a><a class="code" href="../../d3/d4/tpalette_8c.html#a2">00033</a> <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(
00034     <span class="keywordtype">int</span> argc,
00035     <span class="keywordtype">char</span> *argv[]
00036     )
00037 {
00038     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success;
00039     <span class="keywordtype">int</span> i;
00040     HPALETTE hPalette;
00041     LOGPALETTE *Palette;
00042     HANDLE hgo;
00043     CONSOLE_GRAPHICS_BUFFER_INFO cgbi;
00044 
00045     Palette = LocalAlloc(LMEM_FIXED,
00046                     <span class="keyword">sizeof</span>(LOGPALETTE) + 256 * <span class="keyword">sizeof</span>(PALETTEENTRY));
00047 
00048     Palette-&gt;palNumEntries = (WORD) 256;
00049     Palette-&gt;palVersion    = 0x300;
00050 
00051     <span class="comment">/* Fill in the palette entries from the DIB color table and</span>
00052 <span class="comment">     * create a logical color palette.</span>
00053 <span class="comment">     */</span>
00054 
00055     <span class="keywordflow">for</span> (i = 0; i &lt; 256; i++) {
00056         Palette-&gt;palPalEntry[i].peRed   = 255-i;
00057         Palette-&gt;palPalEntry[i].peGreen = 255-i;
00058         Palette-&gt;palPalEntry[i].peBlue  = 255-i;
00059         Palette-&gt;palPalEntry[i].peFlags = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)0;
00060     }
00061 
00062     hPalette = CreatePalette(Palette);
00063     <span class="keywordflow">if</span> (hPalette==<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00064         printf(<span class="stringliteral">"first CreatePalette failed\n"</span>);
00065         printf(<span class="stringliteral">"last error is %x\n"</span>,GetLastError());
00066     }
00067 
00068 <span class="preprocessor">#if 0</span>
00069 <span class="preprocessor"></span>call
00070 HANDLE
00071 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
00072 <a class="code" href="../../d3/d6/iostubs_8c.html#a30">CreateConsoleScreenBuffer</a>(
00073     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDesiredAccess,
00074     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwShareMode,
00075     <a class="code" href="../../d6/d1/userrtl_8h.html#a30">LPSECURITY_ATTRIBUTES</a> lpSecurityAttributes,
00076     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>,  == <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>
00077     PVOID lpScreenBufferData == pCONSOLE_GRAPHICS_BUFFER_INFO
00078     );
00079 <span class="keyword">typedef</span> <span class="keyword">struct </span>_CONSOLE_GRAPHICS_BUFFER_INFO {
00080     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwBitMapInfoLength;
00081     LPBITMAPINFO lpBitMapInfo;
00082     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwUsage;
00083     HANDLE hMutex;
00084     PVOID lpBitMap;
00085 } CONSOLE_GRAPHICS_BUFFER_INFO, *PCONSOLE_GRAPHICS_BUFFER_INFO;
00086 
00087 
00088 <span class="preprocessor">#define CONSOLE_GRAPHICS_BUFFER  2</span>
00089 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00090 <span class="preprocessor"></span>    hgo = <a class="code" href="../../d3/d6/iostubs_8c.html#a30">CreateConsoleScreenBuffer</a>(MAXIMUM_ALLOWED, 0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00091             <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>, &amp;cgbi);
00092     <span class="keywordflow">if</span> (hgo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00093         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CreateConsoleScreenBuffer failed\n"</span>);
00094         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00095     }
00096     Success = <a class="code" href="../../d6/d4/client_2private_8c.html#a13">SetConsolePalette</a>(hgo,
00097                                 hPalette,
00098                                 SYSPAL_NOSTATIC
00099                                );
00100     <span class="keywordflow">if</span> (!Success) {
00101         printf(<span class="stringliteral">"first SetConsolePalette failed\n"</span>);
00102     }
00103     printf(<span class="stringliteral">"palette should be different\n"</span>);
00104     Sleep(5000);
00105     DeleteObject(hPalette);
00106 
00107     <span class="comment">/* Fill in the palette entries from the DIB color table and</span>
00108 <span class="comment">     * create a logical color palette.</span>
00109 <span class="comment">     */</span>
00110 
00111     <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) {
00112         memcpy(&amp;Palette-&gt;palPalEntry[i],
00113                <a class="code" href="../../d3/d4/tpalette_8c.html#a1">MyPalette</a>,
00114                64
00115               );
00116     }
00117 
00118     hPalette = CreatePalette(Palette);
00119     <span class="keywordflow">if</span> (hPalette==<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00120         printf(<span class="stringliteral">"first CreatePalette failed\n"</span>);
00121     }
00122 
00123     Success = <a class="code" href="../../d6/d4/client_2private_8c.html#a13">SetConsolePalette</a>(hgo,
00124                                 hPalette,
00125                                 SYSPAL_STATIC
00126                                );
00127     <span class="keywordflow">if</span> (!Success) {
00128         printf(<span class="stringliteral">"second SetConsolePalette failed\n"</span>);
00129     }
00130     printf(<span class="stringliteral">"palette should be different\n"</span>);
00131     Sleep(5000);
00132     DeleteObject(hPalette);
00133 
00134     printf( <span class="stringliteral">"TCURSOR: Exiting Test Program\n"</span> );
00135     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00136 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:02 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
