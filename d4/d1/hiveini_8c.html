<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: hiveini.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>hiveini.c File Reference</h1><code>#include "<a class="el" href="../../d6/d6/regutil_8h-source.html">regutil.h</a>"</code><br>
<code>#include "<a class="el" href="../../d1/d4/edithive_8h-source.html">edithive.h</a>"</code><br>

<p>
<a href="../../d5/d0/hiveini_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/struct__KEY__INFO.html">_KEY_INFO</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d1/hiveini_8c.html#a0">MAX_KEY_DEPTH</a>&nbsp;&nbsp;&nbsp;64</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d6/struct__KEY__INFO.html">_KEY_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d1/hiveini_8c.html#a3">KEY_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d6/struct__KEY__INFO.html">_KEY_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d1/hiveini_8c.html#a4">PKEY_INFO</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d1/hiveini_8c.html#a5">RiInitializeRegistryFromAsciiFile</a> (IN PUNICODE_STRING HiveName, IN PUNICODE_STRING <a class="el" href="../../d8/d1/hivestat_8c.html#a9">FileName</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d1/hiveini_8c.html#a6">Usage</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int __cdecl&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d1/hiveini_8c.html#a7">main</a> (int argc, argv)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d1/hiveini_8c.html#a1">OldValueBuffer</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d1/hiveini_8c.html#a2">OldValueBufferSize</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="hiveini.c::MAX_KEY_DEPTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_KEY_DEPTH&nbsp;&nbsp;&nbsp;64          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00028">28</a> of file <a class="el" href="../../d5/d0/hiveini_8c-source.html">hiveini.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a3" doxytag="hiveini.c::KEY_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d6/struct__KEY__INFO.html">_KEY_INFO</a>  <a class="el" href="../../d4/d6/struct__KEY__INFO.html">KEY_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="hiveini.c::PKEY_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d6/struct__KEY__INFO.html">_KEY_INFO</a> * <a class="el" href="../../d4/d6/struct__KEY__INFO.html">PKEY_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a7" doxytag="hiveini.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int __cdecl main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>argv&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00333">333</a> of file <a class="el" href="../../d5/d0/hiveini_8c-source.html">hiveini.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d6/d6/regutil_8h-source.html#l00066">DebugOutput</a>, <a class="el" href="../../d0/d1/fedefs_8h-source.html#l00051">exit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d1/rtload_8c-source.html#l00047">FileName</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00017">OldValueBuffer</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00018">OldValueBufferSize</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00045">RegInitialize()</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d6/d0/curdir_8c-source.html#l01717">RtlDosPathNameToNtPathName_U()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00102">RtlInitAnsiString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d0/hivedmp_8c-source.html#l00066">Usage()</a>, and <a class="el" href="../../d6/d6/regutil_8h-source.html#l00039">VALUE_BUFFER_SIZE</a>.
<p>
<pre class="fragment"><div>00336 {
00337     <span class="keywordtype">int</span> i;
00338     <span class="keywordtype">char</span> *s;
00339     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00340     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> FileArgumentSeen;
00341     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> HiveArgumentSeen=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00342     ANSI_STRING AnsiString;
00343     UNICODE_STRING DosFileName;
00344     UNICODE_STRING <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>;
00345     UNICODE_STRING DosHiveName;
00346     UNICODE_STRING HiveName;
00347 
00348     <a class="code" href="../../d4/d1/hiveini_8c.html#a2">OldValueBufferSize</a> = <a class="code" href="../../d5/d7/regutil_8h.html#a0">VALUE_BUFFER_SIZE</a>;
00349     <a class="code" href="../../d4/d1/hiveini_8c.html#a1">OldValueBuffer</a> = VirtualAlloc( NULL, OldValueBufferSize, MEM_COMMIT, PAGE_READWRITE );
00350     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/hiveini_8c.html#a1">OldValueBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00351         fprintf( stderr, <span class="stringliteral">"HIVEINI: Unable to allocate value buffer.\n"</span> );
00352         <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>( 1 );
00353         }
00354 
00355     <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a22">RegInitialize</a>();
00356 
00357     FileArgumentSeen = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00358     HiveName.Length = HiveName.MaximumLength = 0;
00359     HiveName.Buffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00360     <span class="keywordflow">for</span> (i=1; i&lt;argc; i++) {
00361         s = argv[ i ];
00362         <span class="keywordflow">if</span> (*s == <span class="charliteral">'-'</span> || *s == <span class="charliteral">'/'</span>) {
00363             <span class="keywordflow">while</span> (*++s) {
00364                 <span class="keywordflow">switch</span>( tolower( *s ) ) {
00365                     <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00366                         <a class="code" href="../../d5/d7/regutil_8h.html#a3">DebugOutput</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00367                         <span class="keywordflow">break</span>;
00368 
00369                     <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
00370                         <span class="keywordflow">if</span> (++i &lt; argc) {
00371                             <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;AnsiString, argv[i]);
00372                             <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>( &amp;DosHiveName,
00373                                                           &amp;AnsiString,
00374                                                           TRUE );
00375                             <a class="code" href="../../d5/d1/curdir_8c.html#a29">RtlDosPathNameToNtPathName_U</a>( DosHiveName.Buffer,
00376                                                           &amp;HiveName,
00377                                                           NULL,
00378                                                           NULL );
00379                             <span class="keywordflow">break</span>;
00380                         }
00381 
00382                     <span class="keywordflow">default</span>:    <a class="code" href="../../d1/d1/hivedmp_8c.html#a6">Usage</a>();
00383                     }
00384                 }
00385             }
00386         <span class="keywordflow">else</span> {
00387             FileArgumentSeen = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00388             <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>( &amp;AnsiString, s );
00389             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>( &amp;DosFileName, &amp;AnsiString, TRUE );
00390             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00391                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/curdir_8c.html#a29">RtlDosPathNameToNtPathName_U</a>( DosFileName.Buffer,
00392                                                   &amp;FileName,
00393                                                   NULL,
00394                                                   NULL
00395                                                 )
00396                    ) {
00397                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/hiveini_8c.html#a5">RiInitializeRegistryFromAsciiFile</a>( &amp;HiveName,
00398                                                                 &amp;FileName );
00399                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00400                         fprintf( stderr,
00401                                  <span class="stringliteral">"HIVEINI: Failed to load from %wZ - Status == %lx\n"</span>,
00402                                  &amp;FileName,
00403                                  Status
00404                            );
00405                         }
00406                     }
00407                 <span class="keywordflow">else</span> {
00408                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00409                     fprintf( stderr,
00410                              <span class="stringliteral">"HIVEINI: Unable to map Dos Name (%wZ) to NT name\n"</span>,
00411                              &amp;DosFileName
00412                        );
00413                     }
00414                 }
00415             <span class="keywordflow">else</span> {
00416                 fprintf( stderr,
00417                          <span class="stringliteral">"HIVEINI: Unable to convert %s to unicode - Status == %lx\n"</span>,
00418                          &amp;AnsiString,
00419                          Status
00420                        );
00421                 }
00422             }
00423         }
00424 
00425     <span class="keywordflow">if</span> (!FileArgumentSeen) {
00426         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;FileName, L<span class="stringliteral">"\\SystemRoot\\System32\\Config\\registry.sys"</span> );
00427         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/hiveini_8c.html#a5">RiInitializeRegistryFromAsciiFile</a>( &amp;HiveName,
00428                                                     &amp;FileName );
00429         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00430             fprintf( stderr,
00431                      <span class="stringliteral">"HIVEINI: Failed to load from %wZ - Status == %lx\n"</span>,
00432                      &amp;FileName,
00433                      Status
00434                    );
00435             }
00436         <span class="keywordflow">else</span> {
00437             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;FileName, L<span class="stringliteral">"\\SystemRoot\\System32\\Config\\registry.usr"</span> );
00438             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/hiveini_8c.html#a5">RiInitializeRegistryFromAsciiFile</a>( &amp;HiveName,
00439                                                         &amp;FileName );
00440             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00441                 fprintf( stderr,
00442                          <span class="stringliteral">"HIVEINI: Failed to load from %wZ - Status == %lx\n"</span>,
00443                          &amp;FileName,
00444                          Status
00445                        );
00446                 }
00447             }
00448         }
00449 
00450     <span class="keywordflow">return</span>( 0 );
00451 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="hiveini.c::RiInitializeRegistryFromAsciiFile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RiInitializeRegistryFromAsciiFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>HiveName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>FileName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">31</a> of file <a class="el" href="../../d5/d0/hiveini_8c-source.html">hiveini.c</a>.
<p>
References <a class="el" href="../../d6/d6/regutil_8h-source.html#l00048">_REG_UNICODE_FILE::BeginLine</a>, <a class="el" href="../../d6/d6/regutil_8h-source.html#l00066">DebugOutput</a>, <a class="el" href="../../d0/d4/edithive_8c-source.html#l00124">EhCloseHive()</a>, <a class="el" href="../../d0/d4/edithive_8c-source.html#l00625">EhCreateChild()</a>, <a class="el" href="../../d0/d4/edithive_8c-source.html#l00943">EhDeleteValueKey()</a>, <a class="el" href="../../d0/d5/edithive_8h.html#a3">EhOpenHive()</a>, <a class="el" href="../../d0/d4/edithive_8c-source.html#l00785">EhQueryKey()</a>, <a class="el" href="../../d0/d4/edithive_8c-source.html#l00871">EhQueryValueKey()</a>, <a class="el" href="../../d0/d4/edithive_8c-source.html#l00515">EhSetValueKey()</a>, <a class="el" href="../../d6/d6/regutil_8h-source.html#l00049">_REG_UNICODE_FILE::EndOfLine</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d1/rtload_8c-source.html#l00047">FileName</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00024">_KEY_INFO::Handle</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00109">HCELL_NIL</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00021">_KEY_INFO::IndentAmount</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00058">KeyPath</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d6/regutil_8h-source.html#l00045">_REG_UNICODE_FILE::LastWriteTime</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00025">_KEY_INFO::LastWriteTime</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00028">MAX_KEY_DEPTH</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00022">_KEY_INFO::Name</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00017">OldValueBuffer</a>, <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00018">OldValueBufferSize</a>, <a class="el" href="../../d4/d1/hiveini_8c.html#a4">PKEY_INFO</a>, <a class="el" href="../../d5/d7/regutil_8h.html#a1">REG_UNICODE_FILE</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l01096">RegGetKeyValue()</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00473">RegGetNextLine()</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00259">RegLoadAsciiFileAsUnicode()</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d4/edithive_8h-source.html#l00026">TYPE_SIMPLE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d2/d0/hivedmp_8c-source.html#l00060">ValueBuffer</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00333">main()</a>.
<p>
<pre class="fragment"><div>00035 {
00036     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00037     <a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html">REG_UNICODE_FILE</a> UnicodeFile;
00038     PWSTR EndKey, FirstEqual, BeginValue;
00039     ULONG IndentAmount;
00040     UNICODE_STRING InputLine;
00041     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00042     UNICODE_STRING KeyValue;
00043     PKEY_VALUE_FULL_INFORMATION OldValueInformation;
00044     PKEY_BASIC_INFORMATION KeyInformation;
00045     UCHAR KeyInformationBuffer[ 512 ];
00046     ULONG ResultLength;
00047     ULONG OldValueLength;
00048     PVOID <a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>;
00049     ULONG ValueLength;
00050     ULONG ValueType;
00051     <a class="code" href="../../d4/d6/struct__KEY__INFO.html">KEY_INFO</a> <a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>[ <a class="code" href="../../d4/d1/hiveini_8c.html#a0">MAX_KEY_DEPTH</a> ];
00052     <a class="code" href="../../d4/d6/struct__KEY__INFO.html">PKEY_INFO</a> CurrentKey;
00053     ULONG KeyPathLength;
00054     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00055     UNICODE_STRING Class;
00056     ULONG Disposition;
00057     BOOLEAN UpdateKeyValue;
00058     ULONG i;
00059     HANDLE HiveHandle;
00060     HANDLE RootKey;
00061     UNICODE_STRING RootName;
00062 
00063     HiveHandle = <a class="code" href="../../d0/d5/edithive_8h.html#a3">EhOpenHive</a>(HiveName,
00064                             &amp;KeyPath[0].Handle,
00065                             &amp;KeyPath[0].Name,
00066                             TYPE_SIMPLE);
00067     <span class="keywordflow">if</span> (HiveHandle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00068         <span class="keywordflow">return</span>(STATUS_OBJECT_PATH_NOT_FOUND);
00069     }
00070     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>[0].Handle = (HANDLE)<a class="code" href="../../d0/d1/hivedata_8h.html#a6">HCELL_NIL</a>;
00071 
00072     OldValueInformation = (PKEY_VALUE_FULL_INFORMATION)<a class="code" href="../../d4/d1/hiveini_8c.html#a1">OldValueBuffer</a>;
00073     Class.Buffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00074     Class.Length = 0;
00075 
00076     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d7/regutil_8h.html#a7">RegLoadAsciiFileAsUnicode</a>( FileName,
00077                                         &amp;UnicodeFile
00078                                       );
00079     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00080         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00081         }
00082 
00083     KeyPathLength = 0;
00084     <span class="keywordflow">while</span> (<a class="code" href="../../d5/d7/regutil_8h.html#a8">RegGetNextLine</a>( &amp;UnicodeFile, &amp;IndentAmount, &amp;FirstEqual )) {
00085 <span class="preprocessor">#if 0</span>
00086 <span class="preprocessor"></span>        InputLine.Buffer = UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o3">BeginLine</a>;
00087         InputLine.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((PCHAR)UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o4">EndOfLine</a> - (PCHAR)UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o3">BeginLine</a>);
00088         InputLine.MaximumLength = InputLine.Length;
00089         printf( <span class="stringliteral">"GetNextLine: (%02u) '%wZ'\n"</span>, IndentAmount, &amp;InputLine );
00090 <span class="preprocessor">#endif</span>
00091 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (FirstEqual == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00092             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Buffer = UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o3">BeginLine</a>;
00093             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((PCHAR)UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o4">EndOfLine</a> - (PCHAR)<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Buffer);
00094             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length + 1);
00095 
00096 <span class="preprocessor">#if 0</span>
00097 <span class="preprocessor"></span>            printf( <span class="stringliteral">"%02u %04u  KeyName: %wZ\n"</span>, KeyPathLength, IndentAmount, &amp;KeyName );
00098 <span class="preprocessor">#endif</span>
00099 <span class="preprocessor"></span>            CurrentKey = &amp;<a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>[ KeyPathLength ];
00100             <span class="keywordflow">if</span> (KeyPathLength == 0 ||
00101                 IndentAmount &gt; CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o0">IndentAmount</a>
00102                ) {
00103                 <span class="keywordflow">if</span> (KeyPathLength == <a class="code" href="../../d4/d1/hiveini_8c.html#a0">MAX_KEY_DEPTH</a>) {
00104                     fprintf( stderr,
00105                              <span class="stringliteral">"HIVEINI: %wZ key exceeded maximum depth (%u) of tree.\n"</span>,
00106                              &amp;KeyName,
00107                              MAX_KEY_DEPTH
00108                            );
00109 
00110                     <span class="keywordflow">return</span>( STATUS_UNSUCCESSFUL );
00111                     }
00112                 KeyPathLength++;
00113                 CurrentKey++;
00114                 }
00115             <span class="keywordflow">else</span> {
00116                 <span class="keywordflow">do</span> {
00117                     CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o3">Handle</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00118                     <span class="keywordflow">if</span> (IndentAmount == CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o0">IndentAmount</a>) {
00119                         <span class="keywordflow">break</span>;
00120                         }
00121                     CurrentKey--;
00122                     <span class="keywordflow">if</span> (--KeyPathLength == 1) {
00123                         <span class="keywordflow">break</span>;
00124                         }
00125                     }
00126                 <span class="keywordflow">while</span> (IndentAmount &lt;= CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o0">IndentAmount</a>);
00127                 }
00128 
00129 <span class="preprocessor">#if 0</span>
00130 <span class="preprocessor"></span>            printf( <span class="stringliteral">"  (%02u)\n"</span>, KeyPathLength );
00131 <span class="preprocessor">#endif</span>
00132 <span class="preprocessor"></span>            CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o1">Name</a> = <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00133             CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o0">IndentAmount</a> = IndentAmount;
00134             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/edithive_8h.html#a8">EhCreateChild</a>(HiveHandle,
00135                                    KeyPath[ KeyPathLength-1 ].Handle,
00136                                    &amp;KeyName,
00137                                    &amp;CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o3">Handle</a>,
00138                                    &amp;Disposition);
00139 
00140             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00141                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/regutil_8h.html#a3">DebugOutput</a>) {
00142                     fprintf( stderr, <span class="stringliteral">"    Created key %02x %wZ (%08x)\n"</span>,
00143                                      CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o0">IndentAmount</a>,
00144                                      &amp;CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o1">Name</a>,
00145                                      CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o3">Handle</a>
00146                            );
00147                     }
00148                 KeyInformation = (PKEY_BASIC_INFORMATION)KeyInformationBuffer;
00149                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/edithive_8h.html#a9">EhQueryKey</a>( HiveHandle,
00150                                      CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o3">Handle</a>,
00151                                      KeyBasicInformation,
00152                                      KeyInformation,
00153                                      <span class="keyword">sizeof</span>( KeyInformationBuffer ),
00154                                      &amp;ResultLength
00155                                    );
00156                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00157                     CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o4">LastWriteTime</a> = KeyInformation-&gt;LastWriteTime;
00158                     }
00159                 <span class="keywordflow">else</span> {
00160                     RtlZeroMemory( &amp;CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o4">LastWriteTime</a>,
00161                                    <span class="keyword">sizeof</span>( CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o4">LastWriteTime</a> )
00162                                  );
00163 
00164                     }
00165 
00166                 <span class="keywordflow">if</span> (Disposition == REG_CREATED_NEW_KEY) {
00167                     printf( <span class="stringliteral">"Created Key: "</span> );
00168                     <span class="keywordflow">for</span> (i=0; i&lt;KeyPathLength; i++) {
00169                         printf( <span class="stringliteral">"%wZ\\"</span>, &amp;KeyPath[ i ].Name );
00170                         }
00171                     printf( <span class="stringliteral">"%wZ\n"</span>, &amp;KeyName );
00172                     }
00173                 }
00174             <span class="keywordflow">else</span> {
00175                 fprintf( stderr,
00176                          <span class="stringliteral">"HIVEINI: CreateKey (%wZ) relative to handle (%lx) failed - %lx\n"</span>,
00177                          &amp;KeyName,
00178                          <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.RootDirectory,
00179                          Status
00180                        );
00181                 }
00182             }
00183         <span class="keywordflow">else</span> {
00184             <span class="keywordflow">if</span> (FirstEqual == UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o3">BeginLine</a>) {
00185                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Buffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00186                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length = 0;
00187                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.MaximumLength = 0;
00188                 }
00189             <span class="keywordflow">else</span> {
00190                 EndKey = FirstEqual;
00191                 <span class="keywordflow">while</span> (EndKey &gt; UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o3">BeginLine</a> &amp;&amp; EndKey[ -1 ] &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00192                     EndKey--;
00193                     }
00194                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Buffer = UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o3">BeginLine</a>;
00195                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((PCHAR)EndKey - (PCHAR)<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Buffer);
00196                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length + 1);
00197                 }
00198 
00199             BeginValue = FirstEqual + 1;
00200             <span class="keywordflow">while</span> (BeginValue &lt; UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o4">EndOfLine</a> &amp;&amp; *BeginValue &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00201                 BeginValue++;
00202                 }
00203             KeyValue.Buffer = BeginValue;
00204             KeyValue.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((PCHAR)UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o4">EndOfLine</a> - (PCHAR)BeginValue);
00205             KeyValue.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(KeyValue.Length + 1);
00206 
00207             <span class="keywordflow">while</span> (IndentAmount &lt;= CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o0">IndentAmount</a>) {
00208                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/regutil_8h.html#a3">DebugOutput</a>) {
00209                     fprintf( stderr, <span class="stringliteral">"    Popping from key %02x %wZ (%08x)\n"</span>,
00210                                      CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o0">IndentAmount</a>,
00211                                      &amp;CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o1">Name</a>,
00212                                      CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o3">Handle</a>
00213                            );
00214                     }
00215                 CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o3">Handle</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00216                 CurrentKey--;
00217                 <span class="keywordflow">if</span> (--KeyPathLength == 1) {
00218                     <span class="keywordflow">break</span>;
00219                     }
00220                 }
00221             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/regutil_8h.html#a3">DebugOutput</a>) {
00222                 fprintf( stderr, <span class="stringliteral">"    Adding value '%wZ = %wZ' to key %02x %wZ (%08x)\n"</span>,
00223                                  &amp;KeyName,
00224                                  &amp;KeyValue,
00225                                  CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o0">IndentAmount</a>,
00226                                  &amp;CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o1">Name</a>,
00227                                  CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o3">Handle</a>
00228                        );
00229                 }
00230 
00231             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/regutil_8h.html#a9">RegGetKeyValue</a>( &amp;KeyValue,
00232                                 &amp;UnicodeFile,
00233                                 &amp;ValueType,
00234                                 &amp;ValueBuffer,
00235                                 &amp;ValueLength
00236                               )
00237                ) {
00238                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00239                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/edithive_8h.html#a12">EhDeleteValueKey</a>( HiveHandle,
00240                                                KeyPath[ KeyPathLength+1 ].Handle,
00241                                                &amp;KeyValue
00242                                              );
00243                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00244                         printf( <span class="stringliteral">"Delete value for Key: "</span> );
00245                         <span class="keywordflow">for</span> (i=0; i&lt;KeyPathLength; i++) {
00246                             printf( <span class="stringliteral">"%wZ\\"</span>, &amp;KeyPath[ i ].Name );
00247                             }
00248                         printf( <span class="stringliteral">"%wZ\n"</span>, &amp;KeyName );
00249                         }
00250                     }
00251                 <span class="keywordflow">else</span> {
00252                     <span class="keywordflow">if</span> ( UnicodeFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o0">LastWriteTime</a>.QuadPart &gt;
00253                          CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o4">LastWriteTime</a>.QuadPart
00254                        ) {
00255                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00256                         UpdateKeyValue = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00257                         }
00258                     <span class="keywordflow">else</span> {
00259                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/edithive_8h.html#a10">EhQueryValueKey</a>( HiveHandle,
00260                                                   CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o3">Handle</a>,
00261                                                   &amp;KeyName,
00262                                                   KeyValueFullInformation,
00263                                                   OldValueInformation,
00264                                                   OldValueBufferSize,
00265                                                   &amp;OldValueLength
00266                                                 );
00267                         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00268                             UpdateKeyValue = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00269                             }
00270                         <span class="keywordflow">else</span> {
00271                             UpdateKeyValue = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00272                             }
00273                         }
00274 
00275                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) ||
00276                         OldValueInformation-&gt;Type != ValueType ||
00277                         OldValueInformation-&gt;DataLength != ValueLength ||
00278                         !RtlEqualMemory( (PCHAR)OldValueInformation +
00279                                             OldValueInformation-&gt;DataOffset,
00280                                           ValueBuffer,
00281                                           ValueLength )
00282                        ) {
00283 
00284                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/edithive_8h.html#a11">EhSetValueKey</a>( HiveHandle,
00285                                                 CurrentKey-&gt;<a class="code" href="../../d4/d6/struct__KEY__INFO.html#o3">Handle</a>,
00286                                                 &amp;KeyName,
00287                                                 0,
00288                                                 ValueType,
00289                                                 ValueBuffer,
00290                                                 ValueLength
00291                                               );
00292                         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00293                             printf( <span class="stringliteral">"%s value for Key: "</span>,
00294                                     UpdateKeyValue ? <span class="stringliteral">"Updated"</span> : <span class="stringliteral">"Created"</span>
00295                                   );
00296                             <span class="keywordflow">for</span> (i=1; i&lt;=KeyPathLength; i++) {
00297                                 printf( <span class="stringliteral">"%wZ\\"</span>, &amp;KeyPath[ i ].Name );
00298                                 }
00299 
00300                             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length) {
00301                                 printf( <span class="stringliteral">"%wZ "</span>, &amp;KeyName );
00302                                 }
00303                             printf( <span class="stringliteral">"= '%wZ'\n"</span>, &amp;KeyValue );
00304                             }
00305                         <span class="keywordflow">else</span> {
00306                             fprintf( stderr,
00307                                      <span class="stringliteral">"HIVEINI: SetValueKey (%wZ) failed - %lx\n"</span>,
00308                                      &amp;KeyName,
00309                                      Status
00310                                    );
00311                             }
00312                         }
00313 
00314                     <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, ValueBuffer );
00315                     }
00316                 }
00317             <span class="keywordflow">else</span> {
00318                 fprintf( stderr,
00319                          <span class="stringliteral">"HIVEINI: Invalid key (%wZ) value (%wZ)\n"</span>, &amp;KeyName,
00320                          &amp;KeyValue
00321                        );
00322                 }
00323             }
00324         }
00325 
00326         <a class="code" href="../../d0/d5/edithive_8h.html#a4">EhCloseHive</a>(HiveHandle);
00327 
00328     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00329 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="hiveini.c::Usage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void Usage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00011">11</a> of file <a class="el" href="../../d5/d0/hiveini_8c-source.html">hiveini.c</a>.
<p>
References <a class="el" href="../../d0/d1/fedefs_8h-source.html#l00051">exit</a>.
<p>
<pre class="fragment"><div>00012 {
00013     fprintf( stderr, <span class="stringliteral">"usage: HIVEINI -f hivefile [files...]\n"</span> );
00014     <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>( 1 );
00015 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a1" doxytag="hiveini.c::OldValueBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d4/d1/hiveini_8c.html#a1">OldValueBuffer</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00017">17</a> of file <a class="el" href="../../d5/d0/hiveini_8c-source.html">hiveini.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00333">main()</a>, and <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="hiveini.c::OldValueBufferSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d4/d1/hiveini_8c.html#a2">OldValueBufferSize</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00018">18</a> of file <a class="el" href="../../d5/d0/hiveini_8c-source.html">hiveini.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00333">main()</a>, and <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:05 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
