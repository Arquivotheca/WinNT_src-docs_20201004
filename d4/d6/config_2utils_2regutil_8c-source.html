<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: regutil.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>regutil.c</h1><a href="../../d3/d7/config_2utils_2regutil_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    regutil.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Utility routines for use by REGINI and REGDMP programs.</span>
00012 <span class="comment">Author:</span>
00013 <span class="comment"></span>
00014 <span class="comment">    Steve Wood (stevewo)  10-Mar-92</span>
00015 <span class="comment"></span>
00016 <span class="comment">Revision History:</span>
00017 <span class="comment"></span>
00018 <span class="comment">--*/</span>
00019 
00020 <span class="preprocessor">#include "<a class="code" href="../../d5/d7/regutil_8h.html">regutil.h</a>"</span>
00021 
<a name="l00022"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">00022</a> <span class="preprocessor">#define RtlAllocateHeap(x,y,z) malloc(z)</span>
<a name="l00023"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">00023</a> <span class="preprocessor"></span><span class="preprocessor">#define RtlFreeHeap(x,y,z) free(z)</span>
00024 <span class="preprocessor"></span>
<a name="l00025"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a4">00025</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a4">RiOnKeyword</a>;
<a name="l00026"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a5">00026</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a5">RiYesKeyword</a>;
<a name="l00027"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a6">00027</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a6">RiTrueKeyword</a>;
<a name="l00028"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a7">00028</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a7">RiOffKeyword</a>;
<a name="l00029"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a8">00029</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a8">RiNoKeyword</a>;
<a name="l00030"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a9">00030</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a9">RiFalseKeyword</a>;
<a name="l00031"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a10">00031</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a10">RiDeleteKeyword</a>;
<a name="l00032"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a11">00032</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a11">RiRegKeyword</a>;
<a name="l00033"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a12">00033</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a12">RiRegNoneKeyword</a>;
<a name="l00034"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a13">00034</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a13">RiRegSzKeyword</a>;
<a name="l00035"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a14">00035</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a14">RiRegExpandSzKeyword</a>;
<a name="l00036"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a15">00036</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a15">RiRegDwordKeyword</a>;
<a name="l00037"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a16">00037</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a16">RiRegBinaryKeyword</a>;
<a name="l00038"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a17">00038</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a17">RiRegBinaryFileKeyword</a>;
<a name="l00039"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a18">00039</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a18">RiRegLinkKeyword</a>;
<a name="l00040"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a19">00040</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a19">RiRegMultiSzKeyword</a>;
<a name="l00041"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a20">00041</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a20">RiRegMultiSzFileKeyword</a>;
<a name="l00042"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a21">00042</a> UNICODE_STRING <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a21">RiRegDateKeyword</a>;
00043 
00044 <span class="keywordtype">void</span>
<a name="l00045"></a><a class="code" href="../../d5/d7/regutil_8h.html#a5">00045</a> <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a22">RegInitialize</a>( <span class="keywordtype">void</span> )
00046 {
00047     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a4">RiOnKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ON"</span> );
00048     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a5">RiYesKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"YES"</span> );
00049     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a6">RiTrueKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"TRUE"</span> );
00050     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a7">RiOffKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"OFF"</span> );
00051     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a8">RiNoKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"NO"</span> );
00052     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a9">RiFalseKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"FALSE"</span> );
00053     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a10">RiDeleteKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"DELETE"</span> );
00054     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a11">RiRegKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_"</span> );
00055     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a12">RiRegNoneKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_NONE"</span> );
00056     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a13">RiRegSzKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_SZ"</span> );
00057     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a14">RiRegExpandSzKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_EXPAND_SZ"</span> );
00058     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a15">RiRegDwordKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_DWORD"</span> );
00059     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a16">RiRegBinaryKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_BINARY"</span> );
00060     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a17">RiRegBinaryFileKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_BINARYFILE"</span> );
00061     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a18">RiRegLinkKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_LINK"</span> );
00062     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a19">RiRegMultiSzKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_MULTI_SZ"</span> );
00063     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a20">RiRegMultiSzFileKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_MULTISZFILE"</span> );
00064     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a21">RiRegDateKeyword</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"REG_DATE"</span> );
00065 }
00066 
00067 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00068"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a23">00068</a> <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a23">RegReadMultiSzFile</a>(
00069     IN PUNICODE_STRING FileName,
00070     OUT PVOID *ValueBuffer,
00071     OUT PULONG ValueLength
00072     )
00073 {
00074     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00075     UNICODE_STRING NtFileName;
00076     PWSTR s;
00077     UNICODE_STRING MultiSource;
00078     UNICODE_STRING MultiValue;
00079     <a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html">REG_UNICODE_FILE</a> MultiSzFile;
00080     ULONG MultiSzFileSize;
00081 
00082 
00083     <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>-&gt;Buffer[ <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>-&gt;Length/<span class="keyword">sizeof</span>(WCHAR) ] = UNICODE_NULL;
00084 
00085     <a class="code" href="../../d5/d1/curdir_8c.html#a29">RtlDosPathNameToNtPathName_U</a>( <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>-&gt;Buffer,
00086                                   &amp;NtFileName,
00087                                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00088                                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00089 
00090     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d7/regutil_8h.html#a7">RegLoadAsciiFileAsUnicode</a>( &amp;NtFileName, &amp;MultiSzFile );
00091 
00092     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00093         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00094     }
00095 
00096     MultiSzFileSize = (MultiSzFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o2">EndOfFile</a> -
00097                        MultiSzFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o5">NextLine</a>) * <span class="keyword">sizeof</span>(WCHAR);
00098 
00099     *ValueLength = 0;
00100     *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0,
00101                                     MultiSzFileSize);
00102 
00103     MultiSource.Buffer = MultiSzFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o5">NextLine</a>;
00104     <span class="keywordflow">if</span> (MultiSzFileSize &lt;= MAXUSHORT) {
00105         MultiSource.Length =
00106         MultiSource.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)MultiSzFileSize;
00107     } <span class="keywordflow">else</span> {
00108         MultiSource.Length =
00109         MultiSource.MaximumLength = MAXUSHORT;
00110     }
00111 
00112     <span class="keywordflow">while</span> (<a class="code" href="../../d5/d7/regutil_8h.html#a10">RegGetMultiString</a>(&amp;MultiSource, &amp;MultiValue)) {
00113         RtlMoveMemory( (PUCHAR)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> + *ValueLength,
00114                        MultiValue.Buffer,
00115                        MultiValue.Length );
00116         *ValueLength += MultiValue.Length;
00117 
00118         s = MultiSource.Buffer;
00119         <span class="keywordflow">while</span> ( *s != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'"'</span> &amp;&amp;
00120                 *s != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">','</span> &amp;&amp;
00121                 ((s - MultiSource.Buffer) * <span class="keyword">sizeof</span>(WCHAR)) &lt;
00122                     MultiSource.Length ) s++;
00123         <span class="keywordflow">if</span> ( ((s - MultiSource.Buffer) * <span class="keyword">sizeof</span>(WCHAR)) ==
00124              MultiSource.Length ||
00125              *s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">','</span> ||
00126              *s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">';'</span>   ) {
00127 
00128             ((PWSTR)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>)[ *ValueLength / <span class="keyword">sizeof</span>(WCHAR) ] =
00129                 UNICODE_NULL;
00130             *ValueLength += <span class="keyword">sizeof</span>(UNICODE_NULL);
00131             <span class="keywordflow">if</span> ( *s ==  <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">';'</span> ) {
00132                 <span class="keywordflow">break</span>;
00133             }
00134         }
00135 
00136         <span class="keywordflow">if</span> ( (MultiSzFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o2">EndOfFile</a> - MultiSource.Buffer) * <span class="keyword">sizeof</span>(WCHAR) &gt;=
00137               MAXUSHORT ) {
00138             MultiSource.Length =
00139             MultiSource.MaximumLength = MAXUSHORT;
00140         } <span class="keywordflow">else</span> {
00141             MultiSource.Length =
00142             MultiSource.MaximumLength =
00143                 (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((MultiSzFile.<a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html#o2">EndOfFile</a> - MultiSource.Buffer) *
00144                          <span class="keyword">sizeof</span>(WCHAR));
00145         }
00146     }
00147 
00148     ((PWSTR)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>)[ *ValueLength / <span class="keyword">sizeof</span>(WCHAR) ] = UNICODE_NULL;
00149     *ValueLength += <span class="keyword">sizeof</span>(UNICODE_NULL);
00150 
00151     <span class="comment">// Virtual memory for reading of MultiSzFile freed at process</span>
00152     <span class="comment">// death?</span>
00153 
00154     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00155 }
00156 
00157 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00158"></a><a class="code" href="../../d5/d7/regutil_8h.html#a6">00158</a> <a class="code" href="../../d5/d7/regutil_8h.html#a6">RegReadBinaryFile</a>(
00159     IN PUNICODE_STRING FileName,
00160     OUT PVOID *ValueBuffer,
00161     OUT PULONG ValueLength
00162     )
00163 {
00164     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00165     UNICODE_STRING NtFileName;
00166     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00167     IO_STATUS_BLOCK IoStatus;
00168     HANDLE <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>;
00169     FILE_STANDARD_INFORMATION FileInformation;
00170     WCHAR <a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>[ 256 ];
00171     PWSTR s;
00172 
00173     <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>-&gt;Buffer[ <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>-&gt;Length/<span class="keyword">sizeof</span>(WCHAR) ] = UNICODE_NULL;
00174     wcscpy( <a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\DosDevices\\"</span> );
00175     s = wcscat( <a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>, <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>-&gt;Buffer );
00176     <span class="keywordflow">while</span> (*s != UNICODE_NULL) {
00177         <span class="keywordflow">if</span> (*s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'/'</span>) {
00178             *s = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span>;
00179             }
00180         s++;
00181         }
00182     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;NtFileName, <a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a> );
00183 
00184     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00185                                 &amp;NtFileName,
00186                                 OBJ_CASE_INSENSITIVE,
00187                                 (HANDLE)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00188                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00189                               );
00190 
00191     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d2/open_8c.html#a0">NtOpenFile</a>( &amp;<a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>,
00192                          SYNCHRONIZE | GENERIC_READ,
00193                          &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00194                          &amp;IoStatus,
00195                          FILE_SHARE_DELETE |
00196                             FILE_SHARE_READ |
00197                             FILE_SHARE_WRITE,
00198                          FILE_SYNCHRONOUS_IO_NONALERT |
00199                             FILE_NON_DIRECTORY_FILE
00200                        );
00201     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00202         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00203         }
00204 
00205     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d2/qsinfo_8c.html#a3">NtQueryInformationFile</a>( <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>,
00206                                      &amp;IoStatus,
00207                                      (PVOID)&amp;FileInformation,
00208                                      <span class="keyword">sizeof</span>( FileInformation ),
00209                                      FileStandardInformation
00210                                    );
00211     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00212         <span class="keywordflow">if</span> (FileInformation.EndOfFile.HighPart) {
00213             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
00214             }
00215         }
00216     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00217         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a> );
00218         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00219         }
00220 
00221     *ValueLength = FileInformation.EndOfFile.LowPart;
00222     *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, *ValueLength );
00223     <span class="keywordflow">if</span> (*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00224         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00225         }
00226 
00227     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00228         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d5/io_2read_8c.html#a1">NtReadFile</a>( <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>,
00229                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00230                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00231                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00232                              &amp;IoStatus,
00233                              *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>,
00234                              *ValueLength,
00235                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00236                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00237                            );
00238 
00239         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00240             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = IoStatus.Status;
00241 
00242             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00243                 <span class="keywordflow">if</span> (IoStatus.Information != *ValueLength) {
00244                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_END_OF_FILE;
00245                     }
00246                 }
00247             }
00248 
00249         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00250             <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> );
00251             }
00252         }
00253 
00254     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a> );
00255     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00256 }
00257 
00258 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00259"></a><a class="code" href="../../d5/d7/regutil_8h.html#a7">00259</a> <a class="code" href="../../d5/d7/regutil_8h.html#a7">RegLoadAsciiFileAsUnicode</a>(
00260     IN PUNICODE_STRING FileName,
00261     OUT <a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html">PREG_UNICODE_FILE</a> UnicodeFile
00262     )
00263 {
00264     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00265     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00266     IO_STATUS_BLOCK IoStatus;
00267     HANDLE <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>;
00268     FILE_BASIC_INFORMATION FileDateTimeInfo;
00269     FILE_STANDARD_INFORMATION FileInformation;
00270     ULONG <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>, i, i1, LineCount;
00271     PVOID BufferBase;
00272     PCHAR Src, Src1;
00273     PWSTR Dst;
00274 
00275     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00276                                 <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>,
00277                                 OBJ_CASE_INSENSITIVE,
00278                                 (HANDLE)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00279                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00280                               );
00281 
00282     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d2/open_8c.html#a0">NtOpenFile</a>( &amp;<a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>,
00283                          SYNCHRONIZE | GENERIC_READ,
00284                          &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00285                          &amp;IoStatus,
00286                          FILE_SHARE_DELETE |
00287                             FILE_SHARE_READ |
00288                             FILE_SHARE_WRITE,
00289                          FILE_SYNCHRONOUS_IO_NONALERT |
00290                             FILE_NON_DIRECTORY_FILE
00291                        );
00292     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00293         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00294         }
00295 
00296     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d2/qsinfo_8c.html#a3">NtQueryInformationFile</a>( <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>,
00297                                      &amp;IoStatus,
00298                                      (PVOID)&amp;FileInformation,
00299                                      <span class="keyword">sizeof</span>( FileInformation ),
00300                                      FileStandardInformation
00301                                    );
00302     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00303         <span class="keywordflow">if</span> (FileInformation.EndOfFile.HighPart) {
00304             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
00305             }
00306         }
00307     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00308         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a> );
00309         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00310         }
00311 
00312 
00313     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> = FileInformation.EndOfFile.LowPart * <span class="keyword">sizeof</span>( WCHAR );
00314     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> += <span class="keyword">sizeof</span>( UNICODE_NULL );
00315     BufferBase = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00316     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d6/allocvm_8c.html#a7">NtAllocateVirtualMemory</a>( NtCurrentProcess(),
00317                                       (PVOID *)&amp;BufferBase,
00318                                       0,
00319                                       &amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>,
00320                                       MEM_COMMIT,
00321                                       PAGE_READWRITE
00322                                     );
00323     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00324         Src = (PCHAR)BufferBase + ((FileInformation.EndOfFile.LowPart+1) &amp; ~1);
00325         Dst = (PWSTR)BufferBase;
00326         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d5/io_2read_8c.html#a1">NtReadFile</a>( <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>,
00327                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00328                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00329                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00330                              &amp;IoStatus,
00331                              Src,
00332                              FileInformation.EndOfFile.LowPart,
00333                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00334                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00335                            );
00336 
00337         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00338             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = IoStatus.Status;
00339 
00340             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00341                 <span class="keywordflow">if</span> (IoStatus.Information != FileInformation.EndOfFile.LowPart) {
00342                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_END_OF_FILE;
00343                     }
00344                 <span class="keywordflow">else</span> {
00345                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d2/qsinfo_8c.html#a3">NtQueryInformationFile</a>( <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>,
00346                                                      &amp;IoStatus,
00347                                                      (PVOID)&amp;FileDateTimeInfo,
00348                                                      <span class="keyword">sizeof</span>( FileDateTimeInfo ),
00349                                                      FileBasicInformation
00350                                                    );
00351                     }
00352                 }
00353             }
00354 
00355         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00356             <a class="code" href="../../d3/d7/freevm_8c.html#a6">NtFreeVirtualMemory</a>( NtCurrentProcess(),
00357                                  (PVOID *)&amp;BufferBase,
00358                                  &amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>,
00359                                  MEM_RELEASE
00360                                );
00361             }
00362         }
00363 
00364     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a> );
00365     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00366         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00367         }
00368 
00369     i = 0;
00370     <span class="keywordflow">while</span> (i &lt; FileInformation.EndOfFile.LowPart) {
00371         <span class="keywordflow">if</span> (i &gt; 1 &amp;&amp; (Src[-2] == <span class="charliteral">' '</span> || Src[-2] == <span class="charliteral">'\t'</span>) &amp;&amp;
00372             Src[-1] == <span class="charliteral">'\\'</span> &amp;&amp; (*Src == <span class="charliteral">'\r'</span> || *Src == <span class="charliteral">'\n'</span>)
00373            ) {
00374             <span class="keywordflow">if</span> (Dst[-1] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span>) {
00375                 --Dst;
00376                 }
00377             <span class="keywordflow">while</span> (Dst &gt; (PWSTR)BufferBase) {
00378                 <span class="keywordflow">if</span> (Dst[-1] &gt; <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00379                     <span class="keywordflow">break</span>;
00380                     }
00381                 Dst--;
00382                 }
00383             LineCount = 0;
00384             <span class="keywordflow">while</span> (i &lt; FileInformation.EndOfFile.LowPart) {
00385                 <span class="keywordflow">if</span> (*Src == <span class="charliteral">'\n'</span>) {
00386                     i++;
00387                     Src++;
00388                     LineCount++;
00389                     }
00390                 <span class="keywordflow">else</span>
00391                 <span class="keywordflow">if</span> (*Src == <span class="charliteral">'\r'</span> &amp;&amp;
00392                     (i+1) &lt; FileInformation.EndOfFile.LowPart &amp;&amp;
00393                     Src[ 1 ] == <span class="charliteral">'\n'</span>
00394                    ) {
00395                     i += 2;
00396                     Src += 2;
00397                     LineCount++;
00398                     }
00399                 <span class="keywordflow">else</span> {
00400                     <span class="keywordflow">break</span>;
00401                     }
00402                 }
00403 
00404             <span class="keywordflow">if</span> (LineCount &gt; 1) {
00405                 *Dst++ = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\n'</span>;
00406                 }
00407             <span class="keywordflow">else</span> {
00408                 *Dst++ = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>;
00409                 <span class="keywordflow">while</span> (i &lt; FileInformation.EndOfFile.LowPart &amp;&amp; (*Src == <span class="charliteral">' '</span> || *Src == <span class="charliteral">'\t'</span>)) {
00410                     i++;
00411                     Src++;
00412                     }
00413                 }
00414 
00415             <span class="keywordflow">if</span> (i &gt;= FileInformation.EndOfFile.LowPart) {
00416                 <span class="keywordflow">break</span>;
00417                 }
00418             }
00419         <span class="keywordflow">else</span>
00420         <span class="keywordflow">if</span> ((*Src == <span class="charliteral">'\r'</span> &amp;&amp; Src[1] == <span class="charliteral">'\n'</span>) || *Src == <span class="charliteral">'\n'</span>) {
00421             <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00422                 <span class="keywordflow">while</span> (i &lt; FileInformation.EndOfFile.LowPart &amp;&amp; (*Src == <span class="charliteral">'\r'</span> || *Src == <span class="charliteral">'\n'</span>)) {
00423                     i++;
00424                     Src++;
00425                     }
00426                 Src1 = Src;
00427                 i1 = i;
00428                 <span class="keywordflow">while</span> (i1 &lt; FileInformation.EndOfFile.LowPart &amp;&amp; (*Src1 == <span class="charliteral">' '</span> || *Src1 == <span class="charliteral">'\t'</span>)) {
00429                     i1++;
00430                     Src1++;
00431                     }
00432                 <span class="keywordflow">if</span> (i1 &lt; FileInformation.EndOfFile.LowPart &amp;&amp;
00433                     (*Src1 == <span class="charliteral">'\r'</span> &amp;&amp; Src1[1] == <span class="charliteral">'\n'</span>) || *Src1 == <span class="charliteral">'\n'</span>
00434                    ) {
00435                     Src = Src1;
00436                     i = i1;
00437                     }
00438                 <span class="keywordflow">else</span> {
00439                     <span class="keywordflow">break</span>;
00440                     }
00441                 }
00442 
00443             *Dst++ = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\n'</span>;
00444             }
00445         <span class="keywordflow">else</span> {
00446             i++;
00447             *Dst++ = <a class="code" href="../../d6/d6/nls_8c.html#a22">RtlAnsiCharToUnicodeChar</a>( &amp;Src );
00448             }
00449         }
00450 
00451     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00452         *Dst = UNICODE_NULL;
00453         UnicodeFile-&gt;FileContents = BufferBase;
00454         UnicodeFile-&gt;EndOfFile = Dst;
00455         UnicodeFile-&gt;BeginLine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00456         UnicodeFile-&gt;EndOfLine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00457         UnicodeFile-&gt;NextLine = BufferBase;
00458         UnicodeFile-&gt;LastWriteTime = FileDateTimeInfo.LastWriteTime;
00459         }
00460     <span class="keywordflow">else</span> {
00461         <a class="code" href="../../d3/d7/freevm_8c.html#a6">NtFreeVirtualMemory</a>( NtCurrentProcess(),
00462                              (PVOID *)&amp;BufferBase,
00463                              &amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>,
00464                              MEM_RELEASE
00465                            );
00466         }
00467 
00468     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00469 }
00470 
00471 
00472 BOOLEAN
<a name="l00473"></a><a class="code" href="../../d5/d7/regutil_8h.html#a8">00473</a> <a class="code" href="../../d5/d7/regutil_8h.html#a8">RegGetNextLine</a>(
00474     IN OUT <a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html">PREG_UNICODE_FILE</a> UnicodeFile,
00475     OUT PULONG IndentAmount,
00476     OUT PWSTR *FirstEqual
00477     )
00478 {
00479     PWSTR s, s1;
00480 
00481     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00482         <span class="keywordflow">if</span> (!(s = UnicodeFile-&gt;NextLine)) {
00483             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00484             }
00485 
00486         *IndentAmount = 0;
00487         <span class="keywordflow">while</span> (*s &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00488             <span class="keywordflow">if</span> (*s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00489                 *IndentAmount += 1;
00490                 }
00491             <span class="keywordflow">else</span>
00492             <span class="keywordflow">if</span> (*s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\t'</span>) {
00493                 *IndentAmount = ((*IndentAmount + 8) -
00494                                  (*IndentAmount % 8)
00495                                 );
00496                 }
00497 
00498             <span class="keywordflow">if</span> (++s &gt;= UnicodeFile-&gt;EndOfFile) {
00499                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00500                 }
00501             }
00502 
00503         UnicodeFile-&gt;BeginLine = s;
00504 
00505         *FirstEqual = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00506         UnicodeFile-&gt;NextLine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00507         <span class="keywordflow">while</span> (s &lt; UnicodeFile-&gt;EndOfFile) {
00508             <span class="keywordflow">if</span> (*s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'='</span>) {
00509                 <span class="keywordflow">if</span> (*FirstEqual == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00510                     *FirstEqual = s;
00511                     }
00512                 }
00513             <span class="keywordflow">else</span>
00514             <span class="keywordflow">if</span> (*s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\n'</span>) {
00515                 s1 = s;
00516                 <span class="keywordflow">while</span> (s &gt; UnicodeFile-&gt;BeginLine &amp;&amp; s[ -1 ] &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00517                     s--;
00518                     }
00519                 UnicodeFile-&gt;EndOfLine = s;
00520                 <span class="keywordflow">do</span> {
00521                     <span class="keywordflow">if</span> (++s1 &gt;= UnicodeFile-&gt;EndOfFile) {
00522                         s1 = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00523                         <span class="keywordflow">break</span>;
00524                         }
00525                     }
00526                 <span class="keywordflow">while</span> (*s1 == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\r'</span> || *s1 == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\n'</span>);
00527 
00528                 UnicodeFile-&gt;NextLine = s1;
00529                 <span class="keywordflow">break</span>;
00530                 }
00531 
00532             <span class="keywordflow">if</span> (++s == UnicodeFile-&gt;EndOfFile) {
00533                 <span class="keywordflow">break</span>;
00534                 }
00535             }
00536 
00537         <span class="keywordflow">if</span> (UnicodeFile-&gt;EndOfLine &gt; UnicodeFile-&gt;BeginLine) {
00538             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/regutil_8h.html#a3">DebugOutput</a>) {
00539                 fprintf( stderr, <span class="stringliteral">"%02u  %.*ws\n"</span>,
00540                          *IndentAmount,
00541                          UnicodeFile-&gt;EndOfLine - UnicodeFile-&gt;BeginLine,
00542                          UnicodeFile-&gt;BeginLine
00543                        );
00544                 }
00545 
00546             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00547             }
00548         }
00549 
00550     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00551 }
00552 
00553 
00554 <span class="keywordtype">void</span>
<a name="l00555"></a><a class="code" href="../../d5/d7/regutil_8h.html#a11">00555</a> <a class="code" href="../../d5/d7/regutil_8h.html#a11">RegDumpKeyValue</a>(
00556     FILE *fh,
00557     PKEY_VALUE_FULL_INFORMATION KeyValueInformation,
00558     ULONG IndentLevel
00559     )
00560 {
00561     PULONG p;
00562     PWSTR pw, pw1;
00563     ULONG i, j, k, m, cbPrefix;
00564     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00565     PUCHAR pbyte;
00566 
00567     cbPrefix = fprintf( fh, <span class="stringliteral">"%.*s"</span>,
00568                         IndentLevel,
00569                         <span class="stringliteral">"                                                                                  "</span>
00570                       );
00571     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Buffer = (PWSTR)&amp;(KeyValueInformation-&gt;Name[0]);
00572     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)KeyValueInformation-&gt;NameLength;
00573     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)KeyValueInformation-&gt;NameLength;
00574 
00575     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length) {
00576         cbPrefix += fprintf( fh, <span class="stringliteral">"%wZ "</span>, &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a> );
00577         }
00578     cbPrefix += fprintf( fh, <span class="stringliteral">"= "</span> );
00579 
00580     <span class="keywordflow">if</span> (KeyValueInformation-&gt;DataLength == 0) {
00581         fprintf( fh, <span class="stringliteral">" [no data] \n"</span>);
00582         <span class="keywordflow">return</span>;
00583     }
00584 
00585     <span class="keywordflow">switch</span>( KeyValueInformation-&gt;Type ) {
00586     <span class="keywordflow">case</span> REG_SZ:
00587     <span class="keywordflow">case</span> REG_EXPAND_SZ:
00588 
00589         <span class="keywordflow">if</span> (KeyValueInformation-&gt;Type == REG_EXPAND_SZ) {
00590             cbPrefix += fprintf( fh, <span class="stringliteral">"REG_EXPAND_SZ "</span> );
00591         }
00592         pw = (PWSTR)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset);
00593         *(PWSTR)((PCHAR)pw + KeyValueInformation-&gt;DataLength) = UNICODE_NULL;
00594         i = 0;
00595         <span class="keywordflow">while</span> (*pw) {
00596             <span class="keywordflow">if</span> ((cbPrefix + wcslen(pw)) &gt; 80) {
00597                 pw1 = pw;
00598                 <span class="keywordflow">while</span> (*pw1 &amp;&amp; *pw1 &gt; <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00599                     pw1++;
00600                 }
00601 
00602                 <span class="keywordflow">if</span> (*pw1) {
00603                     *pw1++ = UNICODE_NULL;
00604                     <span class="keywordflow">while</span> (*pw1 &amp;&amp; *pw1 &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00605                         pw1++;
00606                     }
00607                 }
00608             } <span class="keywordflow">else</span> {
00609                 pw1 = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00610             }
00611             <span class="keywordflow">if</span> (i &gt; 0) {
00612                 fprintf( fh, <span class="stringliteral">" \\\n%.*s"</span>,
00613                          cbPrefix,
00614                          <span class="stringliteral">"                                                                                  "</span>
00615                        );
00616             }
00617 
00618             fprintf( fh, <span class="stringliteral">"%ws"</span>, pw );
00619             <span class="keywordflow">if</span> (!pw1) {
00620                 <span class="keywordflow">break</span>;
00621                 }
00622             i++;
00623             pw = pw1;
00624         }
00625         <span class="keywordflow">break</span>;
00626 
00627     <span class="keywordflow">case</span> REG_BINARY:
00628         fprintf( fh, <span class="stringliteral">"REG_BINARY 0x%08lx"</span>, KeyValueInformation-&gt;DataLength );
00629         p = (PULONG)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset);
00630         i = (KeyValueInformation-&gt;DataLength + 3) / <span class="keyword">sizeof</span>( ULONG );
00631         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7/regutil_8h.html#a4">SummaryOutput</a> || i &lt;= 8) {
00632             <span class="keywordflow">for</span> (j=0; j&lt;i; j++) {
00633                 <span class="keywordflow">if</span> ((j % 8) == 0) {
00634                     fprintf( fh, <span class="stringliteral">"\n%.*s"</span>,
00635                              IndentLevel+4,
00636                              <span class="stringliteral">"                                                                                  "</span>
00637                            );
00638                     }
00639 
00640                 fprintf( fh, <span class="stringliteral">"0x%08lx  "</span>, *p++ );
00641                 }
00642             }
00643         <span class="keywordflow">else</span> {
00644             fprintf( fh, <span class="stringliteral">" *** value display suppressed ***"</span> );
00645             }
00646         fprintf( fh, <span class="stringliteral">"\n"</span> );
00647         <span class="keywordflow">break</span>;
00648 
00649 <span class="comment">//  case REG_DWORD_LITTLE_ENDIAN:</span>
00650     <span class="keywordflow">case</span> REG_DWORD:
00651         fprintf( fh, <span class="stringliteral">"REG_DWORD 0x%08lx"</span>,
00652                  *((PULONG)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset))
00653                );
00654         <span class="keywordflow">break</span>;
00655 
00656     <span class="keywordflow">case</span> REG_DWORD_BIG_ENDIAN:
00657         fprintf( fh, <span class="stringliteral">"REG_DWORD_BIG_ENDIAN 0x%08lx"</span>,
00658                  *((PULONG)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset))
00659                );
00660         <span class="keywordflow">break</span>;
00661 
00662     <span class="keywordflow">case</span> REG_LINK:
00663         fprintf( fh, <span class="stringliteral">"REG_LINK %ws"</span>,
00664                  ((PWSTR)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset))
00665                );
00666         <span class="keywordflow">break</span>;
00667 
00668     <span class="keywordflow">case</span> REG_MULTI_SZ:
00669         cbPrefix += fprintf( fh, <span class="stringliteral">"REG_MULTI_SZ "</span> );
00670         pw = (PWSTR)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset);
00671         i  = 0;
00672         <span class="keywordflow">if</span> (*pw)
00673         <span class="keywordflow">while</span> (i &lt; ((KeyValueInformation-&gt;DataLength-1) / <span class="keyword">sizeof</span>(WCHAR))) {
00674             <span class="keywordflow">if</span> (i &gt; 0) {
00675                 fprintf( fh, <span class="stringliteral">" \\\n%.*s"</span>,
00676                          cbPrefix,
00677                          <span class="stringliteral">"                                                                                  "</span>
00678                        );
00679             }
00680             fprintf(fh, <span class="stringliteral">"\"%ws\" "</span>,pw+i);
00681             <span class="keywordflow">do</span> {
00682                 ++i;
00683             } <span class="keywordflow">while</span> ( pw[i] != UNICODE_NULL );
00684             ++i;
00685         }
00686         <span class="keywordflow">break</span>;
00687 
00688     <span class="keywordflow">case</span> REG_RESOURCE_LIST:
00689     <span class="keywordflow">case</span> REG_FULL_RESOURCE_DESCRIPTOR:
00690         {
00691         PCM_RESOURCE_LIST ResourceList = ((PCM_RESOURCE_LIST)((PCHAR)KeyValueInformation +
00692                                           KeyValueInformation-&gt;DataOffset));
00693         PCM_FULL_RESOURCE_DESCRIPTOR FullDescriptor;
00694         PCM_PARTIAL_RESOURCE_DESCRIPTOR PartialResourceDescriptor;
00695         ULONG k, l, count;
00696         PWSTR TypeName;
00697         PWSTR FlagName;
00698         ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = KeyValueInformation-&gt;DataLength;
00699 
00700         <span class="keywordflow">if</span> (KeyValueInformation-&gt;Type == REG_RESOURCE_LIST) {
00701 
00702             fprintf( fh, <span class="stringliteral">"   REG_RESOURCE_LIST\n"</span>);
00703 
00704             fprintf( fh, <span class="stringliteral">"%.*sNumber of Full resource Descriptors = %d"</span>,
00705                      IndentLevel,
00706                      <span class="stringliteral">"                                                                                  "</span>,
00707                      ResourceList-&gt;Count
00708                    );
00709 
00710              count = ResourceList-&gt;Count;
00711              FullDescriptor = &amp;ResourceList-&gt;List[0];
00712 
00713         } <span class="keywordflow">else</span> {
00714 
00715             fprintf( fh, <span class="stringliteral">"   REG_FULL_RESOURCE_DESCRIPTOR\n"</span>);
00716             count = 1;
00717             FullDescriptor = ((PCM_FULL_RESOURCE_DESCRIPTOR)
00718                 ((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset));
00719 
00720         }
00721 
00722         <span class="keywordflow">for</span> (i=0; i&lt; count; i++) {
00723 
00724             fprintf( fh, <span class="stringliteral">"\n%.*sPartial List number %d\n"</span>,
00725                      IndentLevel+4,
00726                      <span class="stringliteral">"                                                                                  "</span>,
00727                      i
00728                    );
00729 
00730             <span class="keywordflow">switch</span>(FullDescriptor-&gt;InterfaceType) {
00731 
00732             <span class="keywordflow">case</span> Internal:      TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Internal"</span>;         <span class="keywordflow">break</span>;
00733             <span class="keywordflow">case</span> Isa:           TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Isa"</span>;              <span class="keywordflow">break</span>;
00734             <span class="keywordflow">case</span> Eisa:          TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Eisa"</span>;             <span class="keywordflow">break</span>;
00735             <span class="keywordflow">case</span> MicroChannel:  TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MicroChannel"</span>;     <span class="keywordflow">break</span>;
00736             <span class="keywordflow">case</span> TurboChannel:  TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"TurboChannel"</span>;     <span class="keywordflow">break</span>;
00737             <span class="keywordflow">case</span> PCIBus:        TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCI"</span>;              <span class="keywordflow">break</span>;
00738             <span class="keywordflow">case</span> VMEBus:        TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"VME"</span>;              <span class="keywordflow">break</span>;
00739             <span class="keywordflow">case</span> NuBus:         TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"NuBus"</span>;            <span class="keywordflow">break</span>;
00740             <span class="keywordflow">case</span> PCMCIABus:     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCMCIA"</span>;           <span class="keywordflow">break</span>;
00741             <span class="keywordflow">case</span> CBus:          TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CBUS"</span>;             <span class="keywordflow">break</span>;
00742             <span class="keywordflow">case</span> MPIBus:        TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MPI"</span>;              <span class="keywordflow">break</span>;
00743 
00744             <span class="keywordflow">default</span>:
00745                 TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***invalid bus type***"</span>;
00746                 <span class="keywordflow">break</span>;
00747             }
00748 
00749             fprintf( fh, <span class="stringliteral">"%.*sINTERFACE_TYPE %ws\n"</span>,
00750                      IndentLevel+8,
00751                      <span class="stringliteral">"                                                                                  "</span>,
00752                      TypeName
00753                    );
00754 
00755             fprintf( fh, <span class="stringliteral">"%.*sBUS_NUMBER  %d\n"</span>,
00756                      IndentLevel+8,
00757                      <span class="stringliteral">"                                                                                  "</span>,
00758                      FullDescriptor-&gt;BusNumber
00759                    );
00760 
00761             <span class="comment">//</span>
00762             <span class="comment">// This is a basic test to see if the data format is right.</span>
00763             <span class="comment">// We know at least some video resource list are bogus ...</span>
00764             <span class="comment">//</span>
00765 
00766             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> &lt; FullDescriptor-&gt;PartialResourceList.Count *
00767                          <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_DESCRIPTOR) ) {
00768 
00769                 fprintf( fh, <span class="stringliteral">"\n%.*s *** !!! Invalid ResourceList !!! *** \n"</span>,
00770                          IndentLevel+8,
00771                          <span class="stringliteral">"                                                                                  "</span>,
00772                          i
00773                        );
00774 
00775                 <span class="keywordflow">break</span>;
00776             }
00777 
00778             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> -= FullDescriptor-&gt;PartialResourceList.Count *
00779                          <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_DESCRIPTOR);
00780 
00781 
00782 
00783             <span class="keywordflow">for</span> (j=0; j&lt;FullDescriptor-&gt;PartialResourceList.Count; j++) {
00784 
00785                 fprintf( fh, <span class="stringliteral">"%.*sDescriptor number %d\n"</span>,
00786                          IndentLevel+12,
00787                          <span class="stringliteral">"                                                                                  "</span>,
00788                          j
00789                        );
00790 
00791                 PartialResourceDescriptor =
00792             &amp;(FullDescriptor-&gt;PartialResourceList.PartialDescriptors[j]);
00793 
00794                 <span class="keywordflow">switch</span>(PartialResourceDescriptor-&gt;ShareDisposition) {
00795 
00796                 <span class="keywordflow">case</span> CmResourceShareUndetermined:
00797                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CmResourceShareUndetermined"</span>;
00798                     <span class="keywordflow">break</span>;
00799                 <span class="keywordflow">case</span> CmResourceShareDeviceExclusive:
00800                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CmResourceDeviceExclusive"</span>;
00801                     <span class="keywordflow">break</span>;
00802                 <span class="keywordflow">case</span> CmResourceShareDriverExclusive:
00803                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CmResourceDriverExclusive"</span>;
00804                     <span class="keywordflow">break</span>;
00805                 <span class="keywordflow">case</span> CmResourceShareShared:
00806                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CmResourceShared"</span>;
00807                     <span class="keywordflow">break</span>;
00808                 <span class="keywordflow">default</span>:
00809                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***invalid share disposition***"</span>;
00810                     <span class="keywordflow">break</span>;
00811                 }
00812 
00813                 fprintf( fh, <span class="stringliteral">"%.*sShare Disposition %ws\n"</span>,
00814                          IndentLevel+12,
00815                          <span class="stringliteral">"                                                                                  "</span>,
00816                          TypeName
00817                        );
00818 
00819                 FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***invalid Flags"</span>;
00820 
00821                 <span class="keywordflow">switch</span>(PartialResourceDescriptor-&gt;Type) {
00822 
00823                 <span class="keywordflow">case</span> CmResourceTypeNull:
00824                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"NULL"</span>;
00825                     FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***Unused"</span>;
00826                     <span class="keywordflow">break</span>;
00827                 <span class="keywordflow">case</span> CmResourceTypePort:
00828                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PORT"</span>;
00829                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_PORT_MEMORY) {
00830                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_PORT_MEMORY"</span>;
00831                     }
00832                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_PORT_IO) {
00833                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_PORT_IO"</span>;
00834                     }
00835                     <span class="keywordflow">break</span>;
00836                 <span class="keywordflow">case</span> CmResourceTypeInterrupt:
00837                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"INTERRUPT"</span>;
00838                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_INTERRUPT_LEVEL_SENSITIVE) {
00839                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_INTERRUPT_LEVEL_SENSITIVE"</span>;
00840                     }
00841                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_INTERRUPT_LATCHED) {
00842                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_INTERRUPT_LATCHED"</span>;
00843                     }
00844                     <span class="keywordflow">break</span>;
00845                 <span class="keywordflow">case</span> CmResourceTypeMemory:
00846                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MEMORY"</span>;
00847                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_MEMORY_READ_WRITE) {
00848                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_MEMORY_READ_WRITE"</span>;
00849                     }
00850                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_MEMORY_READ_ONLY) {
00851                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_MEMORY_READ_ONLY"</span>;
00852                     }
00853                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_MEMORY_WRITE_ONLY) {
00854                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_MEMORY_WRITE_ONLY"</span>;
00855                     }
00856                     <span class="keywordflow">break</span>;
00857                 <span class="keywordflow">case</span> CmResourceTypeDma:
00858                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"DMA"</span>;
00859                     FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***Unused"</span>;
00860                     <span class="keywordflow">break</span>;
00861                 <span class="keywordflow">case</span> CmResourceTypeDeviceSpecific:
00862                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"DEVICE SPECIFIC"</span>;
00863                     FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***Unused"</span>;
00864                     <span class="keywordflow">break</span>;
00865                 <span class="keywordflow">default</span>:
00866                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***invalid type***"</span>;
00867                     <span class="keywordflow">break</span>;
00868                 }
00869 
00870                 fprintf( fh, <span class="stringliteral">"%.*sTYPE              %ws\n"</span>,
00871                          IndentLevel+12,
00872                          <span class="stringliteral">"                                                                                  "</span>,
00873                          TypeName
00874                        );
00875 
00876                 fprintf( fh, <span class="stringliteral">"%.*sFlags             %ws\n"</span>,
00877                          IndentLevel+12,
00878                          <span class="stringliteral">"                                                                                  "</span>,
00879                          FlagName
00880                        );
00881 
00882                 <span class="keywordflow">switch</span>(PartialResourceDescriptor-&gt;Type) {
00883 
00884                 <span class="keywordflow">case</span> CmResourceTypePort:
00885                     fprintf( fh, <span class="stringliteral">"%.*sSTART 0x%08lx  LENGTH 0x%08lx\n"</span>,
00886                              IndentLevel+12,
00887                              <span class="stringliteral">"                                                                                  "</span>,
00888                              PartialResourceDescriptor-&gt;u.Port.Start.LowPart,
00889                              PartialResourceDescriptor-&gt;u.Port.Length
00890                            );
00891                     <span class="keywordflow">break</span>;
00892 
00893                 <span class="keywordflow">case</span> CmResourceTypeInterrupt:
00894                     fprintf( fh, <span class="stringliteral">"%.*sLEVEL %d  VECTOR %d  AFFINITY %d\n"</span>,
00895                              IndentLevel+12,
00896                              <span class="stringliteral">"                                                                                  "</span>,
00897                              PartialResourceDescriptor-&gt;u.Interrupt.Level,
00898                              PartialResourceDescriptor-&gt;u.Interrupt.Vector,
00899                              PartialResourceDescriptor-&gt;u.Interrupt.Affinity
00900                            );
00901                     <span class="keywordflow">break</span>;
00902 
00903                 <span class="keywordflow">case</span> CmResourceTypeMemory:
00904                     fprintf( fh, <span class="stringliteral">"%.*sSTART 0x%08lx%08lx  LENGTH 0x%08lx\n"</span>,
00905                              IndentLevel+12,
00906                              <span class="stringliteral">"                                                                                  "</span>,
00907                              PartialResourceDescriptor-&gt;u.Memory.Start.HighPart,
00908                              PartialResourceDescriptor-&gt;u.Memory.Start.LowPart,
00909                              PartialResourceDescriptor-&gt;u.Memory.Length
00910                            );
00911                     <span class="keywordflow">break</span>;
00912 
00913                 <span class="keywordflow">case</span> CmResourceTypeDma:
00914                     fprintf( fh, <span class="stringliteral">"%.*sCHANNEL %d  PORT %d\n"</span>,
00915                              IndentLevel+12,
00916                              <span class="stringliteral">"                                                                                  "</span>,
00917                              PartialResourceDescriptor-&gt;u.Dma.Channel,
00918                              PartialResourceDescriptor-&gt;u.Dma.Port
00919                            );
00920                     <span class="keywordflow">break</span>;
00921 
00922                 <span class="keywordflow">case</span> CmResourceTypeDeviceSpecific:
00923                     fprintf( fh, <span class="stringliteral">"%.*sDataSize 0x%08lx\n"</span>,
00924                              IndentLevel+12,
00925                              <span class="stringliteral">"                                                                                  "</span>,
00926                              PartialResourceDescriptor-&gt;u.DeviceSpecificData.DataSize
00927                            );
00928 
00929                     p = (PULONG)(PartialResourceDescriptor + 1);
00930                     k = (PartialResourceDescriptor-&gt;u.DeviceSpecificData.DataSize + 3) / <span class="keyword">sizeof</span>( ULONG );
00931                     <span class="keywordflow">for</span> (l=0; l&lt;k; l++) {
00932                         <span class="keywordflow">if</span> ((l % 8) == 0) {
00933                             fprintf( fh, <span class="stringliteral">"\n%.*s"</span>,
00934                                 IndentLevel+12,
00935                                 <span class="stringliteral">"                                                                                  "</span>
00936                                );
00937                         }
00938 
00939                         fprintf( fh, <span class="stringliteral">"0x%08lx  "</span>, *p++ );
00940                     }
00941                     fprintf( fh, <span class="stringliteral">"\n"</span> );
00942                     <span class="keywordflow">break</span>;
00943 
00944                 <span class="keywordflow">default</span>:
00945                     fprintf( fh, <span class="stringliteral">"%.*s*** Unknown resource list type: %c ****\n"</span>,
00946                              IndentLevel+12,
00947                              <span class="stringliteral">"                                                                                  "</span>,
00948                              PartialResourceDescriptor-&gt;Type
00949                            );
00950                     <span class="keywordflow">break</span>;
00951                 }
00952 
00953                 fprintf( fh, <span class="stringliteral">"\n"</span> );
00954             }
00955 
00956             FullDescriptor = (PCM_FULL_RESOURCE_DESCRIPTOR) (PartialResourceDescriptor+1);
00957         }
00958 
00959         <span class="keywordflow">break</span>;
00960         }
00961 
00962     <span class="keywordflow">case</span> REG_NONE:
00963     <span class="keywordflow">default</span>:
00964         <span class="keywordflow">if</span> (KeyValueInformation-&gt;Type == REG_NONE) {
00965             fprintf( fh, <span class="stringliteral">"REG_NONE\n"</span>);
00966             }
00967         <span class="keywordflow">else</span> {
00968             fprintf( fh, <span class="stringliteral">"*** Unknown registry type (%08lx)"</span>,
00969                      KeyValueInformation-&gt;Type
00970                    );
00971             }
00972         fprintf( fh, <span class="stringliteral">"%.*s"</span>,
00973              IndentLevel,
00974              <span class="stringliteral">"                                                                                  "</span>
00975              );
00976         fprintf( fh, <span class="stringliteral">"    Length: 0x%lx\n"</span>, KeyValueInformation-&gt;DataLength );
00977                 fprintf( fh, <span class="stringliteral">"\n%.*s"</span>,
00978                     IndentLevel,
00979                     <span class="stringliteral">"                                                                                  "</span>
00980                     );
00981         fprintf( fh, <span class="stringliteral">"      Data: "</span>);
00982         pbyte = ((PUCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset);
00983         <span class="keywordflow">for</span> ( k=0, m=1; k&lt;KeyValueInformation-&gt;DataLength; k++,m++) {
00984             fprintf( fh, <span class="stringliteral">"%02x "</span>, (*pbyte) );
00985             pbyte++;
00986 
00987             <span class="keywordflow">if</span> (m==8) {
00988                 fprintf( fh, <span class="stringliteral">"\n%.*s"</span>,
00989                     IndentLevel+12,
00990                     <span class="stringliteral">"                                                                                  "</span>
00991                     );
00992                 m=0;
00993             }
00994         }
00995         <span class="keywordflow">break</span>;
00996     }
00997 
00998     fprintf( fh, <span class="stringliteral">"\n"</span> );
00999     <span class="keywordflow">return</span>;
01000 }
01001 
01002 <span class="comment">//</span>
01003 <span class="comment">//  Define an upcase macro for temporary use by the upcase routines</span>
01004 <span class="comment">//</span>
01005 
<a name="l01006"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a2">01006</a> <span class="preprocessor">#define upcase(C) (WCHAR )(((C) &gt;= 'a' &amp;&amp; (C) &lt;= 'z' ? (C) - ('a' - 'A') : (C)))</span>
01007 <span class="preprocessor"></span>
01008 BOOLEAN
<a name="l01009"></a><a class="code" href="../../d5/d7/regutil_8h.html#a10">01009</a> <a class="code" href="../../d5/d7/regutil_8h.html#a10">RegGetMultiString</a>(
01010     IN OUT PUNICODE_STRING ValueString,
01011     OUT PUNICODE_STRING MultiString
01012     )
01013 
01014 <span class="comment">/*++</span>
01015 <span class="comment"></span>
01016 <span class="comment">Routine Description:</span>
01017 <span class="comment"></span>
01018 <span class="comment">    This routine parses multi-strings of the form</span>
01019 <span class="comment"></span>
01020 <span class="comment">        "foo" "bar" "bletch"</span>
01021 <span class="comment"></span>
01022 <span class="comment">    Each time it is called, it strips the first string in quotes from</span>
01023 <span class="comment">    the input string, and returns it as the multi-string.</span>
01024 <span class="comment"></span>
01025 <span class="comment">    INPUT ValueString: "foo" "bar" "bletch"</span>
01026 <span class="comment"></span>
01027 <span class="comment">    OUTPUT ValueString: "bar" "bletch"</span>
01028 <span class="comment">           MultiString: foo</span>
01029 <span class="comment"></span>
01030 <span class="comment">Arguments:</span>
01031 <span class="comment"></span>
01032 <span class="comment">    ValueString - Supplies the string from which the multi-string will be</span>
01033 <span class="comment">                  parsed</span>
01034 <span class="comment">                - Returns the remaining string after the multi-string is</span>
01035 <span class="comment">                  removed</span>
01036 <span class="comment"></span>
01037 <span class="comment">    MultiString - Returns the multi-string removed from ValueString</span>
01038 <span class="comment"></span>
01039 <span class="comment">Return Value:</span>
01040 <span class="comment"></span>
01041 <span class="comment">    TRUE - multi-string found and removed.</span>
01042 <span class="comment"></span>
01043 <span class="comment">    FALSE - no more multi-strings remaining.</span>
01044 <span class="comment"></span>
01045 <span class="comment">--*/</span>
01046 
01047 {
01048     <span class="comment">//</span>
01049     <span class="comment">// Find the first quote mark.</span>
01050     <span class="comment">//</span>
01051     <span class="keywordflow">while</span> ((*(ValueString-&gt;Buffer) != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'"'</span>) &amp;&amp;
01052            (ValueString-&gt;Length &gt; 0)) {
01053         ++ValueString-&gt;Buffer;
01054         ValueString-&gt;Length -= <span class="keyword">sizeof</span>(WCHAR);
01055         ValueString-&gt;MaximumLength -= <span class="keyword">sizeof</span>(WCHAR);
01056     }
01057 
01058     <span class="keywordflow">if</span> (ValueString-&gt;Length == 0) {
01059         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01060     }
01061 
01062     <span class="comment">//</span>
01063     <span class="comment">// We have found the start of the multi-string.  Now find the end,</span>
01064     <span class="comment">// building up our return MultiString as we go.</span>
01065     <span class="comment">//</span>
01066     ++ValueString-&gt;Buffer;
01067     ValueString-&gt;Length -= <span class="keyword">sizeof</span>(WCHAR);
01068     ValueString-&gt;MaximumLength -= <span class="keyword">sizeof</span>(WCHAR);
01069     MultiString-&gt;Buffer = ValueString-&gt;Buffer;
01070     MultiString-&gt;Length = 0;
01071     MultiString-&gt;MaximumLength = 0;
01072     <span class="keywordflow">while</span> ((*(ValueString-&gt;Buffer) != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'"'</span>) &amp;&amp;
01073            (ValueString-&gt;Length &gt; 0)) {
01074         ++ValueString-&gt;Buffer;
01075         ValueString-&gt;Length -= <span class="keyword">sizeof</span>(WCHAR);
01076         ValueString-&gt;MaximumLength -= <span class="keyword">sizeof</span>(WCHAR);
01077 
01078         MultiString-&gt;Length += <span class="keyword">sizeof</span>(WCHAR);
01079         MultiString-&gt;MaximumLength += <span class="keyword">sizeof</span>(WCHAR);
01080     }
01081 
01082     <span class="keywordflow">if</span> (ValueString-&gt;Length == 0) {
01083         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01084     }
01085 
01086     ++ValueString-&gt;Buffer;
01087     ValueString-&gt;Length -= <span class="keyword">sizeof</span>(WCHAR);
01088     ValueString-&gt;MaximumLength -= <span class="keyword">sizeof</span>(WCHAR);
01089 
01090     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01091 
01092 }
01093 
01094 
01095 BOOLEAN
<a name="l01096"></a><a class="code" href="../../d5/d7/regutil_8h.html#a9">01096</a> <a class="code" href="../../d5/d7/regutil_8h.html#a9">RegGetKeyValue</a>(
01097     IN PUNICODE_STRING InitialKeyValue,
01098     IN OUT <a class="code" href="../../d9/d2/struct__REG__UNICODE__FILE.html">PREG_UNICODE_FILE</a> UnicodeFile,
01099     OUT PULONG ValueType,
01100     OUT PVOID *ValueBuffer,
01101     OUT PULONG ValueLength
01102     )
01103 {
01104     ULONG PrefixLength;
01105     PWSTR s;
01106     PULONG p;
01107     ULONG <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
01108     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01109     ULONG IndentAmount;
01110     PWSTR FirstEqual;
01111     UNICODE_STRING KeyValue;
01112     UNICODE_STRING MultiValue;
01113     BOOLEAN GetDataFromBinaryFile = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01114     BOOLEAN GetDataFromMultiSzFile = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01115     BOOLEAN ParseDateTime = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01116 
01117     KeyValue = *InitialKeyValue;
01118     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a10">RiDeleteKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
01119         *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01120         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01121         }
01122     <span class="keywordflow">else</span>
01123     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a11">RiRegKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
01124         *ValueType = REG_SZ;
01125         PrefixLength = 0;
01126         }
01127     <span class="keywordflow">else</span>
01128     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a12">RiRegNoneKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
01129         *ValueType = REG_NONE;
01130         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a12">RiRegNoneKeyword</a>.Length;
01131         }
01132     <span class="keywordflow">else</span>
01133     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a13">RiRegSzKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
01134         *ValueType = REG_SZ;
01135         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a13">RiRegSzKeyword</a>.Length;
01136         }
01137     <span class="keywordflow">else</span>
01138     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a14">RiRegExpandSzKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
01139         *ValueType = REG_EXPAND_SZ;
01140         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a14">RiRegExpandSzKeyword</a>.Length;
01141         }
01142     <span class="keywordflow">else</span>
01143     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a15">RiRegDwordKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
01144         *ValueType = REG_DWORD;
01145         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a15">RiRegDwordKeyword</a>.Length;
01146         }
01147     <span class="keywordflow">else</span>
01148     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a17">RiRegBinaryFileKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
01149         *ValueType = REG_BINARY;
01150         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a17">RiRegBinaryFileKeyword</a>.Length;
01151         GetDataFromBinaryFile = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01152         }
01153     <span class="keywordflow">else</span>
01154     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a16">RiRegBinaryKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
01155         *ValueType = REG_BINARY;
01156         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a16">RiRegBinaryKeyword</a>.Length;
01157         }
01158     <span class="keywordflow">else</span>
01159     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a18">RiRegLinkKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
01160         *ValueType = REG_LINK;
01161         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a18">RiRegLinkKeyword</a>.Length;
01162         }
01163     <span class="keywordflow">else</span>
01164     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a20">RiRegMultiSzFileKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
01165         *ValueType = REG_MULTI_SZ;
01166         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a20">RiRegMultiSzFileKeyword</a>.Length;
01167         GetDataFromMultiSzFile = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01168         }
01169     <span class="keywordflow">else</span>
01170     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a19">RiRegMultiSzKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
01171         *ValueType = REG_MULTI_SZ;
01172         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a19">RiRegMultiSzKeyword</a>.Length;
01173         }
01174     <span class="keywordflow">else</span>
01175     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a21">RiRegDateKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
01176         *ValueType = REG_BINARY;
01177         ParseDateTime = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01178         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a21">RiRegDateKeyword</a>.Length;
01179         }
01180     <span class="keywordflow">else</span> {
01181         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01182         }
01183 
01184     <span class="keywordflow">if</span> (*ValueType != REG_NONE) {
01185         s = (PWSTR)
01186             ((PCHAR)KeyValue.Buffer + PrefixLength);
01187         KeyValue.Length -= (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)PrefixLength;
01188         <span class="keywordflow">while</span> (KeyValue.Length != 0 &amp;&amp; *s &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
01189             s++;
01190             KeyValue.Length -= <span class="keyword">sizeof</span>( WCHAR );
01191             }
01192         KeyValue.Buffer = s;
01193         }
01194     <span class="keywordflow">else</span> {
01195         *ValueType = REG_SZ;
01196         }
01197 
01198 
01199     <span class="keywordflow">if</span> (GetDataFromBinaryFile) {
01200         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d7/regutil_8h.html#a6">RegReadBinaryFile</a>( &amp;KeyValue, <a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>, ValueLength );
01201         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
01202             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01203             }
01204         <span class="keywordflow">else</span> {
01205             fprintf( stderr, <span class="stringliteral">"REGINI: Unable to read data from %wZ - Status == %lx\n"</span>, &amp;KeyValue, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01206             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01207             }
01208         }
01209 
01210     <span class="keywordflow">if</span> (GetDataFromMultiSzFile) {
01211         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a23">RegReadMultiSzFile</a>( &amp;KeyValue, <a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>, ValueLength );
01212         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
01213             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01214             }
01215         <span class="keywordflow">else</span> {
01216             fprintf( stderr, <span class="stringliteral">"REGINI: Unable to read data from %wZ - Status == %lx\n"</span>, &amp;KeyValue, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01217             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01218             }
01219         }
01220 
01221     <span class="keywordflow">switch</span>( *ValueType ) {
01222     <span class="keywordflow">case</span> REG_SZ:
01223     <span class="keywordflow">case</span> REG_EXPAND_SZ:
01224     <span class="keywordflow">case</span> REG_LINK:
01225         *ValueLength = KeyValue.Length + <span class="keyword">sizeof</span>( UNICODE_NULL );
01226         *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, *ValueLength );
01227         <span class="keywordflow">if</span> (*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01228             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01229             }
01230 
01231         RtlMoveMemory( *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>, KeyValue.Buffer, KeyValue.Length );
01232         ((PWSTR)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>)[ KeyValue.Length / <span class="keyword">sizeof</span>( WCHAR ) ] = UNICODE_NULL;
01233         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01234 
01235     <span class="keywordflow">case</span> REG_DWORD:
01236         *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, <span class="keyword">sizeof</span>( ULONG ) );
01237         <span class="keywordflow">if</span> (*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01238             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01239             }
01240 
01241         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a6">RiTrueKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ) ||
01242             <a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a5">RiYesKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ) ||
01243             <a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a4">RiOnKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )
01244            ) {
01245             *(PULONG)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = (ULONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01246             }
01247         <span class="keywordflow">else</span>
01248         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a9">RiFalseKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ) ||
01249             <a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a8">RiNoKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ) ||
01250             <a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a7">RiOffKeyword</a>, &amp;KeyValue, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )
01251            ) {
01252             *(PULONG)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = (ULONG)<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01253             }
01254         <span class="keywordflow">else</span> {
01255             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>( &amp;KeyValue, 0, (PULONG)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> );
01256             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
01257                 fprintf( stderr, <span class="stringliteral">"REGINI: CharToInteger( %wZ ) failed - Status == %lx\n"</span>, &amp;KeyValue, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01258                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> );
01259                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01260                 }
01261             }
01262 
01263         *ValueLength = <span class="keyword">sizeof</span>( ULONG );
01264         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01265 
01266     <span class="keywordflow">case</span> REG_BINARY:
01267         <span class="keywordflow">if</span> (ParseDateTime) {
01268 <span class="preprocessor">#define NUMBER_DATE_TIME_FIELDS 6</span>
01269 <span class="preprocessor"></span>            ULONG FieldIndexes[ <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a3">NUMBER_DATE_TIME_FIELDS</a>  ] = {1, 2, 0, 3, 4, 7};
01270             <span class="comment">//</span>
01271             <span class="comment">// Month/Day/Year HH:MM DayOfWeek</span>
01272             <span class="comment">//</span>
01273 
01274             ULONG CurrentField = 0;
01275             PCSHORT Fields;
01276             TIME_FIELDS DateTimeFields;
01277             UNICODE_STRING Field;
01278             ULONG FieldValue;
01279 
01280             RtlZeroMemory( &amp;DateTimeFields, <span class="keyword">sizeof</span>( DateTimeFields ) );
01281             Fields = &amp;DateTimeFields.Year;
01282             <span class="keywordflow">while</span> (KeyValue.Length) {
01283                 <span class="keywordflow">if</span> (CurrentField &gt;= 7) {
01284                     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01285                     }
01286 
01287                 s = KeyValue.Buffer;
01288                 <span class="keywordflow">while</span> (KeyValue.Length &amp;&amp; *s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
01289                     KeyValue.Length--;
01290                     s++;
01291                     }
01292 
01293                 Field.Buffer = s;
01294                 <span class="keywordflow">while</span> (KeyValue.Length) {
01295                     <span class="keywordflow">if</span> (CurrentField == (<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a3">NUMBER_DATE_TIME_FIELDS</a>-1)) {
01296                         }
01297                     <span class="keywordflow">else</span>
01298                     <span class="keywordflow">if</span> (*s &lt; L'0' || *s &gt; <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'9'</span>) {
01299                         <span class="keywordflow">break</span>;
01300                         }
01301 
01302                     KeyValue.Length--;
01303                     s++;
01304                     }
01305 
01306                 Field.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((PCHAR)s - (PCHAR)Field.Buffer);
01307                 Field.MaximumLength = Field.Length;
01308 
01309                 <span class="keywordflow">if</span> (KeyValue.Length) {
01310                     KeyValue.Length--;
01311                     s++;
01312                     }
01313                 KeyValue.Buffer = s;
01314 
01315                 <span class="keywordflow">if</span> (CurrentField == (<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a3">NUMBER_DATE_TIME_FIELDS</a>-1)) {
01316                     <span class="keywordflow">if</span> (Field.Length &lt; 3) {
01317                         printf( <span class="stringliteral">"REGINI: %wZ invalid day of week length\n"</span>, &amp;Field );
01318                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01319                         }
01320 
01321                     <span class="keywordflow">if</span> (DateTimeFields.Year != 0) {
01322                         printf( <span class="stringliteral">"REGINI: Year must be zero to specify day of week\n"</span> );
01323                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01324                         }
01325 
01326                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"SUN"</span>, 3 )) {
01327                         FieldValue = 0;
01328                         }
01329                     <span class="keywordflow">else</span>
01330                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MON"</span>, 3 )) {
01331                         FieldValue = 1;
01332                         }
01333                     <span class="keywordflow">else</span>
01334                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"TUE"</span>, 3 )) {
01335                         FieldValue = 2;
01336                         }
01337                     <span class="keywordflow">else</span>
01338                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"WED"</span>, 3 )) {
01339                         FieldValue = 3;
01340                         }
01341                     <span class="keywordflow">else</span>
01342                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"THU"</span>, 3 )) {
01343                         FieldValue = 4;
01344                         }
01345                     <span class="keywordflow">else</span>
01346                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"FRI"</span>, 3 )) {
01347                         FieldValue = 5;
01348                         }
01349                     <span class="keywordflow">else</span>
01350                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"SAT"</span>, 3 )) {
01351                         FieldValue = 6;
01352                         }
01353                     <span class="keywordflow">else</span> {
01354                         printf( <span class="stringliteral">"REGINI: %wZ invalid day of week\n"</span>, &amp;Field );
01355                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01356                         }
01357                     }
01358                 <span class="keywordflow">else</span> {
01359                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>( &amp;Field, 10, &amp;FieldValue );
01360                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
01361                         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01362                         }
01363                     }
01364 
01365                 Fields[ FieldIndexes[ CurrentField++ ] ] = (CSHORT)FieldValue;
01366                 }
01367 
01368             <span class="keywordflow">if</span> (DateTimeFields.Year == 0) {
01369                 <span class="keywordflow">if</span> (DateTimeFields.Day &gt; 5) {
01370                     printf( <span class="stringliteral">"REGINI: Day must be 0 - 5 if year is zero.\n"</span> );
01371                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01372                     }
01373                 }
01374             <span class="keywordflow">else</span>
01375             <span class="keywordflow">if</span> (DateTimeFields.Year &lt; 100) {
01376                 DateTimeFields.Year += 1900;
01377                 }
01378 
01379             *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, <span class="keyword">sizeof</span>( DateTimeFields ) );
01380             *ValueLength = <span class="keyword">sizeof</span>( DateTimeFields );
01381             RtlMoveMemory( *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>, &amp;DateTimeFields, <span class="keyword">sizeof</span>( DateTimeFields ) );
01382             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01383             }
01384         <span class="keywordflow">else</span> {
01385             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>( &amp;KeyValue, 0, ValueLength );
01386             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
01387                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01388                 }
01389             s = KeyValue.Buffer;
01390             <span class="keywordflow">while</span> (KeyValue.Length != 0 &amp;&amp; *s &gt; <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
01391                 s++;
01392                 KeyValue.Length -= <span class="keyword">sizeof</span>( WCHAR );
01393                 }
01394             KeyValue.Buffer = s;
01395             }
01396         <span class="keywordflow">break</span>;
01397 
01398     <span class="keywordflow">case</span> REG_MULTI_SZ:
01399         *ValueLength = 0;
01400         *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, KeyValue.Length + <span class="keyword">sizeof</span>( UNICODE_NULL ) );
01401         <span class="keywordflow">while</span> (<a class="code" href="../../d5/d7/regutil_8h.html#a10">RegGetMultiString</a>(&amp;KeyValue, &amp;MultiValue)) {
01402             RtlMoveMemory( (PUCHAR)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> + *ValueLength,
01403                            MultiValue.Buffer,
01404                            MultiValue.Length );
01405             *ValueLength += MultiValue.Length;
01406             ((PWSTR)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>)[ *ValueLength / <span class="keyword">sizeof</span>(WCHAR) ] = UNICODE_NULL;
01407             *ValueLength += <span class="keyword">sizeof</span>(UNICODE_NULL);
01408         }
01409         ((PWSTR)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>)[ *ValueLength / <span class="keyword">sizeof</span>(WCHAR) ] = UNICODE_NULL;
01410         *ValueLength += <span class="keyword">sizeof</span>(UNICODE_NULL);
01411 
01412         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01413 
01414     <span class="keywordflow">default</span>:
01415         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01416     }
01417 
01418     *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, *ValueLength );
01419     p = *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>;
01420     <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = (*ValueLength + <span class="keyword">sizeof</span>( ULONG ) - 1) / <span class="keyword">sizeof</span>( ULONG );
01421     <span class="keywordflow">while</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>--) {
01422         <span class="keywordflow">if</span> (KeyValue.Length == 0) {
01423             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7/regutil_8h.html#a8">RegGetNextLine</a>( UnicodeFile, &amp;IndentAmount, &amp;FirstEqual )) {
01424                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> );
01425                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01426                 }
01427             KeyValue.Buffer = UnicodeFile-&gt;BeginLine;
01428             KeyValue.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)
01429                 ((PCHAR)UnicodeFile-&gt;EndOfLine - (PCHAR)UnicodeFile-&gt;BeginLine);
01430             KeyValue.MaximumLength = KeyValue.Length;
01431             }
01432 
01433         s = KeyValue.Buffer;
01434         <span class="keywordflow">while</span> (KeyValue.Length != 0 &amp;&amp; *s &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
01435             s++;
01436             KeyValue.Length -= <span class="keyword">sizeof</span>( WCHAR );
01437             }
01438         KeyValue.Buffer = s;
01439         <span class="keywordflow">if</span> (KeyValue.Length != 0) {
01440             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>( &amp;KeyValue, 0, p );
01441             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
01442                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> );
01443                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01444                 }
01445             p++;
01446 
01447             s = KeyValue.Buffer;
01448             <span class="keywordflow">while</span> (KeyValue.Length != 0 &amp;&amp; *s &gt; <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
01449                 s++;
01450                 KeyValue.Length -= <span class="keyword">sizeof</span>( WCHAR );
01451                 }
01452             KeyValue.Buffer = s;
01453             }
01454         }
01455 
01456     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01457 }
01458 
01459 BOOLEAN
<a name="l01460"></a><a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a30">01460</a> <a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>(
01461     IN PUNICODE_STRING String1,
01462     IN PUNICODE_STRING String2,
01463     IN BOOLEAN CaseInSensitive
01464     )
01465 
01466 <span class="comment">/*++</span>
01467 <span class="comment"></span>
01468 <span class="comment">Routine Description:</span>
01469 <span class="comment"></span>
01470 <span class="comment">    The RtlPrefixUnicodeString function determines if the String1</span>
01471 <span class="comment">    counted string parameter is a prefix of the String2 counted string</span>
01472 <span class="comment">    parameter.</span>
01473 <span class="comment"></span>
01474 <span class="comment">    The CaseInSensitive parameter specifies if case is to be ignored when</span>
01475 <span class="comment">    doing the comparison.</span>
01476 <span class="comment"></span>
01477 <span class="comment">Arguments:</span>
01478 <span class="comment"></span>
01479 <span class="comment">    String1 - Pointer to the first unicode string.</span>
01480 <span class="comment"></span>
01481 <span class="comment">    String2 - Pointer to the second unicode string.</span>
01482 <span class="comment"></span>
01483 <span class="comment">    CaseInsensitive - TRUE if case should be ignored when doing the</span>
01484 <span class="comment">        comparison.</span>
01485 <span class="comment"></span>
01486 <span class="comment">Return Value:</span>
01487 <span class="comment"></span>
01488 <span class="comment">    Boolean value that is TRUE if String1 equals a prefix of String2 and</span>
01489 <span class="comment">    FALSE otherwise.</span>
01490 <span class="comment"></span>
01491 <span class="comment">--*/</span>
01492 
01493 {
01494     PWSTR s1, s2;
01495     ULONG <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
01496     WCHAR c1, c2;
01497 
01498     s1 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>-&gt;Buffer;
01499     s2 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>-&gt;Buffer;
01500     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>-&gt;Length &lt; <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>-&gt;Length) {
01501         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01502         }
01503 
01504     <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>-&gt;Length / <span class="keyword">sizeof</span>( c1 );
01505     <span class="keywordflow">while</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) {
01506         c1 = *s1++;
01507         c2 = *s2++;
01508 
01509         <span class="keywordflow">if</span> (CaseInSensitive) {
01510             c1 = <a class="code" href="../../d7/d6/nlsboot_8c.html#a0">upcase</a>(c1);
01511             c2 = <a class="code" href="../../d7/d6/nlsboot_8c.html#a0">upcase</a>(c2);
01512         }
01513         <span class="keywordflow">if</span> (c1 != c2) {
01514             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01515             }
01516 
01517         <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>--;
01518         }
01519 
01520     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01521 }
01522 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:38 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
