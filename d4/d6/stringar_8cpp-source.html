<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: stringar.cpp Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>stringar.cpp</h1><a href="../../d3/d7/stringar_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/******************************************************************************</span>
00002 <span class="comment"></span>
00003 <span class="comment">  Header File:  String Array.CPP</span>
00004 <span class="comment"></span>
00005 <span class="comment">  Implements the String Array class- see the related header for the declaration</span>
00006 <span class="comment">  of this class.</span>
00007 <span class="comment"></span>
00008 <span class="comment">  This class will do arrays in chunks- if the total array exceeds the size of</span>
00009 <span class="comment">  one chunk, we chain more instances together, then use recursion to do the</span>
00010 <span class="comment">  work.</span>
00011 <span class="comment"></span>
00012 <span class="comment">  Copyright (c) 1996 by Microsoft Corporation</span>
00013 <span class="comment"></span>
00014 <span class="comment">  A Pretty Penny Enterprises Production</span>
00015 <span class="comment"></span>
00016 <span class="comment">  Change History:</span>
00017 <span class="comment"></span>
00018 <span class="comment">  11-01-96  a-robkj@microsoft.com- original version</span>
00019 <span class="comment">  12-04-96  a-robkj@microsoft.com   Added LoadString and IsEmpty to CString</span>
00020 <span class="comment">                                    Also fixed bug in Remove where</span>
00021 <span class="comment">                                    u &gt; ChunkSize (wasn't exiting)</span>
00022 <span class="comment">  12-11-96  a-robkj@microsoft.com   Let CString do ANSI/UNICODE conversions</span>
00023 <span class="comment">                                    automagically to ease some API issues</span>
00024 <span class="comment">  01-07-97  KjelgaardR@acm.org  Fixed CStringArray::Empty and CUintArray::Empty</span>
00025 <span class="comment">            to NULL pointer to next chunk after deleting it.  Led to GP faults</span>
00026 <span class="comment">            if we needed to use the chunk again.</span>
00027 <span class="comment"></span>
00028 <span class="comment">******************************************************************************/</span>
00029 
00030 <span class="preprocessor">#include    "ICMUI.H"</span>
00031 
00032 <span class="comment">//  Convert a UNICODE string to a new ANSI buffer</span>
00033 
<a name="l00034"></a><a class="code" href="../../d1/d7/classCString.html#d0">00034</a> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d7/classCString.html#d0">CString::Flip</a>(LPCWSTR lpstrIn, LPSTR&amp; lpstrOut) {
00035     <span class="keywordflow">if</span>  (!lpstrIn) {
00036         lpstrOut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00037         <span class="keywordflow">return</span>;
00038     }
00039     <span class="keywordtype">int</span> iLength = WideCharToMultiByte(CP_ACP, 0, lpstrIn, -1, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00040         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00041 
00042     <span class="keywordflow">if</span>  (!iLength) {
00043         lpstrOut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00044         <span class="keywordflow">return</span>;
00045     }
00046 
00047     lpstrOut = (LPSTR) malloc(++iLength);
00048     <span class="keywordflow">if</span>(lpstrOut) {
00049         WideCharToMultiByte(CP_ACP, 0, lpstrIn, -1, lpstrOut, iLength, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00050             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00051     }
00052 }
00053 
00054 <span class="comment">//  Convert an ANSI string to a new UNICODE buffer</span>
00055 
<a name="l00056"></a><a class="code" href="../../d1/d7/classCString.html#d1">00056</a> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d7/classCString.html#d0">CString::Flip</a>(LPCSTR lpstrIn, LPWSTR&amp; lpstrOut) {
00057     <span class="keywordflow">if</span>  (!lpstrIn) {
00058         lpstrOut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00059         <span class="keywordflow">return</span>;
00060     }
00061 
00062     <span class="keywordtype">int</span> iLength = MultiByteToWideChar(CP_ACP, MB_PRECOMPOSED, lpstrIn, -1,
00063         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0);
00064 
00065     <span class="keywordflow">if</span>  (!iLength) {
00066         lpstrOut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00067         <span class="keywordflow">return</span>;
00068     }
00069 
00070     lpstrOut = (LPWSTR) malloc(++iLength * <span class="keyword">sizeof</span> (WCHAR));
00071     <span class="keywordflow">if</span>(lpstrOut) {
00072         MultiByteToWideChar(CP_ACP, MB_PRECOMPOSED, lpstrIn, -1, lpstrOut,
00073             iLength);
00074     }
00075 }
00076 
00077 <span class="comment">//  Empty the string, and free all memory.</span>
00078 
<a name="l00079"></a><a class="code" href="../../d1/d7/classCString.html#a6">00079</a> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d7/classCString.html#a6">CString::Empty</a>() {
00080     <span class="keywordflow">if</span>  (<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>)
00081         free(<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>);
00082 
00083     <span class="keywordflow">if</span>  (<a class="code" href="../../d1/d7/classCString.html#r1">m_acConverted</a>)
00084         free(<a class="code" href="../../d1/d7/classCString.html#r1">m_acConverted</a>);
00085 
00086     <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00087     <a class="code" href="../../d1/d7/classCString.html#r1">m_acConverted</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00088     <a class="code" href="../../d1/d7/classCString.html#r2">m_bConverted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00089 }
00090 
00091 <span class="comment">//  Compare with other CString</span>
00092 
<a name="l00093"></a><a class="code" href="../../d1/d7/classCString.html#a19">00093</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d1/d7/classCString.html#a19">CString::IsEqualString</a>(<a class="code" href="../../d1/d7/classCString.html">CString</a>&amp; csRef1)
00094 {
00095     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>() || csRef1.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>())
00096         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00097 
00098     <span class="keywordflow">return</span> (_tcsicmp(<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>,(LPTSTR)csRef1) == 0);
00099 }
00100 
<a name="l00101"></a><a class="code" href="../../d1/d7/classCString.html#a0">00101</a> <a class="code" href="../../d1/d7/classCString.html#a0">CString::CString</a>() {
00102     <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00103     <a class="code" href="../../d1/d7/classCString.html#r1">m_acConverted</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00104     <a class="code" href="../../d1/d7/classCString.html#r2">m_bConverted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00105 }
00106 
<a name="l00107"></a><a class="code" href="../../d1/d7/classCString.html#a1">00107</a> <a class="code" href="../../d1/d7/classCString.html#a0">CString::CString</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d7/classCString.html">CString</a>&amp; csRef) {
00108     <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> = csRef.<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> ? _tcsdup(csRef.<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>) : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00109     <a class="code" href="../../d1/d7/classCString.html#r1">m_acConverted</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00110     <a class="code" href="../../d1/d7/classCString.html#r2">m_bConverted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00111 }
00112 
<a name="l00113"></a><a class="code" href="../../d1/d7/classCString.html#a2">00113</a> <a class="code" href="../../d1/d7/classCString.html#a0">CString::CString</a>(LPCTSTR lpstrRef) {
00114     <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> = lpstrRef ? _tcsdup(lpstrRef) : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00115     <a class="code" href="../../d1/d7/classCString.html#r1">m_acConverted</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00116     <a class="code" href="../../d1/d7/classCString.html#r2">m_bConverted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00117 }
00118 
<a name="l00119"></a><a class="code" href="../../d1/d7/classCString.html#a3">00119</a> <a class="code" href="../../d1/d7/classCString.html#a0">CString::CString</a>(LPCOSTR lpstrRef) {
00120     <a class="code" href="../../d1/d7/classCString.html#r1">m_acConverted</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00121     <a class="code" href="../../d1/d7/classCString.html#r2">m_bConverted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00122 
00123     <span class="keywordflow">if</span>  (!lpstrRef) {
00124         <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00125         <span class="keywordflow">return</span>;
00126     }
00127 
00128     <a class="code" href="../../d1/d7/classCString.html#d0">Flip</a>(lpstrRef, <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>);
00129 }
00130 
00131 <span class="comment">//  Class destructor</span>
00132 
<a name="l00133"></a><a class="code" href="../../d1/d7/classCString.html#a4">00133</a> <a class="code" href="../../d1/d7/classCString.html#a4">CString::~CString</a>() {
00134     <a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00135 }
00136 
00137 <span class="comment">//  Report string in non-native encoding</span>
00138 
<a name="l00139"></a><a class="code" href="../../d1/d7/classCString.html#a10">00139</a> <a class="code" href="../../d1/d7/classCString.html#a10">CString::operator LPCOSTR</a>() {
00140     <span class="keywordflow">if</span>  (!<a class="code" href="../../d1/d7/classCString.html#r2">m_bConverted</a>) {
00141         <a class="code" href="../../d1/d7/classCString.html#d0">Flip</a>(<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>, <a class="code" href="../../d1/d7/classCString.html#r1">m_acConverted</a>);
00142         <a class="code" href="../../d1/d7/classCString.html#r2">m_bConverted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00143     }
00144     <span class="keywordflow">return</span>  <a class="code" href="../../d1/d7/classCString.html#r1">m_acConverted</a>;
00145 }
00146 
<a name="l00147"></a><a class="code" href="../../d1/d7/classCString.html#a11">00147</a> <span class="keyword">const</span> <a class="code" href="../../d1/d7/classCString.html">CString</a>&amp; CString::operator =(<span class="keyword">const</span> <a class="code" href="../../d1/d7/classCString.html">CString</a>&amp; csSrc) {
00148     <a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00149     <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> = csSrc.<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> ? _tcsdup(csSrc.<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>) : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00150     <span class="keywordflow">return</span>  *<span class="keyword">this</span>;
00151 }
00152 
<a name="l00153"></a><a class="code" href="../../d1/d7/classCString.html#a12">00153</a> <span class="keyword">const</span> <a class="code" href="../../d1/d7/classCString.html">CString</a>&amp; CString::operator =(LPCTSTR lpstrSrc) {
00154     <a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00155     <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> = lpstrSrc ? _tcsdup(lpstrSrc) : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00156     <span class="keywordflow">return</span>  *<span class="keyword">this</span>;
00157 }
00158 
<a name="l00159"></a><a class="code" href="../../d1/d7/classCString.html#a13">00159</a> <span class="keyword">const</span> <a class="code" href="../../d1/d7/classCString.html">CString</a>&amp; CString::operator =(LPCOSTR lpstrSrc) {
00160     <a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00161     <a class="code" href="../../d1/d7/classCString.html#d0">Flip</a>(lpstrSrc, <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>);
00162     <span class="keywordflow">return</span>  *<span class="keyword">this</span>;
00163 }
00164 
<a name="l00165"></a><a class="code" href="../../d1/d7/classCString.html#a14">00165</a> <a class="code" href="../../d1/d7/classCString.html">CString</a> <a class="code" href="../../d1/d7/classCString.html#a14">CString::NameOnly</a>()<span class="keyword"> const </span>{
00166     TCHAR   acName[_MAX_FNAME];
00167 
00168     <span class="keywordflow">if</span>  (!<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>)
00169         <span class="keywordflow">return</span>  *<span class="keyword">this</span>;
00170 
00171     _tsplitpath(<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, acName, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00172 
00173     <span class="keywordflow">return</span>  acName;
00174 }
00175 
<a name="l00176"></a><a class="code" href="../../d1/d7/classCString.html#a15">00176</a> <a class="code" href="../../d1/d7/classCString.html">CString</a> <a class="code" href="../../d1/d7/classCString.html#a15">CString::NameAndExtension</a>()<span class="keyword"> const </span>{
00177     TCHAR   acName[_MAX_FNAME], acExtension[_MAX_EXT];
00178 
00179     <span class="keywordflow">if</span>  (!<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>)
00180         <span class="keywordflow">return</span>  *<span class="keyword">this</span>;
00181 
00182     _tsplitpath(<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, acName, acExtension);
00183 
00184     lstrcat(acName, acExtension);
00185 
00186     <span class="keywordflow">return</span>  acName;
00187 }
00188 
<a name="l00189"></a><a class="code" href="../../d1/d7/classCString.html#a16">00189</a> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d7/classCString.html#a16">CString::Load</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, HINSTANCE hi) {
00190 
00191     <span class="keywordflow">if</span>  (!hi)
00192         hi = <a class="code" href="../../d0/d3/classCGlobals.html#e4">CGlobals::Instance</a>();
00193 
00194     TCHAR   acWork[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00195     LoadString(hi, <span class="keywordtype">id</span>, acWork, <a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>);
00196     *<span class="keyword">this</span> = acWork;
00197 }
00198 
00199 <span class="comment">//  03-20-1997  Bob_Kjelgaard@Prodigy.Net   Part of RAID 22289.</span>
00200 <span class="comment">//  Add a method for loading text from a windows handle</span>
00201 
<a name="l00202"></a><a class="code" href="../../d1/d7/classCString.html#a17">00202</a> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d7/classCString.html#a16">CString::Load</a>(HWND hwnd) {
00203     <a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00204 
00205     <span class="keywordtype">int</span> iccNeeded = <a class="code" href="../../d5/d9/cltxt_8h.html#a22">GetWindowTextLength</a>(hwnd);
00206     <span class="keywordflow">if</span>  (!iccNeeded)
00207         <span class="keywordflow">return</span>;
00208     <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> = (LPTSTR) malloc(++iccNeeded * <span class="keyword">sizeof</span> (TCHAR));
00209     <span class="keywordflow">if</span>(<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>) {
00210       <a class="code" href="../../d5/d9/cltxt_8h.html#a21">GetWindowText</a>(hwnd, <a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>, iccNeeded);
00211     }
00212 }
00213 
<a name="l00214"></a><a class="code" href="../../d1/d7/classCString.html#a18">00214</a> <span class="keywordtype">void</span>    <a class="code" href="../../d1/d7/classCString.html#a18">CString::LoadAndFormat</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, HINSTANCE hiWhere, BOOL bSystemMessage,
00215                                DWORD dwNumMsg, va_list *argList) {
00216     <a class="code" href="../../d1/d7/classCString.html#a6">Empty</a>();
00217 
00218     TCHAR   acWork[1024];
00219     <a class="code" href="../../d1/d7/classCString.html">CString</a> csTemplate;
00220     LPTSTR  <a class="code" href="../../d6/d3/kcodecnv_8c.html#a3">lpSource</a>;
00221     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
00222 
00223     <span class="keywordflow">if</span> (bSystemMessage) {
00224         <a class="code" href="../../d6/d3/kcodecnv_8c.html#a3">lpSource</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00225         <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = FORMAT_MESSAGE_FROM_SYSTEM;
00226     } <span class="keywordflow">else</span> {
00227         csTemplate.<a class="code" href="../../d1/d7/classCString.html#a16">Load</a>(<span class="keywordtype">id</span>);
00228         <a class="code" href="../../d6/d3/kcodecnv_8c.html#a3">lpSource</a> = csTemplate;
00229         <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = FORMAT_MESSAGE_FROM_STRING;
00230         <span class="keywordtype">id</span> = 0;
00231     }
00232 
00233     <span class="keywordflow">if</span> (FormatMessage(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>,<a class="code" href="../../d6/d3/kcodecnv_8c.html#a3">lpSource</a>, <span class="keywordtype">id</span>, 0, acWork, 1024, argList)) {
00234         *<span class="keyword">this</span> = acWork;
00235     }
00236 }
00237 
<a name="l00238"></a><a class="code" href="../../d3/d7/stringar_8cpp.html#a0">00238</a> <a class="code" href="../../d1/d7/classCString.html">CString</a> <a class="code" href="../../d3/d7/stringar_8cpp.html#a0">operator +</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d7/classCString.html">CString</a>&amp; csRef, LPCTSTR lpstrRef) {
00239     <span class="keywordflow">if</span>  (!lpstrRef || !*lpstrRef)
00240         <span class="keywordflow">return</span>  csRef;
00241 
00242     <span class="keywordflow">if</span>  (csRef.<a class="code" href="../../d1/d7/classCString.html#a5">IsEmpty</a>())
00243         <span class="keywordflow">return</span>  lpstrRef;
00244 
00245     <a class="code" href="../../d1/d7/classCString.html">CString</a> csReturn;
00246 
00247     csReturn.<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a> = (LPTSTR) malloc((1 + lstrlen(csRef.<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>) +
00248         lstrlen(lpstrRef)) * <span class="keyword">sizeof</span>(TCHAR));
00249     <span class="keywordflow">if</span>(csReturn.<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>) {
00250         lstrcat(lstrcpy(csReturn.<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>, csRef.<a class="code" href="../../d1/d7/classCString.html#r0">m_acContents</a>), lpstrRef);
00251     }
00252 
00253     <span class="keywordflow">return</span>  csReturn;
00254 }
00255 
00256 <span class="comment">//  CStringArray classes- these manage an array of strings,</span>
00257 <span class="comment">//  but the methods are geared to list-style management.</span>
00258 
00259 <span class="comment">//  Borrow first element from next chunk</span>
00260 
<a name="l00261"></a><a class="code" href="../../d2/d7/classCStringArray.html#d1">00261</a> LPCTSTR <a class="code" href="../../d2/d7/classCStringArray.html#d1">CStringArray::Borrow</a>() {
00262 
00263     LPCTSTR lpstrReturn = <a class="code" href="../../d2/d7/classCStringArray.html#r0">m_aStore</a>[0];
00264 
00265     memcpy((LPSTR) m_aStore, (LPSTR) (m_aStore + 1),
00266         (<a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>() - 1) * <span class="keyword">sizeof</span> m_aStore[0]);
00267 
00268     <span class="keywordflow">if</span>  (<a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a> &gt; <a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>())
00269         m_aStore[<a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>() - 1] = <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a> -&gt; <a class="code" href="../../d2/d7/classCStringArray.html#d1">Borrow</a>();
00270     <span class="keywordflow">else</span>
00271         m_aStore[<a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>() - 1] = (LPCTSTR) <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00272 
00273     <a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a>--;
00274 
00275     <span class="keywordflow">if</span>  (<a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a> &lt;= <a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>() &amp;&amp; <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a>) {
00276         <span class="keyword">delete</span>  <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a>;
00277         <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00278     }
00279 
00280     <span class="keywordflow">return</span>  lpstrReturn;
00281 }
00282 
00283 <span class="comment">//  ctor</span>
00284 
<a name="l00285"></a><a class="code" href="../../d2/d7/classCStringArray.html#a0">00285</a> <a class="code" href="../../d2/d7/classCStringArray.html#a0">CStringArray::CStringArray</a>() {
00286     <a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a> = 0;
00287     <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00288 }
00289 
00290 <span class="comment">//  dtor</span>
00291 
<a name="l00292"></a><a class="code" href="../../d2/d7/classCStringArray.html#a1">00292</a> <a class="code" href="../../d2/d7/classCStringArray.html#a1">CStringArray::~CStringArray</a>() {
00293     <a class="code" href="../../d2/d7/classCStringArray.html#a6">Empty</a>();
00294 }
00295 
00296 <span class="comment">//  Empty the list/array</span>
00297 
<a name="l00298"></a><a class="code" href="../../d2/d7/classCStringArray.html#a6">00298</a> <span class="keywordtype">void</span>    <a class="code" href="../../d2/d7/classCStringArray.html#a6">CStringArray::Empty</a>() {
00299 
00300     <span class="keywordflow">if</span>  (!<a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a>) <span class="keywordflow">return</span>;
00301 
00302     <span class="keywordflow">if</span>  (<a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a>) {
00303         <span class="keyword">delete</span>  <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a>;
00304         <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00305     }
00306     <a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a> = 0;
00307 }
00308 
<a name="l00309"></a><a class="code" href="../../d2/d7/classCStringArray.html#a7">00309</a> <span class="keywordtype">unsigned</span>    <a class="code" href="../../d2/d7/classCStringArray.html#a7">CStringArray::Map</a>(LPCTSTR lpstrRef) {
00310 
00311     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> u = 0; u &lt; <a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a>; u++)
00312         <span class="keywordflow">if</span>  (!lstrcmpi(<span class="keyword">operator</span>[](u), lpstrRef))
00313             <span class="keywordflow">break</span>;
00314 
00315     <span class="keywordflow">return</span>  u;
00316 }
00317 
00318 <span class="comment">//  Add an item</span>
00319 
<a name="l00320"></a><a class="code" href="../../d2/d7/classCStringArray.html#a3">00320</a> <span class="keywordtype">void</span>    <a class="code" href="../../d2/d7/classCStringArray.html#a3">CStringArray::Add</a>(LPCTSTR lpstrNew) {
00321 
00322     <span class="keywordflow">if</span>  (<a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a> &lt; <a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>()) {
00323         <a class="code" href="../../d2/d7/classCStringArray.html#r0">m_aStore</a>[<a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a>++] = lpstrNew;
00324         <span class="keywordflow">return</span>;
00325     }
00326 
00327     <span class="comment">//  Not enough space!  Add another record, if there isn't one</span>
00328 
00329     <span class="keywordflow">if</span>  (!<a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a>)
00330         <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a> = <span class="keyword">new</span> <a class="code" href="../../d2/d7/classCStringArray.html">CStringArray</a>;
00331 
00332     <span class="comment">//  Add the string to the next array (recursive call!)</span>
00333 
00334     <span class="keywordflow">if</span>  (<a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a>) {
00335         <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a> -&gt; <a class="code" href="../../d2/d7/classCStringArray.html#a3">Add</a>(lpstrNew);
00336         <a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a>++;
00337     }
00338 }
00339 
00340 <span class="comment">//  define an indexing operator</span>
00341 
<a name="l00342"></a><a class="code" href="../../d2/d7/classCStringArray.html#a4">00342</a> <a class="code" href="../../d1/d7/classCString.html">CString</a>&amp;    CStringArray::operator [](<span class="keywordtype">unsigned</span> u)<span class="keyword"> const </span>{
00343     _ASSERTE(u &lt; <a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a>);
00344 
00345     <span class="keywordflow">return</span>  u &lt; <a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>() ?
00346         (<a class="code" href="../../d1/d7/classCString.html">CString</a>&amp;)<a class="code" href="../../d2/d7/classCStringArray.html#r0">m_aStore</a>[u] : <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a> -&gt; <a class="code" href="../../d2/d7/classCStringArray.html#a4">operator[]</a>(u - <a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>());
00347 }
00348 
00349 <span class="comment">//  Remove the string at some index, shifting the rest down one slot</span>
00350 
<a name="l00351"></a><a class="code" href="../../d2/d7/classCStringArray.html#a5">00351</a> <span class="keywordtype">void</span>    <a class="code" href="../../d2/d7/classCStringArray.html#a5">CStringArray::Remove</a>(<span class="keywordtype">unsigned</span> u) {
00352 
00353     <span class="keywordflow">if</span>  (u &gt; <a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a>)
00354         <span class="keywordflow">return</span>;
00355 
00356     <span class="keywordflow">if</span>  (u &gt;= <a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>()) {
00357         <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a> -&gt; <a class="code" href="../../d2/d7/classCStringArray.html#a5">Remove</a>(u - <a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>());
00358         <span class="keywordflow">return</span>;
00359     }
00360 
00361     memmove((LPSTR) (<a class="code" href="../../d2/d7/classCStringArray.html#r0">m_aStore</a> + u), (LPSTR) (<a class="code" href="../../d2/d7/classCStringArray.html#r0">m_aStore</a> + u + 1),
00362         (<a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>() - (u + 1)) * <span class="keyword">sizeof</span> <a class="code" href="../../d2/d7/classCStringArray.html#r0">m_aStore</a>[0]);
00363 
00364     <span class="keywordflow">if</span>  (<a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a> &gt; <a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>())
00365         m_aStore[<a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>() - 1] = <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a> -&gt; <a class="code" href="../../d2/d7/classCStringArray.html#d1">Borrow</a>();
00366     <span class="keywordflow">else</span>
00367         m_aStore[<a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>() - 1] = (LPCTSTR) <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00368 
00369     <a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a>--;
00370 
00371     <span class="keywordflow">if</span>  (<a class="code" href="../../d2/d7/classCStringArray.html#r2">m_ucUsed</a> &lt;= <a class="code" href="../../d2/d7/classCStringArray.html#d0">ChunkSize</a>() &amp;&amp; <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a>) {
00372         <span class="keyword">delete</span>  <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a>;
00373         <a class="code" href="../../d2/d7/classCStringArray.html#r1">m_pcsaNext</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00374     }
00375 }
00376 
00377 <span class="comment">//  CUintArray class- this manages an array/list of unsigned integers</span>
00378 <span class="comment">//  The implementation is quite similar to the CStringArray's.  Why</span>
00379 <span class="comment">//  bother to do it different, after all?</span>
00380 
<a name="l00381"></a><a class="code" href="../../d3/d7/classCUintArray.html#d1">00381</a> <span class="keywordtype">unsigned</span>    <a class="code" href="../../d3/d7/classCUintArray.html#d1">CUintArray::Borrow</a>() {
00382 
00383     <span class="keywordtype">unsigned</span>    uReturn = <a class="code" href="../../d3/d7/classCUintArray.html#r0">m_aStore</a>[0];
00384 
00385     memcpy((LPSTR) m_aStore, (LPSTR) (m_aStore + 1),
00386         (<a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>() - 1) * <span class="keyword">sizeof</span> m_aStore[0]);
00387 
00388     <span class="keywordflow">if</span>  (<a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a> &gt; <a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>())
00389         m_aStore[<a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>() - 1] = <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a> -&gt; <a class="code" href="../../d3/d7/classCUintArray.html#d1">Borrow</a>();
00390     <span class="keywordflow">else</span>
00391         m_aStore[<a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>() - 1] = 0;
00392 
00393     <a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a>--;
00394 
00395     <span class="keywordflow">if</span>  (<a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a> &lt;= <a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>() &amp;&amp; <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a>) {
00396         <span class="keyword">delete</span>  <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a>;
00397         <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00398     }
00399 
00400     <span class="keywordflow">return</span>  uReturn;
00401 }
00402 
<a name="l00403"></a><a class="code" href="../../d3/d7/classCUintArray.html#a0">00403</a> <a class="code" href="../../d3/d7/classCUintArray.html#a0">CUintArray::CUintArray</a>() {
00404     <a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a> = 0;
00405     <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00406 }
00407 
<a name="l00408"></a><a class="code" href="../../d3/d7/classCUintArray.html#a1">00408</a> <a class="code" href="../../d3/d7/classCUintArray.html#a1">CUintArray::~CUintArray</a>() {
00409     <a class="code" href="../../d3/d7/classCUintArray.html#a6">Empty</a>();
00410 }
00411 
<a name="l00412"></a><a class="code" href="../../d3/d7/classCUintArray.html#a6">00412</a> <span class="keywordtype">void</span>    <a class="code" href="../../d3/d7/classCUintArray.html#a6">CUintArray::Empty</a>() {
00413 
00414     <span class="keywordflow">if</span>  (!<a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a>) <span class="keywordflow">return</span>;
00415 
00416     <span class="keywordflow">if</span>  (<a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a>) {
00417         <span class="keyword">delete</span>  <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a>;
00418         <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00419     }
00420     <a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a> = 0;
00421 }
00422 
00423 <span class="comment">//  Add an item</span>
<a name="l00424"></a><a class="code" href="../../d3/d7/classCUintArray.html#a3">00424</a> <span class="keywordtype">void</span>    <a class="code" href="../../d3/d7/classCUintArray.html#a3">CUintArray::Add</a>(<span class="keywordtype">unsigned</span> uNew) {
00425 
00426     <span class="keywordflow">if</span>  (<a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a> &lt; <a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>()) {
00427         <a class="code" href="../../d3/d7/classCUintArray.html#r0">m_aStore</a>[<a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a>++] = uNew;
00428         <span class="keywordflow">return</span>;
00429     }
00430 
00431     <span class="comment">//  Not enough space!  Add another record, if there isn't one</span>
00432 
00433     <span class="keywordflow">if</span>  (!<a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a>)
00434         <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a> = <span class="keyword">new</span> <a class="code" href="../../d3/d7/classCUintArray.html">CUintArray</a>;
00435 
00436     <span class="comment">//  Add the item to the next array (recursive call!)</span>
00437 
00438     <span class="keywordflow">if</span>  (<a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a>) {
00439         <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a> -&gt; <a class="code" href="../../d3/d7/classCUintArray.html#a3">Add</a>(uNew);
00440         <a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a>++;
00441     }
00442 }
00443 
<a name="l00444"></a><a class="code" href="../../d3/d7/classCUintArray.html#a4">00444</a> <span class="keywordtype">unsigned</span>    CUintArray::operator [](<span class="keywordtype">unsigned</span> u)<span class="keyword"> const </span>{
00445     <span class="keywordflow">return</span>  u &lt; <a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a> ? u &lt; <a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>() ?
00446         <a class="code" href="../../d3/d7/classCUintArray.html#r0">m_aStore</a>[u] : <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a> -&gt; <a class="code" href="../../d3/d7/classCUintArray.html#a4">operator[]</a>(u - <a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>()) : 0;
00447 }
00448 
<a name="l00449"></a><a class="code" href="../../d3/d7/classCUintArray.html#a5">00449</a> <span class="keywordtype">void</span>    <a class="code" href="../../d3/d7/classCUintArray.html#a5">CUintArray::Remove</a>(<span class="keywordtype">unsigned</span> u) {
00450 
00451     <span class="keywordflow">if</span>  (u &gt; <a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a>)
00452         <span class="keywordflow">return</span>;
00453 
00454     <span class="keywordflow">if</span>  (u &gt;= <a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>()) {
00455         <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a> -&gt; <a class="code" href="../../d3/d7/classCUintArray.html#a5">Remove</a>(u - <a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>());
00456         <span class="keywordflow">return</span>;
00457     }
00458 
00459     memmove((LPSTR) (<a class="code" href="../../d3/d7/classCUintArray.html#r0">m_aStore</a> + u), (LPSTR) (<a class="code" href="../../d3/d7/classCUintArray.html#r0">m_aStore</a> + u + 1),
00460         (<a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>() - (u + 1)) * <span class="keyword">sizeof</span> <a class="code" href="../../d3/d7/classCUintArray.html#r0">m_aStore</a>[0]);
00461 
00462     <span class="keywordflow">if</span>  (<a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a> &gt; <a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>())
00463         m_aStore[<a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>() - 1] = <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a> -&gt; <a class="code" href="../../d3/d7/classCUintArray.html#d1">Borrow</a>();
00464     <span class="keywordflow">else</span>
00465         m_aStore[<a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>() - 1] = 0;
00466 
00467     <a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a>--;
00468 
00469     <span class="keywordflow">if</span>  (<a class="code" href="../../d3/d7/classCUintArray.html#r2">m_ucUsed</a> &lt;= <a class="code" href="../../d3/d7/classCUintArray.html#d0">ChunkSize</a>() &amp;&amp; <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a>) {
00470         <span class="keyword">delete</span>  <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a>;
00471         <a class="code" href="../../d3/d7/classCUintArray.html#r1">m_pcuaNext</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00472     }
00473 }
00474 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:53 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
