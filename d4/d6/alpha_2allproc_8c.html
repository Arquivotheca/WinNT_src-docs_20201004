<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: alpha/allproc.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>allproc.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d5/d5/alpha_2allproc_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/alpha_2allproc_8c.html#a0">ROUND_UP</a>(x)&nbsp;&nbsp;&nbsp;((sizeof(x) + 64) &amp; (~64))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/alpha_2allproc_8c.html#a1">BLOCK1_SIZE</a>&nbsp;&nbsp;&nbsp;((3 * KERNEL_STACK_SIZE) + PAGE_SIZE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/alpha_2allproc_8c.html#a2">BLOCK2_SIZE</a>&nbsp;&nbsp;&nbsp;(ROUND_UP(KPRCB) + ROUND_UP(<a class="el" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a>) + 64)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/alpha_2allproc_8c.html#a3">IS_KSEG_ADDRESS</a>(v)&nbsp;&nbsp;&nbsp;(((v) &gt;= KSEG0_BASE) &amp;&amp; ((v) &lt; KSEG2_BASE))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/alpha_2allproc_8c.html#a4">KSEG_PFN</a>(v)&nbsp;&nbsp;&nbsp;((ULONG)(((v) - KSEG0_BASE) &gt;&gt; PAGE_SHIFT))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/alpha_2allproc_8c.html#a5">KSEG0_ADDRESS</a>(v)&nbsp;&nbsp;&nbsp;(v)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/alpha_2allproc_8c.html#a6">KiStartProcessor</a> (IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a> Loaderblock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/alpha_2allproc_8c.html#a7">KeStartAllProcessors</a> (VOID)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="alpha/allproc.c::BLOCK1_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BLOCK1_SIZE&nbsp;&nbsp;&nbsp;((3 * KERNEL_STACK_SIZE) + PAGE_SIZE)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00043">43</a> of file <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html">alpha/allproc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00078">KeStartAllProcessors()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="alpha/allproc.c::BLOCK2_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BLOCK2_SIZE&nbsp;&nbsp;&nbsp;(ROUND_UP(KPRCB) + ROUND_UP(<a class="el" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a>) + 64)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00044">44</a> of file <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html">alpha/allproc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00078">KeStartAllProcessors()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="alpha/allproc.c::IS_KSEG_ADDRESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IS_KSEG_ADDRESS          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">v&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(((v) &gt;= KSEG0_BASE) &amp;&amp; ((v) &lt; KSEG2_BASE))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00062">62</a> of file <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html">alpha/allproc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00078">KeStartAllProcessors()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="alpha/allproc.c::KSEG0_ADDRESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KSEG0_ADDRESS          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">v&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(v)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00064">64</a> of file <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html">alpha/allproc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00078">KeStartAllProcessors()</a>, and <a class="el" href="../../d7/d1/mm_2ia64_2initia64_8c-source.html#l00277">MiInitMachineDependent()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="alpha/allproc.c::KSEG_PFN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KSEG_PFN          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">v&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((ULONG)(((v) - KSEG0_BASE) &gt;&gt; PAGE_SHIFT))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00063">63</a> of file <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html">alpha/allproc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00078">KeStartAllProcessors()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="alpha/allproc.c::ROUND_UP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ROUND_UP          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">x&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((sizeof(x) + 64) &amp; (~64))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00042">42</a> of file <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html">alpha/allproc.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a7" doxytag="alpha/allproc.c::KeStartAllProcessors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeStartAllProcessors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00078">78</a> of file <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html">alpha/allproc.c</a>.
<p>
References <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00043">BLOCK1_SIZE</a>, <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00044">BLOCK2_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/hal_8h.html#a197">HalStartNextProcessor()</a>, <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00062">IS_KSEG_ADDRESS</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02773">KeLoaderBlock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02788">KeRegisteredProcessors</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01847">_LOADER_PARAMETER_BLOCK::KernelStack</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00544">KiAdjustInterruptTime()</a>, <a class="el" href="../../d4/d6/alpha_2allproc_8c.html#a6">KiStartProcessor()</a>, <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00064">KSEG0_ADDRESS</a>, <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00063">KSEG_PFN</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l01420">MAXIMUM_PROCESSORS</a>, <a class="el" href="../../d1/d6/allocpag_8c.html#a39">MmSetSpecialPool()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01848">_LOADER_PARAMETER_BLOCK::Prcb</a>, <a class="el" href="../../d7/d9/hive_8h-source.html#l00049">ROUND_UP</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01850">_LOADER_PARAMETER_BLOCK::Thread</a>, and <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o23">_LOADER_PARAMETER_BLOCK::u</a>.
<p>
<pre class="fragment"><div>00084                    :
00085 
00086     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called during phase 1 initialization on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> master boot
00087     processor to start all of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> other registered processors.
00088 
00089 Arguments:
00090 
00091     None.
00092 
00093 Return Value:
00094 
00095     None.
00096 
00097 --*/
00098 
00099 {
00100 
00101     ULONG_PTR MemoryBlock1;
00102     ULONG_PTR MemoryBlock2;
00103     ULONG Number;
00104     ULONG PcrPage;
00105     PKPRCB Prcb;
00106     KPROCESSOR_STATE ProcessorState;
00107     <span class="keyword">struct </span><a class="code" href="../../d5/d4/struct__RESTART__BLOCK.html">_RESTART_BLOCK</a> *RestartBlock;
00108     BOOLEAN Started;
00109     LOGICAL SpecialPoolState;
00110 
00111 <span class="preprocessor">#if !defined(NT_UP)</span>
00112 <span class="preprocessor"></span>
00113     <span class="comment">//</span>
00114     <span class="comment">// If the registered number of processors is greater than the maximum</span>
00115     <span class="comment">// number of processors supported, then only allow the maximum number</span>
00116     <span class="comment">// of supported processors.</span>
00117     <span class="comment">//</span>
00118 
00119     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/ke_8h.html#a142">KeRegisteredProcessors</a> &gt; <a class="code" href="../../d9/d5/ndismain_8h.html#a183">MAXIMUM_PROCESSORS</a>) {
00120         <a class="code" href="../../d4/d9/ke_8h.html#a142">KeRegisteredProcessors</a> = <a class="code" href="../../d9/d5/ndismain_8h.html#a183">MAXIMUM_PROCESSORS</a>;
00121     }
00122 
00123     <span class="comment">//</span>
00124     <span class="comment">// Initialize the processor state that will be used to start each of</span>
00125     <span class="comment">// processors. Each processor starts in the system initialization code</span>
00126     <span class="comment">// with address of the loader parameter block as an argument.</span>
00127     <span class="comment">//</span>
00128 
00129     RtlZeroMemory(&amp;ProcessorState, <span class="keyword">sizeof</span>(KPROCESSOR_STATE));
00130     ProcessorState.ContextFrame.IntA0 = (ULONGLONG)(LONG_PTR)<a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>;
00131     ProcessorState.ContextFrame.Fir = (ULONGLONG)(LONG_PTR)<a class="code" href="../../d4/d6/alpha_2allproc_8c.html#a6">KiStartProcessor</a>;
00132     Number = 1;
00133     <span class="keywordflow">while</span> (Number &lt; <a class="code" href="../../d4/d9/ke_8h.html#a142">KeRegisteredProcessors</a>) {
00134 
00135         <span class="comment">//</span>
00136         <span class="comment">// Allocate a DPC stack, an idle thread kernel stack, a panic</span>
00137         <span class="comment">// stack, a PCR page, a processor block, and an executive thread</span>
00138         <span class="comment">// object. If the allocation fails or the allocation cannot be</span>
00139         <span class="comment">// made from unmapped nonpaged pool, then stop starting processors.</span>
00140         <span class="comment">//</span>
00141         <span class="comment">// Disable any special pooling that the user may have set in the</span>
00142         <span class="comment">// registry as the next couple of allocations must come from KSEG0.</span>
00143         <span class="comment">//</span>
00144 
00145         SpecialPoolState = <a class="code" href="../../d1/d6/allocpag_8c.html#a39">MmSetSpecialPool</a>(FALSE);
00146         MemoryBlock1 = (ULONG_PTR)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, BLOCK1_SIZE);
00147         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/alpha_2allproc_8c.html#a3">IS_KSEG_ADDRESS</a>(MemoryBlock1) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00148             <a class="code" href="../../d1/d6/allocpag_8c.html#a39">MmSetSpecialPool</a>(SpecialPoolState);
00149             <span class="keywordflow">if</span> ((PVOID)MemoryBlock1 != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00150                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>((PVOID)MemoryBlock1);
00151             }
00152 
00153             <span class="keywordflow">break</span>;
00154         }
00155 
00156         MemoryBlock2 = (ULONG_PTR)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(NonPagedPool, BLOCK2_SIZE);
00157         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/alpha_2allproc_8c.html#a3">IS_KSEG_ADDRESS</a>(MemoryBlock2) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00158             <a class="code" href="../../d1/d6/allocpag_8c.html#a39">MmSetSpecialPool</a>(SpecialPoolState);
00159             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>((PVOID)MemoryBlock1);
00160             <span class="keywordflow">if</span> ((PVOID)MemoryBlock2 != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00161                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>((PVOID)MemoryBlock2);
00162             }
00163 
00164             <span class="keywordflow">break</span>;
00165         }
00166 
00167         <a class="code" href="../../d1/d6/allocpag_8c.html#a39">MmSetSpecialPool</a>(SpecialPoolState);
00168 
00169         <span class="comment">//</span>
00170         <span class="comment">// Zero both blocks of allocated memory.</span>
00171         <span class="comment">//</span>
00172 
00173         RtlZeroMemory((PVOID)MemoryBlock1, BLOCK1_SIZE);
00174         RtlZeroMemory((PVOID)MemoryBlock2, BLOCK2_SIZE);
00175 
00176         <span class="comment">//</span>
00177         <span class="comment">// Set address of interrupt stack in loader parameter block.</span>
00178         <span class="comment">//</span>
00179 
00180         <a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o23">u</a>.Alpha.PanicStack =
00181                         <a class="code" href="../../d4/d6/alpha_2allproc_8c.html#a5">KSEG0_ADDRESS</a>(MemoryBlock1 + (1 * KERNEL_STACK_SIZE));
00182 
00183         <span class="comment">//</span>
00184         <span class="comment">// Set address of idle thread kernel stack in loader parameter block.</span>
00185         <span class="comment">//</span>
00186 
00187         <a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o3">KernelStack</a> =
00188                         <a class="code" href="../../d4/d6/alpha_2allproc_8c.html#a5">KSEG0_ADDRESS</a>(MemoryBlock1 + (2 * KERNEL_STACK_SIZE));
00189 
00190         ProcessorState.ContextFrame.IntSp =
00191                             (ULONGLONG)(LONG_PTR)<a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o3">KernelStack</a>;
00192 
00193         <span class="comment">//</span>
00194         <span class="comment">// Set address of panic stack in loader parameter block.</span>
00195         <span class="comment">//</span>
00196 
00197         <a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o23">u</a>.Alpha.DpcStack =
00198                         <a class="code" href="../../d4/d6/alpha_2allproc_8c.html#a5">KSEG0_ADDRESS</a>(MemoryBlock1 + (3 * KERNEL_STACK_SIZE));
00199 
00200         <span class="comment">//</span>
00201         <span class="comment">// Set the page frame of the PCR page in the loader parameter block.</span>
00202         <span class="comment">//</span>
00203 
00204         PcrPage = <a class="code" href="../../d4/d6/alpha_2allproc_8c.html#a4">KSEG_PFN</a>(MemoryBlock1 + (3 * KERNEL_STACK_SIZE));
00205         <a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o23">u</a>.Alpha.PcrPage = PcrPage;
00206 
00207         <span class="comment">//</span>
00208         <span class="comment">// Set the address of the processor block and executive thread in the</span>
00209         <span class="comment">// loader parameter block.</span>
00210         <span class="comment">//</span>
00211 
00212         <a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o4">Prcb</a> = <a class="code" href="../../d4/d6/alpha_2allproc_8c.html#a5">KSEG0_ADDRESS</a>((MemoryBlock2  + 63) &amp; ~63);
00213         <a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o6">Thread</a> = <a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o4">Prcb</a> + <a class="code" href="../../d6/d0/hive_8h.html#a2">ROUND_UP</a>(KPRCB);
00214 
00215         <span class="comment">//</span>
00216         <span class="comment">// Attempt to start the next processor. If attempt is successful,</span>
00217         <span class="comment">// then wait for the processor to get initialized. Otherwise,</span>
00218         <span class="comment">// deallocate the processor resources and terminate the loop.</span>
00219         <span class="comment">//</span>
00220 
00221         Started = <a class="code" href="../../d2/d7/hal_8h.html#a197">HalStartNextProcessor</a>(KeLoaderBlock, &amp;ProcessorState);
00222         <span class="keywordflow">if</span> (Started == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00223             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>((PVOID)MemoryBlock1);
00224             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>((PVOID)MemoryBlock2);
00225             <span class="keywordflow">break</span>;
00226 
00227         } <span class="keywordflow">else</span> {
00228 
00229             <span class="comment">//</span>
00230             <span class="comment">// Wait until boot is finished on the target processor before</span>
00231             <span class="comment">// starting the next processor. Booting is considered to be</span>
00232             <span class="comment">// finished when a processor completes its initialization and</span>
00233             <span class="comment">// drops into the idle loop.</span>
00234             <span class="comment">//</span>
00235 
00236             Prcb = (PKPRCB)(<a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a>-&gt;<a class="code" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html#o4">Prcb</a>);
00237             RestartBlock = Prcb-&gt;RestartBlock;
00238             <span class="keywordflow">while</span> (RestartBlock-&gt;BootStatus.BootFinished == 0) {
00239                 KiMb();
00240             }
00241         }
00242 
00243         Number += 1;
00244     }
00245 
00246 <span class="preprocessor">#endif</span>
00247 <span class="preprocessor"></span>
00248     <span class="comment">//</span>
00249     <span class="comment">// Reset and synchronize the performance counters of all processors, by</span>
00250     <span class="comment">// applying a null adjustment to the interrupt time</span>
00251     <span class="comment">//</span>
00252 
00253     <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a8">KiAdjustInterruptTime</a>(0);
00254     <span class="keywordflow">return</span>;
00255 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="alpha/allproc.c::KiStartProcessor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiStartProcessor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Loaderblock</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00078">KeStartAllProcessors()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:51 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
