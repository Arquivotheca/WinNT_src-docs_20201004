<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: fullscr/vga/foncache.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>foncache.c File Reference</h1><code>#include "stdarg.h"</code><br>
<code>#include "stdio.h"</code><br>
<code>#include "ntddk.h"</code><br>
<code>#include "<a class="el" href="../../d8/d7/fsvga_8h-source.html">fsvga.h</a>"</code><br>
<code>#include "fsvgalog.h"</code><br>

<p>
<a href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/fullscr_2vga_2foncache_8c.html#a0">ADD_IMAGE</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/fullscr_2vga_2foncache_8c.html#a1">REPLACE_IMAGE</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/fullscr_2vga_2foncache_8c.html#a2">CALC_BITMAP_BITS_FOR_X</a>(FontSizeX, dwAlign)&nbsp;&nbsp;&nbsp;( ( ( FontSizeX * BITMAP_BITS_PIXEL + (dwAlign-1) ) &amp; ~(dwAlign-1)) &gt;&gt; BITMAP_ARRAY_BYTE )</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/fullscr_2vga_2foncache_8c.html#a3">CalcBitmapBufferSize</a> (IN COORD FontSize, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwAlign)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/fullscr_2vga_2foncache_8c.html#a4">AlignCopyMemory</a> (OUT <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pDestBits, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDestAlign, IN <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pSrcBits, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSrcAlign, IN COORD FontSize)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="fullscr/vga/foncache.c::ADD_IMAGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ADD_IMAGE&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00031">31</a> of file <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html">fullscr/vga/foncache.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="fullscr/vga/foncache.c::CALC_BITMAP_BITS_FOR_X" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CALC_BITMAP_BITS_FOR_X          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">FontSizeX,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>dwAlign&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;( ( ( FontSizeX * BITMAP_BITS_PIXEL + (dwAlign-1) ) &amp; ~(dwAlign-1)) &gt;&gt; BITMAP_ARRAY_BYTE )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00035">35</a> of file <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html">fullscr/vga/foncache.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00056">AlignCopyMemory()</a>, and <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00041">CalcBitmapBufferSize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="fullscr/vga/foncache.c::REPLACE_IMAGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define REPLACE_IMAGE&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00032">32</a> of file <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html">fullscr/vga/foncache.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a4" doxytag="fullscr/vga/foncache.c::AlignCopyMemory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID AlignCopyMemory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pDestBits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwDestAlign</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pSrcBits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwSrcAlign</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>FontSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00056">56</a> of file <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html">fullscr/vga/foncache.c</a>.
<p>
References <a class="el" href="../../d7/d5/foncache_8h-source.html#l00059">BITMAP_BITS_BYTE_ALIGN</a>, <a class="el" href="../../d7/d5/foncache_8h-source.html#l00060">BITMAP_BITS_WORD_ALIGN</a>, <a class="el" href="../../d7/d5/foncache_8h-source.html#l00074">BYTE_ALIGN</a>, <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00035">CALC_BITMAP_BITS_FOR_X</a>, <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00041">CalcBitmapBufferSize()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, and <a class="el" href="../../d7/d5/foncache_8h-source.html#l00075">WORD_ALIGN</a>.
<p>
Referenced by <a class="el" href="../../d3/d1/drawscrn_8c-source.html#l00489">FsgWriteToFrameBuffer()</a>.
<p>
<pre class="fragment"><div>00063 {
00064     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDestBufferSize;
00065     COORD coord;
00066 
00067     <span class="keywordflow">try</span>
00068     {
00069 
00070         <span class="keywordflow">if</span> (dwDestAlign == dwSrcAlign) {
00071             dwDestBufferSize = <a class="code" href="../../d6/d6/foncache_8h.html#a29">CalcBitmapBufferSize</a>(FontSize, dwDestAlign);
00072             RtlCopyMemory(pDestBits, pSrcBits, dwDestBufferSize);
00073             <span class="keywordflow">return</span>;
00074         }
00075 
00076         <span class="keywordflow">switch</span> (dwDestAlign) {
00077             <span class="keywordflow">default</span>:
00078             <span class="keywordflow">case</span> <a class="code" href="../../d6/d6/foncache_8h.html#a10">WORD_ALIGN</a>:
00079                 <span class="keywordflow">switch</span> (dwSrcAlign) {
00080                     <span class="keywordflow">default</span>:
00081                     <span class="comment">//</span>
00082                     <span class="comment">// pDest = WORD, pSrc = WORD</span>
00083                     <span class="comment">//</span>
00084                     <span class="keywordflow">case</span> <a class="code" href="../../d6/d6/foncache_8h.html#a10">WORD_ALIGN</a>:
00085                         dwDestBufferSize = <a class="code" href="../../d6/d6/foncache_8h.html#a29">CalcBitmapBufferSize</a>(FontSize, dwDestAlign);
00086                         RtlCopyMemory(pDestBits, pSrcBits, dwDestBufferSize);
00087                         <span class="keywordflow">break</span>;
00088                     <span class="comment">//</span>
00089                     <span class="comment">// pDest = WORD, pSrc = BYTE</span>
00090                     <span class="comment">//</span>
00091                     <span class="keywordflow">case</span> <a class="code" href="../../d6/d6/foncache_8h.html#a9">BYTE_ALIGN</a>:
00092                         dwDestBufferSize = <a class="code" href="../../d6/d6/foncache_8h.html#a29">CalcBitmapBufferSize</a>(FontSize, dwDestAlign);
00093                         <span class="keywordflow">if</span> (((FontSize.X % <a class="code" href="../../d6/d6/foncache_8h.html#a4">BITMAP_BITS_BYTE_ALIGN</a>) == 0) &amp;&amp;
00094                             ((FontSize.X % <a class="code" href="../../d6/d6/foncache_8h.html#a5">BITMAP_BITS_WORD_ALIGN</a>) == 0)   ) {
00095                             RtlCopyMemory(pDestBits, pSrcBits, dwDestBufferSize);
00096                         }
00097                         <span class="keywordflow">else</span> {
00098                             RtlZeroMemory(pDestBits, dwDestBufferSize);
00099                             <span class="keywordflow">for</span> (coord.Y=0; coord.Y &lt; FontSize.Y; coord.Y++) {
00100                                 <span class="keywordflow">for</span> (coord.X=0;
00101                                      coord.X &lt; <a class="code" href="../../d4/d6/fullscr_2vga_2foncache_8c.html#a2">CALC_BITMAP_BITS_FOR_X</a>(FontSize.X, BITMAP_BITS_BYTE_ALIGN);
00102                                      coord.X++) {
00103                                     *pDestBits++ = *pSrcBits++;
00104                                 }
00105                                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/fullscr_2vga_2foncache_8c.html#a2">CALC_BITMAP_BITS_FOR_X</a>(FontSize.X, BITMAP_BITS_BYTE_ALIGN) &amp; 1)
00106                                     pDestBits++;
00107                             }
00108                         }
00109                         <span class="keywordflow">break</span>;
00110                 }
00111                 <span class="keywordflow">break</span>;
00112             <span class="keywordflow">case</span> <a class="code" href="../../d6/d6/foncache_8h.html#a9">BYTE_ALIGN</a>:
00113                 <span class="keywordflow">switch</span> (dwSrcAlign) {
00114                     <span class="comment">//</span>
00115                     <span class="comment">// pDest = BYTE, pSrc = BYTE</span>
00116                     <span class="comment">//</span>
00117                     <span class="keywordflow">case</span> <a class="code" href="../../d6/d6/foncache_8h.html#a9">BYTE_ALIGN</a>:
00118                         dwDestBufferSize = <a class="code" href="../../d6/d6/foncache_8h.html#a29">CalcBitmapBufferSize</a>(FontSize, dwDestAlign);
00119                         RtlCopyMemory(pDestBits, pSrcBits, dwDestBufferSize);
00120                         <span class="keywordflow">break</span>;
00121                     <span class="keywordflow">default</span>:
00122                     <span class="comment">//</span>
00123                     <span class="comment">// pDest = BYTE, pSrc = WORD</span>
00124                     <span class="comment">//</span>
00125                     <span class="keywordflow">case</span> <a class="code" href="../../d6/d6/foncache_8h.html#a10">WORD_ALIGN</a>:
00126                         dwDestBufferSize = <a class="code" href="../../d6/d6/foncache_8h.html#a29">CalcBitmapBufferSize</a>(FontSize, dwDestAlign);
00127                         <span class="keywordflow">if</span> (((FontSize.X % <a class="code" href="../../d6/d6/foncache_8h.html#a4">BITMAP_BITS_BYTE_ALIGN</a>) == 0) &amp;&amp;
00128                             ((FontSize.X % <a class="code" href="../../d6/d6/foncache_8h.html#a5">BITMAP_BITS_WORD_ALIGN</a>) == 0)   ) {
00129                             RtlCopyMemory(pDestBits, pSrcBits, dwDestBufferSize);
00130                         }
00131                         <span class="keywordflow">else</span> {
00132                             RtlZeroMemory(pDestBits, dwDestBufferSize);
00133                             <span class="keywordflow">for</span> (coord.Y=0; coord.Y &lt; FontSize.Y; coord.Y++) {
00134                                 <span class="keywordflow">for</span> (coord.X=0;
00135                                      coord.X &lt; <a class="code" href="../../d4/d6/fullscr_2vga_2foncache_8c.html#a2">CALC_BITMAP_BITS_FOR_X</a>(FontSize.X, BITMAP_BITS_BYTE_ALIGN);
00136                                      coord.X++) {
00137                                     *pDestBits++ = *pSrcBits++;
00138                                 }
00139                                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/fullscr_2vga_2foncache_8c.html#a2">CALC_BITMAP_BITS_FOR_X</a>(FontSize.X, BITMAP_BITS_BYTE_ALIGN) &amp; 1)
00140                                     pSrcBits++;
00141                             }
00142                         }
00143                         <span class="keywordflow">break</span>;
00144                 }
00145                 <span class="keywordflow">break</span>;
00146         }
00147 
00148     }
00149     except (EXCEPTION_EXECUTE_HANDLER)
00150     {
00151     }
00152 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="fullscr/vga/foncache.c::CalcBitmapBufferSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CalcBitmapBufferSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>FontSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwAlign</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00041">41</a> of file <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html">fullscr/vga/foncache.c</a>.
<p>
References <a class="el" href="../../d7/d5/foncache_8h-source.html#l00059">BITMAP_BITS_BYTE_ALIGN</a>, <a class="el" href="../../d7/d5/foncache_8h-source.html#l00060">BITMAP_BITS_WORD_ALIGN</a>, <a class="el" href="../../d7/d5/foncache_8h-source.html#l00070">BITMAP_PLANES</a>, <a class="el" href="../../d7/d5/foncache_8h-source.html#l00074">BYTE_ALIGN</a>, <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00035">CALC_BITMAP_BITS_FOR_X</a>, and <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/fullscr_2vga_2foncache_8c-source.html#l00056">AlignCopyMemory()</a>, <a class="el" href="../../d3/d1/drawscrn_8c-source.html#l00489">FsgWriteToFrameBuffer()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03336">SetRAMFont()</a>, and <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03175">SetRAMFontCodePage()</a>.
<p>
<pre class="fragment"><div>00045 {
00046     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> uiCount;
00047 
00048     uiCount = <a class="code" href="../../d4/d6/fullscr_2vga_2foncache_8c.html#a2">CALC_BITMAP_BITS_FOR_X</a>(FontSize.X,
00049                                      (dwAlign==BYTE_ALIGN ? BITMAP_BITS_BYTE_ALIGN : BITMAP_BITS_WORD_ALIGN));
00050     uiCount = uiCount * <a class="code" href="../../d6/d6/foncache_8h.html#a7">BITMAP_PLANES</a> * FontSize.Y;
00051     <span class="keywordflow">return</span> uiCount;
00052 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:44 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
