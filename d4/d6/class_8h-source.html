<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: class.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>class.h</h1><a href="../../d3/d7/class_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    class.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    These are the structures and defines that are used in the</span>
00012 <span class="comment">    SCSI class drivers.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Mike Glass (mglass)</span>
00017 <span class="comment">    Jeff Havens (jhavens)</span>
00018 <span class="comment"></span>
00019 <span class="comment">Revision History:</span>
00020 <span class="comment"></span>
00021 <span class="comment">--*/</span>
00022 
00023 <span class="preprocessor">#ifndef _CLASS_</span>
00024 <span class="preprocessor"></span>
00025 <span class="preprocessor">#include &lt;ntdddisk.h&gt;</span>
00026 <span class="preprocessor">#include &lt;ntddcdrm.h&gt;</span>
00027 <span class="preprocessor">#include &lt;ntddtape.h&gt;</span>
00028 <span class="preprocessor">#include &lt;ntddchgr.h&gt;</span>
00029 <span class="preprocessor">#include &lt;ntddstor.h&gt;</span>
00030 <span class="preprocessor">#include "ntddscsi.h"</span>
00031 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00032 
00033 <span class="comment">// begin_ntminitape</span>
00034 
00035 <span class="preprocessor">#if DBG</span>
00036 <span class="preprocessor"></span>
00037 <span class="preprocessor">#define DebugPrint(x) ScsiDebugPrint x</span>
00038 <span class="preprocessor"></span>
00039 <span class="preprocessor">#else</span>
00040 <span class="preprocessor"></span>
<a name="l00041"></a><a class="code" href="../../d3/d7/class_8h.html#a0">00041</a> <span class="preprocessor">#define DebugPrint(x)</span>
00042 <span class="preprocessor"></span>
00043 <span class="preprocessor">#endif // DBG</span>
00044 <span class="preprocessor"></span>
00045 <span class="comment">// end_ntminitape</span>
00046 
00047 <span class="preprocessor">#ifdef POOL_TAGGING</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#undef ExAllocatePool</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#undef ExAllocatePoolWithQuota</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#define ExAllocatePool(a,b) ExAllocatePoolWithTag(a,b,'HscS')</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#define ExAllocatePoolWithQuota(a,b) ExAllocatePoolWithQuotaTag(a,b,'HscS')</span>
00052 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00053 <span class="preprocessor"></span>
<a name="l00054"></a><a class="code" href="../../d3/d7/class_8h.html#a1">00054</a> <span class="preprocessor">#define MAXIMUM_RETRIES 4</span>
00055 <span class="preprocessor"></span>
00056 <span class="keyword">typedef</span>
00057 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00058"></a><a class="code" href="../../d3/d7/class_8h.html#a2">00058</a> (*PCLASS_ERROR) (
00059     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00060     IN PSCSI_REQUEST_BLOCK Srb,
00061     IN OUT <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> *<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>,
00062     IN OUT BOOLEAN *Retry
00063     );
00064 
00065 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">_DEVICE_EXTENSION</a> {
00066 
00067     <span class="comment">//</span>
00068     <span class="comment">// Back pointer to device object</span>
00069     <span class="comment">//</span>
00070 
00071     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject;
00072 
00073     <span class="comment">//</span>
00074     <span class="comment">// Pointer to port device object</span>
00075     <span class="comment">//</span>
00076 
00077     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject;
00078 
00079     <span class="comment">//</span>
00080     <span class="comment">// Length of partition in bytes</span>
00081     <span class="comment">//</span>
00082 
00083     LARGE_INTEGER PartitionLength;
00084 
00085     <span class="comment">//</span>
00086     <span class="comment">// Number of bytes before start of partition</span>
00087     <span class="comment">//</span>
00088 
00089     LARGE_INTEGER StartingOffset;
00090 
00091     <span class="comment">//</span>
00092     <span class="comment">// Bytes to skew all requests, since DM Driver has been placed on an IDE drive.</span>
00093     <span class="comment">//</span>
00094 
00095     ULONG DMByteSkew;
00096 
00097     <span class="comment">//</span>
00098     <span class="comment">// Sectors to skew all requests.</span>
00099     <span class="comment">//</span>
00100 
00101     ULONG DMSkew;
00102 
00103     <span class="comment">//</span>
00104     <span class="comment">// Flag to indicate whether DM driver has been located on an IDE drive.</span>
00105     <span class="comment">//</span>
00106 
00107     BOOLEAN DMActive;
00108 
00109     <span class="comment">//</span>
00110     <span class="comment">// Pointer to the specific class error routine.</span>
00111     <span class="comment">//</span>
00112 
00113     <a class="code" href="../../d3/d7/class_8h.html#a2">PCLASS_ERROR</a> ClassError;
00114 
00115     <span class="comment">//</span>
00116     <span class="comment">// SCSI port driver capabilities</span>
00117     <span class="comment">//</span>
00118 
00119     PIO_SCSI_CAPABILITIES PortCapabilities;
00120 
00121     <span class="comment">//</span>
00122     <span class="comment">// Buffer for drive parameters returned in IO device control.</span>
00123     <span class="comment">//</span>
00124 
00125     PDISK_GEOMETRY DiskGeometry;
00126 
00127     <span class="comment">//</span>
00128     <span class="comment">// Back pointer to device object of physical device</span>
00129     <span class="comment">//</span>
00130 
00131     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PhysicalDevice;
00132 
00133     <span class="comment">//</span>
00134     <span class="comment">// Request Sense Buffer</span>
00135     <span class="comment">//</span>
00136 
00137     PSENSE_DATA SenseData;
00138 
00139     <span class="comment">//</span>
00140     <span class="comment">// Request timeout in seconds;</span>
00141     <span class="comment">//</span>
00142 
00143     ULONG TimeOutValue;
00144 
00145     <span class="comment">//</span>
00146     <span class="comment">// System device number</span>
00147     <span class="comment">//</span>
00148 
00149     ULONG DeviceNumber;
00150 
00151     <span class="comment">//</span>
00152     <span class="comment">// Add default Srb Flags.</span>
00153     <span class="comment">//</span>
00154 
00155     ULONG SrbFlags;
00156 
00157     <span class="comment">//</span>
00158     <span class="comment">// Total number of SCSI protocol errors on the device.</span>
00159     <span class="comment">//</span>
00160 
00161     ULONG ErrorCount;
00162 
00163     <span class="comment">//</span>
00164     <span class="comment">// Spinlock for split requests</span>
00165     <span class="comment">//</span>
00166 
00167     KSPIN_LOCK SplitRequestSpinLock;
00168 
00169     <span class="comment">//</span>
00170     <span class="comment">// Zone header and spin lock for zoned SRB requests.</span>
00171     <span class="comment">//</span>
00172 
<a name="l00173"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o20">00173</a>     <a class="code" href="../../d0/d0/struct__ZONE__HEADER.html">PZONE_HEADER</a> <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o20">SrbZone</a>;
00174 
<a name="l00175"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o21">00175</a>     PKSPIN_LOCK <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o21">SrbZoneSpinLock</a>;
00176 
00177     <span class="comment">//</span>
00178     <span class="comment">// Lock count for removable media.</span>
00179     <span class="comment">//</span>
00180 
00181     LONG <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o22">LockCount</a>;
00182 
00183     <span class="comment">//</span>
00184     <span class="comment">// Scsi port number</span>
00185     <span class="comment">//</span>
00186 
00187     UCHAR <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o23">PortNumber</a>;
00188 
00189     <span class="comment">//</span>
00190     <span class="comment">// SCSI path id</span>
00191     <span class="comment">//</span>
00192 
00193     UCHAR <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o24">PathId</a>;
00194 
00195     <span class="comment">//</span>
00196     <span class="comment">// SCSI bus target id</span>
00197     <span class="comment">//</span>
00198 
00199     UCHAR <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o25">TargetId</a>;
00200 
00201     <span class="comment">//</span>
00202     <span class="comment">// SCSI bus logical unit number</span>
00203     <span class="comment">//</span>
00204 
00205     UCHAR <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o26">Lun</a>;
00206 
00207     <span class="comment">//</span>
00208     <span class="comment">// Log2 of sector size</span>
00209     <span class="comment">//</span>
00210 
00211     UCHAR <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o27">SectorShift</a>;
00212 
00213     <span class="comment">//</span>
00214     <span class="comment">// Flag to indicate that the device has write caching enabled.</span>
00215     <span class="comment">//</span>
00216 
<a name="l00217"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o28">00217</a>     BOOLEAN <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o28">WriteCache</a>;
00218 
00219     <span class="comment">//</span>
00220     <span class="comment">// Build SCSI 1 or SCSI 2 CDBs</span>
00221     <span class="comment">//</span>
00222 
<a name="l00223"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o29">00223</a>     BOOLEAN <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o29">UseScsi1</a>;
00224 
00225 } <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">DEVICE_EXTENSION</a>, *<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a>;
00226 
00227 <span class="comment">//</span>
00228 <span class="comment">// Define context structure for asynchronous completions.</span>
00229 <span class="comment">//</span>
00230 
<a name="l00231"></a><a class="code" href="../../d0/d8/struct__COMPLETION__CONTEXT.html">00231</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d8/struct__COMPLETION__CONTEXT.html">_COMPLETION_CONTEXT</a> {
00232     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject;
00233     SCSI_REQUEST_BLOCK Srb;
00234 }<a class="code" href="../../d0/d8/struct__COMPLETION__CONTEXT.html">COMPLETION_CONTEXT</a>, *<a class="code" href="../../d0/d8/struct__COMPLETION__CONTEXT.html">PCOMPLETION_CONTEXT</a>;
00235 
00236 
00237 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00238 <a class="code" href="../../d4/d7/class2_8h.html#a23">ScsiClassGetCapabilities</a>(
00239     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject,
00240     OUT PIO_SCSI_CAPABILITIES *PortCapabilities
00241     );
00242 
00243 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00244 <a class="code" href="../../d4/d7/class2_8h.html#a24">ScsiClassGetInquiryData</a>(
00245     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject,
00246     IN PSCSI_ADAPTER_BUS_INFO *ConfigInfo
00247     );
00248 
00249 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00250 <a class="code" href="../../d4/d7/class2_8h.html#a25">ScsiClassReadDriveCapacity</a>(
00251     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00252     );
00253 
00254 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00255 <a class="code" href="../../d4/d7/class2_8h.html#a26">ScsiClassReleaseQueue</a>(
00256     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00257     );
00258 
00259 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00260 <a class="code" href="../../d4/d7/class2_8h.html#a27">ScsiClassRemoveDevice</a>(
00261     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject,
00262     IN UCHAR PathId,
00263     IN UCHAR TargetId,
00264     IN UCHAR Lun
00265     );
00266 
00267 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00268 <a class="code" href="../../d4/d7/class2_8h.html#a28">ScsiClassAsynchronousCompletion</a>(
00269     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00270     <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00271     PVOID Context
00272     );
00273 
00274 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00275 <a class="code" href="../../d4/d7/class2_8h.html#a29">ScsiClassSplitRequest</a>(
00276     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00277     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00278     IN ULONG MaximumBytes
00279     );
00280 
00281 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00282 <a class="code" href="../../d4/d7/class2_8h.html#a30">ScsiClassDeviceControl</a>(
00283     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00284     <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
00285     );
00286 
00287 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00288 <a class="code" href="../../d4/d7/class2_8h.html#a31">ScsiClassIoComplete</a>(
00289     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00290     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00291     IN PVOID Context
00292     );
00293 
00294 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00295 <a class="code" href="../../d4/d7/class2_8h.html#a33">ScsiClassIoCompleteAssociated</a>(
00296     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00297     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00298     IN PVOID Context
00299     );
00300 
00301 BOOLEAN
00302 <a class="code" href="../../d4/d7/class2_8h.html#a34">ScsiClassInterpretSenseInfo</a>(
00303     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00304     IN PSCSI_REQUEST_BLOCK Srb,
00305     IN UCHAR MajorFunctionCode,
00306     IN ULONG IoDeviceCode,
00307     IN ULONG RetryCount,
00308     OUT NTSTATUS *Status
00309     );
00310 
00311 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00312 <a class="code" href="../../d4/d7/class2_8h.html#a35">ScsiClassSendSrbSynchronous</a>(
00313         <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00314         PSCSI_REQUEST_BLOCK Srb,
00315         PVOID BufferAddress,
00316         ULONG BufferLength,
00317         BOOLEAN WriteToDevice
00318         );
00319 
00320 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00321 <a class="code" href="../../d4/d7/class2_8h.html#a36">ScsiClassSendSrbAsynchronous</a>(
00322         <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00323         PSCSI_REQUEST_BLOCK Srb,
00324         <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00325         PVOID BufferAddress,
00326         ULONG BufferLength,
00327         BOOLEAN WriteToDevice
00328         );
00329 
00330 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00331 <a class="code" href="../../d4/d7/class2_8h.html#a37">ScsiClassBuildRequest</a>(
00332     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00333     <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
00334     );
00335 
00336 ULONG
00337 <a class="code" href="../../d4/d7/class2_8h.html#a38">ScsiClassModeSense</a>(
00338     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00339     IN PCHAR ModeSenseBuffer,
00340     IN ULONG Length,
00341     IN UCHAR PageMode
00342     );
00343 
00344 BOOLEAN
00345 <a class="code" href="../../d4/d7/class2_8h.html#a39">ScsiClassModeSelect</a>(
00346     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00347     IN PCHAR ModeSelectBuffer,
00348     IN ULONG Length,
00349     IN BOOLEAN SavePage
00350     );
00351 
00352 PVOID
00353 <a class="code" href="../../d4/d7/class2_8h.html#a40">ScsiClassFindModePage</a>(
00354     IN PCHAR ModeSenseBuffer,
00355     IN ULONG Length,
00356     IN UCHAR PageMode
00357     );
00358 
00359 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00360 <a class="code" href="../../d4/d7/class2_8h.html#a41">ScsiClassClaimDevice</a>(
00361     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject,
00362     IN PSCSI_INQUIRY_DATA LunInfo,
00363     IN BOOLEAN Release,
00364     OUT <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> *NewPortDeviceObject OPTIONAL
00365     );
00366 
00367 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00368 <a class="code" href="../../d4/d7/class2_8h.html#a42">ScsiClassInternalIoControl</a> (
00369     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00370     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
00371     );
00372 
00373 <span class="preprocessor">#endif </span><span class="comment">/* _CLASS_ */</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
