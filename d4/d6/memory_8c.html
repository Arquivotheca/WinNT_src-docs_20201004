<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: memory.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>memory.c File Reference</h1><code>#include "<a class="el" href="../../d4/d2/arcinst_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d5/d5/memory_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/struct__SEGMENT__HEADER.html">_SEGMENT_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/struct__FREE__HEADER.html">_FREE_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d5/struct__BUSY__HEADER.html">_BUSY_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d6/struct__HEAP__HEADER.html">_HEAP_HEADER</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a0">FLAGS_FREE</a>&nbsp;&nbsp;&nbsp;0x00000000</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a1">FLAGS_BUSY</a>&nbsp;&nbsp;&nbsp;0x00000001</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a2">FLAGS_MASK</a>&nbsp;&nbsp;&nbsp;0x00000003</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a>&nbsp;&nbsp;&nbsp;16</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a4">HEAP_ZERO_EXTRA_MEMORY</a>&nbsp;&nbsp;&nbsp;0x00000008</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d1/struct__SEGMENT__HEADER.html">_SEGMENT_HEADER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a5">SEGMENT_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d1/struct__SEGMENT__HEADER.html">_SEGMENT_HEADER</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a6">PSEGMENT_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d0/struct__FREE__HEADER.html">_FREE_HEADER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a7">FREE_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d0/struct__FREE__HEADER.html">_FREE_HEADER</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a8">PFREE_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d5/struct__BUSY__HEADER.html">_BUSY_HEADER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a9">BUSY_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d5/struct__BUSY__HEADER.html">_BUSY_HEADER</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a10">PBUSY_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d6/struct__HEAP__HEADER.html">_HEAP_HEADER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a11">HEAP_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d6/struct__HEAP__HEADER.html">_HEAP_HEADER</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a12">PHEAP_HEADER</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a16">AlRtCreateHeap</a> (IN ULONG Flags, IN PVOID HeapBase, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a17">AlRtValidateHeap</a> (IN PVOID <a class="el" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>, IN BOOLEAN DumpHeap)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a18">AlRtAllocateHeap</a> (IN PVOID <a class="el" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a19">AlRtFreeHeap</a> (IN PVOID <a class="el" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>, IN PVOID BaseAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a20">AlRtReAllocateHeap</a> (IN PVOID <a class="el" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>, IN PVOID BaseAddress, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a21">AlMemoryInitialize</a> (ULONG StackPages, ULONG HeapPages)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a> (IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a> (IN PVOID HeapAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a24">AlReallocateHeap</a> (IN PVOID HeapAddress, IN ULONG NewSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a25">AlValidateHeap</a> (IN BOOLEAN DumpHeap)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a13">AlHeapFree</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a14">AlHeapLimit</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a3" doxytag="memory.c::ALLOCATION_GRANULARITY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ALLOCATION_GRANULARITY&nbsp;&nbsp;&nbsp;16          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00061">61</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">AlRtAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00119">AlRtCreateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="memory.c::FLAGS_BUSY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLAGS_BUSY&nbsp;&nbsp;&nbsp;0x00000001          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00052">52</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">AlRtAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="memory.c::FLAGS_FREE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLAGS_FREE&nbsp;&nbsp;&nbsp;0x00000000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00051">51</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="memory.c::FLAGS_MASK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FLAGS_MASK&nbsp;&nbsp;&nbsp;0x00000003          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00053">53</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="memory.c::HEAP_ZERO_EXTRA_MEMORY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define HEAP_ZERO_EXTRA_MEMORY&nbsp;&nbsp;&nbsp;0x00000008          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00107">107</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00991">AlMemoryInitialize()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00119">AlRtCreateHeap()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a9" doxytag="memory.c::BUSY_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d5/struct__BUSY__HEADER.html">_BUSY_HEADER</a>  <a class="el" href="../../d9/d5/struct__BUSY__HEADER.html">BUSY_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="memory.c::FREE_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d0/struct__FREE__HEADER.html">_FREE_HEADER</a>  <a class="el" href="../../d7/d0/struct__FREE__HEADER.html">FREE_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="memory.c::HEAP_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d6/struct__HEAP__HEADER.html">_HEAP_HEADER</a>  <a class="el" href="../../d3/d6/struct__HEAP__HEADER.html">HEAP_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="memory.c::PBUSY_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d5/struct__BUSY__HEADER.html">_BUSY_HEADER</a> * <a class="el" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">AlRtAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="memory.c::PFREE_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d0/struct__FREE__HEADER.html">_FREE_HEADER</a> * <a class="el" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">AlRtAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00119">AlRtCreateHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="memory.c::PHEAP_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d6/struct__HEAP__HEADER.html">_HEAP_HEADER</a> * <a class="el" href="../../d3/d6/struct__HEAP__HEADER.html">PHEAP_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">AlRtAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00119">AlRtCreateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="memory.c::PSEGMENT_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d1/struct__SEGMENT__HEADER.html">_SEGMENT_HEADER</a> * <a class="el" href="../../d2/d1/struct__SEGMENT__HEADER.html">PSEGMENT_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">AlRtAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="memory.c::SEGMENT_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d1/struct__SEGMENT__HEADER.html">_SEGMENT_HEADER</a>  <a class="el" href="../../d2/d1/struct__SEGMENT__HEADER.html">SEGMENT_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a22" doxytag="memory.c::AlAllocateHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID AlAllocateHeap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Size</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l01113">1113</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
References <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">AlRtAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00115">HeapHandle</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/almisc_8c-source.html#l00684">AlAddMenuItem()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l01150">AlCombinePaths()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l00026">AlGetEnvVarComponents()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l00647">AlNewMenu()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l01113">AlStrDup()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00812">LowGetDiskLayout()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>.
<p>
<pre class="fragment"><div>01116 {
01117     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d6/memory_8c.html#a18">AlRtAllocateHeap</a>
01118          (
01119          <a class="code" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>,
01120          <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>
01121          ));
01122 
01123 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="memory.c::AlDeallocateHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID AlDeallocateHeap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>HeapAddress</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l01134">1134</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
References <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00115">HeapHandle</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/almisc_8c-source.html#l01190">AlFreeArray()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l00209">AlFreeEnvVarComponents()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l00664">AlFreeMenu()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l01244">AlGetBase()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l00265">AlpFreeComponents()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00812">LowGetDiskLayout()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>.
<p>
<pre class="fragment"><div>01137 {
01138     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d6/memory_8c.html#a19">AlRtFreeHeap</a>
01139         (
01140         <a class="code" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>,
01141         HeapAddress
01142         ));
01143 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="memory.c::AlMemoryInitialize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> AlMemoryInitialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>StackPages</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>HeapPages</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00991">991</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
References <a class="el" href="../../d5/d5/memory_8c-source.html#l00112">AlHeapFree</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00113">AlHeapLimit</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00119">AlRtCreateHeap()</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01500">ArcGetMemoryDescriptor</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00432">_MEMORY_DESCRIPTOR::BasePage</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00107">HEAP_ZERO_EXTRA_MEMORY</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00115">HeapHandle</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00591">KSEG0_BASE</a>, <a class="el" href="../../d1/d9/arc_8h.html#a316a230">MemoryFree</a>, <a class="el" href="../../d1/d9/arc_8h.html#a316a232">MemoryLoadedProgram</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00431">_MEMORY_DESCRIPTOR::MemoryType</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00433">_MEMORY_DESCRIPTOR::PageCount</a>, and <a class="el" href="../../d1/d9/arc_8h.html#a74">PMEMORY_DESCRIPTOR</a>.
<p>
Referenced by <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00090">main()</a>.
<p>
<pre class="fragment"><div>00998                    :
00999 
01000     This routine allocates stack space <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> OS loader, initializes
01001     heap storage, and initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory allocation list.
01002 
01003 Arguments:
01004 
01005     None.
01006 
01007 Return Value:
01008 
01009     <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initialization <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successful. Otherwise,
01010     <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
01011 
01012 --*/
01013 
01014 {
01015 
01016     <a class="code" href="../../d3/d8/struct__MEMORY__DESCRIPTOR.html">PMEMORY_DESCRIPTOR</a> FreeDescriptor;
01017     <a class="code" href="../../d3/d8/struct__MEMORY__DESCRIPTOR.html">PMEMORY_DESCRIPTOR</a> ProgramDescriptor;
01018 
01019     <span class="comment">//</span>
01020     <span class="comment">// Find the memory descriptor that describes the allocation for the OS</span>
01021     <span class="comment">// loader itself.</span>
01022     <span class="comment">//</span>
01023 
01024     ProgramDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01025     <span class="keywordflow">while</span> ((ProgramDescriptor = <a class="code" href="../../d1/d9/arc_8h.html#a26">ArcGetMemoryDescriptor</a>(ProgramDescriptor)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01026         <span class="keywordflow">if</span> (ProgramDescriptor-&gt;<a class="code" href="../../d3/d8/struct__MEMORY__DESCRIPTOR.html#o0">MemoryType</a> == <a class="code" href="../../d1/d9/arc_8h.html#a316a232">MemoryLoadedProgram</a>) {
01027             <span class="keywordflow">break</span>;
01028         }
01029     }
01030 
01031     <span class="comment">//</span>
01032     <span class="comment">// If a loaded program memory descriptor was found, then it must be</span>
01033     <span class="comment">// for the OS loader since that is the only program that can be loaded.</span>
01034     <span class="comment">// If a loaded program memory descriptor was not found, then firmware</span>
01035     <span class="comment">// is not functioning properly and an unsuccessful status is returned.</span>
01036     <span class="comment">//</span>
01037 
01038     <span class="keywordflow">if</span> (ProgramDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01039         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>;
01040     }
01041 
01042     <span class="comment">//</span>
01043     <span class="comment">// Find the free memory descriptor that is just below the loaded</span>
01044     <span class="comment">// program in memory. There should be several megabytes of free</span>
01045     <span class="comment">// memory just preceeding the OS loader.</span>
01046     <span class="comment">//</span>
01047 
01048     FreeDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01049     <span class="keywordflow">while</span> ((FreeDescriptor = <a class="code" href="../../d1/d9/arc_8h.html#a26">ArcGetMemoryDescriptor</a>(FreeDescriptor)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01050         <span class="keywordflow">if</span> ((FreeDescriptor-&gt;<a class="code" href="../../d3/d8/struct__MEMORY__DESCRIPTOR.html#o0">MemoryType</a> == <a class="code" href="../../d1/d9/arc_8h.html#a316a230">MemoryFree</a>) &amp;&amp;
01051             (FreeDescriptor-&gt;<a class="code" href="../../d3/d8/struct__MEMORY__DESCRIPTOR.html#o2">PageCount</a> &gt;= (StackPages+HeapPages))) {
01052             <span class="keywordflow">break</span>;
01053         }
01054     }
01055 
01056     <span class="comment">//</span>
01057     <span class="comment">// If a free memory descriptor was not found that describes the free</span>
01058     <span class="comment">// memory just below the OS loader, then firmware is not functioning</span>
01059     <span class="comment">// properly and an unsuccessful status is returned.</span>
01060     <span class="comment">//</span>
01061 
01062     <span class="keywordflow">if</span> (FreeDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01063         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>;
01064     }
01065 
01066     <span class="comment">//</span>
01067     <span class="comment">// Check to determine if enough free memory is available for the OS</span>
01068     <span class="comment">// loader stack and the heap area. If enough memory is not available,</span>
01069     <span class="comment">// then return an unsuccessful status.</span>
01070     <span class="comment">//</span>
01071 
01072     <span class="keywordflow">if</span> (FreeDescriptor-&gt;<a class="code" href="../../d3/d8/struct__MEMORY__DESCRIPTOR.html#o2">PageCount</a> &lt; (StackPages + HeapPages)) {
01073         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>;
01074     }
01075 
01076     <span class="comment">//</span>
01077     <span class="comment">// Compute the address of the loader heap, initialize the heap</span>
01078     <span class="comment">// allocation variables, and zero the heap memory.</span>
01079     <span class="comment">//</span>
01080 
01081     <a class="code" href="../../d4/d6/memory_8c.html#a13">AlHeapFree</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a443">KSEG0_BASE</a> | ((ProgramDescriptor-&gt;<a class="code" href="../../d3/d8/struct__MEMORY__DESCRIPTOR.html#o1">BasePage</a> -
01082                 (StackPages + HeapPages)) &lt;&lt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>);
01083 
01084     <a class="code" href="../../d4/d6/memory_8c.html#a14">AlHeapLimit</a> = <a class="code" href="../../d4/d6/memory_8c.html#a13">AlHeapFree</a> + (HeapPages &lt;&lt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>);
01085 
01086     memset((PVOID)AlHeapFree, 0,HeapPages &lt;&lt; PAGE_SHIFT);
01087 
01088 
01089     <span class="comment">//</span>
01090     <span class="comment">// Changed to new heap allocater</span>
01091     <span class="comment">//</span>
01092 
01093     <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a> = <a class="code" href="../../d4/d6/memory_8c.html#a16">AlRtCreateHeap</a>
01094             (
01095             <a class="code" href="../../d4/d6/memory_8c.html#a4">HEAP_ZERO_EXTRA_MEMORY</a>,
01096             (PVOID)<a class="code" href="../../d4/d6/memory_8c.html#a13">AlHeapFree</a>,
01097             HeapPages &lt;&lt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>
01098             ))
01099             == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01100        <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>;
01101     <span class="keywordflow">else</span>
01102        <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>;
01103 
01104 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="memory.c::AlReallocateHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID AlReallocateHeap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HeapAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NewSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l01153">1153</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
References <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00115">HeapHandle</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/almisc_8c-source.html#l00684">AlAddMenuItem()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l00812">LowGetDiskLayout()</a>.
<p>
<pre class="fragment"><div>01157 {
01158     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d6/memory_8c.html#a20">AlRtReAllocateHeap</a>
01159         (
01160         <a class="code" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>,
01161         HeapAddress,
01162         NewSize
01163         ));
01164 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="memory.c::AlRtAllocateHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID AlRtAllocateHeap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HeapHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">365</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
References <a class="el" href="../../d5/d5/memory_8c-source.html#l00061">ALLOCATION_GRANULARITY</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l01483">AlPrint()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00352">AlRtValidateHeap()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00052">FLAGS_BUSY</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00095">_HEAP_HEADER::FreeList</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00041">_BUSY_HEADER::HandleValue</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00115">HeapHandle</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00071">_HEAP_HEADER::Length</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00025">_FREE_HEADER::Next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d6/memory_8c.html#a10">PBUSY_HEADER</a>, <a class="el" href="../../d4/d6/memory_8c.html#a8">PFREE_HEADER</a>, <a class="el" href="../../d4/d6/memory_8c.html#a12">PHEAP_HEADER</a>, <a class="el" href="../../d4/d6/memory_8c.html#a6">PSEGMENT_HEADER</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00039">_BUSY_HEADER::Segment</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00027">_FREE_HEADER::Segment</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00040">_BUSY_HEADER::Size</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00026">_FREE_HEADER::Size</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00042">_BUSY_HEADER::Spare</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00078">_HEAP_HEADER::ZeroExtraMemory</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l01113">AlAllocateHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>.
<p>
<pre class="fragment"><div>00369 {
00370     <a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">PHEAP_HEADER</a> Heap = (<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">PHEAP_HEADER</a>)<a class="code" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>;
00371     ULONG allocationSize;
00372 <span class="comment">//    PSEGMENT_HEADER Segment;</span>
00373     <a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a> FreeBlock;
00374     <a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a> PreviousFreeBlock;
00375     <a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a> NewFreeBlock;
00376     <a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a> BusyBlock;
00377 
00378 
00379     <span class="comment">//</span>
00380     <span class="comment">// Validate that HeapAddress points to a HEAP_HEADER structure.</span>
00381     <span class="comment">//</span>
00382 
00383     <span class="keywordflow">if</span> (Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o0">Length</a> != <span class="keyword">sizeof</span>( <a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">HEAP_HEADER</a> )) {
00384 <span class="preprocessor">#if DBG</span>
00385 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Invalid heap header- %lx\n"</span>, Heap );
00386 <span class="preprocessor">#endif // DBG</span>
00387 <span class="preprocessor"></span>        <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00388         }
00389 
00390     <span class="comment">//</span>
00391     <span class="comment">// Additional check, see if the heap is valid, call the heap validation</span>
00392     <span class="comment">// code, requesting it to not dump stuff.</span>
00393     <span class="comment">//</span>
00394     <span class="keywordflow">if</span>(!<a class="code" href="../../d4/d6/memory_8c.html#a17">AlRtValidateHeap</a>( HeapHandle, FALSE)) {
00395 
00396 <span class="preprocessor">#if DBG</span>
00397 <span class="preprocessor"></span>        <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(<span class="stringliteral">"Heap validation failed\n"</span>);
00398 <span class="preprocessor">#endif</span>
00399 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00400     }
00401 
00402 
00403     <span class="comment">//</span>
00404     <span class="comment">// Round the requested size up to the allocation granularity.  Note</span>
00405     <span class="comment">// that if the request is for 0 bytes, we still allocate memory.</span>
00406     <span class="comment">//</span>
00407 
00408     allocationSize = ((<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> ? <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> : <a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a>) +
00409                       <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">BUSY_HEADER</a> ) +
00410                       <a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a> -
00411                       1
00412                      ) &amp; ~(<a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a> - 1);
00413     <span class="keywordflow">if</span> (allocationSize &lt; <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
00414 <span class="preprocessor">#if DBG</span>
00415 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Invalid heap size - %lx\n"</span>, Size );
00416 <span class="comment">//   RtlpBreakPointHeap();</span>
00417 <span class="preprocessor">#endif // DBG</span>
00418 <span class="preprocessor"></span>        <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00419     }
00420 
00421     <span class="comment">//</span>
00422     <span class="comment">// Point to the free list header.</span>
00423     <span class="comment">//</span>
00424 
00425     FreeBlock = &amp;Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o5">FreeList</a>;
00426 <span class="preprocessor">#if DBG</span>
00427 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> != 0) {
00428     <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Heap free list HEAD hosed at %lx\n"</span>, FreeBlock );
00429 <span class="comment">//   RtlpBreakPointHeap();</span>
00430 
00431     <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00432         }
00433 <span class="preprocessor">#endif // DBG</span>
00434 <span class="preprocessor"></span>
00435     <span class="comment">//</span>
00436     <span class="comment">// Continuous loop.  We'll break out of the loop when we've found</span>
00437     <span class="comment">// (or created) some free memory.</span>
00438     <span class="comment">//</span>
00439 
00440     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00441         <span class="comment">//</span>
00442         <span class="comment">// Have we reached the end of the free list?</span>
00443         <span class="comment">//</span>
00444 
00445     <span class="keywordflow">if</span> (FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00446         <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00447         <span class="keywordflow">else</span> {
00448             <span class="comment">//</span>
00449             <span class="comment">// Point to the next free block, saving a pointer to the</span>
00450             <span class="comment">// previous one.</span>
00451             <span class="comment">//</span>
00452 
00453             PreviousFreeBlock = FreeBlock;
00454             FreeBlock = PreviousFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a>;
00455             }
00456 
00457 <span class="preprocessor">#if DBG</span>
00458 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> == 0) {
00459         <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Heap free list ENTRY hosed at %lx\n"</span>,
00460                       FreeBlock
00461                     );
00462 <span class="comment">//       RtlpBreakPointHeap();</span>
00463         <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00464             }
00465 <span class="preprocessor">#endif // DBG</span>
00466 <span class="preprocessor"></span>
00467         <span class="comment">//</span>
00468         <span class="comment">// We haven't exhausted the free list yet.  If this block is</span>
00469         <span class="comment">// large enough for what we need, break out of the while loop.</span>
00470         <span class="comment">//</span>
00471 
00472         <span class="keywordflow">if</span> (FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> &gt;= allocationSize) {
00473             <span class="keywordflow">break</span>;
00474             }
00475 
00476         } <span class="comment">// while ( TRUE )</span>
00477 
00478     <span class="comment">//</span>
00479     <span class="comment">// We have found a free block that is large enough to hold what the</span>
00480     <span class="comment">// user requested.  If it's exactly the right size, simply point the</span>
00481     <span class="comment">// previous free block to the successor of this free block.  If it's</span>
00482     <span class="comment">// larger than what we want, we allocate from the front of the block,</span>
00483     <span class="comment">// leaving the trailing part free.  Exactly the right size is fuzzy,</span>
00484     <span class="comment">// as if we decide to split we need at least enough extra space for</span>
00485     <span class="comment">// a free header plus some space to statisfy an allocation.</span>
00486     <span class="comment">//</span>
00487 
00488     <span class="keywordflow">if</span> ((FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> - allocationSize) &lt; (2 * <span class="keyword">sizeof</span>( <a class="code" href="../../d7/d0/struct__FREE__HEADER.html">FREE_HEADER</a> ))) {
00489         <span class="comment">//</span>
00490         <span class="comment">// If the amount of extra space is less than twice the size of</span>
00491         <span class="comment">// a free header, just give the caller all the space, as the</span>
00492         <span class="comment">// extra amount is too small to waste a free block on.</span>
00493         <span class="comment">//</span>
00494 
00495         allocationSize = FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a>;
00496 
00497         <span class="comment">//</span>
00498         <span class="comment">// Exactly the right size.  Point previous free block to the</span>
00499         <span class="comment">// next free block.</span>
00500         <span class="comment">//</span>
00501 
00502         PreviousFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a> = FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a>;
00503 
00504         }
00505     <span class="keywordflow">else</span> {
00506 
00507         <span class="comment">//</span>
00508         <span class="comment">// More memory than we need.  Make the trailing part of the block</span>
00509         <span class="comment">// into a free block.  Point the previous block to the new block</span>
00510         <span class="comment">// and the new block to the next block.</span>
00511         <span class="comment">//</span>
00512 
00513         NewFreeBlock = (<a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a>)((PCH)FreeBlock + allocationSize);
00514         PreviousFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a> = NewFreeBlock;
00515         NewFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a> = FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a>;
00516         NewFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> = FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> - allocationSize;
00517         NewFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o2">Segment</a> = FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o2">Segment</a>;
00518         }
00519 
00520     <span class="comment">//</span>
00521     <span class="comment">// Set up the header for the allocated block.</span>
00522     <span class="comment">//</span>
00523 
00524     BusyBlock = (<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>)FreeBlock;
00525     BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o0">Segment</a> = (<a class="code" href="../../d2/d1/struct__SEGMENT__HEADER.html">PSEGMENT_HEADER</a>)((ULONG)FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o2">Segment</a> |
00526                                            <a class="code" href="../../d4/d6/memory_8c.html#a1">FLAGS_BUSY</a>
00527                                           );
00528     BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o1">Size</a> = allocationSize;
00529     BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o2">HandleValue</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00530 
00531     <span class="keywordflow">if</span> (Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o1">ZeroExtraMemory</a>) {
00532      ULONG extraSize;
00533 
00534      extraSize = allocationSize - <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> - <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">BUSY_HEADER</a> );
00535      memset( (PCHAR)BusyBlock + (allocationSize - extraSize),
00536             0,
00537             extraSize
00538               );
00539      }
00540 
00541 <span class="preprocessor">#if DBG</span>
00542 <span class="preprocessor"></span>    BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o3">Spare</a> = 0;
00543 <span class="preprocessor">#endif</span>
00544 <span class="preprocessor"></span>
00545     <span class="comment">//</span>
00546     <span class="comment">// Return the address of the user portion of the allocated block.</span>
00547     <span class="comment">// This is the byte following the header.</span>
00548     <span class="comment">//</span>
00549 
00550     <span class="keywordflow">return</span>( (PVOID)(BusyBlock + 1) );
00551 } <span class="comment">// AlRtAllocateHeap</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="memory.c::AlRtCreateHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID AlRtCreateHeap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HeapBase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00119">119</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
References <a class="el" href="../../d5/d5/memory_8c-source.html#l00061">ALLOCATION_GRANULARITY</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00089">_HEAP_HEADER::EndAddress</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00095">_HEAP_HEADER::FreeList</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00107">HEAP_ZERO_EXTRA_MEMORY</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00071">_HEAP_HEADER::Length</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00025">_FREE_HEADER::Next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d6/memory_8c.html#a8">PFREE_HEADER</a>, <a class="el" href="../../d4/d6/memory_8c.html#a12">PHEAP_HEADER</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00027">_FREE_HEADER::Segment</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00026">_FREE_HEADER::Size</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00084">_HEAP_HEADER::ValidAddress</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00078">_HEAP_HEADER::ZeroExtraMemory</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00991">AlMemoryInitialize()</a>.
<p>
<pre class="fragment"><div>00127                    :
00128 
00129     This routine initializes a heap.
00130 
00131 Arguments:
00132 
00133     Flags - Specifies optional attributes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> heap.
00134 
00135         Valid Flags Values:
00136         <a class="code" href="../../d4/d6/memory_8c.html#a4">HEAP_ZERO_EXTRA_MEMORY</a>. to make sure that extra memory passed
00137                     in <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> zeroed <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a>.
00138 
00139     HeapBase - <span class="keywordflow">if</span> not <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <span class="keyword">this</span> specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base address <span class="keywordflow">for</span> memory
00140     to use as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> heap.  If <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, memory <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allocated by these <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a>.
00141 
00142     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> - <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> block of memory passed in to be used as a heap
00143 
00144 Return Value:
00145 
00146     PVOID - a pointer to be used in accessing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> created heap.
00147 
00148 --*/
00149 
00150 {
00151     <a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">PHEAP_HEADER</a> Heap = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00152     <a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a> FreeBlock;
00153 
00154 
00155     Heap          = (<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">PHEAP_HEADER</a>)HeapBase;
00156     Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o0">Length</a>      = <span class="keyword">sizeof</span>( <a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">HEAP_HEADER</a> );
00157     Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o1">ZeroExtraMemory</a> = (BOOLEAN)((Flags &amp; <a class="code" href="../../d4/d6/memory_8c.html#a4">HEAP_ZERO_EXTRA_MEMORY</a>) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00158     Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o2">ValidAddress</a>    = (PCH)Heap + ((<span class="keyword">sizeof</span>(*Heap) + (<a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a>-1)) &amp; ~(<a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a>-1));
00159     Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o3">EndAddress</a>      = (PCH)Heap + <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00160 
00161     <span class="comment">//</span>
00162     <span class="comment">// Initialize the free list to be a single block that starts immediately</span>
00163     <span class="comment">// after the heap header.</span>
00164     <span class="comment">//</span>
00165 
00166     FreeBlock = (<a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a>)Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o2">ValidAddress</a>;
00167     FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00168     FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> = (ULONG)Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o3">EndAddress</a> -
00169                       (ULONG)FreeBlock;
00170     FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o2">Segment</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00171 
00172     Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o5">FreeList</a>.<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a> = FreeBlock;
00173     Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o5">FreeList</a>.<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> = 0;
00174     Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o5">FreeList</a>.<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o2">Segment</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00175 
00176     <span class="keywordflow">return</span>( (PVOID)Heap );
00177 } <span class="comment">// AlRtCreateHeap</span>

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="memory.c::AlRtFreeHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID AlRtFreeHeap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HeapHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">555</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
References <a class="el" href="../../d5/d5/memory_8c-source.html#l00061">ALLOCATION_GRANULARITY</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l01483">AlPrint()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00352">AlRtValidateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00089">_HEAP_HEADER::EndAddress</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00052">FLAGS_BUSY</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00053">FLAGS_MASK</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00095">_HEAP_HEADER::FreeList</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00115">HeapHandle</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00071">_HEAP_HEADER::Length</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00025">_FREE_HEADER::Next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d6/memory_8c.html#a10">PBUSY_HEADER</a>, <a class="el" href="../../d4/d6/memory_8c.html#a8">PFREE_HEADER</a>, <a class="el" href="../../d4/d6/memory_8c.html#a12">PHEAP_HEADER</a>, <a class="el" href="../../d4/d6/memory_8c.html#a6">PSEGMENT_HEADER</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00027">_FREE_HEADER::Segment</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00039">_BUSY_HEADER::Segment</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00026">_FREE_HEADER::Size</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00013">_SEGMENT_HEADER::Size</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00040">_BUSY_HEADER::Size</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00084">_HEAP_HEADER::ValidAddress</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l01134">AlDeallocateHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>.
<p>
<pre class="fragment"><div>00559 {
00560     <a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">PHEAP_HEADER</a> Heap = (<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">PHEAP_HEADER</a>)<a class="code" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>;
00561     <a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a> FreeBlock;
00562     <a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a> PreviousFreeBlock;
00563     <a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a> SecondPrevFreeBlock;
00564     <a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a> BusyBlock;
00565     <a class="code" href="../../d2/d1/struct__SEGMENT__HEADER.html">PSEGMENT_HEADER</a> BusySegment;
00566     ULONG BusyFlags;
00567     ULONG BusySize;
00568 
00569     <span class="keywordflow">if</span> (BaseAddress == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00570         <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00571         }
00572 
00573     <span class="comment">//</span>
00574     <span class="comment">// Validate that HeapAddress points to a HEAP_HEADER structure.</span>
00575     <span class="comment">//</span>
00576 
00577     <span class="keywordflow">if</span> (Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o0">Length</a> != <span class="keyword">sizeof</span>( <a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">HEAP_HEADER</a> )) {
00578 <span class="preprocessor">#if DBG</span>
00579 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Invalid heap header- %lx\n"</span>, Heap );
00580 <span class="comment">//   RtlpBreakPointHeap();</span>
00581 <span class="preprocessor">#endif // DBG</span>
00582 <span class="preprocessor"></span>        <span class="keywordflow">return</span>( BaseAddress );
00583         }
00584 
00585     <span class="comment">//</span>
00586     <span class="comment">// Additional check, see if the heap is valid, call the heap validation</span>
00587     <span class="comment">// code, requesting it to not dump stuff.</span>
00588     <span class="comment">//</span>
00589     <span class="keywordflow">if</span>(!<a class="code" href="../../d4/d6/memory_8c.html#a17">AlRtValidateHeap</a>( HeapHandle, FALSE)) {
00590 
00591 <span class="preprocessor">#if DBG</span>
00592 <span class="preprocessor"></span>        <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(<span class="stringliteral">"Heap validation failed\n"</span>);
00593 <span class="preprocessor">#endif</span>
00594 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( BaseAddress );
00595     }
00596 
00597 
00598     <span class="comment">//</span>
00599     <span class="comment">// Get the 'real' address of the allocation unit.  (That is, the</span>
00600     <span class="comment">// address of the allocation header.)  Make sure the address lies</span>
00601     <span class="comment">// within the bounds of the valid portion of the heap.</span>
00602     <span class="comment">//</span>
00603 
00604     BusyBlock = (<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>)BaseAddress - 1;
00605     BusyFlags = (ULONG)BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o0">Segment</a> &amp; <a class="code" href="../../d4/d6/memory_8c.html#a2">FLAGS_MASK</a>;
00606     BusySegment = (<a class="code" href="../../d2/d1/struct__SEGMENT__HEADER.html">PSEGMENT_HEADER</a>)((ULONG)BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o0">Segment</a> &amp; ~<a class="code" href="../../d4/d6/memory_8c.html#a2">FLAGS_MASK</a>);
00607     BusySize = BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o1">Size</a>;
00608 
00609     <span class="keywordflow">if</span> (BusyFlags != <a class="code" href="../../d4/d6/memory_8c.html#a1">FLAGS_BUSY</a>
00610 <span class="preprocessor">#if DBG</span>
00611 <span class="preprocessor"></span>        || (BusySegment == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00612             ((PCHAR)BusyBlock &lt; (PCHAR)Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o2">ValidAddress</a> ||
00613          (PCHAR)BusyBlock &gt;= (PCHAR)Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o3">EndAddress</a>
00614             )
00615         ) ||
00616         (BusySegment != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00617             (BusyBlock &lt; (<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>)(BusySegment+1) ||
00618              BusyBlock &gt;= (<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>)((ULONG)BusySegment + BusySegment-&gt;<a class="code" href="../../d2/d1/struct__SEGMENT__HEADER.html#o1">Size</a>)
00619             )
00620         ) ||
00621         (BusySize &lt; <a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a>
00622         ) ||
00623         (BusySize &amp; (<a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a>-1) != 0
00624         )
00625 <span class="preprocessor">#endif // DBG</span>
00626 <span class="preprocessor"></span>       ) {
00627 <span class="preprocessor">#if DBG</span>
00628 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Invalid Address specified to AlRtFreeHeap( %lx, %lx )\n"</span>,
00629                   Heap,
00630                   BaseAddress
00631                 );
00632 <span class="comment">//   RtlpBreakPointHeap();</span>
00633 <span class="preprocessor">#endif // DBG</span>
00634 <span class="preprocessor"></span>        <span class="keywordflow">return</span>( BaseAddress );
00635         }
00636 
00637 
00638     <span class="comment">//</span>
00639     <span class="comment">// Free blocks are stored in the free list in ascending order by</span>
00640     <span class="comment">// base address.  As we search the free list to find the place for</span>
00641     <span class="comment">// this block, we remember the previous two free blocks that we</span>
00642     <span class="comment">// passed through.  These are used during combining of adjacent</span>
00643     <span class="comment">// free blocks.</span>
00644     <span class="comment">//</span>
00645 
00646     SecondPrevFreeBlock = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00647     PreviousFreeBlock = &amp;Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o5">FreeList</a>;
00648 <span class="preprocessor">#if DBG</span>
00649 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (PreviousFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> != 0) {
00650     <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Heap free list HEAD hosed at %lx\n"</span>,
00651                   PreviousFreeBlock
00652                 );
00653 <span class="comment">//   RtlpBreakPointHeap();</span>
00654 
00655         <span class="keywordflow">return</span>( BaseAddress );
00656         }
00657 <span class="preprocessor">#endif // DBG</span>
00658 <span class="preprocessor"></span>
00659     <span class="comment">//</span>
00660     <span class="comment">// Continuous loop.  We'll break out of the loop when we've found</span>
00661     <span class="comment">// the first block of free memory whose address is larger than the</span>
00662     <span class="comment">// address of the block being freed.  (Or the end of the free list.)</span>
00663     <span class="comment">//</span>
00664 
00665     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00666 
00667         <span class="comment">//</span>
00668         <span class="comment">// Get the address of the next free block.  If we've exhausted</span>
00669         <span class="comment">// the free list, break out of the loop -- the block we're</span>
00670         <span class="comment">// freeing goes at the end of the list.</span>
00671         <span class="comment">//</span>
00672 
00673         FreeBlock = PreviousFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a>;
00674 
00675         <span class="keywordflow">if</span> (FreeBlock == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00676             <span class="keywordflow">break</span>;
00677             }
00678 
00679 <span class="preprocessor">#if DBG</span>
00680 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> == 0) {
00681         <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Heap free list ENTRY hosed at %lx\n"</span>,
00682                       FreeBlock
00683                     );
00684 <span class="comment">//       RtlpBreakPointHeap();</span>
00685 
00686             <span class="keywordflow">return</span>( BaseAddress );
00687             }
00688 <span class="preprocessor">#endif // DBG</span>
00689 <span class="preprocessor"></span>
00690         <span class="comment">//</span>
00691         <span class="comment">// If the address of the current block is higher than the</span>
00692         <span class="comment">// address of the block we're freeing, break out of the loop.</span>
00693         <span class="comment">// The freed block goes immediately before the current block.</span>
00694         <span class="comment">//</span>
00695 
00696         <span class="keywordflow">if</span> (FreeBlock &gt; (<a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a>)BusyBlock) {
00697             <span class="keywordflow">break</span>;
00698             }
00699 
00700         <span class="comment">//</span>
00701         <span class="comment">// We haven't found the spot yet.  Remember the last two blocks.</span>
00702         <span class="comment">//</span>
00703 
00704         SecondPrevFreeBlock = PreviousFreeBlock;
00705         PreviousFreeBlock = FreeBlock;
00706 
00707         } <span class="comment">// while ( TRUE )</span>
00708 
00709 
00710     <span class="comment">//</span>
00711     <span class="comment">// We've found the place for the block we're freeing.  If the previous</span>
00712     <span class="comment">// block is adjacent to this one, merge the two by summing their sizes,</span>
00713     <span class="comment">// adjusting the address of the block being freed, and making the second</span>
00714     <span class="comment">// previous block the first previous block.  (Note that the previous</span>
00715     <span class="comment">// block may actually be the listhead.  In this case, the if condition</span>
00716     <span class="comment">// will never be true, because the Size of the listhead is 0.)</span>
00717     <span class="comment">//</span>
00718 
00719     <span class="keywordflow">if</span> (((PCH)PreviousFreeBlock + PreviousFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a>) == (PCH)BusyBlock &amp;&amp;
00720         PreviousFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o2">Segment</a> == BusySegment
00721        ) {
00722         BusySize += PreviousFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a>;
00723         BusyBlock = (<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>)PreviousFreeBlock;
00724         PreviousFreeBlock = SecondPrevFreeBlock;
00725 <span class="preprocessor">#if DBG</span>
00726 <span class="preprocessor"></span>        }
00727     <span class="keywordflow">else</span>
00728     <span class="keywordflow">if</span> ((PreviousFreeBlock != &amp;Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o5">FreeList</a>) &amp;&amp;
00729         ((PCH)PreviousFreeBlock + PreviousFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a>) &gt; (PCH)BusyBlock
00730        ) {
00731     <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Heap free list overlaps freed block at %lx\n"</span>,
00732                   BusyBlock
00733                 );
00734 <span class="comment">//   RtlpBreakPointHeap();</span>
00735 
00736     <span class="keywordflow">return</span>( BaseAddress );
00737 <span class="preprocessor">#endif // DBG</span>
00738 <span class="preprocessor"></span>        }
00739 
00740     <span class="comment">//</span>
00741     <span class="comment">// If the block being freed is adjacent to the current block, merge</span>
00742     <span class="comment">// the two by summing their sizes and making the next block the</span>
00743     <span class="comment">// current block.  (Note that the current block may not exist, in</span>
00744     <span class="comment">// which case FreeBlock == NULL, and the if condition will not be</span>
00745     <span class="comment">// true.)</span>
00746     <span class="comment">//*** There is an assumption here that we'll never EVER use the</span>
00747     <span class="comment">//*** very highest part of the address space for user mode allocatable</span>
00748     <span class="comment">//*** memory!</span>
00749     <span class="comment">//</span>
00750 
00751     <span class="keywordflow">if</span> (((PCH)BusyBlock + BusySize) == (PCH)FreeBlock &amp;&amp;
00752         FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o2">Segment</a> == BusySegment
00753        ) {
00754         BusySize += FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a>;
00755         FreeBlock = FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a>;
00756 <span class="preprocessor">#if DBG</span>
00757 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (FreeBlock != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00758             <span class="keywordflow">if</span> (FreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> == 0) {
00759         <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Heap free list ENTRY hosed at %lx\n"</span>,
00760                           FreeBlock
00761                         );
00762 <span class="comment">//       RtlpBreakPointHeap();</span>
00763 
00764         <span class="keywordflow">return</span>( BaseAddress );
00765                 }
00766             }
00767         }
00768     <span class="keywordflow">else</span>
00769     <span class="keywordflow">if</span> ((FreeBlock != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00770         ((PCH)BusyBlock + BusySize) &gt; (PCH)FreeBlock
00771        ) {
00772     <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Freed block overlaps heap free list at %lx\n"</span>,
00773                   BusyBlock
00774                 );
00775 <span class="comment">//   RtlpBreakPointHeap();</span>
00776 
00777     <span class="keywordflow">return</span>( BaseAddress );
00778 <span class="preprocessor">#endif // DBG</span>
00779 <span class="preprocessor"></span>        }
00780 
00781     <span class="comment">//</span>
00782     <span class="comment">// Done merging.  Update the free list and the free block header.</span>
00783     <span class="comment">//*** May want to reclaim (i.e., release) pages sometime.  That is,</span>
00784     <span class="comment">//*** if we find ourselves with oodles of contiguous pages on the</span>
00785     <span class="comment">//*** free list, we could delete them from our address space.  On</span>
00786     <span class="comment">//*** the other hand, it probably doesn't cost very much to keep</span>
00787     <span class="comment">//*** them around, and if the process needed that much memory once,</span>
00788     <span class="comment">//*** it's likely to need it again.</span>
00789     <span class="comment">//</span>
00790 
00791     PreviousFreeBlock-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o0">Next</a> = (<a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a>)BusyBlock;
00792     ((<a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a>)BusyBlock)-&gt;Next = FreeBlock;
00793     ((<a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a>)BusyBlock)-&gt;<a class="code" href="../../d7/d0/struct__FREE__HEADER.html#o1">Size</a> = BusySize;
00794     ((<a class="code" href="../../d7/d0/struct__FREE__HEADER.html">PFREE_HEADER</a>)BusyBlock)-&gt;Segment = BusySegment;
00795 
00796     <span class="comment">//</span>
00797     <span class="comment">// Release the free list lock and return to the caller.</span>
00798     <span class="comment">//</span>
00799 
00800 
00801     <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00802 } <span class="comment">// AlRtFreeHeap</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="memory.c::AlRtReAllocateHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID AlRtReAllocateHeap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HeapHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">807</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
References <a class="el" href="../../d5/d5/memory_8c-source.html#l00061">ALLOCATION_GRANULARITY</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l01483">AlPrint()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">AlRtAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00352">AlRtValidateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00089">_HEAP_HEADER::EndAddress</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00052">FLAGS_BUSY</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00053">FLAGS_MASK</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00115">HeapHandle</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00071">_HEAP_HEADER::Length</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d6/memory_8c.html#a10">PBUSY_HEADER</a>, <a class="el" href="../../d4/d6/memory_8c.html#a12">PHEAP_HEADER</a>, <a class="el" href="../../d4/d6/memory_8c.html#a6">PSEGMENT_HEADER</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00039">_BUSY_HEADER::Segment</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00013">_SEGMENT_HEADER::Size</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00040">_BUSY_HEADER::Size</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00042">_BUSY_HEADER::Spare</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00084">_HEAP_HEADER::ValidAddress</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00078">_HEAP_HEADER::ZeroExtraMemory</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l01153">AlReallocateHeap()</a>.
<p>
<pre class="fragment"><div>00812 {
00813     <a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">PHEAP_HEADER</a> Heap = (<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">PHEAP_HEADER</a>)<a class="code" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>;
00814     PVOID NewBaseAddress;
00815     ULONG allocationSize;
00816     <a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a> BusyBlock;
00817     <a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a> ExtraBusyBlock;
00818     <a class="code" href="../../d2/d1/struct__SEGMENT__HEADER.html">PSEGMENT_HEADER</a> BusySegment;
00819     ULONG BusyFlags;
00820     ULONG BusySize;
00821     LONG DeltaSize;
00822 
00823     <span class="comment">//</span>
00824     <span class="comment">// Validate that HeapAddress points to a HEAP_HEADER structure.</span>
00825     <span class="comment">//</span>
00826 
00827     <span class="keywordflow">if</span> (Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o0">Length</a> != <span class="keyword">sizeof</span>( <a class="code" href="../../d3/d6/struct__HEAP__HEADER.html">HEAP_HEADER</a> )) {
00828 <span class="preprocessor">#if DBG</span>
00829 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Invalid heap header- %lx\n"</span>, Heap );
00830 <span class="comment">//   RtlpBreakPointHeap();</span>
00831 <span class="preprocessor">#endif // DBG</span>
00832 <span class="preprocessor"></span>        <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00833         }
00834 
00835     <span class="comment">//</span>
00836     <span class="comment">// Additional check, see if the heap is valid, call the heap validation</span>
00837     <span class="comment">// code, requesting it to not dump stuff.</span>
00838     <span class="comment">//</span>
00839     <span class="keywordflow">if</span>(!<a class="code" href="../../d4/d6/memory_8c.html#a17">AlRtValidateHeap</a>( HeapHandle, FALSE)) {
00840 
00841 <span class="preprocessor">#if DBG</span>
00842 <span class="preprocessor"></span>        <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(<span class="stringliteral">"Heap validation failed\n"</span>);
00843 <span class="preprocessor">#endif</span>
00844 <span class="preprocessor"></span>        <span class="keywordflow">return</span> ( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00845     }
00846 
00847 
00848     <span class="comment">//</span>
00849     <span class="comment">// Round the requested size up to the allocation granularity.  Note</span>
00850     <span class="comment">// that if the request is for 0 bytes, we still allocate memory.</span>
00851     <span class="comment">//</span>
00852 
00853     allocationSize = ((<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> ? <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> : <a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a>) +
00854                       <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">BUSY_HEADER</a> ) +
00855                       <a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a> -
00856                       1
00857                      ) &amp; ~(<a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a> - 1);
00858 
00859     <span class="keywordflow">if</span> (allocationSize &lt; <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
00860 <span class="preprocessor">#if DBG</span>
00861 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Invalid heap size - %lx\n"</span>, Size );
00862 <span class="comment">//   RtlpBreakPointHeap();</span>
00863 <span class="preprocessor">#endif // DBG</span>
00864 <span class="preprocessor"></span>        <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00865         }
00866 
00867     <span class="keywordflow">if</span> (BaseAddress == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00868 <span class="preprocessor">#if DBG</span>
00869 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Invalid heap address - %lx\n"</span>, BaseAddress );
00870 <span class="comment">//   RtlpBreakPointHeap();</span>
00871 <span class="preprocessor">#endif // DBG</span>
00872 <span class="preprocessor"></span>        <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00873         }
00874 
00875     <span class="comment">//</span>
00876     <span class="comment">// Get the 'real' address of the allocation unit.  (That is, the</span>
00877     <span class="comment">// address of the allocation header.)  Make sure the address lies</span>
00878     <span class="comment">// within the bounds of the valid portion of the heap.</span>
00879     <span class="comment">//</span>
00880 
00881     BusyBlock = (<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>)BaseAddress - 1;
00882     BusySize = BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o1">Size</a>;
00883     BusySegment = (<a class="code" href="../../d2/d1/struct__SEGMENT__HEADER.html">PSEGMENT_HEADER</a>)((ULONG)BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o0">Segment</a> &amp; ~<a class="code" href="../../d4/d6/memory_8c.html#a2">FLAGS_MASK</a>);
00884     BusyFlags = (ULONG)BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o0">Segment</a> &amp; <a class="code" href="../../d4/d6/memory_8c.html#a2">FLAGS_MASK</a>;
00885 
00886     <span class="keywordflow">if</span> (BusyFlags != <a class="code" href="../../d4/d6/memory_8c.html#a1">FLAGS_BUSY</a>
00887 <span class="preprocessor">#if DBG</span>
00888 <span class="preprocessor"></span>        || (BusySegment == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00889             ((PCHAR)BusyBlock &lt; (PCHAR)Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o2">ValidAddress</a> ||
00890          (PCHAR)BusyBlock &gt;= (PCHAR)Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o3">EndAddress</a>
00891             )
00892         ) ||
00893         (BusySegment != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00894             (BusyBlock &lt; (<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>)(BusySegment+1) ||
00895              BusyBlock &gt;= (<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>)((ULONG)BusySegment + BusySegment-&gt;<a class="code" href="../../d2/d1/struct__SEGMENT__HEADER.html#o1">Size</a>)
00896             )
00897         ) ||
00898         (BusySize &lt; <a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a>
00899         ) ||
00900         (BusySize &amp; (<a class="code" href="../../d4/d6/memory_8c.html#a3">ALLOCATION_GRANULARITY</a>-1) != 0
00901         )
00902 <span class="preprocessor">#endif // DBG</span>
00903 <span class="preprocessor"></span>       ) {
00904 <span class="preprocessor">#if DBG</span>
00905 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>( <span class="stringliteral">"ALHEAP: Invalid Address specified to AlRtFreeHeap( %lx, %lx )\n"</span>,
00906                   Heap,
00907                   BaseAddress
00908                 );
00909 <span class="comment">//   RtlpBreakPointHeap();</span>
00910 <span class="preprocessor">#endif // DBG</span>
00911 <span class="preprocessor"></span>        <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
00912         }
00913 
00914 
00915     <span class="comment">//</span>
00916     <span class="comment">// See if new size less than or equal to the current size.</span>
00917     <span class="comment">//</span>
00918 
00919     DeltaSize = (LONG)(BusySize - allocationSize);
00920     <span class="keywordflow">if</span> (DeltaSize &gt;= 0) {
00921         <span class="comment">//</span>
00922         <span class="comment">// Then shrinking block.  If amount of shrinkage is less than</span>
00923         <span class="comment">// the size of a free block, then nothing to do.</span>
00924         <span class="comment">//</span>
00925 
00926         <span class="keywordflow">if</span> (DeltaSize &lt; <span class="keyword">sizeof</span>( <a class="code" href="../../d7/d0/struct__FREE__HEADER.html">FREE_HEADER</a> )) {
00927             <span class="keywordflow">if</span> (Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o1">ZeroExtraMemory</a>) {
00928         memset( (PCHAR)BusyBlock + (allocationSize - DeltaSize),0,
00929                                DeltaSize
00930                              );
00931                 }
00932 
00933             <span class="keywordflow">return</span>( BaseAddress );
00934             }
00935 
00936         <span class="comment">//</span>
00937         <span class="comment">// Otherwise, shrink size of this block to new size, and make extra</span>
00938     <span class="comment">// space at end look like another busy block and call AlRtFreeHeap</span>
00939         <span class="comment">// to free it.</span>
00940         <span class="comment">//</span>
00941 
00942         BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o1">Size</a> = allocationSize;
00943         ExtraBusyBlock = (<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>)((PCH)BusyBlock + allocationSize);
00944         ExtraBusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o0">Segment</a> = BusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o0">Segment</a>;
00945         ExtraBusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o1">Size</a> = (ULONG)(DeltaSize);
00946 <span class="preprocessor">#if DBG</span>
00947 <span class="preprocessor"></span>    ExtraBusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o3">Spare</a> = 0;
00948 <span class="preprocessor">#endif</span>
00949 <span class="preprocessor"></span>
00950     <a class="code" href="../../d4/d6/memory_8c.html#a19">AlRtFreeHeap</a>( HeapHandle, (PVOID)(ExtraBusyBlock+1) );
00951 
00952         <span class="keywordflow">if</span> (Heap-&gt;<a class="code" href="../../d3/d6/struct__HEAP__HEADER.html#o1">ZeroExtraMemory</a>) {
00953             ULONG extraSize;
00954 
00955             extraSize = allocationSize - <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> - <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">BUSY_HEADER</a> );
00956         memset( (PCHAR)BusyBlock + (allocationSize - extraSize),0,
00957                            extraSize
00958                          );
00959             }
00960 
00961         <span class="keywordflow">return</span>( BaseAddress );
00962         }
00963 
00964     <span class="comment">//</span>
00965     <span class="comment">// Otherwise growing block, so allocate a new block with the bigger</span>
00966     <span class="comment">// size, copy the contents of the old block to the new block and then</span>
00967     <span class="comment">// free the old block.  Return the address of the new block.</span>
00968     <span class="comment">//</span>
00969 
00970     NewBaseAddress = <a class="code" href="../../d4/d6/memory_8c.html#a18">AlRtAllocateHeap</a>( HeapHandle, Size );
00971     <span class="keywordflow">if</span> (NewBaseAddress != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00972 <span class="preprocessor">#if DBG</span>
00973 <span class="preprocessor"></span>        ExtraBusyBlock = (<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">PBUSY_HEADER</a>)NewBaseAddress - 1;
00974     ExtraBusyBlock-&gt;<a class="code" href="../../d9/d5/struct__BUSY__HEADER.html#o3">Spare</a> = 0;
00975 <span class="preprocessor">#endif</span>
00976 <span class="preprocessor"></span>    memmove( NewBaseAddress,
00977                        BaseAddress,
00978                        BusySize - <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d5/struct__BUSY__HEADER.html">BUSY_HEADER</a> )
00979                      );
00980 
00981     <a class="code" href="../../d4/d6/memory_8c.html#a19">AlRtFreeHeap</a>( HeapHandle, BaseAddress );
00982         }
00983 
00984     <span class="keywordflow">return</span>( NewBaseAddress );
00985 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="memory.c::AlRtValidateHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN AlRtValidateHeap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HeapHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>DumpHeap</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00352">352</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">AlRtAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l01174">AlValidateHeap()</a>.
<p>
<pre class="fragment"><div>00356 {
00357     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00358 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="memory.c::AlValidateHeap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN AlValidateHeap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DumpHeap</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l01174">1174</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
References <a class="el" href="../../d5/d5/memory_8c-source.html#l00352">AlRtValidateHeap()</a>, and <a class="el" href="../../d5/d5/memory_8c-source.html#l00115">HeapHandle</a>.
<p>
<pre class="fragment"><div>01177 {
01178     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d6/memory_8c.html#a17">AlRtValidateHeap</a>
01179                 (
01180                 <a class="code" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>,
01181                 DumpHeap
01182                 ));
01183 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a13" doxytag="memory.c::AlHeapFree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d4/d6/memory_8c.html#a13">AlHeapFree</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00112">112</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00991">AlMemoryInitialize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="memory.c::AlHeapLimit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d4/d6/memory_8c.html#a14">AlHeapLimit</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00113">113</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l00991">AlMemoryInitialize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="memory.c::HeapHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d4/d6/memory_8c.html#a15">HeapHandle</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d5/memory_8c-source.html#l00115">115</a> of file <a class="el" href="../../d5/d5/memory_8c-source.html">memory.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/memory_8c-source.html#l01113">AlAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l01134">AlDeallocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00991">AlMemoryInitialize()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l01153">AlReallocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00365">AlRtAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00555">AlRtFreeHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l00807">AlRtReAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l01174">AlValidateHeap()</a>, <a class="el" href="../../d1/d9/heaptag_8c-source.html#l00038">LdrpTagAllocateHeap()</a>, <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l01316">RtlAllocateHeap()</a>, <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l02075">RtlAllocateHeapSlowly()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l02401">RtlCompactHeap()</a>, <a class="el" href="../../d5/d7/seurtl_8c-source.html#l01260">RtlCreateAndSetSD()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l01603">RtlCreateTagHeap()</a>, <a class="el" href="../../d5/d7/seurtl_8c-source.html#l01624">RtlCreateUserSecurityObject()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00444">RtlDebugAllocateHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l01260">RtlDebugCompactHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l01421">RtlDebugCreateTagHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00388">RtlDebugDestroyHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00797">RtlDebugFreeHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00919">RtlDebugGetUserInfoHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l01498">RtlDebugQueryTagHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00603">RtlDebugReAllocateHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l01086">RtlDebugSetUserFlagsHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l01002">RtlDebugSetUserValueHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l01177">RtlDebugSizeHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l01572">RtlDebugUsageHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l01654">RtlDebugWalkHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l01338">RtlDebugZeroHeap()</a>, <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l01133">RtlDestroyHeap()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l02132">RtlExtendHeap()</a>, <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l02931">RtlFreeHeap()</a>, <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l03273">RtlFreeHeapSlowly()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l01192">RtlGetUserInfoHeap()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l00390">RtlLockHeap()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l06266">RtlpComputeMergedAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l07461">RtlpConvertAclToAutoInherit()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l06520">RtlpConvertToAutoInheritSecurityObject()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l02336">RtlpDebugPageHeapAllocate()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03512">RtlpDebugPageHeapCompact()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l01997">RtlpDebugPageHeapCreate()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03259">RtlpDebugPageHeapDestroy()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l02693">RtlpDebugPageHeapFree()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03683">RtlpDebugPageHeapGetUserInfo()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03883">RtlpDebugPageHeapIsLocked()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03595">RtlpDebugPageHeapLock()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l00689">RtlpDebugPageHeapPointerFromHandle()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l02895">RtlpDebugPageHeapReAllocate()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03795">RtlpDebugPageHeapSerialize()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03740">RtlpDebugPageHeapSetUserFlags()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03631">RtlpDebugPageHeapSetUserValue()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03401">RtlpDebugPageHeapSize()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03613">RtlpDebugPageHeapUnlock()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03846">RtlpDebugPageHeapUsage()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03539">RtlpDebugPageHeapValidate()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l04100">RtlpDphDllHeapAlloc()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l04128">RtlpDphDllHeapFree()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l04113">RtlpDphDllHeapReAlloc()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l08795">RtlpGetDefaultsSubjectContext()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l06152">RtlpHeapIsLocked()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l05153">RtlpInheritAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d2/d2/dll_2query_8c-source.html#l00729">RtlpQueryProcessEnumHeapsRoutine()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l00258">RtlProtectHeap()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00323">RtlpSerializeHeap()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l03544">RtlpValidOwnerSubjectContext()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l01919">RtlQueryTagHeap()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l00518">RtlReAllocateHeap()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l01480">RtlSetUserFlagsHeap()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l01356">RtlSetUserValueHeap()</a>, <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l03655">RtlSizeHeap()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l00454">RtlUnlockHeap()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l02976">RtlUsageHeap()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l02530">RtlValidateHeap()</a>, <a class="el" href="../../d6/d8/heapdll_8c-source.html#l03714">RtlWalkHeap()</a>, and <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l03762">RtlZeroHeap()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:37 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
