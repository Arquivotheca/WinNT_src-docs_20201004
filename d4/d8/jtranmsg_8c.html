<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: jtranmsg.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>jtranmsg.c File Reference</h1><code>#include "<a class="el" href="../../d9/d2/w32_2ntuser_2imm_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d5/d7/jtranmsg_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a0">JTransCompositionA</a> (LPINPUTCONTEXT lpIMC, LPCOMPOSITIONSTRING lpCompStrA, PTRANSMSG pTransMsgSrc, PTRANSMSG pTransMsgDest)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a1">JTransCompositionW</a> (LPINPUTCONTEXT lpIMC, LPCOMPOSITIONSTRING lpCompStrW, PTRANSMSG pTransMsgSrc, PTRANSMSG pTransMsgDest)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a2">CompStrWToUndetW</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwGCS, LPCOMPOSITIONSTRING lpCompStrW, LPUNDETERMINESTRUCT lpUndetW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a3">CompStrWToUndetA</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwGCS, LPCOMPOSITIONSTRING lpCompStrW, LPUNDETERMINESTRUCT lpUndetA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a4">CompStrWToStringExW</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwGCS, LPCOMPOSITIONSTRING lpCompStrW, LPSTRINGEXSTRUCT lpStringExW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a5">CompStrWToStringExA</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwGCS, LPCOMPOSITIONSTRING lpCompStrW, LPSTRINGEXSTRUCT lpStringExA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a6">CompStrWToStringW</a> (LPCOMPOSITIONSTRING lpCompStrW, LPWSTR lpStringW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a7">CompStrWToStringA</a> (LPCOMPOSITIONSTRING lpCompStrW, LPSTR lpStringA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a8">CompStrWToCharW</a> (HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, LPCOMPOSITIONSTRING lpCompStrW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a9">CompStrWToCharA</a> (HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, LPCOMPOSITIONSTRING lpCompStrW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a10">CompStrAToUndetA</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwGCS, LPCOMPOSITIONSTRING lpCompStrA, LPUNDETERMINESTRUCT lpUndetA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a11">CompStrAToUndetW</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwGCS, LPCOMPOSITIONSTRING lpCompStrA, LPUNDETERMINESTRUCT lpUndetW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a12">CompStrAToStringExA</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwGCS, LPCOMPOSITIONSTRING lpCompStrA, LPSTRINGEXSTRUCT lpStringExA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a13">CompStrAToStringExW</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwGCS, LPCOMPOSITIONSTRING lpCompStrA, LPSTRINGEXSTRUCT lpStringExW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a14">CompStrAToStringA</a> (LPCOMPOSITIONSTRING lpCompStrA, LPSTR lpStringA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a15">CompStrAToStringW</a> (LPCOMPOSITIONSTRING lpCompStrA, LPWSTR lpStringW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a16">CompStrAToCharA</a> (HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, LPCOMPOSITIONSTRING lpCompStrA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a17">CompStrAToCharW</a> (HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, LPCOMPOSITIONSTRING lpCompStrA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/jtranmsg_8c.html#a18">WINNLSTranslateMessageJ</a> (UINT uiNumMsg, PTRANSMSG pTransMsg, LPINPUTCONTEXT lpIMC, LPCOMPOSITIONSTRING lpCompStr, BOOL bAnsiIMC)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a16" doxytag="jtranmsg.c::CompStrAToCharA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CompStrAToCharA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrA</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01423">1423</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d6/strings_8c-source.html#l00190">CharNextA()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00192">GetClientInfo</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00566">WMCR_IR_DBCSCHAR</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00137">JTransCompositionA()</a>.
<p>
<pre class="fragment"><div>01430                    :
01431 
01432     Convert composition string (ANSI) to WM_CHAR (ANSI).
01433 
01434 Arguments:
01435 
01436 Return Value:
01437 
01438 --*/
01439 
01440 {
01441     LPSTR lpszString;
01442     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  fDBCSWmChar = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01443     WORD  wDBCSChar;
01444     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>  szAscii[3];
01445 
01446     lpszString = (LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultStrOffset);
01447 
01448     <span class="comment">// IR_DBCSCHAR: If the app reply to this message with TRUE, we can</span>
01449     <span class="comment">// queue up double byte character in a WM_CHAR message.</span>
01450     <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;dwExpWinVer &gt;= 0x030A ) {
01451         fDBCSWmChar = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)SendMessageA( hWnd,WM_IME_REPORT,IR_DBCSCHAR, 0L);
01452     }
01453 
01454     <span class="comment">// Send IR_STRINGSTART prior to anything.</span>
01455     PostMessageA( hWnd, WM_IME_REPORT, IR_STRINGSTART, 0L );
01456 
01457 
01458     <span class="keywordflow">while</span>(szAscii[0]=*lpszString)
01459     {
01460         <span class="keywordflow">if</span>( *<a class="code" href="../../d5/d7/strings_8c.html#a9">CharNextA</a>(lpszString) == 0 )
01461         {
01462             PostMessageA( hWnd, WM_IME_REPORT, IR_STRINGEND, 0L );
01463         }
01464         <span class="keywordflow">if</span>( IsDBCSLeadByte( szAscii[0] ) )
01465         {
01466             szAscii[1] = *((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(lpszString+1));
01467 
01468             <span class="comment">//  If fDBCSWmChar==TRUE, The app can recieve WM_CHARs which</span>
01469             <span class="comment">// have double byte code in wParam.</span>
01470             <span class="keywordflow">if</span> ( fDBCSWmChar )
01471             {
01472                 <span class="comment">// It's necessary to swap bytes to put 1st byte into upper</span>
01473                 <span class="comment">// part of wParam, and 2nd byte into lower part.</span>
01474                 wDBCSChar = MAKEWORD(szAscii[1], szAscii[0]);
01475                 PostMessageA( hWnd, WM_CHAR, (WPARAM)wDBCSChar|WMCR_IR_DBCSCHAR, 1L );
01476             }
01477             <span class="keywordflow">else</span>
01478             {
01479                 <span class="comment">// Send each byte on a WM_CHAR</span>
01480                 PostMessageA( hWnd, WM_CHAR, (WPARAM)(szAscii[0]), 1L);
01481                 PostMessageA( hWnd, WM_CHAR, (WPARAM)(szAscii[1]), 1L);
01482             }
01483         }
01484         <span class="keywordflow">else</span>
01485         {
01486             PostMessageA( hWnd, WM_CHAR, (WPARAM)(szAscii[0]), 1L);
01487         }
01488         lpszString = <a class="code" href="../../d5/d7/strings_8c.html#a9">CharNextA</a>(lpszString);
01489     }
01490 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="jtranmsg.c::CompStrAToCharW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CompStrAToCharW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrA</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01493">1493</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00799">c</a>, <a class="el" href="../../d6/d6/strings_8c-source.html#l00190">CharNextA()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00137">JTransCompositionA()</a>.
<p>
<pre class="fragment"><div>01500                    :
01501 
01502     Convert composition string (ANSI) to WM_CHAR (Unicode).
01503 
01504 Arguments:
01505 
01506 Return Value:
01507 
01508 --*/
01509 
01510 {
01511     LPSTR lpszString;
01512     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
01513     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>  <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
01514     WORD  wszUnicode[2];
01515 
01516     lpszString = (LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultStrOffset);
01517 
01518     <span class="comment">// IR_DBCSCHAR: If the app reply to this message with TRUE, we can</span>
01519     <span class="comment">// queue up double byte character in a WM_CHAR message.</span>
01520     <span class="comment">// SendMessageW( hWnd,WM_IME_REPORT,IR_DBCSCHAR, 0L);</span>
01521 
01522     <span class="comment">// Send IR_STRINGSTART prior to anything.</span>
01523     PostMessageW( hWnd, WM_IME_REPORT, IR_STRINGSTART, 0L );
01524 
01525 
01526     <span class="keywordflow">while</span>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>=*lpszString)
01527     {
01528         <span class="keywordflow">if</span>( *<a class="code" href="../../d5/d7/strings_8c.html#a9">CharNextA</a>(lpszString) == 0 )
01529         {
01530             PostMessageW( hWnd, WM_IME_REPORT, IR_STRINGEND, 0L );
01531         }
01532         <span class="keywordflow">if</span>( IsDBCSLeadByte( c ) ) {
01533             i = MultiByteToWideChar( CP_ACP,
01534                                     (DWORD)MB_PRECOMPOSED,
01535                                     (LPSTR)lpszString,  <span class="comment">// src</span>
01536                                     (INT)2,
01537                                     (LPWSTR)wszUnicode, <span class="comment">// dest</span>
01538                                     (INT)<span class="keyword">sizeof</span>(wszUnicode));
01539         }
01540         <span class="keywordflow">else</span> {
01541             i = MultiByteToWideChar( CP_ACP,
01542                                     (DWORD)MB_PRECOMPOSED,
01543                                     (LPSTR)lpszString,  <span class="comment">// src</span>
01544                                     (INT)1,
01545                                     (LPWSTR)wszUnicode, <span class="comment">// dest</span>
01546                                     (INT)<span class="keyword">sizeof</span>(wszUnicode));
01547         }
01548         <span class="keywordflow">if</span> (i != 0) {
01549             PostMessageW( hWnd, WM_CHAR, (WPARAM)(wszUnicode[0]), 1L);
01550         }
01551         lpszString = <a class="code" href="../../d5/d7/strings_8c.html#a9">CharNextA</a>(lpszString);
01552     }
01553 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="jtranmsg.c::CompStrAToStringA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrAToStringA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrA</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpStringA</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01333">1333</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00137">JTransCompositionA()</a>.
<p>
<pre class="fragment"><div>01340                    :
01341 
01342     Convert composition string (ANSI) to String (ANSI).
01343 
01344 Arguments:
01345 
01346 Return Value:
01347 
01348 --*/
01349 
01350 {
01351     LPSTR lpszString;
01352     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
01353 
01354     lpszString = (LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultStrOffset);
01355     dwSize = lpCompStrA-&gt;dwResultStrLen;
01356 
01357     <span class="keywordflow">if</span> (lpStringA == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01358         <span class="keywordflow">return</span> ((dwSize + 1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>));
01359     }
01360 
01361     memcpy((PBYTE)lpStringA,
01362            (PBYTE)lpszString,
01363            (dwSize * <span class="keyword">sizeof</span>(CHAR))
01364           );
01365     lpStringA[dwSize] = <span class="charliteral">'\0'</span>;
01366 
01367     <span class="keywordflow">return</span> ((dwSize + 1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>));
01368 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="jtranmsg.c::CompStrAToStringExA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrAToStringExA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwGCS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrA</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTRINGEXSTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpStringExA</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01130">1130</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00137">JTransCompositionA()</a>.
<p>
<pre class="fragment"><div>01138                    :
01139 
01140     Convert composition string (ANSI) to StringEx (ANSI).
01141 
01142 Arguments:
01143 
01144 Return Value:
01145 
01146 --*/
01147 
01148 {
01149     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPos;
01150     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
01151     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
01152 
01153     dwSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(STRINGEXSTRUCT)+1)) +
01154              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwResultStrLen+1) * <span class="keyword">sizeof</span>(CHAR))) +
01155              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(lpCompStrA-&gt;dwResultClauseLen+1) +
01156              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwResultReadStrLen+1) * <span class="keyword">sizeof</span>(CHAR))) +
01157              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(lpCompStrA-&gt;dwResultReadClauseLen+1);
01158 
01159     <span class="keywordflow">if</span> (lpStringExA == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01160         <span class="keywordflow">return</span> dwSize;
01161     }
01162 
01163     dwPos = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(<span class="keyword">sizeof</span>(STRINGEXSTRUCT) + 1);
01164     lpStringExA-&gt;dwSize = dwSize;
01165 
01166     lpStringExA-&gt;uDeterminePos = dwPos;
01167     memcpy((PBYTE)lpStringExA + dwPos,
01168            (PBYTE)lpCompStrA  + lpCompStrA-&gt;dwResultStrOffset,
01169            lpCompStrA-&gt;dwResultStrLen * <span class="keyword">sizeof</span>(CHAR)
01170           );
01171     *(LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExA + dwPos + lpCompStrA-&gt;dwResultStrLen*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)) = <span class="charliteral">'\0'</span>;
01172     dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwResultStrLen + 1)*<span class="keyword">sizeof</span>(CHAR)));
01173 
01174     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTCLAUSE) &amp;&amp;
01175          (lpCompStrA-&gt;dwResultClauseLen &gt; 0) )
01176     {
01177         LPDWORD lpw;
01178         LPDWORD lpdw;
01179 
01180         lpStringExA-&gt;uDetermineDelimPos = dwPos;
01181 
01182         lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExA + dwPos);
01183         lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultClauseOffset);
01184         <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrA-&gt;dwResultClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++)
01185             *lpw++ = *lpdw++;
01186 
01187         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultClauseLen + 1));
01188     }
01189 
01190     lpStringExA-&gt;uYomiPos = dwPos;
01191     memcpy((PBYTE)lpStringExA + dwPos,
01192            (PBYTE)lpCompStrA  + lpCompStrA-&gt;dwResultReadStrOffset,
01193            lpCompStrA-&gt;dwResultReadStrLen * <span class="keyword">sizeof</span>(CHAR)
01194           );
01195     *(LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExA + dwPos + lpCompStrA-&gt;dwResultReadStrLen*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)) = <span class="charliteral">'\0'</span>;
01196     dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwResultReadStrLen + 1)*<span class="keyword">sizeof</span>(CHAR)));
01197 
01198     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTREADCLAUSE) &amp;&amp;
01199          (lpCompStrA-&gt;dwResultReadClauseLen &gt; 0) )
01200     {
01201         LPDWORD lpw;
01202         LPDWORD lpdw;
01203 
01204         lpStringExA-&gt;uYomiDelimPos = dwPos;
01205 
01206         lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExA + dwPos);
01207         lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultReadClauseOffset);
01208         <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrA-&gt;dwResultReadClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++)
01209             *lpw++ = *lpdw++;
01210     }
01211 
01212     <span class="keywordflow">return</span> dwSize;
01213 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="jtranmsg.c::CompStrAToStringExW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrAToStringExW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwGCS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrA</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTRINGEXSTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpStringExW</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01216">1216</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l03052">CalcCharacterPositionAtoW()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00137">JTransCompositionA()</a>.
<p>
<pre class="fragment"><div>01224                    :
01225 
01226     Convert composition string (ANSI) to StringEx (Unicode).
01227 
01228 Arguments:
01229 
01230 Return Value:
01231 
01232 --*/
01233 
01234 {
01235     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPos;
01236     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
01237     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLen;
01238     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
01239 
01240     dwSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(STRINGEXSTRUCT)+1)) +
01241              (lpCompStrA-&gt;dwResultStrLen &gt; 0 ? <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwResultStrLen+1) * <span class="keyword">sizeof</span>(WCHAR))) : 0) +
01242              (lpCompStrA-&gt;dwResultClauseLen &gt; 0 ? <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(lpCompStrA-&gt;dwResultClauseLen+1) : 0) +
01243              (lpCompStrA-&gt;dwResultReadStrLen &gt; 0 ? <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwResultReadStrLen+1) * sizeof(WCHAR))) : 0)+
01244              (lpCompStrA-&gt;dwResultReadClauseLen &gt; 0 ? <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(lpCompStrA-&gt;dwResultReadClauseLen+1) : 0);
01245 
01246     <span class="keywordflow">if</span> (lpStringExW == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01247         <span class="keywordflow">return</span> dwSize;
01248     }
01249 
01250     dwPos = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(<span class="keyword">sizeof</span>(STRINGEXSTRUCT) + 1);
01251     lpStringExW-&gt;dwSize = dwSize;
01252 
01253     <span class="keywordflow">if</span> (lpCompStrA-&gt;dwResultStrLen &gt; 0) {
01254         i = MultiByteToWideChar( CP_ACP,
01255                                 (DWORD)MB_PRECOMPOSED,
01256                                 (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwResultStrOffset),  <span class="comment">// src</span>
01257                                 (INT)lpCompStrA-&gt;dwResultStrLen,
01258                                 (LPWSTR)((PBYTE)lpStringExW + dwPos),                        <span class="comment">// dest</span>
01259                                 (INT)dwSize - dwPos);
01260         ((LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExW + dwPos))[i] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01261         dwLen = i;
01262         lpStringExW-&gt;uDeterminePos = dwPos;
01263         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((dwLen + 1)*<span class="keyword">sizeof</span>(WCHAR)));
01264     } <span class="keywordflow">else</span> {
01265         dwLen = 0;
01266         lpStringExW-&gt;uDeterminePos = 0;
01267     }
01268 
01269     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTCLAUSE) &amp;&amp;
01270          (lpCompStrA-&gt;dwResultClauseLen &gt; 0) )
01271     {
01272         <span class="keywordflow">if</span> (dwLen != 0 &amp;&amp; lpCompStrA-&gt;dwResultClauseLen &gt; 0) {
01273             LPDWORD lpw;
01274             LPDWORD lpdw;
01275 
01276             lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExW + dwPos);
01277             lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultClauseOffset);
01278 
01279             <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrA-&gt;dwResultClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++) {
01280                 *lpw++ = <a class="code" href="../../d4/d0/immcli_8h.html#a81">CalcCharacterPositionAtoW</a>(*lpdw++,
01281                                                    (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwResultStrOffset),
01282                                                    CP_ACP
01283                                                   );
01284             }
01285 
01286             lpStringExW-&gt;uDetermineDelimPos = dwPos;
01287             dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultClauseLen + 1));
01288         }
01289     }
01290 
01291     <span class="keywordflow">if</span> (lpCompStrA-&gt;dwResultReadStrLen &gt; 0) {
01292         i = MultiByteToWideChar( CP_ACP,
01293                                 (DWORD)MB_PRECOMPOSED,
01294                                 (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwResultReadStrOffset),  <span class="comment">// src</span>
01295                                 (INT)lpCompStrA-&gt;dwResultReadStrLen,
01296                                 (LPWSTR)((PBYTE)lpStringExW + dwPos),                            <span class="comment">// dest</span>
01297                                 (INT)dwSize - dwPos);
01298         ((LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExW + dwPos))[i] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01299         dwLen = i;
01300         lpStringExW-&gt;uYomiPos = dwPos;
01301         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((dwLen + 1)*<span class="keyword">sizeof</span>(WCHAR)));
01302     } <span class="keywordflow">else</span> {
01303         dwLen = 0;
01304         lpStringExW-&gt;uYomiPos = 0;
01305     }
01306 
01307     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTREADCLAUSE) &amp;&amp;
01308          (lpCompStrA-&gt;dwResultReadClauseLen &gt; 0) )
01309     {
01310         <span class="keywordflow">if</span> (dwLen != 0 &amp;&amp; lpCompStrA-&gt;dwResultReadClauseLen &gt; 0) {
01311             LPDWORD lpw;
01312             LPDWORD lpdw;
01313 
01314             lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExW + dwPos);
01315             lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultReadClauseOffset);
01316 
01317             <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrA-&gt;dwResultReadClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++) {
01318                 *lpw++ = <a class="code" href="../../d4/d0/immcli_8h.html#a81">CalcCharacterPositionAtoW</a>(*lpdw++,
01319                                                    (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwResultReadStrOffset),
01320                                                    CP_ACP
01321                                                   );
01322             }
01323 
01324             lpStringExW-&gt;uYomiDelimPos = dwPos;
01325             dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultReadClauseLen + 1));
01326         }
01327     }
01328 
01329     <span class="keywordflow">return</span> dwSize;
01330 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="jtranmsg.c::CompStrAToStringW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrAToStringW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrA</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpStringW</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01371">1371</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00137">JTransCompositionA()</a>.
<p>
<pre class="fragment"><div>01378                    :
01379 
01380     Convert composition string (ANSI) to String (Unicode).
01381 
01382 Arguments:
01383 
01384 Return Value:
01385 
01386 --*/
01387 
01388 {
01389     LPSTR lpszString;
01390     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
01391     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
01392 
01393     lpszString = (LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultStrOffset);
01394 
01395     i = MultiByteToWideChar( CP_ACP,
01396                             (DWORD)MB_PRECOMPOSED,
01397                             (LPSTR)lpszString,              <span class="comment">// src</span>
01398                             (INT)lpCompStrA-&gt;dwResultStrLen,
01399                             (LPWSTR)lpStringW,              <span class="comment">// dest</span>
01400                             (INT)0);
01401 
01402     <span class="keywordflow">if</span> (lpStringW == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01403         dwSize = (i+1) * <span class="keyword">sizeof</span>(WCHAR);
01404     }
01405     <span class="keywordflow">else</span> {
01406         dwSize = (i+1) * <span class="keyword">sizeof</span>(WCHAR);
01407 
01408         i = MultiByteToWideChar( CP_ACP,
01409                                 (DWORD)MB_PRECOMPOSED,
01410                                 (LPSTR)lpszString,              <span class="comment">// src</span>
01411                                 (INT)lpCompStrA-&gt;dwResultStrLen,
01412                                 (LPWSTR)lpStringW,              <span class="comment">// dest</span>
01413                                 (INT)dwSize);
01414 
01415         lpStringW[i] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01416         dwSize = (i+1) * <span class="keyword">sizeof</span>(WCHAR);
01417     }
01418 
01419     <span class="keywordflow">return</span> dwSize;
01420 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="jtranmsg.c::CompStrAToUndetA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrAToUndetA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwGCS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrA</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPUNDETERMINESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpUndetA</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00804">804</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00137">JTransCompositionA()</a>.
<p>
<pre class="fragment"><div>00812                    :
00813 
00814     Convert composition string (ANSI) to undetermine string (ANSI).
00815 
00816 Arguments:
00817 
00818 Return Value:
00819 
00820 --*/
00821 
00822 {
00823     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPos;
00824     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
00825     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
00826 
00827     dwSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(UNDETERMINESTRUCT)+1)) +
00828              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwResultStrLen+1) * <span class="keyword">sizeof</span>(CHAR))) +
00829              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultClauseLen+1)) +
00830              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwResultReadStrLen+1) * <span class="keyword">sizeof</span>(CHAR))) +
00831              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultReadClauseLen+1)) +
00832              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwCompAttrLen+1)) +
00833              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwCompStrLen+1) * <span class="keyword">sizeof</span>(CHAR)));
00834 
00835     <span class="keywordflow">if</span> (lpUndetA == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00836         <span class="keywordflow">return</span> dwSize;
00837     }
00838 
00839     dwPos = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(UNDETERMINESTRUCT) + 1));
00840     lpUndetA-&gt;dwSize = dwSize;
00841 
00842     <span class="keywordflow">if</span> (dwGCS &amp; GCS_COMPSTR)
00843     {
00844         lpUndetA-&gt;uUndetTextLen = lpCompStrA-&gt;dwCompStrLen;
00845         lpUndetA-&gt;uUndetTextPos = dwPos;
00846         memcpy((PBYTE)lpUndetA   + dwPos,
00847                (PBYTE)lpCompStrA + lpCompStrA-&gt;dwCompStrOffset,
00848                lpCompStrA-&gt;dwCompStrLen * <span class="keyword">sizeof</span>(CHAR)
00849               );
00850         *(LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + dwPos + lpCompStrA-&gt;dwCompStrLen*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)) = <span class="charliteral">'\0'</span>;
00851         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetA-&gt;uUndetTextLen+1)*<span class="keyword">sizeof</span>(CHAR)));
00852 
00853         <span class="comment">// Sometime Chicago IME does not generate GCS_COMPATTR</span>
00854         <span class="comment">// with GCS_COMPSTR. But uUndetAttrPos should be filled</span>
00855         <span class="comment">// when the UndetText is updated.</span>
00856         <span class="keywordflow">if</span> (lpCompStrA-&gt;dwCompAttrLen &amp;&amp; !(dwGCS &amp; GCS_COMPATTR))
00857             dwGCS |= GCS_COMPATTR;
00858     }
00859 
00860     <span class="keywordflow">if</span> (dwGCS &amp; GCS_COMPATTR)
00861     {
00862         lpUndetA-&gt;uUndetAttrPos = dwPos;
00863         memcpy((PBYTE)lpUndetA   + dwPos,
00864                (PBYTE)lpCompStrA + lpCompStrA-&gt;dwCompAttrOffset,
00865                lpCompStrA-&gt;dwCompAttrLen
00866               );
00867         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpUndetA-&gt;uUndetTextLen + 1));
00868     }
00869 
00870     <span class="keywordflow">if</span> (dwGCS &amp; GCS_CURSORPOS)
00871     {
00872         lpUndetA-&gt;uCursorPos = lpCompStrA-&gt;dwCursorPos;
00873     }
00874 
00875     <span class="keywordflow">if</span> (dwGCS &amp; GCS_DELTASTART)
00876     {
00877         lpUndetA-&gt;uDeltaStart = lpCompStrA-&gt;dwDeltaStart;
00878     }
00879 
00880     <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTSTR)
00881     {
00882         lpUndetA-&gt;uDetermineTextLen = lpCompStrA-&gt;dwResultStrLen;
00883         lpUndetA-&gt;uDetermineTextPos = dwPos;
00884         memcpy((PBYTE)lpUndetA   + dwPos,
00885                (PBYTE)lpCompStrA + lpCompStrA-&gt;dwResultStrOffset,
00886                lpCompStrA-&gt;dwResultStrLen * <span class="keyword">sizeof</span>(CHAR)
00887               );
00888         *(LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + dwPos + lpCompStrA-&gt;dwResultStrLen*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)) = <span class="charliteral">'\0'</span>;
00889         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetA-&gt;uDetermineTextLen + 1)*<span class="keyword">sizeof</span>(CHAR)));
00890     }
00891 
00892     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTCLAUSE) &amp;&amp;
00893          (lpCompStrA-&gt;dwResultClauseLen &gt; 0) )
00894     {
00895         LPDWORD lpw;
00896         LPDWORD lpdw;
00897 
00898         lpUndetA-&gt;uDetermineDelimPos = dwPos;
00899 
00900         lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + dwPos);
00901         lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultClauseOffset);
00902         <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrA-&gt;dwResultClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++)
00903             *lpw++ = *lpdw++;
00904 
00905         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultClauseLen + 1));
00906     }
00907 
00908     <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTREADSTR)
00909     {
00910         lpUndetA-&gt;uYomiTextLen = lpCompStrA-&gt;dwResultReadStrLen;
00911         lpUndetA-&gt;uYomiTextPos = dwPos;
00912         memcpy((PBYTE)lpUndetA   + dwPos,
00913                (PBYTE)lpCompStrA + lpCompStrA-&gt;dwResultReadStrOffset,
00914                lpCompStrA-&gt;dwResultReadStrLen * <span class="keyword">sizeof</span>(CHAR)
00915               );
00916         *(LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + dwPos + lpCompStrA-&gt;dwResultReadStrLen*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)) = <span class="charliteral">'\0'</span>;
00917         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetA-&gt;uYomiTextLen + 1)*<span class="keyword">sizeof</span>(CHAR)));
00918     }
00919 
00920     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTREADCLAUSE) &amp;&amp;
00921          (lpCompStrA-&gt;dwResultReadClauseLen &gt; 0) )
00922     {
00923         LPDWORD lpw;
00924         LPDWORD lpdw;
00925 
00926         lpUndetA-&gt;uYomiDelimPos = dwPos;
00927 
00928         lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + dwPos);
00929         lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultReadClauseOffset);
00930         <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrA-&gt;dwResultReadClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++)
00931             *lpw++ = *lpdw++;
00932 
00933         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultReadClauseLen + 1));
00934     }
00935 
00936     <span class="keywordflow">return</span> dwSize;
00937 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="jtranmsg.c::CompStrAToUndetW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrAToUndetW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwGCS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrA</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPUNDETERMINESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpUndetW</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00940">940</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l03052">CalcCharacterPositionAtoW()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00839">RtlUnicodeToMultiByteSize()</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00137">JTransCompositionA()</a>.
<p>
<pre class="fragment"><div>00948                    :
00949 
00950     Convert composition string (ANSI) to undetermine string (Unicode).
00951 
00952 Arguments:
00953 
00954 Return Value:
00955 
00956 --*/
00957 
00958 {
00959     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPos;
00960     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
00961     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
00962 
00963     dwSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(UNDETERMINESTRUCT)+1)) +
00964              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwResultStrLen+1) * <span class="keyword">sizeof</span>(WCHAR))) +
00965              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultClauseLen+1)) +
00966              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwResultReadStrLen+1) * <span class="keyword">sizeof</span>(WCHAR))) +
00967              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultReadClauseLen+1)) +
00968              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwCompAttrLen * 2)) +
00969              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrA-&gt;dwCompStrLen+1) * <span class="keyword">sizeof</span>(WCHAR)));
00970 
00971     <span class="keywordflow">if</span> (lpUndetW == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00972         <span class="keywordflow">return</span> dwSize;
00973     }
00974 
00975     dwPos = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(UNDETERMINESTRUCT) + 1));
00976     lpUndetW-&gt;dwSize = dwSize;
00977 
00978     <span class="keywordflow">if</span> (dwGCS &amp; GCS_COMPSTR)
00979     {
00980         i = MultiByteToWideChar( CP_ACP,
00981                                 (DWORD)MB_PRECOMPOSED,
00982                                 (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwCompStrOffset),  <span class="comment">// src</span>
00983                                 (INT)lpCompStrA-&gt;dwCompStrLen,
00984                                 (LPWSTR)((PBYTE)lpUndetW + dwPos),                         <span class="comment">// dest</span>
00985                                 (INT)dwSize - dwPos);
00986         ((LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + dwPos))[i] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00987         lpUndetW-&gt;uUndetTextLen = i;
00988         lpUndetW-&gt;uUndetTextPos = dwPos;
00989         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetW-&gt;uUndetTextLen + 1)*<span class="keyword">sizeof</span>(WCHAR)));
00990 
00991         <span class="comment">// Sometime Chicago IME does not generate GCS_COMPATTR</span>
00992         <span class="comment">// with GCS_COMPSTR. But uUndetAttrPos should be filled</span>
00993         <span class="comment">// when the UndetText is updated.</span>
00994         <span class="keywordflow">if</span> (lpCompStrA-&gt;dwCompAttrLen &amp;&amp; !(dwGCS &amp; GCS_COMPATTR))
00995             dwGCS |= GCS_COMPATTR;
00996     }
00997 
00998     <span class="keywordflow">if</span> (dwGCS &amp; GCS_COMPATTR)
00999     {
01000         <span class="keywordflow">if</span> (lpUndetW-&gt;uUndetTextLen != 0) {
01001             LPWSTR lpwszUndetText;
01002             <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>  lpAttrW;
01003             <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>  lpAttrA;
01004             WCHAR  wc;
01005             ULONG  MultiByteSize;
01006 
01007             lpwszUndetText = (LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + lpUndetW-&gt;uUndetTextPos);
01008             lpAttrA = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwCompAttrOffset;
01009             lpAttrW = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW   + dwPos;
01010 
01011             <span class="keywordflow">while</span> (wc=*lpwszUndetText++) {
01012                 <a class="code" href="../../d9/d6/nlsxlat_8c.html#a36">RtlUnicodeToMultiByteSize</a>(&amp;MultiByteSize, &amp;wc, <span class="keyword">sizeof</span>(WCHAR));
01013                 <span class="keywordflow">if</span> (MultiByteSize == 2) {
01014                     *lpAttrW++ = *lpAttrA;
01015                     lpAttrA += 2;
01016                 }
01017                 <span class="keywordflow">else</span> {
01018                     *lpAttrW++ = *lpAttrA++;
01019                 }
01020             }
01021 
01022             lpUndetW-&gt;uUndetAttrPos = dwPos;
01023             dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpUndetW-&gt;uUndetTextLen + 1));
01024         }
01025     }
01026 
01027     <span class="keywordflow">if</span> (dwGCS &amp; GCS_CURSORPOS)
01028     {
01029         <span class="keywordflow">if</span> (lpCompStrA-&gt;dwCursorPos != -1) {
01030             lpUndetW-&gt;uCursorPos = <a class="code" href="../../d4/d0/immcli_8h.html#a81">CalcCharacterPositionAtoW</a>(lpCompStrA-&gt;dwCursorPos,
01031                                                              (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwCompStrOffset),
01032                                                              CP_ACP
01033                                                             );
01034         }
01035         <span class="keywordflow">else</span> {
01036             lpUndetW-&gt;uCursorPos = lpCompStrA-&gt;dwCursorPos;
01037         }
01038     }
01039 
01040     <span class="keywordflow">if</span> (dwGCS &amp; GCS_DELTASTART)
01041     {
01042         <span class="keywordflow">if</span> (lpCompStrA-&gt;dwDeltaStart != -1) {
01043             lpUndetW-&gt;uDeltaStart = <a class="code" href="../../d4/d0/immcli_8h.html#a81">CalcCharacterPositionAtoW</a>(lpCompStrA-&gt;dwDeltaStart,
01044                                                               (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwCompStrOffset),
01045                                                               CP_ACP
01046                                                              );
01047         }
01048         <span class="keywordflow">else</span> {
01049             lpUndetW-&gt;uDeltaStart = lpCompStrA-&gt;dwDeltaStart;
01050         }
01051     }
01052 
01053     <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTSTR)
01054     {
01055         i = MultiByteToWideChar( CP_ACP,
01056                                 (DWORD)MB_PRECOMPOSED,
01057                                 (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwResultStrOffset),  <span class="comment">// src</span>
01058                                 (INT)lpCompStrA-&gt;dwResultStrLen,
01059                                 (LPWSTR)((PBYTE)lpUndetW + dwPos),                           <span class="comment">// dest</span>
01060                                 (INT)dwSize - dwPos);
01061         ((LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + dwPos))[i] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01062         lpUndetW-&gt;uDetermineTextLen = i;
01063         lpUndetW-&gt;uDetermineTextPos = dwPos;
01064         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetW-&gt;uDetermineTextLen + 1)*<span class="keyword">sizeof</span>(WCHAR)));
01065     }
01066 
01067     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTCLAUSE) &amp;&amp;
01068          (lpCompStrA-&gt;dwResultClauseLen &gt; 0) )
01069     {
01070         <span class="keywordflow">if</span> (lpUndetW-&gt;uDetermineTextLen != 0) {
01071             LPDWORD lpw;
01072             LPDWORD lpdw;
01073 
01074             lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + dwPos);
01075             lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultClauseOffset);
01076 
01077             <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrA-&gt;dwResultClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++) {
01078                 *lpw++ = <a class="code" href="../../d4/d0/immcli_8h.html#a81">CalcCharacterPositionAtoW</a>(*lpdw++,
01079                                                    (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwResultStrOffset),
01080                                                    CP_ACP
01081                                                   );
01082             }
01083 
01084             lpUndetW-&gt;uDetermineDelimPos = dwPos;
01085             dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultClauseLen + 1));
01086         }
01087     }
01088 
01089     <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTREADSTR)
01090     {
01091         i = MultiByteToWideChar( CP_ACP,
01092                                 (DWORD)MB_PRECOMPOSED,
01093                                 (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwResultReadStrOffset),  <span class="comment">// src</span>
01094                                 (INT)lpCompStrA-&gt;dwResultReadStrLen,
01095                                 (LPWSTR)((PBYTE)lpUndetW + dwPos),                               <span class="comment">// dest</span>
01096                                 (INT)dwSize - dwPos);
01097         ((LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + dwPos))[i] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01098         lpUndetW-&gt;uYomiTextLen = i;
01099         lpUndetW-&gt;uYomiTextPos = dwPos;
01100         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetW-&gt;uYomiTextLen + 1)*<span class="keyword">sizeof</span>(WCHAR)));
01101     }
01102 
01103     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTREADCLAUSE) &amp;&amp;
01104          (lpCompStrA-&gt;dwResultReadClauseLen &gt; 0) )
01105     {
01106         <span class="keywordflow">if</span> (lpUndetW-&gt;uYomiTextLen != 0) {
01107             LPDWORD lpw;
01108             LPDWORD lpdw;
01109 
01110             lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + dwPos);
01111             lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrA + lpCompStrA-&gt;dwResultReadClauseOffset);
01112 
01113             <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrA-&gt;dwResultReadClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++) {
01114                 *lpw++ = <a class="code" href="../../d4/d0/immcli_8h.html#a81">CalcCharacterPositionAtoW</a>(*lpdw++,
01115                                                    (LPSTR)((PBYTE)lpCompStrA + lpCompStrA-&gt;dwResultReadStrOffset),
01116                                                    CP_ACP
01117                                                   );
01118             }
01119 
01120             lpUndetW-&gt;uYomiDelimPos = dwPos;
01121             dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrA-&gt;dwResultReadClauseLen + 1));
01122         }
01123     }
01124 
01125     <span class="keywordflow">return</span> dwSize;
01126 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="jtranmsg.c::CompStrWToCharA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CompStrWToCharA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrW</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l02234">2234</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d9/d9/wstrings_8c-source.html#l00154">CharNextW()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00192">GetClientInfo</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00566">WMCR_IR_DBCSCHAR</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00359">JTransCompositionW()</a>.
<p>
<pre class="fragment"><div>02241                    :
02242 
02243     Convert composition string (Unicode) to WM_CHAR (ANSI).
02244 
02245 Arguments:
02246 
02247 Return Value:
02248 
02249 --*/
02250 
02251 {
02252     LPWSTR lpwszString;
02253     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fDBCSWmChar = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02254     WORD   wDBCSChar;
02255     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   i;
02256     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   bUDC;
02257     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>   szAscii[3];
02258 
02259     lpwszString = (LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultStrOffset);
02260 
02261     <span class="comment">//</span>
02262     <span class="comment">// IR_DBCSCHAR: If the app reply to this message with TRUE, we can</span>
02263     <span class="comment">// queue up double byte character in a WM_CHAR message.</span>
02264     <span class="comment">//</span>
02265     <span class="comment">//</span>
02266 
02267     <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;dwExpWinVer &gt;= 0x030A ) {
02268        fDBCSWmChar = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)SendMessageA( hWnd,WM_IME_REPORT,IR_DBCSCHAR, 0L);
02269     }
02270 
02271     <span class="comment">//</span>
02272     <span class="comment">// Send IR_STRINGSTART prior to anything.</span>
02273     <span class="comment">//</span>
02274 
02275     PostMessageA( hWnd, WM_IME_REPORT, IR_STRINGSTART, 0L );
02276 
02277 
02278     <span class="keywordflow">while</span> (*lpwszString) {
02279 
02280        <span class="keywordflow">if</span> ( *<a class="code" href="../../d8/d0/wstrings_8c.html#a10">CharNextW</a>(lpwszString) == 0 ) {
02281            PostMessageA( hWnd, WM_IME_REPORT, IR_STRINGEND, 0L );
02282        }
02283 
02284        i = WideCharToMultiByte( CP_ACP,
02285                                 (DWORD)0,
02286                                 (LPWSTR)lpwszString,  <span class="comment">// src</span>
02287                                 (INT)1,
02288                                 (LPSTR)szAscii,       <span class="comment">// dest</span>
02289                                 (INT)<span class="keyword">sizeof</span>(szAscii),
02290                                 (LPSTR)NULL,
02291                                 (LPBOOL)&amp;bUDC);
02292 
02293         <span class="keywordflow">if</span> (i != 0) {
02294 
02295             <span class="keywordflow">if</span> ( IsDBCSLeadByte( szAscii[0] ) ) {
02296 
02297                <span class="comment">//</span>
02298                <span class="comment">//  If fDBCSWmChar==TRUE, The app can recieve WM_CHARs which</span>
02299                <span class="comment">// have double byte code in wParam.</span>
02300                <span class="comment">//</span>
02301 
02302                <span class="keywordflow">if</span> ( fDBCSWmChar )
02303                {
02304                    <span class="comment">//</span>
02305                    <span class="comment">// It's necessary to swap bytes to put 1st byte into upper</span>
02306                    <span class="comment">// part of wParam, and 2nd byte into lower part.</span>
02307                    <span class="comment">//</span>
02308 
02309                    wDBCSChar = MAKEWORD(szAscii[1], szAscii[0]);
02310                    PostMessageA( hWnd, WM_CHAR, wDBCSChar|WMCR_IR_DBCSCHAR, 1L );
02311                }
02312                <span class="keywordflow">else</span>
02313                {
02314                    <span class="comment">//</span>
02315                    <span class="comment">// Send each byte on a WM_CHAR</span>
02316                    <span class="comment">//</span>
02317 
02318                    PostMessageA( hWnd, WM_CHAR, (WPARAM)(szAscii[0]), 1L);
02319                    PostMessageA( hWnd, WM_CHAR, (WPARAM)(szAscii[1]), 1L);
02320                }
02321            }
02322            <span class="keywordflow">else</span>
02323            {
02324                PostMessageA( hWnd, WM_CHAR, (WPARAM)(szAscii[0]), 1L);
02325            }
02326        }
02327 
02328        lpwszString = <a class="code" href="../../d8/d0/wstrings_8c.html#a10">CharNextW</a>(lpwszString);
02329    }
02330 
02331 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="jtranmsg.c::CompStrWToCharW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CompStrWToCharW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrW</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l02192">2192</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d9/d9/wstrings_8c-source.html#l00154">CharNextW()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00359">JTransCompositionW()</a>.
<p>
<pre class="fragment"><div>02199                    :
02200 
02201     Convert composition string (Unicode) to WM_CHAR (Unicode).
02202 
02203 Arguments:
02204 
02205 Return Value:
02206 
02207 --*/
02208 
02209 {
02210     LPWSTR lpwszString;
02211 
02212     lpwszString = (LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultStrOffset);
02213 
02214     <span class="comment">// IR_DBCSCHAR: If the app reply to this message with TRUE, we can</span>
02215     <span class="comment">// queue up double byte character in a WM_CHAR message.</span>
02216     <span class="comment">// SendMessageW( hWnd,WM_IME_REPORT,IR_DBCSCHAR, 0L);</span>
02217 
02218     <span class="comment">// Send IR_STRINGSTART prior to anything.</span>
02219     PostMessageW( hWnd, WM_IME_REPORT, IR_STRINGSTART, 0L );
02220 
02221 
02222     <span class="keywordflow">while</span>(*lpwszString)
02223     {
02224         <span class="keywordflow">if</span>( *<a class="code" href="../../d8/d0/wstrings_8c.html#a10">CharNextW</a>(lpwszString) == 0 )
02225         {
02226             PostMessageW( hWnd, WM_IME_REPORT, IR_STRINGEND, 0L );
02227         }
02228         PostMessageW( hWnd, WM_CHAR, *lpwszString, 1L);
02229         lpwszString = <a class="code" href="../../d8/d0/wstrings_8c.html#a10">CharNextW</a>(lpwszString);
02230     }
02231 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="jtranmsg.c::CompStrWToStringA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrWToStringA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrW</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpStringA</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l02135">2135</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00359">JTransCompositionW()</a>.
<p>
<pre class="fragment"><div>02142                    :
02143 
02144     Convert composition string (Unicode) to String (ANSI).
02145 
02146 Arguments:
02147 
02148 Return Value:
02149 
02150 --*/
02151 
02152 {
02153     LPWSTR lpwszString;
02154     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
02155     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
02156     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bUDC;
02157 
02158     lpwszString = (LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultStrOffset);
02159 
02160     i = WideCharToMultiByte( CP_ACP,
02161                             (DWORD)0,
02162                             (LPWSTR)lpwszString,                             <span class="comment">// src</span>
02163                             (INT)lpCompStrW-&gt;dwResultStrLen,
02164                             (LPSTR)lpStringA,                                <span class="comment">// dest</span>
02165                             (INT)0,
02166                             (LPSTR)NULL,
02167                             (LPBOOL)&amp;bUDC);
02168 
02169     <span class="keywordflow">if</span> (lpStringA == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02170         dwSize = (i+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>);
02171     }
02172     <span class="keywordflow">else</span> {
02173         dwSize = (i+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>);
02174 
02175         i = WideCharToMultiByte( CP_ACP,
02176                                 (DWORD)0,
02177                                 (LPWSTR)lpwszString,                             <span class="comment">// src</span>
02178                                 (INT)lpCompStrW-&gt;dwResultStrLen,
02179                                 (LPSTR)lpStringA,                                <span class="comment">// dest</span>
02180                                 (INT)dwSize,
02181                                 (LPSTR)NULL,
02182                                 (LPBOOL)&amp;bUDC);
02183 
02184         lpStringA[i] = <span class="charliteral">'\0'</span>;
02185         dwSize = (i+1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>);
02186     }
02187 
02188     <span class="keywordflow">return</span> dwSize;
02189 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="jtranmsg.c::CompStrWToStringExA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrWToStringExA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwGCS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrW</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTRINGEXSTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpStringExA</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01975">1975</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l03089">CalcCharacterPositionWtoA()</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00359">JTransCompositionW()</a>.
<p>
<pre class="fragment"><div>01983                    :
01984 
01985     Convert composition string (Unicode) to StringEx (ANSI).
01986 
01987 Arguments:
01988 
01989 Return Value:
01990 
01991 --*/
01992 
01993 {
01994     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPos;
01995     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
01996     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLen;
01997     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
01998     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bUDC;
01999 
02000     dwSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(STRINGEXSTRUCT)+1)) +
02001              (lpCompStrW-&gt;dwResultStrLen &gt; 0 ? <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwResultStrLen+1) * <span class="keyword">sizeof</span>(WCHAR))) : 0) +
02002              (lpCompStrW-&gt;dwResultClauseLen &gt; 0 ? <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(lpCompStrW-&gt;dwResultClauseLen+1) : 0) +
02003              (lpCompStrW-&gt;dwResultReadStrLen &gt; 0 ? <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwResultReadStrLen+1) * sizeof(WCHAR))) : 0)+
02004              (lpCompStrW-&gt;dwResultReadClauseLen &gt; 0 ? <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(lpCompStrW-&gt;dwResultReadClauseLen+1) : 0);
02005 
02006     <span class="keywordflow">if</span> (lpStringExA == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02007         <span class="keywordflow">return</span> dwSize;
02008     }
02009 
02010     dwPos = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(<span class="keyword">sizeof</span>(STRINGEXSTRUCT) + 1);
02011     lpStringExA-&gt;dwSize = dwSize;
02012 
02013     <span class="keywordflow">if</span> (lpCompStrW-&gt;dwResultStrLen &gt; 0) {
02014         i = WideCharToMultiByte( CP_ACP,
02015                                 (DWORD)0,
02016                                 (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwResultStrOffset),  <span class="comment">// src</span>
02017                                 (INT)lpCompStrW-&gt;dwResultStrLen,
02018                                 (LPSTR)((PBYTE)lpStringExA + dwPos),                          <span class="comment">// dest</span>
02019                                 (INT)dwSize - dwPos,
02020                                 (LPSTR)NULL,
02021                                 (LPBOOL)&amp;bUDC);
02022         ((LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExA + dwPos))[i] = <span class="charliteral">'\0'</span>;
02023         dwLen = i;
02024         lpStringExA-&gt;uDeterminePos = dwPos;
02025         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((dwLen + 1)*<span class="keyword">sizeof</span>(CHAR)));
02026     } <span class="keywordflow">else</span> {
02027         dwLen = 0;
02028         lpStringExA-&gt;uDeterminePos = 0;
02029     }
02030 
02031     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTCLAUSE) &amp;&amp;
02032          (lpCompStrW-&gt;dwResultClauseLen &gt; 0) )
02033     {
02034         <span class="keywordflow">if</span> (dwLen != 0 &amp;&amp; lpCompStrW-&gt;dwResultClauseLen &gt; 0) {
02035             LPDWORD lpw;
02036             LPDWORD lpdw;
02037 
02038             lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExA + dwPos);
02039             lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultClauseOffset);
02040 
02041             <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrW-&gt;dwResultClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++) {
02042                 *lpw++ = <a class="code" href="../../d4/d0/immcli_8h.html#a82">CalcCharacterPositionWtoA</a>(*lpdw++,
02043                                                    (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwResultStrOffset),
02044                                                    CP_ACP
02045                                                   );
02046             }
02047 
02048             lpStringExA-&gt;uDetermineDelimPos = dwPos;
02049             dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultClauseLen + 1));
02050         }
02051     }
02052 
02053     <span class="keywordflow">if</span> (lpCompStrW-&gt;dwResultReadStrLen &gt; 0) {
02054         i = WideCharToMultiByte( CP_ACP,
02055                                 (DWORD)0,
02056                                 (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwResultReadStrOffset),  <span class="comment">// src</span>
02057                                 (INT)lpCompStrW-&gt;dwResultReadStrLen,
02058                                 (LPSTR)((PBYTE)lpStringExA + dwPos),                              <span class="comment">// dest</span>
02059                                 (INT)dwSize - dwPos,
02060                                 (LPSTR)NULL,
02061                                 (LPBOOL)&amp;bUDC);
02062         ((LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExA + dwPos))[i] = <span class="charliteral">'\0'</span>;
02063         dwLen = i;
02064         lpStringExA-&gt;uYomiPos = dwPos;
02065         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((dwLen + 1)*<span class="keyword">sizeof</span>(CHAR)));
02066     } <span class="keywordflow">else</span> {
02067         dwLen = 0;
02068         lpStringExA-&gt;uYomiPos = 0;
02069     }
02070 
02071     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTREADCLAUSE) &amp;&amp;
02072          (lpCompStrW-&gt;dwResultReadClauseLen &gt; 0) )
02073     {
02074         <span class="keywordflow">if</span> (dwLen != 0 &amp;&amp; lpCompStrW-&gt;dwResultReadClauseLen &gt; 0) {
02075             LPDWORD lpw;
02076             LPDWORD lpdw;
02077 
02078             lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExA + dwPos);
02079             lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultReadClauseOffset);
02080 
02081             <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrW-&gt;dwResultReadClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++) {
02082                 *lpw++ = <a class="code" href="../../d4/d0/immcli_8h.html#a82">CalcCharacterPositionWtoA</a>(*lpdw++,
02083                                                    (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwResultReadStrOffset),
02084                                                    CP_ACP
02085                                                   );
02086             }
02087 
02088             lpStringExA-&gt;uYomiDelimPos = dwPos;
02089             dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultReadClauseLen + 1));
02090         }
02091     }
02092 
02093     <span class="keywordflow">return</span> dwSize;
02094 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="jtranmsg.c::CompStrWToStringExW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrWToStringExW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwGCS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrW</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTRINGEXSTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpStringExW</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01889">1889</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00359">JTransCompositionW()</a>.
<p>
<pre class="fragment"><div>01897                    :
01898 
01899     Convert composition string (Unicode) to StringEx (Unicode).
01900 
01901 Arguments:
01902 
01903 Return Value:
01904 
01905 --*/
01906 
01907 {
01908     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPos;
01909     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
01910     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
01911 
01912     dwSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(STRINGEXSTRUCT)+1)) +
01913              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwResultStrLen+1) * <span class="keyword">sizeof</span>(WCHAR))) +
01914              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(lpCompStrW-&gt;dwResultClauseLen+1) +
01915              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwResultReadStrLen+1) * <span class="keyword">sizeof</span>(WCHAR))) +
01916              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(lpCompStrW-&gt;dwResultReadClauseLen+1);
01917 
01918     <span class="keywordflow">if</span> (lpStringExW == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01919         <span class="keywordflow">return</span> dwSize;
01920     }
01921 
01922     dwPos = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(<span class="keyword">sizeof</span>(STRINGEXSTRUCT) + 1);
01923     lpStringExW-&gt;dwSize = dwSize;
01924 
01925     lpStringExW-&gt;uDeterminePos = dwPos;
01926     memcpy((PBYTE)lpStringExW + dwPos,
01927            (PBYTE)lpCompStrW  + lpCompStrW-&gt;dwResultStrOffset,
01928            lpCompStrW-&gt;dwResultStrLen * <span class="keyword">sizeof</span>(WCHAR)
01929           );
01930     *(LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExW + dwPos + lpCompStrW-&gt;dwResultStrLen*<span class="keyword">sizeof</span>(WCHAR)) = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01931     dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwResultStrLen + 1)*<span class="keyword">sizeof</span>(WCHAR)));
01932 
01933     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTCLAUSE) &amp;&amp;
01934          (lpCompStrW-&gt;dwResultClauseLen &gt; 0) )
01935     {
01936         LPDWORD lpw;
01937         LPDWORD lpdw;
01938 
01939         lpStringExW-&gt;uDetermineDelimPos = dwPos;
01940 
01941         lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExW + dwPos);
01942         lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultClauseOffset);
01943         <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrW-&gt;dwResultClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++)
01944             *lpw++ = *lpdw++;
01945 
01946         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultClauseLen + 1));
01947     }
01948 
01949     lpStringExW-&gt;uYomiPos = dwPos;
01950     memcpy((PBYTE)lpStringExW + dwPos,
01951            (PBYTE)lpCompStrW  + lpCompStrW-&gt;dwResultReadStrOffset,
01952            lpCompStrW-&gt;dwResultReadStrLen * <span class="keyword">sizeof</span>(WCHAR)
01953           );
01954     *(LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExW + dwPos + lpCompStrW-&gt;dwResultReadStrLen*<span class="keyword">sizeof</span>(WCHAR)) = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01955     dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwResultReadStrLen + 1)*<span class="keyword">sizeof</span>(WCHAR)));
01956 
01957     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTREADCLAUSE) &amp;&amp;
01958          (lpCompStrW-&gt;dwResultReadClauseLen &gt; 0) )
01959     {
01960         LPDWORD lpw;
01961         LPDWORD lpdw;
01962 
01963         lpStringExW-&gt;uYomiDelimPos = dwPos;
01964 
01965         lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpStringExW + dwPos);
01966         lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultReadClauseOffset);
01967         <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrW-&gt;dwResultReadClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++)
01968             *lpw++ = *lpdw++;
01969     }
01970 
01971     <span class="keywordflow">return</span> dwSize;
01972 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="jtranmsg.c::CompStrWToStringW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrWToStringW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrW</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpStringW</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l02097">2097</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00359">JTransCompositionW()</a>.
<p>
<pre class="fragment"><div>02104                    :
02105 
02106     Convert composition string (Unicode) to String (Unicode).
02107 
02108 Arguments:
02109 
02110 Return Value:
02111 
02112 --*/
02113 
02114 {
02115     LPWSTR lpwszString;
02116     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
02117 
02118     lpwszString = (LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultStrOffset);
02119     dwSize = lpCompStrW-&gt;dwResultStrLen;
02120 
02121     <span class="keywordflow">if</span> (lpStringW == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02122         <span class="keywordflow">return</span> ((dwSize + 1) * <span class="keyword">sizeof</span>(WCHAR));
02123     }
02124 
02125     memcpy((PBYTE)lpStringW,
02126            (PBYTE)lpwszString,
02127            (dwSize * <span class="keyword">sizeof</span>(WCHAR))
02128           );
02129     lpStringW[dwSize] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
02130 
02131     <span class="keywordflow">return</span> ((dwSize + 1) * <span class="keyword">sizeof</span>(WCHAR));
02132 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="jtranmsg.c::CompStrWToUndetA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrWToUndetA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwGCS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrW</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPUNDETERMINESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpUndetA</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01692">1692</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00799">c</a>, <a class="el" href="../../d5/d0/ctxtinfo_8c-source.html#l03089">CalcCharacterPositionWtoA()</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00359">JTransCompositionW()</a>.
<p>
<pre class="fragment"><div>01700                    :
01701 
01702     Convert composition string (Unicode) to undetermine string (ANSI).
01703 
01704 Arguments:
01705 
01706 Return Value:
01707 
01708 --*/
01709 
01710 {
01711     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPos;
01712     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
01713     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
01714     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bUDC;
01715 
01716     dwSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(UNDETERMINESTRUCT)+1)) +
01717              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwResultStrLen+1) * <span class="keyword">sizeof</span>(WCHAR))) +
01718              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultClauseLen+1)) +
01719              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwResultReadStrLen+1) * <span class="keyword">sizeof</span>(WCHAR))) +
01720              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultReadClauseLen+1)) +
01721              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwCompAttrLen * 2)) +
01722              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwCompStrLen+1) * <span class="keyword">sizeof</span>(WCHAR)));
01723 
01724     <span class="keywordflow">if</span> (lpUndetA == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01725         <span class="keywordflow">return</span> dwSize;
01726     }
01727 
01728     dwPos = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(UNDETERMINESTRUCT) + 1));
01729     lpUndetA-&gt;dwSize = dwSize;
01730 
01731     <span class="keywordflow">if</span> (dwGCS &amp; GCS_COMPSTR)
01732     {
01733         i = WideCharToMultiByte( CP_ACP,
01734                                 (DWORD)0,
01735                                 (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwCompStrOffset),  <span class="comment">// src</span>
01736                                 (INT)lpCompStrW-&gt;dwCompStrLen,
01737                                 (LPSTR)((PBYTE)lpUndetA + dwPos),                           <span class="comment">// dest</span>
01738                                 (INT)dwSize - dwPos,
01739                                 (LPSTR)NULL,
01740                                 (LPBOOL)&amp;bUDC);
01741         ((LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + dwPos))[i] = <span class="charliteral">'\0'</span>;
01742         lpUndetA-&gt;uUndetTextLen = i;
01743         lpUndetA-&gt;uUndetTextPos = dwPos;
01744         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetA-&gt;uUndetTextLen + 1)*<span class="keyword">sizeof</span>(CHAR)));
01745 
01746         <span class="comment">// Sometime Chicago IME does not generate GCS_COMPATTR</span>
01747         <span class="comment">// with GCS_COMPSTR. But uUndetAttrPos should be filled</span>
01748         <span class="comment">// when the UndetText is updated.</span>
01749         <span class="keywordflow">if</span> (lpCompStrW-&gt;dwCompAttrLen &amp;&amp; !(dwGCS &amp; GCS_COMPATTR))
01750             dwGCS |= GCS_COMPATTR;
01751     }
01752 
01753     <span class="keywordflow">if</span> (dwGCS &amp; GCS_COMPATTR)
01754     {
01755         <span class="keywordflow">if</span> (lpUndetA-&gt;uUndetTextLen != 0) {
01756             LPSTR  lpszUndetText;
01757             <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>  lpAttrW;
01758             <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>  lpAttrA;
01759             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>   <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
01760 
01761             lpszUndetText  = (LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + lpUndetA-&gt;uUndetTextPos);
01762             lpAttrW = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwCompAttrOffset;
01763             lpAttrA = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA   + dwPos;
01764 
01765             <span class="keywordflow">while</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>=*lpszUndetText++) {
01766                 <span class="keywordflow">if</span> (IsDBCSLeadByte(c)) {
01767                     *lpAttrA++ = *lpAttrW;
01768                     *lpAttrA++ = *lpAttrW;
01769                     lpszUndetText++;
01770                 }
01771                 <span class="keywordflow">else</span> {
01772                     *lpAttrA++ = *lpAttrW;
01773                 }
01774                 lpAttrW++;
01775             }
01776 
01777             lpUndetA-&gt;uUndetAttrPos = dwPos;
01778             dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpUndetA-&gt;uUndetTextLen + 1));
01779         }
01780     }
01781 
01782     <span class="keywordflow">if</span> (dwGCS &amp; GCS_CURSORPOS)
01783     {
01784         <span class="keywordflow">if</span> (lpCompStrW-&gt;dwCursorPos != -1) {
01785             lpUndetA-&gt;uCursorPos = <a class="code" href="../../d4/d0/immcli_8h.html#a82">CalcCharacterPositionWtoA</a>(lpCompStrW-&gt;dwCursorPos,
01786                                                              (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwCompStrOffset),
01787                                                              CP_ACP
01788                                                             );
01789         }
01790         <span class="keywordflow">else</span> {
01791             lpUndetA-&gt;uCursorPos = lpCompStrW-&gt;dwCursorPos;
01792         }
01793     }
01794 
01795     <span class="keywordflow">if</span> (dwGCS &amp; GCS_DELTASTART)
01796     {
01797         <span class="keywordflow">if</span> (lpCompStrW-&gt;dwDeltaStart != -1) {
01798             lpUndetA-&gt;uDeltaStart = <a class="code" href="../../d4/d0/immcli_8h.html#a82">CalcCharacterPositionWtoA</a>(lpCompStrW-&gt;dwDeltaStart,
01799                                                               (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwCompStrOffset),
01800                                                               CP_ACP
01801                                                              );
01802         }
01803         <span class="keywordflow">else</span> {
01804             lpUndetA-&gt;uDeltaStart = lpCompStrW-&gt;dwDeltaStart;
01805         }
01806     }
01807 
01808     <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTSTR)
01809     {
01810         i = WideCharToMultiByte( CP_ACP,
01811                                 (DWORD)0,
01812                                 (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwResultStrOffset),  <span class="comment">// src</span>
01813                                 (INT)lpCompStrW-&gt;dwResultStrLen,
01814                                 (LPSTR)((PBYTE)lpUndetA + dwPos),                             <span class="comment">// dest</span>
01815                                 (INT)dwSize - dwPos,
01816                                 (LPSTR)NULL,
01817                                 (LPBOOL)&amp;bUDC);
01818         ((LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + dwPos))[i] = <span class="charliteral">'\0'</span>;
01819         lpUndetA-&gt;uDetermineTextLen = i;
01820         lpUndetA-&gt;uDetermineTextPos = dwPos;
01821         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetA-&gt;uDetermineTextLen + 1)*<span class="keyword">sizeof</span>(CHAR)));
01822     }
01823 
01824     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTCLAUSE) &amp;&amp;
01825          (lpCompStrW-&gt;dwResultClauseLen &gt; 0) )
01826     {
01827         <span class="keywordflow">if</span> (lpUndetA-&gt;uDetermineTextLen != 0) {
01828             LPDWORD lpw;
01829             LPDWORD lpdw;
01830 
01831             lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + dwPos);
01832             lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultClauseOffset);
01833 
01834             <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrW-&gt;dwResultClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++) {
01835                 *lpw++ = <a class="code" href="../../d4/d0/immcli_8h.html#a82">CalcCharacterPositionWtoA</a>(*lpdw++,
01836                                                    (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwResultStrOffset),
01837                                                    CP_ACP
01838                                                   );
01839             }
01840 
01841             lpUndetA-&gt;uDetermineDelimPos = dwPos;
01842             dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultClauseLen + 1));
01843         }
01844     }
01845 
01846     <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTREADSTR)
01847     {
01848         i = WideCharToMultiByte( CP_ACP,
01849                                 (DWORD)0,
01850                                 (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwResultReadStrOffset),  <span class="comment">// src</span>
01851                                 (INT)lpCompStrW-&gt;dwResultReadStrLen,
01852                                 (LPSTR)((PBYTE)lpUndetA + dwPos),                                 <span class="comment">// dest</span>
01853                                 (INT)dwSize - dwPos,
01854                                 (LPSTR)NULL,
01855                                 (LPBOOL)&amp;bUDC);
01856         ((LPSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + dwPos))[i] = <span class="charliteral">'\0'</span>;
01857         lpUndetA-&gt;uYomiTextLen = i;
01858         lpUndetA-&gt;uYomiTextPos = dwPos;
01859         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetA-&gt;uYomiTextLen + 1)*<span class="keyword">sizeof</span>(CHAR)));
01860     }
01861 
01862     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTREADCLAUSE) &amp;&amp;
01863          (lpCompStrW-&gt;dwResultReadClauseLen &gt; 0) )
01864     {
01865         <span class="keywordflow">if</span> (lpUndetA-&gt;uYomiTextLen != 0) {
01866             LPDWORD lpw;
01867             LPDWORD lpdw;
01868 
01869             lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetA + dwPos);
01870             lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultReadClauseOffset);
01871 
01872             <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrW-&gt;dwResultReadClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++) {
01873                 *lpw++ = <a class="code" href="../../d4/d0/immcli_8h.html#a82">CalcCharacterPositionWtoA</a>(*lpdw++,
01874                                                    (LPWSTR)((PBYTE)lpCompStrW + lpCompStrW-&gt;dwResultReadStrOffset),
01875                                                    CP_ACP
01876                                                   );
01877             }
01878 
01879             lpUndetA-&gt;uYomiDelimPos = dwPos;
01880             dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultReadClauseLen + 1));
01881         }
01882     }
01883 
01884     <span class="keywordflow">return</span> dwSize;
01885 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="jtranmsg.c::CompStrWToUndetW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CompStrWToUndetW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwGCS</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrW</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPUNDETERMINESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpUndetW</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01556">1556</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00359">JTransCompositionW()</a>.
<p>
<pre class="fragment"><div>01564                    :
01565 
01566     Convert composition string (Unicode) to undetermine string (Unicode).
01567 
01568 Arguments:
01569 
01570 Return Value:
01571 
01572 --*/
01573 
01574 {
01575     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPos;
01576     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
01577     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
01578 
01579     dwSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(UNDETERMINESTRUCT)+1)) +
01580              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwResultStrLen+1) * <span class="keyword">sizeof</span>(WCHAR))) +
01581              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultClauseLen+1)) +
01582              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwResultReadStrLen+1) * <span class="keyword">sizeof</span>(WCHAR))) +
01583              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultReadClauseLen+1)) +
01584              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwCompAttrLen+1)) +
01585              <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpCompStrW-&gt;dwCompStrLen+1) * <span class="keyword">sizeof</span>(WCHAR)));
01586 
01587     <span class="keywordflow">if</span> (lpUndetW == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01588         <span class="keywordflow">return</span> dwSize;
01589     }
01590 
01591     dwPos = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((<span class="keyword">sizeof</span>(UNDETERMINESTRUCT) + 1));
01592     lpUndetW-&gt;dwSize = dwSize;
01593 
01594     <span class="keywordflow">if</span> (dwGCS &amp; GCS_COMPSTR)
01595     {
01596         lpUndetW-&gt;uUndetTextLen = lpCompStrW-&gt;dwCompStrLen;
01597         lpUndetW-&gt;uUndetTextPos = dwPos;
01598         memcpy((PBYTE)lpUndetW   + dwPos,
01599                (PBYTE)lpCompStrW + lpCompStrW-&gt;dwCompStrOffset,
01600                lpCompStrW-&gt;dwCompStrLen * <span class="keyword">sizeof</span>(WCHAR)
01601               );
01602         *(LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + dwPos + lpCompStrW-&gt;dwCompStrLen*<span class="keyword">sizeof</span>(WCHAR)) = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01603         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetW-&gt;uUndetTextLen+1)*<span class="keyword">sizeof</span>(WCHAR)));
01604 
01605         <span class="comment">// Sometime Chicago IME does not generate GCS_COMPATTR</span>
01606         <span class="comment">// with GCS_COMPSTR. But uUndetAttrPos should be filled</span>
01607         <span class="comment">// when the UndetText is updated.</span>
01608         <span class="keywordflow">if</span> (lpCompStrW-&gt;dwCompAttrLen &amp;&amp; !(dwGCS &amp; GCS_COMPATTR))
01609             dwGCS |= GCS_COMPATTR;
01610     }
01611 
01612     <span class="keywordflow">if</span> (dwGCS &amp; GCS_COMPATTR)
01613     {
01614         lpUndetW-&gt;uUndetAttrPos = dwPos;
01615         memcpy((PBYTE)lpUndetW   + dwPos,
01616                (PBYTE)lpCompStrW + lpCompStrW-&gt;dwCompAttrOffset,
01617                lpCompStrW-&gt;dwCompAttrLen
01618               );
01619         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpUndetW-&gt;uUndetTextLen + 1));
01620     }
01621 
01622     <span class="keywordflow">if</span> (dwGCS &amp; GCS_CURSORPOS)
01623     {
01624         lpUndetW-&gt;uCursorPos = lpCompStrW-&gt;dwCursorPos;
01625     }
01626 
01627     <span class="keywordflow">if</span> (dwGCS &amp; GCS_DELTASTART)
01628     {
01629         lpUndetW-&gt;uDeltaStart = lpCompStrW-&gt;dwDeltaStart;
01630     }
01631 
01632     <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTSTR)
01633     {
01634         lpUndetW-&gt;uDetermineTextLen = lpCompStrW-&gt;dwResultStrLen;
01635         lpUndetW-&gt;uDetermineTextPos = dwPos;
01636         memcpy((PBYTE)lpUndetW   + dwPos,
01637                (PBYTE)lpCompStrW + lpCompStrW-&gt;dwResultStrOffset,
01638                lpCompStrW-&gt;dwResultStrLen * <span class="keyword">sizeof</span>(WCHAR)
01639               );
01640         *(LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + dwPos + lpCompStrW-&gt;dwResultStrLen*<span class="keyword">sizeof</span>(WCHAR)) = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01641         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetW-&gt;uDetermineTextLen + 1)*<span class="keyword">sizeof</span>(WCHAR)));
01642     }
01643 
01644     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTCLAUSE) &amp;&amp;
01645          (lpCompStrW-&gt;dwResultClauseLen &gt; 0) )
01646     {
01647         LPDWORD lpw;
01648         LPDWORD lpdw;
01649 
01650         lpUndetW-&gt;uDetermineDelimPos = dwPos;
01651 
01652         lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + dwPos);
01653         lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultClauseOffset);
01654         <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrW-&gt;dwResultClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++)
01655             *lpw++ = *lpdw++;
01656 
01657         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultClauseLen + 1));
01658     }
01659 
01660     <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTREADSTR)
01661     {
01662         lpUndetW-&gt;uYomiTextLen = lpCompStrW-&gt;dwResultReadStrLen;
01663         lpUndetW-&gt;uYomiTextPos = dwPos;
01664         memcpy((PBYTE)lpUndetW   + dwPos,
01665                (PBYTE)lpCompStrW + lpCompStrW-&gt;dwResultReadStrOffset,
01666                lpCompStrW-&gt;dwResultReadStrLen * <span class="keyword">sizeof</span>(WCHAR)
01667               );
01668         *(LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + dwPos + lpCompStrW-&gt;dwResultReadStrLen*<span class="keyword">sizeof</span>(WCHAR)) = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01669         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(((lpUndetW-&gt;uYomiTextLen + 1)*<span class="keyword">sizeof</span>(WCHAR)));
01670     }
01671 
01672     <span class="keywordflow">if</span> ( (dwGCS &amp; GCS_RESULTREADCLAUSE) &amp;&amp;
01673          (lpCompStrW-&gt;dwResultReadClauseLen &gt; 0) )
01674     {
01675         LPDWORD lpw;
01676         LPDWORD lpdw;
01677 
01678         lpUndetW-&gt;uYomiDelimPos = dwPos;
01679 
01680         lpw  = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpUndetW + dwPos);
01681         lpdw = (LPDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpCompStrW + lpCompStrW-&gt;dwResultReadClauseOffset);
01682         <span class="keywordflow">for</span> (i = 0; i &lt; (lpCompStrW-&gt;dwResultReadClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)); i++)
01683             *lpw++ = *lpdw++;
01684 
01685         dwPos += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>((lpCompStrW-&gt;dwResultReadClauseLen + 1));
01686     }
01687 
01688     <span class="keywordflow">return</span> dwSize;
01689 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="jtranmsg.c::JTransCompositionA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT JTransCompositionA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPINPUTCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIMC</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrA</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTRANSMSG&nbsp;</td>
          <td class="mdname" nowrap> <em>pTransMsgSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTRANSMSG&nbsp;</td>
          <td class="mdname" nowrap> <em>pTransMsgDest</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00137">137</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01423">CompStrAToCharA()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01493">CompStrAToCharW()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01333">CompStrAToStringA()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01130">CompStrAToStringExA()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01216">CompStrAToStringExW()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01371">CompStrAToStringW()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00804">CompStrAToUndetA()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00940">CompStrAToUndetW()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00533">IsWindowUnicode()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00582">WINNLSTranslateMessageJ()</a>.
<p>
<pre class="fragment"><div>00143 {
00144     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> i = 0;
00145     <span class="keywordtype">int</span> iNum = 0;
00146     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
00147     HWND <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>;
00148     WORD wTextLen = 0;
00149     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDoneUndet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00150     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00151     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwGCS;
00152     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bAnsiWnd;
00153 
00154     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> = (HWND)lpIMC-&gt;hWnd;
00155 
00156     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hWnd))
00157         <span class="keywordflow">return</span> 0;
00158 
00159     bAnsiWnd = (! <a class="code" href="../../d3/d8/winmgrc_8c.html#a27">IsWindowUnicode</a>(hWnd)) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00160 
00161     dwGCS = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pTransMsgSrc-&gt;lParam;
00162 
00163     <span class="keywordflow">if</span> (lpIMC-&gt;fdw31Compat &amp; F31COMPAT_MCWHIDDEN)
00164     {
00165         <span class="keywordflow">if</span> (bAnsiWnd) {
00166             dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a10">CompStrAToUndetA</a>(dwGCS, lpCompStrA, NULL);
00167             <span class="keywordflow">if</span> (dwSize != 0) {
00168                 HGLOBAL hUndetA = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00169                 LPUNDETERMINESTRUCT lpUndetA;
00170 
00171                 <span class="keywordflow">if</span> (hUndetA = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00172                     <span class="keywordflow">if</span> (lpUndetA = (LPUNDETERMINESTRUCT)GlobalLock(hUndetA)) {
00173                         <a class="code" href="../../d4/d8/jtranmsg_8c.html#a10">CompStrAToUndetA</a>(dwGCS, lpCompStrA, lpUndetA);
00174                         fDoneUndet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00175                         GlobalUnlock(hUndetA);
00176 
00177                         <span class="keywordflow">if</span> (SendMessageA(hWnd,WM_IME_REPORT,IR_UNDETERMINE, (LPARAM)hUndetA)) {
00178                             GlobalFree(hUndetA);
00179                             <span class="keywordflow">return</span> 0;
00180                         }
00181                     }
00182                     GlobalFree(hUndetA);
00183                 }
00184             }
00185         }
00186         <span class="keywordflow">else</span> {
00187             dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a11">CompStrAToUndetW</a>(dwGCS, lpCompStrA, NULL);
00188             <span class="keywordflow">if</span> (dwSize != 0) {
00189                 HGLOBAL hUndetW = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00190                 LPUNDETERMINESTRUCT lpUndetW;
00191 
00192                 <span class="keywordflow">if</span> (hUndetW = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00193                     <span class="keywordflow">if</span> (lpUndetW = (LPUNDETERMINESTRUCT)GlobalLock(hUndetW)) {
00194                         <a class="code" href="../../d4/d8/jtranmsg_8c.html#a11">CompStrAToUndetW</a>(dwGCS, lpCompStrA, lpUndetW);
00195                         fDoneUndet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00196                         GlobalUnlock(hUndetW);
00197 
00198                         <span class="keywordflow">if</span> (SendMessageW(hWnd,WM_IME_REPORT,IR_UNDETERMINE, (LPARAM)hUndetW)) {
00199                             GlobalFree(hUndetW);
00200                             <span class="keywordflow">return</span> 0;
00201                         }
00202                     }
00203                     GlobalFree(hUndetW);
00204                 }
00205             }
00206         }
00207     }
00208 
00209     <span class="comment">//</span>
00210     <span class="comment">// This is generate result string routine.</span>
00211     <span class="comment">// This should be same as WINNLSSendString of WIN3.1.</span>
00212     <span class="comment">//</span>
00213 
00214     <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTSTR)
00215     {
00216         <span class="comment">//</span>
00217         <span class="comment">// Can we generate IR_STRINGEX ?</span>
00218         <span class="comment">//</span>
00219 
00220         <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTREADSTR)
00221         {
00222             <span class="keywordflow">if</span> (bAnsiWnd) {
00223                 dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a12">CompStrAToStringExA</a>(dwGCS, lpCompStrA, NULL);
00224                 <span class="keywordflow">if</span> (dwSize != 0) {
00225                     HGLOBAL hStringExA = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00226                     LPSTRINGEXSTRUCT lpStringExA;
00227 
00228                     <span class="keywordflow">if</span> (hStringExA = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00229                         <span class="keywordflow">if</span> (lpStringExA = (LPSTRINGEXSTRUCT)GlobalLock(hStringExA)) {
00230                             <a class="code" href="../../d4/d8/jtranmsg_8c.html#a12">CompStrAToStringExA</a>(dwGCS, lpCompStrA, lpStringExA);
00231                             GlobalUnlock(hStringExA);
00232 
00233                             <span class="keywordflow">if</span> (SendMessageA(hWnd,WM_IME_REPORT,IR_STRINGEX, (LPARAM)hStringExA))
00234                             {
00235                                 GlobalFree(hStringExA);
00236                                 fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00237                                 <span class="keywordflow">goto</span> jtc_exit_30;
00238                             }
00239                         }
00240                         GlobalFree(hStringExA);
00241                     }
00242                 }
00243             }
00244             <span class="keywordflow">else</span> {
00245                 dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a13">CompStrAToStringExW</a>(dwGCS, lpCompStrA, NULL);
00246                 <span class="keywordflow">if</span> (dwSize != 0) {
00247                     HGLOBAL hStringExW = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00248                     LPSTRINGEXSTRUCT lpStringExW;
00249 
00250                     <span class="keywordflow">if</span> (hStringExW = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00251                         <span class="keywordflow">if</span> (lpStringExW = (LPSTRINGEXSTRUCT)GlobalLock(hStringExW)) {
00252                             <a class="code" href="../../d4/d8/jtranmsg_8c.html#a13">CompStrAToStringExW</a>(dwGCS, lpCompStrA, lpStringExW);
00253                             GlobalUnlock(hStringExW);
00254 
00255                             <span class="keywordflow">if</span> (SendMessageW(hWnd,WM_IME_REPORT,IR_STRINGEX, (LPARAM)hStringExW))
00256                             {
00257                                 GlobalFree(hStringExW);
00258                                 fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00259                                 <span class="keywordflow">goto</span> jtc_exit_30;
00260                             }
00261                         }
00262                         GlobalFree(hStringExW);
00263                     }
00264                 }
00265             }
00266         }
00267 
00268         <span class="comment">//</span>
00269         <span class="comment">// generate IR_STRING</span>
00270         <span class="comment">//</span>
00271 
00272         <span class="keywordflow">if</span> (bAnsiWnd) {
00273             dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a14">CompStrAToStringA</a>(lpCompStrA, NULL);
00274             <span class="keywordflow">if</span> (dwSize != 0) {
00275                 HGLOBAL hStringA = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00276                 LPSTR lpStringA;
00277 
00278                 <span class="keywordflow">if</span> (hStringA = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00279                     <span class="keywordflow">if</span> (lpStringA = (LPSTR)GlobalLock(hStringA)) {
00280                         <a class="code" href="../../d4/d8/jtranmsg_8c.html#a14">CompStrAToStringA</a>(lpCompStrA, lpStringA);
00281                         GlobalUnlock(hStringA);
00282 
00283                         <span class="keywordflow">if</span> (SendMessageA(hWnd,WM_IME_REPORT,IR_STRING, (LPARAM)hStringA))
00284                         {
00285                             GlobalFree(hStringA);
00286                             fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00287                             <span class="keywordflow">goto</span> jtc_exit_30;
00288                         }
00289                     }
00290                     GlobalFree(hStringA);
00291                 }
00292             }
00293             <span class="keywordflow">else</span> {
00294                 <span class="keywordflow">return</span> 0;
00295             }
00296         }
00297         <span class="keywordflow">else</span> {
00298             dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a15">CompStrAToStringW</a>(lpCompStrA, NULL);
00299             <span class="keywordflow">if</span> (dwSize != 0) {
00300                 HGLOBAL hStringW = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00301                 LPWSTR lpStringW;
00302 
00303                 <span class="keywordflow">if</span> (hStringW = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00304                     <span class="keywordflow">if</span> (lpStringW = (LPWSTR)GlobalLock(hStringW)) {
00305                         <a class="code" href="../../d4/d8/jtranmsg_8c.html#a15">CompStrAToStringW</a>(lpCompStrA, lpStringW);
00306                         GlobalUnlock(hStringW);
00307 
00308                         <span class="keywordflow">if</span> (SendMessageW(hWnd,WM_IME_REPORT,IR_STRING, (LPARAM)hStringW))
00309                         {
00310                             GlobalFree(hStringW);
00311                             fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00312                             <span class="keywordflow">goto</span> jtc_exit_30;
00313                         }
00314                     }
00315                     GlobalFree(hStringW);
00316                 }
00317             }
00318             <span class="keywordflow">else</span> {
00319                 <span class="keywordflow">return</span> 0;
00320             }
00321         }
00322 
00323         <span class="comment">//</span>
00324         <span class="comment">// generate IR_DBCSCHAR/IR_STRINGSTART/WM_CHAR/IR_STRINGEND</span>
00325         <span class="comment">//</span>
00326 
00327         <span class="keywordflow">if</span> (bAnsiWnd) {
00328             <a class="code" href="../../d4/d8/jtranmsg_8c.html#a16">CompStrAToCharA</a>(hWnd, lpCompStrA);
00329         }
00330         <span class="keywordflow">else</span> {
00331             <a class="code" href="../../d4/d8/jtranmsg_8c.html#a17">CompStrAToCharW</a>(hWnd, lpCompStrA);
00332         }
00333 
00334         fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00335     }
00336 
00337 
00338     <span class="keywordflow">if</span> (!fDoneUndet &amp;&amp; !fDoneDet)
00339     {
00340         *pTransMsgDest = *pTransMsgSrc;
00341         iNum++;
00342     }
00343 
00344 jtc_exit_30:
00345 
00346     <span class="keywordflow">if</span> (!fDoneUndet &amp;&amp; fDoneDet &amp;&amp; (dwGCS &amp; GCS_COMPSTR))
00347     {
00348         pTransMsgDest-&gt;message = pTransMsgSrc-&gt;message;
00349         pTransMsgDest-&gt;wParam  = pTransMsgSrc-&gt;wParam;
00350         pTransMsgDest-&gt;lParam  = (LPARAM)(dwGCS &amp; ~(GCS_RESULT | GCS_RESULTREAD));
00351         iNum++;
00352     }
00353 
00354     <span class="keywordflow">return</span> iNum;
00355 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="jtranmsg.c::JTransCompositionW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT JTransCompositionW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPINPUTCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIMC</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStrW</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTRANSMSG&nbsp;</td>
          <td class="mdname" nowrap> <em>pTransMsgSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTRANSMSG&nbsp;</td>
          <td class="mdname" nowrap> <em>pTransMsgDest</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00359">359</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l02234">CompStrWToCharA()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l02192">CompStrWToCharW()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l02135">CompStrWToStringA()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01975">CompStrWToStringExA()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01889">CompStrWToStringExW()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l02097">CompStrWToStringW()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01692">CompStrWToUndetA()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l01556">CompStrWToUndetW()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00533">IsWindowUnicode()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00582">WINNLSTranslateMessageJ()</a>.
<p>
<pre class="fragment"><div>00365 {
00366     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> i = 0;
00367     <span class="keywordtype">int</span> iNum = 0;
00368     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
00369     HWND <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>;
00370     WORD wTextLen = 0;
00371     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDoneUndet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00372     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00373     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwGCS;
00374     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bAnsiWnd;
00375 
00376     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> = (HWND)lpIMC-&gt;hWnd;
00377 
00378     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hWnd))
00379         <span class="keywordflow">return</span> 0;
00380 
00381     bAnsiWnd = (! <a class="code" href="../../d3/d8/winmgrc_8c.html#a27">IsWindowUnicode</a>(hWnd)) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00382 
00383     dwGCS = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pTransMsgSrc-&gt;lParam;
00384 
00385     <span class="keywordflow">if</span> (lpIMC-&gt;fdw31Compat &amp; F31COMPAT_MCWHIDDEN)
00386     {
00387         <span class="keywordflow">if</span> (bAnsiWnd) {
00388             dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a3">CompStrWToUndetA</a>(dwGCS, lpCompStrW, NULL);
00389             <span class="keywordflow">if</span> (dwSize != 0) {
00390                 HGLOBAL hUndetA = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00391                 LPUNDETERMINESTRUCT lpUndetA;
00392 
00393                 <span class="keywordflow">if</span> (hUndetA = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00394                     <span class="keywordflow">if</span> (lpUndetA = (LPUNDETERMINESTRUCT)GlobalLock(hUndetA)) {
00395                         <a class="code" href="../../d4/d8/jtranmsg_8c.html#a3">CompStrWToUndetA</a>(dwGCS, lpCompStrW, lpUndetA);
00396                         fDoneUndet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00397                         GlobalUnlock(hUndetA);
00398 
00399                         <span class="keywordflow">if</span> (SendMessageA(hWnd,WM_IME_REPORT,IR_UNDETERMINE, (LPARAM)hUndetA)) {
00400                             GlobalFree(hUndetA);
00401                             <span class="keywordflow">return</span> 0;
00402                         }
00403                     }
00404                     GlobalFree(hUndetA);
00405                 }
00406             }
00407         }
00408         <span class="keywordflow">else</span> {
00409             dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a2">CompStrWToUndetW</a>(dwGCS, lpCompStrW, NULL);
00410             <span class="keywordflow">if</span> (dwSize != 0) {
00411                 HGLOBAL hUndetW = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00412                 LPUNDETERMINESTRUCT lpUndetW;
00413 
00414                 <span class="keywordflow">if</span> (hUndetW = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00415                     <span class="keywordflow">if</span> (lpUndetW = (LPUNDETERMINESTRUCT)GlobalLock(hUndetW)) {
00416                         <a class="code" href="../../d4/d8/jtranmsg_8c.html#a2">CompStrWToUndetW</a>(dwGCS, lpCompStrW, lpUndetW);
00417                         fDoneUndet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00418                         GlobalUnlock(hUndetW);
00419 
00420                         <span class="keywordflow">if</span> (SendMessageW(hWnd,WM_IME_REPORT,IR_UNDETERMINE, (LPARAM)hUndetW)) {
00421                             GlobalFree(hUndetW);
00422                             <span class="keywordflow">return</span> 0;
00423                         }
00424                     }
00425                     GlobalFree(hUndetW);
00426                 }
00427             }
00428         }
00429     }
00430 
00431     <span class="comment">//</span>
00432     <span class="comment">// This is generate result string routine.</span>
00433     <span class="comment">// This should be same as WINNLSSendString of WIN3.1.</span>
00434     <span class="comment">//</span>
00435 
00436     <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTSTR)
00437     {
00438         <span class="comment">//</span>
00439         <span class="comment">// Can we generate IR_STRINGEX ?</span>
00440         <span class="comment">//</span>
00441 
00442         <span class="keywordflow">if</span> (dwGCS &amp; GCS_RESULTREADSTR)
00443         {
00444             <span class="keywordflow">if</span> (bAnsiWnd) {
00445                 dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a5">CompStrWToStringExA</a>(dwGCS, lpCompStrW, NULL);
00446                 <span class="keywordflow">if</span> (dwSize != 0) {
00447                     HGLOBAL hStringExA = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00448                     LPSTRINGEXSTRUCT lpStringExA;
00449 
00450                     <span class="keywordflow">if</span> (hStringExA = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00451                         <span class="keywordflow">if</span> (lpStringExA = (LPSTRINGEXSTRUCT)GlobalLock(hStringExA)) {
00452                             <a class="code" href="../../d4/d8/jtranmsg_8c.html#a5">CompStrWToStringExA</a>(dwGCS, lpCompStrW, lpStringExA);
00453                             GlobalUnlock(hStringExA);
00454 
00455                             <span class="keywordflow">if</span> (SendMessageA(hWnd,WM_IME_REPORT,IR_STRINGEX, (LPARAM)hStringExA))
00456                             {
00457                                 GlobalFree(hStringExA);
00458                                 fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00459                                 <span class="keywordflow">goto</span> jtc_exit_30;
00460                             }
00461                         }
00462                         GlobalFree(hStringExA);
00463                     }
00464                 }
00465             }
00466             <span class="keywordflow">else</span> {
00467                 dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a4">CompStrWToStringExW</a>(dwGCS, lpCompStrW, NULL);
00468                 <span class="keywordflow">if</span> (dwSize != 0) {
00469                     HGLOBAL hStringExW = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00470                     LPSTRINGEXSTRUCT lpStringExW;
00471 
00472                     <span class="keywordflow">if</span> (hStringExW = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00473                         <span class="keywordflow">if</span> (lpStringExW = (LPSTRINGEXSTRUCT)GlobalLock(hStringExW)) {
00474                             <a class="code" href="../../d4/d8/jtranmsg_8c.html#a4">CompStrWToStringExW</a>(dwGCS, lpCompStrW, lpStringExW);
00475                             GlobalUnlock(hStringExW);
00476 
00477                             <span class="keywordflow">if</span> (SendMessageW(hWnd,WM_IME_REPORT,IR_STRINGEX, (LPARAM)hStringExW))
00478                             {
00479                                 GlobalFree(hStringExW);
00480                                 fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00481                                 <span class="keywordflow">goto</span> jtc_exit_30;
00482                             }
00483                         }
00484                         GlobalFree(hStringExW);
00485                     }
00486                 }
00487             }
00488         }
00489 
00490         <span class="comment">//</span>
00491         <span class="comment">// generate IR_STRING</span>
00492         <span class="comment">//</span>
00493 
00494         <span class="keywordflow">if</span> (bAnsiWnd) {
00495             dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a7">CompStrWToStringA</a>(lpCompStrW, NULL);
00496             <span class="keywordflow">if</span> (dwSize != 0) {
00497                 HGLOBAL hStringA = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00498                 LPSTR lpStringA;
00499 
00500                 <span class="keywordflow">if</span> (hStringA = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00501                     <span class="keywordflow">if</span> (lpStringA = (LPSTR)GlobalLock(hStringA)) {
00502                         <a class="code" href="../../d4/d8/jtranmsg_8c.html#a7">CompStrWToStringA</a>(lpCompStrW, lpStringA);
00503                         GlobalUnlock(hStringA);
00504 
00505                         <span class="keywordflow">if</span> (SendMessageA(hWnd,WM_IME_REPORT,IR_STRING, (LPARAM)hStringA))
00506                         {
00507                             GlobalFree(hStringA);
00508                             fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00509                             <span class="keywordflow">goto</span> jtc_exit_30;
00510                         }
00511                     }
00512                     GlobalFree(hStringA);
00513                 }
00514             }
00515             <span class="keywordflow">else</span> {
00516                 <span class="keywordflow">return</span> 0;
00517             }
00518         }
00519         <span class="keywordflow">else</span> {
00520             dwSize = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a6">CompStrWToStringW</a>(lpCompStrW, NULL);
00521             <span class="keywordflow">if</span> (dwSize != 0) {
00522                 HGLOBAL hStringW = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00523                 LPWSTR lpStringW;
00524 
00525                 <span class="keywordflow">if</span> (hStringW = GlobalAlloc(GHND | GMEM_SHARE, dwSize)) {
00526                     <span class="keywordflow">if</span> (lpStringW = (LPWSTR)GlobalLock(hStringW)) {
00527                         <a class="code" href="../../d4/d8/jtranmsg_8c.html#a6">CompStrWToStringW</a>(lpCompStrW, lpStringW);
00528                         GlobalUnlock(hStringW);
00529 
00530                         <span class="keywordflow">if</span> (SendMessageW(hWnd,WM_IME_REPORT,IR_STRING, (LPARAM)hStringW))
00531                         {
00532                             GlobalFree(hStringW);
00533                             fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00534                             <span class="keywordflow">goto</span> jtc_exit_30;
00535                         }
00536                     }
00537                     GlobalFree(hStringW);
00538                 }
00539             }
00540             <span class="keywordflow">else</span> {
00541                 <span class="keywordflow">return</span> 0;
00542             }
00543         }
00544 
00545         <span class="comment">//</span>
00546         <span class="comment">// generate IR_DBCSCHAR/IR_STRINGSTART/WM_CHAR/IR_STRINGEND</span>
00547         <span class="comment">//</span>
00548 
00549         <span class="keywordflow">if</span> (bAnsiWnd) {
00550             <a class="code" href="../../d4/d8/jtranmsg_8c.html#a9">CompStrWToCharA</a>(hWnd, lpCompStrW);
00551         }
00552         <span class="keywordflow">else</span> {
00553             <a class="code" href="../../d4/d8/jtranmsg_8c.html#a8">CompStrWToCharW</a>(hWnd, lpCompStrW);
00554         }
00555 
00556         fDoneDet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00557     }
00558 
00559 
00560     <span class="keywordflow">if</span> (!fDoneUndet &amp;&amp; !fDoneDet)
00561     {
00562         *pTransMsgDest = *pTransMsgSrc;
00563         iNum++;
00564     }
00565 
00566 jtc_exit_30:
00567 
00568     <span class="keywordflow">if</span> (!fDoneUndet &amp;&amp; fDoneDet &amp;&amp; (dwGCS &amp; GCS_COMPSTR))
00569     {
00570         pTransMsgDest-&gt;message = pTransMsgSrc-&gt;message;
00571         pTransMsgDest-&gt;wParam  = pTransMsgSrc-&gt;wParam;
00572         pTransMsgDest-&gt;lParam  = (LPARAM)(dwGCS &amp; ~(GCS_RESULT | GCS_RESULTREAD));
00573         iNum++;
00574     }
00575 
00576     <span class="keywordflow">return</span> iNum;
00577 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="jtranmsg.c::WINNLSTranslateMessageJ" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT WINNLSTranslateMessageJ           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uiNumMsg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTRANSMSG&nbsp;</td>
          <td class="mdname" nowrap> <em>pTransMsg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPINPUTCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpIMC</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCOMPOSITIONSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCompStr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bAnsiIMC</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00582">582</a> of file <a class="el" href="../../d5/d7/jtranmsg_8c-source.html">jtranmsg.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00027">ImmGetDefaultIMEWnd()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00557">ImmLocalAlloc()</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00137">ImmLocalFree</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00533">IsWindowUnicode()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00137">JTransCompositionA()</a>, <a class="el" href="../../d5/d7/jtranmsg_8c-source.html#l00359">JTransCompositionW()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/ntuser_2imm_2input_8c-source.html#l00478">WINNLSTranslateMessage()</a>.
<p>
<pre class="fragment"><div>00592                    :
00593 
00594 Arguments:
00595 
00596 Return Value:
00597 
00598 --*/
00599 
00600 {
00601     PTRANSMSG       pTransMsgBuf, pTransMsgTemp;
00602     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>            uiNewNum = 0;
00603     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>            uiTempNum;
00604     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>           dwTempSize;
00605     HWND            hDefIMEWnd;
00606     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>            i;
00607     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            bAnsiWnd;
00608 
00609     hDefIMEWnd = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a4">ImmGetDefaultIMEWnd</a>((HWND)lpIMC-&gt;hWnd);
00610 
00611     bAnsiWnd = (! <a class="code" href="../../d3/d8/winmgrc_8c.html#a27">IsWindowUnicode</a>(lpIMC-&gt;hWnd)) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00612 
00613     dwTempSize = uiNumMsg * <span class="keyword">sizeof</span>(TRANSMSG);
00614 
00615     <span class="comment">//</span>
00616     <span class="comment">// Allocate one more TRANSMSG and ZEROINIT the whole thing!</span>
00617     <span class="comment">//</span>
00618 
00619     pTransMsgBuf = (PTRANSMSG)<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a22">ImmLocalAlloc</a>( HEAP_ZERO_MEMORY,
00620                                              dwTempSize + <span class="keyword">sizeof</span>(TRANSMSG)
00621                                            );
00622     <span class="keywordflow">if</span> ( pTransMsgBuf == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
00623         <span class="keywordflow">goto</span> wtmsg2_j_10;
00624 
00625     RtlCopyMemory(pTransMsgBuf, pTransMsg, dwTempSize);
00626     pTransMsgTemp = pTransMsgBuf;
00627 
00628     <span class="comment">//</span>
00629     <span class="comment">// When MCW_HIDDEN mode, WM_IME_ENDCOMPOSITION will be translated to</span>
00630     <span class="comment">// IR_UNDETERMINE with 0 string. So that, this message have to be</span>
00631     <span class="comment">// generated after all messages.</span>
00632     <span class="comment">//</span>
00633 
00634     <span class="keywordflow">if</span> (lpIMC-&gt;fdw31Compat &amp; F31COMPAT_MCWHIDDEN) {
00635 
00636         <span class="keywordflow">for</span> (i = 0; i &lt; uiNumMsg; i++, pTransMsgTemp++) {
00637             <span class="keywordflow">if</span> (pTransMsgTemp-&gt;message == WM_IME_ENDCOMPOSITION) {
00638                 <span class="keywordflow">break</span>;
00639             }
00640         }
00641 
00642         <span class="keywordflow">if</span> (pTransMsgTemp-&gt;message == WM_IME_ENDCOMPOSITION) {
00643 
00644             PTRANSMSG pTransMsgSrc = pTransMsgTemp + 1;
00645 
00646             <span class="keywordflow">while</span> (pTransMsgSrc-&gt;message != 0) {
00647                 *pTransMsgTemp++ = *pTransMsgSrc++;
00648             }
00649 
00650             pTransMsgTemp-&gt;message = WM_IME_ENDCOMPOSITION;
00651             pTransMsgTemp-&gt;wParam  = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00652             pTransMsgTemp-&gt;lParam  = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00653 
00654         }
00655 
00656         pTransMsgTemp = pTransMsgBuf;
00657     }
00658 
00659     <span class="keywordflow">while</span> (pTransMsgTemp-&gt;message != 0) {
00660 
00661         <span class="keywordflow">switch</span> (pTransMsgTemp-&gt;message)
00662         {
00663             <span class="keywordflow">case</span> WM_IME_COMPOSITION:
00664 
00665                 <span class="keywordflow">if</span> (bAnsiIMC)
00666                     uiTempNum = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a0">JTransCompositionA</a>(lpIMC,lpCompStr,pTransMsgTemp,pTransMsg);
00667                 <span class="keywordflow">else</span>
00668                     uiTempNum = <a class="code" href="../../d4/d8/jtranmsg_8c.html#a1">JTransCompositionW</a>(lpIMC,lpCompStr,pTransMsgTemp,pTransMsg);
00669 
00670                 uiNewNum  += uiTempNum;
00671                 pTransMsg += uiTempNum;
00672 
00673                 <span class="keywordflow">if</span> ( !(lpIMC-&gt;fdw31Compat &amp; F31COMPAT_MCWHIDDEN) )
00674                 {
00675                     <span class="keywordflow">if</span> ( lpIMC-&gt;cfCompForm.dwStyle != CFS_DEFAULT ) {
00676                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>((HWND)lpIMC-&gt;hWnd, WM_IME_REPORT, IR_CHANGECONVERT, 0L);
00677                     }
00678                 }
00679 
00680                 <span class="keywordflow">break</span>;
00681 
00682             <span class="keywordflow">case</span> WM_IME_STARTCOMPOSITION:
00683 
00684                 <span class="keywordflow">if</span> ( !(lpIMC-&gt;fdw31Compat &amp; F31COMPAT_MCWHIDDEN) )
00685                 {
00686                     <span class="keywordflow">if</span> ( lpIMC-&gt;cfCompForm.dwStyle != CFS_DEFAULT ) {
00687                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>((HWND)lpIMC-&gt;hWnd, WM_IME_REPORT, IR_OPENCONVERT, 0L);
00688                     }
00689 
00690                     *pTransMsg++ = *pTransMsgTemp;
00691                     uiNewNum++;
00692                 }
00693 
00694                 <span class="keywordflow">break</span>;
00695 
00696             <span class="keywordflow">case</span> WM_IME_ENDCOMPOSITION:
00697 
00698                 <span class="keywordflow">if</span> ( !(lpIMC-&gt;fdw31Compat &amp; F31COMPAT_MCWHIDDEN) )
00699                 {
00700                     <span class="keywordflow">if</span> ( lpIMC-&gt;cfCompForm.dwStyle != CFS_DEFAULT ) {
00701                         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>((HWND)lpIMC-&gt;hWnd, WM_IME_REPORT, IR_CLOSECONVERT, 0L);
00702                     }
00703 
00704                     *pTransMsg++ = *pTransMsgTemp;
00705                     uiNewNum++;
00706 
00707                 }
00708                 <span class="keywordflow">else</span> {
00709 
00710                     HWND <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> = (HWND)lpIMC-&gt;hWnd;
00711                     HGLOBAL hUndet = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00712 
00713                     <span class="keywordflow">if</span> (hUndet = GlobalAlloc(GHND | GMEM_SHARE, <span class="keyword">sizeof</span>(UNDETERMINESTRUCT)))
00714                     {
00715                         <span class="keywordflow">if</span> (! <a class="code" href="../../d3/d8/winmgrc_8c.html#a27">IsWindowUnicode</a>(lpIMC-&gt;hWnd))
00716                             SendMessageA(hWnd,WM_IME_REPORT, IR_UNDETERMINE, (LPARAM)hUndet);
00717                         <span class="keywordflow">else</span>
00718                             SendMessageW(hWnd,WM_IME_REPORT, IR_UNDETERMINE, (LPARAM)hUndet);
00719 
00720                         GlobalFree(hUndet);
00721                     }
00722                 }
00723 
00724                 <span class="keywordflow">break</span>;
00725 
00726             <span class="keywordflow">case</span> WM_IME_NOTIFY:
00727 
00728                 <span class="keywordflow">switch</span> (pTransMsgTemp-&gt;wParam)
00729                 {
00730                     <span class="keywordflow">case</span> IMN_OPENCANDIDATE:
00731 
00732                         <span class="comment">//</span>
00733                         <span class="comment">// When 3.1 Application want to set MCW_HIDDEN,</span>
00734                         <span class="comment">// the candidate window of Chicago IME go way</span>
00735                         <span class="comment">// from the restangle of the composition string</span>
00736                         <span class="comment">// that will be drawn by the application.</span>
00737                         <span class="comment">//</span>
00738 
00739                         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>((HWND)lpIMC-&gt;hWnd) &amp;&amp;
00740                             (lpIMC-&gt;fdw31Compat &amp; F31COMPAT_MCWHIDDEN)) {
00741                             CANDIDATEFORM cfCandForm;
00742                             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
00743                             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwNumCand = 0;
00744 
00745                             <span class="keywordflow">for</span> (i = 0; i &lt; 32; i++)
00746                             {
00747                                 <span class="comment">//</span>
00748                                 <span class="comment">// Only the opened candidate should be updated.</span>
00749                                 <span class="comment">//</span>
00750                                 <span class="keywordflow">if</span> (!(pTransMsgTemp-&gt;lParam &amp; (01<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a> &lt;&lt; i)))
00751                                     <span class="keywordflow">continue</span>;
00752 
00753                                 cfCandForm.dwIndex = i;
00754                                 cfCandForm.dwStyle = CFS_EXCLUDE;
00755                                 cfCandForm.ptCurrentPos = lpIMC-&gt;cfCompForm.ptCurrentPos;
00756                                 cfCandForm.rcArea       = lpIMC-&gt;cfCompForm.rcArea;
00757                                 <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hDefIMEWnd, WM_IME_CONTROL, IMC_SETCANDIDATEPOS,
00758                                                (LPARAM)(LPCANDIDATEFORM)&amp;cfCandForm);
00759                             }
00760                         }
00761 
00762                         <span class="keywordflow">break</span>;
00763 
00764                     <span class="keywordflow">default</span> :
00765                         <span class="keywordflow">break</span>;
00766                 }
00767 
00768                 <span class="keywordflow">if</span> (!(lpIMC-&gt;fdw31Compat &amp; F31COMPAT_MCWHIDDEN)) {
00769                     *pTransMsg++ = *pTransMsgTemp;
00770                     uiNewNum++;
00771                 }
00772                 <span class="keywordflow">else</span> {
00773                     <span class="comment">//</span>
00774                     <span class="comment">// For win31 apps who set MCW_HIDDEN, we won't give them</span>
00775                     <span class="comment">// IMN_OPENCANDIDATE here. Instead, send it directly to the</span>
00776                     <span class="comment">// default IME window.</span>
00777                     <span class="comment">//</span>
00778                     <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>( hDefIMEWnd, 
00779                                  pTransMsgTemp-&gt;message,
00780                                  pTransMsgTemp-&gt;wParam,
00781                                  pTransMsgTemp-&gt;lParam
00782                                );
00783                 }
00784 
00785                 <span class="keywordflow">break</span>;
00786 
00787             <span class="keywordflow">default</span> :
00788                 *pTransMsg++ = *pTransMsgTemp;
00789                 uiNewNum++;
00790                 <span class="keywordflow">break</span>;
00791         }
00792 
00793         pTransMsgTemp++;
00794     }
00795 
00796     <a class="code" href="../../d4/d0/immcli_8h.html#a8">ImmLocalFree</a>(pTransMsgBuf);
00797 
00798 wtmsg2_j_10:
00799     <span class="keywordflow">return</span> (uiNewNum);
00800 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
