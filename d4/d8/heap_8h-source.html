<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: heap.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>heap.h</h1><a href="../../d3/d9/heap_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1992  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    heap.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This is the header file that describes the constants and data</span>
00012 <span class="comment">    structures used by the user mode heap manager, exported by ntdll.dll</span>
00013 <span class="comment">    and ntrtl.lib</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Procedure prototypes are defined in ntrtl.h</span>
00016 <span class="comment"></span>
00017 <span class="comment">Author:</span>
00018 <span class="comment"></span>
00019 <span class="comment">    Steve Wood (stevewo) 21-Aug-1992</span>
00020 <span class="comment"></span>
00021 <span class="comment">Revision History:</span>
00022 <span class="comment"></span>
00023 <span class="comment">--*/</span>
00024 
00025 <span class="preprocessor">#ifndef _RTL_HEAP_</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#define _RTL_HEAP_</span>
00027 <span class="preprocessor"></span>
<a name="l00028"></a><a class="code" href="../../d3/d9/heap_8h.html#a0">00028</a> <span class="preprocessor">#define HEAP_LARGE_TAG_MASK 0xFF000000</span>
00029 <span class="preprocessor"></span>
<a name="l00030"></a><a class="code" href="../../d3/d9/heap_8h.html#a1">00030</a> <span class="preprocessor">#define ROUND_UP_TO_POWER2( x, n ) (((ULONG_PTR)(x) + ((n)-1)) &amp; ~((ULONG_PTR)(n)-1))</span>
<a name="l00031"></a><a class="code" href="../../d3/d9/heap_8h.html#a2">00031</a> <span class="preprocessor"></span><span class="preprocessor">#define ROUND_DOWN_TO_POWER2( x, n ) ((ULONG_PTR)(x) &amp; ~((ULONG_PTR)(n)-1))</span>
00032 <span class="preprocessor"></span>
<a name="l00033"></a><a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">00033</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">_HEAP_ENTRY</a> {
00034 
00035     <span class="comment">//</span>
00036     <span class="comment">//  This field gives the size of the current block in allocation</span>
00037     <span class="comment">//  granularity units.  (i.e. Size &lt;&lt; HEAP_GRANULARITY_SHIFT</span>
00038     <span class="comment">//  equals the size in bytes).</span>
00039     <span class="comment">//</span>
00040     <span class="comment">//  Except if this is part of a virtual alloc block then this</span>
00041     <span class="comment">//  value is the difference between the commit size in the virtual</span>
00042     <span class="comment">//  alloc entry and the what the user asked for.</span>
00043     <span class="comment">//</span>
00044 
<a name="l00045"></a><a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o0">00045</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00046 
00047     <span class="comment">//</span>
00048     <span class="comment">// This field gives the size of the previous block in allocation</span>
00049     <span class="comment">// granularity units. (i.e. PreviousSize &lt;&lt; HEAP_GRANULARITY_SHIFT</span>
00050     <span class="comment">// equals the size of the previous block in bytes).</span>
00051     <span class="comment">//</span>
00052 
<a name="l00053"></a><a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o1">00053</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o1">PreviousSize</a>;
00054 
00055     <span class="comment">//</span>
00056     <span class="comment">// This field contains the index into the segment that controls</span>
00057     <span class="comment">// the memory for this block.</span>
00058     <span class="comment">//</span>
00059 
<a name="l00060"></a><a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o2">00060</a>     UCHAR <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o2">SegmentIndex</a>;
00061 
00062     <span class="comment">//</span>
00063     <span class="comment">// This field contains various flag bits associated with this block.</span>
00064     <span class="comment">// Currently these are:</span>
00065     <span class="comment">//</span>
00066     <span class="comment">//  0x01 - HEAP_ENTRY_BUSY</span>
00067     <span class="comment">//  0x02 - HEAP_ENTRY_EXTRA_PRESENT</span>
00068     <span class="comment">//  0x04 - HEAP_ENTRY_FILL_PATTERN</span>
00069     <span class="comment">//  0x08 - HEAP_ENTRY_VIRTUAL_ALLOC</span>
00070     <span class="comment">//  0x10 - HEAP_ENTRY_LAST_ENTRY</span>
00071     <span class="comment">//  0x20 - HEAP_ENTRY_SETTABLE_FLAG1</span>
00072     <span class="comment">//  0x40 - HEAP_ENTRY_SETTABLE_FLAG2</span>
00073     <span class="comment">//  0x80 - HEAP_ENTRY_SETTABLE_FLAG3</span>
00074     <span class="comment">//</span>
00075 
<a name="l00076"></a><a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o3">00076</a>     UCHAR <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o3">Flags</a>;
00077 
00078     <span class="comment">//</span>
00079     <span class="comment">// This field contains the number of unused bytes at the end of this</span>
00080     <span class="comment">// block that were not actually allocated.  Used to compute exact</span>
00081     <span class="comment">// size requested prior to rounding requested size to allocation</span>
00082     <span class="comment">// granularity.  Also used for tail checking purposes.</span>
00083     <span class="comment">//</span>
00084 
<a name="l00085"></a><a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o4">00085</a>     UCHAR <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o4">UnusedBytes</a>;
00086 
00087     <span class="comment">//</span>
00088     <span class="comment">// Small (8 bit) tag indexes can go here.</span>
00089     <span class="comment">//</span>
00090 
<a name="l00091"></a><a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o5">00091</a>     UCHAR <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html#o5">SmallTagIndex</a>;
00092 
00093 <span class="preprocessor">#if defined(_WIN64)</span>
00094 <span class="preprocessor"></span>    ULONGLONG <a class="code" href="../../d1/d9/arc_8h.html#a313a149">Reserved1</a>;
00095 <span class="preprocessor">#endif</span>
00096 <span class="preprocessor"></span>
00097 } <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">HEAP_ENTRY</a>, *<a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">PHEAP_ENTRY</a>;
00098 
00099 
00100 <span class="comment">//</span>
00101 <span class="comment">// This block describes extra information that might be at the end of a</span>
00102 <span class="comment">// busy block.</span>
00103 <span class="comment">//</span>
00104 
<a name="l00105"></a><a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html">00105</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html">_HEAP_ENTRY_EXTRA</a> {
00106     <span class="keyword">union </span>{
00107         <span class="keyword">struct </span>{
00108             <span class="comment">//</span>
00109             <span class="comment">// This field is for debugging purposes.  It will normally contain a</span>
00110             <span class="comment">// stack back trace index of the allocator for x86 systems.</span>
00111             <span class="comment">//</span>
00112 
<a name="l00113"></a><a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html#o0">00113</a>             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html#o0">AllocatorBackTraceIndex</a>;
00114 
00115             <span class="comment">//</span>
00116             <span class="comment">// This field is currently unused, but is intended for storing</span>
00117             <span class="comment">// any encoded value that will give the that gives the type of object</span>
00118             <span class="comment">// allocated.</span>
00119             <span class="comment">//</span>
00120 
<a name="l00121"></a><a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html#o1">00121</a>             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html#o1">TagIndex</a>;
00122 
00123             <span class="comment">//</span>
00124             <span class="comment">// This field is a 32-bit settable value that a higher level heap package</span>
00125             <span class="comment">// can use.  The Win32 heap manager stores handle values in this field.</span>
00126             <span class="comment">//</span>
00127 
<a name="l00128"></a><a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html#o2">00128</a>             ULONG_PTR <a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html#o2">Settable</a>;
00129         };
00130 <span class="preprocessor">#if defined(_WIN64)</span>
00131 <span class="preprocessor"></span>        <span class="keyword">struct </span>{
00132             ULONGLONG ZeroInit;
00133             ULONGLONG ZeroInit1;
00134         };
00135 <span class="preprocessor">#else</span>
<a name="l00136"></a><a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html#o3">00136</a> <span class="preprocessor"></span>        ULONGLONG <a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html#o3">ZeroInit</a>;
00137 <span class="preprocessor">#endif</span>
00138 <span class="preprocessor"></span>    };
00139 } <a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html">HEAP_ENTRY_EXTRA</a>, *<a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html">PHEAP_ENTRY_EXTRA</a>;
00140 
00141 <span class="comment">//</span>
00142 <span class="comment">// This structure is present at the end of a free block if HEAP_ENTRY_EXTRA_PRESENT</span>
00143 <span class="comment">// is set in the Flags field of a HEAP_FREE_ENTRY structure.  It is used to save the</span>
00144 <span class="comment">// tag index that was associated with the allocated block after it has been freed.</span>
00145 <span class="comment">// Works best when coalesce on free is disabled, along with decommitment.</span>
00146 <span class="comment">//</span>
00147 
<a name="l00148"></a><a class="code" href="../../d2/d6/struct__HEAP__FREE__ENTRY__EXTRA.html">00148</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d6/struct__HEAP__FREE__ENTRY__EXTRA.html">_HEAP_FREE_ENTRY_EXTRA</a> {
<a name="l00149"></a><a class="code" href="../../d2/d6/struct__HEAP__FREE__ENTRY__EXTRA.html#o0">00149</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d6/struct__HEAP__FREE__ENTRY__EXTRA.html#o0">TagIndex</a>;
<a name="l00150"></a><a class="code" href="../../d2/d6/struct__HEAP__FREE__ENTRY__EXTRA.html#o1">00150</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d6/struct__HEAP__FREE__ENTRY__EXTRA.html#o1">FreeBackTraceIndex</a>;
00151 } <a class="code" href="../../d2/d6/struct__HEAP__FREE__ENTRY__EXTRA.html">HEAP_FREE_ENTRY_EXTRA</a>, *<a class="code" href="../../d2/d6/struct__HEAP__FREE__ENTRY__EXTRA.html">PHEAP_FREE_ENTRY_EXTRA</a>;
00152 
00153 <span class="comment">//</span>
00154 <span class="comment">// This structure describes a block that lies outside normal heap memory</span>
00155 <span class="comment">// as it was allocated with NtAllocateVirtualMemory and has the</span>
00156 <span class="comment">// HEAP_ENTRY_VIRTUAL_ALLOC flag set.</span>
00157 <span class="comment">//</span>
00158 
<a name="l00159"></a><a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html">00159</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html">_HEAP_VIRTUAL_ALLOC_ENTRY</a> {
<a name="l00160"></a><a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html#o0">00160</a>     LIST_ENTRY <a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html#o0">Entry</a>;
<a name="l00161"></a><a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html#o1">00161</a>     <a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html">HEAP_ENTRY_EXTRA</a> <a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html#o1">ExtraStuff</a>;
<a name="l00162"></a><a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html#o2">00162</a>     SIZE_T <a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html#o2">CommitSize</a>;
<a name="l00163"></a><a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html#o3">00163</a>     SIZE_T <a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html#o3">ReserveSize</a>;
<a name="l00164"></a><a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html#o4">00164</a>     <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">HEAP_ENTRY</a> <a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html#o4">BusyBlock</a>;
00165 } <a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html">HEAP_VIRTUAL_ALLOC_ENTRY</a>, *<a class="code" href="../../d6/d7/struct__HEAP__VIRTUAL__ALLOC__ENTRY.html">PHEAP_VIRTUAL_ALLOC_ENTRY</a>;
00166 
<a name="l00167"></a><a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html">00167</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html">_HEAP_FREE_ENTRY</a> {
00168     <span class="comment">//</span>
00169     <span class="comment">// This field gives the size of the current block in allocation</span>
00170     <span class="comment">// granularity units.  (i.e. Size &lt;&lt; HEAP_GRANULARITY_SHIFT</span>
00171     <span class="comment">// equals the size in bytes).</span>
00172     <span class="comment">//</span>
00173 
<a name="l00174"></a><a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o0">00174</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00175 
00176     <span class="comment">//</span>
00177     <span class="comment">// This field gives the size of the previous block in allocation</span>
00178     <span class="comment">// granularity units. (i.e. PreviousSize &lt;&lt; HEAP_GRANULARITY_SHIFT</span>
00179     <span class="comment">// equals the size of the previous block in bytes).</span>
00180     <span class="comment">//</span>
00181 
<a name="l00182"></a><a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o1">00182</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o1">PreviousSize</a>;
00183 
00184     <span class="comment">//</span>
00185     <span class="comment">// This field contains the index into the segment that controls</span>
00186     <span class="comment">// the memory for this block.</span>
00187     <span class="comment">//</span>
00188 
<a name="l00189"></a><a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o2">00189</a>     UCHAR <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o2">SegmentIndex</a>;
00190 
00191     <span class="comment">//</span>
00192     <span class="comment">// This field contains various flag bits associated with this block.</span>
00193     <span class="comment">// Currently for free blocks these can be:</span>
00194     <span class="comment">//</span>
00195     <span class="comment">//  0x02 - HEAP_ENTRY_EXTRA_PRESENT</span>
00196     <span class="comment">//  0x04 - HEAP_ENTRY_FILL_PATTERN</span>
00197     <span class="comment">//  0x10 - HEAP_ENTRY_LAST_ENTRY</span>
00198     <span class="comment">//</span>
00199 
<a name="l00200"></a><a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o3">00200</a>     UCHAR <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o3">Flags</a>;
00201 
00202     <span class="comment">//</span>
00203     <span class="comment">// Two fields to encode the location of the bit in FreeListsInUse</span>
00204     <span class="comment">// array in HEAP_SEGMENT for blocks of this size.</span>
00205     <span class="comment">//</span>
00206 
<a name="l00207"></a><a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o4">00207</a>     UCHAR <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o4">Index</a>;
<a name="l00208"></a><a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o5">00208</a>     UCHAR <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o5">Mask</a>;
00209 
00210     <span class="comment">//</span>
00211     <span class="comment">// Free blocks use these two words for linking together free blocks</span>
00212     <span class="comment">// of the same size on a doubly linked list.</span>
00213     <span class="comment">//</span>
<a name="l00214"></a><a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o6">00214</a>     LIST_ENTRY <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html#o6">FreeList</a>;
00215 
00216 <span class="preprocessor">#if defined(_WIN64)</span>
00217 <span class="preprocessor"></span>    ULONGLONG <a class="code" href="../../d1/d9/arc_8h.html#a313a149">Reserved1</a>;
00218 <span class="preprocessor">#endif</span>
00219 <span class="preprocessor"></span>
00220 } <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html">HEAP_FREE_ENTRY</a>, *<a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html">PHEAP_FREE_ENTRY</a>;
00221 
00222 
00223 
<a name="l00224"></a><a class="code" href="../../d3/d9/heap_8h.html#a3">00224</a> <span class="preprocessor">#define HEAP_GRANULARITY            ((LONG) sizeof( HEAP_ENTRY ))</span>
00225 <span class="preprocessor"></span><span class="preprocessor">#if defined(_WIN64)</span>
00226 <span class="preprocessor"></span><span class="preprocessor">#define HEAP_GRANULARITY_SHIFT      4   // Log2( HEAP_GRANULARITY )</span>
00227 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00228"></a><a class="code" href="../../d3/d9/heap_8h.html#a4">00228</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_GRANULARITY_SHIFT      3   // Log2( HEAP_GRANULARITY )</span>
00229 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00230 <span class="preprocessor"></span>
<a name="l00231"></a><a class="code" href="../../d3/d9/heap_8h.html#a5">00231</a> <span class="preprocessor">#define HEAP_MAXIMUM_BLOCK_SIZE     (USHORT)(((0x10000 &lt;&lt; HEAP_GRANULARITY_SHIFT) - PAGE_SIZE) &gt;&gt; HEAP_GRANULARITY_SHIFT)</span>
00232 <span class="preprocessor"></span>
<a name="l00233"></a><a class="code" href="../../d3/d9/heap_8h.html#a6">00233</a> <span class="preprocessor">#define HEAP_MAXIMUM_FREELISTS 128</span>
<a name="l00234"></a><a class="code" href="../../d3/d9/heap_8h.html#a7">00234</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_MAXIMUM_SEGMENTS 64</span>
00235 <span class="preprocessor"></span>
<a name="l00236"></a><a class="code" href="../../d3/d9/heap_8h.html#a8">00236</a> <span class="preprocessor">#define HEAP_ENTRY_BUSY             0x01</span>
<a name="l00237"></a><a class="code" href="../../d3/d9/heap_8h.html#a9">00237</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_ENTRY_EXTRA_PRESENT    0x02</span>
<a name="l00238"></a><a class="code" href="../../d3/d9/heap_8h.html#a10">00238</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_ENTRY_FILL_PATTERN     0x04</span>
<a name="l00239"></a><a class="code" href="../../d3/d9/heap_8h.html#a11">00239</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_ENTRY_VIRTUAL_ALLOC    0x08</span>
<a name="l00240"></a><a class="code" href="../../d3/d9/heap_8h.html#a12">00240</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_ENTRY_LAST_ENTRY       0x10</span>
<a name="l00241"></a><a class="code" href="../../d3/d9/heap_8h.html#a13">00241</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_ENTRY_SETTABLE_FLAG1   0x20</span>
<a name="l00242"></a><a class="code" href="../../d3/d9/heap_8h.html#a14">00242</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_ENTRY_SETTABLE_FLAG2   0x40</span>
<a name="l00243"></a><a class="code" href="../../d3/d9/heap_8h.html#a15">00243</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_ENTRY_SETTABLE_FLAG3   0x80</span>
<a name="l00244"></a><a class="code" href="../../d3/d9/heap_8h.html#a16">00244</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_ENTRY_SETTABLE_FLAGS   0xE0</span>
00245 <span class="preprocessor"></span>
00246 <span class="comment">//</span>
00247 <span class="comment">// HEAP_SEGMENT defines the structure used to describe a range of</span>
00248 <span class="comment">// contiguous virtual memory that has been set aside for use by</span>
00249 <span class="comment">// a heap.</span>
00250 <span class="comment">//</span>
00251 
<a name="l00252"></a><a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html">00252</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html">_HEAP_UNCOMMMTTED_RANGE</a> {
<a name="l00253"></a><a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html#o0">00253</a>     <span class="keyword">struct </span><a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html">_HEAP_UNCOMMMTTED_RANGE</a> *<a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html#o0">Next</a>;
<a name="l00254"></a><a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html#o1">00254</a>     ULONG_PTR <a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html#o1">Address</a>;
<a name="l00255"></a><a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html#o2">00255</a>     SIZE_T <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
<a name="l00256"></a><a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html#o3">00256</a>     ULONG <a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html#o3">filler</a>;
00257 } <a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html">HEAP_UNCOMMMTTED_RANGE</a>, *<a class="code" href="../../d5/d7/struct__HEAP__UNCOMMMTTED__RANGE.html">PHEAP_UNCOMMMTTED_RANGE</a>;
00258 
<a name="l00259"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html">00259</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html">_HEAP_SEGMENT</a> {
<a name="l00260"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o0">00260</a>     <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">HEAP_ENTRY</a> <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o0">Entry</a>;
00261 
<a name="l00262"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o1">00262</a>     ULONG <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o1">Signature</a>;
<a name="l00263"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o2">00263</a>     ULONG <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o2">Flags</a>;
<a name="l00264"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o3">00264</a>     <span class="keyword">struct </span><a class="code" href="../../d5/d5/struct__HEAP.html">_HEAP</a> *<a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o3">Heap</a>;
<a name="l00265"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o4">00265</a>     SIZE_T <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o4">LargestUnCommittedRange</a>;
00266 
<a name="l00267"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o5">00267</a>     PVOID <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o5">BaseAddress</a>;
<a name="l00268"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o6">00268</a>     ULONG <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o6">NumberOfPages</a>;
<a name="l00269"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o7">00269</a>     <a class="code" href="../../d3/d9/heap_8h.html#a34">PHEAP_ENTRY</a> <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o7">FirstEntry</a>;
<a name="l00270"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o8">00270</a>     <a class="code" href="../../d3/d9/heap_8h.html#a34">PHEAP_ENTRY</a> <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o8">LastValidEntry</a>;
00271 
<a name="l00272"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o9">00272</a>     ULONG <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o9">NumberOfUnCommittedPages</a>;
<a name="l00273"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o10">00273</a>     ULONG <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o10">NumberOfUnCommittedRanges</a>;
<a name="l00274"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o11">00274</a>     <a class="code" href="../../d3/d9/heap_8h.html#a44">PHEAP_UNCOMMMTTED_RANGE</a> <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o11">UnCommittedRanges</a>;
<a name="l00275"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o12">00275</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o12">AllocatorBackTraceIndex</a>;
<a name="l00276"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o13">00276</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o13">Reserved</a>;
<a name="l00277"></a><a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o14">00277</a>     <a class="code" href="../../d3/d9/heap_8h.html#a34">PHEAP_ENTRY</a> <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html#o14">LastEntryInSegment</a>;
00278 } <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html">HEAP_SEGMENT</a>, *<a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html">PHEAP_SEGMENT</a>;
00279 
<a name="l00280"></a><a class="code" href="../../d3/d9/heap_8h.html#a17">00280</a> <span class="preprocessor">#define HEAP_SEGMENT_SIGNATURE  0xFFEEFFEE</span>
<a name="l00281"></a><a class="code" href="../../d3/d9/heap_8h.html#a18">00281</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_SEGMENT_USER_ALLOCATED (ULONG)0x00000001</span>
00282 <span class="preprocessor"></span>
00283 <span class="comment">//</span>
00284 <span class="comment">// HEAP defines the header for a heap.</span>
00285 <span class="comment">//</span>
00286 
<a name="l00287"></a><a class="code" href="../../d4/d6/struct__HEAP__LOCK.html">00287</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d6/struct__HEAP__LOCK.html">_HEAP_LOCK</a> {
00288     <span class="keyword">union </span>{
<a name="l00289"></a><a class="code" href="../../d4/d6/struct__HEAP__LOCK.html#o0">00289</a>         RTL_CRITICAL_SECTION <a class="code" href="../../d4/d6/struct__HEAP__LOCK.html#o0">CriticalSection</a>;
<a name="l00290"></a><a class="code" href="../../d4/d6/struct__HEAP__LOCK.html#o1">00290</a>         <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d4/d6/struct__HEAP__LOCK.html#o1">Resource</a>;
00291     } Lock;
00292 } <a class="code" href="../../d4/d6/struct__HEAP__LOCK.html">HEAP_LOCK</a>, *<a class="code" href="../../d4/d6/struct__HEAP__LOCK.html">PHEAP_LOCK</a>;
00293 
<a name="l00294"></a><a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html">00294</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html">_HEAP_UCR_SEGMENT</a> {
<a name="l00295"></a><a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html#o0">00295</a>     <span class="keyword">struct </span><a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html">_HEAP_UCR_SEGMENT</a> *<a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html#o0">Next</a>;
<a name="l00296"></a><a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html#o1">00296</a>     SIZE_T <a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html#o1">ReservedSize</a>;
<a name="l00297"></a><a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html#o2">00297</a>     SIZE_T <a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html#o2">CommittedSize</a>;
<a name="l00298"></a><a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html#o3">00298</a>     ULONG <a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html#o3">filler</a>;
00299 } <a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html">HEAP_UCR_SEGMENT</a>, *<a class="code" href="../../d4/d7/struct__HEAP__UCR__SEGMENT.html">PHEAP_UCR_SEGMENT</a>;
00300 
00301 
<a name="l00302"></a><a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html">00302</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html">_HEAP_TAG_ENTRY</a> {
<a name="l00303"></a><a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o0">00303</a>     ULONG <a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o0">Allocs</a>;
<a name="l00304"></a><a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o1">00304</a>     ULONG <a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o1">Frees</a>;
<a name="l00305"></a><a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o2">00305</a>     SIZE_T <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
<a name="l00306"></a><a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o3">00306</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o3">TagIndex</a>;
<a name="l00307"></a><a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o4">00307</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o4">CreatorBackTraceIndex</a>;
<a name="l00308"></a><a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o5">00308</a>     WCHAR <a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html#o5">TagName</a>[ 24 ];
00309 } <a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html">HEAP_TAG_ENTRY</a>, *<a class="code" href="../../d3/d7/struct__HEAP__TAG__ENTRY.html">PHEAP_TAG_ENTRY</a>;     <span class="comment">// sizeof( HEAP_TAG_ENTRY ) must divide page size evenly</span>
00310 
<a name="l00311"></a><a class="code" href="../../d7/d6/struct__HEAP__PSEUDO__TAG__ENTRY.html">00311</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d6/struct__HEAP__PSEUDO__TAG__ENTRY.html">_HEAP_PSEUDO_TAG_ENTRY</a> {
<a name="l00312"></a><a class="code" href="../../d7/d6/struct__HEAP__PSEUDO__TAG__ENTRY.html#o0">00312</a>     ULONG <a class="code" href="../../d7/d6/struct__HEAP__PSEUDO__TAG__ENTRY.html#o0">Allocs</a>;
<a name="l00313"></a><a class="code" href="../../d7/d6/struct__HEAP__PSEUDO__TAG__ENTRY.html#o1">00313</a>     ULONG <a class="code" href="../../d7/d6/struct__HEAP__PSEUDO__TAG__ENTRY.html#o1">Frees</a>;
<a name="l00314"></a><a class="code" href="../../d7/d6/struct__HEAP__PSEUDO__TAG__ENTRY.html#o2">00314</a>     SIZE_T <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00315 } <a class="code" href="../../d7/d6/struct__HEAP__PSEUDO__TAG__ENTRY.html">HEAP_PSEUDO_TAG_ENTRY</a>, *<a class="code" href="../../d7/d6/struct__HEAP__PSEUDO__TAG__ENTRY.html">PHEAP_PSEUDO_TAG_ENTRY</a>;
00316 
00317 
<a name="l00318"></a><a class="code" href="../../d5/d5/struct__HEAP.html">00318</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d5/struct__HEAP.html">_HEAP</a> {
<a name="l00319"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o0">00319</a>     <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">HEAP_ENTRY</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o0">Entry</a>;
00320 
<a name="l00321"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o1">00321</a>     ULONG <a class="code" href="../../d5/d5/struct__HEAP.html#o1">Signature</a>;
<a name="l00322"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o2">00322</a>     ULONG <a class="code" href="../../d5/d5/struct__HEAP.html#o2">Flags</a>;
<a name="l00323"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o3">00323</a>     ULONG <a class="code" href="../../d5/d5/struct__HEAP.html#o3">ForceFlags</a>;
<a name="l00324"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o4">00324</a>     ULONG <a class="code" href="../../d5/d5/struct__HEAP.html#o4">VirtualMemoryThreshold</a>;
00325 
<a name="l00326"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o5">00326</a>     SIZE_T <a class="code" href="../../d5/d5/struct__HEAP.html#o5">SegmentReserve</a>;
<a name="l00327"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o6">00327</a>     SIZE_T <a class="code" href="../../d5/d5/struct__HEAP.html#o6">SegmentCommit</a>;
<a name="l00328"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o7">00328</a>     SIZE_T <a class="code" href="../../d5/d5/struct__HEAP.html#o7">DeCommitFreeBlockThreshold</a>;
<a name="l00329"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o8">00329</a>     SIZE_T <a class="code" href="../../d5/d5/struct__HEAP.html#o8">DeCommitTotalFreeThreshold</a>;
00330 
<a name="l00331"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o9">00331</a>     SIZE_T <a class="code" href="../../d5/d5/struct__HEAP.html#o9">TotalFreeSize</a>;
<a name="l00332"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o10">00332</a>     SIZE_T <a class="code" href="../../d5/d5/struct__HEAP.html#o10">MaximumAllocationSize</a>;
<a name="l00333"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o11">00333</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o11">ProcessHeapsListIndex</a>;
<a name="l00334"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o12">00334</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o12">HeaderValidateLength</a>;
<a name="l00335"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o13">00335</a>     PVOID <a class="code" href="../../d5/d5/struct__HEAP.html#o13">HeaderValidateCopy</a>;
00336 
<a name="l00337"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o14">00337</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o14">NextAvailableTagIndex</a>;
<a name="l00338"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o15">00338</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o15">MaximumTagIndex</a>;
<a name="l00339"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o16">00339</a>     <a class="code" href="../../d3/d9/heap_8h.html#a52">PHEAP_TAG_ENTRY</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o16">TagEntries</a>;
<a name="l00340"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o17">00340</a>     <a class="code" href="../../d3/d9/heap_8h.html#a50">PHEAP_UCR_SEGMENT</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o17">UCRSegments</a>;
<a name="l00341"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o18">00341</a>     <a class="code" href="../../d3/d9/heap_8h.html#a44">PHEAP_UNCOMMMTTED_RANGE</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o18">UnusedUnCommittedRanges</a>;
00342 
00343     <span class="comment">//</span>
00344     <span class="comment">//  The following two fields control the alignment for each new heap entry</span>
00345     <span class="comment">//  allocation.  The round is added to each size and the mask is used to</span>
00346     <span class="comment">//  align it.  The round value includes the heap entry and any tail checking</span>
00347     <span class="comment">//  space</span>
00348     <span class="comment">//</span>
00349 
<a name="l00350"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o19">00350</a>     ULONG <a class="code" href="../../d5/d5/struct__HEAP.html#o19">AlignRound</a>;
<a name="l00351"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o20">00351</a>     ULONG <a class="code" href="../../d5/d5/struct__HEAP.html#o20">AlignMask</a>;
00352 
<a name="l00353"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o21">00353</a>     LIST_ENTRY <a class="code" href="../../d5/d5/struct__HEAP.html#o21">VirtualAllocdBlocks</a>;
00354 
<a name="l00355"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o22">00355</a>     <a class="code" href="../../d3/d9/heap_8h.html#a46">PHEAP_SEGMENT</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o22">Segments</a>[ <a class="code" href="../../d3/d9/heap_8h.html#a7">HEAP_MAXIMUM_SEGMENTS</a> ];
00356 
00357     <span class="keyword">union </span>{
<a name="l00358"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o23">00358</a>         ULONG <a class="code" href="../../d5/d5/struct__HEAP.html#o23">FreeListsInUseUlong</a>[ <a class="code" href="../../d3/d9/heap_8h.html#a6">HEAP_MAXIMUM_FREELISTS</a> / 32 ];
<a name="l00359"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o24">00359</a>         UCHAR <a class="code" href="../../d5/d5/struct__HEAP.html#o24">FreeListsInUseBytes</a>[ <a class="code" href="../../d3/d9/heap_8h.html#a6">HEAP_MAXIMUM_FREELISTS</a> / 8 ];
00360     } u;
00361 
<a name="l00362"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o26">00362</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o26">FreeListsInUseTerminate</a>;
<a name="l00363"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o27">00363</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o27">AllocatorBackTraceIndex</a>;
<a name="l00364"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o28">00364</a>     ULONG <a class="code" href="../../d5/d5/struct__HEAP.html#o28">Reserved1</a>[2];
<a name="l00365"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o29">00365</a>     <a class="code" href="../../d3/d9/heap_8h.html#a54">PHEAP_PSEUDO_TAG_ENTRY</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o29">PseudoTagEntries</a>;
00366 
<a name="l00367"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o30">00367</a>     LIST_ENTRY <a class="code" href="../../d5/d5/struct__HEAP.html#o30">FreeLists</a>[ <a class="code" href="../../d3/d9/heap_8h.html#a6">HEAP_MAXIMUM_FREELISTS</a> ];
00368 
<a name="l00369"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o31">00369</a>     <a class="code" href="../../d3/d9/heap_8h.html#a48">PHEAP_LOCK</a> <a class="code" href="../../d5/d5/struct__HEAP.html#o31">LockVariable</a>;
<a name="l00370"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o32">00370</a>     PRTL_HEAP_COMMIT_ROUTINE <a class="code" href="../../d5/d5/struct__HEAP.html#o32">CommitRoutine</a>;
00371 
00372     <span class="comment">//</span>
00373     <span class="comment">//  The following field is used to manage the heap lookaside list.  The</span>
00374     <span class="comment">//  pointer is used to locate the lookaside list array.  If it is null</span>
00375     <span class="comment">//  then the lookaside list is not active.</span>
00376     <span class="comment">//</span>
00377     <span class="comment">//  The lock count is used to denote if the heap is locked.  A zero value</span>
00378     <span class="comment">//  means the heap is not locked.  Each lock operation increments the</span>
00379     <span class="comment">//  heap count and each unlock decrements the counter</span>
00380     <span class="comment">//</span>
00381 
<a name="l00382"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o33">00382</a>     PVOID <a class="code" href="../../d5/d5/struct__HEAP.html#o33">Lookaside</a>;
<a name="l00383"></a><a class="code" href="../../d5/d5/struct__HEAP.html#o34">00383</a>     ULONG <a class="code" href="../../d5/d5/struct__HEAP.html#o34">LookasideLockCount</a>;
00384 
00385 } <a class="code" href="../../d5/d5/struct__HEAP.html">HEAP</a>, *<a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a>;
00386 
<a name="l00387"></a><a class="code" href="../../d3/d9/heap_8h.html#a19">00387</a> <span class="preprocessor">#define HEAP_SIGNATURE                      (ULONG)0xEEFFEEFF</span>
<a name="l00388"></a><a class="code" href="../../d3/d9/heap_8h.html#a20">00388</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_LOCK_USER_ALLOCATED            (ULONG)0x80000000</span>
<a name="l00389"></a><a class="code" href="../../d3/d9/heap_8h.html#a21">00389</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_VALIDATE_PARAMETERS_ENABLED    (ULONG)0x40000000</span>
<a name="l00390"></a><a class="code" href="../../d3/d9/heap_8h.html#a22">00390</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_VALIDATE_ALL_ENABLED           (ULONG)0x20000000</span>
<a name="l00391"></a><a class="code" href="../../d3/d9/heap_8h.html#a23">00391</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_SKIP_VALIDATION_CHECKS         (ULONG)0x10000000</span>
<a name="l00392"></a><a class="code" href="../../d3/d9/heap_8h.html#a24">00392</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_CAPTURE_STACK_BACKTRACES       (ULONG)0x08000000</span>
00393 <span class="preprocessor"></span>
<a name="l00394"></a><a class="code" href="../../d3/d9/heap_8h.html#a25">00394</a> <span class="preprocessor">#define CHECK_HEAP_TAIL_SIZE HEAP_GRANULARITY</span>
<a name="l00395"></a><a class="code" href="../../d3/d9/heap_8h.html#a26">00395</a> <span class="preprocessor"></span><span class="preprocessor">#define CHECK_HEAP_TAIL_FILL 0xAB</span>
<a name="l00396"></a><a class="code" href="../../d3/d9/heap_8h.html#a27">00396</a> <span class="preprocessor"></span><span class="preprocessor">#define FREE_HEAP_FILL 0xFEEEFEEE</span>
<a name="l00397"></a><a class="code" href="../../d3/d9/heap_8h.html#a28">00397</a> <span class="preprocessor"></span><span class="preprocessor">#define ALLOC_HEAP_FILL 0xBAADF00D</span>
00398 <span class="preprocessor"></span>
<a name="l00399"></a><a class="code" href="../../d3/d9/heap_8h.html#a29">00399</a> <span class="preprocessor">#define HEAP_MAXIMUM_SMALL_TAG              0xFF</span>
<a name="l00400"></a><a class="code" href="../../d3/d9/heap_8h.html#a30">00400</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_SMALL_TAG_MASK                 (HEAP_MAXIMUM_SMALL_TAG &lt;&lt; HEAP_TAG_SHIFT)</span>
<a name="l00401"></a><a class="code" href="../../d3/d9/heap_8h.html#a31">00401</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_NEED_EXTRA_FLAGS ((HEAP_TAG_MASK ^ HEAP_SMALL_TAG_MASK)  | \</span>
00402 <span class="preprocessor">                               HEAP_CAPTURE_STACK_BACKTRACES          | \</span>
00403 <span class="preprocessor">                               HEAP_SETTABLE_USER_VALUE                 \</span>
00404 <span class="preprocessor">                              )</span>
<a name="l00405"></a><a class="code" href="../../d3/d9/heap_8h.html#a32">00405</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAP_NUMBER_OF_PSEUDO_TAG           (HEAP_MAXIMUM_FREELISTS+1)</span>
00406 <span class="preprocessor"></span>
00407 
00408 <span class="preprocessor">#if (HEAP_ENTRY_SETTABLE_FLAG1 ^    \</span>
00409 <span class="preprocessor">     HEAP_ENTRY_SETTABLE_FLAG2 ^    \</span>
00410 <span class="preprocessor">     HEAP_ENTRY_SETTABLE_FLAG3 ^    \</span>
00411 <span class="preprocessor">     HEAP_ENTRY_SETTABLE_FLAGS      \</span>
00412 <span class="preprocessor">    )</span>
00413 <span class="preprocessor"></span><span class="preprocessor">#error Invalid HEAP_ENTRY_SETTABLE_FLAGS</span>
00414 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00415 <span class="preprocessor"></span>
00416 <span class="preprocessor">#if ((HEAP_ENTRY_BUSY ^             \</span>
00417 <span class="preprocessor">      HEAP_ENTRY_EXTRA_PRESENT ^    \</span>
00418 <span class="preprocessor">      HEAP_ENTRY_FILL_PATTERN ^     \</span>
00419 <span class="preprocessor">      HEAP_ENTRY_VIRTUAL_ALLOC ^    \</span>
00420 <span class="preprocessor">      HEAP_ENTRY_LAST_ENTRY ^       \</span>
00421 <span class="preprocessor">      HEAP_ENTRY_SETTABLE_FLAGS     \</span>
00422 <span class="preprocessor">     ) !=                           \</span>
00423 <span class="preprocessor">     (HEAP_ENTRY_BUSY |             \</span>
00424 <span class="preprocessor">      HEAP_ENTRY_EXTRA_PRESENT |    \</span>
00425 <span class="preprocessor">      HEAP_ENTRY_FILL_PATTERN |     \</span>
00426 <span class="preprocessor">      HEAP_ENTRY_VIRTUAL_ALLOC |    \</span>
00427 <span class="preprocessor">      HEAP_ENTRY_LAST_ENTRY |       \</span>
00428 <span class="preprocessor">      HEAP_ENTRY_SETTABLE_FLAGS     \</span>
00429 <span class="preprocessor">     )                              \</span>
00430 <span class="preprocessor">    )</span>
00431 <span class="preprocessor"></span><span class="preprocessor">#error Conflicting HEAP_ENTRY flags</span>
00432 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00433 <span class="preprocessor"></span>
00434 <span class="preprocessor">#if ((HEAP_SETTABLE_USER_FLAGS &gt;&gt; 4) ^ HEAP_ENTRY_SETTABLE_FLAGS)</span>
00435 <span class="preprocessor"></span><span class="preprocessor">#error HEAP_SETTABLE_USER_FLAGS in ntrtl.h conflicts with HEAP_ENTRY_SETTABLE_FLAGS in heap.h</span>
00436 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00437 <span class="preprocessor"></span>
<a name="l00438"></a><a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html">00438</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html">_HEAP_STOP_ON_TAG</a> {
00439     <span class="keyword">union </span>{
<a name="l00440"></a><a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html#o0">00440</a>         ULONG <a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html#o0">HeapAndTagIndex</a>;
00441         <span class="keyword">struct </span>{
<a name="l00442"></a><a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html#o1">00442</a>             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html#o1">TagIndex</a>;
<a name="l00443"></a><a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html#o2">00443</a>             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html#o2">HeapIndex</a>;
00444         };
00445     };
00446 } <a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html">HEAP_STOP_ON_TAG</a>, *<a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html">PHEAP_STOP_ON_TAG</a>;
00447 
<a name="l00448"></a><a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html">00448</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html">_HEAP_STOP_ON_VALUES</a> {
<a name="l00449"></a><a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o0">00449</a>     SIZE_T <a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o0">AllocAddress</a>;
<a name="l00450"></a><a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o1">00450</a>     <a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html">HEAP_STOP_ON_TAG</a> <a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o1">AllocTag</a>;
<a name="l00451"></a><a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o2">00451</a>     SIZE_T <a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o2">ReAllocAddress</a>;
<a name="l00452"></a><a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o3">00452</a>     <a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html">HEAP_STOP_ON_TAG</a> <a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o3">ReAllocTag</a>;
<a name="l00453"></a><a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o4">00453</a>     SIZE_T <a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o4">FreeAddress</a>;
<a name="l00454"></a><a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o5">00454</a>     <a class="code" href="../../d9/d6/struct__HEAP__STOP__ON__TAG.html">HEAP_STOP_ON_TAG</a> <a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html#o5">FreeTag</a>;
00455 } <a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html">HEAP_STOP_ON_VALUES</a>, *<a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html">PHEAP_STOP_ON_VALUES</a>;
00456 
00457 <span class="preprocessor">#ifndef NTOS_KERNEL_RUNTIME</span>
00458 <span class="preprocessor"></span>
<a name="l00459"></a><a class="code" href="../../d3/d9/heap_8h.html#a61">00459</a> <span class="keyword">extern</span> BOOLEAN <a class="code" href="../../d3/d9/heap_8h.html#a61">RtlpDebugHeap</a>;
<a name="l00460"></a><a class="code" href="../../d3/d9/heap_8h.html#a62">00460</a> <span class="keyword">extern</span> BOOLEAN <a class="code" href="../../d3/d9/heap_8h.html#a62">RtlpValidateHeapHdrsEnable</a>; <span class="comment">// Set to TRUE if headers are being corrupted</span>
<a name="l00461"></a><a class="code" href="../../d3/d9/heap_8h.html#a63">00461</a> <span class="keyword">extern</span> BOOLEAN <a class="code" href="../../d3/d9/heap_8h.html#a63">RtlpValidateHeapTagsEnable</a>; <span class="comment">// Set to TRUE if tag counts are off and you want to know why</span>
<a name="l00462"></a><a class="code" href="../../d3/d9/heap_8h.html#a64">00462</a> <span class="keyword">extern</span> <a class="code" href="../../d3/d9/heap_8h.html#a56">PHEAP</a> <a class="code" href="../../d3/d9/heap_8h.html#a64">RtlpGlobalTagHeap</a>;
<a name="l00463"></a><a class="code" href="../../d3/d9/heap_8h.html#a65">00463</a> <span class="keyword">extern</span> <a class="code" href="../../d2/d7/struct__HEAP__STOP__ON__VALUES.html">HEAP_STOP_ON_VALUES</a> <a class="code" href="../../d3/d9/heap_8h.html#a65">RtlpHeapStopOn</a>;
00464 
00465 BOOLEAN
00466 <a class="code" href="../../d5/d9/heapdll_8c.html#a46">RtlpHeapIsLocked</a>(
00467     IN PVOID HeapHandle
00468     );
00469 
00470 <span class="comment">//</span>
00471 <span class="comment">// Page heap external interface.</span>
00472 <span class="comment">//</span>
00473 
00474 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/d9/heappage_8h.html">heappage.h</a>&gt;</span>
00475 
00476 <span class="preprocessor">#endif // NTOS_KERNEL_RUNTIME</span>
00477 <span class="preprocessor"></span>
00478 <span class="preprocessor">#endif //  _RTL_HEAP_</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:15 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
