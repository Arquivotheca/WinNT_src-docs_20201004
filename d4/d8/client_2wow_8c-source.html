<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: wow.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>wow.c</h1><a href="../../d3/d9/client_2wow_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: wow.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* This module contains shared code between USER32 and USER16</span>
00007 <span class="comment">* No New CODE should be added to this file, unless its shared</span>
00008 <span class="comment">* with USER16.</span>
00009 <span class="comment">*</span>
00010 <span class="comment">* History:</span>
00011 <span class="comment">* 29-DEC-93 NanduriR      shared user32/user16 code.</span>
00012 <span class="comment">\***************************************************************************/</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00015 <span class="preprocessor">#pragma hdrstop</span>
00016 <span class="preprocessor"></span>
00017 
00018 <span class="comment">/***************************************************************************\</span>
00019 <span class="comment">* ValidateHwnd</span>
00020 <span class="comment">*</span>
00021 <span class="comment">* Verify that the handle is valid.  If the handle is invalid or access</span>
00022 <span class="comment">* cannot be granted fail.</span>
00023 <span class="comment">*</span>
00024 <span class="comment">* History:</span>
00025 <span class="comment">* 03-18-92 DarrinM      Created from pieces of misc server-side funcs.</span>
00026 <span class="comment">\***************************************************************************/</span>
00027 
<a name="l00028"></a><a class="code" href="../../d4/d1/userk_8h.html#a1137">00028</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a> <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(
00029     HWND hwnd)
00030 {
00031     <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
00032 
00033     <span class="comment">/*</span>
00034 <span class="comment">     * Attempt fast window validation</span>
00035 <span class="comment">     */</span>
00036     <span class="keywordflow">if</span> (hwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; hwnd == pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o9">CallbackWnd</a>.<a class="code" href="../../d2/d7/struct__CALLBACKWND.html#o0">hwnd</a>) {
00037         <span class="keywordflow">return</span> pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o9">CallbackWnd</a>.<a class="code" href="../../d2/d7/struct__CALLBACKWND.html#o1">pwnd</a>;
00038     }
00039 
00040     <span class="comment">/*</span>
00041 <span class="comment">     * Validate the handle is of the proper type.</span>
00042 <span class="comment">     */</span>
00043     <span class="keywordflow">return</span> <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a6">HMValidateHandle</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a237">TYPE_WINDOW</a>);
00044 }
00045 
00046 
<a name="l00047"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a1">00047</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a1">ValidateHwndNoRip</a>(
00048     HWND hwnd)
00049 {
00050     <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
00051 
00052     <span class="comment">/*</span>
00053 <span class="comment">     * Attempt fast window validation</span>
00054 <span class="comment">     */</span>
00055     <span class="keywordflow">if</span> (hwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; hwnd == pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o9">CallbackWnd</a>.<a class="code" href="../../d2/d7/struct__CALLBACKWND.html#o0">hwnd</a>) {
00056         <span class="keywordflow">return</span> pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o9">CallbackWnd</a>.<a class="code" href="../../d2/d7/struct__CALLBACKWND.html#o1">pwnd</a>;
00057     }
00058 
00059     <span class="comment">/*</span>
00060 <span class="comment">     * Validate the handle is of the proper type.</span>
00061 <span class="comment">     */</span>
00062     <span class="keywordflow">return</span> <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a8">HMValidateHandleNoRip</a>(hwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a237">TYPE_WINDOW</a>);
00063 }
00064 
00065 
00066 
<a name="l00067"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a2">00067</a> <span class="keywordtype">int</span> WINAPI <a class="code" href="../../d3/d9/client_2wow_8c.html#a2">GetClassNameA</a>(
00068     HWND hwnd,
00069     LPSTR lpClassName,
00070     <span class="keywordtype">int</span> nMaxCount)
00071 {
00072     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls;
00073     LPSTR lpszClassNameSrc;
00074     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00075     <span class="keywordtype">int</span> cchSrc;
00076 
00077     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00078 
00079     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00080         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00081 
00082     <span class="keywordflow">try</span> {
00083         <span class="keywordflow">if</span> (nMaxCount != 0) {
00084             pcls = (<a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, pcls);
00085             lpszClassNameSrc = <a class="code" href="../../d6/d0/usercli_8h.html#a25">REBASEPTR</a>(pwnd, pcls-&gt;lpszAnsiClassName);
00086             cchSrc = lstrlenA(lpszClassNameSrc);
00087             nMaxCount = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cchSrc, nMaxCount - 1);
00088             RtlCopyMemory(lpClassName, lpszClassNameSrc, nMaxCount);
00089             lpClassName[nMaxCount] = <span class="charliteral">'\0'</span>;
00090         }
00091     } except (W32ExceptionHandler(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, RIP_WARNING)) {
00092         nMaxCount = 0;
00093     }
00094 
00095     <span class="keywordflow">return</span> nMaxCount;
00096 }
00097 
00098 <span class="comment">/***************************************************************************\</span>
00099 <span class="comment">* _GetDesktopWindow (API)</span>
00100 <span class="comment">*</span>
00101 <span class="comment">*</span>
00102 <span class="comment">*</span>
00103 <span class="comment">* History:</span>
00104 <span class="comment">* 11-07-90 darrinm      Implemented.</span>
00105 <span class="comment">\***************************************************************************/</span>
00106 
<a name="l00107"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a3">00107</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a3">_GetDesktopWindow</a>(<span class="keywordtype">void</span>)
00108 {
00109     <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci;
00110 
00111     <a class="code" href="../../d1/d0/inc_2user_8h.html#a848">ConnectIfNecessary</a>();
00112 
00113     pci = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
00114     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)((KERNEL_ULONG_PTR)pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o5">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a> -
00115             pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o6">ulClientDelta</a>);
00116 }
00117 
00118 
00119 
<a name="l00120"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a4">00120</a> HWND <a class="code" href="../../d3/d9/client_2wow_8c.html#a4">GetDesktopWindow</a>(<span class="keywordtype">void</span>)
00121 {
00122     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>        pwnd;
00123     <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci;
00124 
00125     pwnd = <a class="code" href="../../d3/d9/client_2wow_8c.html#a3">_GetDesktopWindow</a>();
00126 
00127     pci = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
00128 
00129     <span class="comment">/*</span>
00130 <span class="comment">     * validate the parent window's handle if a restricted process</span>
00131 <span class="comment">     */</span>
00132     <span class="keywordflow">if</span> (pci &amp;&amp; (pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o4">dwTIFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a821">TIF_RESTRICTED</a>)) {
00133         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00134             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00135         }
00136     }
00137     <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd);
00138 }
00139 
00140 
<a name="l00141"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a5">00141</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a5">_GetDlgItem</a>(
00142     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00143     <span class="keywordtype">int</span> <span class="keywordtype">id</span>)
00144 {
00145     <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00146         pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndChild);
00147         <span class="keywordflow">while</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00148             <span class="keywordflow">if</span> (PtrToLong(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>) == <span class="keywordtype">id</span>)
00149                 <span class="keywordflow">break</span>;
00150             pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndNext);
00151         }
00152     }
00153 
00154     <span class="keywordflow">return</span> pwnd;
00155 }
00156 
00157 
<a name="l00158"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a6">00158</a> HWND <a class="code" href="../../d3/d9/client_2wow_8c.html#a6">GetDlgItem</a>(
00159     HWND hwnd,
00160     <span class="keywordtype">int</span> <span class="keywordtype">id</span>)
00161 {
00162     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00163     HWND hwndRet;
00164 
00165     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00166     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00167         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00168 
00169     pwnd = <a class="code" href="../../d3/d9/client_2wow_8c.html#a5">_GetDlgItem</a>(pwnd, <span class="keywordtype">id</span>);
00170 
00171     hwndRet = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd);
00172 
00173     <span class="keywordflow">if</span> (hwndRet == (HWND)0)
00174         RIPERR0(ERROR_CONTROL_ID_NOT_FOUND, RIP_VERBOSE, <span class="stringliteral">""</span>);
00175 
00176     <span class="keywordflow">return</span> hwndRet;
00177 }
00178 
00179 
<a name="l00180"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a7">00180</a> HMENU <a class="code" href="../../d3/d9/client_2wow_8c.html#a7">GetMenu</a>(
00181     HWND hwnd)
00182 {
00183     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00184     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu;
00185 
00186     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00187 
00188     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00189         <span class="keywordflow">return</span> 0;
00190 
00191     <span class="comment">/*</span>
00192 <span class="comment">     * Some ill-behaved apps use GetMenu to get the child id, so</span>
00193 <span class="comment">     * only map to the handle for non-child windows.</span>
00194 <span class="comment">     */</span>
00195     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
00196         pmenu = <a class="code" href="../../d6/d0/usercli_8h.html#a26">REBASE</a>(pwnd, spmenu);
00197         <span class="keywordflow">return</span> (HMENU)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pmenu);
00198     } <span class="keywordflow">else</span> {
00199         <span class="keywordflow">return</span> (HMENU)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>;
00200     }
00201 }
00202 
00203 
00204 <span class="comment">/***************************************************************************\</span>
00205 <span class="comment">* GetMenuItemCount</span>
00206 <span class="comment">*</span>
00207 <span class="comment">* Returns a count of the number of items in the menu. Returns -1 if</span>
00208 <span class="comment">* invalid menu.</span>
00209 <span class="comment">*</span>
00210 <span class="comment">* History:</span>
00211 <span class="comment">\***************************************************************************/</span>
00212 
<a name="l00213"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a8">00213</a> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9/client_2wow_8c.html#a8">GetMenuItemCount</a>(
00214     HMENU hMenu)
00215 {
00216     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00217 
00218     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00219 
00220     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00221         <span class="keywordflow">return</span> -1;
00222 
00223     <span class="keywordflow">return</span> pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>;
00224 }
00225 
00226 <span class="comment">/***************************************************************************\</span>
00227 <span class="comment">* GetMenuItemID</span>
00228 <span class="comment">*</span>
00229 <span class="comment">* Return the ID of a menu item at the specified position.</span>
00230 <span class="comment">*</span>
00231 <span class="comment">* History:</span>
00232 <span class="comment">\***************************************************************************/</span>
00233 
<a name="l00234"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a9">00234</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a9">GetMenuItemID</a>(
00235     HMENU hMenu,
00236     <span class="keywordtype">int</span> nPos)
00237 {
00238     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00239     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
00240 
00241     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00242 
00243     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00244         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)-1;
00245 
00246     <span class="comment">/*</span>
00247 <span class="comment">     * If the position is valid and the item is not a popup, get the ID</span>
00248 <span class="comment">     * Don't allow negative indexes, because that'll cause an access violation.</span>
00249 <span class="comment">     */</span>
00250     <span class="keywordflow">if</span> (nPos &lt; (<span class="keywordtype">int</span>)pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a> &amp;&amp; nPos &gt;= 0) {
00251         pItem = &amp;((<a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pMenu, rgItems))[nPos];
00252         <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00253             <span class="keywordflow">return</span> pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o2">wID</a>;
00254     }
00255 
00256     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)-1;
00257 }
00258 
00259 
<a name="l00260"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a10">00260</a> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a10">GetMenuState</a>(
00261     HMENU hMenu,
00262     UINT uId,
00263     UINT uFlags)
00264 {
00265     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00266 
00267     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00268 
00269     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || (uFlags &amp; ~MF_VALID) != 0) {
00270         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)-1;
00271     }
00272 
00273     <span class="keywordflow">return</span> <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a11">_GetMenuState</a>(pMenu, uId, uFlags);
00274 }
00275 
00276 
<a name="l00277"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a11">00277</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(
00278     HWND hwnd)
00279 {
00280     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00281 
00282     <span class="comment">/*</span>
00283 <span class="comment">     * Validate the handle is of type window</span>
00284 <span class="comment">     */</span>
00285     pwnd = <a class="code" href="../../d3/d9/client_2wow_8c.html#a1">ValidateHwndNoRip</a>(hwnd);
00286 
00287     <span class="comment">/*</span>
00288 <span class="comment">     * And validate this handle is valid for this desktop by trying to read it</span>
00289 <span class="comment">     */</span>
00290     <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00291         <span class="keywordflow">try</span> {
00292             <span class="keywordflow">if</span> (pwnd-&gt;fnid &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a227">FNID_DELETED_BIT</a>) {
00293                 pwnd = 0;
00294             }
00295         } except (W32ExceptionHandler(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, RIP_WARNING)) {
00296             RIPMSG1(RIP_WARNING, <span class="stringliteral">"IsWindow: Window %#p not of this desktop"</span>,
00297                     pwnd);
00298             pwnd = 0;
00299         }
00300     }
00301     <span class="keywordflow">return</span> !!pwnd;
00302 }
00303 
00304 
<a name="l00305"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a12">00305</a> HWND <a class="code" href="../../d3/d9/client_2wow_8c.html#a12">GetWindow</a>(
00306     HWND hwnd,
00307     UINT wCmd)
00308 {
00309     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00310 
00311     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00312     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00313         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00314 
00315     pwnd = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a13">_GetWindow</a>(pwnd, wCmd);
00316     <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd);
00317 }
00318 
<a name="l00319"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a13">00319</a> HWND <a class="code" href="../../d3/d9/client_2wow_8c.html#a13">GetParent</a>(
00320     HWND hwnd)
00321 {
00322     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>        pwnd;
00323     <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci;
00324 
00325     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00326     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00327         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00328 
00329     <span class="keywordflow">try</span> {
00330         pwnd = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a14">_GetParent</a>(pwnd);
00331         hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd);
00332     } except (W32ExceptionHandler(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, RIP_WARNING)) {
00333         hwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00334     }
00335 
00336     pci = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
00337 
00338     <span class="comment">/*</span>
00339 <span class="comment">     * validate the parent window's handle if a restricted process</span>
00340 <span class="comment">     */</span>
00341     <span class="keywordflow">if</span> (pci &amp;&amp; (pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o4">dwTIFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a821">TIF_RESTRICTED</a>)) {
00342         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00343             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00344         }
00345     }
00346 
00347     <span class="keywordflow">return</span> hwnd;
00348 }
00349 
<a name="l00350"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a14">00350</a> HMENU <a class="code" href="../../d3/d9/client_2wow_8c.html#a14">GetSubMenu</a>(
00351     HMENU hMenu,
00352     <span class="keywordtype">int</span> nPos)
00353 {
00354     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00355 
00356     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00357 
00358     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00359         <span class="keywordflow">return</span> 0;
00360 
00361     pMenu = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a15">_GetSubMenu</a>(pMenu, nPos);
00362     <span class="keywordflow">return</span> (HMENU)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pMenu);
00363 }
00364 
00365 
<a name="l00366"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a15">00366</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a15">GetSysColor</a>(
00367     <span class="keywordtype">int</span> nIndex)
00368 {
00369 
00370     <span class="comment">/*</span>
00371 <span class="comment">     * Currently we don't do client side checks because they do not really</span>
00372 <span class="comment">     * make sense;  someone can read the data even with the checks.  We</span>
00373 <span class="comment">     * leave in the attribute values in case we want to move these values</span>
00374 <span class="comment">     * back to the server side someday</span>
00375 <span class="comment">     */</span>
00376 <span class="preprocessor">#ifdef ENABLE_CLIENTSIDE_ACCESSCHECK</span>
00377 <span class="preprocessor"></span>    <span class="comment">/*</span>
00378 <span class="comment">     * Make sure we have access to the system colors.</span>
00379 <span class="comment">     */</span>
00380     <span class="keywordflow">if</span> (!(<a class="code" href="../../d1/d8/clglobal_8c.html#a10">gamWinSta</a> &amp; WINSTA_READATTRIBUTES)) {
00381         <span class="keywordflow">return</span> 0;
00382     }
00383 <span class="preprocessor">#endif</span>
00384 <span class="preprocessor"></span>
00385     <span class="comment">/*</span>
00386 <span class="comment">     * Return 0 if the index is out of range.</span>
00387 <span class="comment">     */</span>
00388     <span class="keywordflow">if</span> (nIndex &lt; 0 || nIndex &gt;= COLOR_MAX) {
00389         RIPERR1(ERROR_INVALID_PARAMETER,
00390                 RIP_WARNING,
00391                 <span class="stringliteral">"Invalid parameter \"nIndex\" (%ld) to GetSysColor"</span>,
00392                 nIndex);
00393 
00394         <span class="keywordflow">return</span> 0;
00395     }
00396 
00397     <span class="keywordflow">return</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[nIndex]);
00398 }
00399 
00400 
<a name="l00401"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a16">00401</a> <span class="keywordtype">int</span> <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(
00402     <span class="keywordtype">int</span> index)
00403 {
00404     <a class="code" href="../../d1/d0/inc_2user_8h.html#a848">ConnectIfNecessary</a>();
00405 
00406     <span class="comment">/*</span>
00407 <span class="comment">     * check first for values that are out of the 'aiSysMet' array</span>
00408 <span class="comment">     */</span>
00409     <span class="keywordflow">switch</span> (index) {
00410 
00411     <span class="keywordflow">case</span> SM_REMOTESESSION:
00412         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a30">ISREMOTESESSION</a>();
00413     }
00414 
00415     <span class="keywordflow">if</span> ((index &lt; 0) || (index &gt;= SM_CMETRICS))
00416         <span class="keywordflow">return</span> 0;
00417 
00418     <span class="keywordflow">switch</span> (index) {
00419     <span class="keywordflow">case</span> SM_DBCSENABLED:
00420 <span class="preprocessor">#ifdef FE_SB</span>
00421 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a10">TEST_BOOL_FLAG</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o1">wSRVIFlags</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a376">SRVIF_DBCS</a>);
00422 <span class="preprocessor">#else</span>
00423 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00424 <span class="preprocessor">#endif</span>
00425 <span class="preprocessor"></span>    <span class="keywordflow">case</span> SM_IMMENABLED:
00426 <span class="preprocessor">#ifdef FE_IME</span>
00427 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a10">TEST_BOOL_FLAG</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o1">wSRVIFlags</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a377">SRVIF_IME</a>);
00428 <span class="preprocessor">#else</span>
00429 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00430 <span class="preprocessor">#endif</span>
00431 <span class="preprocessor"></span>
00432     <span class="keywordflow">case</span> SM_MIDEASTENABLED:
00433         <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a10">TEST_BOOL_FLAG</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o1">wSRVIFlags</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a378">SRVIF_MIDEAST</a>);
00434     }
00435 
00436     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;dwExpWinVer &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a101">VER40</a>) {
00437         <span class="comment">/*</span>
00438 <span class="comment">         * SCROLL BAR</span>
00439 <span class="comment">         * before 4.0, the scroll bars and the border overlapped by a pixel.  Many apps</span>
00440 <span class="comment">         * rely on this overlap when they compute dimensions.  Now, in 4.0, this pixel</span>
00441 <span class="comment">         * overlap is no longer there.  So for old apps, we lie and pretend the overlap</span>
00442 <span class="comment">         * is there by making the scroll bar widths one bigger.</span>
00443 <span class="comment">         *</span>
00444 <span class="comment">         * DLGFRAME</span>
00445 <span class="comment">         * In Win3.1, SM_CXDLGFRAME &amp; SM_CYDLGFRAME were border space MINUS 1</span>
00446 <span class="comment">         * In Win4.0, they are border space</span>
00447 <span class="comment">         *</span>
00448 <span class="comment">         * CAPTION</span>
00449 <span class="comment">         * In Win3.1, SM_CYCAPTION was the caption height PLUS 1</span>
00450 <span class="comment">         * In Win4.0, SM_CYCAPTION is the caption height</span>
00451 <span class="comment">         *</span>
00452 <span class="comment">         * MENU</span>
00453 <span class="comment">         * In Win3.1, SM_CYMENU was the menu height MINUS 1</span>
00454 <span class="comment">         * In Win4.0, SM_CYMENU is the menu height</span>
00455 <span class="comment">         */</span>
00456 
00457         <span class="keywordflow">switch</span> (index) {
00458 
00459         <span class="keywordflow">case</span> SM_CXDLGFRAME:
00460         <span class="keywordflow">case</span> SM_CYDLGFRAME:
00461         <span class="keywordflow">case</span> SM_CYMENU:
00462         <span class="keywordflow">case</span> SM_CYFULLSCREEN:
00463             <span class="keywordflow">return</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;aiSysMet)[index] - 1;
00464 
00465         <span class="keywordflow">case</span> SM_CYCAPTION:
00466         <span class="keywordflow">case</span> SM_CXVSCROLL:
00467         <span class="keywordflow">case</span> SM_CYHSCROLL:
00468             <span class="keywordflow">return</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;aiSysMet)[index] + 1;
00469         }
00470     }
00471 
00472     <span class="keywordflow">return</span> <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;aiSysMet[index];
00473 }
00474 
00475 <span class="comment">/***************************************************************************\</span>
00476 <span class="comment">* GetTopWindow (API)</span>
00477 <span class="comment">*</span>
00478 <span class="comment">* This poorly named API should really be called 'GetFirstChild', which is</span>
00479 <span class="comment">* what it does.</span>
00480 <span class="comment">*</span>
00481 <span class="comment">* History:</span>
00482 <span class="comment">* 11-12-90 darrinm      Ported.</span>
00483 <span class="comment">* 02-19-91 JimA         Added enum access check</span>
00484 <span class="comment">* 05-04-02 DarrinM      Removed enum access check and moved to USERRTL.DLL</span>
00485 <span class="comment">\***************************************************************************/</span>
00486 
<a name="l00487"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a17">00487</a> HWND <a class="code" href="../../d3/d9/client_2wow_8c.html#a17">GetTopWindow</a>(
00488     HWND hwnd)
00489 {
00490     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00491 
00492     <span class="comment">/*</span>
00493 <span class="comment">     * Allow a NULL hwnd to go through here.</span>
00494 <span class="comment">     */</span>
00495     <span class="keywordflow">if</span> (hwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00496         pwnd = <a class="code" href="../../d3/d9/client_2wow_8c.html#a3">_GetDesktopWindow</a>();
00497     } <span class="keywordflow">else</span> {
00498         pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00499     }
00500     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00501         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00502 
00503     pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndChild);
00504     <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd);
00505 }
00506 
00507 
<a name="l00508"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a18">00508</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a18">IsChild</a>(
00509     HWND hwndParent,
00510     HWND hwnd)
00511 {
00512     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, pwndParent;
00513 
00514     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00515     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00516         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00517 
00518     pwndParent = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndParent);
00519     <span class="keywordflow">if</span> (pwndParent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00520         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00521 
00522     <span class="keywordflow">return</span> <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a16">_IsChild</a>(pwndParent, pwnd);
00523 }
00524 
<a name="l00525"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a19">00525</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a19">IsIconic</a>(
00526     HWND hwnd)
00527 {
00528     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00529 
00530     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00531 
00532     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00533         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00534 
00535     <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a748">_IsIconic</a>(pwnd);
00536 }
00537 
<a name="l00538"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a20">00538</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a20">IsWindowEnabled</a>(
00539     HWND hwnd)
00540 {
00541     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00542 
00543     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00544 
00545     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00546         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00547 
00548     <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a747">_IsWindowEnabled</a>(pwnd);
00549 }
00550 
<a name="l00551"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a21">00551</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a21">IsWindowVisible</a>(
00552     HWND hwnd)
00553 {
00554     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00555     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRet;
00556 
00557     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00558 
00559     <span class="comment">/*</span>
00560 <span class="comment">     * We have have to try - except this call because there is no</span>
00561 <span class="comment">     * synchronization on the window structure on the client side.</span>
00562 <span class="comment">     * If the window is deleted after it is validated then we can</span>
00563 <span class="comment">     * fault so we catch that on return that the window is not</span>
00564 <span class="comment">     * visible.  As soon as this API returns there is no guarentee</span>
00565 <span class="comment">     * the return is still valid in a muli-tasking environment.</span>
00566 <span class="comment">     */</span>
00567     <span class="keywordflow">try</span> {
00568         <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00569             bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00570         } <span class="keywordflow">else</span> {
00571             bRet = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a17">_IsWindowVisible</a>(pwnd);
00572         }
00573     } except (W32ExceptionHandler(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, RIP_WARNING)) {
00574         bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00575     }
00576 
00577     <span class="keywordflow">return</span> bRet;
00578 }
00579 
<a name="l00580"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a22">00580</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a22">IsZoomed</a>(
00581     HWND hwnd)
00582 {
00583     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00584 
00585     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00586 
00587     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00588         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00589 
00590     <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a749">_IsZoomed</a>(pwnd);
00591 }
00592 
<a name="l00593"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a23">00593</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a23">ClientToScreen</a>(
00594     HWND hwnd,
00595     LPPOINT ppoint)
00596 {
00597     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00598 
00599     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00600 
00601     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00602         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00603 
00604     <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a18">_ClientToScreen</a>(pwnd, ppoint);
00605     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00606 }
00607 
<a name="l00608"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a24">00608</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a24">GetClientRect</a>(
00609     HWND   hwnd,
00610     LPRECT prect)
00611 {
00612     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00613 
00614     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00615 
00616     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00617         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00618 
00619     <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(pwnd, prect);
00620     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00621 }
00622 
00623 
<a name="l00624"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a25">00624</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a25">GetCursorPos</a>(
00625     LPPOINT lpPoint)
00626 {
00627 <span class="preprocessor">#ifdef REDIRECTION</span>
00628 <span class="preprocessor"></span>    <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci;
00629 <span class="preprocessor">#endif // REDIRECTION</span>
00630 <span class="preprocessor"></span>
00631     <span class="comment">/*</span>
00632 <span class="comment">     * Blow it off if the caller doesn't have the proper access rights</span>
00633 <span class="comment">     */</span>
00634 <span class="preprocessor">#ifdef ENABLE_CLIENTSIDE_ACCESSCHECK</span>
00635 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!(<a class="code" href="../../d1/d8/clglobal_8c.html#a10">gamWinSta</a> &amp; WINSTA_READATTRIBUTES)) {
00636         lpPoint-&gt;x = 0;
00637         lpPoint-&gt;y = 0;
00638         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00639     }
00640 <span class="preprocessor">#endif</span>
00641 <span class="preprocessor"></span>
00642     *lpPoint = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor;
00643     
00644 <span class="preprocessor">#ifdef REDIRECTION</span>
00645 <span class="preprocessor"></span>    pci = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
00646 
00647     <span class="keywordflow">if</span> (pci != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o5">pDeskInfo</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; <a class="code" href="../../d6/d0/usercli_8h.html#a208">IsHooked</a>(pci, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a518">WHF_CBT</a>)) {
00648         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a174">NtUserCallOneParam</a>((ULONG_PTR)lpPoint, SFI_XXXGETCURSORPOS);
00649     }
00650 <span class="preprocessor">#endif // REDIRECTION</span>
00651 <span class="preprocessor"></span>    
00652     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00653 }
00654 
<a name="l00655"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a26">00655</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>(
00656     HWND hwnd,
00657     LPRECT prect)
00658 {
00659     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00660 
00661     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00662 
00663     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00664         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00665 
00666     <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a20">_GetWindowRect</a>(pwnd, prect);
00667     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00668 }
00669 
<a name="l00670"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a27">00670</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a27">ScreenToClient</a>(
00671     HWND hwnd,
00672     LPPOINT ppoint)
00673 {
00674     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00675 
00676     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00677 
00678     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00679         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00680 
00681     <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a21">_ScreenToClient</a>(pwnd, ppoint);
00682     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00683 }
00684 
<a name="l00685"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a28">00685</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d9/client_2wow_8c.html#a28">EnableMenuItem</a>(
00686     HMENU hMenu,
00687     UINT uIDEnableItem,
00688     UINT uEnable)
00689 {
00690     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00691     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
00692 
00693     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00694     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00695         <span class="keywordflow">return</span> (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)-1;
00696     }
00697 
00698     <span class="comment">/*</span>
00699 <span class="comment">     * Get a pointer the the menu item</span>
00700 <span class="comment">     */</span>
00701     <span class="keywordflow">if</span> ((pItem = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a10">MNLookUpItem</a>(pMenu, uIDEnableItem, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>) (uEnable &amp; MF_BYPOSITION), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00702         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1;
00703 
00704     <span class="comment">/*</span>
00705 <span class="comment">     * If the item is already in the state we're</span>
00706 <span class="comment">     * trying to set, just return.</span>
00707 <span class="comment">     */</span>
00708     <span class="keywordflow">if</span> ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MFS_GRAYED) ==
00709             (uEnable &amp; MFS_GRAYED)) {
00710         <span class="keywordflow">return</span> pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MFS_GRAYED;
00711     }
00712 
00713     <span class="keywordflow">return</span> <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a161">NtUserEnableMenuItem</a>(hMenu, uIDEnableItem, uEnable);
00714 }
00715 
00716 <span class="comment">/***************************************************************************\</span>
00717 <span class="comment">* CallNextHookEx</span>
00718 <span class="comment">*</span>
00719 <span class="comment">* This routine is called to call the next hook in the hook chain.</span>
00720 <span class="comment">*</span>
00721 <span class="comment">* 05-09-91 ScottLu Created.</span>
00722 <span class="comment">\***************************************************************************/</span>
00723 
<a name="l00724"></a><a class="code" href="../../d3/d9/client_2wow_8c.html#a29">00724</a> LRESULT WINAPI <a class="code" href="../../d3/d9/client_2wow_8c.html#a29">CallNextHookEx</a>(
00725     HHOOK hhk,
00726     <span class="keywordtype">int</span> nCode,
00727     WPARAM wParam,
00728     LPARAM lParam)
00729 {
00730     LRESULT nRet;
00731     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  bAnsi;
00732     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwHookCurrent;
00733     <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci;
00734     ULONG_PTR dwHookData;
00735     ULONG_PTR <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
00736 
00737     DBG_UNREFERENCED_PARAMETER(hhk);
00738 
00739     <a class="code" href="../../d1/d0/inc_2user_8h.html#a848">ConnectIfNecessary</a>();
00740 
00741     pci = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>();
00742     dwHookCurrent = pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o10">dwHookCurrent</a>;
00743     bAnsi = LOWORD(dwHookCurrent);
00744 
00745     <span class="comment">/*</span>
00746 <span class="comment">     * If this is the last hook in the hook chain then return 0; we're done</span>
00747 <span class="comment">     */</span>
00748     UserAssert(pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o7">phkCurrent</a>);
00749     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a22">PhkNextValid</a>((<a class="code" href="../../d5/d6/structtagHOOK.html">PHOOK</a>)((KERNEL_ULONG_PTR)pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o7">phkCurrent</a> - pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o6">ulClientDelta</a>)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00750         <span class="keywordflow">return</span> 0;
00751     }
00752 
00753     <span class="keywordflow">switch</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)HIWORD(dwHookCurrent)) {
00754     <span class="keywordflow">case</span> WH_CALLWNDPROC:
00755     <span class="keywordflow">case</span> WH_CALLWNDPROCRET:
00756         <span class="comment">/*</span>
00757 <span class="comment">         * This is the hardest of the hooks because we need to thunk through</span>
00758 <span class="comment">         * the message hooks in order to deal with synchronously sent messages</span>
00759 <span class="comment">         * that point to structures - to get the structures passed across</span>
00760 <span class="comment">         * alright, etc.</span>
00761 <span class="comment">         *</span>
00762 <span class="comment">         * This will call a special kernel-side routine that'll rebundle the</span>
00763 <span class="comment">         * arguments and call the hook in the right format.</span>
00764 <span class="comment">         *</span>
00765 <span class="comment">         * Currently, the message thunk callbacks to the client-side don't take</span>
00766 <span class="comment">         * enough parameters to pass wParam (which == fInterThread send msg).</span>
00767 <span class="comment">         * To do this, save the state of wParam in the CLIENTINFO structure.</span>
00768 <span class="comment">         */</span>
00769         <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = KERNEL_ULONG_PTR_TO_ULONG_PTR(pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a>) &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a116">CI_INTERTHREAD_HOOK</a>;
00770         dwHookData = KERNEL_ULONG_PTR_TO_ULONG_PTR(pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o14">dwHookData</a>);
00771         <span class="keywordflow">if</span> (wParam) {
00772             pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a> |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a116">CI_INTERTHREAD_HOOK</a>;
00773         } <span class="keywordflow">else</span> {
00774             pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a> &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a116">CI_INTERTHREAD_HOOK</a>;
00775         }
00776 
00777         <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)HIWORD(dwHookCurrent) == WH_CALLWNDPROC) {
00778             nRet = <a class="code" href="../../d6/d0/usercli_8h.html#a11">CsSendMessage</a>(
00779                     ((LPCWPSTRUCT)lParam)-&gt;hwnd,
00780                     ((LPCWPSTRUCT)lParam)-&gt;message,
00781                     ((LPCWPSTRUCT)lParam)-&gt;wParam,
00782                     ((LPCWPSTRUCT)lParam)-&gt;lParam,
00783                     0, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a210">FNID_HKINLPCWPEXSTRUCT</a>, bAnsi);
00784         } <span class="keywordflow">else</span> {
00785             pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o14">dwHookData</a> = ((LPCWPRETSTRUCT)lParam)-&gt;lResult;
00786             nRet = <a class="code" href="../../d6/d0/usercli_8h.html#a11">CsSendMessage</a>(
00787                     ((LPCWPRETSTRUCT)lParam)-&gt;hwnd,
00788                     ((LPCWPRETSTRUCT)lParam)-&gt;message,
00789                     ((LPCWPRETSTRUCT)lParam)-&gt;wParam,
00790                     ((LPCWPRETSTRUCT)lParam)-&gt;lParam,
00791                     0, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a211">FNID_HKINLPCWPRETEXSTRUCT</a>, bAnsi);
00792         }
00793 
00794         <span class="comment">/*</span>
00795 <span class="comment">         * Restore previous hook state.</span>
00796 <span class="comment">         */</span>
00797         pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a> ^= ((pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a> ^ <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>) &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a116">CI_INTERTHREAD_HOOK</a>);
00798         pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o14">dwHookData</a> = dwHookData;
00799         <span class="keywordflow">break</span>;
00800 
00801     <span class="keywordflow">default</span>:
00802         nRet = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a384">NtUserCallNextHookEx</a>(
00803                 nCode,
00804                 wParam,
00805                 lParam,
00806                 bAnsi);
00807     }
00808 
00809     <span class="keywordflow">return</span> nRet;
00810 }
00811 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:27 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
