<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: createw.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>createw.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d5/d7/createw_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a0">WantImeWindow</a> (IN <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent, IN <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a1">xxxCreateWindowEx</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwExStyle, <a class="el" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> cczpstrClass, <a class="el" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> cczpstrName, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> style, int x, int y, int cx, int <a class="el" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent, <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, HANDLE hInstance, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpCreateParams, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwExpWinVerAndFlags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a2">SetTiledRect</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, LPRECT lprc, <a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> pMonitor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a3">xxxAdjustSize</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, LPINT lpcx, LPINT lpcy)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a4">LinkWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndInsert, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a5">xxxDestroyWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a6">xxxDW_DestroyOwnedWindows</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a7">xxxDW_SendDestroyMessages</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a8">xxxFW_DestroyAllChildren</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a9">UnlockNotifyWindow</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a10">xxxFreeWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d5/d1/struct__TL.html">PTL</a> ptlpwndFree)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a11">UnlinkWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndUnlink, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a12">DestroyCacheDCEntries</a> (<a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/createw_8c.html#a13">PatchThreadWindows</a> (<a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a12" doxytag="createw.c::DestroyCacheDCEntries" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DestroyCacheDCEntries           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pti</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l02923">2923</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03592">tagDCE::DCX_flags</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01638">DestroyCacheDC()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03586">tagDCE::hdc</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02197">tagDISPLAYINFO::pdceFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03585">tagDCE::pdceNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03593">tagDCE::ptiOwner</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l00565">CleanupGDI()</a>, and <a class="el" href="../../d5/d7/handtabl_8c-source.html#l02284">DestroyThreadsObjects()</a>.
<p>
<pre class="fragment"><div>02925 {
02926     <a class="code" href="../../d3/d2/structtagDCE.html">PDCE</a> *ppdce;
02927     <a class="code" href="../../d3/d2/structtagDCE.html">PDCE</a> pdce;
02928     <span class="comment">/*</span>
02929 <span class="comment">     * Before any window destruction occurs, we need to destroy any dcs</span>
02930 <span class="comment">     * in use in the dc cache.  When a dc is checked out, it is marked owned,</span>
02931 <span class="comment">     * which makes gdi's process cleanup code delete it when a process</span>
02932 <span class="comment">     * goes away.  We need to similarly destroy the cache entry of any dcs</span>
02933 <span class="comment">     * in use by the exiting process.</span>
02934 <span class="comment">     */</span>
02935     <span class="keywordflow">for</span> (ppdce = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o9">pdceFirst</a>; *ppdce != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; ) {
02936 
02937         <span class="comment">/*</span>
02938 <span class="comment">         * If the dc owned by this thread, remove it from the cache.  Because</span>
02939 <span class="comment">         * DestroyCacheEntry destroys gdi objects, it is important that</span>
02940 <span class="comment">         * USER be called first in process destruction ordering.</span>
02941 <span class="comment">         *</span>
02942 <span class="comment">         * Only destroy this dc if it is a cache dc, because if it is either</span>
02943 <span class="comment">         * an owndc or a classdc, it will be destroyed for us when we destroy</span>
02944 <span class="comment">         * the window (for owndcs) or destroy the class (for classdcs).</span>
02945 <span class="comment">         */</span>
02946         pdce = *ppdce;
02947         <span class="keywordflow">if</span> (pti == pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o8">ptiOwner</a>) {
02948 
02949             <span class="keywordflow">if</span> (pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; DCX_CACHE)
02950                 <a class="code" href="../../d4/d1/userk_8h.html#a1700">DestroyCacheDC</a>(ppdce, pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o1">hdc</a>);
02951         }
02952 
02953         <span class="comment">/*</span>
02954 <span class="comment">         * Step to the next DC.  If the DC was deleted, there</span>
02955 <span class="comment">         * is no need to calculate address of the next entry.</span>
02956 <span class="comment">         */</span>
02957         <span class="keywordflow">if</span> (pdce == *ppdce)
02958             ppdce = &amp;pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o0">pdceNext</a>;
02959     }
02960 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="createw.c::LinkWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void LinkWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndInsert</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndParent</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l01478">1478</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01738">tagCLS::atomClassName</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01297">tagSERVERINFO::atomSysClass</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01600">CFIME</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05504">FSwpTopmost()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00362">ICLS_IME</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01843">tagWND::pcls</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03829">PWND_BOTTOM</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03828">PWND_TOP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02791">PWNDMESSAGE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01744">tagWND::spwndNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01609">TestCF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l01184">TrackLayeredZorder()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02360">WEFTOPMOST</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02310">WFBOTTOMMOST</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02304">WFDESTROYED</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02293">WFTOGGLETOPMOST</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/ntimm_8c-source.html#l01995">ImeSetTopmost()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01797">xxxCreateDesktop()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">xxxCreateWindowEx()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l00311">xxxSetParent()</a>, and <a class="el" href="../../d3/d7/swp_8c-source.html#l01955">zzzChangeStates()</a>.
<p>
<pre class="fragment"><div>01482 {
01483     <span class="keywordflow">if</span> (pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a> == pwnd) {
01484         RIPMSG0(RIP_WARNING, <span class="stringliteral">"Attempting to link a window to itself"</span>);
01485         <span class="keywordflow">return</span>;
01486     }
01487     UserAssert(pwnd != pwndInsert);
01488     UserAssert((pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> == NULL) || (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> == pwndParent));
01489 
01490     <span class="keywordflow">if</span> (pwndInsert == <a class="code" href="../../d4/d1/userk_8h.html#a452">PWND_TOP</a>) {
01491 
01492         <span class="comment">/*</span>
01493 <span class="comment">         * We are at the top of the list.</span>
01494 <span class="comment">         */</span>
01495 LinkTop:
01496 <span class="preprocessor">#if DBG</span>
01497 <span class="preprocessor"></span>        <span class="comment">/*</span>
01498 <span class="comment">         * If the first child is topmost, so must be pwnd, but only for top-level windows.</span>
01499 <span class="comment">         *</span>
01500 <span class="comment">         * IME or IME related windows are the exceptions, because ImeSetTopmost() and its fellow</span>
01501 <span class="comment">         * do most of the relinking by its own: when LinkWindow() is called, it's possible TOPMOST flags</span>
01502 <span class="comment">         * are left in intermediate state. By the time the all window relinking finishes, TOPMOST</span>
01503 <span class="comment">         * flags have been taken care of and they are just fine.</span>
01504 <span class="comment">         */</span>
01505         <span class="keywordflow">if</span> (pwndParent == <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwndParent) &amp;&amp;
01506                 pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a> &amp;&amp;
01507                 <a class="code" href="../../d4/d1/userk_8h.html#a1613">FSwpTopmost</a>(pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>) &amp;&amp;
01508                 pwndParent != <a class="code" href="../../d4/d1/userk_8h.html#a323">PWNDMESSAGE</a>(pwndParent) &amp;&amp;
01509                 <span class="comment">// Check if the target is IME related window</span>
01510                 !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a485">TestCF</a>(pwnd, CFIME) &amp;&amp; pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> != <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a89">ICLS_IME</a>]) {
01511 
01512             <span class="comment">/*</span>
01513 <span class="comment">             * There are few cases that cause the z-ordering code to leave the WFTOGGLETOPMOST bit set.</span>
01514 <span class="comment">             * One is when SWP_NOOWNERZORDER is used when changing the topmost state of a window;</span>
01515 <span class="comment">             *  in this case, ZOrderByOwner2 doesn't add ownees to the psmwp list, still SetTopMost</span>
01516 <span class="comment">             *  sets the bit on all the ownees.</span>
01517 <span class="comment">             * Another case is when SetWindowPos gets re-entered on the same window.</span>
01518 <span class="comment">             * It's too late to attempt to fix this ancient behavior (2/24/99) so let's turn off</span>
01519 <span class="comment">             *  the assert for now.</span>
01520 <span class="comment">             */</span>
01521             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1613">FSwpTopmost</a>(pwnd)) {
01522                 RIPMSG1(RIP_WARNING, <span class="stringliteral">"LinkWindow pwnd:%p is not FSwpTopmost"</span>, pwnd);
01523             }
01524         }
01525 <span class="preprocessor">#endif</span>
01526 <span class="preprocessor"></span>
01527         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>, pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>);
01528         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>), pwnd);
01529     } <span class="keywordflow">else</span> {
01530         <span class="keywordflow">if</span> (pwndInsert == <a class="code" href="../../d4/d1/userk_8h.html#a453">PWND_BOTTOM</a>) {
01531 
01532             <span class="comment">/*</span>
01533 <span class="comment">             * Find bottom-most window.</span>
01534 <span class="comment">             */</span>
01535             <span class="keywordflow">if</span> (((pwndInsert = pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
01536                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndInsert, WFBOTTOMMOST))
01537                 <span class="keywordflow">goto</span> LinkTop;
01538 
01539             <span class="comment">/*</span>
01540 <span class="comment">             * Since we know (ahem) that there's only one bottommost window,</span>
01541 <span class="comment">             * we can't possibly insert after it.  Either we're inserting</span>
01542 <span class="comment">             * the bottomost window, in which case it's not in the linked</span>
01543 <span class="comment">             * list currently, or we're inserting some other window.</span>
01544 <span class="comment">             */</span>
01545 
01546             <span class="keywordflow">while</span> (pwndInsert-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01547                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndInsert-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>, WFBOTTOMMOST)) {
01548 <span class="preprocessor">#if DBG</span>
01549 <span class="preprocessor"></span>                    UserAssert(pwnd != pwndInsert-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>);
01550                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFBOTTOMMOST))
01551                         UserAssert(FALSE);
01552 <span class="preprocessor">#endif</span>
01553 <span class="preprocessor"></span>                    <span class="keywordflow">break</span>;
01554                 }
01555 
01556                 pwndInsert = pwndInsert-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
01557             }
01558         }
01559 
01560         UserAssert(pwnd != pwndInsert);
01561         UserAssert(pwnd != pwndInsert-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>);
01562         UserAssert(!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndInsert, WFDESTROYED));
01563         UserAssert(!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTOPMOST) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndInsert, WEFTOPMOST) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFTOGGLETOPMOST) || (pwndParent != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwndInsert)));
01564         UserAssert(pwnd-&gt;spwndParent == pwndInsert-&gt;spwndParent);
01565 
01566         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pwnd-&gt;spwndNext, pwndInsert-&gt;spwndNext);
01567         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pwndInsert-&gt;spwndNext, pwnd);
01568     }
01569 
01570     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYERED))
01571         <a class="code" href="../../d4/d1/userk_8h.html#a1985">TrackLayeredZorder</a>(pwnd);
01572 
01573 <span class="preprocessor">#if DBG</span>
01574 <span class="preprocessor"></span>    VerifyWindowLink (pwnd, pwndParent, TRUE);
01575 <span class="preprocessor">#endif</span>
01576 <span class="preprocessor"></span>
01577 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="createw.c::PatchThreadWindows" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PatchThreadWindows           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pti</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l02972">2972</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01278">tagSHAREDINFO::aheList</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01515">_HANDLEENTRY::bFlags</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01514">_HANDLEENTRY::bType</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00790">FNID_WNDPROCEND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00782">FNID_WNDPROCSTART</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00849">giheLast</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00052">gSharedInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01429">HANDLEF_DESTROY</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01841">tagWND::lpfnWndProc</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01512">_HANDLEENTRY::phead</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01447">_HANDLEENTRY::pOwner</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1017">PTHROBJHEAD</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03327">tagTHREADINFO::rpdesk</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02653">tagDESKTOP::spwndMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00841">STOCID</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00906">TYPE_WINDOW</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02286">WFANSIPROC</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02285">WFSERVERSIDEPROC</a>, and <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/queue_8c-source.html#l02552">xxxDestroyThreadInfo()</a>.
<p>
<pre class="fragment"><div>02974 {
02975     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a>  pheT;
02976     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a>  pheMax;
02977     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
02978 
02979     <span class="comment">/*</span>
02980 <span class="comment">     * First do any preparation work: windows need to be "patched" so that</span>
02981 <span class="comment">     * their window procs point to server only windowprocs, for example.</span>
02982 <span class="comment">     */</span>
02983     pheMax = &amp;<a class="code" href="../../d1/d8/clglobal_8c.html#a5">gSharedInfo</a>.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o1">aheList</a>[<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a308">giheLast</a>];
02984     <span class="keywordflow">for</span> (pheT = <a class="code" href="../../d1/d8/clglobal_8c.html#a5">gSharedInfo</a>.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o1">aheList</a>; pheT &lt;= pheMax; pheT++) {
02985 
02986         <span class="comment">/*</span>
02987 <span class="comment">         * Make sure this object is a window, it hasn't been marked for</span>
02988 <span class="comment">         * destruction, and that it is owned by this thread.</span>
02989 <span class="comment">         */</span>
02990         <span class="keywordflow">if</span> (pheT-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a237">TYPE_WINDOW</a>)
02991             <span class="keywordflow">continue</span>;
02992 
02993         <span class="keywordflow">if</span> (pheT-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o3">bFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a421">HANDLEF_DESTROY</a>)
02994             <span class="keywordflow">continue</span>;
02995 
02996         <span class="keywordflow">if</span> ((<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>)pheT-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a> != pti)
02997             <span class="keywordflow">continue</span>;
02998 
02999         <span class="comment">/*</span>
03000 <span class="comment">         * don't patch the shared menu window</span>
03001 <span class="comment">         */</span>
03002         <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a> &amp;&amp; (<a class="code" href="../../d4/d5/struct__HEAD.html">PHEAD</a>)pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o6">spwndMenu</a> == pheT-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>) {
03003 
03004             ((<a class="code" href="../../d1/d1/struct__THROBJHEAD.html">PTHROBJHEAD</a>)pheT-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>)-&gt;pti = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.pti;
03005             pheT-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a> = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.pti;
03006 
03007             <span class="keywordflow">continue</span>;
03008         }
03009 
03010         <span class="comment">/*</span>
03011 <span class="comment">         * Don't patch the window based on the class it was created from -</span>
03012 <span class="comment">         * because apps can sometimes sub-class a class - make a random class,</span>
03013 <span class="comment">         * then call ButtonWndProc with windows of that class by using</span>
03014 <span class="comment">         * the CallWindowProc() api.  So patch the wndproc based on what</span>
03015 <span class="comment">         * wndproc this window has been calling.</span>
03016 <span class="comment">         */</span>
03017         pwnd = (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)pheT-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>;
03018 
03019         <span class="keywordflow">if</span> ((pwnd-&gt;fnid &gt;= (WORD)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a192">FNID_WNDPROCSTART</a>) &amp;&amp;
03020             (pwnd-&gt;fnid &lt;= (WORD)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a198">FNID_WNDPROCEND</a>)) {
03021 
03022             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a230">STOCID</a>(pwnd-&gt;fnid);
03023 
03024             <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
03025                 pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a> = <a class="code" href="../../d8/d3/dwp_8c.html#a17">xxxDefWindowProc</a>;
03026 
03027         } <span class="keywordflow">else</span> {
03028 
03029             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a> = <a class="code" href="../../d8/d3/dwp_8c.html#a17">xxxDefWindowProc</a>;
03030         }
03031 
03032         <span class="comment">/*</span>
03033 <span class="comment">         * This is a server side window now...</span>
03034 <span class="comment">         */</span>
03035         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFSERVERSIDEPROC);
03036         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFANSIPROC);
03037     }
03038 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="createw.c::SetTiledRect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SetTiledRect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMonitor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l01333">1333</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02161">tagMONITOR::cWndStack</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00417">GetRealClientRect()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03044">GRC_MINWNDS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00624">MultDiv</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">xxxCreateWindowEx()</a>.
<p>
<pre class="fragment"><div>01337 {
01338     POINT   pt;
01339     RECT    rcT;
01340 
01341     UserAssert(pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o7">cWndStack</a> &gt;= 0);
01342 
01343     <span class="comment">/*</span>
01344 <span class="comment">     * Get available desktop area, minus minimized spacing area.</span>
01345 <span class="comment">     */</span>
01346     <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a3">GetRealClientRect</a>(<a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd), &amp;rcT, GRC_MINWNDS, pMonitor);
01347 
01348     <span class="comment">/*</span>
01349 <span class="comment">     * Normalized rectangle is 3/4 width, 3/4 height of desktop area.  We</span>
01350 <span class="comment">     * offset it based on the value of giwndStack for cascading.</span>
01351 <span class="comment">     */</span>
01352 
01353     <span class="comment">/*</span>
01354 <span class="comment">     * We want the left edge of the new window to align with the</span>
01355 <span class="comment">     * right edge of the old window's system menu.  And we want the</span>
01356 <span class="comment">     * top edge of the new window to align with the bottom edge of the</span>
01357 <span class="comment">     * selected caption area (caption height - cyBorder) of the old</span>
01358 <span class="comment">     * window.</span>
01359 <span class="comment">     */</span>
01360     pt.x = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o7">cWndStack</a> * (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZEFRAME) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE));
01361     pt.y = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o7">cWndStack</a> * (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZEFRAME) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE));
01362 
01363     <span class="comment">/*</span>
01364 <span class="comment">     * If below upper top left 1/4 of free area, reset.</span>
01365 <span class="comment">     */</span>
01366     <span class="keywordflow">if</span> (    (pt.x &gt; ((rcT.right-rcT.left) / 4)) ||
01367             (pt.y &gt; ((rcT.bottom-rcT.top) / 4)) ) {
01368 
01369         pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o7">cWndStack</a> = 0;
01370         pt.x = 0;
01371         pt.y = 0;
01372     }
01373 
01374     <span class="comment">/*</span>
01375 <span class="comment">     * Get starting position</span>
01376 <span class="comment">     */</span>
01377     pt.x += rcT.left;
01378     pt.y += rcT.top;
01379 
01380     lprc-&gt;left      = pt.x;
01381     lprc-&gt;top       = pt.y;
01382     lprc-&gt;right     = pt.x + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(rcT.right-rcT.left, 3, 4);
01383     lprc-&gt;bottom    = pt.y + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(rcT.bottom-rcT.top, 3, 4);
01384 
01385     <span class="comment">/*</span>
01386 <span class="comment">     * Increment the count of stacked windows.</span>
01387 <span class="comment">     */</span>
01388     pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o7">cWndStack</a>++;
01389 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="createw.c::UnlinkWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UnlinkWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndUnlink</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndParent</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l02867">2867</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01744">tagWND::spwndNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/ntimm_8c-source.html#l01995">ImeSetTopmost()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">xxxDestroyWindow()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02126">xxxFW_DestroyAllChildren()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l00311">xxxSetParent()</a>, and <a class="el" href="../../d3/d7/swp_8c-source.html#l01955">zzzChangeStates()</a>.
<p>
<pre class="fragment"><div>02870 {
02871     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
02872 
02873     pwnd = pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>;
02874 
02875     <span class="keywordflow">if</span> (pwnd == pwndUnlink) {
02876         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>), pwndUnlink-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>);
02877         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwndUnlink-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>);
02878 
02879 <span class="preprocessor">#if DBG</span>
02880 <span class="preprocessor"></span>        VerifyWindowLink (pwnd, pwndParent, FALSE);
02881 <span class="preprocessor">#endif</span>
02882 <span class="preprocessor"></span>
02883         <span class="keywordflow">return</span>;
02884     }
02885 
02886     <span class="keywordflow">while</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02887         UserAssert(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> == pwndParent);
02888         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a> == pwndUnlink) {
02889             <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>), pwndUnlink-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>);
02890             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwndUnlink-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>);
02891 
02892 <span class="preprocessor">#if DBG</span>
02893 <span class="preprocessor"></span>            VerifyWindowLink (pwnd, pwndParent, FALSE);
02894 <span class="preprocessor">#endif</span>
02895 <span class="preprocessor"></span>            <span class="keywordflow">return</span>;
02896         }
02897 
02898         pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
02899     }
02900 
02901     <span class="comment">/*</span>
02902 <span class="comment">     * We should never get here unless the window isn't in the list!</span>
02903 <span class="comment">     */</span>
02904     RIPMSG1(RIP_WARNING,
02905           <span class="stringliteral">"Unlinking previously unlinked window %#p\n"</span>,
02906           pwndUnlink);
02907 
02908 <span class="preprocessor">#if DBG</span>
02909 <span class="preprocessor"></span>    VerifyWindowLink (pwnd, pwndParent, FALSE);
02910 <span class="preprocessor">#endif</span>
02911 <span class="preprocessor"></span>
02912     <span class="keywordflow">return</span>;
02913 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="createw.c::UnlockNotifyWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UnlockNotifyWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pmenu</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l02192">2192</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02797">tagMENU::rgItems</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02606">tagITEM::spSubMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02646">tagMENU::spwndNotify</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>.
<p>
<pre class="fragment"><div>02194 {
02195     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
02196     <span class="keywordtype">int</span>   i;
02197 
02198     <span class="comment">/*</span>
02199 <span class="comment">     * Go down the item list and unlock submenus.</span>
02200 <span class="comment">     */</span>
02201     pItem = pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>;
02202     <span class="keywordflow">for</span> (i = pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>; i--; ++pItem) {
02203 
02204         <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02205             <a class="code" href="../../d4/d8/createw_8c.html#a9">UnlockNotifyWindow</a>(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a>);
02206     }
02207 
02208     <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>);
02209 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="createw.c::WantImeWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WantImeWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndParent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l01287">1287</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02718">tagWINDOWSTATION::dwWSF_Flags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02648">tagDESKTOP::rpwinstaParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02851">TIF_DISABLEIME</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02285">WFSERVERSIDEPROC</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l02704">WSF_NOIO</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">xxxCreateWindowEx()</a>.
<p>
<pre class="fragment"><div>01288 {
01289     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesk;
01290 
01291     UserAssert(pwnd);
01292 
01293     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;TIF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a817">TIF_DISABLEIME</a>) {
01294         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01295     }
01296     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSERVERSIDEPROC)) {
01297         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01298     }
01299 
01300     pdesk = pwnd-&gt;head.rpdesk;
01301     <span class="keywordflow">if</span> (pdesk == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o3">rpwinstaParent</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01302         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01303     }
01304 
01305     <span class="comment">// Check whether pwnd's desktop has I/O.</span>
01306     <span class="keywordflow">if</span> (pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o3">rpwinstaParent</a>-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a316">WSF_NOIO</a>) {
01307         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01308     }
01309 
01310     <span class="comment">// Check if the owner window is message-only window.</span>
01311     <span class="keywordflow">if</span> (pwndParent) {
01312         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT = pwndParent;
01313 
01314         <span class="keywordflow">while</span> (pwndT &amp;&amp; pdesk == pwndT-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk) {
01315             <span class="keywordflow">if</span> (pwndT == pdesk-&gt;spwndMessage) {
01316                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01317             }
01318             pwndT = pwndT-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>;
01319         }
01320     }
01321 
01322     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01323 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="createw.c::xxxAdjustSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxAdjustSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPINT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpcx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPINT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpcy</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l01401">1401</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02563">TestwndTiled</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02404">WFSIZEBOX</a>, and <a class="el" href="../../d5/d8/minmax_8c-source.html#l00032">xxxInitSendValidateMinMaxInfo()</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">xxxCreateWindowEx()</a>, and <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>01405 {
01406     POINT       ptmin,
01407                 ptmax;
01408     MINMAXINFO  mmi;
01409 
01410     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01411 
01412     <span class="comment">/*</span>
01413 <span class="comment">     * If this window is sizeable or if this window is tiled, check size</span>
01414 <span class="comment">     */</span>
01415     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a737">TestwndTiled</a>(pwnd) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSIZEBOX)) {
01416 
01417         <span class="comment">/*</span>
01418 <span class="comment">         * Get size info from pwnd</span>
01419 <span class="comment">         */</span>
01420         <a class="code" href="../../d4/d1/userk_8h.html#a1161">xxxInitSendValidateMinMaxInfo</a>(pwnd, &amp;mmi);
01421 
01422         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED)) {
01423             ptmin = mmi.ptReserved;
01424             ptmax = mmi.ptMaxSize;
01425         } <span class="keywordflow">else</span> {
01426             ptmin = mmi.ptMinTrackSize;
01427             ptmax = mmi.ptMaxTrackSize;
01428         }
01429 
01430         <span class="comment">//</span>
01431         <span class="comment">// Make sure we're less than the max, and greater than the min</span>
01432         <span class="comment">//</span>
01433         *lpcx = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(ptmin.x, <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(*lpcx, ptmax.x));
01434         *lpcy = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(ptmin.y, <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(*lpcy, ptmax.y));
01435     }
01436 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="createw.c::xxxCreateWindowEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> xxxCreateWindowEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwExStyle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cczpstrClass</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cczpstrName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>style</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>y</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndParent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hInstance</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCreateParams</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwExpWinVerAndFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">33</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00107">_GetDesktopWindow()</a>, <a class="el" href="../../d0/d1/mmrtl_8c-source.html#l00426">_MonitorFromWindow()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03389">tagTHREADINFO::amdesk</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01738">tagCLS::atomClassName</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01297">tagSERVERINFO::atomSysClass</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00421">_LARGE_STRING::Buffer</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00435">_LARGE_UNICODE_STRING::Buffer</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l03620">CalcForegroundInsertAfter()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01856">tagWND::cbwndExtra</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01593">CFCLASSDC</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01600">CFIME</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01596">CFNOCLOSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01592">CFOWNDC</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00508">_CLIENTINFO::CI_flags</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00570">CI_INPUTCONTEXT_REINIT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00243">CopyRect</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01463">CreateCacheDC()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a885">CREATESTRUCTEX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01686">CSF_ANSIPROC</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01744">tagCLS::CSF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01685">CSF_SERVERSIDEPROC</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03483">tagPROCESSINFO::cThreads</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02743">CW2_USEDEFAULT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03390">tagTHREADINFO::cWindows</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02161">tagMONITOR::cWndStack</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00191">tagSIZERECT::cx</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00480">cy</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00192">tagSIZERECT::cy</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02579">DF_DESKWNDDESTROYED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02580">DF_DESTROYED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02578">DF_DYING</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00290">DIALOGCLASS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02650">tagDESKTOP::dwDTFlags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02465">tagUSERSTARTUPINFO::dwFlags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03492">tagPROCESSINFO::dwHotkey</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d6/winhtky_8c-source.html#l00096">DWP_SetHotKey()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02461">tagUSERSTARTUPINFO::dwX</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02463">tagUSERSTARTUPINFO::dwXSize</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02462">tagUSERSTARTUPINFO::dwY</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02464">tagUSERSTARTUPINFO::dwYSize</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00772">gaOleMainThreadWndClass</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l01014">GetAppCompatFlags()</a>, <a class="el" href="../../d3/d6/class_8c-source.html#l01036">GetClassPtr()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02604">GetPrimaryMonitor()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00817">GetTopLevelWindow()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05501">GETTOPMOSTINSERTAFTER</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03345">tagTHREADINFO::hdesk</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01770">tagWND::hImc</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02508">tagKL::hkl</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l00828">HMAllocObject()</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l01069">HMFreeObject()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03493">tagPROCESSINFO::hMonitor</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01514">HW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00339">ICLS_BUTTON</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00344">ICLS_COMBOBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00354">ICLS_COMBOLISTBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00349">ICLS_DIALOG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00340">ICLS_EDIT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00362">ICLS_IME</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00342">ICLS_LISTBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00353">ICLS_MDICLIENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00341">ICLS_STATIC</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00481">Is310Compat</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00480">Is400Compat</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00479">Is500Compat</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00591">IS_IME_ENABLED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00410">IS_PTR</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01266">IsHooked</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a968">LARGE_STRING</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01478">LinkWindow()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00422">LockWndMenu()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01841">tagWND::lpfnWndProc</a>, <a class="el" href="../../d3/d4/ntuser_2rtl_2getset_8c-source.html#l00049">MapClientNeuterToClientPfn()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02558">MaskWF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04322">MINMAX_KEEPHIDDEN</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00727">NeedsWindowEdge()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00025">NULL_HIMC</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03329">tagTHREADINFO::pClientInfo</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01843">tagWND::pcls</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01661">tagCLS::pdce</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a969">PLARGE_STRING</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03319">tagTHREADINFO::ppi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01512">PtoH</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06584">PUDF_ANIMATE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03829">PWND_BOTTOM</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03828">PWND_TOP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02791">PWNDMESSAGE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01839">tagWND::rcClient</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02157">tagMONITOR::rcMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00448">RECTFromSIZERECT()</a>, <a class="el" href="../../d3/d6/class_8c-source.html#l01645">ReferenceClass()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02364">RETURN_IF_ACCESS_DENIED</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03327">tagTHREADINFO::rpdesk</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00608">RtlInitLargeAnsiString()</a>, <a class="el" href="../../d1/d0/base_8c-source.html#l00204">RtlInitUnicodeStringOrId()</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l05176">SetMinimize()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01333">SetTiledRect()</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l05237">SetVisible()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a959">SIZERECT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05534">SMIN_CLEAR</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03380">tagTHREADINFO::spDefaultImc</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03323">tagTHREADINFO::spklActive</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01764">tagWND::spmenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03379">tagTHREADINFO::spwndDefaultIme</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01759">tagWND::spwndLastActive</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01747">tagWND::spwndOwner</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01855">tagWND::strName</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02585">SV_UNSET</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06608">TEST_PUDF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01609">TestCF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01613">TestCF2</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02565">TestwndPopup</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02563">TestwndTiled</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00365">ThreadLockAlwaysWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00364">ThreadLockWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02827">TIF_16BIT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03331">tagTHREADINFO::TIF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02826">TIF_INCLEANUP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00906">TYPE_WINDOW</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d2/d9/w32_2ntuser_2kernel_2atom_8c-source.html#l00062">UserFindAtom()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03505">tagPROCESSINFO::usi</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00210">ValidateHmonitor()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l01265">ValidateOwnerDepth()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l01197">ValidateParentDepth()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01287">WantImeWindow()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02379">WEFAPPWINDOW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02359">WEFNOPARENTNOTIFY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02364">WEFTOOLWINDOW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02360">WEFTOPMOST</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02365">WEFWINDOWEDGE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02337">WFALWAYSSENDNCPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02302">WFANSICREATOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02286">WFANSIPROC</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02410">WFBORDER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02412">WFCAPTION</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02421">WFCHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02416">WFCLIPCHILDREN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02417">WFCLIPSIBLINGS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02304">WFDESTROYED</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02475">WFISINITIALIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02415">WFMAXIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02308">WFOLDUI</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02265">WFSENDSIZEMOVE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02285">WFSERVERSIDEPROC</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02284">WFTITLESET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02423">WFTYPEMASK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02318">WFWIN31COMPAT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02319">WFWIN40COMPAT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02320">WFWIN50COMPAT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02037">WHF_CBT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00845">WNDPROC_PWND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00728">WS_EX_ANSICREATOR</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00189">tagSIZERECT::x</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01401">xxxAdjustSize()</a>, <a class="el" href="../../d2/d1/hooks_8c-source.html#l01246">xxxCallHook()</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l05305">xxxCheckFullScreen()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1009">xxxClientLoadMenu()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1281">xxxClientWOWGetProcModule()</a>, <a class="el" href="../../d7/d6/classchg_8c-source.html#l00172">xxxCreateClassSmIcon()</a>, <a class="el" href="../../d6/d7/ntimm_8c-source.html#l00531">xxxCreateDefaultImeWindow()</a>, <a class="el" href="../../d4/d1/mnchange_8c-source.html#l00782">xxxDeleteMenu()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">xxxDestroyWindow()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00368">xxxGetSystemMenu()</a>, <a class="el" href="../../d5/d8/minmax_8c-source.html#l01329">xxxMinMaximize()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l02861">xxxSendSizeMessage()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00467">xxxSetLayeredWindow()</a>, <a class="el" href="../../d1/d8/showwin_8c-source.html#l00085">xxxShowWindow()</a>, <a class="el" href="../../d6/d6/kernel_2winable_8c-source.html#l00274">xxxWindowEvent()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00190">tagSIZERECT::y</a>, and <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l06367">zzzAttachThreadInput()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08087">NtUserCreateWindowEx()</a>, <a class="el" href="../../d6/d7/ntimm_8c-source.html#l00531">xxxCreateDefaultImeWindow()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01797">xxxCreateDesktop()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>, <a class="el" href="../../d2/d3/ddemlsvr_8c-source.html#l00019">xxxCsDdeInitialize()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l01934">xxxMNOpenHierarchy()</a>, <a class="el" href="../../d2/d2/tmswitch_8c-source.html#l01675">xxxNextWindow()</a>, <a class="el" href="../../d2/d2/tmswitch_8c-source.html#l02121">xxxOldNextWindow()</a>, and <a class="el" href="../../d3/d2/mnpopup_8c-source.html#l00052">xxxTrackPopupMenuEx()</a>.
<p>
<pre class="fragment"><div>00047 {
00048     <span class="comment">/*</span>
00049 <span class="comment">     * The buffers for Class and Name may be client memory, and access</span>
00050 <span class="comment">     * to those buffers must be protected.</span>
00051 <span class="comment">     */</span>
00052     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>           mask = 0;
00053     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>           fChild;
00054     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>           fDefPos = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00055     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>           fStartup = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00056     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a>           pcls;
00057     <a class="code" href="../../d7/d0/structtagCLS.html">PPCLS</a>          ppcls;
00058     RECT           rc;
00059     <span class="keywordtype">int</span>            dx, dy;
00060     <a class="code" href="../../d6/d6/structtagSIZERECT.html">SIZERECT</a>       src;
00061     <span class="keywordtype">int</span>            sw = SW_SHOW;
00062     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>           pwnd;
00063     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>           pwndZOrder, pwndHardError;
00064     <a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html">CREATESTRUCTEX</a> csex;
00065     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>       pdesk;
00066     ATOM           atomT;
00067     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>    ptiCurrent;
00068     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>             tlpwnd;
00069     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>             tlpwndParent;
00070     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>             tlpwndParentT;
00071     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>           fLockParent = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00072     WORD           wWFAnsiCreator = 0;
00073     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          dw;
00074     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          dwMinMax;
00075     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>       pMonitor;
00076     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>           fTiled;
00077 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00078 <span class="preprocessor"></span>    <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLayout;
00079 <span class="preprocessor">#endif</span>
00080 <span class="preprocessor"></span>
00081     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndParent);
00082     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00083 
00084     <span class="comment">/*</span>
00085 <span class="comment">     * For Edit Controls (including those in comboboxes), we must know whether</span>
00086 <span class="comment">     * the App used an ANSI or a Unicode CreateWindow call.  This is passed in</span>
00087 <span class="comment">     * with the private WS_EX_ANSICREATOR dwExStyle bit, but we MUST NOT leave</span>
00088 <span class="comment">     * out this bit in the window's dwExStyle! Transfer to the internal window</span>
00089 <span class="comment">     * flag WFANSICREATOR immediately.</span>
00090 <span class="comment">     */</span>
00091     <span class="keywordflow">if</span> (dwExStyle &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a188">WS_EX_ANSICREATOR</a>) {
00092         wWFAnsiCreator = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a581">WFANSICREATOR</a>;
00093         dwExStyle &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a188">WS_EX_ANSICREATOR</a>;
00094     }
00095 
00096     ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00097     <span class="comment">/*</span>
00098 <span class="comment">     * If this thread has already been in xxxDestroyThreadInfo, then this window</span>
00099 <span class="comment">     *  is probably going to end up with a bogus pti.</span>
00100 <span class="comment">     */</span>
00101     UserAssert(!(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; TIF_INCLEANUP));
00102     pdesk = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>;
00103 
00104     <span class="comment">/*</span>
00105 <span class="comment">     * If a parent window is specified, make sure it's on the</span>
00106 <span class="comment">     * same desktop.</span>
00107 <span class="comment">     */</span>
00108     <span class="keywordflow">if</span> (pwndParent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk != pdesk) {
00109         RIPERR0(ERROR_INVALID_PARAMETER, RIP_VERBOSE, <span class="stringliteral">""</span>);
00110         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00111     }
00112 
00113     <span class="comment">/*</span>
00114 <span class="comment">     * Set a flag to indicate whther a it is a child window</span>
00115 <span class="comment">     */</span>
00116     fChild = ((HIWORD(style) &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a734">MaskWF</a>(WFTYPEMASK)) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a734">MaskWF</a>(WFCHILD));
00117 
00118 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00119 <span class="preprocessor"></span>    <span class="comment">/*</span>
00120 <span class="comment"></span>
00121 <span class="comment"></span>
00122 <span class="comment">    The WS_EX_LAYOUT_RTL flag is set if,</span>
00123 <span class="comment"></span>
00124 <span class="comment">    1- WS_EX_LAYOUT_RTL set in dwExStyle parameter of the CreateWindow call.</span>
00125 <span class="comment">    2- If the window is created from DialogBox class, then it can't inherit from its parent</span>
00126 <span class="comment">       and it has to specify WS_EX_LAYOUTRTL explicitly to enable mirroring on it.</span>
00127 <span class="comment">    3- If the window is an owned window then the window is left to right layout and the algorithm terminates.</span>
00128 <span class="comment">        (An owned window is one created with an HWND passed in the hWndParent paremeter to CreateWindow(Ex),</span>
00129 <span class="comment">        but without the WS_CHILD flag present in it's styles.</span>
00130 <span class="comment">    4- If the window is a child window, and it's parent is right to left layout,</span>
00131 <span class="comment">        and it's parent does not have the WS_EX_NOINHERIT_LAYOUT flag set in it's extended styles,</span>
00132 <span class="comment">        then the window is right to left layout and the algorithm terminates.</span>
00133 <span class="comment">    5- If the hWndParent parameter to Createwindow(Ex) was NULL, and the process calling CreateWindow(Ex) has called</span>
00134 <span class="comment">        SetProcessDefaultLayout(LAYOUT_RTL), then the window is right to left layout and the algorithm terminates.</span>
00135 <span class="comment">    6- In all other cases, the layout is left to right.</span>
00136 <span class="comment">    */</span>
00137 
00138     <span class="keywordflow">if</span> (!(dwExStyle &amp; WS_EX_LAYOUTRTL)) {
00139         <span class="keywordflow">if</span> (pwndParent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00140             <span class="keywordflow">if</span> (fChild &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndParent, WEFLAYOUTRTL) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndParent, WEFNOINHERITLAYOUT)) {
00141                 dwExStyle |= WS_EX_LAYOUTRTL;
00142             }
00143         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(cczpstrClass) &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(cczpstrClass) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(DIALOGCLASS)))) {
00144             <span class="keywordflow">if</span> ((_GetProcessDefaultLayout(&amp;dwLayout)) &amp;&amp; (dwLayout &amp; LAYOUT_RTL)) {
00145                 dwExStyle |= WS_EX_LAYOUTRTL;
00146             }
00147         }
00148     }
00149 <span class="preprocessor">#endif</span>
00150 <span class="preprocessor"></span>    <span class="comment">/*</span>
00151 <span class="comment">     * Ensure that we can create the window.  If there is no desktop</span>
00152 <span class="comment">     * yet, assume that this will be the root desktop window and allow</span>
00153 <span class="comment">     * the creation.</span>
00154 <span class="comment">     */</span>
00155     <span class="keywordflow">if</span> (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o18">hdesk</a>) {
00156         <a class="code" href="../../d4/d1/userk_8h.html#a263">RETURN_IF_ACCESS_DENIED</a>(
00157                 ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o48">amdesk</a>, DESKTOP_CREATEWINDOW, NULL);
00158     }
00159 
00160     <span class="keywordflow">if</span> (fChild) {
00161 
00162         <span class="comment">/*</span>
00163 <span class="comment">         * Don't allow child windows without a parent handle.</span>
00164 <span class="comment">         */</span>
00165         <span class="keywordflow">if</span> (pwndParent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00166             RIPERR0(ERROR_TLW_WITH_WSCHILD, RIP_VERBOSE, <span class="stringliteral">""</span>);
00167             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00168         }
00169 
00170         <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a17">ValidateParentDepth</a>(NULL, pwndParent)) {
00171             RIPERR0(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"Exceeded nested children limit"</span>);
00172             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00173         }
00174     }
00175 
00176     <span class="comment">/*</span>
00177 <span class="comment">     * Make sure we can get the window class.</span>
00178 <span class="comment">     */</span>
00179     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(cczpstrClass)) {
00180         <span class="comment">/*</span>
00181 <span class="comment">         * UserFindAtom protects access of the string.</span>
00182 <span class="comment">         */</span>
00183         atomT = <a class="code" href="../../d4/d1/userk_8h.html#a1298">UserFindAtom</a>(cczpstrClass-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>);
00184     } <span class="keywordflow">else</span>
00185         atomT = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(cczpstrClass);
00186 
00187     <span class="keywordflow">if</span> (atomT == 0) {
00188 CantFindClassMessageAndFail:
00189 <span class="preprocessor">#if DBG</span>
00190 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(cczpstrClass)) {
00191             <span class="keywordflow">try</span> {
00192                 RIPMSG1(RIP_WARNING,
00193                         <span class="stringliteral">"Couldn't find class string %ws"</span>,
00194                         cczpstrClass-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>);
00195 
00196             } except (W32ExceptionHandler(FALSE, RIP_WARNING)) {
00197             }
00198         } <span class="keywordflow">else</span> {
00199             RIPMSG1(RIP_WARNING,
00200                     <span class="stringliteral">"Couldn't find class atom %lx"</span>,
00201                     cczpstrClass);
00202         }
00203 <span class="preprocessor">#endif</span>
00204 <span class="preprocessor"></span>
00205         RIPERR0(ERROR_CANNOT_FIND_WND_CLASS, RIP_VERBOSE, <span class="stringliteral">""</span>);
00206         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00207     }
00208 
00209     <span class="comment">/*</span>
00210 <span class="comment">     * First scan the private classes.  If we don't find the class there</span>
00211 <span class="comment">     * scan the public classes.  If we don't find it there, fail.</span>
00212 <span class="comment">     */</span>
00213     ppcls = <a class="code" href="../../d4/d1/userk_8h.html#a1152">GetClassPtr</a>(atomT, ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>, hInstance);
00214     <span class="keywordflow">if</span> (ppcls == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00215         <span class="keywordflow">goto</span> CantFindClassMessageAndFail;
00216     }
00217 
00218     pcls = *ppcls;
00219 
00220     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a9">NeedsWindowEdge</a>(style, dwExStyle, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a105">Is400Compat</a>(dwExpWinVerAndFlags))) {
00221         dwExStyle |= WS_EX_WINDOWEDGE;
00222     } <span class="keywordflow">else</span> {
00223         dwExStyle &amp;= ~WS_EX_WINDOWEDGE;
00224     }
00225 
00226     <span class="comment">/*</span>
00227 <span class="comment">     * Allocate memory for regular windows.</span>
00228 <span class="comment">     */</span>
00229     pwnd = <a class="code" href="../../d4/d1/userk_8h.html#a969">HMAllocObject</a>(
00230             ptiCurrent, pdesk, TYPE_WINDOW, <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>) + pcls-&gt;cbwndExtra);
00231 
00232     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00233         RIPERR0(ERROR_OUTOFMEMORY,
00234                 RIP_WARNING,
00235                 <span class="stringliteral">"Out of pool in xxxCreateWindowEx"</span>);
00236 
00237         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00238     }
00239 
00240     <span class="comment">/*</span>
00241 <span class="comment">     * Stuff in the pq, class pointer, and window style.</span>
00242 <span class="comment">     */</span>
00243     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a> = pcls;
00244     pwnd-&gt;style = style &amp; ~WS_VISIBLE;
00245 <span class="preprocessor">#ifdef REDIRECTION</span>
00246 <span class="preprocessor"></span>    pwnd-&gt;ExStyle = dwExStyle &amp; ~(WS_EX_LAYERED | WS_EX_REDIRECTED);
00247 <span class="preprocessor">#else</span>
00248 <span class="preprocessor"></span>    pwnd-&gt;ExStyle = dwExStyle &amp; ~WS_EX_LAYERED;
00249 <span class="preprocessor">#endif // REDIRECTION</span>
00250 <span class="preprocessor"></span>    pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o10">cbwndExtra</a> = pcls-&gt;cbwndExtra;
00251 
00252 
00253     <span class="comment">/*</span>
00254 <span class="comment">     * Increment the Window Reference Count in the Class structure</span>
00255 <span class="comment">     * Because xxxFreeWindow() decrements the count, incrementing has</span>
00256 <span class="comment">     * to be done now.  Incase of error, xxxFreeWindow() will decrement it.</span>
00257 <span class="comment">     */</span>
00258     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1153">ReferenceClass</a>(pcls, pwnd)) {
00259         <a class="code" href="../../d4/d1/userk_8h.html#a970">HMFreeObject</a>(pwnd);
00260         <span class="keywordflow">goto</span> CantFindClassMessageAndFail;
00261     }
00262 
00263     <span class="comment">/*</span>
00264 <span class="comment">     * Button control doesn't need input context. Other windows</span>
00265 <span class="comment">     * will associate with the default input context.</span>
00266 <span class="comment">     */</span>
00267     <span class="keywordflow">if</span> (atomT == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a68">ICLS_BUTTON</a>]) {
00268         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o20">hImc</a> = <a class="code" href="../../d8/d0/immstruc_8h.html#a0">NULL_HIMC</a>;
00269     } <span class="keywordflow">else</span> {
00270         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o20">hImc</a> = (HIMC)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o40">spDefaultImc</a>);
00271     }
00272 
00273     <span class="comment">/*</span>
00274 <span class="comment">     * Update the window count.  Doing this now will ensure that if</span>
00275 <span class="comment">     * the creation fails, xxxFreeWindow will keep the window count</span>
00276 <span class="comment">     * correct.</span>
00277 <span class="comment">     */</span>
00278     ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o49">cWindows</a>++;
00279 
00280     <span class="comment">/*</span>
00281 <span class="comment">     * Get the class from the window because ReferenceClass may have</span>
00282 <span class="comment">     * cloned the class.</span>
00283 <span class="comment">     */</span>
00284     pcls = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>;
00285 
00286     <span class="comment">/*</span>
00287 <span class="comment">     * This is a replacement for the &amp;lpCreateParams stuff that used to</span>
00288 <span class="comment">     * pass a pointer directly to the parameters on the stack.  This</span>
00289 <span class="comment">     * step must be done AFTER referencing the class because we</span>
00290 <span class="comment">     * may use the ANSI class name.</span>
00291 <span class="comment">     */</span>
00292     RtlZeroMemory(&amp;csex, <span class="keyword">sizeof</span>(csex));
00293     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.dwExStyle = dwExStyle;
00294     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.hInstance = hInstance;
00295 
00296     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(cczpstrClass)) {
00297         csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszClass = (LPWSTR)cczpstrClass;
00298     } <span class="keywordflow">else</span> {
00299         <span class="keywordflow">if</span> (wWFAnsiCreator) {
00300             csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszClass = (LPWSTR)pcls-&gt;lpszAnsiClassName;
00301             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszClass)) {
00302                 <a class="code" href="../../d5/d6/chartran_8c.html#a6">RtlInitLargeAnsiString</a>(
00303                         (<a class="code" href="../../d5/d8/struct__LARGE__ANSI__STRING.html">PLARGE_ANSI_STRING</a>)&amp;csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>,
00304                         (LPSTR)csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszClass,
00305                         (UINT)-1);
00306             }
00307         } <span class="keywordflow">else</span> {
00308             csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszClass = cczpstrClass-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>;
00309             csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a> = *cczpstrClass;
00310         }
00311     }
00312 
00313     <span class="keywordflow">if</span> (cczpstrName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00314         csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName = cczpstrName-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>;
00315         csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a> = *cczpstrName;
00316     }
00317     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.style = style;
00318     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.x = x;
00319     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.y = y;
00320     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.cx = cx;
00321     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.cy = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00322     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.hwndParent = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent);
00323 
00324     <span class="comment">/*</span>
00325 <span class="comment">     * If pMenu is non-NULL and the window is not a child, pMenu must</span>
00326 <span class="comment">     * be a menu.</span>
00327 <span class="comment">     * Child windows get their UIState bits from their parent.  Top level ones</span>
00328 <span class="comment">     * remain with the default cleared bits.</span>
00329 <span class="comment">     *</span>
00330 <span class="comment">     * The below test is equivalent to TestwndChild().</span>
00331 <span class="comment">     */</span>
00332     <span class="keywordflow">if</span> (fChild) {
00333         csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.hMenu = (HMENU)pMenu;
00334 
00335         pwnd-&gt;ExStyle |= pwndParent-&gt;ExStyle &amp; (WS_EXP_FOCUSHIDDEN | WS_EXP_ACCELHIDDEN);
00336 <span class="preprocessor">#if WS_EXP_ACCELHIDDEN  !=  0x40000000</span>
00337 <span class="preprocessor"></span><span class="preprocessor">#error Fix UISTATE bits copying if you moved the UISTATE bits from ExStyle</span>
00338 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00339 <span class="preprocessor"></span>
00340     } <span class="keywordflow">else</span> {
00341         csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.hMenu = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pMenu);
00342     }
00343 
00344     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpCreateParams = lpCreateParams;
00345 
00346     <span class="comment">/*</span>
00347 <span class="comment">     * ThreadLock: we are going to be doing multiple callbacks here.</span>
00348 <span class="comment">     */</span>
00349     <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(ptiCurrent, pwnd, &amp;tlpwnd);
00350 
00351     <span class="comment">/*</span>
00352 <span class="comment">     * set the parent to be the desktop window (if exists)</span>
00353 <span class="comment">     * before any callback. This way we'll always have a</span>
00354 <span class="comment">     * pointer on spwndParent</span>
00355 <span class="comment">     */</span>
00356     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk) {
00357         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>), <a class="code" href="../../d4/d1/userk_8h.html#a323">PWNDMESSAGE</a>(pwnd));
00358     }
00359 
00360     <span class="comment">/*</span>
00361 <span class="comment">     * Create the class small icon if there isn't one since we are in context</span>
00362 <span class="comment">     * and we are creating a window from this class...</span>
00363 <span class="comment">     */</span>
00364     <span class="keywordflow">if</span> (pcls-&gt;spicn &amp;&amp; !pcls-&gt;spicnSm) {
00365         <a class="code" href="../../d4/d1/userk_8h.html#a1447">xxxCreateClassSmIcon</a>(pcls);
00366     }
00367 
00368     <span class="comment">/*</span>
00369 <span class="comment">     * Store the instance handle and window proc address.  We do this earlier</span>
00370 <span class="comment">     * than Windows because they have a bug were a message can be sent</span>
00371 <span class="comment">     * but lpfnWndProc is not set (3986 CBT WM_CREATE not allowed.)</span>
00372 <span class="comment">     */</span>
00373     pwnd-&gt;hModule = hInstance;
00374 
00375     <span class="comment">/*</span>
00376 <span class="comment">     * Get rid of EditWndProc plain.</span>
00377 <span class="comment">     */</span>
00378     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a> = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a988">WNDPROC_PWND</a>)<a class="code" href="../../d2/d5/ntuser_2rtl_2getset_8c.html#a1">MapClientNeuterToClientPfn</a>(pcls, 0, wWFAnsiCreator);
00379 
00380     <span class="comment">/*</span>
00381 <span class="comment">     * If this window class has a server-side window procedure, mark</span>
00382 <span class="comment">     * it as such.  If the app subclasses it later with an app-side proc</span>
00383 <span class="comment">     * then this mark will be removed.</span>
00384 <span class="comment">     */</span>
00385     <span class="keywordflow">if</span> (pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a492">CSF_SERVERSIDEPROC</a>) {
00386         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFSERVERSIDEPROC);
00387         UserAssert(!(pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp; CSF_ANSIPROC));
00388     }
00389 
00390     <span class="comment">/*</span>
00391 <span class="comment">     * If this window was created with an ANSI CreateWindow*() call, mark</span>
00392 <span class="comment">     * it as such so edit controls will be created correctly. (A combobox</span>
00393 <span class="comment">     * will be able to pass the WFANSICREATOR bit on to its edit control)</span>
00394 <span class="comment">     */</span>
00395     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, wWFAnsiCreator);
00396 
00397     <span class="comment">/*</span>
00398 <span class="comment">     * If this window belongs to an ANSI class or it is a WFANSICREATOR</span>
00399 <span class="comment">     * control, then mark it as an ANSI window</span>
00400 <span class="comment">     */</span>
00401     <span class="keywordflow">if</span> ((pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a493">CSF_ANSIPROC</a>) ||
00402             (wWFAnsiCreator &amp;&amp;
00403              ((atomT == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a68">ICLS_BUTTON</a>]) ||
00404               (atomT == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a73">ICLS_COMBOBOX</a>]) ||
00405               (atomT == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a81">ICLS_COMBOLISTBOX</a>]) ||
00406               (atomT == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a76">ICLS_DIALOG</a>]) ||
00407               (atomT == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a69">ICLS_EDIT</a>]) ||
00408               (atomT == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a71">ICLS_LISTBOX</a>]) ||
00409               (atomT == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a80">ICLS_MDICLIENT</a>]) ||
00410               (atomT == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a89">ICLS_IME</a>]) ||
00411               (atomT == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a70">ICLS_STATIC</a>])))) {
00412         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFANSIPROC);
00413     }
00414 
00415     <span class="comment">/*</span>
00416 <span class="comment">     * If a 3.1-compatible application is creating the window, set this</span>
00417 <span class="comment">     * bit to enable various backward-compatibility hacks.</span>
00418 <span class="comment">     *</span>
00419 <span class="comment">     * If it's not 3.1 compatible, see if we need to turn on the PixieHack</span>
00420 <span class="comment">     * (see wmupdate.c for more info on this)</span>
00421 <span class="comment">     */</span>
00422 
00423     dw = <a class="code" href="../../d6/d3/queue_8c.html#a34">GetAppCompatFlags</a>(ptiCurrent);
00424 
00425     <span class="keywordflow">if</span> (dw &amp; GACF_RANDOM3XUI) {
00426         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFOLDUI);
00427 
00428         dwExStyle &amp;= 0x0000003f;
00429         csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.dwExStyle &amp;= 0x0000003f;
00430     }
00431 
00432     pwnd-&gt;hMod16  = ((ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a796">TIF_16BIT</a>) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSERVERSIDEPROC))? <a class="code" href="../../d4/d1/userk_8h.html#a1281">xxxClientWOWGetProcModule</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>):0;
00433     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a106">Is310Compat</a>(dwExpWinVerAndFlags)) {
00434         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFWIN31COMPAT);
00435         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a105">Is400Compat</a>(dwExpWinVerAndFlags)) {
00436             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFWIN40COMPAT);
00437             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a104">Is500Compat</a>(dwExpWinVerAndFlags)) {
00438                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFWIN50COMPAT);
00439             }
00440         }
00441     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dw &amp; GACF_ALWAYSSENDNCPAINT) {
00442         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFALWAYSSENDNCPAINT);
00443     }
00444 
00445     <span class="comment">/*</span>
00446 <span class="comment">     * Inform the CBT hook that a window is being created.  Pass it the</span>
00447 <span class="comment">     * CreateParams and the window handle that the new one will be inserted</span>
00448 <span class="comment">     * after.  The CBT hook handler returns TRUE to prevent the window</span>
00449 <span class="comment">     * from being created.  It can also modify the CREATESTRUCT info, which</span>
00450 <span class="comment">     * will affect the size, parent, and position of the window.</span>
00451 <span class="comment">     * Defaultly position non-child windows at the top of their list.</span>
00452 <span class="comment">     */</span>
00453 
00454     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a208">IsHooked</a>(ptiCurrent, WHF_CBT)) {
00455         CBT_CREATEWND cbt;
00456 
00457         <span class="comment">/*</span>
00458 <span class="comment">         * Use the extended createstruct so the hook thunk can</span>
00459 <span class="comment">         * handle the strings correctly.</span>
00460 <span class="comment">         */</span>
00461         cbt.lpcs = (LPCREATESTRUCT)&amp;csex;
00462         cbt.hwndInsertAfter = HWND_TOP;
00463 
00464         <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)<a class="code" href="../../d4/d1/userk_8h.html#a1521">xxxCallHook</a>(HCBT_CREATEWND, (WPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd),
00465                 (LPARAM)&amp;cbt, WH_CBT)) {
00466 
00467             <span class="keywordflow">goto</span> MemError;
00468         } <span class="keywordflow">else</span> {
00469             <span class="comment">/*</span>
00470 <span class="comment">             * The CreateHook may have modified some parameters so write them</span>
00471 <span class="comment">             * out (in Windows 3.1 we used to write directly to the variables</span>
00472 <span class="comment">             * on the stack).</span>
00473 <span class="comment">             */</span>
00474 
00475             x = csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.x;
00476             y = csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.y;
00477             cx = csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.cx;
00478             <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.cy;
00479 
00480             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(cbt.hwndInsertAfter))
00481                 pwndZOrder = (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)cbt.hwndInsertAfter;
00482             <span class="keywordflow">else</span>
00483                 pwndZOrder = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(cbt.hwndInsertAfter);
00484         }
00485     } <span class="keywordflow">else</span> {
00486         pwndZOrder = (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)HWND_TOP;
00487     }
00488 
00489     <span class="keywordflow">if</span> (!(fTiled = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a737">TestwndTiled</a>(pwnd))) {
00490 
00491         <span class="comment">/*</span>
00492 <span class="comment">         * CW_USEDEFAULT is only valid for tiled and overlapped windows.</span>
00493 <span class="comment">         * Don't let it be used.</span>
00494 <span class="comment">         */</span>
00495         <span class="keywordflow">if</span> (x == CW_USEDEFAULT || x == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>) {
00496             x = 0;
00497             y = 0;
00498         }
00499 
00500         <span class="keywordflow">if</span> (cx == CW_USEDEFAULT || cx == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>) {
00501             cx = 0;
00502             <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = 0;
00503         }
00504     }
00505 
00506     <span class="comment">/*</span>
00507 <span class="comment">     * Make local copies of these parameters.</span>
00508 <span class="comment">     */</span>
00509     src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o0">x</a> = x;
00510     src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a>  = y;
00511     src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o2">cx</a> = cx;
00512     src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o3">cy</a> = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00513 
00514     <span class="comment">/*</span>
00515 <span class="comment">     *    Position Child Windows</span>
00516 <span class="comment">     */</span>
00517     <span class="keywordflow">if</span> (fChild = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
00518 
00519         <span class="comment">/*</span>
00520 <span class="comment">         * Child windows are offset from the parent's origin.</span>
00521 <span class="comment">         */</span>
00522         UserAssert(pwndParent);
00523         <span class="keywordflow">if</span> (pwndParent != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd)) {
00524             src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o0">x</a> += pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left;
00525             src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a> += pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top;
00526         }
00527 
00528         <span class="comment">/*</span>
00529 <span class="comment">         * Defaultly position child windows at bottom of their list.</span>
00530 <span class="comment">         */</span>
00531         pwndZOrder = <a class="code" href="../../d4/d1/userk_8h.html#a453">PWND_BOTTOM</a>;
00532     }
00533 
00534     <span class="comment">/*</span>
00535 <span class="comment">     *    Position Tiled Windows</span>
00536 <span class="comment">     */</span>
00537 
00538     <span class="comment">/*</span>
00539 <span class="comment">     * Is this a Tiled/Overlapping window?</span>
00540 <span class="comment">     */</span>
00541     <span class="keywordflow">if</span> (fTiled) {
00542 
00543         <span class="comment">/*</span>
00544 <span class="comment">         * Force the WS_CLIPSIBLINGS window style and add a caption and</span>
00545 <span class="comment">         * a border.</span>
00546 <span class="comment">         */</span>
00547         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFCLIPSIBLINGS);
00548         mask = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a734">MaskWF</a>(WFCAPTION) | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a734">MaskWF</a>(WFBORDER);
00549 
00550         <span class="comment">//</span>
00551         <span class="comment">// We add on a raised edge since IF the person had passed in WS_CAPTION,</span>
00552         <span class="comment">// and didn't specify any 3D borders, we would've added it on to the</span>
00553         <span class="comment">// style bits above.</span>
00554         <span class="comment">//</span>
00555 
00556         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT)) {
00557 <span class="comment">//        if (!TestWF(pwnd, WEFEDGEMASK))</span>
00558             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WEFWINDOWEDGE);
00559         }
00560 
00561         <span class="comment">/*</span>
00562 <span class="comment">         * Set bit that will force size message to be sent at SHOW time.</span>
00563 <span class="comment">         */</span>
00564         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFSENDSIZEMOVE);
00565 
00566         <span class="comment">/*</span>
00567 <span class="comment">         * Here is how the "tiled" window initial positioning works...</span>
00568 <span class="comment">         * If the app is a 1.0x app, then we use our standard "stair step"</span>
00569 <span class="comment">         * default positioning scheme.  Otherwise, we check the x &amp; cx</span>
00570 <span class="comment">         * parameters.  If either of these == CW_USEDEFAULT then use the</span>
00571 <span class="comment">         * default position/size, otherwise use the position/size they</span>
00572 <span class="comment">         * specified.  If not using default position, use SW_SHOW for the</span>
00573 <span class="comment">         * xxxShowWindow() parameter, otherwise use the y parameter given.</span>
00574 <span class="comment">         *</span>
00575 <span class="comment">         * In 32-bit world, CW_USEDEFAULT is 0x80000000, but apps still</span>
00576 <span class="comment">         * store word-oriented values either in dialog templates or</span>
00577 <span class="comment">         * in their own structures.  So CreateWindow still recognizes the</span>
00578 <span class="comment">         * 16 bit equivalent, which is 0x8000, CW2_USEDEFAULT.  The original</span>
00579 <span class="comment">         * is changed because parameters to CreateWindow() are 32 bit</span>
00580 <span class="comment">         * values, which can cause sign extention, or weird results if</span>
00581 <span class="comment">         * 16 bit math assumptions are being made, etc.</span>
00582 <span class="comment">         */</span>
00583 
00584         <span class="comment">/*</span>
00585 <span class="comment">         * Default to passing the y parameter to xxxShowWindow().</span>
00586 <span class="comment">         */</span>
00587         <span class="keywordflow">if</span> (x == CW_USEDEFAULT || x == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>) {
00588 
00589             <span class="comment">/*</span>
00590 <span class="comment">             * If the y value is not CW_USEDEFAULT, use it as a SW_* command.</span>
00591 <span class="comment">             */</span>
00592             <span class="keywordflow">if</span> (src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a> != CW_USEDEFAULT &amp;&amp; src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>) {
00593                 sw = src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a>;
00594             }
00595         }
00596 
00597 
00598         <span class="comment">/*</span>
00599 <span class="comment">         * Allow the shell to tell us what monitor to run this app on</span>
00600 <span class="comment">         */</span>
00601         pMonitor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00602         <span class="keywordflow">if</span> (    x == CW_USEDEFAULT ||
00603                 x == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a> ||
00604                 cx == CW_USEDEFAULT ||
00605                 cx == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>) {
00606 
00607             <span class="keywordflow">if</span> (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o18">hMonitor</a>) {
00608                 pMonitor = <a class="code" href="../../d7/d3/validate_8c.html#a10">ValidateHmonitor</a>(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o18">hMonitor</a>);
00609             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pwndParent) {
00610                 pMonitor = <a class="code" href="../../d9/d1/mmrtl_8c.html#a8">_MonitorFromWindow</a>(pwndParent, MONITOR_DEFAULTTONEAREST);
00611             }
00612         }
00613 
00614         <span class="keywordflow">if</span> (!pMonitor) {
00615             pMonitor = <a class="code" href="../../d6/d0/usercli_8h.html#a793">GetPrimaryMonitor</a>();
00616         }
00617 
00618         <a class="code" href="../../d4/d1/userk_8h.html#a1456">SetTiledRect</a>(pwnd, &amp;rc, pMonitor);
00619 
00620         <span class="comment">/*</span>
00621 <span class="comment">         * Did the app ask for default positioning?</span>
00622 <span class="comment">         */</span>
00623         <span class="keywordflow">if</span> (x == CW_USEDEFAULT || x == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>) {
00624 
00625             <span class="comment">/*</span>
00626 <span class="comment">             * Use default positioning.</span>
00627 <span class="comment">             */</span>
00628             <span class="keywordflow">if</span> (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o5">dwFlags</a> &amp; STARTF_USEPOSITION ) {
00629                 fStartup = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00630                 x = src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o0">x</a> = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o1">dwX</a>;
00631                 y = src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a> = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o2">dwY</a>;
00632             } <span class="keywordflow">else</span> {
00633                 x = src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o0">x</a> = rc.left;
00634                 y = src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a> = rc.top;
00635             }
00636             fDefPos = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00637 
00638         } <span class="keywordflow">else</span> {
00639 
00640             <span class="comment">/*</span>
00641 <span class="comment">             * Use the apps specified positioning.  Undo the "stacking"</span>
00642 <span class="comment">             * effect caused by SetTiledRect().</span>
00643 <span class="comment">             */</span>
00644             <span class="keywordflow">if</span> (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o7">cWndStack</a>) {
00645                 pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o7">cWndStack</a>--;
00646             }
00647         }
00648 
00649         <span class="comment">/*</span>
00650 <span class="comment">         * Did the app ask for default sizing?</span>
00651 <span class="comment">         */</span>
00652         <span class="keywordflow">if</span> (src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o2">cx</a> == CW_USEDEFAULT || src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o2">cx</a> == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>) {
00653 
00654             <span class="comment">/*</span>
00655 <span class="comment">             * Use default sizing.</span>
00656 <span class="comment">             */</span>
00657             <span class="keywordflow">if</span> (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o5">dwFlags</a> &amp; STARTF_USESIZE) {
00658                 fStartup = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00659                 src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o2">cx</a> = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o3">dwXSize</a>;
00660                 src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o3">cy</a> = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o4">dwYSize</a>;
00661             } <span class="keywordflow">else</span> {
00662                 src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o2">cx</a> = rc.right - x;
00663                 src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o3">cy</a> = rc.bottom - y;
00664             }
00665             fDefPos = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00666 
00667         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fDefPos) {
00668             <span class="comment">/*</span>
00669 <span class="comment">             * The app wants default positioning but not default sizing.</span>
00670 <span class="comment">             * Make sure that it's still entirely visible by moving the</span>
00671 <span class="comment">             * window.</span>
00672 <span class="comment">             */</span>
00673             dx = (src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o0">x</a> + src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o2">cx</a>) - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.right;
00674             dy = (src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a> + src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o3">cy</a>) - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.bottom;
00675             <span class="keywordflow">if</span> (dx &gt; 0) {
00676                 x -= dx;
00677                 src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o0">x</a> = x;
00678                 <span class="keywordflow">if</span> (src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o0">x</a> &lt; pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left) {
00679                     src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o0">x</a> = x = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left;
00680                 }
00681             }
00682 
00683             <span class="keywordflow">if</span> (dy &gt; 0) {
00684                 y -= dy;
00685                 src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a> = y;
00686                 <span class="keywordflow">if</span> (src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a> &lt; pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.top) {
00687                     src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o1">y</a> = y = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.top;
00688                 }
00689             }
00690         }
00691     }
00692 
00693     <span class="comment">/*</span>
00694 <span class="comment">     * If we have used any startup postitions, turn off the startup</span>
00695 <span class="comment">     * info so we don't use it again.</span>
00696 <span class="comment">     */</span>
00697     <span class="keywordflow">if</span> (fStartup) {
00698         ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o5">dwFlags</a> &amp;=
00699                 ~(STARTF_USESIZE | STARTF_USEPOSITION);
00700     }
00701 
00702     <span class="comment">/*</span>
00703 <span class="comment">     *    Position Popup Windows</span>
00704 <span class="comment">     */</span>
00705 
00706     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a739">TestwndPopup</a>(pwnd)) {
00707 <span class="comment">// LATER: Why is this test necessary? Can one create a popup desktop?</span>
00708         <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d3/d9/client_2wow_8c.html#a3">_GetDesktopWindow</a>()) {
00709 
00710             <span class="comment">/*</span>
00711 <span class="comment">             * Force the clipsiblings/overlap style.</span>
00712 <span class="comment">             */</span>
00713             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFCLIPSIBLINGS);
00714         }
00715     }
00716 
00717     <span class="comment">/*</span>
00718 <span class="comment">     * Shove in those default style bits.</span>
00719 <span class="comment">     */</span>
00720     *(((WORD *)&amp;pwnd-&gt;style) + 1) |= mask;
00721 
00722     <span class="comment">/*</span>
00723 <span class="comment">     *    Menu/SysMenu Stuff</span>
00724 <span class="comment">     */</span>
00725 
00726     <span class="comment">/*</span>
00727 <span class="comment">     * If there is no menu handle given and it's not a child window but</span>
00728 <span class="comment">     * there is a class menu, use the class menu.</span>
00729 <span class="comment">     */</span>
00730     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; !fChild &amp;&amp; (pcls-&gt;lpszMenuName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00731         UNICODE_STRING strMenuName;
00732 
00733         <a class="code" href="../../d4/d1/userk_8h.html#a1005">RtlInitUnicodeStringOrId</a>(&amp;strMenuName, pcls-&gt;lpszMenuName);
00734         pMenu = <a class="code" href="../../d4/d1/userk_8h.html#a1009">xxxClientLoadMenu</a>(pcls-&gt;hModule, &amp;strMenuName);
00735         csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.hMenu = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pMenu);
00736 
00737         <span class="comment">/*</span>
00738 <span class="comment">         * This load fails if the caller does not have DESKTOP_CREATEMENU</span>
00739 <span class="comment">         * permission but that's ok they will just get a window without a menu</span>
00740 <span class="comment">         */</span>
00741     }
00742 
00743     <span class="comment">/*</span>
00744 <span class="comment">     * Store the menu handle.</span>
00745 <span class="comment">     */</span>
00746     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
00747 
00748         <span class="comment">/*</span>
00749 <span class="comment">         * It's an id in this case.</span>
00750 <span class="comment">         */</span>
00751         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a> = pMenu;
00752     } <span class="keywordflow">else</span> {
00753 
00754         <span class="comment">/*</span>
00755 <span class="comment">         * It's a real handle in this case.</span>
00756 <span class="comment">         */</span>
00757         <a class="code" href="../../d4/d1/userk_8h.html#a1362">LockWndMenu</a>(pwnd, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>, pMenu);
00758     }
00759 
00760 <span class="comment">// LATER does this work?</span>
00761     <span class="comment">/*</span>
00762 <span class="comment">     * Delete the Close menu item if directed.</span>
00763 <span class="comment">     */</span>
00764     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a485">TestCF</a>(pwnd, CFNOCLOSE)) {
00765 
00766         <span class="comment">/*</span>
00767 <span class="comment">         * Do this by position since the separator does not have an ID.</span>
00768 <span class="comment">         */</span>
00769 <span class="comment">// LATER mikeke why is xxxGetSystemMenu() returning NULL?</span>
00770         pMenu = <a class="code" href="../../d4/d1/userk_8h.html#a1886">xxxGetSystemMenu</a>(pwnd, FALSE);
00771         <span class="keywordflow">if</span> (pMenu != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00772             <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpMenu;
00773 
00774             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pMenu, &amp;tlpMenu);
00775             <a class="code" href="../../d4/d1/userk_8h.html#a1595">xxxDeleteMenu</a>(pMenu, 5, MF_BYPOSITION);
00776             <a class="code" href="../../d4/d1/userk_8h.html#a1595">xxxDeleteMenu</a>(pMenu, 5, MF_BYPOSITION);
00777             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpMenu);
00778         }
00779     }
00780 
00781     <span class="comment">/*</span>
00782 <span class="comment">     *    Parent/Owner Stuff</span>
00783 <span class="comment">     */</span>
00784 
00785     <span class="comment">/*</span>
00786 <span class="comment">     * If this isn't a child window, reset the Owner/Parent info.</span>
00787 <span class="comment">     */</span>
00788     <span class="keywordflow">if</span> (!fChild) {
00789         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o12">spwndLastActive</a>), pwnd);
00790         <span class="keywordflow">if</span> ((pwndParent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00791                 (pwndParent != pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spwndMessage) &amp;&amp;
00792                 (pwndParent != pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwnd)) {
00793 
00794             <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndOwner = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a11">GetTopLevelWindow</a>(pwndParent);
00795 
00796             <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a18">ValidateOwnerDepth</a>(pwnd, pwndOwner)) {
00797                 RIPERR1(ERROR_INVALID_PARAMETER,
00798                         RIP_WARNING,
00799                         <span class="stringliteral">"Exceeded nested owner limit for pwnd %#p"</span>,
00800                         pwnd);
00801                 <span class="keywordflow">goto</span> MemError;
00802             }
00803 
00804 <span class="preprocessor">#if DBG</span>
00805 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a89">ICLS_IME</a>]) {
00806                 UserAssert(!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a485">TestCF</a>(pwndOwner, CFIME));
00807             }
00808 <span class="preprocessor">#endif</span>
00809 <span class="preprocessor"></span>            <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>), pwndOwner);
00810             <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>, WEFTOPMOST)) {
00811 
00812                 <span class="comment">/*</span>
00813 <span class="comment">                 * If this window's owner is a topmost window, then it has to</span>
00814 <span class="comment">                 * be one also since a window must be above its owner.</span>
00815 <span class="comment">                 */</span>
00816                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WEFTOPMOST);
00817             }
00818 
00819             <span class="comment">/*</span>
00820 <span class="comment">             * If this is a owner window on another thread, share input</span>
00821 <span class="comment">             * state so this window gets z-ordered correctly.</span>
00822 <span class="comment">             */</span>
00823             <span class="keywordflow">if</span> (atomT != <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a89">ICLS_IME</a>] &amp;&amp;
00824                     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00825                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>) != ptiCurrent) {
00826                 <span class="comment">/*</span>
00827 <span class="comment">                 * No need to DeferWinEventNotify() here:  pwnd and pwndParent</span>
00828 <span class="comment">                 * are locked and because we called ReferenceClass(pcls, pwnd),</span>
00829 <span class="comment">                 * pcls is safe until xxxFreeWindow(pwnd). (IanJa)</span>
00830 <span class="comment">                 */</span>
00831                 <a class="code" href="../../d4/d1/userk_8h.html#a1202">zzzAttachThreadInput</a>(ptiCurrent, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>), TRUE);
00832             }
00833 
00834         } <span class="keywordflow">else</span> {
00835             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00836         }
00837 
00838 <span class="preprocessor">#if DBG</span>
00839 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00840             UserAssert(!(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o4">dwDTFlags</a> &amp; (DF_DESTROYED | DF_DESKWNDDESTROYED | DF_DYING)));
00841         }
00842 <span class="preprocessor">#endif</span>
00843 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((pwndParent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00844                (pwndParent != pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spwndMessage)) {
00845             pwndParent = <a class="code" href="../../d3/d9/client_2wow_8c.html#a3">_GetDesktopWindow</a>();
00846 
00847             <a class="code" href="../../d6/d0/usercli_8h.html#a38">ThreadLockWithPti</a>(ptiCurrent, pwndParent, &amp;tlpwndParent);
00848             fLockParent = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00849         }
00850     }
00851 
00852     <span class="comment">/*</span>
00853 <span class="comment">     * Store backpointer to parent.</span>
00854 <span class="comment">     */</span>
00855     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>), pwndParent);
00856 
00857     <span class="comment">/*</span>
00858 <span class="comment">     *    Final Window Positioning</span>
00859 <span class="comment">     */</span>
00860 
00861     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN31COMPAT)) {
00862         <span class="comment">/*</span>
00863 <span class="comment">         * BACKWARD COMPATIBILITY HACK</span>
00864 <span class="comment">         *</span>
00865 <span class="comment">         * In 3.0, CS_PARENTDC overrides WS_CLIPCHILDREN and WS_CLIPSIBLINGS,</span>
00866 <span class="comment">         * but only if the parent is not WS_CLIPCHILDREN.</span>
00867 <span class="comment">         * This behavior is required by PowerPoint and Charisma, among others.</span>
00868 <span class="comment">         */</span>
00869         <span class="keywordflow">if</span> ((pcls-&gt;style &amp; CS_PARENTDC) &amp;&amp;
00870                 !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndParent, WFCLIPCHILDREN)) {
00871 <span class="preprocessor">#if DBG</span>
00872 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCLIPCHILDREN))
00873                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"WS_CLIPCHILDREN overridden by CS_PARENTDC"</span>);
00874             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCLIPSIBLINGS))
00875                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"WS_CLIPSIBLINGS overridden by CS_PARENTDC"</span>);
00876 <span class="preprocessor">#endif</span>
00877 <span class="preprocessor"></span>            <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, (WFCLIPCHILDREN | WFCLIPSIBLINGS));
00878         }
00879     }
00880 
00881     <span class="comment">/*</span>
00882 <span class="comment">     * If this is a child window being created in a parent window</span>
00883 <span class="comment">     * of a different thread, but not on the desktop, attach their</span>
00884 <span class="comment">     * input streams together. [windows with WS_CHILD can be created</span>
00885 <span class="comment">     * on the desktop, that's why we check both the style bits</span>
00886 <span class="comment">     * and the parent window.]</span>
00887 <span class="comment">     */</span>
00888     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd) &amp;&amp; (pwndParent != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd)) &amp;&amp;
00889             (ptiCurrent != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndParent))) {
00890         <span class="comment">/*</span>
00891 <span class="comment">         * No need to DeferWinEventNotify() - there is an xxx call just below</span>
00892 <span class="comment">         */</span>
00893         <a class="code" href="../../d4/d1/userk_8h.html#a1202">zzzAttachThreadInput</a>(ptiCurrent, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndParent), TRUE);
00894     }
00895 
00896     <span class="comment">/*</span>
00897 <span class="comment">     * Make sure the window is between the minimum and maximum sizes.</span>
00898 <span class="comment">     */</span>
00899 
00900     <span class="comment">/*</span>
00901 <span class="comment">     * HACK ALERT!</span>
00902 <span class="comment">     * This sends WM_GETMINMAXINFO to a (tiled or sizable) window before</span>
00903 <span class="comment">     * it has been created (before it is sent WM_NCCREATE).</span>
00904 <span class="comment">     * Maybe some app expects this, so we nustn't reorder the messages.</span>
00905 <span class="comment">     */</span>
00906     <a class="code" href="../../d4/d1/userk_8h.html#a1510">xxxAdjustSize</a>(pwnd, &amp;src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o2">cx</a>, &amp;src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o3">cy</a>);
00907 
00908     <span class="comment">/*</span>
00909 <span class="comment">     * check for a window being created full screen</span>
00910 <span class="comment">     *</span>
00911 <span class="comment">     * Note the check for a non-NULL pdeskParent -- this is important for CreateWindowStation</span>
00912 <span class="comment">     */</span>
00913     <span class="keywordflow">if</span> (    pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00914             !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD) &amp;&amp;
00915             !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTOOLWINDOW)) {
00916 
00917         <a class="code" href="../../d4/d1/userk_8h.html#a1752">xxxCheckFullScreen</a>(pwnd, &amp;src);
00918     }
00919 
00920     <span class="keywordflow">if</span> (src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o2">cx</a> &lt; 0) {
00921         RIPMSG1(RIP_WARNING, <span class="stringliteral">"xxxCreateWindowEx: adjusted cx in pwnd %#p"</span>, pwnd);
00922         src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o2">cx</a> = 0;
00923     }
00924 
00925     <span class="keywordflow">if</span> (src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o3">cy</a> &lt; 0) {
00926         RIPMSG1(RIP_WARNING, <span class="stringliteral">"xxxCreateWindowEx: adjusted cy in pwnd %#p"</span>, pwnd);
00927         src.<a class="code" href="../../d6/d6/structtagSIZERECT.html#o3">cy</a> = 0;
00928     }
00929 
00930     <span class="comment">/*</span>
00931 <span class="comment">     * Calculate final window dimensions...</span>
00932 <span class="comment">     */</span>
00933     <a class="code" href="../../d3/d6/rect_8c.html#a14">RECTFromSIZERECT</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, &amp;src);
00934 
00935     <span class="keywordflow">if</span> (dwExStyle &amp; WS_EX_LAYERED) {
00936         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1983">xxxSetLayeredWindow</a>(pwnd, FALSE)) {
00937             <span class="keywordflow">goto</span> MemError;
00938         }
00939     }
00940 
00941 <span class="preprocessor">#ifdef REDIRECTION</span>
00942 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (dwExStyle &amp; WS_EX_REDIRECTED) {
00943         <span class="keywordflow">if</span> (!SetRedirectedWindow(pwnd)) {
00944             <span class="keywordflow">goto</span> MemError;
00945         }
00946     }
00947 <span class="preprocessor">#endif // REDIRECTION</span>
00948 <span class="preprocessor"></span>
00949     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a488">TestCF2</a>(pcls, CFOWNDC) ||
00950             (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a488">TestCF2</a>(pcls, CFCLASSDC) &amp;&amp; pcls-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o4">pdce</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00951         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> == <a class="code" href="../../d4/d1/userk_8h.html#a1699">CreateCacheDC</a>(pwnd, DCX_OWNDC, NULL)) {
00952 
00953             RIPMSG1(RIP_WARNING, <span class="stringliteral">"xxxCreateWindowEx: pwnd %#p failed to create cached DC"</span>,
00954                     pwnd);
00955 
00956             <span class="keywordflow">goto</span> MemError;
00957         }
00958     }
00959 
00960     <span class="comment">/*</span>
00961 <span class="comment">     * Update the create struct now that we've modified some passed in</span>
00962 <span class="comment">     * parameters.</span>
00963 <span class="comment">     */</span>
00964     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.x = x;
00965     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.y = y;
00966     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.cx = cx;
00967     csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.cy = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00968 
00969     <span class="comment">/*</span>
00970 <span class="comment">     * Send a NCCREATE message to the window.</span>
00971 <span class="comment">     */</span>
00972     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_NCCREATE, 0L, (LPARAM)&amp;csex)) {
00973 
00974 MemError:
00975 
00976 <span class="preprocessor">#if DBG</span>
00977 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(cczpstrClass)) {
00978             RIPMSG2(RIP_WARNING,
00979                     (pwndParent) ?
00980                             <span class="stringliteral">"xxxCreateWindowEx failed, Class=%#.4x, ID=%d"</span> :
00981                             <span class="stringliteral">"xxxCreateWindowEx failed, Class=%#.4x"</span>,
00982                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(cczpstrClass),
00983                     (LONG_PTR) pMenu);
00984         } <span class="keywordflow">else</span> {
00985             RIPMSG2(RIP_WARNING,
00986                     (pwndParent) ?
00987                             <span class="stringliteral">"xxxCreateWindowEx failed, Class=\"%s\", ID=%d"</span> :
00988                             <span class="stringliteral">"xxxCreateWindowEx failed, Class=\"%s\""</span>,
00989                     pcls-&gt;lpszAnsiClassName,
00990                     (LONG_PTR) pMenu);
00991         }
00992 <span class="preprocessor">#endif</span>
00993 <span class="preprocessor"></span>
00994         <span class="keywordflow">if</span> (fLockParent)
00995             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
00996 
00997         <span class="comment">/*</span>
00998 <span class="comment">         * Set the state as destroyed so any z-ordering events will be ignored.</span>
00999 <span class="comment">         * We cannot NULL out the owner field until WM_NCDESTROY is send or</span>
01000 <span class="comment">         * apps like Rumba fault  (they call GetParent after every message)</span>
01001 <span class="comment">         */</span>
01002         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFDESTROYED);
01003 
01004         <span class="comment">/*</span>
01005 <span class="comment">         * Unset the visible flag so we don't think in xxxDestroyWindow that</span>
01006 <span class="comment">         * this window is visible</span>
01007 <span class="comment">         */</span>
01008         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
01009             <a class="code" href="../../d4/d1/userk_8h.html#a1626">SetVisible</a>(pwnd, SV_UNSET);
01010         }
01011 
01012         <span class="comment">/*</span>
01013 <span class="comment">         * FreeWindow performs a ThreadUnlock.</span>
01014 <span class="comment">         */</span>
01015         <a class="code" href="../../d4/d1/userk_8h.html#a1461">xxxFreeWindow</a>(pwnd, &amp;tlpwnd);
01016 
01017         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01018     }
01019 
01020     <span class="comment">/*</span>
01021 <span class="comment">     * WM_NCCREATE processing may have changed the window text.  Change</span>
01022 <span class="comment">     * the CREATESTRUCT to point to the real window text.</span>
01023 <span class="comment">     *</span>
01024 <span class="comment">     * MSMoney needs this because it clears the window and we need to</span>
01025 <span class="comment">     * reflect the new name back into the cs structure.</span>
01026 <span class="comment">     * A better thing to do would be to have a pointer to the CREATESTRUCT</span>
01027 <span class="comment">     * within the window itself so that DefWindowProc can change the</span>
01028 <span class="comment">     * the window name in the CREATESTRUCT to point to the real name and</span>
01029 <span class="comment">     * this funky check is no longer needed.</span>
01030 <span class="comment">     *</span>
01031 <span class="comment">     * DefSetText converts a pointer to NULL to a NULL title so</span>
01032 <span class="comment">     * we don't want to over-write cs.lpszName if it was a pointer to</span>
01033 <span class="comment">     * a NULL string and pName is NULL.  Approach Database for Windows creates</span>
01034 <span class="comment">     * windows with a pointer to NULL and then accesses the pointer later</span>
01035 <span class="comment">     * during WM_CREATE</span>
01036 <span class="comment">     */</span>
01037     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFTITLESET))
01038         <span class="keywordflow">if</span> (!(csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o0">Length</a> == 0 &amp;&amp;
01039                 pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o3">Buffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01040             csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o3">Buffer</a>;
01041             RtlCopyMemory(&amp;csex.<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">LARGE_STRING</a>));
01042         }
01043 
01044     <span class="comment">/*</span>
01045 <span class="comment">     * The Window is now officially "created."  Change the relevant global</span>
01046 <span class="comment">     * stuff.</span>
01047 <span class="comment">     */</span>
01048 
01049 
01050      <span class="comment">/*</span>
01051 <span class="comment">      * Create per thread default IME window.</span>
01052 <span class="comment">      */</span>
01053     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>() &amp;&amp; ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01054         <span class="comment">/*</span>
01055 <span class="comment">         * Avoid creating the default IME window to any of message only windows</span>
01056 <span class="comment">         * or windows on no I/O desktop.</span>
01057 <span class="comment">         */</span>
01058         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d8/createw_8c.html#a0">WantImeWindow</a>(pwndParent, pwnd)) {
01059             <span class="comment">//</span>
01060             <span class="comment">// Make sure we are not creating a window for Ole,</span>
01061             <span class="comment">// for it does not pump messages even though</span>
01062             <span class="comment">// they creates a window.</span>
01063             <span class="comment">//</span>
01064             UserAssert(gaOleMainThreadWndClass != atomT);
01065 
01066             <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>),
01067                   <a class="code" href="../../d5/d8/ntimm_8c.html#a9">xxxCreateDefaultImeWindow</a>(pwnd, atomT, hInstance));
01068 
01069 
01070             <span class="comment">/*</span>
01071 <span class="comment">             * If keybaord layout is switched but Imm activation was skipped</span>
01072 <span class="comment">             * while spwndDefaultIme was gone, do the activation now.</span>
01073 <span class="comment">             */</span>
01074 <span class="preprocessor">#if _DBG</span>
01075 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o40">spDefaultImc</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01076                 RIPMSG1(RIP_WARNING, <span class="stringliteral">"xxxCreateWindowEx: ptiCurrent(%08p)-&gt;spDefaultImc is NULL."</span>, ptiCurrent);
01077             }
01078             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o8">pClientInfo</a>);
01079 <span class="preprocessor">#endif</span>
01080 <span class="preprocessor"></span>
01081             <span class="keywordflow">if</span> (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a> &amp;&amp; (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o8">pClientInfo</a>-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a> &amp; <a class="code" href="../../d1/d0/inc_2user_8h.html#a105">CI_INPUTCONTEXT_REINIT</a>)) {
01082 
01083                 <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndIme;
01084 
01085                 TAGMSG1(DBGTAG_IMM, <span class="stringliteral">"xxxCreateDefaultImeWindow: ptiCurrent(%08p)-&gt;spDefaultImc-&gt;fNeedClientImcActivate is set."</span>, ptiCurrent);
01086                 <span class="comment">/*</span>
01087 <span class="comment">                 * Make this client side callback to force the input context</span>
01088 <span class="comment">                 * is re-initialized appropriately.</span>
01089 <span class="comment">                 * (keyboard layout has been changed since this thread was taking</span>
01090 <span class="comment">                 * a nap while with no window but still was GUI thread)</span>
01091 <span class="comment">                 * see raid #294964</span>
01092 <span class="comment">                 */</span>
01093                 <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>, &amp;tlpwndIme);
01094                 <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>, WM_IME_SYSTEM, (WPARAM)IMS_ACTIVATETHREADLAYOUT, (LPARAM)ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o4">spklActive</a>-&gt;<a class="code" href="../../d4/d9/structtagKL.html#o4">hkl</a>);
01095 
01096                 <span class="comment">// Reset the flag.</span>
01097                 ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o8">pClientInfo</a>-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o0">CI_flags</a> &amp;= ~<a class="code" href="../../d1/d0/inc_2user_8h.html#a105">CI_INPUTCONTEXT_REINIT</a>;
01098 
01099                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndIme);
01100             }
01101         }
01102         <span class="keywordflow">else</span> {
01103             RIPMSG0(RIP_VERBOSE, <span class="stringliteral">"xxxCreateWindowEx: default IME window is not created."</span>);
01104         }
01105     }
01106 
01107 
01108     <span class="comment">/*</span>
01109 <span class="comment">     * Update the Parent/Child linked list.</span>
01110 <span class="comment">     */</span>
01111     <span class="keywordflow">if</span> (pwndParent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01112         <span class="keywordflow">if</span> (!fChild &amp;&amp; (pwndParent != pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spwndMessage)) {
01113 
01114             <span class="comment">/*</span>
01115 <span class="comment">             * If this is a top-level window, and it's not part of the</span>
01116 <span class="comment">             * topmost pile of windows, then we have to make sure it</span>
01117 <span class="comment">             * doesn't go on top of any of the topmost windows.</span>
01118 <span class="comment">             *</span>
01119 <span class="comment">             * If he's trying to put the window on the top, or trying</span>
01120 <span class="comment">             * to insert it after one of the topmost windows, insert</span>
01121 <span class="comment">             * it after the last topmost window in the pile.</span>
01122 <span class="comment">             */</span>
01123             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTOPMOST)) {
01124                 <span class="keywordflow">if</span> (pwndZOrder == <a class="code" href="../../d4/d1/userk_8h.html#a452">PWND_TOP</a> ||
01125                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndZOrder, WEFTOPMOST)) {
01126                     pwndZOrder = <a class="code" href="../../d4/d1/userk_8h.html#a1614">CalcForegroundInsertAfter</a>(pwnd);
01127                 }
01128             } <span class="keywordflow">else</span> {
01129                 pwndHardError = <a class="code" href="../../d4/d1/userk_8h.html#a573">GETTOPMOSTINSERTAFTER</a>(pwnd);
01130                 <span class="keywordflow">if</span> (pwndHardError != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01131                     pwndZOrder = pwndHardError;
01132                 }
01133             }
01134         }
01135 
01136         <a class="code" href="../../d4/d1/userk_8h.html#a1457">LinkWindow</a>(pwnd, pwndZOrder, pwndParent);
01137     }
01138 
01139     <span class="comment">/*</span>
01140 <span class="comment">     *    Message Sending</span>
01141 <span class="comment">     */</span>
01142 
01143     <span class="comment">/*</span>
01144 <span class="comment">     * Send a NCCALCSIZE message to the window and have it return the official</span>
01145 <span class="comment">     * size of its client area.</span>
01146 <span class="comment">     */</span>
01147 
01148 <span class="preprocessor">#ifdef USE_MIRRORING</span>
01149 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (fChild &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndParent, WEFLAYOUTRTL)) {
01150         cx = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
01151         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right = pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right - (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left - pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left);
01152         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left  = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - cx;
01153     }
01154 <span class="preprocessor">#endif</span>
01155 <span class="preprocessor"></span>
01156     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;rc, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>);
01157     <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_NCCALCSIZE, 0L, (LPARAM)&amp;rc);
01158     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a> = rc;
01159 
01160     <span class="comment">/*</span>
01161 <span class="comment">     * Send a CREATE message to the window.</span>
01162 <span class="comment">     */</span>
01163     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_CREATE, 0L, (LPARAM)&amp;csex) == -1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>) {
01164 <span class="preprocessor">#if DBG</span>
01165 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(cczpstrClass)) {
01166             RIPMSG1(RIP_WARNING,
01167                     <span class="stringliteral">"CreateWindow() send of WM_CREATE failed, Class = 0x%x"</span>,
01168                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(cczpstrClass));
01169         } <span class="keywordflow">else</span> {
01170             RIPMSG1(RIP_WARNING,
01171                     <span class="stringliteral">"CreateWindow() send of WM_CREATE failed, Class = \"%s\""</span>,
01172                     pcls-&gt;lpszAnsiClassName);
01173         }
01174 <span class="preprocessor">#endif</span>
01175 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (fLockParent)
01176             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01177 
01178         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd))
01179             <a class="code" href="../../d4/d1/userk_8h.html#a1575">xxxDestroyWindow</a>(pwnd);
01180 
01181         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01182     }
01183 
01184     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFISINITIALIZED); <span class="comment">/* Flag that the window is created.</span>
01185 <span class="comment">                                     WoW uses this bit to determine that</span>
01186 <span class="comment">                                     an fnid of 0 really means 0. */</span>
01187 
01188     <span class="comment">/*</span>
01189 <span class="comment">     * Notify anyone who is listening that the window is created.  Do this</span>
01190 <span class="comment">     * before we size/move/max/min/show it so that event observers can count</span>
01191 <span class="comment">     * on getting notifications for those things also.</span>
01192 <span class="comment">     *</span>
01193 <span class="comment">     * But do this AFTER WM_CREATE is sent.  The window and its data will not</span>
01194 <span class="comment">     * be fully initialized until then.  Since the purpose of an event is to</span>
01195 <span class="comment">     * let watchers turn around and do querying, we want their queries to</span>
01196 <span class="comment">     * succeed and not fault.</span>
01197 <span class="comment">     */</span>
01198     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
01199         <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_OBJECT_CREATE, pwnd, OBJID_WINDOW, INDEXID_OBJECT, 0);
01200     }
01201 
01202     <span class="comment">/*</span>
01203 <span class="comment">     * If this is a Tiled/Overlapped window, don't send size or move msgs yet.</span>
01204 <span class="comment">     */</span>
01205     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSENDSIZEMOVE)) {
01206         <a class="code" href="../../d4/d1/userk_8h.html#a1505">xxxSendSizeMessage</a>(pwnd, SIZENORMAL);
01207 
01208         <span class="keywordflow">if</span> (pwndParent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd) != pwndParent) {
01209             rc.left -= pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left;
01210             rc.top -= pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top;
01211         }
01212 
01213         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_MOVE, 0L, MAKELONG(rc.left, rc.top));
01214     }
01215 
01216     <span class="comment">/*</span>
01217 <span class="comment">     *    Min/Max Stuff</span>
01218 <span class="comment">     */</span>
01219 
01220     <span class="comment">/*</span>
01221 <span class="comment">     * If app specified either min/max style, then we must call our minmax</span>
01222 <span class="comment">     * code to get it all set up correctly so that when the show is done,</span>
01223 <span class="comment">     * the window is displayed right.</span>
01224 <span class="comment">     */</span>
01225     dwMinMax = <a class="code" href="../../d4/d1/userk_8h.html#a503">MINMAX_KEEPHIDDEN</a> | <a class="code" href="../../d4/d1/userk_8h.html#a657">TEST_PUDF</a>(PUDF_ANIMATE);
01226     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED)) {
01227         <a class="code" href="../../d4/d1/userk_8h.html#a1631">SetMinimize</a>(pwnd, SMIN_CLEAR);
01228         <a class="code" href="../../d4/d1/userk_8h.html#a1159">xxxMinMaximize</a>(pwnd, SW_SHOWMINNOACTIVE, dwMinMax);
01229     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXIMIZED)) {
01230         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFMAXIMIZED);
01231         <a class="code" href="../../d4/d1/userk_8h.html#a1159">xxxMinMaximize</a>(pwnd, SW_SHOWMAXIMIZED, dwMinMax);
01232     }
01233 
01234     <span class="comment">/*</span>
01235 <span class="comment">     * Send notification if child</span>
01236 <span class="comment">     */</span>
01237 
01238     <span class="comment">// LATER 15-Aug-1991 mikeke</span>
01239     <span class="comment">// pointer passed as a word here</span>
01240 
01241     <span class="keywordflow">if</span> (fChild &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFNOPARENTNOTIFY) &amp;&amp;
01242             (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01243         <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(ptiCurrent, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, &amp;tlpwndParentT);
01244         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, WM_PARENTNOTIFY,
01245                 MAKELONG(WM_CREATE, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>)), (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd));
01246         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParentT);
01247     }
01248 
01249     <span class="comment">/*</span>
01250 <span class="comment">     * Show the Window</span>
01251 <span class="comment">     */</span>
01252     <span class="keywordflow">if</span> (style &amp; WS_VISIBLE) {
01253         <a class="code" href="../../d4/d1/userk_8h.html#a1607">xxxShowWindow</a>(pwnd, sw | <a class="code" href="../../d4/d1/userk_8h.html#a657">TEST_PUDF</a>(PUDF_ANIMATE));
01254     }
01255 
01256     <span class="comment">/*</span>
01257 <span class="comment">     * Try and set the application's hot key.  Use the Win95 logic of</span>
01258 <span class="comment">     * looking for the first tiled and/or APPWINDOW to be created by</span>
01259 <span class="comment">     * this process.</span>
01260 <span class="comment">     */</span>
01261     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a737">TestwndTiled</a>(pwnd) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFAPPWINDOW)) {
01262         <span class="keywordflow">if</span> (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o17">dwHotkey</a>) {
01263             <span class="comment">/*</span>
01264 <span class="comment">             * Ignore hot keys for WowExe the first thread of a wow process.</span>
01265 <span class="comment">             */</span>
01266             <span class="keywordflow">if</span> (!(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a796">TIF_16BIT</a>) || (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o9">cThreads</a> &gt; 1)) {
01267 <span class="preprocessor">#ifdef LATER</span>
01268 <span class="preprocessor"></span>                <span class="comment">/*</span>
01269 <span class="comment">                 * Win95 sets the hot key directly, we on the other hand send</span>
01270 <span class="comment">                 * a WM_SETHOTKEY message to the app.  Which is right?</span>
01271 <span class="comment">                 */</span>
01272                 <a class="code" href="../../d7/d7/winhtky_8c.html#a2">DWP_SetHotKey</a>(pwnd, ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o17">dwHotkey</a>);
01273 <span class="preprocessor">#else</span>
01274 <span class="preprocessor"></span>                <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_SETHOTKEY, ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o17">dwHotkey</a>, 0);
01275 <span class="preprocessor">#endif</span>
01276 <span class="preprocessor"></span>                ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o17">dwHotkey</a> = 0;
01277             }
01278         }
01279     }
01280 
01281     <span class="keywordflow">if</span> (fLockParent)
01282         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01283 
01284     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
01285 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="createw.c::xxxDestroyWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxDestroyWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">1591</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01738">tagCLS::atomClassName</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01297">tagSERVERINFO::atomSysClass</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02325">AW_SKIP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02324">AW_TRY</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01600">CFIME</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d6/winhtky_8c-source.html#l00096">DWP_SetHotKey()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03210">tagMENUSTATE::fModelessMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04727">GetpMenuState()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00219">ghwndSwitch</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00099">gpqForeground</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l02112">HMChangeOwnerThread()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01477">HMIsMarkDestroy</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01510">HMPheFromObject</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00362">ICLS_IME</a>, <a class="el" href="../../d4/d1/userk_8h.html#a2051">ImeCanDestroyDefIME()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a2053">ImeCanDestroyDefIMEforChild()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00591">IS_IME_ENABLED</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01266">IsHooked</a>, <a class="el" href="../../d9/d6/winloop2_8c-source.html#l00062">IsTrayWindow()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d5/d2/mnstate_8c-source.html#l00234">MNEndMenuStateNotify()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01843">tagWND::pcls</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03201">tagMENUSTATE::pGlobalPopupMenu</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l03719">PostShellHookMessages()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01513">PtoHq</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06584">PUDF_ANIMATE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l05237">SetVisible()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01764">tagWND::spmenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03111">tagQ::spwndActive</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03379">tagTHREADINFO::spwndDefaultIme</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03110">tagQ::spwndFocus</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01759">tagWND::spwndLastActive</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02863">tagPOPUPMENU::spwndNotify</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01747">tagWND::spwndOwner</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02585">SV_UNSET</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06608">TEST_PUDF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01609">TestCF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00365">ThreadLockAlwaysWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00364">ThreadLockWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02855">TIF_DISABLEHOOKS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03331">tagTHREADINFO::TIF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02826">TIF_INCLEANUP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02867">UnlinkWindow()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06464">WEF_USEPWNDTHREAD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02359">WEFNOPARENTNOTIFY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02421">WFCHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02304">WFDESTROYED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02288">WFHASPALETTE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02312">WFINDESTROY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02422">WFPOPUP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02037">WHF_CBT</a>, <a class="el" href="../../d4/d5/focusact_8c-source.html#l02060">xxxActivateWindow()</a>, <a class="el" href="../../d2/d1/hooks_8c-source.html#l01246">xxxCallHook()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01989">xxxDW_DestroyOwnedWindows()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02053">xxxDW_SendDestroyMessages()</a>, <a class="el" href="../../d3/d1/mnapi_8c-source.html#l00124">xxxEndMenu()</a>, <a class="el" href="../../d1/d2/palette_8c-source.html#l00220">xxxFlushPalette()</a>, <a class="el" href="../../d6/d7/ntimm_8c-source.html#l00405">xxxFocusSetInputContext()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l00299">xxxRedrawWindow()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l01468">xxxSetWindowPos()</a>, <a class="el" href="../../d1/d8/showwin_8c-source.html#l00085">xxxShowWindow()</a>, <a class="el" href="../../d6/d6/kernel_2winable_8c-source.html#l00274">xxxWindowEvent()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l06367">zzzAttachThreadInput()</a>, and <a class="el" href="../../d5/d4/caret_8c-source.html#l00189">zzzInternalDestroyCaret()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04115">NtUserDestroyWindow()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l13087">NtUserDisableThreadIme()</a>, <a class="el" href="../../d2/d2/tmswitch_8c-source.html#l01635">xxxCancelCoolSwitch()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01797">xxxCreateDesktop()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">xxxCreateWindowEx()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00114">xxxDesktopThread()</a>, <a class="el" href="../../d2/d3/ddemlsvr_8c-source.html#l00127">xxxDestroyThreadDDEObject()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01989">xxxDW_DestroyOwnedWindows()</a>, <a class="el" href="../../d3/d1/mnapi_8c-source.html#l00124">xxxEndMenu()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l03395">xxxMNCancel()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l02517">xxxMNCloseHierarchy()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l01934">xxxMNOpenHierarchy()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l03772">xxxProcessEventMessage()</a>, and <a class="el" href="../../d3/d2/mnpopup_8c-source.html#l00052">xxxTrackPopupMenuEx()</a>.
<p>
<pre class="fragment"><div>01593 {
01594     <a class="code" href="../../d4/d1/structtagMENUSTATE.html">PMENUSTATE</a>  pMenuState, pmnsEnd;
01595     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
01596     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>          tlpwnd;
01597     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndFocus;
01598     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndFocus;
01599     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndParent;
01600     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAlreadyDestroyed;
01601     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDisableHooks;
01602 
01603     dwDisableHooks = 0;
01604     <a class="code" href="../../d6/d0/usercli_8h.html#a38">ThreadLockWithPti</a>(pti, pwnd, &amp;tlpwnd);
01605 
01606     <span class="comment">/*</span>
01607 <span class="comment">     * First, if this handle has been marked for destruction, that means it</span>
01608 <span class="comment">     * is possible that the current thread is not its owner! (meaning we're</span>
01609 <span class="comment">     * being called from a handle unlock call).  In this case, set the owner</span>
01610 <span class="comment">     * to be the current thread so inter-thread send messages occur.</span>
01611 <span class="comment">     */</span>
01612     fAlreadyDestroyed = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a438">HMIsMarkDestroy</a>(pwnd);
01613     <span class="keywordflow">if</span> (fAlreadyDestroyed) {
01614         <span class="comment">/*</span>
01615 <span class="comment">         * UserAssert(dwInAtomicOperation &gt; 0);</span>
01616 <span class="comment">         * This Assert ensures that we are here only because of an unlock</span>
01617 <span class="comment">         * on a previously destroyed window.  We BEGIN/ENDATOMICHCHECK in</span>
01618 <span class="comment">         * HMDestroyUnlockedObject to ensure we don't leave the crit sect</span>
01619 <span class="comment">         * unexpectedly, which gives us dwInAtomicCheck &gt; 0.  We set</span>
01620 <span class="comment">         * TIF_DISABLEHOOKS to prevent a callback in Unlock</span>
01621 <span class="comment">         * However, it is currently possible destroy the same window handle</span>
01622 <span class="comment">         * twice, since we don't (yet) fail to revalidate zombie handles:</span>
01623 <span class="comment">         * GerardoB may change this, at which time we should probably restore</span>
01624 <span class="comment">         * this Assert, and test #76902 (close winmsd.exe) again. (preventing</span>
01625 <span class="comment">         * hooks in a second destroy of a zombie window should be OK) - IanJa</span>
01626 <span class="comment">         */</span>
01627         <span class="comment">// UserAssert(dwInAtomicOperation &gt; 0);</span>
01628 
01629         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a446">HMPheFromObject</a>(pwnd)-&gt;pOwner != pti) {
01630             UserAssert(<a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Tcb.Win32Thread);
01631             <a class="code" href="../../d4/d1/userk_8h.html#a980">HMChangeOwnerThread</a>(pwnd, pti);
01632         }
01633         dwDisableHooks = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a820">TIF_DISABLEHOOKS</a>;
01634         pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a820">TIF_DISABLEHOOKS</a>;
01635     } <span class="keywordflow">else</span> {
01636         <span class="comment">/*</span>
01637 <span class="comment">         * Ensure that we can destroy the window.  JIMA: no other process or thread</span>
01638 <span class="comment">         * should be able to destroy any other process or thread's window.</span>
01639 <span class="comment">         */</span>
01640         <span class="keywordflow">if</span> (pti != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)) {
01641             RIPERR0(ERROR_ACCESS_DENIED,
01642                     RIP_WARNING,
01643                     <span class="stringliteral">"Access denied in xxxDestroyWindow"</span>);
01644 
01645             <span class="keywordflow">goto</span> FalseReturn;
01646         }
01647     }
01648 
01649     <span class="comment">/*</span>
01650 <span class="comment">     * First ask the CBT hook if we can destroy this window.</span>
01651 <span class="comment">     * If this object has already been destroyed OR this thread is currently</span>
01652 <span class="comment">     * in cleanup mode, *do not* make any callbacks via hooks to the client</span>
01653 <span class="comment">     * process.</span>
01654 <span class="comment">     */</span>
01655     <span class="keywordflow">if</span> (!fAlreadyDestroyed &amp;&amp; !(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a795">TIF_INCLEANUP</a>) &amp;&amp;
01656             <a class="code" href="../../d6/d0/usercli_8h.html#a208">IsHooked</a>(pti, WHF_CBT)) {
01657         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1521">xxxCallHook</a>(HCBT_DESTROYWND, (WPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), 0, WH_CBT)) {
01658             <span class="keywordflow">goto</span> FalseReturn;
01659         }
01660     }
01661 
01662     <span class="comment">/*</span>
01663 <span class="comment">     * If the window we are destroying is in menu mode, end the menu</span>
01664 <span class="comment">     */</span>
01665     pMenuState = <a class="code" href="../../d4/d1/userk_8h.html#a1320">GetpMenuState</a>(pwnd);
01666     <span class="keywordflow">if</span> ((pMenuState != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01667             &amp;&amp; (pwnd == pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o0">pGlobalPopupMenu</a>-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o25">spwndNotify</a>)) {
01668 
01669         <a class="code" href="../../d4/d1/userk_8h.html#a1345">MNEndMenuStateNotify</a>(pMenuState);
01670         <span class="comment">/*</span>
01671 <span class="comment">         * Signal all states to end. The window(s) will be unlocked when</span>
01672 <span class="comment">         *  the menu exits; we cannot unlock it now because the menu</span>
01673 <span class="comment">         *  code could fault.</span>
01674 <span class="comment">         */</span>
01675         pmnsEnd = pMenuState;
01676         <span class="keywordflow">do</span> {
01677             UserAssert(pwnd == pMenuState-&gt;pGlobalPopupMenu-&gt;spwndNotify);
01678             pMenuState-&gt;fInsideMenuLoop = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01679             pMenuState = pMenuState-&gt;pmnsPrev;
01680         } <span class="keywordflow">while</span> (pMenuState != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ;
01681 
01682         <span class="comment">/*</span>
01683 <span class="comment">         * All states have been signaled to exit, so once we callback</span>
01684 <span class="comment">         *  we cannot count on pmnsEnd-&gt;pmnsPrev to be valid. Thus</span>
01685 <span class="comment">         *  we simply end the current menu here and let the others go</span>
01686 <span class="comment">         *  on their own. No state points to pwnd anymore so that</span>
01687 <span class="comment">         *  should be OK.</span>
01688 <span class="comment">         */</span>
01689         <span class="keywordflow">if</span> (!pmnsEnd-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o9">fModelessMenu</a>) {
01690             <a class="code" href="../../d4/d1/userk_8h.html#a1397">xxxEndMenu</a>(pmnsEnd);
01691         }
01692     }
01693 
01694     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a91">ghwndSwitch</a> == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd))
01695         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a91">ghwndSwitch</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01696 
01697     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD) &amp;&amp; (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01698 
01699         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFHASPALETTE)) {
01700             <a class="code" href="../../d4/d1/userk_8h.html#a1105">xxxFlushPalette</a>(pwnd);
01701         }
01702     }
01703 
01704     <span class="comment">/*</span>
01705 <span class="comment">     * Disassociate thread state if this is top level and owned by a different</span>
01706 <span class="comment">     * thread. This is done to begin with so these windows z-order together.</span>
01707 <span class="comment">     */</span>
01708     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> != <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a89">ICLS_IME</a>] &amp;&amp;
01709         !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd) &amp;&amp; pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
01710             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)) {
01711         <span class="comment">/*</span>
01712 <span class="comment">         * No need to zzzDeferWinEventNotify() - there is an xxx call just below</span>
01713 <span class="comment">         */</span>
01714         <a class="code" href="../../d4/d1/userk_8h.html#a1202">zzzAttachThreadInput</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>), FALSE);
01715     }
01716 
01717     <span class="comment">/*</span>
01718 <span class="comment">     * If we are a child window without the WS_NOPARENTNOTIFY style, send</span>
01719 <span class="comment">     * the appropriate notification message.</span>
01720 <span class="comment">     *</span>
01721 <span class="comment">     * NOTE: Although it would appear that we are illegally cramming a</span>
01722 <span class="comment">     * a WORD (WM_DESTROY) and a DWORD (pwnd-&gt;spmenu) into a single LONG</span>
01723 <span class="comment">     * (wParam) this isn't really the case because we first test if this</span>
01724 <span class="comment">     * is a child window.  The pMenu field in a child window is really</span>
01725 <span class="comment">     * the window's id and only the LOWORD is significant.</span>
01726 <span class="comment">     */</span>
01727     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFNOPARENTNOTIFY) &amp;&amp;
01728             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01729 
01730         <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(pti, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, &amp;tlpwndParent);
01731         <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, WM_PARENTNOTIFY,
01732                 MAKELONG(WM_DESTROY, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>)), (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd));
01733         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
01734     }
01735 
01736     <span class="comment">/*</span>
01737 <span class="comment">     * Mark this window as beginning the destroy process.  This is necessary</span>
01738 <span class="comment">     * to prevent window-management calls such as ShowWindow or SetWindowPos</span>
01739 <span class="comment">     * from coming in and changing the visible-state of the window</span>
01740 <span class="comment">     * once we hide it.  Otherwise, if the app attempts to make it</span>
01741 <span class="comment">     * visible, then we can get our vis-rgns screwed up once we truely</span>
01742 <span class="comment">     * destroy the window.</span>
01743 <span class="comment">     *</span>
01744 <span class="comment">     * Don't mark the mother desktop with this bit.  The xxxSetWindowPos()</span>
01745 <span class="comment">     * will fail for this window, and thus possibly cause an assertion</span>
01746 <span class="comment">     * in the xxxFreeWindow() call when we check for the visible-bit.</span>
01747 <span class="comment">     */</span>
01748     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> &amp;&amp; (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>))
01749         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFINDESTROY);
01750 
01751     <span class="comment">/*</span>
01752 <span class="comment">     * Hide the window.</span>
01753 <span class="comment">     */</span>
01754     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
01755         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD)) {
01756             <a class="code" href="../../d4/d1/userk_8h.html#a1607">xxxShowWindow</a>(pwnd, SW_HIDE | <a class="code" href="../../d4/d1/userk_8h.html#a657">TEST_PUDF</a>(PUDF_ANIMATE));
01757         } <span class="keywordflow">else</span> {
01758 
01759             <span class="comment">/*</span>
01760 <span class="comment">             * Hide this window without activating anyone else.</span>
01761 <span class="comment">             */</span>
01762             <a class="code" href="../../d4/d1/userk_8h.html#a1615">xxxSetWindowPos</a>(pwnd, NULL, 0, 0, 0, 0, SWP_HIDEWINDOW |
01763                     SWP_NOACTIVATE | SWP_NOMOVE | SWP_NOSIZE | SWP_NOZORDER |
01764                     (fAlreadyDestroyed ? SWP_DEFERDRAWING : 0));
01765         }
01766 
01767         <span class="comment">/*</span>
01768 <span class="comment">         * Under low memory conditions, the above attempt to hide could fail.</span>
01769 <span class="comment">         */</span>
01770         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE)) {
01771             RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxDestroyWindow: normal hide failed"</span>);
01772             <a class="code" href="../../d4/d1/userk_8h.html#a1626">SetVisible</a>(pwnd, SV_UNSET);
01773 
01774             <span class="comment">/*</span>
01775 <span class="comment">             * Invalidate windows below so they redraw properly.</span>
01776 <span class="comment">             */</span>
01777             <a class="code" href="../../d4/d1/userk_8h.html#a1679">xxxRedrawWindow</a>(NULL, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, NULL, RDW_INVALIDATE |
01778                     RDW_ERASE | RDW_ALLCHILDREN);
01779 
01780         }
01781     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/winloop2_8c.html#a2">IsTrayWindow</a>(pwnd)) {
01782         <a class="code" href="../../d4/d1/userk_8h.html#a1867">PostShellHookMessages</a>(HSHELL_WINDOWDESTROYED,
01783                               (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>( pwnd ));
01784     }
01785 
01786     <span class="comment">/*</span>
01787 <span class="comment">     * Destroy any owned windows.</span>
01788 <span class="comment">     */</span>
01789     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD)) {
01790         <a class="code" href="../../d4/d1/userk_8h.html#a1459">xxxDW_DestroyOwnedWindows</a>(pwnd);
01791 
01792         <span class="comment">/*</span>
01793 <span class="comment">         * And remove the window hot-key, if it has one</span>
01794 <span class="comment">         */</span>
01795         <a class="code" href="../../d7/d7/winhtky_8c.html#a2">DWP_SetHotKey</a>(pwnd, 0);
01796     }
01797 
01798     <span class="comment">/*</span>
01799 <span class="comment">     * If the window has already been destroyed, don't muck with</span>
01800 <span class="comment">     * activation because we may already be in the middle of</span>
01801 <span class="comment">     * an activation event.  Changing activation now may cause us</span>
01802 <span class="comment">     * to leave our critical section while holding the display lock.</span>
01803 <span class="comment">     * This will result in a deadlock if another thread gets the</span>
01804 <span class="comment">     * critical section before we do and attempts to lock the</span>
01805 <span class="comment">     * display.</span>
01806 <span class="comment">     */</span>
01807     <span class="keywordflow">if</span> (!fAlreadyDestroyed) {
01808         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndActivate = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01809         <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndActivate;
01810         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cmdActivate;
01811 
01812         <span class="comment">/*</span>
01813 <span class="comment">         * If hiding the active window, activate someone else.</span>
01814 <span class="comment">         * This call is strategically located after DestroyOwnedWindows() so we</span>
01815 <span class="comment">         * don't end up activating our owner window.</span>
01816 <span class="comment">         *</span>
01817 <span class="comment">         * If the window is a popup, try to activate his creator not the top</span>
01818 <span class="comment">         * window in the Z list.</span>
01819 <span class="comment">         */</span>
01820         <span class="keywordflow">if</span> (pwnd == pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>) {
01821             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFPOPUP) &amp;&amp; pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>) {
01822                 pwndActivate = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>;
01823                 cmdActivate = <a class="code" href="../../d4/d1/userk_8h.html#a251">AW_TRY</a>;
01824 
01825             } <span class="keywordflow">else</span> {
01826                 pwndActivate = pwnd;
01827                 cmdActivate = <a class="code" href="../../d4/d1/userk_8h.html#a252">AW_SKIP</a>;
01828             }
01829         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a> == pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>)) {
01830             pwndActivate = pwnd;
01831             cmdActivate = <a class="code" href="../../d4/d1/userk_8h.html#a252">AW_SKIP</a>;
01832         }
01833 
01834         <span class="keywordflow">if</span> (pwndActivate) {
01835             <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(pti, pwndActivate, &amp;tlpwndActivate);
01836 
01837             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1230">xxxActivateWindow</a>(pwndActivate, cmdActivate) ||
01838                     ((cmdActivate == <a class="code" href="../../d4/d1/userk_8h.html#a252">AW_SKIP</a>) &amp;&amp; (pwnd == pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>))) {
01839                 <span class="keywordflow">if</span> ((cmdActivate == <a class="code" href="../../d4/d1/userk_8h.html#a252">AW_SKIP</a>) || (pwnd == pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>)) {
01840                     <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>);
01841                     pwndFocus = <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>);
01842                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>() &amp;&amp; pwndFocus != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01843                         <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(pti, pwndFocus, &amp;tlpwndFocus);
01844                         <a class="code" href="../../d4/d1/userk_8h.html#a2036">xxxFocusSetInputContext</a>(pwndFocus, FALSE, FALSE);
01845                         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndFocus);
01846                     }
01847                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>() &amp;&amp; (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a> == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>)) {
01848                         <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_OBJECT_FOCUS, NULL, OBJID_CLIENT,
01849                                 INDEXID_CONTAINER, 0);
01850                         <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_SYSTEM_FOREGROUND, NULL, OBJID_WINDOW,
01851                                 INDEXID_CONTAINER, WEF_USEPWNDTHREAD);
01852                     }
01853                     <a class="code" href="../../d4/d5/caret_8c.html#a2">zzzInternalDestroyCaret</a>();
01854                 }
01855             }
01856 
01857             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndActivate);
01858         }
01859     }
01860 
01861     <span class="comment">/*</span>
01862 <span class="comment">     * fix last active popup</span>
01863 <span class="comment">     */</span>
01864     {
01865         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndOwner = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>;
01866 
01867         <span class="keywordflow">if</span> (pwndOwner != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01868             <span class="keywordflow">while</span> (pwndOwner-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01869                 pwndOwner = pwndOwner-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>;
01870             }
01871 
01872             <span class="keywordflow">if</span> (pwnd == pwndOwner-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o12">spwndLastActive</a>) {
01873                 <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pwndOwner-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o12">spwndLastActive</a>), pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>);
01874             }
01875         }
01876     }
01877 
01878     <span class="keywordflow">if</span> (!fAlreadyDestroyed) {
01879     <span class="comment">/*</span>
01880 <span class="comment">     * Note we do this BEFORE telling the app the window is dying.  Note also</span>
01881 <span class="comment">     * that we do NOT loop through the children generating DESTROY events.</span>
01882 <span class="comment">     * DESTROY of a parent implies DESTROY of all children (see #71846 - IanJa)</span>
01883 <span class="comment">     */</span>
01884         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>() &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFDESTROYED)) {
01885             <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_OBJECT_DESTROY, pwnd, OBJID_WINDOW, INDEXID_CONTAINER, 0);
01886         }
01887 
01888     <span class="comment">/*</span>
01889 <span class="comment">     * Send destroy messages before the WindowLockStart in case</span>
01890 <span class="comment">     * he tries to destroy windows as a result.</span>
01891 <span class="comment">     */</span>
01892         <a class="code" href="../../d4/d1/userk_8h.html#a1460">xxxDW_SendDestroyMessages</a>(pwnd);
01893     }
01894 
01895     <span class="comment">/*</span>
01896 <span class="comment">     * Check the owner of IME window again.</span>
01897 <span class="comment">     * If thread is destroying, don't bother to check.</span>
01898 <span class="comment">     */</span>
01899     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>() &amp;&amp; !(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a795">TIF_INCLEANUP</a>) &amp;&amp;
01900             pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
01901             !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a485">TestCF</a>(pwnd, CFIME) &amp;&amp;
01902             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> != <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a89">ICLS_IME</a>]) {
01903 
01904         <span class="keywordflow">if</span> (fAlreadyDestroyed) {
01905             RIPMSG2(RIP_VERBOSE, <span class="stringliteral">"xxxDestroyWindow: in final destruction of %#p, ime=%#p"</span>,
01906                     pwnd, pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>);
01907         } <span class="keywordflow">else</span> {
01908             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD)) {
01909                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a2051">ImeCanDestroyDefIME</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>, pwnd)) {
01910                     TAGMSG1(DBGTAG_IMM, <span class="stringliteral">"xxxDestroyWindow: destroying (1) the default IME window=%p"</span>, pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>);
01911                     <a class="code" href="../../d4/d1/userk_8h.html#a1575">xxxDestroyWindow</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>);
01912                 }
01913             }
01914             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01915                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a2053">ImeCanDestroyDefIMEforChild</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>, pwnd)) {
01916                     TAGMSG1(DBGTAG_IMM, <span class="stringliteral">"xxxDestroyWindow: destroying (2) the default IME window=%p"</span>, pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>);
01917                     <a class="code" href="../../d4/d1/userk_8h.html#a1575">xxxDestroyWindow</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>);
01918                 }
01919             }
01920         }
01921     }
01922 
01923     <span class="keywordflow">if</span> ((pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; !fAlreadyDestroyed) {
01924 
01925         <span class="comment">/*</span>
01926 <span class="comment">         * TestwndChild() on checks to WFCHILD bit.  Make sure this</span>
01927 <span class="comment">         * window wasn't SetParent()'ed to the desktop as well.</span>
01928 <span class="comment">         */</span>
01929         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd) &amp;&amp; (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd)) &amp;&amp;
01930                 (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>))) {
01931             <span class="comment">/*</span>
01932 <span class="comment">             * pwnd is threadlocked, so no need to DeferWinEventNotify()</span>
01933 <span class="comment">             */</span>
01934             <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01935             <a class="code" href="../../d4/d1/userk_8h.html#a1202">zzzAttachThreadInput</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>), FALSE);
01936         }
01937 
01938         <a class="code" href="../../d4/d1/userk_8h.html#a1458">UnlinkWindow</a>(pwnd, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>);
01939     }
01940 
01941     <span class="comment">/*</span>
01942 <span class="comment">     * This in intended to check for a case where we destroy the window,</span>
01943 <span class="comment">     * but it's still listed as the active-window in the queue.  This</span>
01944 <span class="comment">     * could cause problems in window-activation (see xxxActivateThisWindow)</span>
01945 <span class="comment">     * where we attempt to activate another window and in the process, try</span>
01946 <span class="comment">     * to deactivate this window (bad).</span>
01947 <span class="comment">     */</span>
01948 <span class="preprocessor">#if DBG</span>
01949 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (pwnd == pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>) {
01950         RIPMSG1(RIP_WARNING, <span class="stringliteral">"xxxDestroyWindow: pwnd == pti-&gt;pq-&gt;spwndActive (%#p)"</span>, pwnd);
01951     }
01952 <span class="preprocessor">#endif</span>
01953 <span class="preprocessor"></span>
01954     <span class="comment">/*</span>
01955 <span class="comment">     * Set the state as destroyed so any z-ordering events will be ignored.</span>
01956 <span class="comment">     * We cannot NULL out the owner field until WM_NCDESTROY is send or</span>
01957 <span class="comment">     * apps like Rumba fault  (they call GetParent after every message)</span>
01958 <span class="comment">     */</span>
01959     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFDESTROYED);
01960 
01961     <span class="comment">/*</span>
01962 <span class="comment">     * FreeWindow performs a ThreadUnlock.</span>
01963 <span class="comment">     */</span>
01964 
01965     <a class="code" href="../../d4/d1/userk_8h.html#a1461">xxxFreeWindow</a>(pwnd, &amp;tlpwnd);
01966 
01967     <span class="keywordflow">if</span> (fAlreadyDestroyed) {
01968         pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> = (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a820">TIF_DISABLEHOOKS</a>) | dwDisableHooks;
01969     }
01970     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01971 
01972 FalseReturn:
01973     <span class="keywordflow">if</span> (fAlreadyDestroyed) {
01974         pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> = (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a820">TIF_DISABLEHOOKS</a>) | dwDisableHooks;
01975     }
01976     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
01977     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01978 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="createw.c::xxxDW_DestroyOwnedWindows" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDW_DestroyOwnedWindows           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwndParent</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l01989">1989</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00591">IS_IME_ENABLED</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01744">tagWND::spwndNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01747">tagWND::spwndOwner</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02826">TIF_INCLEANUP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, and <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">xxxDestroyWindow()</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">xxxDestroyWindow()</a>.
<p>
<pre class="fragment"><div>01991 {
01992     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, pwndDesktop;
01993     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdeskParent;
01994     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDefaultIme = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndParent)-&gt;spwndDefaultIme;
01995 
01996     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndParent);
01997 
01998     <span class="keywordflow">if</span> ((pdeskParent = pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01999         <span class="keywordflow">return</span>;
02000     pwndDesktop = pdeskParent-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>;
02001 
02002     <span class="comment">/*</span>
02003 <span class="comment">     * During shutdown, the desktop owner window will be</span>
02004 <span class="comment">     * destroyed.  In this case, pwndDesktop will be NULL.</span>
02005 <span class="comment">     */</span>
02006     <span class="keywordflow">if</span> (pwndDesktop == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02007         <span class="keywordflow">return</span>;
02008 
02009     pwnd = pwndDesktop-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>;
02010 
02011     <span class="keywordflow">while</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02012         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> == pwndParent) {
02013             <span class="comment">/*</span>
02014 <span class="comment">             * We don't destroy the IME window here</span>
02015 <span class="comment">             * unless the thread is doing cleanup.</span>
02016 <span class="comment">             */</span>
02017             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>() &amp;&amp; !(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndParent)-&gt;TIF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a795">TIF_INCLEANUP</a>) &amp;&amp;
02018                     pwnd == pwndDefaultIme) {
02019                 <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>);
02020                 pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
02021                 <span class="keywordflow">continue</span>;
02022             }
02023 
02024             <span class="comment">/*</span>
02025 <span class="comment">             * If the window doesn't get destroyed, set its owner to NULL.</span>
02026 <span class="comment">             * A good example of this is trying to destroy a window created</span>
02027 <span class="comment">             * by another thread or process, but there are other cases.</span>
02028 <span class="comment">             */</span>
02029             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1575">xxxDestroyWindow</a>(pwnd)) {
02030                 <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>);
02031             }
02032 
02033             <span class="comment">/*</span>
02034 <span class="comment">             * Start the search over from the beginning since the app could</span>
02035 <span class="comment">             * have caused other windows to be created or activation/z-order</span>
02036 <span class="comment">             * changes.</span>
02037 <span class="comment">             */</span>
02038             pwnd = pwndDesktop-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>;
02039         } <span class="keywordflow">else</span> {
02040             pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
02041         }
02042     }
02043 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="createw.c::xxxDW_SendDestroyMessages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDW_SendDestroyMessages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l02053">2053</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d9/d7/winsta_8c-source.html#l01240">_GetProcessWindowStation()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d9/d7/ntuser_2kernel_2clipbrd_8c-source.html#l02687">DisownClipboard()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02728">tagWINDOWSTATION::spwndClipOwner</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01744">tagWND::spwndNext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d4/d5/focusact_8c-source.html#l02549">xxxCheckFocus()</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">xxxDestroyWindow()</a>.
<p>
<pre class="fragment"><div>02055 {
02056     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndChild;
02057     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndNext;
02058     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndNext;
02059     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndChild;
02060     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta;
02061 
02062     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
02063 
02064     <span class="comment">/*</span>
02065 <span class="comment">     * Be sure the window gets any resulting messages before being destroyed.</span>
02066 <span class="comment">     */</span>
02067     <a class="code" href="../../d4/d1/userk_8h.html#a1506">xxxCheckFocus</a>(pwnd);
02068 
02069     pwinsta = <a class="code" href="../../d8/d8/winsta_8c.html#a11">_GetProcessWindowStation</a>(NULL);
02070     <span class="keywordflow">if</span> (pwinsta != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; pwnd == pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o9">spwndClipOwner</a>) {
02071         <span class="comment">/*</span>
02072 <span class="comment">         * Pass along the pwnd which is the reason we are dis'ing the clipboard.</span>
02073 <span class="comment">         * We want to later make sure the owner is still this window after we make callbacks</span>
02074 <span class="comment">         * and clear the owner</span>
02075 <span class="comment">         */</span>
02076         <a class="code" href="../../d4/d1/userk_8h.html#a1497">DisownClipboard</a>(pwnd);
02077     }
02078 
02079     <span class="comment">/*</span>
02080 <span class="comment">     * Send the WM_DESTROY message.</span>
02081 <span class="comment">     */</span>
02082 <span class="preprocessor">#if _DBG</span>
02083 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;spwndDefaultIme) {
02084         TAGMSG2(DBGTAG_IMM, <span class="stringliteral">"xxxDW_SendDestroyMessages: sending WM_DESTROY message to def IME=%p, pti=%p"</span>, pwnd, <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>());
02085     }
02086 <span class="preprocessor">#endif</span>
02087 <span class="preprocessor"></span>    <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_DESTROY, 0L, 0L);
02088 
02089     <span class="comment">/*</span>
02090 <span class="comment">     * Now send destroy message to all children of pwnd.</span>
02091 <span class="comment">     * Enumerate down (pwnd-&gt;spwndChild) and sideways (pwnd-&gt;spwndNext).</span>
02092 <span class="comment">     * We do it this way because parents often assume that child windows still</span>
02093 <span class="comment">     * exist during WM_DESTROY message processing.</span>
02094 <span class="comment">     */</span>
02095     pwndChild = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>;
02096 
02097     <span class="keywordflow">while</span> (pwndChild != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02098 
02099         pwndNext = pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
02100 
02101         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndNext, &amp;tlpwndNext);
02102 
02103         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndChild, &amp;tlpwndChild);
02104         <a class="code" href="../../d4/d1/userk_8h.html#a1460">xxxDW_SendDestroyMessages</a>(pwndChild);
02105         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndChild);
02106         pwndChild = pwndNext;
02107 
02108         <span class="comment">/*</span>
02109 <span class="comment">         * The unlock may nuke the next window.  If so, get out.</span>
02110 <span class="comment">         */</span>
02111         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndNext))
02112             <span class="keywordflow">break</span>;
02113     }
02114 
02115     <a class="code" href="../../d4/d1/userk_8h.html#a1506">xxxCheckFocus</a>(pwnd);
02116 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="createw.c::xxxFreeWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxFreeWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d1/struct__TL.html">PTL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ptlpwndFree</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">2218</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d5/d4/rare_8c-source.html#l03655">_DeregisterShellHookWindow()</a>, <a class="el" href="../../d8/d1/mndstry_8c-source.html#l00027">_DestroyMenu()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l01240">_GetProcessWindowStation()</a>, <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d0/d1/mmrtl_8c-source.html#l00426">_MonitorFromWindow()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l01109">_PostQuitMessage()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01312">tagSERVERINFO::atomIconProp</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01297">tagSERVERINFO::atomSysClass</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00435">_LARGE_UNICODE_STRING::Buffer</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02257">CallClientWorkerProc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01593">CFCLASSDC</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01592">CFOWNDC</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00057">ClearHungFlag()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l02400">ClearSendMessages()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06150">tagDDEIMP::cRefConv</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06149">tagDDEIMP::cRefInit</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03390">tagTHREADINFO::cWindows</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01662">tagCLS::cWndReferenceCount</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03601">DCE_FREED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03602">DCE_NORELEASE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03600">DCE_RELEASED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03592">tagDCE::DCX_flags</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l01272">DecPaintCount()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00549">DeleteHrgnClip()</a>, <a class="el" href="../../d0/d2/paint_8c-source.html#l00132">DeleteMaybeSpecialRgn()</a>, <a class="el" href="../../d5/d7/kernel_2winprop_8c-source.html#l00265">DeleteProperties()</a>, <a class="el" href="../../d3/d6/class_8c-source.html#l01735">DereferenceClass()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02697">DesktopFree</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01638">DestroyCacheDC()</a>, <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00093">DestroyWindowsHotKeys()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l01067">DestroyWindowSmIcon()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00504">DestroyWindowsTimers()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02588">DF_MOUSEMOVETRK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02582">DF_TOOLTIPSHOWING</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l03336">FindQMsg()</a>, <a class="el" href="../../d2/d3/spb_8c-source.html#l00965">FindSpb()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00840">FNID</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00836">FNID_CLEANEDUP_BIT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00803">FNID_CONTROLEND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00837">FNID_DELETED_BIT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00787">FNID_DESKTOP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00897">FNID_TO_CLIENT_PFNWORKER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00790">FNID_WNDPROCEND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00782">FNID_WNDPROCSTART</a>, <a class="el" href="../../d2/d3/spb_8c-source.html#l01171">FreeSpb()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00226">gcountPWO</a>, <a class="el" href="../../d3/d6/class_8c-source.html#l01036">GetClassPtr()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01548">GETPDESK</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00090">gptiLockUpdate</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00216">gspwndActivate</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00253">gspwndCursor</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00217">gspwndLockUpdate</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00218">gspwndMouseOwner</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01430">HANDLEF_INDESTROY</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03586">tagDCE::hdc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l02112">HMChangeOwnerThread()</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l01069">HMFreeObject()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01477">HMIsMarkDestroy</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l01237">HMMarkObjectDestroy()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00734">hModuleWin</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01510">HMPheFromObject</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03589">tagDCE::hrgnClip</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01768">tagWND::hrgnClip</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01757">tagWND::hrgnUpdate</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00352">ICLS_ICONTITLE</a>, <a class="el" href="../../d5/d7/kernel_2winprop_8c-source.html#l00098">InternalRemoveProp()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00591">IS_IME_ENABLED</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00463">_LARGE_UNICODE_STRING::Length</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01841">tagWND::lpfnWndProc</a>, <a class="el" href="../../d7/d0/userrtl_8h-source.html#l00022">MAKEINTATOM</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05695">MarkDCEInvalid()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03383">tagTHREADINFO::mlPost</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02979">tagQMSG::msg</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01774">NEEDSPAINT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02402">NEEDSSYNCPAINT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01843">tagWND::pcls</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02197">tagDISPLAYINFO::pdceFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03585">tagDCE::pdceNext</a>, <a class="el" href="../../d4/d1/userk_8h.html#a930">PDDECONV</a>, <a class="el" href="../../d4/d1/userk_8h.html#a928">PDDEIMP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03319">tagTHREADINFO::ppi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00084">PpiCurrent</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01847">tagWND::ppropList</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03088">tagMLIST::pqmsgRead</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03895">PROP_DDEIMP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03893">PROP_DDETRACK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03896">PROP_WNDOBJ</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01722">PROPF_INTERNAL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01848">tagWND::pSBInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02724">tagWINDOWSTATION::ptiClipLock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00049">PTL</a>, <a class="el" href="../../d4/d1/userk_8h.html#a957">PTOOLTIPWND</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03588">tagDCE::pwndClip</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03587">tagDCE::pwndOrg</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01337">ReleaseCacheDC()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01764">tagWND::spmenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01763">tagWND::spmenuSys</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03112">tagQ::spwndActivePrev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03109">tagQ::spwndCapture</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02726">tagWINDOWSTATION::spwndClipOpen</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02727">tagWINDOWSTATION::spwndClipViewer</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03379">tagTHREADINFO::spwndDefaultIme</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03110">tagQ::spwndFocus</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01759">tagWND::spwndLastActive</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01747">tagWND::spwndOwner</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01855">tagWND::strName</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01609">TestCF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00365">ThreadLockAlwaysWithPti</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01652">ThreadLockDesktop</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01664">ThreadUnlockDesktop</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03331">tagTHREADINFO::TIF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02826">TIF_INCLEANUP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02192">UnlockNotifyWindow()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00458">UnlockWndMenu()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00417">UnsetLayeredWindow()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02509">WEFLAYERED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02288">WFHASPALETTE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02268">WFHASSPB</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02312">WFINDESTROY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02273">WFINTERNALPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02323">WFMAXFAKEREGIONAL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02266">WFMSGBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02299">WFREDRAWFRAMEIFHUNG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02298">WFREDRAWIFHUNG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02270">WFSENDERASEBKGND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02272">WFSENDNCPAINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02285">WFSERVERSIDEPROC</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02383">WFSHELLHOOKWND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02414">WFTILED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02423">WFTYPEMASK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d6/d3/kernel_2ddetrack_8c-source.html#l00768">xxxDDETrackWindowDying()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02126">xxxFW_DestroyAllChildren()</a>, <a class="el" href="../../d4/d4/w32_2ntuser_2kernel_2capture_8c-source.html#l00078">xxxReleaseCapture()</a>, <a class="el" href="../../d9/d6/winloop2_8c-source.html#l00205">xxxRemoveFullScreen()</a>, <a class="el" href="../../d2/d3/tooltips_8c-source.html#l00453">xxxResetTooltip()</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">xxxCreateWindowEx()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">xxxDestroyWindow()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02126">xxxFW_DestroyAllChildren()</a>, and <a class="el" href="../../d7/d2/queue_8c-source.html#l03772">xxxProcessEventMessage()</a>.
<p>
<pre class="fragment"><div>02221 {
02222     <a class="code" href="../../d3/d2/structtagDCE.html">PDCE</a>           *ppdce;
02223     <a class="code" href="../../d3/d2/structtagDCE.html">PDCE</a>           pdce;
02224     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>           uDCERelease;
02225     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>          pmenu;
02226     <a class="code" href="../../d8/d4/structtagQMSG.html">PQMSG</a>          pqmsg;
02227     <a class="code" href="../../d7/d0/structtagCLS.html">PPCLS</a>          ppcls;
02228     WORD           fnid;
02229     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>             tlpdesk;
02230     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta = <a class="code" href="../../d8/d8/winsta_8c.html#a11">_GetProcessWindowStation</a>(NULL);
02231     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>    pti  = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
02232     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a>   ppi;
02233     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>       pMonitor;
02234     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>             tlpMonitor;
02235 
02236     UNREFERENCED_PARAMETER(ptlpwndFree);
02237 
02238     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
02239 
02240     <span class="comment">/*</span>
02241 <span class="comment">     * If the pwnd is any of the global shell-related windows,</span>
02242 <span class="comment">     * then we need to unlock them from the deskinfo.</span>
02243 <span class="comment">     */</span>
02244     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02245         <span class="keywordflow">if</span> (pwnd == pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndShell)
02246             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndShell);
02247         <span class="keywordflow">if</span> (pwnd == pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndBkGnd)
02248             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndBkGnd);
02249         <span class="keywordflow">if</span> (pwnd == pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndTaskman)
02250             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndTaskman);
02251         <span class="keywordflow">if</span> (pwnd == pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndProgman)
02252             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndProgman);
02253         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd,WFSHELLHOOKWND)) {
02254             <a class="code" href="../../d4/d1/userk_8h.html#a1865">_DeregisterShellHookWindow</a>(pwnd);
02255         }
02256 
02257         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMSGBOX)) {
02258             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;cntMBox--;
02259             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFMSGBOX);
02260         }
02261     }
02262 
02263     <span class="comment">/*</span>
02264 <span class="comment">     * First, if this handle has been marked for destruction, that means it</span>
02265 <span class="comment">     * is possible that the current thread is not its owner! (meaning we're</span>
02266 <span class="comment">     * being called from a handle unlock call).  In this case, set the owner</span>
02267 <span class="comment">     * to be the current thread so inter-thread send messages don't occur.</span>
02268 <span class="comment">     */</span>
02269     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a438">HMIsMarkDestroy</a>(pwnd))
02270         <a class="code" href="../../d4/d1/userk_8h.html#a980">HMChangeOwnerThread</a>(pwnd, pti);
02271 
02272     <span class="comment">/*</span>
02273 <span class="comment">     * Blow away the children.</span>
02274 <span class="comment">     *</span>
02275 <span class="comment">     * DestroyAllChildren() will still destroy windows created by other</span>
02276 <span class="comment">     * threads! This needs to be looked at more closely: the ultimate</span>
02277 <span class="comment">     * "right" thing to do is not to destroy these windows but just</span>
02278 <span class="comment">     * unlink them.</span>
02279 <span class="comment">     */</span>
02280     <a class="code" href="../../d4/d1/userk_8h.html#a1462">xxxFW_DestroyAllChildren</a>(pwnd);
02281     <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_NCDESTROY, 0, 0L);
02282 
02283     pMonitor = <a class="code" href="../../d9/d1/mmrtl_8c.html#a8">_MonitorFromWindow</a>(pwnd, MONITOR_DEFAULTTOPRIMARY);
02284     <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(pti, pMonitor, &amp;tlpMonitor);
02285     <a class="code" href="../../d8/d7/winloop2_8c.html#a5">xxxRemoveFullScreen</a>(pwnd, pMonitor);
02286     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpMonitor);
02287 
02288     <span class="comment">/*</span>
02289 <span class="comment">     * If this is one of the built in controls which hasn't been cleaned</span>
02290 <span class="comment">     * up yet, do it now. If it lives in the kernel, call the function</span>
02291 <span class="comment">     * directly, otherwise call back to the client. Even if the control</span>
02292 <span class="comment">     * is sub- or super-classed, use the window procs associated with</span>
02293 <span class="comment">     * the function id.</span>
02294 <span class="comment">     */</span>
02295     fnid = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd);
02296     <span class="keywordflow">if</span> ((fnid &gt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a192">FNID_WNDPROCSTART</a>) &amp;&amp; !(pwnd-&gt;fnid &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a226">FNID_CLEANEDUP_BIT</a>)) {
02297 
02298        <span class="keywordflow">if</span> (fnid &lt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a198">FNID_WNDPROCEND</a>) {
02299 
02300            <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a229">FNID</a>(fnid)(pwnd, WM_FINALDESTROY, 0, 0, 0);
02301 
02302        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fnid &lt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a209">FNID_CONTROLEND</a> &amp;&amp; !(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a795">TIF_INCLEANUP</a>)) {
02303 
02304            <a class="code" href="../../d4/d1/userk_8h.html#a244">CallClientWorkerProc</a>(pwnd,
02305                                     WM_FINALDESTROY,
02306                                     0,
02307                                     0,
02308                                     (PROC)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a235">FNID_TO_CLIENT_PFNWORKER</a>(fnid));
02309        }
02310 
02311        pwnd-&gt;fnid |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a226">FNID_CLEANEDUP_BIT</a>;
02312     }
02313 
02314     pwnd-&gt;fnid |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a227">FNID_DELETED_BIT</a>;
02315 
02316     <span class="comment">/*</span>
02317 <span class="comment">     * Check to clear the most recently active window in owned list.</span>
02318 <span class="comment">     */</span>
02319     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> &amp;&amp; (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o12">spwndLastActive</a> == pwnd)) {
02320         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o12">spwndLastActive</a>), pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>);
02321     }
02322 
02323     <span class="comment">/*</span>
02324 <span class="comment">     * The windowstation may be NULL if we are destroying a desktop</span>
02325 <span class="comment">     * or windowstation.  If this is the case, this thread will not</span>
02326 <span class="comment">     * be using the clipboard.</span>
02327 <span class="comment">     */</span>
02328     <span class="keywordflow">if</span> (pwinsta != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02329 
02330         <span class="keywordflow">if</span> (pwnd == pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o7">spwndClipOpen</a>) {
02331             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o7">spwndClipOpen</a>);
02332             pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o5">ptiClipLock</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02333         }
02334 
02335         <span class="keywordflow">if</span> (pwnd == pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o8">spwndClipViewer</a>) {
02336             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o8">spwndClipViewer</a>);
02337         }
02338     }
02339 
02340     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>() &amp;&amp; pwnd == pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>)
02341         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>);
02342 
02343     <span class="keywordflow">if</span> (pwnd == pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>)
02344         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>);
02345 
02346     <span class="keywordflow">if</span> (pwnd == pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o9">spwndActivePrev</a>)
02347         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o9">spwndActivePrev</a>);
02348 
02349     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a88">gspwndActivate</a>)
02350         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;gspwndActivate);
02351 
02352     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02353 
02354         <span class="keywordflow">if</span> (pwnd == pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spwndForeground)
02355             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spwndForeground);
02356 
02357         <span class="keywordflow">if</span> (pwnd == pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spwndTray)
02358             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spwndTray);
02359 
02360         <span class="keywordflow">if</span> (pwnd == pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spwndTrack) {
02361             <span class="comment">/*</span>
02362 <span class="comment">             * Remove tooltip, if any</span>
02363 <span class="comment">             */</span>
02364             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a456">GETPDESK</a>(pwnd)-&gt;dwDTFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a289">DF_TOOLTIPSHOWING</a>) {
02365                 <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndTooltip = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a456">GETPDESK</a>(pwnd)-&gt;spwndTooltip;
02366                 <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndTooltip;
02367 
02368                 <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndTooltip, &amp;tlpwndTooltip);
02369                 <a class="code" href="../../d4/d1/userk_8h.html#a1973">xxxResetTooltip</a>((<a class="code" href="../../d8/d8/structtagTOOLTIPWND.html">PTOOLTIPWND</a>)pwndTooltip);
02370                 <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndTooltip);
02371             }
02372 
02373             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spwndTrack);
02374             pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;dwDTFlags &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a295">DF_MOUSEMOVETRK</a>;
02375         }
02376     }
02377 
02378     <span class="keywordflow">if</span> (pwnd == pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o6">spwndCapture</a>)
02379         <a class="code" href="../../d4/d1/userk_8h.html#a1713">xxxReleaseCapture</a>();
02380 
02381     <span class="comment">/*</span>
02382 <span class="comment">     * This window won't be needing any more input.</span>
02383 <span class="comment">     */</span>
02384     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a90">gspwndMouseOwner</a>)
02385         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;gspwndMouseOwner);
02386 
02387     <span class="comment">/*</span>
02388 <span class="comment">     * It also won't have any mouse cursors over it.</span>
02389 <span class="comment">     */</span>
02390     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a108">gspwndCursor</a>)
02391         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;gspwndCursor);
02392 
02393     <a class="code" href="../../d4/d1/userk_8h.html#a1479">DestroyWindowsTimers</a>(pwnd);
02394     <a class="code" href="../../d4/d1/userk_8h.html#a1550">DestroyWindowsHotKeys</a>(pwnd);
02395 
02396     <span class="comment">/*</span>
02397 <span class="comment">     * Make sure this window has no pending sent messages.</span>
02398 <span class="comment">     */</span>
02399     <a class="code" href="../../d4/d1/userk_8h.html#a1151">ClearSendMessages</a>(pwnd);
02400 
02401     <span class="comment">/*</span>
02402 <span class="comment">     * Remove the associated GDI sprite.</span>
02403 <span class="comment">     */</span>
02404     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYERED)) {
02405         <a class="code" href="../../d4/d1/userk_8h.html#a1984">UnsetLayeredWindow</a>(pwnd);
02406     }
02407 
02408 <span class="preprocessor">#ifdef REDIRECTION</span>
02409 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFREDIRECTED)) {
02410         UnsetRedirectedWindow(pwnd);
02411     }
02412 <span class="preprocessor">#endif // REDIRECTION</span>
02413 <span class="preprocessor"></span>
02414     <span class="comment">/*</span>
02415 <span class="comment">     * Blow away any update region lying around.</span>
02416 <span class="comment">     */</span>
02417     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a501">NEEDSPAINT</a>(pwnd)) {
02418 
02419         <a class="code" href="../../d4/d1/userk_8h.html#a1470">DecPaintCount</a>(pwnd);
02420 
02421         <a class="code" href="../../d4/d1/userk_8h.html#a1003">DeleteMaybeSpecialRgn</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a>);
02422         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02423         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFINTERNALPAINT);
02424     }
02425 
02426     <span class="comment">/*</span>
02427 <span class="comment">     * Decrememt queue's syncpaint count if necessary.</span>
02428 <span class="comment">     */</span>
02429     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a267">NEEDSSYNCPAINT</a>(pwnd)) {
02430         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSENDNCPAINT);
02431         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSENDERASEBKGND);
02432     }
02433 
02434     <span class="comment">/*</span>
02435 <span class="comment">     * Clear both flags to ensure that the window is removed</span>
02436 <span class="comment">     * from the hung redraw list.</span>
02437 <span class="comment">     */</span>
02438     <a class="code" href="../../d4/d1/userk_8h.html#a1126">ClearHungFlag</a>(pwnd, WFREDRAWIFHUNG);
02439     <a class="code" href="../../d4/d1/userk_8h.html#a1126">ClearHungFlag</a>(pwnd, WFREDRAWFRAMEIFHUNG);
02440 
02441     <span class="comment">/*</span>
02442 <span class="comment">     * If there is a WM_QUIT message in this app's message queue, call</span>
02443 <span class="comment">     * PostQuitMessage() (this happens if the app posts itself a quit message.</span>
02444 <span class="comment">     * WinEdit2.0 posts a quit to a window while receiving the WM_DESTROY</span>
02445 <span class="comment">     * for that window - it works because we need to do a PostQuitMessage()</span>
02446 <span class="comment">     * automatically for this thread.</span>
02447 <span class="comment">     */</span>
02448     <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02449 
02450         <span class="comment">/*</span>
02451 <span class="comment">         * try to get rid of WM_DDE_ACK too.</span>
02452 <span class="comment">         */</span>
02453         <span class="keywordflow">if</span> ((pqmsg = <a class="code" href="../../d4/d1/userk_8h.html#a1826">FindQMsg</a>(pti,
02454                               &amp;(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>),
02455                               pwnd,
02456                               WM_QUIT,
02457                               WM_QUIT, TRUE)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02458 
02459             <a class="code" href="../../d4/d1/userk_8h.html#a1644">_PostQuitMessage</a>((<span class="keywordtype">int</span>)pqmsg-&gt;<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.wParam);
02460         }
02461     }
02462 
02463     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd) &amp;&amp; pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02464         pmenu = (<a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>;
02465         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1363">UnlockWndMenu</a>(pwnd, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>))
02466             <a class="code" href="../../d4/d1/userk_8h.html#a1887">_DestroyMenu</a>(pmenu);
02467     }
02468 
02469     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02470         pmenu = (<a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>;
02471         <span class="keywordflow">if</span> (pmenu != pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spmenuDialogSys) {
02472             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1363">UnlockWndMenu</a>(pwnd, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>)) {
02473                 <a class="code" href="../../d4/d1/userk_8h.html#a1887">_DestroyMenu</a>(pmenu);
02474             }
02475         } <span class="keywordflow">else</span> {
02476             <a class="code" href="../../d4/d1/userk_8h.html#a1363">UnlockWndMenu</a>(pwnd, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>);
02477         }
02478     }
02479 
02480     <span class="comment">/*</span>
02481 <span class="comment">     * If it was using either of the desktop system menus, unlock it</span>
02482 <span class="comment">     */</span>
02483     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02484         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spmenuSys != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
02485                 pwnd == pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spmenuSys-&gt;spwndNotify) {
02486 
02487             <a class="code" href="../../d4/d8/createw_8c.html#a9">UnlockNotifyWindow</a>(pwnd-&gt;head.rpdesk-&gt;spmenuSys);
02488         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pwnd-&gt;head.rpdesk-&gt;spmenuDialogSys != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
02489                 pwnd == pwnd-&gt;head.rpdesk-&gt;spmenuDialogSys-&gt;spwndNotify) {
02490 
02491             <a class="code" href="../../d4/d8/createw_8c.html#a9">UnlockNotifyWindow</a>(pwnd-&gt;head.rpdesk-&gt;spmenuDialogSys);
02492         }
02493 
02494     }
02495 
02496 
02497     <span class="comment">/*</span>
02498 <span class="comment">     * Tell Gdi that the window is going away.</span>
02499 <span class="comment">     */</span>
02500     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a95">gcountPWO</a> != 0) {
02501         PVOID pwo = <a class="code" href="../../d4/d8/kernel_2winprop_8c.html#a1">InternalRemoveProp</a>(pwnd, PROP_WNDOBJ, TRUE);
02502         <span class="keywordflow">if</span> (pwo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02503             GreLockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
02504             GreDeleteWnd(pwo);
02505             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a95">gcountPWO</a>--;
02506             GreUnlockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
02507         }
02508     }
02509 
02510 <span class="preprocessor">#ifdef HUNGAPP_GHOSTING</span>
02511 <span class="preprocessor"></span>
02512     <span class="comment">/*</span>
02513 <span class="comment">     * RemoveGhost handles the case when pwnd is the hung window that has a</span>
02514 <span class="comment">     * corresponding ghost window and the case when pwnd is the ghost itself.</span>
02515 <span class="comment">     */</span>
02516     RemoveGhost(pwnd);
02517 
02518 <span class="preprocessor">#endif // HUNGAPP_GHOSTING</span>
02519 <span class="preprocessor"></span>
02520     <span class="comment">/*</span>
02521 <span class="comment">     * Scan the DC cache to find any DC's for this window.  If any are there,</span>
02522 <span class="comment">     * then invalidate them.  We don't need to worry about calling SpbCheckDC</span>
02523 <span class="comment">     * because the window has been hidden by this time.</span>
02524 <span class="comment">     */</span>
02525     <span class="keywordflow">for</span> (ppdce = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o9">pdceFirst</a>; *ppdce != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; ) {
02526 
02527         pdce = *ppdce;
02528         <span class="keywordflow">if</span> (pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; DCX_INVALID) {
02529             <span class="keywordflow">goto</span> NextEntry;
02530         }
02531 
02532         <span class="keywordflow">if</span> ((pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o2">pwndOrg</a> == pwnd) || (pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o3">pwndClip</a> == pwnd)) {
02533 
02534             <span class="keywordflow">if</span> (!(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; DCX_CACHE)) {
02535 
02536                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a485">TestCF</a>(pwnd, CFCLASSDC)) {
02537 
02538                     GreLockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
02539 
02540                     <span class="keywordflow">if</span> (pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; (DCX_EXCLUDERGN | DCX_INTERSECTRGN))
02541                         <a class="code" href="../../d4/d1/userk_8h.html#a1702">DeleteHrgnClip</a>(pdce);
02542 
02543                     <a class="code" href="../../d4/d1/userk_8h.html#a1709">MarkDCEInvalid</a>(pdce);
02544                     pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o2">pwndOrg</a>  = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02545                     pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o3">pwndClip</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02546                     pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o4">hrgnClip</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02547 
02548                     <span class="comment">/*</span>
02549 <span class="comment">                     * Remove the vis rgn since it is still owned - if we did</span>
02550 <span class="comment">                     * not, gdi would not be able to clean up properly if the</span>
02551 <span class="comment">                     * app that owns this vis rgn exist while the vis rgn is</span>
02552 <span class="comment">                     * still selected.</span>
02553 <span class="comment">                     */</span>
02554                     GreSelectVisRgn(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o1">hdc</a>, NULL, SVR_DELETEOLD);
02555                     GreUnlockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
02556 
02557                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a485">TestCF</a>(pwnd, CFOWNDC)) {
02558                     <a class="code" href="../../d4/d1/userk_8h.html#a1700">DestroyCacheDC</a>(ppdce, pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o1">hdc</a>);
02559                 } <span class="keywordflow">else</span> {
02560                     UserAssert(FALSE);
02561                 }
02562 
02563             } <span class="keywordflow">else</span> {
02564 
02565                 <span class="comment">/*</span>
02566 <span class="comment">                 * If the DC is checked out, release it before</span>
02567 <span class="comment">                 * we invalidate.  Note, that if this process is exiting</span>
02568 <span class="comment">                 * and it has a dc checked out, gdi is going to destroy that</span>
02569 <span class="comment">                 * dc.  We need to similarly remove that dc from the dc cache.</span>
02570 <span class="comment">                 * This is not done here, but in the exiting code.</span>
02571 <span class="comment">                 *</span>
02572 <span class="comment">                 * The return for ReleaseDC() could fail, which would</span>
02573 <span class="comment">                 * indicate a delayed-free (DCE_NUKE).</span>
02574 <span class="comment">                 */</span>
02575                 uDCERelease = <a class="code" href="../../d4/d1/userk_8h.html#a396">DCE_RELEASED</a>;
02576 
02577                 <span class="keywordflow">if</span> (pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; DCX_INUSE) {
02578                     uDCERelease = <a class="code" href="../../d4/d1/userk_8h.html#a1698">ReleaseCacheDC</a>(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o1">hdc</a>, FALSE);
02579                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!GreSetDCOwner(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o1">hdc</a>, OBJECT_OWNER_NONE)) {
02580                     uDCERelease = <a class="code" href="../../d4/d1/userk_8h.html#a398">DCE_NORELEASE</a>;
02581                 }
02582 
02583                 <span class="keywordflow">if</span> (uDCERelease != <a class="code" href="../../d4/d1/userk_8h.html#a397">DCE_FREED</a>) {
02584 
02585                     <span class="keywordflow">if</span> (uDCERelease == <a class="code" href="../../d4/d1/userk_8h.html#a398">DCE_NORELEASE</a>) {
02586 
02587                         <span class="comment">/*</span>
02588 <span class="comment">                         * We either could not release this dc or could not set</span>
02589 <span class="comment">                         * its owner. In either case it means some other thread</span>
02590 <span class="comment">                         * is actively using it. Since it is not too useful if</span>
02591 <span class="comment">                         * the window it is calculated for is gone, mark it as</span>
02592 <span class="comment">                         * INUSE (so we don't give it out again) and as</span>
02593 <span class="comment">                         * DESTROYTHIS (so we just get rid of it since it is</span>
02594 <span class="comment">                         * easier to do this than to release it back into the</span>
02595 <span class="comment">                         * cache). The W32PF_OWNERDCCLEANUP bit means "look for</span>
02596 <span class="comment">                         * DESTROYTHIS flags and destroy that dc", and the bit</span>
02597 <span class="comment">                         * gets looked at in various strategic execution paths.</span>
02598 <span class="comment">                         */</span>
02599                         pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> = DCX_DESTROYTHIS | DCX_INUSE | DCX_CACHE;
02600                         pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>-&gt;W32PF_Flags |= W32PF_OWNDCCLEANUP;
02601 
02602                     } <span class="keywordflow">else</span> {
02603 
02604                         <span class="comment">/*</span>
02605 <span class="comment">                         * We either released the DC or changed its owner</span>
02606 <span class="comment">                         * successfully.  Mark the entry as invalid so it can</span>
02607 <span class="comment">                         * be given out again.</span>
02608 <span class="comment">                         */</span>
02609                         <a class="code" href="../../d4/d1/userk_8h.html#a1709">MarkDCEInvalid</a>(pdce);
02610                         pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o4">hrgnClip</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02611                     }
02612 
02613                     <span class="comment">/*</span>
02614 <span class="comment">                     * We shouldn't reference this window anymore. Setting</span>
02615 <span class="comment">                     * these to NULL here will make sure that even if we were</span>
02616 <span class="comment">                     * not able to release the DC here, we won't return this</span>
02617 <span class="comment">                     * window from one of the DC matching functions.</span>
02618 <span class="comment">                     */</span>
02619                     pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o2">pwndOrg</a>  = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02620                     pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o3">pwndClip</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02621 
02622                     <span class="comment">/*</span>
02623 <span class="comment">                     * Remove the visrgn since it is still owned - if we did</span>
02624 <span class="comment">                     * not, gdi would not be able to clean up properly if the</span>
02625 <span class="comment">                     * app that owns this visrgn exist while the visrgn is</span>
02626 <span class="comment">                     * still selected.</span>
02627 <span class="comment">                     */</span>
02628                     GreLockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
02629                     GreSelectVisRgn(pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o1">hdc</a>, NULL, SVR_DELETEOLD);
02630                     GreUnlockDisplay(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>);
02631                 }
02632             }
02633         }
02634 
02635         <span class="comment">/*</span>
02636 <span class="comment">         * Step to the next DC.  If the DC was deleted, there</span>
02637 <span class="comment">         * is no need to calculate address of the next entry.</span>
02638 <span class="comment">         */</span>
02639         <span class="keywordflow">if</span> (pdce == *ppdce)
02640 NextEntry:
02641             ppdce = &amp;pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o0">pdceNext</a>;
02642     }
02643 
02644     <span class="comment">/*</span>
02645 <span class="comment">     * Clean up the spb that may still exist - like child window spb's.</span>
02646 <span class="comment">     */</span>
02647     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a89">gspwndLockUpdate</a>) {
02648         <a class="code" href="../../d4/d1/userk_8h.html#a1766">FreeSpb</a>(<a class="code" href="../../d4/d1/userk_8h.html#a1765">FindSpb</a>(pwnd));
02649         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;gspwndLockUpdate);
02650         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a24">gptiLockUpdate</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02651     }
02652 
02653     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFHASSPB)) {
02654         <a class="code" href="../../d4/d1/userk_8h.html#a1766">FreeSpb</a>(<a class="code" href="../../d4/d1/userk_8h.html#a1765">FindSpb</a>(pwnd));
02655     }
02656 
02657     <span class="comment">/*</span>
02658 <span class="comment">     * Blow away the window clipping region. If the window is maximized, don't</span>
02659 <span class="comment">     * blow away the monitor region. If the window is the desktop, don't blow</span>
02660 <span class="comment">     * away the screen region.</span>
02661 <span class="comment">     */</span>
02662     <span class="keywordflow">if</span> (    pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
02663             !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXFAKEREGIONAL) &amp;&amp;
02664             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
02665 
02666         GreDeleteObject(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a>);
02667         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02668     }
02669 
02670     <span class="comment">/*</span>
02671 <span class="comment">     * Clean up any memory allocated for scroll bars...</span>
02672 <span class="comment">     */</span>
02673     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a>) {
02674         <a class="code" href="../../d4/d1/userk_8h.html#a313">DesktopFree</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk, (HANDLE)(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a>));
02675         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02676     }
02677 
02678     <span class="comment">/*</span>
02679 <span class="comment">     * Free any callback handles associated with this window.</span>
02680 <span class="comment">     * This is done outside of DeleteProperties because of the special</span>
02681 <span class="comment">     * nature of callback handles as opposed to normal memory handles</span>
02682 <span class="comment">     * allocated for a thread.</span>
02683 <span class="comment">     */</span>
02684 
02685     <span class="comment">/*</span>
02686 <span class="comment">     * Blow away the title</span>
02687 <span class="comment">     */</span>
02688     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o3">Buffer</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02689         <a class="code" href="../../d4/d1/userk_8h.html#a313">DesktopFree</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o3">Buffer</a>);
02690         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o3">Buffer</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02691         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a> = 0;
02692     }
02693 
02694     <span class="comment">/*</span>
02695 <span class="comment">     * Blow away any properties connected to the window.</span>
02696 <span class="comment">     */</span>
02697     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o13">ppropList</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02698         <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpDdeConv;
02699         <a class="code" href="../../d6/d2/structtagDDECONV.html">PDDECONV</a> pDdeConv;
02700         <a class="code" href="../../d7/d2/structtagDDEIMP.html">PDDEIMP</a> pddei;
02701 
02702         <span class="comment">/*</span>
02703 <span class="comment">         * Get rid of any icon properties.</span>
02704 <span class="comment">         */</span>
02705         <a class="code" href="../../d4/d1/userk_8h.html#a1449">DestroyWindowSmIcon</a>(pwnd);
02706         <a class="code" href="../../d4/d8/kernel_2winprop_8c.html#a1">InternalRemoveProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o29">atomIconProp</a>), PROPF_INTERNAL);
02707 
02708         pDdeConv = (<a class="code" href="../../d6/d2/structtagDDECONV.html">PDDECONV</a>)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, PROP_DDETRACK, PROPF_INTERNAL);
02709         <span class="keywordflow">if</span> (pDdeConv != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02710             <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(pti, pDdeConv, &amp;tlpDdeConv);
02711             <a class="code" href="../../d4/d1/userk_8h.html#a1877">xxxDDETrackWindowDying</a>(pwnd, pDdeConv);
02712             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpDdeConv);
02713         }
02714         pddei = (<a class="code" href="../../d7/d2/structtagDDEIMP.html">PDDEIMP</a>)<a class="code" href="../../d4/d8/kernel_2winprop_8c.html#a1">InternalRemoveProp</a>(pwnd, PROP_DDEIMP, PROPF_INTERNAL);
02715         <span class="keywordflow">if</span> (pddei != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02716             pddei-&gt;<a class="code" href="../../d7/d2/structtagDDEIMP.html#o2">cRefInit</a> = 0;
02717             <span class="keywordflow">if</span> (pddei-&gt;<a class="code" href="../../d7/d2/structtagDDEIMP.html#o3">cRefConv</a> == 0) {
02718                 <span class="comment">/*</span>
02719 <span class="comment">                 * If this is not 0 it is referenced by one or more DdeConv</span>
02720 <span class="comment">                 * structures so DON'T free it yet!</span>
02721 <span class="comment">                 */</span>
02722                 UserFreePool(pddei);
02723             }
02724         }
02725     }
02726 
02727     <span class="comment">/*</span>
02728 <span class="comment">     * Unlock everything that the window references.</span>
02729 <span class="comment">     * After we have sent the WM_DESTROY and WM_NCDESTROY message we</span>
02730 <span class="comment">     * can unlock &amp; NULL the owner field so no other windows get z-ordered</span>
02731 <span class="comment">     * relative to this window.  Rhumba faults if we NULL it before the</span>
02732 <span class="comment">     * destroy.  (It calls GetParent after every message).</span>
02733 <span class="comment">     *</span>
02734 <span class="comment">     * We special-case the spwndParent window.  In this case, if the</span>
02735 <span class="comment">     * window being destroyed is a desktop window, unlock the parent.</span>
02736 <span class="comment">     * Otherwise, we lock in the desktop-window as the parent so that</span>
02737 <span class="comment">     * if we aren't freed in this function, we will ensure that we</span>
02738 <span class="comment">     * won't fault when doing things like clipping-calculations.  We'll</span>
02739 <span class="comment">     * unlock this once we know we're truly going to free this window.</span>
02740 <span class="comment">     */</span>
02741     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
02742             pwnd != pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwnd)
02743         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwnd);
02744     <span class="keywordflow">else</span>
02745         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>);
02746 
02747     <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>);
02748     <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>);
02749     <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o12">spwndLastActive</a>);
02750 
02751     <span class="comment">/*</span>
02752 <span class="comment">     * Decrement the Window Reference Count in the Class structure.</span>
02753 <span class="comment">     */</span>
02754     <a class="code" href="../../d4/d1/userk_8h.html#a1154">DereferenceClass</a>(pwnd);
02755 
02756     <span class="comment">/*</span>
02757 <span class="comment">     * Mark the object for destruction before this final unlock. This way</span>
02758 <span class="comment">     * the WM_FINALDESTROY will get sent if this is the last thread lock.</span>
02759 <span class="comment">     * We're currently destroying this window, so don't allow unlock recursion</span>
02760 <span class="comment">     * at this point (this is what HANDLEF_INDESTROY will do for us).</span>
02761 <span class="comment">     */</span>
02762     <a class="code" href="../../d4/d1/userk_8h.html#a971">HMMarkObjectDestroy</a>(pwnd);
02763     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a446">HMPheFromObject</a>(pwnd)-&gt;bFlags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a422">HANDLEF_INDESTROY</a>;
02764 
02765     <span class="comment">/*</span>
02766 <span class="comment">     * Unlock the window... This shouldn't return FALSE because HANDLEF_DESTROY</span>
02767 <span class="comment">     * is set, but just in case...  if it isn't around anymore, return because</span>
02768 <span class="comment">     * pwnd is invalid.</span>
02769 <span class="comment">     */</span>
02770     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(ptlpwndFree))
02771         <span class="keywordflow">return</span>;
02772 
02773     <span class="comment">/*</span>
02774 <span class="comment">     * Try to free the object.  The object won't free if it is locked - but</span>
02775 <span class="comment">     * it will be marked for destruction.  If the window is locked, change</span>
02776 <span class="comment">     * it's wndproc to xxxDefWindowProc().</span>
02777 <span class="comment">     *</span>
02778 <span class="comment">     * HMMarkObjectDestroy() will clear the HANDLEF_INDESTROY flag if the</span>
02779 <span class="comment">     * object isn't about to go away (so it can be destroyed again!)</span>
02780 <span class="comment">     */</span>
02781     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02782     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a971">HMMarkObjectDestroy</a>(pwnd)) {
02783 
02784         <span class="comment">/*</span>
02785 <span class="comment">         * Delete the window's property list. Wait until now in case some</span>
02786 <span class="comment">         * thread keeps a property pointer around across a callback.</span>
02787 <span class="comment">         */</span>
02788         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o13">ppropList</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02789             <a class="code" href="../../d4/d8/kernel_2winprop_8c.html#a4">DeleteProperties</a>(pwnd);
02790         }
02791 
02792 <span class="preprocessor">#if DBG</span>
02793 <span class="preprocessor"></span>        <span class="comment">/*</span>
02794 <span class="comment">         * If we find the window is visible at the time we free it, then</span>
02795 <span class="comment">         * somehow the app was made visible on a callback (we hide it</span>
02796 <span class="comment">         * during xxxDestroyWindow().  This screws up our vis-window</span>
02797 <span class="comment">         * count for the thread, so we need to assert it.</span>
02798 <span class="comment">         */</span>
02799         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFINDESTROY) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE))
02800             RIPMSG1(RIP_ERROR, <span class="stringliteral">"xxxFreeWindow: Window should not be visible (pwnd == %#p)"</span>, pwnd);
02801 <span class="preprocessor">#endif</span>
02802 <span class="preprocessor"></span>
02803         pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o49">cWindows</a>--;
02804 
02805         <span class="comment">/*</span>
02806 <span class="comment">         * Since we're freeing the memory for this window, we need</span>
02807 <span class="comment">         * to unlock the parent (which is the desktop for zombie windows).</span>
02808 <span class="comment">         */</span>
02809         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>);
02810 
02811         <a class="code" href="../../d4/d1/userk_8h.html#a128">ThreadLockDesktop</a>(pti, pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk, &amp;tlpdesk, LDLT_FN_FREEWINDOW);
02812         <a class="code" href="../../d4/d1/userk_8h.html#a970">HMFreeObject</a>(pwnd);
02813         <a class="code" href="../../d4/d1/userk_8h.html#a130">ThreadUnlockDesktop</a>(pti, &amp;tlpdesk, LDUT_FN_FREEWINDOW);
02814         <span class="keywordflow">return</span>;
02815     }
02816 
02817     <span class="comment">/*</span>
02818 <span class="comment">     * Turn this into an object that the app won't see again - turn</span>
02819 <span class="comment">     * it into an icon title window - the window is still totally</span>
02820 <span class="comment">     * valid and useable by any structures that has this window locked.</span>
02821 <span class="comment">     */</span>
02822     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a> = <a class="code" href="../../d8/d3/dwp_8c.html#a17">xxxDefWindowProc</a>;
02823     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk)
02824         ppi = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;rpwinstaParent-&gt;pTerm-&gt;ptiDesktop-&gt;ppi;
02825     <span class="keywordflow">else</span>
02826         ppi = <a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>();
02827     ppcls = <a class="code" href="../../d4/d1/userk_8h.html#a1152">GetClassPtr</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[ICLS_ICONTITLE], ppi, hModuleWin);
02828 
02829     UserAssert(ppcls);
02830     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a> = *ppcls;
02831 
02832     <span class="comment">/*</span>
02833 <span class="comment">     * Since pwnd is marked as destroyed, there should be no client-side</span>
02834 <span class="comment">     * code which can validate it.  So we do not need to search for a clone</span>
02835 <span class="comment">     * class of the right desktop -- just use the base class and bump the</span>
02836 <span class="comment">     * WndReferenceCount.  This also helps if we are in a low-memory situation</span>
02837 <span class="comment">     * and cannot alloc another clone.</span>
02838 <span class="comment">     */</span>
02839 
02840     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>-&gt;<a class="code" href="../../d7/d0/structtagCLS.html#o5">cWndReferenceCount</a>++;
02841 
02842     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFSERVERSIDEPROC);
02843 
02844     <span class="comment">/*</span>
02845 <span class="comment">     * Clear the palette bit so that WM_PALETTECHANGED will not be sent</span>
02846 <span class="comment">     * again when the window is finally destroyed.</span>
02847 <span class="comment">     */</span>
02848     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFHASPALETTE);
02849 
02850     <span class="comment">/*</span>
02851 <span class="comment">     * Clear its child bits so no code assumes that if the child bit</span>
02852 <span class="comment">     * is set, it has a parent. Change spmenu to NULL - it is only</span>
02853 <span class="comment">     * non-zero if this was child.</span>
02854 <span class="comment">     */</span>
02855     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFTYPEMASK);
02856     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFTILED);
02857     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02858 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="createw.c::xxxFW_DestroyAllChildren" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxFW_DestroyAllChildren           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d7/createw_8c-source.html#l02126">2126</a> of file <a class="el" href="../../d5/d7/createw_8c-source.html">createw.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l02068">PostEventMessage()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02997">QEVENT_DESTROYWINDOW</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l05237">SetVisible()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02585">SV_UNSET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00365">ThreadLockAlwaysWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l02867">UnlinkWindow()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02304">WFDESTROYED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, and <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>.
<p>
<pre class="fragment"><div>02128 {
02129     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndChild;
02130     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndChild;
02131     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
02132     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
02133 
02134     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
02135 
02136     <span class="keywordflow">while</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02137         pwndChild = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>;
02138 
02139         <span class="comment">/*</span>
02140 <span class="comment">         * ThreadLock prior to the unlink in case pwndChild</span>
02141 <span class="comment">         * is already marked as destroyed.</span>
02142 <span class="comment">         */</span>
02143         <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(ptiCurrent, pwndChild, &amp;tlpwndChild);
02144 
02145         <span class="comment">/*</span>
02146 <span class="comment">         * Propagate the VISIBLE flag. We need to do this so that</span>
02147 <span class="comment">         * when a child window gets destroyed we don't try to hide it</span>
02148 <span class="comment">         * if the WFVISIBLE flag is set.</span>
02149 <span class="comment">         */</span>
02150         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, WFVISIBLE)) {
02151             <a class="code" href="../../d4/d1/userk_8h.html#a1626">SetVisible</a>(pwndChild, SV_UNSET);
02152         }
02153 
02154         <a class="code" href="../../d4/d1/userk_8h.html#a1458">UnlinkWindow</a>(pwndChild, pwnd);
02155 
02156         <span class="comment">/*</span>
02157 <span class="comment">         * Set the state as destroyed so any z-ordering events will be ignored.</span>
02158 <span class="comment">         * We cannot NULL out the owner field until WM_NCDESTROY is send or</span>
02159 <span class="comment">         * apps like Rumba fault  (they call GetParent after every message)</span>
02160 <span class="comment">         */</span>
02161         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwndChild, WFDESTROYED);
02162 
02163         <span class="comment">/*</span>
02164 <span class="comment">         * If the window belongs to another thread, post</span>
02165 <span class="comment">         * an event to let it know it should be destroyed.</span>
02166 <span class="comment">         * Otherwise, free the window.</span>
02167 <span class="comment">         */</span>
02168         pti = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndChild);
02169         <span class="keywordflow">if</span> (pti != ptiCurrent) {
02170             <a class="code" href="../../d4/d1/userk_8h.html#a1217">PostEventMessage</a>(pti, pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>, QEVENT_DESTROYWINDOW,
02171                              NULL, 0,
02172                              (WPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndChild), 0);
02173             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndChild);
02174         } <span class="keywordflow">else</span> {
02175             <span class="comment">/*</span>
02176 <span class="comment">             * FreeWindow performs a ThreadUnlock.</span>
02177 <span class="comment">             */</span>
02178             <a class="code" href="../../d4/d1/userk_8h.html#a1461">xxxFreeWindow</a>(pwndChild, &amp;tlpwndChild);
02179         }
02180     }
02181 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:18 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
