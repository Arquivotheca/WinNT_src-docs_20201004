<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: timers.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>timers.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d5/d1/timers_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a0">_TIMERS</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a1">TIMERID_MAX</a>&nbsp;&nbsp;&nbsp;0x7FFF</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a2">TIMERID_MIN</a>&nbsp;&nbsp;&nbsp;0x100</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a3">ELAPSED_MAX</a>&nbsp;&nbsp;&nbsp;0x7FFFFFFF</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a4">SYSRIT_TIMER</a>&nbsp;&nbsp;&nbsp;(TMRF_SYSTEM | TMRF_RIT)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>UINT_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a6">_SetTimer</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT_PTR nIDEvent, UINT dwElapse, <a class="el" href="../../d1/d0/inc_2user_8h.html#a960">TIMERPROC_PWND</a> pTimerFunc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a7">_SetSystemTimer</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT_PTR nIDEvent, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwElapse, <a class="el" href="../../d1/d0/inc_2user_8h.html#a960">TIMERPROC_PWND</a> pTimerFunc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a8">FreeTimer</a> (<a class="el" href="../../d4/d8/structtagTIMER.html">PTIMER</a> ptmr)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d8/structtagTIMER.html">PTIMER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a9">FindTimer</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT_PTR nID, UINT flags, BOOL fKill)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a10">InternalSetTimer</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT_PTR nIDEvent, UINT dwElapse, <a class="el" href="../../d1/d0/inc_2user_8h.html#a960">TIMERPROC_PWND</a> pTimerFunc, UINT flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a11">_KillTimer</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT_PTR nIDEvent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a12">_KillSystemTimer</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT_PTR nIDEvent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a13">KillTimer2</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT_PTR nIDEvent, BOOL fSystemTimer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a14">DestroyThreadsTimers</a> (<a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a15">DestroyWindowsTimers</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a16">DoTimer</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndFilter)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a17">DecTimerCount</a> (<a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a18">JournalTimer</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT message, UINT_PTR nID, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a19">SetJournalTimer</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dt, UINT msgJournal)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a20">StartTimers</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a21">TimersProc</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a22">xxxSystemTimerProc</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, UINT_PTR id, LPARAM lParam)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>WORD&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d2/timers_8c.html#a5">cTimerId</a> = TIMERID_MAX</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="timers.c::_TIMERS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define _TIMERS&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00013">13</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="timers.c::ELAPSED_MAX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ELAPSED_MAX&nbsp;&nbsp;&nbsp;0x7FFFFFFF          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00030">30</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="timers.c::SYSRIT_TIMER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SYSRIT_TIMER&nbsp;&nbsp;&nbsp;(TMRF_SYSTEM | TMRF_RIT)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00032">32</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00167">FindTimer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="timers.c::TIMERID_MAX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TIMERID_MAX&nbsp;&nbsp;&nbsp;0x7FFF          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00027">27</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="timers.c::TIMERID_MIN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TIMERID_MIN&nbsp;&nbsp;&nbsp;0x100          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00028">28</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a12" doxytag="timers.c::_KillSystemTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _KillSystemTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>nIDEvent</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00431">431</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00447">KillTimer2()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/caret_8c-source.html#l00513">_SetCaretBlinkTime()</a>, <a class="el" href="../../d5/d4/caret_8c-source.html#l00454">CaretBlinkProc()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00037">DecrementRedirectedCount()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00918">StopFade()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l02725">TrackMouseEvent()</a>, <a class="el" href="../../d2/d3/tooltips_8c-source.html#l01125">xxxCancelMouseMoveTracking()</a>, <a class="el" href="../../d9/d3/sbctl_8c-source.html#l01782">xxxEndScroll()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l00027">xxxFlashWindow()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00882">xxxSystemTimerProc()</a>, <a class="el" href="../../d5/d4/caret_8c-source.html#l00189">zzzInternalDestroyCaret()</a>, and <a class="el" href="../../d5/d4/caret_8c-source.html#l00550">zzzSetCaretPos()</a>.
<p>
<pre class="fragment"><div>00434 {
00435     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1242">KillTimer2</a>(pwnd, nIDEvent, TRUE);
00436 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="timers.c::_KillTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _KillTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>nIDEvent</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00414">414</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d5/d1/timers_8c-source.html#l00447">KillTimer2()</a>.
<p>
Referenced by <a class="el" href="../../d2/d3/tooltips_8c-source.html#l00429">KillTooltipTimer()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00290">MNAnimate()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05388">NtUserKillTimer()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l02517">xxxMNCloseHierarchy()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00880">xxxMNDestroyHandler()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00591">xxxMNDoScroll()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l01934">xxxMNOpenHierarchy()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l02818">xxxMNSelectItem()</a>, and <a class="el" href="../../d3/d2/mnpopup_8c-source.html#l00052">xxxTrackPopupMenuEx()</a>.
<p>
<pre class="fragment"><div>00417 {
00418     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1242">KillTimer2</a>(pwnd, nIDEvent, FALSE);
00419 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="timers.c::_SetSystemTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT_PTR _SetSystemTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>nIDEvent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwElapse</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a960">TIMERPROC_PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pTimerFunc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00078">78</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l00084">PpiCurrent</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/caret_8c-source.html#l00513">_SetCaretBlinkTime()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08554">NtUserSetSystemTimer()</a>, <a class="el" href="../../d9/d3/sbctl_8c-source.html#l01913">xxxContScroll()</a>, <a class="el" href="../../d5/d4/caret_8c-source.html#l00254">xxxCreateCaret()</a>, <a class="el" href="../../d9/d3/sbctl_8c-source.html#l01971">xxxTrackBox()</a>, and <a class="el" href="../../d5/d4/caret_8c-source.html#l00550">zzzSetCaretPos()</a>.
<p>
<pre class="fragment"><div>00083 {
00084     <span class="comment">/*</span>
00085 <span class="comment">     * Prevent apps from setting a Timer with a window proc to another app</span>
00086 <span class="comment">     */</span>
00087     <span class="keywordflow">if</span> (pwnd &amp;&amp; <a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>() != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi) {
00088 
00089         RIPERR1(ERROR_ACCESS_DENIED,
00090                 RIP_WARNING,
00091                 <span class="stringliteral">"Calling SetSystemTimer with window of another process %lX"</span>,
00092                 pwnd);
00093 
00094         <span class="keywordflow">return</span> 0;
00095     }
00096 
00097     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1044">InternalSetTimer</a>(pwnd, nIDEvent, dwElapse, pTimerFunc, TMRF_SYSTEM);
00098 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="timers.c::_SetTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT_PTR _SetTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>nIDEvent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>dwElapse</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a960">TIMERPROC_PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pTimerFunc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00045">45</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l00084">PpiCurrent</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l03600">MNSetTimerToAutoDismiss()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l03917">MNSetTimerToCloseHierarchy()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l03870">MNSetTimerToOpenHierarchy()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06092">NtUserSetTimer()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00591">xxxMNDoScroll()</a>.
<p>
<pre class="fragment"><div>00050 {
00051     <span class="comment">/*</span>
00052 <span class="comment">     * Prevent apps from setting a Timer with a window proc to another app</span>
00053 <span class="comment">     */</span>
00054     <span class="keywordflow">if</span> (pwnd &amp;&amp; (<a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>() != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi)) {
00055 
00056         RIPERR1(ERROR_ACCESS_DENIED,
00057                 RIP_WARNING,
00058                 <span class="stringliteral">"Calling SetTimer with window of another process %lX"</span>,
00059                 pwnd);
00060 
00061         <span class="keywordflow">return</span> 0;
00062     }
00063 
00064     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1044">InternalSetTimer</a>(pwnd, nIDEvent, dwElapse, pTimerFunc, 0);
00065 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="timers.c::DecTimerCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DecTimerCount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pti</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00644">644</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03347">tagTHREADINFO::cTimersReady</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03041">tagCLIENTTHREADINFO::fsWakeBits</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03325">tagTHREADINFO::pcti</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00538">DoTimer()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00112">FreeTimer()</a>, and <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>.
<p>
<pre class="fragment"><div>00646 {
00647     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00648 
00649     <span class="keywordflow">if</span> (--pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o20">cTimersReady</a> == 0)
00650         pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o5">pcti</a>-&gt;<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o2">fsWakeBits</a> &amp;= ~QS_TIMER;
00651 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="timers.c::DestroyThreadsTimers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DestroyThreadsTimers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pti</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00472">472</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d1/timers_8c-source.html#l00112">FreeTimer()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00666">gptmrFirst</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04048">tagTIMER::pti</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04055">tagTIMER::ptiOptCreator</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04046">tagTIMER::ptmrNext</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/queue_8c-source.html#l02552">xxxDestroyThreadInfo()</a>.
<p>
<pre class="fragment"><div>00474 {
00475     <a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a> ptmr;
00476 
00477     ptmr = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a>;
00478 
00479     <span class="keywordflow">while</span> (ptmr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00480 
00481         <span class="comment">/*</span>
00482 <span class="comment">         * Is this one of the timers we're looking for?  If so, destroy it.</span>
00483 <span class="comment">         */</span>
00484         <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a> == pti || ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o10">ptiOptCreator</a> == pti) {
00485             <a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a> ptmrNext = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00486             <a class="code" href="../../d4/d1/userk_8h.html#a1045">FreeTimer</a>(ptmr);
00487             ptmr = ptmrNext;
00488         } <span class="keywordflow">else</span> {
00489             ptmr = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00490         }
00491     }
00492 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="timers.c::DestroyWindowsTimers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DestroyWindowsTimers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00504">504</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d1/timers_8c-source.html#l00112">FreeTimer()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00666">gptmrFirst</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04046">tagTIMER::ptmrNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04049">tagTIMER::spwnd</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/kernel_2exitwin_8c-source.html#l00428">xxxClientShutdown2()</a>, and <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>.
<p>
<pre class="fragment"><div>00506 {
00507     <a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a> ptmr;
00508 
00509     ptmr = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a>;
00510 
00511     <span class="keywordflow">while</span> (ptmr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00512 
00513         <span class="comment">/*</span>
00514 <span class="comment">         * Is this one of the timers we're looking for?  If so, destroy it.</span>
00515 <span class="comment">         */</span>
00516         <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o4">spwnd</a> == pwnd) {
00517             <a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a> ptmrNext = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00518             <a class="code" href="../../d4/d1/userk_8h.html#a1045">FreeTimer</a>(ptmr);
00519             ptmr = ptmrNext;
00520         } <span class="keywordflow">else</span> {
00521             ptmr = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00522         }
00523     }
00524 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="timers.c::DoTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DoTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwndFilter</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00538">538</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d7/d2/queue_8c-source.html#l03208">AllocQEntry()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2kernel_2random_8c-source.html#l00131">CheckPwndFilter()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00644">DecTimerCount()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04053">tagTIMER::flags</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00666">gptmrFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03383">tagTHREADINFO::mlPost</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04050">tagTIMER::nID</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04054">tagTIMER::pfn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04048">tagTIMER::pti</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04046">tagTIMER::ptmrNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04047">tagTIMER::ptmrPrev</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04578">SetWakeBit()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04049">tagTIMER::spwnd</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04831">StoreQMessage()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05138">StoreQMessagePti()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d2/d0/bench_8c-source.html#l01433">WM_SYSTIMER</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l00213">xxxInternalGetMessage()</a>.
<p>
<pre class="fragment"><div>00540 {
00541     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
00542     <a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a>      ptmr;
00543     <a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a>      ptmrNext;
00544     <a class="code" href="../../d8/d4/structtagQMSG.html">PQMSG</a>       pqmsg;
00545 
00546     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00547 
00548     pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00549 
00550     <span class="comment">/*</span>
00551 <span class="comment">     * Search for a timer that belongs to this queue.</span>
00552 <span class="comment">     */</span>
00553     ptmr = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a>;
00554 
00555     <span class="keywordflow">while</span> (ptmr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00556 
00557         <span class="comment">/*</span>
00558 <span class="comment">         * Has this timer gone off and is it one we're looking for?</span>
00559 <span class="comment">         */</span>
00560         <span class="keywordflow">if</span> ((ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp; TMRF_READY) &amp;&amp;
00561             (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a> == pti)         &amp;&amp;
00562             <a class="code" href="../../d4/d1/userk_8h.html#a1220">CheckPwndFilter</a>(ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o4">spwnd</a>, pwndFilter)) {
00563 
00564             <span class="comment">/*</span>
00565 <span class="comment">             * We found an appropriate timer. Put it in the app's queue and</span>
00566 <span class="comment">             * return success.</span>
00567 <span class="comment">             */</span>
00568             <span class="keywordflow">if</span> ((pqmsg = <a class="code" href="../../d4/d1/userk_8h.html#a1210">AllocQEntry</a>(&amp;pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00569 
00570                 <span class="comment">/*</span>
00571 <span class="comment">                 * Store the message and set the QS_POSTMESSAGE bit so the</span>
00572 <span class="comment">                 * thread knows it has a message.</span>
00573 <span class="comment">                 */</span>
00574                 <a class="code" href="../../d4/d1/userk_8h.html#a1503">StoreQMessage</a>(pqmsg,
00575                               ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o4">spwnd</a>,
00576                               (UINT)((ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp; TMRF_SYSTEM) ?
00577                                       WM_SYSTIMER : WM_TIMER),
00578                               (WPARAM)ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o5">nID</a>,
00579                               (LPARAM)ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o9">pfn</a>,
00580                               0, 0, 0);
00581 <span class="preprocessor">#ifdef REDIRECTION</span>
00582 <span class="preprocessor"></span>                <a class="code" href="../../d4/d1/userk_8h.html#a1504">StoreQMessagePti</a>(pqmsg, pti);
00583 <span class="preprocessor">#endif // REDIRECTION</span>
00584 <span class="preprocessor"></span>                <a class="code" href="../../d4/d1/userk_8h.html#a1197">SetWakeBit</a>(pti, QS_POSTMESSAGE | QS_ALLPOSTMESSAGE);
00585             }
00586 
00587             <span class="comment">/*</span>
00588 <span class="comment">             * Reset this timer.</span>
00589 <span class="comment">             */</span>
00590             ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp;= ~TMRF_READY;
00591             <a class="code" href="../../d4/d1/userk_8h.html#a1244">DecTimerCount</a>(ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a>);
00592 
00593             <span class="comment">/*</span>
00594 <span class="comment">             * If there are other timers in the system move this timer</span>
00595 <span class="comment">             * to the end of the list so other timers in for this queue</span>
00596 <span class="comment">             * get a chance to go off.</span>
00597 <span class="comment">             */</span>
00598             ptmrNext = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00599             <span class="keywordflow">if</span> (ptmrNext != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00600 
00601                 <span class="comment">/*</span>
00602 <span class="comment">                 * Remove ptmr from its place in the list.</span>
00603 <span class="comment">                 */</span>
00604                 <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a>) {
00605                     ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a>-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a> = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00606                 } <span class="keywordflow">else</span>
00607                     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a> = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00608 
00609                 ptmrNext-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a> = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a>;
00610 
00611                 <span class="comment">/*</span>
00612 <span class="comment">                 * Move to the last TIMER of the list.</span>
00613 <span class="comment">                 */</span>
00614                 <span class="keywordflow">while</span> (ptmrNext-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00615                     ptmrNext = ptmrNext-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00616 
00617                 <span class="comment">/*</span>
00618 <span class="comment">                 * Insert this timer at the end.</span>
00619 <span class="comment">                 */</span>
00620                 ptmrNext-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a> = ptmr;
00621                 ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a> = ptmrNext;
00622                 ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>     = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00623             }
00624 
00625             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00626         }
00627 
00628         ptmr = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00629     }
00630 
00631     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00632 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="timers.c::FindTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d8/structtagTIMER.html">PTIMER</a> FindTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>nID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fKill</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00167">167</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l04053">tagTIMER::flags</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00112">FreeTimer()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00666">gptmrFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04050">tagTIMER::nID</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04046">tagTIMER::ptmrNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04049">tagTIMER::spwnd</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00032">SYSRIT_TIMER</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00447">KillTimer2()</a>, and <a class="el" href="../../d4/d0/usergdi_8c-source.html#l00024">UserSetTimer()</a>.
<p>
<pre class="fragment"><div>00172 {
00173     <a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a> ptmr;
00174 
00175     ptmr = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a>;
00176 
00177     <span class="keywordflow">while</span> (ptmr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00178 
00179         <span class="comment">/*</span>
00180 <span class="comment">         * Is this the timer we're looking for?</span>
00181 <span class="comment">         */</span>
00182         <span class="keywordflow">if</span> ((ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o4">spwnd</a> == pwnd) &amp;&amp;
00183             (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o5">nID</a> == nID)    &amp;&amp;
00184             (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp; <a class="code" href="../../d4/d2/timers_8c.html#a4">SYSRIT_TIMER</a>) == (flags &amp; <a class="code" href="../../d4/d2/timers_8c.html#a4">SYSRIT_TIMER</a>)) {
00185 
00186             <span class="comment">/*</span>
00187 <span class="comment">             * Are we being called from KillTimer()? If so, destroy the</span>
00188 <span class="comment">             * timer.  return != 0 because *pptmr is gone.</span>
00189 <span class="comment">             */</span>
00190             <span class="keywordflow">if</span> (fKill) {
00191                 <a class="code" href="../../d4/d1/userk_8h.html#a1045">FreeTimer</a>(ptmr);
00192                 <span class="keywordflow">return</span> (<a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a>)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00193             }
00194 
00195             <span class="comment">/*</span>
00196 <span class="comment">             * Found the timer, break out of the loop.</span>
00197 <span class="comment">             */</span>
00198             <span class="keywordflow">break</span>;
00199         }
00200 
00201         <span class="comment">/*</span>
00202 <span class="comment">         * No, try the next one.</span>
00203 <span class="comment">         */</span>
00204         ptmr = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00205     }
00206 
00207     <span class="keywordflow">return</span> ptmr;
00208 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="timers.c::FreeTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d8/structtagTIMER.html">PTIMER</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ptmr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00112">112</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00644">DecTimerCount()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00666">gptmrFirst</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l01069">HMFreeObject()</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l01237">HMMarkObjectDestroy()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04046">tagTIMER::ptmrNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04047">tagTIMER::ptmrPrev</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00472">DestroyThreadsTimers()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00504">DestroyWindowsTimers()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00167">FindTimer()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02146">InitiateWin32kCleanup()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l00097">Win32kNtUserCleanup()</a>.
<p>
<pre class="fragment"><div>00113                  {
00114 
00115     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00116 
00117     <span class="comment">/*</span>
00118 <span class="comment">     * Mark it for destruction.  If it the object is locked it can't</span>
00119 <span class="comment">     * be freed right now.</span>
00120 <span class="comment">     */</span>
00121     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a971">HMMarkObjectDestroy</a>((PVOID)ptmr))
00122         <span class="keywordflow">return</span>;
00123 
00124     <span class="comment">/*</span>
00125 <span class="comment">     * If this timer was just about to be processed, decrement</span>
00126 <span class="comment">     * the ready-count since we're blowing it off.</span>
00127 <span class="comment">     */</span>
00128     <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp; TMRF_READY)
00129         <a class="code" href="../../d4/d1/userk_8h.html#a1244">DecTimerCount</a>(ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a>);
00130 
00131     <span class="comment">/*</span>
00132 <span class="comment">     * Unlock the window</span>
00133 <span class="comment">     */</span>
00134     <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o4">spwnd</a>);
00135 
00136     <span class="comment">/*</span>
00137 <span class="comment">     * Unlink this timer</span>
00138 <span class="comment">     */</span>
00139     <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a>) {
00140         ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a>-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a> = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00141     } <span class="keywordflow">else</span> {
00142         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a> = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00143     }
00144 
00145     <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>) {
00146         ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a> = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a>;
00147     }
00148 
00149     <span class="comment">/*</span>
00150 <span class="comment">     * Free up the TIMER structure.</span>
00151 <span class="comment">     */</span>
00152     <a class="code" href="../../d4/d1/userk_8h.html#a970">HMFreeObject</a>((PVOID)ptmr);
00153 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="timers.c::InternalSetTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT_PTR InternalSetTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>nIDEvent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>dwElapse</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a960">TIMERPROC_PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pTimerFunc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">225</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04051">tagTIMER::cmsCountdown</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04052">tagTIMER::cmsRate</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00034">cTimerId</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00644">DecTimerCount()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00030">ELAPSED_MAX</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00167">FindTimer()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04053">tagTIMER::flags</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00669">gbMasterTimerSet</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00455">gptiRit</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00666">gptmrFirst</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00667">gptmrMaster</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l00828">HMAllocObject()</a>, <a class="el" href="../../d5/d7/handtabl_8c-source.html#l01069">HMFreeObject()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00243">KeSetTimer()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04050">tagTIMER::nID</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04054">tagTIMER::pfn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04048">tagTIMER::pti</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04055">tagTIMER::ptiOptCreator</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04046">tagTIMER::ptmrNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04047">tagTIMER::ptmrPrev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04049">tagTIMER::spwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02827">TIF_16BIT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03331">tagTHREADINFO::TIF_flags</a>, <a class="el" href="../../d4/d1/userk_8h.html#a909">TIMER</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00027">TIMERID_MAX</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00028">TIMERID_MIN</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00921">TYPE_TIMER</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00078">_SetSystemTimer()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00045">_SetTimer()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l02943">_UserSoundSentryWorker()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l02289">AccessTimeOutReset()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l00485">FilterKeys()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l00201">FKActivationTimer()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00020">IncrementRedirectedCount()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02615">ProcessKeyboardInput()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l02653">ResetMouseHover()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l01094">SetAppStarting()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00693">SetJournalTimer()</a>, <a class="el" href="../../d2/d3/tooltips_8c-source.html#l00441">SetTooltipTimer()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l02898">SoundSentryTimer()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00879">StartFade()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00722">StartTimers()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l02108">ToggleKeys()</a>, <a class="el" href="../../d4/d0/usergdi_8c-source.html#l00024">UserSetTimer()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l00423">xxxFKAcceptanceDelayTimer()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l00374">xxxFKRepeatRateTimer()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l00027">xxxFlashWindow()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l01616">xxxMKMouseMove()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l01543">xxxMKMoveAccelCursorTimer()</a>, <a class="el" href="../../d2/d3/tooltips_8c-source.html#l00904">xxxTrackMouseMove()</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00389">zzzAnimateCursor()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00496">zzzUpdateCursorImage()</a>.
<p>
<pre class="fragment"><div>00231 {
00232     LARGE_INTEGER liT = {1, 0};
00233     <a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a>        ptmr;
00234     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>   ptiCurrent;
00235 
00236     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00237 
00238     <span class="comment">/*</span>
00239 <span class="comment">     * Assert if someone tries to set a timer after InitiateWin32kCleanup</span>
00240 <span class="comment">     * killed the RIT.</span>
00241 <span class="comment">     */</span>
00242     UserAssert(gptiRit != NULL);
00243     
00244     <span class="comment">/*</span>
00245 <span class="comment">     * 1.0 compatibility weirdness. Also, don't allow negative elapse times</span>
00246 <span class="comment">     * because this'll cause ScanTimers() to generate negative elapse times</span>
00247 <span class="comment">     * between timers.</span>
00248 <span class="comment">     */</span>
00249     <span class="keywordflow">if</span> ((dwElapse == 0) || (dwElapse &gt; <a class="code" href="../../d4/d2/timers_8c.html#a3">ELAPSED_MAX</a>))
00250         dwElapse = 1;
00251 
00252     <span class="comment">/*</span>
00253 <span class="comment">     * Attempt to first locate the timer, then create a new one</span>
00254 <span class="comment">     * if one isn't found.</span>
00255 <span class="comment">     */</span>
00256     <span class="keywordflow">if</span> ((ptmr = <a class="code" href="../../d4/d1/userk_8h.html#a1721">FindTimer</a>(pwnd, nIDEvent, flags, FALSE)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00257 
00258         <span class="comment">/*</span>
00259 <span class="comment">         * Not found.  Create a new one.</span>
00260 <span class="comment">         */</span>
00261         ptmr = (<a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a>)<a class="code" href="../../d4/d1/userk_8h.html#a969">HMAllocObject</a>(NULL, NULL, TYPE_TIMER, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8/structtagTIMER.html">TIMER</a>));
00262         <span class="keywordflow">if</span> (ptmr == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00263             <span class="keywordflow">return</span> 0;
00264         }
00265 
00266         ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o4">spwnd</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00267 
00268         <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00269 
00270             WORD timerIdInitial = <a class="code" href="../../d4/d2/timers_8c.html#a5">cTimerId</a>;
00271 
00272             <span class="comment">/*</span>
00273 <span class="comment">             * Pick a unique, unused timer ID.</span>
00274 <span class="comment">             */</span>
00275             <span class="keywordflow">do</span> {
00276 
00277                 <span class="keywordflow">if</span> (--<a class="code" href="../../d4/d2/timers_8c.html#a5">cTimerId</a> &lt;= <a class="code" href="../../d4/d2/timers_8c.html#a2">TIMERID_MIN</a>)
00278                     <a class="code" href="../../d4/d2/timers_8c.html#a5">cTimerId</a> = <a class="code" href="../../d4/d2/timers_8c.html#a1">TIMERID_MAX</a>;
00279 
00280                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/timers_8c.html#a5">cTimerId</a> == timerIdInitial) {
00281 
00282                     <span class="comment">/*</span>
00283 <span class="comment">                     * Flat out of timers bud.</span>
00284 <span class="comment">                     */</span>
00285                     <a class="code" href="../../d4/d1/userk_8h.html#a970">HMFreeObject</a>(ptmr);
00286                     <span class="keywordflow">return</span> 0;
00287                 }
00288 
00289             } <span class="keywordflow">while</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1721">FindTimer</a>(NULL, cTimerId, flags, FALSE) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00290 
00291             ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o5">nID</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d4/d2/timers_8c.html#a5">cTimerId</a>;
00292 
00293         } <span class="keywordflow">else</span> {
00294             ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o5">nID</a> = nIDEvent;
00295         }
00296 
00297         <span class="comment">/*</span>
00298 <span class="comment">         * Link the new timer into the front of the list.</span>
00299 <span class="comment">         * Handily this works even when gptmrFirst is NULL.</span>
00300 <span class="comment">         */</span>
00301         ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a>;
00302         ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00303         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a>)
00304             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a>-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o2">ptmrPrev</a> = ptmr;
00305         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a> = ptmr;
00306 
00307     } <span class="keywordflow">else</span> {
00308 
00309         <span class="comment">/*</span>
00310 <span class="comment">         * If this timer was just about to be processed,</span>
00311 <span class="comment">         * decrement cTimersReady since we're resetting it.</span>
00312 <span class="comment">         */</span>
00313         <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp; TMRF_READY)
00314             <a class="code" href="../../d4/d1/userk_8h.html#a1244">DecTimerCount</a>(ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a>);
00315     }
00316 
00317     <span class="comment">/*</span>
00318 <span class="comment">     * If pwnd is NULL, create a unique id by</span>
00319 <span class="comment">     * using the timer handle.  RIT timers are 'owned' by the RIT pti</span>
00320 <span class="comment">     * so they are not deleted when the creating pti dies.</span>
00321 <span class="comment">     *</span>
00322 <span class="comment">     * We used to record the pti as the pti of the window if one was</span>
00323 <span class="comment">     * specified.  This is not what Win 3.1 does and it broke 10862</span>
00324 <span class="comment">     * where some merge app was setting the timer on winword's window</span>
00325 <span class="comment">     * it it still expected to get the messages not winword.</span>
00326 <span class="comment">     *</span>
00327 <span class="comment">     * MS Visual C NT was counting on this bug in the NT 3.1 so if</span>
00328 <span class="comment">     * a thread sets a timer for a window in another thread in the</span>
00329 <span class="comment">     * same process the timer goes off in the thread of the window.</span>
00330 <span class="comment">     * You can see this by doing a build in msvcnt and the files being</span>
00331 <span class="comment">     * compiled do not show up.</span>
00332 <span class="comment">     */</span>
00333     ptiCurrent = (<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>)(W32GetCurrentThread()); <span class="comment">/*</span>
00334 <span class="comment">                                                        * This will be NULL</span>
00335 <span class="comment">                                                        * for a non-GUI thread.</span>
00336 <span class="comment">                                                        */</span>
00337 
00338     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00339 
00340         <span class="keywordflow">if</span> (flags &amp; TMRF_RIT) {
00341             ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a175">gptiRit</a>;
00342         } <span class="keywordflow">else</span> {
00343             ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a> = ptiCurrent;
00344             UserAssert(ptiCurrent);
00345         }
00346 
00347     } <span class="keywordflow">else</span> {
00348 
00349         <span class="comment">/*</span>
00350 <span class="comment">         * As enforced in the API wrappers.  We shouldn't get here</span>
00351 <span class="comment">         * any other way for an app timer.</span>
00352 <span class="comment">         *</span>
00353 <span class="comment">         * Always use pti of the window when TMRF_PTIWINDOW is passed in.</span>
00354 <span class="comment">         */</span>
00355         <span class="keywordflow">if</span> ((ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a796">TIF_16BIT</a>) &amp;&amp; !(flags &amp; TMRF_PTIWINDOW)) {
00356             ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a> = ptiCurrent;
00357             UserAssert(ptiCurrent);
00358         } <span class="keywordflow">else</span> {
00359             ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd);
00360         }
00361     }
00362 
00363     <span class="comment">/*</span>
00364 <span class="comment">     * Initialize the timer-struct.</span>
00365 <span class="comment">     *</span>
00366 <span class="comment">     * NOTE: The ptiOptCreator is used to identify a JOURNAL-timer.  We</span>
00367 <span class="comment">     *       want to allow these timers to be destroyed when the creator</span>
00368 <span class="comment">     *       thread goes away.  For other threads that create timers across</span>
00369 <span class="comment">     *       threads, we do not want to destroy these timers when the</span>
00370 <span class="comment">     *       creator goes away.  Currently, we're only checking for a</span>
00371 <span class="comment">     *       TMRF_RIT.  However, in the future we might want to add this</span>
00372 <span class="comment">     *       same check for TMRF_SYSTEM.</span>
00373 <span class="comment">     */</span>
00374     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o4">spwnd</a>), pwnd);
00375 
00376     ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o6">cmsCountdown</a>  = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o7">cmsRate</a> = dwElapse;
00377     ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a>         = flags | TMRF_INIT;
00378     ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o9">pfn</a>           = pTimerFunc;
00379     ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o10">ptiOptCreator</a> = (flags &amp; TMRF_RIT ? ptiCurrent : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00380 
00381     <span class="comment">/*</span>
00382 <span class="comment">     * Force the RIT to scan timers.</span>
00383 <span class="comment">     *</span>
00384 <span class="comment">     * N.B. The following code sets the raw input thread timer to expire</span>
00385 <span class="comment">     *      at the absolute time 1 which is very far into the past. This</span>
00386 <span class="comment">     *      causes the timer to immediately expire before the set timer</span>
00387 <span class="comment">     *      call returns.</span>
00388 <span class="comment">     */</span>
00389     <span class="keywordflow">if</span> (ptiCurrent == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a175">gptiRit</a>) {
00390         <span class="comment">/*</span>
00391 <span class="comment">         * Don't let RIT timer loop reset the master timer - we already have.</span>
00392 <span class="comment">         */</span>
00393         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a251">gbMasterTimerSet</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00394     }
00395 
00396     UserAssert(gptmrMaster);
00397     <a class="code" href="../../d3/d2/timerobj_8c.html#a6">KeSetTimer</a>(gptmrMaster, liT, NULL);
00398 
00399     <span class="comment">/*</span>
00400 <span class="comment">     * Windows 3.1 returns the timer ID if non-zero, otherwise it returns 1.</span>
00401 <span class="comment">     */</span>
00402     <span class="keywordflow">return</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o5">nID</a> == 0 ? 1 : ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o5">nID</a>);
00403 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="timers.c::JournalTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID JournalTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>nID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00661">661</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l03134">tagQ::msgJournal</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l01664">WakeSomeone()</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00693">SetJournalTimer()</a>.
<p>
<pre class="fragment"><div>00666 {
00667     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
00668 
00669     DBG_UNREFERENCED_PARAMETER(pwnd);
00670     DBG_UNREFERENCED_PARAMETER(message);
00671     DBG_UNREFERENCED_PARAMETER(nID);
00672 
00673     <span class="comment">/*</span>
00674 <span class="comment">     * We've already entered the critical section.</span>
00675 <span class="comment">     */</span>
00676     <span class="keywordflow">if</span> (pti = ((<a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a>)lParam)-&gt;ptiOptCreator)
00677         <a class="code" href="../../d4/d1/userk_8h.html#a1198">WakeSomeone</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>, pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o24">msgJournal</a>, NULL);
00678 
00679     <span class="keywordflow">return</span>;
00680 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="timers.c::KillTimer2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL KillTimer2           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>nIDEvent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fSystemTimer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00447">447</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00167">FindTimer()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00431">_KillSystemTimer()</a>, and <a class="el" href="../../d5/d1/timers_8c-source.html#l00414">_KillTimer()</a>.
<p>
<pre class="fragment"><div>00451 {
00452     <span class="comment">/*</span>
00453 <span class="comment">     * Call FindTimer() with fKill == TRUE.  This will</span>
00454 <span class="comment">     * basically delete the timer.</span>
00455 <span class="comment">     */</span>
00456     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1721">FindTimer</a>(pwnd,
00457                       nIDEvent,
00458                       (fSystemTimer ? TMRF_SYSTEM : 0),
00459                       TRUE) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00460 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="timers.c::SetJournalTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SetJournalTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msgJournal</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00693">693</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d8/d3/conexts_8c-source.html#l00650">dt()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>, <a class="el" href="../../d5/d1/timers_8c-source.html#l00661">JournalTimer()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l02802">xxxGetNextSysMsg()</a>.
<p>
<pre class="fragment"><div>00696 {
00697     <span class="keyword">static</span> UINT_PTR idJournal = 0;
00698 
00699     <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;msgJournal = msgJournal;
00700 
00701     <span class="comment">/*</span>
00702 <span class="comment">     * Remember idJournal - because TMRF_ONESHOT timers stay in the timer</span>
00703 <span class="comment">     * list - by remembering the idJournal, we always reuse the same timer</span>
00704 <span class="comment">     * rather than creating new ones always.</span>
00705 <span class="comment">     */</span>
00706     idJournal = <a class="code" href="../../d4/d1/userk_8h.html#a1044">InternalSetTimer</a>(NULL,
00707                                  idJournal,
00708                                  dt,
00709                                  JournalTimer,
00710                                  TMRF_RIT | TMRF_ONESHOT);
00711 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="timers.c::StartTimers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT_PTR StartTimers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00722">722</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00446">xxxHungAppDemon()</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/ntinput_8c-source.html#l03858">RawInputThread()</a>.
<p>
<pre class="fragment"><div>00723 {
00724     <span class="comment">/*</span>
00725 <span class="comment">     * Let GDI know that it can start settings timers on the RIT.</span>
00726 <span class="comment">     */</span>
00727     GreStartTimers();
00728 
00729     <span class="comment">/*</span>
00730 <span class="comment">     * TMRF_RIT timers are called directly from ScanTimers -- no nasty</span>
00731 <span class="comment">     * thread switching for these boys.</span>
00732 <span class="comment">     */</span>
00733     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1044">InternalSetTimer</a>(NULL, 0, 1000, xxxHungAppDemon, TMRF_RIT);
00734 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="timers.c::TimersProc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID TimersProc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00746">746</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l04051">tagTIMER::cmsCountdown</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04052">tagTIMER::cmsRate</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06972">ComputePastTickDelta()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03347">tagTHREADINFO::cTimersReady</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00201">EnterCrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04053">tagTIMER::flags</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00669">gbMasterTimerSet</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00668">gcmsLastTimer</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00668">gdmsNextTimer</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00666">gptmrFirst</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00667">gptmrMaster</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01477">HMIsMarkDestroy</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00243">KeSetTimer()</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00202">LeaveCrit</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04050">tagTIMER::nID</a>, <a class="el" href="../../d0/d5/gettickc_8c-source.html#l00026">NtGetTickCount()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04054">tagTIMER::pfn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04048">tagTIMER::pti</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04046">tagTIMER::ptmrNext</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04578">SetWakeBit()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d2/d0/bench_8c-source.html#l01433">WM_SYSTIMER</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/ntinput_8c-source.html#l03858">RawInputThread()</a>.
<p>
<pre class="fragment"><div>00748 {
00749     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>            dmsSinceLast;
00750     LARGE_INTEGER  liT;
00751     <a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a>         ptmr;
00752     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          cmsCur;
00753 
00754     <span class="comment">/*</span>
00755 <span class="comment">     * Calculate how long it was since the last time we</span>
00756 <span class="comment">     * processed timers so we can subtract that much time</span>
00757 <span class="comment">     * from each timer's countdown value.</span>
00758 <span class="comment">     */</span>
00759     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
00760 
00761     cmsCur = <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>();
00762     dmsSinceLast = <a class="code" href="../../d4/d1/userk_8h.html#a2021">ComputePastTickDelta</a>(cmsCur, gcmsLastTimer);
00763     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a250">gcmsLastTimer</a> = cmsCur;
00764 
00765     <span class="comment">/*</span>
00766 <span class="comment">     * dmsNextTimer is the time delta before the next</span>
00767 <span class="comment">     * timer should go off.  As we loop through the</span>
00768 <span class="comment">     * timers below this will shrink to the smallest</span>
00769 <span class="comment">     * cmsCountdown value in the list.</span>
00770 <span class="comment">     */</span>
00771     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a249">gdmsNextTimer</a> = 0x7FFFFFFF;
00772     ptmr = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a247">gptmrFirst</a>;
00773     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a251">gbMasterTimerSet</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00774     <span class="keywordflow">while</span> (ptmr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00775 
00776         <span class="comment">/*</span>
00777 <span class="comment">         * ONESHOT timers go to a WAITING state after</span>
00778 <span class="comment">         * they go off. This allows us to leave them</span>
00779 <span class="comment">         * in the list but keep them from going off</span>
00780 <span class="comment">         * over and over.</span>
00781 <span class="comment">         */</span>
00782         <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp; TMRF_WAITING) {
00783             ptmr = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00784             <span class="keywordflow">continue</span>;
00785         }
00786 
00787         <span class="comment">/*</span>
00788 <span class="comment">         * The first time we encounter a timer we don't</span>
00789 <span class="comment">         * want to set it off, we just want to use it to</span>
00790 <span class="comment">         * compute the shortest countdown value.</span>
00791 <span class="comment">         */</span>
00792         <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp; TMRF_INIT) {
00793             ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp;= ~TMRF_INIT;
00794 
00795         } <span class="keywordflow">else</span> {
00796             <span class="comment">/*</span>
00797 <span class="comment">             * If this timer is going off, wake up its</span>
00798 <span class="comment">             * owner.</span>
00799 <span class="comment">             */</span>
00800             ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o6">cmsCountdown</a> -= dmsSinceLast;
00801             <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o6">cmsCountdown</a> &lt;= 0) {
00802                 ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o6">cmsCountdown</a> = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o7">cmsRate</a>;
00803 
00804                 <span class="comment">/*</span>
00805 <span class="comment">                 * If the timer's owner hasn't handled the</span>
00806 <span class="comment">                 * last time it went off yet, throw this event</span>
00807 <span class="comment">                 * away.</span>
00808 <span class="comment">                 */</span>
00809                 <span class="keywordflow">if</span> (!(ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp; TMRF_READY)) {
00810                     <span class="comment">/*</span>
00811 <span class="comment">                     * A ONESHOT timer goes into a WAITING state</span>
00812 <span class="comment">                     * until SetTimer is called again to reset it.</span>
00813 <span class="comment">                     */</span>
00814                     <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp; TMRF_ONESHOT)
00815                         ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> |= TMRF_WAITING;
00816 
00817                     <span class="comment">/*</span>
00818 <span class="comment">                     * RIT timers have the distinction of being</span>
00819 <span class="comment">                     * called directly and executing serially with</span>
00820 <span class="comment">                     * with incoming timer events.</span>
00821 <span class="comment">                     * NOTE: RIT timers get called while we're</span>
00822 <span class="comment">                     * inside the critical section.</span>
00823 <span class="comment">                     */</span>
00824                     <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> &amp; TMRF_RIT) {
00825                         <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlTimer;
00826 
00827                         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(ptmr, &amp;tlTimer);
00828                         <span class="comment">/*</span>
00829 <span class="comment">                         * May set gbMasterTimerSet</span>
00830 <span class="comment">                         */</span>
00831                         (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o9">pfn</a>)(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00832                                     <a class="code" href="../../d1/d1/bench_8c.html#a4">WM_SYSTIMER</a>,
00833                                     ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o5">nID</a>,
00834                                     (LPARAM)ptmr);
00835 
00836                         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a438">HMIsMarkDestroy</a>(ptmr)) {
00837                             ptmr = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00838                             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlTimer);
00839                             <span class="keywordflow">continue</span>;
00840                         }
00841                         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlTimer);
00842 
00843                     } <span class="keywordflow">else</span> {
00844                         ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a> |= TMRF_READY;
00845                         ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a>-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o20">cTimersReady</a>++;
00846                         <a class="code" href="../../d4/d1/userk_8h.html#a1197">SetWakeBit</a>(ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a>, QS_TIMER);
00847                     }
00848                 }
00849             }
00850         }
00851 
00852         <span class="comment">/*</span>
00853 <span class="comment">         * Remember the shortest time left of the timers.</span>
00854 <span class="comment">         */</span>
00855         <span class="keywordflow">if</span> (ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o6">cmsCountdown</a> &lt; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a249">gdmsNextTimer</a>)
00856             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a249">gdmsNextTimer</a> = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o6">cmsCountdown</a>;
00857 
00858         <span class="comment">/*</span>
00859 <span class="comment">         * Advance to the next timer structure.</span>
00860 <span class="comment">         */</span>
00861         ptmr = ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>;
00862     }
00863 
00864     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a251">gbMasterTimerSet</a>) {
00865         <span class="comment">/*</span>
00866 <span class="comment">         * Time in NT should be negative to specify a relative</span>
00867 <span class="comment">         * time. It's also in hundred nanosecond units so multiply</span>
00868 <span class="comment">         * by 10000  to get the right value from milliseconds.</span>
00869 <span class="comment">         */</span>
00870         liT.QuadPart = Int32x32To64(-10000, gdmsNextTimer);
00871         <a class="code" href="../../d3/d2/timerobj_8c.html#a6">KeSetTimer</a>(gptmrMaster, liT, NULL);
00872     }
00873 
00874     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00875 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="timers.c::xxxSystemTimerProc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxSystemTimerProc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00882">882</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
References <a class="el" href="../../d5/d1/timers_8c-source.html#l00431">_KillSystemTimer()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l00981">_PostMessage()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00984">AnimateFade()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03592">tagDCE::DCX_flags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02586">DF_TRACKMOUSEHOVER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02650">tagDESKTOP::dwDTFlags</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l02251">GetActiveTrackPwnd()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l03267">GetMouseKeyFlags()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02671">tagDESKTOP::htEx</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06704">HTEXMENUFIRST</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06710">HTEXMENULAST</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06697">HTEXSCROLLFIRST</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06703">HTEXSCROLLLAST</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00328">IDSYS_FADE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00301">IDSYS_FLASHWND</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00327">IDSYS_LAYER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00303">IDSYS_MOUSEHOVER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00300">IDSYS_WNDTRACKING</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02197">tagDISPLAYINFO::pdceFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03585">tagDCE::pdceNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03321">tagTHREADINFO::pq</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00118">PtInRect()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03032">QF_ACTIVEWNDTRACKING</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03129">tagQ::QF_flags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03002">QF_MOUSEMOVED</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01839">tagWND::rcClient</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02672">tagDESKTOP::rcMouseHover</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03327">tagTHREADINFO::rpdesk</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04578">SetWakeBit()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02670">tagDESKTOP::spwndTrack</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05262">TestUP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00141">UpdateLayeredSprite()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l00027">xxxFlashWindow()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sprite_8c-source.html#l00020">IncrementRedirectedCount()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l02653">ResetMouseHover()</a>, <a class="el" href="../../d9/d3/sprite_8c-source.html#l00879">StartFade()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l00027">xxxFlashWindow()</a>, and <a class="el" href="../../d2/d3/tooltips_8c-source.html#l00904">xxxTrackMouseMove()</a>.
<p>
<pre class="fragment"><div>00883 {
00884     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00885     UNREFERENCED_PARAMETER(msg);
00886     UNREFERENCED_PARAMETER(<span class="keywordtype">id</span>);
00887     UNREFERENCED_PARAMETER(lParam);
00888 
00889     <span class="keywordflow">switch</span> (<span class="keywordtype">id</span>) {
00890         <span class="keywordflow">case</span> <a class="code" href="../../d1/d0/inc_2user_8h.html#a39">IDSYS_LAYER</a>: {
00891             <a class="code" href="../../d3/d2/structtagDCE.html">PDCE</a> pdce;
00892             
00893             <span class="keywordflow">for</span> (pdce = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o9">pdceFirst</a>; pdce != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; pdce = pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o0">pdceNext</a>) {
00894 
00895                 <span class="keywordflow">if</span> (pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; (DCX_INVALID | DCX_DESTROYTHIS))
00896                     <span class="keywordflow">continue</span>;
00897 
00898                 <span class="keywordflow">if</span> ((pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; DCX_LAYERED) &amp;&amp; (pdce-&gt;<a class="code" href="../../d3/d2/structtagDCE.html#o7">DCX_flags</a> &amp; DCX_INUSE)) {
00899                     <a class="code" href="../../d4/d1/userk_8h.html#a1986">UpdateLayeredSprite</a>(pdce);
00900                 }
00901             }
00902         }
00903         <span class="keywordflow">return</span>;
00904 
00905         <span class="keywordflow">case</span> <a class="code" href="../../d1/d0/inc_2user_8h.html#a40">IDSYS_FADE</a>:
00906             <a class="code" href="../../d8/d4/sprite_8c.html#a23">AnimateFade</a>();
00907             <span class="keywordflow">return</span>;
00908 
00909         <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a47">IDSYS_FLASHWND</a>:
00910             <a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a2">xxxFlashWindow</a>(pwnd, FLASHW_TIMERCALL, 0);
00911             <span class="keywordflow">return</span>;
00912 
00913         <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a46">IDSYS_WNDTRACKING</a>: {
00914             <span class="comment">/*</span>
00915 <span class="comment">             * If the active track window hasn't changed,</span>
00916 <span class="comment">             *  it's time to active it.</span>
00917 <span class="comment">             * spwndTrack can be NULL if it got destroyed but we haven't</span>
00918 <span class="comment">             *  destroyed the timer.yet</span>
00919 <span class="comment">             */</span>
00920             <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd);
00921             UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a563">TestUP</a>(ACTIVEWINDOWTRACKING));
00922 
00923             <span class="keywordflow">if</span> ((pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o21">spwndTrack</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00924                     &amp;&amp; (pwnd == <a class="code" href="../../d4/d1/userk_8h.html#a1654">GetActiveTrackPwnd</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o21">spwndTrack</a>, NULL))) {
00925 
00926                 pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a> |= (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a870">QF_ACTIVEWNDTRACKING</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a860">QF_MOUSEMOVED</a>);
00927 
00928 <span class="preprocessor">#ifdef REDIRECTION</span>
00929 <span class="preprocessor"></span>                <span class="comment">/*</span>
00930 <span class="comment">                 * Should we call the hit test hook here ?</span>
00931 <span class="comment">                 */</span>
00932                 PushMouseMove(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor);
00933 <span class="preprocessor">#endif // REDIRECTION</span>
00934 <span class="preprocessor"></span>                
00935                 <a class="code" href="../../d4/d1/userk_8h.html#a1197">SetWakeBit</a>(pti, QS_MOUSEMOVE);
00936             }
00937         }
00938         <span class="keywordflow">break</span>;
00939 
00940         <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a49">IDSYS_MOUSEHOVER</a>: {
00941             <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd);
00942             <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesk = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>;
00943             <span class="comment">/*</span>
00944 <span class="comment">             * If hover hasn't been canceled, the mouse is still on</span>
00945 <span class="comment">             *  this window and the point is still on the rect, then</span>
00946 <span class="comment">             *  it's hover time!</span>
00947 <span class="comment">             */</span>
00948             <span class="keywordflow">if</span> ((pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o4">dwDTFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a293">DF_TRACKMOUSEHOVER</a>)
00949                     &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o21">spwndTrack</a>)
00950                     &amp;&amp; <a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o23">rcMouseHover</a>, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor))) {
00951 
00952                 <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> message;
00953                 WPARAM wParam;
00954                 POINT pt = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor;
00955 
00956                 <span class="keywordflow">if</span> (pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o22">htEx</a> == HTCLIENT) {
00957                     message = WM_MOUSEHOVER;
00958                     wParam = (WPARAM)<a class="code" href="../../d4/d1/userk_8h.html#a1641">GetMouseKeyFlags</a>(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>);
00959 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00960 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL)) {
00961                         pt.x = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right - pt.x - 1;
00962                     } <span class="keywordflow">else</span>
00963 <span class="preprocessor">#endif</span>
00964 <span class="preprocessor"></span>                    {
00965                         pt.x -= pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left;
00966                     }
00967                     pt.y -= pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top;
00968                 } <span class="keywordflow">else</span> {
00969                     message = WM_NCMOUSEHOVER;
00970                     <span class="comment">/*</span>
00971 <span class="comment">                     * Map the extended hit test code to a public one.</span>
00972 <span class="comment">                     */</span>
00973                     wParam = (WPARAM)LOWORD(pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o22">htEx</a>);
00974                     <span class="keywordflow">if</span> ((wParam &gt;= <a class="code" href="../../d4/d1/userk_8h.html#a674">HTEXMENUFIRST</a>) &amp;&amp; (wParam &lt;= <a class="code" href="../../d4/d1/userk_8h.html#a680">HTEXMENULAST</a>)) {
00975                         wParam = (WPARAM)HTMENU;
00976                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((wParam &gt;= <a class="code" href="../../d4/d1/userk_8h.html#a667">HTEXSCROLLFIRST</a>) &amp;&amp; (wParam &lt;= <a class="code" href="../../d4/d1/userk_8h.html#a673">HTEXSCROLLLAST</a>)) {
00977                         wParam = (WPARAM)(HIWORD(pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o22">htEx</a>) ? HTVSCROLL : HTHSCROLL);
00978                     }
00979                 }
00980 
00981                 <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(pwnd, message, wParam, MAKELPARAM(pt.x, pt.y));
00982 
00983                 pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o4">dwDTFlags</a> &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a293">DF_TRACKMOUSEHOVER</a>;
00984                 <span class="keywordflow">break</span>;
00985             }
00986         }
00987         <span class="keywordflow">return</span>;
00988 
00989 
00990         <span class="keywordflow">default</span>:
00991             RIPMSG1(RIP_ERROR, <span class="stringliteral">"xxxSystemTimerProc: unexpected id:%#lx"</span>, <span class="keywordtype">id</span>);
00992             <span class="keywordflow">break</span>;
00993     }
00994 
00995     <span class="comment">/*</span>
00996 <span class="comment">     * if we fell through, the timer got to go</span>
00997 <span class="comment">     */</span>
00998     <a class="code" href="../../d4/d1/userk_8h.html#a1567">_KillSystemTimer</a>(pwnd, <span class="keywordtype">id</span>);
00999     <span class="keywordflow">return</span>;
01000 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a5" doxytag="timers.c::cTimerId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WORD <a class="el" href="../../d4/d2/timers_8c.html#a5">cTimerId</a> = TIMERID_MAX          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d1/timers_8c-source.html#l00034">34</a> of file <a class="el" href="../../d5/d1/timers_8c-source.html">timers.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/timers_8c-source.html#l00225">InternalSetTimer()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:46 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
