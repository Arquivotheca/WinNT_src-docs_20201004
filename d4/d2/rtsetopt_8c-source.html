<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rtsetopt.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>rtsetopt.c</h1><a href="../../d3/d3/rtsetopt_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    rtsetopt.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    NT level registry api test program, basic non-error paths.</span>
00012 <span class="comment"></span>
00013 <span class="comment">    This program attempts to force all cases through the various</span>
00014 <span class="comment">    optimizations in the NtSetValueKey code.</span>
00015 <span class="comment"></span>
00016 <span class="comment">    This is a whitebox test intended force system errors (crashes)</span>
00017 <span class="comment">    when run.  Returned values are not very interesting.</span>
00018 <span class="comment"></span>
00019 <span class="comment">    rtsetopt &lt;root of test tree&gt;</span>
00020 <span class="comment"></span>
00021 <span class="comment">    Example:</span>
00022 <span class="comment"></span>
00023 <span class="comment">        rtsetopt \registry\machine\software\test</span>
00024 <span class="comment"></span>
00025 <span class="comment">    Named key must already exist.</span>
00026 <span class="comment"></span>
00027 <span class="comment"></span>
00028 <span class="comment">Author:</span>
00029 <span class="comment"></span>
00030 <span class="comment">    Bryan Willman (bryanwi)  17-Nov-92</span>
00031 <span class="comment"></span>
00032 <span class="comment">Revision History:</span>
00033 <span class="comment"></span>
00034 <span class="comment">--*/</span>
00035 
00036 <span class="preprocessor">#include "<a class="code" href="../../d1/d2/cmp_8h.html">cmp.h</a>"</span>
00037 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00038 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00039 <span class="preprocessor">#include &lt;string.h&gt;</span>
00040 
<a name="l00041"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a0">00041</a> <span class="preprocessor">#define WORK_SIZE   1024</span>
00042 <span class="preprocessor"></span>
00043 <span class="keywordtype">void</span> __cdecl <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(<span class="keywordtype">int</span>, <span class="keywordtype">char</span> **);
00044 <span class="keywordtype">void</span> <a class="code" href="../../d8/d0/rtbatcr_8c.html#a13">processargs</a>();
00045 
<a name="l00046"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a1">00046</a> ULONG           <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a> = 0;
00047 
<a name="l00048"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a2">00048</a> UNICODE_STRING  <a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>;
00049 
<a name="l00050"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a3">00050</a> UCHAR           <a class="code" href="../../d3/d3/rtsetopt_8c.html#a3">TestData</a>[] =
00051 <span class="stringliteral">"This is some test data, it is short. But long enough for most of our tests."</span>;
00052 
<a name="l00053"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a4">00053</a> UNICODE_STRING  <a class="code" href="../../d8/d0/rtbatcr_8c.html#a10">WorkName</a>;
<a name="l00054"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a5">00054</a> WCHAR           <a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[2 * <a class="code" href="../../d1/d2/cmp_8h.html#a70">CM_MAX_STASH</a>];
00055 
<a name="l00056"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a6">00056</a> LONG    <a class="code" href="../../d3/d3/rtsetopt_8c.html#a6">testvector0</a>[] = { 0, 3, 4, 5, -1 };
00057 
<a name="l00058"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a7">00058</a> LONG    <a class="code" href="../../d3/d3/rtsetopt_8c.html#a7">testvector1</a>[] = { 0, 0, 3, 0, 4, 0, 5, 0, 3, 3, 4, 3, 5, 3,
00059                           4, 4, 5, 4, 5, 5, -1 };
00060 
<a name="l00061"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a8">00061</a> LONG    <a class="code" href="../../d3/d3/rtsetopt_8c.html#a8">testvector2</a>[] = { 8, 6, 8, 32,
00062                           <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>-1, <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>+1,
00063                           -1 };
00064 
<a name="l00065"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a9">00065</a> LONG    <a class="code" href="../../d3/d3/rtsetopt_8c.html#a9">testvector3</a>[] = { <a class="code" href="../../d1/d2/cmp_8h.html#a70">CM_MAX_STASH</a>, <a class="code" href="../../d1/d2/cmp_8h.html#a70">CM_MAX_STASH</a>-1, <a class="code" href="../../d1/d2/cmp_8h.html#a70">CM_MAX_STASH</a>,
00066                           <a class="code" href="../../d1/d2/cmp_8h.html#a70">CM_MAX_STASH</a>+1, -1 };
00067 
<a name="l00068"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a10">00068</a> PLONG   <a class="code" href="../../d3/d3/rtsetopt_8c.html#a10">supervector</a>[] = { &amp;(<a class="code" href="../../d3/d3/rtsetopt_8c.html#a7">testvector1</a>[0]), &amp;(<a class="code" href="../../d3/d3/rtsetopt_8c.html#a8">testvector2</a>[1]),
00069                           &amp;(<a class="code" href="../../d3/d3/rtsetopt_8c.html#a9">testvector3</a>[0]), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> };
00070 
00071 
00072 <span class="keywordtype">void</span>
<a name="l00073"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a11">00073</a> __cdecl <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(
00074     <span class="keywordtype">int</span> argc,
00075     <span class="keywordtype">char</span> **argv
00076     )
00077 {
00078     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00079     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00080     HANDLE          BaseHandle;
00081     UNICODE_STRING  <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00082     ULONG   ResultLength;
00083     PKEY_VALUE_FULL_INFORMATION pvaluefull;
00084     PKEY_VALUE_PARTIAL_INFORMATION pvaluepart;
00085     ULONG   i;
00086     ULONG  index;
00087     LONG    testsize;
00088     PUCHAR  p;
00089     PLONG   activevector;
00090 
00091 
00092     <span class="keywordflow">for</span> (i = 0; i &lt; 2 * <a class="code" href="../../d1/d2/cmp_8h.html#a70">CM_MAX_STASH</a>; i++) {
00093         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[i] = <span class="charliteral">'e'</span>;
00094     }
00095 
00096     <span class="comment">//</span>
00097     <span class="comment">// Process args</span>
00098     <span class="comment">//</span>
00099     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a13">processargs</a>(argc, argv);
00100 
00101 
00102     <span class="comment">//</span>
00103     <span class="comment">// Open the specified keypath, punt on failure</span>
00104     <span class="comment">//</span>
00105     printf(<span class="stringliteral">"rtsetopt: starting\n"</span>);
00106 
00107     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a10">WorkName</a>.MaximumLength = <a class="code" href="../../d8/d0/rtbatcr_8c.html#a0">WORK_SIZE</a>;
00108     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a10">WorkName</a>.Length = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00109     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a10">WorkName</a>.Buffer = &amp;(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[0]);
00110 
00111     <a class="code" href="../../d2/d7/string_8c.html#a8">RtlCopyString</a>((PSTRING)&amp;<a class="code" href="../../d8/d0/rtbatcr_8c.html#a10">WorkName</a>, (PSTRING)&amp;<a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>);
00112 
00113     InitializeObjectAttributes(
00114         &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00115         &amp;<a class="code" href="../../d8/d0/rtbatcr_8c.html#a10">WorkName</a>,
00116         0,
00117         (HANDLE)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00118         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00119         );
00120     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Attributes |= OBJ_CASE_INSENSITIVE;
00121 
00122     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00123                 &amp;BaseHandle,
00124                 MAXIMUM_ALLOWED,
00125                 &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00126                 );
00127     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00128         printf(<span class="stringliteral">"line_%4d: abort %08lx\n"</span>, __LINE__,  status);
00129         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00130         <span class="keywordflow">goto</span> punt;
00131     }
00132 
00133 
00134     <span class="comment">//</span>
00135     <span class="comment">// Perform new value entry tests, with an empty list.</span>
00136     <span class="comment">//</span>
00137     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00138         &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00139         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"NewValueTest1"</span>
00140         );
00141 
00142     <span class="keywordflow">for</span> (index = 0; <a class="code" href="../../d3/d3/rtsetopt_8c.html#a6">testvector0</a>[index] != -1; index++) {
00143 
00144         testsize = <a class="code" href="../../d3/d3/rtsetopt_8c.html#a6">testvector0</a>[index];
00145 
00146         printf(<span class="stringliteral">"AT line_%4d: %d\n"</span>, __LINE__,  testsize);
00147 
00148         status = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00149                     BaseHandle,
00150                     &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00151                     1,
00152                     REG_BINARY,
00153                     &amp;(<a class="code" href="../../d3/d3/rtsetopt_8c.html#a3">TestData</a>[0]),
00154                     testsize
00155                     );
00156         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00157             printf(<span class="stringliteral">"line_%4d: %08lx\n"</span>, __LINE__,  status);
00158             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00159         }
00160 
00161         printf(<span class="stringliteral">"AT line_%4d: %d\n"</span>, __LINE__,  testsize);
00162         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d8/d0/rtbatcr_8c.html#a0">WORK_SIZE</a>; i++) <a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[i] = <span class="charliteral">'?'</span>;
00163         status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00164                     BaseHandle,
00165                     &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00166                     KeyValueFullInformation,
00167                     &amp;(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[0]),
00168                     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a0">WORK_SIZE</a>,
00169                     &amp;ResultLength
00170                     );
00171         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00172             printf(<span class="stringliteral">"line_%4d: %08lx\n"</span>, __LINE__,  status);
00173             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00174         }
00175 
00176         pvaluefull = (PKEY_VALUE_FULL_INFORMATION)(&amp;(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[0]));
00177         <span class="keywordflow">if</span> (pvaluefull-&gt;DataLength != testsize) {
00178             printf(<span class="stringliteral">"line_%4d: %08lx\n"</span>, __LINE__,  9999);
00179             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00180         }
00181 
00182 
00183         <span class="keywordflow">if</span> (testsize &gt; 0) {
00184             p = (PUCHAR)pvaluefull;
00185             p = p+pvaluefull-&gt;DataOffset;
00186             <span class="keywordflow">if</span> (p[2] != <span class="charliteral">'i'</span>) {
00187                 printf(<span class="stringliteral">"line_%4d: %08lx\n"</span>, __LINE__,  9999);
00188                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00189             }
00190         }
00191 
00192         printf(<span class="stringliteral">"AT line_%4d: %d\n"</span>, __LINE__,  testsize);
00193         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/rtsetopt_8c.html#a6">testvector0</a>[index+1] != -1) {
00194             status = <a class="code" href="../../d7/d7/ntapi_8c.html#a16">NtDeleteValueKey</a>(
00195                         BaseHandle,
00196                         &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>
00197                         );
00198             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00199                 printf(<span class="stringliteral">"line_%4d: abort %08lx\n"</span>, __LINE__,  status);
00200                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00201                 <span class="keywordflow">goto</span> punt;
00202             }
00203         }
00204     }
00205 
00206     <span class="comment">//</span>
00207     <span class="comment">// Perform new value entry tests, with a non empty list.</span>
00208     <span class="comment">//</span>
00209     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00210         &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00211         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"NewValueTest2"</span>
00212         );
00213 
00214     <span class="keywordflow">for</span> (index = 0; <a class="code" href="../../d3/d3/rtsetopt_8c.html#a6">testvector0</a>[index] != -1; index++) {
00215 
00216         testsize = <a class="code" href="../../d3/d3/rtsetopt_8c.html#a6">testvector0</a>[index];
00217 
00218         printf(<span class="stringliteral">"AT line_%4d: %d\n"</span>, __LINE__,  testsize);
00219         status = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00220                     BaseHandle,
00221                     &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00222                     1,
00223                     REG_BINARY,
00224                     &amp;(<a class="code" href="../../d3/d3/rtsetopt_8c.html#a3">TestData</a>[0]),
00225                     testsize
00226                     );
00227         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00228             printf(<span class="stringliteral">"line_%4d: %08lx\n"</span>, __LINE__,  status);
00229             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00230         }
00231 
00232         printf(<span class="stringliteral">"AT line_%4d: %d\n"</span>, __LINE__,  testsize);
00233         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d8/d0/rtbatcr_8c.html#a0">WORK_SIZE</a>; i++) <a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[i] = <span class="charliteral">'?'</span>;
00234         status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00235                     BaseHandle,
00236                     &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00237                     KeyValuePartialInformation,
00238                     &amp;(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[0]),
00239                     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a0">WORK_SIZE</a>,
00240                     &amp;ResultLength
00241                     );
00242         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00243             printf(<span class="stringliteral">"line_%4d: %08lx\n"</span>, __LINE__,  status);
00244             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00245         }
00246 
00247         pvaluepart = (PKEY_VALUE_PARTIAL_INFORMATION)(&amp;(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[0]));
00248         <span class="keywordflow">if</span> (pvaluepart-&gt;DataLength != testsize) {
00249             printf(<span class="stringliteral">"line_%4d: %08lx\n"</span>, __LINE__,  9999);
00250             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00251         }
00252 
00253 
00254         <span class="keywordflow">if</span> (testsize &gt; 0) {
00255             <span class="keywordflow">if</span> (pvaluepart-&gt;Data[2] != <span class="charliteral">'i'</span>) {
00256                 printf(<span class="stringliteral">"line_%4d: %08lx\n"</span>, __LINE__,  9999);
00257                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00258             }
00259         }
00260 
00261         printf(<span class="stringliteral">"AT line_%4d: %d\n"</span>, __LINE__,  testsize);
00262         status = <a class="code" href="../../d7/d7/ntapi_8c.html#a16">NtDeleteValueKey</a>(
00263                     BaseHandle,
00264                     &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>
00265                     );
00266         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00267             printf(<span class="stringliteral">"line_%4d: abort %08lx\n"</span>, __LINE__,  status);
00268             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00269             <span class="keywordflow">goto</span> punt;
00270         }
00271    }
00272 
00273 
00274     <span class="comment">//</span>
00275     <span class="comment">// Perform existing value entry tests, with all the relevent</span>
00276     <span class="comment">// size transitions.</span>
00277     <span class="comment">//</span>
00278     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00279         &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00280         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"NewValueTest3"</span>
00281         );
00282 
00283     <span class="keywordflow">for</span> (i = 0; i &lt; 2 * <a class="code" href="../../d1/d2/cmp_8h.html#a70">CM_MAX_STASH</a>; i++) {
00284         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[i] = <span class="charliteral">'e'</span>;
00285     }
00286 
00287     <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d3/d3/rtsetopt_8c.html#a10">supervector</a>[i] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; i++) {
00288 
00289         activevector = <a class="code" href="../../d3/d3/rtsetopt_8c.html#a10">supervector</a>[i];
00290 
00291         <span class="keywordflow">for</span> (index = 0; activevector[index] != -1; index++) {
00292 
00293             testsize = activevector[index];
00294 
00295             printf(<span class="stringliteral">"AT line_%4d: %d\n"</span>, __LINE__,  testsize);
00296             status = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00297                         BaseHandle,
00298                         &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00299                         1,
00300                         REG_BINARY,
00301                         &amp;(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[0]),
00302                         testsize
00303                         );
00304             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00305                 printf(<span class="stringliteral">"line_%4d: %08lx\n"</span>, __LINE__,  status);
00306                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00307             }
00308 
00309             printf(<span class="stringliteral">"AT line_%4d: %d\n"</span>, __LINE__,  testsize);
00310             status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00311                         BaseHandle,
00312                         &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00313                         KeyValuePartialInformation,
00314                         &amp;(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a11">workbuffer</a>[0]),
00315                         2 * <a class="code" href="../../d1/d2/cmp_8h.html#a70">CM_MAX_STASH</a>,
00316                         &amp;ResultLength
00317                         );
00318             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00319                 printf(<span class="stringliteral">"line_%4d: %08lx\n"</span>, __LINE__,  status);
00320                 <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00321             }
00322         }
00323     }
00324 
00325 
00326 punt:
00327     printf(<span class="stringliteral">"rtsetopt: %d failures\n"</span>, <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>);
00328     <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>);
00329 }
00330 
00331 
00332 <span class="keywordtype">void</span>
<a name="l00333"></a><a class="code" href="../../d3/d3/rtsetopt_8c.html#a13">00333</a> <a class="code" href="../../d8/d0/rtbatcr_8c.html#a13">processargs</a>(
00334     <span class="keywordtype">int</span> argc,
00335     <span class="keywordtype">char</span> *argv[]
00336     )
00337 {
00338     ANSI_STRING temp;
00339 
00340     <span class="keywordflow">if</span> (argc != 2)
00341     {
00342         printf(<span class="stringliteral">"Usage: %s &lt;KeyPath&gt;\n"</span>, argv[0]);
00343         <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(1);
00344     }
00345 
00346     <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(
00347         &amp;temp,
00348         argv[1]
00349         );
00350 
00351     <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(
00352         &amp;<a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>,
00353         &amp;temp,
00354         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00355         );
00356 
00357     <span class="keywordflow">return</span>;
00358 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:41 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
