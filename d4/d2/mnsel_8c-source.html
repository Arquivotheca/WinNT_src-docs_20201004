<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mnsel.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>mnsel.c</h1><a href="../../d3/d3/mnsel_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/**************************** Module Header ********************************\</span>
00002 <span class="comment">* Module Name: mnsel.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* Menu Selection Routines</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">*  10-10-90 JimA    Cleanup.</span>
00010 <span class="comment">*  03-18-91 IanJa   Window revalidation added</span>
00011 <span class="comment">\***************************************************************************/</span>
00012 
00013 <span class="preprocessor">#include "<a class="code" href="../../d0/d4/w32_2ntuser_2kernel_2precomp_8h.html">precomp.h</a>"</span>
00014 <span class="preprocessor">#pragma hdrstop</span>
00015 <span class="preprocessor"></span>
00016 <span class="comment">/***************************************************************************\</span>
00017 <span class="comment">* xxxSendMenuSelect</span>
00018 <span class="comment">*</span>
00019 <span class="comment">* !</span>
00020 <span class="comment">*</span>
00021 <span class="comment">* Revalidation notes:</span>
00022 <span class="comment">* o Assumes pMenuState-&gt;hwndMenu is non-NULL and valid</span>
00023 <span class="comment">*</span>
00024 <span class="comment">* Note: if pMenu==SMS_NOMENU, idx had better be MFMWFP_NOITEM!</span>
00025 <span class="comment">*</span>
00026 <span class="comment">* History:</span>
00027 <span class="comment">\***************************************************************************/</span>
00028 
<a name="l00029"></a><a class="code" href="../../d4/d1/userk_8h.html#a1389">00029</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d1/userk_8h.html#a1389">xxxSendMenuSelect</a>(
00030     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndNotify,
00031     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndMenu,
00032     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu,
00033     <span class="keywordtype">int</span> idx)
00034 {
00035     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cmd;       <span class="comment">// Menu ID if applicable.</span>
00036     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> flags;     <span class="comment">// MF_ values if any</span>
00037     MSG <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00038     <a class="code" href="../../d4/d1/structtagMENUSTATE.html">PMENUSTATE</a> pMenuState;
00039 
00040     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndNotify);
00041     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwndMenu);
00042 
00043 
00044     <span class="comment">/*</span>
00045 <span class="comment">     * We must be hacking or passing valid things.</span>
00046 <span class="comment">     */</span>
00047     UserAssert((pMenu != <a class="code" href="../../d4/d1/userk_8h.html#a551">SMS_NOMENU</a>) || (idx == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>));
00048 
00049 
00050     <span class="keywordflow">if</span> ((idx &gt;= 0) &amp;&amp; (pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a> &gt; (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)idx)) {
00051         <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem = &amp;(pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>[idx]);
00052 
00053         flags   = (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o0">fType</a>  &amp; MFT_OLDAPI_MASK) |
00054                   (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; MFS_OLDAPI_MASK);
00055 
00056         <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00057             flags |= MF_POPUP;
00058 
00059         flags &amp;= (~(MF_SYSMENU | MF_MOUSESELECT));
00060 
00061         <span class="comment">/*</span>
00062 <span class="comment">         * WARNING!</span>
00063 <span class="comment">         * Under Windows the menu handle was always returned but additionally</span>
00064 <span class="comment">         * if the menu was a pop-up the pop-up menu handle was returned</span>
00065 <span class="comment">         * instead of the ID.  In NT we don't have enough space for 2 handles</span>
00066 <span class="comment">         * and flags so if it is a pop-up we return the pop-up index</span>
00067 <span class="comment">         * and the main Menu handle.</span>
00068 <span class="comment">         */</span>
00069 
00070         <span class="keywordflow">if</span> (flags &amp; MF_POPUP)
00071             cmd = idx;      <span class="comment">// index of popup-menu</span>
00072         <span class="keywordflow">else</span>
00073             cmd = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o2">wID</a>;
00074 
00075         pMenuState = <a class="code" href="../../d4/d1/userk_8h.html#a1320">GetpMenuState</a>(pwndNotify);
00076         <span class="keywordflow">if</span> (pMenuState != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00077             <span class="keywordflow">if</span> (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o22">mnFocus</a> == <a class="code" href="../../d4/d1/userk_8h.html#a332">MOUSEHOLD</a>)
00078                 flags |= MF_MOUSESELECT;
00079 
00080             <span class="keywordflow">if</span> (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o2">fIsSysMenu</a>)
00081                 flags |= MF_SYSMENU;
00082 
00083         }
00084     } <span class="keywordflow">else</span> {
00085         <span class="comment">/*</span>
00086 <span class="comment">         * idx assumed to be MFMWFP_NOITEM</span>
00087 <span class="comment">         */</span>
00088         <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d1/userk_8h.html#a551">SMS_NOMENU</a>) {
00089 
00090             <span class="comment">/*</span>
00091 <span class="comment">             * Hack so we can send MenuSelect messages with MFMWFP_MAINMENU</span>
00092 <span class="comment">             * (loword(lparam)=-1) when the menu pops back up for the CBT people.</span>
00093 <span class="comment">             */</span>
00094             flags = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a775">MF_MAINMENU</a>;
00095         } <span class="keywordflow">else</span> {
00096             flags = 0;
00097         }
00098 
00099         cmd = 0;    <span class="comment">// so MAKELONG(cmd, flags) == MFMWFP_MAINMENU</span>
00100         pMenu = 0;
00101         idx = -1;   <span class="comment">// so that idx+1 == 0, meaning nothing for zzzWindowEvent()</span>
00102     }
00103 
00104     <span class="comment">/*</span>
00105 <span class="comment">     * Call msgfilter so help libraries can hook WM_MENUSELECT messages.</span>
00106 <span class="comment">     */</span>
00107     <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndNotify);
00108     <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.message = WM_MENUSELECT;
00109     <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.wParam = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)MAKELONG(cmd, flags);
00110     <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.lParam = (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pMenu);
00111     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1818">_CallMsgFilter</a>((LPMSG)&amp;<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>, MSGF_MENU)) {
00112         <a class="code" href="../../d4/d1/userk_8h.html#a1581">xxxSendNotifyMessage</a>(pwndNotify, WM_MENUSELECT, <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.wParam, <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.lParam);
00113     }
00114 
00115     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>() &amp;&amp; pwndMenu) {
00116         <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_OBJECT_FOCUS, pwndMenu,
00117                 ((pwndMenu != pwndNotify) ? OBJID_CLIENT : ((flags &amp; MF_SYSMENU) ? OBJID_SYSMENU : OBJID_MENU)),
00118                 idx+1, 0);
00119     }
00120 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:51 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
