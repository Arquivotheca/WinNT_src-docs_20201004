<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rare.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>rare.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d5/d4/rare_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a0">CALC_RESIZE</a>&nbsp;&nbsp;&nbsp;0x0001</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a1">CALC_FRAME</a>&nbsp;&nbsp;&nbsp;0x0002</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a2">CALC_MINIMIZE</a>&nbsp;&nbsp;&nbsp;0x0004</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a3">NORMALIZERECT_NORMAL</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a4">NORMALIZERECT_MAXIMIZED</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a5">NORMALIZERECT_FULLSCREEN</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a6">ppvi</a>&nbsp;&nbsp;&nbsp;(UPDWORDPointer(wFlag))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a7">uDataRead</a>&nbsp;&nbsp;&nbsp;((UINT)fWinIniChanged)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a8">DbgCheckVWPL</a>(foo)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a9">SnapshotMonitorRects</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a10">NormalizeRect</a> (LPRECT lprcDest, LPRECT lprcSrc, <a class="el" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a> pmrOld, int iOldMonitor, int codeFullScreen, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> style)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a11">_SetRipFlags</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRipFlags, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a12">_SetDbgTag</a> (int tag, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDBGTAGFlags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a13">UpdateWinIniInt</a> (PUNICODE_STRING pProfileUserName, UINT idSection, UINT wKeyNameId, int value)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a14">SetDesktopMetrics</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a15">xxxMetricsRecalc</a> (UINT wFlags, int dx, int dy, int dyCaption, int dyMenu)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a16">FindOldMonitor</a> (LPCRECT lprc, <a class="el" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a> pmr)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a17">xxxDesktopRecalc</a> (<a class="el" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a> pmrOld)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a> (PUNICODE_STRING pProfileUserName, WORD wKeyNameId, int iIniValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a19">SetWindowMetricFont</a> (PUNICODE_STRING pProfileUserName, UINT idKey, LPLOGFONT lplf)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a20">xxxSetAndDrawNCMetrics</a> (PUNICODE_STRING pProfileUserName, int clNewBorder, LPNONCLIENTMETRICS lpnc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a21">xxxSetAndDrawMinMetrics</a> (PUNICODE_STRING pProfileUserName, LPMINIMIZEDMETRICS lpmin)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a22">xxxSPISetNCMetrics</a> (PUNICODE_STRING pProfileUserName, LPNONCLIENTMETRICS lpnc, BOOL fAlterWinIni)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a23">xxxSPISetMinMetrics</a> (PUNICODE_STRING pProfileUserName, LPMINIMIZEDMETRICS lpmin, BOOL fAlterWinIni)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a24">SPISetIconMetrics</a> (PUNICODE_STRING pProfileUserName, LPICONMETRICS lpicon, BOOL fAlterWinIni)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a25">SPISetIconTitleFont</a> (PUNICODE_STRING pProfileUserName, LPLOGFONT lplf, BOOL fAlterWinIni)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a26">xxxSetSPIMetrics</a> (PUNICODE_STRING pProfileUserName, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> wFlag, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lParam, BOOL fAlterWinIni)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a27">SetFilterKeys</a> (PUNICODE_STRING pProfileUserName, LPFILTERKEYS pFilterKeys)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a28">SetMouseKeys</a> (PUNICODE_STRING pProfileUserName, LPMOUSEKEYS pMK)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a29">SetSoundSentry</a> (PUNICODE_STRING pProfileUserName, LPSOUNDSENTRY pSS)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a30">CalculateMouseSensitivity</a> (LONG lSens)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a31">xxxSystemParametersInfo</a> (UINT wFlag, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> wParam, PVOID lParam, UINT flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a32">_RegisterShellHookWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a33">_DeregisterShellHookWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a34">xxxSendMinRectMessages</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, RECT *lpRect)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a35">PostShellHookMessages</a> (UINT message, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a36">_ResetDblClk</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a37">SetMsgBox</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a38">xxxSimulateShiftF10</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a39">VWPLAdd</a> (<a class="el" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a> *ppvwpl, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwThreshhold)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a40">VWPLRemove</a> (<a class="el" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a> *ppvwpl, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/rare_8c.html#a41">VWPLNext</a> (<a class="el" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a> pvwpl, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndPrev, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *pnPrev)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="rare.c::CALC_FRAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CALC_FRAME&nbsp;&nbsp;&nbsp;0x0002          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00017">17</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00362">xxxMetricsRecalc()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00799">xxxSetAndDrawNCMetrics()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="rare.c::CALC_MINIMIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CALC_MINIMIZE&nbsp;&nbsp;&nbsp;0x0004          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00018">18</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00362">xxxMetricsRecalc()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00870">xxxSetAndDrawMinMetrics()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l00799">xxxSetAndDrawNCMetrics()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="rare.c::CALC_RESIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CALC_RESIZE&nbsp;&nbsp;&nbsp;0x0001          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00016">16</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00362">xxxMetricsRecalc()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l00799">xxxSetAndDrawNCMetrics()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="rare.c::DbgCheckVWPL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DbgCheckVWPL          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">foo&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l03904">3904</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l03916">VWPLAdd()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l04083">VWPLNext()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l04002">VWPLRemove()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="rare.c::NORMALIZERECT_FULLSCREEN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NORMALIZERECT_FULLSCREEN&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00025">25</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00605">xxxDesktopRecalc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="rare.c::NORMALIZERECT_MAXIMIZED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NORMALIZERECT_MAXIMIZED&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00024">24</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00103">NormalizeRect()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l00605">xxxDesktopRecalc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="rare.c::NORMALIZERECT_NORMAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NORMALIZERECT_NORMAL&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00023">23</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00103">NormalizeRect()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l00605">xxxDesktopRecalc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="rare.c::ppvi" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ppvi&nbsp;&nbsp;&nbsp;(UPDWORDPointer(wFlag))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01173">LoadCPUserPreferences()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="rare.c::uDataRead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define uDataRead&nbsp;&nbsp;&nbsp;((UINT)fWinIniChanged)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a33" doxytag="rare.c::_DeregisterShellHookWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _DeregisterShellHookWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l03655">3655</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02264">tagDESKTOPINFO::pvwplShellHook</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l04002">VWPLRemove()</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02383">WFSHELLHOOKWND</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>.
<p>
<pre class="fragment"><div>03655                                            {
03656     <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> pdeskinfo;
03657 
03658     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
03659         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03660 
03661     pdeskinfo = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo;
03662 
03663     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1871">VWPLRemove</a>(&amp;(pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o21">pvwplShellHook</a>), pwnd)) {
03664         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WFSHELLHOOKWND);
03665     }
03666     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03667 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="rare.c::_RegisterShellHookWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _RegisterShellHookWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l03628">3628</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02264">tagDESKTOPINFO::pvwplShellHook</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l03916">VWPLAdd()</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02383">WFSHELLHOOKWND</a>.
<p>
<pre class="fragment"><div>03628                                          {
03629     <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> pdeskinfo;
03630 
03631     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
03632         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03633 
03634     pdeskinfo = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo;
03635 
03636     <span class="comment">/*</span>
03637 <span class="comment">     * Add pwnd to the desktop's Volatile Window Pointer List (VWPL) of</span>
03638 <span class="comment">     * ShellHook windows. If this call initializes the VWPL, set the</span>
03639 <span class="comment">     * (re)allocation threshhold to 2 PWNDs (we know we never have more than</span>
03640 <span class="comment">     * 2 windows in this list anyway)</span>
03641 <span class="comment">     */</span>
03642     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1870">VWPLAdd</a>(&amp;(pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o21">pvwplShellHook</a>), pwnd, 2)) {
03643         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFSHELLHOOKWND);
03644         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03645     }
03646     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03647 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="rare.c::_ResetDblClk" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID _ResetDblClk           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l03768">3768</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>03769 {
03770     <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;timeDblClk = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
03771 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="rare.c::_SetDbgTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void _SetDbgTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwDBGTAGFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00287">287</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00173">COPY_FLAG</a>, and <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04500">NtUserSetDbgTag()</a>, and <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html#l00136">SetDbgTag()</a>.
<p>
<pre class="fragment"><div>00288 {
00289 <span class="preprocessor">#if DEBUGTAGS</span>
00290 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a> &amp;&amp; tag &lt; DBGTAG_Max &amp;&amp; !(dwDBGTAGFlags &amp; ~DBGTAG_VALIDUSERFLAGS)) {
00291         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a14">COPY_FLAG</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;adwDBGTAGFlags[tag], dwDBGTAGFlags, DBGTAG_VALIDUSERFLAGS);
00292     }
00293 <span class="preprocessor">#else</span>
00294 <span class="preprocessor"></span>    UNREFERENCED_PARAMETER(tag);
00295     UNREFERENCED_PARAMETER(dwDBGTAGFlags);
00296 <span class="preprocessor">#endif</span>
00297 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="rare.c::_SetRipFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID _SetRipFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwRipFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwPID</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00264">264</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01174">RIPF_VALIDUSERFLAGS</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01265">tagSERVERINFO::wRIPFlags</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01267">tagSERVERINFO::wRIPPID</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04490">NtUserSetRipFlags()</a>, and <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html#l00131">SetRipFlags()</a>.
<p>
<pre class="fragment"><div>00266 {
00267     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>) {
00268         <span class="keywordflow">if</span> ((dwRipFlags != (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1) &amp;&amp; !(dwRipFlags &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a398">RIPF_VALIDUSERFLAGS</a>)) {
00269             <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o0">wRIPFlags</a> = (WORD)((<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o0">wRIPFlags</a> &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a398">RIPF_VALIDUSERFLAGS</a>) | dwRipFlags);
00270         }
00271         <span class="keywordflow">if</span> (dwPID != (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1) {
00272             <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o2">wRIPPID</a> = (WORD)dwPID;
00273         }
00274     }
00275 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="rare.c::CalculateMouseSensitivity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG CalculateMouseSensitivity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lSens</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l01247">1247</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02445">xxxUpdatePerUserSystemParameters()</a>.
<p>
<pre class="fragment"><div>01274                :  Sensitivities are constrained to be between 1 and 20.
01275  */
01276 {
01277     LONG lSenFactor ;
01278 
01279     <span class="keywordflow">if</span>(lSens &lt;= 2)
01280        lSenFactor=lSens*256/32 ;
01281     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(lSens &gt;= 3 &amp;&amp; lSens &lt;= 10 )
01282        lSenFactor=(lSens-2)*256/8 ;
01283     <span class="keywordflow">else</span>
01284        lSenFactor=(lSens-6)*256/4 ;
01285 
01286     <span class="keywordflow">return</span> lSenFactor ;
01287 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="rare.c::FindOldMonitor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int FindOldMonitor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPCRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pmr</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00542">542</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l06207">tagMONITORRECTS::amp</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06206">tagMONITORRECTS::cMonitor</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, and <a class="el" href="../../d4/d5/rect_8c-source.html#l00191">IntersectRect()</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00605">xxxDesktopRecalc()</a>.
<p>
<pre class="fragment"><div>00543 {
00544     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       dwClosest;
00545     <span class="keywordtype">int</span>         iClosest, i;
00546     <span class="keywordtype">int</span>         cxRect, cyRect;
00547     <a class="code" href="../../d2/d2/structtagMONITORPOS.html">PMONITORPOS</a> pmp;
00548 
00549     iClosest = -1;
00550     dwClosest = 0;
00551 
00552     cxRect = (lprc-&gt;right - lprc-&gt;left);
00553     cyRect = (lprc-&gt;bottom - lprc-&gt;top);
00554 
00555     <span class="keywordflow">for</span> (i = 0, pmp = pmr-&gt;<a class="code" href="../../d3/d2/structtagMONITORRECTS.html#o1">amp</a>; i &lt; pmr-&gt;<a class="code" href="../../d3/d2/structtagMONITORRECTS.html#o0">cMonitor</a>; pmp++, i++)
00556     {
00557         RECT rcT;
00558 
00559         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/rect_8c.html#a8">IntersectRect</a>(&amp;rcT, lprc, &amp;pmp-&gt;rcMonitor))
00560         {
00561             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwT;
00562 
00563             <span class="comment">//</span>
00564             <span class="comment">// convert to width/height</span>
00565             <span class="comment">//</span>
00566             rcT.right -= rcT.left;
00567             rcT.bottom -= rcT.top;
00568 
00569             <span class="comment">//</span>
00570             <span class="comment">// if fully enclosed, we're done</span>
00571             <span class="comment">//</span>
00572             <span class="keywordflow">if</span> ((rcT.right == cxRect) &amp;&amp; (rcT.bottom == cyRect))
00573                 <span class="keywordflow">return</span> i;
00574 
00575             <span class="comment">//</span>
00576             <span class="comment">// use largest area</span>
00577             <span class="comment">//</span>
00578             dwT = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)rcT.right * (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)rcT.bottom;
00579             <span class="keywordflow">if</span> (dwT &gt; dwClosest)
00580             {
00581                 dwClosest = dwT;
00582                 iClosest = i;
00583             }
00584         }
00585     }
00586 
00587     <span class="keywordflow">return</span> iClosest;
00588 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="rare.c::NormalizeRect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> NormalizeRect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprcDest</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprcSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pmrOld</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>iOldMonitor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codeFullScreen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>style</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00103">103</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l06207">tagMONITORRECTS::amp</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00073">CopyOffsetRect()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02604">GetPrimaryMonitor()</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00165">InflateRect()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00624">MultDiv</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00024">NORMALIZERECT_MAXIMIZED</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00023">NORMALIZERECT_NORMAL</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00139">OffsetRect()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06201">tagMONITORPOS::pMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02157">tagMONITOR::rcMonitor</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06199">tagMONITORPOS::rcMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02158">tagMONITOR::rcWork</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l06200">tagMONITORPOS::rcWork</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00605">xxxDesktopRecalc()</a>.
<p>
<pre class="fragment"><div>00110 {
00111     LPCRECT     lprcOldMonitor;
00112     LPCRECT     lprcOldWork;
00113     LPRECT      lprcNewWork;
00114     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>    pMonitor;
00115     <span class="keywordtype">int</span>         cxOldMonitor;
00116     <span class="keywordtype">int</span>         cyOldMonitor;
00117     <span class="keywordtype">int</span>         cxNewMonitor;
00118     <span class="keywordtype">int</span>         cyNewMonitor;
00119     <span class="keywordtype">int</span>         dxOrg, dyOrg;
00120 
00121     <span class="comment">/*</span>
00122 <span class="comment">     * Track the window so it stays in the same place on the same monitor.</span>
00123 <span class="comment">     * If the old monitor is no longer active then pick a default.</span>
00124 <span class="comment">     */</span>
00125     <span class="keywordflow">if</span> ((pMonitor = pmrOld-&gt;<a class="code" href="../../d3/d2/structtagMONITORRECTS.html#o1">amp</a>[iOldMonitor].<a class="code" href="../../d2/d2/structtagMONITORPOS.html#o2">pMonitor</a>) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00126         pMonitor = <a class="code" href="../../d6/d0/usercli_8h.html#a793">GetPrimaryMonitor</a>();
00127     }
00128 
00129     lprcOldMonitor = &amp;pmrOld-&gt;<a class="code" href="../../d3/d2/structtagMONITORRECTS.html#o1">amp</a>[iOldMonitor].<a class="code" href="../../d2/d2/structtagMONITORPOS.html#o0">rcMonitor</a>;
00130     lprcOldWork = &amp;pmrOld-&gt;<a class="code" href="../../d3/d2/structtagMONITORRECTS.html#o1">amp</a>[iOldMonitor].<a class="code" href="../../d2/d2/structtagMONITORPOS.html#o1">rcWork</a>;
00131 
00132     <span class="comment">/*</span>
00133 <span class="comment">     * If is a fullscreen app just make it fullscreen at the new location.</span>
00134 <span class="comment">     */</span>
00135     <span class="keywordflow">if</span> (codeFullScreen != <a class="code" href="../../d4/d5/rare_8c.html#a3">NORMALIZERECT_NORMAL</a>) {
00136         LPCRECT lprcOldSnap, lprcNewSnap;
00137 
00138         <span class="comment">/*</span>
00139 <span class="comment">         * If it is a maximized window snap it to the work area.</span>
00140 <span class="comment">         * Otherwise it is a rude app so snap it to the screen.</span>
00141 <span class="comment">         */</span>
00142         <span class="keywordflow">if</span> (codeFullScreen == <a class="code" href="../../d4/d5/rare_8c.html#a4">NORMALIZERECT_MAXIMIZED</a>) {
00143             lprcOldSnap = lprcOldWork;
00144             lprcNewSnap = &amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>;
00145         } <span class="keywordflow">else</span> {
00146             lprcOldSnap = lprcOldMonitor;
00147             lprcNewSnap = &amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>;
00148         }
00149 
00150         lprcDest-&gt;left = lprcSrc-&gt;left +
00151             lprcNewSnap-&gt;left - lprcOldSnap-&gt;left;
00152 
00153         lprcDest-&gt;top = lprcSrc-&gt;top +
00154             lprcNewSnap-&gt;top - lprcOldSnap-&gt;top;
00155 
00156         lprcDest-&gt;right = lprcSrc-&gt;right +
00157             lprcNewSnap-&gt;right - lprcOldSnap-&gt;right;
00158 
00159         lprcDest-&gt;bottom = lprcSrc-&gt;bottom +
00160             lprcNewSnap-&gt;bottom - lprcOldSnap-&gt;bottom;
00161 
00162         <span class="keywordflow">goto</span> AllDone;
00163     }
00164 
00165     <span class="comment">/*</span>
00166 <span class="comment">     * Offset the window by the change in desktop origin.</span>
00167 <span class="comment">     */</span>
00168     dxOrg = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left - lprcOldMonitor-&gt;left;
00169     dyOrg = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.top - lprcOldMonitor-&gt;top;
00170 
00171     <span class="comment">/*</span>
00172 <span class="comment">     * Calculate the change in screen size (we need it in more than one place).</span>
00173 <span class="comment">     */</span>
00174     cxOldMonitor = lprcOldMonitor-&gt;right - lprcOldMonitor-&gt;left;
00175     cyOldMonitor = lprcOldMonitor-&gt;bottom - lprcOldMonitor-&gt;top;
00176     cxNewMonitor = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.right - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left;
00177     cyNewMonitor = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.bottom - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.top;
00178 
00179     <span class="comment">/*</span>
00180 <span class="comment">     * If the monitor resolution has changed (or we moved to a new monitor)</span>
00181 <span class="comment">     * then factor in the size change.</span>
00182 <span class="comment">     */</span>
00183     <span class="keywordflow">if</span> (cxNewMonitor != cxOldMonitor || cyNewMonitor != cyOldMonitor) {
00184         <span class="keywordtype">int</span> xWnd = lprcSrc-&gt;left - lprcOldMonitor-&gt;left;
00185         <span class="keywordtype">int</span> yWnd = lprcSrc-&gt;top - lprcOldMonitor-&gt;top;
00186 
00187         dxOrg += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(xWnd, cxNewMonitor - cxOldMonitor, cxOldMonitor);
00188         dyOrg += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(yWnd, cyNewMonitor - cyOldMonitor, cyOldMonitor);
00189     }
00190 
00191     <span class="comment">/*</span>
00192 <span class="comment">     * Compute the initial new position.</span>
00193 <span class="comment">     */</span>
00194     <a class="code" href="../../d3/d6/rect_8c.html#a3">CopyOffsetRect</a>(lprcDest, lprcSrc, dxOrg, dyOrg);
00195     lprcNewWork = &amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>;
00196 
00197     <span class="comment">/*</span>
00198 <span class="comment">     * Fit horizontally.  Try to fit so that the window isn't out of the</span>
00199 <span class="comment">     * working area horizontally.  Keep left edge visible always.</span>
00200 <span class="comment">     */</span>
00201     <span class="keywordflow">if</span> (lprcDest-&gt;right &gt; lprcNewWork-&gt;right) {
00202         <a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(lprcDest, lprcNewWork-&gt;right - lprcDest-&gt;right, 0);
00203     }
00204 
00205     <span class="keywordflow">if</span> (lprcDest-&gt;left &lt; lprcNewWork-&gt;left) {
00206         <a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(lprcDest, lprcNewWork-&gt;left - lprcDest-&gt;left, 0);
00207     }
00208 
00209     <span class="comment">/*</span>
00210 <span class="comment">     * Fit vertically.  Try to fit so that the window isn't out of the</span>
00211 <span class="comment">     * working area vertically.  Keep top edge visible always.</span>
00212 <span class="comment">     */</span>
00213     <span class="keywordflow">if</span> (lprcDest-&gt;bottom &gt; lprcNewWork-&gt;bottom) {
00214         <a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(lprcDest, 0, lprcNewWork-&gt;bottom - lprcDest-&gt;bottom);
00215     }
00216 
00217     <span class="keywordflow">if</span> (lprcDest-&gt;top &lt; lprcNewWork-&gt;top) {
00218         <a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(lprcDest, 0, lprcNewWork-&gt;top - lprcDest-&gt;top);
00219     }
00220 
00221     <span class="comment">/*</span>
00222 <span class="comment">     * If the window is sizeable then shrink it if necessary.</span>
00223 <span class="comment">     */</span>
00224     <span class="keywordflow">if</span> (style &amp; WS_THICKFRAME)
00225     {
00226         <span class="keywordtype">int</span> cSnap = 0;
00227 
00228         <span class="keywordflow">if</span> (lprcDest-&gt;right &gt; lprcNewWork-&gt;right) {
00229             lprcDest-&gt;right = lprcNewWork-&gt;right;
00230             cSnap++;
00231         }
00232 
00233         <span class="keywordflow">if</span> (lprcDest-&gt;bottom &gt; lprcNewWork-&gt;bottom) {
00234             lprcDest-&gt;bottom = lprcNewWork-&gt;bottom;
00235             cSnap++;
00236         }
00237 
00238 
00239         <span class="comment">/*</span>
00240 <span class="comment">         * Now make sure we didn't turn this normal window into a</span>
00241 <span class="comment">         * fullscreen window.  This is a complete hack but it is much</span>
00242 <span class="comment">         * better than changing from 800x600 to 640x480 and ending up with</span>
00243 <span class="comment">         * a bunch of fullscreen apps...</span>
00244 <span class="comment">         */</span>
00245         <span class="keywordflow">if</span> (cSnap == 2) {
00246             <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(lprcDest, -1, -1);
00247         }
00248     }
00249 
00250 AllDone:
00251     <span class="keywordflow">return</span> pMonitor;
00252 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="rare.c::PostShellHookMessages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void PostShellHookMessages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l03719">3719</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l00981">_PostMessage()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02345">GETDESKINFO</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00198">glinp</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00787">guiOtherWindowCreated</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00788">guiOtherWindowDestroyed</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03262">tagLASTINPUT::ptiLastWoken</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02264">tagDESKTOPINFO::pvwplShellHook</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02163">tagDESKTOPINFO::spwndProgman</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01302">tagSERVERINFO::uiShellMsg</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l04083">VWPLNext()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00114">xxxDesktopThread()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">xxxDestroyWindow()</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l04773">xxxEndDeferWindowPosEx()</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l00027">xxxFlashWindow()</a>, <a class="el" href="../../d1/d4/ntuser_2kernel_2getset_8c-source.html#l00499">xxxHandleOwnerSwitch()</a>, <a class="el" href="../../d5/d8/minmax_8c-source.html#l01329">xxxMinMaximize()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l03772">xxxProcessEventMessage()</a>, <a class="el" href="../../d2/d1/drawfrm_8c-source.html#l00205">xxxRedrawFrameAndHook()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00766">xxxRedrawTitle()</a>, <a class="el" href="../../d9/d6/winloop2_8c-source.html#l00100">xxxSetTrayWindow()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>03719                                                         {
03720     <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> pdeskinfo = <a class="code" href="../../d4/d1/userk_8h.html#a256">GETDESKINFO</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>());
03721     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nPwndShellHook;
03722     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndShellHook;
03723 
03724     nPwndShellHook = 0;
03725     pwndShellHook = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03726 
03727     <span class="comment">/*</span>
03728 <span class="comment">     * Hack for WM_APPCOMMAND (bug 389210):</span>
03729 <span class="comment">     * We want to allow anyone who's listening for these wm_appcommand messages to be able to</span>
03730 <span class="comment">     * take the foreground. ie pressing mail will launch outlook AND bring it to the foreground</span>
03731 <span class="comment">     * We set the token to null so anyone can steal the foreground - else it isn't clear who should</span>
03732 <span class="comment">     * have the right to steal it - only one person gets the right. We let them fight it out to</span>
03733 <span class="comment">     * decide who gets foreground if more than one listener will try make a foreground change.</span>
03734 <span class="comment">     */</span>
03735     <span class="keywordflow">if</span> (HSHELL_APPCOMMAND == message) {
03736         TAGMSG0(DBGTAG_FOREGROUND, <span class="stringliteral">"PostShellHookMessages cleared last input token - open foreground."</span>);
03737 
03738         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o2">ptiLastWoken</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03739     }
03740 
03741     <span class="comment">/*</span>
03742 <span class="comment">     * Loop through all the windows registered to listen for shell hooks and post the message</span>
03743 <span class="comment">     * to them</span>
03744 <span class="comment">     */</span>
03745     <span class="keywordflow">while</span> (pwndShellHook = <a class="code" href="../../d4/d1/userk_8h.html#a1872">VWPLNext</a>(pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o21">pvwplShellHook</a>, pwndShellHook, &amp;nPwndShellHook)) {
03746         <span class="keywordflow">if</span> (pwndShellHook == pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o9">spwndProgman</a>) {
03747             <span class="keywordflow">switch</span> (message) {
03748             <span class="keywordflow">case</span> HSHELL_WINDOWCREATED:
03749                 <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(pwndShellHook, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o15">uiShellMsg</a>, guiOtherWindowCreated, lParam);
03750                 <span class="keywordflow">break</span>;
03751             <span class="keywordflow">case</span> HSHELL_WINDOWDESTROYED:
03752                 <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(pwndShellHook, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o15">uiShellMsg</a>, guiOtherWindowDestroyed, lParam);
03753                 <span class="keywordflow">break</span>;
03754             }
03755         } <span class="keywordflow">else</span> {
03756             <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(pwndShellHook, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o15">uiShellMsg</a>, message, lParam);
03757         }
03758     }
03759 
03760 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="rare.c::SetDesktopMetrics" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SetDesktopMetrics           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00336">336</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l02604">GetPrimaryMonitor()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02158">tagMONITOR::rcWork</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00622">SetNCMetrics()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00564">UpdateUserScreen()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>00337 {
00338     LPRECT      lprcWork;
00339 
00340     lprcWork = &amp;<a class="code" href="../../d6/d0/usercli_8h.html#a793">GetPrimaryMonitor</a>()-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>;
00341 
00342     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFULLSCREEN)      = lprcWork-&gt;right - lprcWork-&gt;left;
00343     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMAXIMIZED)       = lprcWork-&gt;right - lprcWork-&gt;left + 2*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZEFRAME);
00344 
00345     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYFULLSCREEN)      = lprcWork-&gt;bottom - lprcWork-&gt;top - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYCAPTION);
00346     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMAXIMIZED)       = lprcWork-&gt;bottom - lprcWork-&gt;top + 2*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZEFRAME);
00347 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="rare.c::SetFilterKeys" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetFilterKeys           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPFILTERKEYS&nbsp;</td>
          <td class="mdname" nowrap> <em>pFilterKeys</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l01118">1118</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00988">FastWriteProfileStringW()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l06855">PMAP_KEYBOARDRESPONSE</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>01120 {
01121     LPWSTR           pwszd = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"%d"</span>;
01122     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>             fWinIniChanged;
01123     WCHAR            szTemp[40];
01124 
01125     swprintf(szTemp, pwszd, pFilterKeys-&gt;dwFlags);
01126     fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01127             PMAP_KEYBOARDRESPONSE,
01128             L<span class="stringliteral">"Flags"</span>,
01129             szTemp
01130             );
01131 
01132     swprintf(szTemp, pwszd, pFilterKeys-&gt;iWaitMSec);
01133     fWinIniChanged &amp;= <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01134             PMAP_KEYBOARDRESPONSE,
01135             L<span class="stringliteral">"DelayBeforeAcceptance"</span>,
01136             szTemp
01137             );
01138 
01139     swprintf(szTemp, pwszd, pFilterKeys-&gt;iDelayMSec);
01140     fWinIniChanged &amp;= <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01141             PMAP_KEYBOARDRESPONSE,
01142             L<span class="stringliteral">"AutoRepeatDelay"</span>,
01143             szTemp
01144             );
01145 
01146     swprintf(szTemp, pwszd, pFilterKeys-&gt;iRepeatMSec);
01147     fWinIniChanged &amp;= <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01148             PMAP_KEYBOARDRESPONSE,
01149             L<span class="stringliteral">"AutoRepeatRate"</span>,
01150             szTemp
01151             );
01152 
01153     swprintf(szTemp, pwszd, pFilterKeys-&gt;iBounceMSec);
01154     fWinIniChanged &amp;= <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01155             PMAP_KEYBOARDRESPONSE,
01156             L<span class="stringliteral">"BounceTime"</span>,
01157             szTemp
01158             );
01159 
01160     <span class="keywordflow">return</span> fWinIniChanged;
01161 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="rare.c::SetMouseKeys" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetMouseKeys           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPMOUSEKEYS&nbsp;</td>
          <td class="mdname" nowrap> <em>pMK</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l01170">1170</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00988">FastWriteProfileStringW()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l06856">PMAP_MOUSEKEYS</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>01172 {
01173     LPWSTR           pwszd = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"%d"</span>;
01174     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>             fWinIniChanged;
01175     WCHAR            szTemp[40];
01176 
01177     swprintf(szTemp, pwszd, pMK-&gt;dwFlags);
01178     fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01179             PMAP_MOUSEKEYS,
01180             L<span class="stringliteral">"Flags"</span>,
01181             szTemp
01182             );
01183 
01184     swprintf(szTemp, pwszd, pMK-&gt;iMaxSpeed);
01185     fWinIniChanged &amp;= <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01186             PMAP_MOUSEKEYS,
01187             L<span class="stringliteral">"MaximumSpeed"</span>,
01188             szTemp
01189             );
01190 
01191     swprintf(szTemp, pwszd, pMK-&gt;iTimeToMaxSpeed);
01192     fWinIniChanged &amp;= <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01193             PMAP_MOUSEKEYS,
01194             L<span class="stringliteral">"TimeToMaximumSpeed"</span>,
01195             szTemp
01196             );
01197 
01198     <span class="keywordflow">return</span> fWinIniChanged;
01199 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="rare.c::SetMsgBox" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SetMsgBox           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l03779">3779</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02266">WFMSGBOX</a>.
<p>
<pre class="fragment"><div>03780 {
03781     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;cntMBox++;
03782     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WFMSGBOX);
03783     <span class="keywordflow">return</span>;
03784 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="rare.c::SetSoundSentry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetSoundSentry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSOUNDSENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>pSS</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l01208">1208</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00988">FastWriteProfileStringW()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l06859">PMAP_SOUNDSENTRY</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>01210 {
01211     LPWSTR           pwszd = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"%d"</span>;
01212     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>             fWinIniChanged;
01213     WCHAR            szTemp[40];
01214 
01215     swprintf(szTemp, pwszd, pSS-&gt;dwFlags);
01216     fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01217             PMAP_SOUNDSENTRY,
01218             L<span class="stringliteral">"Flags"</span>,
01219             szTemp
01220             );
01221 
01222     swprintf(szTemp, pwszd, pSS-&gt;iFSTextEffect);
01223     fWinIniChanged &amp;= <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01224             PMAP_SOUNDSENTRY,
01225             L<span class="stringliteral">"TextEffect"</span>,
01226             szTemp
01227             );
01228 
01229     swprintf(szTemp, pwszd, pSS-&gt;iWindowsEffect);
01230     fWinIniChanged &amp;= <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
01231             PMAP_SOUNDSENTRY,
01232             L<span class="stringliteral">"WindowsEffect"</span>,
01233             szTemp
01234             );
01235 
01236     <span class="keywordflow">return</span> fWinIniChanged;
01237 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="rare.c::SetWindowMetricFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetWindowMetricFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPLOGFONT&nbsp;</td>
          <td class="mdname" nowrap> <em>lplf</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00777">777</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01115">FastWriteProfileValue()</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l06863">PMAP_METRICS</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00979">SPISetIconMetrics()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01014">SPISetIconTitleFont()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l00907">xxxSPISetNCMetrics()</a>.
<p>
<pre class="fragment"><div>00781 {
00782     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a2012">FastWriteProfileValue</a>(
00783             pProfileUserName,
00784             PMAP_METRICS,
00785             (LPWSTR)UIntToPtr( idKey ),
00786             REG_BINARY,
00787             (LPBYTE)lplf,
00788             <span class="keyword">sizeof</span>(LOGFONTW)
00789             );
00790 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="rare.c::SetWindowMetricInt" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetWindowMetricInt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>wKeyNameId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>iIniValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00734">734</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00624">MultDiv</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06863">PMAP_METRICS</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l00306">UpdateWinIniInt()</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00979">SPISetIconMetrics()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01067">xxxSetSPIMetrics()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00948">xxxSPISetMinMetrics()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00907">xxxSPISetNCMetrics()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>00738 {
00739     <span class="comment">/*</span>
00740 <span class="comment">     * If you change the below list of STR_* make sure you make a corresponding</span>
00741 <span class="comment">     * change in FastGetProfileIntFromID (profile.c)</span>
00742 <span class="comment">     */</span>
00743     <span class="keywordflow">switch</span> (wKeyNameId) {
00744     <span class="keywordflow">case</span> STR_BORDERWIDTH:
00745     <span class="keywordflow">case</span> STR_SCROLLWIDTH:
00746     <span class="keywordflow">case</span> STR_SCROLLHEIGHT:
00747     <span class="keywordflow">case</span> STR_CAPTIONWIDTH:
00748     <span class="keywordflow">case</span> STR_CAPTIONHEIGHT:
00749     <span class="keywordflow">case</span> STR_SMCAPTIONWIDTH:
00750     <span class="keywordflow">case</span> STR_SMCAPTIONHEIGHT:
00751     <span class="keywordflow">case</span> STR_MENUWIDTH:
00752     <span class="keywordflow">case</span> STR_MENUHEIGHT:
00753     <span class="keywordflow">case</span> STR_ICONHORZSPACING:
00754     <span class="keywordflow">case</span> STR_ICONVERTSPACING:
00755     <span class="keywordflow">case</span> STR_MINWIDTH:
00756     <span class="keywordflow">case</span> STR_MINHORZGAP:
00757     <span class="keywordflow">case</span> STR_MINVERTGAP:
00758       <span class="comment">/*</span>
00759 <span class="comment">       * Always store window metrics in TWIPS</span>
00760 <span class="comment">       */</span>
00761         iIniValue = -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(iIniValue, 72*20, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dmLogPixels);
00762         <span class="keywordflow">break</span>;
00763     }
00764 
00765       <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(pProfileUserName,
00766                              PMAP_METRICS,
00767                              wKeyNameId,
00768                              iIniValue);
00769 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="rare.c::SnapshotMonitorRects" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a> SnapshotMonitorRects           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00040">40</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l06207">tagMONITORRECTS::amp</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06206">tagMONITORRECTS::cMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02201">tagDISPLAYINFO::cMonitors</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00243">CopyRect</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02156">tagMONITOR::dwMONFlags</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00432">HdevFromMonitor()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02054">MONF_VISIBLE</a>, <a class="el" href="../../d4/d1/userk_8h.html#a935">MONITORPOS</a>, <a class="el" href="../../d4/d1/userk_8h.html#a937">MONITORRECTS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06201">tagMONITORPOS::pMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02203">tagDISPLAYINFO::pMonitorFirst</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02067">tagMONITOR::pMonitorNext</a>, <a class="el" href="../../d4/d1/userk_8h.html#a936">PMONITORPOS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06199">tagMONITORPOS::rcMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02157">tagMONITOR::rcMonitor</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06200">tagMONITORPOS::rcWork</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02158">tagMONITOR::rcWork</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>00041 {
00042     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>        pMonitor;
00043     <a class="code" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a>   pmr;
00044     <a class="code" href="../../d2/d2/structtagMONITORPOS.html">PMONITORPOS</a>     pmp;
00045 <span class="preprocessor">#if DBG</span>
00046 <span class="preprocessor"></span>    ULONG           cVisMon = 0;
00047 <span class="preprocessor">#endif</span>
00048 <span class="preprocessor"></span>
00049     pmr = UserAllocPool(
00050             <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d2/structtagMONITORRECTS.html">MONITORRECTS</a>) + <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d2/structtagMONITORPOS.html">MONITORPOS</a>) * (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o11">cMonitors</a> - 1),
00051             TAG_MONITORRECTS);
00052 
00053     <span class="keywordflow">if</span> (!pmr) {
00054         RIPERR0(ERROR_OUTOFMEMORY, RIP_WARNING, <span class="stringliteral">"Out of memory in SnapshotMonitorRects"</span>);
00055         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00056     }
00057 
00058     pmp = pmr-&gt;<a class="code" href="../../d3/d2/structtagMONITORRECTS.html#o1">amp</a>;
00059     <span class="keywordflow">for</span> (   pMonitor = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o13">pMonitorFirst</a>;
00060             pMonitor;
00061             pMonitor = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o1">pMonitorNext</a>) {
00062 
00063         <span class="keywordflow">if</span> (!(pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o2">dwMONFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a525">MONF_VISIBLE</a>))
00064             <span class="keywordflow">continue</span>;
00065 <span class="preprocessor">#if DBG</span>
00066 <span class="preprocessor"></span>        cVisMon++;
00067 <span class="preprocessor">#endif</span>
00068 <span class="preprocessor"></span>
00069         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;pmp-&gt;<a class="code" href="../../d2/d2/structtagMONITORPOS.html#o0">rcMonitor</a>, &amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>);
00070         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;pmp-&gt;<a class="code" href="../../d2/d2/structtagMONITORPOS.html#o1">rcWork</a>,    &amp;pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>);
00071 
00072         <span class="comment">/*</span>
00073 <span class="comment">         * If the device for this monitor object is not active, don't store</span>
00074 <span class="comment">         * the pointer to it in the list.  This way the windows on the inactive</span>
00075 <span class="comment">         * monitor will be later moved to the default one.</span>
00076 <span class="comment">         */</span>
00077         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a2081">HdevFromMonitor</a>(pMonitor) == -1) {
00078             pmp-&gt;<a class="code" href="../../d2/d2/structtagMONITORPOS.html#o2">pMonitor</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00079         } <span class="keywordflow">else</span> {
00080             pmp-&gt;<a class="code" href="../../d2/d2/structtagMONITORPOS.html#o2">pMonitor</a> = pMonitor;
00081         }
00082 
00083         pmp++;
00084     }
00085     UserAssert(cVisMon == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o11">cMonitors</a>);
00086 
00087     pmr-&gt;<a class="code" href="../../d3/d2/structtagMONITORRECTS.html#o0">cMonitor</a> = (<span class="keywordtype">int</span>)(pmp - pmr-&gt;<a class="code" href="../../d3/d2/structtagMONITORRECTS.html#o1">amp</a>);
00088 
00089     <span class="keywordflow">return</span> pmr;
00090 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="rare.c::SPISetIconMetrics" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SPISetIconMetrics           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPICONMETRICS&nbsp;</td>
          <td class="mdname" nowrap> <em>lpicon</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAlterWinIni</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00979">979</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l01213">SetIconMetrics()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00777">SetWindowMetricFont()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00734">SetWindowMetricInt()</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l03863">xxxRedrawScreen</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01067">xxxSetSPIMetrics()</a>.
<p>
<pre class="fragment"><div>00983 {
00984     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fWriteAllowed = !fAlterWinIni;
00985     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00986 
00987     <span class="keywordflow">if</span> (fAlterWinIni) {
00988         fChanged  = <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_ICONHORZSPACING, (<span class="keywordtype">int</span>) lpicon-&gt;iHorzSpacing);
00989         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_ICONVERTSPACING, (<span class="keywordtype">int</span>) lpicon-&gt;iVertSpacing);
00990         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_ICONTITLEWRAP,   (<span class="keywordtype">int</span>) lpicon-&gt;iTitleWrap);
00991         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a19">SetWindowMetricFont</a>(pProfileUserName,STR_ICONFONT,             &amp;lpicon-&gt;lfFont);
00992 
00993         fWriteAllowed = fChanged;
00994     }
00995 
00996     <span class="keywordflow">if</span> (fWriteAllowed) {
00997 
00998         <a class="code" href="../../d4/d1/userk_8h.html#a1858">SetIconMetrics</a>(pProfileUserName,lpicon);
00999 
01000         <a class="code" href="../../d4/d1/userk_8h.html#a470">xxxRedrawScreen</a>();
01001     }
01002 
01003     <span class="keywordflow">return</span> fChanged;
01004 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="rare.c::SPISetIconTitleFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SPISetIconTitleFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPLOGFONT&nbsp;</td>
          <td class="mdname" nowrap> <em>lplf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAlterWinIni</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l01014">1014</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1855">CreateFontFromWinIni()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00327">ghIconFont</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00098">lf</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00777">SetWindowMetricFont()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01067">xxxSetSPIMetrics()</a>.
<p>
<pre class="fragment"><div>01018 {
01019     HFONT hfnT;
01020     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  fWriteAllowed = !fAlterWinIni;
01021     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  fWinIniChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01022 
01023     <span class="keywordflow">if</span> (hfnT = <a class="code" href="../../d4/d1/userk_8h.html#a1855">CreateFontFromWinIni</a>(pProfileUserName,lplf, STR_ICONFONT)) {
01024         <span class="keywordflow">if</span> (fAlterWinIni) {
01025 
01026             <span class="keywordflow">if</span> (lplf) {
01027                 LOGFONT <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
01028 
01029                 GreExtGetObjectW(hfnT, <span class="keyword">sizeof</span>(LOGFONTW), &amp;lf);
01030                 fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a19">SetWindowMetricFont</a>(pProfileUserName,STR_ICONFONT, &amp;lf);
01031             } <span class="keywordflow">else</span> {
01032                 <span class="comment">/*</span>
01033 <span class="comment">                 * !lParam so go back to current win.ini settings so</span>
01034 <span class="comment">                 */</span>
01035                 fWinIniChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01036             }
01037 
01038             fWriteAllowed = fWinIniChanged;
01039         }
01040 
01041         <span class="keywordflow">if</span> (fWriteAllowed) {
01042 
01043             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a148">ghIconFont</a>) {
01044                 GreMarkDeletableFont(ghIconFont);
01045                 GreDeleteObject(ghIconFont);
01046             }
01047 
01048             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a148">ghIconFont</a> = hfnT;
01049 
01050         } <span class="keywordflow">else</span> {
01051             GreMarkDeletableFont(hfnT);
01052             GreDeleteObject(hfnT);
01053         }
01054     }
01055 
01056     <span class="keywordflow">return</span> fWinIniChanged;
01057 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="rare.c::UpdateWinIniInt" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UpdateWinIniInt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idSection</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wKeyNameId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>value</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00306">306</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00988">FastWriteProfileStringW()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00734">hModuleWin</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l02272">ServerLoadString</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00734">SetWindowMetricInt()</a>, <a class="el" href="../../d6/d7/ntimm_8c-source.html#l02606">xxxSetIMEShowStatus()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>00311 {
00312     WCHAR szTemp[40];
00313     WCHAR            szKeyName[40];
00314     swprintf(szTemp, L<span class="stringliteral">"%d"</span>, value);
00315 
00316     <a class="code" href="../../d4/d1/userk_8h.html#a248">ServerLoadString</a>(hModuleWin,
00317                          wKeyNameId,
00318                          szKeyName,
00319                          <span class="keyword">sizeof</span>(szKeyName) / <span class="keyword">sizeof</span>(WCHAR));
00320 
00321     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
00322                                    idSection,
00323                                    szKeyName,
00324                                    szTemp);
00325 
00326 
00327 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="rare.c::VWPLAdd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL VWPLAdd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppvwpl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwThreshhold</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l03916">3916</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l03904">DbgCheckVWPL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00057">PWND</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l03628">_RegisterShellHookWindow()</a>, and <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00026">SetHungFlag()</a>.
<p>
<pre class="fragment"><div>03920 {
03921     <a class="code" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a> pvwpl;
03922     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ixPwnd;
03923 
03924     TAGMSG2(DBGTAG_VWPL, <span class="stringliteral">"VWPL %#p + %#p"</span>, *ppvwpl, pwnd);
03925     UserAssert(pwnd);
03926 
03927     <span class="keywordflow">if</span> (*ppvwpl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03928         <span class="comment">/*</span>
03929 <span class="comment">         * Initialize the VWPL</span>
03930 <span class="comment">         */</span>
03931         UserAssert(dwThreshhold &gt;= 2); <span class="comment">// could be 1, but that would be silly</span>
03932         pvwpl = (<a class="code" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a>)UserAllocPool(
03933                 <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d2/structVWPL.html">VWPL</a>) + (<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>) * dwThreshhold), TAG_VWPL);
03934         <span class="keywordflow">if</span> (pvwpl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03935             RIPMSG1(RIP_WARNING,
03936                     <span class="stringliteral">"VWPLAdd fail to allocate initial %lx"</span>,
03937                     <span class="keyword">sizeof</span>(VWPL) + (<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>) * dwThreshhold));
03938             <a class="code" href="../../d4/d5/rare_8c.html#a8">DbgCheckVWPL</a>(*ppvwpl);
03939             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03940         }
03941         pvwpl-&gt;cElem = dwThreshhold;
03942         pvwpl-&gt;cThreshhold = dwThreshhold;
03943 <span class="preprocessor">#if ZERO_INIT_VWPL</span>
03944 <span class="preprocessor"></span>        RtlZeroMemory(&amp;(pvwpl-&gt;aPwnd[0]), (<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>) * dwThreshhold));
03945 <span class="preprocessor">#endif</span>
03946 <span class="preprocessor"></span>        pvwpl-&gt;cPwnd = 0;
03947         *ppvwpl = pvwpl;
03948         ixPwnd = 0;
03949         <span class="keywordflow">goto</span> AddPwnd;
03950     } <span class="keywordflow">else</span> {
03951         pvwpl = *ppvwpl;
03952         <span class="keywordflow">for</span> (ixPwnd = 0; ixPwnd &lt; pvwpl-&gt;cElem; ixPwnd++) {
03953             <span class="keywordflow">if</span> (pwnd == pvwpl-&gt;aPwnd[ixPwnd]) {
03954                 <a class="code" href="../../d4/d5/rare_8c.html#a8">DbgCheckVWPL</a>(*ppvwpl);
03955                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>; <span class="comment">// callers require FALSE this case</span>
03956             }
03957         }
03958 
03959         <span class="keywordflow">if</span> (pvwpl-&gt;cPwnd &gt;= pvwpl-&gt;cElem ) {
03960             <span class="comment">/*</span>
03961 <span class="comment">             *  didn't find it already there, and no space so grow the VWPL</span>
03962 <span class="comment">             */</span>
03963             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
03964             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSizeNew;
03965 
03966             dwSize = <span class="keyword">sizeof</span>(VWPL) + (<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>) * pvwpl-&gt;cElem);
03967             dwSizeNew = dwSize + (<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>) * pvwpl-&gt;cThreshhold);
03968             pvwpl = (<a class="code" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a>)UserReAllocPool(pvwpl, dwSize, dwSizeNew, TAG_VWPL);
03969             <span class="keywordflow">if</span> (pvwpl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03970                 RIPMSG2(RIP_WARNING,
03971                         <span class="stringliteral">"VWPLAdd fail to reallocate %lx to %lx"</span>, dwSize, dwSizeNew);
03972                 <a class="code" href="../../d4/d5/rare_8c.html#a8">DbgCheckVWPL</a>(*ppvwpl);
03973                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03974             }
03975 <span class="preprocessor">#if ZERO_INIT_VWPL</span>
03976 <span class="preprocessor"></span>            RtlZeroMemory(&amp;(pvwpl-&gt;aPwnd[pvwpl-&gt;cPwnd]), (<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>) * dwThreshhold));
03977 <span class="preprocessor">#endif</span>
03978 <span class="preprocessor"></span>            pvwpl-&gt;cElem += pvwpl-&gt;cThreshhold;
03979             *ppvwpl = pvwpl;
03980         }
03981     }
03982 
03983 AddPwnd:
03984     ixPwnd = pvwpl-&gt;cPwnd;
03985     pvwpl-&gt;aPwnd[ixPwnd] = pwnd;
03986     pvwpl-&gt;cPwnd++;
03987     <a class="code" href="../../d4/d5/rare_8c.html#a8">DbgCheckVWPL</a>(*ppvwpl);
03988     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03989 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="rare.c::VWPLNext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> VWPLNext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pvwpl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwndPrev</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>pnPrev</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l04083">4083</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/rare_8c-source.html#l03904">DbgCheckVWPL</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l03719">PostShellHookMessages()</a>, <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00446">xxxHungAppDemon()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l03675">xxxSendMinRectMessages()</a>.
<p>
<pre class="fragment"><div>04084 {
04085     <a class="code" href="../../d4/d5/rare_8c.html#a8">DbgCheckVWPL</a>(pvwpl);
04086 
04087     <span class="keywordflow">if</span> (!pvwpl) {
04088         TAGMSG1(DBGTAG_VWPL, <span class="stringliteral">"VWPL %#p =&gt; NULL (empty)"</span>, pvwpl);
04089         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04090     }
04091 
04092     <span class="keywordflow">if</span> (*pnPrev &gt;= pvwpl-&gt;cPwnd) {
04093         <span class="keywordflow">goto</span> NoMorePwnds;
04094     }
04095 
04096     <span class="comment">/*</span>
04097 <span class="comment">     * If our previous pwnd is still there, advance to the next slot</span>
04098 <span class="comment">     * (else it has gone, so return the one now occupying its slot)</span>
04099 <span class="comment">     */</span>
04100     <span class="keywordflow">if</span> (pvwpl-&gt;aPwnd[*pnPrev] == pwndPrev) {
04101         (*pnPrev)++;
04102     }
04103 
04104     <span class="keywordflow">if</span> (*pnPrev &lt; pvwpl-&gt;cPwnd) {
04105         UserAssert(pvwpl-&gt;aPwnd[*pnPrev] != pwndPrev);
04106         TAGMSG2(DBGTAG_VWPL, <span class="stringliteral">"VWPL %#p =&gt; %#p"</span>, pvwpl, pvwpl-&gt;aPwnd[*pnPrev]);
04107         <span class="keywordflow">return</span> pvwpl-&gt;aPwnd[*pnPrev];
04108     }
04109 
04110     <span class="comment">/*</span>
04111 <span class="comment">     * We came to the end</span>
04112 <span class="comment">     */</span>
04113 NoMorePwnds:
04114     TAGMSG1(DBGTAG_VWPL, <span class="stringliteral">"VWPL %#p =&gt; NULL (end)"</span>, pvwpl);
04115     *pnPrev = 0;
04116     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04117 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="rare.c::VWPLRemove" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL VWPLRemove           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppvwpl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l04002">4002</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l03904">DbgCheckVWPL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l03655">_DeregisterShellHookWindow()</a>, and <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00057">ClearHungFlag()</a>.
<p>
<pre class="fragment"><div>04005 {
04006     <a class="code" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a> pvwpl = *ppvwpl;
04007     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ixPwnd;
04008 
04009     TAGMSG2(DBGTAG_VWPL, <span class="stringliteral">"VWPL %#p - %#p"</span>, *ppvwpl, pwnd);
04010     UserAssert(pwnd);
04011 
04012     <span class="keywordflow">if</span> (!pvwpl) {
04013         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04014     }
04015     <span class="keywordflow">for</span> (ixPwnd = 0; ixPwnd &lt; pvwpl-&gt;cElem; ixPwnd++) {
04016         <span class="keywordflow">if</span> (pwnd == pvwpl-&gt;aPwnd[ixPwnd]) {
04017             <span class="keywordflow">goto</span> PwndIsFound;
04018         }
04019     }
04020     <a class="code" href="../../d4/d5/rare_8c.html#a8">DbgCheckVWPL</a>(*ppvwpl);
04021     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04022 
04023 PwndIsFound:
04024     pvwpl-&gt;aPwnd[ixPwnd] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04025     pvwpl-&gt;cPwnd--;
04026 
04027     <span class="keywordflow">if</span> (pvwpl-&gt;cPwnd == 0) {
04028         UserFreePool(pvwpl);
04029         *ppvwpl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04030         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04031     }
04032 
04033     <span class="comment">/*</span>
04034 <span class="comment">     * Compact the VWPL to keep all the empty slots at the end.</span>
04035 <span class="comment">     * If these free slots exceeds the threshhold, realloc to shrink.</span>
04036 <span class="comment">     * It doesn't matter that we change the order.</span>
04037 <span class="comment">     */</span>
04038     pvwpl-&gt;aPwnd[ixPwnd] = pvwpl-&gt;aPwnd[pvwpl-&gt;cPwnd];
04039 <span class="preprocessor">#if ZERO_INIT_VWPL</span>
04040 <span class="preprocessor"></span>    pvwpl-&gt;aPwnd[pvwpl-&gt;cPwnd] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04041 <span class="preprocessor">#endif</span>
04042 <span class="preprocessor"></span>
04043 
04044     <span class="keywordflow">if</span> ((pvwpl-&gt;cElem - pvwpl-&gt;cPwnd) &gt;= pvwpl-&gt;cThreshhold) {
04045         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
04046         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSizeNew;
04047 
04048         <span class="comment">// Low memory may have made a shrinking realloc fail, which doesn't</span>
04049         <span class="comment">// really bother us.</span>
04050         <span class="comment">// UserAssert((pvwpl-&gt;cElem - pvwpl-&gt;cPwnd) == pvwpl-&gt;cThreshhold);</span>
04051 
04052         dwSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d2/structVWPL.html">VWPL</a>) + (<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>) * pvwpl-&gt;cElem);
04053         dwSizeNew = <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d2/structVWPL.html">VWPL</a>) + (<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>) * pvwpl-&gt;cPwnd);
04054         pvwpl = (<a class="code" href="../../d1/d0/inc_2user_8h.html#a1031">PVWPL</a>)UserReAllocPool(pvwpl, dwSize, dwSizeNew, TAG_VWPL);
04055         <span class="keywordflow">if</span> (pvwpl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04056             RIPMSG2(RIP_WARNING,
04057                     <span class="stringliteral">"VWPLRemove fail to reallocate %lx to %lx"</span>,
04058                     dwSize, dwSizeNew);
04059             <a class="code" href="../../d4/d5/rare_8c.html#a8">DbgCheckVWPL</a>(*ppvwpl);
04060             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04061         }
04062         pvwpl-&gt;cElem = pvwpl-&gt;cPwnd;
04063         *ppvwpl = pvwpl;
04064     }
04065 
04066     <a class="code" href="../../d4/d5/rare_8c.html#a8">DbgCheckVWPL</a>(*ppvwpl);
04067     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04068 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="rare.c::xxxDesktopRecalc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxDesktopRecalc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pmrOld</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00605">605</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d3/d7/swp_8c-source.html#l00365">_DeferWindowPos()</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00107">_GetDesktopWindow()</a>, <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06207">tagMONITORRECTS::amp</a>, <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00091">BuildHwndList()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03634">BWL_ENUMLIST</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00542">FindOldMonitor()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02922">tagCHECKPOINT::fMinInitialized</a>, <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00417">FreeHwndList()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01768">tagWND::hrgnClip</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02071">tagMONITOR::hrgnMonitor</a>, <a class="el" href="../../d3/d7/swp_8c-source.html#l00231">InternalBeginDeferWindowPos()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00103">NormalizeRect()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00025">NORMALIZERECT_FULLSCREEN</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00024">NORMALIZERECT_MAXIMIZED</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00023">NORMALIZERECT_NORMAL</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06522">PHWND</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03892">PROP_CHECKPOINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01722">PROPF_INTERNAL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02916">tagCHECKPOINT::rcNormal</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06200">tagMONITORPOS::rcWork</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03624">tagBWL::rghwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02364">WEFTOOLWINDOW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02311">WFFULLSCREEN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02323">WFMAXFAKEREGIONAL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02415">WFMAXIMIZED</a>, and <a class="el" href="../../d3/d7/swp_8c-source.html#l04773">xxxEndDeferWindowPosEx()</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/fullscr_8c-source.html#l01152">xxxResetDisplayDevice()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>00606 {
00607     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>            pwndDesktop;
00608     <a class="code" href="../../d8/d6/structtagSMWP.html">PSMWP</a>           psmwp;
00609     <a class="code" href="../../d4/d1/userk_8h.html#a944">PHWND</a>           phwnd;
00610     <a class="code" href="../../d4/d9/structtagBWL.html">PBWL</a>            pbwl;
00611     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>            pwnd;
00612     <a class="code" href="../../d0/d0/structtagCHECKPOINT.html">CHECKPOINT</a> *    pcp;
00613     <span class="keywordtype">int</span>             iOldMonitor;
00614     <span class="keywordtype">int</span>             codeFullScreen;
00615 
00616     UserVerify(pwndDesktop = <a class="code" href="../../d3/d9/client_2wow_8c.html#a3">_GetDesktopWindow</a>());
00617     <span class="keywordflow">if</span> ((pbwl = <a class="code" href="../../d4/d1/userk_8h.html#a1157">BuildHwndList</a>(pwndDesktop-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>, BWL_ENUMLIST, NULL)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00618         <span class="keywordflow">return</span>;
00619 
00620     <span class="keywordflow">if</span> ((psmwp = <a class="code" href="../../d4/d1/userk_8h.html#a1616">InternalBeginDeferWindowPos</a>(4)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00621         <span class="keywordflow">for</span> (phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>; *phwnd != (HWND)1 &amp;&amp; psmwp; phwnd++) {
00622             <span class="comment">/*</span>
00623 <span class="comment">             * Make sure this hwnd is still around.</span>
00624 <span class="comment">             */</span>
00625             <span class="keywordflow">if</span> (    (pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwnd)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00626                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTOOLWINDOW)) {
00627 
00628                 <span class="keywordflow">continue</span>;
00629             }
00630 
00631             codeFullScreen = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFFULLSCREEN) ?
00632                 <a class="code" href="../../d4/d5/rare_8c.html#a5">NORMALIZERECT_FULLSCREEN</a> : <a class="code" href="../../d4/d5/rare_8c.html#a3">NORMALIZERECT_NORMAL</a>;
00633 
00634             pcp = (<a class="code" href="../../d0/d0/structtagCHECKPOINT.html">CHECKPOINT</a> *)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, PROP_CHECKPOINT, PROPF_INTERNAL);
00635             <span class="keywordflow">if</span> (pcp) {
00636 
00637                 <span class="comment">/*</span>
00638 <span class="comment">                 * We don't need to blow away saved maximized positions</span>
00639 <span class="comment">                 * anymore, since the max position is always (for top level</span>
00640 <span class="comment">                 * windows) relative to the origin of the monitor's working</span>
00641 <span class="comment">                 * area.  And for child windows, we shouldn't do it period</span>
00642 <span class="comment">                 * anyway.</span>
00643 <span class="comment">                 */</span>
00644                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o6">fMinInitialized</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00645 
00646                 <span class="comment">/*</span>
00647 <span class="comment">                 * Figure out which monitor the position was on before things</span>
00648 <span class="comment">                 * got shuffled around and try to keep it on that monitor.  If</span>
00649 <span class="comment">                 * it was never visible on a monitor then leave it alone.</span>
00650 <span class="comment">                 */</span>
00651                 iOldMonitor = <a class="code" href="../../d4/d5/rare_8c.html#a16">FindOldMonitor</a>(&amp;pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>, pmrOld);
00652                 <span class="keywordflow">if</span> (iOldMonitor != (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)-1) {
00653                     <a class="code" href="../../d4/d5/rare_8c.html#a10">NormalizeRect</a>(
00654                             &amp;pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>,
00655                             &amp;pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>,
00656                             pmrOld,
00657                             iOldMonitor,
00658                             codeFullScreen,
00659                             pwnd-&gt;style);
00660                 }
00661             }
00662 
00663             <span class="comment">/*</span>
00664 <span class="comment">             * Figure out which monitor the position was on before things got</span>
00665 <span class="comment">             * shuffled around and try to keep it on that monitor.  If it</span>
00666 <span class="comment">             * was never visible on a monitor then leave it alone.</span>
00667 <span class="comment">             */</span>
00668 
00669             iOldMonitor = <a class="code" href="../../d4/d5/rare_8c.html#a16">FindOldMonitor</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, pmrOld);
00670             <span class="keywordflow">if</span> (iOldMonitor != -1) {
00671 
00672                 <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> pMonitorDst;
00673                 RECT rc;
00674 
00675                 <span class="comment">/*</span>
00676 <span class="comment">                 * Check for maximized apps that are truly maximized.</span>
00677 <span class="comment">                 * (As opposed to apps that manage their owm maximized rect.)</span>
00678 <span class="comment">                 */</span>
00679                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXIMIZED)) {
00680                     LPRECT lprcOldWork = &amp;pmrOld-&gt;<a class="code" href="../../d3/d2/structtagMONITORRECTS.html#o1">amp</a>[iOldMonitor].<a class="code" href="../../d2/d2/structtagMONITORPOS.html#o1">rcWork</a>;
00681 
00682                     <span class="keywordflow">if</span> (    (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left &gt;=
00683                                 lprcOldWork-&gt;right - lprcOldWork-&gt;left)
00684                             &amp;&amp;
00685                             (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top &gt;=
00686                                 lprcOldWork-&gt;bottom - lprcOldWork-&gt;top)) {
00687 
00688                         codeFullScreen = <a class="code" href="../../d4/d5/rare_8c.html#a4">NORMALIZERECT_MAXIMIZED</a>;
00689                     }
00690                 }
00691 
00692                 pMonitorDst = <a class="code" href="../../d4/d5/rare_8c.html#a10">NormalizeRect</a>(
00693                         &amp;rc,
00694                         &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>,
00695                         pmrOld,
00696                         iOldMonitor,
00697                         codeFullScreen,
00698                         pwnd-&gt;style);
00699 
00700                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXFAKEREGIONAL)) {
00701                     UserAssert(pMonitorDst-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o5">hrgnMonitor</a>);
00702                     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a> = pMonitorDst-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o5">hrgnMonitor</a>;
00703                 }
00704 
00705                 psmwp = <a class="code" href="../../d4/d1/userk_8h.html#a1619">_DeferWindowPos</a>(
00706                         psmwp,
00707                         pwnd,
00708                         (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)HWND_TOP,
00709                         rc.left,
00710                         rc.top,
00711                         rc.right - rc.left,
00712                         rc.bottom - rc.top,
00713                         SWP_NOACTIVATE | SWP_NOZORDER);
00714             }
00715         }
00716 
00717         <span class="keywordflow">if</span> (psmwp) {
00718             <a class="code" href="../../d4/d1/userk_8h.html#a1620">xxxEndDeferWindowPosEx</a>(psmwp, TRUE);
00719         }
00720     }
00721 
00722     <a class="code" href="../../d4/d1/userk_8h.html#a1158">FreeHwndList</a>(pbwl);
00723 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="rare.c::xxxMetricsRecalc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxMetricsRecalc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dx</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dyCaption</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dyMenu</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00362">362</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00091">BuildHwndList()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03633">BWL_ENUMCHILDREN</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03634">BWL_ENUMLIST</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00799">c</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00017">CALC_FRAME</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00018">CALC_MINIMIZE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00016">CALC_RESIZE</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00052">CopyInflateRect()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00243">CopyRect</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02923">tagCHECKPOINT::fMaxInitialized</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00799">FNID_MDICLIENT</a>, <a class="el" href="../../d5/d6/enumwin_8c-source.html#l00417">FreeHwndList()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02345">GETDESKINFO</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00165">InflateRect()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00139">OffsetRect()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06522">PHWND</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03621">tagBWL::phwndNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03892">PROP_CHECKPOINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01722">PROPF_INTERNAL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02918">tagCHECKPOINT::ptMax</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03828">PWND_TOP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01839">tagWND::rcClient</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02916">tagCHECKPOINT::rcNormal</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03624">tagBWL::rghwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00365">ThreadLockAlwaysWithPti</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02421">WFCHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02262">WFCPRESENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02415">WFMAXIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02259">WFMPRESENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02404">WFSIZEBOX</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00688">xxxSendMessage()</a>, and <a class="el" href="../../d3/d7/swp_8c-source.html#l01468">xxxSetWindowPos()</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00870">xxxSetAndDrawMinMetrics()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00799">xxxSetAndDrawNCMetrics()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>00368 {
00369     <a class="code" href="../../d4/d1/userk_8h.html#a944">PHWND</a>       phwnd;
00370     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>        pwnd;
00371     RECT        rc;
00372     <a class="code" href="../../d0/d0/structtagCHECKPOINT.html">PCHECKPOINT</a> pcp;
00373     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>          tlpwnd;
00374     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        fResized;
00375     <a class="code" href="../../d4/d9/structtagBWL.html">PBWL</a>        pbwl;
00376     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent;
00377     <span class="keywordtype">int</span>         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
00378 
00379     ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00380     pbwl = <a class="code" href="../../d4/d1/userk_8h.html#a1157">BuildHwndList</a>(
00381             <a class="code" href="../../d4/d1/userk_8h.html#a256">GETDESKINFO</a>(ptiCurrent)-&gt;spwnd-&gt;spwndChild,
00382             BWL_ENUMLIST | BWL_ENUMCHILDREN,
00383             NULL);
00384 
00385     <span class="keywordflow">if</span> (!pbwl)
00386         <span class="keywordflow">return</span>;
00387 
00388     UserAssert(*pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o1">phwndNext</a> == (HWND) 1);
00389     <span class="keywordflow">for</span> (   <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = (<span class="keywordtype">int</span>)(pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o1">phwndNext</a> - pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>), phwnd = pbwl-&gt;<a class="code" href="../../d4/d9/structtagBWL.html#o4">rghwnd</a>;
00390             <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &gt; 0;
00391             <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>--, phwnd++) {
00392 
00393         pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(*phwnd);
00394         <span class="keywordflow">if</span> (!pwnd)
00395             <span class="keywordflow">continue</span>;
00396 
00397         <a class="code" href="../../d6/d0/usercli_8h.html#a39">ThreadLockAlwaysWithPti</a>(ptiCurrent, pwnd, &amp;tlpwnd);
00398 
00399         fResized = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00400 
00401         <span class="keywordflow">if</span> ((wFlags &amp; <a class="code" href="../../d4/d5/rare_8c.html#a2">CALC_MINIMIZE</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED)) {
00402             <span class="comment">/*</span>
00403 <span class="comment">             * We're changing the minimized window dimensions.  We need to</span>
00404 <span class="comment">             * resize.  Note that we do NOT move.</span>
00405 <span class="comment">             */</span>
00406             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;rc, (&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>));
00407             rc.right += dx;
00408             rc.bottom += dy;
00409 
00410             <span class="keywordflow">goto</span> PositionWnd;
00411         }
00412 
00413         <span class="comment">/*</span>
00414 <span class="comment">         * We're changing the size of the window because the sizing border</span>
00415 <span class="comment">         * changed.</span>
00416 <span class="comment">         */</span>
00417         <span class="keywordflow">if</span> ((wFlags &amp; <a class="code" href="../../d4/d5/rare_8c.html#a0">CALC_RESIZE</a>) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSIZEBOX)) {
00418 
00419             pcp = (<a class="code" href="../../d0/d0/structtagCHECKPOINT.html">CHECKPOINT</a> *)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, PROP_CHECKPOINT, PROPF_INTERNAL);
00420 
00421             <span class="comment">/*</span>
00422 <span class="comment">             * Update maximized position to account for sizing border</span>
00423 <span class="comment">             * We do this for DOS box also.  This way client of max'ed windows</span>
00424 <span class="comment">             * stays in same relative position.</span>
00425 <span class="comment">             */</span>
00426             <span class="keywordflow">if</span> (pcp &amp;&amp; (pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o7">fMaxInitialized</a>)) {
00427                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o2">ptMax</a>.x -= dx;
00428                 pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o2">ptMax</a>.y -= dy;
00429             }
00430 
00431             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED)) {
00432                 <span class="keywordflow">if</span> (pcp)
00433                     <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;pcp-&gt;<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>, dx, dy);
00434             } <span class="keywordflow">else</span> {
00435                 <a class="code" href="../../d3/d6/rect_8c.html#a2">CopyInflateRect</a>(&amp;rc, (&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>), dx, dy);
00436                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCPRESENT))
00437                     rc.bottom += dyCaption;
00438                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMPRESENT))
00439                     rc.bottom += dyMenu;
00440 
00441 PositionWnd:
00442                 fResized = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00443 
00444                 <span class="comment">/*</span>
00445 <span class="comment">                 * Remember SWP expects values in PARENT CLIENT coordinates.</span>
00446 <span class="comment">                 */</span>
00447                 <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd)) {
00448                     <a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(&amp;rc,
00449                         -pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left,
00450                         -pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top);
00451                 }
00452 
00453                 <a class="code" href="../../d4/d1/userk_8h.html#a1615">xxxSetWindowPos</a>(pwnd,
00454                                 PWND_TOP,
00455                                 rc.left,
00456                                 rc.top,
00457                                 rc.right-rc.left,
00458                                 rc.bottom-rc.top,
00459 
00460 #<span class="keywordflow">if</span> 0 <span class="comment">// Win95 flags</span>
00461                                 SWP_NOZORDER | SWP_NOACTIVATE | SWP_DEFERDRAWING | SWP_FRAMECHANGED);
00462 <span class="preprocessor">#else</span>
00463 <span class="preprocessor"></span>                                SWP_NOZORDER | SWP_NOACTIVATE | SWP_NOCOPYBITS | SWP_FRAMECHANGED | SWP_NOREDRAW);
00464 <span class="preprocessor">#endif</span>
00465 <span class="preprocessor"></span>            }
00466         }
00467 
00468         <span class="comment">/*</span>
00469 <span class="comment">         * We're changing the nonclient widgets, so recalculate the</span>
00470 <span class="comment">         * client.</span>
00471 <span class="comment">         */</span>
00472         <span class="keywordflow">if</span> (wFlags &amp; <a class="code" href="../../d4/d5/rare_8c.html#a1">CALC_FRAME</a>) {
00473 
00474             <span class="comment">/*</span>
00475 <span class="comment">             * Delete any cached small icons...</span>
00476 <span class="comment">             */</span>
00477             <span class="keywordflow">if</span> (dyCaption)
00478                  <a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_SETICON, ICON_RECREATE, 0);
00479 
00480             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED) &amp;&amp; !fResized) {
00481 
00482                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;rc, &amp;(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>));
00483                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMPRESENT))
00484                     rc.bottom += dyMenu;
00485 
00486                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCPRESENT)) {
00487                     rc.bottom += dyCaption;
00488                     <span class="comment">/*</span>
00489 <span class="comment">                     * Maximized MDI child windows position their caption</span>
00490 <span class="comment">                     *  outside their parent's client area (negative y).</span>
00491 <span class="comment">                     *  If the caption has changed, they need to be</span>
00492 <span class="comment">                     *  repositioned.</span>
00493 <span class="comment">                     */</span>
00494                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXIMIZED)
00495                             &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD)
00496                             &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a206">FNID_MDICLIENT</a>)) {
00497 
00498                         <a class="code" href="../../d4/d1/userk_8h.html#a1615">xxxSetWindowPos</a>(pwnd,
00499                                         PWND_TOP,
00500                                         rc.left  - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left,
00501                                         rc.top   - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top - dyCaption,
00502                                         rc.right - rc.left,
00503                                         rc.bottom- rc.top, SWP_NOZORDER | SWP_NOACTIVATE | SWP_FRAMECHANGED | SWP_NOREDRAW);
00504                         <span class="keywordflow">goto</span> LoopCleanup;
00505                     }
00506                 }
00507 
00508                 <a class="code" href="../../d4/d1/userk_8h.html#a1615">xxxSetWindowPos</a>(pwnd,
00509                                 PWND_TOP,
00510                                 0,
00511                                 0,
00512                                 rc.right-rc.left,
00513                                 rc.bottom-rc.top,
00514 #<span class="keywordflow">if</span> 0 <span class="comment">// Win95 flags</span>
00515                                 SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE | SWP_FRAMECHANGED | SWP_NOREDRAW);
00516 <span class="preprocessor">#else</span>
00517 <span class="preprocessor"></span>                                SWP_NOMOVE | SWP_NOZORDER | SWP_NOACTIVATE | SWP_FRAMECHANGED | SWP_NOCOPYBITS | SWP_NOREDRAW);
00518 <span class="preprocessor">#endif</span>
00519 <span class="preprocessor"></span>            }
00520         }
00521 
00522 LoopCleanup:
00523         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00524     }
00525 
00526     <a class="code" href="../../d4/d1/userk_8h.html#a1158">FreeHwndList</a>(pbwl);
00527 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="rare.c::xxxSendMinRectMessages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxSendMinRectMessages           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>RECT *&nbsp;</td>
          <td class="mdname" nowrap> <em>lpRect</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l03675">3675</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02345">GETDESKINFO</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01514">HW</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01266">IsHooked</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02264">tagDESKTOPINFO::pvwplShellHook</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l04083">VWPLNext()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02042">WHF_SHELL</a>, <a class="el" href="../../d2/d1/hooks_8c-source.html#l01246">xxxCallHook()</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00764">xxxSendMessageTimeout()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>, <a class="el" href="../../d5/d8/minmax_8c-source.html#l02005">xxxMinimizeHungWindow()</a>, <a class="el" href="../../d5/d8/minmax_8c-source.html#l01329">xxxMinMaximize()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l01683">xxxMNPositionHierarchy()</a>.
<p>
<pre class="fragment"><div>03675                                                      {
03676     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03677     HWND hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd);
03678     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
03679     <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> pdeskinfo;
03680     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nPwndShellHook;
03681     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndShellHook;
03682 
03683     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a208">IsHooked</a>(pti, WHF_SHELL)) {
03684         <a class="code" href="../../d4/d1/userk_8h.html#a1521">xxxCallHook</a>(HSHELL_GETMINRECT, (WPARAM)hwnd,
03685             (LPARAM)lpRect, WH_SHELL);
03686         fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03687     }
03688 
03689     pdeskinfo = <a class="code" href="../../d4/d1/userk_8h.html#a256">GETDESKINFO</a>(pti);
03690     <span class="keywordflow">if</span> (pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o21">pvwplShellHook</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
03691         <span class="keywordflow">return</span> fRet;
03692 
03693     nPwndShellHook = 0;
03694     pwndShellHook = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03695     <span class="keywordflow">while</span> (pwndShellHook = <a class="code" href="../../d4/d1/userk_8h.html#a1872">VWPLNext</a>(pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o21">pvwplShellHook</a>, pwndShellHook, &amp;nPwndShellHook)) {
03696         <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
03697         ULONG_PTR dwRes;
03698 
03699         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndShellHook, &amp;tlpwnd);
03700         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1580">xxxSendMessageTimeout</a>(pwndShellHook, WM_KLUDGEMINRECT, (WPARAM)(hwnd), (LPARAM)lpRect,
03701             SMTO_NORMAL, 100, &amp;dwRes))
03702             fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03703 
03704         <span class="comment">/*</span>
03705 <span class="comment">         * pdeskinfo-&gt;pvwplShellHook may have been realloced to a different</span>
03706 <span class="comment">         * location and size during the WM_KLUDGEMINRECT callback.</span>
03707 <span class="comment">         */</span>
03708         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
03709     }
03710     <span class="keywordflow">return</span> fRet;
03711 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="rare.c::xxxSetAndDrawMinMetrics" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxSetAndDrawMinMetrics           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPMINIMIZEDMETRICS&nbsp;</td>
          <td class="mdname" nowrap> <em>lpmin</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00870">870</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00018">CALC_MINIMIZE</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l01170">SetMinMetrics()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00362">xxxMetricsRecalc()</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l03863">xxxRedrawScreen</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00948">xxxSPISetMinMetrics()</a>.
<p>
<pre class="fragment"><div>00873 {
00874     <span class="comment">/*</span>
00875 <span class="comment">     * Save minimized window dimensions</span>
00876 <span class="comment">     */</span>
00877     <span class="keywordtype">int</span> dxMinOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINIMIZED);
00878     <span class="keywordtype">int</span> dyMinOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINIMIZED);
00879 
00880 
00881     <a class="code" href="../../d4/d1/userk_8h.html#a1856">SetMinMetrics</a>(pProfileUserName,lpmin);
00882 
00883     <span class="comment">/*</span>
00884 <span class="comment">     * Do we need to adjust minimized size?</span>
00885 <span class="comment">     */</span>
00886     dxMinOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINIMIZED) - dxMinOld;
00887     dyMinOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINIMIZED) - dyMinOld;
00888 
00889     <span class="keywordflow">if</span> (dxMinOld || dyMinOld) {
00890         <a class="code" href="../../d4/d1/userk_8h.html#a1536">xxxMetricsRecalc</a>(CALC_MINIMIZE, dxMinOld, dyMinOld, 0, 0);
00891     }
00892 
00893     <a class="code" href="../../d4/d1/userk_8h.html#a470">xxxRedrawScreen</a>();
00894 
00895 
00896     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00897 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="rare.c::xxxSetAndDrawNCMetrics" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxSetAndDrawNCMetrics           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>clNewBorder</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPNONCLIENTMETRICS&nbsp;</td>
          <td class="mdname" nowrap> <em>lpnc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00799">799</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00017">CALC_FRAME</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00018">CALC_MINIMIZE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00016">CALC_RESIZE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d3/d7/metrics_8c-source.html#l00020">MenuRecalc()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00362">xxxMetricsRecalc()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03863">xxxRedrawScreen</a>, and <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l01080">xxxSetWindowNCMetrics()</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l00907">xxxSPISetNCMetrics()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>00802 {
00803     <span class="keywordtype">int</span> dl;
00804     <span class="keywordtype">int</span> dxMinOld;
00805     <span class="keywordtype">int</span> dyMinOld;
00806     <span class="keywordtype">int</span> cxBorder;
00807     <span class="keywordtype">int</span> cyBorder;
00808     <span class="keywordtype">int</span> dyCaption;
00809     <span class="keywordtype">int</span> dyMenu;
00810 
00811     dl = clNewBorder - <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder;
00812     dxMinOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINIMIZED);
00813     dyMinOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINIMIZED);
00814     cxBorder = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
00815     cyBorder = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00816 
00817 
00818     <span class="comment">/*</span>
00819 <span class="comment">     * Do we need to recalculate?</span>
00820 <span class="comment">     */</span>
00821     <span class="keywordflow">if</span> ((lpnc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; !dl)
00822         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00823 
00824     <span class="keywordflow">if</span> (lpnc) {
00825         dyCaption = (<span class="keywordtype">int</span>)lpnc-&gt;iCaptionHeight - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE);
00826         dyMenu = (<span class="keywordtype">int</span>)lpnc-&gt;iMenuHeight - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMENUSIZE);
00827     } <span class="keywordflow">else</span> {
00828         dyCaption = dyMenu = 0;
00829     }
00830 
00831 
00832     <span class="comment">/*</span>
00833 <span class="comment">     * Recalculate the system metrics</span>
00834 <span class="comment">     */</span>
00835     <a class="code" href="../../d4/d1/userk_8h.html#a1857">xxxSetWindowNCMetrics</a>(pProfileUserName, lpnc, TRUE, clNewBorder);
00836 
00837     <span class="comment">/*</span>
00838 <span class="comment">     * Reset our saved menu size/position info</span>
00839 <span class="comment">     */</span>
00840     <a class="code" href="../../d2/d8/metrics_8c.html#a0">MenuRecalc</a>();
00841 
00842     <span class="comment">/*</span>
00843 <span class="comment">     * Reset window sized, positions, frames</span>
00844 <span class="comment">     */</span>
00845     <a class="code" href="../../d4/d1/userk_8h.html#a1536">xxxMetricsRecalc</a>(
00846             CALC_FRAME | (dl ? CALC_RESIZE : 0),
00847             dl*cxBorder,
00848             dl*cyBorder,
00849             dyCaption,
00850             dyMenu);
00851 
00852     dxMinOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINIMIZED) - dxMinOld;
00853     dyMinOld = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINIMIZED) - dyMinOld;
00854     <span class="keywordflow">if</span> (dxMinOld || dyMinOld) {
00855         <a class="code" href="../../d4/d1/userk_8h.html#a1536">xxxMetricsRecalc</a>(CALC_MINIMIZE, dxMinOld, dyMinOld, 0, 0);
00856     }
00857 
00858     <a class="code" href="../../d4/d1/userk_8h.html#a470">xxxRedrawScreen</a>();
00859 
00860 
00861     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00862 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="rare.c::xxxSetSPIMetrics" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxSetSPIMetrics           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>wFlag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAlterWinIni</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l01067">1067</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06584">PUDF_ANIMATE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06612">SET_OR_CLEAR_PUDF</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00734">SetWindowMetricInt()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00979">SPISetIconMetrics()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01014">SPISetIconTitleFont()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00948">xxxSPISetMinMetrics()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l00907">xxxSPISetNCMetrics()</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">xxxSystemParametersInfo()</a>.
<p>
<pre class="fragment"><div>01072 {
01073     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fWinIniChanged;
01074 
01075     <span class="keywordflow">switch</span> (wFlag) {
01076     <span class="keywordflow">case</span> SPI_SETANIMATION:
01077         <span class="keywordflow">if</span> (fAlterWinIni) {
01078             fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,
01079                     STR_MINANIMATE,
01080                     (<span class="keywordtype">int</span>) ((LPANIMATIONINFO) lParam)-&gt;iMinAnimate
01081                     );
01082 
01083             <span class="keywordflow">if</span> (!fWinIniChanged) {
01084                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01085             }
01086         } <span class="keywordflow">else</span> {
01087             fWinIniChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01088         }
01089 
01090         <a class="code" href="../../d4/d1/userk_8h.html#a661">SET_OR_CLEAR_PUDF</a>(PUDF_ANIMATE, ((LPANIMATIONINFO) lParam)-&gt;iMinAnimate);
01091         <span class="keywordflow">return</span> fWinIniChanged;
01092 
01093     <span class="keywordflow">case</span> SPI_SETNONCLIENTMETRICS:
01094         <span class="keywordflow">return</span> <a class="code" href="../../d4/d5/rare_8c.html#a22">xxxSPISetNCMetrics</a>(pProfileUserName,(LPNONCLIENTMETRICS) lParam, fAlterWinIni);
01095 
01096     <span class="keywordflow">case</span> SPI_SETICONMETRICS:
01097         <span class="keywordflow">return</span> <a class="code" href="../../d4/d5/rare_8c.html#a24">SPISetIconMetrics</a>(pProfileUserName,(LPICONMETRICS) lParam, fAlterWinIni);
01098 
01099     <span class="keywordflow">case</span> SPI_SETMINIMIZEDMETRICS:
01100         <span class="keywordflow">return</span> <a class="code" href="../../d4/d5/rare_8c.html#a23">xxxSPISetMinMetrics</a>(pProfileUserName,(LPMINIMIZEDMETRICS) lParam, fAlterWinIni);
01101 
01102     <span class="keywordflow">case</span> SPI_SETICONTITLELOGFONT:
01103         <span class="keywordflow">return</span> <a class="code" href="../../d4/d5/rare_8c.html#a25">SPISetIconTitleFont</a>(pProfileUserName,(LPLOGFONT) lParam, fAlterWinIni);
01104 
01105     <span class="keywordflow">default</span>:
01106         RIPERR1(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"SetSPIMetrics. Invalid wFlag: %#lx"</span>, wFlag);
01107         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01108     }
01109 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="rare.c::xxxSimulateShiftF10" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxSimulateShiftF10           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l03797">3797</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d5/gettickc_8c-source.html#l00026">NtGetTickCount()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d7/d7/ntinput_8c-source.html#l01338">xxxKeyEvent()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.
<p>
<pre class="fragment"><div>03798 {
03799         <span class="comment">/*</span>
03800 <span class="comment">     *  VK_SHIFT down</span>
03801 <span class="comment">     */</span>
03802     <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(VK_LSHIFT, 0x2A | SCANCODE_SIMULATED, <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>(), 0, FALSE);
03803 
03804     <span class="comment">/*</span>
03805 <span class="comment">     *  VK_F10 down</span>
03806 <span class="comment">     */</span>
03807     <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(VK_F10, 0x44 | SCANCODE_SIMULATED, <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>(), 0, FALSE);
03808 
03809     <span class="comment">/*</span>
03810 <span class="comment">     *  VK_F10 up</span>
03811 <span class="comment">     */</span>
03812     <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(VK_F10 | KBDBREAK, 0x44 | SCANCODE_SIMULATED, <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>(), 0, FALSE);
03813 
03814     <span class="comment">/*</span>
03815 <span class="comment">     *  VK_SHIFT up</span>
03816 <span class="comment">     */</span>
03817     <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(VK_LSHIFT | KBDBREAK, 0x2A | SCANCODE_SIMULATED, <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>(), 0, FALSE);
03818 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="rare.c::xxxSPISetMinMetrics" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxSPISetMinMetrics           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPMINIMIZEDMETRICS&nbsp;</td>
          <td class="mdname" nowrap> <em>lpmin</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAlterWinIni</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00948">948</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00734">SetWindowMetricInt()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l00870">xxxSetAndDrawMinMetrics()</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01067">xxxSetSPIMetrics()</a>.
<p>
<pre class="fragment"><div>00952 {
00953     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fWriteAllowed = !fAlterWinIni;
00954     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00955 
00956     <span class="keywordflow">if</span> (fAlterWinIni) {
00957         fChanged  = <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_MINWIDTH,   (<span class="keywordtype">int</span>) lpmin-&gt;iWidth      );
00958         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_MINHORZGAP, (<span class="keywordtype">int</span>) lpmin-&gt;iHorzGap    );
00959         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_MINVERTGAP, (<span class="keywordtype">int</span>) lpmin-&gt;iVertGap    );
00960         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_MINARRANGE, (<span class="keywordtype">int</span>) lpmin-&gt;iArrange    );
00961 
00962         fWriteAllowed = fChanged;
00963     }
00964 
00965     <span class="keywordflow">if</span> (fWriteAllowed) {
00966         <a class="code" href="../../d4/d5/rare_8c.html#a21">xxxSetAndDrawMinMetrics</a>(pProfileUserName,lpmin);
00967     }
00968 
00969     <span class="keywordflow">return</span> fChanged;
00970 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="rare.c::xxxSPISetNCMetrics" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxSPISetNCMetrics           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPNONCLIENTMETRICS&nbsp;</td>
          <td class="mdname" nowrap> <em>lpnc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fAlterWinIni</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l00907">907</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00777">SetWindowMetricFont()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00734">SetWindowMetricInt()</a>, and <a class="el" href="../../d5/d4/rare_8c-source.html#l00799">xxxSetAndDrawNCMetrics()</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/rare_8c-source.html#l01067">xxxSetSPIMetrics()</a>.
<p>
<pre class="fragment"><div>00911 {
00912     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fWriteAllowed = !fAlterWinIni;
00913     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00914 
00915     <span class="keywordflow">if</span> (fAlterWinIni) {
00916         fChanged  = <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_BORDERWIDTH,     (<span class="keywordtype">int</span>) lpnc-&gt;iBorderWidth        );
00917         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_SCROLLWIDTH,     (<span class="keywordtype">int</span>) lpnc-&gt;iScrollWidth        );
00918         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_SCROLLHEIGHT,    (<span class="keywordtype">int</span>) lpnc-&gt;iScrollHeight       );
00919         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_CAPTIONWIDTH,    (<span class="keywordtype">int</span>) lpnc-&gt;iCaptionWidth       );
00920         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_CAPTIONHEIGHT,   (<span class="keywordtype">int</span>) lpnc-&gt;iCaptionHeight      );
00921         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_SMCAPTIONWIDTH,  (<span class="keywordtype">int</span>) lpnc-&gt;iSmCaptionWidth     );
00922         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_SMCAPTIONHEIGHT, (<span class="keywordtype">int</span>) lpnc-&gt;iSmCaptionHeight    );
00923         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_MENUWIDTH,       (<span class="keywordtype">int</span>) lpnc-&gt;iMenuWidth          );
00924         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName,STR_MENUHEIGHT,      (<span class="keywordtype">int</span>) lpnc-&gt;iMenuHeight         );
00925 
00926         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a19">SetWindowMetricFont</a>(pProfileUserName,STR_CAPTIONFONT,    &amp;lpnc-&gt;lfCaptionFont            );
00927         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a19">SetWindowMetricFont</a>(pProfileUserName,STR_SMCAPTIONFONT,  &amp;lpnc-&gt;lfSmCaptionFont          );
00928         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a19">SetWindowMetricFont</a>(pProfileUserName,STR_MENUFONT,       &amp;lpnc-&gt;lfMenuFont               );
00929         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a19">SetWindowMetricFont</a>(pProfileUserName,STR_STATUSFONT,     &amp;lpnc-&gt;lfStatusFont             );
00930         fChanged &amp;= <a class="code" href="../../d4/d5/rare_8c.html#a19">SetWindowMetricFont</a>(pProfileUserName,STR_MESSAGEFONT,    &amp;lpnc-&gt;lfMessageFont            );
00931 
00932         fWriteAllowed = fChanged;
00933     }
00934 
00935     <span class="keywordflow">if</span> (fWriteAllowed)
00936         <a class="code" href="../../d4/d5/rare_8c.html#a20">xxxSetAndDrawNCMetrics</a>(pProfileUserName,(<span class="keywordtype">int</span>) lpnc-&gt;iBorderWidth, lpnc);
00937 
00938     <span class="keywordflow">return</span> fChanged;
00939 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="rare.c::xxxSystemParametersInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxSystemParametersInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wFlag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/rare_8c-source.html#l01497">1497</a> of file <a class="el" href="../../d5/d4/rare_8c-source.html">rare.c</a>.
<p>
References <a class="el" href="../../d6/d7/ntimm_8c-source.html#l02705">_GetIMEShowStatus()</a>, <a class="el" href="../../d0/d1/mmrtl_8c-source.html#l00221">_MonitorFromRect()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l00981">_PostMessage()</a>, <a class="el" href="../../d0/d8/sysmet_8c-source.html#l00074">_SetDoubleClickTime()</a>, <a class="el" href="../../d0/d8/sysmet_8c-source.html#l00025">_SwapMouseButton()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l02289">AccessTimeOutReset()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06586">ACCF_KEYBOARDPREF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06587">ACCF_SCREENREADER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06579">ACCF_SHOWSOUNDSON</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03490">tagPROCESSINFO::amwinsta</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06913">BORDER_EXTRA</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00017">CALC_FRAME</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01247">CalculateMouseSensitivity()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l01973">CalculateMouseTable()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00426">CheckDesktopPolicy()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00518">CheckWinstaWriteAttributesAccess()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05253">ClearUPBOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00243">CopyRect</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l00494">CreateBitmapStrip()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00151">CreateProfileUserName()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03703">tagINTERNALSETHIGHCONTRAST::dwFlags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03261">tagLASTINPUT::dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00244">EqualRect</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01086">FastGetProfileStringFromIDW()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01173">FastGetProfileValue()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01323">FastUpdateWinIni()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00988">FastWriteProfileStringW()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l01115">FastWriteProfileValue()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05831">FCallHookTray</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l00485">FilterKeys()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00174">FreeProfileUserName()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00109">gAccessTimeOut</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00671">gbDisableAlpha</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00443">gbMKMouseMode</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00240">gcxMouseHover</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00241">gcyMouseHover</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00224">gdtMNDropDown</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00242">gdtMouseHover</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02393">GetKbdLangSwitch()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02604">GetPrimaryMonitor()</a>, <a class="el" href="../../d2/d0/inctlpan_8c-source.html#l01030">GetWindowNCMetrics()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00106">gFilterKeys</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00327">ghIconFont</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00113">gHighContrast</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00114">gHighContrastDefaultScheme</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00797">giLowPowerTimeOutMs</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00798">giPowerOffTimeOutMs</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00229">giScreenSaveTimeOutMs</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00439">gLatchBits</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00198">glinp</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00440">gLockBits</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00108">gMouseKeys</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00281">gMouseSensitivity</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00280">gMouseSensitivityFactor</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00277">gMouseSpeed</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00278">gMouseThresh1</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00279">gMouseThresh2</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00228">gnKeyboardSpeed</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00707">gNumLockVk</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00348">gpdwCPUserPreferencesMask</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00794">gpepCSRSS</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00423">gppiScreenSaver</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00030">gpszWall</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00370">gpviCPUserPreferences</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00111">gSoundSentry</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00164">gspklBaseLayout</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00071">gspwndLogonNotify</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00107">gStickyKeys</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00110">gToggleKeys</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00149">gwMKButtonState</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00150">gwMKCurrentButton</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02094">tagDISPLAYINFO::hDev</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02508">tagKL::hkl</a>, <a class="el" href="../../d7/d1/kbdlyout_8c-source.html#l00040">HKLtoPKL()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00734">hModuleWin</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03064">HRGN_FULL</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00191">IntersectRect()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00410">IS_PTR</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03886">KDELAY_MASK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03887">KDELAY_SHIFT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03885">KSPEED_MASK</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03272">LINP_INPUTTIMEOUTS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03271">LINP_POWERTIMEOUTS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d1/d0/inc_2user_8h.html#a1121">LPINTERNALSETHIGHCONTRAST</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l01322">MKHideMouseCursor()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l01279">MKShowMouseCursor()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03957">MOUSE_SENSITIVITY_MAX</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l01813">MouseKeys()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d5/gettickc_8c-source.html#l00026">NtGetTickCount()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02644">tagDESKTOP::pDeskInfo</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">PINT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06851">PMAP_BEEP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06843">PMAP_DESKTOP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06869">PMAP_HIGHCONTRAST</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06853">PMAP_KEYBOARD</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06867">PMAP_KEYBOARDPREF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06852">PMAP_MOUSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06868">PMAP_SCREENREADER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06860">PMAP_SHOWSOUNDS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06854">PMAP_STICKYKEYS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06858">PMAP_TIMEOUT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06857">PMAP_TOGGLEKEYS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06842">PMAP_WINDOWSU</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02095">tagDISPLAYINFO::pmdev</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l03719">PostShellHookMessages()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00084">PpiCurrent</a>, <a class="el" href="../../d4/d5/rare_8c.html#a6">ppvi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05286">PropagetUPBOOLTogpsi</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06584">PUDF_ANIMATE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06588">PUDF_BEEP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06590">PUDF_DRAGFULLWINDOWS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06591">PUDF_ICONTITLEWRAP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01072">PUSIF_SNAPTO</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03833">PWND_BROADCAST</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05200">tagPROFILEVALUEINFO::pwszKeyName</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02157">tagMONITOR::rcMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02158">tagMONITOR::rcWork</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02364">RETURN_IF_ACCESS_DENIED</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00636">RtlInitLargeUnicodeString()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02272">ServerLoadString</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06605">SET_OR_CLEAR_ACCF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06612">SET_OR_CLEAR_PUDF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01080">SET_OR_CLEAR_PUSIF</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l02881">SetAccessEnabledFlag()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00336">SetDesktopMetrics()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01118">SetFilterKeys()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02932">SetKeyboardRate()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01170">SetMouseKeys()</a>, <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00676">SetPointer()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01208">SetSoundSentry()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05250">SetUPBOOL</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00734">SetWindowMetricInt()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00040">SnapshotMonitorRects()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02156">tagDESKTOPINFO::spwnd</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l00717">StopFilterKeysTimers()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d0/d3/access_8h-source.html#l00048">TEST_ACCESSFLAG</a>, <a class="el" href="../../d0/d3/access_8h-source.html#l00049">TEST_BOOL_ACCESSFLAG</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06602">TEST_BOOL_ACCF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06609">TEST_BOOL_PUDF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01077">TEST_BOOL_PUSIF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02974">TestAsyncKeyStateToggle</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05262">TestUP</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05247">TestUPBOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01704">ThreadLockPool</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01710">ThreadUnlockAndFreePool</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03260">tagLASTINPUT::timeLastInputMessage</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l02108">ToggleKeys()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d5/rare_8c.html#a7">uDataRead</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00306">UpdateWinIniInt()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l07059">UPDWORDValue()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05226">UPIsBOOLRange</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05213">UPIsDWORDRange</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03704">tagINTERNALSETHIGHCONTRAST::usDefaultScheme</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05199">tagPROFILEVALUEINFO::uSection</a>, <a class="el" href="../../d2/d1/hooks_8c-source.html#l01246">xxxCallHook()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00605">xxxDesktopRecalc()</a>, <a class="el" href="../../d9/d8/update_8c-source.html#l01302">xxxInternalInvalidate()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00362">xxxMetricsRecalc()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03863">xxxRedrawScreen</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00764">xxxSendMessageTimeout()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l00799">xxxSetAndDrawNCMetrics()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01105">xxxSetDeskPattern()</a>, <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l01079">xxxSetDeskWallpaper()</a>, <a class="el" href="../../d6/d7/ntimm_8c-source.html#l02606">xxxSetIMEShowStatus()</a>, <a class="el" href="../../d5/d4/rare_8c-source.html#l01067">xxxSetSPIMetrics()</a>, <a class="el" href="../../d9/d2/ntuser_2kernel_2access_8c-source.html#l01077">xxxTurnOffStickyKeys()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01685">xxxUpdateSystemCursorsFromRegistry()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01735">xxxUpdateSystemIconsFromRegistry()</a>.
<p>
<pre class="fragment"><div>01503 {
01504     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a>         ppi = <a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>();
01505     <span class="keywordtype">int</span>                  clBorderOld;
01506     <span class="keywordtype">int</span>                  clBorderNew;
01507     LPWSTR               pwszd = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"%d"</span>;
01508     WCHAR                szSection[40];
01509     WCHAR                szTemp[40];
01510     WCHAR                szPat[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
01511     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                 fWinIniChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01512     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                 fAlterWinIni = ((flags &amp; SPIF_UPDATEINIFILE) != 0);
01513     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                 fSendWinIniChange = ((flags &amp; SPIF_SENDCHANGE) != 0);
01514     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                 fWriteAllowed = !fAlterWinIni;
01515     ACCESS_MASK          amRequest;
01516     <a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html">LARGE_UNICODE_STRING</a> strSection;
01517     <span class="keywordtype">int</span>                  *piTimeOut;
01518     <span class="keywordtype">int</span>                  iResID;
01519     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlName;
01520     PUNICODE_STRING pProfileUserName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01521 
01522     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
01523 
01524     <span class="comment">/*</span>
01525 <span class="comment">     * CONSIDER(adams) : Many of the SPI_GET* could be implemented</span>
01526 <span class="comment">     * on the client side (SnapTo, WheelScrollLines, etc.).</span>
01527 <span class="comment">     */</span>
01528 
01529     <span class="comment">/*</span>
01530 <span class="comment">     * Features not implemented</span>
01531 <span class="comment">     */</span>
01532 
01533     <span class="keywordflow">switch</span> (wFlag)
01534     {
01535         <span class="keywordflow">case</span> SPI_TIMEOUTS:
01536         <span class="keywordflow">case</span> SPI_KANJIMENU:
01537         <span class="keywordflow">case</span> SPI_LANGDRIVER:
01538         <span class="keywordflow">case</span> SPI_UNUSED39:
01539         <span class="keywordflow">case</span> SPI_UNUSED40:
01540         <span class="keywordflow">case</span> SPI_SETPENWINDOWS:
01541 
01542         <span class="keywordflow">case</span> SPI_GETWINDOWSEXTENSION:
01543         <span class="keywordflow">case</span> SPI_SETSCREENSAVERRUNNING:     <span class="comment">// same as SPI_SCREENSAVERRUNNING</span>
01544 
01545         <span class="keywordflow">case</span> SPI_GETSERIALKEYS:
01546         <span class="keywordflow">case</span> SPI_SETSERIALKEYS:
01547 
01548         <span class="keywordflow">case</span> SPI_SETMOUSETRAILS:
01549         <span class="keywordflow">case</span> SPI_GETMOUSETRAILS:
01550             RIPERR1(ERROR_INVALID_PARAMETER,
01551                     RIP_WARNING,
01552                     <span class="stringliteral">"SPI_ 0x%lx parameter not supported"</span>, wFlag );
01553 
01554             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01555     }
01556 
01557 
01558     <span class="comment">/*</span>
01559 <span class="comment">     * Perform access check.  Always grant access to CSR.</span>
01560 <span class="comment">     */</span>
01561     <span class="keywordflow">if</span> (ppi-&gt;Process != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a299">gpepCSRSS</a>) {
01562         <span class="keywordflow">switch</span> (wFlag) {
01563         <span class="keywordflow">case</span> SPI_SETBEEP:
01564         <span class="keywordflow">case</span> SPI_SETMOUSE:
01565         <span class="keywordflow">case</span> SPI_SETBORDER:
01566         <span class="keywordflow">case</span> SPI_SETKEYBOARDSPEED:
01567         <span class="keywordflow">case</span> SPI_SETDEFAULTINPUTLANG:
01568         <span class="keywordflow">case</span> SPI_SETSCREENSAVETIMEOUT:
01569         <span class="keywordflow">case</span> SPI_SETSCREENSAVEACTIVE:
01570         <span class="keywordflow">case</span> SPI_SETLOWPOWERTIMEOUT:
01571         <span class="keywordflow">case</span> SPI_SETPOWEROFFTIMEOUT:
01572         <span class="keywordflow">case</span> SPI_SETLOWPOWERACTIVE:
01573         <span class="keywordflow">case</span> SPI_SETPOWEROFFACTIVE:
01574         <span class="keywordflow">case</span> SPI_SETGRIDGRANULARITY:
01575         <span class="keywordflow">case</span> SPI_SETDESKWALLPAPER:
01576         <span class="keywordflow">case</span> SPI_SETDESKPATTERN:
01577         <span class="keywordflow">case</span> SPI_SETKEYBOARDDELAY:
01578         <span class="keywordflow">case</span> SPI_SETICONTITLEWRAP:
01579         <span class="keywordflow">case</span> SPI_SETMENUDROPALIGNMENT:
01580         <span class="keywordflow">case</span> SPI_SETDOUBLECLKWIDTH:
01581         <span class="keywordflow">case</span> SPI_SETDOUBLECLKHEIGHT:
01582         <span class="keywordflow">case</span> SPI_SETDOUBLECLICKTIME:
01583         <span class="keywordflow">case</span> SPI_SETMOUSEBUTTONSWAP:
01584         <span class="keywordflow">case</span> SPI_SETICONTITLELOGFONT:
01585         <span class="keywordflow">case</span> SPI_SETFASTTASKSWITCH:
01586         <span class="keywordflow">case</span> SPI_SETFILTERKEYS:
01587         <span class="keywordflow">case</span> SPI_SETTOGGLEKEYS:
01588         <span class="keywordflow">case</span> SPI_SETMOUSEKEYS:
01589         <span class="keywordflow">case</span> SPI_SETSHOWSOUNDS:
01590         <span class="keywordflow">case</span> SPI_SETSTICKYKEYS:
01591         <span class="keywordflow">case</span> SPI_SETACCESSTIMEOUT:
01592         <span class="keywordflow">case</span> SPI_SETSOUNDSENTRY:
01593         <span class="keywordflow">case</span> SPI_SETKEYBOARDPREF:
01594         <span class="keywordflow">case</span> SPI_SETSCREENREADER:
01595         <span class="keywordflow">case</span> SPI_SETSNAPTODEFBUTTON:
01596         <span class="keywordflow">case</span> SPI_SETANIMATION:
01597         <span class="keywordflow">case</span> SPI_SETNONCLIENTMETRICS:
01598         <span class="keywordflow">case</span> SPI_SETICONMETRICS:
01599         <span class="keywordflow">case</span> SPI_SETMINIMIZEDMETRICS:
01600         <span class="keywordflow">case</span> SPI_SETWORKAREA:
01601         <span class="keywordflow">case</span> SPI_SETFONTSMOOTHING:
01602         <span class="keywordflow">case</span> SPI_SETMOUSEHOVERWIDTH:
01603         <span class="keywordflow">case</span> SPI_SETMOUSEHOVERHEIGHT:
01604         <span class="keywordflow">case</span> SPI_SETMOUSEHOVERTIME:
01605         <span class="keywordflow">case</span> SPI_SETWHEELSCROLLLINES:
01606         <span class="keywordflow">case</span> SPI_SETMENUSHOWDELAY:
01607         <span class="keywordflow">case</span> SPI_SETHIGHCONTRAST:
01608         <span class="keywordflow">case</span> SPI_SETDRAGFULLWINDOWS:
01609         <span class="keywordflow">case</span> SPI_SETDRAGWIDTH:
01610         <span class="keywordflow">case</span> SPI_SETDRAGHEIGHT:
01611         <span class="keywordflow">case</span> SPI_SETCURSORS:
01612         <span class="keywordflow">case</span> SPI_SETICONS:
01613         <span class="keywordflow">case</span> SPI_SETLANGTOGGLE:
01614             amRequest = WINSTA_WRITEATTRIBUTES;
01615             <span class="keywordflow">break</span>;
01616 
01617         <span class="keywordflow">case</span> SPI_ICONHORIZONTALSPACING:
01618         <span class="keywordflow">case</span> SPI_ICONVERTICALSPACING:
01619             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lParam)) {
01620                 amRequest = WINSTA_READATTRIBUTES;
01621             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam) {
01622                 amRequest = WINSTA_WRITEATTRIBUTES;
01623             } <span class="keywordflow">else</span>
01624                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01625             <span class="keywordflow">break</span>;
01626 
01627         <span class="keywordflow">default</span>:
01628             <span class="keywordflow">if</span> ((wFlag &amp; SPIF_RANGETYPEMASK) &amp;&amp; (wFlag &amp; SPIF_SET)) {
01629                 amRequest = WINSTA_WRITEATTRIBUTES;
01630             } <span class="keywordflow">else</span> {
01631                 amRequest = WINSTA_READATTRIBUTES;
01632             }
01633             <span class="keywordflow">break</span>;
01634         }
01635 
01636         <span class="keywordflow">if</span> (amRequest == WINSTA_READATTRIBUTES) {
01637             <a class="code" href="../../d4/d1/userk_8h.html#a263">RETURN_IF_ACCESS_DENIED</a>(ppi-&gt;<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o16">amwinsta</a>, amRequest, FALSE);
01638         } <span class="keywordflow">else</span> {
01639             UserAssert(amRequest == WINSTA_WRITEATTRIBUTES);
01640             <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5/w32_2ntuser_2kernel_2security_8c.html#a9">CheckWinstaWriteAttributesAccess</a>()) {
01641                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01642             }
01643         }
01644 
01645         <span class="comment">/*</span>
01646 <span class="comment">         * If we're reading, then set the write flag to ensure that</span>
01647 <span class="comment">         * the return value will be TRUE.</span>
01648 <span class="comment">         */</span>
01649         <span class="keywordflow">if</span> (amRequest == WINSTA_READATTRIBUTES)
01650             fWriteAllowed = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01651     } <span class="keywordflow">else</span> {
01652         fWriteAllowed = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01653     }
01654 
01655     <span class="comment">/*</span>
01656 <span class="comment">     * Make sure the section buffer is terminated.</span>
01657 <span class="comment">     */</span>
01658     szSection[0] = 0;
01659 
01660     <span class="keywordflow">switch</span> (wFlag) {
01661     <span class="keywordflow">case</span> SPI_GETBEEP:
01662         (*(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> *)lParam) = <a class="code" href="../../d4/d1/userk_8h.html#a658">TEST_BOOL_PUDF</a>(PUDF_BEEP);
01663         <span class="keywordflow">break</span>;
01664 
01665     <span class="keywordflow">case</span> SPI_SETBEEP:
01666         <span class="keywordflow">if</span> (fAlterWinIni) {
01667             <a class="code" href="../../d4/d1/userk_8h.html#a248">ServerLoadString</a>(
01668                     hModuleWin,
01669                     (UINT)(wParam ? STR_BEEPYES : STR_BEEPNO),
01670                     (LPWSTR)szTemp, 10);
01671 
01672             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2015">FastUpdateWinIni</a>(NULL,
01673                     PMAP_BEEP,
01674                     (UINT) STR_BEEP,
01675                     szTemp
01676                     );
01677 
01678             fWriteAllowed = fWinIniChanged;
01679         }
01680 
01681         <span class="keywordflow">if</span> (fWriteAllowed) {
01682             <a class="code" href="../../d4/d1/userk_8h.html#a661">SET_OR_CLEAR_PUDF</a>(PUDF_BEEP, wParam);
01683         }
01684 
01685         <span class="keywordflow">break</span>;
01686 
01687 
01688     <span class="keywordflow">case</span> SPI_SETMOUSESPEED:
01689         <span class="keywordflow">if</span> (((LONG_PTR) lParam &lt; MOUSE_SENSITIVITY_MIN) || ((LONG_PTR) lParam &gt; <a class="code" href="../../d4/d1/userk_8h.html#a485">MOUSE_SENSITIVITY_MAX</a>)) {
01690             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
01691         }
01692 
01693         <span class="keywordflow">if</span> (fAlterWinIni) {
01694             swprintf(szTemp, pwszd, lParam) ;
01695             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2015">FastUpdateWinIni</a>(NULL,
01696                     PMAP_MOUSE,
01697                     STR_MOUSESENSITIVITY,
01698                     szTemp
01699                     );
01700 
01701             fWriteAllowed = fWinIniChanged;
01702         }
01703 
01704         <span class="keywordflow">if</span> (fWriteAllowed) {
01705             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a124">gMouseSensitivity</a> = PtrToLong(lParam);
01706             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a123">gMouseSensitivityFactor</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1031">CalculateMouseSensitivity</a>(PtrToLong(lParam)) ;
01707         }
01708         <span class="keywordflow">break</span>;
01709 
01710     <span class="keywordflow">case</span> SPI_GETMOUSESPEED:
01711         *((LPINT)lParam) = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a124">gMouseSensitivity</a> ;
01712         <span class="keywordflow">break</span>;
01713 
01714     <span class="keywordflow">case</span> SPI_GETMOUSE:
01715         ((LPINT)lParam)[0] = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a121">gMouseThresh1</a>;
01716         ((LPINT)lParam)[1] = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a122">gMouseThresh2</a>;
01717         ((LPINT)lParam)[2] = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a120">gMouseSpeed</a>;
01718         <span class="keywordflow">break</span>;
01719 
01720     <span class="keywordflow">case</span> SPI_SETMOUSE:
01721         <span class="keywordflow">if</span> (fAlterWinIni) {
01722             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bWritten1, bWritten2, bWritten3;
01723 
01724             pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
01725             bWritten1 = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(pProfileUserName, PMAP_MOUSE, STR_MOUSETHRESH1, ((LPINT)lParam)[0]);
01726             bWritten2 = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(pProfileUserName, PMAP_MOUSE, STR_MOUSETHRESH2, ((LPINT)lParam)[1]);
01727             bWritten3 = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(pProfileUserName, PMAP_MOUSE, STR_MOUSESPEED,   ((LPINT)lParam)[2]);
01728             <span class="keywordflow">if</span> (bWritten1 &amp;&amp; bWritten2 &amp;&amp; bWritten3)
01729                 fWinIniChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01730             <span class="keywordflow">else</span> {
01731 
01732                 <span class="comment">/*</span>
01733 <span class="comment">                 * Attempt to backout any changes.</span>
01734 <span class="comment">                 */</span>
01735                 <span class="keywordflow">if</span> (bWritten1) {
01736                     <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(pProfileUserName, PMAP_MOUSE, STR_MOUSETHRESH1, gMouseThresh1);
01737                 }
01738                 <span class="keywordflow">if</span> (bWritten2) {
01739                     <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(pProfileUserName, PMAP_MOUSE, STR_MOUSETHRESH2, gMouseThresh2);
01740                 }
01741                 <span class="keywordflow">if</span> (bWritten3) {
01742                     <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(pProfileUserName, PMAP_MOUSE, STR_MOUSESPEED,   gMouseSpeed);
01743                 }
01744             }
01745             fWriteAllowed = fWinIniChanged;
01746             <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
01747         }
01748         <span class="keywordflow">if</span> (fWriteAllowed) {
01749             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a121">gMouseThresh1</a> = ((LPINT)lParam)[0];
01750             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a122">gMouseThresh2</a> = ((LPINT)lParam)[1];
01751             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a120">gMouseSpeed</a> = ((LPINT)lParam)[2];
01752         }
01753         <span class="keywordflow">break</span>;
01754 
01755     <span class="keywordflow">case</span> SPI_GETSNAPTODEFBUTTON:
01756         (*(LPBOOL)lParam) = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a369">TEST_BOOL_PUSIF</a>(PUSIF_SNAPTO);
01757         <span class="keywordflow">break</span>;
01758 
01759     <span class="keywordflow">case</span> SPI_SETSNAPTODEFBUTTON:
01760         wParam = (wParam != 0);
01761 
01762         <span class="keywordflow">if</span> (fAlterWinIni) {
01763             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_MOUSE, STR_SNAPTO, wParam);
01764             fWriteAllowed = fWinIniChanged;
01765         }
01766 
01767         <span class="keywordflow">if</span> (fWriteAllowed) {
01768             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a372">SET_OR_CLEAR_PUSIF</a>(PUSIF_SNAPTO, wParam);
01769         }
01770 
01771         <span class="keywordflow">break</span>;
01772 
01773     <span class="keywordflow">case</span> SPI_GETBORDER:
01774         (*(LPINT)lParam) = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder;
01775         <span class="keywordflow">break</span>;
01776 
01777     <span class="keywordflow">case</span> SPI_SETBORDER:
01778         pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
01779         <span class="keywordflow">if</span> (fAlterWinIni) {
01780             fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(pProfileUserName, STR_BORDERWIDTH, wParam);
01781             fWriteAllowed = fWinIniChanged;
01782         }
01783         <span class="keywordflow">if</span> (fWriteAllowed) {
01784             clBorderOld = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder;
01785             clBorderNew = wParam;
01786 
01787             <span class="keywordflow">if</span> (clBorderNew &lt; 1)
01788                 clBorderNew = 1;
01789             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (clBorderNew &gt; 50)
01790                 clBorderNew = 50;
01791 
01792             <span class="keywordflow">if</span> (clBorderOld == clBorderNew) {
01793 
01794                 <span class="comment">/*</span>
01795 <span class="comment">                 * If border size doesn't change, don't waste time.</span>
01796 <span class="comment">                 */</span>
01797                 <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
01798                 <span class="keywordflow">break</span>;
01799             }
01800 
01801             <a class="code" href="../../d4/d5/rare_8c.html#a20">xxxSetAndDrawNCMetrics</a>(pProfileUserName, clBorderNew, NULL);
01802 
01803             <span class="comment">/*</span>
01804 <span class="comment">             * Nice magic number of 3.  So if the border is set to 1, there are actualy</span>
01805 <span class="comment">             * 4 pixels in the border</span>
01806 <span class="comment">             */</span>
01807 
01808             bSetDevDragWidth(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder + BORDER_EXTRA);
01809         }
01810         <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
01811         <span class="keywordflow">break</span>;
01812 
01813     <span class="keywordflow">case</span> SPI_GETFONTSMOOTHING:
01814         (*(LPINT)lParam) = !!(GreGetFontEnumeration() &amp; FE_AA_ON);
01815         <span class="keywordflow">break</span>;
01816 
01817     <span class="keywordflow">case</span> SPI_SETFONTSMOOTHING:
01818         wParam = (wParam ? FE_AA_ON : 0);
01819         <span class="keywordflow">if</span> (fAlterWinIni) {
01820             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL,PMAP_DESKTOP, STR_FONTSMOOTHING, wParam);
01821             fWriteAllowed = fWinIniChanged;
01822         }
01823         <span class="keywordflow">if</span> (fWriteAllowed) {
01824             GreSetFontEnumeration(wParam | FE_SET_AA);
01825         }
01826         <span class="keywordflow">break</span>;
01827 
01828     <span class="keywordflow">case</span> SPI_GETKEYBOARDSPEED:
01829         (*(<span class="keywordtype">int</span> *)lParam) = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a97">gnKeyboardSpeed</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a472">KSPEED_MASK</a>);
01830         <span class="keywordflow">break</span>;
01831 
01832     <span class="keywordflow">case</span> SPI_SETKEYBOARDSPEED:
01833         <span class="comment">/*</span>
01834 <span class="comment">         * Limit the range to max value; SetKeyboardRate takes both speed and delay</span>
01835 <span class="comment">         */</span>
01836         <span class="keywordflow">if</span> (wParam &gt; <a class="code" href="../../d4/d1/userk_8h.html#a472">KSPEED_MASK</a>)           <span class="comment">// KSPEED_MASK == KSPEED_MAX</span>
01837             wParam = <a class="code" href="../../d4/d1/userk_8h.html#a472">KSPEED_MASK</a>;
01838         <span class="keywordflow">if</span> (fAlterWinIni) {
01839             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL,PMAP_KEYBOARD, STR_KEYSPEED, wParam);
01840             fWriteAllowed = fWinIniChanged;
01841         }
01842         <span class="keywordflow">if</span> (fWriteAllowed) {
01843             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a97">gnKeyboardSpeed</a> = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a97">gnKeyboardSpeed</a> &amp; ~<a class="code" href="../../d4/d1/userk_8h.html#a472">KSPEED_MASK</a>) | wParam;
01844             <a class="code" href="../../d4/d1/userk_8h.html#a1176">SetKeyboardRate</a>(gnKeyboardSpeed );
01845         }
01846         <span class="keywordflow">break</span>;
01847 
01848     <span class="keywordflow">case</span> SPI_GETKEYBOARDDELAY:
01849         (*(<span class="keywordtype">int</span> *)lParam) = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a97">gnKeyboardSpeed</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a473">KDELAY_MASK</a>) &gt;&gt; <a class="code" href="../../d4/d1/userk_8h.html#a474">KDELAY_SHIFT</a>;
01850         <span class="keywordflow">break</span>;
01851 
01852     <span class="keywordflow">case</span> SPI_SETKEYBOARDDELAY:
01853         <span class="keywordflow">if</span> (fAlterWinIni) {
01854             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL,PMAP_KEYBOARD, STR_KEYDELAY, wParam);
01855             fWriteAllowed = fWinIniChanged;
01856         }
01857         <span class="keywordflow">if</span> (fWriteAllowed) {
01858             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a97">gnKeyboardSpeed</a> = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a97">gnKeyboardSpeed</a> &amp; ~<a class="code" href="../../d4/d1/userk_8h.html#a473">KDELAY_MASK</a>) | (wParam &lt;&lt; <a class="code" href="../../d4/d1/userk_8h.html#a474">KDELAY_SHIFT</a>);
01859             <a class="code" href="../../d4/d1/userk_8h.html#a1176">SetKeyboardRate</a>(gnKeyboardSpeed);
01860         }
01861         <span class="keywordflow">break</span>;
01862 
01863     <span class="keywordflow">case</span> SPI_SETLANGTOGGLE:
01864 
01865         <span class="comment">/*</span>
01866 <span class="comment">         * wParam unused, lParam unused.  Simply reread the registry setting.</span>
01867 <span class="comment">         */</span>
01868 
01869         <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a1305">GetKbdLangSwitch</a>(NULL);
01870 
01871         <span class="keywordflow">break</span>;
01872 
01873     <span class="keywordflow">case</span> SPI_GETDEFAULTINPUTLANG:
01874         <span class="comment">/*</span>
01875 <span class="comment">         * wParam unused.  lParam is a pointer to buffer to store hkl.</span>
01876 <span class="comment">         */</span>
01877         UserAssert(gspklBaseLayout != NULL);
01878         (*(HKL *)lParam) = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a62">gspklBaseLayout</a>-&gt;<a class="code" href="../../d4/d9/structtagKL.html#o4">hkl</a>;
01879         <span class="keywordflow">break</span>;
01880 
01881     <span class="keywordflow">case</span> SPI_SETDEFAULTINPUTLANG: {
01882         <a class="code" href="../../d4/d9/structtagKL.html">PKL</a> pkl;
01883         <span class="comment">/*</span>
01884 <span class="comment">         * wParam unused.  lParam is new language of hkl (depending on whether the</span>
01885 <span class="comment">         * hiword is set.</span>
01886 <span class="comment">         */</span>
01887         pkl = <a class="code" href="../../d4/d1/userk_8h.html#a1019">HKLtoPKL</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), *(HKL *)lParam);
01888         <span class="keywordflow">if</span> (pkl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01889             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01890         }
01891         <span class="keywordflow">if</span> (fWriteAllowed) {
01892             <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;gspklBaseLayout, pkl);
01893         }
01894         <span class="keywordflow">break</span>;
01895     }
01896 
01897     <span class="keywordflow">case</span> SPI_ICONHORIZONTALSPACING:
01898         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lParam)) {
01899             *(LPINT)lParam = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXICONSPACING);
01900         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam) {
01901 
01902             <span class="comment">/*</span>
01903 <span class="comment">             * Make sure icon spacing is reasonable.</span>
01904 <span class="comment">             */</span>
01905             wParam = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(wParam, (DWORD)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXICON));
01906 
01907             <span class="keywordflow">if</span> (fAlterWinIni) {
01908                 fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(NULL, STR_ICONHORZSPACING, wParam );
01909                 fWriteAllowed = fWinIniChanged;
01910             }
01911             <span class="keywordflow">if</span> (fWriteAllowed) {
01912                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXICONSPACING) = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)wParam;
01913             }
01914         }
01915         <span class="keywordflow">break</span>;
01916 
01917     <span class="keywordflow">case</span> SPI_ICONVERTICALSPACING:
01918         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lParam)) {
01919             *(LPINT)lParam = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYICONSPACING);
01920         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam) {
01921             wParam = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(wParam, (DWORD)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYICON));
01922 
01923             <span class="keywordflow">if</span> (fAlterWinIni) {
01924                 fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(NULL, STR_ICONVERTSPACING, wParam);
01925                 fWriteAllowed = fWinIniChanged;
01926             }
01927             <span class="keywordflow">if</span> (fWriteAllowed) {
01928                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYICONSPACING) = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)wParam;
01929             }
01930         }
01931         <span class="keywordflow">break</span>;
01932 
01933     <span class="keywordflow">case</span> SPI_GETSCREENSAVETIMEOUT:
01934         piTimeOut = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a98">giScreenSaveTimeOutMs</a>;
01935         <span class="keywordflow">goto</span> HandleGetTimeouts;
01936 
01937     <span class="keywordflow">case</span> SPI_GETLOWPOWERTIMEOUT:
01938         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(DrvGetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD1))) {
01939             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01940         }
01941         piTimeOut = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a301">giLowPowerTimeOutMs</a>;
01942         <span class="keywordflow">goto</span> HandleGetTimeouts;
01943 
01944     <span class="keywordflow">case</span> SPI_GETPOWEROFFTIMEOUT:
01945         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(DrvGetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD3))) {
01946             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01947         }
01948         piTimeOut = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a302">giPowerOffTimeOutMs</a>;
01949 
01950 HandleGetTimeouts:
01951         <span class="comment">/*</span>
01952 <span class="comment">         * If the screen saver is disabled, I store this fact as a negative</span>
01953 <span class="comment">         * time out value.  So, we give the Control Panel the absolute value</span>
01954 <span class="comment">         * of the screen save time out. We store this in milliseconds.</span>
01955 <span class="comment">         */</span>
01956         <span class="keywordflow">if</span> (*piTimeOut &lt; 0)
01957             (*(<span class="keywordtype">int</span> *)lParam) = -*piTimeOut / 1000;
01958         <span class="keywordflow">else</span>
01959             (*(<span class="keywordtype">int</span> *)lParam) = *piTimeOut / 1000;
01960         <span class="keywordflow">break</span>;
01961 
01962     <span class="keywordflow">case</span> SPI_SETSCREENSAVETIMEOUT:
01963         piTimeOut = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a98">giScreenSaveTimeOutMs</a>;
01964         iResID = STR_SCREENSAVETIMEOUT;
01965         <span class="keywordflow">goto</span> HandleSetTimeouts;
01966 
01967     <span class="keywordflow">case</span> SPI_SETLOWPOWERTIMEOUT:
01968         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(DrvGetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD1))) {
01969             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01970         }
01971         piTimeOut = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a301">giLowPowerTimeOutMs</a>;
01972         iResID = STR_LOWPOWERTIMEOUT;
01973         <span class="keywordflow">goto</span> HandleSetTimeouts;
01974 
01975     <span class="keywordflow">case</span> SPI_SETPOWEROFFTIMEOUT:
01976         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(DrvGetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD3))) {
01977             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01978         }
01979         piTimeOut = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a302">giPowerOffTimeOutMs</a>;
01980         iResID = STR_POWEROFFTIMEOUT;
01981 
01982 HandleSetTimeouts:
01983         <span class="comment">/*</span>
01984 <span class="comment">         * Maintain the screen save active/inactive state when setting the</span>
01985 <span class="comment">         * time out value.  Timeout value is given in seconds but stored</span>
01986 <span class="comment">         * in milliseconds</span>
01987 <span class="comment">         */</span>
01988         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a2003">CheckDesktopPolicy</a>(NULL, (PCWSTR)iResID)) {
01989             fAlterWinIni = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01990             fWriteAllowed = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01991         }
01992         <span class="keywordflow">if</span> (fAlterWinIni) {
01993             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL,PMAP_DESKTOP, iResID, wParam);
01994             fWriteAllowed = fWinIniChanged;
01995         }
01996         <span class="keywordflow">if</span> (fWriteAllowed) {
01997             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o1">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a380">LINP_POWERTIMEOUTS</a>) {
01998                 <span class="comment">// Call video driver here to exit power down mode.</span>
01999                 KdPrint((<span class="stringliteral">"Exit video power down mode\n"</span>));
02000                 DrvSetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD0);
02001             }
02002             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o1">dwFlags</a> &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a381">LINP_INPUTTIMEOUTS</a>;
02003             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o0">timeLastInputMessage</a> = <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>();
02004             <span class="keywordflow">if</span> (*piTimeOut &lt; 0) {
02005                 *piTimeOut = -((<span class="keywordtype">int</span>)wParam);
02006             } <span class="keywordflow">else</span> {
02007                 *piTimeOut = wParam;
02008             }
02009             *piTimeOut *= 1000;
02010         }
02011         <span class="keywordflow">break</span>;
02012 
02013     <span class="keywordflow">case</span> SPI_GETSCREENSAVEACTIVE:
02014         (*(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> *)lParam) = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a98">giScreenSaveTimeOutMs</a> &gt; 0);
02015         <span class="keywordflow">break</span>;
02016 
02017     <span class="keywordflow">case</span> SPI_GETLOWPOWERACTIVE:
02018         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(DrvGetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD1))) {
02019             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02020         }
02021         (*(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> *)lParam) = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a301">giLowPowerTimeOutMs</a> &gt; 0);
02022         <span class="keywordflow">break</span>;
02023 
02024     <span class="keywordflow">case</span> SPI_GETPOWEROFFACTIVE:
02025         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(DrvGetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD3))) {
02026             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02027         }
02028         (*(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> *)lParam) = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a302">giPowerOffTimeOutMs</a> &gt; 0);
02029         <span class="keywordflow">break</span>;
02030 
02031     <span class="keywordflow">case</span> SPI_SETSCREENSAVEACTIVE:
02032         piTimeOut = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a98">giScreenSaveTimeOutMs</a>;
02033         iResID = STR_SCREENSAVEACTIVE;
02034         <span class="keywordflow">goto</span> HandleSetActive;
02035 
02036     <span class="keywordflow">case</span> SPI_SETLOWPOWERACTIVE:
02037         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(DrvGetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD1))) {
02038             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02039         }
02040         piTimeOut = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a301">giLowPowerTimeOutMs</a>;
02041         iResID = STR_LOWPOWERACTIVE;
02042         <span class="keywordflow">goto</span> HandleSetActive;
02043 
02044     <span class="keywordflow">case</span> SPI_SETPOWEROFFACTIVE:
02045         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(DrvGetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD3))) {
02046             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02047         }
02048         piTimeOut = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a302">giPowerOffTimeOutMs</a>;
02049         iResID = STR_POWEROFFACTIVE;
02050 
02051 HandleSetActive:
02052         wParam = (wParam != 0);
02053 
02054         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a2003">CheckDesktopPolicy</a>(NULL, (PCWSTR)iResID)) {
02055             fAlterWinIni = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02056             fWriteAllowed = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02057         }
02058         <span class="keywordflow">if</span> (fAlterWinIni) {
02059             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL,PMAP_DESKTOP, iResID, wParam);
02060             fWriteAllowed = fWinIniChanged;
02061         }
02062         <span class="keywordflow">if</span> (fWriteAllowed) {
02063             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o1">dwFlags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a380">LINP_POWERTIMEOUTS</a>) {
02064                 <span class="comment">// Call video driver here to exit power down mode.</span>
02065                 KdPrint((<span class="stringliteral">"Exit video power down mode\n"</span>));
02066                 DrvSetMonitorPowerState(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o1">pmdev</a>, PowerDeviceD0);
02067             }
02068             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o1">dwFlags</a> &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a381">LINP_INPUTTIMEOUTS</a>;
02069             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o0">timeLastInputMessage</a> = <a class="code" href="../../d9/d5/gettickc_8c.html#a0">NtGetTickCount</a>();
02070             <span class="keywordflow">if</span> ((*piTimeOut &lt; 0 &amp;&amp; wParam) ||
02071                 (*piTimeOut &gt;= 0 &amp;&amp; !wParam)) {
02072                 *piTimeOut = -*piTimeOut;
02073             }
02074         }
02075         <span class="keywordflow">break</span>;
02076 
02077 
02078     <span class="keywordflow">case</span> SPI_SETDESKWALLPAPER:
02079         pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
02080         <span class="keywordflow">if</span> (fAlterWinIni) {
02081 
02082             <span class="keywordflow">if</span> (wParam != (WPARAM)-1) {
02083 
02084                 <span class="comment">/*</span>
02085 <span class="comment">                 * Save current wallpaper in case of failure.</span>
02086 <span class="comment">                 */</span>
02087                 <a class="code" href="../../d4/d1/userk_8h.html#a2011">FastGetProfileStringFromIDW</a>(pProfileUserName,
02088                        PMAP_DESKTOP,
02089                        STR_DTBITMAP,
02090                        TEXT(<span class="stringliteral">""</span>),
02091                        szPat,
02092                        <span class="keyword">sizeof</span>(szPat) / <span class="keyword">sizeof</span>(WCHAR)
02093                        );
02094 
02095                 fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2015">FastUpdateWinIni</a>(pProfileUserName,
02096                        PMAP_DESKTOP,
02097                        STR_DTBITMAP,
02098                        (LPWSTR)lParam
02099                        );
02100 
02101                 fWriteAllowed = fWinIniChanged;
02102 
02103             } <span class="keywordflow">else</span> {
02104                 fWriteAllowed = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02105             }
02106         }
02107 
02108         <span class="keywordflow">if</span> (fWriteAllowed) {
02109 
02110             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1186">xxxSetDeskWallpaper</a>(pProfileUserName,(LPWSTR)lParam)) {
02111 
02112                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>) {
02113 
02114                     <a class="code" href="../../d4/d1/userk_8h.html#a1681">xxxInternalInvalidate</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>,
02115                                           HRGN_FULL,
02116                                           RDW_INVALIDATE |
02117                                               RDW_ERASE |
02118                                               RDW_FRAME |
02119                                               RDW_ALLCHILDREN);
02120                 }
02121 
02122             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fAlterWinIni &amp;&amp; (wParam != 0xFFFFFFFF)) {
02123 
02124                 <span class="comment">/*</span>
02125 <span class="comment">                 * Backout any change to win.ini.</span>
02126 <span class="comment">                 */</span>
02127                 <a class="code" href="../../d4/d1/userk_8h.html#a2015">FastUpdateWinIni</a>(pProfileUserName,PMAP_DESKTOP, STR_DTBITMAP, szPat);
02128                 fWinIniChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02129                 fWriteAllowed = fWinIniChanged;
02130             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fAlterWinIni) {
02131                 <span class="comment">/*</span>
02132 <span class="comment">                 * Bug 304109 - joejo</span>
02133 <span class="comment">                 * Make sure we return a 0 retval if we didn't do anything!</span>
02134 <span class="comment">                 */</span>
02135                 fWinIniChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02136                 fWriteAllowed = fWinIniChanged;
02137             }
02138         }
02139         <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
02140         <span class="keywordflow">break</span>;
02141 
02142     <span class="comment">/*</span>
02143 <span class="comment">     * Bug 257718 - joejo</span>
02144 <span class="comment">     * Add SPI_GETDESKWALLPAPER to SystemParametersInfo</span>
02145 <span class="comment">     */</span>
02146     <span class="keywordflow">case</span> SPI_GETDESKWALLPAPER:
02147         <span class="comment">/*</span>
02148 <span class="comment">         * Bug 283318 - jojeo</span>
02149 <span class="comment">         *</span>
02150 <span class="comment">         * Get the string from the gobal var, not the registry,</span>
02151 <span class="comment">         * as it's more current.</span>
02152 <span class="comment">         */</span>
02153         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a6">gpszWall</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02154             <span class="comment">/*</span>
02155 <span class="comment">             * Copy the global wallpaper name ONLY if nun null</span>
02156 <span class="comment">             */</span>
02157             wcscpy(lParam, gpszWall);
02158         } <span class="keywordflow">else</span> {
02159             <span class="comment">/*</span>
02160 <span class="comment">             * Null out the string so no garbage can corrupt the user's</span>
02161 <span class="comment">             * buffer.</span>
02162 <span class="comment">             */</span>
02163             (*(LPWSTR)lParam) = (WCHAR)0;
02164         }
02165         <span class="keywordflow">break</span>;
02166 
02167     <span class="keywordflow">case</span> SPI_SETDESKPATTERN: {
02168             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet;
02169 
02170             <span class="keywordflow">if</span> (wParam == -1 &amp;&amp; lParam != 0)
02171                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02172 
02173             pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
02174             <span class="keywordflow">if</span> (fAlterWinIni &amp;&amp; wParam != -1) {
02175 
02176                 <span class="comment">/*</span>
02177 <span class="comment">                 * Save the current pattern in case of failure.</span>
02178 <span class="comment">                 */</span>
02179                 <a class="code" href="../../d4/d1/userk_8h.html#a2011">FastGetProfileStringFromIDW</a>(pProfileUserName,
02180                         PMAP_DESKTOP,
02181                         STR_DESKPATTERN,
02182                         TEXT(<span class="stringliteral">""</span>),
02183                         szPat,
02184                         <span class="keyword">sizeof</span>(szPat) / <span class="keyword">sizeof</span>(WCHAR)
02185                         );
02186 
02187                 fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2015">FastUpdateWinIni</a>(pProfileUserName,
02188                         PMAP_DESKTOP,
02189                         STR_DESKPATTERN,
02190                         (LPWSTR)lParam
02191                         );
02192 
02193                 fWriteAllowed = fWinIniChanged;
02194             }
02195 
02196             <span class="keywordflow">if</span> (fWriteAllowed) {
02197 
02198                 fRet = <a class="code" href="../../d4/d1/userk_8h.html#a1185">xxxSetDeskPattern</a>(pProfileUserName,
02199                         wParam == -1 ? (LPWSTR)-1 : (LPWSTR)lParam,
02200                         FALSE);
02201 
02202                 <span class="keywordflow">if</span> (!fRet) {
02203 
02204                     <span class="comment">/*</span>
02205 <span class="comment">                     * Back out any change to win.ini</span>
02206 <span class="comment">                     */</span>
02207                     <span class="keywordflow">if</span> (fAlterWinIni &amp;&amp; wParam != -1) {
02208 
02209                         <a class="code" href="../../d4/d1/userk_8h.html#a2015">FastUpdateWinIni</a>(pProfileUserName,
02210                                 PMAP_DESKTOP,
02211                                 STR_DESKPATTERN,
02212                                 szPat
02213                                 );
02214                     }
02215 
02216                     <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
02217                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02218                 }
02219             }
02220         }
02221         <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
02222         <span class="keywordflow">break</span>;
02223 
02224     <span class="keywordflow">case</span> SPI_GETICONTITLEWRAP:
02225         *((<span class="keywordtype">int</span> *)lParam) = <a class="code" href="../../d4/d1/userk_8h.html#a658">TEST_BOOL_PUDF</a>(PUDF_ICONTITLEWRAP);
02226         <span class="keywordflow">break</span>;
02227 
02228     <span class="keywordflow">case</span> SPI_SETICONTITLEWRAP:
02229         wParam = (wParam != 0);
02230         <span class="keywordflow">if</span> (fAlterWinIni) {
02231             fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a18">SetWindowMetricInt</a>(NULL, STR_ICONTITLEWRAP, wParam);
02232             fWriteAllowed = fWinIniChanged;
02233         }
02234         <span class="keywordflow">if</span> (fWriteAllowed) {
02235             <a class="code" href="../../d4/d1/userk_8h.html#a661">SET_OR_CLEAR_PUDF</a>(PUDF_ICONTITLEWRAP, wParam);
02236             <a class="code" href="../../d4/d1/userk_8h.html#a1536">xxxMetricsRecalc</a>(CALC_FRAME, 0, 0, 0, 0);
02237         }
02238         <span class="keywordflow">break</span>;
02239 
02240     <span class="keywordflow">case</span> SPI_SETDRAGWIDTH:
02241         <span class="keywordflow">if</span> (fAlterWinIni) {
02242             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_DESKTOP, STR_DRAGWIDTH, wParam);
02243             fWriteAllowed = fWinIniChanged;
02244         }
02245         <span class="keywordflow">if</span> (fWriteAllowed) {
02246             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXDRAG) = wParam;
02247         }
02248         <span class="keywordflow">break</span>;
02249 
02250     <span class="keywordflow">case</span> SPI_SETDRAGHEIGHT:
02251         <span class="keywordflow">if</span> (fAlterWinIni) {
02252             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_DESKTOP, STR_DRAGHEIGHT, wParam);
02253             fWriteAllowed = fWinIniChanged;
02254         }
02255         <span class="keywordflow">if</span> (fWriteAllowed) {
02256             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYDRAG) = wParam;
02257         }
02258         <span class="keywordflow">break</span>;
02259 
02260     <span class="keywordflow">case</span> SPI_GETMENUDROPALIGNMENT:
02261         (*(<span class="keywordtype">int</span> *)lParam) = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(MENUDROPALIGNMENT));
02262         <span class="keywordflow">break</span>;
02263 
02264     <span class="keywordflow">case</span> SPI_SETMENUDROPALIGNMENT:
02265         <span class="keywordflow">if</span> (fAlterWinIni) {
02266             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_WINDOWSU, STR_MENUDROPALIGNMENT, wParam);
02267             fWriteAllowed = fWinIniChanged;
02268         }
02269         <span class="keywordflow">if</span> (fWriteAllowed) {
02270             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(MENUDROPALIGNMENT) = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)(wParam != 0);
02271         }
02272         <span class="keywordflow">break</span>;
02273 
02274     <span class="keywordflow">case</span> SPI_SETDOUBLECLKWIDTH:
02275         <span class="keywordflow">if</span> (fAlterWinIni) {
02276             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_MOUSE, STR_DOUBLECLICKWIDTH, wParam);
02277             fWriteAllowed = fWinIniChanged;
02278         }
02279         <span class="keywordflow">if</span> (fWriteAllowed) {
02280             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXDOUBLECLK) = wParam;
02281         }
02282         <span class="keywordflow">break</span>;
02283 
02284     <span class="keywordflow">case</span> SPI_SETDOUBLECLKHEIGHT:
02285         <span class="keywordflow">if</span> (fAlterWinIni) {
02286             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_MOUSE, STR_DOUBLECLICKHEIGHT, wParam);
02287             fWriteAllowed = fWinIniChanged;
02288         }
02289         <span class="keywordflow">if</span> (fWriteAllowed) {
02290             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYDOUBLECLK) = wParam;
02291         }
02292         <span class="keywordflow">break</span>;
02293 
02294     <span class="keywordflow">case</span> SPI_GETICONTITLELOGFONT:
02295         GreExtGetObjectW(ghIconFont, <span class="keyword">sizeof</span>(LOGFONTW), lParam);
02296         <span class="keywordflow">break</span>;
02297 
02298     <span class="keywordflow">case</span> SPI_SETICONTITLELOGFONT:
02299     {
02300         <span class="keywordflow">if</span> (lParam != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02301             <span class="keywordflow">if</span> (wParam != <span class="keyword">sizeof</span>(LOGFONTW))
02302                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02303         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam) {
02304             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02305         }
02306 
02307         pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
02308         fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a26">xxxSetSPIMetrics</a>(pProfileUserName, wFlag, lParam, fAlterWinIni);
02309         <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
02310         <span class="keywordflow">if</span> (fAlterWinIni) {
02311             fWriteAllowed = fWinIniChanged;
02312         }
02313         <span class="keywordflow">break</span>;
02314     }
02315 
02316     <span class="keywordflow">case</span> SPI_SETDOUBLECLICKTIME:
02317         <span class="keywordflow">if</span> (fAlterWinIni) {
02318             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL,PMAP_MOUSE, STR_DBLCLKSPEED, wParam);
02319             fWriteAllowed = fWinIniChanged;
02320         }
02321         <span class="keywordflow">if</span> (fWriteAllowed) {
02322             <a class="code" href="../../d4/d1/userk_8h.html#a1883">_SetDoubleClickTime</a>((UINT)wParam);
02323         }
02324         <span class="keywordflow">break</span>;
02325 
02326     <span class="keywordflow">case</span> SPI_GETANIMATION: {
02327         LPANIMATIONINFO lpai = (LPANIMATIONINFO) lParam;
02328 
02329         <span class="keywordflow">if</span> (lpai == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || (wParam != <span class="keyword">sizeof</span>(ANIMATIONINFO)))
02330             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02331 
02332         lpai-&gt;cbSize        = <span class="keyword">sizeof</span>(ANIMATIONINFO);
02333         lpai-&gt;iMinAnimate   = <a class="code" href="../../d4/d1/userk_8h.html#a658">TEST_BOOL_PUDF</a>(PUDF_ANIMATE);
02334 
02335         <span class="keywordflow">break</span>;
02336     }
02337 
02338     <span class="keywordflow">case</span> SPI_GETNONCLIENTMETRICS: {
02339         LPNONCLIENTMETRICS lpnc = (LPNONCLIENTMETRICS) lParam;
02340         <span class="keywordflow">if</span> (lpnc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02341             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02342 
02343         <a class="code" href="../../d4/d1/userk_8h.html#a1854">GetWindowNCMetrics</a>(lpnc);
02344         <span class="keywordflow">break</span>;
02345     }
02346 
02347     <span class="keywordflow">case</span> SPI_GETMINIMIZEDMETRICS: {
02348         LPMINIMIZEDMETRICS lpmin = (LPMINIMIZEDMETRICS)lParam;
02349 
02350         lpmin-&gt;cbSize        = <span class="keyword">sizeof</span>(MINIMIZEDMETRICS);
02351 
02352             lpmin-&gt;iWidth    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINIMIZED) - 2*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME);
02353             lpmin-&gt;iHorzGap  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINSPACING) - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXMINIMIZED);
02354             lpmin-&gt;iVertGap  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINSPACING) - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYMINIMIZED);
02355             lpmin-&gt;iArrange  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(ARRANGE);
02356 
02357         <span class="keywordflow">break</span>;
02358     }
02359 
02360     <span class="keywordflow">case</span> SPI_GETICONMETRICS: {
02361         LPICONMETRICS lpicon = (LPICONMETRICS)lParam;
02362 
02363         lpicon-&gt;cbSize          = <span class="keyword">sizeof</span>(ICONMETRICS);
02364 
02365         lpicon-&gt;iHorzSpacing    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXICONSPACING);
02366         lpicon-&gt;iVertSpacing    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYICONSPACING);
02367         lpicon-&gt;iTitleWrap      = <a class="code" href="../../d4/d1/userk_8h.html#a658">TEST_BOOL_PUDF</a>(PUDF_ICONTITLEWRAP);
02368         GreExtGetObjectW(ghIconFont, <span class="keyword">sizeof</span>(LOGFONTW), &amp;(lpicon-&gt;lfFont));
02369 
02370         <span class="keywordflow">break</span>;
02371     }
02372 
02373     <span class="keywordflow">case</span> SPI_SETANIMATION:
02374     <span class="keywordflow">case</span> SPI_SETNONCLIENTMETRICS:
02375     <span class="keywordflow">case</span> SPI_SETICONMETRICS:
02376     <span class="keywordflow">case</span> SPI_SETMINIMIZEDMETRICS:
02377     {
02378         fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a26">xxxSetSPIMetrics</a>(NULL, wFlag, lParam, fAlterWinIni);
02379         <span class="keywordflow">if</span> (fAlterWinIni) {
02380             fWriteAllowed = fWinIniChanged;
02381         }
02382         <a class="code" href="../../d4/d1/userk_8h.html#a248">ServerLoadString</a>(hModuleWin, STR_METRICS, szSection, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szSection));
02383         <span class="keywordflow">break</span>;
02384     }
02385     <span class="keywordflow">case</span> SPI_SETMOUSEBUTTONSWAP:
02386         <span class="keywordflow">if</span> (fAlterWinIni) {
02387             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_MOUSE, STR_SWAPBUTTONS, wParam);
02388             fWriteAllowed = fWinIniChanged;
02389         }
02390         <span class="keywordflow">if</span> (fWriteAllowed) {
02391             <a class="code" href="../../d4/d1/userk_8h.html#a1884">_SwapMouseButton</a>((wParam != 0));
02392         }
02393         <span class="keywordflow">break</span>;
02394 
02395     <span class="keywordflow">case</span> SPI_GETFASTTASKSWITCH:
02396         *((<a class="code" href="../../d9/d5/ndismain_8h.html#a264">PINT</a>)lParam) = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;    <span class="comment">// do the work so we don't screw anybody</span>
02397 
02398     <span class="keywordflow">case</span> SPI_SETFASTTASKSWITCH:
02399         RIPMSG0(RIP_WARNING,<span class="stringliteral">"SPI_SETFASTTASKSWITCH and SPI_GETFASTTASKSWITCH are obsolete actions."</span>);
02400         <span class="keywordflow">break</span>;
02401 
02402     <span class="keywordflow">case</span> SPI_GETWORKAREA:
02403         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>((LPRECT)lParam, &amp;<a class="code" href="../../d6/d0/usercli_8h.html#a793">GetPrimaryMonitor</a>()-&gt;rcWork);
02404         <span class="keywordflow">break</span>;
02405 
02406     <span class="keywordflow">case</span> SPI_SETWORKAREA:
02407     {
02408         RECT        rcNewWork;
02409         LPRECT      lprcNewWork;
02410         <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>    pMonitorWork;
02411 
02412         lprcNewWork = (LPRECT)lParam;
02413 
02414         <span class="comment">/*</span>
02415 <span class="comment">         * Validate Rectangle</span>
02416 <span class="comment">         */</span>
02417         <span class="keywordflow">if</span> ((lprcNewWork != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
02418             ((lprcNewWork-&gt;right &lt; lprcNewWork-&gt;left) ||
02419              (lprcNewWork-&gt;bottom &lt; lprcNewWork-&gt;top))) {
02420 
02421             RIPMSG0(RIP_WARNING, <span class="stringliteral">"Bad work rectangle passed to SystemParametersInfo(SPI_SETWORKAREA, ...)\n"</span>);
02422             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02423         }
02424 
02425         <span class="comment">/*</span>
02426 <span class="comment">         * Figure out which monitor has the working area.</span>
02427 <span class="comment">         */</span>
02428         <span class="keywordflow">if</span> (!lprcNewWork) {
02429             pMonitorWork = <a class="code" href="../../d6/d0/usercli_8h.html#a793">GetPrimaryMonitor</a>();
02430             lprcNewWork = &amp;pMonitorWork-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>;
02431         } <span class="keywordflow">else</span> {
02432             pMonitorWork = <a class="code" href="../../d9/d1/mmrtl_8c.html#a7">_MonitorFromRect</a>(lprcNewWork, MONITOR_DEFAULTTOPRIMARY);
02433         }
02434 
02435         <span class="comment">/*</span>
02436 <span class="comment">         * Get new working area, clipped to monitor of course.</span>
02437 <span class="comment">         */</span>
02438         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a8">IntersectRect</a>(&amp;rcNewWork, lprcNewWork, &amp;pMonitorWork-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>) ||
02439             !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a34">EqualRect</a>(&amp;rcNewWork, lprcNewWork))
02440         {
02441             <span class="comment">/*</span>
02442 <span class="comment">             * Complain.</span>
02443 <span class="comment">             */</span>
02444             RIPERR4(
02445                     ERROR_INVALID_PARAMETER,
02446                     RIP_WARNING,
02447                     <span class="stringliteral">"Bad work rectangle passed to SystemParametersInfo(SPI_SETWORKAREA, ...) %d, %d, %d, %d"</span>,
02448                     lprcNewWork-&gt;left, lprcNewWork-&gt;top, lprcNewWork-&gt;right, lprcNewWork-&gt;bottom);
02449             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02450         }
02451 
02452         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a34">EqualRect</a>(&amp;pMonitorWork-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>, &amp;rcNewWork))
02453         {
02454             <a class="code" href="../../d3/d2/structtagMONITORRECTS.html">PMONITORRECTS</a>   pmr;
02455 
02456             <span class="comment">/*</span>
02457 <span class="comment">             * If we are going to reposition windows, remember the old</span>
02458 <span class="comment">             * monitor positions for xxxDesktopRecalc.</span>
02459 <span class="comment">             */</span>
02460             <span class="keywordflow">if</span> (wParam) {
02461                 pmr = <a class="code" href="../../d4/d5/rare_8c.html#a9">SnapshotMonitorRects</a>();
02462                 <span class="keywordflow">if</span> (!pmr) {
02463                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02464                 }
02465             }
02466 
02467             pMonitorWork-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a> = rcNewWork;
02468             <span class="keywordflow">if</span> (pMonitorWork == <a class="code" href="../../d6/d0/usercli_8h.html#a793">GetPrimaryMonitor</a>()) {
02469                 <a class="code" href="../../d4/d5/rare_8c.html#a14">SetDesktopMetrics</a>();
02470             }
02471 
02472             <span class="comment">/*</span>
02473 <span class="comment">             * Reposition windows</span>
02474 <span class="comment">             */</span>
02475 
02476             <span class="keywordflow">if</span> (wParam) {
02477 
02478                 <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlPool;
02479 
02480                 <a class="code" href="../../d4/d1/userk_8h.html#a137">ThreadLockPool</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), pmr, &amp;tlPool);
02481                 <a class="code" href="../../d4/d1/userk_8h.html#a1882">xxxDesktopRecalc</a>(pmr);
02482                 <a class="code" href="../../d4/d1/userk_8h.html#a139">ThreadUnlockAndFreePool</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), &amp;tlPool);
02483             }
02484 
02485             fWinIniChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02486         }
02487 
02488         fWriteAllowed = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02489         <span class="keywordflow">break</span>;
02490     }
02491 
02492     <span class="keywordflow">case</span> SPI_SETDRAGFULLWINDOWS:
02493         wParam = (wParam == 1);
02494         <span class="keywordflow">if</span> (fAlterWinIni) {
02495             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_DESKTOP, STR_DRAGFULLWINDOWS, wParam);
02496             fWriteAllowed = fWinIniChanged;
02497         }
02498         <span class="keywordflow">if</span> (fWriteAllowed) {
02499             <a class="code" href="../../d4/d1/userk_8h.html#a661">SET_OR_CLEAR_PUDF</a>(PUDF_DRAGFULLWINDOWS, wParam);
02500         }
02501         <span class="keywordflow">break</span>;
02502 
02503     <span class="keywordflow">case</span> SPI_GETDRAGFULLWINDOWS:
02504         *((<a class="code" href="../../d9/d5/ndismain_8h.html#a264">PINT</a>)lParam) = <a class="code" href="../../d4/d1/userk_8h.html#a658">TEST_BOOL_PUDF</a>(PUDF_DRAGFULLWINDOWS);
02505         <span class="keywordflow">break</span>;
02506 
02507     <span class="keywordflow">case</span> SPI_GETFILTERKEYS:
02508         {
02509             LPFILTERKEYS pFK = (LPFILTERKEYS)lParam;
02510             <span class="keywordtype">int</span> cbSkip = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a32">gFilterKeys</a>.cbSize);
02511 
02512             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(FILTERKEYS))) {
02513                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02514             }
02515             <span class="keywordflow">if</span> (!pFK || (pFK-&gt;cbSize != <span class="keyword">sizeof</span>(FILTERKEYS))) {
02516                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02517             }
02518             <span class="comment">/*</span>
02519 <span class="comment">             * In the future we may support multiple sizes of this data structure.  Don't</span>
02520 <span class="comment">             * change the cbSize field of the data structure passed in.</span>
02521 <span class="comment">             */</span>
02522             RtlCopyMemory((LPVOID)((LPBYTE)pFK + cbSkip),
02523                           (LPVOID)((LPBYTE)&amp;gFilterKeys + cbSkip),
02524                           pFK-&gt;cbSize - cbSkip);
02525         }
02526         <span class="keywordflow">break</span>;
02527 
02528     <span class="keywordflow">case</span> SPI_SETFILTERKEYS:
02529         {
02530             LPFILTERKEYS pFK = (LPFILTERKEYS)lParam;
02531 
02532             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(FILTERKEYS))) {
02533                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02534             }
02535             <span class="keywordflow">if</span> (!pFK || (pFK-&gt;cbSize != <span class="keyword">sizeof</span>(FILTERKEYS)))
02536                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02537 
02538             <span class="comment">/*</span>
02539 <span class="comment">             * SlowKeys and BounceKeys cannot both be active simultaneously</span>
02540 <span class="comment">             */</span>
02541             <span class="keywordflow">if</span> (pFK-&gt;iWaitMSec &amp;&amp; pFK-&gt;iBounceMSec) {
02542                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02543             }
02544 
02545             <span class="comment">/*</span>
02546 <span class="comment">             * Do some parameter validation.  We will fail on unsupported and</span>
02547 <span class="comment">             * undefined bits being set.</span>
02548 <span class="comment">             */</span>
02549             <span class="keywordflow">if</span> ((pFK-&gt;dwFlags &amp; FKF_VALID) != pFK-&gt;dwFlags) {
02550                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02551             }
02552             <span class="comment">/*</span>
02553 <span class="comment">             * FKF_AVAILABLE can't be set via API.  Use registry value.</span>
02554 <span class="comment">             */</span>
02555             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/access_8h.html#a0">TEST_ACCESSFLAG</a>(FilterKeys, FKF_AVAILABLE)) {
02556                 pFK-&gt;dwFlags |= FKF_AVAILABLE;
02557             } <span class="keywordflow">else</span> {
02558                 pFK-&gt;dwFlags &amp;= ~FKF_AVAILABLE;
02559             }
02560             <span class="keywordflow">if</span> ((pFK-&gt;iWaitMSec &gt; 2000) ||
02561                 (pFK-&gt;iDelayMSec &gt; 2000) ||
02562                 (pFK-&gt;iRepeatMSec &gt; 2000) ||
02563                 (pFK-&gt;iBounceMSec &gt; 2000)) {
02564                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02565             }
02566 
02567             <span class="keywordflow">if</span> (fAlterWinIni) {
02568                 pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
02569                 fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a27">SetFilterKeys</a>(pProfileUserName, pFK);
02570                 fWriteAllowed = fWinIniChanged;
02571                 <span class="keywordflow">if</span> (!fWinIniChanged) {
02572 
02573                     <span class="comment">/*</span>
02574 <span class="comment">                     * Back out any changes to win.ini</span>
02575 <span class="comment">                     */</span>
02576                     <a class="code" href="../../d4/d5/rare_8c.html#a27">SetFilterKeys</a>(pProfileUserName, &amp;gFilterKeys);
02577                 }
02578                 <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
02579             }
02580             <span class="keywordflow">if</span> (fWriteAllowed) {
02581                 RtlCopyMemory(&amp;gFilterKeys, pFK, pFK-&gt;cbSize);
02582 
02583                 <span class="comment">/*</span>
02584 <span class="comment">                 * Don't allow user to change cbSize field</span>
02585 <span class="comment">                 */</span>
02586                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a32">gFilterKeys</a>.cbSize = <span class="keyword">sizeof</span>(FILTERKEYS);
02587 
02588                 <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d3/access_8h.html#a0">TEST_ACCESSFLAG</a>(FilterKeys, FKF_FILTERKEYSON)) {
02589                     <a class="code" href="../../d9/d3/access_8h.html#a50">StopFilterKeysTimers</a>();
02590                 }
02591                 <a class="code" href="../../d9/d3/access_8h.html#a49">SetAccessEnabledFlag</a>();
02592                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a593">FCallHookTray</a>())
02593                     <a class="code" href="../../d4/d1/userk_8h.html#a1521">xxxCallHook</a>(HSHELL_ACCESSIBILITYSTATE,
02594                                 ACCESS_FILTERKEYS,
02595                                 (LONG)0,
02596                                 WH_SHELL);
02597                 <a class="code" href="../../d4/d1/userk_8h.html#a1867">PostShellHookMessages</a>(HSHELL_ACCESSIBILITYSTATE, ACCESS_FILTERKEYS);
02598             }
02599         }
02600         <span class="keywordflow">break</span>;
02601 
02602     <span class="keywordflow">case</span> SPI_GETSTICKYKEYS:
02603         {
02604             LPSTICKYKEYS pSK = (LPSTICKYKEYS)lParam;
02605             <span class="keywordtype">int</span> cbSkip = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a33">gStickyKeys</a>.cbSize);
02606 
02607             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(STICKYKEYS))) {
02608                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02609             }
02610             <span class="keywordflow">if</span> (!pSK || (pSK-&gt;cbSize != <span class="keyword">sizeof</span>(STICKYKEYS))) {
02611                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02612             }
02613             <span class="comment">/*</span>
02614 <span class="comment">             * In the future we may support multiple sizes of this data structure.  Don't</span>
02615 <span class="comment">             * change the cbSize field of the data structure passed in.</span>
02616 <span class="comment">             */</span>
02617             RtlCopyMemory((LPVOID)((LPBYTE)pSK + cbSkip),
02618                           (LPVOID)((LPBYTE)&amp;gStickyKeys + cbSkip),
02619                           pSK-&gt;cbSize - cbSkip);
02620 
02621             pSK-&gt;dwFlags &amp;= ~SKF_STATEINFO;
02622             pSK-&gt;dwFlags |= (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a166">gLatchBits</a>&amp;0xff) &lt;&lt;24;
02623 
02624 <span class="preprocessor">#if SKF_LALTLATCHED != 0x10000000</span>
02625 <span class="preprocessor"></span><span class="preprocessor">#error SKF_LALTLATCHED value is incorrect</span>
02626 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02627 <span class="preprocessor"></span><span class="preprocessor">#if SKF_LCTLLATCHED != 0x04000000</span>
02628 <span class="preprocessor"></span><span class="preprocessor">#error SKF_LCTLLATCHED value is incorrect</span>
02629 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02630 <span class="preprocessor"></span><span class="preprocessor">#if SKF_LSHIFTLATCHED != 0x01000000</span>
02631 <span class="preprocessor"></span><span class="preprocessor">#error SKF_LSHIFTLATCHED value is incorrect</span>
02632 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02633 <span class="preprocessor"></span><span class="preprocessor">#if SKF_RALTLATCHED  !=  0x20000000</span>
02634 <span class="preprocessor"></span><span class="preprocessor">#error SKF_RALTLATCHED value is incorrect</span>
02635 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02636 <span class="preprocessor"></span><span class="preprocessor">#if  SKF_RCTLLATCHED != 0x08000000</span>
02637 <span class="preprocessor"></span><span class="preprocessor">#error SKF_RCTLLATCHED value is incorrect</span>
02638 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02639 <span class="preprocessor"></span><span class="preprocessor">#if SKF_RSHIFTLATCHED != 0x02000000</span>
02640 <span class="preprocessor"></span><span class="preprocessor">#error SKF_RSHIFTLATCHED value is incorrect</span>
02641 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02642 <span class="preprocessor"></span>            pSK-&gt;dwFlags |= (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a167">gLockBits</a>&amp;0xff) &lt;&lt;16;
02643 <span class="preprocessor">#if SKF_LALTLOCKED != 0x00100000</span>
02644 <span class="preprocessor"></span><span class="preprocessor">#error SKF_LALTLOCKED value is incorrect</span>
02645 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02646 <span class="preprocessor"></span><span class="preprocessor">#if SKF_LCTLLOCKED != 0x00040000</span>
02647 <span class="preprocessor"></span><span class="preprocessor">#error SKF_LCTLLOCKED value is incorrect</span>
02648 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02649 <span class="preprocessor"></span><span class="preprocessor">#if SKF_LSHIFTLOCKED != 0x00010000</span>
02650 <span class="preprocessor"></span><span class="preprocessor">#error SKF_LSHIFTLOCKED value is incorrect</span>
02651 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02652 <span class="preprocessor"></span><span class="preprocessor">#if SKF_RALTLOCKED  != 0x00200000</span>
02653 <span class="preprocessor"></span><span class="preprocessor">#error SKF_RALTLOCKED value is incorrect</span>
02654 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02655 <span class="preprocessor"></span><span class="preprocessor">#if SKF_RCTLLOCKED != 0x00080000</span>
02656 <span class="preprocessor"></span><span class="preprocessor">#error SKF_RCTLLOCKED value is incorrect</span>
02657 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02658 <span class="preprocessor"></span><span class="preprocessor">#if SKF_RSHIFTLOCKED != 0x00020000</span>
02659 <span class="preprocessor"></span><span class="preprocessor">#error SKF_RSHIFTLOCKED value is incorrect</span>
02660 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02661 <span class="preprocessor"></span>
02662         }
02663 
02664         <span class="keywordflow">break</span>;
02665 
02666     <span class="keywordflow">case</span> SPI_SETSTICKYKEYS:
02667         {
02668             LPSTICKYKEYS pSK = (LPSTICKYKEYS)lParam;
02669             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fWasOn;
02670 
02671             fWasOn = <a class="code" href="../../d9/d3/access_8h.html#a1">TEST_BOOL_ACCESSFLAG</a>(StickyKeys, SKF_STICKYKEYSON);
02672             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(STICKYKEYS))) {
02673                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02674             }
02675             <span class="keywordflow">if</span> (!pSK || (pSK-&gt;cbSize != <span class="keyword">sizeof</span>(STICKYKEYS)))
02676                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02677 
02678             pSK-&gt;dwFlags &amp;= ~SKF_STATEINFO;  <span class="comment">/* Don't penalize them for using</span>
02679 <span class="comment">                                              * data from SPI_GETSTICKYKEYS.</span>
02680 <span class="comment">                                              */</span>
02681 
02682             <span class="comment">/*</span>
02683 <span class="comment">             * Do some parameter validation.  We will fail on unsupported and</span>
02684 <span class="comment">             * undefined bits being set.</span>
02685 <span class="comment">             */</span>
02686             <span class="keywordflow">if</span> ((pSK-&gt;dwFlags &amp; SKF_VALID) != pSK-&gt;dwFlags) {
02687                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02688             }
02689             <span class="comment">/*</span>
02690 <span class="comment">             * SKF_AVAILABLE can't be set via API.  Use registry value.</span>
02691 <span class="comment">             */</span>
02692             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/access_8h.html#a0">TEST_ACCESSFLAG</a>(StickyKeys, SKF_AVAILABLE)) {
02693                 pSK-&gt;dwFlags |= SKF_AVAILABLE;
02694             } <span class="keywordflow">else</span> {
02695                 pSK-&gt;dwFlags &amp;= ~SKF_AVAILABLE;
02696             }
02697 
02698             <span class="keywordflow">if</span> (fAlterWinIni) {
02699                 swprintf(szTemp, pwszd, pSK-&gt;dwFlags);
02700                 fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(NULL,
02701                         PMAP_STICKYKEYS,
02702                         L<span class="stringliteral">"Flags"</span>,
02703                         szTemp
02704                         );
02705                 fWriteAllowed = fWinIniChanged;
02706             }
02707             <span class="keywordflow">if</span> (fWriteAllowed) {
02708                 RtlCopyMemory(&amp;gStickyKeys, pSK, pSK-&gt;cbSize);
02709 
02710                 <span class="comment">/*</span>
02711 <span class="comment">                 * Don't allow user to change cbSize field</span>
02712 <span class="comment">                 */</span>
02713                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a33">gStickyKeys</a>.cbSize = <span class="keyword">sizeof</span>(STICKYKEYS);
02714                 <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d3/access_8h.html#a0">TEST_ACCESSFLAG</a>(StickyKeys, SKF_STICKYKEYSON) &amp;&amp; fWasOn) {
02715                     <a class="code" href="../../d9/d3/access_8h.html#a60">xxxTurnOffStickyKeys</a>();
02716                 }
02717 
02718                 <a class="code" href="../../d9/d3/access_8h.html#a49">SetAccessEnabledFlag</a>();
02719                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a593">FCallHookTray</a>())
02720                     <a class="code" href="../../d4/d1/userk_8h.html#a1521">xxxCallHook</a>(HSHELL_ACCESSIBILITYSTATE,
02721                                 ACCESS_STICKYKEYS,
02722                                 (LONG)0,
02723                                 WH_SHELL);
02724                 <a class="code" href="../../d4/d1/userk_8h.html#a1867">PostShellHookMessages</a>(HSHELL_ACCESSIBILITYSTATE, ACCESS_STICKYKEYS);
02725             }
02726         }
02727         <span class="keywordflow">break</span>;
02728 
02729     <span class="keywordflow">case</span> SPI_GETTOGGLEKEYS:
02730         {
02731             LPTOGGLEKEYS pTK = (LPTOGGLEKEYS)lParam;
02732             <span class="keywordtype">int</span> cbSkip = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a36">gToggleKeys</a>.cbSize);
02733 
02734             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(TOGGLEKEYS))) {
02735                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02736             }
02737             <span class="keywordflow">if</span> (!pTK || (pTK-&gt;cbSize != <span class="keyword">sizeof</span>(TOGGLEKEYS))) {
02738                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02739             }
02740             <span class="comment">/*</span>
02741 <span class="comment">             * In the future we may support multiple sizes of this data structure.  Don't</span>
02742 <span class="comment">             * change the cbSize field of the data structure passed in.</span>
02743 <span class="comment">             */</span>
02744             RtlCopyMemory((LPVOID)((LPBYTE)pTK + cbSkip),
02745                           (LPVOID)((LPBYTE)&amp;gToggleKeys + cbSkip),
02746                           pTK-&gt;cbSize - cbSkip);
02747         }
02748         <span class="keywordflow">break</span>;
02749 
02750     <span class="keywordflow">case</span> SPI_SETTOGGLEKEYS:
02751         {
02752             LPTOGGLEKEYS pTK = (LPTOGGLEKEYS)lParam;
02753 
02754             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(TOGGLEKEYS))) {
02755                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02756             }
02757             <span class="keywordflow">if</span> (!pTK || (pTK-&gt;cbSize != <span class="keyword">sizeof</span>(TOGGLEKEYS)))
02758                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02759 
02760             <span class="comment">/*</span>
02761 <span class="comment">             * Do some parameter validation.  We will fail on unsupported and</span>
02762 <span class="comment">             * undefined bits being set.</span>
02763 <span class="comment">             */</span>
02764             <span class="keywordflow">if</span> ((pTK-&gt;dwFlags &amp; TKF_VALID) != pTK-&gt;dwFlags) {
02765                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02766             }
02767             <span class="comment">/*</span>
02768 <span class="comment">             * TKF_AVAILABLE can't be set via API.  Use registry value.</span>
02769 <span class="comment">             */</span>
02770             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/access_8h.html#a0">TEST_ACCESSFLAG</a>(ToggleKeys, TKF_AVAILABLE)) {
02771                 pTK-&gt;dwFlags |= TKF_AVAILABLE;
02772             } <span class="keywordflow">else</span> {
02773                 pTK-&gt;dwFlags &amp;= ~TKF_AVAILABLE;
02774             }
02775 
02776             <span class="keywordflow">if</span> (fAlterWinIni) {
02777                 swprintf(szTemp, pwszd, pTK-&gt;dwFlags);
02778                 fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(NULL,
02779                         PMAP_TOGGLEKEYS,
02780                         L<span class="stringliteral">"Flags"</span>,
02781                         szTemp
02782                         );
02783                 fWriteAllowed = fWinIniChanged;
02784             }
02785             <span class="keywordflow">if</span> (fWriteAllowed) {
02786                 RtlCopyMemory(&amp;gToggleKeys, pTK, pTK-&gt;cbSize);
02787 
02788                 <span class="comment">/*</span>
02789 <span class="comment">                 * Don't allow user to change cbSize field</span>
02790 <span class="comment">                 */</span>
02791                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a36">gToggleKeys</a>.cbSize = <span class="keyword">sizeof</span>(TOGGLEKEYS);
02792 
02793                 <a class="code" href="../../d9/d3/access_8h.html#a49">SetAccessEnabledFlag</a>();
02794             }
02795         }
02796         <span class="keywordflow">break</span>;
02797 
02798     <span class="keywordflow">case</span> SPI_GETMOUSEKEYS:
02799         {
02800             LPMOUSEKEYS pMK = (LPMOUSEKEYS)lParam;
02801             <span class="keywordtype">int</span> cbSkip = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a34">gMouseKeys</a>.cbSize);
02802 
02803             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(MOUSEKEYS))) {
02804                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02805             }
02806             <span class="keywordflow">if</span> (!pMK || (pMK-&gt;cbSize != <span class="keyword">sizeof</span>(MOUSEKEYS))) {
02807                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02808             }
02809             <span class="comment">/*</span>
02810 <span class="comment">             * In the future we may support multiple sizes of this data structure.  Don't</span>
02811 <span class="comment">             * change the cbSize field of the data structure passed in.</span>
02812 <span class="comment">             */</span>
02813             RtlCopyMemory((LPVOID)((LPBYTE)pMK + cbSkip),
02814                           (LPVOID)((LPBYTE)&amp;gMouseKeys + cbSkip),
02815                           pMK-&gt;cbSize - cbSkip);
02816 
02817 
02818             pMK-&gt;dwFlags &amp;= ~MKF_STATEINFO;
02819 
02820             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a170">gbMKMouseMode</a>) pMK-&gt;dwFlags |= MKF_MOUSEMODE;
02821 
02822             pMK-&gt;dwFlags |= (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a53">gwMKButtonState</a> &amp; 3) &lt;&lt; 24;
02823 <span class="preprocessor">#if MOUSE_BUTTON_LEFT != 0x01</span>
02824 <span class="preprocessor"></span><span class="preprocessor">#error MOUSE_BUTTON_LEFT value is incorrect</span>
02825 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02826 <span class="preprocessor"></span><span class="preprocessor">#if MOUSE_BUTTON_RIGHT != 0x02</span>
02827 <span class="preprocessor"></span><span class="preprocessor">#error MOUSE_BUTTON_RIGHT value is incorrect</span>
02828 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02829 <span class="preprocessor"></span><span class="preprocessor">#if MKF_LEFTBUTTONDOWN != 0x01000000</span>
02830 <span class="preprocessor"></span><span class="preprocessor">#error MKF_LEFTBUTTONDOWN value is incorrect</span>
02831 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02832 <span class="preprocessor"></span><span class="preprocessor">#if MKF_RIGHTBUTTONDOWN != 0x02000000</span>
02833 <span class="preprocessor"></span><span class="preprocessor">#error MKF_RIGHTBUTTONDOWN value is incorrect</span>
02834 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02835 <span class="preprocessor"></span>
02836             pMK-&gt;dwFlags |= (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a54">gwMKCurrentButton</a> &amp; 3)&lt;&lt; 28;
02837 <span class="preprocessor">#if MKF_LEFTBUTTONSEL != 0x10000000</span>
02838 <span class="preprocessor"></span><span class="preprocessor">#error MKF_LEFTBUTTONSEL value is incorrect</span>
02839 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02840 <span class="preprocessor"></span><span class="preprocessor">#if MKF_RIGHTBUTTONSEL != 0x20000000</span>
02841 <span class="preprocessor"></span><span class="preprocessor">#error MKF_RIGHTBUTTONSEL value is incorrect</span>
02842 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02843 <span class="preprocessor"></span>        }
02844         <span class="keywordflow">break</span>;
02845 
02846     <span class="keywordflow">case</span> SPI_SETMOUSEKEYS: {
02847             LPMOUSEKEYS pMK = (LPMOUSEKEYS)lParam;
02848 
02849             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(MOUSEKEYS))) {
02850                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02851             }
02852             <span class="keywordflow">if</span> (!pMK || (pMK-&gt;cbSize != <span class="keyword">sizeof</span>(MOUSEKEYS)))
02853                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02854 
02855             <span class="comment">/*</span>
02856 <span class="comment">             * Do some parameter validation.  We will fail on unsupported and</span>
02857 <span class="comment">             * undefined bits being set.</span>
02858 <span class="comment">             */</span>
02859             pMK-&gt;dwFlags &amp;= ~MKF_STATEINFO;  <span class="comment">/* Don't penalize them for using</span>
02860 <span class="comment">                                              * data from SPI_GETMOUSEKEYS.</span>
02861 <span class="comment">                                              */</span>
02862 
02863             <span class="keywordflow">if</span> ((pMK-&gt;dwFlags &amp; MKF_VALID) != pMK-&gt;dwFlags) {
02864                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02865             }
02866             <span class="comment">/*</span>
02867 <span class="comment">             * MKF_AVAILABLE can't be set via API.  Use registry value.</span>
02868 <span class="comment">             */</span>
02869             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/access_8h.html#a0">TEST_ACCESSFLAG</a>(MouseKeys, MKF_AVAILABLE)) {
02870                 pMK-&gt;dwFlags |= MKF_AVAILABLE;
02871             } <span class="keywordflow">else</span> {
02872                 pMK-&gt;dwFlags &amp;= ~MKF_AVAILABLE;
02873             }
02874             <span class="keywordflow">if</span> ((pMK-&gt;iMaxSpeed &lt; 10) || (pMK-&gt;iMaxSpeed &gt; 360)) {
02875                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02876             }
02877             <span class="keywordflow">if</span> ((pMK-&gt;iTimeToMaxSpeed &lt; 1000) || (pMK-&gt;iTimeToMaxSpeed &gt; 5000)) {
02878                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02879             }
02880 
02881             <span class="keywordflow">if</span> (fAlterWinIni) {
02882                 pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
02883                 fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a28">SetMouseKeys</a>(pProfileUserName, pMK);
02884                 fWriteAllowed = fWinIniChanged;
02885                 <span class="keywordflow">if</span> (!fWinIniChanged) {
02886 
02887                     <span class="comment">/*</span>
02888 <span class="comment">                     * Back out any changes to win.ini</span>
02889 <span class="comment">                     */</span>
02890                     <a class="code" href="../../d4/d5/rare_8c.html#a28">SetMouseKeys</a>(pProfileUserName, &amp;gMouseKeys);
02891                 }
02892                 <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
02893             }
02894             <span class="keywordflow">if</span> (fWriteAllowed) {
02895                 RtlCopyMemory(&amp;gMouseKeys, pMK, pMK-&gt;cbSize);
02896 
02897                 <span class="comment">/*</span>
02898 <span class="comment">                 * Don't allow user to change cbSize field</span>
02899 <span class="comment">                 */</span>
02900                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a34">gMouseKeys</a>.cbSize = <span class="keyword">sizeof</span>(MOUSEKEYS);
02901 
02902                 <a class="code" href="../../d9/d3/access_8h.html#a71">CalculateMouseTable</a>();
02903 
02904                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/access_8h.html#a0">TEST_ACCESSFLAG</a>(MouseKeys, MKF_MOUSEKEYSON)) {
02905                     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a846">TestAsyncKeyStateToggle</a>(gNumLockVk) != 0) ^
02906                         (<a class="code" href="../../d9/d3/access_8h.html#a0">TEST_ACCESSFLAG</a>(MouseKeys, MKF_REPLACENUMBERS) != 0))
02907                         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a170">gbMKMouseMode</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02908                     <span class="keywordflow">else</span>
02909                         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a170">gbMKMouseMode</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02910                     <a class="code" href="../../d8/d3/ntuser_2kernel_2access_8c.html#a25">MKShowMouseCursor</a>();
02911                 } <span class="keywordflow">else</span> {
02912                     <a class="code" href="../../d8/d3/ntuser_2kernel_2access_8c.html#a26">MKHideMouseCursor</a>();
02913                 }
02914 
02915                 <a class="code" href="../../d9/d3/access_8h.html#a49">SetAccessEnabledFlag</a>();
02916 
02917                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a593">FCallHookTray</a>())
02918                     <a class="code" href="../../d4/d1/userk_8h.html#a1521">xxxCallHook</a>(HSHELL_ACCESSIBILITYSTATE,
02919                                 ACCESS_MOUSEKEYS,
02920                                 (LONG)0,
02921                                 WH_SHELL);
02922                 <a class="code" href="../../d4/d1/userk_8h.html#a1867">PostShellHookMessages</a>(HSHELL_ACCESSIBILITYSTATE, ACCESS_MOUSEKEYS);
02923             }
02924         }
02925         <span class="keywordflow">break</span>;
02926 
02927     <span class="keywordflow">case</span> SPI_GETHIGHCONTRAST:
02928         {
02929             LPHIGHCONTRAST pHC = (LPHIGHCONTRAST)lParam;
02930 
02931             <span class="comment">/*</span>
02932 <span class="comment">             * In the future we may support multiple sizes of this data structure.  Don't</span>
02933 <span class="comment">             * change the cbSize field of the data structure passed in.</span>
02934 <span class="comment">             */</span>
02935 
02936             pHC-&gt;dwFlags = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a38">gHighContrast</a>.dwFlags;
02937 
02938             <span class="comment">/*</span>
02939 <span class="comment">             * A hostile app could deallocate the memory using a second thread,</span>
02940 <span class="comment">             * so shelter the copy with a try.</span>
02941 <span class="comment">             */</span>
02942             <span class="keywordflow">try</span> {
02943                 RtlCopyMemory(pHC-&gt;lpszDefaultScheme, gHighContrastDefaultScheme, MAX_SCHEME_NAME_SIZE * <span class="keyword">sizeof</span>(WCHAR));
02944             } except (W32ExceptionHandler(FALSE, RIP_WARNING)) {
02945             }
02946         }
02947 
02948         <span class="keywordflow">break</span>;
02949 
02950     <span class="keywordflow">case</span> SPI_SETHIGHCONTRAST:
02951         {
02952             <a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html">LPINTERNALSETHIGHCONTRAST</a> pHC = (<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html">LPINTERNALSETHIGHCONTRAST</a>)lParam;
02953             WCHAR wcDefaultScheme[MAX_SCHEME_NAME_SIZE];
02954 
02955             <span class="keywordflow">if</span> (pHC-&gt;<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html#o2">usDefaultScheme</a>.Length &gt;= MAX_SCHEME_NAME_SIZE*<span class="keyword">sizeof</span>(WCHAR) )
02956                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02957 
02958             <span class="keywordflow">if</span> (pHC-&gt;<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html#o2">usDefaultScheme</a>.Buffer) {
02959                 <span class="comment">/*</span>
02960 <span class="comment">                 * Only set the scheme if the user specifies a scheme.  An empty</span>
02961 <span class="comment">                 * buffer is ignored.  We do the copy here so that we don't need to</span>
02962 <span class="comment">                 * put a try/except around the WriteProfileString code.</span>
02963 <span class="comment">                 */</span>
02964 
02965                 <span class="keywordflow">try</span> {
02966                     RtlCopyMemory(wcDefaultScheme, pHC-&gt;<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html#o2">usDefaultScheme</a>.Buffer, pHC-&gt;<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html#o2">usDefaultScheme</a>.Length);
02967                 } except (W32ExceptionHandler(TRUE, RIP_WARNING)) {
02968                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02969                 }
02970             }
02971             wcDefaultScheme[pHC-&gt;<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html#o2">usDefaultScheme</a>.Length / <span class="keyword">sizeof</span>(WCHAR)] = 0;
02972 
02973             <span class="keywordflow">if</span> (fAlterWinIni) {
02974                 pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
02975                 swprintf(szTemp, pwszd, pHC-&gt;<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html#o1">dwFlags</a>);
02976                 fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
02977                         PMAP_HIGHCONTRAST,
02978                         L<span class="stringliteral">"Flags"</span>,
02979                         szTemp
02980                         );
02981 
02982                 fWriteAllowed = fWinIniChanged;
02983                 <span class="comment">/*</span>
02984 <span class="comment">                 * Note -- we do not write anything if there is no default scheme</span>
02985 <span class="comment">                 * from the app.  This is consistent with Win95/Win98 behavior.</span>
02986 <span class="comment">                 */</span>
02987 
02988                 <span class="keywordflow">if</span> (pHC-&gt;<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html#o2">usDefaultScheme</a>.Buffer) {
02989                     fWinIniChanged |= <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
02990                         PMAP_HIGHCONTRAST,
02991                         TEXT(<span class="stringliteral">"High Contrast Scheme"</span>),
02992                         wcDefaultScheme
02993                         );
02994                 }
02995                 <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
02996 
02997             }
02998             <span class="keywordflow">if</span> (fWriteAllowed) {
02999                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwFlagsOld = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a38">gHighContrast</a>.dwFlags;
03000                 LPARAM lp = fAlterWinIni?0:ACCESS_HIGHCONTRASTNOREG;
03001 
03002 <span class="preprocessor">#if (ACCESS_HIGHCONTRASTNOREG | ACCESS_HIGHCONTRASTOFF) != ACCESS_HIGHCONTRASTOFFNOREG</span>
03003 <span class="preprocessor"></span><span class="preprocessor">#error ACCESS_HIGHCONTRASTOFF value is incorrect</span>
03004 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
03005 <span class="preprocessor"></span><span class="preprocessor">#if (ACCESS_HIGHCONTRASTNOREG | ACCESS_HIGHCONTRASTON) != ACCESS_HIGHCONTRASTONNOREG</span>
03006 <span class="preprocessor"></span><span class="preprocessor">#error ACCESS_HIGHCONTRASTON value is incorrect</span>
03007 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
03008 <span class="preprocessor"></span><span class="preprocessor">#if (ACCESS_HIGHCONTRASTNOREG | ACCESS_HIGHCONTRASTCHANGE) != ACCESS_HIGHCONTRASTCHANGENOREG</span>
03009 <span class="preprocessor"></span><span class="preprocessor">#error ACCESS_HIGHCONTRASTCHANGE value is incorrect</span>
03010 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
03011 <span class="preprocessor"></span>
03012                 <span class="comment">/*</span>
03013 <span class="comment">                 * If a NULL is specified in the lpszDefaultScheme, then it is</span>
03014 <span class="comment">                 * not changed.  This is consistent with Win95/Win98 behavior.</span>
03015 <span class="comment">                 */</span>
03016 
03017                 <span class="keywordflow">if</span> (pHC-&gt;<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html#o2">usDefaultScheme</a>.Buffer)
03018                     wcscpy(gHighContrastDefaultScheme, wcDefaultScheme);
03019 
03020                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a38">gHighContrast</a>.dwFlags = pHC-&gt;<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html#o1">dwFlags</a>;
03021 
03022                 <span class="comment">/*</span>
03023 <span class="comment">                 * now, post message to turn high contrast on or off</span>
03024 <span class="comment">                 */</span>
03025 
03026                 <span class="keywordflow">if</span> (pHC-&gt;<a class="code" href="../../d8/d8/structtagINTERNALSETHIGHCONTRAST.html#o1">dwFlags</a> &amp; HCF_HIGHCONTRASTON) {
03027                     <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(gspwndLogonNotify, WM_LOGONNOTIFY, LOGON_ACCESSNOTIFY,
03028                         (dwFlagsOld &amp; HCF_HIGHCONTRASTON)? (ACCESS_HIGHCONTRASTCHANGE | lp):
03029                                                            (ACCESS_HIGHCONTRASTON | lp));
03030                 } <span class="keywordflow">else</span> {
03031                     <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(gspwndLogonNotify, WM_LOGONNOTIFY, LOGON_ACCESSNOTIFY, ACCESS_HIGHCONTRASTOFF | lp);
03032                 }
03033 
03034             }
03035         <span class="keywordflow">break</span>;
03036         }
03037 
03038     <span class="keywordflow">case</span> SPI_GETACCESSTIMEOUT:
03039         {
03040             LPACCESSTIMEOUT pTO = (LPACCESSTIMEOUT)lParam;
03041             <span class="keywordtype">int</span> cbSkip = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a35">gAccessTimeOut</a>.cbSize);
03042 
03043             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(ACCESSTIMEOUT))) {
03044                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03045             }
03046             <span class="keywordflow">if</span> (!pTO || (pTO-&gt;cbSize != <span class="keyword">sizeof</span>(ACCESSTIMEOUT))) {
03047                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03048             }
03049             <span class="comment">/*</span>
03050 <span class="comment">             * In the future we may support multiple sizes of this data structure.  Don't</span>
03051 <span class="comment">             * change the cbSize field of the data structure passed in.</span>
03052 <span class="comment">             */</span>
03053             RtlCopyMemory((LPVOID)((LPBYTE)pTO + cbSkip),
03054                           (LPVOID)((LPBYTE)&amp;gAccessTimeOut + cbSkip),
03055                           pTO-&gt;cbSize - cbSkip);
03056         }
03057         <span class="keywordflow">break</span>;
03058 
03059     <span class="keywordflow">case</span> SPI_SETACCESSTIMEOUT:
03060         {
03061             LPACCESSTIMEOUT pTO = (LPACCESSTIMEOUT)lParam;
03062 
03063             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(ACCESSTIMEOUT))) {
03064                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03065             }
03066             <span class="keywordflow">if</span> (!pTO || (pTO-&gt;cbSize != <span class="keyword">sizeof</span>(ACCESSTIMEOUT)))
03067                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03068 
03069             <span class="comment">/*</span>
03070 <span class="comment">             * Do some parameter validation.  We will fail on unsupported and</span>
03071 <span class="comment">             * undefined bits being set.</span>
03072 <span class="comment">             */</span>
03073             <span class="keywordflow">if</span> ((pTO-&gt;dwFlags &amp; ATF_VALID) != pTO-&gt;dwFlags) {
03074                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03075             }
03076             <span class="keywordflow">if</span> (pTO-&gt;iTimeOutMSec &gt; 3600000) {
03077                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03078             }
03079 
03080             <span class="keywordflow">if</span> (fAlterWinIni) {
03081                 pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
03082                 swprintf(szTemp, pwszd, pTO-&gt;dwFlags);
03083                 fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
03084                         PMAP_TIMEOUT,
03085                         L<span class="stringliteral">"Flags"</span>,
03086                         szTemp
03087                         );
03088 
03089                 swprintf(szTemp, pwszd, pTO-&gt;iTimeOutMSec);
03090                 fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
03091                         PMAP_TIMEOUT,
03092                         L<span class="stringliteral">"TimeToWait"</span>,
03093                         szTemp
03094                         );
03095 
03096                 fWriteAllowed = fWinIniChanged;
03097                 <span class="keywordflow">if</span> (!fWinIniChanged) {
03098 
03099                     <span class="comment">/*</span>
03100 <span class="comment">                     * Back out any changes to win.ini</span>
03101 <span class="comment">                     */</span>
03102                     swprintf(szTemp, pwszd, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a35">gAccessTimeOut</a>.dwFlags);
03103                     fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
03104                             PMAP_TIMEOUT,
03105                             L<span class="stringliteral">"Flags"</span>,
03106                             szTemp
03107                             );
03108 
03109                     swprintf(szTemp, pwszd, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a35">gAccessTimeOut</a>.iTimeOutMSec);
03110                     fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(pProfileUserName,
03111                             PMAP_TIMEOUT,
03112                             L<span class="stringliteral">"TimeToWait"</span>,
03113                             szTemp
03114                             );
03115                 }
03116                 <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
03117             }
03118             <span class="keywordflow">if</span> (fWriteAllowed) {
03119                 RtlCopyMemory(&amp;gAccessTimeOut, pTO, pTO-&gt;cbSize);
03120 
03121                 <span class="comment">/*</span>
03122 <span class="comment">                 * Don't allow user to change cbSize field</span>
03123 <span class="comment">                 */</span>
03124                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a35">gAccessTimeOut</a>.cbSize = <span class="keyword">sizeof</span>(ACCESSTIMEOUT);
03125 
03126                 <a class="code" href="../../d9/d3/access_8h.html#a49">SetAccessEnabledFlag</a>();
03127 
03128                 <a class="code" href="../../d8/d3/ntuser_2kernel_2access_8c.html#a42">AccessTimeOutReset</a>();
03129             }
03130         }
03131         <span class="keywordflow">break</span>;
03132 
03133     <span class="keywordflow">case</span> SPI_SETSHOWSOUNDS:
03134         <span class="keywordflow">if</span> (fAlterWinIni) {
03135             swprintf(szTemp, pwszd, (wParam == 1));
03136             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(NULL,
03137                     PMAP_SHOWSOUNDS,
03138                     L<span class="stringliteral">"On"</span>,
03139                     szTemp
03140                     );
03141 
03142             fWriteAllowed = fWinIniChanged;
03143         }
03144         <span class="keywordflow">if</span> (fWriteAllowed) {
03145             <a class="code" href="../../d4/d1/userk_8h.html#a655">SET_OR_CLEAR_ACCF</a>(ACCF_SHOWSOUNDSON, wParam == 1);
03146             <a class="code" href="../../d9/d3/access_8h.html#a49">SetAccessEnabledFlag</a>();
03147 
03148             <span class="comment">/*</span>
03149 <span class="comment">            * Bug 2079.  Update the System Metrics Info.</span>
03150 <span class="comment">            */</span>
03151             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(SHOWSOUNDS) = <a class="code" href="../../d4/d1/userk_8h.html#a652">TEST_BOOL_ACCF</a>(ACCF_SHOWSOUNDSON);
03152         }
03153         <span class="keywordflow">break</span>;
03154 
03155     <span class="keywordflow">case</span> SPI_GETSHOWSOUNDS: {
03156             <a class="code" href="../../d9/d5/ndismain_8h.html#a264">PINT</a> pint = (<span class="keywordtype">int</span> *)lParam;
03157 
03158             *pint = <a class="code" href="../../d4/d1/userk_8h.html#a652">TEST_BOOL_ACCF</a>(ACCF_SHOWSOUNDSON);
03159         }
03160         <span class="keywordflow">break</span>;
03161 
03162     <span class="keywordflow">case</span> SPI_GETKEYBOARDPREF:
03163         {
03164             PBOOL pfKeyboardPref = (PBOOL)lParam;
03165 
03166             *pfKeyboardPref = <a class="code" href="../../d4/d1/userk_8h.html#a652">TEST_BOOL_ACCF</a>(ACCF_KEYBOARDPREF);
03167         }
03168         <span class="keywordflow">break</span>;
03169 
03170     <span class="keywordflow">case</span> SPI_SETKEYBOARDPREF:
03171         {
03172             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fKeyboardPref = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)wParam;
03173 
03174             <span class="keywordflow">if</span> (fAlterWinIni) {
03175                 fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(NULL,
03176                         PMAP_KEYBOARDPREF,
03177                         L<span class="stringliteral">"On"</span>,
03178                         (fKeyboardPref) ? L<span class="stringliteral">"1"</span> : L<span class="stringliteral">"0"</span>
03179                         );
03180 
03181                 fWriteAllowed = fWinIniChanged;
03182             }
03183             <span class="keywordflow">if</span> (fWriteAllowed)
03184             {
03185                 <a class="code" href="../../d4/d1/userk_8h.html#a655">SET_OR_CLEAR_ACCF</a>(ACCF_KEYBOARDPREF, wParam);
03186             }
03187         }
03188         <span class="keywordflow">break</span>;
03189 
03190     <span class="keywordflow">case</span> SPI_GETSCREENREADER:
03191         {
03192             PBOOL pfScreenReader = (PBOOL)lParam;
03193 
03194             *pfScreenReader = <a class="code" href="../../d4/d1/userk_8h.html#a652">TEST_BOOL_ACCF</a>(ACCF_SCREENREADER);
03195         }
03196         <span class="keywordflow">break</span>;
03197 
03198     <span class="keywordflow">case</span> SPI_SETSCREENREADER:
03199         {
03200             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fScreenReader = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)wParam;
03201 
03202             <span class="keywordflow">if</span> (fAlterWinIni) {
03203                 fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2009">FastWriteProfileStringW</a>(NULL,
03204                     PMAP_SCREENREADER,
03205                     L<span class="stringliteral">"On"</span>,
03206                     (fScreenReader) ? L<span class="stringliteral">"1"</span> : L<span class="stringliteral">"0"</span>
03207                     );
03208                 fWriteAllowed = fWinIniChanged;
03209             }
03210             <span class="keywordflow">if</span> (fWriteAllowed)
03211             {
03212                 <a class="code" href="../../d4/d1/userk_8h.html#a655">SET_OR_CLEAR_ACCF</a>(ACCF_SCREENREADER, wParam);
03213             }
03214         }
03215         <span class="keywordflow">break</span>;
03216 
03217     <span class="keywordflow">case</span> SPI_GETSOUNDSENTRY:
03218         {
03219             LPSOUNDSENTRY pSS = (LPSOUNDSENTRY)lParam;
03220             <span class="keywordtype">int</span> cbSkip = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a37">gSoundSentry</a>.cbSize);
03221 
03222             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(SOUNDSENTRY))) {
03223                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03224             }
03225             <span class="keywordflow">if</span> (!pSS || (pSS-&gt;cbSize != <span class="keyword">sizeof</span>(SOUNDSENTRY))) {
03226                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03227             }
03228             <span class="comment">/*</span>
03229 <span class="comment">             * In the future we may support multiple sizes of this data structure.  Don't</span>
03230 <span class="comment">             * change the cbSize field of the data structure passed in.</span>
03231 <span class="comment">             */</span>
03232             RtlCopyMemory((LPVOID)((LPBYTE)pSS + cbSkip),
03233                           (LPVOID)((LPBYTE)&amp;gSoundSentry + cbSkip),
03234                           pSS-&gt;cbSize - cbSkip);
03235         }
03236         <span class="keywordflow">break</span>;
03237 
03238     <span class="keywordflow">case</span> SPI_SETSOUNDSENTRY:
03239         {
03240             LPSOUNDSENTRY pSS = (LPSOUNDSENTRY)lParam;
03241 
03242             <span class="keywordflow">if</span> ((wParam != 0) &amp;&amp; (wParam != <span class="keyword">sizeof</span>(SOUNDSENTRY))) {
03243                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03244             }
03245             <span class="keywordflow">if</span> (!pSS || (pSS-&gt;cbSize != <span class="keyword">sizeof</span>(SOUNDSENTRY)))
03246                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03247 
03248             <span class="comment">/*</span>
03249 <span class="comment">             * Do some parameter validation.  We will fail on unsupported and</span>
03250 <span class="comment">             * undefined bits being set.</span>
03251 <span class="comment">             */</span>
03252             <span class="keywordflow">if</span> ((pSS-&gt;dwFlags &amp; SSF_VALID) != pSS-&gt;dwFlags) {
03253                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03254             }
03255             <span class="comment">/*</span>
03256 <span class="comment">             * We don't support SSWF_CUSTOM.</span>
03257 <span class="comment">             */</span>
03258             <span class="keywordflow">if</span> (pSS-&gt;iWindowsEffect &gt; SSWF_DISPLAY) {
03259                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03260             }
03261             <span class="comment">/*</span>
03262 <span class="comment">             * No support for non-windows apps.</span>
03263 <span class="comment">             */</span>
03264             <span class="keywordflow">if</span> (pSS-&gt;iFSTextEffect != SSTF_NONE) {
03265                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03266             }
03267             <span class="keywordflow">if</span> (pSS-&gt;iFSGrafEffect != SSGF_NONE) {
03268                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03269             }
03270             <span class="comment">/*</span>
03271 <span class="comment">             * SSF_AVAILABLE can't be set via API.  Use registry value.</span>
03272 <span class="comment">             */</span>
03273             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d3/access_8h.html#a0">TEST_ACCESSFLAG</a>(SoundSentry, SSF_AVAILABLE)) {
03274                 pSS-&gt;dwFlags |= SSF_AVAILABLE;
03275             } <span class="keywordflow">else</span> {
03276                 pSS-&gt;dwFlags &amp;= ~SSF_AVAILABLE;
03277             }
03278 
03279             <span class="keywordflow">if</span> (fAlterWinIni) {
03280                 pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
03281                 fWinIniChanged = <a class="code" href="../../d4/d5/rare_8c.html#a29">SetSoundSentry</a>(pProfileUserName, pSS);
03282                 fWriteAllowed = fWinIniChanged;
03283                 <span class="keywordflow">if</span> (!fWinIniChanged) {
03284 
03285                     <span class="comment">/*</span>
03286 <span class="comment">                     * Back out any changes to win.ini</span>
03287 <span class="comment">                     */</span>
03288                     <a class="code" href="../../d4/d5/rare_8c.html#a29">SetSoundSentry</a>(pProfileUserName, &amp;gSoundSentry);
03289                 }
03290                 <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
03291             }
03292             <span class="keywordflow">if</span> (fWriteAllowed) {
03293                 RtlCopyMemory(&amp;gSoundSentry, pSS, pSS-&gt;cbSize);
03294 
03295                 <span class="comment">/*</span>
03296 <span class="comment">                 * Don't allow user to change cbSize field</span>
03297 <span class="comment">                 */</span>
03298                 <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a37">gSoundSentry</a>.cbSize = <span class="keyword">sizeof</span>(SOUNDSENTRY);
03299 
03300                 <a class="code" href="../../d9/d3/access_8h.html#a49">SetAccessEnabledFlag</a>();
03301             }
03302         }
03303         <span class="keywordflow">break</span>;
03304 
03305     <span class="keywordflow">case</span> SPI_SETCURSORS:
03306             pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
03307             <a class="code" href="../../d4/d1/userk_8h.html#a1840">xxxUpdateSystemCursorsFromRegistry</a>(pProfileUserName);
03308             <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
03309 
03310             <span class="keywordflow">break</span>;
03311 
03312     <span class="keywordflow">case</span> SPI_SETICONS:
03313             pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
03314             <a class="code" href="../../d4/d1/userk_8h.html#a1841">xxxUpdateSystemIconsFromRegistry</a>(pProfileUserName);
03315             <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
03316 
03317             <span class="keywordflow">break</span>;
03318 
03319     <span class="keywordflow">case</span> SPI_GETMOUSEHOVERWIDTH:
03320         *((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> *)lParam) = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a102">gcxMouseHover</a>;
03321         <span class="keywordflow">break</span>;
03322 
03323     <span class="keywordflow">case</span> SPI_SETMOUSEHOVERWIDTH:
03324         <span class="keywordflow">if</span> (fAlterWinIni) {
03325             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_MOUSE, STR_MOUSEHOVERWIDTH, wParam);
03326             fWriteAllowed = fWinIniChanged;
03327         }
03328         <span class="keywordflow">if</span> (fWriteAllowed) {
03329             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a102">gcxMouseHover</a> = wParam;
03330         }
03331         <span class="keywordflow">break</span>;
03332 
03333     <span class="keywordflow">case</span> SPI_GETMOUSEHOVERHEIGHT:
03334         *((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> *)lParam) = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a103">gcyMouseHover</a>;
03335         <span class="keywordflow">break</span>;
03336 
03337     <span class="keywordflow">case</span> SPI_SETMOUSEHOVERHEIGHT:
03338         <span class="keywordflow">if</span> (fAlterWinIni) {
03339             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_MOUSE, STR_MOUSEHOVERHEIGHT, wParam);
03340             fWriteAllowed = fWinIniChanged;
03341         }
03342         <span class="keywordflow">if</span> (fWriteAllowed) {
03343             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a103">gcyMouseHover</a> = wParam;
03344         }
03345         <span class="keywordflow">break</span>;
03346 
03347     <span class="keywordflow">case</span> SPI_GETMOUSEHOVERTIME:
03348         *((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> *)lParam) = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a104">gdtMouseHover</a>;
03349         <span class="keywordflow">break</span>;
03350 
03351     <span class="keywordflow">case</span> SPI_SETMOUSEHOVERTIME:
03352         <span class="keywordflow">if</span> (fAlterWinIni) {
03353             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_MOUSE, STR_MOUSEHOVERTIME, wParam);
03354             fWriteAllowed = fWinIniChanged;
03355         }
03356         <span class="keywordflow">if</span> (fWriteAllowed) {
03357             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a104">gdtMouseHover</a> = wParam;
03358         }
03359         <span class="keywordflow">break</span>;
03360 
03361     <span class="keywordflow">case</span> SPI_GETWHEELSCROLLLINES:
03362         (*(LPDWORD)lParam) = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ucWheelScrollLines;
03363         <span class="keywordflow">break</span>;
03364 
03365     <span class="keywordflow">case</span> SPI_SETWHEELSCROLLLINES:
03366         <span class="keywordflow">if</span> (fAlterWinIni) {
03367             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_DESKTOP, STR_WHEELSCROLLLINES, wParam);
03368             fWriteAllowed = fWinIniChanged;
03369         }
03370 
03371         <span class="keywordflow">if</span> (fWriteAllowed)
03372             <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ucWheelScrollLines = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)wParam;
03373         <span class="keywordflow">break</span>;
03374 
03375     <span class="keywordflow">case</span> SPI_GETMENUSHOWDELAY:
03376         (*(LPDWORD)lParam) = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a94">gdtMNDropDown</a>;
03377         <span class="keywordflow">break</span>;
03378 
03379     <span class="keywordflow">case</span> SPI_SETMENUSHOWDELAY:
03380         <span class="keywordflow">if</span> (fAlterWinIni) {
03381             fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a1861">UpdateWinIniInt</a>(NULL, PMAP_DESKTOP, STR_MENUSHOWDELAY, wParam);
03382             fWriteAllowed = fWinIniChanged;
03383         }
03384         <span class="keywordflow">if</span> (fWriteAllowed)
03385             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a94">gdtMNDropDown</a> = wParam;
03386         <span class="keywordflow">break</span>;
03387 
03388     <span class="keywordflow">case</span> SPI_GETSCREENSAVERRUNNING:
03389         (*(LPBOOL)lParam) = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a158">gppiScreenSaver</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03390         <span class="keywordflow">break</span>;
03391 
03392     <span class="keywordflow">case</span> SPI_SETSHOWIMEUI:
03393         <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/userk_8h.html#a2060">xxxSetIMEShowStatus</a>(!!wParam);
03394 
03395     <span class="keywordflow">case</span> SPI_GETSHOWIMEUI:
03396         (*(LPBOOL)lParam) = <a class="code" href="../../d4/d1/userk_8h.html#a1133">_GetIMEShowStatus</a>();
03397         <span class="keywordflow">break</span>;
03398 
03399     <span class="keywordflow">default</span>:
03400 
03401 <span class="preprocessor">#define ppvi (UPDWORDPointer(wFlag))</span>
03402 <span class="preprocessor"></span><span class="preprocessor">#define uDataRead ((UINT)fWinIniChanged)</span>
03403 <span class="preprocessor"></span>
03404         <span class="keywordflow">if</span> (wFlag &lt; SPI_MAX) {
03405             RIPERR1(ERROR_INVALID_SPI_VALUE, RIP_WARNING, <span class="stringliteral">"xxxSystemParamtersInfo: Invalid SPI_:%#lx"</span>, wFlag);
03406             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03407         }
03408 
03409         UserAssert(wFlag &amp; SPIF_RANGETYPEMASK);
03410 
03411         <span class="keywordflow">if</span> (!(wFlag &amp; SPIF_SET)) {
03412 
03413             <span class="keywordflow">if</span> ((wFlag &amp; SPIF_RANGETYPEMASK) == SPIF_BOOL) {
03414                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDisable, fDisableValue;
03415 
03416                 UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a556">UPIsBOOLRange</a>(wFlag));
03417                 <span class="comment">/*</span>
03418 <span class="comment">                 * Handle settings that can be disabled by additional conditions.</span>
03419 <span class="comment">                 */</span>
03420                 fDisable = fDisableValue = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03421                 <span class="keywordflow">if</span> (wFlag &lt; SPI_GETUIEFFECTS) {
03422                     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a563">TestUP</a>(UIEFFECTS)) {
03423                         <span class="keywordflow">switch</span> (wFlag) {
03424                         <span class="keywordflow">case</span> SPI_GETACTIVEWNDTRKZORDER:
03425                         <span class="keywordflow">case</span> SPI_GETACTIVEWINDOWTRACKING:
03426                             <span class="keywordflow">break</span>;
03427 
03428                         <span class="keywordflow">case</span> SPI_GETKEYBOARDCUES:
03429                             fDisableValue = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03430                             <span class="comment">/* Fall Through */</span>
03431 
03432                         <span class="keywordflow">default</span>:
03433                             fDisable = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03434                             <span class="keywordflow">break</span>;
03435                         }
03436                     } <span class="keywordflow">else</span> { <span class="comment">/* if (!TestUP(UIEFFECTS) */</span>
03437                         <span class="keywordflow">switch</span> (wFlag) {
03438                         <span class="keywordflow">case</span> SPI_GETKEYBOARDCUES:
03439                             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a652">TEST_BOOL_ACCF</a>(ACCF_KEYBOARDPREF)) {
03440                                 fDisableValue = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03441                                 fDisable = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03442                             }
03443                             <span class="keywordflow">break</span>;
03444 
03445                         <span class="keywordflow">case</span> SPI_GETGRADIENTCAPTIONS:
03446                         <span class="keywordflow">case</span> SPI_GETSELECTIONFADE:
03447                         <span class="keywordflow">case</span> SPI_GETMENUFADE:
03448                         <span class="keywordflow">case</span> SPI_GETTOOLTIPFADE:
03449                         <span class="keywordflow">case</span> SPI_GETCURSORSHADOW:
03450                             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a252">gbDisableAlpha</a>) {
03451                                 fDisable = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03452                             }
03453                             <span class="keywordflow">break</span>;
03454                         }
03455                     }
03456                 } <span class="comment">/* if (wFlag &lt; SPI_GETUIEFFECTS) */</span>
03457                 <span class="comment">/*</span>
03458 <span class="comment">                 * Give them the disabled value or read the actual one</span>
03459 <span class="comment">                 */</span>
03460                 <span class="keywordflow">if</span> (fDisable) {
03461                     *((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> *)lParam) = fDisableValue;
03462                 } <span class="keywordflow">else</span> {
03463                     *((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> *)lParam) = !!<a class="code" href="../../d4/d1/userk_8h.html#a560">TestUPBOOL</a>(gpdwCPUserPreferencesMask, wFlag);
03464                 }
03465             } <span class="keywordflow">else</span> {
03466                 UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a554">UPIsDWORDRange</a>(wFlag));
03467                 *((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)lParam) = <a class="code" href="../../d4/d1/userk_8h.html#a2029">UPDWORDValue</a>(wFlag);
03468             }
03469 
03470         } <span class="keywordflow">else</span> { <span class="comment">/* if (!(wFlag &amp; SPIF_SET)) */</span>
03471             pProfileUserName = <a class="code" href="../../d4/d1/userk_8h.html#a2000">CreateProfileUserName</a>(&amp;tlName);
03472 
03473             <span class="keywordflow">if</span> ((wFlag &amp; SPIF_RANGETYPEMASK) == SPIF_BOOL) {
03474                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> pdwValue [SPI_BOOLMASKDWORDSIZE];
03475 
03476                 UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a556">UPIsBOOLRange</a>(wFlag));
03477                 UserAssert(<span class="keyword">sizeof</span>(pdwValue) == <span class="keyword">sizeof</span>(gpdwCPUserPreferencesMask));
03478 
03479                 <span class="keywordflow">if</span> (fAlterWinIni) {
03480                     <span class="comment">/*</span>
03481 <span class="comment">                     * We only need to set/clear the bit passed in, however, we write the whole</span>
03482 <span class="comment">                     *  bit mask to the registry. Since the info in gpdwCPUserPreferencesMask</span>
03483 <span class="comment">                     *  might not match what it is in the registry, we need to read the registry before</span>
03484 <span class="comment">                     *  we write to it.</span>
03485 <span class="comment">                     */</span>
03486                     <a class="code" href="../../d4/d5/rare_8c.html#a7">uDataRead</a> = <a class="code" href="../../d4/d1/userk_8h.html#a2013">FastGetProfileValue</a>(pProfileUserName,
03487                             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a151">gpviCPUserPreferences</a>-&gt;<a class="code" href="../../d9/d3/structtagPROFILEVALUEINFO.html#o1">uSection</a>,
03488                             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a151">gpviCPUserPreferences</a>-&gt;<a class="code" href="../../d9/d3/structtagPROFILEVALUEINFO.html#o2">pwszKeyName</a>,
03489                             NULL,
03490                             (LPBYTE)pdwValue,
03491                             <span class="keyword">sizeof</span>(pdwValue)
03492                             );
03493 
03494                     <span class="comment">/*</span>
03495 <span class="comment">                     * If some bits are not in the registry, get them from gpdwCPUserPreferencesMask</span>
03496 <span class="comment">                     */</span>
03497                     UserAssert(uDataRead &lt;= <span class="keyword">sizeof</span>(gpdwCPUserPreferencesMask));
03498                     RtlCopyMemory(pdwValue + uDataRead,
03499                                   gpdwCPUserPreferencesMask + uDataRead,
03500                                   <span class="keyword">sizeof</span>(gpdwCPUserPreferencesMask) - uDataRead);
03501 
03502                     <span class="comment">/*</span>
03503 <span class="comment">                     * Set/Clear the new state and write it</span>
03504 <span class="comment">                     */</span>
03505                     <span class="keywordflow">if</span> (lParam) {
03506                         <a class="code" href="../../d4/d1/userk_8h.html#a561">SetUPBOOL</a>(pdwValue, wFlag);
03507                     } <span class="keywordflow">else</span> {
03508                         <a class="code" href="../../d4/d1/userk_8h.html#a562">ClearUPBOOL</a>(pdwValue, wFlag);
03509                     }
03510 
03511                     fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2012">FastWriteProfileValue</a>(pProfileUserName,
03512                             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a151">gpviCPUserPreferences</a>-&gt;<a class="code" href="../../d9/d3/structtagPROFILEVALUEINFO.html#o1">uSection</a>,
03513                             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a151">gpviCPUserPreferences</a>-&gt;<a class="code" href="../../d9/d3/structtagPROFILEVALUEINFO.html#o2">pwszKeyName</a>,
03514                             REG_BINARY,
03515                             (LPBYTE)pdwValue,
03516                             <span class="keyword">sizeof</span>(pdwValue)
03517                             );
03518 
03519                     fWriteAllowed = fWinIniChanged;
03520                 }
03521 
03522                 <span class="keywordflow">if</span> (fWriteAllowed) {
03523                     <span class="keywordflow">if</span> (lParam) {
03524                         <a class="code" href="../../d4/d1/userk_8h.html#a561">SetUPBOOL</a>(gpdwCPUserPreferencesMask, wFlag);
03525                     } <span class="keywordflow">else</span> {
03526                         <a class="code" href="../../d4/d1/userk_8h.html#a562">ClearUPBOOL</a>(gpdwCPUserPreferencesMask, wFlag);
03527                     }
03528 
03529                     <span class="comment">/*</span>
03530 <span class="comment">                     * Propagate gpsi flags</span>
03531 <span class="comment">                     */</span>
03532                     <span class="keywordflow">switch</span> (wFlag) {
03533                     <span class="keywordflow">case</span> SPI_SETUIEFFECTS:
03534                         <a class="code" href="../../d4/d1/userk_8h.html#a569">PropagetUPBOOLTogpsi</a>(UIEFFECTS);
03535                         <a class="code" href="../../d4/d1/userk_8h.html#a1790">SetPointer</a>(TRUE);
03536                         <span class="comment">/*</span>
03537 <span class="comment">                         * Fall through</span>
03538 <span class="comment">                         */</span>
03539 
03540                     <span class="keywordflow">case</span> SPI_SETGRADIENTCAPTIONS:
03541                         <a class="code" href="../../d4/d1/userk_8h.html#a1860">CreateBitmapStrip</a>();
03542                         <a class="code" href="../../d4/d1/userk_8h.html#a470">xxxRedrawScreen</a>();
03543                         <span class="keywordflow">break</span>;
03544 
03545                     <span class="keywordflow">case</span> SPI_SETCOMBOBOXANIMATION:
03546                         <a class="code" href="../../d4/d1/userk_8h.html#a569">PropagetUPBOOLTogpsi</a>(COMBOBOXANIMATION);
03547                         <span class="keywordflow">break</span>;
03548 
03549                     <span class="keywordflow">case</span> SPI_SETLISTBOXSMOOTHSCROLLING:
03550                         <a class="code" href="../../d4/d1/userk_8h.html#a569">PropagetUPBOOLTogpsi</a>(LISTBOXSMOOTHSCROLLING);
03551                         <span class="keywordflow">break</span>;
03552 
03553                     <span class="keywordflow">case</span> SPI_SETKEYBOARDCUES:
03554                         <a class="code" href="../../d4/d1/userk_8h.html#a569">PropagetUPBOOLTogpsi</a>(KEYBOARDCUES);
03555                         <span class="keywordflow">break</span>;
03556 
03557                     <span class="keywordflow">case</span> SPI_SETCURSORSHADOW:
03558                         <a class="code" href="../../d4/d1/userk_8h.html#a1790">SetPointer</a>(TRUE);
03559                         <span class="keywordflow">break</span>;
03560 
03561                     } <span class="comment">/* switch (wFlag) */</span>
03562 
03563                 } <span class="comment">/* if (fWriteAllowed) */</span>
03564 
03565             } <span class="keywordflow">else</span> { <span class="comment">/* if ((wFlag &amp; SPIF_RANGETYPEMASK) == SPIF_BOOL) */</span>
03566 
03567                 UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a554">UPIsDWORDRange</a>(wFlag));
03568 
03569                 <span class="keywordflow">if</span> (fAlterWinIni) {
03570                     fWinIniChanged = <a class="code" href="../../d4/d1/userk_8h.html#a2012">FastWriteProfileValue</a>(pProfileUserName,
03571                             <a class="code" href="../../d4/d5/rare_8c.html#a6">ppvi</a>-&gt;uSection,
03572                             <a class="code" href="../../d4/d5/rare_8c.html#a6">ppvi</a>-&gt;pwszKeyName,
03573                             REG_DWORD,
03574                             (LPBYTE)&amp;lParam,
03575                             <span class="keyword">sizeof</span>(DWORD)
03576                             );
03577 
03578                     fWriteAllowed = fWinIniChanged;
03579                 }
03580 
03581                 <span class="keywordflow">if</span> (fWriteAllowed) {
03582 
03583                     <a class="code" href="../../d4/d5/rare_8c.html#a6">ppvi</a>-&gt;dwValue = PtrToUlong(lParam);
03584 
03585                     <span class="keywordflow">switch</span>(wFlag) {
03586                     <span class="keywordflow">case</span> SPI_SETCARETWIDTH:
03587                         <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;uCaretWidth = <a class="code" href="../../d4/d5/rare_8c.html#a6">ppvi</a>-&gt;dwValue;
03588                         <span class="keywordflow">break</span>;
03589                     <span class="keywordflow">default</span>:
03590                         <span class="keywordflow">break</span>;
03591                     }
03592                 }
03593 
03594             } <span class="comment">/* if ((wFlag &amp; SPIF_RANGETYPEMASK) == SPIF_BOOL) */</span>
03595 
03596             <a class="code" href="../../d4/d1/userk_8h.html#a2001">FreeProfileUserName</a>(pProfileUserName, &amp;tlName);
03597         } <span class="comment">/* if (!(wFlag &amp; SPIF_SET)) */</span>
03598 
03599         <span class="keywordflow">break</span>;
03600 <span class="preprocessor">#undef ppvi</span>
03601 <span class="preprocessor"></span><span class="preprocessor">#undef uDataRead</span>
03602 <span class="preprocessor"></span>    } <span class="comment">/* switch (wFlag) */</span>
03603 
03604 
03605     <span class="keywordflow">if</span> (fWinIniChanged &amp;&amp; fSendWinIniChange) {
03606         ULONG_PTR dwResult;
03607 
03608         <span class="comment">/*</span>
03609 <span class="comment">         * dwResult is defined so that xxxSendMessageTimeout will really</span>
03610 <span class="comment">         * and truly do a timeout.  Yeah, I know, this is a hack, but,</span>
03611 <span class="comment">         * it is compatible.</span>
03612 <span class="comment">         */</span>
03613 
03614         <a class="code" href="../../d5/d6/chartran_8c.html#a7">RtlInitLargeUnicodeString</a>(&amp;strSection, szSection, (UINT)-1);
03615         <a class="code" href="../../d4/d1/userk_8h.html#a1580">xxxSendMessageTimeout</a>(PWND_BROADCAST, WM_SETTINGCHANGE, wFlag, (LPARAM)&amp;strSection,
03616                 SMTO_NORMAL, 100, &amp;dwResult);
03617     }
03618 
03619     <span class="keywordflow">return</span> fWriteAllowed;
03620 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:27 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
