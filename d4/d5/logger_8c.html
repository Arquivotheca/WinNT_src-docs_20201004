<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: logger.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>logger.c File Reference</h1><code>#include "<a class="el" href="../../d5/d9/exp_8h-source.html">exp.h</a>"</code><br>

<p>
<a href="../../d5/d4/logger_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d7/struct__EX__DEBUG__LOG.html">PEX_DEBUG_LOG</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/logger_8c.html#a0">ExCreateDebugLog</a> (IN UCHAR MaximumNumberOfTags, IN ULONG MaximumNumberOfEvents)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/logger_8c.html#a1">ExCreateDebugLogTag</a> (IN <a class="el" href="../../d4/d7/struct__EX__DEBUG__LOG.html">PEX_DEBUG_LOG</a> Log, IN PCHAR <a class="el" href="../../d9/d3/rules_8c.html#a6">Name</a>, IN UCHAR Format1, IN UCHAR Format2, IN UCHAR Format3, IN UCHAR Format4)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/logger_8c.html#a2">ExDebugLogEvent</a> (IN <a class="el" href="../../d4/d7/struct__EX__DEBUG__LOG.html">PEX_DEBUG_LOG</a> Log, IN UCHAR Tag, IN ULONG Data1, IN ULONG Data2, IN ULONG Data3, IN ULONG Data4)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="logger.c::ExCreateDebugLog" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d7/struct__EX__DEBUG__LOG.html">PEX_DEBUG_LOG</a> ExCreateDebugLog           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>MaximumNumberOfTags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>MaximumNumberOfEvents</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/logger_8c-source.html#l00030">30</a> of file <a class="el" href="../../d5/d4/logger_8c-source.html">logger.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03150">_EX_DEBUG_LOG::First</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03151">_EX_DEBUG_LOG::Last</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03145">_EX_DEBUG_LOG::Lock</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03147">_EX_DEBUG_LOG::MaximumNumberOfTags</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03152">_EX_DEBUG_LOG::Next</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l03148">_EX_DEBUG_LOG::Tags</a>.
<p>
<pre class="fragment"><div>00034 {
00035     <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html">PEX_DEBUG_LOG</a> Log;
00036     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00037 
00038     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = <span class="keyword">sizeof</span>( <a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html">EX_DEBUG_LOG</a> ) +
00039             (MaximumNumberOfTags *
00040              <span class="keyword">sizeof</span>( <a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html">EX_DEBUG_LOG_TAG</a> )
00041             ) +
00042             (MaximumNumberOfEvents *
00043              <span class="keyword">sizeof</span>( <a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html">EX_DEBUG_LOG_EVENT</a> )
00044             );
00045 
00046 
00047     Log = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( NonPagedPool, Size, 'oLbD' );
00048     <span class="keywordflow">if</span> (Log != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00049         RtlZeroMemory( Log, Size );
00050         <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>( &amp;Log-&gt;<a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o0">Lock</a> );
00051         Log-&gt;<a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o2">MaximumNumberOfTags</a> = MaximumNumberOfTags;
00052         Log-&gt;<a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o3">Tags</a> = (<a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html">PEX_DEBUG_LOG_TAG</a>)(Log + 1);
00053         Log-&gt;<a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o5">First</a> = (<a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html">PEX_DEBUG_LOG_EVENT</a>)(Log-&gt;<a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o3">Tags</a> + MaximumNumberOfTags);
00054         Log-&gt;<a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o6">Last</a> = Log-&gt;<a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o5">First</a> + MaximumNumberOfEvents;
00055         Log-&gt;<a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o7">Next</a> = Log-&gt;<a class="code" href="../../d4/d7/struct__EX__DEBUG__LOG.html#o5">First</a>;
00056         }
00057 
00058     <span class="keywordflow">return</span> Log;
00059 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="logger.c::ExCreateDebugLogTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR ExCreateDebugLogTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d7/struct__EX__DEBUG__LOG.html">PEX_DEBUG_LOG</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Log</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Format1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Format2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Format3</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Format4</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/logger_8c-source.html#l00062">62</a> of file <a class="el" href="../../d5/d4/logger_8c-source.html">logger.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03131">_EX_DEBUG_LOG_TAG::Format</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03132">_EX_DEBUG_LOG_TAG::Name</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, and <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>.
<p>
<pre class="fragment"><div>00070 {
00071     KIRQL OldIrql;
00072     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00073     <a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html">PEX_DEBUG_LOG_TAG</a> Tag;
00074     UCHAR TagIndex;
00075     PCHAR CapturedName;
00076 
00077     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>( Name );
00078     CapturedName = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( NonPagedPool, Size, 'oLbD' );
00079     RtlMoveMemory( CapturedName, Name, Size + 1 );
00080 
00081     ExAcquireSpinLock( &amp;Log-&gt;Lock, &amp;OldIrql );
00082 
00083     <span class="keywordflow">if</span> (Log-&gt;NumberOfTags &lt; Log-&gt;MaximumNumberOfTags) {
00084         TagIndex = (UCHAR)(Log-&gt;NumberOfTags++);
00085         Tag = &amp;Log-&gt;Tags[ TagIndex ];
00086         Tag-&gt;<a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html#o1">Name</a> = CapturedName;
00087         Tag-&gt;<a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html#o0">Format</a>[ 0 ] = Format1;
00088         Tag-&gt;<a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html#o0">Format</a>[ 1 ] = Format2;
00089         Tag-&gt;<a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html#o0">Format</a>[ 2 ] = Format3;
00090         Tag-&gt;<a class="code" href="../../d6/d7/struct__EX__DEBUG__LOG__TAG.html#o0">Format</a>[ 3 ] = Format4;
00091         CapturedName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00092         }
00093     <span class="keywordflow">else</span> {
00094         TagIndex = (UCHAR)0xFF;
00095         }
00096 
00097     ExReleaseSpinLock( &amp;Log-&gt;Lock, OldIrql );
00098 
00099     <span class="keywordflow">if</span> (CapturedName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00100         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( CapturedName );
00101         }
00102     <span class="keywordflow">return</span> TagIndex;
00103 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="logger.c::ExDebugLogEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExDebugLogEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d7/struct__EX__DEBUG__LOG.html">PEX_DEBUG_LOG</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Log</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Data1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Data2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Data3</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Data4</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/logger_8c-source.html#l00106">106</a> of file <a class="el" href="../../d5/d4/logger_8c-source.html">logger.c</a>.
<p>
References <a class="el" href="../../d2/d8/ps_8h-source.html#l00388">_ETHREAD::Cid</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03141">_EX_DEBUG_LOG_EVENT::Data</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00153">KeQuerySystemTime()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03137">_EX_DEBUG_LOG_EVENT::ProcessId</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03139">_EX_DEBUG_LOG_EVENT::Tag</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03136">_EX_DEBUG_LOG_EVENT::ThreadId</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l03138">_EX_DEBUG_LOG_EVENT::Time</a>.
<p>
<pre class="fragment"><div>00114 {
00115     KIRQL OldIrql;
00116     <a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html">PEX_DEBUG_LOG_EVENT</a> p;
00117     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
00118     LARGE_INTEGER CurrentTime;
00119 
00120     <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a3">KeQuerySystemTime</a>( &amp;CurrentTime );
00121 
00122     ExAcquireSpinLock( &amp;Log-&gt;Lock, &amp;OldIrql );
00123 
00124     p = Log-&gt;Next;
00125     <span class="keywordflow">if</span> (p == Log-&gt;Last) {
00126         p = Log-&gt;First;
00127         }
00128     Log-&gt;Next = p + 1;
00129 
00130     p-&gt;<a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o0">ThreadId</a> = Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueThread;
00131     p-&gt;<a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o1">ProcessId</a> = Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueProcess;
00132     p-&gt;<a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o2">Time</a> = CurrentTime.LowPart;
00133     p-&gt;<a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o3">Tag</a> = Tag;
00134     p-&gt;<a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o5">Data</a>[ 0 ] = Data1;
00135     p-&gt;<a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o5">Data</a>[ 1 ] = Data2;
00136     p-&gt;<a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o5">Data</a>[ 2 ] = Data3;
00137     p-&gt;<a class="code" href="../../d5/d7/struct__EX__DEBUG__LOG__EVENT.html#o5">Data</a>[ 3 ] = Data4;
00138 
00139     ExReleaseSpinLock( &amp;Log-&gt;Lock, OldIrql );
00140 
00141     <span class="keywordflow">return</span>;
00142 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:33 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
