<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: iostubs.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>iostubs.c</h1><a href="../../d3/d6/iostubs_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    iostubs.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains the stubs for the console I/O API.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Therese Stowell (thereses) 14-Nov-1990</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment">    </span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#include "<a class="code" href="../../d4/d3/w32_2ntcon_2client_2precomp_8h.html">precomp.h</a>"</span>
00022 <span class="preprocessor">#pragma hdrstop</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#pragma hdrstop</span>
00024 <span class="preprocessor"></span>
00025 <span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00026 <span class="preprocessor"></span>
00027 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00028 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00029"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a1">00029</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a1">GetConsoleInput</a>(
00030     IN HANDLE hConsoleInput,
00031     OUT PINPUT_RECORD lpBuffer,
00032     IN DWORD nLength,
00033     OUT LPDWORD lpNumberOfEventsRead,
00034     IN USHORT wFlags,
00035     IN BOOLEAN Unicode
00036     )
00037 
00038 <span class="comment">/*++</span>
00039 <span class="comment"></span>
00040 <span class="comment">Parameters:</span>
00041 <span class="comment"></span>
00042 <span class="comment">    hConsoleInput - Supplies an open handle to CONIN$ that is to be</span>
00043 <span class="comment">        read.  The handle must have been created with GENERIC_READ access.</span>
00044 <span class="comment"></span>
00045 <span class="comment">    lpBuffer - Supplies the address of a buffer to receive the data read</span>
00046 <span class="comment">        from the input buffer.</span>
00047 <span class="comment"></span>
00048 <span class="comment">    nLength - Supplies the length of lpBuffer in INPUT_RECORDs.</span>
00049 <span class="comment"></span>
00050 <span class="comment">    lpNumberOfEventsRead - Pointer to number of events read.</span>
00051 <span class="comment"></span>
00052 <span class="comment">    wFlags - Flags that control how data is read.</span>
00053 <span class="comment"></span>
00054 <span class="comment">Return Value:</span>
00055 <span class="comment"></span>
00056 <span class="comment">    TRUE - The operation was successful.</span>
00057 <span class="comment"></span>
00058 <span class="comment">    FALSE/NULL - The operation failed.</span>
00059 <span class="comment">        Extended error status is available using GetLastError.</span>
00060 <span class="comment"></span>
00061 <span class="comment">--*/</span>
00062 
00063 {
00064     PCSR_CAPTURE_HEADER CaptureBuffer;
00065     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00066     <a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html">PCONSOLE_GETCONSOLEINPUT_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleInput;
00067 
00068     <span class="comment">//</span>
00069     <span class="comment">// If it's not a well formed handle, don't bother going to the server.</span>
00070     <span class="comment">//</span>
00071 
00072     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/rdwr_8c.html#a8">CONSOLE_HANDLE</a>(hConsoleInput)) {
00073         <span class="keywordflow">try</span> {
00074             *lpNumberOfEventsRead = 0;
00075             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_HANDLE);
00076         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00077             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00078         }
00079         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00080     }
00081 
00082     a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00083     a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o1">InputHandle</a> = hConsoleInput;
00084     a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o4">NumRecords</a> = nLength;
00085     a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o5">Flags</a> = wFlags;
00086     a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o6">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00087 
00088     <span class="comment">//</span>
00089     <span class="comment">// for speed in the case where we're only reading a few records, we have</span>
00090     <span class="comment">// a buffer in the msg we pass to the server. this means we don't have to</span>
00091     <span class="comment">// allocate a capture buffer.</span>
00092     <span class="comment">//</span>
00093 
00094     <span class="keywordflow">if</span> (nLength &gt; <a class="code" href="../../d5/d5/conmsg_8h.html#a7">INPUT_RECORD_BUFFER_SIZE</a>) {
00095         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00096                                                   nLength * <span class="keyword">sizeof</span>(INPUT_RECORD)
00097                                                 );
00098         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00099             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00100             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00101         }
00102         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00103                                  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00104                                  nLength * <span class="keyword">sizeof</span>(INPUT_RECORD),
00105                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o3">BufPtr</a>
00106                                );
00107 
00108     } <span class="keywordflow">else</span> {
00109         a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o3">BufPtr</a> = a-&gt;<a class="code" href="../../d2/d1/struct__CONSOLE__GETCONSOLEINPUT__MSG.html#o2">Record</a>;
00110         CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00111     }
00112     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00113                          CaptureBuffer,
00114                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00115                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a164">ConsolepGetConsoleInput</a>
00116                                             ),
00117                          <span class="keyword">sizeof</span>( *a )
00118                        );
00119 
00120     <span class="keywordflow">try</span> {
00121         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00122             *lpNumberOfEventsRead = a-&gt;NumRecords;
00123             RtlCopyMemory(lpBuffer, a-&gt;BufPtr, a-&gt;NumRecords * <span class="keyword">sizeof</span>(INPUT_RECORD));
00124         }
00125         <span class="keywordflow">else</span> {
00126             *lpNumberOfEventsRead = 0;
00127             <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00128         }
00129     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00130         <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00131             <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00132         }
00133         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00134         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00135     }
00136     <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00137         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00138     }
00139 
00140     <span class="keywordflow">return</span> <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(m.ReturnValue);
00141 
00142 }
00143 
00144 <span class="preprocessor">#endif </span>
00145 <span class="preprocessor"></span>
00146 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00147 <span class="preprocessor"></span>
00148 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00149 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00150"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a2">00150</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a2">PeekConsoleInputA</a>(
00151     HANDLE hConsoleInput,
00152     PINPUT_RECORD lpBuffer,
00153     DWORD nLength,
00154     LPDWORD lpNumberOfEventsRead
00155     )
00156 
00157 {
00158     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a1">GetConsoleInput</a>(hConsoleInput,
00159                            lpBuffer,
00160                            nLength,
00161                            lpNumberOfEventsRead,
00162                            CONSOLE_READ_NOREMOVE | CONSOLE_READ_NOWAIT,
00163                            <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00164 }
00165 
00166 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00167 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00168"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a3">00168</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a3">PeekConsoleInputW</a>(
00169     HANDLE hConsoleInput,
00170     PINPUT_RECORD lpBuffer,
00171     DWORD nLength,
00172     LPDWORD lpNumberOfEventsRead
00173     )
00174 
00175 <span class="comment">/*++</span>
00176 <span class="comment"></span>
00177 <span class="comment">Parameters:</span>
00178 <span class="comment"></span>
00179 <span class="comment">    hConsoleInput - Supplies an open handle to CONIN$ that is to be</span>
00180 <span class="comment">        read.  The handle must have been created with GENERIC_READ access.</span>
00181 <span class="comment"></span>
00182 <span class="comment">    lpBuffer - Supplies the address of a buffer to receive the data read</span>
00183 <span class="comment">        from the input buffer.</span>
00184 <span class="comment"></span>
00185 <span class="comment">    nLength - Supplies the length of lpBuffer in INPUT_RECORDs.</span>
00186 <span class="comment"></span>
00187 <span class="comment">    lpNumberOfEventsRead - Pointer to number of events read.</span>
00188 <span class="comment"></span>
00189 <span class="comment">Return Value:</span>
00190 <span class="comment"></span>
00191 <span class="comment">    TRUE - The operation was successful.</span>
00192 <span class="comment"></span>
00193 <span class="comment">    FALSE/NULL - The operation failed.</span>
00194 <span class="comment">        Extended error status is available using GetLastError.</span>
00195 <span class="comment"></span>
00196 <span class="comment">--*/</span>
00197 
00198 {
00199     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a1">GetConsoleInput</a>(hConsoleInput,
00200                            lpBuffer,
00201                            nLength,
00202                            lpNumberOfEventsRead,
00203                            CONSOLE_READ_NOREMOVE | CONSOLE_READ_NOWAIT,
00204                            <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00205 }
00206 
00207 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00208 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00209"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a4">00209</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a4">ReadConsoleInputA</a>(
00210     HANDLE hConsoleInput,
00211     PINPUT_RECORD lpBuffer,
00212     DWORD nLength,
00213     LPDWORD lpNumberOfEventsRead
00214     )
00215 
00216 {
00217     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a1">GetConsoleInput</a>(hConsoleInput,
00218                            lpBuffer,
00219                            nLength,
00220                            lpNumberOfEventsRead,
00221                            0,
00222                            <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00223 }
00224 
00225 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00226 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00227"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a5">00227</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a5">ReadConsoleInputW</a>(
00228     HANDLE hConsoleInput,
00229     PINPUT_RECORD lpBuffer,
00230     DWORD nLength,
00231     LPDWORD lpNumberOfEventsRead
00232     )
00233 
00234 <span class="comment">/*++</span>
00235 <span class="comment"></span>
00236 <span class="comment">Parameters:</span>
00237 <span class="comment"></span>
00238 <span class="comment">    hConsoleInput - Supplies an open handle to CONIN$ that is to be</span>
00239 <span class="comment">        read.  The handle must have been created with GENERIC_READ access.</span>
00240 <span class="comment"></span>
00241 <span class="comment">    lpBuffer - Supplies the address of a buffer to receive the data read</span>
00242 <span class="comment">        from the input buffer.</span>
00243 <span class="comment"></span>
00244 <span class="comment">    nLength - Supplies the length of lpBuffer in INPUT_RECORDs.</span>
00245 <span class="comment"></span>
00246 <span class="comment">    lpNumberOfEventsRead - Pointer to number of events read.</span>
00247 <span class="comment"></span>
00248 <span class="comment">Return Value:</span>
00249 <span class="comment"></span>
00250 <span class="comment">    TRUE - The operation was successful.</span>
00251 <span class="comment"></span>
00252 <span class="comment">    FALSE/NULL - The operation failed.</span>
00253 <span class="comment">        Extended error status is available using GetLastError.</span>
00254 <span class="comment"></span>
00255 <span class="comment">--*/</span>
00256 
00257 {
00258     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a1">GetConsoleInput</a>(hConsoleInput,
00259                            lpBuffer,
00260                            nLength,
00261                            lpNumberOfEventsRead,
00262                            0,
00263                            <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00264 }
00265 
00266 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00267 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00268"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a6">00268</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a6">ReadConsoleInputExA</a>(
00269     HANDLE hConsoleInput,
00270     PINPUT_RECORD lpBuffer,
00271     DWORD nLength,
00272     LPDWORD lpNumberOfEventsRead,
00273     USHORT wFlags
00274     )
00275 
00276 {
00277     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a1">GetConsoleInput</a>(hConsoleInput,
00278                            lpBuffer,
00279                            nLength,
00280                            lpNumberOfEventsRead,
00281                            wFlags,
00282                            <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00283 }
00284 
00285 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00286 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00287"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a7">00287</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a7">ReadConsoleInputExW</a>(
00288     HANDLE hConsoleInput,
00289     PINPUT_RECORD lpBuffer,
00290     DWORD nLength,
00291     LPDWORD lpNumberOfEventsRead,
00292     USHORT wFlags
00293     )
00294 
00295 <span class="comment">/*++</span>
00296 <span class="comment"></span>
00297 <span class="comment">Parameters:</span>
00298 <span class="comment"></span>
00299 <span class="comment">    hConsoleInput - Supplies an open handle to CONIN$ that is to be</span>
00300 <span class="comment">        read.  The handle must have been created with GENERIC_READ access.</span>
00301 <span class="comment"></span>
00302 <span class="comment">    lpBuffer - Supplies the address of a buffer to receive the data read</span>
00303 <span class="comment">        from the input buffer.</span>
00304 <span class="comment"></span>
00305 <span class="comment">    nLength - Supplies the length of lpBuffer in INPUT_RECORDs.</span>
00306 <span class="comment"></span>
00307 <span class="comment">    lpNumberOfEventsRead - Pointer to number of events read.</span>
00308 <span class="comment"></span>
00309 <span class="comment">    wFlags - Flags that control how data is read.</span>
00310 <span class="comment"></span>
00311 <span class="comment">Return Value:</span>
00312 <span class="comment"></span>
00313 <span class="comment">    TRUE - The operation was successful.</span>
00314 <span class="comment"></span>
00315 <span class="comment">    FALSE/NULL - The operation failed.</span>
00316 <span class="comment">        Extended error status is available using GetLastError.</span>
00317 <span class="comment"></span>
00318 <span class="comment">--*/</span>
00319 
00320 {
00321     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a1">GetConsoleInput</a>(hConsoleInput,
00322                            lpBuffer,
00323                            nLength,
00324                            lpNumberOfEventsRead,
00325                            wFlags,
00326                            <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00327 }
00328 
00329 <span class="preprocessor">#endif </span>
00330 <span class="preprocessor"></span>
00331 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00332 <span class="preprocessor"></span>
00333 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00334 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00335"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a8">00335</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a8">WriteConsoleInputInternal</a>(
00336     IN HANDLE hConsoleInput,
00337     IN CONST INPUT_RECORD *lpBuffer,
00338     IN DWORD nLength,
00339     OUT LPDWORD lpNumberOfEventsWritten,
00340     IN BOOLEAN Unicode,
00341     IN BOOLEAN Append
00342     )
00343 
00344 <span class="comment">/*++</span>
00345 <span class="comment">Parameters:</span>
00346 <span class="comment"></span>
00347 <span class="comment">    hConsoleInput - Supplies an open handle to CONIN$ that is to be</span>
00348 <span class="comment">        written.  The handle must have been created with GENERIC_WRITE access.</span>
00349 <span class="comment"></span>
00350 <span class="comment">    lpBuffer - Supplies the address of a buffer containing the input records</span>
00351 <span class="comment">        to write to the input buffer.</span>
00352 <span class="comment"></span>
00353 <span class="comment">    nLength - Supplies the length of lpBuffer in INPUT_RECORDs.</span>
00354 <span class="comment"></span>
00355 <span class="comment">    lpNumberOfEventsWritten - Pointer to number of events written.</span>
00356 <span class="comment"></span>
00357 <span class="comment">    Unicode - TRUE if characters are unicode</span>
00358 <span class="comment"></span>
00359 <span class="comment">    Append - TRUE if append to end of input stream.  if FALSE, write to the</span>
00360 <span class="comment">    beginning of the input stream (used by VDM).</span>
00361 <span class="comment"></span>
00362 <span class="comment">Return Value:</span>
00363 <span class="comment"></span>
00364 <span class="comment">    TRUE - The operation was successful.</span>
00365 <span class="comment"></span>
00366 <span class="comment">    FALSE/NULL - The operation failed.</span>
00367 <span class="comment">        Extended error status is available using GetLastError.</span>
00368 <span class="comment"></span>
00369 <span class="comment">--*/</span>
00370 
00371 {
00372     PCSR_CAPTURE_HEADER CaptureBuffer;
00373     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00374     <a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html">PCONSOLE_WRITECONSOLEINPUT_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.WriteConsoleInput;
00375 
00376     a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00377     a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o1">InputHandle</a> = hConsoleInput;
00378     a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o4">NumRecords</a> = nLength;
00379     a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o5">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00380     a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o6">Append</a> = Append;
00381 
00382     <span class="comment">//</span>
00383     <span class="comment">// for speed in the case where we're only writing a few records, we have</span>
00384     <span class="comment">// a buffer in the msg we pass to the server. this means we don't have to</span>
00385     <span class="comment">// allocate a capture buffer.</span>
00386     <span class="comment">//</span>
00387 
00388     <span class="keywordflow">if</span> (nLength &gt; <a class="code" href="../../d5/d5/conmsg_8h.html#a7">INPUT_RECORD_BUFFER_SIZE</a>) {
00389         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00390                                                   nLength * <span class="keyword">sizeof</span>(INPUT_RECORD)
00391                                                 );
00392         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00393             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00394             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00395         }
00396         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00397                                  (PCHAR) lpBuffer,
00398                                  nLength * <span class="keyword">sizeof</span>(INPUT_RECORD),
00399                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o3">BufPtr</a>
00400                                );
00401 
00402     } <span class="keywordflow">else</span> {
00403         a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o3">BufPtr</a> = a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o2">Record</a>;
00404         CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00405         <span class="keywordflow">try</span> {
00406             RtlCopyMemory(a-&gt;<a class="code" href="../../d5/d7/struct__CONSOLE__WRITECONSOLEINPUT__MSG.html#o3">BufPtr</a>, lpBuffer, nLength * <span class="keyword">sizeof</span>(INPUT_RECORD));
00407         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00408             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00409             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00410         }
00411     }
00412     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00413                          CaptureBuffer,
00414                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00415                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a165">ConsolepWriteConsoleInput</a>
00416                                             ),
00417                          <span class="keyword">sizeof</span>( *a )
00418                        );
00419     <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00420         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00421     }
00422     <span class="keywordflow">try</span> {
00423         *lpNumberOfEventsWritten = a-&gt;NumRecords;
00424     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00425         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00426         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00427     }
00428     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(m.ReturnValue)) {
00429         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00430         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00431     }
00432     <span class="keywordflow">else</span> {
00433         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00434     }
00435 
00436 }
00437 
00438 <span class="preprocessor">#endif </span>
00439 <span class="preprocessor"></span>
00440 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00441 <span class="preprocessor"></span>
00442 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00443 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00444"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a9">00444</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a9">WriteConsoleInputA</a>(
00445     HANDLE hConsoleInput,
00446     CONST INPUT_RECORD *lpBuffer,
00447     DWORD nLength,
00448     LPDWORD lpNumberOfEventsWritten
00449     )
00450 {
00451     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a8">WriteConsoleInputInternal</a>(hConsoleInput,lpBuffer,nLength,lpNumberOfEventsWritten,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00452 }
00453 
00454 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00455 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00456"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a10">00456</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a10">WriteConsoleInputW</a>(
00457     HANDLE hConsoleInput,
00458     CONST INPUT_RECORD *lpBuffer,
00459     DWORD nLength,
00460     LPDWORD lpNumberOfEventsWritten
00461     )
00462 {
00463     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a8">WriteConsoleInputInternal</a>(hConsoleInput,lpBuffer,nLength,lpNumberOfEventsWritten,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00464 }
00465 
00466 
00467 <span class="preprocessor">#endif </span>
00468 <span class="preprocessor"></span>
00469 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00470 <span class="preprocessor"></span>
00471 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00472"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a11">00472</a> <a class="code" href="../../d6/d2/output_8c.html#a51">CopyRectangle</a>(
00473     IN CONST CHAR_INFO *Source,
00474     IN COORD SourceSize,
00475     IN PSMALL_RECT SourceRect,
00476     OUT PCHAR_INFO Target,
00477     IN COORD TargetSize,
00478     IN COORD TargetPoint
00479     )
00480 
00481 <span class="comment">/*++</span>
00482 <span class="comment"></span>
00483 <span class="comment">Routine Description:</span>
00484 <span class="comment"></span>
00485 <span class="comment">    This routine copies a rectangular region, doing any necessary clipping.</span>
00486 <span class="comment"></span>
00487 <span class="comment">Arguments:</span>
00488 <span class="comment"></span>
00489 <span class="comment">    Source - pointer to source buffer</span>
00490 <span class="comment"></span>
00491 <span class="comment">    SourceSize - dimensions of source buffer</span>
00492 <span class="comment"></span>
00493 <span class="comment">    SourceRect - rectangle in source buffer to copy</span>
00494 <span class="comment"></span>
00495 <span class="comment">    Target - pointer to target buffer</span>
00496 <span class="comment"></span>
00497 <span class="comment">    TargetSize - dimensions of target buffer</span>
00498 <span class="comment"></span>
00499 <span class="comment">    TargetPoint - upper left coordinates of target rectangle</span>
00500 <span class="comment"></span>
00501 <span class="comment">Return Value:</span>
00502 <span class="comment"></span>
00503 <span class="comment"></span>
00504 <span class="comment">--*/</span>
00505 
00506 {
00507 
00508 <span class="preprocessor">#define SCREEN_BUFFER_POINTER(BASE,X,Y,XSIZE,CELLSIZE) ((ULONG_PTR)BASE + ((XSIZE * (Y)) + (X)) * (ULONG)CELLSIZE)</span>
00509 <span class="preprocessor"></span>
00510     CONST CHAR_INFO *SourcePtr;
00511     PCHAR_INFO TargetPtr;
00512     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
00513     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> XSize,YSize;
00514     BOOLEAN WholeSource,WholeTarget;
00515 
00516     XSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d6/d4/condll_8h.html#a7">CONSOLE_RECT_SIZE_X</a>(SourceRect);
00517     YSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d6/d4/condll_8h.html#a8">CONSOLE_RECT_SIZE_Y</a>(SourceRect);
00518 
00519     <span class="comment">// do clipping.  we only clip for target, not source.</span>
00520 
00521     <span class="keywordflow">if</span> (XSize &gt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetSize.X - TargetPoint.X + 1)) {
00522         XSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetSize.X - TargetPoint.X + 1);
00523     }
00524     <span class="keywordflow">if</span> (YSize &gt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetSize.Y - TargetPoint.Y + 1)) {
00525         YSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TargetSize.Y - TargetPoint.Y + 1);
00526     }
00527 
00528     WholeSource = WholeTarget = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00529     <span class="keywordflow">if</span> (XSize == SourceSize.X) {
00530         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (SourceRect-&gt;Left == 0);
00531         <span class="keywordflow">if</span> (SourceRect-&gt;Top == 0) {
00532             SourcePtr = Source;
00533         }
00534         <span class="keywordflow">else</span> {
00535             SourcePtr = (PCHAR_INFO) <a class="code" href="../../d3/d6/iostubs_8c.html#a0">SCREEN_BUFFER_POINTER</a>(Source,
00536                                                            SourceRect-&gt;Left,
00537                                                            SourceRect-&gt;Top,
00538                                                            SourceSize.X,
00539                                                            <span class="keyword">sizeof</span>(CHAR_INFO));
00540         }
00541         WholeSource = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00542     }
00543     <span class="keywordflow">if</span> (XSize == TargetSize.X) {
00544         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (TargetPoint.X == 0);
00545         <span class="keywordflow">if</span> (TargetPoint.Y == 0) {
00546             TargetPtr = Target;
00547         }
00548         <span class="keywordflow">else</span> {
00549             TargetPtr = (PCHAR_INFO) <a class="code" href="../../d3/d6/iostubs_8c.html#a0">SCREEN_BUFFER_POINTER</a>(Target,
00550                                                            TargetPoint.X,
00551                                                            TargetPoint.Y,
00552                                                            TargetSize.X,
00553                                                            <span class="keyword">sizeof</span>(CHAR_INFO));
00554         }
00555         WholeTarget = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00556     }
00557     <span class="keywordflow">if</span> (WholeSource &amp;&amp; WholeTarget) {
00558         memmove(TargetPtr,SourcePtr,XSize*YSize*<span class="keyword">sizeof</span>(CHAR_INFO));
00559         <span class="keywordflow">return</span>;
00560     }
00561 
00562     <span class="keywordflow">for</span> (i=0;i&lt;YSize;i++) {
00563         <span class="keywordflow">if</span> (!WholeTarget) {
00564             TargetPtr = (PCHAR_INFO) <a class="code" href="../../d3/d6/iostubs_8c.html#a0">SCREEN_BUFFER_POINTER</a>(Target,
00565                                                            TargetPoint.X,
00566                                                            TargetPoint.Y+i,
00567                                                            TargetSize.X,
00568                                                            <span class="keyword">sizeof</span>(CHAR_INFO));
00569         }
00570         <span class="keywordflow">if</span> (!WholeSource) {
00571             SourcePtr = (PCHAR_INFO) <a class="code" href="../../d3/d6/iostubs_8c.html#a0">SCREEN_BUFFER_POINTER</a>(Source,
00572                                                            SourceRect-&gt;Left,
00573                                                            SourceRect-&gt;Top+i,
00574                                                            SourceSize.X,
00575                                                            <span class="keyword">sizeof</span>(CHAR_INFO));
00576         }
00577         <span class="keywordflow">for</span> (j=0;j&lt;XSize;j++,SourcePtr++,TargetPtr++) {
00578             *TargetPtr = *SourcePtr;
00579         }
00580     }
00581 }
00582 
00583 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00584 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00585"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a12">00585</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a12">ReadConsoleOutputInternal</a>(
00586     IN HANDLE hConsoleOutput,
00587     OUT PCHAR_INFO lpBuffer,
00588     IN COORD dwBufferSize,
00589     IN COORD dwBufferCoord,
00590     IN OUT PSMALL_RECT lpReadRegion,
00591     IN BOOLEAN Unicode
00592     )
00593 
00594 <span class="comment">/*++</span>
00595 <span class="comment">Parameters:</span>
00596 <span class="comment"></span>
00597 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
00598 <span class="comment">        that is to be read.  The handle must have been created with</span>
00599 <span class="comment">        GENERIC_READ access.</span>
00600 <span class="comment"></span>
00601 <span class="comment">    lpBuffer - Supplies the address of a buffer to receive the data read</span>
00602 <span class="comment">        from the screen buffer.  This pointer is treated as the origin of</span>
00603 <span class="comment">        a two dimensional array of size dwBufferSize.</span>
00604 <span class="comment"></span>
00605 <span class="comment">    dwBufferSize - size of lpBuffer</span>
00606 <span class="comment"></span>
00607 <span class="comment">    dwBufferCoord - coordinates of upper left point in buffer to receive</span>
00608 <span class="comment">        read data.</span>
00609 <span class="comment"></span>
00610 <span class="comment">    lpReadRegion - Supplies on input the address of a structure indicating the</span>
00611 <span class="comment">        rectangle within the screen buffer to read from.  The fields in</span>
00612 <span class="comment">        the structure are column and row coordinates.  On output, the fields</span>
00613 <span class="comment">        contain the actual region read.</span>
00614 <span class="comment"></span>
00615 <span class="comment">Return Value:</span>
00616 <span class="comment"></span>
00617 <span class="comment">    TRUE - The operation was successful.</span>
00618 <span class="comment"></span>
00619 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00620 <span class="comment">        using GetLastError.</span>
00621 <span class="comment">--*/</span>
00622 
00623 {
00624     PCSR_CAPTURE_HEADER CaptureBuffer;
00625     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00626     <a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html">PCONSOLE_READCONSOLEOUTPUT_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.ReadConsoleOutput;
00627     ULONG NumChars;
00628     COORD SourceSize;
00629 
00630     a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00631     a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
00632     a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o5">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00633 
00634     <span class="comment">//</span>
00635     <span class="comment">// clip region to read based on caller's buffer size</span>
00636     <span class="comment">//</span>
00637 
00638     SourceSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d6/d4/condll_8h.html#a7">CONSOLE_RECT_SIZE_X</a>(lpReadRegion);
00639     <span class="keywordflow">if</span> (SourceSize.X &gt; dwBufferSize.X-dwBufferCoord.X)
00640         SourceSize.X = dwBufferSize.X-dwBufferCoord.X;
00641     SourceSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d6/d4/condll_8h.html#a8">CONSOLE_RECT_SIZE_Y</a>(lpReadRegion);
00642     <span class="keywordflow">if</span> (SourceSize.Y &gt; dwBufferSize.Y-dwBufferCoord.Y)
00643         SourceSize.Y = dwBufferSize.Y-dwBufferCoord.Y;
00644 
00645     a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Left = lpReadRegion-&gt;Left;
00646     a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(lpReadRegion-&gt;Left + SourceSize.X - 1);
00647     a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Top  = lpReadRegion-&gt;Top;
00648     a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(lpReadRegion-&gt;Top + SourceSize.Y - 1);
00649 
00650     <span class="comment">//</span>
00651     <span class="comment">// for speed in the case where we're only reading one character, we have</span>
00652     <span class="comment">// a buffer in the msg we pass to the server. this means we don't have to</span>
00653     <span class="comment">// allocate a capture buffer.</span>
00654     <span class="comment">//</span>
00655 
00656     NumChars = SourceSize.X * SourceSize.Y;
00657     <span class="keywordflow">if</span> (NumChars &gt; 1) {
00658         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00659                                                   NumChars * <span class="keyword">sizeof</span>(CHAR_INFO)
00660                                                 );
00661         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00662             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00663             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00664         }
00665         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00666                                  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00667                                  NumChars * <span class="keyword">sizeof</span>(CHAR_INFO),
00668                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o3">BufPtr</a>
00669                                );
00670     }
00671     <span class="keywordflow">else</span> {
00672         CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00673         a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o3">BufPtr</a> = &amp;a-&gt;<a class="code" href="../../d4/d4/struct__CONSOLE__READCONSOLEOUTPUT__MSG.html#o2">Char</a>;
00674     }
00675     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00676                          CaptureBuffer,
00677                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00678                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a166">ConsolepReadConsoleOutput</a>
00679                                             ),
00680                          <span class="keyword">sizeof</span>( *a )
00681                        );
00682     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00683         <span class="keywordflow">try</span> {
00684             SMALL_RECT SourceRect;
00685 
00686             SourceRect.Left = a-&gt;CharRegion.Left - lpReadRegion-&gt;Left;
00687             SourceRect.Top = a-&gt;CharRegion.Top - lpReadRegion-&gt;Top;
00688             SourceRect.Right = SourceRect.Left +
00689                     (a-&gt;CharRegion.Right - a-&gt;CharRegion.Left);
00690             SourceRect.Bottom =  SourceRect.Top +
00691                     (a-&gt;CharRegion.Bottom - a-&gt;CharRegion.Top);
00692             dwBufferCoord.X += SourceRect.Left;
00693             dwBufferCoord.Y += SourceRect.Top;
00694             <a class="code" href="../../d6/d2/output_8c.html#a51">CopyRectangle</a>(a-&gt;BufPtr,
00695                           SourceSize,
00696                           &amp;SourceRect,
00697                           lpBuffer,
00698                           dwBufferSize,
00699                           dwBufferCoord
00700                          );
00701         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00702             <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00703                 <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00704             }
00705             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00706             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00707         }
00708     }
00709     <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00710         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00711     }
00712     *lpReadRegion = a-&gt;CharRegion;
00713     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(m.ReturnValue)) {
00714         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00715         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00716     }
00717     <span class="keywordflow">else</span> {
00718         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00719     }
00720 
00721 }
00722 
00723 <span class="preprocessor">#endif </span>
00724 <span class="preprocessor"></span>
00725 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00726 <span class="preprocessor"></span>
00727 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00728 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00729"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a13">00729</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a13">ReadConsoleOutputW</a>(
00730     HANDLE hConsoleOutput,
00731     PCHAR_INFO lpBuffer,
00732     COORD dwBufferSize,
00733     COORD dwBufferCoord,
00734     PSMALL_RECT lpReadRegion
00735     )
00736 {
00737     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a12">ReadConsoleOutputInternal</a>(hConsoleOutput,
00738                                      lpBuffer,
00739                                      dwBufferSize,
00740                                      dwBufferCoord,
00741                                      lpReadRegion,
00742                                      <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00743                                     );
00744 }
00745 
00746 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00747 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00748"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a14">00748</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a14">ReadConsoleOutputA</a>(
00749     HANDLE hConsoleOutput,
00750     PCHAR_INFO lpBuffer,
00751     COORD dwBufferSize,
00752     COORD dwBufferCoord,
00753     PSMALL_RECT lpReadRegion
00754     )
00755 {
00756     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a12">ReadConsoleOutputInternal</a>(hConsoleOutput,
00757                                      lpBuffer,
00758                                      dwBufferSize,
00759                                      dwBufferCoord,
00760                                      lpReadRegion,
00761                                      <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00762                                     );
00763 }
00764 
00765 <span class="preprocessor">#endif </span>
00766 <span class="preprocessor"></span>
00767 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00768 <span class="preprocessor"></span>
00769 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00770 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00771"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a15">00771</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a15">WriteConsoleOutputInternal</a>(
00772     IN HANDLE hConsoleOutput,
00773     IN CONST CHAR_INFO *lpBuffer,
00774     IN COORD dwBufferSize,
00775     IN COORD dwBufferCoord,
00776     IN PSMALL_RECT lpWriteRegion,
00777     IN BOOLEAN Unicode
00778     )
00779 
00780 <span class="comment">/*++</span>
00781 <span class="comment">Parameters:</span>
00782 <span class="comment"></span>
00783 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
00784 <span class="comment">        that is to be written.  The handle must have been created with</span>
00785 <span class="comment">        GENERIC_WRITE access.</span>
00786 <span class="comment"></span>
00787 <span class="comment">    lpBuffer - Supplies the address of a buffer containing the data to write</span>
00788 <span class="comment">        to the screen buffer.  This buffer is treated as a two dimensional</span>
00789 <span class="comment">        array.</span>
00790 <span class="comment"></span>
00791 <span class="comment">    dwBufferSize - size of lpBuffer</span>
00792 <span class="comment"></span>
00793 <span class="comment">    dwBufferCoord - coordinates of upper left point in buffer to write data</span>
00794 <span class="comment">        from.</span>
00795 <span class="comment"></span>
00796 <span class="comment">    lpWriteRegion - Supplies on input the address of a structure indicating the</span>
00797 <span class="comment">        rectangle within the screen buffer to write to.  The fields in</span>
00798 <span class="comment">        the structure are column and row coordinates.  On output, the fields</span>
00799 <span class="comment">        contain the actual region written.</span>
00800 <span class="comment"></span>
00801 <span class="comment">Return Value:</span>
00802 <span class="comment"></span>
00803 <span class="comment">    TRUE - The operation was successful.</span>
00804 <span class="comment"></span>
00805 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00806 <span class="comment">        using GetLastError.</span>
00807 <span class="comment">--*/</span>
00808 
00809 {
00810 
00811     PCSR_CAPTURE_HEADER CaptureBuffer;
00812     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00813     <a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html">PCONSOLE_WRITECONSOLEOUTPUT_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.WriteConsoleOutput;
00814     ULONG NumChars;
00815     COORD SourceSize;
00816     COORD TargetPoint;
00817 
00818     a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00819     a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
00820     a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o5">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00821 
00822     <span class="comment">//</span>
00823     <span class="comment">// clip region to write based on caller's buffer size</span>
00824     <span class="comment">//</span>
00825 
00826     SourceSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d6/d4/condll_8h.html#a7">CONSOLE_RECT_SIZE_X</a>(lpWriteRegion);
00827     <span class="keywordflow">if</span> (SourceSize.X &gt; dwBufferSize.X-dwBufferCoord.X)
00828         SourceSize.X = dwBufferSize.X-dwBufferCoord.X;
00829     SourceSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d6/d4/condll_8h.html#a8">CONSOLE_RECT_SIZE_Y</a>(lpWriteRegion);
00830     <span class="keywordflow">if</span> (SourceSize.Y &gt; dwBufferSize.Y-dwBufferCoord.Y)
00831         SourceSize.Y = dwBufferSize.Y-dwBufferCoord.Y;
00832 
00833     <span class="keywordflow">if</span> (SourceSize.X &lt;= 0 ||
00834         SourceSize.Y &lt;= 0) {
00835         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
00836         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00837     }
00838 
00839     a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Left = lpWriteRegion-&gt;Left;
00840     a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(lpWriteRegion-&gt;Left + SourceSize.X - 1);
00841     a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Top  = lpWriteRegion-&gt;Top;
00842     a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o4">CharRegion</a>.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(lpWriteRegion-&gt;Top + SourceSize.Y - 1);
00843 
00844     <span class="comment">//</span>
00845     <span class="comment">// for speed in the case where we're only writing one character, we have</span>
00846     <span class="comment">// a buffer in the msg we pass to the server. this means we don't have to</span>
00847     <span class="comment">// allocate a capture buffer.</span>
00848     <span class="comment">//</span>
00849 
00850     NumChars = SourceSize.X * SourceSize.Y;
00851     <span class="keywordflow">if</span> (NumChars &gt; 1) {
00852         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00853                                                   NumChars * <span class="keyword">sizeof</span>(CHAR_INFO)
00854                                                 );
00855         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00856             a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o6">ReadVM</a>=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00857             a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, NumChars * <span class="keyword">sizeof</span>(CHAR_INFO));
00858             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00859                 <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00860                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00861             }
00862         } <span class="keywordflow">else</span> {
00863             a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o6">ReadVM</a>=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00864             <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00865                                      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00866                                      NumChars * <span class="keyword">sizeof</span>(CHAR_INFO),
00867                                      (PVOID *) &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a>
00868                                    );
00869         }
00870     }
00871     <span class="keywordflow">else</span> {
00872         a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o6">ReadVM</a>=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00873         CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00874         a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a> = &amp;a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o2">Char</a>;
00875     }
00876     <span class="keywordflow">try</span> {
00877         SMALL_RECT SourceRect;
00878 
00879         SourceRect.Left = dwBufferCoord.X;
00880         SourceRect.Top = dwBufferCoord.Y;
00881         SourceRect.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(dwBufferCoord.X+SourceSize.X-1);
00882         SourceRect.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(dwBufferCoord.Y+SourceSize.Y-1);
00883         TargetPoint.X = 0;
00884         TargetPoint.Y = 0;
00885         <a class="code" href="../../d6/d2/output_8c.html#a51">CopyRectangle</a>(lpBuffer,
00886                       dwBufferSize,
00887                       &amp;SourceRect,
00888                       a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a>,
00889                       SourceSize,
00890                       TargetPoint
00891                      );
00892     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00893         <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00894             <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00895         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o6">ReadVM</a>) {
00896             <span class="comment">// a-&gt;BufPtr was allocated with RtlAllocateHeap.</span>
00897             <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, a-&gt;<a class="code" href="../../d6/d7/struct__CONSOLE__WRITECONSOLEOUTPUT__MSG.html#o3">BufPtr</a>);  
00898         }
00899         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00900         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00901     }
00902     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00903                          CaptureBuffer,
00904                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00905                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a167">ConsolepWriteConsoleOutput</a>
00906                                             ),
00907                          <span class="keyword">sizeof</span>( *a )
00908                        );
00909     <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00910         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00911     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;ReadVM) {
00912         <span class="comment">// a-&gt;BufPtr was allocated with RtlAllocateHeap.</span>
00913         <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>(RtlProcessHeap(),0,a-&gt;BufPtr);       
00914     }
00915     *lpWriteRegion = a-&gt;CharRegion;
00916     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(m.ReturnValue)) {
00917         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00918         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00919     }
00920     <span class="keywordflow">else</span> {
00921         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00922     }
00923 
00924 }
00925 
00926 <span class="preprocessor">#endif </span>
00927 <span class="preprocessor"></span>
00928 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00929 <span class="preprocessor"></span>
00930 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00931 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00932"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a16">00932</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a16">WriteConsoleOutputW</a>(
00933     HANDLE hConsoleOutput,
00934     CONST CHAR_INFO *lpBuffer,
00935     COORD dwBufferSize,
00936     COORD dwBufferCoord,
00937     PSMALL_RECT lpWriteRegion
00938     )
00939 {
00940     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a15">WriteConsoleOutputInternal</a>(hConsoleOutput,
00941                                       lpBuffer,
00942                                       dwBufferSize,
00943                                       dwBufferCoord,
00944                                       lpWriteRegion,
00945                                       <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00946                                       );
00947 }
00948 
00949 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00950 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00951"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a17">00951</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a17">WriteConsoleOutputA</a>(
00952     HANDLE hConsoleOutput,
00953     CONST CHAR_INFO *lpBuffer,
00954     COORD dwBufferSize,
00955     COORD dwBufferCoord,
00956     PSMALL_RECT lpWriteRegion
00957     )
00958 {
00959     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a15">WriteConsoleOutputInternal</a>(hConsoleOutput,
00960                                       lpBuffer,
00961                                       dwBufferSize,
00962                                       dwBufferCoord,
00963                                       lpWriteRegion,
00964                                       <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00965                                       );
00966 }
00967 
00968 <span class="preprocessor">#endif //defined(BUILD_WOW64)</span>
00969 <span class="preprocessor"></span>
00970 <span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00971 <span class="preprocessor"></span>
00972 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00973 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00974"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a18">00974</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a18">ReadConsoleOutputString</a>(
00975     IN HANDLE hConsoleOutput,
00976     OUT LPVOID lpString,
00977     IN DWORD nLength,
00978     IN DWORD nSize,
00979     IN DWORD fFlags,
00980     IN COORD dwReadCoord,
00981     OUT LPDWORD lpNumberOfElementsRead
00982     )
00983 
00984 <span class="comment">/*++</span>
00985 <span class="comment"></span>
00986 <span class="comment">Parameters:</span>
00987 <span class="comment"></span>
00988 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
00989 <span class="comment">        that is to be read.  The handle must have been created with</span>
00990 <span class="comment">        GENERIC_READ access.</span>
00991 <span class="comment"></span>
00992 <span class="comment">    lpString - Supplies the address of a buffer to receive the character</span>
00993 <span class="comment">        or attribute string read from the screen buffer.</span>
00994 <span class="comment"></span>
00995 <span class="comment">    nLength - Size of lpCharacter buffer in elements.</span>
00996 <span class="comment"></span>
00997 <span class="comment">    nSize - Size of element to read.</span>
00998 <span class="comment"></span>
00999 <span class="comment">    fFlags - flag indicating what type of string to copy</span>
01000 <span class="comment"></span>
01001 <span class="comment">    dwReadCoord - Screen buffer coordinates of string to read.</span>
01002 <span class="comment">        read data.</span>
01003 <span class="comment"></span>
01004 <span class="comment">    lpNumberOfElementsRead - Pointer to number of events read.</span>
01005 <span class="comment"></span>
01006 <span class="comment">Return Value:</span>
01007 <span class="comment"></span>
01008 <span class="comment">    TRUE - The operation was successful.</span>
01009 <span class="comment"></span>
01010 <span class="comment">    FALSE/NULL - The operation failed.</span>
01011 <span class="comment">        Extended error status is available using GetLastError.</span>
01012 <span class="comment"></span>
01013 <span class="comment">--*/</span>
01014 
01015 {
01016     PCSR_CAPTURE_HEADER CaptureBuffer;
01017     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
01018     <a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html">PCONSOLE_READCONSOLEOUTPUTSTRING_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.ReadConsoleOutputString;
01019     ULONG DataLength;
01020 
01021     a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
01022     a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
01023     a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a> = nLength;
01024     a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o3">StringType</a> = fFlags;
01025     a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o2">ReadCoord</a> = dwReadCoord;
01026 
01027     DataLength = nLength*nSize;
01028 
01029     <span class="comment">//</span>
01030     <span class="comment">// for speed in the case where the string is small, we have a buffer</span>
01031     <span class="comment">// in the msg we pass to the server. this means we don't have to</span>
01032     <span class="comment">// allocate a capture buffer.</span>
01033     <span class="comment">//</span>
01034 
01035     <span class="keywordflow">if</span> (DataLength &gt; <span class="keyword">sizeof</span>(a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o4">String</a>)) {
01036         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
01037                                                   DataLength
01038                                                 );
01039         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01040             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
01041             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01042         }
01043         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
01044                                  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01045                                  DataLength,
01046                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>
01047                                );
01048 
01049     }
01050     <span class="keywordflow">else</span> {
01051         a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a> = a-&gt;<a class="code" href="../../d5/d4/struct__CONSOLE__READCONSOLEOUTPUTSTRING__MSG.html#o4">String</a>;
01052         CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01053     }
01054     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
01055                          CaptureBuffer,
01056                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
01057                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a168">ConsolepReadConsoleOutputString</a>
01058                                             ),
01059                          <span class="keyword">sizeof</span>( *a )
01060                        );
01061 
01062     <span class="keywordflow">try</span> {
01063        *lpNumberOfElementsRead = a-&gt;NumRecords;
01064         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
01065             RtlCopyMemory(lpString, a-&gt;BufPtr, a-&gt;NumRecords * nSize);
01066         }
01067         <span class="keywordflow">else</span> {
01068             <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
01069         }
01070     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01071         <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01072             <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
01073         }
01074         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
01075         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01076     }
01077     <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01078         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
01079     }
01080     <span class="keywordflow">return</span> <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(m.ReturnValue);
01081 }
01082 
01083 <span class="preprocessor">#endif </span>
01084 <span class="preprocessor"></span>
01085 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
01086 <span class="preprocessor"></span>
01087 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01088 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01089"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a19">01089</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a19">ReadConsoleOutputCharacterA</a>(
01090     HANDLE hConsoleOutput,
01091     LPSTR lpCharacter,
01092     DWORD nLength,
01093     COORD dwReadCoord,
01094     LPDWORD lpNumberOfCharsRead
01095     )
01096 
01097 <span class="comment">/*++</span>
01098 <span class="comment"></span>
01099 <span class="comment">Parameters:</span>
01100 <span class="comment"></span>
01101 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
01102 <span class="comment">        that is to be read.  The handle must have been created with</span>
01103 <span class="comment">        GENERIC_READ access.</span>
01104 <span class="comment"></span>
01105 <span class="comment">    lpCharacter - Supplies the address of a buffer to receive the character</span>
01106 <span class="comment">        string read from the screen buffer.</span>
01107 <span class="comment"></span>
01108 <span class="comment">    nLength - Size of lpCharacter buffer in characters.</span>
01109 <span class="comment"></span>
01110 <span class="comment">    dwReadCoord - Screen buffer coordinates of string to read.</span>
01111 <span class="comment">        read data.</span>
01112 <span class="comment"></span>
01113 <span class="comment">    lpNumberOfCharsRead - Pointer to number of chars read.</span>
01114 <span class="comment"></span>
01115 <span class="comment">Return Value:</span>
01116 <span class="comment"></span>
01117 <span class="comment">    TRUE - The operation was successful.</span>
01118 <span class="comment"></span>
01119 <span class="comment">    FALSE/NULL - The operation failed.</span>
01120 <span class="comment">        Extended error status is available using GetLastError.</span>
01121 <span class="comment"></span>
01122 <span class="comment">--*/</span>
01123 
01124 {
01125     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a18">ReadConsoleOutputString</a>(hConsoleOutput,
01126                                    lpCharacter,
01127                                    nLength,
01128                                    <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>),
01129                                    <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>,
01130                                    dwReadCoord,
01131                                    lpNumberOfCharsRead
01132                                   );
01133 }
01134 
01135 
01136 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01137 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01138"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a20">01138</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a20">ReadConsoleOutputCharacterW</a>(
01139     HANDLE hConsoleOutput,
01140     LPWSTR lpCharacter,
01141     DWORD nLength,
01142     COORD dwReadCoord,
01143     LPDWORD lpNumberOfCharsRead
01144     )
01145 
01146 {
01147     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a18">ReadConsoleOutputString</a>(hConsoleOutput,
01148                                    lpCharacter,
01149                                    nLength,
01150                                    <span class="keyword">sizeof</span>(WCHAR),
01151                                    <a class="code" href="../../d5/d5/conmsg_8h.html#a10">CONSOLE_REAL_UNICODE</a>,
01152                                    dwReadCoord,
01153                                    lpNumberOfCharsRead
01154                                   );
01155 }
01156 
01157 
01158 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01159 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01160"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a21">01160</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a21">ReadConsoleOutputAttribute</a>(
01161     HANDLE hConsoleOutput,
01162     LPWORD lpAttribute,
01163     DWORD nLength,
01164     COORD dwReadCoord,
01165     LPDWORD lpNumberOfAttrsRead
01166     )
01167 
01168 <span class="comment">/*++</span>
01169 <span class="comment"></span>
01170 <span class="comment">Parameters:</span>
01171 <span class="comment"></span>
01172 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
01173 <span class="comment">        that is to be read.  The handle must have been created with</span>
01174 <span class="comment">        GENERIC_READ access.</span>
01175 <span class="comment"></span>
01176 <span class="comment">    lpAttribute - Supplies the address of a buffer to receive the attribute</span>
01177 <span class="comment">        string read from the screen buffer.</span>
01178 <span class="comment"></span>
01179 <span class="comment">    nLength - Size of lpAttribute buffer in bytes.</span>
01180 <span class="comment"></span>
01181 <span class="comment">    dwReadCoord - Screen buffer coordinates of string to read.</span>
01182 <span class="comment">        read data.</span>
01183 <span class="comment"></span>
01184 <span class="comment">    lpNumberOfAttrsRead - Pointer to number of attrs read.</span>
01185 <span class="comment"></span>
01186 <span class="comment">Return Value:</span>
01187 <span class="comment"></span>
01188 <span class="comment">    TRUE - The operation was successful.</span>
01189 <span class="comment"></span>
01190 <span class="comment">    FALSE/NULL - The operation failed.</span>
01191 <span class="comment">        Extended error status is available using GetLastError.</span>
01192 <span class="comment"></span>
01193 <span class="comment">--*/</span>
01194 
01195 {
01196     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a18">ReadConsoleOutputString</a>(hConsoleOutput,
01197                                    lpAttribute,
01198                                    nLength,
01199                                    <span class="keyword">sizeof</span>(WORD),
01200                                    <a class="code" href="../../d5/d5/conmsg_8h.html#a11">CONSOLE_ATTRIBUTE</a>,
01201                                    dwReadCoord,
01202                                    lpNumberOfAttrsRead
01203                                   );
01204 }
01205 
01206 <span class="preprocessor">#endif </span>
01207 <span class="preprocessor"></span>
01208 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
01209 <span class="preprocessor"></span>
01210 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01211 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01212"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a22">01212</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a22">WriteConsoleOutputString</a>(
01213     IN HANDLE hConsoleOutput,
01214     IN CONST VOID *lpString,
01215     IN DWORD nLength,
01216     IN DWORD nSize,
01217     IN DWORD fFlags,
01218     IN COORD dwWriteCoord,
01219     OUT LPDWORD lpNumberOfElementsWritten
01220     )
01221 
01222 <span class="comment">/*++</span>
01223 <span class="comment"></span>
01224 <span class="comment">Parameters:</span>
01225 <span class="comment"></span>
01226 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
01227 <span class="comment">        that is to be written.  The handle must have been created with</span>
01228 <span class="comment">        GENERIC_WRITE access.</span>
01229 <span class="comment"></span>
01230 <span class="comment">    lpString - Supplies the address of a buffer containing the character</span>
01231 <span class="comment">        or attribute string to write to the screen buffer.</span>
01232 <span class="comment"></span>
01233 <span class="comment">    nLength - Length of string to write, in elements.</span>
01234 <span class="comment"></span>
01235 <span class="comment">    nSize - Size of element to read.</span>
01236 <span class="comment"></span>
01237 <span class="comment">    fFlags - flag indicating what type of string to copy</span>
01238 <span class="comment"></span>
01239 <span class="comment">    dwWriteCoord - Screen buffer coordinates to write the string to.</span>
01240 <span class="comment"></span>
01241 <span class="comment">    lpNumberOfElementsWritten - Pointer to number of elements written.</span>
01242 <span class="comment"></span>
01243 <span class="comment">Return Value:</span>
01244 <span class="comment"></span>
01245 <span class="comment">    TRUE - The operation was successful.</span>
01246 <span class="comment"></span>
01247 <span class="comment">    FALSE/NULL - The operation failed.</span>
01248 <span class="comment">        Extended error status is available using GetLastError.</span>
01249 <span class="comment"></span>
01250 <span class="comment">--*/</span>
01251 
01252 {
01253 
01254     PCSR_CAPTURE_HEADER CaptureBuffer;
01255     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
01256     <a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html">PCONSOLE_WRITECONSOLEOUTPUTSTRING_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.WriteConsoleOutputString;
01257     ULONG DataLength;
01258 
01259     a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
01260     a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
01261     a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o6">NumRecords</a> = nLength;
01262     a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o3">StringType</a> = fFlags;
01263     a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o2">WriteCoord</a> = dwWriteCoord;
01264 
01265     <span class="comment">//</span>
01266     <span class="comment">// for speed in the case where the string is small, we have a buffer</span>
01267     <span class="comment">// in the msg we pass to the server. this means we don't have to</span>
01268     <span class="comment">// allocate a capture buffer.</span>
01269     <span class="comment">//</span>
01270 
01271     DataLength = nLength*nSize;
01272     <span class="keywordflow">if</span> (DataLength &gt; <span class="keyword">sizeof</span>(a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o4">String</a>)) {
01273         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
01274                                                   DataLength
01275                                                 );
01276         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01277             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
01278             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01279         }
01280         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
01281                                  (PCHAR) lpString,
01282                                  DataLength,
01283                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>
01284                                );
01285     }
01286     <span class="keywordflow">else</span> {
01287         a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a> = a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o4">String</a>;
01288         CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01289 
01290         <span class="keywordflow">try</span> {
01291             RtlCopyMemory(a-&gt;<a class="code" href="../../d7/d7/struct__CONSOLE__WRITECONSOLEOUTPUTSTRING__MSG.html#o5">BufPtr</a>, lpString, DataLength);
01292         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01293             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
01294             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01295         }
01296     }
01297     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
01298                          CaptureBuffer,
01299                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
01300                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a169">ConsolepWriteConsoleOutputString</a>
01301                                             ),
01302                          <span class="keyword">sizeof</span>( *a )
01303                        );
01304     <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01305         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
01306     }
01307     <span class="keywordflow">try</span> {
01308         *lpNumberOfElementsWritten = a-&gt;NumRecords;
01309     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01310         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
01311         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01312     }
01313     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(m.ReturnValue)) {
01314         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
01315         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01316     }
01317     <span class="keywordflow">else</span> {
01318         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01319     }
01320 
01321 }
01322 
01323 <span class="preprocessor">#endif </span>
01324 <span class="preprocessor"></span>
01325 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
01326 <span class="preprocessor"></span>
01327 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01328 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01329"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a23">01329</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a23">WriteConsoleOutputCharacterA</a>(
01330     HANDLE hConsoleOutput,
01331     LPCSTR lpCharacter,
01332     DWORD nLength,
01333     COORD dwWriteCoord,
01334     LPDWORD lpNumberOfCharsWritten
01335     )
01336 
01337 <span class="comment">/*++</span>
01338 <span class="comment"></span>
01339 <span class="comment">Parameters:</span>
01340 <span class="comment"></span>
01341 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
01342 <span class="comment">        that is to be written.  The handle must have been created with</span>
01343 <span class="comment">        GENERIC_WRITE access.</span>
01344 <span class="comment"></span>
01345 <span class="comment">    lpCharacter - Supplies the address of a buffer containing the character</span>
01346 <span class="comment">        string to write to the screen buffer.</span>
01347 <span class="comment"></span>
01348 <span class="comment">    nLength - Length of string to write, in characters.</span>
01349 <span class="comment"></span>
01350 <span class="comment">    dwWriteCoord - Screen buffer coordinates to write the string to.</span>
01351 <span class="comment"></span>
01352 <span class="comment">    lpNumberOfCharsWritten - Pointer to number of chars written.</span>
01353 <span class="comment"></span>
01354 <span class="comment">Return Value:</span>
01355 <span class="comment"></span>
01356 <span class="comment">    TRUE - The operation was successful.</span>
01357 <span class="comment"></span>
01358 <span class="comment">    FALSE/NULL - The operation failed.</span>
01359 <span class="comment">        Extended error status is available using GetLastError.</span>
01360 <span class="comment"></span>
01361 <span class="comment">--*/</span>
01362 
01363 {
01364     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a22">WriteConsoleOutputString</a>(hConsoleOutput,
01365                                     lpCharacter,
01366                                     nLength,
01367                                     <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>),
01368                                     <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>,
01369                                     dwWriteCoord,
01370                                     lpNumberOfCharsWritten
01371                                    );
01372 }
01373 
01374 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01375 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01376"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a24">01376</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a24">WriteConsoleOutputCharacterW</a>(
01377     HANDLE hConsoleOutput,
01378     LPCWSTR lpCharacter,
01379     DWORD nLength,
01380     COORD dwWriteCoord,
01381     LPDWORD lpNumberOfCharsWritten
01382     )
01383 
01384 {
01385     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a22">WriteConsoleOutputString</a>(hConsoleOutput,
01386                                     lpCharacter,
01387                                     nLength,
01388                                     <span class="keyword">sizeof</span>(WCHAR),
01389                                     <a class="code" href="../../d5/d5/conmsg_8h.html#a10">CONSOLE_REAL_UNICODE</a>,
01390                                     dwWriteCoord,
01391                                     lpNumberOfCharsWritten
01392                                    );
01393 }
01394 
01395 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01396 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01397"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a25">01397</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a25">WriteConsoleOutputAttribute</a>(
01398     HANDLE hConsoleOutput,
01399     CONST WORD *lpAttribute,
01400     DWORD nLength,
01401     COORD dwWriteCoord,
01402     LPDWORD lpNumberOfAttrsWritten
01403     )
01404 
01405 <span class="comment">/*++</span>
01406 <span class="comment"></span>
01407 <span class="comment">Parameters:</span>
01408 <span class="comment"></span>
01409 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
01410 <span class="comment">        that is to be written.  The handle must have been created with</span>
01411 <span class="comment">        GENERIC_WRITE access.</span>
01412 <span class="comment"></span>
01413 <span class="comment">    lpAttribute - Supplies the address of a buffer containing the attribute</span>
01414 <span class="comment">        string to write to the screen buffer.</span>
01415 <span class="comment"></span>
01416 <span class="comment">    nLength - Length of string to write.</span>
01417 <span class="comment"></span>
01418 <span class="comment">    dwWriteCoord - Screen buffer coordinates to write the string to.</span>
01419 <span class="comment"></span>
01420 <span class="comment">    lpNumberOfAttrsWritten - Pointer to number of attrs written.</span>
01421 <span class="comment"></span>
01422 <span class="comment">Return Value:</span>
01423 <span class="comment"></span>
01424 <span class="comment">    TRUE - The operation was successful.</span>
01425 <span class="comment"></span>
01426 <span class="comment">    FALSE/NULL - The operation failed.</span>
01427 <span class="comment">        Extended error status is available using GetLastError.</span>
01428 <span class="comment"></span>
01429 <span class="comment">--*/</span>
01430 
01431 {
01432     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a22">WriteConsoleOutputString</a>(hConsoleOutput,
01433                                     lpAttribute,
01434                                     nLength,
01435                                     <span class="keyword">sizeof</span>(WORD),
01436                                     <a class="code" href="../../d5/d5/conmsg_8h.html#a11">CONSOLE_ATTRIBUTE</a>,
01437                                     dwWriteCoord,
01438                                     lpNumberOfAttrsWritten
01439                                    );
01440 }
01441 
01442 <span class="preprocessor">#endif </span>
01443 <span class="preprocessor"></span>
01444 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
01445 <span class="preprocessor"></span>
01446 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01447 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01448"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a26">01448</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a26">FillConsoleOutput</a>(
01449     IN HANDLE hConsoleOutput,
01450     IN WORD   Element,
01451     IN DWORD  nLength,
01452     IN DWORD  fFlags,
01453     IN COORD  dwWriteCoord,
01454     OUT LPDWORD lpNumberOfElementsWritten
01455     )
01456 
01457 <span class="comment">/*++</span>
01458 <span class="comment"></span>
01459 <span class="comment">Parameters:</span>
01460 <span class="comment"></span>
01461 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
01462 <span class="comment">        that is to be written.  The handle must have been created with</span>
01463 <span class="comment">        GENERIC_WRITE access.</span>
01464 <span class="comment"></span>
01465 <span class="comment">    Element - The attribute or character to write.</span>
01466 <span class="comment"></span>
01467 <span class="comment">    nLength - Number of times to write the element.</span>
01468 <span class="comment"></span>
01469 <span class="comment">    fFlags - flag indicating what type of element to write.</span>
01470 <span class="comment"></span>
01471 <span class="comment">    dwWriteCoord - Screen buffer coordinates to write the element to.</span>
01472 <span class="comment"></span>
01473 <span class="comment">    lpNumberOfElementsWritten - Pointer to number of elements written.</span>
01474 <span class="comment"></span>
01475 <span class="comment">Return Value:</span>
01476 <span class="comment"></span>
01477 <span class="comment">    TRUE - The operation was successful.</span>
01478 <span class="comment"></span>
01479 <span class="comment">    FALSE/NULL - The operation failed.</span>
01480 <span class="comment">        Extended error status is available using GetLastError.</span>
01481 <span class="comment"></span>
01482 <span class="comment">--*/</span>
01483 
01484 {
01485 
01486     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
01487     <a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html">PCONSOLE_FILLCONSOLEOUTPUT_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.FillConsoleOutput;
01488 
01489     a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
01490     a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
01491     a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o5">Length</a> = nLength;
01492     a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o3">ElementType</a> = fFlags;
01493     a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o4">Element</a> = Element;
01494     a-&gt;<a class="code" href="../../d2/d0/struct__CONSOLE__FILLCONSOLEOUTPUT__MSG.html#o2">WriteCoord</a> = dwWriteCoord;
01495     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
01496                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01497                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
01498                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a170">ConsolepFillConsoleOutput</a>
01499                                             ),
01500                          <span class="keyword">sizeof</span>( *a )
01501                        );
01502     <span class="keywordflow">try</span> {
01503         *lpNumberOfElementsWritten = a-&gt;Length;
01504     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01505         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
01506         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01507     }
01508     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(m.ReturnValue)) {
01509         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
01510         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01511     }
01512     <span class="keywordflow">else</span> {
01513         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01514     }
01515 
01516 }
01517 
01518 <span class="preprocessor">#endif </span>
01519 <span class="preprocessor"></span>
01520 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
01521 <span class="preprocessor"></span>
01522 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01523 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01524"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a27">01524</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a27">FillConsoleOutputCharacterA</a>(
01525     HANDLE hConsoleOutput,
01526     CHAR   cCharacter,
01527     DWORD  nLength,
01528     COORD  dwWriteCoord,
01529     LPDWORD lpNumberOfCharsWritten
01530     )
01531 
01532 <span class="comment">/*++</span>
01533 <span class="comment"></span>
01534 <span class="comment">Parameters:</span>
01535 <span class="comment"></span>
01536 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
01537 <span class="comment">        that is to be written.  The handle must have been created with</span>
01538 <span class="comment">        GENERIC_WRITE access.</span>
01539 <span class="comment"></span>
01540 <span class="comment">    cCharacter - Supplies the ASCII character to write to the screen buffer.</span>
01541 <span class="comment"></span>
01542 <span class="comment">    nLength - Number of times to write the character.</span>
01543 <span class="comment"></span>
01544 <span class="comment">    dwWriteCoord - Screen buffer coordinates to begin writing the character</span>
01545 <span class="comment">        to.</span>
01546 <span class="comment"></span>
01547 <span class="comment">    lpNumberOfCharsWritten - Pointer to number of chars written.</span>
01548 <span class="comment"></span>
01549 <span class="comment">Return Value:</span>
01550 <span class="comment"></span>
01551 <span class="comment">    TRUE - The operation was successful.</span>
01552 <span class="comment"></span>
01553 <span class="comment">    FALSE/NULL - The operation failed.</span>
01554 <span class="comment">        Extended error status is available using GetLastError.</span>
01555 <span class="comment"></span>
01556 <span class="comment">--*/</span>
01557 
01558 {
01559     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a26">FillConsoleOutput</a>(hConsoleOutput,
01560                              (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) cCharacter,
01561                              nLength,
01562                              <a class="code" href="../../d5/d5/conmsg_8h.html#a9">CONSOLE_ASCII</a>,
01563                              dwWriteCoord,
01564                              lpNumberOfCharsWritten
01565                             );
01566 }
01567 
01568 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01569 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01570"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a28">01570</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a28">FillConsoleOutputCharacterW</a>(
01571     HANDLE hConsoleOutput,
01572     WCHAR   cCharacter,
01573     DWORD  nLength,
01574     COORD  dwWriteCoord,
01575     LPDWORD lpNumberOfCharsWritten
01576     )
01577 
01578 <span class="comment">/*++</span>
01579 <span class="comment"></span>
01580 <span class="comment">Parameters:</span>
01581 <span class="comment"></span>
01582 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
01583 <span class="comment">        that is to be written.  The handle must have been created with</span>
01584 <span class="comment">        GENERIC_WRITE access.</span>
01585 <span class="comment"></span>
01586 <span class="comment">    cCharacter - Supplies the ASCII character to write to the screen buffer.</span>
01587 <span class="comment"></span>
01588 <span class="comment">    nLength - Number of times to write the character.</span>
01589 <span class="comment"></span>
01590 <span class="comment">    dwWriteCoord - Screen buffer coordinates to begin writing the character</span>
01591 <span class="comment">        to.</span>
01592 <span class="comment"></span>
01593 <span class="comment">    lpNumberOfCharsWritten - Pointer to number of chars written.</span>
01594 <span class="comment"></span>
01595 <span class="comment">Return Value:</span>
01596 <span class="comment"></span>
01597 <span class="comment">    TRUE - The operation was successful.</span>
01598 <span class="comment"></span>
01599 <span class="comment">    FALSE/NULL - The operation failed.</span>
01600 <span class="comment">        Extended error status is available using GetLastError.</span>
01601 <span class="comment"></span>
01602 <span class="comment">--*/</span>
01603 
01604 {
01605     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a26">FillConsoleOutput</a>(hConsoleOutput,
01606                              (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) cCharacter,
01607                              nLength,
01608                              <a class="code" href="../../d5/d5/conmsg_8h.html#a10">CONSOLE_REAL_UNICODE</a>,
01609                              dwWriteCoord,
01610                              lpNumberOfCharsWritten
01611                             );
01612 }
01613 
01614 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01615 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01616"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a29">01616</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a29">FillConsoleOutputAttribute</a>(
01617     HANDLE hConsoleOutput,
01618     WORD   wAttribute,
01619     DWORD  nLength,
01620     COORD  dwWriteCoord,
01621     LPDWORD lpNumberOfAttrsWritten
01622     )
01623 
01624 <span class="comment">/*++</span>
01625 <span class="comment"></span>
01626 <span class="comment">Parameters:</span>
01627 <span class="comment"></span>
01628 <span class="comment">    hConsoleOutput - Supplies an open handle to the screen buffer (CONOUT$)</span>
01629 <span class="comment">        that is to be written.  The handle must have been created with</span>
01630 <span class="comment">        GENERIC_WRITE access.</span>
01631 <span class="comment"></span>
01632 <span class="comment">    wAttribute - Supplies the attribute to write to the screen buffer.</span>
01633 <span class="comment"></span>
01634 <span class="comment">    nLength - Number of times to write the attribute.</span>
01635 <span class="comment"></span>
01636 <span class="comment">    dwWriteCoord - Screen buffer coordinates to begin writing the attribute</span>
01637 <span class="comment">        to.</span>
01638 <span class="comment"></span>
01639 <span class="comment">    lpNumberOfAttrsWritten - Pointer to number of attrs written.</span>
01640 <span class="comment"></span>
01641 <span class="comment">Return Value:</span>
01642 <span class="comment"></span>
01643 <span class="comment">    TRUE - The operation was successful.</span>
01644 <span class="comment"></span>
01645 <span class="comment">    FALSE/NULL - The operation failed.</span>
01646 <span class="comment">        Extended error status is available using GetLastError.</span>
01647 <span class="comment"></span>
01648 <span class="comment">--*/</span>
01649 
01650 {
01651     <span class="keywordflow">return</span> <a class="code" href="../../d3/d6/iostubs_8c.html#a26">FillConsoleOutput</a>(hConsoleOutput,
01652                              wAttribute,
01653                              nLength,
01654                              <a class="code" href="../../d5/d5/conmsg_8h.html#a11">CONSOLE_ATTRIBUTE</a>,
01655                              dwWriteCoord,
01656                              lpNumberOfAttrsWritten
01657                             );
01658 }
01659 
01660 <span class="preprocessor">#endif </span>
01661 <span class="preprocessor"></span>
01662 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
01663 <span class="preprocessor"></span>
01664 HANDLE
01665 WINAPI
<a name="l01666"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a30">01666</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a30">CreateConsoleScreenBuffer</a>(
01667     IN DWORD dwDesiredAccess,
01668     IN DWORD dwShareMode,
01669     IN CONST SECURITY_ATTRIBUTES *lpSecurityAttributes,
01670     IN DWORD dwFlags,
01671     IN PVOID lpScreenBufferData OPTIONAL
01672     )
01673 {
01674     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
01675     <a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html">PCONSOLE_CREATESCREENBUFFER_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.CreateConsoleScreenBuffer;
01676     PCONSOLE_GRAPHICS_BUFFER_INFO GraphicsBufferInfo;
01677     PCSR_CAPTURE_HEADER CaptureBuffer=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01678 
01679     <span class="keywordflow">if</span> (dwDesiredAccess &amp; ~<a class="code" href="../../d6/d4/condll_8h.html#a4">VALID_ACCESSES</a> ||
01680         dwShareMode &amp; ~<a class="code" href="../../d6/d4/condll_8h.html#a5">VALID_SHARE_ACCESSES</a> ||
01681         (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> != <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a> &amp;&amp;
01682          <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> != <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>)) {
01683         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
01684         <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
01685     }
01686     a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
01687     a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o1">DesiredAccess</a> = dwDesiredAccess;
01688     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(lpSecurityAttributes)) {
01689         a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o2">InheritHandle</a> = lpSecurityAttributes-&gt;bInheritHandle;
01690     }
01691     <span class="keywordflow">else</span> {
01692         a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o2">InheritHandle</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01693     }
01694     a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o3">ShareMode</a> = dwShareMode;
01695     a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o4">Flags</a> = <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
01696     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> == <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>) {
01697         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o2">InheritHandle</a> || lpScreenBufferData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01698             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
01699             <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
01700         }
01701         GraphicsBufferInfo = lpScreenBufferData;
01702         <span class="keywordflow">try</span> {
01703             a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o5">GraphicsBufferInfo</a> = *GraphicsBufferInfo;
01704             CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
01705                                                       a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o5">GraphicsBufferInfo</a>.dwBitMapInfoLength
01706                                                     );
01707             <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01708                 <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
01709                 <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
01710             }
01711             <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
01712                                      (PCHAR) GraphicsBufferInfo-&gt;lpBitMapInfo,
01713                                      a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o5">GraphicsBufferInfo</a>.dwBitMapInfoLength,
01714                                      (PVOID *) &amp;a-&gt;<a class="code" href="../../d8/d9/struct__CONSOLE__CREATESCREENBUFFER__MSG.html#o5">GraphicsBufferInfo</a>.lpBitMapInfo
01715                                    );
01716 
01717         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01718             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
01719             <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
01720         }
01721     }
01722     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
01723                          CaptureBuffer,
01724                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
01725                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a203">ConsolepCreateScreenBuffer</a>
01726                                             ),
01727                          <span class="keyword">sizeof</span>( *a )
01728                        );
01729     <span class="keywordflow">if</span> (CaptureBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01730         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
01731     }
01732     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue)) {
01733         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
01734         <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
01735     }
01736     <span class="keywordflow">else</span> {
01737         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> == <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>) {
01738             <span class="keywordflow">try</span> {
01739                 GraphicsBufferInfo-&gt;hMutex = a-&gt;hMutex;
01740                 GraphicsBufferInfo-&gt;lpBitMap = a-&gt;lpBitmap;
01741             } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01742                 <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
01743                 <span class="keywordflow">return</span> (HANDLE) <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>;
01744             }
01745         }
01746         <span class="keywordflow">return</span> a-&gt;Handle;
01747     }
01748 }
01749 
01750 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01751 WINAPI
<a name="l01752"></a><a class="code" href="../../d3/d6/iostubs_8c.html#a31">01752</a> <a class="code" href="../../d3/d6/iostubs_8c.html#a31">InvalidateConsoleDIBits</a>(
01753     IN HANDLE hConsoleOutput,
01754     IN PSMALL_RECT lpRect
01755     )
01756 
01757 <span class="comment">/*++</span>
01758 <span class="comment"></span>
01759 <span class="comment">Parameters:</span>
01760 <span class="comment"></span>
01761 <span class="comment">    hConsoleHandle - Supplies a console input or output handle.</span>
01762 <span class="comment"></span>
01763 <span class="comment">    lpRect - the region that needs to be updated to the screen.</span>
01764 <span class="comment"></span>
01765 <span class="comment">Return Value:</span>
01766 <span class="comment"></span>
01767 <span class="comment">    TRUE - The operation was successful.</span>
01768 <span class="comment"></span>
01769 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
01770 <span class="comment">        using GetLastError.</span>
01771 <span class="comment"></span>
01772 <span class="comment"></span>
01773 <span class="comment">--*/</span>
01774 
01775 {
01776     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
01777     <a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html">PCONSOLE_INVALIDATERECT_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.InvalidateConsoleBitmapRect;
01778 
01779     a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
01780     a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o1">OutputHandle</a> = hConsoleOutput;
01781     <span class="keywordflow">try</span> {
01782         a-&gt;<a class="code" href="../../d2/d3/struct__CONSOLE__INVALIDATERECT__MSG.html#o2">Rect</a> = *lpRect;
01783     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01784         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
01785         <span class="keywordflow">return</span> ERROR_INVALID_ACCESS;
01786     }
01787     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
01788                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01789                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
01790                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a204">ConsolepInvalidateBitmapRect</a>
01791                                             ),
01792                          <span class="keyword">sizeof</span>( *a )
01793                        );
01794     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
01795         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01796     } <span class="keywordflow">else</span> {
01797         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a> (m.ReturnValue);
01798         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01799     }
01800 }
01801 
01802 <span class="preprocessor">#endif </span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:30 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
