<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: getsetc.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>getsetc.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d5/d4/getsetc_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>WORD&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/getsetc_8c.html#a0">_GetWindowWord</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, int index)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/getsetc_8c.html#a1">GetWindowData</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, int index, BOOL bAnsi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/getsetc_8c.html#a2">_GetWindowLongPtr</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, int index, BOOL bAnsi)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="getsetc.c::_GetWindowLongPtr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR _GetWindowLongPtr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/getsetc_8c-source.html#l00102">102</a> of file <a class="el" href="../../d5/d4/getsetc_8c-source.html">getsetc.c</a>.
<p>
References <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00842">CBFNID</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01856">tagWND::cbwndExtra</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01561">CPD_ANSI_TO_UNICODE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01567">CPD_DIALOG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01562">CPD_UNICODE_TO_ANSI</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02824">DLGF_ANSI</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00797">FNID_EDIT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00799">FNID_MDICLIENT</a>, <a class="el" href="../../d1/d4/ntuser_2kernel_2getset_8c-source.html#l00875">GetCPD()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, <a class="el" href="../../d5/d4/getsetc_8c-source.html#l00343">GetWindowData()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02819">PDLG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l01178">TestWindowProcess()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02282">WFDIALOGWINDOW</a>.
<p>
<pre class="fragment"><div>00106 {
00107     ULONG_PTR           dwProc;
00108     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>              dwCPDType = 0;
00109     ULONG_PTR UNALIGNED *pudw;
00110 
00111     <span class="comment">/*</span>
00112 <span class="comment">     * If it's a dialog window, only a few indices are permitted.</span>
00113 <span class="comment">     */</span>
00114     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) != 0) {
00115         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFDIALOGWINDOW)) {
00116             <span class="keywordflow">switch</span> (index) {
00117             <span class="keywordflow">case</span> DWLP_DLGPROC:    <span class="comment">// See similar case GWLP_WNDGPROC</span>
00118 
00119                 <span class="comment">/*</span>
00120 <span class="comment">                 * Hide the window proc from other processes</span>
00121 <span class="comment">                 */</span>
00122                 <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a16">TestWindowProcess</a>(pwnd)) {
00123                     RIPERR1(ERROR_ACCESS_DENIED,
00124                             RIP_WARNING,
00125                             <span class="stringliteral">"Access denied to \"pwnd\" (%#p) in _GetWindowLong"</span>,
00126                             pwnd);
00127 
00128                     <span class="keywordflow">return</span> 0;
00129                 }
00130 
00131                 dwProc = (ULONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;lpfnDlg;
00132 
00133                 <span class="comment">/*</span>
00134 <span class="comment">                 * If a proc exists check it to see if we need a translation</span>
00135 <span class="comment">                 */</span>
00136                 <span class="keywordflow">if</span> (dwProc) {
00137 
00138                     <span class="comment">/*</span>
00139 <span class="comment">                     * May need to return a CallProc handle if there is an</span>
00140 <span class="comment">                     * Ansi/Unicode transition</span>
00141 <span class="comment">                     */</span>
00142                     <span class="keywordflow">if</span> (bAnsi != ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a794">DLGF_ANSI</a>) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00143                         dwCPDType |= bAnsi ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a459">CPD_ANSI_TO_UNICODE</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a460">CPD_UNICODE_TO_ANSI</a>;
00144                     }
00145 
00146                     <span class="keywordflow">if</span> (dwCPDType) {
00147                         ULONG_PTR cpd;
00148 
00149                         cpd = <a class="code" href="../../d0/d5/ntuser_2kernel_2getset_8c.html#a7">GetCPD</a>(pwnd, dwCPDType | CPD_DIALOG, dwProc);
00150 
00151                         <span class="keywordflow">if</span> (cpd) {
00152                             dwProc = cpd;
00153                         } <span class="keywordflow">else</span> {
00154                             RIPMSG0(RIP_WARNING, <span class="stringliteral">"GetWindowLong unable to alloc CPD returning handle\n"</span>);
00155                         }
00156                     }
00157                 }
00158 
00159                 <span class="comment">/*</span>
00160 <span class="comment">                 * return proc (or CPD handle)</span>
00161 <span class="comment">                 */</span>
00162                 <span class="keywordflow">return</span> dwProc;
00163 
00164             <span class="keywordflow">case</span> DWLP_MSGRESULT:
00165                  <span class="keywordflow">return</span> (ULONG_PTR)((<a class="code" href="../../d4/d5/struct__DIALOG.html">PDIALOG</a>)pwnd)-&gt;resultWP;
00166 
00167             <span class="keywordflow">case</span> DWLP_USER:
00168                  <span class="keywordflow">return</span> (ULONG_PTR)((<a class="code" href="../../d4/d5/struct__DIALOG.html">PDIALOG</a>)pwnd)-&gt;unused;
00169 
00170             <span class="keywordflow">default</span>:
00171                 <span class="keywordflow">if</span> (index &gt;= 0 &amp;&amp; index &lt; DLGWINDOWEXTRA) {
00172                     RIPERR0(ERROR_PRIVATE_DIALOG_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00173                     <span class="keywordflow">return</span> 0;
00174                 }
00175             }
00176         } <span class="keywordflow">else</span> {
00177             <span class="keywordflow">if</span> (index &gt;= 0 &amp;&amp;
00178                     (index &lt; (<span class="keywordtype">int</span>)(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a231">CBFNID</a>(pwnd-&gt;fnid)-<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>)))) {
00179                 <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd)) {
00180                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a206">FNID_MDICLIENT</a>:
00181                     <span class="comment">/*</span>
00182 <span class="comment">                     * Allow the 0 index (which is reserved) to be set/get.</span>
00183 <span class="comment">                     * Quattro Pro 1.0 uses this index!</span>
00184 <span class="comment">                     */</span>
00185                     <span class="keywordflow">if</span> (index != 0)
00186                         <span class="keywordflow">break</span>;
00187 
00188                     <span class="keywordflow">goto</span> GetData;
00189                     <span class="keywordflow">break</span>;
00190 
00191                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a204">FNID_EDIT</a>:
00192 
00193                     <span class="keywordflow">if</span> (index != 0)
00194                         <span class="keywordflow">break</span>;
00195 
00196                     <span class="comment">/*</span>
00197 <span class="comment">                     * If we get to this point we need to return the first</span>
00198 <span class="comment">                     * entry in the lookaside.  This will provide backward</span>
00199 <span class="comment">                     * compatibilty for 3.51 that allowed edit-controls to</span>
00200 <span class="comment">                     * do this.  PeachTree is one app which required this.</span>
00201 <span class="comment">                     */</span>
00202                     pudw = (ULONG_PTR UNALIGNED *)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *)(pwnd + 1));
00203 
00204                     <span class="comment">/*</span>
00205 <span class="comment">                     * Do not dereference the pointer if we are not in</span>
00206 <span class="comment">                     *  the proper address space. Apps like Spyxx like to</span>
00207 <span class="comment">                     *  do this on other process' windows</span>
00208 <span class="comment">                     */</span>
00209                     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a16">TestWindowProcess</a>(pwnd) ? *(ULONG_PTR UNALIGNED *)*pudw : (ULONG_PTR)pudw);
00210 
00211                 }
00212 
00213                 RIPERR3(ERROR_INVALID_INDEX,
00214                         RIP_WARNING,
00215                         <span class="stringliteral">"GetWindowLong: Trying to read private server data pwnd=(%#p) index=(%ld) fnid (%lX)"</span>,
00216                         pwnd, index, (DWORD)pwnd-&gt;fnid);
00217                 <span class="keywordflow">return</span> 0;
00218             }
00219         }
00220     }
00221 
00222     <span class="keywordflow">if</span> (index &lt; 0) {
00223         <span class="keywordflow">return</span> <a class="code" href="../../d4/d5/getsetc_8c.html#a1">GetWindowData</a>(pwnd, index, bAnsi);
00224     } <span class="keywordflow">else</span> {
00225         <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)index + <span class="keyword">sizeof</span>(ULONG_PTR) &gt; (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o10">cbwndExtra</a>) {
00226             RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00227             <span class="keywordflow">return</span> 0;
00228         } <span class="keywordflow">else</span> {
00229 
00230 GetData:
00231             pudw = (ULONG_PTR UNALIGNED *)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *)(pwnd + 1) + index);
00232             <span class="keywordflow">return</span> *pudw;
00233         }
00234     }
00235 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="getsetc.c::_GetWindowWord" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WORD _GetWindowWord           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>index</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/getsetc_8c-source.html#l00026">26</a> of file <a class="el" href="../../d5/d4/getsetc_8c-source.html">getsetc.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03187">tagBUTN::buttonState</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00842">CBFNID</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01856">tagWND::cbwndExtra</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01767">tagWND::dwUserData</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00793">FNID_BUTTON</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00796">FNID_DIALOG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00799">FNID_MDICLIENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00028">GetWindowWord()</a>.
<p>
<pre class="fragment"><div>00029 {
00030     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) != 0) {
00031         <span class="keywordflow">if</span> ((index &gt;= 0) &amp;&amp; (index &lt;
00032                 (<span class="keywordtype">int</span>)(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a231">CBFNID</a>(pwnd-&gt;fnid)-<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d9/structtagWND.html">WND</a>)))) {
00033 
00034             <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd)) {
00035             <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a206">FNID_MDICLIENT</a>:
00036                 <span class="keywordflow">if</span> (index == 0)
00037                     <span class="keywordflow">break</span>;
00038                 <span class="keywordflow">goto</span> DoDefault;
00039 
00040             <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a>:
00041                 <span class="comment">/*</span>
00042 <span class="comment">                 * CorelDraw does a get/set on the first button window word.</span>
00043 <span class="comment">                 * Allow it to.</span>
00044 <span class="comment">                 */</span>
00045                 <span class="keywordflow">if</span> (index == 0) {
00046                     <span class="comment">/*</span>
00047 <span class="comment">                     *  Since we now use a lookaside buffer for the control's</span>
00048 <span class="comment">                     *  private data, we need to indirect into this structure.</span>
00049 <span class="comment">                     */</span>
00050                     <a class="code" href="../../d2/d9/structtagBUTN.html">PBUTN</a> pbutn = ((<a class="code" href="../../d3/d9/structtagBUTNWND.html">PBUTNWND</a>)pwnd)-&gt;pbutn;
00051                     <span class="keywordflow">if</span> (!pbutn || (LONG_PTR)pbutn == (LONG_PTR)-1) {
00052                         <span class="keywordflow">return</span> 0;
00053                     } <span class="keywordflow">else</span> {
00054                         <span class="keywordflow">return</span> (WORD)(pbutn-&gt;<a class="code" href="../../d2/d9/structtagBUTN.html#o1">buttonState</a>);
00055                     }
00056                 }
00057                 <span class="keywordflow">goto</span> DoDefault;
00058 
00059             <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a203">FNID_DIALOG</a>:
00060                 <span class="keywordflow">if</span> (index == DWLP_USER)
00061                     <span class="keywordflow">return</span> LOWORD(((<a class="code" href="../../d4/d5/struct__DIALOG.html">PDIALOG</a>)pwnd)-&gt;unused);
00062                 <span class="keywordflow">if</span> (index == DWLP_USER+2)
00063                     <span class="keywordflow">return</span> HIWORD(((<a class="code" href="../../d4/d5/struct__DIALOG.html">PDIALOG</a>)pwnd)-&gt;unused);
00064                 <span class="keywordflow">goto</span> DoDefault;
00065 
00066             <span class="keywordflow">default</span>:
00067 DoDefault:
00068                 RIPERR3(ERROR_INVALID_INDEX,
00069                         RIP_WARNING,
00070                         <span class="stringliteral">"GetWindowWord: Trying to read private server data pwnd=(%#p) index=(%ld) fnid=(%lX)"</span>,
00071                         pwnd, index, (DWORD)pwnd-&gt;fnid);
00072                 <span class="keywordflow">return</span> 0;
00073                 <span class="keywordflow">break</span>;
00074             }
00075         }
00076     }
00077 
00078     <span class="keywordflow">if</span> (index == GWLP_USERDATA)
00079         <span class="keywordflow">return</span> (WORD)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o18">dwUserData</a>;
00080 
00081     <span class="keywordflow">if</span> ((index &lt; 0) || ((UINT)index + sizeof(WORD) &gt; (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o10">cbwndExtra</a>)) {
00082         RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00083         <span class="keywordflow">return</span> 0;
00084     } <span class="keywordflow">else</span> {
00085         <span class="keywordflow">return</span> *((WORD UNALIGNED *)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *)(pwnd + 1) + index));
00086     }
00087 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="getsetc.c::GetWindowData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR GetWindowData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>bAnsi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/getsetc_8c-source.html#l00343">343</a> of file <a class="el" href="../../d5/d4/getsetc_8c-source.html">getsetc.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01561">CPD_ANSI_TO_UNICODE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01562">CPD_UNICODE_TO_ANSI</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01566">CPD_WND</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01767">tagWND::dwUserData</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00787">FNID_DESKTOP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00797">FNID_EDIT</a>, <a class="el" href="../../d1/d4/ntuser_2kernel_2getset_8c-source.html#l00875">GetCPD()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01514">HW</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01841">tagWND::lpfnWndProc</a>, <a class="el" href="../../d3/d4/ntuser_2rtl_2getset_8c-source.html#l00049">MapClientNeuterToClientPfn()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00976">MapKernelClientFnToClientFn</a>, <a class="el" href="../../d3/d4/ntuser_2rtl_2getset_8c-source.html#l00022">MapServerToClientPfn()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01512">PtoH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00210">REBASEALWAYS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00215">REBASEPWND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01764">tagWND::spmenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01745">tagWND::spwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l01178">TestWindowProcess()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02286">WFANSIPROC</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02285">WFSERVERSIDEPROC</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/getsetc_8c-source.html#l00102">_GetWindowLongPtr()</a>.
<p>
<pre class="fragment"><div>00347 {
00348     KERNEL_ULONG_PTR dwProc;
00349     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCPDType = 0;
00350     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
00351 
00352     <span class="keywordflow">switch</span> (index) {
00353     <span class="keywordflow">case</span> GWLP_USERDATA:
00354         <span class="keywordflow">return</span> KERNEL_ULONG_PTR_TO_ULONG_PTR(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o18">dwUserData</a>);
00355 
00356     <span class="keywordflow">case</span> GWL_EXSTYLE:
00357         <span class="comment">/*</span>
00358 <span class="comment">         * Apps should not mess with unused bits.  We use them privately</span>
00359 <span class="comment">         */</span>
00360         <span class="keywordflow">return</span> pwnd-&gt;ExStyle &amp; WS_EX_ALLVALID;
00361 
00362     <span class="keywordflow">case</span> GWL_STYLE:
00363         <span class="keywordflow">return</span> pwnd-&gt;style;
00364 
00365     <span class="keywordflow">case</span> GWLP_ID:
00366         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
00367             <span class="keywordflow">return</span> (ULONG_PTR)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>;
00368         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00369             <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu;
00370 
00371             pmenu = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, spmenu);
00372             <span class="keywordflow">return</span> (ULONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pmenu);
00373         }
00374         <span class="keywordflow">return</span> 0;
00375 
00376     <span class="keywordflow">case</span> GWLP_HINSTANCE:
00377         <span class="keywordflow">return</span> (ULONG_PTR)pwnd-&gt;hModule;
00378 
00379     <span class="keywordflow">case</span> GWLP_WNDPROC: <span class="comment">// See similar case DWLP_DLGPROC</span>
00380         <span class="comment">/*</span>
00381 <span class="comment">         * Hide the window proc from other processes</span>
00382 <span class="comment">         */</span>
00383         <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a16">TestWindowProcess</a>(pwnd)) {
00384             RIPERR1(ERROR_ACCESS_DENIED, RIP_WARNING, <span class="stringliteral">"Can not subclass another process's window %#p"</span>, pwnd);
00385             <span class="keywordflow">return</span> 0;
00386         }
00387 
00388         <span class="comment">/*</span>
00389 <span class="comment">         * If the client queries a server-side winproc we return the</span>
00390 <span class="comment">         * address of the client-side winproc (expecting ANSI or Unicode</span>
00391 <span class="comment">         * depending on bAnsi)</span>
00392 <span class="comment">         */</span>
00393         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSERVERSIDEPROC)) {
00394             dwProc = <a class="code" href="../../d2/d5/ntuser_2rtl_2getset_8c.html#a0">MapServerToClientPfn</a>((KERNEL_ULONG_PTR)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>, bAnsi);
00395             <span class="keywordflow">if</span> (dwProc == 0)
00396                 RIPMSG1(RIP_WARNING, <span class="stringliteral">"GetWindowLong: GWL_WNDPROC: Kernel-side wndproc can't be mapped for pwnd=%#p"</span>, pwnd);
00397         } <span class="keywordflow">else</span> {
00398 
00399             <span class="comment">/*</span>
00400 <span class="comment">             * Keep edit control behavior compatible with NT 3.51.</span>
00401 <span class="comment">             */</span>
00402             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a204">FNID_EDIT</a>) {
00403                 dwProc = (ULONG_PTR)<a class="code" href="../../d1/d0/inc_2user_8h.html#a237">MapKernelClientFnToClientFn</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>);
00404                 <span class="keywordflow">goto</span> CheckAnsiUnicodeMismatch;
00405             } <span class="keywordflow">else</span> {
00406                 <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, pcls);
00407                 dwProc = <a class="code" href="../../d2/d5/ntuser_2rtl_2getset_8c.html#a1">MapClientNeuterToClientPfn</a>(pcls, (KERNEL_ULONG_PTR)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>, bAnsi);
00408             }
00409 
00410             <span class="comment">/*</span>
00411 <span class="comment">             * If the client mapping didn't change the window proc then see if</span>
00412 <span class="comment">             * we need a callproc handle.</span>
00413 <span class="comment">             */</span>
00414             <span class="keywordflow">if</span> (dwProc == (KERNEL_ULONG_PTR)pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>) {
00415 CheckAnsiUnicodeMismatch:
00416                 <span class="comment">/*</span>
00417 <span class="comment">                 * Need to return a CallProc handle if there is an Ansi/Unicode mismatch</span>
00418 <span class="comment">                 */</span>
00419                 <span class="keywordflow">if</span> (bAnsi != (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFANSIPROC) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00420                     dwCPDType |= bAnsi ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a459">CPD_ANSI_TO_UNICODE</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a460">CPD_UNICODE_TO_ANSI</a>;
00421                 }
00422             }
00423 
00424             <span class="keywordflow">if</span> (dwCPDType) {
00425                 ULONG_PTR cpd;
00426 
00427                 cpd = <a class="code" href="../../d0/d5/ntuser_2kernel_2getset_8c.html#a7">GetCPD</a>(pwnd, dwCPDType | CPD_WND, KERNEL_ULONG_PTR_TO_ULONG_PTR(dwProc));
00428 
00429                 <span class="keywordflow">if</span> (cpd) {
00430                     dwProc = cpd;
00431                 } <span class="keywordflow">else</span> {
00432                     RIPMSG0(RIP_WARNING, <span class="stringliteral">"GetWindowLong unable to alloc CPD returning handle\n"</span>);
00433                 }
00434             }
00435         }
00436 
00437         <span class="comment">/*</span>
00438 <span class="comment">         * return proc (or CPD handle)</span>
00439 <span class="comment">         */</span>
00440         <span class="keywordflow">return</span> KERNEL_ULONG_PTR_TO_ULONG_PTR(dwProc);
00441 
00442     <span class="keywordflow">case</span> GWLP_HWNDPARENT:
00443 
00444         <span class="comment">/*</span>
00445 <span class="comment">         * If the window is the desktop window, return</span>
00446 <span class="comment">         * NULL to keep it compatible with Win31 and</span>
00447 <span class="comment">         * to prevent any access to the desktop owner</span>
00448 <span class="comment">         * window.</span>
00449 <span class="comment">         */</span>
00450         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
00451             <span class="keywordflow">return</span> 0;
00452         }
00453 
00454         <span class="comment">/*</span>
00455 <span class="comment">         * Special case for pre-1.1 versions of Windows</span>
00456 <span class="comment">         * Set/GetWindowWord(GWL_HWNDPARENT) needs to be mapped</span>
00457 <span class="comment">         * to the hwndOwner for top level windows.</span>
00458 <span class="comment">         *</span>
00459 <span class="comment">         * Note that we find the desktop window through the</span>
00460 <span class="comment">         * pti because the PWNDDESKTOP macro only works in</span>
00461 <span class="comment">         * the server.</span>
00462 <span class="comment">         */</span>
00463 
00464         <span class="comment">/*</span>
00465 <span class="comment">         * Remove this test when we later add a test for WFDESTROYED</span>
00466 <span class="comment">         * in Client handle validation.</span>
00467 <span class="comment">         */</span>
00468         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00469             <span class="keywordflow">return</span> 0;
00470         }
00471         pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, spwndParent);
00472         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndParent) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
00473             pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndOwner);
00474             <span class="keywordflow">return</span> (ULONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd);
00475         }
00476 
00477         <span class="keywordflow">return</span> (ULONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndParent);
00478 
00479     <span class="comment">/*</span>
00480 <span class="comment">     * WOW uses a pointer straight into the window structure.</span>
00481 <span class="comment">     */</span>
00482     <span class="keywordflow">case</span> GWLP_WOWWORDS:
00483         <span class="keywordflow">return</span> (ULONG_PTR) &amp;pwnd-&gt;state;
00484 
00485     }
00486 
00487     RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00488     <span class="keywordflow">return</span> 0;
00489 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:54 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
