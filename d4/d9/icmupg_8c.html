<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: icmupg.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>icmupg.c File Reference</h1><code>#include "<a class="el" href="../../d7/d8/icmupg_8h-source.html">icmupg.h</a>"</code><br>
<code>#include "msg.h"</code><br>
<code>#include &lt;setupapi.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>

<p>
<a href="../../d5/d8/icmupg_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d0/structtagMANUMODELIDS.html">tagMANUMODELIDS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/structtagREGDATA.html">tagREGDATA</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d2/structVENDORINFO.html">VENDORINFO</a></td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d0/structtagMANUMODELIDS.html">tagMANUMODELIDS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a0">MANUMODELIDS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d0/structtagMANUMODELIDS.html">tagMANUMODELIDS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a1">PMANUMODELIDS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d5/structtagREGDATA.html">tagREGDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a2">REGDATA</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d5/structtagREGDATA.html">tagREGDATA</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a3">PREGDATA</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOL(WINAPI *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a4">PFNINSTALLCOLORPROFILEA</a> )(PSTR, PSTR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOL(WINAPI *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a5">PFNINSTALLCOLORPROFILE</a> )(LPCTSTR, LPCTSTR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOL(WINAPI *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a6">PFNENUMCOLORPROFILES</a> )(PCTSTR, PENUMTYPE, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>, PDWORD, PDWORD)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a7">PVENDORINFO</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a25">InternalUpgradeICM</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a26">UpgradeClass</a> (HKEY)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a27">AssociateMonitorProfile</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a28">AssociatePrinterProfiles</a> (HKEY)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a29">InstallProfiles</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a30">DeleteOldICMKey</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a31">GetManuAndModelIDs</a> (PTSTR, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a32">lstrcmpn</a> (PTSTR, PTSTR, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a33">DllEntryPoint</a> (HINSTANCE hinstDll, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwReason, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a34">QueryVersion</a> (OUT LPCSTR *pszProductID, OUT LPUINT puDllVersion, OUT LPINT *pCodePageArray, OPTIONAL OUT LPCSTR *ppszExeNamesBuf, OPTIONAL OUT <a class="el" href="../../d4/d9/icmupg_8c.html#a7">PVENDORINFO</a> *ppVendorInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a35">Initialize9x</a> (IN LPCSTR pszWorkingDir, IN LPCSTR pszSourceDir, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pvReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a36">MigrateUser9x</a> (IN HWND hwndParent, IN LPCSTR pszUnattendFile, IN HKEY hUserRegKey, IN LPCSTR pszUserName, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pvReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a37">MigrateSystem9x</a> (IN HWND hwndParent, IN LPCSTR pszUnattendFile, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pvReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a38">InitializeNT</a> (IN LPCWSTR pszWorkingDir, IN LPCWSTR pszSourceDir, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pvReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a39">MigrateUserNT</a> (IN HANDLE hUnattendInf, IN HKEY hUserRegKey, IN LPCWSTR pszUserName, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pvReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a40">MigrateSystemNT</a> (IN HANDLE hUnattendInf, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pvReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a41">MyMoveDir</a> (char *s, char *d)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>TCHAR const&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a8">gszICMRegPath</a> [] = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ICM"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>TCHAR const&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a9">gszProfile</a> [] = "profile"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>TCHAR const&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a10">gszMSCMSdll</a> [] = "mscms.dll"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>char const&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a11">gszProductID</a> [] = "Microsoft Color Management System"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>char const&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a12">gszInstallColorProfile</a> [] = "InstallColorProfileA"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>char const&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a13">gszGetColorDirectory</a> [] = "GetColorDirectoryA"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>char const&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a14">gszEnumColorProfiles</a> [] = "EnumColorProfilesA"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structVENDORINFO.html">VENDORINFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>char&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a16">gszMigInf</a> [MAX_PATH]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>char const&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a17">gszFullICMRegPath</a> [] = "\"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ICM\""</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>char const&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a18">gszInstallColorProfileA</a> [] = "InstallColorProfileA"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>TCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a19">szValue</a> [MAX_PATH]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>TCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a20">szName</a> [MAX_PATH]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/icmupg_8c.html#a4">PFNINSTALLCOLORPROFILEA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a21">pInstallColorProfileA</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/icmupg_8c.html#a5">PFNINSTALLCOLORPROFILE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a22">pInstallColorProfile</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/icmupg_8c.html#a6">PFNENUMCOLORPROFILES</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a23">pEnumColorProfiles</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HINSTANCE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d9/icmupg_8c.html#a24">hinstMigDll</a></td></tr>

</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a0" doxytag="icmupg.c::MANUMODELIDS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d0/structtagMANUMODELIDS.html">tagMANUMODELIDS</a>  <a class="el" href="../../d5/d0/structtagMANUMODELIDS.html">MANUMODELIDS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="icmupg.c::PFNENUMCOLORPROFILES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOL(WINAPI * <a class="el" href="../../d4/d9/icmupg_8c.html#a6">PFNENUMCOLORPROFILES</a>)(PCTSTR, PENUMTYPE, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>, PDWORD, PDWORD)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00051">51</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00296">MigrateSystem9x()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="icmupg.c::PFNINSTALLCOLORPROFILE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOL(WINAPI * <a class="el" href="../../d4/d9/icmupg_8c.html#a5">PFNINSTALLCOLORPROFILE</a>)(LPCTSTR, LPCTSTR)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00050">50</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">MigrateSystemNT()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="icmupg.c::PFNINSTALLCOLORPROFILEA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOL(WINAPI * <a class="el" href="../../d4/d9/icmupg_8c.html#a4">PFNINSTALLCOLORPROFILEA</a>)(PSTR, PSTR)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00049">49</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">MigrateSystemNT()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="icmupg.c::PMANUMODELIDS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d0/structtagMANUMODELIDS.html">tagMANUMODELIDS</a> * <a class="el" href="../../d5/d0/structtagMANUMODELIDS.html">PMANUMODELIDS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="icmupg.c::PREGDATA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d5/structtagREGDATA.html">tagREGDATA</a> * <a class="el" href="../../d2/d5/structtagREGDATA.html">PREGDATA</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="icmupg.c::PVENDORINFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef   * <a class="el" href="../../d4/d9/icmupg_8c.html#a7">PVENDORINFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="icmupg.c::REGDATA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d5/structtagREGDATA.html">tagREGDATA</a>  <a class="el" href="../../d2/d5/structtagREGDATA.html">REGDATA</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a27" doxytag="icmupg.c::AssociateMonitorProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL AssociateMonitorProfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="icmupg.c::AssociatePrinterProfiles" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL AssociatePrinterProfiles           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKEY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="icmupg.c::DeleteOldICMKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DeleteOldICMKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00600">600</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00065">gszICMRegPath</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">MigrateSystemNT()</a>.
<p>
<pre class="fragment"><div>00601 {
00602     HKEY      hkICM = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;         <span class="comment">// key to ICM branch in registry</span>
00603     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nSubkeys, i;
00604     TCHAR szKeyName[32];
00605 
00606     <span class="comment">//</span>
00607     <span class="comment">// Open the registry path where profiles used to be kept</span>
00608     <span class="comment">//</span>
00609 
00610     <span class="keywordflow">if</span> (RegCreateKeyEx(HKEY_LOCAL_MACHINE, gszICMRegPath, 0, NULL, 
00611                        REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS,
00612                        NULL, &amp;hkICM, NULL) != ERROR_SUCCESS)
00613     {
00614         
00615         SetupLogError(<span class="stringliteral">"ICM Migration: Cannot open ICM branch of registry\r\n"</span>, LogSevError);
00616         <span class="keywordflow">return</span>;
00617     }
00618 
00619     <span class="keywordflow">if</span> (RegQueryInfoKey(hkICM, NULL, NULL, 0, &amp;nSubkeys, NULL, NULL,
00620         NULL, NULL, NULL, NULL, NULL) != ERROR_SUCCESS)
00621     {
00622         SetupLogError(<span class="stringliteral">"ICM Migration: Cannot enumerate ICM branch of registry\r\n"</span>, LogSevError);
00623         <span class="keywordflow">goto</span> EndDeleteOldICMKey;
00624     }
00625 
00626     <span class="comment">//</span>
00627     <span class="comment">// Go through all the device classes and delete all subkeys - this should</span>
00628     <span class="comment">// only be one level deep</span>
00629     <span class="comment">//</span>
00630 
00631     <span class="keywordflow">for</span> (i=nSubkeys; i&gt;0; i--)
00632     {
00633         RegEnumKey(hkICM, i-1, szKeyName, <span class="keyword">sizeof</span>(szKeyName));
00634         RegDeleteKey(hkICM, szKeyName);
00635     }
00636 
00637 EndDeleteOldICMKey:
00638     <span class="keywordflow">if</span> (hkICM)
00639     {
00640         RegCloseKey(hkICM);
00641     }
00642     RegDeleteKey(HKEY_LOCAL_MACHINE, gszICMRegPath);
00643 
00644     <span class="keywordflow">return</span>;
00645 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="icmupg.c::DllEntryPoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI DllEntryPoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HINSTANCE&nbsp;</td>
          <td class="mdname" nowrap> <em>hinstDll</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwReason</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00110">110</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00106">hinstMigDll</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00110                                                                      {
00111   <span class="keywordflow">if</span>(dwReason==DLL_PROCESS_ATTACH) {
00112     <a class="code" href="../../d4/d9/icmupg_8c.html#a24">hinstMigDll</a> = hinstDll;
00113   }
00114   <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00115 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="icmupg.c::GetManuAndModelIDs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void GetManuAndModelIDs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PTSTR&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="icmupg.c::Initialize9x" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG CALLBACK Initialize9x           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LPCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszWorkingDir</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszSourceDir</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pvReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00215">215</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00075">gszMigInf</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00220 {
00221   <span class="comment">//</span>
00222   <span class="comment">// Lets figure out if we're on a Win98 or Win95 system</span>
00223   <span class="comment">// We don't migrate Win95 because Win95 doesn't have a </span>
00224   <span class="comment">// profile database to migrate.</span>
00225   <span class="comment">//</span>
00226 
00227 <span class="comment">/*  OSVERSIONINFO osVer;</span>
00228 <span class="comment"></span>
00229 <span class="comment">  osVer.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);</span>
00230 <span class="comment">  GetVersionEx(&amp;osVer);</span>
00231 <span class="comment">  gbWin98 = </span>
00232 <span class="comment">    (osVer.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS) &amp;&amp;</span>
00233 <span class="comment">    ( (osVer.dwMajorVersion &gt; 4) ||</span>
00234 <span class="comment">    ( (osVer.dwMajorVersion == 4) &amp;&amp; (osVer.dwMinorVersion &gt; 0) ) );</span>
00235 <span class="comment"> */</span>
00236   <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Initialize9x called\n"</span>)));
00237    
00238   lstrcpyA(gszMigInf, pszWorkingDir);
00239   lstrcatA(gszMigInf, <span class="stringliteral">"\\migrate.inf"</span>);
00240 
00241   <span class="keywordflow">return</span> ERROR_SUCCESS;
00242 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="icmupg.c::InitializeNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG CALLBACK InitializeNT           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszWorkingDir</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszSourceDir</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pvReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00470">470</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>.
<p>
<pre class="fragment"><div>00475 {
00476     SetupOpenLog(FALSE);
00477     SetupLogError(<span class="stringliteral">"ICM Migration: InitializeNT called\r\n"</span>, LogSevInformation);
00478     <span class="keywordflow">return</span> ERROR_SUCCESS;
00479 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="icmupg.c::InstallProfiles" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InstallProfiles           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00726">726</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00075">gszMigInf</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00212">INVALID_HANDLE_VALUE</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00665">MyMoveDir()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00089">pInstallColorProfileA</a>, and <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">MigrateSystemNT()</a>.
<p>
<pre class="fragment"><div>00727 {
00728     WIN32_FIND_DATAA wfd;
00729     PSTR             pNewColorDirEnd;
00730     HANDLE           hFindFile;
00731     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>             szOldColorDir[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00732     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>             szNewColorDir[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00733     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>             szReturnString[2];
00734     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>             szDefaultString[2];
00735     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>             szMessage[2*<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>+100];
00736 
00737     GetWindowsDirectoryA(szOldColorDir, MAX_PATH);
00738     <span class="keywordflow">if</span> (szOldColorDir[lstrlenA(szOldColorDir)-1] != <span class="charliteral">'\\'</span>)
00739         lstrcatA(szOldColorDir, <span class="stringliteral">"\\"</span>);
00740     lstrcatA(szOldColorDir, <span class="stringliteral">"system\\color\\"</span>);
00741 
00742 
00743     GetWindowsDirectoryA(szNewColorDir, MAX_PATH);
00744     <span class="keywordflow">if</span> (szNewColorDir[lstrlenA(szNewColorDir)-1] != <span class="charliteral">'\\'</span>)
00745     {
00746         lstrcatA(szNewColorDir, <span class="stringliteral">"\\"</span>);
00747     }
00748     lstrcatA(szNewColorDir, <span class="stringliteral">"system32\\spool\\drivers\\color\\"</span>);
00749 
00750     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pInstallColorProfileA != NULL);
00751 
00752 
00753     <span class="comment">//</span>
00754     <span class="comment">// Eat any errors on the MoveFile. This is just in case the migration </span>
00755     <span class="comment">// was stopped after a previous move and now the source doesn't exist.</span>
00756     <span class="comment">//</span>
00757 
00758     <a class="code" href="../../d4/d9/icmupg_8c.html#a41">MyMoveDir</a>(szOldColorDir, szNewColorDir);
00759 
00760     <span class="comment">//</span>
00761     <span class="comment">// Now we have presumably moved everything so run through the list of </span>
00762     <span class="comment">// previously installed profiles and install those in the new directory</span>
00763     <span class="comment">// (if we find them).</span>
00764     <span class="comment">//</span>
00765 
00766     pNewColorDirEnd = szNewColorDir + lstrlenA(szNewColorDir);
00767     lstrcatA(szNewColorDir, <span class="stringliteral">"*.*"</span>);
00768 
00769 
00770 
00771     szDefaultString[0]=<span class="charliteral">'0'</span>;
00772     szDefaultString[1]=0;
00773     hFindFile = FindFirstFileA(szNewColorDir, &amp;wfd);
00774 
00775 
00776     <span class="keywordflow">if</span> (hFindFile != <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>)
00777     {
00778         <span class="keywordflow">do</span>
00779         {
00780             lstrcpyA(pNewColorDirEnd, wfd.cFileName);
00781 
00782             <span class="comment">//</span>
00783             <span class="comment">// Check to see if the profile was installed on Win9x</span>
00784             <span class="comment">//</span>
00785 
00786             GetPrivateProfileStringA(<span class="stringliteral">"Installed ICM Profiles"</span>, wfd.cFileName, szDefaultString, szReturnString, 2, gszMigInf);
00787 
00788             <span class="comment">//</span>
00789             <span class="comment">// If it was installed, attempt to install it on NT</span>
00790             <span class="comment">//</span>
00791 
00792             <span class="keywordflow">if</span>(szReturnString[0]==<span class="charliteral">'1'</span>) { 
00793                 <span class="keywordflow">if</span> (!(*pInstallColorProfileA)(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, szNewColorDir))
00794                 {
00795                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(szMessage, <span class="stringliteral">"ICM Migration: Error %d installing profile %s\r\n"</span>, GetLastError(), szNewColorDir);
00796                     SetupLogError(szMessage, LogSevError);
00797                 }
00798                 <span class="keywordflow">else</span>
00799                 {
00800                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(szMessage, <span class="stringliteral">"ICM Migration: Installed profile %s\r\n"</span>, szNewColorDir);
00801                     SetupLogError(szMessage, LogSevInformation);
00802                 }
00803             }
00804 
00805         } <span class="keywordflow">while</span> (FindNextFileA(hFindFile, &amp;wfd));
00806 
00807         FindClose(hFindFile);
00808     }
00809     <span class="keywordflow">else</span>
00810     {
00811         SetupLogError(<span class="stringliteral">"ICM Migration: FindFirstFile returned an invalid handle\r\n"</span>, LogSevFatalError);
00812     }
00813 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="icmupg.c::InternalUpgradeICM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InternalUpgradeICM           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00833">833</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00065">gszICMRegPath</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>, and <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00916">UpgradeClass()</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">MigrateSystemNT()</a>.
<p>
<pre class="fragment"><div>00834 {
00835     HKEY      hkICM = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;         <span class="comment">// key to ICM branch in registry</span>
00836     HKEY      hkDevice = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;      <span class="comment">// key to ICM device branch in registry</span>
00837     <span class="keywordtype">int</span>       i;                    <span class="comment">// counter variable</span>
00838     TCHAR    *pszClasses[] = {      <span class="comment">// different profile classes</span>
00839         __TEXT(<span class="stringliteral">"mntr"</span>),
00840         __TEXT(<span class="stringliteral">"prtr"</span>),
00841         __TEXT(<span class="stringliteral">"scnr"</span>),
00842         __TEXT(<span class="stringliteral">"link"</span>),
00843         __TEXT(<span class="stringliteral">"abst"</span>),
00844         __TEXT(<span class="stringliteral">"spac"</span>),
00845         __TEXT(<span class="stringliteral">"nmcl"</span>)
00846     };
00847     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> szMessage[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00848     LONG errcode;
00849 
00850     <span class="comment">//</span>
00851     <span class="comment">// Open the registry path where profiles are kept</span>
00852     <span class="comment">//</span>
00853     
00854     <span class="keywordflow">if</span> (errcode = RegCreateKeyEx(HKEY_LOCAL_MACHINE, gszICMRegPath, 0, NULL, 
00855                                  REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS, NULL, 
00856                                  &amp;hkICM, NULL) != ERROR_SUCCESS)
00857     {
00858         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(szMessage, <span class="stringliteral">"ICM Migration: Fatal Error, cannot open registry entry (%s) code:%d\r\n"</span>, 
00859                 gszICMRegPath, errcode);
00860         SetupLogError(szMessage, LogSevFatalError);
00861         <span class="keywordflow">return</span>;
00862     }
00863 
00864     <span class="comment">//</span>
00865     <span class="comment">// Go through all the device classes and install the profiles</span>
00866     <span class="comment">//</span>
00867 
00868     <span class="keywordflow">for</span> (i=0; i&lt;<span class="keyword">sizeof</span>(pszClasses)/<span class="keyword">sizeof</span>(PTSTR); i++)
00869     {
00870         <span class="keywordflow">if</span> (RegOpenKeyEx(hkICM, pszClasses[i], 0, KEY_ALL_ACCESS, &amp;hkDevice) != ERROR_SUCCESS)
00871         {
00872             <span class="keywordflow">continue</span>;           <span class="comment">// go to next key</span>
00873         }
00874        
00875         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(szMessage, <span class="stringliteral">"ICM Migration: Upgrading %s\r\n"</span>, pszClasses[i]);
00876         SetupLogError(szMessage, LogSevInformation);
00877         <a class="code" href="../../d4/d9/icmupg_8c.html#a26">UpgradeClass</a>(hkDevice);
00878 
00879         RegCloseKey(hkDevice);
00880     }
00881 
00882     <span class="comment">//</span>
00883     <span class="comment">// Set default monitor profile</span>
00884     <span class="comment">//</span>
00885 
00886     <span class="comment">// AssociateMonitorProfile(); - Not needed for Memphis</span>
00887     <span class="comment">// If Pnp moves everything from Win9x PnP S/W section to NT 5.0 PnP S/W</span>
00888     <span class="comment">// section, then we don't need this for NT either</span>
00889 
00890     <span class="keywordflow">if</span> (hkICM)
00891     {
00892         RegCloseKey(hkICM);
00893     }
00894 
00895     <span class="keywordflow">return</span>;
00896 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="icmupg.c::lstrcmpn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int lstrcmpn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PTSTR&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTSTR&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l01048">1048</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00916">UpgradeClass()</a>.
<p>
<pre class="fragment"><div>01053 {
01054     <span class="comment">//</span>
01055     <span class="comment">// Assume no NULL strings</span>
01056     <span class="comment">//</span>
01057 
01058     <span class="keywordflow">while</span> (*pStr1 &amp;&amp; *pStr2 &amp;&amp; --dwLen)
01059     {
01060         <span class="keywordflow">if</span> (*pStr1 != *pStr2)
01061             <span class="keywordflow">break</span>;
01062 
01063         pStr1++;
01064         pStr2++;
01065     }
01066 
01067     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(*pStr1 - *pStr2);
01068 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="icmupg.c::MigrateSystem9x" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG CALLBACK MigrateSystem9x           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwndParent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszUnattendFile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pvReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00296">296</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00073">gszEnumColorProfiles</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00076">gszFullICMRegPath</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00075">gszMigInf</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00067">gszMSCMSdll</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00091">pEnumColorProfiles</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00051">PFNENUMCOLORPROFILES</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00301 {
00302     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>            nProfiles;
00303     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>            dwSize;
00304     <span class="keywordtype">char</span>             szColorDir[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00305     <span class="keywordtype">char</span>             szNewColorDir[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00306     <span class="keywordtype">char</span>             szDrive[2];
00307     HMODULE          hModule;
00308     ENUMTYPE         et = {<span class="keyword">sizeof</span> (ENUMTYPE), ENUM_TYPE_VERSION, 0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>};    
00309     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>            pBuffer;
00310     PSTR             pstrBuffer;
00311     PSTR             pstrTraversal;
00312 
00313     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"MigrateSystem9x called\n"</span>)));
00314     
00315     <span class="comment">//</span>
00316     <span class="comment">// Produce the Win9x Color Directory.</span>
00317     <span class="comment">//</span>
00318 
00319     GetWindowsDirectoryA(szColorDir, MAX_PATH);
00320     <span class="keywordflow">if</span> (szColorDir[lstrlenA(szColorDir)-1] != <span class="charliteral">'\\'</span>) 
00321     {
00322         lstrcatA(szColorDir,<span class="stringliteral">"\\"</span>);
00323     }
00324     lstrcatA(szColorDir, <span class="stringliteral">"system\\color\\"</span>);
00325     
00326     GetWindowsDirectoryA(szNewColorDir, MAX_PATH);
00327     <span class="keywordflow">if</span> (szNewColorDir[lstrlenA(szNewColorDir)-1] != <span class="charliteral">'\\'</span>) 
00328     {
00329         lstrcatA(szNewColorDir,<span class="stringliteral">"\\"</span>);
00330     }
00331     lstrcatA(szNewColorDir, <span class="stringliteral">"system32\\spool\\drivers\\color\\"</span>);
00332 
00333 
00334     <span class="comment">//</span>
00335     <span class="comment">// If this is a Win95 system we have nothing to do because</span>
00336     <span class="comment">// Win95 doesn't have a color profile database.</span>
00337     <span class="comment">//</span>
00338 
00339     
00340     <span class="comment">//</span>
00341     <span class="comment">// We can't have mscms as an implib because when they try to load us in</span>
00342     <span class="comment">// Win95, they won't find mscms.dll and reject us.</span>
00343     <span class="comment">//</span>
00344     
00345     hModule = LoadLibrary(gszMSCMSdll);
00346     <span class="keywordflow">if</span> (hModule) {
00347 <span class="preprocessor">      #ifdef ICM_MIG_DEBUG</span>
00348 <span class="preprocessor"></span>      WritePrivateProfileStringA(<span class="stringliteral">"ICM Debug"</span>, <span class="stringliteral">"hModule"</span>, <span class="stringliteral">"not NULL"</span>, gszMigInf);
00349       WritePrivateProfileStringA(<span class="stringliteral">"ICM Debug"</span>, <span class="stringliteral">"gbWin98"</span>, <span class="stringliteral">"TRUE"</span>, gszMigInf);
00350 <span class="preprocessor">      #endif</span>
00351 <span class="preprocessor"></span>
00352       <a class="code" href="../../d4/d9/icmupg_8c.html#a23">pEnumColorProfiles</a> = (<a class="code" href="../../d4/d9/icmupg_8c.html#a6">PFNENUMCOLORPROFILES</a>)GetProcAddress(hModule, gszEnumColorProfiles);
00353       <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/icmupg_8c.html#a23">pEnumColorProfiles</a>) {
00354         
00355 <span class="preprocessor">        #ifdef ICM_MIG_DEBUG</span>
00356 <span class="preprocessor"></span>        WritePrivateProfileStringA(<span class="stringliteral">"ICM Debug"</span>, <span class="stringliteral">"pEnumColorProfiles"</span>, <span class="stringliteral">"not NULL"</span>, gszMigInf);
00357 <span class="preprocessor">        #endif</span>
00358 <span class="preprocessor"></span>
00359         <span class="comment">//</span>
00360         <span class="comment">// Compute the size of the EnumColorProfiles buffer.</span>
00361         <span class="comment">//</span>
00362     
00363         dwSize = 0;
00364         <a class="code" href="../../d4/d9/icmupg_8c.html#a23">pEnumColorProfiles</a>(NULL, &amp;et, NULL, &amp;dwSize, &amp;nProfiles);
00365         
00366         <span class="keywordflow">if</span>(dwSize==0) 
00367         {
00368 <span class="preprocessor">          #ifdef ICM_MIG_DEBUG</span>
00369 <span class="preprocessor"></span>          WritePrivateProfileStringA(<span class="stringliteral">"ICM Debug"</span>, <span class="stringliteral">"dwSize"</span>, <span class="stringliteral">"0"</span>, gszMigInf);
00370 <span class="preprocessor">          #endif </span>
00371 <span class="preprocessor"></span>          <span class="comment">//</span>
00372           <span class="comment">// Need to exit - nothing to do if there are no profiles installed,</span>
00373           <span class="comment">// except to move the directory and registry settings.</span>
00374           <span class="comment">//</span>
00375           <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"No profiles installed\n"</span>)));
00376           <span class="keywordflow">goto</span> EndMigrateSystem9x;
00377         }
00378     
00379     
00380         <span class="comment">//</span>
00381         <span class="comment">// Enumerate all the currently installed color profiles.</span>
00382         <span class="comment">//</span>
00383 
00384 <span class="preprocessor">        #ifdef ICM_MIG_DEBUG</span>
00385 <span class="preprocessor"></span>        WritePrivateProfileStringA(<span class="stringliteral">"ICM Debug"</span>, <span class="stringliteral">"Enumerate"</span>, <span class="stringliteral">"Start"</span>, gszMigInf);
00386 <span class="preprocessor">        #endif </span>
00387 <span class="preprocessor"></span>
00388         pBuffer = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *)malloc(dwSize);
00389         pstrBuffer = (PSTR)pBuffer;
00390         
00391 <span class="preprocessor">        #ifdef ICM_MIG_DEBUG</span>
00392 <span class="preprocessor"></span>        WritePrivateProfileStringA(<span class="stringliteral">"ICM Debug"</span>, <span class="stringliteral">"Enumerate"</span>, <span class="stringliteral">"TRUE"</span>, gszMigInf);
00393 <span class="preprocessor">        #endif         </span>
00394 <span class="preprocessor"></span>        
00395         <span class="keywordflow">if</span>(<a class="code" href="../../d4/d9/icmupg_8c.html#a23">pEnumColorProfiles</a>(NULL, &amp;et, pBuffer, &amp;dwSize, &amp;nProfiles))
00396         {            
00397 <span class="preprocessor">            #ifdef ICM_MIG_DEBUG</span>
00398 <span class="preprocessor"></span>            WritePrivateProfileStringA(<span class="stringliteral">"ICM Debug"</span>, <span class="stringliteral">"Enumerate"</span>, <span class="stringliteral">"for"</span>, gszMigInf);
00399 <span class="preprocessor">            #endif </span>
00400 <span class="preprocessor"></span>
00401             <span class="keywordflow">for</span>(pstrTraversal = pstrBuffer;
00402                 nProfiles--;
00403                 pstrTraversal += 1 + lstrlenA(pstrTraversal)) {
00404 
00405                 <span class="comment">//</span>
00406                 <span class="comment">// Write the fact into the Migration Information file.</span>
00407                 <span class="comment">//</span>
00408                 
00409                 WritePrivateProfileStringA(<span class="stringliteral">"Installed ICM Profiles"</span>, pstrTraversal, <span class="stringliteral">"1"</span>, gszMigInf);
00410             }
00411         }
00412         free(pBuffer);
00413       } 
00414 <span class="preprocessor">      #ifdef ICM_MIG_DEBUG</span>
00415 <span class="preprocessor"></span>        <span class="keywordflow">else</span> {
00416         WritePrivateProfileStringA(<span class="stringliteral">"ICM Debug"</span>, <span class="stringliteral">"pEnumColorProfiles"</span>, <span class="stringliteral">"NULL"</span>, gszMigInf);
00417       }
00418 <span class="preprocessor">      #endif</span>
00419 <span class="preprocessor"></span>
00420   
00421       EndMigrateSystem9x:
00422       <span class="keywordflow">if</span> (hModule)
00423       {
00424           FreeLibrary(hModule);
00425       }
00426   }
00427 <span class="preprocessor">  #ifdef ICM_MIG_DEBUG</span>
00428 <span class="preprocessor"></span>    <span class="keywordflow">else</span> {
00429     WritePrivateProfileStringA(<span class="stringliteral">"ICM Debug"</span>, <span class="stringliteral">"hModule"</span>, <span class="stringliteral">"NULL"</span>, gszMigInf);    
00430     WritePrivateProfileStringA(<span class="stringliteral">"ICM Debug"</span>, <span class="stringliteral">"gbWin98"</span>, <span class="stringliteral">"FALSE"</span>, gszMigInf);
00431   }
00432 <span class="preprocessor">  #endif</span>
00433 <span class="preprocessor"></span>
00434   <span class="comment">//</span>
00435   <span class="comment">// We'll handle the ICM branch of the registry</span>
00436   <span class="comment">//</span>
00437 
00438   WritePrivateProfileStringA(<span class="stringliteral">"Handled"</span>, gszFullICMRegPath, <span class="stringliteral">"Registry"</span>, gszMigInf);
00439 
00440       
00441   <span class="comment">//</span>
00442   <span class="comment">// We'll be moving the entire subdirectory.</span>
00443   <span class="comment">//</span>
00444 
00445   WritePrivateProfileStringA(<span class="stringliteral">"Moved"</span>, szColorDir, szNewColorDir, gszMigInf);
00446 
00447 
00448   <span class="keywordflow">return</span>  ERROR_SUCCESS;
00449 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="icmupg.c::MigrateSystemNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG CALLBACK MigrateSystemNT           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hUnattendInf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pvReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">534</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00600">DeleteOldICMKey()</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00071">gszInstallColorProfile</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00078">gszInstallColorProfileA</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00067">gszMSCMSdll</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00726">InstallProfiles()</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00833">InternalUpgradeICM()</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00050">PFNINSTALLCOLORPROFILE</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00049">PFNINSTALLCOLORPROFILEA</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00090">pInstallColorProfile</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00089">pInstallColorProfileA</a>, and <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>.
<p>
<pre class="fragment"><div>00538 {
00539     HINSTANCE hModule;
00540     LONG      rc = ERROR_FILE_NOT_FOUND;
00541     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>      szMessage[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00542 
00543     SetupLogError(<span class="stringliteral">"ICM Migration: MigrateSystemNT called\r\n"</span>, LogSevInformation);
00544     
00545     <span class="comment">//</span>
00546     <span class="comment">// We can't have mscms as an implib because when they try to load us in</span>
00547     <span class="comment">// Win95, they won't find mscms.dll and reject us.</span>
00548     <span class="comment">//</span>
00549 
00550     hModule = LoadLibrary(gszMSCMSdll);
00551     <span class="keywordflow">if</span> (!hModule)
00552     {
00553         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(szMessage, <span class="stringliteral">"ICM Migration: Fatal Error, cannot load mscms.dll. Error %d\r\n"</span>, GetLastError());
00554         SetupLogError(szMessage, LogSevFatalError);
00555         <span class="keywordflow">return</span> rc;
00556     }
00557 
00558     <a class="code" href="../../d4/d9/icmupg_8c.html#a21">pInstallColorProfileA</a> = (<a class="code" href="../../d4/d9/icmupg_8c.html#a4">PFNINSTALLCOLORPROFILEA</a>)GetProcAddress(hModule, gszInstallColorProfileA);
00559     <a class="code" href="../../d4/d9/icmupg_8c.html#a22">pInstallColorProfile</a> = (<a class="code" href="../../d4/d9/icmupg_8c.html#a5">PFNINSTALLCOLORPROFILE</a>)GetProcAddress(hModule, gszInstallColorProfile);
00560 
00561     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d9/icmupg_8c.html#a22">pInstallColorProfile</a> || !<a class="code" href="../../d4/d9/icmupg_8c.html#a21">pInstallColorProfileA</a>)
00562     {
00563         SetupLogError(<span class="stringliteral">"ICM Migration: Fatal Error, cannot find mscms functions. \r\n"</span>, LogSevFatalError);
00564         <span class="keywordflow">goto</span> EndMigrateSystemNT;
00565     }
00566 
00567     <a class="code" href="../../d4/d9/icmupg_8c.html#a25">InternalUpgradeICM</a>();   <span class="comment">// Upgrade over Win9x</span>
00568     <a class="code" href="../../d4/d9/icmupg_8c.html#a29">InstallProfiles</a>();      <span class="comment">// Install all profiles in the old color directory</span>
00569     <a class="code" href="../../d4/d9/icmupg_8c.html#a30">DeleteOldICMKey</a>();
00570 
00571     rc = ERROR_SUCCESS;
00572 
00573 EndMigrateSystemNT:
00574 
00575     <span class="keywordflow">if</span> (hModule)
00576     {
00577         FreeLibrary(hModule);
00578     }
00579 
00580     <span class="keywordflow">return</span> rc;
00581 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="icmupg.c::MigrateUser9x" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG CALLBACK MigrateUser9x           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwndParent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszUnattendFile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HKEY&nbsp;</td>
          <td class="mdname" nowrap> <em>hUserRegKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pvReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00262">262</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00269 {
00270     <span class="comment">//</span>
00271     <span class="comment">// Nothing to do</span>
00272     <span class="comment">//</span>
00273 
00274     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"MigrateUser9x called\n"</span>)));
00275     <span class="keywordflow">return</span>  ERROR_SUCCESS;
00276 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="icmupg.c::MigrateUserNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG CALLBACK MigrateUserNT           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hUnattendInf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HKEY&nbsp;</td>
          <td class="mdname" nowrap> <em>hUserRegKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszUserName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pvReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00499">499</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
<pre class="fragment"><div>00505 {
00506     SetupLogError(<span class="stringliteral">"ICM Migration: MigrateUserNT called\r\n"</span>, LogSevInformation);
00507 
00508     <span class="comment">//</span>
00509     <span class="comment">// Nothing to do</span>
00510     <span class="comment">//</span>
00511 
00512     <span class="keywordflow">return</span>  ERROR_SUCCESS;
00513 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="icmupg.c::MyMoveDir" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MyMoveDir           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>d</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00665">665</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, and <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00726">InstallProfiles()</a>.
<p>
<pre class="fragment"><div>00665                                  {
00666   WIN32_FIND_DATA rf;
00667   HANDLE hf;
00668   <span class="keywordtype">char</span> s2[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00669   <span class="keywordtype">char</span> s_[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00670   <span class="keywordtype">char</span> d_[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00671   <span class="keywordtype">char</span> err[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00672 
00673   <span class="comment">//</span>
00674   <span class="comment">// If MoveFileEx succeeds, we're done.</span>
00675   <span class="comment">//</span>
00676 
00677   <span class="keywordflow">if</span>(!MoveFileEx(s, d, MOVEFILE_REPLACE_EXISTING)) {
00678     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(s2, <span class="stringliteral">"%s*"</span>, s);
00679     hf = FindFirstFile(s2, &amp;rf);
00680     <span class="keywordflow">do</span> {
00681       <span class="comment">// don't move . and ..</span>
00682       <span class="keywordflow">if</span>(!(strcmp(<span class="stringliteral">"."</span>, rf.cFileName)==0 ||
00683            strcmp(<span class="stringliteral">".."</span>, rf.cFileName)==0) ) {
00684         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(s_, <span class="stringliteral">"%s%s"</span>, s, rf.cFileName);
00685         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(d_, <span class="stringliteral">"%s%s"</span>, d, rf.cFileName);
00686         <span class="keywordflow">if</span>(!MoveFileEx(s_, d_, MOVEFILE_REPLACE_EXISTING)) {
00687           <span class="keywordtype">int</span> e = GetLastError();  
00688           <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(err, <span class="stringliteral">"ICM Migration: Failed the move of %s with %d\r\n"</span>, s_, e);
00689           SetupLogError(err, LogSevError);
00690         } <span class="keywordflow">else</span> {
00691           <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(err, <span class="stringliteral">"ICM Migration: Moved %s to %s\n"</span>, s_, d_);
00692           SetupLogError(err, LogSevInformation);
00693         }
00694       }
00695 
00696     } <span class="keywordflow">while</span>(FindNextFile(hf, &amp;rf));
00697     FindClose(hf);
00698   }
00699 
00700   <span class="comment">//</span>
00701   <span class="comment">// source directory should theoretically be empty at this point</span>
00702   <span class="comment">// If there are errors, we'll leave files behind and report this in </span>
00703   <span class="comment">// the setup log as a LogSevError.</span>
00704   <span class="comment">//</span>
00705 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="icmupg.c::QueryVersion" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG CALLBACK QueryVersion           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT LPCSTR *&nbsp;</td>
          <td class="mdname" nowrap> <em>pszProductID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPUINT&nbsp;</td>
          <td class="mdname" nowrap> <em>puDllVersion</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPINT *&nbsp;</td>
          <td class="mdname" nowrap> <em>pCodePageArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OPTIONAL OUT LPCSTR *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppszExeNamesBuf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OPTIONAL OUT <a class="el" href="../../d4/d9/icmupg_8c.html#a7">PVENDORINFO</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppVendorInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00139">139</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00054">VENDORINFO::CompanyName</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00069">gszProductID</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00074">gVendorInfo</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00106">hinstMigDll</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00057">VENDORINFO::InstructionsToUser</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00055">VENDORINFO::SupportNumber</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00056">VENDORINFO::SupportUrl</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00146 {
00147     *pszProductID = <a class="code" href="../../d4/d9/icmupg_8c.html#a11">gszProductID</a>;
00148     *puDllVersion = 1;
00149     *ppszExeNamesBuf    = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00150     *pCodePageArray = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00151     *ppVendorInfo = &amp;<a class="code" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a>;
00152     memset(&amp;gVendorInfo, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d2/structVENDORINFO.html">VENDORINFO</a>));
00153     FormatMessageA(
00154                  FORMAT_MESSAGE_FROM_HMODULE,
00155                  hinstMigDll,
00156                  MSG_VI_COMPANY_NAME,
00157                  MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
00158                  <a class="code" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a>.<a class="code" href="../../d0/d2/structVENDORINFO.html#o0">CompanyName</a>,
00159                  <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a>.<a class="code" href="../../d0/d2/structVENDORINFO.html#o0">CompanyName</a>),
00160                  NULL
00161                  );
00162 
00163     FormatMessageA(
00164                  FORMAT_MESSAGE_FROM_HMODULE,
00165                  hinstMigDll,
00166                  MSG_VI_SUPPORT_NUMBER,
00167                  MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
00168                  <a class="code" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a>.<a class="code" href="../../d0/d2/structVENDORINFO.html#o1">SupportNumber</a>,
00169                  <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a>.<a class="code" href="../../d0/d2/structVENDORINFO.html#o1">SupportNumber</a>),
00170                  NULL
00171                  );
00172 
00173     FormatMessageA(
00174                  FORMAT_MESSAGE_FROM_HMODULE,
00175                  hinstMigDll,
00176                  MSG_VI_SUPPORT_URL,
00177                  MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
00178                  <a class="code" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a>.<a class="code" href="../../d0/d2/structVENDORINFO.html#o2">SupportUrl</a>,
00179                  <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a>.<a class="code" href="../../d0/d2/structVENDORINFO.html#o2">SupportUrl</a>),
00180                  NULL
00181                  );
00182 
00183     FormatMessageA(
00184                  FORMAT_MESSAGE_FROM_HMODULE,
00185                  hinstMigDll,
00186                  MSG_VI_INSTRUCTIONS,
00187                  MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
00188                  <a class="code" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a>.<a class="code" href="../../d0/d2/structVENDORINFO.html#o3">InstructionsToUser</a>,
00189                  <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a>.<a class="code" href="../../d0/d2/structVENDORINFO.html#o3">InstructionsToUser</a>),
00190                  NULL
00191                  );
00192     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"QueryVersion called\n"</span>)));
00193     <span class="keywordflow">return</span> ERROR_SUCCESS;
00194 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="icmupg.c::UpgradeClass" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UpgradeClass           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKEY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00916">916</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00066">gszProfile</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l01048">lstrcmpn()</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00090">pInstallColorProfile</a>, <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00087">szName</a>, and <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00086">szValue</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00833">InternalUpgradeICM()</a>.
<p>
<pre class="fragment"><div>00919 {
00920     HKEY  hSubkey;
00921     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nSubkeys, nValues, i, cbName, cbValue;
00922     TCHAR szKeyName[32];
00923     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>  szMessage[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00924 
00925     <span class="comment">//</span>
00926     <span class="comment">// If there is an error, return</span>
00927     <span class="comment">//</span>
00928 
00929     <span class="keywordflow">if</span> (RegQueryInfoKey(hKey, NULL, NULL, 0, &amp;nSubkeys, NULL, NULL,
00930         &amp;nValues, NULL, NULL, NULL, NULL) != ERROR_SUCCESS)
00931     {
00932         <span class="keywordflow">return</span>;
00933     }
00934 
00935     <span class="keywordflow">if</span> (nSubkeys &gt; 0)
00936     {
00937         <span class="comment">//</span>
00938         <span class="comment">// This is not the leaf node, recurse</span>
00939         <span class="comment">//</span>
00940 
00941         <span class="keywordflow">for</span> (i=nSubkeys; i&gt;0; i--)
00942         {
00943             RegEnumKey(hKey, i-1, szKeyName, <span class="keyword">sizeof</span>(szKeyName));
00944             <span class="keywordflow">if</span> (RegOpenKeyEx(hKey, szKeyName, 0, KEY_ALL_ACCESS, &amp;hSubkey) == ERROR_SUCCESS)
00945             {
00946                 <a class="code" href="../../d4/d9/icmupg_8c.html#a26">UpgradeClass</a>(hSubkey);
00947                 RegCloseKey(hSubkey);
00948                 RegDeleteKey(hKey, szKeyName);
00949             }
00950         }
00951     }
00952     <span class="keywordflow">else</span>
00953     {
00954         <span class="comment">//</span>
00955         <span class="comment">// This is the leaf node - install all the profiles registered</span>
00956         <span class="comment">//</span>
00957 
00958         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pInstallColorProfile != NULL);
00959 
00960         <span class="keywordflow">for</span> (i=nValues; i&gt;0; i--)
00961         {
00962             cbName = <a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>;
00963             cbValue = <a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>;
00964             <span class="keywordflow">if</span> (RegEnumValue(hKey, i-1, szName, &amp;cbName, 0, NULL, (LPBYTE)szValue,
00965                 &amp;cbValue) == ERROR_SUCCESS)
00966             {
00967                 <span class="keywordflow">if</span> (! <a class="code" href="../../d4/d9/icmupg_8c.html#a32">lstrcmpn</a>(szName, (PTSTR)gszProfile, lstrlen(gszProfile)))
00968                 {
00969                     <span class="keywordflow">if</span> (! (*pInstallColorProfile)(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d9/icmupg_8c.html#a19">szValue</a>))
00970                     {
00971                         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(szMessage, <span class="stringliteral">"ICM Migration: Error installing profile %s\r\n"</span>, szValue);
00972                         SetupLogError(szMessage, LogSevError);
00973                     }
00974                     <span class="keywordflow">else</span>
00975                     {
00976                         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(szMessage, <span class="stringliteral">"ICM Migration: Installed profile %s\r\n"</span>, szValue);
00977                         SetupLogError(szMessage, LogSevInformation);
00978                     }            
00979                 }
00980                 <span class="keywordflow">else</span>
00981                 {
00982                     PTSTR pProfile;
00983                 
00984                     <span class="comment">//</span>
00985                     <span class="comment">// We might be upgrading over Memphis or later</span>
00986                     <span class="comment">// In Memphis it is "file name" "value" instead of</span>
00987                     <span class="comment">// "profilexx" "value" in Win95 &amp; OSR2</span>
00988                     <span class="comment">//</span>
00989                 
00990                     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/icmupg_8c.html#a20">szName</a>[1] == <span class="charliteral">':'</span>)
00991                     {
00992                         <span class="comment">//</span>
00993                         <span class="comment">// Assume full path name</span>
00994                         <span class="comment">//</span>
00995                 
00996                         pProfile = <a class="code" href="../../d4/d9/icmupg_8c.html#a20">szName</a>;
00997                 
00998                     }
00999                     <span class="keywordflow">else</span>
01000                     {
01001                         GetWindowsDirectory(szValue, MAX_PATH);
01002                         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/icmupg_8c.html#a19">szValue</a>[lstrlen(szValue)-1] != <span class="charliteral">'\\'</span>)
01003                             lstrcat(szValue, __TEXT(<span class="stringliteral">"\\"</span>));
01004                         lstrcat(szValue, __TEXT(<span class="stringliteral">"system\\color\\"</span>));
01005                         lstrcat(szValue, szName);
01006                         pProfile = <a class="code" href="../../d4/d9/icmupg_8c.html#a19">szValue</a>;
01007                     }
01008                 
01009                     <span class="keywordflow">if</span> (! (*pInstallColorProfile)(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, pProfile))
01010                     {
01011                         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(szMessage, <span class="stringliteral">"ICM Migration: Error installing profile %s\r\n"</span>, pProfile);
01012                         SetupLogError(szMessage, LogSevError);
01013                     }
01014                     <span class="keywordflow">else</span>
01015                     {
01016                         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(szMessage, <span class="stringliteral">"ICM Migration: Installed Profile %s\r\n"</span>, pProfile);
01017                         SetupLogError(szMessage, LogSevInformation);
01018                     }
01019                 }                
01020                 RegDeleteValue(hKey, szName);
01021             }
01022         }
01023     }
01024 
01025     <span class="keywordflow">return</span>;
01026 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a14" doxytag="icmupg.c::gszEnumColorProfiles" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char const <a class="el" href="../../d4/d9/icmupg_8c.html#a14">gszEnumColorProfiles</a>[] = "EnumColorProfilesA"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00073">73</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00296">MigrateSystem9x()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="icmupg.c::gszFullICMRegPath" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char const <a class="el" href="../../d4/d9/icmupg_8c.html#a17">gszFullICMRegPath</a>[] = "\"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ICM\""          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00076">76</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00296">MigrateSystem9x()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="icmupg.c::gszGetColorDirectory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char const <a class="el" href="../../d4/d9/icmupg_8c.html#a13">gszGetColorDirectory</a>[] = "GetColorDirectoryA"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00072">72</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="icmupg.c::gszICMRegPath" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> TCHAR const <a class="el" href="../../d7/d6/ntgdi_2icm_2mscms_2globals_8h.html#a6">gszICMRegPath</a>[] = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\ICM"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00065">65</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00600">DeleteOldICMKey()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l05510">GetMonitorData()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l02838">InternalAssociateColorProfileWithDevice()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l03118">InternalDisassociateColorProfileFromDevice()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l03356">InternalEnumColorProfiles()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l03884">InternalGetSCSProfile()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l02475">InternalInstallColorProfile()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l03785">InternalSetSCSProfile()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l02664">InternalUninstallColorProfile()</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00833">InternalUpgradeICM()</a>, and <a class="el" href="../../d0/d7/profman_8c-source.html#l05280">OpenMonitor()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="icmupg.c::gszInstallColorProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char const <a class="el" href="../../d4/d9/icmupg_8c.html#a12">gszInstallColorProfile</a>[] = "InstallColorProfileA"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00071">71</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">MigrateSystemNT()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="icmupg.c::gszInstallColorProfileA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char const <a class="el" href="../../d4/d9/icmupg_8c.html#a18">gszInstallColorProfileA</a>[] = "InstallColorProfileA"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00078">78</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">MigrateSystemNT()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="icmupg.c::gszMigInf" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char <a class="el" href="../../d4/d9/icmupg_8c.html#a16">gszMigInf</a>[MAX_PATH]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00075">75</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00215">Initialize9x()</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00726">InstallProfiles()</a>, and <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00296">MigrateSystem9x()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="icmupg.c::gszMSCMSdll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> TCHAR const <a class="el" href="../../d4/d9/icmupg_8c.html#a10">gszMSCMSdll</a>[] = "mscms.dll"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00067">67</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00296">MigrateSystem9x()</a>, and <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">MigrateSystemNT()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="icmupg.c::gszProductID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char const <a class="el" href="../../d4/d9/icmupg_8c.html#a11">gszProductID</a>[] = "Microsoft Color Management System"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00069">69</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00139">QueryVersion()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="icmupg.c::gszProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> TCHAR const <a class="el" href="../../d4/d9/icmupg_8c.html#a9">gszProfile</a>[] = "profile"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00066">66</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00916">UpgradeClass()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="icmupg.c::gVendorInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structVENDORINFO.html">VENDORINFO</a> <a class="el" href="../../d4/d9/icmupg_8c.html#a15">gVendorInfo</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00074">74</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00139">QueryVersion()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="icmupg.c::hinstMigDll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HINSTANCE <a class="el" href="../../d4/d9/icmupg_8c.html#a24">hinstMigDll</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00106">106</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00110">DllEntryPoint()</a>, and <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00139">QueryVersion()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="icmupg.c::pEnumColorProfiles" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/icmupg_8c.html#a6">PFNENUMCOLORPROFILES</a> <a class="el" href="../../d4/d9/icmupg_8c.html#a23">pEnumColorProfiles</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00091">91</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00296">MigrateSystem9x()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="icmupg.c::pInstallColorProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/icmupg_8c.html#a5">PFNINSTALLCOLORPROFILE</a> <a class="el" href="../../d4/d9/icmupg_8c.html#a22">pInstallColorProfile</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00090">90</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">MigrateSystemNT()</a>, and <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00916">UpgradeClass()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="icmupg.c::pInstallColorProfileA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/icmupg_8c.html#a4">PFNINSTALLCOLORPROFILEA</a> <a class="el" href="../../d4/d9/icmupg_8c.html#a21">pInstallColorProfileA</a> = NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00089">89</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00726">InstallProfiles()</a>, and <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00534">MigrateSystemNT()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="icmupg.c::szName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> TCHAR <a class="el" href="../../d4/d9/icmupg_8c.html#a20">szName</a>[MAX_PATH]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00087">87</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/profile_8cpp-source.html#l00240">CScannerList::Enumerate()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02146">InitiateWin32kCleanup()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l05280">OpenMonitor()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l03858">RawInputThread()</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00916">UpgradeClass()</a>, and <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l02001">vCheckMMInstance()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="icmupg.c::szValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> TCHAR <a class="el" href="../../d4/d9/icmupg_8c.html#a19">szValue</a>[MAX_PATH]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00086">86</a> of file <a class="el" href="../../d5/d8/icmupg_8c-source.html">icmupg.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00916">UpgradeClass()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:09 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
