<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dllssstb.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dllssstb.c</h1><a href="../../d3/d0/dllssstb_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    dllssstb.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Debug Subsystem DbgSs API Stubs</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Mark Lucovsky (markl) 22-Jan-1990</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#include "<a class="code" href="../../d3/d3/dbgdllp_8h.html">dbgdllp.h</a>"</span>
00022 <span class="preprocessor">#include "<a class="code" href="../../d9/d2/ldrp_8h.html">ldrp.h</a>"</span>
00023 
00024 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00025"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a0">00025</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a0">DbgSspConnectToDbg</a>( VOID )
00026 
00027 <span class="comment">/*++</span>
00028 <span class="comment"></span>
00029 <span class="comment">Routine Description:</span>
00030 <span class="comment"></span>
00031 <span class="comment">    This routine makes a connection between the caller and the</span>
00032 <span class="comment">    DbgSs port in the Dbg subsystem.</span>
00033 <span class="comment"></span>
00034 <span class="comment">Arguments:</span>
00035 <span class="comment"></span>
00036 <span class="comment">    None.</span>
00037 <span class="comment"></span>
00038 <span class="comment">Return Value:</span>
00039 <span class="comment"></span>
00040 <span class="comment">    TBD.</span>
00041 <span class="comment"></span>
00042 <span class="comment">--*/</span>
00043 
00044 {
00045     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00046     UNICODE_STRING <a class="code" href="../../d3/d9/ulpc_8h.html#a2">PortName</a>;
00047     SECURITY_QUALITY_OF_SERVICE <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>;
00048 
00049     <span class="comment">//</span>
00050     <span class="comment">// Set up the security quality of service parameters to use over the</span>
00051     <span class="comment">// port.  Use the most efficient (least overhead) - which is dynamic</span>
00052     <span class="comment">// rather than static tracking.</span>
00053     <span class="comment">//</span>
00054 
00055     <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>.ImpersonationLevel = SecurityImpersonation;
00056     <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>.ContextTrackingMode = SECURITY_DYNAMIC_TRACKING;
00057     <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>.EffectiveOnly = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00058 
00059 
00060     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;<a class="code" href="../../d3/d9/ulpc_8h.html#a2">PortName</a>,<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\DbgSsApiPort"</span>);
00061     st = <a class="code" href="../../d5/d6/lpcconn_8c.html#a1">NtConnectPort</a>(
00062             &amp;<a class="code" href="../../d3/d3/dbgdllp_8h.html#a1">DbgSspApiPort</a>,
00063             &amp;<a class="code" href="../../d3/d9/ulpc_8h.html#a2">PortName</a>,
00064             &amp;<a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>,
00065             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00066             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00067             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00068             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00069             0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>
00070             );
00071 
00072     <span class="keywordflow">return</span> st;
00073 
00074 }
00075 
00076 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00077"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a1">00077</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a1">DbgSspException</a> (
00078     IN <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey,
00079     IN PCLIENT_ID AppClientId,
00080     IN PDBGKM_EXCEPTION Exception
00081     )
00082 
00083 <span class="comment">/*++</span>
00084 <span class="comment"></span>
00085 <span class="comment">Routine Description:</span>
00086 <span class="comment"></span>
00087 <span class="comment">    This function is called by emulation subsystems to report that</span>
00088 <span class="comment">    an exception occured in a thread.</span>
00089 <span class="comment"></span>
00090 <span class="comment">Arguments:</span>
00091 <span class="comment"></span>
00092 <span class="comment">    ContinueKey - Supplies the captured DbgKm API message that needs a reply</span>
00093 <span class="comment">        should this API complete successfully.</span>
00094 <span class="comment"></span>
00095 <span class="comment">    AppClientId - Supplies the address of the ClientId of the thread that</span>
00096 <span class="comment">        encountered an exception.</span>
00097 <span class="comment"></span>
00098 <span class="comment">    Exception - Supplies the address of the Exception message as sent</span>
00099 <span class="comment">        through the applications DebugPort.</span>
00100 <span class="comment"></span>
00101 <span class="comment">Return Value:</span>
00102 <span class="comment"></span>
00103 <span class="comment">    TBD</span>
00104 <span class="comment"></span>
00105 <span class="comment">--*/</span>
00106 
00107 {
00108 
00109     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00110     DBGSS_APIMSG ApiMsg;
00111 
00112     PDBGKM_EXCEPTION args;
00113 
00114     args = &amp;ApiMsg.u.Exception;
00115 
00116     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsExceptionApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00117 
00118     *args = *Exception;
00119 
00120     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(<a class="code" href="../../d3/d3/dbgdllp_8h.html#a1">DbgSspApiPort</a>, (PPORT_MESSAGE) &amp;ApiMsg);
00121 
00122     <span class="keywordflow">return</span> st;
00123 }
00124 
00125 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00126"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a2">00126</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a2">DbgSspCreateThread</a> (
00127     IN <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey,
00128     IN PCLIENT_ID AppClientId,
00129     IN PDBGKM_CREATE_THREAD NewThread
00130     )
00131 
00132 <span class="comment">/*++</span>
00133 <span class="comment"></span>
00134 <span class="comment">Routine Description:</span>
00135 <span class="comment"></span>
00136 <span class="comment">    This function is called by emulation subsystems to report the</span>
00137 <span class="comment">    creation of a new thread to the Dbg subsystem.</span>
00138 <span class="comment"></span>
00139 <span class="comment">Arguments:</span>
00140 <span class="comment"></span>
00141 <span class="comment">    ContinueKey - Supplies the captured DbgKm API message that needs a reply</span>
00142 <span class="comment">        should this API complete successfully.</span>
00143 <span class="comment"></span>
00144 <span class="comment">    AppClientId - Supplies the address of the new thread's ClientId.</span>
00145 <span class="comment"></span>
00146 <span class="comment">    NewThread - Supplies the address of the NewThread message as sent through</span>
00147 <span class="comment">        the applications DebugPort. The calling subsystem may modify the</span>
00148 <span class="comment">        SubSystemKey field of this message.</span>
00149 <span class="comment"></span>
00150 <span class="comment">Return Value:</span>
00151 <span class="comment"></span>
00152 <span class="comment">    TBD</span>
00153 <span class="comment"></span>
00154 <span class="comment">--*/</span>
00155 
00156 {
00157 
00158     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00159     DBGSS_APIMSG ApiMsg;
00160 
00161     PDBGKM_CREATE_THREAD args;
00162 
00163     args = &amp;ApiMsg.u.CreateThread;
00164 
00165     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsCreateThreadApi,<span class="keyword">sizeof</span>(*args),AppClientId, ContinueKey);
00166 
00167     *args = *NewThread;
00168 
00169     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(<a class="code" href="../../d3/d3/dbgdllp_8h.html#a1">DbgSspApiPort</a>, (PPORT_MESSAGE) &amp;ApiMsg);
00170 
00171     <span class="keywordflow">return</span> st;
00172 }
00173 
00174 
00175 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00176"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a3">00176</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a3">DbgSspCreateProcess</a> (
00177     IN <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey,
00178     IN PCLIENT_ID AppClientId,
00179     IN PCLIENT_ID DebugUiClientId,
00180     IN PDBGKM_CREATE_PROCESS NewProcess
00181     )
00182 
00183 <span class="comment">/*++</span>
00184 <span class="comment"></span>
00185 <span class="comment">Routine Description:</span>
00186 <span class="comment"></span>
00187 <span class="comment">    This function is called by emulation subsystems to report the</span>
00188 <span class="comment">    creation of a new process to the Dbg subsystem.  It is the</span>
00189 <span class="comment">    responsibility of individual subsystems to track a process and its</span>
00190 <span class="comment">    controlling DebugUi.</span>
00191 <span class="comment"></span>
00192 <span class="comment">Arguments:</span>
00193 <span class="comment"></span>
00194 <span class="comment">    ContinueKey - Supplies the captured DbgKm API message that needs a reply</span>
00195 <span class="comment">        should this API complete successfully.</span>
00196 <span class="comment"></span>
00197 <span class="comment">    AppClientId - Supplies the address of the new thread's ClientId.</span>
00198 <span class="comment"></span>
00199 <span class="comment">    DebugUiClientId - Supplies the address of the ClientId of the user</span>
00200 <span class="comment">        interface controlling the new thread.</span>
00201 <span class="comment"></span>
00202 <span class="comment">    NewProcess - Supplies the address of the NewProcess message as sent through</span>
00203 <span class="comment">        the applications DebugPort. The calling subsystem may modify the</span>
00204 <span class="comment">        SubSystemKey fields of this message.</span>
00205 <span class="comment"></span>
00206 <span class="comment">Return Value:</span>
00207 <span class="comment"></span>
00208 <span class="comment">    TBD</span>
00209 <span class="comment"></span>
00210 <span class="comment">--*/</span>
00211 
00212 {
00213 
00214     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00215     DBGSS_APIMSG ApiMsg;
00216 
00217     PDBGSS_CREATE_PROCESS args;
00218 
00219     args = &amp;ApiMsg.u.CreateProcessInfo;
00220 
00221     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsCreateProcessApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00222 
00223     args-&gt;DebugUiClientId = *DebugUiClientId;
00224     args-&gt;NewProcess = *NewProcess;
00225 
00226     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(<a class="code" href="../../d3/d3/dbgdllp_8h.html#a1">DbgSspApiPort</a>, (PPORT_MESSAGE) &amp;ApiMsg);
00227 
00228     <span class="keywordflow">return</span> st;
00229 
00230 }
00231 
00232 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00233"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a4">00233</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a4">DbgSspExitThread</a> (
00234     IN <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey,
00235     IN PCLIENT_ID AppClientId,
00236     IN PDBGKM_EXIT_THREAD ExitThread
00237     )
00238 
00239 <span class="comment">/*++</span>
00240 <span class="comment"></span>
00241 <span class="comment">Routine Description:</span>
00242 <span class="comment"></span>
00243 <span class="comment">    This function is called by emulation subsystems to report that</span>
00244 <span class="comment">    a thread is exiting.</span>
00245 <span class="comment"></span>
00246 <span class="comment">Arguments:</span>
00247 <span class="comment"></span>
00248 <span class="comment">    ContinueKey - Supplies the captured DbgKm API message that needs a reply</span>
00249 <span class="comment">        should this API complete successfully.</span>
00250 <span class="comment"></span>
00251 <span class="comment">    AppClientId - Supplies the address of the exiting thread's ClientId.</span>
00252 <span class="comment"></span>
00253 <span class="comment">    ExitThread - Supplies the address of the ExitThread message as sent</span>
00254 <span class="comment">        through the applications DebugPort.</span>
00255 <span class="comment"></span>
00256 <span class="comment">Return Value:</span>
00257 <span class="comment"></span>
00258 <span class="comment">    TBD</span>
00259 <span class="comment"></span>
00260 <span class="comment">--*/</span>
00261 
00262 {
00263 
00264     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00265     DBGSS_APIMSG ApiMsg;
00266 
00267     PDBGKM_EXIT_THREAD args;
00268 
00269     args = &amp;ApiMsg.u.ExitThread;
00270 
00271     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsExitThreadApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00272 
00273     *args = *ExitThread;
00274 
00275     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(<a class="code" href="../../d3/d3/dbgdllp_8h.html#a1">DbgSspApiPort</a>, (PPORT_MESSAGE) &amp;ApiMsg);
00276 
00277     <span class="keywordflow">return</span> st;
00278 }
00279 
00280 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00281"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a5">00281</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a5">DbgSspExitProcess</a> (
00282     IN <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey,
00283     IN PCLIENT_ID AppClientId,
00284     IN PDBGKM_EXIT_PROCESS ExitProcess
00285     )
00286 
00287 <span class="comment">/*++</span>
00288 <span class="comment"></span>
00289 <span class="comment">Routine Description:</span>
00290 <span class="comment"></span>
00291 <span class="comment">    This function is called by emulation subsystems to report that</span>
00292 <span class="comment">    a process is exiting.</span>
00293 <span class="comment"></span>
00294 <span class="comment">Arguments:</span>
00295 <span class="comment"></span>
00296 <span class="comment">    ContinueKey - Supplies the captured DbgKm API message that needs a reply</span>
00297 <span class="comment">        should this API complete successfully.</span>
00298 <span class="comment"></span>
00299 <span class="comment">    AppClientId - Supplies the address of the ClientId of the last thread</span>
00300 <span class="comment">        in the process to exit.</span>
00301 <span class="comment"></span>
00302 <span class="comment">    ExitProcess - Supplies the address of the ExitProcess message as sent</span>
00303 <span class="comment">        through the applications DebugPort.</span>
00304 <span class="comment"></span>
00305 <span class="comment">Return Value:</span>
00306 <span class="comment"></span>
00307 <span class="comment">    TBD</span>
00308 <span class="comment"></span>
00309 <span class="comment">--*/</span>
00310 
00311 {
00312 
00313     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00314     DBGSS_APIMSG ApiMsg;
00315 
00316     PDBGKM_EXIT_PROCESS args;
00317 
00318     args = &amp;ApiMsg.u.ExitProcess;
00319 
00320     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsExitProcessApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00321 
00322     *args = *ExitProcess;
00323 
00324     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(<a class="code" href="../../d3/d3/dbgdllp_8h.html#a1">DbgSspApiPort</a>, (PPORT_MESSAGE) &amp;ApiMsg);
00325 
00326     <span class="keywordflow">return</span> st;
00327 }
00328 
00329 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00330"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a6">00330</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a6">DbgSspLoadDll</a> (
00331     IN <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey,
00332     IN PCLIENT_ID AppClientId,
00333     IN PDBGKM_LOAD_DLL LoadDll
00334     )
00335 
00336 <span class="comment">/*++</span>
00337 <span class="comment"></span>
00338 <span class="comment">Routine Description:</span>
00339 <span class="comment"></span>
00340 <span class="comment">    This function is called by emulation subsystems to report that</span>
00341 <span class="comment">    a a process has loaded a DLL</span>
00342 <span class="comment"></span>
00343 <span class="comment">Arguments:</span>
00344 <span class="comment"></span>
00345 <span class="comment">    ContinueKey - Supplies the captured DbgKm API message that needs a reply</span>
00346 <span class="comment">        should this API complete successfully.</span>
00347 <span class="comment"></span>
00348 <span class="comment">    AppClientId - Supplies the address of the ClientId of the thread</span>
00349 <span class="comment">        that mapped the section.</span>
00350 <span class="comment"></span>
00351 <span class="comment">    LoadDll - Supplies the address of the LoadDll message as sent</span>
00352 <span class="comment">        through the applications DebugPort.</span>
00353 <span class="comment"></span>
00354 <span class="comment">Return Value:</span>
00355 <span class="comment"></span>
00356 <span class="comment">    TBD</span>
00357 <span class="comment"></span>
00358 <span class="comment">--*/</span>
00359 
00360 {
00361 
00362     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00363     DBGSS_APIMSG ApiMsg;
00364 
00365     PDBGKM_LOAD_DLL args;
00366 
00367     args = &amp;ApiMsg.u.LoadDll;
00368 
00369     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsLoadDllApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00370 
00371     *args = *LoadDll;
00372 
00373     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(<a class="code" href="../../d3/d3/dbgdllp_8h.html#a1">DbgSspApiPort</a>, (PPORT_MESSAGE) &amp;ApiMsg);
00374 
00375     <span class="keywordflow">return</span> st;
00376 }
00377 
00378 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00379"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a7">00379</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a7">DbgSspUnloadDll</a> (
00380     IN <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey,
00381     IN PCLIENT_ID AppClientId,
00382     IN PDBGKM_UNLOAD_DLL UnloadDll
00383     )
00384 
00385 <span class="comment">/*++</span>
00386 <span class="comment"></span>
00387 <span class="comment">Routine Description:</span>
00388 <span class="comment"></span>
00389 <span class="comment">    This function is called by emulation subsystems to report that</span>
00390 <span class="comment">    a a process has un-mapped a view of a section</span>
00391 <span class="comment"></span>
00392 <span class="comment">Arguments:</span>
00393 <span class="comment"></span>
00394 <span class="comment">    ContinueKey - Supplies the captured DbgKm API message that needs a reply</span>
00395 <span class="comment">        should this API complete successfully.</span>
00396 <span class="comment"></span>
00397 <span class="comment">    AppClientId - Supplies the address of the ClientId of the thread</span>
00398 <span class="comment">        that mapped the section.</span>
00399 <span class="comment"></span>
00400 <span class="comment">    UnloadDll - Supplies the address of the UnloadDll message as sent</span>
00401 <span class="comment">        through the applications DebugPort.</span>
00402 <span class="comment"></span>
00403 <span class="comment">Return Value:</span>
00404 <span class="comment"></span>
00405 <span class="comment">    TBD</span>
00406 <span class="comment"></span>
00407 <span class="comment">--*/</span>
00408 
00409 {
00410 
00411     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00412     DBGSS_APIMSG ApiMsg;
00413 
00414     PDBGKM_UNLOAD_DLL args;
00415 
00416     args = &amp;ApiMsg.u.UnloadDll;
00417 
00418     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsUnloadDllApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00419 
00420     *args = *UnloadDll;
00421 
00422     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(<a class="code" href="../../d3/d3/dbgdllp_8h.html#a1">DbgSspApiPort</a>, (PPORT_MESSAGE) &amp;ApiMsg);
00423 
00424     <span class="keywordflow">return</span> st;
00425 }
00426 
00427 
00428 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00429"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a8">00429</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a8">DbgSsInitialize</a>(
00430     IN HANDLE KmReplyPort,
00431     IN PDBGSS_UI_LOOKUP UiLookUpRoutine,
00432     IN PDBGSS_SUBSYSTEMKEY_LOOKUP SubsystemKeyLookupRoutine OPTIONAL,
00433     IN PDBGSS_DBGKM_APIMSG_FILTER KmApiMsgFilter OPTIONAL
00434     )
00435 
00436 <span class="comment">/*++</span>
00437 <span class="comment"></span>
00438 <span class="comment">Routine Description:</span>
00439 <span class="comment"></span>
00440 <span class="comment">    This function is called by a subsystem to initialize</span>
00441 <span class="comment">    portions of the debug subsystem dll. The main purpose of</span>
00442 <span class="comment">    this function is to set up callouts that are needed in order</span>
00443 <span class="comment">    to use DbgSsHandleKmApiMsg, and to connect to the debug server.</span>
00444 <span class="comment"></span>
00445 <span class="comment">Arguments:</span>
00446 <span class="comment"></span>
00447 <span class="comment">    KmReplyPort - Supplies a handle to the port that the subsystem</span>
00448 <span class="comment">        receives DbgKm API messages on.</span>
00449 <span class="comment"></span>
00450 <span class="comment">    UiLookupRoutine - Supplies the address of a function that will</span>
00451 <span class="comment">        be called upon receipt of a process creation message. The</span>
00452 <span class="comment">        purpose of this function is to identify the client id of the</span>
00453 <span class="comment">        debug ui controlling the process.</span>
00454 <span class="comment"></span>
00455 <span class="comment">    SubsystemKeyLookupRoutine - Supplies the address of a function that</span>
00456 <span class="comment">        will be called upon receipt of process creation and thread</span>
00457 <span class="comment">        creation messages.  The purpose of this function is to allow a</span>
00458 <span class="comment">        subsystem to correlate a key value with a given process or</span>
00459 <span class="comment">        thread.</span>
00460 <span class="comment"></span>
00461 <span class="comment">    KmApiMsgFilter - Supplies the address of a function that will be</span>
00462 <span class="comment">        called upon receipt of a DbgKm Api message. This function can</span>
00463 <span class="comment">        take any action. If it returns any value other than DBG_CONTINUE,</span>
00464 <span class="comment">        DbgSsHandleKmApiMsg will not process the message. This function</span>
00465 <span class="comment">        is called before any other call outs occur.</span>
00466 <span class="comment"></span>
00467 <span class="comment">Return Value:</span>
00468 <span class="comment"></span>
00469 <span class="comment">    Return code of DbgSsConnectToDbg.</span>
00470 <span class="comment"></span>
00471 <span class="comment">--*/</span>
00472 
00473 {
00474     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00475 
00476     st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a0">DbgSspConnectToDbg</a>();
00477 
00478     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st)) {
00479         <a class="code" href="../../d3/d3/dbgdllp_8h.html#a2">DbgSspKmReplyPort</a> = KmReplyPort;
00480         <a class="code" href="../../d3/d3/dbgdllp_8h.html#a3">DbgSspUiLookUpRoutine</a> = UiLookUpRoutine;
00481         <a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a> = SubsystemKeyLookupRoutine;
00482         <a class="code" href="../../d3/d3/dbgdllp_8h.html#a5">DbgSspKmApiMsgFilter</a> = KmApiMsgFilter;
00483 
00484         st = <a class="code" href="../../d0/d2/rtlexec_8c.html#a13">RtlCreateUserThread</a>(
00485                 NtCurrentProcess(),
00486                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00487                 <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00488                 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>,
00489                 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>,
00490                 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>,
00491                 <a class="code" href="../../d3/d3/dbgdllp_8h.html#a9">DbgSspSrvApiLoop</a>,
00492                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00493                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00494                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00495                 );
00496         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) );
00497     }
00498 
00499     <span class="keywordflow">return</span> st;
00500 }
00501 
00502 
00503 <span class="preprocessor">#if DBG</span>
00504 <span class="preprocessor"></span>PSZ DbgpKmApiName[ DbgKmMaxApiNumber+1 ] = {
00505     <span class="stringliteral">"DbgKmException"</span>,
00506     <span class="stringliteral">"DbgKmCreateThread"</span>,
00507     <span class="stringliteral">"DbgKmCreateProcess"</span>,
00508     <span class="stringliteral">"DbgKmExitThread"</span>,
00509     <span class="stringliteral">"DbgKmExitProcess"</span>,
00510     <span class="stringliteral">"DbgKmLoadDll"</span>,
00511     <span class="stringliteral">"DbgKmUnloadDll"</span>,
00512     <span class="stringliteral">"Unknown DbgKm Api Number"</span>
00513 };
00514 <span class="preprocessor">#endif // DBG</span>
00515 <span class="preprocessor"></span>
00516 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00517"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a9">00517</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a9">DbgSsHandleKmApiMsg</a>(
00518     IN PDBGKM_APIMSG ApiMsg,
00519     IN HANDLE ReplyEvent OPTIONAL
00520     )
00521 
00522 <span class="comment">/*++</span>
00523 <span class="comment"></span>
00524 <span class="comment">Routine Description:</span>
00525 <span class="comment"></span>
00526 <span class="comment">    This function is called by a subsystem upon receipt of a message whose</span>
00527 <span class="comment">    type is LPC_DEBUG_EVENT. The purpose of this function is to propagate</span>
00528 <span class="comment">    the debug event message to the debug server.</span>
00529 <span class="comment"></span>
00530 <span class="comment">    A number of callouts are performed prior to propagating the message:</span>
00531 <span class="comment"></span>
00532 <span class="comment">      - For all messages, the KmApiMsgFilter is called (if it was</span>
00533 <span class="comment">        supplied during DbgSsInitialize.  If this returns anything other</span>
00534 <span class="comment">        that DBG_CONTINUE, the message is not propagated by this</span>
00535 <span class="comment">        function.  The caller is responsible for event propagation, and</span>
00536 <span class="comment">        for replying to the thread reporting the debug event.</span>
00537 <span class="comment"></span>
00538 <span class="comment">      - For create process messages, the UiLookupRoutine is called.  If</span>
00539 <span class="comment">        a success code is returned than message is propagated.</span>
00540 <span class="comment">        Otherwise, a reply is generated to the thread reporting the</span>
00541 <span class="comment">        debug event.</span>
00542 <span class="comment"></span>
00543 <span class="comment">     -  For create process and create thread messages,</span>
00544 <span class="comment">        SubsystemKeyLookupRoutine is called.  Failure does not effect</span>
00545 <span class="comment">        propagation.  It simply inhibits the update of messages</span>
00546 <span class="comment">        SubSystemKey field.</span>
00547 <span class="comment"></span>
00548 <span class="comment">    Based on the debug event type, a DBGSS_APIMSG is formated and sent</span>
00549 <span class="comment">    as a datagram to the debug server.</span>
00550 <span class="comment"></span>
00551 <span class="comment">Arguments:</span>
00552 <span class="comment"></span>
00553 <span class="comment">    ApiMsg - Supplies the debug event message to propagate to the debug</span>
00554 <span class="comment">        server.</span>
00555 <span class="comment"></span>
00556 <span class="comment">    ReplyEvent - An optional parameter, that if specified supplies a handle</span>
00557 <span class="comment">        to an event that is to be signaled rather that generating a reply</span>
00558 <span class="comment">        to this message.</span>
00559 <span class="comment"></span>
00560 <span class="comment">Return Value:</span>
00561 <span class="comment"></span>
00562 <span class="comment">    None.</span>
00563 <span class="comment"></span>
00564 <span class="comment">--*/</span>
00565 
00566 
00567 {
00568     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00569     CLIENT_ID DebugUiClientId;
00570     ULONG SubsystemKey;
00571     <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey;
00572 
00573     ApiMsg-&gt;ReturnedStatus = STATUS_PENDING;
00574 
00575 <span class="preprocessor">#if DBG &amp;&amp; 0</span>
00576 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ApiMsg-&gt;ApiNumber &gt;= DbgKmMaxApiNumber ) {
00577         ApiMsg-&gt;ApiNumber = DbgKmMaxApiNumber;
00578     }
00579     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"DBG:  %s Api Request received from %lx.%lx\n"</span>,
00580               DbgpKmApiName[ ApiMsg-&gt;ApiNumber ],
00581               ApiMsg-&gt;h.ClientId.UniqueProcess,
00582               ApiMsg-&gt;h.ClientId.UniqueThread
00583            );
00584 <span class="preprocessor">#endif // DBG</span>
00585 <span class="preprocessor"></span>
00586     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a5">DbgSspKmApiMsgFilter</a>) {
00587         <span class="keywordflow">if</span> ( (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a5">DbgSspKmApiMsgFilter</a>)(ApiMsg) != DBG_CONTINUE ) {
00588             <span class="keywordflow">return</span>;
00589         }
00590     }
00591 
00592     ContinueKey = (<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>) <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>(RtlProcessHeap(), <a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( <a class="code" href="../../d9/d2/ldrp_8h.html#a16">DBG_TAG</a> ), <span class="keyword">sizeof</span>(*ContinueKey));
00593     <span class="keywordflow">if</span> ( !ContinueKey ) {
00594         ApiMsg-&gt;ReturnedStatus = STATUS_NO_MEMORY;
00595         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT(ReplyEvent) ) {
00596             st = <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(ReplyEvent,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00597         } <span class="keywordflow">else</span> {
00598             st = <a class="code" href="../../d5/d7/lpcreply_8c.html#a1">NtReplyPort</a>(<a class="code" href="../../d3/d3/dbgdllp_8h.html#a2">DbgSspKmReplyPort</a>,
00599                              (PPORT_MESSAGE)ApiMsg
00600                             );
00601         }
00602         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st));
00603         <span class="keywordflow">return</span>;
00604     }
00605     ContinueKey-&gt;KmApiMsg = *ApiMsg;
00606 
00607     ContinueKey-&gt;ReplyEvent = ReplyEvent;
00608 
00609     <span class="keywordflow">switch</span> (ApiMsg-&gt;ApiNumber) {
00610 
00611     <span class="keywordflow">case</span> DbgKmExceptionApi :
00612         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a1">DbgSspException</a>(
00613                 ContinueKey,
00614                 &amp;ApiMsg-&gt;h.ClientId,
00615                 &amp;ApiMsg-&gt;u.Exception
00616                 );
00617 
00618         <span class="keywordflow">break</span>;
00619 
00620     <span class="keywordflow">case</span> DbgKmCreateThreadApi :
00621 
00622         <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a> ) {
00623 
00624             st = (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a>)(
00625                     &amp;ApiMsg-&gt;h.ClientId,
00626                     &amp;SubsystemKey,
00627                     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00628                     );
00629 
00630             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00631                 ApiMsg-&gt;u.CreateThread.SubSystemKey = SubsystemKey;
00632             }
00633         }
00634 
00635         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a2">DbgSspCreateThread</a>(
00636                 ContinueKey,
00637                 &amp;ApiMsg-&gt;h.ClientId,
00638                 &amp;ApiMsg-&gt;u.CreateThread
00639                 );
00640 
00641         <span class="keywordflow">break</span>;
00642 
00643     <span class="keywordflow">case</span> DbgKmCreateProcessApi :
00644 
00645         st = (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a3">DbgSspUiLookUpRoutine</a>)(
00646                 &amp;ApiMsg-&gt;h.ClientId,
00647                 &amp;DebugUiClientId
00648                 );
00649         <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00650             <span class="keywordflow">break</span>;
00651         }
00652 
00653         <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a> ) {
00654 
00655             st = (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a>)(
00656                     &amp;ApiMsg-&gt;h.ClientId,
00657                     &amp;SubsystemKey,
00658                     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00659                     );
00660 
00661             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00662                 ApiMsg-&gt;u.CreateProcessInfo.SubSystemKey = SubsystemKey;
00663             }
00664 
00665             st = (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a>)(
00666                     &amp;ApiMsg-&gt;h.ClientId,
00667                     &amp;SubsystemKey,
00668                     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00669                     );
00670 
00671             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00672                 ApiMsg-&gt;u.CreateProcessInfo.InitialThread.SubSystemKey = SubsystemKey;
00673             }
00674         }
00675 
00676         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a3">DbgSspCreateProcess</a>(
00677                 ContinueKey,
00678                 &amp;ApiMsg-&gt;h.ClientId,
00679                 &amp;DebugUiClientId,
00680                 &amp;ApiMsg-&gt;u.CreateProcessInfo
00681                 );
00682         <span class="keywordflow">break</span>;
00683 
00684 
00685     <span class="keywordflow">case</span> DbgKmExitThreadApi :
00686         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a4">DbgSspExitThread</a>(
00687                 ContinueKey,
00688                 &amp;ApiMsg-&gt;h.ClientId,
00689                 &amp;ApiMsg-&gt;u.ExitThread
00690                 );
00691         <span class="keywordflow">break</span>;
00692 
00693     <span class="keywordflow">case</span> DbgKmExitProcessApi :
00694         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a5">DbgSspExitProcess</a>(
00695                 ContinueKey,
00696                 &amp;ApiMsg-&gt;h.ClientId,
00697                 &amp;ApiMsg-&gt;u.ExitProcess
00698                 );
00699         <span class="keywordflow">break</span>;
00700 
00701     <span class="keywordflow">case</span> DbgKmLoadDllApi :
00702         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a6">DbgSspLoadDll</a>(
00703                 ContinueKey,
00704                 &amp;ApiMsg-&gt;h.ClientId,
00705                 &amp;ApiMsg-&gt;u.LoadDll
00706                 );
00707         <span class="keywordflow">break</span>;
00708 
00709     <span class="keywordflow">case</span> DbgKmUnloadDllApi :
00710         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a7">DbgSspUnloadDll</a>(
00711                 ContinueKey,
00712                 &amp;ApiMsg-&gt;h.ClientId,
00713                 &amp;ApiMsg-&gt;u.UnloadDll
00714                 );
00715         <span class="keywordflow">break</span>;
00716 
00717     <span class="keywordflow">default</span> :
00718         st = STATUS_NOT_IMPLEMENTED;
00719     }
00720 
00721     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00722         ApiMsg-&gt;ReturnedStatus = st;
00723         <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>(RtlProcessHeap(), 0, ContinueKey);
00724         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT(ReplyEvent) ) {
00725             st = <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(ReplyEvent,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00726         } <span class="keywordflow">else</span> {
00727             st = <a class="code" href="../../d5/d7/lpcreply_8c.html#a1">NtReplyPort</a>(<a class="code" href="../../d3/d3/dbgdllp_8h.html#a2">DbgSspKmReplyPort</a>,
00728                              (PPORT_MESSAGE)ApiMsg
00729                             );
00730         }
00731         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st));
00732     }
00733 }
00734 
00735 
00736 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00737"></a><a class="code" href="../../d3/d0/dllssstb_8c.html#a10">00737</a> <a class="code" href="../../d3/d0/dllssstb_8c.html#a10">DbgSspSrvApiLoop</a>(
00738     IN PVOID ThreadParameter
00739     )
00740 
00741 <span class="comment">/*++</span>
00742 <span class="comment"></span>
00743 <span class="comment">Routine Description:</span>
00744 <span class="comment"></span>
00745 <span class="comment">    This loop services Dbg Subsystem server originated messages.</span>
00746 <span class="comment"></span>
00747 <span class="comment">Arguments:</span>
00748 <span class="comment"></span>
00749 <span class="comment">    ThreadParameter - Not used.</span>
00750 <span class="comment"></span>
00751 <span class="comment">Return Value:</span>
00752 <span class="comment"></span>
00753 <span class="comment">    None.</span>
00754 <span class="comment"></span>
00755 <span class="comment">--*/</span>
00756 
00757 {
00758     DBGSRV_APIMSG DbgSrvApiMsg;
00759     <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey;
00760     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00761 
00762     <span class="keywordflow">for</span>(;;) {
00763 
00764         st = <a class="code" href="../../d4/d7/lpcrecv_8c.html#a0">NtReplyWaitReceivePort</a>(
00765                 <a class="code" href="../../d3/d3/dbgdllp_8h.html#a1">DbgSspApiPort</a>,
00766                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00767                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00768                 (PPORT_MESSAGE) &amp;DbgSrvApiMsg
00769                 );
00770 
00771         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( st )) {
00772             <span class="keywordflow">continue</span>;
00773             }
00774 
00775         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DbgSrvApiMsg.ApiNumber &lt; DbgSrvMaxApiNumber);
00776 
00777         <span class="keywordflow">switch</span> (DbgSrvApiMsg.ApiNumber ) {
00778         <span class="keywordflow">case</span> DbgSrvContinueApi :
00779 
00780             <span class="comment">//</span>
00781             <span class="comment">// Might want to implement continue status based callout</span>
00782             <span class="comment">// like DBG_TERMINATE_PROCESS/THREAD</span>
00783             <span class="comment">//</span>
00784 
00785             ContinueKey = (<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>) DbgSrvApiMsg.ContinueKey;
00786             ContinueKey-&gt;<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html#o0">KmApiMsg</a>.ReturnedStatus = DbgSrvApiMsg.ReturnedStatus;
00787 
00788             <span class="keywordflow">if</span> ( ContinueKey-&gt;<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html#o1">ReplyEvent</a> ) {
00789                 st = <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(ContinueKey-&gt;<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html#o1">ReplyEvent</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00790             } <span class="keywordflow">else</span> {
00791                 st = <a class="code" href="../../d5/d7/lpcreply_8c.html#a1">NtReplyPort</a>(<a class="code" href="../../d3/d3/dbgdllp_8h.html#a2">DbgSspKmReplyPort</a>,
00792                                  (PPORT_MESSAGE) &amp;ContinueKey-&gt;<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html#o0">KmApiMsg</a>
00793                                 );
00794             }
00795 
00796             <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>(RtlProcessHeap(), 0, ContinueKey);
00797             <span class="keywordflow">break</span>;
00798         <span class="keywordflow">default</span> :
00799             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00800         }
00801     }
00802 
00803     <span class="comment">//</span>
00804     <span class="comment">// Make the compiler happy</span>
00805     <span class="comment">//</span>
00806 
00807     <span class="keywordflow">return</span> st;
00808 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:45 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
