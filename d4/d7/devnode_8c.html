<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: devnode.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>devnode.c File Reference</h1><code>#include "<a class="el" href="../../d1/d5/iop_8h-source.html">iop.h</a>"</code><br>

<p>
<a href="../../d5/d6/devnode_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d3/struct__ENUM__CONTEXT.html">_ENUM_CONTEXT</a></td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d3/struct__ENUM__CONTEXT.html">_ENUM_CONTEXT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/devnode_8c.html#a0">ENUM_CONTEXT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d3/struct__ENUM__CONTEXT.html">_ENUM_CONTEXT</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/devnode_8c.html#a1">PENUM_CONTEXT</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/devnode_8c.html#a2">IopForAllDeviceNodesCallback</a> (IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> DeviceNode, IN PVOID Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/devnode_8c.html#a3">IopAllocateDeviceNode</a> (IN <a class="el" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PhysicalDeviceObject)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/devnode_8c.html#a4">IopForAllDeviceNodes</a> (IN <a class="el" href="../../d9/d0/pnpiop_8h.html#a118">PENUM_CALLBACK</a> Callback, IN PVOID Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/devnode_8c.html#a5">IopForAllChildDeviceNodes</a> (IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> Parent, IN <a class="el" href="../../d9/d0/pnpiop_8h.html#a118">PENUM_CALLBACK</a> Callback, IN PVOID Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/devnode_8c.html#a6">IopDestroyDeviceNode</a> (IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> DeviceNode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/devnode_8c.html#a7">IopInsertTreeDeviceNode</a> (IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> ParentNode, IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> DeviceNode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/devnode_8c.html#a8">IopRemoveTreeDeviceNode</a> (IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> DeviceNode)</td></tr>

</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a0" doxytag="devnode.c::ENUM_CONTEXT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d3/struct__ENUM__CONTEXT.html">_ENUM_CONTEXT</a>  <a class="el" href="../../d6/d3/struct__ENUM__CONTEXT.html">ENUM_CONTEXT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="devnode.c::PENUM_CONTEXT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d3/struct__ENUM__CONTEXT.html">_ENUM_CONTEXT</a> * <a class="el" href="../../d6/d3/struct__ENUM__CONTEXT.html">PENUM_CONTEXT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d6/devnode_8c-source.html#l00237">IopForAllDeviceNodesCallback()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3" doxytag="devnode.c::IopAllocateDeviceNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> IopAllocateDeviceNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PhysicalDeviceObject</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/devnode_8c-source.html#l00056">56</a> of file <a class="el" href="../../d5/d6/devnode_8c-source.html">devnode.c</a>.
<p>
References <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00208">_DEVICE_NODE::BusNumber</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00215">_DEVICE_NODE::ChildBusNumber</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00216">_DEVICE_NODE::ChildBusTypeIndex</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00214">_DEVICE_NODE::ChildInterfaceType</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a117">DEVICE_NODE</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00239">_DEVICE_NODE::DeviceArbiterList</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01274">_DEVOBJ_EXTENSION::DeviceNode</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01210">_DEVICE_OBJECT::DeviceObjectExtension</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00246">_DEVICE_NODE::DeviceTranslatorList</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01159">DO_DEVICE_INITIALIZING</a>, <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html#o42">_DEVICE_NODE::DockInfo</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00170">_DEVICE_NODE::EnumerationMutex</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00129">_DEVICE_NODE::Flags</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00207">_DEVICE_NODE::InterfaceType</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00037">IOP_DNOD_TAG</a>, <a class="el" href="../../d2/d9/pnpdata_8c-source.html#l00098">IopNumberDeviceNodes</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01066">KeInitializeEvent</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00341">_DEVICE_NODE::PendedSetInterfaceState</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00151">_DEVICE_NODE::PhysicalDeviceObject</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00232">_DEVICE_NODE::TargetDeviceNotify</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01163">IopEnumerateDevice()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l05911">IopFindLegacyDeviceNode()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00879">IopInitializeDeviceInstanceKey()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, and <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01548">IoReportDetectedDevice()</a>.
<p>
<pre class="fragment"><div>00062                    :
00063 
00064     This function allocates a device node from nonpaged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> and initializes
00065     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> fields which <span class="keywordflow">do</span> not require to hold lock to <span class="keywordflow">do</span> so.  Since adding
00066     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device node to pnp mgr's device node tree requires acquiring lock,
00067     <span class="keyword">this</span> routine does not add <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device node to device node tree.
00068 
00069 Arguments:
00070 
00071     PhysicalDeviceObject - Supplies a pointer to its corresponding physical device
00072         object.
00073 
00074 Return Value:
00075 
00076     a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> newly created device node. Null <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> failed.
00077 
00078 --*/
00079 {
00080     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> deviceNode;
00081 
00082     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00083 
00084     deviceNode = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(
00085                     NonPagedPool,
00086                     <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">DEVICE_NODE</a>),
00087                     IOP_DNOD_TAG
00088                     );
00089 
00090     <span class="keywordflow">if</span> (deviceNode == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ){
00091         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00092     }
00093 
00094     InterlockedIncrement (&amp;IopNumberDeviceNodes);
00095 
00096     RtlZeroMemory(deviceNode, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">DEVICE_NODE</a>));
00097     deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o17">InterfaceType</a> = InterfaceTypeUndefined;
00098     deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o18">BusNumber</a> = (ULONG)-1;
00099     deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o19">ChildInterfaceType</a> = InterfaceTypeUndefined;
00100     deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o20">ChildBusNumber</a> = (ULONG)-1;
00101     deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o21">ChildBusTypeIndex</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)-1;
00102 
00103     <a class="code" href="../../d4/d9/ke_8h.html#a20">KeInitializeEvent</a>( &amp;deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o12">EnumerationMutex</a>,
00104                        SynchronizationEvent,
00105                        TRUE );
00106 
00107     InitializeListHead(&amp;deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o24">DeviceArbiterList</a>);
00108     InitializeListHead(&amp;deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o25">DeviceTranslatorList</a>);
00109 
00110     <span class="keywordflow">if</span> (PhysicalDeviceObject){
00111 
00112         deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o9">PhysicalDeviceObject</a> = PhysicalDeviceObject;
00113         PhysicalDeviceObject-&gt;<a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html#o25">DeviceObjectExtension</a>-&gt;<a class="code" href="../../d3/d5/struct__DEVOBJ__EXTENSION.html#o6">DeviceNode</a> = (PVOID)deviceNode;
00114         PhysicalDeviceObject-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o6">Flags</a> &amp;= ~<a class="code" href="../../d0/d5/io_8h.html#a128">DO_DEVICE_INITIALIZING</a>;
00115     }
00116 
00117     InitializeListHead(&amp;deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o23">TargetDeviceNotify</a>);
00118 
00119     InitializeListHead(&amp;deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o42">DockInfo</a>.ListEntry);
00120 
00121     InitializeListHead(&amp;deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o44">PendedSetInterfaceState</a>);
00122 
00123     <span class="keywordflow">return</span> deviceNode;
00124 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="devnode.c::IopDestroyDeviceNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopDestroyDeviceNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceNode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/devnode_8c-source.html#l00297">297</a> of file <a class="el" href="../../d5/d6/devnode_8c-source.html">devnode.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00570">DNF_LEGACY_RESOURCE_DEVICENODE</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00610">DNUF_NOT_DISABLEABLE</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01164">DO_BUS_ENUMERATED_DEVICE</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d2/d9/pnpdata_8c-source.html#l00098">IopNumberDeviceNodes</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00191">IopUncacheInterfaceInformation()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00076">_PENDING_SET_INTERFACE_STATE::LinkName</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html#o32">_DEVICE_NODE::OverUsed1</a>, <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html#o34">_DEVICE_NODE::OverUsed2</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d0/d5/io_8h.html#a364">PINTERFACE</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00635">PNP_ERR_ACTIVE_PDO_FREED</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a113">PPENDING_SET_INTERFACE_STATE</a>, and <a class="el" href="../../d9/d0/pnpiop_8h.html#a130">PPI_RESOURCE_TRANSLATOR_ENTRY</a>.
<p>
<pre class="fragment"><div>00303                    :
00304 
00305     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> invoked by <a class="code" href="../../d0/d6/iop_8h.html#a163">IopDeleteDevice</a> to clean up <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device object's
00306     device node structure.
00307 
00308 Arguments:
00309 
00310     DeviceNode - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device node whose subtree <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be walked.
00311 
00312     Context - Supplies a context which contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller specified call back
00313               function and parameter.
00314 
00315 Return Value:
00316 
00317     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> value.
00318 
00319 --*/
00320 
00321 {
00322     PLIST_ENTRY listHead, nextEntry, entry;
00323     <a class="code" href="../../d8/d5/struct__PI__RESOURCE__TRANSLATOR__ENTRY.html">PPI_RESOURCE_TRANSLATOR_ENTRY</a> handlerEntry;
00324     <a class="code" href="../../d8/d3/struct__INTERFACE.html">PINTERFACE</a> interface;
00325 
00326     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00327 
00328     <span class="keywordflow">if</span> (DeviceNode) {
00329 
00330         <span class="keywordflow">if</span> ((DeviceNode-&gt;PhysicalDeviceObject-&gt;Flags &amp; <a class="code" href="../../d0/d5/io_8h.html#a133">DO_BUS_ENUMERATED_DEVICE</a>) &amp;&amp;
00331             DeviceNode-&gt;Parent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
00332 
00333             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>( PNP_DETECTED_FATAL_ERROR,
00334                           PNP_ERR_ACTIVE_PDO_FREED,
00335                           (ULONG_PTR)DeviceNode-&gt;PhysicalDeviceObject,
00336                           0,
00337                           0);
00338         }
00339 
00340 <span class="preprocessor">#if DBG</span>
00341 <span class="preprocessor"></span>
00342         <span class="comment">//</span>
00343         <span class="comment">// If Only Parent is NOT NULL, most likely the driver forgot to</span>
00344         <span class="comment">// release resources before deleting its FDO.  (The driver previously</span>
00345         <span class="comment">// call legacy assign resource interface.)</span>
00346         <span class="comment">//</span>
00347 
00348         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DeviceNode-&gt;Child == NULL &amp;&amp;
00349                DeviceNode-&gt;Sibling == NULL &amp;&amp;
00350                DeviceNode-&gt;LastChild == NULL
00351                );
00352 
00353         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DeviceNode-&gt;DockInfo.SerialNumber == NULL &amp;&amp;
00354                IsListEmpty(&amp;DeviceNode-&gt;DockInfo.ListEntry));
00355 
00356         <span class="keywordflow">if</span> (DeviceNode-&gt;PhysicalDeviceObject-&gt;Flags &amp; <a class="code" href="../../d0/d5/io_8h.html#a133">DO_BUS_ENUMERATED_DEVICE</a>) {
00357             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (DeviceNode-&gt;Parent == 0);
00358         }
00359 
00360         <span class="keywordflow">if</span> (DeviceNode-&gt;PreviousResourceList) {
00361             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(DeviceNode-&gt;PreviousResourceList);
00362         }
00363         <span class="keywordflow">if</span> (DeviceNode-&gt;PreviousResourceRequirements) {
00364             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(DeviceNode-&gt;PreviousResourceRequirements);
00365         }
00366 
00367         <span class="comment">//</span>
00368         <span class="comment">// device should not appear to be not-disableable if/when we get here</span>
00369         <span class="comment">// if either of these two lines ASSERT, email: jamiehun</span>
00370         <span class="comment">//</span>
00371 
00372         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((DeviceNode-&gt;UserFlags &amp; DNUF_NOT_DISABLEABLE) == 0);
00373         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DeviceNode-&gt;DisableableDepends == 0);
00374 
00375 <span class="preprocessor">#endif</span>
00376 <span class="preprocessor"></span>        <span class="comment">//</span>
00377         <span class="comment">// If this devicenode is our internal one used for legacy</span>
00378         <span class="comment">// resource allocation, then clean up. Find this devicenode </span>
00379         <span class="comment">// in the list of legacy resource devnodes hanging off the</span>
00380         <span class="comment">// legacy devicenode in the tree and remove it.</span>
00381         <span class="comment">//</span>
00382         <span class="comment">// BUGBUG: SantoshJ 10/15/99: We should be releasing</span>
00383         <span class="comment">// resources assigned to this device.</span>
00384         <span class="comment">//</span>
00385         
00386         <span class="keywordflow">if</span> (DeviceNode-&gt;Flags &amp; <a class="code" href="../../d9/d0/pnpiop_8h.html#a34">DNF_LEGACY_RESOURCE_DEVICENODE</a>) {
00387 
00388             <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>    resourceDeviceNode;
00389 
00390             <span class="keywordflow">for</span> (   resourceDeviceNode = (<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>)DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o32">OverUsed1</a>.LegacyDeviceNode;
00391                     resourceDeviceNode;
00392                     resourceDeviceNode = resourceDeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o34">OverUsed2</a>.NextResourceDeviceNode) {
00393 
00394                     <span class="keywordflow">if</span> (resourceDeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o34">OverUsed2</a>.NextResourceDeviceNode == DeviceNode) {
00395 
00396                         resourceDeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o34">OverUsed2</a>.NextResourceDeviceNode = DeviceNode-&gt;OverUsed2.NextResourceDeviceNode;
00397                         <span class="keywordflow">break</span>;
00398 
00399                     }
00400             }
00401         }
00402 
00403         <span class="keywordflow">if</span> (DeviceNode-&gt;DuplicatePDO) {
00404             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(DeviceNode-&gt;DuplicatePDO);
00405         }
00406         <span class="keywordflow">if</span> (DeviceNode-&gt;ServiceName.Length != 0) {
00407             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(DeviceNode-&gt;ServiceName.Buffer);
00408         }
00409         <span class="keywordflow">if</span> (DeviceNode-&gt;InstancePath.Length != 0) {
00410             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(DeviceNode-&gt;InstancePath.Buffer);
00411         }
00412         <span class="keywordflow">if</span> (DeviceNode-&gt;ResourceRequirements) {
00413             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(DeviceNode-&gt;ResourceRequirements);
00414         }
00415 
00416         <span class="comment">//</span>
00417         <span class="comment">// Dereference all the arbiters and translators on this PDO.</span>
00418         <span class="comment">//</span>
00419         <a class="code" href="../../d0/d1/pnpirp_8c.html#a17">IopUncacheInterfaceInformation</a>(DeviceNode-&gt;PhysicalDeviceObject) ;
00420 
00421         <span class="comment">//</span>
00422         <span class="comment">// Release any pended IoSetDeviceInterface structures</span>
00423         <span class="comment">//</span>
00424 
00425         <span class="keywordflow">while</span> (!IsListEmpty(&amp;DeviceNode-&gt;PendedSetInterfaceState)) {
00426 
00427             <a class="code" href="../../d9/d4/struct__PENDING__SET__INTERFACE__STATE.html">PPENDING_SET_INTERFACE_STATE</a> entry;
00428 
00429             entry = (<a class="code" href="../../d9/d4/struct__PENDING__SET__INTERFACE__STATE.html">PPENDING_SET_INTERFACE_STATE</a>)RemoveHeadList(&amp;DeviceNode-&gt;PendedSetInterfaceState);
00430 
00431             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(entry-&gt;<a class="code" href="../../d9/d4/struct__PENDING__SET__INTERFACE__STATE.html#o1">LinkName</a>.Buffer);
00432 
00433             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(entry);
00434         }
00435 
00436         DeviceNode-&gt;PhysicalDeviceObject-&gt;DeviceObjectExtension-&gt;DeviceNode = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00437         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(DeviceNode);
00438         <a class="code" href="../../d1/d0/pnpdata_8c.html#a12">IopNumberDeviceNodes</a>--;
00439     }
00440 }
<span class="comment">//</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="devnode.c::IopForAllChildDeviceNodes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS IopForAllChildDeviceNodes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Parent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d0/pnpiop_8h.html#a118">PENUM_CALLBACK</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Callback</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/devnode_8c-source.html#l00179">179</a> of file <a class="el" href="../../d5/d6/devnode_8c-source.html">devnode.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00093">_DEVICE_NODE::Sibling</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/devnode_8c-source.html#l00127">IopForAllDeviceNodes()</a>, <a class="el" href="../../d5/d6/devnode_8c-source.html#l00237">IopForAllDeviceNodesCallback()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l01117">IopProcessAddDevicesWorker()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l01328">IopProcessAssignResourcesWorker()</a>, and <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00912">IopProcessStartDevicesWorker()</a>.
<p>
<pre class="fragment"><div>00187                    :
00188 
00189     This function walks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Parent's device node subtree and perform caller specified
00190     'Callback' function <span class="keywordflow">for</span> each device node under Parent.
00191 
00192     Note, befor calling <span class="keyword">this</span> rotuine, callers must acquire <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> enumeration mutex
00193     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> 'Parent' device node to make sure its children won'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> go away unless <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00194     call tells them to.
00195 
00196 Arguments:
00197 
00198     Parent - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device node whose subtree <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be walked.
00199 
00200     Callback - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call back routine <span class="keywordflow">for</span> each device node.
00201 
00202     Context - Supplies a parameter/context <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> callback function.
00203 
00204 Return Value:
00205 
00206     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> value.
00207 
00208 --*/
00209 
00210 {
00211     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> nextChild = Parent-&gt;Child;
00212     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a> child;
00213     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status = STATUS_SUCCESS;
00214 
00215     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00216 
00217     <span class="comment">//</span>
00218     <span class="comment">// Process siblings until we find the end of the sibling list or</span>
00219     <span class="comment">// the Callback() returns FALSE.  Set result = TRUE at the top of</span>
00220     <span class="comment">// the loop so that if there are no siblings we will return TRUE,</span>
00221     <span class="comment">// e.g. Keep Enumerating.</span>
00222     <span class="comment">//</span>
00223     <span class="comment">// Note, we need to find next child before calling Callback function</span>
00224     <span class="comment">// in case the current child is deleted by the Callback function.</span>
00225     <span class="comment">//</span>
00226 
00227     <span class="keywordflow">while</span> (nextChild &amp;&amp; <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00228         child = nextChild;
00229         nextChild = child-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o0">Sibling</a>;
00230         status = Callback(child, Context);
00231     }
00232 
00233     <span class="keywordflow">return</span> status;
00234 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="devnode.c::IopForAllDeviceNodes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS IopForAllDeviceNodes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d0/pnpiop_8h.html#a118">PENUM_CALLBACK</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Callback</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/devnode_8c-source.html#l00127">127</a> of file <a class="el" href="../../d5/d6/devnode_8c-source.html">devnode.c</a>.
<p>
References <a class="el" href="../../d5/d6/devnode_8c-source.html#l00030">_ENUM_CONTEXT::CallersCallback</a>, <a class="el" href="../../d5/d6/devnode_8c-source.html#l00031">_ENUM_CONTEXT::CallersContext</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l01266">IopAcquireEnumerationLock</a>, <a class="el" href="../../d5/d6/devnode_8c-source.html#l00179">IopForAllChildDeviceNodes()</a>, <a class="el" href="../../d5/d6/devnode_8c-source.html#l00237">IopForAllDeviceNodesCallback()</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l01276">IopReleaseEnumerationLock</a>, <a class="el" href="../../d2/d9/pnpdata_8c-source.html#l00056">IopRootDeviceNode</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00642">PENUM_CALLBACK</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l05109">IopProcessNewProfileWorker()</a>.
<p>
<pre class="fragment"><div>00134                    :
00135 
00136     This function walks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device node tree and perform caller specified
00137     'Callback' function <span class="keywordflow">for</span> each device node.
00138 
00139     Note, <span class="keyword">this</span> routine (or its worker routine) traverses <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tree in a top
00140     down manner.
00141 
00142 Arguments:
00143 
00144     Callback - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call back routine <span class="keywordflow">for</span> each device node.
00145 
00146     Context - Supplies a parameter/context <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> callback function.
00147 
00148 Return Value:
00149 
00150     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> returned from Callback, <span class="keywordflow">if</span> not successfull then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tree walking stops.
00151 
00152 --*/
00153 {
00154     <a class="code" href="../../d6/d3/struct__ENUM__CONTEXT.html">ENUM_CONTEXT</a> enumContext;
00155     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00156 
00157     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00158 
00159     enumContext.<a class="code" href="../../d6/d3/struct__ENUM__CONTEXT.html#o0">CallersCallback</a> = Callback;
00160     enumContext.<a class="code" href="../../d6/d3/struct__ENUM__CONTEXT.html#o1">CallersContext</a> = Context;
00161 
00162     <span class="comment">//</span>
00163     <span class="comment">// Start with a pointer to the root device node, recursively examine all the</span>
00164     <span class="comment">// children until we the callback function says stop or we've looked at all</span>
00165     <span class="comment">// of them.</span>
00166     <span class="comment">//</span>
00167 
00168     <a class="code" href="../../d9/d0/pnpiop_8h.html#a95">IopAcquireEnumerationLock</a>(IopRootDeviceNode);
00169 
00170     status = <a class="code" href="../../d9/d0/pnpiop_8h.html#a270">IopForAllChildDeviceNodes</a>(IopRootDeviceNode,
00171                                        IopForAllDeviceNodesCallback,
00172                                        (PVOID)&amp;enumContext );
00173 
00174     <a class="code" href="../../d9/d0/pnpiop_8h.html#a96">IopReleaseEnumerationLock</a>(IopRootDeviceNode);
00175     <span class="keywordflow">return</span> status;
00176 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="devnode.c::IopForAllDeviceNodesCallback" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS IopForAllDeviceNodesCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceNode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/devnode_8c-source.html#l00237">237</a> of file <a class="el" href="../../d5/d6/devnode_8c-source.html">devnode.c</a>.
<p>
References <a class="el" href="../../d5/d6/devnode_8c-source.html#l00030">_ENUM_CONTEXT::CallersCallback</a>, <a class="el" href="../../d5/d6/devnode_8c-source.html#l00031">_ENUM_CONTEXT::CallersContext</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l01266">IopAcquireEnumerationLock</a>, <a class="el" href="../../d5/d6/devnode_8c-source.html#l00179">IopForAllChildDeviceNodes()</a>, <a class="el" href="../../d5/d6/devnode_8c-source.html#l00237">IopForAllDeviceNodesCallback()</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l01276">IopReleaseEnumerationLock</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d4/d7/devnode_8c.html#a1">PENUM_CONTEXT</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/devnode_8c-source.html#l00127">IopForAllDeviceNodes()</a>, and <a class="el" href="../../d5/d6/devnode_8c-source.html#l00237">IopForAllDeviceNodesCallback()</a>.
<p>
<pre class="fragment"><div>00244                    :
00245 
00246     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> worker routine <span class="keywordflow">for</span> <a class="code" href="../../d4/d7/devnode_8c.html#a5">IopForAllChildDeviceNodes</a> routine.
00247 
00248 Arguments:
00249 
00250     DeviceNode - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device node whose subtree <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be walked.
00251 
00252     Context - Supplies a context which contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller specified call back
00253               function and parameter.
00254 
00255 Return Value:
00256 
00257     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> value.
00258 
00259 --*/
00260 
00261 {
00262     <a class="code" href="../../d6/d3/struct__ENUM__CONTEXT.html">PENUM_CONTEXT</a> enumContext;
00263     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00264 
00265     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00266 
00267     enumContext = (<a class="code" href="../../d6/d3/struct__ENUM__CONTEXT.html">PENUM_CONTEXT</a>)Context;
00268 
00269     <span class="comment">//</span>
00270     <span class="comment">// First call the caller's callback for this devnode</span>
00271     <span class="comment">//</span>
00272 
00273     status =
00274         enumContext-&gt;<a class="code" href="../../d6/d3/struct__ENUM__CONTEXT.html#o0">CallersCallback</a>(DeviceNode, enumContext-&gt;<a class="code" href="../../d6/d3/struct__ENUM__CONTEXT.html#o1">CallersContext</a>);
00275 
00276     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00277 
00278         <span class="comment">//</span>
00279         <span class="comment">// Now enumerate the children, if any.</span>
00280         <span class="comment">//</span>
00281 
00282         <a class="code" href="../../d9/d0/pnpiop_8h.html#a95">IopAcquireEnumerationLock</a>(DeviceNode);
00283 
00284         <span class="keywordflow">if</span>( DeviceNode-&gt;Child) {
00285 
00286             status = <a class="code" href="../../d9/d0/pnpiop_8h.html#a270">IopForAllChildDeviceNodes</a>(
00287                                         DeviceNode,
00288                                         IopForAllDeviceNodesCallback,
00289                                         Context);
00290         }
00291         <a class="code" href="../../d9/d0/pnpiop_8h.html#a96">IopReleaseEnumerationLock</a>(DeviceNode);
00292     }
00293 
00294     <span class="keywordflow">return</span> status;
00295 }
<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="devnode.c::IopInsertTreeDeviceNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopInsertTreeDeviceNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ParentNode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceNode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/devnode_8c-source.html#l00447">447</a> of file <a class="el" href="../../d5/d6/devnode_8c-source.html">devnode.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d9/pnpdata_8c-source.html#l00155">IoDeviceNodeTreeSequence</a>, <a class="el" href="../../d2/d9/pnpdata_8c-source.html#l00178">IopMaxDeviceNodeLevel</a>, <a class="el" href="../../d2/d9/pnpdata_8c-source.html#l00056">IopRootDeviceNode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00105">_DEVICE_NODE::Parent</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01163">IopEnumerateDevice()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00879">IopInitializeDeviceInstanceKey()</a>, and <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01548">IoReportDetectedDevice()</a>.
<p>
<pre class="fragment"><div>00452 {
00453     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>    deviceNode;
00454     PLIST_ENTRY     *p;
00455     LONG            i;
00456 
00457     <span class="comment">//</span>
00458     <span class="comment">// Put this devnode at the end of the parent's list of children.</span>
00459     <span class="comment">//</span>
00460 
00461     DeviceNode-&gt;Parent = ParentNode;
00462     <span class="keywordflow">if</span> (ParentNode-&gt;LastChild) {
00463         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ParentNode-&gt;LastChild-&gt;Sibling == NULL);
00464         ParentNode-&gt;LastChild-&gt;Sibling = DeviceNode;
00465         ParentNode-&gt;LastChild = DeviceNode;
00466     } <span class="keywordflow">else</span> {
00467         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ParentNode-&gt;Child == NULL);
00468         ParentNode-&gt;Child = ParentNode-&gt;LastChild = DeviceNode;
00469     }
00470 
00471     <span class="comment">//</span>
00472     <span class="comment">// Determine the depth of the devnode.</span>
00473     <span class="comment">//</span>
00474 
00475     <span class="keywordflow">for</span> (deviceNode = DeviceNode;
00476          deviceNode != <a class="code" href="../../d1/d0/pnpdata_8c.html#a5">IopRootDeviceNode</a>;
00477          deviceNode = deviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o2">Parent</a>) {
00478         DeviceNode-&gt;Level++;
00479     }
00480 
00481     <span class="keywordflow">if</span> (DeviceNode-&gt;Level &gt; <a class="code" href="../../d1/d0/pnpdata_8c.html#a25">IopMaxDeviceNodeLevel</a>) {
00482         <a class="code" href="../../d1/d0/pnpdata_8c.html#a25">IopMaxDeviceNodeLevel</a> = DeviceNode-&gt;Level;
00483     }
00484 
00485     <span class="comment">//</span>
00486     <span class="comment">// Tree has changed</span>
00487     <span class="comment">//</span>
00488 
00489     <a class="code" href="../../d1/d0/pnpdata_8c.html#a21">IoDeviceNodeTreeSequence</a> += 1;
00490 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="devnode.c::IopRemoveTreeDeviceNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID IopRemoveTreeDeviceNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceNode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/devnode_8c-source.html#l00494">494</a> of file <a class="el" href="../../d5/d6/devnode_8c-source.html">devnode.c</a>.
<p>
References <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00099">_DEVICE_NODE::Child</a>, <a class="el" href="../../d9/d0/pnpiop_8h.html#a385">IopOrphanNotification()</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00111">_DEVICE_NODE::LastChild</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00105">_DEVICE_NODE::Parent</a>, and <a class="el" href="../../d0/d0/pnpiop_8h-source.html#l00093">_DEVICE_NODE::Sibling</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00232">IopDeleteLockedDeviceNode()</a>, and <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l01572">IopUnlockDeviceRemovalRelations()</a>.
<p>
<pre class="fragment"><div>00499                    :
00500 
00501     This function removes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device node from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device node tree
00502 
00503     N.B. The caller must own <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device tree lock of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent's enumeration lock
00504 
00505 Arguments:
00506 
00507     DeviceNode      - Device node to remove
00508 
00509 Return Value:
00510 
00511 
00512 --*/
00513 {
00514     <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">PDEVICE_NODE</a>        *Node;
00515 
00516     <span class="comment">//</span>
00517     <span class="comment">// Ulink the pointer to this device node.  (If this is the</span>
00518     <span class="comment">// first entry, unlink it from the parents child pointer, else</span>
00519     <span class="comment">// remove it from the sibling list)</span>
00520     <span class="comment">//</span>
00521 
00522     Node = &amp;DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o1">Child</a>;
00523     <span class="keywordflow">while</span> (*Node != DeviceNode) {
00524         Node = &amp;(*Node)-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o0">Sibling</a>;
00525     }
00526     *Node = DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o0">Sibling</a>;
00527 
00528     <span class="keywordflow">if</span> (DeviceNode-&gt;Parent-&gt;Child == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00529         DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o3">LastChild</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00530     } <span class="keywordflow">else</span> {
00531         <span class="keywordflow">while</span> (*Node) {
00532             Node = &amp;(*Node)-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o0">Sibling</a>;
00533         }
00534         DeviceNode-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o2">Parent</a>-&gt;<a class="code" href="../../d4/d4/struct__DEVICE__NODE.html#o3">LastChild</a> = CONTAINING_RECORD(Node, <a class="code" href="../../d4/d4/struct__DEVICE__NODE.html">DEVICE_NODE</a>, Sibling);
00535     }
00536 
00537 
00538     <span class="comment">//</span>
00539     <span class="comment">// Orphan any outstanding device change notifications on these nodes.</span>
00540     <span class="comment">//</span>
00541     <a class="code" href="../../d9/d0/pnpiop_8h.html#a385">IopOrphanNotification</a>(DeviceNode);
00542 
00543     <span class="comment">//</span>
00544     <span class="comment">// No longer linked</span>
00545     <span class="comment">//</span>
00546 
00547     DeviceNode-&gt;Parent    = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00548     DeviceNode-&gt;Child     = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00549     DeviceNode-&gt;Sibling   = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00550     DeviceNode-&gt;LastChild = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00551 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:27 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
