<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rtl/regutil.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>regutil.c File Reference</h1><code>#include "<a class="el" href="../../d6/d8/ntrtlp_8h-source.html">ntrtlp.h</a>"</code><br>
<code>#include &lt;ctype.h&gt;</code><br>

<p>
<a href="../../d5/d6/rtl_2regutil_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a0">MAX_USTRING</a>&nbsp;&nbsp;&nbsp;( sizeof(WCHAR) * (MAXUSHORT/sizeof(WCHAR)) )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a1">MAX_NONNULL_USTRING</a>&nbsp;&nbsp;&nbsp;( MAX_USTRING - sizeof(UNICODE_NULL) )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a2">QuadAlignPtr</a>(P)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a3">SIZE_OF_TOKEN_INFORMATION</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a13">RtlpGetRegistryHandle</a> (IN ULONG RelativeTo, IN PCWSTR <a class="el" href="../../d8/d3/rtvbatcr_8c.html#a3">KeyName</a>, IN BOOLEAN WriteAccess, OUT PHANDLE <a class="el" href="../../d3/d0/user32_8def.html#a52">Key</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a14">RtlpQueryRegistryDirect</a> (IN ULONG ValueType, IN PVOID ValueData, IN ULONG ValueLength, IN OUT PVOID Destination)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a15">RtlpCallQueryRegistryRoutine</a> (IN PRTL_QUERY_REGISTRY_TABLE QueryTable, IN PKEY_VALUE_FULL_INFORMATION KeyValueInformation, IN OUT PULONG PKeyValueInfoLength, IN PVOID Context, IN PVOID Environment OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a16">RtlpAllocDeallocQueryBuffer</a> (IN OUT SIZE_T *PAllocLength OPTIONAL, IN PVOID OldKeyValueInformation OPTIONAL, IN SIZE_T OldAllocLength OPTIONAL, OUT NTSTATUS *pStatus OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a17">RtlpInitCurrentUserString</a> (OUT PUNICODE_STRING UserString)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a18">RtlpGetTimeZoneInfoHandle</a> (IN BOOLEAN WriteAccess, OUT PHANDLE <a class="el" href="../../d3/d0/user32_8def.html#a52">Key</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a19">RtlQueryRegistryValues</a> (IN ULONG RelativeTo, IN PCWSTR Path, IN PRTL_QUERY_REGISTRY_TABLE QueryTable, IN PVOID Context, IN PVOID Environment OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a20">RtlWriteRegistryValue</a> (IN ULONG RelativeTo, IN PCWSTR Path, IN PCWSTR <a class="el" href="../../d8/d2/rtrenval_8c.html#a3">ValueName</a>, IN ULONG ValueType, IN PVOID ValueData, IN ULONG ValueLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a21">RtlCheckRegistryKey</a> (IN ULONG RelativeTo, IN PWSTR Path)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a22">RtlCreateRegistryKey</a> (IN ULONG RelativeTo, IN PWSTR Path)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a23">RtlDeleteRegistryValue</a> (IN ULONG RelativeTo, IN PCWSTR Path, IN PCWSTR <a class="el" href="../../d8/d2/rtrenval_8c.html#a3">ValueName</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a24">RtlExpandEnvironmentStrings_U</a> (IN PVOID Environment OPTIONAL, IN PUNICODE_STRING Source, OUT PUNICODE_STRING Destination, OUT PULONG ReturnedLength OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a25">RtlGetNtGlobalFlags</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a26">RtlFormatCurrentUserKeyPath</a> (OUT PUNICODE_STRING CurrentUserKeyPath)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a27">RtlOpenCurrentUser</a> (IN ULONG DesiredAccess, OUT PHANDLE CurrentUserKey)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a28">RtlQueryTimeZoneInformation</a> (OUT PRTL_TIME_ZONE_INFORMATION TimeZoneInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a29">RtlSetTimeZoneInformation</a> (IN PRTL_TIME_ZONE_INFORMATION TimeZoneInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a30">RtlSetActiveTimeBias</a> (IN LONG ActiveBias)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>const PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a4">RtlpRegistryPaths</a> [RTL_REGISTRY_MAXIMUM]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>SIZE_T&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a5">RtlpRegistryQueryInitialBuffersize</a> = PAGE_SIZE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>const WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a6">szBias</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>const WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a7">szStandardName</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>const WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a8">szStandardBias</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>const WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a9">szStandardStart</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>const WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a10">szDaylightName</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>const WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a11">szDaylightBias</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>const WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a12">szDaylightStart</a> []</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="rtl/regutil.c::MAX_NONNULL_USTRING" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_NONNULL_USTRING&nbsp;&nbsp;&nbsp;( MAX_USTRING - sizeof(UNICODE_NULL) )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00192">192</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00281">RtlpCallQueryRegistryRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="rtl/regutil.c::MAX_USTRING" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_USTRING&nbsp;&nbsp;&nbsp;( sizeof(WCHAR) * (MAXUSHORT/sizeof(WCHAR)) )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00186">186</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00281">RtlpCallQueryRegistryRoutine()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00200">RtlpQueryRegistryDirect()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="rtl/regutil.c::QuadAlignPtr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define QuadAlignPtr          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">P&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(             \
    (PVOID)((((ULONG_PTR)(P)) + 7) &amp; (-8)) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00276">276</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00281">RtlpCallQueryRegistryRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="rtl/regutil.c::SIZE_OF_TOKEN_INFORMATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SIZE_OF_TOKEN_INFORMATION          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><span class="keyword">sizeof</span>( TOKEN_USER )                            \
    + <span class="keyword">sizeof</span>( SID )                                 \
    + <span class="keyword">sizeof</span>( ULONG ) * SID_MAX_SUB_AUTHORITIES
</div></pre>
<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01446">1446</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01453">RtlFormatCurrentUserKeyPath()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a21" doxytag="rtl/regutil.c::RtlCheckRegistryKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlCheckRegistryKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RelativeTo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Path</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01257">1257</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00092">RtlpGetRegistryHandle()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02249">Win32UserInitialize()</a>.
<p>
<pre class="fragment"><div>01261 {
01262     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01263     HANDLE <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
01264 
01265     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01266 
01267     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a13">RtlpGetRegistryHandle</a>( RelativeTo, Path, FALSE, &amp;Key );
01268     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01269         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01270         }
01271 
01272     ZwClose( Key );
01273     <span class="keywordflow">return</span> STATUS_SUCCESS;
01274 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="rtl/regutil.c::RtlCreateRegistryKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlCreateRegistryKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RelativeTo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Path</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01278">1278</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00092">RtlpGetRegistryHandle()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01282 {
01283     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01284     HANDLE <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
01285 
01286     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01287 
01288     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a13">RtlpGetRegistryHandle</a>( RelativeTo, Path, TRUE, &amp;Key );
01289     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01290         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01291     }
01292 
01293     ZwClose( Key );
01294     <span class="keywordflow">return</span> STATUS_SUCCESS;
01295 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="rtl/regutil.c::RtlDeleteRegistryValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlDeleteRegistryValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RelativeTo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Path</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01299">1299</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00092">RtlpGetRegistryHandle()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
<pre class="fragment"><div>01304 {
01305     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01306     UNICODE_STRING KeyValueName;
01307     HANDLE <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
01308 
01309     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01310 
01311     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a13">RtlpGetRegistryHandle</a>( RelativeTo, Path, TRUE, &amp;Key );
01312     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01313         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01314         }
01315 
01316     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyValueName, ValueName );
01317     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwDeleteValueKey( Key, &amp;KeyValueName );
01318 
01319     ZwClose( Key );
01320     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01321 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="rtl/regutil.c::RtlExpandEnvironmentStrings_U" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlExpandEnvironmentStrings_U           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID Environment&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>Destination</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG ReturnedLength&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01325">1325</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d6/d6/environ_8c-source.html#l00250">RtlQueryEnvironmentVariable_U()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d7/d8/restrfil_8c-source.html#l00879">InitializeRestrictedStuff()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00281">RtlpCallQueryRegistryRoutine()</a>.
<p>
<pre class="fragment"><div>01331 {
01332     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>, Status1;
01333     PWCHAR Src, Src1, Dst;
01334     UNICODE_STRING VariableName, VariableValue;
01335     ULONG SrcLength, DstLength, VarLength, RequiredLength;
01336 
01337     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01338 
01339     Src = Source-&gt;Buffer;
01340     SrcLength = Source-&gt;Length;
01341     Dst = Destination-&gt;Buffer;
01342     DstLength = Destination-&gt;MaximumLength;
01343     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01344     RequiredLength = 0;
01345     <span class="keywordflow">while</span> (SrcLength &gt;= <span class="keyword">sizeof</span>(WCHAR)) {
01346         <span class="keywordflow">if</span> (*Src == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'%'</span>) {
01347             Src1 = Src + 1;
01348             VarLength = 0;
01349             VariableName.Length = 0;
01350             VariableName.Buffer = Src1;
01351 
01352             <span class="keywordflow">while</span> (VarLength &lt; (SrcLength - <span class="keyword">sizeof</span>(WCHAR))) {
01353                 <span class="keywordflow">if</span> (*Src1 == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'%'</span>) {
01354                     <span class="keywordflow">if</span> (VarLength) {
01355                         VariableName.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)VarLength;
01356                         VariableName.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)VarLength;
01357                     }
01358                     <span class="keywordflow">break</span>;
01359 
01360                 }
01361 
01362                 Src1++;
01363                 VarLength += <span class="keyword">sizeof</span>(WCHAR);
01364             }
01365 
01366             <span class="keywordflow">if</span> (VariableName.Length) {
01367                 VariableValue.Buffer = Dst;
01368                 VariableValue.Length = 0;
01369                 VariableValue.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)DstLength;
01370                 Status1 = <a class="code" href="../../d5/d7/environ_8c.html#a6">RtlQueryEnvironmentVariable_U</a>( Environment,
01371                                                          &amp;VariableName,
01372                                                          &amp;VariableValue
01373                                                        );
01374                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status1 ) || Status1 == STATUS_BUFFER_TOO_SMALL) {
01375                     RequiredLength += VariableValue.Length;
01376                     Src = Src1 + 1;
01377                     SrcLength -= (VarLength + 2*<span class="keyword">sizeof</span>(WCHAR));
01378 
01379                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status1 )) {
01380                         DstLength -= VariableValue.Length;
01381                         Dst += VariableValue.Length / <span class="keyword">sizeof</span>(WCHAR);
01382 
01383                     } <span class="keywordflow">else</span> {
01384                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = Status1;
01385                     }
01386 
01387                     <span class="keywordflow">continue</span>;
01388                 }
01389             }
01390         }
01391 
01392         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01393             <span class="keywordflow">if</span> (DstLength &gt; <span class="keyword">sizeof</span>(WCHAR)) {
01394                 DstLength -= <span class="keyword">sizeof</span>(WCHAR);
01395                 *Dst++ = *Src;
01396 
01397             } <span class="keywordflow">else</span> {
01398                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01399             }
01400         }
01401 
01402         RequiredLength += <span class="keyword">sizeof</span>(WCHAR);
01403         SrcLength -= <span class="keyword">sizeof</span>(WCHAR);
01404         Src++;
01405     }
01406 
01407     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01408         <span class="keywordflow">if</span> (DstLength) {
01409             DstLength -= <span class="keyword">sizeof</span>(WCHAR);
01410             *Dst = UNICODE_NULL;
01411 
01412         } <span class="keywordflow">else</span> {
01413             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01414         }
01415     }
01416 
01417     RequiredLength += <span class="keyword">sizeof</span>(WCHAR);
01418 
01419     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ReturnedLength )) {
01420         *ReturnedLength = RequiredLength;
01421     }
01422 
01423     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01424         Destination-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(RequiredLength - <span class="keyword">sizeof</span>(WCHAR));
01425     }
01426 
01427     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01428 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="rtl/regutil.c::RtlFormatCurrentUserKeyPath" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlFormatCurrentUserKeyPath           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CurrentUserKeyPath</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01453">1453</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d1/ldrinit_8c-source.html#l00136">RtlAllocateStringRoutine</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01821">RtlAppendUnicodeToString()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01611">RtlConvertSidToUnicodeString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01532">RtlLengthSidAsUnicodeString()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01446">SIZE_OF_TOKEN_INFORMATION</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d7/d8/restrfil_8c-source.html#l00879">InitializeRestrictedStuff()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00103">InitPreviousUserString()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01564">RtlOpenCurrentUser()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00092">RtlpGetRegistryHandle()</a>.
<p>
<pre class="fragment"><div>01459                    :
01460 
01461     Initialize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied buffer with a string representation
01462     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current user's SID.
01463 
01464 Arguments:
01465 
01466     CurrentUserKeyPath - Returns a string that represents <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
01467         user's root key in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Registry.  Caller must call
01468         <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a> to free <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer when done with <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
01469 
01470 Return Value:
01471 
01472     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - Returns STATUS_SUCCESS <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user string was
01473         succesfully initialized.
01474 
01475 --*/
01476 
01477 {
01478     HANDLE TokenHandle;
01479     UCHAR TokenInformation[ <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a3">SIZE_OF_TOKEN_INFORMATION</a> ];
01480     ULONG ReturnLength;
01481     ULONG SidStringLength ;
01482     UNICODE_STRING SidString ;
01483     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01484 
01485     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenThreadToken( NtCurrentThread(),
01486                                  TOKEN_READ,
01487                                  TRUE,
01488                                  &amp;TokenHandle
01489                                );
01490 
01491     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) &amp;&amp; ( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_NO_TOKEN ) ) {
01492         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01493     }
01494 
01495     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) ) {
01496 
01497         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenProcessToken( NtCurrentProcess(),
01498                                      TOKEN_READ,
01499                                      &amp;TokenHandle
01500                                    );
01501         <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01502             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01503         }
01504     }
01505 
01506     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryInformationToken( TokenHandle,
01507                                       TokenUser,
01508                                       TokenInformation,
01509                                       <span class="keyword">sizeof</span>( TokenInformation ),
01510                                       &amp;ReturnLength
01511                                     );
01512 
01513     ZwClose( TokenHandle );
01514 
01515     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01516         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01517     }
01518 
01519     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a48">RtlLengthSidAsUnicodeString</a>(
01520                         ((PTOKEN_USER)TokenInformation)-&gt;User.Sid,
01521                         &amp;SidStringLength
01522                         );
01523 
01524     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) ) {
01525         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> ;
01526     }
01527 
01528     CurrentUserKeyPath-&gt;Length = 0;
01529     CurrentUserKeyPath-&gt;MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(SidStringLength +
01530                                         <span class="keyword">sizeof</span>( <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\REGISTRY\\USER\\"</span> ) +
01531                                         <span class="keyword">sizeof</span>( UNICODE_NULL ));
01532     CurrentUserKeyPath-&gt;Buffer = (<a class="code" href="../../d8/d2/ldrinit_8c.html#a7">RtlAllocateStringRoutine</a>)( CurrentUserKeyPath-&gt;MaximumLength );
01533     <span class="keywordflow">if</span> (CurrentUserKeyPath-&gt;Buffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01534         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01535     }
01536 
01537     <span class="comment">//</span>
01538     <span class="comment">// Copy "\REGISTRY\USER" to the current user string.</span>
01539     <span class="comment">//</span>
01540 
01541     <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>( CurrentUserKeyPath, L<span class="stringliteral">"\\REGISTRY\\USER\\"</span> );
01542 
01543     SidString.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)SidStringLength ;
01544     SidString.Length = 0 ;
01545     SidString.Buffer = CurrentUserKeyPath-&gt;Buffer +
01546             (CurrentUserKeyPath-&gt;Length / <span class="keyword">sizeof</span>(WCHAR) );
01547 
01548     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a49">RtlConvertSidToUnicodeString</a>( &amp;SidString,
01549                                            ((PTOKEN_USER)TokenInformation)-&gt;User.Sid,
01550                                            FALSE
01551                                          );
01552     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01553         <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>( CurrentUserKeyPath );
01554 
01555     } <span class="keywordflow">else</span> {
01556         CurrentUserKeyPath-&gt;Length += SidString.Length ;
01557     }
01558 
01559     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01560 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="rtl/regutil.c::RtlGetNtGlobalFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG RtlGetNtGlobalFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01432">1432</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00370">NtGlobalFlag</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l00191">RtlCreateHeap()</a>, <a class="el" href="../../d1/d1/rtlexec_8c-source.html#l00813">RtlCreateUserProcess()</a>, <a class="el" href="../../d2/d8/rtl_2heap_8c-source.html#l04732">RtlpInitializeHeapSegment()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00059">UserClientDllInitialize()</a>, and <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.
<p>
<pre class="fragment"><div>01433 {
01434 <span class="preprocessor">#ifdef NTOS_KERNEL_RUNTIME</span>
01435 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d9/d2/ldrp_8h.html#a33">NtGlobalFlag</a>;
01436 <span class="preprocessor">#else</span>
01437 <span class="preprocessor"></span>    <span class="keywordflow">return</span> NtCurrentPeb()-&gt;NtGlobalFlag;
01438 <span class="preprocessor">#endif</span>
01439 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="rtl/regutil.c::RtlOpenCurrentUser" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlOpenCurrentUser           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>CurrentUserKey</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01564">1564</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01453">RtlFormatCurrentUserKeyPath()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00089">RtlpRegistryPaths</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/immhotky_8c-source.html#l00260">CliGetImeHotKeysFromRegistry()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00666">ExpGetCurrentUserUILanguage()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00585">ExpSetCurrentUserUILanguage()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03729">GetActiveKeyboardName()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02210">GetRegistryValues()</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01068">GetTimeouts()</a>, and <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00258">NtSetDefaultLocale()</a>.
<p>
<pre class="fragment"><div>01571                    :
01572 
01573     Attempts to open <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> HKEY_CURRENT_USER predefined handle.
01574 
01575 Arguments:
01576 
01577     DesiredAccess - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access to open <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key <span class="keywordflow">for</span>.
01578 
01579     CurrentUserKey - Returns a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key \REGISTRY\USER\*.
01580 
01581 Return Value:
01582 
01583     Returns ERROR_SUCCESS (0) for success; error-code for failure.
01584 
01585 --*/
01586 
01587 {
01588     UNICODE_STRING      CurrentUserKeyPath;
01589     OBJECT_ATTRIBUTES   Obja;
01590     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01591 
01592     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01593 
01594     <span class="comment">//</span>
01595     <span class="comment">// Format the registry path for the current user.</span>
01596     <span class="comment">//</span>
01597 
01598     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a26">RtlFormatCurrentUserKeyPath</a>( &amp;CurrentUserKeyPath );
01599     <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
01600 
01601         InitializeObjectAttributes( &amp;Obja,
01602                                     &amp;CurrentUserKeyPath,
01603                                     OBJ_CASE_INSENSITIVE,
01604                                     NULL,
01605                                     NULL
01606                                   );
01607         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenKey( CurrentUserKey,
01608                             DesiredAccess,
01609                             &amp;Obja
01610                           );
01611         <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>( &amp;CurrentUserKeyPath );
01612     }
01613 
01614     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
01615         <span class="comment">//</span>
01616         <span class="comment">// Opening \REGISTRY\USER&lt;SID&gt; failed, try \REGISTRY\USER\.DEFAULT</span>
01617         <span class="comment">//</span>
01618         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;CurrentUserKeyPath, RtlpRegistryPaths[ RTL_REGISTRY_USER ] );
01619         InitializeObjectAttributes( &amp;Obja,
01620                                     &amp;CurrentUserKeyPath,
01621                                     OBJ_CASE_INSENSITIVE,
01622                                     NULL,
01623                                     NULL
01624                                   );
01625 
01626         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenKey( CurrentUserKey,
01627                             DesiredAccess,
01628                             &amp;Obja
01629                           );
01630     }
01631 
01632     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01633 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="rtl/regutil.c::RtlpAllocDeallocQueryBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID RtlpAllocDeallocQueryBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT SIZE_T *PAllocLength&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID OldKeyValueInformation&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T OldAllocLength&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT NTSTATUS *pStatus&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00679">679</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00744">RtlQueryRegistryValues()</a>.
<p>
<pre class="fragment"><div>00685 {
00686    PVOID    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>     = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00687    <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>  = STATUS_SUCCESS;
00688 
00689 <span class="preprocessor">#ifdef NTOS_KERNEL_RUNTIME</span>
00690 <span class="preprocessor"></span>
00691    <span class="comment">//</span>
00692    <span class="comment">// Kernel version</span>
00693    <span class="comment">//</span>
00694 
00695    UNREFERENCED_PARAMETER( OldAllocLength );
00696 
00697    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT(OldKeyValueInformation) ) {
00698       <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( OldKeyValueInformation );
00699    }
00700 
00701    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT(PAllocLength) ) {
00702       <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a> = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, *PAllocLength, 'vrqR' );
00703       <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00704          <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00705       }
00706    }
00707 
00708 <span class="preprocessor">#else</span>
00709 <span class="preprocessor"></span>
00710    <span class="comment">//</span>
00711    <span class="comment">// User version</span>
00712    <span class="comment">//</span>
00713 
00714    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT(OldKeyValueInformation) ) {
00715        <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwFreeVirtualMemory( NtCurrentProcess(),
00716                                      &amp;OldKeyValueInformation,
00717                                      &amp;OldAllocLength,
00718                                      MEM_RELEASE );
00719    }
00720 
00721    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT(PAllocLength) ) {
00722 
00723        <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwAllocateVirtualMemory( NtCurrentProcess(),
00724                                      &amp;Ptr,
00725                                      0,
00726                                      PAllocLength,
00727                                      MEM_COMMIT,
00728                                      PAGE_READWRITE );
00729        <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00730           <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00731        }
00732    }
00733 
00734 <span class="preprocessor">#endif</span>
00735 <span class="preprocessor"></span>
00736    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT(pStatus) ) {
00737       *pStatus = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00738    }
00739 
00740    <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>;
00741 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="rtl/regutil.c::RtlpCallQueryRegistryRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpCallQueryRegistryRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRTL_QUERY_REGISTRY_TABLE&nbsp;</td>
          <td class="mdname" nowrap> <em>QueryTable</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEY_VALUE_FULL_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyValueInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PKeyValueInfoLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID Environment&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00281">281</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00192">MAX_NONNULL_USTRING</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00186">MAX_USTRING</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00154">Name</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00276">QuadAlignPtr</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01325">RtlExpandEnvironmentStrings_U()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00200">RtlpQueryRegistryDirect()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00744">RtlQueryRegistryValues()</a>.
<p>
<pre class="fragment"><div>00291                    :
00292 
00293     This function implements <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> a caller specified
00294     routine.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> reponsible <span class="keywordflow">for</span> capturing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> arguments <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00295     routine and then calling <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.  If not specifically disabled, <span class="keyword">this</span>
00296     routine will converted REG_EXPAND_SZ Registry values to REG_SZ by
00297     calling <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a24">RtlExpandEnvironmentStrings_U</a> prior to calling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> routine.
00298     It will also converted REG_MULTI_SZ registry values into multiple
00299     REG_SZ calls to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified routine.
00300 
00301     N.B. UNICODE_STRINGs cannot handle strings exceeding <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a0">MAX_USTRING</a> bytes. This creates
00302     issues both <span class="keywordflow">for</span> expansion and <span class="keywordflow">for</span> returning queries.  Whenever <span class="keyword">this</span> limitation
00303     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a encountered, we punt as best we can -- often returning an unexpanded, or perhaps
00304     truncated stream -- since <span class="keyword">this</span> seems to create fewer problems <span class="keywordflow">for</span> our callers than
00305     <span class="keywordflow">if</span> we unexpectedly fail.
00306 
00307 Arguments:
00308 
00309     QueryTable - specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current query table entry.
00310 
00311     KeyValueInformation - points to a buffer that contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information
00312         about <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current registry value.
00313 
00314     PKeyValueInfoLength - pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> KeyValueInformation
00315         buffer.  This function will use <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00316         unused portion at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end of <span class="keyword">this</span> buffer <span class="keywordflow">for</span> storing null terminated
00317         value name strings and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> expanded version of REG_EXPAND_SZ values.
00318         PKeyValueInfoLength returns an estimate of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> space required <span class="keywordflow">if</span>
00319         STATUS_BUFFER_TOO_SMALL <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.  This estimate can be used to retry
00320         with a larger buffer. Two retries may be required <span class="keywordflow">if</span> REG_EXPAND_SZ <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified.
00321 
00322     Context - specifies a 32-bit quantity that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> passed uninterpreted to
00323         each QueryRoutine called.
00324 
00325     Environment - optional parameter, that <span class="keywordflow">if</span> specified <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> environment
00326         used when expanding variable values in REG_EXPAND_SZ registry
00327         values.
00328 
00329 Return Value:
00330 
00331     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation.
00332 
00333 --*/
00334 {
00335     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00336     ULONG ValueType;
00337     PWSTR <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00338     PVOID ValueData;
00339     ULONG ValueLength;
00340     PWSTR s;
00341     PCHAR FreeMem;
00342     PCHAR EndFreeMem;
00343     LONG  FreeMemSize;
00344     ULONG KeyValueInfoLength;
00345     <span class="keywordtype">int</span>   retries;
00346 
00347 
00348     <span class="comment">//</span>
00349     <span class="comment">// Return 0 length unless we return STATUS_BUFFER_TOO_SMALL.</span>
00350     <span class="comment">//</span>
00351     KeyValueInfoLength = *PKeyValueInfoLength;
00352     *PKeyValueInfoLength = 0;
00353 
00354     <span class="comment">//</span>
00355     <span class="comment">// Initially assume the entire KeyValueInformation buffer is unused.</span>
00356     <span class="comment">//</span>
00357 
00358     FreeMem = (PCHAR)KeyValueInformation;
00359     FreeMemSize = KeyValueInfoLength;
00360     EndFreeMem = FreeMem + FreeMemSize;
00361 
00362     <span class="keywordflow">if</span> (KeyValueInformation-&gt;Type == REG_NONE ||
00363         (KeyValueInformation-&gt;DataLength == 0 &amp;&amp;
00364          KeyValueInformation-&gt;Type == QueryTable-&gt;DefaultType)
00365        ) {
00366 
00367         <span class="comment">//</span>
00368         <span class="comment">// If there is no registry value then see if they want to default</span>
00369         <span class="comment">// this value.</span>
00370         <span class="comment">//</span>
00371         <span class="keywordflow">if</span> (QueryTable-&gt;DefaultType == REG_NONE) {
00372             <span class="comment">//</span>
00373             <span class="comment">// No default value specified.  Return success unless this is</span>
00374             <span class="comment">// a required value.</span>
00375             <span class="comment">//</span>
00376             <span class="keywordflow">if</span> ( QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_REQUIRED ) {
00377                <span class="keywordflow">return</span> STATUS_OBJECT_NAME_NOT_FOUND;
00378             } <span class="keywordflow">else</span> {
00379                <span class="keywordflow">return</span> STATUS_SUCCESS;
00380             }
00381         }
00382 
00383         <span class="comment">//</span>
00384         <span class="comment">// Default requested.  Setup the value data pointers from the</span>
00385         <span class="comment">// information in the table entry.</span>
00386         <span class="comment">//</span>
00387 
00388         <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a> = QueryTable-&gt;Name,
00389         ValueType = QueryTable-&gt;DefaultType;
00390         ValueData = QueryTable-&gt;DefaultData;
00391         ValueLength = QueryTable-&gt;DefaultLength;
00392         <span class="keywordflow">if</span> (ValueLength == 0) {
00393             <span class="comment">//</span>
00394             <span class="comment">// If the length of the value is zero, then calculate the</span>
00395             <span class="comment">// actual length for REG_SZ, REG_EXPAND_SZ and REG_MULTI_SZ</span>
00396             <span class="comment">// value types.</span>
00397             <span class="comment">//</span>
00398 
00399             s = (PWSTR)ValueData;
00400             <span class="keywordflow">if</span> (ValueType == REG_SZ || ValueType == REG_EXPAND_SZ) {
00401                 <span class="keywordflow">while</span> (*s++ != UNICODE_NULL) {
00402                 }
00403                 ValueLength = (ULONG)((PCHAR)s - (PCHAR)ValueData);
00404 
00405             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ValueType == REG_MULTI_SZ) {
00406                 <span class="keywordflow">while</span> (*s != UNICODE_NULL) {
00407                     <span class="keywordflow">while</span> (*s++ != UNICODE_NULL) {
00408                         }
00409                     }
00410                 ValueLength = (ULONG)((PCHAR)s - (PCHAR)ValueData) + <span class="keyword">sizeof</span>( UNICODE_NULL );
00411             }
00412         }
00413 
00414     } <span class="keywordflow">else</span> {
00415         <span class="keywordflow">if</span> (!(QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_DIRECT)) {
00416             LONG ValueSpaceNeeded;
00417 
00418             <span class="comment">//</span>
00419             <span class="comment">// There is a registry value.  Calculate a pointer to the</span>
00420             <span class="comment">// free memory at the end of the value information buffer,</span>
00421             <span class="comment">// and its size.</span>
00422             <span class="comment">//</span>
00423             <span class="keywordflow">if</span> (KeyValueInformation-&gt;DataLength) {
00424                 FreeMem += KeyValueInformation-&gt;DataOffset +
00425                            KeyValueInformation-&gt;DataLength;
00426             } <span class="keywordflow">else</span> {
00427                 FreeMem += FIELD_OFFSET(KEY_VALUE_FULL_INFORMATION, Name) +
00428                            KeyValueInformation-&gt;NameLength;
00429             }
00430             FreeMem = (PCHAR)<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a2">QuadAlignPtr</a>(FreeMem);
00431             FreeMemSize = (ULONG) (EndFreeMem - FreeMem);
00432 
00433             <span class="comment">//</span>
00434             <span class="comment">// See if there is room in the free memory area for a null</span>
00435             <span class="comment">// terminated copy of the value name string.  If not return</span>
00436             <span class="comment">// the length we require (so far) and an error.</span>
00437             <span class="comment">//</span>
00438             ValueSpaceNeeded = KeyValueInformation-&gt;NameLength + <span class="keyword">sizeof</span>(UNICODE_NULL);
00439             <span class="keywordflow">if</span> ( FreeMemSize &lt; ValueSpaceNeeded ) {
00440 
00441                *PKeyValueInfoLength = (ULONG)(((PCHAR)FreeMem - (PCHAR)KeyValueInformation) + ValueSpaceNeeded);
00442                 <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
00443             }
00444 
00445             <span class="comment">//</span>
00446             <span class="comment">// There is room, so copy the string, and null terminate it.</span>
00447             <span class="comment">//</span>
00448 
00449             <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a> = (PWSTR)FreeMem;
00450             RtlCopyMemory( ValueName,
00451                            KeyValueInformation-&gt;Name,
00452                            KeyValueInformation-&gt;NameLength
00453                          );
00454             *(PWSTR)((PCHAR)<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a> + KeyValueInformation-&gt;NameLength) = UNICODE_NULL;
00455 
00456             <span class="comment">//</span>
00457             <span class="comment">// Update the free memory pointer and size to reflect the space we</span>
00458             <span class="comment">// just used for the null terminated value name.</span>
00459             <span class="comment">//</span>
00460             FreeMem += ValueSpaceNeeded;
00461             FreeMem = (PCHAR)<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a2">QuadAlignPtr</a>(FreeMem);
00462             FreeMemSize = (LONG) (EndFreeMem - FreeMem);
00463 
00464         } <span class="keywordflow">else</span> {
00465             <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a> = QueryTable-&gt;Name;
00466         }
00467 
00468         <span class="comment">//</span>
00469         <span class="comment">// Get the remaining data for the registry value.</span>
00470         <span class="comment">//</span>
00471 
00472         ValueType = KeyValueInformation-&gt;Type;
00473         ValueData = (PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset;
00474         ValueLength = KeyValueInformation-&gt;DataLength;
00475     }
00476 
00477     <span class="comment">//</span>
00478     <span class="comment">// Unless specifically disabled for this table entry, preprocess</span>
00479     <span class="comment">// registry values of type REG_EXPAND_SZ and REG_MULTI_SZ</span>
00480     <span class="comment">//</span>
00481 
00482     <span class="keywordflow">if</span> (!(QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_NOEXPAND)) {
00483         <span class="keywordflow">if</span> (ValueType == REG_MULTI_SZ) {
00484             PWSTR ValueEnd;
00485 
00486             <span class="comment">//</span>
00487             <span class="comment">// For REG_MULTI_SZ value type, call the query routine once</span>
00488             <span class="comment">// for each null terminated string in the registry value.  Fake</span>
00489             <span class="comment">// like this is multiple REG_SZ values with the same value name.</span>
00490             <span class="comment">//</span>
00491 
00492             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00493             ValueEnd = (PWSTR)((PCHAR)ValueData + ValueLength) - <span class="keyword">sizeof</span>(UNICODE_NULL);
00494             s = (PWSTR)ValueData;
00495             <span class="keywordflow">while</span> (s &lt; ValueEnd) {
00496                 <span class="keywordflow">while</span> (*s++ != UNICODE_NULL) {
00497                 }
00498 
00499                 ValueLength = (ULONG)((PCHAR)s - (PCHAR)ValueData);
00500                 <span class="keywordflow">if</span> (QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_DIRECT) {
00501                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a14">RtlpQueryRegistryDirect</a>( REG_SZ,
00502                                                       ValueData,
00503                                                       ValueLength,
00504                                                       QueryTable-&gt;EntryContext
00505                                                     );
00506                     (PUNICODE_STRING)(QueryTable-&gt;EntryContext) += 1;
00507 
00508                 } <span class="keywordflow">else</span> {
00509                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (QueryTable-&gt;QueryRoutine)( <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00510                                                          REG_SZ,
00511                                                          ValueData,
00512                                                          ValueLength,
00513                                                          Context,
00514                                                          QueryTable-&gt;EntryContext
00515                                                        );
00516                 }
00517 
00518                 <span class="comment">//</span>
00519                 <span class="comment">// We ignore failures where the buffer is too small.</span>
00520                 <span class="comment">//</span>
00521                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL) {
00522                    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00523                 }
00524 
00525                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00526                     <span class="keywordflow">break</span>;
00527                 }
00528 
00529                 ValueData = (PVOID)s;
00530             }
00531 
00532             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00533         }
00534 
00535         <span class="comment">//</span>
00536         <span class="comment">// If requested, expand the Value -- but only if the unexpanded value</span>
00537         <span class="comment">// can be represented with a UNICODE_STRING.</span>
00538         <span class="comment">//</span>
00539         <span class="keywordflow">if</span> ((ValueType == REG_EXPAND_SZ) &amp;&amp;
00540             (ValueLength &gt;= <span class="keyword">sizeof</span>(WCHAR)) &amp;&amp;
00541             (ValueLength &lt;= <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a1">MAX_NONNULL_USTRING</a>)) {
00542             <span class="comment">//</span>
00543             <span class="comment">// For REG_EXPAND_SZ value type, expand any environment variable</span>
00544             <span class="comment">// references in the registry value string using the Rtl function.</span>
00545             <span class="comment">//</span>
00546 
00547             UNICODE_STRING Source;
00548             UNICODE_STRING Destination;
00549             PWCHAR  Src;
00550             ULONG   SrcLength;
00551             ULONG   RequiredLength;
00552             BOOLEAN PercentFound;
00553 
00554             <span class="comment">//</span>
00555             <span class="comment">// Don't expand unless we have to since expansion doubles buffer usage.</span>
00556             <span class="comment">//</span>
00557 
00558             PercentFound = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00559             SrcLength = ValueLength - <span class="keyword">sizeof</span>(WCHAR);
00560             Src = (PWSTR)ValueData;
00561             <span class="keywordflow">while</span> (SrcLength) {
00562                 <span class="keywordflow">if</span> (*Src == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'%'</span>) {
00563                     PercentFound = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00564                     <span class="keywordflow">break</span>;
00565                 }
00566                 Src++;
00567                 SrcLength -= <span class="keyword">sizeof</span>(WCHAR);
00568             }
00569 
00570             <span class="keywordflow">if</span> ( PercentFound ) {
00571                 Source.Buffer = (PWSTR)ValueData;
00572                 Source.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ValueLength;
00573                 Source.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Source.MaximumLength - <span class="keyword">sizeof</span>(UNICODE_NULL));
00574                 Destination.Buffer = (PWSTR)FreeMem;
00575                 Destination.Length = 0;
00576 
00577                 <span class="keywordflow">if</span> (FreeMemSize &lt;= 0) {
00578                     Destination.MaximumLength = 0;
00579                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (FreeMemSize &lt;= <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a0">MAX_USTRING</a>) {
00580                     Destination.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)FreeMemSize;
00581                     Destination.Buffer[FreeMemSize/<span class="keyword">sizeof</span>(WCHAR) - 1] = UNICODE_NULL;
00582                 } <span class="keywordflow">else</span> {
00583                     Destination.MaximumLength = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a0">MAX_USTRING</a>;
00584                     Destination.Buffer[<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a0">MAX_USTRING</a>/<span class="keyword">sizeof</span>(WCHAR) - 1] = UNICODE_NULL;
00585                 }
00586 
00587                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a24">RtlExpandEnvironmentStrings_U</a>( Environment,
00588                                                         &amp;Source,
00589                                                         &amp;Destination,
00590                                                         &amp;RequiredLength
00591                                                       );
00592                 ValueType = REG_SZ;
00593 
00594                 <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
00595                     ValueData = Destination.Buffer;
00596                     ValueLength = Destination.Length + <span class="keyword">sizeof</span>( UNICODE_NULL );
00597                 } <span class="keywordflow">else</span> {
00598                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL) {
00599                        *PKeyValueInfoLength = (ULONG)((PCHAR)FreeMem - (PCHAR)KeyValueInformation) + RequiredLength;
00600                     }
00601 <span class="comment">//#if DBG</span>
00602                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL) {
00603                        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"RTL: Expand variables for %wZ failed - Status == %lx Size %x &gt; %x &lt;%x&gt;\n"</span>,
00604                                      &amp;Source, Status, *PKeyValueInfoLength, KeyValueInfoLength,
00605                                      Destination.MaximumLength );
00606                     } <span class="keywordflow">else</span> {
00607                        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"RTL: Expand variables for %wZ failed - Status == %lx\n"</span>, &amp;Source, Status );
00608                     }
00609 <span class="comment">//#endif  // DBG</span>
00610                     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW ||
00611                          <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL &amp;&amp;
00612                         ( Destination.MaximumLength == <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a0">MAX_USTRING</a>
00613                          || RequiredLength &gt; <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a1">MAX_NONNULL_USTRING</a> ) ) {
00614 
00615                        <span class="comment">// We can't do variable expansion because the required buffer can't be described</span>
00616                        <span class="comment">// by a UNICODE_STRING, so we silently ignore expansion.</span>
00617 <span class="comment">//#if DBG</span>
00618                        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlpCallQueryRegistryRoutine: skipping expansion.  Status=%x RequiredLength=%x\n"</span>,
00619                          Status, RequiredLength);
00620 <span class="comment">//#endif //DBG</span>
00621                    } <span class="keywordflow">else</span> {
00622                         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00623                    }
00624                 }
00625             }
00626         }
00627 <span class="comment">//#if DBG</span>
00628         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ValueType == REG_EXPAND_SZ  &amp;&amp;  ValueLength &gt; <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a1">MAX_NONNULL_USTRING</a>) {
00629             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlpCallQueryRegistryRoutine: skipping environment expansion.  ValueLength=%x\n"</span>,
00630                      ValueLength);
00631         }
00632 <span class="comment">//#endif //DBG</span>
00633     }
00634 
00635     <span class="comment">//</span>
00636     <span class="comment">// No special process of the registry value required so just call</span>
00637     <span class="comment">// the query routine.</span>
00638     <span class="comment">//</span>
00639     <span class="keywordflow">if</span> (QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_DIRECT) {
00640         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a14">RtlpQueryRegistryDirect</a>( ValueType,
00641                                           ValueData,
00642                                           ValueLength,
00643                                           QueryTable-&gt;EntryContext
00644                                         );
00645     } <span class="keywordflow">else</span> {
00646         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (QueryTable-&gt;QueryRoutine)( <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00647                                              ValueType,
00648                                              ValueData,
00649                                              ValueLength,
00650                                              Context,
00651                                              QueryTable-&gt;EntryContext
00652                                            );
00653 
00654     }
00655 
00656     <span class="comment">//</span>
00657     <span class="comment">// At this point we fail silently if the buffer is too small.</span>
00658     <span class="comment">//</span>
00659     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL) {
00660         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00661     }
00662     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00663 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="rtl/regutil.c::RtlpGetRegistryHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpGetRegistryHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RelativeTo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WriteAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Key</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00092">92</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00058">KeyPath</a>, <a class="el" href="../../d3/d1/rtload_8c-source.html#l00045">KeyPathBuffer</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01883">RtlAppendUnicodeStringToString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01821">RtlAppendUnicodeToString()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01453">RtlFormatCurrentUserKeyPath()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00089">RtlpRegistryPaths</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01257">RtlCheckRegistryKey()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01278">RtlCreateRegistryKey()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01299">RtlDeleteRegistryValue()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01637">RtlpGetTimeZoneInfoHandle()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00744">RtlQueryRegistryValues()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01220">RtlWriteRegistryValue()</a>.
<p>
<pre class="fragment"><div>00098 {
00099     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00100     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00101     WCHAR <a class="code" href="../../d2/d2/rtload_8c.html#a2">KeyPathBuffer</a>[ MAXIMUM_FILENAME_LENGTH+6 ];
00102     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>;
00103     UNICODE_STRING CurrentUserKeyPath;
00104     BOOLEAN OptionalPath;
00105 
00106     <span class="keywordflow">if</span> (RelativeTo &amp; RTL_REGISTRY_HANDLE) {
00107         *<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a> = (HANDLE)<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00108         <span class="keywordflow">return</span> STATUS_SUCCESS;
00109     }
00110 
00111     <span class="keywordflow">if</span> (RelativeTo &amp; RTL_REGISTRY_OPTIONAL) {
00112         RelativeTo &amp;= ~RTL_REGISTRY_OPTIONAL;
00113         OptionalPath = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00114     } <span class="keywordflow">else</span> {
00115         OptionalPath = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00116     }
00117 
00118     <span class="keywordflow">if</span> (RelativeTo &gt;= RTL_REGISTRY_MAXIMUM) {
00119         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00120     }
00121 
00122     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>.Buffer = <a class="code" href="../../d2/d2/rtload_8c.html#a2">KeyPathBuffer</a>;
00123     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>.Length = 0;
00124     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>.MaximumLength = <span class="keyword">sizeof</span>( <a class="code" href="../../d2/d2/rtload_8c.html#a2">KeyPathBuffer</a> );
00125     <span class="keywordflow">if</span> (RelativeTo != RTL_REGISTRY_ABSOLUTE) {
00126         <span class="keywordflow">if</span> (RelativeTo == RTL_REGISTRY_USER &amp;&amp;
00127             <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a26">RtlFormatCurrentUserKeyPath</a>( &amp;CurrentUserKeyPath ) )
00128            ) {
00129             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a46">RtlAppendUnicodeStringToString</a>( &amp;KeyPath, &amp;CurrentUserKeyPath );
00130             <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>( &amp;CurrentUserKeyPath );
00131         } <span class="keywordflow">else</span> {
00132             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>( &amp;KeyPath, RtlpRegistryPaths[ RelativeTo ] );
00133         }
00134 
00135         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00136             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00137         }
00138 
00139         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>( &amp;KeyPath, L<span class="stringliteral">"\\"</span> );
00140         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00141             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00142         }
00143     }
00144 
00145     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a45">RtlAppendUnicodeToString</a>( &amp;KeyPath, KeyName );
00146     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00147         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00148     }
00149 
00150 
00151     InitializeObjectAttributes( &amp;ObjectAttributes,
00152                                 &amp;KeyPath,
00153                                 OBJ_CASE_INSENSITIVE,
00154                                 NULL,
00155                                 NULL
00156                               );
00157 <span class="preprocessor">#ifdef NTOS_KERNEL_RUNTIME</span>
00158 <span class="preprocessor"></span>    <span class="comment">//</span>
00159     <span class="comment">// Use a kernel-mode handle for the registry key to prevent</span>
00160     <span class="comment">// malicious apps from hijacking it.</span>
00161     <span class="comment">//</span>
00162     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Attributes |= OBJ_KERNEL_HANDLE;
00163 <span class="preprocessor">#endif</span>
00164 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (WriteAccess) {
00165         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateKey( Key,
00166                               GENERIC_WRITE,
00167                               &amp;ObjectAttributes,
00168                               0,
00169                               (PUNICODE_STRING) NULL,
00170                               0,
00171                               NULL
00172                             );
00173     } <span class="keywordflow">else</span> {
00174         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenKey( Key,
00175                             MAXIMUM_ALLOWED | GENERIC_READ,
00176                             &amp;ObjectAttributes
00177                           );
00178     }
00179 
00180     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00181 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="rtl/regutil.c::RtlpGetTimeZoneInfoHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpGetTimeZoneInfoHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WriteAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Key</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01637">1637</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00092">RtlpGetRegistryHandle()</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01656">RtlQueryTimeZoneInformation()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01811">RtlSetActiveTimeBias()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01724">RtlSetTimeZoneInformation()</a>.
<p>
<pre class="fragment"><div>01641 {
01642     <span class="keywordflow">return</span> <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a13">RtlpGetRegistryHandle</a>( RTL_REGISTRY_CONTROL, L<span class="stringliteral">"TimeZoneInformation"</span>, WriteAccess, Key );
01643 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="rtl/regutil.c::RtlpInitCurrentUserString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpInitCurrentUserString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>UserString</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="rtl/regutil.c::RtlpQueryRegistryDirect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlpQueryRegistryDirect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Destination</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00200">200</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00186">MAX_USTRING</a>, <a class="el" href="../../d8/d9/exts_8h-source.html#l00092">n</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00410">RtlAllocateStringRoutine</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00281">RtlpCallQueryRegistryRoutine()</a>.
<p>
<pre class="fragment"><div>00206 {
00207 
00208     <span class="keywordflow">if</span> (ValueType == REG_SZ ||
00209         ValueType == REG_EXPAND_SZ ||
00210         ValueType == REG_MULTI_SZ
00211        ) {
00212         PUNICODE_STRING DestinationString;
00213         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> TruncValueLength;
00214 
00215         <span class="comment">//</span>
00216         <span class="comment">// Truncate ValueLength to be represented in a UNICODE_STRING</span>
00217         <span class="comment">//</span>
00218         <span class="keywordflow">if</span> ( ValueLength &lt;= <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a0">MAX_USTRING</a> ) {
00219             TruncValueLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)ValueLength;
00220         } <span class="keywordflow">else</span> {
00221             TruncValueLength = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a0">MAX_USTRING</a>;
00222 
00223 <span class="comment">//davepr: move all this stuff to debug builds at some point.</span>
00224 <span class="comment">//davepr: but for now, I'd like to identify whether there are components</span>
00225 <span class="comment">//davepr: that are seeing silent failures.</span>
00226 <span class="comment">//#if DBG</span>
00227             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlpQueryRegistryDirect: truncating SZ Value length: %x -&gt; %x\n"</span>,
00228                      ValueLength, TruncValueLength);
00229 <span class="comment">//#endif //DBG</span>
00230         }
00231 
00232         DestinationString = (PUNICODE_STRING)Destination;
00233         <span class="keywordflow">if</span> (DestinationString-&gt;Buffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00234 
00235             DestinationString-&gt;Buffer = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a49">RtlAllocateStringRoutine</a>( TruncValueLength );
00236             <span class="keywordflow">if</span> (!DestinationString-&gt;Buffer) {
00237                 <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00238             }
00239             DestinationString-&gt;MaximumLength = TruncValueLength;
00240         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (TruncValueLength &gt; DestinationString-&gt;MaximumLength) {
00241                 <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
00242         }
00243 
00244         RtlCopyMemory( DestinationString-&gt;Buffer, ValueData, TruncValueLength );
00245         DestinationString-&gt;Length = (TruncValueLength - <span class="keyword">sizeof</span>(UNICODE_NULL));
00246 
00247     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ValueLength &lt;= <span class="keyword">sizeof</span>( ULONG )) {
00248         RtlCopyMemory( Destination, ValueData, ValueLength );
00249 
00250     } <span class="keywordflow">else</span> {
00251         PULONG DestinationLength;
00252 
00253         DestinationLength = (PULONG)Destination;
00254         <span class="keywordflow">if</span> ((LONG)*DestinationLength &lt; 0) {
00255             ULONG <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = -(LONG)*DestinationLength;
00256 
00257             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> &lt; ValueLength) {
00258                 <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
00259             }
00260             RtlCopyMemory( DestinationLength, ValueData, ValueLength );
00261 
00262         } <span class="keywordflow">else</span> {
00263             <span class="keywordflow">if</span> (*DestinationLength &lt; (2 * <span class="keyword">sizeof</span>(*DestinationLength) + ValueLength)) {
00264                 <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
00265             }
00266 
00267             *DestinationLength++ = ValueLength;
00268             *DestinationLength++ = ValueType;
00269             RtlCopyMemory( DestinationLength, ValueData, ValueLength );
00270         }
00271     }
00272 
00273     <span class="keywordflow">return</span> STATUS_SUCCESS;
00274 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="rtl/regutil.c::RtlQueryRegistryValues" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlQueryRegistryValues           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RelativeTo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Path</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PRTL_QUERY_REGISTRY_TABLE&nbsp;</td>
          <td class="mdname" nowrap> <em>QueryTable</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID Environment&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00744">744</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00058">KeyPath</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00679">RtlpAllocDeallocQueryBuffer()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00281">RtlpCallQueryRegistryRoutine()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00092">RtlpGetRegistryHandle()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00672">RtlpRegistryQueryInitialBuffersize</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03863">CmpIsLastKnownGoodBoot()</a>, <a class="el" href="../../d7/d7/fsvga_8c-source.html#l00858">FsVgaServiceParameters()</a>, <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l00067">GetVersionInfo()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l02525">IopCallDriverAddDevice()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04000">IopProcessCriticalDeviceRoutine()</a>, <a class="el" href="../../d5/d1/fekbd_8c-source.html#l01092">NlsKbdInitializePerSystem()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01656">RtlQueryTimeZoneInformation()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01811">RtlSetActiveTimeBias()</a>.
<p>
<pre class="fragment"><div>00754                    :
00755 
00756     This function allows <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller to query multiple values from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry
00757     sub-tree with a single call.  The caller specifies an initial key <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>,
00758     and a table.  The table contains one or more entries that describe <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00759     key values and subkey names <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> interested in.  This function
00760     starts at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initial key and enumerates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entries in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> table.  For
00761     each entry that specifies a value name or subkey name that exists in
00762     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry, <span class="keyword">this</span> function calls <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's query routine associated
00763     with each table entry.  The caller's query routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> passed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value
00764     name, <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>, data and data length, to <span class="keywordflow">do</span> with what they wish.
00765 
00766 Arguments:
00767 
00768     RelativeTo - specifies that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Path parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> either an absolute
00769         registry <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>, or a <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> relative to a predefined key <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>.  The
00770         following values are defined:
00771 
00772         RTL_REGISTRY_ABSOLUTE   - Path <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an absolute registry <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>
00773         RTL_REGISTRY_SERVICES   - Path <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> relative to \Registry\Machine\System\CurrentControlSet\Services
00774         RTL_REGISTRY_CONTROL    - Path <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> relative to \Registry\Machine\System\CurrentControlSet\Control
00775         RTL_REGISTRY_WINDOWS_NT - Path <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> relative to \Registry\Machine\Software\Microsoft\Windows NT\CurrentVersion
00776         RTL_REGISTRY_DEVICEMAP  - Path <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> relative to \Registry\Machine\Hardware\DeviceMap
00777         RTL_REGISTRY_USER       - Path <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> relative to \Registry\User\CurrentUser
00778 
00779         RTL_REGISTRY_OPTIONAL   - Bit that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> key referenced by
00780                                   <span class="keyword">this</span> parameter and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Path parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00781                                   optional.
00782 
00783         RTL_REGISTRY_HANDLE     - Bit that specifies that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Path parameter
00784                                   <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> actually a registry handle to use.
00785                                   optional.
00786 
00787     Path - specifies either an absolute registry <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>, or a <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> relative to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00788         known location specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RelativeTo parameter.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00789         RTL_REGISTRY_HANDLE flag <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified, then <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a
00790         registry handle to use directly.
00791 
00792     QueryTable - specifies a table of one or more value names and subkey names
00793         that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> interested.  Each table entry contains a query routine
00794         that will be called <span class="keywordflow">for</span> each value name that exists in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.
00795         The table <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> terminated when a <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> reached.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00796         table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> defined as a table entry with a <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> QueryRoutine
00797         and a <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> field.
00798 
00799         QueryTable entry fields:
00800 
00801         PRTL_QUERY_REGISTRY_ROUTINE QueryRoutine - This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00802             called with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name, <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>, data and data length of a
00803             registry value.  If <span class="keyword">this</span> field <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, then <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> marks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00804             end of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> table.
00805 
00806         ULONG Flags - These flags <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> how <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following fields are
00807             interpreted.  The following flags are defined:
00808 
00809             RTL_QUERY_REGISTRY_SUBKEY - says <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> field of <span class="keyword">this</span>
00810                 table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> another <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> to a registry key and all
00811                 following table entries are <span class="keywordflow">for</span> that key rather than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00812                 key specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Path parameter.  This change in
00813                 focus lasts until <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> table or another
00814                 RTL_QUERY_REGISTRY_SUBKEY entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> seen or
00815                 RTL_QUERY_REGISTRY_TOPKEY entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> seen.  Each such
00816                 entry must specify a <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> relative to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Path
00817                 specified on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call to <span class="keyword">this</span> function.
00818 
00819             RTL_QUERY_REGISTRY_TOPKEY - resets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current registry key
00820                 handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> original one specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RelativeTo
00821                 and Path parameters.  Useful <span class="keywordflow">for</span> getting back to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00822                 original node after descending into subkeys with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00823                 RTL_QUERY_REGISTRY_SUBKEY flag.
00824 
00825             RTL_QUERY_REGISTRY_REQUIRED - specifies that <span class="keyword">this</span> value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00826                 required and <span class="keywordflow">if</span> not found then STATUS_OBJECT_NAME_NOT_FOUND
00827                 <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.  For a table entry that specifies a <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00828                 name so that <span class="keyword">this</span> function will enumerate all of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00829                 value names under a key, STATUS_OBJECT_NAME_NOT_FOUND
00830                 will be returned <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> <span class="keywordflow">if</span> there are no value keys under
00831                 <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current key.
00832 
00833             RTL_QUERY_REGISTRY_NOVALUE - specifies that even though
00834                 there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> field <span class="keywordflow">for</span> <span class="keyword">this</span> table entry, all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00835                 caller wants <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a call back, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> does NOT want to
00836                 enumerate all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> values under <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current key.  The
00837                 query routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called with <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <span class="keywordflow">for</span> ValueData,
00838                 REG_NONE <span class="keywordflow">for</span> ValueType and zero <span class="keywordflow">for</span> ValueLength.
00839 
00840             RTL_QUERY_REGISTRY_NOEXPAND - specifies that <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value
00841                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <span class="keyword">this</span> registry value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> REG_EXPAND_SZ or
00842                 REG_MULTI_SZ, then <span class="keyword">this</span> function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> NOT to <span class="keywordflow">do</span> any
00843                 preprocessing of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry values prior to calling
00844                 <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query routine.  Default behavior <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to expand
00845                 environment variable references in REG_EXPAND_SZ
00846                 values and to enumerate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> terminated strings
00847                 in a REG_MULTI_SZ value and call <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query routine
00848                 once <span class="keywordflow">for</span> each, making <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> look like multiple REG_SZ
00849                 values with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> same <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.
00850 
00851             RTL_QUERY_REGISTRY_DIRECT QueryRoutine field ignored.
00852                 EntryContext field points to location to store value.
00853                 For null terminated strings, EntryContext points to
00854                 UNICODE_STRING structure that that describes maximum
00855                 size of buffer.  If .Buffer field <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> then a buffer
00856                 <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allocated.
00857 
00858             RTL_QUERY_REGISTRY_DELETE Used to <span class="keyword">delete</span> value keys after
00859                 they are queried.
00860 
00861         PWSTR <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> - This field gives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of a Value <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller
00862             wants to query <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of.  If <span class="keyword">this</span> field <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, then
00863             <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> QueryRoutine specified <span class="keywordflow">for</span> <span class="keyword">this</span> table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called
00864             <span class="keywordflow">for</span> all values associated with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current registry key.
00865 
00866         PVOID EntryContext - This field <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an arbitrary 32-bit field
00867             that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> passed uninterpreted to each QueryRoutine called.
00868 
00869         ULONG DefaultType
00870         PVOID DefaultData
00871         ULONG DefaultLength If there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no value name that matches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00872             name given by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> field, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DefaultType field <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00873             not REG_NONE, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> QueryRoutine <span class="keywordflow">for</span> <span class="keyword">this</span> table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00874             called with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following fields as <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00875             value had been found in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DefaultType <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00876             REG_SZ, REG_EXPANDSZ or REG_MULTI_SZ and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DefaultLength
00877             <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> 0 then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of DefaultLength will be computed based
00878             on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of unicode string pointed to by DefaultData
00879 
00880     Context - specifies a 32-bit quantity that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> passed uninterpreted to
00881         each QueryRoutine called.
00882 
00883     Environment - optional parameter, that <span class="keywordflow">if</span> specified <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> environment
00884         used when expanding variable values in REG_EXPAND_SZ registry
00885         values.
00886 
00887 Return Value:
00888 
00889     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation.
00890 
00891 --*/
00892 
00893 {
00894     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00895     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00896     UNICODE_STRING    <a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>, KeyValueName;
00897     HANDLE  <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>, Key1;
00898     PKEY_VALUE_FULL_INFORMATION KeyValueInformation;
00899     SIZE_T  KeyValueInfoLength;
00900     ULONG   ValueIndex;
00901     SIZE_T  AllocLength;
00902     ULONG   KeyResultLength;
00903     <span class="keywordtype">int</span>     retries;
00904 
00905     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
00906 
00907     KeyValueInformation = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00908 
00909     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a13">RtlpGetRegistryHandle</a>( RelativeTo, Path, FALSE, &amp;Key );
00910     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00911         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00912     }
00913 
00914     <span class="keywordflow">if</span> ((RelativeTo &amp; RTL_REGISTRY_HANDLE) == 0) {
00915         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;KeyPath, Path);
00916     } <span class="keywordflow">else</span> {
00917         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;KeyPath, NULL);
00918     }
00919 
00920     AllocLength = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a5">RtlpRegistryQueryInitialBuffersize</a>;
00921 
00922     KeyValueInformation = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a16">RtlpAllocDeallocQueryBuffer</a>( &amp;AllocLength, NULL, 0, &amp;Status );
00923     <span class="keywordflow">if</span> ( KeyValueInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00924         <span class="keywordflow">if</span> (!(RelativeTo &amp; RTL_REGISTRY_HANDLE)) {
00925             ZwClose( Key );
00926         }
00927         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00928     }
00929 
00930     KeyValueInfoLength = AllocLength - <span class="keyword">sizeof</span>(UNICODE_NULL);
00931     Key1 = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
00932     <span class="keywordflow">while</span> (QueryTable-&gt;QueryRoutine != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00933            (QueryTable-&gt;Flags &amp; (RTL_QUERY_REGISTRY_SUBKEY | RTL_QUERY_REGISTRY_DIRECT))
00934           ) {
00935 
00936         <span class="keywordflow">if</span> ((QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_DIRECT) &amp;&amp;
00937             (QueryTable-&gt;Name == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00938              (QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_SUBKEY) ||
00939              QueryTable-&gt;QueryRoutine != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00940            ) {
00941 
00942             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00943             <span class="keywordflow">break</span>;
00944         }
00945 
00946         <span class="keywordflow">if</span> (QueryTable-&gt;Flags &amp; (RTL_QUERY_REGISTRY_TOPKEY | RTL_QUERY_REGISTRY_SUBKEY)) {
00947             <span class="keywordflow">if</span> (Key1 != <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>) {
00948                 <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( Key1 );
00949                 Key1 = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
00950             }
00951         }
00952 
00953         <span class="keywordflow">if</span> (QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_SUBKEY) {
00954             <span class="keywordflow">if</span> (QueryTable-&gt;Name == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00955                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00956             } <span class="keywordflow">else</span> {
00957                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyPath, QueryTable-&gt;Name );
00958                 InitializeObjectAttributes( &amp;ObjectAttributes,
00959                                             &amp;KeyPath,
00960                                             OBJ_CASE_INSENSITIVE,
00961                                             Key,
00962                                             NULL
00963                                             );
00964 <span class="preprocessor">#ifdef NTOS_KERNEL_RUNTIME</span>
00965 <span class="preprocessor"></span>                <span class="comment">//</span>
00966                 <span class="comment">// Use a kernel-mode handle for the registry key to prevent</span>
00967                 <span class="comment">// malicious apps from hijacking it.</span>
00968                 <span class="comment">//</span>
00969                 <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Attributes |= OBJ_KERNEL_HANDLE;
00970 <span class="preprocessor">#endif</span>
00971 <span class="preprocessor"></span>                <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenKey( &amp;Key1,
00972                                     MAXIMUM_ALLOWED,
00973                                     &amp;ObjectAttributes
00974                                   );
00975                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00976                     <span class="keywordflow">if</span> (QueryTable-&gt;QueryRoutine != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00977                         <span class="keywordflow">goto</span> enumvalues;
00978                     }
00979                 }
00980             }
00981 
00982         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (QueryTable-&gt;Name != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00983                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyValueName, QueryTable-&gt;Name );
00984                 retries = 0;
00985     retryqueryvalue:
00986                 <span class="comment">//</span>
00987                 <span class="comment">// A maximum of two retries is expected. If we see more we must</span>
00988                 <span class="comment">// have miscomputed how much is required for the query buffer.</span>
00989                 <span class="comment">//</span>
00990                 <span class="keywordflow">if</span> (retries++ &gt; 4) {
00991 <span class="comment">//#if DBG</span>
00992                    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlQueryRegistryValues: Miscomputed buffer size at line %d\n"</span>, __LINE__);
00993 <span class="comment">//#endif</span>
00994                    <span class="keywordflow">break</span>;
00995                 }
00996 
00997                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryValueKey( Key1,
00998                                           &amp;KeyValueName,
00999                                           KeyValueFullInformation,
01000                                           KeyValueInformation,
01001                                           (ULONG) KeyValueInfoLength,
01002                                           &amp;KeyResultLength
01003                                         );
01004                 <span class="comment">//</span>
01005                 <span class="comment">// ZwQueryValueKey returns overflow even though the problem is that</span>
01006                 <span class="comment">// the specified buffer was too small, so we fix that up here so we</span>
01007                 <span class="comment">// can decide correctly whether to retry or not below.</span>
01008                 <span class="comment">//</span>
01009                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) {
01010                    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01011                 }
01012 
01013                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01014                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_OBJECT_NAME_NOT_FOUND) {
01015 
01016                         KeyValueInformation-&gt;Type = REG_NONE;
01017                         KeyValueInformation-&gt;DataLength = 0;
01018                         KeyResultLength = (ULONG)KeyValueInfoLength;
01019                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a15">RtlpCallQueryRegistryRoutine</a>( QueryTable,
01020                                                                KeyValueInformation,
01021                                                                &amp;KeyResultLength,
01022                                                                Context,
01023                                                                Environment
01024                                                              );
01025                     }
01026 
01027                    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL) {
01028                         <span class="comment">//</span>
01029                         <span class="comment">// Try to allocate a larger buffer as this is one humongous</span>
01030                         <span class="comment">// value.</span>
01031                         <span class="comment">//</span>
01032                         AllocLength = KeyResultLength + <span class="keyword">sizeof</span>(PVOID) + <span class="keyword">sizeof</span>(UNICODE_NULL);
01033                         KeyValueInformation = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a16">RtlpAllocDeallocQueryBuffer</a>( &amp;AllocLength,
01034                                                                            KeyValueInformation,
01035                                                                            AllocLength,
01036                                                                            &amp;Status
01037                                                                          );
01038                         <span class="keywordflow">if</span> ( KeyValueInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01039                            <span class="keywordflow">break</span>;
01040                         }
01041                         KeyValueInfoLength = AllocLength - <span class="keyword">sizeof</span>(UNICODE_NULL);
01042                         <span class="keywordflow">goto</span> retryqueryvalue;
01043                     }
01044 
01045                 } <span class="keywordflow">else</span> {
01046                     <span class="comment">//</span>
01047                     <span class="comment">// KeyResultLength holds the length of the data returned by ZwQueryKeyValue.</span>
01048                     <span class="comment">// If this is a MULTI_SZ value, catenate a NUL.</span>
01049                     <span class="comment">//</span>
01050                     <span class="keywordflow">if</span> ( KeyValueInformation-&gt;Type == REG_MULTI_SZ ) {
01051                             *(PWCHAR) ((PUCHAR)KeyValueInformation + KeyResultLength) = UNICODE_NULL;
01052                             KeyValueInformation-&gt;DataLength += <span class="keyword">sizeof</span>(UNICODE_NULL);
01053                     }
01054 
01055                     KeyResultLength = (ULONG)KeyValueInfoLength;
01056                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a15">RtlpCallQueryRegistryRoutine</a>( QueryTable,
01057                                                            KeyValueInformation,
01058                                                            &amp;KeyResultLength,
01059                                                            Context,
01060                                                            Environment
01061                                                          );
01062 
01063                     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL ) {
01064                          <span class="comment">//</span>
01065                          <span class="comment">// Try to allocate a larger buffer as this is one humongous</span>
01066                          <span class="comment">// value.</span>
01067                          <span class="comment">//</span>
01068                          AllocLength = KeyResultLength + <span class="keyword">sizeof</span>(PVOID) + <span class="keyword">sizeof</span>(UNICODE_NULL);
01069                          KeyValueInformation = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a16">RtlpAllocDeallocQueryBuffer</a>( &amp;AllocLength,
01070                                                                             KeyValueInformation,
01071                                                                             AllocLength,
01072                                                                             &amp;Status
01073                                                                           );
01074                          <span class="keywordflow">if</span> ( KeyValueInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01075                             <span class="keywordflow">break</span>;
01076                          }
01077                          KeyValueInfoLength = AllocLength - <span class="keyword">sizeof</span>(UNICODE_NULL);
01078                          <span class="keywordflow">goto</span> retryqueryvalue;
01079                      }
01080 
01081                     <span class="comment">//</span>
01082                     <span class="comment">// If requested, delete the value key after it has been successfully queried.</span>
01083                     <span class="comment">//</span>
01084 
01085                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) &amp;&amp; QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_DELETE) {
01086                         ZwDeleteValueKey (Key1, &amp;KeyValueName);
01087                     }
01088                 }
01089 
01090         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_NOVALUE) {
01091             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (QueryTable-&gt;QueryRoutine)( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01092                                                  REG_NONE,
01093                                                  <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01094                                                  0,
01095                                                  Context,
01096                                                  QueryTable-&gt;EntryContext
01097                                                );
01098         } <span class="keywordflow">else</span> {
01099 
01100         enumvalues:
01101             retries = 0;
01102             <span class="keywordflow">for</span> (ValueIndex = 0; <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; ValueIndex++) {
01103                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwEnumerateValueKey( Key1,
01104                                               ValueIndex,
01105                                               KeyValueFullInformation,
01106                                               KeyValueInformation,
01107                                               (ULONG) KeyValueInfoLength,
01108                                               &amp;KeyResultLength
01109                                             );
01110                 <span class="comment">//</span>
01111                 <span class="comment">// ZwEnumerateValueKey returns overflow even though the problem is that</span>
01112                 <span class="comment">// the specified buffer was too small, so we fix that up here so we</span>
01113                 <span class="comment">// can decide correctly whether to retry or not below.</span>
01114                 <span class="comment">//</span>
01115                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) {
01116                    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01117                 }
01118 
01119                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_NO_MORE_ENTRIES) {
01120                     <span class="keywordflow">if</span> (ValueIndex == 0 &amp;&amp; (QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_REQUIRED)) {
01121                        <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_OBJECT_NAME_NOT_FOUND;
01122                     } <span class="keywordflow">else</span> {
01123                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01124                     }
01125                     <span class="keywordflow">break</span>;
01126                 }
01127 
01128                 <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) ) {
01129 
01130                     KeyResultLength = (ULONG)KeyValueInfoLength;
01131                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a15">RtlpCallQueryRegistryRoutine</a>( QueryTable,
01132                                                            KeyValueInformation,
01133                                                            &amp;KeyResultLength,
01134                                                            Context,
01135                                                            Environment
01136                                                          );
01137                 }
01138 
01139                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_TOO_SMALL) {
01140                     <span class="comment">//</span>
01141                     <span class="comment">// Allocate a larger buffer and try again.</span>
01142                     <span class="comment">//</span>
01143                     AllocLength = KeyResultLength + <span class="keyword">sizeof</span>(PVOID) + <span class="keyword">sizeof</span>(UNICODE_NULL);
01144                     KeyValueInformation = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a16">RtlpAllocDeallocQueryBuffer</a>( &amp;AllocLength,
01145                                                                        KeyValueInformation,
01146                                                                        AllocLength,
01147                                                                        &amp;Status
01148                                                                      );
01149                     <span class="keywordflow">if</span> (KeyValueInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01150                        <span class="keywordflow">break</span>;
01151                     }
01152                     KeyValueInfoLength = AllocLength - <span class="keyword">sizeof</span>(UNICODE_NULL);
01153                     ValueIndex -= 1;
01154 
01155                     <span class="comment">//</span>
01156                     <span class="comment">// A maximum of two retries is expected per loop iteration.</span>
01157                     <span class="comment">// If we see more we must have miscomputed</span>
01158                     <span class="comment">// how much is required for the query buffer.</span>
01159                     <span class="comment">//</span>
01160                     <span class="keywordflow">if</span> (retries++ &lt;= 4) {
01161                         <span class="keywordflow">continue</span>;
01162                     }
01163 <span class="comment">//#if DBG</span>
01164                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlQueryRegistryValues: Miscomputed buffer size at line %d\n"</span>, __LINE__);
01165 <span class="comment">//#endif</span>
01166                     <span class="keywordflow">break</span>;
01167                 }
01168 
01169                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01170                     <span class="keywordflow">break</span>;
01171                 }
01172 
01173                 retries = 0;
01174 
01175                 <span class="comment">//</span>
01176                 <span class="comment">// If requested, delete the value key after it has been successfully queried.</span>
01177                 <span class="comment">// After deletion the current ValueIndex is for the next sub-key, so adjust it.</span>
01178                 <span class="comment">// KeyValueInformation-&gt;NameLength should fit in a USHORT, but we don't check since</span>
01179                 <span class="comment">// it only harms our caller.</span>
01180                 <span class="comment">//</span>
01181 
01182                 <span class="keywordflow">if</span> (QueryTable-&gt;Flags &amp; RTL_QUERY_REGISTRY_DELETE) {
01183                     KeyValueName.Buffer = KeyValueInformation-&gt;Name;
01184                     KeyValueName.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)KeyValueInformation-&gt;NameLength;
01185                     KeyValueName.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)KeyValueInformation-&gt;NameLength;
01186                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwDeleteValueKey( Key1,
01187                                                &amp;KeyValueName
01188                                              );
01189                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01190                         ValueIndex -= 1;
01191                     }
01192                 }
01193             }
01194         }
01195 
01196         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01197             <span class="keywordflow">break</span>;
01198         }
01199 
01200         QueryTable++;
01201     }
01202 
01203     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; !(RelativeTo &amp; RTL_REGISTRY_HANDLE)) {
01204         ZwClose( Key );
01205     }
01206 
01207     <span class="keywordflow">if</span> (Key1 != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; Key1 != <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>) {
01208         ZwClose( Key1 );
01209     }
01210 
01211     <span class="comment">//</span>
01212     <span class="comment">// Free any query buffer we allocated.</span>
01213     <span class="comment">//</span>
01214     (<span class="keywordtype">void</span>) <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a16">RtlpAllocDeallocQueryBuffer</a>( NULL, KeyValueInformation, AllocLength, NULL );
01215     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01216 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="rtl/regutil.c::RtlQueryTimeZoneInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlQueryTimeZoneInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PRTL_TIME_ZONE_INFORMATION&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TimeZoneInformation</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01656">1656</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01637">RtlpGetTimeZoneInfoHandle()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00744">RtlQueryRegistryValues()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01647">szBias</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01652">szDaylightBias</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01651">szDaylightName</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01653">szDaylightStart</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01649">szStandardBias</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01648">szStandardName</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01650">szStandardStart</a>.
<p>
<pre class="fragment"><div>01659 {
01660     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01661     HANDLE <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
01662     UNICODE_STRING StandardName, DaylightName;
01663     RTL_QUERY_REGISTRY_TABLE RegistryConfigurationTable[ 8 ];
01664 
01665     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01666 
01667     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a18">RtlpGetTimeZoneInfoHandle</a>( FALSE, &amp;Key );
01668     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01669         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01670     }
01671 
01672     RtlZeroMemory( TimeZoneInformation, <span class="keyword">sizeof</span>( *TimeZoneInformation ) );
01673     RtlZeroMemory( RegistryConfigurationTable, <span class="keyword">sizeof</span>( RegistryConfigurationTable ) );
01674 
01675     RegistryConfigurationTable[ 0 ].Flags = RTL_QUERY_REGISTRY_DIRECT;
01676     RegistryConfigurationTable[ 0 ].Name = (PWSTR)<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a6">szBias</a>;
01677     RegistryConfigurationTable[ 0 ].EntryContext = &amp;TimeZoneInformation-&gt;Bias;
01678 
01679 
01680     StandardName.Buffer = TimeZoneInformation-&gt;StandardName;
01681     StandardName.Length = 0;
01682     StandardName.MaximumLength = <span class="keyword">sizeof</span>( TimeZoneInformation-&gt;StandardName );
01683     RegistryConfigurationTable[ 1 ].Flags = RTL_QUERY_REGISTRY_DIRECT;
01684     RegistryConfigurationTable[ 1 ].Name = (PWSTR)<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a7">szStandardName</a>;
01685     RegistryConfigurationTable[ 1 ].EntryContext = &amp;StandardName;
01686 
01687     RegistryConfigurationTable[ 2 ].Flags = RTL_QUERY_REGISTRY_DIRECT;
01688     RegistryConfigurationTable[ 2 ].Name = (PWSTR)<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a8">szStandardBias</a>;
01689     RegistryConfigurationTable[ 2 ].EntryContext = &amp;TimeZoneInformation-&gt;StandardBias;
01690 
01691     RegistryConfigurationTable[ 3 ].Flags = RTL_QUERY_REGISTRY_DIRECT;
01692     RegistryConfigurationTable[ 3 ].Name = (PWSTR)<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a9">szStandardStart</a>;
01693     RegistryConfigurationTable[ 3 ].EntryContext = &amp;TimeZoneInformation-&gt;StandardStart;
01694     *(PLONG)(RegistryConfigurationTable[ 3 ].EntryContext) = -(LONG)<span class="keyword">sizeof</span>( TIME_FIELDS );
01695 
01696     DaylightName.Buffer = TimeZoneInformation-&gt;DaylightName;
01697     DaylightName.Length = 0;
01698     DaylightName.MaximumLength = <span class="keyword">sizeof</span>( TimeZoneInformation-&gt;DaylightName );
01699     RegistryConfigurationTable[ 4 ].Flags = RTL_QUERY_REGISTRY_DIRECT;
01700     RegistryConfigurationTable[ 4 ].Name = (PWSTR)<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a10">szDaylightName</a>;
01701     RegistryConfigurationTable[ 4 ].EntryContext = &amp;DaylightName;
01702 
01703     RegistryConfigurationTable[ 5 ].Flags = RTL_QUERY_REGISTRY_DIRECT;
01704     RegistryConfigurationTable[ 5 ].Name = (PWSTR)<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a11">szDaylightBias</a>;
01705     RegistryConfigurationTable[ 5 ].EntryContext = &amp;TimeZoneInformation-&gt;DaylightBias;
01706 
01707     RegistryConfigurationTable[ 6 ].Flags = RTL_QUERY_REGISTRY_DIRECT;
01708     RegistryConfigurationTable[ 6 ].Name = (PWSTR)<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a12">szDaylightStart</a>;
01709     RegistryConfigurationTable[ 6 ].EntryContext = &amp;TimeZoneInformation-&gt;DaylightStart;
01710     *(PLONG)(RegistryConfigurationTable[ 6 ].EntryContext) = -(LONG)<span class="keyword">sizeof</span>( TIME_FIELDS );
01711 
01712     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a19">RtlQueryRegistryValues</a>( RTL_REGISTRY_HANDLE,
01713                                      (PWSTR)Key,
01714                                      RegistryConfigurationTable,
01715                                      NULL,
01716                                      NULL
01717                                    );
01718     ZwClose( Key );
01719     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01720 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="rtl/regutil.c::RtlSetActiveTimeBias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlSetActiveTimeBias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ActiveBias</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01811">1811</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01637">RtlpGetTimeZoneInfoHandle()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00744">RtlQueryRegistryValues()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01220">RtlWriteRegistryValue()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01814 {
01815     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01816     HANDLE <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
01817     RTL_QUERY_REGISTRY_TABLE RegistryConfigurationTable[ 2 ];
01818     LONG CurrentActiveBias;
01819 
01820     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01821 
01822     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a18">RtlpGetTimeZoneInfoHandle</a>( TRUE, &amp;Key );
01823     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01824         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01825     }
01826 
01827     RtlZeroMemory( RegistryConfigurationTable, <span class="keyword">sizeof</span>( RegistryConfigurationTable ) );
01828     RegistryConfigurationTable[ 0 ].Flags = RTL_QUERY_REGISTRY_DIRECT | RTL_QUERY_REGISTRY_REQUIRED;
01829     RegistryConfigurationTable[ 0 ].Name = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ActiveTimeBias"</span>;
01830     RegistryConfigurationTable[ 0 ].EntryContext = &amp;CurrentActiveBias;
01831 
01832     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a19">RtlQueryRegistryValues</a>( RTL_REGISTRY_HANDLE,
01833                                      (PWSTR)Key,
01834                                      RegistryConfigurationTable,
01835                                      NULL,
01836                                      NULL
01837                                    );
01838 
01839     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) || CurrentActiveBias != ActiveBias ) {
01840 
01841         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a20">RtlWriteRegistryValue</a>( RTL_REGISTRY_HANDLE,
01842                                         (PWSTR)Key,
01843                                         L<span class="stringliteral">"ActiveTimeBias"</span>,
01844                                         REG_DWORD,
01845                                         &amp;ActiveBias,
01846                                         <span class="keyword">sizeof</span>( ActiveBias )
01847                                       );
01848     }
01849 
01850     ZwClose( Key );
01851     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01852 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="rtl/regutil.c::RtlSetTimeZoneInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlSetTimeZoneInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRTL_TIME_ZONE_INFORMATION&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TimeZoneInformation</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01724">1724</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01637">RtlpGetTimeZoneInfoHandle()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01220">RtlWriteRegistryValue()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01647">szBias</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01652">szDaylightBias</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01651">szDaylightName</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01653">szDaylightStart</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01649">szStandardBias</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01648">szStandardName</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01650">szStandardStart</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01727 {
01728     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01729     HANDLE <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
01730 
01731     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01732 
01733     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a18">RtlpGetTimeZoneInfoHandle</a>( TRUE, &amp;Key );
01734     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01735         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01736     }
01737 
01738     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a20">RtlWriteRegistryValue</a>( RTL_REGISTRY_HANDLE,
01739                                     (PWSTR)Key,
01740                                     szBias,
01741                                     REG_DWORD,
01742                                     &amp;TimeZoneInformation-&gt;Bias,
01743                                     <span class="keyword">sizeof</span>( TimeZoneInformation-&gt;Bias )
01744                                   );
01745     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01746         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a20">RtlWriteRegistryValue</a>( RTL_REGISTRY_HANDLE,
01747                                         (PWSTR)Key,
01748                                         szStandardName,
01749                                         REG_SZ,
01750                                         TimeZoneInformation-&gt;StandardName,
01751                                         (wcslen( TimeZoneInformation-&gt;StandardName ) + 1) * <span class="keyword">sizeof</span>( WCHAR )
01752                                       );
01753     }
01754 
01755     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01756         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a20">RtlWriteRegistryValue</a>( RTL_REGISTRY_HANDLE,
01757                                         (PWSTR)Key,
01758                                         szStandardBias,
01759                                         REG_DWORD,
01760                                         &amp;TimeZoneInformation-&gt;StandardBias,
01761                                         <span class="keyword">sizeof</span>( TimeZoneInformation-&gt;StandardBias )
01762                                       );
01763     }
01764 
01765     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01766         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a20">RtlWriteRegistryValue</a>( RTL_REGISTRY_HANDLE,
01767                                         (PWSTR)Key,
01768                                         szStandardStart,
01769                                         REG_BINARY,
01770                                         &amp;TimeZoneInformation-&gt;StandardStart,
01771                                         <span class="keyword">sizeof</span>( TimeZoneInformation-&gt;StandardStart )
01772                                       );
01773     }
01774 
01775     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01776         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a20">RtlWriteRegistryValue</a>( RTL_REGISTRY_HANDLE,
01777                                         (PWSTR)Key,
01778                                         szDaylightName,
01779                                         REG_SZ,
01780                                         TimeZoneInformation-&gt;DaylightName,
01781                                         (wcslen( TimeZoneInformation-&gt;DaylightName ) + 1) * <span class="keyword">sizeof</span>( WCHAR )
01782                                       );
01783     }
01784 
01785     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01786         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a20">RtlWriteRegistryValue</a>( RTL_REGISTRY_HANDLE,
01787                                         (PWSTR)Key,
01788                                         szDaylightBias,
01789                                         REG_DWORD,
01790                                         &amp;TimeZoneInformation-&gt;DaylightBias,
01791                                         <span class="keyword">sizeof</span>( TimeZoneInformation-&gt;DaylightBias )
01792                                       );
01793     }
01794 
01795     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01796         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a20">RtlWriteRegistryValue</a>( RTL_REGISTRY_HANDLE,
01797                                         (PWSTR)Key,
01798                                         szDaylightStart,
01799                                         REG_BINARY,
01800                                         &amp;TimeZoneInformation-&gt;DaylightStart,
01801                                         <span class="keyword">sizeof</span>( TimeZoneInformation-&gt;DaylightStart )
01802                                       );
01803     }
01804 
01805     ZwClose( Key );
01806     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01807 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="rtl/regutil.c::RtlWriteRegistryValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlWriteRegistryValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RelativeTo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Path</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01220">1220</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
References <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00092">RtlpGetRegistryHandle()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/fsvga_8c-source.html#l00053">DriverEntry()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01811">RtlSetActiveTimeBias()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01724">RtlSetTimeZoneInformation()</a>.
<p>
<pre class="fragment"><div>01228 {
01229     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01230     UNICODE_STRING KeyValueName;
01231     HANDLE <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
01232 
01233     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01234 
01235     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a13">RtlpGetRegistryHandle</a>( RelativeTo, Path, TRUE, &amp;Key );
01236     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01237         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01238     }
01239 
01240     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyValueName, ValueName );
01241     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetValueKey( Key,
01242                             &amp;KeyValueName,
01243                             0,
01244                             ValueType,
01245                             ValueData,
01246                             ValueLength
01247                           );
01248     <span class="keywordflow">if</span> (!(RelativeTo &amp; RTL_REGISTRY_HANDLE)) {
01249         ZwClose( Key );
01250     }
01251 
01252     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01253 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a4" doxytag="rtl/regutil.c::RtlpRegistryPaths" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const PWSTR <a class="el" href="../../d8/d1/rtldata_8c.html#a1">RtlpRegistryPaths</a>[RTL_REGISTRY_MAXIMUM]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00089">89</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01564">RtlOpenCurrentUser()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00092">RtlpGetRegistryHandle()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="rtl/regutil.c::RtlpRegistryQueryInitialBuffersize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> SIZE_T <a class="el" href="../../d4/d7/rtl_2regutil_8c.html#a5">RtlpRegistryQueryInitialBuffersize</a> = PAGE_SIZE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00672">672</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00744">RtlQueryRegistryValues()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="rtl/regutil.c::szBias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const WCHAR <a class="el" href="../../d8/d1/rtldata_8c.html#a2">szBias</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01647">1647</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01656">RtlQueryTimeZoneInformation()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01724">RtlSetTimeZoneInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="rtl/regutil.c::szDaylightBias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const WCHAR <a class="el" href="../../d8/d1/rtldata_8c.html#a7">szDaylightBias</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01652">1652</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01656">RtlQueryTimeZoneInformation()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01724">RtlSetTimeZoneInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="rtl/regutil.c::szDaylightName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const WCHAR <a class="el" href="../../d8/d1/rtldata_8c.html#a6">szDaylightName</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01651">1651</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01656">RtlQueryTimeZoneInformation()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01724">RtlSetTimeZoneInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="rtl/regutil.c::szDaylightStart" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const WCHAR <a class="el" href="../../d8/d1/rtldata_8c.html#a8">szDaylightStart</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01653">1653</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01656">RtlQueryTimeZoneInformation()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01724">RtlSetTimeZoneInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="rtl/regutil.c::szStandardBias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const WCHAR <a class="el" href="../../d8/d1/rtldata_8c.html#a4">szStandardBias</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01649">1649</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01656">RtlQueryTimeZoneInformation()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01724">RtlSetTimeZoneInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="rtl/regutil.c::szStandardName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const WCHAR <a class="el" href="../../d8/d1/rtldata_8c.html#a3">szStandardName</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01648">1648</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01656">RtlQueryTimeZoneInformation()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01724">RtlSetTimeZoneInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="rtl/regutil.c::szStandardStart" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const WCHAR <a class="el" href="../../d8/d1/rtldata_8c.html#a5">szStandardStart</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01650">1650</a> of file <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html">rtl/regutil.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01656">RtlQueryTimeZoneInformation()</a>, and <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01724">RtlSetTimeZoneInformation()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:28 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
