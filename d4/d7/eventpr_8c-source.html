<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: eventpr.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>eventpr.c</h1><a href="../../d3/d8/eventpr_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    eventpr.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implements the executive event pair object.  Functions</span>
00012 <span class="comment">    are provided to create, open, waitlow, waithi, setlow, sethi,</span>
00013 <span class="comment">    sethiwaitlo, setlowaithi.</span>
00014 <span class="comment"></span>
00015 <span class="comment">Author:</span>
00016 <span class="comment"></span>
00017 <span class="comment">    Mark Lucovsky (markl) 18-Oct-1990</span>
00018 <span class="comment"></span>
00019 <span class="comment">Environment:</span>
00020 <span class="comment"></span>
00021 <span class="comment">    Kernel mode only.</span>
00022 <span class="comment"></span>
00023 <span class="comment">Revision History:</span>
00024 <span class="comment"></span>
00025 <span class="comment">--*/</span>
00026 
00027 <span class="preprocessor">#include "<a class="code" href="../../d4/d0/exp_8h.html">exp.h</a>"</span>
00028 
00029 <span class="comment">//</span>
00030 <span class="comment">// Define performance counters.</span>
00031 <span class="comment">//</span>
00032 
<a name="l00033"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a0">00033</a> ULONG <a class="code" href="../../d3/d8/eventpr_8c.html#a0">EvPrSetHigh</a> = 0;
<a name="l00034"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a1">00034</a> ULONG <a class="code" href="../../d3/d8/eventpr_8c.html#a1">EvPrSetLow</a> = 0;
00035 
00036 <span class="comment">//</span>
00037 <span class="comment">// Address of event pair object type descriptor.</span>
00038 <span class="comment">//</span>
00039 
<a name="l00040"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a2">00040</a> <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> <a class="code" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a>;
00041 
00042 <span class="comment">//</span>
00043 <span class="comment">// Structure that describes the mapping of generic access rights to object</span>
00044 <span class="comment">// specific access rights for event pair objects.</span>
00045 <span class="comment">//</span>
00046 
<a name="l00047"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a3">00047</a> GENERIC_MAPPING <a class="code" href="../../d3/d8/eventpr_8c.html#a3">ExpEventPairMapping</a> = {
00048     STANDARD_RIGHTS_READ |
00049         SYNCHRONIZE,
00050     STANDARD_RIGHTS_WRITE |
00051         SYNCHRONIZE,
00052     STANDARD_RIGHTS_EXECUTE |
00053         SYNCHRONIZE,
00054     EVENT_PAIR_ALL_ACCESS
00055 };
00056 
00057 <span class="preprocessor">#ifdef ALLOC_PRAGMA</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(INIT, ExpEventPairInitialization)</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, NtCreateEventPair)</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, NtOpenEventPair)</span>
00061 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, NtWaitLowEventPair)</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, NtWaitHighEventPair)</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, NtSetLowWaitHighEventPair)</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, NtSetHighWaitLowEventPair)</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, NtSetHighEventPair)</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE, NtSetLowEventPair)</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00068 <span class="preprocessor"></span>
00069 BOOLEAN
<a name="l00070"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a4">00070</a> <a class="code" href="../../d3/d8/eventpr_8c.html#a4">ExpEventPairInitialization</a> (
00071     )
00072 
00073 <span class="comment">/*++</span>
00074 <span class="comment"></span>
00075 <span class="comment">Routine Description:</span>
00076 <span class="comment"></span>
00077 <span class="comment">    This function creates the event pair object type descriptor at system</span>
00078 <span class="comment">    initialization and stores the address of the object type descriptor</span>
00079 <span class="comment">    in global storage.</span>
00080 <span class="comment"></span>
00081 <span class="comment">Arguments:</span>
00082 <span class="comment"></span>
00083 <span class="comment">    None.</span>
00084 <span class="comment"></span>
00085 <span class="comment">Return Value:</span>
00086 <span class="comment"></span>
00087 <span class="comment">    A value of TRUE is returned if the event pair object type descriptor is</span>
00088 <span class="comment">    successfully initialized. Otherwise a value of FALSE is returned.</span>
00089 <span class="comment"></span>
00090 <span class="comment">--*/</span>
00091 
00092 {
00093 
00094     <a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">OBJECT_TYPE_INITIALIZER</a> ObjectTypeInitializer;
00095     ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = 0;
00096     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00097     UNICODE_STRING TypeName;
00098 
00099     <span class="comment">//</span>
00100     <span class="comment">// Initialize string descriptor.</span>
00101     <span class="comment">//</span>
00102 
00103     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;TypeName, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"EventPair"</span>);
00104 
00105     <span class="comment">//</span>
00106     <span class="comment">// Create event object type descriptor.</span>
00107     <span class="comment">//</span>
00108 
00109     RtlZeroMemory(&amp;ObjectTypeInitializer, <span class="keyword">sizeof</span>(ObjectTypeInitializer));
00110     ObjectTypeInitializer.Length = <span class="keyword">sizeof</span>(ObjectTypeInitializer);
00111     ObjectTypeInitializer.InvalidAttributes = OBJ_OPENLINK;
00112     ObjectTypeInitializer.GenericMapping = <a class="code" href="../../d3/d8/eventpr_8c.html#a3">ExpEventPairMapping</a>;
00113     ObjectTypeInitializer.PoolType = <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>;
00114     ObjectTypeInitializer.DefaultNonPagedPoolCharge = <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">EEVENT_PAIR</a>);
00115     ObjectTypeInitializer.ValidAccessMask = EVENT_PAIR_ALL_ACCESS;
00116     ObjectTypeInitializer.UseDefaultObject = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00117     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d2/obtype_8c.html#a2">ObCreateObjectType</a>(&amp;TypeName,
00118                                 &amp;ObjectTypeInitializer,
00119                                 (PSECURITY_DESCRIPTOR)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00120                                 &amp;<a class="code" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a>);
00121 
00122     <span class="comment">//</span>
00123     <span class="comment">// If the event pair object type descriptor was successfully created, then</span>
00124     <span class="comment">// return a value of TRUE. Otherwise return a value of FALSE.</span>
00125     <span class="comment">//</span>
00126 
00127     <span class="keywordflow">return</span> (BOOLEAN)(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>));
00128 }
00129 
00130 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00131"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a5">00131</a> <a class="code" href="../../d3/d8/eventpr_8c.html#a5">NtCreateEventPair</a> (
00132     OUT PHANDLE EventPairHandle,
00133     IN ACCESS_MASK DesiredAccess,
00134     IN POBJECT_ATTRIBUTES ObjectAttributes OPTIONAL
00135     )
00136 
00137 <span class="comment">/*++</span>
00138 <span class="comment"></span>
00139 <span class="comment">Routine Description:</span>
00140 <span class="comment"></span>
00141 <span class="comment">    This function creates an event pair object, sets it initial state,</span>
00142 <span class="comment">    and opens a handle to the object with the specified desired access.</span>
00143 <span class="comment"></span>
00144 <span class="comment">Arguments:</span>
00145 <span class="comment"></span>
00146 <span class="comment">    EventPairHandle - Supplies a pointer to a variable that will receive the</span>
00147 <span class="comment">        event pair object handle.</span>
00148 <span class="comment"></span>
00149 <span class="comment">    DesiredAccess - Supplies the desired types of access for the event</span>
00150 <span class="comment">        pair object.</span>
00151 <span class="comment"></span>
00152 <span class="comment">    ObjectAttributes - Supplies a pointer to an object attributes</span>
00153 <span class="comment">        structure.</span>
00154 <span class="comment"></span>
00155 <span class="comment">Return Value:</span>
00156 <span class="comment"></span>
00157 <span class="comment">    TBS</span>
00158 <span class="comment"></span>
00159 <span class="comment">--*/</span>
00160 
00161 {
00162 
00163     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00164     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00165     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00166     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00167 
00168     <span class="comment">//</span>
00169     <span class="comment">// Establish an exception handler, probe the output handle address, and</span>
00170     <span class="comment">// attempt to create an event object. If the probe fails, then return the</span>
00171     <span class="comment">// exception code as the service status. Otherwise return the status value</span>
00172     <span class="comment">// returned by the object insertion routine.</span>
00173     <span class="comment">//</span>
00174 
00175     <span class="keywordflow">try</span> {
00176 
00177         <span class="comment">//</span>
00178         <span class="comment">// Get previous processor mode and probe output handle address if</span>
00179         <span class="comment">// necessary.</span>
00180         <span class="comment">//</span>
00181 
00182         PreviousMode = KeGetPreviousMode();
00183         <span class="keywordflow">if</span> (PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00184             <a class="code" href="../../d5/d8/ex_8h.html#a35">ProbeForWriteHandle</a>(EventPairHandle);
00185         }
00186 
00187         <span class="comment">//</span>
00188         <span class="comment">// Allocate event object.</span>
00189         <span class="comment">//</span>
00190 
00191         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d0/obcreate_8c.html#a5">ObCreateObject</a>(PreviousMode,
00192                                 <a class="code" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a>,
00193                                 <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00194                                 PreviousMode,
00195                                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00196                                 <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">EEVENT_PAIR</a>),
00197                                 0,
00198                                 0,
00199                                 (PVOID *)&amp;EventPair);
00200 
00201         <span class="comment">//</span>
00202         <span class="comment">// If the event pair object was successfully allocated, then</span>
00203         <span class="comment">// initialize the event pair object and attempt to insert the</span>
00204         <span class="comment">// event pair object in the current process' handle table.</span>
00205         <span class="comment">//</span>
00206 
00207         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00208             <a class="code" href="../../d2/d8/eventobj_8c.html#a3">KeInitializeEventPair</a>(&amp;EventPair-&gt;KernelEventPair);
00209             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d1/obinsert_8c.html#a0">ObInsertObject</a>((PVOID)EventPair,
00210                                     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00211                                     DesiredAccess,
00212                                     0,
00213                                     (PVOID *)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00214                                     &amp;<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>);
00215 
00216             <span class="comment">//</span>
00217             <span class="comment">// If the event pair object was successfully inserted in the</span>
00218             <span class="comment">// current process' handle table, then attempt to write the</span>
00219             <span class="comment">// event pair object handle value.  If the write attempt</span>
00220             <span class="comment">// fails, then do not report an error.  When the caller</span>
00221             <span class="comment">// attempts to access the handle value, an access violation</span>
00222             <span class="comment">// will occur.</span>
00223 
00224             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00225                 <span class="keywordflow">try</span> {
00226                     *EventPairHandle = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00227 
00228                 } except(<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00229                 }
00230             }
00231         }
00232 
00233         <span class="comment">//</span>
00234         <span class="comment">// If an exception occurs during the probe of the output handle address,</span>
00235         <span class="comment">// then always handle the exception and return the exception code as the</span>
00236         <span class="comment">// status value.</span>
00237         <span class="comment">//</span>
00238 
00239     } except (<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00240         <span class="keywordflow">return</span> GetExceptionCode();
00241     }
00242 
00243     <span class="comment">//</span>
00244     <span class="comment">// Return service status.</span>
00245     <span class="comment">//</span>
00246 
00247     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00248 }
00249 
00250 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00251"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a6">00251</a> <a class="code" href="../../d3/d8/eventpr_8c.html#a6">NtOpenEventPair</a>(
00252     OUT PHANDLE EventPairHandle,
00253     IN ACCESS_MASK DesiredAccess,
00254     IN POBJECT_ATTRIBUTES ObjectAttributes
00255     )
00256 
00257 <span class="comment">/*++</span>
00258 <span class="comment"></span>
00259 <span class="comment">Routine Description:</span>
00260 <span class="comment"></span>
00261 <span class="comment">    This function opens a handle to an event pair object with the specified</span>
00262 <span class="comment">    desired access.</span>
00263 <span class="comment"></span>
00264 <span class="comment">Arguments:</span>
00265 <span class="comment"></span>
00266 <span class="comment">    EventPairHandle - Supplies a pointer to a variable that will receive</span>
00267 <span class="comment">        the event pair object handle.</span>
00268 <span class="comment"></span>
00269 <span class="comment">    DesiredAccess - Supplies the desired types of access for the event</span>
00270 <span class="comment">        pair object.</span>
00271 <span class="comment"></span>
00272 <span class="comment">    ObjectAttributes - Supplies a pointer to an object attributes structure.</span>
00273 <span class="comment"></span>
00274 <span class="comment">Return Value:</span>
00275 <span class="comment"></span>
00276 <span class="comment">    TBS</span>
00277 <span class="comment"></span>
00278 <span class="comment">--*/</span>
00279 
00280 {
00281 
00282     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00283     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00284     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00285 
00286     <span class="comment">//</span>
00287     <span class="comment">// Establish an exception handler, probe the output handle address, and</span>
00288     <span class="comment">// attempt to open the event object. If the probe fails, then return the</span>
00289     <span class="comment">// exception code as the service status. Otherwise return the status value</span>
00290     <span class="comment">// returned by the object open routine.</span>
00291     <span class="comment">//</span>
00292 
00293     <span class="keywordflow">try</span> {
00294 
00295         <span class="comment">//</span>
00296         <span class="comment">// Get previous processor mode and probe output handle address</span>
00297         <span class="comment">// if necessary.</span>
00298         <span class="comment">//</span>
00299 
00300         PreviousMode = KeGetPreviousMode();
00301         <span class="keywordflow">if</span> (PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00302             <a class="code" href="../../d5/d8/ex_8h.html#a35">ProbeForWriteHandle</a>(EventPairHandle);
00303         }
00304 
00305         <span class="comment">//</span>
00306         <span class="comment">// Open handle to the event pair object with the specified</span>
00307         <span class="comment">// desired access.</span>
00308         <span class="comment">//</span>
00309 
00310         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a2">ObOpenObjectByName</a>(<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00311                                     <a class="code" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a>,
00312                                     PreviousMode,
00313                                     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00314                                     DesiredAccess,
00315                                     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00316                                     &amp;<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>);
00317 
00318 
00319         <span class="comment">//</span>
00320         <span class="comment">// If the open was successful, then attempt to write the event</span>
00321         <span class="comment">// pair object handle value.  If the write attempt fails, then do</span>
00322         <span class="comment">// not report an error.  When the caller attempts to access the</span>
00323         <span class="comment">// handle value, an access violation will occur.</span>
00324         <span class="comment">//</span>
00325 
00326         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00327             <span class="keywordflow">try</span> {
00328                 *EventPairHandle = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00329 
00330             } except(<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00331             }
00332         }
00333 
00334         <span class="comment">//</span>
00335         <span class="comment">// If an exception occurs during the probe of the output event handle,</span>
00336         <span class="comment">// then always handle the exception and return the exception code as the</span>
00337         <span class="comment">// status value.</span>
00338         <span class="comment">//</span>
00339 
00340     } except (<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00341         <span class="keywordflow">return</span> GetExceptionCode();
00342     }
00343 
00344     <span class="comment">//</span>
00345     <span class="comment">// Return service status.</span>
00346     <span class="comment">//</span>
00347 
00348     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00349 }
00350 
00351 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00352"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a7">00352</a> <a class="code" href="../../d3/d8/eventpr_8c.html#a7">NtWaitLowEventPair</a>(
00353     IN HANDLE EventPairHandle
00354     )
00355 
00356 <span class="comment">/*++</span>
00357 <span class="comment"></span>
00358 <span class="comment">Routine Description:</span>
00359 <span class="comment"></span>
00360 <span class="comment">    This function waits on the low event of an event pair object.</span>
00361 <span class="comment"></span>
00362 <span class="comment">Arguments:</span>
00363 <span class="comment"></span>
00364 <span class="comment">    EventPairHandle - Supplies a handle to an event pair object.</span>
00365 <span class="comment"></span>
00366 <span class="comment">Return Value:</span>
00367 <span class="comment"></span>
00368 <span class="comment">    TBS</span>
00369 <span class="comment"></span>
00370 <span class="comment">--*/</span>
00371 
00372 {
00373 
00374     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00375     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00376     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00377 
00378     <span class="comment">//</span>
00379     <span class="comment">// Reference event pair object by handle.</span>
00380     <span class="comment">//</span>
00381 
00382     PreviousMode = KeGetPreviousMode();
00383     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00384                                        SYNCHRONIZE,
00385                                        <a class="code" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a>,
00386                                        PreviousMode,
00387                                        (PVOID *)&amp;EventPair,
00388                                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00389 
00390     <span class="comment">//</span>
00391     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00392     <span class="comment">// of the event pair.</span>
00393     <span class="comment">//</span>
00394 
00395     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00396         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d9/ke_8h.html#a33">KeWaitForLowEventPair</a>(&amp;EventPair-&gt;KernelEventPair,
00397                                        PreviousMode,
00398                                        <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00399                                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00400 
00401         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00402     }
00403 
00404     <span class="comment">//</span>
00405     <span class="comment">// Return service status.</span>
00406     <span class="comment">//</span>
00407 
00408     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00409 }
00410 
00411 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00412"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a8">00412</a> <a class="code" href="../../d3/d8/eventpr_8c.html#a8">NtWaitHighEventPair</a>(
00413     IN HANDLE EventPairHandle
00414     )
00415 
00416 <span class="comment">/*++</span>
00417 <span class="comment"></span>
00418 <span class="comment">Routine Description:</span>
00419 <span class="comment"></span>
00420 <span class="comment">    This function waits on the high event of an event pair object.</span>
00421 <span class="comment"></span>
00422 <span class="comment">Arguments:</span>
00423 <span class="comment"></span>
00424 <span class="comment">    EventPairHandle - Supplies a handle to an event pair object.</span>
00425 <span class="comment"></span>
00426 <span class="comment">Return Value:</span>
00427 <span class="comment"></span>
00428 <span class="comment">    TBS</span>
00429 <span class="comment"></span>
00430 <span class="comment">--*/</span>
00431 
00432 {
00433 
00434     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00435     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00436     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00437 
00438     <span class="comment">//</span>
00439     <span class="comment">// Reference event pair object by handle.</span>
00440     <span class="comment">//</span>
00441 
00442     PreviousMode = KeGetPreviousMode();
00443     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00444                                        SYNCHRONIZE,
00445                                        <a class="code" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a>,
00446                                        PreviousMode,
00447                                        (PVOID *)&amp;EventPair,
00448                                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00449 
00450     <span class="comment">//</span>
00451     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00452     <span class="comment">// of the event pair.</span>
00453     <span class="comment">//</span>
00454 
00455     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00456         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d9/ke_8h.html#a32">KeWaitForHighEventPair</a>(&amp;EventPair-&gt;KernelEventPair,
00457                                         PreviousMode,
00458                                         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00459                                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00460 
00461         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00462     }
00463 
00464     <span class="comment">//</span>
00465     <span class="comment">// Return service status.</span>
00466     <span class="comment">//</span>
00467 
00468     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00469 }
00470 
00471 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00472"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a9">00472</a> <a class="code" href="../../d3/d8/eventpr_8c.html#a9">NtSetLowWaitHighEventPair</a>(
00473     IN HANDLE EventPairHandle
00474     )
00475 
00476 <span class="comment">/*++</span>
00477 <span class="comment"></span>
00478 <span class="comment">Routine Description:</span>
00479 <span class="comment"></span>
00480 <span class="comment">    This function sets the low event of an event pair and then</span>
00481 <span class="comment">    waits on the high event of an event pair object.</span>
00482 <span class="comment"></span>
00483 <span class="comment">Arguments:</span>
00484 <span class="comment"></span>
00485 <span class="comment">    EventPairHandle - Supplies a handle to an event pair object.</span>
00486 <span class="comment"></span>
00487 <span class="comment">Return Value:</span>
00488 <span class="comment"></span>
00489 <span class="comment">    TBS</span>
00490 <span class="comment"></span>
00491 <span class="comment">--*/</span>
00492 
00493 {
00494 
00495     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00496     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00497     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00498 
00499     <span class="comment">//</span>
00500     <span class="comment">// Reference event pair object by handle.</span>
00501     <span class="comment">//</span>
00502 
00503     PreviousMode = KeGetPreviousMode();
00504     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00505                                        SYNCHRONIZE,
00506                                        <a class="code" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a>,
00507                                        PreviousMode,
00508                                        (PVOID *)&amp;EventPair,
00509                                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00510 
00511     <span class="comment">//</span>
00512     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00513     <span class="comment">// of the event pair.</span>
00514     <span class="comment">//</span>
00515 
00516     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00517         <a class="code" href="../../d3/d8/eventpr_8c.html#a1">EvPrSetLow</a>++;
00518         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d9/ke_8h.html#a31">KeSetLowWaitHighEventPair</a>(&amp;EventPair-&gt;KernelEventPair,
00519                                            PreviousMode);
00520 
00521         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00522     }
00523 
00524     <span class="comment">//</span>
00525     <span class="comment">// Return service status.</span>
00526     <span class="comment">//</span>
00527 
00528     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00529 }
00530 
00531 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00532"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a10">00532</a> <a class="code" href="../../d3/d8/eventpr_8c.html#a10">NtSetHighWaitLowEventPair</a>(
00533     IN HANDLE EventPairHandle
00534     )
00535 
00536 <span class="comment">/*++</span>
00537 <span class="comment"></span>
00538 <span class="comment">Routine Description:</span>
00539 <span class="comment"></span>
00540 <span class="comment">    This function sets the high event of an event pair and then</span>
00541 <span class="comment">    waits on the low event of an event pair object.</span>
00542 <span class="comment"></span>
00543 <span class="comment">Arguments:</span>
00544 <span class="comment"></span>
00545 <span class="comment">    EventPairHandle - Supplies a handle to an event pair object.</span>
00546 <span class="comment"></span>
00547 <span class="comment">Return Value:</span>
00548 <span class="comment"></span>
00549 <span class="comment">    TBS</span>
00550 <span class="comment"></span>
00551 <span class="comment">--*/</span>
00552 
00553 {
00554 
00555     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00556     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00557     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00558 
00559     <span class="comment">//</span>
00560     <span class="comment">// Reference event pair object by handle.</span>
00561     <span class="comment">//</span>
00562 
00563     PreviousMode = KeGetPreviousMode();
00564     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00565                                        SYNCHRONIZE,
00566                                        <a class="code" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a>,
00567                                        PreviousMode,
00568                                        (PVOID *)&amp;EventPair,
00569                                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00570 
00571     <span class="comment">//</span>
00572     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00573     <span class="comment">// of the event pair.</span>
00574     <span class="comment">//</span>
00575 
00576     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00577         <a class="code" href="../../d3/d8/eventpr_8c.html#a0">EvPrSetHigh</a>++;
00578         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d9/ke_8h.html#a30">KeSetHighWaitLowEventPair</a>(&amp;EventPair-&gt;KernelEventPair,
00579                                            PreviousMode);
00580 
00581         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00582     }
00583 
00584     <span class="comment">//</span>
00585     <span class="comment">// Return service status.</span>
00586     <span class="comment">//</span>
00587 
00588     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00589 }
00590 
00591 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00592"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a11">00592</a> <a class="code" href="../../d3/d8/eventpr_8c.html#a11">NtSetLowEventPair</a>(
00593     IN HANDLE EventPairHandle
00594     )
00595 
00596 <span class="comment">/*++</span>
00597 <span class="comment"></span>
00598 <span class="comment">Routine Description:</span>
00599 <span class="comment"></span>
00600 <span class="comment">    This function sets the low event of an event pair object.</span>
00601 <span class="comment"></span>
00602 <span class="comment">Arguments:</span>
00603 <span class="comment"></span>
00604 <span class="comment">    EventPairHandle - Supplies a handle to an event pair object.</span>
00605 <span class="comment"></span>
00606 <span class="comment">Return Value:</span>
00607 <span class="comment"></span>
00608 <span class="comment">    TBS</span>
00609 <span class="comment"></span>
00610 <span class="comment">--*/</span>
00611 
00612 {
00613 
00614     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00615     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00616     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00617 
00618     <span class="comment">//</span>
00619     <span class="comment">// Reference event pair object by handle.</span>
00620     <span class="comment">//</span>
00621 
00622     PreviousMode = KeGetPreviousMode();
00623     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00624                                        SYNCHRONIZE,
00625                                        <a class="code" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a>,
00626                                        PreviousMode,
00627                                        (PVOID *)&amp;EventPair,
00628                                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00629 
00630     <span class="comment">//</span>
00631     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00632     <span class="comment">// of the event pair.</span>
00633     <span class="comment">//</span>
00634 
00635     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00636         <a class="code" href="../../d3/d8/eventpr_8c.html#a1">EvPrSetLow</a>++;
00637         <a class="code" href="../../d4/d9/ke_8h.html#a23">KeSetLowEventPair</a>(&amp;EventPair-&gt;KernelEventPair,
00638                           <a class="code" href="../../d7/d8/exboosts_8h.html#a1">EVENT_PAIR_INCREMENT</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00639 
00640         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00641     }
00642 
00643     <span class="comment">//</span>
00644     <span class="comment">// Return service status.</span>
00645     <span class="comment">//</span>
00646 
00647     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00648 }
00649 
00650 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00651"></a><a class="code" href="../../d3/d8/eventpr_8c.html#a12">00651</a> <a class="code" href="../../d3/d8/eventpr_8c.html#a12">NtSetHighEventPair</a>(
00652     IN HANDLE EventPairHandle
00653     )
00654 
00655 <span class="comment">/*++</span>
00656 <span class="comment"></span>
00657 <span class="comment">Routine Description:</span>
00658 <span class="comment"></span>
00659 <span class="comment">    This function sets the high event of an event pair object.</span>
00660 <span class="comment"></span>
00661 <span class="comment">Arguments:</span>
00662 <span class="comment"></span>
00663 <span class="comment">    EventPairHandle - Supplies a handle to an event pair object.</span>
00664 <span class="comment"></span>
00665 <span class="comment">Return Value:</span>
00666 <span class="comment"></span>
00667 <span class="comment">    TBS</span>
00668 <span class="comment"></span>
00669 <span class="comment">--*/</span>
00670 
00671 {
00672 
00673     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00674     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00675     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00676 
00677     <span class="comment">//</span>
00678     <span class="comment">// Reference event pair object by handle.</span>
00679     <span class="comment">//</span>
00680 
00681     PreviousMode = KeGetPreviousMode();
00682     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00683                                        SYNCHRONIZE,
00684                                        <a class="code" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a>,
00685                                        PreviousMode,
00686                                        (PVOID *)&amp;EventPair,
00687                                        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00688 
00689     <span class="comment">//</span>
00690     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00691     <span class="comment">// of the event pair.</span>
00692     <span class="comment">//</span>
00693 
00694     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00695         <a class="code" href="../../d3/d8/eventpr_8c.html#a0">EvPrSetHigh</a>++;
00696         <a class="code" href="../../d4/d9/ke_8h.html#a22">KeSetHighEventPair</a>(&amp;EventPair-&gt;KernelEventPair,
00697                            <a class="code" href="../../d7/d8/exboosts_8h.html#a1">EVENT_PAIR_INCREMENT</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00698 
00699         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00700     }
00701 
00702     <span class="comment">//</span>
00703     <span class="comment">// Return service status.</span>
00704     <span class="comment">//</span>
00705 
00706     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00707 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:57 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
