<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: udfprocs.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>udfprocs.h</h1><a href="../../d3/d8/udfprocs_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    UdfProcs.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module defines all of the globally used procedures in the Udfs</span>
00012 <span class="comment">    file system.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Dan Lovinger    [DanLo]   29-May-1996</span>
00017 <span class="comment"></span>
00018 <span class="comment">Revision History:</span>
00019 <span class="comment"></span>
00020 <span class="comment">--*/</span>
00021 
00022 <span class="preprocessor">#ifndef _UDFPROCS_</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define _UDFPROCS_</span>
00024 <span class="preprocessor"></span>
00025 <span class="preprocessor">#include &lt;ntifs.h&gt;</span>
00026 
00027 <span class="preprocessor">#include &lt;ntddcdrm.h&gt;</span>
00028 <span class="preprocessor">#include &lt;ntddcdvd.h&gt;</span>
00029 <span class="preprocessor">#include &lt;ntdddisk.h&gt;</span>
00030 
00031 <span class="preprocessor">#ifndef INLINE</span>
<a name="l00032"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a0">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define INLINE __inline</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#include "<a class="code" href="../../d1/d7/udfs_2nodetype_8h.html">nodetype.h</a>"</span>
00036 <span class="preprocessor">#include "Udf.h"</span>
00037 <span class="preprocessor">#include "UdfStruc.h"</span>
00038 <span class="preprocessor">#include "UdfData.h"</span>
00039 
00040 <span class="comment">//</span>
00041 <span class="comment">//  The Bug check file id for this module</span>
00042 <span class="comment">//</span>
00043 
<a name="l00044"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a1">00044</a> <span class="preprocessor">#define BugCheckFileId                   (UDFS_BUG_CHECK_STRUCSUP)</span>
00045 <span class="preprocessor"></span>
00046 <span class="comment">//</span>
00047 <span class="comment">//  The local debug trace level</span>
00048 <span class="comment">//</span>
00049 
<a name="l00050"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a2">00050</a> <span class="preprocessor">#define Dbg                              (UDFS_DEBUG_LEVEL_STRUCSUP)</span>
00051 <span class="preprocessor"></span>
00052 
00053 <span class="comment">//</span>
00054 <span class="comment">//  Miscellaneous support routines/macros</span>
00055 <span class="comment">//</span>
00056 
00057 <span class="comment">//</span>
00058 <span class="comment">//  Yet another declaration of Min/Max</span>
00059 <span class="comment">//</span>
00060 
<a name="l00061"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a3">00061</a> <span class="preprocessor">#define Min(a, b)   ((a) &lt; (b) ? (a) : (b))</span>
<a name="l00062"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a4">00062</a> <span class="preprocessor"></span><span class="preprocessor">#define Max(a, b)   ((a) &gt; (b) ? (a) : (b))</span>
00063 <span class="preprocessor"></span>
00064 <span class="comment">//</span>
00065 <span class="comment">//  Yet another declaration of the basic bit fiddlers</span>
00066 <span class="comment">//</span>
00067 
<a name="l00068"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a5">00068</a> <span class="preprocessor">#define FlagMask(F,SF) (                \</span>
00069 <span class="preprocessor">    ((F) &amp; (SF))                        \</span>
00070 <span class="preprocessor">)</span>
00071 <span class="preprocessor"></span>
<a name="l00072"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a6">00072</a> <span class="preprocessor">#define BooleanFlagOn(F,SF) (           \</span>
00073 <span class="preprocessor">    (BOOLEAN)(FlagOn(F, SF) != 0)       \</span>
00074 <span class="preprocessor">)</span>
00075 <span class="preprocessor"></span>
<a name="l00076"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a7">00076</a> <span class="preprocessor">#define BooleanFlagOff(F,SF) (          \</span>
00077 <span class="preprocessor">    (BOOLEAN)(FlagOn(F, SF)) == 0)      \</span>
00078 <span class="preprocessor">)</span>
00079 <span class="preprocessor"></span>
<a name="l00080"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a8">00080</a> <span class="preprocessor">#define SetFlag(Flags,SingleFlag) (     \</span>
00081 <span class="preprocessor">    (Flags) |= (SingleFlag)             \</span>
00082 <span class="preprocessor">)</span>
00083 <span class="preprocessor"></span>
<a name="l00084"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a9">00084</a> <span class="preprocessor">#define ClearFlag(Flags,SingleFlag) (   \</span>
00085 <span class="preprocessor">    (Flags) &amp;= ~(SingleFlag)            \</span>
00086 <span class="preprocessor">)</span>
00087 <span class="preprocessor"></span>
00088 <span class="comment">//</span>
00089 <span class="comment">//      CAST</span>
00090 <span class="comment">//      Add2Ptr (</span>
00091 <span class="comment">//          IN PVOID Pointer,</span>
00092 <span class="comment">//          IN ULONG Increment</span>
00093 <span class="comment">//          IN (CAST)</span>
00094 <span class="comment">//          );</span>
00095 <span class="comment">//</span>
00096 <span class="comment">//      ULONG</span>
00097 <span class="comment">//      PtrOffset (</span>
00098 <span class="comment">//          IN PVOID BasePtr,</span>
00099 <span class="comment">//          IN PVOID OffsetPtr</span>
00100 <span class="comment">//          );</span>
00101 <span class="comment">//</span>
00102 
<a name="l00103"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a10">00103</a> <span class="preprocessor">#define Add2Ptr(PTR,INC,CAST) ((CAST)((ULONG_PTR)(PTR) + (INC)))</span>
00104 <span class="preprocessor"></span>
<a name="l00105"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a11">00105</a> <span class="preprocessor">#define PtrOffset(BASE,OFFSET) ((ULONG)((ULONG)(OFFSET) - (ULONG)(BASE)))</span>
00106 <span class="preprocessor"></span>
00107 <span class="comment">//</span>
00108 <span class="comment">//  Generic truncation/align/offset/remainder macros for power-of-two units.</span>
00109 <span class="comment">//</span>
00110 <span class="comment">//  The offset and remainder functions range from zero to (unit - 1).  The</span>
00111 <span class="comment">//  re-offset in the remainder performs this work.</span>
00112 <span class="comment">//</span>
00113 
<a name="l00114"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a12">00114</a> <span class="preprocessor">#define GenericTruncate(B, U) (                                             \</span>
00115 <span class="preprocessor">    (B) &amp; ~((U) - 1)                                                        \</span>
00116 <span class="preprocessor">)</span>
00117 <span class="preprocessor"></span>
<a name="l00118"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a13">00118</a> <span class="preprocessor">#define GenericAlign(B, U) (                                                \</span>
00119 <span class="preprocessor">    GenericTruncate((B) + (U) - 1, U)                                       \</span>
00120 <span class="preprocessor">)</span>
00121 <span class="preprocessor"></span>
<a name="l00122"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a14">00122</a> <span class="preprocessor">#define GenericOffset(B, U) (                                               \</span>
00123 <span class="preprocessor">    (B) &amp; ((U) - 1)                                                         \</span>
00124 <span class="preprocessor">)</span>
00125 <span class="preprocessor"></span>
<a name="l00126"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a15">00126</a> <span class="preprocessor">#define GenericRemainder(B, U) (                                            \</span>
00127 <span class="preprocessor">    GenericOffset( (U) - GenericOffset((B), (U)), (U) )                     \</span>
00128 <span class="preprocessor">)</span>
00129 <span class="preprocessor"></span>
00130 
<a name="l00131"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a16">00131</a> <span class="preprocessor">#define GenericTruncatePtr(B, U) (                                          \</span>
00132 <span class="preprocessor">    (PVOID)(((ULONG_PTR)(B)) &amp; ~((U) - 1))                                  \</span>
00133 <span class="preprocessor">)</span>
00134 <span class="preprocessor"></span>
<a name="l00135"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a17">00135</a> <span class="preprocessor">#define GenericAlignPtr(B, U) (                                             \</span>
00136 <span class="preprocessor">    GenericTruncatePtr((B) + (U) - 1, (U))                                  \</span>
00137 <span class="preprocessor">)</span>
00138 <span class="preprocessor"></span>
<a name="l00139"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a18">00139</a> <span class="preprocessor">#define GenericOffsetPtr(B, U) (                                            \</span>
00140 <span class="preprocessor">    (ULONG)(((ULONG_PTR)(B)) &amp; ((U) - 1))                                   \</span>
00141 <span class="preprocessor">)</span>
00142 <span class="preprocessor"></span>
<a name="l00143"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a19">00143</a> <span class="preprocessor">#define GenericRemainderPtr(B, U) (                                         \</span>
00144 <span class="preprocessor">    (ULONG)GenericOffset( (U) - GenericOffsetPtr((B), (U)), (U) )           \</span>
00145 <span class="preprocessor">)</span>
00146 <span class="preprocessor"></span>
00147 <span class="comment">//</span>
00148 <span class="comment">//  Useful compositions of the defaults for common types.</span>
00149 <span class="comment">//</span>
00150 
<a name="l00151"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a20">00151</a> <span class="preprocessor">#define WordAlign(B) GenericAlign((B), 2)</span>
00152 <span class="preprocessor"></span>
<a name="l00153"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a21">00153</a> <span class="preprocessor">#define LongAlign(B) GenericAlign((B), 4)</span>
00154 <span class="preprocessor"></span>
<a name="l00155"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a22">00155</a> <span class="preprocessor">#define QuadAlign(B) GenericAlign((B), 8)</span>
00156 <span class="preprocessor"></span>
00157 
<a name="l00158"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a23">00158</a> <span class="preprocessor">#define WordOffset(B) GenericOffset((B), 2)</span>
00159 <span class="preprocessor"></span>
<a name="l00160"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a24">00160</a> <span class="preprocessor">#define LongOffset(B) GenericOffset((B), 4)</span>
00161 <span class="preprocessor"></span>
<a name="l00162"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a25">00162</a> <span class="preprocessor">#define QuadOffset(B) GenericOffset((B), 8)</span>
00163 <span class="preprocessor"></span>
00164 
<a name="l00165"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a26">00165</a> <span class="preprocessor">#define WordAlignPtr(P) GenericAlignPtr((P), 2)</span>
00166 <span class="preprocessor"></span>
<a name="l00167"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a27">00167</a> <span class="preprocessor">#define LongAlignPtr(P) GenericAlignPtr((P), 4)</span>
00168 <span class="preprocessor"></span>
<a name="l00169"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a28">00169</a> <span class="preprocessor">#define QuadAlignPtr(P) GenericAlignPtr((P), 8)</span>
00170 <span class="preprocessor"></span>
00171 
<a name="l00172"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a29">00172</a> <span class="preprocessor">#define WordOffsetPtr(P) GenericOffsetPtr((P), 2)</span>
00173 <span class="preprocessor"></span>
<a name="l00174"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a30">00174</a> <span class="preprocessor">#define LongOffsetPtr(P) GenericOffsetPtr((P), 4)</span>
00175 <span class="preprocessor"></span>
<a name="l00176"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a31">00176</a> <span class="preprocessor">#define QuadOffsetPtr(P) GenericOffsetPtr((P), 8)</span>
00177 <span class="preprocessor"></span>
00178 
00179 <span class="comment">//</span>
00180 <span class="comment">//  Macros to round up and down on sector and logical block boundaries.  Although</span>
00181 <span class="comment">//  UDF 1.01 specifies that a physical sector is the logical block size we will</span>
00182 <span class="comment">//  be general and treat sectors and logical blocks as distinct.  Since UDF may</span>
00183 <span class="comment">//  at some point relax the restriction, these definitions will be the only</span>
00184 <span class="comment">//  acknowledgement outside of the mount path (which merely checks the volume's</span>
00185 <span class="comment">//  conformance).</span>
00186 <span class="comment">//</span>
00187 
00188 <span class="comment">//</span>
00189 <span class="comment">//  Sector</span>
00190 <span class="comment">//</span>
00191 
<a name="l00192"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a32">00192</a> <span class="preprocessor">#define SectorAlignN(SECTORSIZE, L) (                                           \</span>
00193 <span class="preprocessor">    ((((ULONG)(L)) + ((SECTORSIZE) - 1)) &amp; ~((SECTORSIZE) - 1))                 \</span>
00194 <span class="preprocessor">)</span>
00195 <span class="preprocessor"></span>
<a name="l00196"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a33">00196</a> <span class="preprocessor">#define SectorAlign(V, L) (                                                     \</span>
00197 <span class="preprocessor">    ((((ULONG)(L)) + (((V)-&gt;SectorSize) - 1)) &amp; ~(((V)-&gt;SectorSize) - 1))       \</span>
00198 <span class="preprocessor">)</span>
00199 <span class="preprocessor"></span>
<a name="l00200"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a34">00200</a> <span class="preprocessor">#define LlSectorAlign(V, L) (                                                   \</span>
00201 <span class="preprocessor">    ((((LONGLONG)(L)) + (((V)-&gt;SectorSize) - 1)) &amp; ~(((LONGLONG)(V)-&gt;SectorSize) - 1)) \</span>
00202 <span class="preprocessor">)</span>
00203 <span class="preprocessor"></span>
<a name="l00204"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a35">00204</a> <span class="preprocessor">#define SectorTruncate(V, L) (                                                  \</span>
00205 <span class="preprocessor">    ((ULONG)(L)) &amp; ~(((V)-&gt;SectorSize) - 1)                                     \</span>
00206 <span class="preprocessor">)</span>
00207 <span class="preprocessor"></span>
<a name="l00208"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a36">00208</a> <span class="preprocessor">#define LlSectorTruncate(V, L) (                                                \</span>
00209 <span class="preprocessor">    ((LONGLONG)(L)) &amp; ~(((LONGLONG)(V)-&gt;SectorSize) - 1)                        \</span>
00210 <span class="preprocessor">)</span>
00211 <span class="preprocessor"></span>
<a name="l00212"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a37">00212</a> <span class="preprocessor">#define BytesFromSectors(V, L) (                                                \</span>
00213 <span class="preprocessor">    ((ULONG) (L)) &lt;&lt; ((V)-&gt;SectorShift)                                         \</span>
00214 <span class="preprocessor">)</span>
00215 <span class="preprocessor"></span>
<a name="l00216"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a38">00216</a> <span class="preprocessor">#define SectorsFromBytes(V, L) (                                                \</span>
00217 <span class="preprocessor">    ((ULONG) (L)) &gt;&gt; ((V)-&gt;SectorShift)                                         \</span>
00218 <span class="preprocessor">)</span>
00219 <span class="preprocessor"></span>
<a name="l00220"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a39">00220</a> <span class="preprocessor">#define LlBytesFromSectors(V, L) (                                              \</span>
00221 <span class="preprocessor">    Int64ShllMod32( (ULONGLONG)(L), ((V)-&gt;SectorShift) )                        \</span>
00222 <span class="preprocessor">)</span>
00223 <span class="preprocessor"></span>
<a name="l00224"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a40">00224</a> <span class="preprocessor">#define LlSectorsFromBytes(V, L) (                                              \</span>
00225 <span class="preprocessor">    Int64ShrlMod32( (ULONGLONG)(L), ((V)-&gt;SectorShift) )                        \</span>
00226 <span class="preprocessor">)</span>
00227 <span class="preprocessor"></span>
<a name="l00228"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a41">00228</a> <span class="preprocessor">#define SectorsFromBlocks(V, B) (B)</span>
00229 <span class="preprocessor"></span>
<a name="l00230"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a42">00230</a> <span class="preprocessor">#define SectorSize(V) ((V)-&gt;SectorSize)</span>
00231 <span class="preprocessor"></span>
<a name="l00232"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a43">00232</a> <span class="preprocessor">#define SectorOffset(V, L) (                                                    \</span>
00233 <span class="preprocessor">    ((ULONG) (L)) &amp; (((V)-&gt;SectorSize) - 1)                                     \</span>
00234 <span class="preprocessor">)</span>
00235 <span class="preprocessor"></span>
00236 <span class="comment">//</span>
00237 <span class="comment">//  Logical Block</span>
00238 <span class="comment">//</span>
00239 
<a name="l00240"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a44">00240</a> <span class="preprocessor">#define BlockAlignN(BLOCKSIZE, L) (                                             \</span>
00241 <span class="preprocessor">    SectorAlighN((BLOCKSIZE), (L))                                              \</span>
00242 <span class="preprocessor">)</span>
00243 <span class="preprocessor"></span>
<a name="l00244"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a45">00244</a> <span class="preprocessor">#define BlockAlign(V, L) (                                                      \</span>
00245 <span class="preprocessor">    SectorAlign((V), (L))                                                       \</span>
00246 <span class="preprocessor">)</span>
00247 <span class="preprocessor"></span>
<a name="l00248"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a46">00248</a> <span class="preprocessor">#define LlBlockAlign(V, L) (                                                    \</span>
00249 <span class="preprocessor">    LlSectorAlign((V), (L))                                                     \</span>
00250 <span class="preprocessor">)</span>
00251 <span class="preprocessor"></span>
<a name="l00252"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a47">00252</a> <span class="preprocessor">#define BlockTruncate(V, L) (                                                   \</span>
00253 <span class="preprocessor">    SectorTruncate((V), (L))                                                    \</span>
00254 <span class="preprocessor">)</span>
00255 <span class="preprocessor"></span>
<a name="l00256"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a48">00256</a> <span class="preprocessor">#define LlBlockTruncate(V, L) (                                                 \</span>
00257 <span class="preprocessor">    LlSectorTruncate((V), (L))                                                  \</span>
00258 <span class="preprocessor">)</span>
00259 <span class="preprocessor"></span>
<a name="l00260"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a49">00260</a> <span class="preprocessor">#define BytesFromBlocks(V, L) (                                                 \</span>
00261 <span class="preprocessor">    BytesFromSectors((V), (L))                                                  \</span>
00262 <span class="preprocessor">)</span>
00263 <span class="preprocessor"></span>
<a name="l00264"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a50">00264</a> <span class="preprocessor">#define BlocksFromBytes(V, L) (                                                 \</span>
00265 <span class="preprocessor">    SectorsFromBytes((V), (L))                                                  \</span>
00266 <span class="preprocessor">)</span>
00267 <span class="preprocessor"></span>
<a name="l00268"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a51">00268</a> <span class="preprocessor">#define LlBytesFromBlocks(V, L) (                                               \</span>
00269 <span class="preprocessor">    LlBytesFromSectors((V), (L))                                                \</span>
00270 <span class="preprocessor">)</span>
00271 <span class="preprocessor"></span>
<a name="l00272"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a52">00272</a> <span class="preprocessor">#define LlBlocksFromBytes(V, L) (                                               \</span>
00273 <span class="preprocessor">    LlSectorsFromBytes((V), (L))                                                \</span>
00274 <span class="preprocessor">)</span>
00275 <span class="preprocessor"></span>
<a name="l00276"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a53">00276</a> <span class="preprocessor">#define BlocksFromSectors(V, S) (S)</span>
00277 <span class="preprocessor"></span>
<a name="l00278"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a54">00278</a> <span class="preprocessor">#define BlockSize(V) (SectorSize(V))</span>
00279 <span class="preprocessor"></span>
<a name="l00280"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a55">00280</a> <span class="preprocessor">#define BlockOffset(V, L) (                                                     \</span>
00281 <span class="preprocessor">    SectorOffset((V), (L))                                                      \</span>
00282 <span class="preprocessor">)</span>
00283 <span class="preprocessor"></span>
00284 <span class="comment">//</span>
00285 <span class="comment">//  The following types and macros are used to help unpack the packed and</span>
00286 <span class="comment">//  misaligned fields found in various structures.</span>
00287 <span class="comment">//</span>
00288 
00289 <span class="keyword">typedef</span> <span class="keyword">union </span><a class="code" href="../../d9/d2/union__UCHAR1.html">_UCHAR1</a> {
<a name="l00290"></a><a class="code" href="../../d9/d2/union__UCHAR1.html#o0">00290</a>     UCHAR  <a class="code" href="../../d9/d2/union__UCHAR1.html#o0">Uchar</a>[1];
<a name="l00291"></a><a class="code" href="../../d9/d2/union__UCHAR1.html#o1">00291</a>     UCHAR  <a class="code" href="../../d9/d2/union__UCHAR1.html#o1">ForceAlignment</a>;
00292 } <a class="code" href="../../d9/d2/union__UCHAR1.html">UCHAR1</a>, *<a class="code" href="../../d9/d2/union__UCHAR1.html">PUCHAR1</a>;
00293 
00294 <span class="keyword">typedef</span> <span class="keyword">union </span><a class="code" href="../../d0/d3/union__UCHAR2.html">_UCHAR2</a> {
<a name="l00295"></a><a class="code" href="../../d0/d3/union__UCHAR2.html#o0">00295</a>     UCHAR  <a class="code" href="../../d0/d3/union__UCHAR2.html#o0">Uchar</a>[2];
<a name="l00296"></a><a class="code" href="../../d0/d3/union__UCHAR2.html#o1">00296</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d0/d3/union__UCHAR2.html#o1">ForceAlignment</a>;
00297 } <a class="code" href="../../d0/d3/union__UCHAR2.html">UCHAR2</a>, *<a class="code" href="../../d0/d3/union__UCHAR2.html">PUCHAR2</a>;
00298 
00299 <span class="keyword">typedef</span> <span class="keyword">union </span><a class="code" href="../../d1/d3/union__UCHAR4.html">_UCHAR4</a> {
<a name="l00300"></a><a class="code" href="../../d1/d3/union__UCHAR4.html#o0">00300</a>     UCHAR  <a class="code" href="../../d1/d3/union__UCHAR4.html#o0">Uchar</a>[4];
<a name="l00301"></a><a class="code" href="../../d1/d3/union__UCHAR4.html#o1">00301</a>     ULONG  <a class="code" href="../../d1/d3/union__UCHAR4.html#o1">ForceAlignment</a>;
00302 } <a class="code" href="../../d1/d3/union__UCHAR4.html">UCHAR4</a>, *<a class="code" href="../../d1/d3/union__UCHAR4.html">PUCHAR4</a>;
00303 
<a name="l00304"></a><a class="code" href="../../d7/d4/union__USHORT2.html">00304</a> <span class="keyword">typedef</span> <span class="keyword">union </span><a class="code" href="../../d7/d4/union__USHORT2.html">_USHORT2</a> {
<a name="l00305"></a><a class="code" href="../../d7/d4/union__USHORT2.html#o0">00305</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d7/d4/union__USHORT2.html#o0">Ushort</a>[2];
<a name="l00306"></a><a class="code" href="../../d7/d4/union__USHORT2.html#o1">00306</a>     ULONG  <a class="code" href="../../d7/d4/union__USHORT2.html#o1">ForceAlignment</a>;
00307 } <a class="code" href="../../d7/d4/union__USHORT2.html">USHORT2</a>, *<a class="code" href="../../d7/d4/union__USHORT2.html">PUSHORT2</a>;
00308 
00309 <span class="comment">//</span>
00310 <span class="comment">//  This macro copies an unaligned src byte to an aligned dst byte</span>
00311 <span class="comment">//</span>
00312 
<a name="l00313"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a56">00313</a> <span class="preprocessor">#define CopyUchar1(Dst,Src) {                           \</span>
00314 <span class="preprocessor">    *((UCHAR1 *)(Dst)) = *((UNALIGNED UCHAR1 *)(Src));  \</span>
00315 <span class="preprocessor">    }</span>
00316 <span class="preprocessor"></span>
00317 <span class="comment">//</span>
00318 <span class="comment">//  This macro copies an unaligned src word to an aligned dst word</span>
00319 <span class="comment">//</span>
00320 
<a name="l00321"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a57">00321</a> <span class="preprocessor">#define CopyUchar2(Dst,Src) {                           \</span>
00322 <span class="preprocessor">    *((UCHAR2 *)(Dst)) = *((UNALIGNED UCHAR2 *)(Src));  \</span>
00323 <span class="preprocessor">    }</span>
00324 <span class="preprocessor"></span>    
00325 <span class="comment">//</span>
00326 <span class="comment">//  This macro copies an unaligned src word to a dst word,</span>
00327 <span class="comment">//  performing an little/big endian swap.</span>
00328 <span class="comment">//</span>
00329 
<a name="l00330"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a58">00330</a> <span class="preprocessor">#define SwapCopyUchar2(Dst,Src) {                                       \</span>
00331 <span class="preprocessor">    *((UNALIGNED UCHAR1 *)(Dst)) = *((UNALIGNED UCHAR1 *)(Src) + 1);    \</span>
00332 <span class="preprocessor">    *((UNALIGNED UCHAR1 *)(Dst) + 1) = *((UNALIGNED UCHAR1 *)(Src));    \</span>
00333 <span class="preprocessor">}</span>
00334 <span class="preprocessor"></span>
00335 <span class="comment">//</span>
00336 <span class="comment">//  This macro copies an unaligned src longword to an aligned dst longword</span>
00337 <span class="comment">//</span>
00338 
<a name="l00339"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a59">00339</a> <span class="preprocessor">#define CopyUchar4(Dst,Src) {                           \</span>
00340 <span class="preprocessor">    *((UCHAR4 *)(Dst)) = *((UNALIGNED UCHAR4 *)(Src));  \</span>
00341 <span class="preprocessor">    }</span>
00342 <span class="preprocessor"></span>
00343 <span class="comment">//</span>
00344 <span class="comment">//  This macro copies an unaligned src longword to a dst longword,</span>
00345 <span class="comment">//  performing an little/big endian swap.</span>
00346 <span class="comment">//</span>
00347 
<a name="l00348"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a60">00348</a> <span class="preprocessor">#define SwapCopyUchar4(Dst,Src) {                                        \</span>
00349 <span class="preprocessor">    *((UNALIGNED UCHAR1 *)(Dst)) = *((UNALIGNED UCHAR1 *)(Src) + 3);     \</span>
00350 <span class="preprocessor">    *((UNALIGNED UCHAR1 *)(Dst) + 1) = *((UNALIGNED UCHAR1 *)(Src) + 2); \</span>
00351 <span class="preprocessor">    *((UNALIGNED UCHAR1 *)(Dst) + 2) = *((UNALIGNED UCHAR1 *)(Src) + 1); \</span>
00352 <span class="preprocessor">    *((UNALIGNED UCHAR1 *)(Dst) + 3) = *((UNALIGNED UCHAR1 *)(Src));     \</span>
00353 <span class="preprocessor">}</span>
00354 <span class="preprocessor"></span>
00355 <span class="comment">//</span>
00356 <span class="comment">//  This macro copies an unaligned src longword to an aligned dsr longword</span>
00357 <span class="comment">//  accessing the source on a word boundary.</span>
00358 <span class="comment">//</span>
00359 
<a name="l00360"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a61">00360</a> <span class="preprocessor">#define CopyUshort2(Dst,Src) {                          \</span>
00361 <span class="preprocessor">    *((USHORT2 *)(Dst)) = *((UNALIGNED USHORT2 *)(Src));\</span>
00362 <span class="preprocessor">    }</span>
00363 <span class="preprocessor"></span>
00364 <span class="comment">//</span>
00365 <span class="comment">//  The following macro is used to determine if an FSD thread can block</span>
00366 <span class="comment">//  for I/O or wait for a resource.  It returns TRUE if the thread can</span>
00367 <span class="comment">//  block and FALSE otherwise.  This attribute can then be used to call</span>
00368 <span class="comment">//  the FSD &amp; FSP common work routine with the proper wait value.</span>
00369 <span class="comment">//</span>
00370 
<a name="l00371"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a62">00371</a> <span class="preprocessor">#define CanFsdWait(I)   IoIsOperationSynchronous(I)</span>
00372 <span class="preprocessor"></span>
00373 <span class="comment">//</span>
00374 <span class="comment">//  The following macro is used to set the fast i/o possible bits in the</span>
00375 <span class="comment">//  FsRtl header.</span>
00376 <span class="comment">//</span>
00377 <span class="comment">//      FastIoIsNotPossible - If the Fcb is bad or there are oplocks on the file.</span>
00378 <span class="comment">//</span>
00379 <span class="comment">//      FastIoIsQuestionable - If there are file locks.</span>
00380 <span class="comment">//</span>
00381 <span class="comment">//      FastIoIsPossible - In all other cases.</span>
00382 <span class="comment">//</span>
00383 <span class="comment">//</span>
00384 
<a name="l00385"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a63">00385</a> <span class="preprocessor">#define UdfIsFastIoPossible(F) ((BOOLEAN)                                           \</span>
00386 <span class="preprocessor">    ((((F)-&gt;Vcb-&gt;VcbCondition != VcbMounted ) ||                                    \</span>
00387 <span class="preprocessor">      !FsRtlOplockIsFastIoPossible( &amp;(F)-&gt;Oplock )) ?                               \</span>
00388 <span class="preprocessor">                                                                                    \</span>
00389 <span class="preprocessor">     FastIoIsNotPossible :                                                          \</span>
00390 <span class="preprocessor">                                                                                    \</span>
00391 <span class="preprocessor">     ((((F)-&gt;FileLock != NULL) &amp;&amp; FsRtlAreThereCurrentFileLocks( (F)-&gt;FileLock )) ? \</span>
00392 <span class="preprocessor">                                                                                    \</span>
00393 <span class="preprocessor">        FastIoIsQuestionable :                                                      \</span>
00394 <span class="preprocessor">                                                                                    \</span>
00395 <span class="preprocessor">        FastIoIsPossible))                                                          \</span>
00396 <span class="preprocessor">)</span>
00397 <span class="preprocessor"></span>
00398 <span class="comment">//</span>
00399 <span class="comment">//  The following macros encapsulate the common work of raising exceptions while storing</span>
00400 <span class="comment">//  the exception in the IrpContext.</span>
00401 <span class="comment">//</span>
00402 
00403 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
00404 DECLSPEC_NORETURN
00405 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00406"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a122">00406</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a122">UdfRaiseStatus</a> (
00407     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00408     IN NTSTATUS Status
00409     )
00410 {
00411     IrpContext-&gt;ExceptionStatus = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00412     <a class="code" href="../../d1/d8/udfdata_8h.html#a9">DebugBreakOnStatus</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00413     <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00414 }
00415 
00416 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
00417 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00418"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a123">00418</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a123">UdfNormalizeAndRaiseStatus</a> (
00419     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00420     IN NTSTATUS Status
00421     )
00422 {
00423     IrpContext-&gt;ExceptionStatus = <a class="code" href="../../d1/d8/fsrtl_8h.html#a136">FsRtlNormalizeNtstatus</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>, STATUS_UNEXPECTED_IO_ERROR );
00424     <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( IrpContext-&gt;ExceptionStatus );
00425 }
00426 
00427 <span class="comment">//</span>
00428 <span class="comment">//  The following is a convenience macro to execute a little code before making</span>
00429 <span class="comment">//  a shortcircuit out of a surrounding try-finally clause.  This is usually to</span>
00430 <span class="comment">//  set a status value.</span>
00431 <span class="comment">//</span>
00432 <span class="comment">//  Note that our compilers support the leave keyword now and we don't have to</span>
00433 <span class="comment">//  use the old try_exit: labels and goto.</span>
00434 <span class="comment">//</span>
00435 
<a name="l00436"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a64">00436</a> <span class="preprocessor">#define try_leave(S) { S; leave; }</span>
00437 <span class="preprocessor"></span>
00438 <span class="comment">//</span>
00439 <span class="comment">//  For debugging purposes we sometimes want to allocate our structures from nonpaged</span>
00440 <span class="comment">//  pool so that in the kernel debugger we can walk all the structures.</span>
00441 <span class="comment">//</span>
00442 
<a name="l00443"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a65">00443</a> <span class="preprocessor">#define UdfPagedPool                 PagedPool</span>
<a name="l00444"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a66">00444</a> <span class="preprocessor"></span><span class="preprocessor">#define UdfNonPagedPool              NonPagedPool</span>
<a name="l00445"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a67">00445</a> <span class="preprocessor"></span><span class="preprocessor">#define UdfNonPagedPoolCacheAligned  NonPagedPoolCacheAligned</span>
00446 <span class="preprocessor"></span>
00447 <span class="comment">//</span>
00448 <span class="comment">//  Encapsulate safe pool freeing</span>
00449 <span class="comment">//</span>
00450 
00451 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
00452 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00453"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a124">00453</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a124">UdfFreePool</a>(
00454     IN PVOID *Pool
00455     )
00456 {
00457     <span class="keywordflow">if</span> (*Pool != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00458 
00459         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(*Pool);
00460         *Pool = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00461     }
00462 }
00463 
00464 <span class="comment">//</span>
00465 <span class="comment">//  Encapsulate counted string compares with uncounted fields.  Thanks to a</span>
00466 <span class="comment">//  very smart compiler, we have to carefully tell it that no matter what it</span>
00467 <span class="comment">//  thinks, it *cannot* do anything other than a bytewise compare.</span>
00468 <span class="comment">//</span>
00469 
00470 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
00471 BOOLEAN
<a name="l00472"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a125">00472</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a125">UdfEqualCountedString</a>(
00473     IN PSTRING String,
00474     IN PCHAR Field
00475     )
00476 {
00477     <span class="keywordflow">return</span> (RtlEqualMemory( (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> UNALIGNED *)<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer,
00478                             (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> UNALIGNED *)Field,
00479                             <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length )                    != 0);
00480 }
00481 
00482 
00483 <span class="comment">//</span>
00484 <span class="comment">//  Type of opens.  FilObSup.c depends on this order.</span>
00485 <span class="comment">//</span>
00486 
<a name="l00487"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a263">00487</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d3/d8/udfprocs_8h.html#a263">_TYPE_OF_OPEN</a> {
00488 
00489     <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a113">UnopenedFileObject</a> = 0,
00490     <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a114">StreamFileOpen</a>,
00491     <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a115">UserVolumeOpen</a>,
00492     <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a116">UserDirectoryOpen</a>,
00493     <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a117">UserFileOpen</a>,
00494     <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a118">BeyondValidType</a>
00495 
00496 } <a class="code" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a>, *<a class="code" href="../../d3/d8/udfprocs_8h.html#a110">PTYPE_OF_OPEN</a>;
00497 
00498 
00499 <span class="comment">//</span>
00500 <span class="comment">//  Following routines handle entry in and out of the filesystem.  They are</span>
00501 <span class="comment">//  contained in UdfData.c.  We also get some very generic utility functions</span>
00502 <span class="comment">//  here that aren't associated with any particular datastructure.</span>
00503 <span class="comment">//</span>
00504 
00505 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00506 <a class="code" href="../../d3/d8/udfprocs_8h.html#a126">UdfFsdDispatch</a> (
00507     IN <a class="code" href="../../d6/d7/struct__VOLUME__DEVICE__OBJECT.html">PVOLUME_DEVICE_OBJECT</a> VolumeDeviceObject,
00508     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
00509     );
00510 
00511 LONG
00512 <a class="code" href="../../d3/d8/udfprocs_8h.html#a127">UdfExceptionFilter</a> (
00513     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00514     IN PEXCEPTION_POINTERS ExceptionPointer
00515     );
00516 
00517 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00518 <a class="code" href="../../d3/d8/udfprocs_8h.html#a128">UdfProcessException</a> (
00519     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext OPTIONAL,
00520     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00521     IN NTSTATUS ExceptionCode
00522     );
00523 
00524 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00525 <a class="code" href="../../d3/d8/udfprocs_8h.html#a129">UdfCompleteRequest</a> (
00526     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext OPTIONAL,
00527     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp OPTIONAL,
00528     IN NTSTATUS Status
00529     );
00530 
00531 <span class="comment">//</span>
00532 <span class="comment">//  Following are the routines to handle the top level thread logic.</span>
00533 <span class="comment">//</span>
00534 
00535 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00536 <a class="code" href="../../d3/d8/udfprocs_8h.html#a130">UdfSetThreadContext</a> (
00537     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00538     IN <a class="code" href="../../d0/d1/struct__THREAD__CONTEXT.html">PTHREAD_CONTEXT</a> ThreadContext
00539     );
00540 
00541 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
00542 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00543"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a131">00543</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a131">UdfRestoreThreadContext</a> (
00544      IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext
00545      )
00546 {
00547     IrpContext-&gt;ThreadContext-&gt;Udfs = 0;
00548     <a class="code" href="../../d4/d6/iosubs_8c.html#a109">IoSetTopLevelIrp</a>( IrpContext-&gt;ThreadContext-&gt;SavedTopLevelIrp );
00549     IrpContext-&gt;ThreadContext = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00550 }
00551 
00552 <span class="comment">//</span>
00553 <span class="comment">//  Following are some generic utility functions we have to carry along for the ride</span>
00554 <span class="comment">//</span>
00555 
00556 ULONG
00557 <a class="code" href="../../d3/d8/udfprocs_8h.html#a132">UdfSerial32</a> (
00558     IN PCHAR Buffer,
00559     IN ULONG ByteCount
00560     );
00561 
00562 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00563 <a class="code" href="../../d3/d8/udfprocs_8h.html#a133">UdfInitializeCrc16</a> (
00564     ULONG Polynomial
00565     );
00566 
00567 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>
00568 <a class="code" href="../../d3/d8/udfprocs_8h.html#a134">UdfComputeCrc16</a> (
00569         IN PUCHAR Buffer,
00570         IN ULONG ByteCount
00571     );
00572 
00573 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>
00574 <a class="code" href="../../d3/d8/udfprocs_8h.html#a135">UdfComputeCrc16Uni</a> (
00575     PWCHAR Buffer,
00576     ULONG CharCount
00577     );
00578 
00579 ULONG
00580 <a class="code" href="../../d3/d8/udfprocs_8h.html#a136">UdfHighBit</a> (
00581     ULONG Word
00582     );
00583 
00584 <span class="comment">//</span>
00585 <span class="comment">//  Following are the fast entry points.</span>
00586 <span class="comment">//</span>
00587 
00588 BOOLEAN
00589 <a class="code" href="../../d3/d8/udfprocs_8h.html#a137">UdfFastQueryBasicInfo</a> (
00590     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
00591     IN BOOLEAN Wait,
00592     IN OUT PFILE_BASIC_INFORMATION Buffer,
00593     OUT PIO_STATUS_BLOCK IoStatus,
00594     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00595     );
00596 
00597 BOOLEAN
00598 <a class="code" href="../../d3/d8/udfprocs_8h.html#a138">UdfFastIoCheckIfPossible</a> (
00599     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
00600     IN PLARGE_INTEGER FileOffset,
00601     IN ULONG Length,
00602     IN BOOLEAN Wait,
00603     IN ULONG LockKey,
00604     IN BOOLEAN CheckForReadOperation,
00605     OUT PIO_STATUS_BLOCK IoStatus,
00606     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00607     );
00608 
00609 BOOLEAN
00610 <a class="code" href="../../d3/d8/udfprocs_8h.html#a139">UdfFastLock</a> (
00611     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
00612     IN PLARGE_INTEGER FileOffset,
00613     IN PLARGE_INTEGER Length,
00614     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> ProcessId,
00615     ULONG Key,
00616     BOOLEAN FailImmediately,
00617     BOOLEAN ExclusiveLock,
00618     OUT PIO_STATUS_BLOCK IoStatus,
00619     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00620     );
00621 
00622 BOOLEAN
00623 <a class="code" href="../../d3/d8/udfprocs_8h.html#a140">UdfFastQueryNetworkInfo</a> (
00624     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
00625     IN BOOLEAN Wait,
00626     OUT PFILE_NETWORK_OPEN_INFORMATION Buffer,
00627     OUT PIO_STATUS_BLOCK IoStatus,
00628     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00629     );
00630 
00631 BOOLEAN
00632 <a class="code" href="../../d3/d8/udfprocs_8h.html#a141">UdfFastQueryStdInfo</a> (
00633     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
00634     IN BOOLEAN Wait,
00635     IN OUT PFILE_STANDARD_INFORMATION Buffer,
00636     OUT PIO_STATUS_BLOCK IoStatus,
00637     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00638     );
00639 
00640 BOOLEAN
00641 <a class="code" href="../../d3/d8/udfprocs_8h.html#a142">UdfFastUnlockSingle</a> (
00642     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
00643     IN PLARGE_INTEGER FileOffset,
00644     IN PLARGE_INTEGER Length,
00645     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> ProcessId,
00646     ULONG Key,
00647     OUT PIO_STATUS_BLOCK IoStatus,
00648     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00649     );
00650 
00651 BOOLEAN
00652 <a class="code" href="../../d3/d8/udfprocs_8h.html#a143">UdfFastUnlockAll</a> (
00653     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
00654     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> ProcessId,
00655     OUT PIO_STATUS_BLOCK IoStatus,
00656     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00657     );
00658 
00659 BOOLEAN
00660 <a class="code" href="../../d3/d8/udfprocs_8h.html#a144">UdfFastUnlockAllByKey</a> (
00661     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
00662     PVOID ProcessId,
00663     ULONG Key,
00664     OUT PIO_STATUS_BLOCK IoStatus,
00665     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00666     );
00667 
00668 
00669 <span class="comment">//</span>
00670 <span class="comment">//  File access check routine, implemented in AcChkSup.c</span>
00671 <span class="comment">//</span>
00672 
00673 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
00674 BOOLEAN
<a name="l00675"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a145">00675</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a145">UdfIllegalFcbAccess</a> (
00676     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00677     IN TYPE_OF_OPEN TypeOfOpen,
00678     IN ACCESS_MASK DesiredAccess
00679     )
00680 
00681 <span class="comment">/*++</span>
00682 <span class="comment"></span>
00683 <span class="comment">Routine Description:</span>
00684 <span class="comment"></span>
00685 <span class="comment">    This routine simply asserts that the access is legal for a readonly filesystem.</span>
00686 <span class="comment">    </span>
00687 <span class="comment">Arguments:</span>
00688 <span class="comment"></span>
00689 <span class="comment">    TypeOfOpen - type of open for the Fcb in question.</span>
00690 <span class="comment">    </span>
00691 <span class="comment">    DesiredAccess - mask of access the caller is trying for.</span>
00692 <span class="comment"></span>
00693 <span class="comment">Return Value:</span>
00694 <span class="comment"></span>
00695 <span class="comment">    BOOLEAN True if illegal access, false otherwise.</span>
00696 <span class="comment"></span>
00697 <span class="comment">--*/</span>
00698 
00699 {
00700     <span class="keywordflow">return</span> <a class="code" href="../../d5/d5/cc_8h.html#a59">BooleanFlagOn</a>( DesiredAccess,
00701                           (TypeOfOpen != <a class="code" href="../../d3/d8/udfprocs_8h.html#a263a115">UserVolumeOpen</a> ?
00702                            (FILE_WRITE_ATTRIBUTES           |
00703                             FILE_WRITE_DATA                 |
00704                             FILE_WRITE_EA                   |
00705                             FILE_ADD_FILE                   |                     
00706                             FILE_ADD_SUBDIRECTORY           |
00707                             FILE_APPEND_DATA) : 0)          |
00708                           FILE_DELETE_CHILD                 |
00709                           DELETE                            |
00710                           WRITE_DAC );
00711 }
00712 
00713 
00714 <span class="comment">//</span>
00715 <span class="comment">//  Sector lookup routines, implemented in AllocSup.c</span>
00716 <span class="comment">//</span>
00717 
00718 BOOLEAN
00719 <a class="code" href="../../d3/d8/udfprocs_8h.html#a146">UdfLookupAllocation</a> (
00720     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00721     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
00722     IN LONGLONG FileOffset,
00723     OUT PLONGLONG DiskOffset,
00724     OUT PULONG ByteCount
00725     );
00726 
00727 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00728 <a class="code" href="../../d3/d8/udfprocs_8h.html#a147">UdfDeletePcb</a> (
00729     IN <a class="code" href="../../d4/d9/struct__PCB.html">PPCB</a> Pcb
00730     );
00731 
00732 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00733 <a class="code" href="../../d3/d8/udfprocs_8h.html#a148">UdfInitializePcb</a> (
00734     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00735     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
00736     IN OUT <a class="code" href="../../d4/d9/struct__PCB.html">PPCB</a> *Pcb,
00737     IN <a class="code" href="../../d6/d2/structNSR__LVOL.html">PNSR_LVOL</a> LVD
00738     );
00739 
00740 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00741 <a class="code" href="../../d3/d8/udfprocs_8h.html#a149">UdfAddToPcb</a> (
00742     IN <a class="code" href="../../d4/d9/struct__PCB.html">PPCB</a> Pcb,
00743     IN <a class="code" href="../../d7/d2/structNSR__PART.html">PNSR_PART</a> PartitionDescriptor
00744 );
00745 
00746 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00747 <a class="code" href="../../d3/d8/udfprocs_8h.html#a150">UdfCompletePcb</a>(
00748     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00749     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
00750     IN <a class="code" href="../../d4/d9/struct__PCB.html">PPCB</a> Pcb );
00751 
00752 BOOLEAN
00753 <a class="code" href="../../d3/d8/udfprocs_8h.html#a151">UdfEquivalentPcb</a> (
00754     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00755     IN <a class="code" href="../../d4/d9/struct__PCB.html">PPCB</a> Pcb1,
00756     IN <a class="code" href="../../d4/d9/struct__PCB.html">PPCB</a> Pcb2
00757     );
00758 
00759 ULONG
00760 <a class="code" href="../../d3/d8/udfprocs_8h.html#a152">UdfLookupPsnOfExtent</a> (
00761     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,    
00762     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
00763     IN USHORT Reference,
00764     IN ULONG Lbn,
00765     IN ULONG Len
00766     );
00767 
00768 ULONG
00769 <a class="code" href="../../d3/d8/udfprocs_8h.html#a153">UdfLookupMetaVsnOfExtent</a> (
00770     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00771     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
00772     IN USHORT Reference,
00773     IN ULONG Lbn,
00774     IN ULONG Len,
00775     IN BOOLEAN ExactEnd
00776     );
00777 
00778 
00779 <span class="comment">//</span>
00780 <span class="comment">//</span>
00781 <span class="comment">//   Buffer control routines for data caching, implemented in CacheSup.c</span>
00782 <span class="comment">//</span>
00783 
00784 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00785 <a class="code" href="../../d3/d8/udfprocs_8h.html#a154">UdfCreateInternalStream</a> (
00786     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00787     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
00788     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb
00789     );
00790 
00791 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00792 <a class="code" href="../../d3/d8/udfprocs_8h.html#a155">UdfDeleteInternalStream</a> (
00793     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00794     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb
00795     );
00796 
00797 
00798 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00799 <a class="code" href="../../d3/d8/udfprocs_8h.html#a156">UdfCompleteMdl</a> (
00800     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00801     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
00802     );
00803 
00804 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00805 <a class="code" href="../../d3/d8/udfprocs_8h.html#a157">UdfMapMetadataView</a> (
00806     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00807     IN <a class="code" href="../../d6/d6/struct__MAPPED__PVIEW.html">PMAPPED_PVIEW</a> View,
00808     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
00809     IN USHORT Partition,
00810     IN ULONG Lbn,
00811     IN ULONG Length
00812     );
00813 
00814 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00815 <a class="code" href="../../d3/d8/udfprocs_8h.html#a158">UdfPurgeVolume</a> (
00816     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00817     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
00818     IN BOOLEAN DismountUnderway
00819     );
00820 
00821 <span class="comment">//  VOID</span>
00822 <span class="comment">//  UdfUnpinView (</span>
00823 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
00824 <span class="comment">//      IN PMAPPED_VIEW View</span>
00825 <span class="comment">//      );</span>
00826 <span class="comment">//</span>
00827 
<a name="l00828"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a68">00828</a> <span class="preprocessor">#define UdfUnpinView(IC,V)   \</span>
00829 <span class="preprocessor">    if (((V)-&gt;Bcb) != NULL) { CcUnpinData( ((V)-&gt;Bcb) ); ((V)-&gt;Bcb) = NULL; ((V)-&gt;View) = NULL; }</span>
00830 <span class="preprocessor"></span>
00831 <span class="comment">//  VOID</span>
00832 <span class="comment">//  UdfUnpinData (</span>
00833 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
00834 <span class="comment">//      IN OUT PBCB *Bcb</span>
00835 <span class="comment">//      );</span>
00836 <span class="comment">//</span>
00837 
<a name="l00838"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a69">00838</a> <span class="preprocessor">#define UdfUnpinData(IC,B)   \</span>
00839 <span class="preprocessor">    if (*(B) != NULL) { CcUnpinData( *(B) ); *(B) = NULL; }</span>
00840 <span class="preprocessor"></span>
00841 
00842 <span class="comment">//</span>
00843 <span class="comment">//  Device I/O routines, implemented in DevIoSup.c</span>
00844 <span class="comment">//</span>
00845 <span class="comment">//  These routines perform the actual device reads and other communcation.</span>
00846 <span class="comment">//  They do not affect any data structures.</span>
00847 <span class="comment">//</span>
00848 
00849 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00850 <a class="code" href="../../d3/d8/udfprocs_8h.html#a159">UdfPerformDevIoCtrl</a> (
00851     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00852     IN ULONG IoControlCode,
00853     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> Device,
00854     OUT PVOID OutputBuffer OPTIONAL,
00855     IN ULONG OutputBufferLength,
00856     IN BOOLEAN InternalDeviceIoControl,
00857     IN BOOLEAN OverrideVerify,
00858     OUT PIO_STATUS_BLOCK Iosb OPTIONAL
00859     );
00860 
00861 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00862 <a class="code" href="../../d3/d8/udfprocs_8h.html#a160">UdfReadSectors</a> (
00863     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00864     IN LONGLONG StartingOffset,
00865     IN ULONG ByteCount,
00866     IN BOOLEAN ReturnError,
00867     IN OUT PVOID Buffer,
00868     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> TargetDeviceObject
00869     );
00870 
00871 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00872 <a class="code" href="../../d3/d8/udfprocs_8h.html#a161">UdfNonCachedRead</a> (
00873     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00874     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
00875     IN LONGLONG StartingOffset,
00876     IN ULONG ByteCount
00877     );
00878 
00879 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00880 <a class="code" href="../../d3/d8/udfprocs_8h.html#a162">UdfCreateUserMdl</a> (
00881     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00882     IN ULONG BufferLength,
00883     IN BOOLEAN RaiseOnError
00884     );
00885 
00886 <span class="comment">//</span>
00887 <span class="comment">//  VOID</span>
00888 <span class="comment">//  UdfMapUserBuffer (</span>
00889 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
00890 <span class="comment">//      OUT PVOID Buffer</span>
00891 <span class="comment">//      );</span>
00892 <span class="comment">//</span>
00893 <span class="comment">//  Will raise on failure.</span>
00894 <span class="comment">//</span>
00895 <span class="comment">//  VOID</span>
00896 <span class="comment">//  UdfLockUserBuffer (</span>
00897 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
00898 <span class="comment">//      IN ULONG BufferLength</span>
00899 <span class="comment">//      );</span>
00900 <span class="comment">//</span>
00901 
<a name="l00902"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a70">00902</a> <span class="preprocessor">#define UdfMapUserBuffer(IC,UB) {                                                   \</span>
00903 <span class="preprocessor">            *(UB) = ((PVOID) (((IC)-&gt;Irp-&gt;MdlAddress == NULL) ?                     \</span>
00904 <span class="preprocessor">                             (IC)-&gt;Irp-&gt;UserBuffer :                                \</span>
00905 <span class="preprocessor">                             MmGetSystemAddressForMdlSafe( (IC)-&gt;Irp-&gt;MdlAddress, NormalPagePriority )));   \</span>
00906 <span class="preprocessor">            if (NULL == *(UB))  {                                                    \</span>
00907 <span class="preprocessor">                UdfRaiseStatus( IrpContext, STATUS_INSUFFICIENT_RESOURCES);         \</span>
00908 <span class="preprocessor">            }                                                                       \</span>
00909 <span class="preprocessor">        }</span>
00910 <span class="preprocessor"></span>        
<a name="l00911"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a71">00911</a> <span class="preprocessor">#define UdfLockUserBuffer(IC,BL) {                   \</span>
00912 <span class="preprocessor">    if ((IC)-&gt;Irp-&gt;MdlAddress == NULL) {             \</span>
00913 <span class="preprocessor">        (VOID) UdfCreateUserMdl( (IC), (BL), TRUE ); \</span>
00914 <span class="preprocessor">    }                                                \</span>
00915 <span class="preprocessor">}</span>
00916 <span class="preprocessor"></span>
00917 <span class="comment">//</span>
00918 <span class="comment">//  Udf*RawBufferSize and Udf*RawReadSize calculate how big a buffer must be</span>
00919 <span class="comment">//  to do a direct read of a given sector aligned structure (UdfReadSectors)</span>
00920 <span class="comment">//  and how much data the read must recover.  Reads must write into whole-page</span>
00921 <span class="comment">//  sized buffers and be in whole-sector units.</span>
00922 <span class="comment">//</span>
00923 <span class="comment">//  Note that although all descriptors are constrained to fit in one logical</span>
00924 <span class="comment">//  block, it is not always going to be neccesary to read the entire logical</span>
00925 <span class="comment">//  block to get the descriptor.  The underlying restriction is the physical</span>
00926 <span class="comment">//  sector.</span>
00927 <span class="comment">//</span>
00928 
00929 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
00930 ULONG
<a name="l00931"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a163">00931</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a163">UdfRawBufferSize</a> (
00932     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
00933     IN ULONG StructureSize
00934     )
00935 {
00936     <span class="keywordflow">return</span> (ULONG)<a class="code" href="../../d2/d1/mm_8h.html#a4">ROUND_TO_PAGES</a>( <a class="code" href="../../d3/d8/fsrtlp_8h.html#a12">SectorAlign</a>( Vcb, StructureSize ));
00937 }
00938 
00939 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
00940 ULONG
<a name="l00941"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a164">00941</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a164">UdfRawReadSize</a> (
00942     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
00943     IN ULONG StructureSize
00944     )
00945 {
00946     <span class="keywordflow">return</span> <a class="code" href="../../d3/d8/fsrtlp_8h.html#a12">SectorAlign</a>( Vcb, StructureSize );
00947 }
00948 
00949 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
00950 ULONG
<a name="l00951"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a165">00951</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a165">UdfRawBufferSizeN</a> (
00952     IN ULONG SectorSize,
00953     IN ULONG StructureSize
00954     )
00955 {
00956     <span class="keywordflow">return</span> (ULONG)<a class="code" href="../../d2/d1/mm_8h.html#a4">ROUND_TO_PAGES</a>( <a class="code" href="../../d5/d8/udfs__rec_8h.html#a11">SectorAlignN</a>( <a class="code" href="../../d3/d8/udfprocs_8h.html#a42">SectorSize</a>, StructureSize ));
00957 }
00958 
00959 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
00960 ULONG
<a name="l00961"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a166">00961</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a166">UdfRawReadSizeN</a> (
00962     IN ULONG SectorSize,
00963     IN ULONG StructureSize
00964     )
00965 {
00966     <span class="keywordflow">return</span> <a class="code" href="../../d5/d8/udfs__rec_8h.html#a11">SectorAlignN</a>( <a class="code" href="../../d3/d8/udfprocs_8h.html#a42">SectorSize</a>, StructureSize );
00967 }
00968 
00969 
00970 <span class="comment">//</span>
00971 <span class="comment">//  The following routines are used to read on-disk directory structures, implemented</span>
00972 <span class="comment">//  in DirSup.c</span>
00973 <span class="comment">//</span>
00974 
00975 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00976 <a class="code" href="../../d3/d8/udfprocs_8h.html#a167">UdfInitializeDirContext</a> (
00977     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00978     IN <a class="code" href="../../d5/d5/struct__DIR__ENUM__CONTEXT.html">PDIR_ENUM_CONTEXT</a> DirContext
00979     );
00980 
00981 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00982 <a class="code" href="../../d3/d8/udfprocs_8h.html#a168">UdfCleanupDirContext</a> (
00983     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00984     IN <a class="code" href="../../d5/d5/struct__DIR__ENUM__CONTEXT.html">PDIR_ENUM_CONTEXT</a> DirContext
00985     );
00986 
00987 BOOLEAN
00988 <a class="code" href="../../d3/d8/udfprocs_8h.html#a169">UdfLookupInitialDirEntry</a> (
00989     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00990     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
00991     IN <a class="code" href="../../d5/d5/struct__DIR__ENUM__CONTEXT.html">PDIR_ENUM_CONTEXT</a> DirContext,
00992     IN PLONGLONG InitialOffset OPTIONAL
00993     );
00994 
00995 BOOLEAN
00996 <a class="code" href="../../d3/d8/udfprocs_8h.html#a170">UdfLookupNextDirEntry</a> (
00997     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
00998     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
00999     IN <a class="code" href="../../d5/d5/struct__DIR__ENUM__CONTEXT.html">PDIR_ENUM_CONTEXT</a> DirContext
01000     );
01001 
01002 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01003 <a class="code" href="../../d3/d8/udfprocs_8h.html#a171">UdfUpdateDirNames</a> (
01004     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01005     IN <a class="code" href="../../d5/d5/struct__DIR__ENUM__CONTEXT.html">PDIR_ENUM_CONTEXT</a> DirContext,
01006     IN BOOLEAN IgnoreCase
01007     );
01008 
01009 BOOLEAN
01010 <a class="code" href="../../d3/d8/udfprocs_8h.html#a172">UdfFindDirEntry</a> (
01011     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01012     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
01013     IN PUNICODE_STRING Name,
01014     IN BOOLEAN IgnoreCase,
01015     IN BOOLEAN ShortName,
01016     IN <a class="code" href="../../d5/d5/struct__DIR__ENUM__CONTEXT.html">PDIR_ENUM_CONTEXT</a> DirContext
01017     );
01018 
01019 
01020 <span class="comment">//</span>
01021 <span class="comment">//  The following routines are used to manipulate the fscontext fields</span>
01022 <span class="comment">//  of the file object, implemented in FilObSup.c</span>
01023 <span class="comment">//</span>
01024 
01025 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01026 <a class="code" href="../../d3/d8/udfprocs_8h.html#a173">UdfSetFileObject</a> (
01027     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01028     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
01029     IN TYPE_OF_OPEN TypeOfOpen,
01030     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb OPTIONAL,
01031     IN <a class="code" href="../../d2/d9/struct__CCB.html">PCCB</a> Ccb OPTIONAL
01032     );
01033 
01034 <a class="code" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a>
01035 <a class="code" href="../../d3/d8/udfprocs_8h.html#a174">UdfDecodeFileObject</a> (
01036     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
01037     OUT <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> *Fcb,
01038     OUT <a class="code" href="../../d2/d9/struct__CCB.html">PCCB</a> *Ccb
01039     );
01040 
01041 <a class="code" href="../../d3/d8/udfprocs_8h.html#a109">TYPE_OF_OPEN</a>
01042 <a class="code" href="../../d3/d8/udfprocs_8h.html#a175">UdfFastDecodeFileObject</a> (
01043     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject,
01044     OUT <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> *Fcb
01045     );
01046 
01047 
01048 <span class="comment">//</span>
01049 <span class="comment">//  FSCTL request support routines. Contained in FsCtrl.c</span>
01050 <span class="comment">//</span>
01051 
01052 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01053 <a class="code" href="../../d3/d8/udfprocs_8h.html#a176">UdfStoreVolumeDescriptorIfPrevailing</a> (
01054     IN OUT <a class="code" href="../../d4/d3/structNSR__VD__GENERIC.html">PNSR_VD_GENERIC</a> *StoredVD,
01055     IN OUT <a class="code" href="../../d4/d3/structNSR__VD__GENERIC.html">PNSR_VD_GENERIC</a> NewVD
01056     );
01057 
01058 
01059 <span class="comment">//</span>
01060 <span class="comment">//  Name mangling routines.  Implemented in Namesup.c</span>
01061 <span class="comment">//</span>
01062 
01063 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01064 <a class="code" href="../../d3/d8/udfprocs_8h.html#a177">UdfDissectName</a> (
01065     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01066     IN OUT PUNICODE_STRING RemainingName,
01067     OUT PUNICODE_STRING FinalName
01068     );
01069 
01070 BOOLEAN
01071 <a class="code" href="../../d3/d8/udfprocs_8h.html#a178">UdfIs8dot3Name</a> (
01072     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01073     IN UNICODE_STRING FileName
01074     );
01075 
01076 BOOLEAN
01077 <a class="code" href="../../d3/d8/udfprocs_8h.html#a179">UdfCandidateShortName</a> (
01078     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01079     IN PUNICODE_STRING Name
01080     );
01081 
01082 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01083 <a class="code" href="../../d3/d8/udfprocs_8h.html#a180">UdfGenerate8dot3Name</a> (
01084     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01085     IN PUNICODE_STRING FileName,
01086     OUT PUNICODE_STRING ShortFileName
01087     );
01088 
01089 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01090 <a class="code" href="../../d3/d8/udfprocs_8h.html#a181">UdfConvertCS0DstringToUnicode</a> (
01091     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01092     IN PUCHAR Dstring,
01093     IN UCHAR Length OPTIONAL,
01094     IN UCHAR FieldLength OPTIONAL,
01095     IN OUT PUNICODE_STRING Name
01096     );
01097 
01098 BOOLEAN
01099 <a class="code" href="../../d3/d8/udfprocs_8h.html#a182">UdfCheckLegalCS0Dstring</a> (
01100     <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01101     PUCHAR Dstring,
01102     UCHAR Length OPTIONAL,
01103     UCHAR FieldLength OPTIONAL,
01104     BOOLEAN ReturnOnError
01105     );
01106 
01107 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01108 <a class="code" href="../../d3/d8/udfprocs_8h.html#a183">UdfRenderNameToLegalUnicode</a> (
01109     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01110     IN PUNICODE_STRING Name,
01111     IN PUNICODE_STRING RenderedName
01112     );
01113 
01114 BOOLEAN
01115 <a class="code" href="../../d3/d8/udfprocs_8h.html#a184">UdfIsNameInExpression</a> (
01116     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01117     IN PUNICODE_STRING CurrentName,
01118     IN PUNICODE_STRING SearchExpression,
01119     IN BOOLEAN Wild
01120     );
01121 
01122 <a class="code" href="../../d1/d8/fsrtl_8h.html#a70">FSRTL_COMPARISON_RESULT</a>
01123 <a class="code" href="../../d3/d8/udfprocs_8h.html#a185">UdfFullCompareNames</a> (
01124     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01125     IN PUNICODE_STRING NameA,
01126     IN PUNICODE_STRING NameB
01127     );
01128 
01129 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
01130 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01131"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a186">01131</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a186">UdfUpcaseName</a> (
01132     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01133     IN PUNICODE_STRING Name,
01134     IN OUT PUNICODE_STRING UpcaseName
01135     )
01136 
01137 <span class="comment">/*++</span>
01138 <span class="comment"></span>
01139 <span class="comment">Routine Description:</span>
01140 <span class="comment"></span>
01141 <span class="comment">    This routine upcases a name with an assertion of success.</span>
01142 <span class="comment">    </span>
01143 <span class="comment">Arguments:</span>
01144 <span class="comment"></span>
01145 <span class="comment">    Name - an name to upcase</span>
01146 <span class="comment">    </span>
01147 <span class="comment">    Length - a place to put the upcased name (can be the same as Name)</span>
01148 <span class="comment">    </span>
01149 <span class="comment">Return Value:</span>
01150 <span class="comment"></span>
01151 <span class="comment">    None.</span>
01152 <span class="comment">    </span>
01153 <span class="comment">--*/</span>
01154 
01155 {
01156     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01157 
01158     <span class="comment">//</span>
01159     <span class="comment">//  Upcase the string using the correct upcase routine.</span>
01160     <span class="comment">//</span>
01161 
01162     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a31">RtlUpcaseUnicodeString</a>( UpcaseName,
01163                                      <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>,
01164                                      <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01165 
01166     <span class="comment">//</span>
01167     <span class="comment">//  This should never fail.</span>
01168     <span class="comment">//</span>
01169 
01170     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_SUCCESS );
01171 
01172     <span class="keywordflow">return</span>;
01173 }
01174 
01175 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
01176 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>
<a name="l01177"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a187">01177</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a187">UdfCS0DstringUnicodeSize</a> (
01178     <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01179     PCHAR Dstring,
01180     UCHAR Length
01181     )
01182 
01183 <span class="comment">/*++</span>
01184 <span class="comment"></span>
01185 <span class="comment">Routine Description:</span>
01186 <span class="comment"></span>
01187 <span class="comment">    This routine computes the number of bytes required for the UNICODE representation</span>
01188 <span class="comment">    of a CS0 Dstring (1/7.2.12)</span>
01189 <span class="comment">    </span>
01190 <span class="comment">Arguments:</span>
01191 <span class="comment"></span>
01192 <span class="comment">    Dstring - a dstring</span>
01193 <span class="comment">    </span>
01194 <span class="comment">    Length - length of the dstring</span>
01195 <span class="comment">    </span>
01196 <span class="comment">Return Value:</span>
01197 <span class="comment"></span>
01198 <span class="comment">    ULONG number of bytes.</span>
01199 <span class="comment">    </span>
01200 <span class="comment">--*/</span>
01201 
01202 {
01203     <span class="keywordflow">return</span> (16 / *Dstring) * (Length - 1);
01204 }
01205 
01206 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
01207 BOOLEAN
<a name="l01208"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a188">01208</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a188">UdfIsCharacterLegal</a> (
01209     IN WCHAR Character
01210     )
01211 
01212 <span class="comment">/*++</span>
01213 <span class="comment"></span>
01214 <span class="comment">Routine Description:</span>
01215 <span class="comment"></span>
01216 <span class="comment">    This routine checks that a given UNICODE character is legal.</span>
01217 <span class="comment">    </span>
01218 <span class="comment">Arguments:</span>
01219 <span class="comment"></span>
01220 <span class="comment">    Character - a character to check</span>
01221 <span class="comment">    </span>
01222 <span class="comment">Return Value:</span>
01223 <span class="comment"></span>
01224 <span class="comment">    BOOLEAN True if a legal character, False otherwise.</span>
01225 <span class="comment">    </span>
01226 <span class="comment">--*/</span>
01227 
01228 {
01229     <span class="keywordflow">if</span> (Character &lt; 0xff &amp;&amp; !<a class="code" href="../../d1/d8/fsrtl_8h.html#a31">FsRtlIsAnsiCharacterLegalHpfs</a>( Character, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> )) {
01230 
01231         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01232     }
01233 
01234     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01235 }
01236 
01237 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
01238 BOOLEAN
<a name="l01239"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a189">01239</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a189">UdfCS0DstringContainsLegalCharacters</a> (
01240     IN PCHAR Dstring,
01241     IN ULONG Length
01242     )
01243 
01244 <span class="comment">/*++</span>
01245 <span class="comment"></span>
01246 <span class="comment">Routine Description:</span>
01247 <span class="comment"></span>
01248 <span class="comment">    This routine inspects a CS0 dstring for illegal characters.  The assumption is</span>
01249 <span class="comment">    made that the string is legal CS0.</span>
01250 <span class="comment">    </span>
01251 <span class="comment">Arguments:</span>
01252 <span class="comment"></span>
01253 <span class="comment">    Name - a name to check</span>
01254 <span class="comment">    </span>
01255 <span class="comment">Return Value:</span>
01256 <span class="comment"></span>
01257 <span class="comment">    BOOLEAN True if legal characters are found, False otherwise.</span>
01258 <span class="comment">    </span>
01259 <span class="comment">--*/</span>
01260 
01261 {
01262     ULONG Step;
01263     WCHAR Char;
01264     PCHAR Bound = Dstring + Length;
01265 
01266     <span class="comment">//</span>
01267     <span class="comment">//  Determine how big a step we take in the string according to the</span>
01268     <span class="comment">//  "compression" applied.</span>
01269     <span class="comment">//</span>
01270     
01271     <span class="keywordflow">if</span> (*Dstring == 16) {
01272 
01273         Step = <span class="keyword">sizeof</span>( WCHAR );
01274     
01275     } <span class="keywordflow">else</span> {
01276 
01277         Step = <span class="keyword">sizeof</span>( <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> );
01278     }
01279 
01280     <span class="comment">//</span>
01281     <span class="comment">//  Advance past the compression marker and loop over the string.</span>
01282     <span class="comment">//</span>
01283     
01284     <span class="keywordflow">for</span> (Dstring++; Dstring &lt; Bound; Dstring += Step) {
01285 
01286         <span class="comment">//</span>
01287         <span class="comment">//  Perform the endianess swapcopy to convert from UDF bigendian CS0 to our</span>
01288         <span class="comment">//  little endian wide characters.</span>
01289         <span class="comment">//</span>
01290         
01291         <a class="code" href="../../d3/d8/udfprocs_8h.html#a58">SwapCopyUchar2</a>( &amp;Char, Dstring );
01292         
01293         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d8/udfprocs_8h.html#a188">UdfIsCharacterLegal</a>( Char )) {
01294 
01295             <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(( 0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>, <span class="stringliteral">"UdfCS0DstringContainsLegalCharacters, Char %04x @ %08x\n"</span>, (WCHAR) Char, Dstring ));
01296 
01297             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01298         }
01299     }
01300 
01301     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01302 }
01303 
01304 
01305 <span class="comment">//</span>
01306 <span class="comment">//  Filesystem control operations.  Implemented in Fsctrl.c</span>
01307 <span class="comment">//</span>
01308 
01309 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01310 <a class="code" href="../../d3/d8/udfprocs_8h.html#a190">UdfLockVolumeInternal</a> (
01311     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01312     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
01313     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject OPTIONAL
01314     );
01315 
01316 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01317 <a class="code" href="../../d3/d8/udfprocs_8h.html#a191">UdfUnlockVolumeInternal</a> (
01318     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01319     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
01320     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject OPTIONAL
01321     );
01322 
01323 
01324 <span class="comment">//</span>
01325 <span class="comment">//  Routines to handle the prefix trees attached to directories, used to quickly travel common</span>
01326 <span class="comment">//  bits of the hierarchy.  Implemented in PrefxSup.c</span>
01327 <span class="comment">//</span>
01328 
01329 <a class="code" href="../../d5/d9/struct__LCB.html">PLCB</a>
01330 <a class="code" href="../../d3/d8/udfprocs_8h.html#a192">UdfFindPrefix</a> (
01331     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01332     IN OUT <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> *CurrentFcb,
01333     IN OUT PUNICODE_STRING RemainingName,
01334     IN BOOLEAN IgnoreCase
01335     );
01336 
01337 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>            
01338 <a class="code" href="../../d3/d8/udfprocs_8h.html#a193">UdfInitializeLcbFromDirContext</a> (
01339     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01340     IN <a class="code" href="../../d5/d9/struct__LCB.html">PLCB</a> Lcb,
01341     IN <a class="code" href="../../d5/d5/struct__DIR__ENUM__CONTEXT.html">PDIR_ENUM_CONTEXT</a> DirContext
01342     );
01343 
01344 <a class="code" href="../../d5/d9/struct__LCB.html">PLCB</a>
01345 <a class="code" href="../../d3/d8/udfprocs_8h.html#a194">UdfInsertPrefix</a> (
01346     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01347     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
01348     IN PUNICODE_STRING Name,
01349     IN BOOLEAN ShortNameMatch,
01350     IN BOOLEAN IgnoreCase,
01351     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> ParentFcb
01352     );
01353 
01354 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01355 <a class="code" href="../../d3/d8/udfprocs_8h.html#a195">UdfRemovePrefix</a> (
01356     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01357     IN <a class="code" href="../../d5/d9/struct__LCB.html">PLCB</a> Lcb
01358     );
01359 
01360 
01361 <span class="comment">//</span>
01362 <span class="comment">//  Synchronization routines.  Implemented in Resrcsup.c</span>
01363 <span class="comment">//</span>
01364 <span class="comment">//  The following routines/macros are used to synchronize the in-memory structures.</span>
01365 <span class="comment">//</span>
01366 <span class="comment">//      Routine/Macro               Synchronizes                            Subsequent</span>
01367 <span class="comment">//</span>
01368 <span class="comment">//      UdfAcquireUdfData           Volume Mounts/Dismounts,Vcb Queue       UdfReleaseUdfData</span>
01369 <span class="comment">//      UdfAcquireVcbExclusive      Vcb for open/close                      UdfReleaseVcb</span>
01370 <span class="comment">//      UdfAcquireVcbShared         Vcb for open/close                      UdfReleaseVcb</span>
01371 <span class="comment">//      UdfAcquireAllFiles          Locks out operations to all files       UdfReleaseAllFiles</span>
01372 <span class="comment">//      UdfAcquireFileExclusive     Locks out file operations               UdfReleaseFile</span>
01373 <span class="comment">//      UdfAcquireFileShared        Files for file operations               UdfReleaseFile</span>
01374 <span class="comment">//      UdfAcquireFcbExclusive      Fcb for open/close                      UdfReleaseFcb</span>
01375 <span class="comment">//      UdfAcquireFcbShared         Fcb for open/close                      UdfReleaseFcb</span>
01376 <span class="comment">//      UdfLockUdfData              Fields in UdfData                       UdfUnlockUdfData</span>
01377 <span class="comment">//      UdfLockVcb                  Vcb fields, FcbReference, FcbTable      UdfUnlockVcb</span>
01378 <span class="comment">//      UdfLockFcb                  Fcb fields, prefix table, Mcb           UdfUnlockFcb</span>
01379 <span class="comment">//</span>
01380 
<a name="l01381"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a264">01381</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d3/d8/udfprocs_8h.html#a264">_TYPE_OF_ACQUIRE</a> {
01382     
01383     <a class="code" href="../../d3/d8/udfprocs_8h.html#a264a119">AcquireExclusive</a>,
01384     <a class="code" href="../../d3/d8/udfprocs_8h.html#a264a120">AcquireShared</a>,
01385     <a class="code" href="../../d3/d8/udfprocs_8h.html#a264a121">AcquireSharedStarveExclusive</a>
01386 
01387 } <a class="code" href="../../d3/d8/udfprocs_8h.html#a111">TYPE_OF_ACQUIRE</a>, *<a class="code" href="../../d3/d8/udfprocs_8h.html#a112">PTYPE_OF_ACQUIRE</a>;
01388 
01389 BOOLEAN
01390 <a class="code" href="../../d3/d8/udfprocs_8h.html#a196">UdfAcquireResource</a> (
01391     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01392     IN <a class="code" href="../../d6/d4/struct__ERESOURCE.html">PERESOURCE</a> Resource,
01393     IN BOOLEAN IgnoreWait,
01394     IN TYPE_OF_ACQUIRE Type
01395     );
01396 
01397 <span class="comment">//</span>
01398 <span class="comment">//  BOOLEAN</span>
01399 <span class="comment">//  UdfAcquireUdfData (</span>
01400 <span class="comment">//      IN PIRP_CONTEXT IrpContext</span>
01401 <span class="comment">//      );</span>
01402 <span class="comment">//</span>
01403 <span class="comment">//  VOID</span>
01404 <span class="comment">//  UdfReleaseUdfData (</span>
01405 <span class="comment">//      IN PIRP_CONTEXT IrpContext</span>
01406 <span class="comment">//    );</span>
01407 <span class="comment">//</span>
01408 <span class="comment">//  BOOLEAN</span>
01409 <span class="comment">//  UdfAcquireVcbExclusive (</span>
01410 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01411 <span class="comment">//      IN PVCB Vcb,</span>
01412 <span class="comment">//      IN BOOLEAN IgnoreWait</span>
01413 <span class="comment">//      );</span>
01414 <span class="comment">//</span>
01415 <span class="comment">//  BOOLEAN</span>
01416 <span class="comment">//  UdfAcquireVcbShared (</span>
01417 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01418 <span class="comment">//      IN PVCB Vcb,</span>
01419 <span class="comment">//      IN BOOLEAN IgnoreWait</span>
01420 <span class="comment">//      );</span>
01421 <span class="comment">//</span>
01422 <span class="comment">//  VOID</span>
01423 <span class="comment">//  UdfReleaseVcb (</span>
01424 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01425 <span class="comment">//      IN PVCB Vcb</span>
01426 <span class="comment">//      );</span>
01427 <span class="comment">//</span>
01428 <span class="comment">//  VOID</span>
01429 <span class="comment">//  UdfAcquireAllFiles (</span>
01430 <span class="comment">//      IN PIRP_CONTEXT,</span>
01431 <span class="comment">//      IN PVCB Vcb</span>
01432 <span class="comment">//      );</span>
01433 <span class="comment">//</span>
01434 <span class="comment">//  VOID</span>
01435 <span class="comment">//  UdfReleaseAllFiles (</span>
01436 <span class="comment">//      IN PIRP_CONTEXT,</span>
01437 <span class="comment">//      IN PVCB Vcb</span>
01438 <span class="comment">//      );</span>
01439 <span class="comment">//</span>
01440 <span class="comment">//  VOID</span>
01441 <span class="comment">//  UdfAcquireFileExclusive (</span>
01442 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01443 <span class="comment">//      IN PFCB Fcb,</span>
01444 <span class="comment">//      );</span>
01445 <span class="comment">//</span>
01446 <span class="comment">//  VOID</span>
01447 <span class="comment">//  UdfAcquireFileShared (</span>
01448 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01449 <span class="comment">//      IN PFCB Fcb</span>
01450 <span class="comment">//      );</span>
01451 <span class="comment">//</span>
01452 <span class="comment">//  VOID</span>
01453 <span class="comment">//  UdfReleaseFile (</span>
01454 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01455 <span class="comment">//      IN PFCB Fcb</span>
01456 <span class="comment">//    );</span>
01457 <span class="comment">//</span>
01458 <span class="comment">//  BOOLEAN</span>
01459 <span class="comment">//  UdfAcquireFcbExclusive (</span>
01460 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01461 <span class="comment">//      IN PFCB Fcb,</span>
01462 <span class="comment">//      IN BOOLEAN IgnoreWait</span>
01463 <span class="comment">//      );</span>
01464 <span class="comment">//</span>
01465 <span class="comment">//  BOOLEAN</span>
01466 <span class="comment">//  UdfAcquireFcbShared (</span>
01467 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01468 <span class="comment">//      IN PFCB Fcb,</span>
01469 <span class="comment">//      IN BOOLEAN IgnoreWait</span>
01470 <span class="comment">//      );</span>
01471 <span class="comment">//</span>
01472 <span class="comment">//  BOOLEAN</span>
01473 <span class="comment">//  UdfReleaseFcb (</span>
01474 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01475 <span class="comment">//      IN PFCB Fcb</span>
01476 <span class="comment">//      );</span>
01477 <span class="comment">//</span>
01478 <span class="comment">//  VOID</span>
01479 <span class="comment">//  UdfLockUdfData (</span>
01480 <span class="comment">//      );</span>
01481 <span class="comment">//</span>
01482 <span class="comment">//  VOID</span>
01483 <span class="comment">//  UdfUnlockUdfData (</span>
01484 <span class="comment">//      );</span>
01485 <span class="comment">//</span>
01486 <span class="comment">//  VOID</span>
01487 <span class="comment">//  UdfLockVcb (</span>
01488 <span class="comment">//      IN PIRP_CONTEXT IrpContext</span>
01489 <span class="comment">//      );</span>
01490 <span class="comment">//</span>
01491 <span class="comment">//  VOID</span>
01492 <span class="comment">//  UdfUnlockVcb (</span>
01493 <span class="comment">//      IN PIRP_CONTEXT IrpContext</span>
01494 <span class="comment">//      );</span>
01495 <span class="comment">//</span>
01496 <span class="comment">//  VOID</span>
01497 <span class="comment">//  UdfLockFcb (</span>
01498 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01499 <span class="comment">//      IN PFCB Fcb</span>
01500 <span class="comment">//      );</span>
01501 <span class="comment">//</span>
01502 <span class="comment">//  VOID</span>
01503 <span class="comment">//  UdfUnlockFcb (</span>
01504 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01505 <span class="comment">//      IN PFCB Fcb</span>
01506 <span class="comment">//      );</span>
01507 <span class="comment">//</span>
01508 
<a name="l01509"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a72">01509</a> <span class="preprocessor">#define UdfAcquireUdfData(IC)                                                           \</span>
01510 <span class="preprocessor">    ExAcquireResourceExclusive( &amp;UdfData.DataResource, TRUE )</span>
01511 <span class="preprocessor"></span>
<a name="l01512"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a73">01512</a> <span class="preprocessor">#define UdfReleaseUdfData(IC)                                                           \</span>
01513 <span class="preprocessor">    ExReleaseResource( &amp;UdfData.DataResource )</span>
01514 <span class="preprocessor"></span>
<a name="l01515"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a74">01515</a> <span class="preprocessor">#define UdfAcquireVcbExclusive(IC,V,I)                                                  \</span>
01516 <span class="preprocessor">    UdfAcquireResource( (IC), &amp;(V)-&gt;VcbResource, (I), AcquireExclusive )</span>
01517 <span class="preprocessor"></span>
<a name="l01518"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a75">01518</a> <span class="preprocessor">#define UdfAcquireVcbShared(IC,V,I)                                                     \</span>
01519 <span class="preprocessor">    UdfAcquireResource( (IC), &amp;(V)-&gt;VcbResource, (I), AcquireShared )</span>
01520 <span class="preprocessor"></span>
<a name="l01521"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a76">01521</a> <span class="preprocessor">#define UdfReleaseVcb(IC,V)                                                             \</span>
01522 <span class="preprocessor">    ExReleaseResource( &amp;(V)-&gt;VcbResource )</span>
01523 <span class="preprocessor"></span>
<a name="l01524"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a77">01524</a> <span class="preprocessor">#define UdfAcquireAllFiles(IC,V)                                                        \</span>
01525 <span class="preprocessor">    UdfAcquireResource( (IC), &amp;(V)-&gt;FileResource, FALSE, AcquireExclusive )</span>
01526 <span class="preprocessor"></span>
<a name="l01527"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a78">01527</a> <span class="preprocessor">#define UdfReleaseAllFiles(IC,V)                                                        \</span>
01528 <span class="preprocessor">    ExReleaseResource( &amp;(V)-&gt;FileResource )</span>
01529 <span class="preprocessor"></span>
<a name="l01530"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a79">01530</a> <span class="preprocessor">#define UdfAcquireFileExclusive(IC,F)                                                   \</span>
01531 <span class="preprocessor">    UdfAcquireResource( (IC), (F)-&gt;Resource, FALSE, AcquireExclusive )</span>
01532 <span class="preprocessor"></span>
<a name="l01533"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a80">01533</a> <span class="preprocessor">#define UdfAcquireFileShared(IC,F)                                                      \</span>
01534 <span class="preprocessor">    UdfAcquireResource( (IC), (F)-&gt;Resource, FALSE, AcquireShared )</span>
01535 <span class="preprocessor"></span>
<a name="l01536"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a81">01536</a> <span class="preprocessor">#define UdfAcquireFileSharedStarveExclusive(IC,F)                                       \</span>
01537 <span class="preprocessor">    UdfAcquireResource( (IC), (F)-&gt;Resource, FALSE, AcquireSharedStarveExclusive )</span>
01538 <span class="preprocessor"></span>
<a name="l01539"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a82">01539</a> <span class="preprocessor">#define UdfReleaseFile(IC,F)                                                            \</span>
01540 <span class="preprocessor">    ExReleaseResource( (F)-&gt;Resource )</span>
01541 <span class="preprocessor"></span>
<a name="l01542"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a83">01542</a> <span class="preprocessor">#define UdfAcquireFcbExclusive(IC,F,I)                                                  \</span>
01543 <span class="preprocessor">    UdfAcquireResource( (IC), &amp;(F)-&gt;FcbNonpaged-&gt;FcbResource, (I), AcquireExclusive )</span>
01544 <span class="preprocessor"></span>
<a name="l01545"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a84">01545</a> <span class="preprocessor">#define UdfAcquireFcbShared(IC,F,I)                                                     \</span>
01546 <span class="preprocessor">    UdfAcquireResource( (IC), &amp;(F)-&gt;FcbNonpaged-&gt;FcbResource, (I), AcquireShared )</span>
01547 <span class="preprocessor"></span>
<a name="l01548"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a85">01548</a> <span class="preprocessor">#define UdfReleaseFcb(IC,F)                                                             \</span>
01549 <span class="preprocessor">    ExReleaseResource( &amp;(F)-&gt;FcbNonpaged-&gt;FcbResource )</span>
01550 <span class="preprocessor"></span>
<a name="l01551"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a86">01551</a> <span class="preprocessor">#define UdfLockUdfData()                                                                \</span>
01552 <span class="preprocessor">    ExAcquireFastMutex( &amp;UdfData.UdfDataMutex );                                        \</span>
01553 <span class="preprocessor">    UdfData.UdfDataLockThread = PsGetCurrentThread()</span>
01554 <span class="preprocessor"></span>
<a name="l01555"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a87">01555</a> <span class="preprocessor">#define UdfUnlockUdfData()                                                              \</span>
01556 <span class="preprocessor">    UdfData.UdfDataLockThread = NULL;                                                   \</span>
01557 <span class="preprocessor">    ExReleaseFastMutex( &amp;UdfData.UdfDataMutex )</span>
01558 <span class="preprocessor"></span>
<a name="l01559"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a88">01559</a> <span class="preprocessor">#define UdfLockVcb(IC,V)                                                                \</span>
01560 <span class="preprocessor">    ExAcquireFastMutex( &amp;(V)-&gt;VcbMutex );                                               \</span>
01561 <span class="preprocessor">    (V)-&gt;VcbLockThread = PsGetCurrentThread()</span>
01562 <span class="preprocessor"></span>
<a name="l01563"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a89">01563</a> <span class="preprocessor">#define UdfUnlockVcb(IC,V)                                                              \</span>
01564 <span class="preprocessor">    (V)-&gt;VcbLockThread = NULL;                                                          \</span>
01565 <span class="preprocessor">    ExReleaseFastMutex( &amp;(V)-&gt;VcbMutex )</span>
01566 <span class="preprocessor"></span>
<a name="l01567"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a90">01567</a> <span class="preprocessor">#define UdfLockFcb(IC,F) {                                                              \</span>
01568 <span class="preprocessor">    PVOID _CurrentThread = PsGetCurrentThread();                                        \</span>
01569 <span class="preprocessor">    if (_CurrentThread != (F)-&gt;FcbLockThread) {                                         \</span>
01570 <span class="preprocessor">        ExAcquireFastMutex( &amp;(F)-&gt;FcbNonpaged-&gt;FcbMutex );                              \</span>
01571 <span class="preprocessor">        ASSERT( (F)-&gt;FcbLockCount == 0 );                                               \</span>
01572 <span class="preprocessor">        (F)-&gt;FcbLockThread = _CurrentThread;                                            \</span>
01573 <span class="preprocessor">    }                                                                                   \</span>
01574 <span class="preprocessor">    (F)-&gt;FcbLockCount += 1;                                                             \</span>
01575 <span class="preprocessor">}</span>
01576 <span class="preprocessor"></span>
<a name="l01577"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a91">01577</a> <span class="preprocessor">#define UdfUnlockFcb(IC,F) {                                                            \</span>
01578 <span class="preprocessor">    (F)-&gt;FcbLockCount -= 1;                                                             \</span>
01579 <span class="preprocessor">    if ((F)-&gt;FcbLockCount == 0) {                                                       \</span>
01580 <span class="preprocessor">        (F)-&gt;FcbLockThread = NULL;                                                      \</span>
01581 <span class="preprocessor">        ExReleaseFastMutex( &amp;(F)-&gt;FcbNonpaged-&gt;FcbMutex );                              \</span>
01582 <span class="preprocessor">    }                                                                                   \</span>
01583 <span class="preprocessor">}</span>
01584 <span class="preprocessor"></span>
01585 BOOLEAN
01586 <a class="code" href="../../d3/d8/udfprocs_8h.html#a197">UdfNoopAcquire</a> (
01587     IN PVOID Fcb,
01588     IN BOOLEAN Wait
01589     );
01590 
01591 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01592 <a class="code" href="../../d3/d8/udfprocs_8h.html#a198">UdfNoopRelease</a> (
01593     IN PVOID Fcb
01594     );
01595 
01596 BOOLEAN
01597 <a class="code" href="../../d3/d8/udfprocs_8h.html#a199">UdfAcquireForCache</a> (
01598     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
01599     IN BOOLEAN Wait
01600     );
01601 
01602 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01603 <a class="code" href="../../d3/d8/udfprocs_8h.html#a200">UdfReleaseFromCache</a> (
01604     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb
01605     );
01606 
01607 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01608 <a class="code" href="../../d3/d8/udfprocs_8h.html#a201">UdfAcquireForCreateSection</a> (
01609     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject
01610     );
01611 
01612 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01613 <a class="code" href="../../d3/d8/udfprocs_8h.html#a202">UdfReleaseForCreateSection</a> (
01614     IN <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject
01615     );
01616 
01617 
01618 <span class="comment">//</span>
01619 <span class="comment">//  Structure support routines, implemented in StrucSup.c</span>
01620 <span class="comment">//</span>
01621 <span class="comment">//  These routines perform in-memory structure manipulations. They do *not* operate</span>
01622 <span class="comment">//  on disk structures.</span>
01623 <span class="comment">//</span>
01624 
01625 BOOLEAN
01626 <a class="code" href="../../d3/d8/udfprocs_8h.html#a203">UdfInitializeVcb</a> (
01627     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01628     IN OUT <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
01629     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> TargetDeviceObject,
01630     IN <a class="code" href="../../d7/d7/struct__VPB.html">PVPB</a> Vpb,
01631     IN PDISK_GEOMETRY DiskGeometry,
01632     IN ULONG MediaChangeCount
01633     );
01634 
01635 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01636 <a class="code" href="../../d3/d8/udfprocs_8h.html#a204">UdfUpdateVcbPhase0</a> (
01637     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01638     IN OUT <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb
01639     );
01640 
01641 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01642 <a class="code" href="../../d3/d8/udfprocs_8h.html#a205">UdfUpdateVcbPhase1</a> (
01643     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01644     IN OUT <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
01645     IN <a class="code" href="../../d2/d2/structNSR__FSD.html">PNSR_FSD</a> Fsd
01646     );
01647 
01648 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01649 <a class="code" href="../../d3/d8/udfprocs_8h.html#a206">UdfDeleteVcb</a> (
01650     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01651     IN OUT <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb
01652     );
01653 
01654 <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a>
01655 <a class="code" href="../../d3/d8/udfprocs_8h.html#a207">UdfCreateIrpContext</a> (
01656     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
01657     IN BOOLEAN Wait
01658     );
01659 
01660 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01661 <a class="code" href="../../d3/d8/udfprocs_8h.html#a208">UdfCleanupIrpContext</a> (
01662     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01663     IN BOOLEAN Post
01664     );
01665 
01666 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01667 <a class="code" href="../../d3/d8/udfprocs_8h.html#a209">UdfInitializeStackIrpContext</a> (
01668     OUT <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01669     IN <a class="code" href="../../d2/d3/struct__IRP__CONTEXT__LITE.html">PIRP_CONTEXT_LITE</a> IrpContextLite
01670     );
01671 
01672 <span class="comment">//</span>
01673 <span class="comment">//  PIRP_CONTEXT_LITE</span>
01674 <span class="comment">//  UdfCreateIrpContextLite (</span>
01675 <span class="comment">//      IN PIRP_CONTEXT IrpContext</span>
01676 <span class="comment">//      );</span>
01677 <span class="comment">//</span>
01678 <span class="comment">//  VOID</span>
01679 <span class="comment">//  UdfFreeIrpContextLite (</span>
01680 <span class="comment">//      IN PIRP_CONTEXT_LITE IrpContextLite</span>
01681 <span class="comment">//      );</span>
01682 <span class="comment">//</span>
01683 
<a name="l01684"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a92">01684</a> <span class="preprocessor">#define UdfCreateIrpContextLite(IC)  \</span>
01685 <span class="preprocessor">    ExAllocatePoolWithTag( UdfNonPagedPool, sizeof( IRP_CONTEXT_LITE ), TAG_IRP_CONTEXT_LITE )</span>
01686 <span class="preprocessor"></span>
<a name="l01687"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a93">01687</a> <span class="preprocessor">#define UdfFreeIrpContextLite(ICL)  \</span>
01688 <span class="preprocessor">    ExFreePool( ICL )</span>
01689 <span class="preprocessor"></span>
01690 <span class="comment">//</span>
01691 <span class="comment">//  PUDF_IO_CONTEXT</span>
01692 <span class="comment">//  UdfAllocateIoContext (</span>
01693 <span class="comment">//      );</span>
01694 <span class="comment">//</span>
01695 <span class="comment">//  VOID</span>
01696 <span class="comment">//  UdfFreeIoContext (</span>
01697 <span class="comment">//      PUDF_IO_CONTEXT IoContext</span>
01698 <span class="comment">//      );</span>
01699 <span class="comment">//</span>
01700 
<a name="l01701"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a94">01701</a> <span class="preprocessor">#define UdfAllocateIoContext()                           \</span>
01702 <span class="preprocessor">    FsRtlAllocatePoolWithTag( UdfNonPagedPool,           \</span>
01703 <span class="preprocessor">                              sizeof( UDF_IO_CONTEXT ),  \</span>
01704 <span class="preprocessor">                              TAG_IO_CONTEXT )</span>
01705 <span class="preprocessor"></span>
<a name="l01706"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a95">01706</a> <span class="preprocessor">#define UdfFreeIoContext(IO)     ExFreePool( IO )</span>
01707 <span class="preprocessor"></span>
01708 <span class="comment">//</span>
01709 <span class="comment">//  VOID</span>
01710 <span class="comment">//  UdfIncrementCleanupCounts (</span>
01711 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01712 <span class="comment">//      IN PFCB Fcb</span>
01713 <span class="comment">//      );</span>
01714 <span class="comment">//</span>
01715 <span class="comment">//  VOID</span>
01716 <span class="comment">//  UdfDecrementCleanupCounts (</span>
01717 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01718 <span class="comment">//      IN PFCB Fcb</span>
01719 <span class="comment">//      );</span>
01720 <span class="comment">//</span>
01721 <span class="comment">//  VOID</span>
01722 <span class="comment">//  UdfIncrementReferenceCounts (</span>
01723 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01724 <span class="comment">//      IN PFCB Fcb,</span>
01725 <span class="comment">//      IN ULONG ReferenceCount</span>
01726 <span class="comment">//      IN ULONG UserReferenceCount</span>
01727 <span class="comment">//      );</span>
01728 <span class="comment">//</span>
01729 <span class="comment">//  VOID</span>
01730 <span class="comment">//  UdfDecrementReferenceCounts (</span>
01731 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01732 <span class="comment">//      IN PFCB Fcb,</span>
01733 <span class="comment">//      IN ULONG ReferenceCount</span>
01734 <span class="comment">//      IN ULONG UserReferenceCount</span>
01735 <span class="comment">//      );</span>
01736 <span class="comment">//</span>
01737 <span class="comment">//  VOID</span>
01738 <span class="comment">//  UdfIncrementFcbReference (</span>
01739 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01740 <span class="comment">//      IN PFCB Fcb</span>
01741 <span class="comment">//      );</span>
01742 <span class="comment">//</span>
01743 <span class="comment">//  VOID</span>
01744 <span class="comment">//  UdfDecrementFcbReference (</span>
01745 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
01746 <span class="comment">//      IN PFCB Fcb</span>
01747 <span class="comment">//      );</span>
01748 <span class="comment">//</span>
01749 
<a name="l01750"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a96">01750</a> <span class="preprocessor">#define UdfIncrementCleanupCounts(IC,F) {        \</span>
01751 <span class="preprocessor">    ASSERT_LOCKED_VCB( (F)-&gt;Vcb );              \</span>
01752 <span class="preprocessor">    (F)-&gt;FcbCleanup += 1;                       \</span>
01753 <span class="preprocessor">    (F)-&gt;Vcb-&gt;VcbCleanup += 1;                  \</span>
01754 <span class="preprocessor">}</span>
01755 <span class="preprocessor"></span>
<a name="l01756"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a97">01756</a> <span class="preprocessor">#define UdfDecrementCleanupCounts(IC,F) {        \</span>
01757 <span class="preprocessor">    ASSERT_LOCKED_VCB( (F)-&gt;Vcb );              \</span>
01758 <span class="preprocessor">    (F)-&gt;FcbCleanup -= 1;                       \</span>
01759 <span class="preprocessor">    (F)-&gt;Vcb-&gt;VcbCleanup -= 1;                  \</span>
01760 <span class="preprocessor">}</span>
01761 <span class="preprocessor"></span>
<a name="l01762"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a98">01762</a> <span class="preprocessor">#define UdfIncrementReferenceCounts(IC,F,C,UC) { \</span>
01763 <span class="preprocessor">    ASSERT_LOCKED_VCB( (F)-&gt;Vcb );              \</span>
01764 <span class="preprocessor">    (F)-&gt;FcbReference += (C);                   \</span>
01765 <span class="preprocessor">    (F)-&gt;FcbUserReference += (UC);              \</span>
01766 <span class="preprocessor">    (F)-&gt;Vcb-&gt;VcbReference += (C);              \</span>
01767 <span class="preprocessor">    (F)-&gt;Vcb-&gt;VcbUserReference += (UC);         \</span>
01768 <span class="preprocessor">}</span>
01769 <span class="preprocessor"></span>
<a name="l01770"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a99">01770</a> <span class="preprocessor">#define UdfDecrementReferenceCounts(IC,F,C,UC) { \</span>
01771 <span class="preprocessor">    ASSERT_LOCKED_VCB( (F)-&gt;Vcb );              \</span>
01772 <span class="preprocessor">    (F)-&gt;FcbReference -= (C);                   \</span>
01773 <span class="preprocessor">    (F)-&gt;FcbUserReference -= (UC);              \</span>
01774 <span class="preprocessor">    (F)-&gt;Vcb-&gt;VcbReference -= (C);              \</span>
01775 <span class="preprocessor">    (F)-&gt;Vcb-&gt;VcbUserReference -= (UC);         \</span>
01776 <span class="preprocessor">}</span>
01777 <span class="preprocessor"></span>
01778 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01779 <a class="code" href="../../d3/d8/udfprocs_8h.html#a210">UdfTeardownStructures</a> (
01780     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01781     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> StartingFcb,
01782     IN BOOLEAN Recursive,
01783     OUT PBOOLEAN RemovedStartingFcb
01784     );
01785 
01786 <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a>
01787 <a class="code" href="../../d3/d8/udfprocs_8h.html#a211">UdfLookupFcbTable</a> (
01788     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01789     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
01790     IN FILE_ID FileId
01791     );
01792 
01793 <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a>
01794 <a class="code" href="../../d3/d8/udfprocs_8h.html#a212">UdfGetNextFcb</a> (
01795     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01796     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
01797     IN PVOID *RestartKey
01798     );
01799 
01800 <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a>
01801 <a class="code" href="../../d3/d8/udfprocs_8h.html#a213">UdfCreateFcb</a> (
01802     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01803     IN FILE_ID FileId,
01804     IN NODE_TYPE_CODE NodeTypeCode,
01805     OUT PBOOLEAN FcbExisted OPTIONAL
01806     );
01807 
01808 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01809 <a class="code" href="../../d3/d8/udfprocs_8h.html#a214">UdfDeleteFcb</a> (
01810     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01811     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb
01812     );
01813 
01814 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01815 <a class="code" href="../../d3/d8/udfprocs_8h.html#a215">UdfInitializeFcbFromIcbContext</a> (
01816     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01817     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
01818     IN <a class="code" href="../../d9/d9/struct__ICB__SEARCH__CONTEXT.html">PICB_SEARCH_CONTEXT</a> IcbContext
01819     );
01820 
01821 <a class="code" href="../../d2/d9/struct__CCB.html">PCCB</a>
01822 <a class="code" href="../../d3/d8/udfprocs_8h.html#a216">UdfCreateCcb</a> (
01823     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01824     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
01825     IN <a class="code" href="../../d5/d9/struct__LCB.html">PLCB</a> Lcb OPTIONAL,
01826     IN ULONG Flags
01827     );
01828 
01829 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01830 <a class="code" href="../../d3/d8/udfprocs_8h.html#a217">UdfDeleteCcb</a> (
01831     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01832     IN <a class="code" href="../../d2/d9/struct__CCB.html">PCCB</a> Ccb
01833     );
01834 
01835 ULONG
01836 <a class="code" href="../../d3/d8/udfprocs_8h.html#a218">UdfFindInParseTable</a> (
01837     IN <a class="code" href="../../d2/d8/struct__PARSE__KEYVALUE.html">PPARSE_KEYVALUE</a> ParseTable,
01838     IN PCHAR Id,
01839     IN ULONG MaxIdLen
01840     );
01841 
01842 BOOLEAN
01843 <a class="code" href="../../d3/d8/udfprocs_8h.html#a219">UdfVerifyDescriptor</a> (
01844     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01845     IN <a class="code" href="../../d7/d7/structDESTAG.html">PDESTAG</a> Descriptor,
01846     IN USHORT Tag,
01847     IN ULONG Size,
01848     IN ULONG Lbn,
01849     IN BOOLEAN ReturnError
01850     );
01851 
01852 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01853 <a class="code" href="../../d3/d8/udfprocs_8h.html#a220">UdfInitializeIcbContextFromFcb</a> (
01854     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01855     IN <a class="code" href="../../d9/d9/struct__ICB__SEARCH__CONTEXT.html">PICB_SEARCH_CONTEXT</a> IcbContext,
01856     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb
01857     );
01858 
01859 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01860 <a class="code" href="../../d3/d8/udfprocs_8h.html#a221">UdfInitializeIcbContext</a> (
01861     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01862     IN <a class="code" href="../../d9/d9/struct__ICB__SEARCH__CONTEXT.html">PICB_SEARCH_CONTEXT</a> IcbContext,
01863     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
01864     IN USHORT IcbType,
01865     IN USHORT Partition,
01866     IN ULONG Lbn,
01867     IN ULONG Length
01868     );
01869 
01870 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
01871 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01872"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a222">01872</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a222">UdfFastInitializeIcbContext</a> (
01873     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01874     IN <a class="code" href="../../d9/d9/struct__ICB__SEARCH__CONTEXT.html">PICB_SEARCH_CONTEXT</a> IcbContext
01875     )
01876 {
01877 
01878     RtlZeroMemory( IcbContext, <span class="keyword">sizeof</span>( <a class="code" href="../../d9/d9/struct__ICB__SEARCH__CONTEXT.html">ICB_SEARCH_CONTEXT</a> ));
01879 }
01880 
01881 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01882 <a class="code" href="../../d3/d8/udfprocs_8h.html#a223">UdfLookupActiveIcb</a> (
01883     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01884     IN <a class="code" href="../../d9/d9/struct__ICB__SEARCH__CONTEXT.html">PICB_SEARCH_CONTEXT</a> IcbContext
01885     );
01886 
01887 
01888 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01889 <a class="code" href="../../d3/d8/udfprocs_8h.html#a224">UdfCleanupIcbContext</a> (
01890     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01891     IN <a class="code" href="../../d9/d9/struct__ICB__SEARCH__CONTEXT.html">PICB_SEARCH_CONTEXT</a> IcbContext
01892     );
01893 
01894 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01895 <a class="code" href="../../d3/d8/udfprocs_8h.html#a225">UdfInitializeAllocations</a> (
01896     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01897     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
01898     IN <a class="code" href="../../d9/d9/struct__ICB__SEARCH__CONTEXT.html">PICB_SEARCH_CONTEXT</a> IcbContext
01899     );
01900 
01901 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
01902 <a class="code" href="../../d3/d8/udfprocs_8h.html#a226">UdfUpdateTimestampsFromIcbContext</a> (
01903     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01904     IN <a class="code" href="../../d9/d9/struct__ICB__SEARCH__CONTEXT.html">PICB_SEARCH_CONTEXT</a> IcbContext,
01905     IN <a class="code" href="../../d4/d1/struct__TIMESTAMP__BUNDLE.html">PTIMESTAMP_BUNDLE</a> Timestamps
01906     );
01907 
01908 BOOLEAN
01909 <a class="code" href="../../d3/d8/udfprocs_8h.html#a227">UdfCreateFileLock</a> (
01910     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext OPTIONAL,
01911     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb,
01912     IN BOOLEAN RaiseOnError
01913     );
01914 
01915 <span class="comment">//</span>
01916 <span class="comment">//  The following macro converts from UDF time to NT time.</span>
01917 <span class="comment">//</span>
01918 
01919 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
01920 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01921"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a228">01921</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a228">UdfConvertUdfTimeToNtTime</a> (
01922     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
01923     IN <a class="code" href="../../d5/d0/structTIMESTAMP.html">PTIMESTAMP</a> UdfTime,
01924     OUT PLARGE_INTEGER NtTime
01925     )
01926 {
01927     TIME_FIELDS TimeField;
01928     
01929     TimeField.Year = UdfTime-&gt;Year;
01930     TimeField.Month = UdfTime-&gt;Month;
01931     TimeField.Day = UdfTime-&gt;Day;
01932     TimeField.Hour = UdfTime-&gt;Hour;
01933     TimeField.Minute = UdfTime-&gt;Minute;
01934     TimeField.Second = UdfTime-&gt;Second;
01935     
01936     <span class="comment">//</span>
01937     <span class="comment">//  This is where it gets hairy.  For some unholy reason, ISO 13346 timestamps</span>
01938     <span class="comment">//  carve the right of the decimal point up into three fields of precision</span>
01939     <span class="comment">//  10-2, 10-4, and 10-6, each ranging from 0-99. Lawdy.</span>
01940     <span class="comment">//</span>
01941     <span class="comment">//  To make it easier, since they cannot cause a wrap into the next second,</span>
01942     <span class="comment">//  just save it all up and add it in after the conversion.</span>
01943     <span class="comment">//</span>
01944     
01945     TimeField.Milliseconds = 0; 
01946     
01947     <span class="keywordflow">if</span> (UdfTime-&gt;Type &lt;= 1 &amp;&amp;
01948         ((UdfTime-&gt;Zone &gt;= <a class="code" href="../../d0/d7/iso13346_8h.html#a12">TIMESTAMP_Z_MIN</a> &amp;&amp; UdfTime-&gt;Zone &lt;= <a class="code" href="../../d0/d7/iso13346_8h.html#a13">TIMESTAMP_Z_MAX</a>) ||
01949          UdfTime-&gt;Zone == <a class="code" href="../../d0/d7/iso13346_8h.html#a14">TIMESTAMP_Z_NONE</a>) &amp;&amp;
01950         <a class="code" href="../../d1/d2/time_8c.html#a28">RtlTimeFieldsToTime</a>( &amp;TimeField, NtTime )) {
01951 
01952         <span class="comment">//</span>
01953         <span class="comment">//  Now fold in the remaining sub-second "precision".  Read as coversions</span>
01954         <span class="comment">//  through the 10-3 units, then into our 10-7 base. (centi-&gt;milli-&gt;micro,</span>
01955         <span class="comment">//  etc).</span>
01956         <span class="comment">//</span>
01957     
01958         NtTime-&gt;QuadPart += ((UdfTime-&gt;CentiSecond * (10 * 1000)) +
01959                              (UdfTime-&gt;Usec100 * 100) +
01960                              UdfTime-&gt;Usec) * 10;
01961 
01962         <span class="comment">//</span>
01963         <span class="comment">//  Perform TZ normalization if this is a local time with</span>
01964         <span class="comment">//  specified timezone.</span>
01965         <span class="comment">//</span>
01966 
01967         <span class="keywordflow">if</span> (UdfTime-&gt;Type == 1 &amp;&amp; UdfTime-&gt;Zone != <a class="code" href="../../d0/d7/iso13346_8h.html#a14">TIMESTAMP_Z_NONE</a>) {
01968             
01969             NtTime-&gt;QuadPart += Int32x32To64( -UdfTime-&gt;Zone, (60 * 10 * 1000 * 1000) );
01970         }
01971     
01972     } <span class="keywordflow">else</span> {
01973 
01974         <span class="comment">//</span>
01975         <span class="comment">//  Epoch.  Malformed timestamp.</span>
01976         <span class="comment">//</span>
01977 
01978         NtTime-&gt;QuadPart = 0;
01979     }
01980 }
01981 
01982 <span class="comment">//</span>
01983 <span class="comment">//  An equivalence test for Entity IDs.</span>
01984 <span class="comment">//</span>
01985 
01986 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
01987 BOOLEAN
<a name="l01988"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a229">01988</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a229">UdfEqualEntityId</a> (
01989     IN <a class="code" href="../../d6/d6/structREGID.html">PREGID</a> RegID,
01990     IN PSTRING Id,
01991     IN OPTIONAL PSTRING Suffix
01992     )
01993 {
01994 
01995     <span class="keywordflow">return</span> (<a class="code" href="../../d3/d8/udfprocs_8h.html#a125">UdfEqualCountedString</a>( Id, RegID-&gt;Identifier ) &amp;&amp;
01996 
01997 <span class="preprocessor">#ifndef UDF_SUPPORT_NONSTANDARD_ENTITY_STRINGTERM</span>
01998 <span class="preprocessor"></span>            
01999             <span class="comment">//</span>
02000             <span class="comment">//  Allow disabling of the check that the identifier</span>
02001             <span class="comment">//  seems to be padded with zero.</span>
02002             <span class="comment">//</span>
02003             <span class="comment">//  Reason: a couple samples that are otherwise useful</span>
02004             <span class="comment">//      padded some identifiers with junk.</span>
02005             <span class="comment">//</span>
02006 
02007             ((Id-&gt;Length == <span class="keyword">sizeof</span>(RegID-&gt;Identifier) ||
02008               RegID-&gt;Identifier[Id-&gt;Length] == <span class="charliteral">'\0'</span>) ||
02009              
02010              !<a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(( 0, <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a>,
02011                            <span class="stringliteral">"UdfEqualEntityId, RegID seems to be terminated with junk!\n"</span> ))) &amp;&amp;
02012 <span class="preprocessor">#endif</span>
02013 <span class="preprocessor"></span>
02014             ((Suffix == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || <a class="code" href="../../d3/d8/udfprocs_8h.html#a125">UdfEqualCountedString</a>( Suffix, RegID-&gt;Suffix )));
02015 }
02016 
02017 <span class="comment">//</span>
02018 <span class="comment">//  A Domain Identifier RegID is considered to be contained if the</span>
02019 <span class="comment">//  text string identifier matches and the revision is less than or</span>
02020 <span class="comment">//  equal.  This is the convenient way to check that a Domain ID</span>
02021 <span class="comment">//  indicates a set of structures will be intelligible to a given</span>
02022 <span class="comment">//  implementation level.</span>
02023 <span class="comment">//</span>
02024 
02025 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
02026 BOOLEAN
<a name="l02027"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a230">02027</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a230">UdfDomainIdentifierContained</a> (
02028     IN <a class="code" href="../../d6/d6/structREGID.html">PREGID</a> RegID,
02029     IN PSTRING Domain,
02030     IN USHORT RevisionMin,
02031     IN USHORT RevisionMax
02032     )
02033 {
02034     <a class="code" href="../../d6/d3/struct__UDF__SUFFIX__DOMAIN.html">PUDF_SUFFIX_DOMAIN</a> DomainSuffix = (<a class="code" href="../../d6/d3/struct__UDF__SUFFIX__DOMAIN.html">PUDF_SUFFIX_DOMAIN</a>) RegID-&gt;Suffix;
02035 
02036 <span class="preprocessor">#ifdef UDF_SUPPORT_NONSTANDARD_ALLSTOR</span>
02037 <span class="preprocessor"></span>    
02038     <span class="comment">//</span>
02039     <span class="comment">//  Disable checking of the UDF revision.</span>
02040     <span class="comment">//</span>
02041     <span class="comment">//  Reason: first drop of Allstor media recorded the version number as</span>
02042     <span class="comment">//      a decimal number, not hex (102 = 0x66)</span>
02043     <span class="comment">//</span>
02044 
02045     <span class="keywordflow">return</span> (<a class="code" href="../../d3/d8/udfprocs_8h.html#a229">UdfEqualEntityId</a>( RegID, Domain, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ));
02046 
02047 <span class="preprocessor">#else</span>
02048 <span class="preprocessor"></span>
02049     <span class="keywordflow">return</span> ((DomainSuffix-&gt;<a class="code" href="../../d6/d3/struct__UDF__SUFFIX__DOMAIN.html#o0">UdfRevision</a> &lt;= RevisionMax &amp;&amp; DomainSuffix-&gt;<a class="code" href="../../d6/d3/struct__UDF__SUFFIX__DOMAIN.html#o0">UdfRevision</a> &gt;= RevisionMin) &amp;&amp;
02050             <a class="code" href="../../d3/d8/udfprocs_8h.html#a229">UdfEqualEntityId</a>( RegID, Domain, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ));
02051 <span class="preprocessor">#endif</span>
02052 <span class="preprocessor"></span>}
02053 
02054 <span class="comment">//</span>
02055 <span class="comment">//  In like fashion, we define containment for a UDF Identifier RegID.</span>
02056 <span class="comment">//</span>
02057 
02058 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
02059 BOOLEAN
<a name="l02060"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a231">02060</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a231">UdfUdfIdentifierContained</a> (
02061     IN <a class="code" href="../../d6/d6/structREGID.html">PREGID</a> RegID,
02062     IN PSTRING Type,
02063     IN USHORT RevisionMin,
02064     IN USHORT RevisionMax,
02065     IN UCHAR OSClass,
02066     IN UCHAR OSIdentifier
02067     )
02068 {
02069     <a class="code" href="../../d8/d3/struct__UDF__SUFFIX__UDF.html">PUDF_SUFFIX_UDF</a> UdfSuffix = (<a class="code" href="../../d8/d3/struct__UDF__SUFFIX__UDF.html">PUDF_SUFFIX_UDF</a>) RegID-&gt;Suffix;
02070 
02071     <span class="keywordflow">return</span> ((UdfSuffix-&gt;<a class="code" href="../../d8/d3/struct__UDF__SUFFIX__UDF.html#o0">UdfRevision</a> &lt;= RevisionMax &amp;&amp; UdfSuffix-&gt;<a class="code" href="../../d8/d3/struct__UDF__SUFFIX__UDF.html#o0">UdfRevision</a> &gt;= RevisionMin) &amp;&amp;
02072             (OSClass == <a class="code" href="../../d9/d7/udf_8h.html#a33">OSCLASS_INVALID</a> || UdfSuffix-&gt;<a class="code" href="../../d8/d3/struct__UDF__SUFFIX__UDF.html#o1">OSClass</a> == OSClass) &amp;&amp;
02073             (OSIdentifier == <a class="code" href="../../d9/d7/udf_8h.html#a34">OSIDENTIFIER_INVALID</a> || UdfSuffix-&gt;<a class="code" href="../../d8/d3/struct__UDF__SUFFIX__UDF.html#o2">OSIdentifier</a> == OSIdentifier) &amp;&amp;
02074             <a class="code" href="../../d3/d8/udfprocs_8h.html#a229">UdfEqualEntityId</a>( RegID, Type, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ));
02075 }
02076 
02077 
02078 <span class="comment">//</span>
02079 <span class="comment">//  Verification support routines.  Contained in verfysup.c</span>
02080 <span class="comment">//</span>
02081 
02082 BOOLEAN
02083 <a class="code" href="../../d8/d5/udfs_2verfysup_8c.html#a3">UdfCheckForDismount</a> (
02084     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02085     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb,
02086     IN BOOLEAN Force
02087     );
02088 
02089 BOOLEAN
02090 <a class="code" href="../../d8/d5/udfs_2verfysup_8c.html#a4">UdfDismountVcb</a> (
02091     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02092     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb
02093     );
02094 
02095 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02096 <a class="code" href="../../d8/d5/udfs_2verfysup_8c.html#a5">UdfVerifyVcb</a> (
02097     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02098     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb
02099     );
02100 
02101 BOOLEAN
02102 <a class="code" href="../../d8/d5/udfs_2verfysup_8c.html#a6">UdfVerifyFcbOperation</a> (
02103     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext OPTIONAL,
02104     IN <a class="code" href="../../d7/d9/struct__FCB.html">PFCB</a> Fcb
02105     );
02106 
02107 <span class="comment">//</span>
02108 <span class="comment">//  BOOLEAN</span>
02109 <span class="comment">//  UdfIsRawDevice (</span>
02110 <span class="comment">//      IN PIRP_CONTEXT IrpContext,</span>
02111 <span class="comment">//      IN NTSTATUS Status</span>
02112 <span class="comment">//      );</span>
02113 <span class="comment">//</span>
02114 
<a name="l02115"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a100">02115</a> <span class="preprocessor">#define UdfIsRawDevice(IC,S) (           \</span>
02116 <span class="preprocessor">    ((S) == STATUS_DEVICE_NOT_READY) ||  \</span>
02117 <span class="preprocessor">    ((S) == STATUS_NO_MEDIA_IN_DEVICE)   \</span>
02118 <span class="preprocessor">)</span>
02119 <span class="preprocessor"></span>
02120 
02121 <span class="comment">//</span>
02122 <span class="comment">//  Volume Mapped Control Blocks routines, implemented in VmcbSup.c</span>
02123 <span class="comment">//</span>
02124 
02125 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02126 <a class="code" href="../../d6/d6/vmcbsup_8c.html#a5">UdfInitializeVmcb</a> (
02127     IN <a class="code" href="../../d1/d7/struct__VMCB.html">PVMCB</a> Vmcb,
02128     IN POOL_TYPE PoolType,
02129     IN ULONG MaximumLbn,
02130     IN ULONG LbSize
02131     );
02132 
02133 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02134 <a class="code" href="../../d6/d6/vmcbsup_8c.html#a6">UdfUninitializeVmcb</a> (
02135     IN <a class="code" href="../../d1/d7/struct__VMCB.html">PVMCB</a> Vmcb
02136     );
02137 
02138 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02139 <a class="code" href="../../d6/d6/vmcbsup_8c.html#a7">UdfResetVmcb</a> (
02140     IN <a class="code" href="../../d1/d7/struct__VMCB.html">PVMCB</a> Vmcb
02141     );
02142 
02143 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02144 <a class="code" href="../../d6/d6/vmcbsup_8c.html#a8">UdfSetMaximumLbnVmcb</a> (
02145     IN <a class="code" href="../../d1/d7/struct__VMCB.html">PVMCB</a> Vmcb,
02146     IN ULONG MaximumLbn
02147     );
02148 
02149 BOOLEAN
02150 <a class="code" href="../../d6/d6/vmcbsup_8c.html#a9">UdfVmcbVbnToLbn</a> (
02151     IN <a class="code" href="../../d1/d7/struct__VMCB.html">PVMCB</a> Vmcb,
02152     IN <a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> Vbn,
02153     OUT <a class="code" href="../../d1/d8/fsrtl_8h.html#a51">PLBN</a> Lbn,
02154     OUT PULONG SectorCount OPTIONAL
02155     );
02156 
02157 BOOLEAN
02158 <a class="code" href="../../d6/d6/vmcbsup_8c.html#a10">UdfVmcbLbnToVbn</a> (
02159     IN <a class="code" href="../../d1/d7/struct__VMCB.html">PVMCB</a> Vmcb,
02160     IN LBN Lbn,
02161     OUT <a class="code" href="../../d1/d8/fsrtl_8h.html#a53">PVBN</a> Vbn,
02162     OUT PULONG SectorCount OPTIONAL
02163     );
02164 
02165 BOOLEAN
02166 <a class="code" href="../../d6/d6/vmcbsup_8c.html#a11">UdfAddVmcbMapping</a> (
02167     IN <a class="code" href="../../d1/d7/struct__VMCB.html">PVMCB</a> Vmcb,
02168     IN LBN Lbn,
02169     IN ULONG SectorCount,
02170     IN BOOLEAN ExactEnd,
02171     OUT PVBN Vbn,
02172     OUT PULONG AlignedSectorCount
02173     );
02174 
02175 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02176 <a class="code" href="../../d6/d6/vmcbsup_8c.html#a12">UdfRemoveVmcbMapping</a> (
02177     IN <a class="code" href="../../d1/d7/struct__VMCB.html">PVMCB</a> Vmcb,
02178     IN LBN Lbn,
02179     IN ULONG SectorCount
02180     );
02181 
02182 
02183 <span class="comment">//</span>
02184 <span class="comment">//  Routines to verify the correspondance of the underlying media, implemented in</span>
02185 <span class="comment">//  verfysup.c</span>
02186 <span class="comment">//</span>
02187 
02188 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02189 <a class="code" href="../../d8/d5/udfs_2verfysup_8c.html#a2">UdfPerformVerify</a> (
02190     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02191     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
02192     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceToVerify
02193     );
02194 
02195 
02196 <span class="comment">//</span>
02197 <span class="comment">//  Work queue routines for posting and retrieving an Irp, implemented in</span>
02198 <span class="comment">//  workque.c</span>
02199 <span class="comment">//</span>
02200 
02201 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02202 <a class="code" href="../../d2/d9/workque_8c.html#a4">UdfFsdPostRequest</a>(
02203     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02204     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02205     );
02206 
02207 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02208 <a class="code" href="../../d2/d9/workque_8c.html#a5">UdfPrePostIrp</a> (
02209     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02210     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02211     );
02212 
02213 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02214 <a class="code" href="../../d2/d9/workque_8c.html#a6">UdfOplockComplete</a> (
02215     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02216     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02217     );
02218 
02219 
02220 <span class="comment">//</span>
02221 <span class="comment">//  Charspecs are small containers that specify a CS&lt;N&gt; type and a text</span>
02222 <span class="comment">//  string specifying a version, etc.  This is a convenient way of bottling</span>
02223 <span class="comment">//  up equivalence checks of a charspec.</span>
02224 <span class="comment">//</span>
02225 
02226 <a class="code" href="../../d5/d3/filelock_8c.html#a1">INLINE</a>
02227 BOOLEAN
<a name="l02228"></a><a class="code" href="../../d3/d8/udfprocs_8h.html#a248">02228</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a248">UdfEqualCharspec</a> (
02229     IN <a class="code" href="../../d2/d3/structCHARSPEC.html">PCHARSPEC</a> Charspec,
02230     IN PSTRING Identifier,
02231     IN UCHAR Type
02232     )
02233 {
02234     <span class="keywordflow">return</span> ((Charspec-&gt;Type == Type) &amp;&amp; <a class="code" href="../../d3/d8/udfprocs_8h.html#a125">UdfEqualCountedString</a>( Identifier, Charspec-&gt;Info));
02235 }
02236 
02237 
02238 <span class="comment">//</span>
02239 <span class="comment">//  The FSP level dispatch/main routine.  This is the routine that takes</span>
02240 <span class="comment">//  IRP's off of the work queue and calls the appropriate FSP level</span>
02241 <span class="comment">//  work routine.</span>
02242 <span class="comment">//</span>
02243 
02244 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02245 <a class="code" href="../../d3/d8/udfprocs_8h.html#a249">UdfFspDispatch</a> (                            <span class="comment">//  implemented in FspDisp.c</span>
02246     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext
02247     );
02248 
02249 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02250 <a class="code" href="../../d3/d8/udfprocs_8h.html#a250">UdfFspClose</a> (                               <span class="comment">//  Implemented in Close.c</span>
02251     IN <a class="code" href="../../d7/d5/struct__VCB.html">PVCB</a> Vcb OPTIONAL
02252     );
02253 
02254 <span class="comment">//</span>
02255 <span class="comment">//  The following routines are the entry points for the different operations</span>
02256 <span class="comment">//  based on the IrpSp major functions.</span>
02257 <span class="comment">//</span>
02258 
02259 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02260 <a class="code" href="../../d3/d8/udfprocs_8h.html#a251">UdfCommonCleanup</a> (                          <span class="comment">//  Implemented in Cleanup.c</span>
02261     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02262     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02263     );
02264 
02265 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02266 <a class="code" href="../../d3/d8/udfprocs_8h.html#a252">UdfCommonClose</a> (                            <span class="comment">//  Implemented in Close.c</span>
02267     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02268     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02269     );
02270 
02271 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02272 <a class="code" href="../../d3/d8/udfprocs_8h.html#a253">UdfCommonCreate</a> (                           <span class="comment">//  Implemented in Create.c</span>
02273     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02274     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02275     );
02276 
02277 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                                    <span class="comment">//  Implemented in DevCtrl.c</span>
02278 <a class="code" href="../../d3/d8/udfprocs_8h.html#a254">UdfCommonDevControl</a> (
02279     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02280     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02281     );
02282 
02283 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                                    <span class="comment">//  Implemented in DirCtrl.c</span>
02284 <a class="code" href="../../d3/d8/udfprocs_8h.html#a255">UdfCommonDirControl</a> (
02285     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02286     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02287     );
02288 
02289 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
02290 <a class="code" href="../../d3/d8/udfprocs_8h.html#a256">UdfCommonFsControl</a> (                        <span class="comment">//  Implemented in FsCtrl.c</span>
02291     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02292     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02293     );
02294 
02295 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                                    <span class="comment">//  Implemented in LockCtrl.c</span>
02296 <a class="code" href="../../d3/d8/udfprocs_8h.html#a257">UdfCommonLockControl</a> (
02297     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02298     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02299     );
02300 
02301 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                                    <span class="comment">//  Implemented in Pnp.c</span>
02302 <a class="code" href="../../d3/d8/udfprocs_8h.html#a258">UdfCommonPnp</a> (
02303     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02304     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02305     );
02306 
02307 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                                    <span class="comment">//  Implemented in FileInfo.c</span>
02308 <a class="code" href="../../d3/d8/udfprocs_8h.html#a259">UdfCommonQueryInfo</a> (
02309     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02310     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02311     );
02312 
02313 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                                    <span class="comment">//  Implemented in VolInfo.c</span>
02314 <a class="code" href="../../d7/d6/volinfo_8c.html#a6">UdfCommonQueryVolInfo</a> (
02315     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02316     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02317     );
02318 
02319 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                                    <span class="comment">//  Implemented in Read.c</span>
02320 <a class="code" href="../../d3/d8/udfprocs_8h.html#a261">UdfCommonRead</a> (
02321     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02322     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02323     );
02324 
02325 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                                    <span class="comment">//  Implemented in FileInfo.c</span>
02326 <a class="code" href="../../d3/d8/udfprocs_8h.html#a262">UdfCommonSetInfo</a> (
02327     IN <a class="code" href="../../d0/d3/struct__IRP__CONTEXT.html">PIRP_CONTEXT</a> IrpContext,
02328     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
02329     );
02330 
02331 
02332 <span class="comment">//</span>
02333 <span class="comment">//  Clean up our internal-to-the-header definitions so they do not leak out.</span>
02334 <span class="comment">//</span>
02335 
02336 <span class="preprocessor">#undef BugCheckFileId</span>
02337 <span class="preprocessor"></span><span class="preprocessor">#undef Dbg</span>
02338 <span class="preprocessor"></span>
02339 
02340 <span class="preprocessor">#endif // _UDFPROCS_</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:10 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
