<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: client/ddetrack.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ddetrack.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d5/d3/client_2ddetrack_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a0">_ClientCopyDDEIn1</a> (HANDLE hClient, <a class="el" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a1">_ClientCopyDDEIn2</a> (<a class="el" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a2">FixupDdeExecuteIfNecessary</a> (HGLOBAL *phCommands, BOOL fNeedUnicode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a3">_ClientCopyDDEOut1</a> (<a class="el" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a4">_ClientCopyDDEOut2</a> (<a class="el" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a5">_ClientFreeDDEHandle</a> (HANDLE hDDE, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a6">_ClientGetDDEFlags</a> (HANDLE hDDE, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LPARAM APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a7">PackDDElParam</a> (UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, UINT_PTR uiLo, UINT_PTR uiHi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a8">UnpackDDElParam</a> (UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, LPARAM lParam, PUINT_PTR puiLo, PUINT_PTR puiHi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a> (UINT <a class="el" href="../../d2/d1/userexts_8c.html#a129">msg</a>, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LPARAM APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/client_2ddetrack_8c.html#a10">ReuseDDElParam</a> (LPARAM lParam, UINT msgIn, UINT msgOut, UINT_PTR uiLo, UINT_PTR uiHi)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="client/ddetrack.c::_ClientCopyDDEIn1" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> _ClientCopyDDEIn1           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hClient</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00015">15</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00033">tagINTDDEINFO::cbDirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00036">tagINTDDEINFO::cbIndirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00020">tagDDE_DATA::Data</a>, <a class="el" href="../../d6/d4/ddetrack_8h.html#a23">DDE_DATA</a>, <a class="el" href="../../d6/d4/ddetrack_8h.html#a21">DDEPACK</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00029">tagINTDDEINFO::DdePack</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00063">DO_POST</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00061">FAIL_POST</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00064">FAILNOFREE_POST</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00030">tagINTDDEINFO::flags</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00031">tagINTDDEINFO::hDirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00034">tagINTDDEINFO::hIndirect</a>, <a class="el" href="../../d6/d4/ddetrack_8h.html#a25">INTDDEINFO</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d6/d4/ddetrack_8h.html#a24">PDDE_DATA</a>, <a class="el" href="../../d6/d4/ddetrack_8h.html#a22">PDDEPACK</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00032">tagINTDDEINFO::pDirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00035">tagINTDDEINFO::pIndirect</a>, <a class="el" href="../../d6/d4/ddetrack_8h.html#a26">PINTDDEINFO</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00014">tagDDEPACK::uiHi</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00013">tagDDEPACK::uiLo</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00124">UserGlobalFree</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00130">UserGlobalSize</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00019">tagDDE_DATA::wFmt</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00046">XS_BITMAP</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00044">XS_DATA</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00047">XS_DIB</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00048">XS_ENHMETAFILE</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00054">XS_EXECUTE</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00055">XS_FREESRC</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00051">XS_HIHANDLE</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00050">XS_LOHANDLE</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00045">XS_METAFILEPICT</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00043">XS_PACKED</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00049">XS_PALETTE</a>.
<p>
<pre class="fragment"><div>00018 {
00019     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pData;
00020     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> flags;
00021 
00022     <span class="comment">//</span>
00023     <span class="comment">// zero out everything but the flags</span>
00024     <span class="comment">//</span>
00025     flags = pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a>;
00026     RtlZeroMemory(pi, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a>));
00027     pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> = flags;
00028     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hClient, pData);
00029 
00030     <span class="keywordflow">if</span> (pData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {                            <span class="comment">// bad hClient</span>
00031         RIPMSG0(RIP_WARNING, <span class="stringliteral">"_ClientCopyDDEIn1:GlobalLock failed."</span>);
00032         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d4/ddetrack_8h.html#a17">FAIL_POST</a>);
00033     }
00034 
00035     <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a0">XS_PACKED</a>) {
00036 
00037         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a6">UserGlobalSize</a>(hClient) &lt; <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d2/structtagDDEPACK.html">DDEPACK</a>)) {
00038             <span class="comment">/*</span>
00039 <span class="comment">             * must be a low memory condition. fail.</span>
00040 <span class="comment">             */</span>
00041             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d4/ddetrack_8h.html#a17">FAIL_POST</a>);
00042         }
00043 
00044         pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o0">DdePack</a> = *(<a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a>)pData;
00045         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hClient);
00046         <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>(hClient);    <span class="comment">// packed data handles are not WOW matched.</span>
00047         hClient = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00048 
00049         <span class="keywordflow">if</span> (!(flags &amp; (<a class="code" href="../../d6/d4/ddetrack_8h.html#a7">XS_LOHANDLE</a> | <a class="code" href="../../d6/d4/ddetrack_8h.html#a8">XS_HIHANDLE</a>))) {
00050             <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a11">XS_EXECUTE</a> &amp;&amp; flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a12">XS_FREESRC</a>) {
00051                 <span class="comment">/*</span>
00052 <span class="comment">                 * free execute ACK data</span>
00053 <span class="comment">                 */</span>
00054                 <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>((HANDLE)pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o0">DdePack</a>.<a class="code" href="../../d9/d2/structtagDDEPACK.html#o1">uiHi</a>);
00055             }
00056             <span class="keywordflow">return</span> (<a class="code" href="../../d6/d4/ddetrack_8h.html#a19">DO_POST</a>); <span class="comment">// no direct data</span>
00057         }
00058 
00059         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a7">XS_LOHANDLE</a>) {
00060             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a> = (HANDLE)pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o0">DdePack</a>.<a class="code" href="../../d9/d2/structtagDDEPACK.html#o0">uiLo</a>;
00061         } <span class="keywordflow">else</span> {
00062             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a> = (HANDLE)pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o0">DdePack</a>.<a class="code" href="../../d9/d2/structtagDDEPACK.html#o1">uiHi</a>;
00063         }
00064 
00065         <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a> == 0) {
00066             <span class="keywordflow">return</span> (<a class="code" href="../../d6/d4/ddetrack_8h.html#a19">DO_POST</a>); <span class="comment">// must be warm link</span>
00067         }
00068 
00069         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>, pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o3">pDirect</a>);
00070         <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o3">pDirect</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00071             RIPMSG1(RIP_ERROR, <span class="stringliteral">"_ClientCopyDDEIn1:GlobalLock failed for hDirect %lx."</span>,pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00072             <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/ddetrack_8h.html#a20">FAILNOFREE_POST</a>;
00073         }
00074         pData = pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o3">pDirect</a>;
00075         pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a6">UserGlobalSize</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00076 
00077     } <span class="keywordflow">else</span> {    <span class="comment">// not packed - must be execute data or we wouldn't be called</span>
00078 
00079         UserAssert(flags &amp; XS_EXECUTE);
00080 
00081         pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a6">UserGlobalSize</a>(hClient);
00082         pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a> = hClient;
00083         pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o3">pDirect</a> = pData;
00084         hClient = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00085     }
00086 
00087     <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a1">XS_DATA</a>) {
00088         <a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a> pDdeData = (<a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a>)pData;
00089 
00090         <span class="comment">/*</span>
00091 <span class="comment">         * Assert that the hClient has been freed. If not this code will return</span>
00092 <span class="comment">         * the wrong thing on failure</span>
00093 <span class="comment">         */</span>
00094         UserAssert(flags &amp; XS_PACKED);
00095 
00096         <span class="comment">//</span>
00097         <span class="comment">// check here for indirect data</span>
00098         <span class="comment">//</span>
00099 
00100         <span class="keywordflow">switch</span> (pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o1">wFmt</a>) {
00101         <span class="keywordflow">case</span> CF_BITMAP:
00102         <span class="keywordflow">case</span> CF_DSPBITMAP:
00103             <span class="comment">//</span>
00104             <span class="comment">// Imediately following the dde data header is a bitmap handle.</span>
00105             <span class="comment">//</span>
00106             UserAssert(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a> &gt;= <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d2/structtagDDE__DATA.html">DDE_DATA</a>));
00107             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> = (HANDLE)pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>;
00108             <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> == 0) {
00109                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"_ClientCopyDDEIn1:GdiConvertBitmap failed"</span>);
00110                 <span class="keywordflow">return</span>(<a class="code" href="../../d6/d4/ddetrack_8h.html#a20">FAILNOFREE_POST</a>);
00111             }
00112             <span class="comment">// pi-&gt;cbIndirect = 0; // zero init.</span>
00113             <span class="comment">// pi-&gt;pIndirect = NULL; // zero init.</span>
00114             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> |= <a class="code" href="../../d6/d4/ddetrack_8h.html#a3">XS_BITMAP</a>;
00115             <span class="keywordflow">break</span>;
00116 
00117         <span class="keywordflow">case</span> CF_DIB:
00118             <span class="comment">//</span>
00119             <span class="comment">// Imediately following the dde data header is a global data handle</span>
00120             <span class="comment">// to the DIB bits.</span>
00121             <span class="comment">//</span>
00122             UserAssert(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a> &gt;= <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d2/structtagDDE__DATA.html">DDE_DATA</a>));
00123             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> |= <a class="code" href="../../d6/d4/ddetrack_8h.html#a4">XS_DIB</a>;
00124             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> = (HANDLE)pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>;
00125             <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>, pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o6">pIndirect</a>);
00126             <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o6">pIndirect</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00127                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"_ClientCopyDDEIn1:CF_DIB GlobalLock failed."</span>);
00128                 <span class="keywordflow">return</span> (<a class="code" href="../../d6/d4/ddetrack_8h.html#a20">FAILNOFREE_POST</a>);
00129             }
00130             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o7">cbIndirect</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a6">UserGlobalSize</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>);
00131             <span class="keywordflow">break</span>;
00132 
00133         <span class="keywordflow">case</span> CF_PALETTE:
00134             UserAssert(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a> &gt;= <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d2/structtagDDE__DATA.html">DDE_DATA</a>));
00135             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> = (HANDLE) pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>;
00136             <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> == 0) {
00137                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"_ClientCopyDDEIn1:GdiConvertPalette failed."</span>);
00138                 <span class="keywordflow">return</span>(<a class="code" href="../../d6/d4/ddetrack_8h.html#a20">FAILNOFREE_POST</a>);
00139             }
00140             <span class="comment">// pi-&gt;cbIndirect = 0; // zero init.</span>
00141             <span class="comment">// pi-&gt;pIndirect = NULL; // zero init.</span>
00142             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> |= <a class="code" href="../../d6/d4/ddetrack_8h.html#a6">XS_PALETTE</a>;
00143             <span class="keywordflow">break</span>;
00144 
00145         <span class="keywordflow">case</span> CF_DSPMETAFILEPICT:
00146         <span class="keywordflow">case</span> CF_METAFILEPICT:
00147             <span class="comment">//</span>
00148             <span class="comment">// This format holds a global data handle which contains</span>
00149             <span class="comment">// a METAFILEPICT structure that in turn contains</span>
00150             <span class="comment">// a GDI metafile.</span>
00151             <span class="comment">//</span>
00152             UserAssert(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a> &gt;= <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d2/structtagDDE__DATA.html">DDE_DATA</a>));
00153             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> = GdiConvertMetaFilePict((HANDLE)pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>);
00154             <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> == 0) {
00155                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"_ClientCopyDDEIn1:GdiConvertMetaFilePict failed"</span>);
00156                 <span class="keywordflow">return</span>(<a class="code" href="../../d6/d4/ddetrack_8h.html#a20">FAILNOFREE_POST</a>);
00157             }
00158             <span class="comment">// pi-&gt;cbIndirect = 0; // zero init.</span>
00159             <span class="comment">// pi-&gt;pIndirect = NULL; // zero init.</span>
00160             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> |= <a class="code" href="../../d6/d4/ddetrack_8h.html#a2">XS_METAFILEPICT</a>;
00161             <span class="keywordflow">break</span>;
00162 
00163         <span class="keywordflow">case</span> CF_ENHMETAFILE:
00164         <span class="keywordflow">case</span> CF_DSPENHMETAFILE:
00165             UserAssert(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a> &gt;= <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d2/structtagDDE__DATA.html">DDE_DATA</a>));
00166             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> = GdiConvertEnhMetaFile((HENHMETAFILE)pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>);
00167             <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> == 0) {
00168                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"_ClientCopyDDEIn1:GdiConvertEnhMetaFile failed"</span>);
00169                 <span class="keywordflow">return</span>(<a class="code" href="../../d6/d4/ddetrack_8h.html#a20">FAILNOFREE_POST</a>);
00170             }
00171             <span class="comment">// pi-&gt;cbIndirect = 0; // zero init.</span>
00172             <span class="comment">// pi-&gt;pIndirect = NULL; // zero init.</span>
00173             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> |= <a class="code" href="../../d6/d4/ddetrack_8h.html#a5">XS_ENHMETAFILE</a>;
00174             <span class="keywordflow">break</span>;
00175         }
00176     }
00177 
00178     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d4/ddetrack_8h.html#a19">DO_POST</a>);
00179 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="client/ddetrack.c::_ClientCopyDDEIn2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID _ClientCopyDDEIn2           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00185">185</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00033">tagINTDDEINFO::cbDirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00036">tagINTDDEINFO::cbIndirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00030">tagINTDDEINFO::flags</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00031">tagINTDDEINFO::hDirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00034">tagINTDDEINFO::hIndirect</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00055">XS_FREESRC</a>.
<p>
<pre class="fragment"><div>00187 {
00188     <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a>) {
00189         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00190         <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a12">XS_FREESRC</a>) {
00191             <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00192         }
00193     }
00194 
00195     <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o7">cbIndirect</a>) {
00196         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>);
00197         <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a12">XS_FREESRC</a>) {
00198             <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>);
00199         }
00200     }
00201 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="client/ddetrack.c::_ClientCopyDDEOut1" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE _ClientCopyDDEOut1           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00305">305</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00033">tagINTDDEINFO::cbDirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00036">tagINTDDEINFO::cbIndirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00029">tagINTDDEINFO::DdePack</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00030">tagINTDDEINFO::flags</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00031">tagINTDDEINFO::hDirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00034">tagINTDDEINFO::hIndirect</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00032">tagINTDDEINFO::pDirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00035">tagINTDDEINFO::pIndirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00014">tagDDEPACK::uiHi</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00013">tagDDEPACK::uiLo</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00125">UserGlobalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00124">UserGlobalFree</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00051">XS_HIHANDLE</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00050">XS_LOHANDLE</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00043">XS_PACKED</a>.
<p>
<pre class="fragment"><div>00307 {
00308     HANDLE hDdePack = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00309     <a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a> pDdePack = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00310 
00311     <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a0">XS_PACKED</a>) {
00312         <span class="comment">/*</span>
00313 <span class="comment">         * make a wrapper for the data</span>
00314 <span class="comment">         */</span>
00315         hDdePack = <a class="code" href="../../d6/d0/usercli_8h.html#a3">UserGlobalAlloc</a>(GMEM_DDESHARE | GMEM_FIXED,
00316                 <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d2/structtagDDEPACK.html">DDEPACK</a>));
00317         pDdePack = (<a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a>)hDdePack;
00318         <span class="keywordflow">if</span> (pDdePack == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00319             RIPMSG0(RIP_WARNING, <span class="stringliteral">"_ClientCopyDDEOut1:Couldn't allocate DDEPACK"</span>);
00320             <span class="keywordflow">return</span> (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00321         }
00322         *pDdePack = pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o0">DdePack</a>;
00323     }
00324 
00325     <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a>) {
00326         pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a3">UserGlobalAlloc</a>(GMEM_DDESHARE | GMEM_MOVEABLE, pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a>);
00327         <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00328             RIPMSG0(RIP_WARNING, <span class="stringliteral">"_ClientCopyDDEOut1:Couldn't allocate hDirect"</span>);
00329             <span class="keywordflow">if</span> (hDdePack) {
00330                 <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>(hDdePack);
00331             }
00332             <span class="keywordflow">return</span> (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00333         }
00334 
00335         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>, pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o3">pDirect</a>);
00336         UserAssert(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o3">pDirect</a>);
00337 
00338         <span class="comment">// fixup packed data reference to direct data</span>
00339 
00340         <span class="keywordflow">if</span> (pDdePack != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00341             <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a7">XS_LOHANDLE</a>) {
00342                 pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o0">uiLo</a> = HandleToUlong(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00343                 UserAssert((ULONG_PTR)pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o0">uiLo</a> == (ULONG_PTR)pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00344             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a8">XS_HIHANDLE</a>) {
00345                 pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o1">uiHi</a> = HandleToUlong(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00346                 UserAssert((ULONG_PTR)pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o1">uiHi</a> == (ULONG_PTR)pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00347             }
00348         }
00349 
00350         <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o7">cbIndirect</a>) {
00351             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a3">UserGlobalAlloc</a>(GMEM_DDESHARE | GMEM_MOVEABLE,
00352                     pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o7">cbIndirect</a>);
00353             <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00354                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"_ClientCopyDDEOut1:Couldn't allocate hIndirect"</span>);
00355                 <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00356                 <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00357                 <span class="keywordflow">if</span> (hDdePack) {
00358                     <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>(hDdePack);
00359                 }
00360                 <span class="keywordflow">return</span> (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00361             }
00362             <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>, pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o6">pIndirect</a>);
00363             UserAssert(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o6">pIndirect</a>);
00364         }
00365     }
00366 
00367     <span class="keywordflow">if</span> (hDdePack) {
00368         <span class="keywordflow">return</span> (hDdePack);
00369     } <span class="keywordflow">else</span> {
00370         <span class="keywordflow">return</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00371     }
00372 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="client/ddetrack.c::_ClientCopyDDEOut2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _ClientCopyDDEOut2           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00379">379</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00020">tagDDE_DATA::Data</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00208">FixupDdeExecuteIfNecessary()</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00030">tagINTDDEINFO::flags</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00031">tagINTDDEINFO::hDirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00034">tagINTDDEINFO::hIndirect</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00032">tagINTDDEINFO::pDirect</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00019">tagDDE_DATA::wFmt</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00054">XS_EXECUTE</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00059">XS_UNICODE</a>.
<p>
<pre class="fragment"><div>00381 {
00382     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00383     <span class="comment">/*</span>
00384 <span class="comment">     * done with copies - now fixup indirect references</span>
00385 <span class="comment">     */</span>
00386     <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>) {
00387         <a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a> pDdeData = (<a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a>)pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o3">pDirect</a>;
00388 
00389         <span class="keywordflow">switch</span> (pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o1">wFmt</a>) {
00390         <span class="keywordflow">case</span> CF_BITMAP:
00391         <span class="keywordflow">case</span> CF_DSPBITMAP:
00392         <span class="keywordflow">case</span> CF_PALETTE:
00393             pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> = (ULONG_PTR)pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>;
00394             fSuccess = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>;
00395             <span class="keywordflow">break</span>;
00396 
00397         <span class="keywordflow">case</span> CF_METAFILEPICT:
00398         <span class="keywordflow">case</span> CF_DSPMETAFILEPICT:
00399             pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> = (ULONG_PTR)GdiCreateLocalMetaFilePict(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>);
00400             fSuccess = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>;
00401             <span class="keywordflow">break</span>;
00402 
00403         <span class="keywordflow">case</span> CF_DIB:
00404             pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> = (ULONG_PTR)pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>;
00405             fSuccess = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>;
00406             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>);
00407             <span class="keywordflow">break</span>;
00408 
00409         <span class="keywordflow">case</span> CF_ENHMETAFILE:
00410         <span class="keywordflow">case</span> CF_DSPENHMETAFILE:
00411             pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> = (ULONG_PTR)GdiCreateLocalEnhMetaFile(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>);
00412             fSuccess = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pDdeData-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>;
00413             <span class="keywordflow">break</span>;
00414 
00415         <span class="keywordflow">default</span>:
00416             RIPMSG0(RIP_WARNING, <span class="stringliteral">"_ClientCopyDDEOut2:Unknown format w/indirect data."</span>);
00417             fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00418             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o5">hIndirect</a>);
00419         }
00420     }
00421 
00422     UserAssert(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>); <span class="comment">// if its null, we didn't need to call this function.</span>
00423     <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>);
00424     <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a11">XS_EXECUTE</a>) {
00425         <span class="comment">/*</span>
00426 <span class="comment">         * Its possible that in RAW DDE cases where the app allocated the</span>
00427 <span class="comment">         * execute data as non-moveable, we have a different hDirect</span>
00428 <span class="comment">         * than we started with.  This needs to be noted and passed</span>
00429 <span class="comment">         * back to the server. (Very RARE case)</span>
00430 <span class="comment">         */</span>
00431         <a class="code" href="../../d9/d7/ntcb_8h.html#a94">FixupDdeExecuteIfNecessary</a>(&amp;pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>,
00432                 pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> &amp; XS_UNICODE);
00433     }
00434     <span class="keywordflow">return</span> fSuccess;
00435 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="client/ddetrack.c::_ClientFreeDDEHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _ClientFreeDDEHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hDDE</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00456">456</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00491">FreeDDEData()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00410">IS_PTR</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00014">tagDDEPACK::uiHi</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00013">tagDDEPACK::uiLo</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00044">XS_DATA</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00058">XS_DUMPMSG</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00054">XS_EXECUTE</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00050">XS_LOHANDLE</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00043">XS_PACKED</a>.
<p>
<pre class="fragment"><div>00459 {
00460     <a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a> pDdePack;
00461     HANDLE hNew;
00462 
00463     <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a0">XS_PACKED</a>) {
00464         pDdePack = (<a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a>)hDDE;
00465         <span class="keywordflow">if</span> (pDdePack == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00466             <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00467         }
00468         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a7">XS_LOHANDLE</a>) {
00469             hNew = (HANDLE)pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o0">uiLo</a>;
00470         } <span class="keywordflow">else</span> {
00471             hNew = (HANDLE)pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o1">uiHi</a>;
00472 
00473         }
00474         <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(hDDE);
00475         hDDE = hNew;
00476 
00477     }
00478 
00479    <span class="comment">/*</span>
00480 <span class="comment">    * Do a range check and call GlobalFlags to validate, just to prevent heap checking</span>
00481 <span class="comment">    * from complaining during the GlobalSize call.</span>
00482 <span class="comment">    * Is this leaking atoms??</span>
00483 <span class="comment">    */</span>
00484     <span class="keywordflow">if</span> ((hDDE &lt;= (HANDLE)0xFFFF)
00485         || (GlobalFlags(hDDE) == GMEM_INVALID_HANDLE)
00486         || !GlobalSize(hDDE)) {
00487             <span class="comment">/*</span>
00488 <span class="comment">             * There may be cases where apps improperly freed stuff</span>
00489 <span class="comment">             * when they shouldn't have so make sure this handle</span>
00490 <span class="comment">             * is valid by the time it gets here.</span>
00491 <span class="comment">             *</span>
00492 <span class="comment">             * See SvSpontAdvise; it posts a message with an atom in uiHi. Then from _PostMessage</span>
00493 <span class="comment">             *  in the kernel side, we might end up here. So it's not only for apps...</span>
00494 <span class="comment">             */</span>
00495             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00496     }
00497 
00498     <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a15">XS_DUMPMSG</a>) {
00499         <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a0">XS_PACKED</a>) {
00500             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(hNew)) {
00501                 GlobalDeleteAtom(LOWORD((ULONG_PTR)hNew));
00502                 <span class="keywordflow">if</span> (!(flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a1">XS_DATA</a>)) {
00503                     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);     <span class="comment">// ACK</span>
00504                 }
00505             }
00506         } <span class="keywordflow">else</span> {
00507             <span class="keywordflow">if</span> (!(flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a11">XS_EXECUTE</a>)) {
00508                 GlobalDeleteAtom(LOWORD((ULONG_PTR)hDDE));   <span class="comment">// REQUEST, UNADVISE</span>
00509                 <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00510             }
00511         }
00512     }
00513     <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a1">XS_DATA</a>) {
00514         <span class="comment">// POKE, DATA</span>
00515 <span class="preprocessor">#if DBG</span>
00516 <span class="preprocessor"></span>        DDEHandleLastFreed = hDDE;
00517 <span class="preprocessor">#endif</span>
00518 <span class="preprocessor"></span>        <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(hDDE,
00519                 (flags &amp; XS_DUMPMSG) ? FALSE : TRUE,    <span class="comment">// fIgnorefRelease</span>
00520                 (flags &amp; XS_DUMPMSG) ? TRUE : FALSE);    <span class="comment">// fDestroyTruelyGlobalObjects</span>
00521     } <span class="keywordflow">else</span> {
00522         <span class="comment">// ADVISE, EXECUTE</span>
00523 <span class="preprocessor">#if DBG</span>
00524 <span class="preprocessor"></span>        DDEHandleLastFreed = hDDE;
00525 <span class="preprocessor">#endif</span>
00526 <span class="preprocessor"></span>        <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(hDDE);   <span class="comment">// covers ADVISE case (fmt but no data)</span>
00527     }
00528     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00529 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="client/ddetrack.c::_ClientGetDDEFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> _ClientGetDDEFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hDDE</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00532">532</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00013">tagDDEPACK::uiLo</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00044">XS_DATA</a>.
<p>
<pre class="fragment"><div>00535 {
00536     <a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a> pDdePack;
00537     PWORD pw;
00538     HANDLE hData;
00539     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> retval = 0;
00540 
00541     pDdePack = (<a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a>)hDDE;
00542     <span class="keywordflow">if</span> (pDdePack == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00543         <span class="keywordflow">return</span> (0);
00544     }
00545 
00546     <span class="keywordflow">if</span> (flags &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a1">XS_DATA</a>) {
00547         <span class="keywordflow">if</span> (pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o0">uiLo</a>) {
00548             hData = (HANDLE)pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o0">uiLo</a>;
00549             <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hData, pw);
00550             <span class="keywordflow">if</span> (pw != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00551                 retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)*pw; <span class="comment">// first word is hData is wStatus</span>
00552                 <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hData);
00553             }
00554         }
00555     } <span class="keywordflow">else</span> {
00556         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o0">uiLo</a>;
00557     }
00558 
00559     <span class="keywordflow">return</span> (retval);
00560 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="client/ddetrack.c::FixupDdeExecuteIfNecessary" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL FixupDdeExecuteIfNecessary           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HGLOBAL *&nbsp;</td>
          <td class="mdname" nowrap> <em>phCommands</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fNeedUnicode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00208">208</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l02098">RtlIsTextUnicode()</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00369">RtlMultiByteToUnicodeN()</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00905">RtlUnicodeToMultiByteN()</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>.
<p>
Referenced by <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00379">_ClientCopyDDEOut2()</a>.
<p>
<pre class="fragment"><div>00211 {
00212     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cbLen;
00213     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cbSrc = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)GlobalSize(*phCommands);
00214     <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pstr;
00215     HGLOBAL hTemp;
00216     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fHandleValueChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00217 
00218     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(*phCommands, pstr);
00219 
00220     <span class="keywordflow">if</span> (cbSrc &amp;&amp; pstr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00221         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fIsUnicodeText;
00222 <span class="preprocessor">#ifdef ISTEXTUNICODE_WORKS</span>
00223 <span class="preprocessor"></span>        <span class="keywordtype">int</span> flags;
00224 
00225         flags = (IS_TEXT_UNICODE_UNICODE_MASK |
00226                 IS_TEXT_UNICODE_REVERSE_MASK |
00227                 (IS_TEXT_UNICODE_NOT_UNICODE_MASK &amp;
00228                 (~IS_TEXT_UNICODE_ILLEGAL_CHARS)) |
00229                 IS_TEXT_UNICODE_NOT_ASCII_MASK);
00230         fIsUnicodeText = <a class="code" href="../../d6/d6/nls_8c.html#a50">RtlIsTextUnicode</a>(pstr, cbSrc - 2, &amp;flags);
00231 <span class="preprocessor">#else</span>
00232 <span class="preprocessor"></span>        fIsUnicodeText = ((cbSrc &gt;= <span class="keyword">sizeof</span>(WCHAR)) &amp;&amp; (((LPSTR)pstr)[1] == <span class="charliteral">'\0'</span>));
00233 <span class="preprocessor">#endif</span>
00234 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!fIsUnicodeText &amp;&amp; fNeedUnicode) {
00235             LPWSTR pwsz;
00236             <span class="comment">/*</span>
00237 <span class="comment">             * Contents needs to be UNICODE.</span>
00238 <span class="comment">             */</span>
00239             cbLen = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(pstr) + 1;
00240             cbSrc = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cbSrc, cbLen);
00241             pwsz = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(HEAP_ZERO_MEMORY, cbSrc * <span class="keyword">sizeof</span>(WCHAR));
00242             <span class="keywordflow">if</span> (pwsz != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00243                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d9/d6/nlsxlat_8c.html#a33">RtlMultiByteToUnicodeN</a>(
00244                         pwsz,
00245                         cbSrc * <span class="keyword">sizeof</span>(WCHAR),
00246                         NULL,
00247                         (PCHAR)pstr,
00248                         cbSrc))) {
00249                     <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(*phCommands);
00250                     <span class="keywordflow">if</span> ((hTemp = GlobalReAlloc(
00251                             *phCommands,
00252                             cbSrc * <span class="keyword">sizeof</span>(WCHAR),
00253                             GMEM_MOVEABLE)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00254                         fHandleValueChanged = (hTemp != *phCommands);
00255                         *phCommands = hTemp;
00256                         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(*phCommands, pstr);
00257                         pwsz[cbSrc - 1] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00258                         wcscpy(pstr, pwsz);
00259                     }
00260                 }
00261                 <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pwsz);
00262             }
00263         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fIsUnicodeText &amp;&amp; !fNeedUnicode) {
00264             LPSTR psz;
00265             <span class="comment">/*</span>
00266 <span class="comment">             * Contents needs to be ANSI.</span>
00267 <span class="comment">             */</span>
00268             cbLen = (wcslen(pstr) + 1) * <span class="keyword">sizeof</span>(WCHAR);
00269             cbSrc = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cbSrc, cbLen);
00270             psz = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(HEAP_ZERO_MEMORY, cbSrc);
00271             <span class="keywordflow">if</span> (psz != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00272                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d9/d6/nlsxlat_8c.html#a37">RtlUnicodeToMultiByteN</a>(
00273                         psz,
00274                         cbSrc,
00275                         NULL,
00276                         (PWSTR)pstr,
00277                         cbSrc))) {
00278                     <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(*phCommands);
00279                     <span class="keywordflow">if</span> ((hTemp = GlobalReAlloc(
00280                             *phCommands,
00281                             cbSrc / <span class="keyword">sizeof</span>(WCHAR),
00282                             GMEM_MOVEABLE)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00283                         fHandleValueChanged = (hTemp != *phCommands);
00284                         *phCommands = hTemp;
00285                         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(*phCommands, pstr);
00286                         UserAssert(pstr);
00287                         psz[cbSrc - 1] = <span class="charliteral">'\0'</span>;
00288                         strcpy(pstr, psz);
00289                     }
00290                 }
00291                 <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(psz);
00292             }
00293         }
00294         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(*phCommands);
00295     }
00296     <span class="keywordflow">return</span>(fHandleValueChanged);
00297 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="client/ddetrack.c::FreeDDElParam" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY FreeDDElParam           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00642">642</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00048">APIENTRY</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00124">UserGlobalFree</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00190">ClRespAdviseAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00958">ClRespExecuteAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01116">ClRespPokeAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">ClRespRequestData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00719">ClRespUnadviseAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00362">ClSpontAdviseData()</a>, <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00714">DumpDDEMessage()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00666">ReuseDDElParam()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00470">SvRespAdviseDataAck()</a>.
<p>
<pre class="fragment"><div>00645 {
00646     <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00647     <span class="keywordflow">case</span> WM_DDE_ACK:
00648     <span class="keywordflow">case</span> WM_DDE_ADVISE:
00649     <span class="keywordflow">case</span> WM_DDE_DATA:
00650     <span class="keywordflow">case</span> WM_DDE_POKE:
00651         <span class="comment">/*</span>
00652 <span class="comment">         * Do a range check and call GlobalFlags to validate,</span>
00653 <span class="comment">         * just to prevent heap checking from complaining</span>
00654 <span class="comment">         */</span>
00655         <span class="keywordflow">if</span> ((lParam &gt; (LPARAM)0xFFFF) &amp;&amp; GlobalFlags((HANDLE)lParam) != GMEM_INVALID_HANDLE) {
00656             <span class="keywordflow">if</span> (GlobalHandle((HANDLE)lParam))
00657                 <span class="keywordflow">return</span>(<a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>((HANDLE)lParam) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00658         }
00659 
00660     <span class="keywordflow">default</span>:
00661         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00662     }
00663 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="client/ddetrack.c::PackDDElParam" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LPARAM APIENTRY PackDDElParam           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>uiLo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>uiHi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00563">563</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00048">APIENTRY</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00014">tagDDEPACK::uiHi</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00013">tagDDEPACK::uiLo</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00125">UserGlobalAlloc</a>.
<p>
Referenced by <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00666">ReuseDDElParam()</a>.
<p>
<pre class="fragment"><div>00567 {
00568     <a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a> pDdePack;
00569     HANDLE h;
00570 
00571     <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00572     <span class="keywordflow">case</span> WM_DDE_EXECUTE:
00573         <span class="keywordflow">return</span>((LPARAM)uiHi);
00574 
00575     <span class="keywordflow">case</span> WM_DDE_ACK:
00576     <span class="keywordflow">case</span> WM_DDE_ADVISE:
00577     <span class="keywordflow">case</span> WM_DDE_DATA:
00578     <span class="keywordflow">case</span> WM_DDE_POKE:
00579         h = <a class="code" href="../../d6/d0/usercli_8h.html#a3">UserGlobalAlloc</a>(GMEM_DDESHARE | GMEM_FIXED, <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d2/structtagDDEPACK.html">DDEPACK</a>));
00580         pDdePack = (<a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a>)h;
00581         <span class="keywordflow">if</span> (pDdePack == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00582             <span class="keywordflow">return</span>(0);
00583         }
00584         pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o0">uiLo</a> = uiLo;
00585         pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o1">uiHi</a> = uiHi;
00586         <span class="keywordflow">return</span>((LPARAM)h);
00587 
00588     <span class="keywordflow">default</span>:
00589         <span class="keywordflow">return</span>(MAKELONG((WORD)uiLo, (WORD)uiHi));
00590     }
00591 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="client/ddetrack.c::ReuseDDElParam" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LPARAM APIENTRY ReuseDDElParam           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msgIn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msgOut</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>uiLo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>uiHi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00666">666</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00048">APIENTRY</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00642">FreeDDElParam()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00563">PackDDElParam()</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00014">tagDDEPACK::uiHi</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00013">tagDDEPACK::uiLo</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01534">PackAndPostMessage()</a>.
<p>
<pre class="fragment"><div>00672 {
00673     <a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a> pDdePack;
00674 
00675     <span class="keywordflow">switch</span> (msgIn) {
00676     <span class="keywordflow">case</span> WM_DDE_ACK:
00677     <span class="keywordflow">case</span> WM_DDE_DATA:
00678     <span class="keywordflow">case</span> WM_DDE_POKE:
00679     <span class="keywordflow">case</span> WM_DDE_ADVISE:
00680         <span class="comment">//</span>
00681         <span class="comment">// Incoming message was packed...</span>
00682         <span class="comment">//</span>
00683         <span class="keywordflow">switch</span> (msgOut) {
00684         <span class="keywordflow">case</span> WM_DDE_EXECUTE:
00685             <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a>(msgIn, lParam);
00686             <span class="keywordflow">return</span>((LPARAM)uiHi);
00687 
00688         <span class="keywordflow">case</span> WM_DDE_ACK:
00689         <span class="keywordflow">case</span> WM_DDE_ADVISE:
00690         <span class="keywordflow">case</span> WM_DDE_DATA:
00691         <span class="keywordflow">case</span> WM_DDE_POKE:
00692             <span class="comment">/*</span>
00693 <span class="comment">             * This must be a valid handle</span>
00694 <span class="comment">             */</span>
00695             UserAssert(GlobalFlags((HANDLE)lParam) != GMEM_INVALID_HANDLE);
00696             UserAssert(GlobalSize((HANDLE)lParam) == <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d2/structtagDDEPACK.html">DDEPACK</a>));
00697             <span class="comment">//</span>
00698             <span class="comment">// Actual cases where lParam can be reused.</span>
00699             <span class="comment">//</span>
00700             pDdePack = (<a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a>)lParam;
00701             <span class="keywordflow">if</span> (pDdePack == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00702                 <span class="keywordflow">return</span>(0);          <span class="comment">// the only error case</span>
00703             }
00704             pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o0">uiLo</a> = uiLo;
00705             pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o1">uiHi</a> = uiHi;
00706             <span class="keywordflow">return</span>(lParam);
00707 
00708 
00709         <span class="keywordflow">default</span>:
00710             <a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a9">FreeDDElParam</a>(msgIn, lParam);
00711             <span class="keywordflow">return</span>(MAKELONG((WORD)uiLo, (WORD)uiHi));
00712         }
00713 
00714     <span class="keywordflow">default</span>:
00715         <span class="comment">//</span>
00716         <span class="comment">// Incoming message was not packed ==&gt; PackDDElParam()</span>
00717         <span class="comment">//</span>
00718         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d4/client_2ddetrack_8c.html#a7">PackDDElParam</a>(msgOut, uiLo, uiHi));
00719     }
00720 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="client/ddetrack.c::UnpackDDElParam" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL APIENTRY UnpackDDElParam           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PUINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>puiLo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PUINT_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>puiHi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00595">595</a> of file <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html">client/ddetrack.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00048">APIENTRY</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00014">tagDDEPACK::uiHi</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00013">tagDDEPACK::uiLo</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00500">_ClientGetDDEHookData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00190">ClRespAdviseAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00958">ClRespExecuteAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01116">ClRespPokeAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">ClRespRequestData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00719">ClRespUnadviseAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00362">ClSpontAdviseData()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>, <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00714">DumpDDEMessage()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00470">SvRespAdviseDataAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00112">SvSpontAdvise()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01042">SvSpontPoke()</a>.
<p>
<pre class="fragment"><div>00600 {
00601     <a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a> pDdePack;
00602 
00603     <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>) {
00604     <span class="keywordflow">case</span> WM_DDE_EXECUTE:
00605         <span class="keywordflow">if</span> (puiLo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00606             *puiLo = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00607         }
00608         <span class="keywordflow">if</span> (puiHi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00609             *puiHi = (UINT_PTR)lParam;
00610         }
00611         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00612 
00613     <span class="keywordflow">case</span> WM_DDE_ACK:
00614     <span class="keywordflow">case</span> WM_DDE_ADVISE:
00615     <span class="keywordflow">case</span> WM_DDE_DATA:
00616     <span class="keywordflow">case</span> WM_DDE_POKE:
00617         pDdePack = (<a class="code" href="../../d9/d2/structtagDDEPACK.html">PDDEPACK</a>)lParam;
00618         <span class="keywordflow">if</span> (pDdePack == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || !GlobalHandle(pDdePack)) {
00619             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00620         }
00621         <span class="keywordflow">if</span> (puiLo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00622             *puiLo = pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o0">uiLo</a>;
00623         }
00624         <span class="keywordflow">if</span> (puiHi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00625             *puiHi = pDdePack-&gt;<a class="code" href="../../d9/d2/structtagDDEPACK.html#o1">uiHi</a>;
00626         }
00627         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00628 
00629     <span class="keywordflow">default</span>:
00630         <span class="keywordflow">if</span> (puiLo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00631             *puiLo = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)LOWORD(lParam);
00632         }
00633         <span class="keywordflow">if</span> (puiHi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00634             *puiHi = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)HIWORD(lParam);
00635         }
00636         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00637     }
00638 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
