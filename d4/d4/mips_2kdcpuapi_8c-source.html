<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: kdcpuapi.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>kdcpuapi.c</h1><a href="../../d3/d5/mips_2kdcpuapi_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1990  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    kdcpuapi.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implements CPU specific remote debug APIs.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Mark Lucovsky (markl) 04-Sep-1990</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#include "<a class="code" href="../../d1/d7/4_2kdp_8h.html">kdp.h</a>"</span>
00022 
00023 
<a name="l00024"></a><a class="code" href="../../d3/d5/mips_2kdcpuapi_8c.html#a0">00024</a> <span class="preprocessor">#define HEADER_FILE</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#include "kxmips.h"</span>
00026 
00027 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00028"></a><a class="code" href="../../d3/d5/mips_2kdcpuapi_8c.html#a1">00028</a> <a class="code" href="../../d1/d7/4_2kdp_8h.html#a113">KdpSetLoadState</a> (
00029     IN PDBGKD_WAIT_STATE_CHANGE WaitStateChange,
00030     IN PCONTEXT ContextRecord
00031     )
00032 
00033 <span class="comment">/*++</span>
00034 <span class="comment"></span>
00035 <span class="comment">Routine Description:</span>
00036 <span class="comment"></span>
00037 <span class="comment">    Fill in the Wait_State_Change message record for the load symbol case.</span>
00038 <span class="comment"></span>
00039 <span class="comment">Arguments:</span>
00040 <span class="comment"></span>
00041 <span class="comment">    WaitStateChange - Supplies pointer to record to fill in</span>
00042 <span class="comment"></span>
00043 <span class="comment">    ContextRecord - Supplies a pointer to a context record.</span>
00044 <span class="comment"></span>
00045 <span class="comment">Return Value:</span>
00046 <span class="comment"></span>
00047 <span class="comment">    None.</span>
00048 <span class="comment"></span>
00049 <span class="comment">--*/</span>
00050 
00051 {
00052 
00053     ULONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00054     PVOID <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>;
00055 
00056     <span class="comment">//</span>
00057     <span class="comment">// Copy the immediate instruction stream into the control report structure.</span>
00058     <span class="comment">//</span>
00059 
00060     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(&amp;WaitStateChange-&gt;ControlReport.InstructionStream[0],
00061                           WaitStateChange-&gt;ProgramCounter,
00062                           DBGKD_MAXSTREAM);
00063 
00064     WaitStateChange-&gt;ControlReport.InstructionCount = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00065 
00066     <span class="comment">//</span>
00067     <span class="comment">// Clear breakpoints in the copied instruction stream. If any breakpoints</span>
00068     <span class="comment">// are cleared, then recopy the instruction stream.</span>
00069     <span class="comment">//</span>
00070 
00071     <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a> = (PVOID)((PUCHAR)(WaitStateChange-&gt;ProgramCounter) + <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> - 1);
00072     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a106">KdpDeleteBreakpointRange</a>(WaitStateChange-&gt;ProgramCounter, <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00073         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(&amp;WaitStateChange-&gt;ControlReport.InstructionStream[0],
00074                       WaitStateChange-&gt;ProgramCounter,
00075                       <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00076     }
00077 
00078     <span class="comment">//</span>
00079     <span class="comment">// Copy the context record into the wait state change structure.</span>
00080     <span class="comment">//</span>
00081 
00082     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>((PCHAR)&amp;WaitStateChange-&gt;Context,
00083                   (PCHAR)ContextRecord,
00084                   <span class="keyword">sizeof</span>(*ContextRecord));
00085 
00086     <span class="keywordflow">return</span>;
00087 }
00088 
00089 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00090"></a><a class="code" href="../../d3/d5/mips_2kdcpuapi_8c.html#a2">00090</a> <a class="code" href="../../d1/d7/4_2kdp_8h.html#a114">KdpSetStateChange</a> (
00091     IN PDBGKD_WAIT_STATE_CHANGE WaitStateChange,
00092     IN PEXCEPTION_RECORD ExceptionRecord,
00093     IN PCONTEXT ContextRecord,
00094     IN BOOLEAN SecondChance
00095     )
00096 
00097 <span class="comment">/*++</span>
00098 <span class="comment"></span>
00099 <span class="comment">Routine Description:</span>
00100 <span class="comment"></span>
00101 <span class="comment">    Fill in the Wait_State_Change message record.</span>
00102 <span class="comment"></span>
00103 <span class="comment">Arguments:</span>
00104 <span class="comment"></span>
00105 <span class="comment">    WaitStateChange - Supplies pointer to record to fill in</span>
00106 <span class="comment"></span>
00107 <span class="comment">    ExceptionRecord - Supplies a pointer to an exception record.</span>
00108 <span class="comment"></span>
00109 <span class="comment">    ContextRecord - Supplies a pointer to a context record.</span>
00110 <span class="comment"></span>
00111 <span class="comment">    SecondChance - Supplies a boolean value that determines whether this is</span>
00112 <span class="comment">        the first or second chance for the exception.</span>
00113 <span class="comment"></span>
00114 <span class="comment">Return Value:</span>
00115 <span class="comment"></span>
00116 <span class="comment">    None.</span>
00117 <span class="comment"></span>
00118 <span class="comment">--*/</span>
00119 
00120 {
00121 
00122     ULONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00123     PVOID <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>;
00124 
00125     <span class="comment">//</span>
00126     <span class="comment">//  Set up description of event, including exception record</span>
00127     <span class="comment">//</span>
00128 
00129     WaitStateChange-&gt;NewState = DbgKdExceptionStateChange;
00130     WaitStateChange-&gt;ProcessorLevel = <a class="code" href="../../d4/d9/ke_8h.html#a135">KeProcessorLevel</a>;
00131     WaitStateChange-&gt;Processor = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number;
00132     WaitStateChange-&gt;NumberProcessors = (ULONG)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>;
00133     WaitStateChange-&gt;Thread = (PVOID)<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00134     WaitStateChange-&gt;ProgramCounter = (PVOID)CONTEXT_TO_PROGRAM_COUNTER(ContextRecord);
00135     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a111">KdpQuickMoveMemory</a>((PCHAR)&amp;WaitStateChange-&gt;u.Exception.ExceptionRecord,
00136                        (PCHAR)ExceptionRecord,
00137                        <span class="keyword">sizeof</span>(EXCEPTION_RECORD));
00138 
00139     WaitStateChange-&gt;u.Exception.FirstChance = !SecondChance;
00140 
00141     <span class="comment">//</span>
00142     <span class="comment">// Copy the immediate instruction stream into the control report structure.</span>
00143     <span class="comment">//</span>
00144 
00145     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(&amp;WaitStateChange-&gt;ControlReport.InstructionStream[0],
00146                           WaitStateChange-&gt;ProgramCounter,
00147                           DBGKD_MAXSTREAM);
00148 
00149     WaitStateChange-&gt;ControlReport.InstructionCount = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00150 
00151     <span class="comment">//</span>
00152     <span class="comment">// Clear breakpoints in the copied instruction stream. If any breakpoints</span>
00153     <span class="comment">// are cleared, then recopy the instruction stream.</span>
00154     <span class="comment">//</span>
00155 
00156     <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a> = (PVOID)((PUCHAR)(WaitStateChange-&gt;ProgramCounter) + <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> - 1);
00157     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a106">KdpDeleteBreakpointRange</a>(WaitStateChange-&gt;ProgramCounter, <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00158         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(&amp;WaitStateChange-&gt;ControlReport.InstructionStream[0],
00159                       WaitStateChange-&gt;ProgramCounter,
00160                       <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00161     }
00162 
00163     <span class="comment">//</span>
00164     <span class="comment">// Copy the context record into the wait state change structure.</span>
00165     <span class="comment">//</span>
00166 
00167     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>((PCHAR)&amp;WaitStateChange-&gt;Context,
00168                   (PCHAR)ContextRecord,
00169                   <span class="keyword">sizeof</span>(*ContextRecord));
00170 
00171     <span class="keywordflow">return</span>;
00172 }
00173 
00174 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00175"></a><a class="code" href="../../d3/d5/mips_2kdcpuapi_8c.html#a3">00175</a> <a class="code" href="../../d1/d7/4_2kdp_8h.html#a115">KdpGetStateChange</a> (
00176     IN PDBGKD_MANIPULATE_STATE ManipulateState,
00177     IN PCONTEXT ContextRecord
00178     )
00179 
00180 <span class="comment">/*++</span>
00181 <span class="comment"></span>
00182 <span class="comment">Routine Description:</span>
00183 <span class="comment"></span>
00184 <span class="comment">    Extract continuation control data from Manipulate_State message</span>
00185 <span class="comment"></span>
00186 <span class="comment">    N.B. This is a noop for MIPS.</span>
00187 <span class="comment"></span>
00188 <span class="comment">Arguments:</span>
00189 <span class="comment"></span>
00190 <span class="comment">    ManipulateState - supplies pointer to Manipulate_State packet</span>
00191 <span class="comment"></span>
00192 <span class="comment">    ContextRecord - Supplies a pointer to a context record.</span>
00193 <span class="comment"></span>
00194 <span class="comment">Return Value:</span>
00195 <span class="comment"></span>
00196 <span class="comment">    None.</span>
00197 <span class="comment"></span>
00198 <span class="comment">--*/</span>
00199 
00200 {
00201 }
00202 
00203 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00204"></a><a class="code" href="../../d3/d5/mips_2kdcpuapi_8c.html#a4">00204</a> <a class="code" href="../../d1/d7/4_2kdp_8h.html#a132">KdpReadControlSpace</a> (
00205     IN PDBGKD_MANIPULATE_STATE m,
00206     IN PSTRING AdditionalData,
00207     IN PCONTEXT Context
00208     )
00209 
00210 <span class="comment">/*++</span>
00211 <span class="comment"></span>
00212 <span class="comment">Routine Description:</span>
00213 <span class="comment"></span>
00214 <span class="comment">    This function is called in response of a read control space state</span>
00215 <span class="comment">    manipulation message.  Its function is to read implementation</span>
00216 <span class="comment">    specific system data.</span>
00217 <span class="comment"></span>
00218 <span class="comment">Arguments:</span>
00219 <span class="comment"></span>
00220 <span class="comment">    m - Supplies the state manipulation message.</span>
00221 <span class="comment"></span>
00222 <span class="comment">    AdditionalData - Supplies any additional data for the message.</span>
00223 <span class="comment"></span>
00224 <span class="comment">    Context - Supplies the current context.</span>
00225 <span class="comment"></span>
00226 <span class="comment">Return Value:</span>
00227 <span class="comment"></span>
00228 <span class="comment">    None.</span>
00229 <span class="comment"></span>
00230 <span class="comment">--*/</span>
00231 
00232 {
00233 
00234     PDBGKD_READ_MEMORY a = &amp;m-&gt;u.ReadMemory;
00235     ULONG Length;
00236     STRING MessageHeader;
00237     ULONG NumberOfEntries;
00238     ULONG StartingEntry;
00239     PULONG EntryBuffer;
00240     PKPRCB Prcb;
00241     PTB_ENTRY TbEntry;
00242 
00243     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00244     MessageHeader.Buffer = (PCHAR)m;
00245 
00246     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
00247 
00248     <span class="keywordflow">if</span> (a-&gt;TransferCount &gt; (PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE))) {
00249         Length = PACKET_MAX_SIZE - <span class="keyword">sizeof</span>(DBGKD_MANIPULATE_STATE);
00250 
00251     } <span class="keywordflow">else</span> {
00252         Length = a-&gt;TransferCount;
00253     }
00254 
00255     <span class="comment">//</span>
00256     <span class="comment">// Case on address to determine what part of Control space is being read.</span>
00257     <span class="comment">//</span>
00258 
00259     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<span class="keyword">sizeof</span>(PVOID) == <span class="keyword">sizeof</span>(ULONG));
00260     <span class="keywordflow">if</span> ( (ULONG)a-&gt;TargetBaseAddress &gt;= 0 &amp;&amp;
00261          (ULONG)a-&gt;TargetBaseAddress &lt; KeNumberTbEntries &amp;&amp;
00262          (m-&gt;Processor &lt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a> )) {
00263 
00264         <span class="comment">//</span>
00265         <span class="comment">// Read TB entries.</span>
00266         <span class="comment">//</span>
00267 
00268         NumberOfEntries = Length / <span class="keyword">sizeof</span>(TB_ENTRY);
00269         StartingEntry = (ULONG)a-&gt;TargetBaseAddress;
00270 
00271         <span class="comment">//</span>
00272         <span class="comment">// Trim number of entries to tb range</span>
00273         <span class="comment">//</span>
00274 
00275         <span class="keywordflow">if</span> (StartingEntry + NumberOfEntries &gt; KeNumberTbEntries) {
00276             NumberOfEntries = KeNumberTbEntries - StartingEntry;
00277         }
00278 
00279         AdditionalData-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(NumberOfEntries * <span class="keyword">sizeof</span>(TB_ENTRY));
00280         EntryBuffer = (PULONG)AdditionalData-&gt;Buffer;
00281         Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[m-&gt;Processor];
00282         TbEntry = &amp;Prcb-&gt;ProcessorState.TbEntry[0];
00283         <span class="keywordflow">while</span> (NumberOfEntries--) {
00284             *(PENTRYLO)EntryBuffer++ = TbEntry[StartingEntry].Entrylo0;
00285             *(PENTRYLO)EntryBuffer++ = TbEntry[StartingEntry].Entrylo1;
00286             *(PENTRYHI)EntryBuffer++ = TbEntry[StartingEntry].Entryhi;
00287             *(PPAGEMASK)EntryBuffer++ = TbEntry[StartingEntry].Pagemask;
00288             StartingEntry += 1;
00289         }
00290 
00291         m-&gt;ReturnStatus = STATUS_SUCCESS;
00292         a-&gt;ActualBytesRead = AdditionalData-&gt;Length;
00293 
00294     } <span class="keywordflow">else</span> {
00295 
00296         <span class="comment">//</span>
00297         <span class="comment">// Uninterpreted Special Space</span>
00298         <span class="comment">//</span>
00299 
00300         AdditionalData-&gt;Length = 0;
00301         m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
00302         a-&gt;ActualBytesRead = 0;
00303     }
00304 
00305     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00306         PACKET_TYPE_KD_STATE_MANIPULATE,
00307         &amp;MessageHeader,
00308         AdditionalData
00309         );
00310 }
00311 
00312 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00313"></a><a class="code" href="../../d3/d5/mips_2kdcpuapi_8c.html#a5">00313</a> <a class="code" href="../../d1/d7/4_2kdp_8h.html#a133">KdpWriteControlSpace</a> (
00314     IN PDBGKD_MANIPULATE_STATE m,
00315     IN PSTRING AdditionalData,
00316     IN PCONTEXT Context
00317     )
00318 
00319 <span class="comment">/*++</span>
00320 <span class="comment"></span>
00321 <span class="comment">Routine Description:</span>
00322 <span class="comment"></span>
00323 <span class="comment">    This function is called in response of a write control space state</span>
00324 <span class="comment">    manipulation message.  Its function is to write implementation</span>
00325 <span class="comment">    specific system data.</span>
00326 <span class="comment"></span>
00327 <span class="comment">Arguments:</span>
00328 <span class="comment"></span>
00329 <span class="comment">    m - Supplies the state manipulation message.</span>
00330 <span class="comment"></span>
00331 <span class="comment">    AdditionalData - Supplies any additional data for the message.</span>
00332 <span class="comment"></span>
00333 <span class="comment">    Context - Supplies the current context.</span>
00334 <span class="comment"></span>
00335 <span class="comment">Return Value:</span>
00336 <span class="comment"></span>
00337 <span class="comment">    None.</span>
00338 <span class="comment"></span>
00339 <span class="comment">--*/</span>
00340 
00341 {
00342     PDBGKD_WRITE_MEMORY a = &amp;m-&gt;u.WriteMemory;
00343     STRING MessageHeader;
00344 
00345     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00346     MessageHeader.Buffer = (PCHAR)m;
00347 
00348     AdditionalData-&gt;Length = 0;
00349     m-&gt;ReturnStatus = STATUS_UNSUCCESSFUL;
00350     a-&gt;ActualBytesWritten = 0;
00351 
00352     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00353         PACKET_TYPE_KD_STATE_MANIPULATE,
00354         &amp;MessageHeader,
00355         AdditionalData
00356         );
00357 }
00358 
00359 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00360"></a><a class="code" href="../../d3/d5/mips_2kdcpuapi_8c.html#a6">00360</a> <a class="code" href="../../d1/d7/4_2kdp_8h.html#a134">KdpReadIoSpace</a> (
00361     IN PDBGKD_MANIPULATE_STATE m,
00362     IN PSTRING AdditionalData,
00363     IN PCONTEXT Context
00364     )
00365 
00366 <span class="comment">/*++</span>
00367 <span class="comment"></span>
00368 <span class="comment">Routine Description:</span>
00369 <span class="comment"></span>
00370 <span class="comment">    This function is called in response of a read io space state</span>
00371 <span class="comment">    manipulation message.  Its function is to read system io</span>
00372 <span class="comment">    locations.</span>
00373 <span class="comment"></span>
00374 <span class="comment">Arguments:</span>
00375 <span class="comment"></span>
00376 <span class="comment">    m - Supplies the state manipulation message.</span>
00377 <span class="comment"></span>
00378 <span class="comment">    AdditionalData - Supplies any additional data for the message.</span>
00379 <span class="comment"></span>
00380 <span class="comment">    Context - Supplies the current context.</span>
00381 <span class="comment"></span>
00382 <span class="comment">Return Value:</span>
00383 <span class="comment"></span>
00384 <span class="comment">    None.</span>
00385 <span class="comment"></span>
00386 <span class="comment">--*/</span>
00387 
00388 {
00389     PDBGKD_READ_WRITE_IO a = &amp;m-&gt;u.ReadWriteIo;
00390     STRING MessageHeader;
00391     PUCHAR b;
00392     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a> s;
00393     PULONG l;
00394 
00395     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00396     MessageHeader.Buffer = (PCHAR)m;
00397 
00398     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
00399 
00400     m-&gt;ReturnStatus = STATUS_SUCCESS;
00401 
00402     <span class="comment">//</span>
00403     <span class="comment">// Check Size and Alignment</span>
00404     <span class="comment">//</span>
00405 
00406     <span class="keywordflow">switch</span> ( a-&gt;DataSize ) {
00407         <span class="keywordflow">case</span> 1:
00408             b = (PUCHAR)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>(a-&gt;IoAddress);
00409             <span class="keywordflow">if</span> ( b ) {
00410                 a-&gt;DataValue = (ULONG)*b;
00411             } <span class="keywordflow">else</span> {
00412                 m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00413             }
00414             <span class="keywordflow">break</span>;
00415         <span class="keywordflow">case</span> 2:
00416             <span class="keywordflow">if</span> ((ULONG)a-&gt;IoAddress &amp; 1 ) {
00417                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
00418             } <span class="keywordflow">else</span> {
00419                 s = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>(a-&gt;IoAddress);
00420                 <span class="keywordflow">if</span> ( s ) {
00421                     a-&gt;DataValue = (ULONG)*s;
00422                 } <span class="keywordflow">else</span> {
00423                     m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00424                 }
00425             }
00426             <span class="keywordflow">break</span>;
00427         <span class="keywordflow">case</span> 4:
00428             <span class="keywordflow">if</span> ((ULONG)a-&gt;IoAddress &amp; 3 ) {
00429                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
00430             } <span class="keywordflow">else</span> {
00431                 l = (PULONG)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a0">MmDbgReadCheck</a>(a-&gt;IoAddress);
00432                 <span class="keywordflow">if</span> ( l ) {
00433                     a-&gt;DataValue = (ULONG)*l;
00434                 } <span class="keywordflow">else</span> {
00435                     m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00436                 }
00437             }
00438             <span class="keywordflow">break</span>;
00439         <span class="keywordflow">default</span>:
00440             m-&gt;ReturnStatus = STATUS_INVALID_PARAMETER;
00441     }
00442 
00443     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00444         PACKET_TYPE_KD_STATE_MANIPULATE,
00445         &amp;MessageHeader,
00446         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00447         );
00448 }
00449 
00450 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00451"></a><a class="code" href="../../d3/d5/mips_2kdcpuapi_8c.html#a7">00451</a> <a class="code" href="../../d1/d7/4_2kdp_8h.html#a136">KdpWriteIoSpace</a> (
00452     IN PDBGKD_MANIPULATE_STATE m,
00453     IN PSTRING AdditionalData,
00454     IN PCONTEXT Context
00455     )
00456 
00457 <span class="comment">/*++</span>
00458 <span class="comment"></span>
00459 <span class="comment">Routine Description:</span>
00460 <span class="comment"></span>
00461 <span class="comment">    This function is called in response of a write io space state</span>
00462 <span class="comment">    manipulation message.  Its function is to write to system io</span>
00463 <span class="comment">    locations.</span>
00464 <span class="comment"></span>
00465 <span class="comment">Arguments:</span>
00466 <span class="comment"></span>
00467 <span class="comment">    m - Supplies the state manipulation message.</span>
00468 <span class="comment"></span>
00469 <span class="comment">    AdditionalData - Supplies any additional data for the message.</span>
00470 <span class="comment"></span>
00471 <span class="comment">    Context - Supplies the current context.</span>
00472 <span class="comment"></span>
00473 <span class="comment">Return Value:</span>
00474 <span class="comment"></span>
00475 <span class="comment">    None.</span>
00476 <span class="comment"></span>
00477 <span class="comment">--*/</span>
00478 
00479 {
00480     PDBGKD_READ_WRITE_IO a = &amp;m-&gt;u.ReadWriteIo;
00481     STRING MessageHeader;
00482     PUCHAR b;
00483     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a> s;
00484     PULONG l;
00485 
00486     MessageHeader.Length = <span class="keyword">sizeof</span>(*m);
00487     MessageHeader.Buffer = (PCHAR)m;
00488 
00489     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(AdditionalData-&gt;Length == 0);
00490 
00491     m-&gt;ReturnStatus = STATUS_SUCCESS;
00492 
00493     <span class="comment">//</span>
00494     <span class="comment">// Check Size and Alignment</span>
00495     <span class="comment">//</span>
00496 
00497     <span class="keywordflow">switch</span> ( a-&gt;DataSize ) {
00498         <span class="keywordflow">case</span> 1:
00499             b = (PUCHAR)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a1">MmDbgWriteCheck</a>(a-&gt;IoAddress);
00500             <span class="keywordflow">if</span> ( b ) {
00501                 WRITE_REGISTER_UCHAR(b,(UCHAR)a-&gt;DataValue);
00502             } <span class="keywordflow">else</span> {
00503                 m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00504             }
00505             <span class="keywordflow">break</span>;
00506         <span class="keywordflow">case</span> 2:
00507             <span class="keywordflow">if</span> ((ULONG)a-&gt;IoAddress &amp; 1 ) {
00508                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
00509             } <span class="keywordflow">else</span> {
00510                 s = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a1">MmDbgWriteCheck</a>(a-&gt;IoAddress);
00511                 <span class="keywordflow">if</span> ( s ) {
00512                     WRITE_REGISTER_USHORT(s,(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)a-&gt;DataValue);
00513                 } <span class="keywordflow">else</span> {
00514                     m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00515                 }
00516             }
00517             <span class="keywordflow">break</span>;
00518         <span class="keywordflow">case</span> 4:
00519             <span class="keywordflow">if</span> ((ULONG)a-&gt;IoAddress &amp; 3 ) {
00520                 m-&gt;ReturnStatus = STATUS_DATATYPE_MISALIGNMENT;
00521             } <span class="keywordflow">else</span> {
00522                 l = (PULONG)<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a1">MmDbgWriteCheck</a>(a-&gt;IoAddress);
00523                 <span class="keywordflow">if</span> ( l ) {
00524                     WRITE_REGISTER_ULONG(l,a-&gt;DataValue);
00525                 } <span class="keywordflow">else</span> {
00526                     m-&gt;ReturnStatus = STATUS_ACCESS_VIOLATION;
00527                 }
00528             }
00529             <span class="keywordflow">break</span>;
00530         <span class="keywordflow">default</span>:
00531             m-&gt;ReturnStatus = STATUS_INVALID_PARAMETER;
00532     }
00533 
00534     <a class="code" href="../../d1/d7/4_2kdp_8h.html#a116">KdpSendPacket</a>(
00535         PACKET_TYPE_KD_STATE_MANIPULATE,
00536         &amp;MessageHeader,
00537         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00538         );
00539 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:34 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
