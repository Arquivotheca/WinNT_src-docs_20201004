<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: flush.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>flush.c</h1><a href="../../d3/d5/ppc_2flush_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1990  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    flush.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implements PowerPc machine dependent kernel functions to flush</span>
00012 <span class="comment">    the data and instruction caches and to flush I/O buffers.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    David N. Cutler (davec) 26-Apr-1990</span>
00017 <span class="comment"></span>
00018 <span class="comment">Modified by:</span>
00019 <span class="comment"></span>
00020 <span class="comment">    Pat Carr (patcarr@pets.sps.mot.com) 15-Aug-1994</span>
00021 <span class="comment"></span>
00022 <span class="comment">Environment:</span>
00023 <span class="comment"></span>
00024 <span class="comment">    Kernel mode only.</span>
00025 <span class="comment"></span>
00026 <span class="comment">Revision History:</span>
00027 <span class="comment"></span>
00028 <span class="comment">--*/</span>
00029 
00030 <span class="preprocessor">#include "<a class="code" href="../../d0/d0/ki_8h.html">ki.h</a>"</span>
00031 
00032 <span class="comment">//</span>
00033 <span class="comment">// Define forward referenced prototyes.</span>
00034 <span class="comment">//</span>
00035 
00036 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00037 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a0">KiChangeColorPageTarget</a> (
00038     IN PULONG SignalDone,
00039     IN PVOID NewColor,
00040     IN PVOID OldColor,
00041     IN PVOID PageFrame
00042     );
00043 
00044 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00045 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a1">KiSweepDcacheTarget</a> (
00046     IN PULONG SignalDone,
00047     IN PVOID Parameter1,
00048     IN PVOID Parameter2,
00049     IN PVOID Parameter3
00050     );
00051 
00052 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00053 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a2">KiSweepIcacheTarget</a> (
00054     IN PULONG SignalDone,
00055     IN PVOID Parameter1,
00056     IN PVOID Parameter2,
00057     IN PVOID Parameter3
00058     );
00059 
00060 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00061 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a3">KiSweepIcacheRangeTarget</a> (
00062     IN PULONG SignalDone,
00063     IN PVOID BaseAddress,
00064     IN PVOID Length,
00065     IN PVOID Parameter3
00066     );
00067 
00068 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00069 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a4">KiFlushIoBuffersTarget</a> (
00070     IN PULONG SignalDone,
00071     IN PVOID Mdl,
00072     IN PVOID ReadOperation,
00073     IN PVOID DmaOperation
00074     );
00075 
00076 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00077"></a><a class="code" href="../../d3/d5/ppc_2flush_8c.html#a5">00077</a> <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a5">KeChangeColorPage</a> (
00078     IN PVOID NewColor,
00079     IN PVOID OldColor,
00080     IN ULONG PageFrame
00081     )
00082 
00083 <span class="comment">/*++</span>
00084 <span class="comment"></span>
00085 <span class="comment">Routine Description:</span>
00086 <span class="comment"></span>
00087 <span class="comment">    This routine changes the color of a page.</span>
00088 <span class="comment"></span>
00089 <span class="comment">Arguments:</span>
00090 <span class="comment"></span>
00091 <span class="comment">    NewColor - Supplies the page aligned virtual address of the new color</span>
00092 <span class="comment">        the page to change.</span>
00093 <span class="comment"></span>
00094 <span class="comment">    OldColor - Supplies the page aligned virtual address of the old color</span>
00095 <span class="comment">        of the page to change.</span>
00096 <span class="comment"></span>
00097 <span class="comment">    PageFrame - Supplies the page frame number of the page that is changed.</span>
00098 <span class="comment"></span>
00099 <span class="comment">Return Value:</span>
00100 <span class="comment"></span>
00101 <span class="comment">    None.</span>
00102 <span class="comment"></span>
00103 <span class="comment">--*/</span>
00104 
00105 {
00106     KIRQL OldIrql;
00107     KAFFINITY TargetProcessors;
00108 
00109     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= <a class="code" href="../../d6/d7/halmips_8h.html#a58">SYNCH_LEVEL</a>);
00110 
00111     <span class="comment">//</span>
00112     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00113     <span class="comment">//</span>
00114 
00115 <span class="preprocessor">#if !defined(NT_UP)</span>
00116 <span class="preprocessor"></span>
00117     OldIrql = KeRaiseIrqlToSynchLevel();
00118 
00119     <span class="comment">//</span>
00120     <span class="comment">// Compute the set of target processors and send the change color</span>
00121     <span class="comment">// parameters to the target processors, if any, for execution.</span>
00122     <span class="comment">//</span>
00123 
00124     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00125     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00126         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00127                         <a class="code" href="../../d2/d5/mips_2flush_8c.html#a1">KiChangeColorPageTarget</a>,
00128                         (PVOID)NewColor,
00129                         (PVOID)OldColor,
00130                         (PVOID)PageFrame);
00131     }
00132 
00133 <span class="preprocessor">#endif</span>
00134 <span class="preprocessor"></span>
00135 <span class="preprocessor">#ifdef COLORED_PAGES</span>
00136 <span class="preprocessor"></span>    <span class="comment">//</span>
00137     <span class="comment">// Change the color of the page on the current processor.</span>
00138     <span class="comment">//</span>
00139 
00140     HalChangeColorPage(NewColor, OldColor, PageFrame);
00141 
00142 <span class="preprocessor">#endif</span>
00143 <span class="preprocessor"></span>
00144     <span class="comment">//</span>
00145     <span class="comment">// Wait until all target processors have finished changing the color</span>
00146     <span class="comment">// of the page.</span>
00147     <span class="comment">//</span>
00148 
00149 <span class="preprocessor">#if !defined(NT_UP)</span>
00150 <span class="preprocessor"></span>
00151     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00152         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00153     }
00154 
00155     <span class="comment">//</span>
00156     <span class="comment">// Lower IRQL to its previous level and return.</span>
00157     <span class="comment">//</span>
00158 
00159     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00160 
00161 <span class="preprocessor">#endif</span>
00162 <span class="preprocessor"></span>
00163     <span class="keywordflow">return</span>;
00164 }
00165 
00166 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00167 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a0">KiChangeColorPageTarget</a> (
00168     IN PULONG SignalDone,
00169     IN PVOID NewColor,
00170     IN PVOID OldColor,
00171     IN PVOID PageFrame
00172     )
00173 
00174 <span class="comment">/*++</span>
00175 <span class="comment"></span>
00176 <span class="comment">Routine Description:</span>
00177 <span class="comment"></span>
00178 <span class="comment">    This is the target function for changing the color of a page.</span>
00179 <span class="comment"></span>
00180 <span class="comment">Arguments:</span>
00181 <span class="comment"></span>
00182 <span class="comment">    SignalDone Supplies a pointer to a variable that is cleared when the</span>
00183 <span class="comment">        requested operation has been performed.</span>
00184 <span class="comment"></span>
00185 <span class="comment">    NewColor - Supplies the page aligned virtual address of the new color</span>
00186 <span class="comment">        the page to change.</span>
00187 <span class="comment"></span>
00188 <span class="comment">    OldColor - Supplies the page aligned virtual address of the old color</span>
00189 <span class="comment">        of the page to change.</span>
00190 <span class="comment"></span>
00191 <span class="comment">    PageFrame - Supplies the page frame number of the page that is changed.</span>
00192 <span class="comment"></span>
00193 <span class="comment">Return Value:</span>
00194 <span class="comment"></span>
00195 <span class="comment">    None.</span>
00196 <span class="comment"></span>
00197 <span class="comment">--*/</span>
00198 
00199 {
00200 
00201     <span class="comment">//</span>
00202     <span class="comment">// Change the color of the page on the current processor and clear</span>
00203     <span class="comment">// change color packet address to signal the source to continue.</span>
00204     <span class="comment">//</span>
00205 
00206 <span class="preprocessor">#if !defined(NT_UP)</span>
00207 <span class="preprocessor"></span>
00208 <span class="preprocessor">#ifdef COLORED_PAGES</span>
00209 <span class="preprocessor"></span>    HalChangeColorPage(NewColor, OldColor, (ULONG)PageFrame);
00210 <span class="preprocessor">#endif</span>
00211 <span class="preprocessor"></span>
00212     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00213 
00214 <span class="preprocessor">#endif</span>
00215 <span class="preprocessor"></span>
00216     <span class="keywordflow">return</span>;
00217 }
00218 
00219 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00220"></a><a class="code" href="../../d3/d5/ppc_2flush_8c.html#a6">00220</a> <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a6">KeSweepDcache</a> (
00221     IN BOOLEAN AllProcessors
00222     )
00223 
00224 <span class="comment">/*++</span>
00225 <span class="comment"></span>
00226 <span class="comment">Routine Description:</span>
00227 <span class="comment"></span>
00228 <span class="comment">    This function flushes the data cache on all processors that are currently</span>
00229 <span class="comment">    running threads which are children of the current process or flushes the</span>
00230 <span class="comment">    data cache on all processors in the host configuration.</span>
00231 <span class="comment"></span>
00232 <span class="comment">    N.B. PowerPC maintains cache coherency across processors however</span>
00233 <span class="comment">    in this routine, the range of addresses being flushed is unknown</span>
00234 <span class="comment">    so we must still broadcast the request to the other processors.</span>
00235 <span class="comment"></span>
00236 <span class="comment">Arguments:</span>
00237 <span class="comment"></span>
00238 <span class="comment">    AllProcessors - Supplies a boolean value that determines which data</span>
00239 <span class="comment">        caches are flushed.</span>
00240 <span class="comment"></span>
00241 <span class="comment">Return Value:</span>
00242 <span class="comment"></span>
00243 <span class="comment">    None.</span>
00244 <span class="comment"></span>
00245 <span class="comment">--*/</span>
00246 
00247 {
00248 
00249     KIRQL OldIrql;
00250     KAFFINITY TargetProcessors;
00251 
00252     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= <a class="code" href="../../d6/d7/halmips_8h.html#a58">SYNCH_LEVEL</a>);
00253 
00254     <span class="comment">//</span>
00255     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00256     <span class="comment">//</span>
00257 
00258 <span class="preprocessor">#if !defined(NT_UP)</span>
00259 <span class="preprocessor"></span>
00260     OldIrql = KeRaiseIrqlToSynchLevel();
00261 
00262     <span class="comment">//</span>
00263     <span class="comment">// Compute the set of target processors and send the sweep parameters</span>
00264     <span class="comment">// to the target processors, if any, for execution.</span>
00265     <span class="comment">//</span>
00266 
00267     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00268     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00269         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00270                         <a class="code" href="../../d9/d4/alpha_2flush_8c.html#a1">KiSweepDcacheTarget</a>,
00271                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00272                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00273                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00274     }
00275 
00276 <span class="preprocessor">#endif</span>
00277 <span class="preprocessor"></span>
00278     <span class="comment">//</span>
00279     <span class="comment">// Sweep the data cache on the current processor.</span>
00280     <span class="comment">//</span>
00281 
00282     HalSweepDcache();
00283 
00284     <span class="comment">//</span>
00285     <span class="comment">// Wait until all target processors have finished sweeping the their</span>
00286     <span class="comment">// data cache.</span>
00287     <span class="comment">//</span>
00288 
00289 <span class="preprocessor">#if !defined(NT_UP)</span>
00290 <span class="preprocessor"></span>
00291     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00292         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00293     }
00294 
00295     <span class="comment">//</span>
00296     <span class="comment">// Lower IRQL to its previous level and return.</span>
00297     <span class="comment">//</span>
00298 
00299     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00300 
00301 <span class="preprocessor">#endif</span>
00302 <span class="preprocessor"></span>
00303     <span class="keywordflow">return</span>;
00304 }
00305 
00306 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00307 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a1">KiSweepDcacheTarget</a> (
00308     IN PULONG SignalDone,
00309     IN PVOID Parameter1,
00310     IN PVOID Parameter2,
00311     IN PVOID Parameter3
00312     )
00313 
00314 <span class="comment">/*++</span>
00315 <span class="comment"></span>
00316 <span class="comment">Routine Description:</span>
00317 <span class="comment"></span>
00318 <span class="comment">    This is the target function for sweeping the data cache on target</span>
00319 <span class="comment">    processors.</span>
00320 <span class="comment"></span>
00321 <span class="comment">    N.B. PowerPC maintains cache coherency in the D-Cache across all</span>
00322 <span class="comment">    processors.   This routine should not be used but is here in case</span>
00323 <span class="comment">    it actually is used.</span>
00324 <span class="comment"></span>
00325 <span class="comment">Arguments:</span>
00326 <span class="comment"></span>
00327 <span class="comment">    SignalDone Supplies a pointer to a variable that is cleared when the</span>
00328 <span class="comment">        requested operation has been performed.</span>
00329 <span class="comment"></span>
00330 <span class="comment">    Parameter1 - Parameter3 - Not used.</span>
00331 <span class="comment"></span>
00332 <span class="comment">Return Value:</span>
00333 <span class="comment"></span>
00334 <span class="comment">    None.</span>
00335 <span class="comment"></span>
00336 <span class="comment">--*/</span>
00337 
00338 {
00339 
00340     <span class="comment">//</span>
00341     <span class="comment">// Sweep the data cache on the current processor and clear the sweep</span>
00342     <span class="comment">// data cache packet address to signal the source to continue.</span>
00343     <span class="comment">//</span>
00344 
00345 <span class="preprocessor">#if !defined(NT_UP)</span>
00346 <span class="preprocessor"></span>
00347     HalSweepDcache();
00348     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00349 
00350 <span class="preprocessor">#endif</span>
00351 <span class="preprocessor"></span>
00352     <span class="keywordflow">return</span>;
00353 }
00354 
00355 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00356"></a><a class="code" href="../../d3/d5/ppc_2flush_8c.html#a7">00356</a> <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a7">KeSweepIcache</a> (
00357     IN BOOLEAN AllProcessors
00358     )
00359 
00360 <span class="comment">/*++</span>
00361 <span class="comment"></span>
00362 <span class="comment">Routine Description:</span>
00363 <span class="comment"></span>
00364 <span class="comment">    This function flushes the instruction cache on all processors that are</span>
00365 <span class="comment">    currently running threads which are children of the current process or</span>
00366 <span class="comment">    flushes the instruction cache on all processors in the host configuration.</span>
00367 <span class="comment"></span>
00368 <span class="comment">    N.B. Although PowerPC maintains cache coherency across processors, we</span>
00369 <span class="comment">    use the flash invalidate function (h/w) for I-Cache sweeps which doesn't</span>
00370 <span class="comment">    maintain coherency so we still do the MP I-Cache flush in s/w.   plj.</span>
00371 <span class="comment"></span>
00372 <span class="comment">Arguments:</span>
00373 <span class="comment"></span>
00374 <span class="comment">    AllProcessors - Supplies a boolean value that determines which instruction</span>
00375 <span class="comment">        caches are flushed.</span>
00376 <span class="comment"></span>
00377 <span class="comment">Return Value:</span>
00378 <span class="comment"></span>
00379 <span class="comment">    None.</span>
00380 <span class="comment"></span>
00381 <span class="comment">--*/</span>
00382 
00383 {
00384 
00385     KIRQL OldIrql;
00386     KAFFINITY TargetProcessors;
00387 
00388     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= <a class="code" href="../../d6/d7/halmips_8h.html#a58">SYNCH_LEVEL</a>);
00389 
00390     <span class="comment">//</span>
00391     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00392     <span class="comment">//</span>
00393 
00394 <span class="preprocessor">#if !defined(NT_UP)</span>
00395 <span class="preprocessor"></span>
00396     OldIrql = KeRaiseIrqlToSynchLevel();
00397 
00398     <span class="comment">//</span>
00399     <span class="comment">// Compute the set of target processors and send the sweep parameters</span>
00400     <span class="comment">// to the target processors, if any, for execution.</span>
00401     <span class="comment">//</span>
00402 
00403     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00404     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00405         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00406                         <a class="code" href="../../d9/d4/alpha_2flush_8c.html#a2">KiSweepIcacheTarget</a>,
00407                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00408                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00409                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00410     }
00411 
00412 <span class="preprocessor">#endif</span>
00413 <span class="preprocessor"></span>
00414     <span class="comment">//</span>
00415     <span class="comment">// Sweep the instruction cache on the current processor.</span>
00416     <span class="comment">//</span>
00417     <span class="comment">// If the processor is not a 601, flush the data cache first.</span>
00418     <span class="comment">//</span>
00419 
00420     <span class="keywordflow">if</span> ( ( (KeGetPvr() &gt;&gt; 16 ) &amp; 0xffff ) &gt; 1 ) {
00421         HalSweepDcache();
00422     }
00423 
00424     HalSweepIcache();
00425 
00426     <span class="comment">//</span>
00427     <span class="comment">// Wait until all target processors have finished sweeping their</span>
00428     <span class="comment">// instruction caches.</span>
00429     <span class="comment">//</span>
00430 
00431 <span class="preprocessor">#if !defined(NT_UP)</span>
00432 <span class="preprocessor"></span>
00433     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00434         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00435     }
00436 
00437     <span class="comment">//</span>
00438     <span class="comment">// Lower IRQL to its previous level and return.</span>
00439     <span class="comment">//</span>
00440 
00441     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00442 
00443 <span class="preprocessor">#endif</span>
00444 <span class="preprocessor"></span>
00445     <span class="keywordflow">return</span>;
00446 }
00447 
00448 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00449 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a2">KiSweepIcacheTarget</a> (
00450     IN PULONG SignalDone,
00451     IN PVOID Parameter1,
00452     IN PVOID Parameter2,
00453     IN PVOID Parameter3
00454     )
00455 
00456 <span class="comment">/*++</span>
00457 <span class="comment"></span>
00458 <span class="comment">Routine Description:</span>
00459 <span class="comment"></span>
00460 <span class="comment">    This is the target function for sweeping the instruction cache on</span>
00461 <span class="comment">    target processors.</span>
00462 <span class="comment"></span>
00463 <span class="comment">Arguments:</span>
00464 <span class="comment"></span>
00465 <span class="comment">    SignalDone Supplies a pointer to a variable that is cleared when the</span>
00466 <span class="comment">        requested operation has been performed.</span>
00467 <span class="comment"></span>
00468 <span class="comment">    Parameter1 - Parameter3 - Not used.</span>
00469 <span class="comment"></span>
00470 <span class="comment">Return Value:</span>
00471 <span class="comment"></span>
00472 <span class="comment">    None.</span>
00473 <span class="comment"></span>
00474 <span class="comment">--*/</span>
00475 
00476 {
00477 
00478     <span class="comment">//</span>
00479     <span class="comment">// Sweep the instruction cache on the current processor and clear</span>
00480     <span class="comment">// the sweep instruction cache packet address to signal the source</span>
00481     <span class="comment">// to continue.</span>
00482     <span class="comment">//</span>
00483     <span class="comment">// If the processor is not a 601, flush the data cache first.</span>
00484     <span class="comment">//</span>
00485 
00486     <span class="keywordflow">if</span> ( ( (KeGetPvr() &gt;&gt; 16 ) &amp; 0xffff ) &gt; 1 ) {
00487         HalSweepDcache();
00488     }
00489 
00490 
00491 <span class="preprocessor">#if !defined(NT_UP)</span>
00492 <span class="preprocessor"></span>
00493     HalSweepIcache();
00494     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00495 
00496 <span class="preprocessor">#endif</span>
00497 <span class="preprocessor"></span>
00498     <span class="keywordflow">return</span>;
00499 }
00500 
00501 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00502"></a><a class="code" href="../../d3/d5/ppc_2flush_8c.html#a8">00502</a> <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a8">KeSweepIcacheRange</a> (
00503     IN BOOLEAN AllProcessors,
00504     IN PVOID BaseAddress,
00505     IN ULONG Length
00506     )
00507 
00508 <span class="comment">/*++</span>
00509 <span class="comment"></span>
00510 <span class="comment">Routine Description:</span>
00511 <span class="comment"></span>
00512 <span class="comment">    This function is used to flush a range of virtual addresses from the</span>
00513 <span class="comment">    primary instruction cache on all processors that are currently running</span>
00514 <span class="comment">    threads which are children of the current process or flushes the range</span>
00515 <span class="comment">    of virtual addresses from the primary instruction cache on all</span>
00516 <span class="comment">    processors in the host configuration.</span>
00517 <span class="comment"></span>
00518 <span class="comment">Arguments:</span>
00519 <span class="comment"></span>
00520 <span class="comment">    AllProcessors - Supplies a boolean value that determines which instruction</span>
00521 <span class="comment">        caches are flushed.</span>
00522 <span class="comment"></span>
00523 <span class="comment">    BaseAddress - Supplies a pointer to the base of the range that is flushed.</span>
00524 <span class="comment"></span>
00525 <span class="comment">    Length - Supplies the length of the range that is flushed if the base</span>
00526 <span class="comment">        address is specified.</span>
00527 <span class="comment"></span>
00528 <span class="comment">Return Value:</span>
00529 <span class="comment"></span>
00530 <span class="comment">    None.</span>
00531 <span class="comment"></span>
00532 <span class="comment">--*/</span>
00533 
00534 {
00535 
00536     ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
00537     KIRQL OldIrql;
00538     KAFFINITY TargetProcessors;
00539     ULONG ProcessorType;
00540     ULONG DcacheAlignment;
00541     ULONG IcacheAlignment;
00542 
00543     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= <a class="code" href="../../d6/d7/halmips_8h.html#a58">SYNCH_LEVEL</a>);
00544 
00545     <span class="comment">//</span>
00546     <span class="comment">// If the length of the range is greater than the size of the primary</span>
00547     <span class="comment">// instruction cache, then flush the entire cache.</span>
00548     <span class="comment">//</span>
00549     <span class="comment">// N.B. It is assumed that the size of the primary instruction and</span>
00550     <span class="comment">//      data caches are the same.</span>
00551     <span class="comment">//</span>
00552 
00553     <span class="keywordflow">if</span> (Length &gt; PCR-&gt;FirstLevelIcacheSize) {
00554         <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a7">KeSweepIcache</a>(AllProcessors);
00555         <span class="keywordflow">return</span>;
00556     }
00557 
00558     ProcessorType = KeGetPvr() &gt;&gt; 16;
00559 
00560     <span class="keywordflow">if</span> (ProcessorType != 1) {
00561 
00562         <span class="comment">// PowerPc 601 has a unified cache; all others have dual caches.</span>
00563         <span class="comment">// Flush the Dcache prior to sweeping the Icache in case we need</span>
00564         <span class="comment">// to fetch a modified instruction currently Dcache resident.</span>
00565 
00566         DcacheAlignment = PCR-&gt;DcacheAlignment;
00567         <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = (ULONG)BaseAddress &amp; DcacheAlignment;
00568         HalSweepDcacheRange(
00569             (PVOID)((ULONG)BaseAddress &amp; ~DcacheAlignment),
00570             (<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> + Length + DcacheAlignment) &amp; ~DcacheAlignment);
00571     }
00572 
00573 <span class="preprocessor">#if 0</span>
00574 <span class="preprocessor"></span>
00575     <span class="comment">//</span>
00576     <span class="comment">// PowerPC h/w maintains coherency across processors.  No need</span>
00577     <span class="comment">// to send IPI request.</span>
00578     <span class="comment">//</span>
00579 
00580     <span class="comment">//</span>
00581     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00582     <span class="comment">//</span>
00583 
00584     OldIrql = KeRaiseIrqlToSynchLevel();
00585 
00586     <span class="comment">//</span>
00587     <span class="comment">// Compute the set of target processors, and send the sweep range</span>
00588     <span class="comment">// parameters to the target processors, if any, for execution.</span>
00589     <span class="comment">//</span>
00590 
00591     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00592     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00593         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00594                         <a class="code" href="../../d2/d5/mips_2flush_8c.html#a4">KiSweepIcacheRangeTarget</a>,
00595                         (PVOID)BaseAddress,
00596                         (PVOID)Length,
00597                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00598     }
00599 
00600 <span class="preprocessor">#endif</span>
00601 <span class="preprocessor"></span>
00602     <span class="comment">//</span>
00603     <span class="comment">// Flush the specified range of virtual addresses from the primary</span>
00604     <span class="comment">// instruction cache.</span>
00605     <span class="comment">//</span>
00606 
00607     IcacheAlignment = PCR-&gt;IcacheAlignment;
00608     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = (ULONG)BaseAddress &amp; IcacheAlignment;
00609     HalSweepIcacheRange((PVOID)((ULONG)BaseAddress &amp; ~IcacheAlignment),
00610                         (<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> + Length + IcacheAlignment) &amp; ~IcacheAlignment);
00611 
00612     <span class="comment">//</span>
00613     <span class="comment">// Wait until all target processors have finished sweeping the specified</span>
00614     <span class="comment">// range of addresses from the instruction cache.</span>
00615     <span class="comment">//</span>
00616 
00617 <span class="preprocessor">#if 0</span>
00618 <span class="preprocessor"></span>
00619     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00620         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00621     }
00622 
00623     <span class="comment">//</span>
00624     <span class="comment">// Lower IRQL to its previous level and return.</span>
00625     <span class="comment">//</span>
00626 
00627     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00628 
00629 <span class="preprocessor">#endif</span>
00630 <span class="preprocessor"></span>
00631     <span class="keywordflow">return</span>;
00632 }
00633 
00634 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00635 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a3">KiSweepIcacheRangeTarget</a> (
00636     IN PULONG SignalDone,
00637     IN PVOID BaseAddress,
00638     IN PVOID Length,
00639     IN PVOID Parameter3
00640     )
00641 
00642 <span class="comment">/*++</span>
00643 <span class="comment"></span>
00644 <span class="comment">Routine Description:</span>
00645 <span class="comment"></span>
00646 <span class="comment">    This is the target function for sweeping a range of addresses from the</span>
00647 <span class="comment">    instruction cache.</span>
00648 <span class="comment"></span>
00649 <span class="comment">    N.B. This routine is not used on PowerPC as the h/w can be relied</span>
00650 <span class="comment">    upon to maintain cache coherency.</span>
00651 <span class="comment"></span>
00652 <span class="comment">Arguments:</span>
00653 <span class="comment"></span>
00654 <span class="comment">    SignalDone Supplies a pointer to a variable that is cleared when the</span>
00655 <span class="comment">        requested operation has been performed.</span>
00656 <span class="comment"></span>
00657 <span class="comment">    BaseAddress - Supplies a pointer to the base of the range that is flushed.</span>
00658 <span class="comment"></span>
00659 <span class="comment">    Length - Supplies the length of the range that is flushed if the base</span>
00660 <span class="comment">        address is specified.</span>
00661 <span class="comment"></span>
00662 <span class="comment">    Parameter3 - Not used.</span>
00663 <span class="comment"></span>
00664 <span class="comment">Return Value:</span>
00665 <span class="comment"></span>
00666 <span class="comment">    None.</span>
00667 <span class="comment"></span>
00668 <span class="comment">--*/</span>
00669 
00670 {
00671 
00672 <span class="preprocessor">#if 0</span>
00673 <span class="preprocessor"></span>
00674     ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
00675     ULONG IcacheAlignment;
00676     <span class="comment">//</span>
00677     <span class="comment">// Sweep the specified instruction cache range on the current processor.</span>
00678     <span class="comment">//</span>
00679 
00680     IcacheAlignment = PCR-&gt;IcacheAlignment;
00681     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = (ULONG)(BaseAddress) &amp; IcacheAlignment;
00682     HalSweepIcacheRange((PVOID)((ULONG)(BaseAddress) &amp; ~IcacheAlignment),
00683                         (Offset + (ULONG)Length + IcacheAlignment) &amp; ~IcacheAlignment);
00684 
00685     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00686 
00687 <span class="preprocessor">#endif</span>
00688 <span class="preprocessor"></span>
00689     <span class="keywordflow">return</span>;
00690 }
00691 
00692 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00693"></a><a class="code" href="../../d3/d5/ppc_2flush_8c.html#a9">00693</a> <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a9">KeFlushIoBuffers</a> (
00694     IN <a class="code" href="../../d6/d7/struct__MDL.html">PMDL</a> Mdl,
00695     IN BOOLEAN ReadOperation,
00696     IN BOOLEAN DmaOperation
00697     )
00698 
00699 <span class="comment">/*++</span>
00700 <span class="comment"></span>
00701 <span class="comment">Routine Description:</span>
00702 <span class="comment"></span>
00703 <span class="comment">    This function flushes the I/O buffer specified by the memory descriptor</span>
00704 <span class="comment">    list from the data cache on all processors.</span>
00705 <span class="comment"></span>
00706 <span class="comment">Arguments:</span>
00707 <span class="comment"></span>
00708 <span class="comment">    Mdl - Supplies a pointer to a memory descriptor list that describes the</span>
00709 <span class="comment">        I/O buffer location.</span>
00710 <span class="comment"></span>
00711 <span class="comment">    ReadOperation - Supplies a boolean value that determines whether the I/O</span>
00712 <span class="comment">        operation is a read into memory.</span>
00713 <span class="comment"></span>
00714 <span class="comment">    DmaOperation - Supplies a boolean value that determines whether the I/O</span>
00715 <span class="comment">        operation is a DMA operation.</span>
00716 <span class="comment"></span>
00717 <span class="comment">Return Value:</span>
00718 <span class="comment"></span>
00719 <span class="comment">    None.</span>
00720 <span class="comment"></span>
00721 <span class="comment">--*/</span>
00722 
00723 {
00724 
00725     KIRQL OldIrql;
00726     KAFFINITY TargetProcessors;
00727     ULONG MaxLocalSweep;
00728 
00729     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= <a class="code" href="../../d6/d7/halmips_8h.html#a58">SYNCH_LEVEL</a>);
00730 
00731     <span class="comment">//</span>
00732     <span class="comment">// If the operation is a DMA operation, then check if the flush</span>
00733     <span class="comment">// can be avoided because the host system supports the right set</span>
00734     <span class="comment">// of cache coherency attributes. Otherwise, the flush can also</span>
00735     <span class="comment">// be avoided if the operation is a programmed I/O and not a page</span>
00736     <span class="comment">// read.</span>
00737     <span class="comment">//</span>
00738 
00739     <span class="keywordflow">if</span> (DmaOperation != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00740         <span class="keywordflow">if</span> (ReadOperation != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00741 
00742 <span class="preprocessor">#if DBG</span>
00743 <span class="preprocessor"></span>
00744             <span class="comment">//</span>
00745             <span class="comment">// Yes, it's a DMA operation, and yes, it's a read.  PPC</span>
00746             <span class="comment">// I-Caches do not snoop so this code is here only in debug</span>
00747             <span class="comment">// systems to ensure KiDmaIoCoherency is set reasonably.</span>
00748             <span class="comment">//</span>
00749 
00750             <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/kernldat_8c.html#a34">KiDmaIoCoherency</a> &amp; <a class="code" href="../../d4/d9/ke_8h.html#a41">DMA_READ_ICACHE_INVALIDATE</a>) != 0) {
00751 
00752                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((<a class="code" href="../../d5/d9/kernldat_8c.html#a34">KiDmaIoCoherency</a> &amp; <a class="code" href="../../d4/d9/ke_8h.html#a40">DMA_READ_DCACHE_INVALIDATE</a>) != 0);
00753 
00754                 <span class="keywordflow">return</span>;
00755             }
00756 
00757 <span class="preprocessor">#endif</span>
00758 <span class="preprocessor"></span>
00759             <span class="comment">//</span>
00760             <span class="comment">// If the operation is NOT a page read, then the read will</span>
00761             <span class="comment">// not affect the I-Cache.  The PPC architecture ensures the</span>
00762             <span class="comment">// D-Cache will remain coherent.</span>
00763             <span class="comment">//</span>
00764 
00765             <span class="keywordflow">if</span> ((Mdl-&gt;MdlFlags &amp; <a class="code" href="../../d0/d9/ntosdef_8h.html#a18">MDL_IO_PAGE_READ</a>) == 0) {
00766                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((<a class="code" href="../../d5/d9/kernldat_8c.html#a34">KiDmaIoCoherency</a> &amp; <a class="code" href="../../d4/d9/ke_8h.html#a40">DMA_READ_DCACHE_INVALIDATE</a>) != 0);
00767                 <span class="keywordflow">return</span>;
00768             }
00769 
00770         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/kernldat_8c.html#a34">KiDmaIoCoherency</a> &amp; <a class="code" href="../../d4/d9/ke_8h.html#a42">DMA_WRITE_DCACHE_SNOOP</a>) != 0) {
00771             <span class="keywordflow">return</span>;
00772         }
00773 
00774     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Mdl-&gt;MdlFlags &amp; <a class="code" href="../../d0/d9/ntosdef_8h.html#a18">MDL_IO_PAGE_READ</a>) == 0) {
00775         <span class="keywordflow">return</span>;
00776     }
00777 
00778     <span class="comment">//</span>
00779     <span class="comment">// If the processor has a unified cache (currently the only</span>
00780     <span class="comment">// PowerPC to fall into this category is a 601) then there</span>
00781     <span class="comment">// are no problems with the I-Cache not snooping and D-Cache</span>
00782     <span class="comment">// coherency is architected.</span>
00783     <span class="comment">//</span>
00784 
00785     <span class="keywordflow">if</span> ((KeGetPvr() &gt;&gt; 16) == 1) {
00786         <span class="keywordflow">return</span>;
00787     }
00788 
00789     <span class="comment">//</span>
00790     <span class="comment">// Either the operation is a DMA operation and the right coherency</span>
00791     <span class="comment">// atributes are not supported by the host system, or the operation</span>
00792     <span class="comment">// is programmed I/O and a page read.</span>
00793     <span class="comment">//</span>
00794     <span class="comment">// If the amount of data to sweep is large, sweep the entire</span>
00795     <span class="comment">// data and inctruction caches on all processors, otherwise,</span>
00796     <span class="comment">// sweep the explicit range covered by the mdl.</span>
00797     <span class="comment">//</span>
00798     <span class="comment">// Sweeping the range covered by the mdl will be broadcast</span>
00799     <span class="comment">// to the other processors by the PPC h/w coherency mechanism.</span>
00800     <span class="comment">// (1 DCBST + 1 ICBI per block)</span>
00801     <span class="comment">// Sweeping the entire D-Cache involves (potentially) loading</span>
00802     <span class="comment">// and broadcasting a DCBST for each block in the D-Cache on</span>
00803     <span class="comment">// every processor.</span>
00804     <span class="comment">//</span>
00805     <span class="comment">// For this reason we only sweep all if the amount to flush</span>
00806     <span class="comment">// is greater than the First Level D Cache size * number of</span>
00807     <span class="comment">// processors in the system.</span>
00808     <span class="comment">//</span>
00809 
00810     MaxLocalSweep = PCR-&gt;FirstLevelDcacheSize;
00811 
00812 <span class="preprocessor">#if !defined(NT_UP)</span>
00813 <span class="preprocessor"></span>
00814     MaxLocalSweep *= <a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>;
00815 
00816 <span class="preprocessor">#endif</span>
00817 <span class="preprocessor"></span>
00818     <span class="keywordflow">if</span> (Mdl-&gt;ByteCount &gt; MaxLocalSweep) {
00819 
00820         <span class="comment">//</span>
00821         <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00822         <span class="comment">//</span>
00823 
00824         OldIrql = KeRaiseIrqlToSynchLevel();
00825 
00826 <span class="preprocessor">#if !defined(NT_UP)</span>
00827 <span class="preprocessor"></span>
00828         <span class="comment">//</span>
00829         <span class="comment">// Compute the set of target processors and send the sweep parameters</span>
00830         <span class="comment">// to the target processors, if any, for execution.</span>
00831         <span class="comment">//</span>
00832 
00833         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00834         <span class="keywordflow">if</span> (TargetProcessors != 0) {
00835 
00836             <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00837                             <a class="code" href="../../d9/d4/alpha_2flush_8c.html#a3">KiFlushIoBuffersTarget</a>,
00838                             (PVOID)Mdl,
00839                             (PVOID)((ULONG)ReadOperation),
00840                             (PVOID)((ULONG)DmaOperation));
00841 
00842         }
00843 
00844 <span class="preprocessor">#endif</span>
00845 <span class="preprocessor"></span>
00846         <span class="comment">//</span>
00847         <span class="comment">// Flush the caches on the current processor.</span>
00848         <span class="comment">//</span>
00849 
00850         HalSweepDcache();
00851 
00852         HalSweepIcache();
00853 
00854         <span class="comment">//</span>
00855         <span class="comment">// Wait until all target processors have finished</span>
00856         <span class="comment">// flushing their caches.</span>
00857         <span class="comment">//</span>
00858 
00859 <span class="preprocessor">#if !defined(NT_UP)</span>
00860 <span class="preprocessor"></span>
00861         <span class="keywordflow">if</span> (TargetProcessors != 0) {
00862             <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00863         }
00864 
00865 <span class="preprocessor">#endif</span>
00866 <span class="preprocessor"></span>
00867         <span class="comment">//</span>
00868         <span class="comment">// Lower IRQL to its previous level and return.</span>
00869         <span class="comment">//</span>
00870 
00871         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00872 
00873         <span class="keywordflow">return</span>;
00874     }
00875 
00876     <span class="comment">//</span>
00877     <span class="comment">// The amount of data to be flushed is sufficiently small that it</span>
00878     <span class="comment">// should be done on this processor only, allowing the h/w to ensure</span>
00879     <span class="comment">// coherency.</span>
00880     <span class="comment">//</span>
00881 
00882     HalFlushIoBuffers(Mdl, ReadOperation, DmaOperation);
00883 
00884 }
00885 
00886 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00887 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a4">KiFlushIoBuffersTarget</a> (
00888     IN PULONG SignalDone,
00889     IN PVOID Mdl,
00890     IN PVOID ReadOperation,
00891     IN PVOID DmaOperation
00892     )
00893 
00894 <span class="comment">/*++</span>
00895 <span class="comment"></span>
00896 <span class="comment">Routine Description:</span>
00897 <span class="comment"></span>
00898 <span class="comment">    This is the target function for flushing an I/O buffer on target</span>
00899 <span class="comment">    processors.   On PowerPC this routine is only called when it has</span>
00900 <span class="comment">    been determined that it is more efficient to sweep the entire</span>
00901 <span class="comment">    cache than to sweep the range specified in the mdl.</span>
00902 <span class="comment"></span>
00903 <span class="comment">Arguments:</span>
00904 <span class="comment"></span>
00905 <span class="comment">    SignalDone Supplies a pointer to a variable that is cleared when the</span>
00906 <span class="comment">        requested operation has been performed.</span>
00907 <span class="comment"></span>
00908 <span class="comment">    Mdl - Supplies a pointer to a memory descriptor list that describes the</span>
00909 <span class="comment">        I/O buffer location.</span>
00910 <span class="comment"></span>
00911 <span class="comment">    ReadOperation - Supplies a boolean value that determines whether the I/O</span>
00912 <span class="comment">        operation is a read into memory.</span>
00913 <span class="comment"></span>
00914 <span class="comment">    DmaOperation - Supplies a boolean value that determines whether the I/O</span>
00915 <span class="comment">        operation is a DMA operation.</span>
00916 <span class="comment"></span>
00917 <span class="comment">Return Value:</span>
00918 <span class="comment"></span>
00919 <span class="comment">    None.</span>
00920 <span class="comment"></span>
00921 <span class="comment">--*/</span>
00922 
00923 {
00924 
00925     <span class="comment">//</span>
00926     <span class="comment">// Flush the caches on the current processor.</span>
00927     <span class="comment">//</span>
00928 
00929 <span class="preprocessor">#if !defined(NT_UP)</span>
00930 <span class="preprocessor"></span>
00931     HalSweepDcache();
00932 
00933     HalSweepIcache();
00934 
00935     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00936 
00937 <span class="preprocessor">#endif</span>
00938 <span class="preprocessor"></span>
00939     <span class="keywordflow">return</span>;
00940 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:02 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
