<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: threads.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>threads.h</h1><a href="../../d3/d1/threads_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989-1998 Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    threads.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module is the header file for thread pools. Thread pools can be used for</span>
00012 <span class="comment">    one time execution of tasks, for waits and for one shot or periodic timers.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Gurdeep Singh Pall (gurdeep) Nov 13, 1997</span>
00017 <span class="comment"></span>
00018 <span class="comment">Environment:</span>
00019 <span class="comment"></span>
00020 <span class="comment">    These routines are statically linked in the caller's executable and</span>
00021 <span class="comment">    are callable in only from user mode. They make use of Nt system services.</span>
00022 <span class="comment"></span>
00023 <span class="comment"></span>
00024 <span class="comment">Revision History:</span>
00025 <span class="comment"></span>
00026 <span class="comment">    Aug-19 lokeshs - modifications to thread pool apis.</span>
00027 <span class="comment"></span>
00028 <span class="comment">--*/</span>
00029 
00030 <span class="comment">//todo remove below</span>
<a name="l00031"></a><a class="code" href="../../d3/d1/threads_8h.html#a0">00031</a> <span class="preprocessor">#define DBG1 1</span>
00032 <span class="preprocessor"></span>
00033 
00034 
00035 <span class="comment">// Structures used by the Thread pool</span>
00036 
00037 <span class="comment">// Timer structures</span>
00038 
00039 <span class="comment">// Timer Queues and Timer entries both use RTLP_GENERIC_TIMER structure below.</span>
00040 <span class="comment">// Timer Queues are linked using List.</span>
00041 <span class="comment">// Timers are attached to the Timer Queue using TimerList</span>
00042 <span class="comment">// Timers are linked to each other using List</span>
00043 
<a name="l00044"></a><a class="code" href="../../d3/d1/threads_8h.html#a1">00044</a> <span class="preprocessor">#define RTLP_TIMER RTLP_GENERIC_TIMER</span>
<a name="l00045"></a><a class="code" href="../../d3/d1/threads_8h.html#a2">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTLP_TIMER PRTLP_GENERIC_TIMER</span>
00046 <span class="preprocessor"></span>
<a name="l00047"></a><a class="code" href="../../d3/d1/threads_8h.html#a3">00047</a> <span class="preprocessor">#define RTLP_TIMER_QUEUE RTLP_GENERIC_TIMER</span>
<a name="l00048"></a><a class="code" href="../../d3/d1/threads_8h.html#a4">00048</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTLP_TIMER_QUEUE PRTLP_GENERIC_TIMER</span>
00049 <span class="preprocessor"></span>
00050 <span class="keyword">struct </span><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html">_RTLP_WAIT</a> ;
00051 
<a name="l00052"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html">00052</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html">_RTLP_GENERIC_TIMER</a> {
00053 
<a name="l00054"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o0">00054</a>     LIST_ENTRY <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o0">List</a> ;                   <span class="comment">// All Timers and Queues are linked using this.</span>
<a name="l00055"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o1">00055</a>     ULONG <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o1">DeltaFiringTime</a> ;             <span class="comment">// Time difference in Milliseconds from the TIMER entry</span>
00056                                         <span class="comment">// just before this entry</span>
00057     <span class="keyword">union </span>{
<a name="l00058"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o2">00058</a>         ULONG <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o2">RefCount</a> ;        <span class="comment">// Timer RefCount</span>
<a name="l00059"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o3">00059</a>         ULONG * <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o3">RefCountPtr</a> ;   <span class="comment">// Pointer to Wait-&gt;Refcount</span>
00060     } ;                         <span class="comment">// keeps count of async callbacks still executing</span>
00061 
<a name="l00062"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o4">00062</a>     ULONG <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o4">State</a> ;               <span class="comment">// State of timer: CREATED, DELETE, ACTIVE. DONT_FIRE</span>
00063 
00064     <span class="keyword">union </span>{
00065 
00066         <span class="comment">// Used for Timer Queues</span>
00067 
00068         <span class="keyword">struct  </span>{
00069 
<a name="l00070"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o5">00070</a>             LIST_ENTRY  <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o5">TimerList</a> ;     <span class="comment">// Timers Hanging off of the queue</span>
<a name="l00071"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o6">00071</a>             LIST_ENTRY  <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o6">UncancelledTimerList</a> ;<span class="comment">//List of one shot timers not cancelled</span>
00072                                               <span class="comment">//not used for wait timers</span>
00073 <span class="preprocessor">            #if DBG1</span>
<a name="l00074"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o7">00074</a> <span class="preprocessor"></span>            ULONG <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o7">NextDbgId</a>; <span class="comment">//ksl</span>
00075 <span class="preprocessor">            #endif</span>
00076 <span class="preprocessor"></span>            
00077         } ;
00078 
00079         <span class="comment">// Used for Timers</span>
00080 
00081         <span class="keyword">struct  </span>{
<a name="l00082"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o8">00082</a>             <span class="keyword">struct </span><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html">_RTLP_GENERIC_TIMER</a> *<a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o8">Queue</a> ;<span class="comment">// Queue to which this timer belongs</span>
<a name="l00083"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o9">00083</a>             <span class="keyword">struct </span><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html">_RTLP_WAIT</a> *<a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o9">Wait</a> ;  <span class="comment">// Pointer to Wait event if timer is part of waits. else NULL</span>
<a name="l00084"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o10">00084</a>             ULONG <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o10">Flags</a> ;              <span class="comment">// Flags indicating special treatment for this timer</span>
<a name="l00085"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o11">00085</a>             PVOID <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o11">Function</a> ;           <span class="comment">// Function to call when timer fires</span>
<a name="l00086"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o12">00086</a>             PVOID <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o12">Context</a> ;            <span class="comment">// Context to pass to function when timer fires</span>
<a name="l00087"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o13">00087</a>             ULONG <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o13">Period</a> ;             <span class="comment">// In Milliseconds. Used for periodic timers.</span>
<a name="l00088"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o14">00088</a>             LIST_ENTRY <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o14">TimersToFireList</a>;<span class="comment">//placed in this list if the timer is fired</span>
00089         } ;
00090     } ;
00091 
<a name="l00092"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o15">00092</a>     HANDLE <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o15">CompletionEvent</a> ;   <span class="comment">// Event signalled when the timer is finally deleted</span>
00093 
00094 <span class="preprocessor">    #if DBG1</span>
<a name="l00095"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o16">00095</a> <span class="preprocessor"></span>    ULONG <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o16">DbgId</a>; <span class="comment">//ksl</span>
<a name="l00096"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o17">00096</a>     ULONG <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o17">ThreadId</a> ;
<a name="l00097"></a><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o18">00097</a>     ULONG <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html#o18">ThreadId2</a> ;
00098 <span class="preprocessor">    #endif</span>
00099 <span class="preprocessor"></span>
00100 }  <a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html">RTLP_GENERIC_TIMER</a>, *<a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html">PRTLP_GENERIC_TIMER</a> ;
00101 
00102 <span class="preprocessor">#if DBG1</span>
<a name="l00103"></a><a class="code" href="../../d3/d1/threads_8h.html#a48">00103</a> <span class="preprocessor"></span>ULONG <a class="code" href="../../d3/d1/threads_8h.html#a48">NextTimerDbgId</a>;
<a name="l00104"></a><a class="code" href="../../d3/d1/threads_8h.html#a49">00104</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a49">NextWaitDbgId</a>;
00105 <span class="preprocessor">#endif</span>
00106 <span class="preprocessor"></span>
00107 
00108 <span class="comment">// Structurs used by Wait Threads</span>
00109 
00110 <span class="comment">// Wait structure</span>
00111 
<a name="l00112"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html">00112</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html">_RTLP_WAIT</a> {
00113 
<a name="l00114"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o0">00114</a>     <span class="keyword">struct </span><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html">_RTLP_WAIT_THREAD_CONTROL_BLOCK</a> *<a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o0">ThreadCB</a> ;
<a name="l00115"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o1">00115</a>     HANDLE <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o1">WaitHandle</a> ;         <span class="comment">// Object to wait on</span>
<a name="l00116"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o2">00116</a>     ULONG <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o2">State</a> ;               <span class="comment">// REGISTERED, ACTIVE,DELETE state flags</span>
<a name="l00117"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o3">00117</a>     ULONG <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o3">RefCount</a> ;            <span class="comment">// initially set to 1. When 0, then ready to be deleted</span>
<a name="l00118"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o4">00118</a>     HANDLE <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o4">CompletionEvent</a> ;
<a name="l00119"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o5">00119</a>     <span class="keyword">struct </span><a class="code" href="../../d1/d6/struct__RTLP__GENERIC__TIMER.html">_RTLP_GENERIC_TIMER</a> *<a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o5">Timer</a> ; <span class="comment">// For timeouts on the wait</span>
<a name="l00120"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o6">00120</a>     ULONG <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o6">Flags</a> ;               <span class="comment">// Flags indicating special treatment for this wait</span>
<a name="l00121"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o7">00121</a>     PVOID <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o7">Function</a> ;            <span class="comment">// Function to call when wait completes</span>
<a name="l00122"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o8">00122</a>     PVOID <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o8">Context</a> ;             <span class="comment">// Context to pass to function</span>
<a name="l00123"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o9">00123</a>     ULONG <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o9">Timeout</a> ;             <span class="comment">// In Milliseconds.</span>
00124 <span class="preprocessor">    #if DBG1</span>
<a name="l00125"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o10">00125</a> <span class="preprocessor"></span>    ULONG <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o10">DbgId</a> ;
<a name="l00126"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o11">00126</a>     ULONG <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o11">ThreadId</a> ;
<a name="l00127"></a><a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o12">00127</a>     ULONG <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html#o12">ThreadId2</a> ;
00128 <span class="preprocessor">    #endif</span>
00129 <span class="preprocessor"></span>    
00130 } <a class="code" href="../../d2/d7/struct__RTLP__WAIT.html">RTLP_WAIT</a>, *<a class="code" href="../../d2/d7/struct__RTLP__WAIT.html">PRTLP_WAIT</a> ;
00131 
00132 
00133 <span class="comment">// Wait Thread Control Block</span>
00134 
<a name="l00135"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html">00135</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html">_RTLP_WAIT_THREAD_CONTROL_BLOCK</a> {
00136 
<a name="l00137"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o0">00137</a>     LIST_ENTRY <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o0">WaitThreadsList</a> ;<span class="comment">// List of all the thread control blocks</span>
00138 
<a name="l00139"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o1">00139</a>     HANDLE <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o1">ThreadHandle</a> ;       <span class="comment">// Handle for this thread</span>
<a name="l00140"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o2">00140</a>     ULONG <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o2">ThreadId</a> ;            <span class="comment">// Used to check if callback is in WaitThread</span>
00141 
<a name="l00142"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o3">00142</a>     ULONG <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o3">NumWaits</a> ;            <span class="comment">// Number of active waits + handles not being waited upon</span>
<a name="l00143"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o4">00143</a>     ULONG <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o4">NumActiveWaits</a> ;      <span class="comment">// Total number of waits.</span>
<a name="l00144"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o5">00144</a>     HANDLE <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o5">ActiveWaitArray</a>[64] ;<span class="comment">// Array used for waiting</span>
<a name="l00145"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o6">00145</a>     <a class="code" href="../../d3/d1/threads_8h.html#a51">PRTLP_WAIT</a> <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o6">ActiveWaitPointers</a>[64] ;<span class="comment">// Array of pointers to active Wait blocks.</span>
<a name="l00146"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o7">00146</a>     HANDLE <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o7">TimerHandle</a> ;        <span class="comment">// Handle to the NT timer used for timeouts</span>
<a name="l00147"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o8">00147</a>     <a class="code" href="../../d3/d1/threads_8h.html#a3">RTLP_TIMER_QUEUE</a> <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o8">TimerQueue</a>;<span class="comment">// Queue in which all timers are kept</span>
<a name="l00148"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o9">00148</a>     <a class="code" href="../../d3/d1/threads_8h.html#a1">RTLP_TIMER</a> <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o9">TimerBlocks</a>[63] ;<span class="comment">// All the timers required for wait timeouts - max of 63 since wait[0]</span>
00149                                 <span class="comment">// is used for NT timer object</span>
<a name="l00150"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o10">00150</a>     LIST_ENTRY <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o10">FreeTimerBlocks</a> ;<span class="comment">// List of Free Blocks</span>
00151 
<a name="l00152"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o11">00152</a>     LARGE_INTEGER <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o11">Current64BitTickCount</a> ;
<a name="l00153"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o12">00153</a>     LONGLONG <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o12">Firing64BitTickCount</a> ;
00154     
<a name="l00155"></a><a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o13">00155</a>     RTL_CRITICAL_SECTION <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html#o13">WaitThreadCriticalSection</a> ;
00156                                 <span class="comment">// Used for addition and deletion of waits</span>
00157 
00158 } <a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html">RTLP_WAIT_THREAD_CONTROL_BLOCK</a>, *<a class="code" href="../../d3/d7/struct__RTLP__WAIT__THREAD__CONTROL__BLOCK.html">PRTLP_WAIT_THREAD_CONTROL_BLOCK</a> ;
00159 
00160 
00161 <span class="comment">// Structure used for attaching all I/O worker threads</span>
00162 
<a name="l00163"></a><a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html">00163</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html">_RTLP_IOWORKER_TCB</a> {
00164 
<a name="l00165"></a><a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html#o0">00165</a>     LIST_ENTRY <a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html#o0">List</a> ;           <span class="comment">// List of IO Worker threads</span>
<a name="l00166"></a><a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html#o1">00166</a>     HANDLE     <a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html#o1">ThreadHandle</a> ;   <span class="comment">// Handle of this thread</span>
<a name="l00167"></a><a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html#o2">00167</a>     ULONG      <a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html#o2">Flags</a> ;          <span class="comment">// WT_EXECUTEINPERSISTENTIOTHREAD</span>
<a name="l00168"></a><a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html#o3">00168</a>     BOOLEAN    <a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html#o3">LongFunctionFlag</a> ;<span class="comment">// Is the thread currently executing long fn</span>
00169 } <a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html">RTLP_IOWORKER_TCB</a>, *<a class="code" href="../../d6/d6/struct__RTLP__IOWORKER__TCB.html">PRTLP_IOWORKER_TCB</a> ;
00170 
<a name="l00171"></a><a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html">00171</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html">_RTLP_WAITWORKER</a> {
00172     <span class="keyword">union </span>{
<a name="l00173"></a><a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html#o0">00173</a>         <a class="code" href="../../d3/d1/threads_8h.html#a51">PRTLP_WAIT</a> <a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html#o0">Wait</a> ;
<a name="l00174"></a><a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html#o1">00174</a>         <a class="code" href="../../d3/d1/threads_8h.html#a2">PRTLP_TIMER</a> <a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html#o1">Timer</a> ;
00175     } ;
<a name="l00176"></a><a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html#o2">00176</a>     BOOLEAN <a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html#o2">WaitThreadCallback</a> ; <span class="comment">//callback queued by Wait thread or Timer thread</span>
<a name="l00177"></a><a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html#o3">00177</a>     BOOLEAN <a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html#o3">TimerCondition</a> ;<span class="comment">//true if fired because wait timed out.</span>
00178 } <a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html">RTLP_ASYNC_CALLBACK</a>, * <a class="code" href="../../d4/d7/struct__RTLP__WAITWORKER.html">PRTLP_ASYNC_CALLBACK</a> ;
00179 
00180 
00181 
00182 <span class="comment">// structure used for calling worker function</span>
00183 
<a name="l00184"></a><a class="code" href="../../d6/d7/struct__RTLP__WORK.html">00184</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7/struct__RTLP__WORK.html">_RTLP_WORK</a> {
00185 
<a name="l00186"></a><a class="code" href="../../d6/d7/struct__RTLP__WORK.html#o0">00186</a>     WORKERCALLBACKFUNC <a class="code" href="../../d6/d7/struct__RTLP__WORK.html#o0">Function</a> ;
<a name="l00187"></a><a class="code" href="../../d6/d7/struct__RTLP__WORK.html#o1">00187</a>     ULONG <a class="code" href="../../d6/d7/struct__RTLP__WORK.html#o1">Flags</a> ;
00188     
00189 } <a class="code" href="../../d6/d7/struct__RTLP__WORK.html">RTLP_WORK</a>, *<a class="code" href="../../d6/d7/struct__RTLP__WORK.html">PRTLP_WORK</a> ;
00190 
00191 
00192 
00193 <span class="comment">// Structure used for storing events</span>
00194 
<a name="l00195"></a><a class="code" href="../../d0/d6/struct__RTLP__EVENT.html">00195</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d6/struct__RTLP__EVENT.html">_RTLP_EVENT</a> {
00196 
<a name="l00197"></a><a class="code" href="../../d0/d6/struct__RTLP__EVENT.html#o0">00197</a>     LIST_ENTRY <a class="code" href="../../d0/d6/struct__RTLP__EVENT.html#o0">List</a> ;
<a name="l00198"></a><a class="code" href="../../d0/d6/struct__RTLP__EVENT.html#o1">00198</a>     HANDLE <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a29">Handle</a> ;
00199     
00200 } <a class="code" href="../../d0/d6/struct__RTLP__EVENT.html">RTLP_EVENT</a>, *<a class="code" href="../../d0/d6/struct__RTLP__EVENT.html">PRTLP_EVENT</a> ;
00201 
00202 
00203 
00204 <span class="comment">// Globals used by the thread pool</span>
00205 
<a name="l00206"></a><a class="code" href="../../d3/d1/threads_8h.html#a62">00206</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a62">StartedTPInitialization</a> ; <span class="comment">// Used for Initializing ThreadPool</span>
<a name="l00207"></a><a class="code" href="../../d3/d1/threads_8h.html#a63">00207</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a63">CompletedTPInitialization</a>;<span class="comment">// Used to check if ThreadPool is initialized</span>
00208 
<a name="l00209"></a><a class="code" href="../../d3/d1/threads_8h.html#a64">00209</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a64">StartedWorkerInitialization</a> ;     <span class="comment">// Used for Worker thread startup synchronization</span>
<a name="l00210"></a><a class="code" href="../../d3/d1/threads_8h.html#a65">00210</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a65">CompletedWorkerInitialization</a> ;   <span class="comment">// Used to check if Worker thread pool is initialized</span>
00211 
<a name="l00212"></a><a class="code" href="../../d3/d1/threads_8h.html#a66">00212</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a66">StartedWaitInitialization</a> ;       <span class="comment">// Used for Wait thread startup synchronization</span>
<a name="l00213"></a><a class="code" href="../../d3/d1/threads_8h.html#a67">00213</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a67">CompletedWaitInitialization</a> ;     <span class="comment">// Used to check if Wait thread pool is initialized</span>
00214 
<a name="l00215"></a><a class="code" href="../../d3/d1/threads_8h.html#a68">00215</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a68">StartedTimerInitialization</a> ;      <span class="comment">// Used by Timer thread startup synchronization</span>
<a name="l00216"></a><a class="code" href="../../d3/d1/threads_8h.html#a69">00216</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a69">CompletedTimerInitialization</a> ;    <span class="comment">// Used for to check if Timer thread is initialized</span>
00217 
<a name="l00218"></a><a class="code" href="../../d3/d1/threads_8h.html#a70">00218</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a70">StartedEventCacheInitialization</a> ; <span class="comment">// Used for initializing event cache</span>
<a name="l00219"></a><a class="code" href="../../d3/d1/threads_8h.html#a71">00219</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a71">CompletedEventCacheInitialization</a>;<span class="comment">// Used for initializing event cache</span>
00220 
<a name="l00221"></a><a class="code" href="../../d3/d1/threads_8h.html#a72">00221</a> HANDLE <a class="code" href="../../d3/d1/threads_8h.html#a72">TimerThreadHandle</a> ;              <span class="comment">// Holds the timer thread handle</span>
<a name="l00222"></a><a class="code" href="../../d3/d1/threads_8h.html#a73">00222</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a73">TimerThreadId</a> ;                   <span class="comment">// Used to check if current thread is a timer thread</span>
00223 
<a name="l00224"></a><a class="code" href="../../d3/d1/threads_8h.html#a74">00224</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a74">NumIOWorkerThreads</a> ;              <span class="comment">// Count of IO Worker Threads alive</span>
<a name="l00225"></a><a class="code" href="../../d3/d1/threads_8h.html#a75">00225</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a75">NumWorkerThreads</a> ;                <span class="comment">// Count of Worker Threads alive</span>
<a name="l00226"></a><a class="code" href="../../d3/d1/threads_8h.html#a76">00226</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a76">NumMinWorkerThreads</a> ;             <span class="comment">// Min worker threads should be alive: 1 if ioCompletion used, else 0</span>
<a name="l00227"></a><a class="code" href="../../d3/d1/threads_8h.html#a77">00227</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a77">NumIOWorkRequests</a> ;               <span class="comment">// Count of IO Work Requests pending</span>
<a name="l00228"></a><a class="code" href="../../d3/d1/threads_8h.html#a78">00228</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a78">NumLongIOWorkRequests</a> ;           <span class="comment">// IO Worker threads executing long worker functions</span>
<a name="l00229"></a><a class="code" href="../../d3/d1/threads_8h.html#a79">00229</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a79">NumWorkRequests</a> ;                 <span class="comment">// Count of Work Requests pending.</span>
<a name="l00230"></a><a class="code" href="../../d3/d1/threads_8h.html#a80">00230</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a80">NumLongWorkRequests</a> ;             <span class="comment">// Worker threads executing long worker functions</span>
<a name="l00231"></a><a class="code" href="../../d3/d1/threads_8h.html#a81">00231</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a81">NumExecutingWorkerThreads</a> ;       <span class="comment">// Worker threads currently executing worker functions</span>
<a name="l00232"></a><a class="code" href="../../d3/d1/threads_8h.html#a82">00232</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a82">TotalExecutedWorkRequests</a> ;       <span class="comment">// Total worker requests that were picked up</span>
<a name="l00233"></a><a class="code" href="../../d3/d1/threads_8h.html#a83">00233</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a83">OldTotalExecutedWorkRequests</a> ;    <span class="comment">// Total worker requests since last timeout.</span>
<a name="l00234"></a><a class="code" href="../../d3/d1/threads_8h.html#a84">00234</a> HANDLE <a class="code" href="../../d3/d1/threads_8h.html#a84">WorkerThreadTimerQueue</a> ;         <span class="comment">// Timer queue used by worker threads</span>
<a name="l00235"></a><a class="code" href="../../d3/d1/threads_8h.html#a85">00235</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a85">WorkerThreadTimerQueueInit</a> ;      <span class="comment">// Initialization of the above timer queue</span>
00236 
<a name="l00237"></a><a class="code" href="../../d3/d1/threads_8h.html#a86">00237</a> HANDLE <a class="code" href="../../d3/d1/threads_8h.html#a86">WorkerThreadTimer</a> ;              <span class="comment">// Timer used by worker threads</span>
00238 
<a name="l00239"></a><a class="code" href="../../d3/d1/threads_8h.html#a87">00239</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a87">NumUnusedEvents</a> ;                 <span class="comment">// Count of Unused events in the cache</span>
00240 
<a name="l00241"></a><a class="code" href="../../d3/d1/threads_8h.html#a88">00241</a> ULONG <a class="code" href="../../d3/d1/threads_8h.html#a88">LastThreadCreationTickCount</a> ;     <span class="comment">// Tick count at which the last thread was created</span>
00242 
<a name="l00243"></a><a class="code" href="../../d3/d1/threads_8h.html#a89">00243</a> LIST_ENTRY <a class="code" href="../../d3/d1/threads_8h.html#a89">IOWorkerThreads</a> ;            <span class="comment">// List of IOWorkerThreads</span>
<a name="l00244"></a><a class="code" href="../../d3/d1/threads_8h.html#a90">00244</a> <a class="code" href="../../d3/d1/threads_8h.html#a55">PRTLP_IOWORKER_TCB</a> <a class="code" href="../../d3/d1/threads_8h.html#a90">PersistentIOTCB</a> ;    <span class="comment">// ptr to TCB of persistest IO worker thread</span>
<a name="l00245"></a><a class="code" href="../../d3/d1/threads_8h.html#a91">00245</a> HANDLE <a class="code" href="../../d3/d1/threads_8h.html#a91">WorkerCompletionPort</a> ;           <span class="comment">// Completion port used for queuing tasks to Worker threads</span>
00246 
<a name="l00247"></a><a class="code" href="../../d3/d1/threads_8h.html#a92">00247</a> LIST_ENTRY <a class="code" href="../../d3/d1/threads_8h.html#a92">WaitThreads</a> ;                <span class="comment">// List of all wait threads created</span>
<a name="l00248"></a><a class="code" href="../../d3/d1/threads_8h.html#a93">00248</a> LIST_ENTRY <a class="code" href="../../d3/d1/threads_8h.html#a93">EventCache</a> ;                 <span class="comment">// Events used for synchronization</span>
00249 
00250 
<a name="l00251"></a><a class="code" href="../../d3/d1/threads_8h.html#a94">00251</a> LIST_ENTRY <a class="code" href="../../d3/d1/threads_8h.html#a94">TimerQueues</a> ;                <span class="comment">// All timer queues are linked in this list</span>
<a name="l00252"></a><a class="code" href="../../d3/d1/threads_8h.html#a95">00252</a> HANDLE     <a class="code" href="../../d3/d1/threads_8h.html#a95">TimerHandle</a> ;                <span class="comment">// Holds handle of NT Timer used by the Timer Thread</span>
<a name="l00253"></a><a class="code" href="../../d3/d1/threads_8h.html#a96">00253</a> ULONG      <a class="code" href="../../d3/d1/threads_8h.html#a96">NumTimerQueues</a> ;             <span class="comment">// Number of timer queues</span>
00254 
<a name="l00255"></a><a class="code" href="../../d3/d1/threads_8h.html#a97">00255</a> RTL_CRITICAL_SECTION <a class="code" href="../../d3/d1/threads_8h.html#a97">WorkerCriticalSection</a> ;    <span class="comment">// Exclusion used by worker threads</span>
<a name="l00256"></a><a class="code" href="../../d3/d1/threads_8h.html#a98">00256</a> RTL_CRITICAL_SECTION <a class="code" href="../../d3/d1/threads_8h.html#a98">WaitCriticalSection</a> ;      <span class="comment">// Exclusion used by wait threads</span>
<a name="l00257"></a><a class="code" href="../../d3/d1/threads_8h.html#a99">00257</a> RTL_CRITICAL_SECTION <a class="code" href="../../d3/d1/threads_8h.html#a99">TimerCriticalSection</a> ;     <span class="comment">// Exclusion used by timer threads</span>
<a name="l00258"></a><a class="code" href="../../d3/d1/threads_8h.html#a100">00258</a> RTL_CRITICAL_SECTION <a class="code" href="../../d3/d1/threads_8h.html#a100">EventCacheCriticalSection</a> ;<span class="comment">// Exclusion used for handle allocation</span>
00259 
<a name="l00260"></a><a class="code" href="../../d3/d1/threads_8h.html#a101">00260</a> RTLP_START_THREAD <a class="code" href="../../d3/d1/threads_8h.html#a101">RtlpStartThread</a> ;
<a name="l00261"></a><a class="code" href="../../d3/d1/threads_8h.html#a102">00261</a> PRTLP_START_THREAD <a class="code" href="../../d3/d1/threads_8h.html#a102">RtlpStartThreadFunc</a> = <a class="code" href="../../d3/d1/threads_8h.html#a101">RtlpStartThread</a> ;
<a name="l00262"></a><a class="code" href="../../d3/d1/threads_8h.html#a103">00262</a> RTLP_EXIT_THREAD <a class="code" href="../../d3/d1/threads_8h.html#a103">RtlpExitThread</a> ;
<a name="l00263"></a><a class="code" href="../../d3/d1/threads_8h.html#a104">00263</a> PRTLP_EXIT_THREAD <a class="code" href="../../d3/d1/threads_8h.html#a104">RtlpExitThreadFunc</a> = <a class="code" href="../../d3/d1/threads_8h.html#a103">RtlpExitThread</a> ;
00264 
00265 <span class="preprocessor">#if DBG1</span>
<a name="l00266"></a><a class="code" href="../../d3/d1/threads_8h.html#a108">00266</a> <span class="preprocessor"></span>PVOID <a class="code" href="../../d3/d1/threads_8h.html#a105">CallbackFn1</a>, <a class="code" href="../../d3/d1/threads_8h.html#a106">CallbackFn2</a>, <a class="code" href="../../d3/d1/threads_8h.html#a107">Context1</a>, <a class="code" href="../../d3/d1/threads_8h.html#a108">Context2</a> ;
00267 <span class="preprocessor">#endif</span>
00268 <span class="preprocessor"></span>
00269 
00270 <span class="comment">// defines used in the thread pool</span>
00271 
<a name="l00272"></a><a class="code" href="../../d3/d1/threads_8h.html#a5">00272</a> <span class="preprocessor">#define THREAD_CREATION_DAMPING_TIME1    1000    // In Milliseconds. Time between starting successive threads.</span>
<a name="l00273"></a><a class="code" href="../../d3/d1/threads_8h.html#a6">00273</a> <span class="preprocessor"></span><span class="preprocessor">#define THREAD_CREATION_DAMPING_TIME2    5000    // In Milliseconds. Time between starting successive threads.</span>
<a name="l00274"></a><a class="code" href="../../d3/d1/threads_8h.html#a7">00274</a> <span class="preprocessor"></span><span class="preprocessor">#define THREAD_TERMINATION_DAMPING_TIME 10000    // In Milliseconds. Time between stopping successive threads.</span>
<a name="l00275"></a><a class="code" href="../../d3/d1/threads_8h.html#a8">00275</a> <span class="preprocessor"></span><span class="preprocessor">#define NEW_THREAD_THRESHOLD            7       // Number of requests outstanding before we start a new thread</span>
<a name="l00276"></a><a class="code" href="../../d3/d1/threads_8h.html#a9">00276</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_WORKER_THREADS              1000    // Max effective worker threads</span>
<a name="l00277"></a><a class="code" href="../../d3/d1/threads_8h.html#a10">00277</a> <span class="preprocessor"></span><span class="preprocessor">#define INFINITE_TIME                   (ULONG)~0   // In milliseconds</span>
<a name="l00278"></a><a class="code" href="../../d3/d1/threads_8h.html#a11">00278</a> <span class="preprocessor"></span><span class="preprocessor">#define RTLP_MAX_TIMERS                 0x00080000  // 524288 timers per process</span>
<a name="l00279"></a><a class="code" href="../../d3/d1/threads_8h.html#a12">00279</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_UNUSED_EVENTS               40</span>
00280 <span class="preprocessor"></span>
00281 
00282 <span class="comment">// Macros</span>
00283 
00284 
<a name="l00285"></a><a class="code" href="../../d3/d1/threads_8h.html#a13">00285</a> <span class="preprocessor">#define ONE_MILLISECOND_TIMEOUT(TimeOut) {      \</span>
00286 <span class="preprocessor">        TimeOut.LowPart  = 0xffffd8f0 ;         \</span>
00287 <span class="preprocessor">        TimeOut.HighPart = 0xffffffff ;         \</span>
00288 <span class="preprocessor">        }</span>
00289 <span class="preprocessor"></span>
<a name="l00290"></a><a class="code" href="../../d3/d1/threads_8h.html#a14">00290</a> <span class="preprocessor">#define HUNDRED_MILLISECOND_TIMEOUT(TimeOut) {  \</span>
00291 <span class="preprocessor">        TimeOut.LowPart  = 0xfff0bdc0 ;         \</span>
00292 <span class="preprocessor">        TimeOut.HighPart = 0xffffffff ;         \</span>
00293 <span class="preprocessor">        }</span>
00294 <span class="preprocessor"></span>
<a name="l00295"></a><a class="code" href="../../d3/d1/threads_8h.html#a15">00295</a> <span class="preprocessor">#define ONE_SECOND_TIMEOUT(TimeOut) {           \</span>
00296 <span class="preprocessor">        TimeOut.LowPart  = 0xff676980 ;         \</span>
00297 <span class="preprocessor">        TimeOut.HighPart = 0xffffffff ;         \</span>
00298 <span class="preprocessor">        }</span>
00299 <span class="preprocessor"></span>
<a name="l00300"></a><a class="code" href="../../d3/d1/threads_8h.html#a16">00300</a> <span class="preprocessor">#define USE_PROCESS_HEAP 1</span>
00301 <span class="preprocessor"></span>
<a name="l00302"></a><a class="code" href="../../d3/d1/threads_8h.html#a17">00302</a> <span class="preprocessor">#define RtlpFreeTPHeap(Ptr) \</span>
00303 <span class="preprocessor">    RtlFreeHeap( RtlProcessHeap(), 0, (Ptr) )</span>
00304 <span class="preprocessor"></span>
<a name="l00305"></a><a class="code" href="../../d3/d1/threads_8h.html#a18">00305</a> <span class="preprocessor">#define RtlpAllocateTPHeap(Size, Flags) \</span>
00306 <span class="preprocessor">    RtlAllocateHeap( RtlProcessHeap(), (Flags), (Size) )</span>
00307 <span class="preprocessor"></span>
00308 <span class="comment">// used to allocate Wait thread</span>
00309 
<a name="l00310"></a><a class="code" href="../../d3/d1/threads_8h.html#a19">00310</a> <span class="preprocessor">#define ACQUIRE_GLOBAL_WAIT_LOCK() \</span>
00311 <span class="preprocessor">    RtlEnterCriticalSection (&amp;WaitCriticalSection)</span>
00312 <span class="preprocessor"></span>
<a name="l00313"></a><a class="code" href="../../d3/d1/threads_8h.html#a20">00313</a> <span class="preprocessor">#define RELEASE_GLOBAL_WAIT_LOCK() \</span>
00314 <span class="preprocessor">    RtlLeaveCriticalSection(&amp;WaitCriticalSection)</span>
00315 <span class="preprocessor"></span>
00316 
00317 <span class="comment">// taken before a timer/queue is deleted and when the timers</span>
00318 <span class="comment">// are being fired. Used to assure that no timers will be fired later.</span>
00319 
<a name="l00320"></a><a class="code" href="../../d3/d1/threads_8h.html#a21">00320</a> <span class="preprocessor">#define ACQUIRE_GLOBAL_TIMER_LOCK() \</span>
00321 <span class="preprocessor">    RtlEnterCriticalSection (&amp;TimerCriticalSection)</span>
00322 <span class="preprocessor"></span>
<a name="l00323"></a><a class="code" href="../../d3/d1/threads_8h.html#a22">00323</a> <span class="preprocessor">#define RELEASE_GLOBAL_TIMER_LOCK() \</span>
00324 <span class="preprocessor">    RtlLeaveCriticalSection(&amp;TimerCriticalSection)</span>
00325 <span class="preprocessor"></span>
00326 <span class="comment">// used in RtlpThreadPoolCleanup to find if a component is initialized</span>
00327 
<a name="l00328"></a><a class="code" href="../../d3/d1/threads_8h.html#a23">00328</a> <span class="preprocessor">#define IS_COMPONENT_INITIALIZED(StartedVariable, CompletedVariable, Flag) \</span>
00329 <span class="preprocessor">{\</span>
00330 <span class="preprocessor">    LARGE_INTEGER TimeOut ;     \</span>
00331 <span class="preprocessor">    Flag = FALSE ;              \</span>
00332 <span class="preprocessor">                                \</span>
00333 <span class="preprocessor">    if ( StartedVariable ) {    \</span>
00334 <span class="preprocessor">                                \</span>
00335 <span class="preprocessor">        if ( !CompletedVariable ) { \</span>
00336 <span class="preprocessor">                                    \</span>
00337 <span class="preprocessor">            ONE_MILLISECOND_TIMEOUT(TimeOut) ;  \</span>
00338 <span class="preprocessor">                                                \</span>
00339 <span class="preprocessor">            while (!(volatile ULONG) CompletedVariable) \</span>
00340 <span class="preprocessor">                NtDelayExecution (FALSE, &amp;TimeOut) ;    \</span>
00341 <span class="preprocessor">                                                        \</span>
00342 <span class="preprocessor">            if (CompletedVariable == 1)                 \</span>
00343 <span class="preprocessor">                Flag = TRUE ;                           \</span>
00344 <span class="preprocessor">                                                        \</span>
00345 <span class="preprocessor">        } else {                                        \</span>
00346 <span class="preprocessor">            Flag = TRUE ;                               \</span>
00347 <span class="preprocessor">        }                                               \</span>
00348 <span class="preprocessor">    }                                                   \</span>
00349 <span class="preprocessor">}    </span>
00350 <span class="preprocessor"></span>
00351 
00352 <span class="comment">// macro used to set dbg function/context</span>
00353 
<a name="l00354"></a><a class="code" href="../../d3/d1/threads_8h.html#a24">00354</a> <span class="preprocessor">#define DBG_SET_FUNCTION(Fn, Context) { \</span>
00355 <span class="preprocessor">    CallbackFn1 = CallbackFn2 ;         \</span>
00356 <span class="preprocessor">    CallbackFn2 = (Fn) ;                \</span>
00357 <span class="preprocessor">    Context1 = Context2 ;               \</span>
00358 <span class="preprocessor">    Context2 = (Context ) ;             \</span>
00359 <span class="preprocessor">}</span>
00360 <span class="preprocessor"></span>
00361 
00362 <span class="comment">// used to move the wait array</span>
00363 <span class="comment">/*</span>
00364 <span class="comment">VOID</span>
00365 <span class="comment">RtlpShiftWaitArray(</span>
00366 <span class="comment">    PRTLP_WAIT_THREAD_CONTROL_BLOCK ThreadCB ThreadCB,</span>
00367 <span class="comment">    ULONG SrcIndex,</span>
00368 <span class="comment">    ULONG DstIndex,</span>
00369 <span class="comment">    ULONG Count</span>
00370 <span class="comment">    )</span>
00371 <span class="comment">*/</span>
<a name="l00372"></a><a class="code" href="../../d3/d1/threads_8h.html#a25">00372</a> <span class="preprocessor">#define RtlpShiftWaitArray(ThreadCB, SrcIndex, DstIndex, Count) {  \</span>
00373 <span class="preprocessor">                                                            \</span>
00374 <span class="preprocessor">    RtlCopyMemory (&amp;(ThreadCB)-&gt;ActiveWaitArray[DstIndex],  \</span>
00375 <span class="preprocessor">                    &amp;(ThreadCB)-&gt;ActiveWaitArray[SrcIndex], \</span>
00376 <span class="preprocessor">                    sizeof (HANDLE) * (Count)) ;            \</span>
00377 <span class="preprocessor">                                                            \</span>
00378 <span class="preprocessor">    RtlCopyMemory (&amp;(ThreadCB)-&gt;ActiveWaitPointers[DstIndex],\</span>
00379 <span class="preprocessor">                    &amp;(ThreadCB)-&gt;ActiveWaitPointers[SrcIndex],\</span>
00380 <span class="preprocessor">                    sizeof (HANDLE) * (Count)) ;            \</span>
00381 <span class="preprocessor">}</span>
00382 <span class="preprocessor"></span>
<a name="l00383"></a><a class="code" href="../../d3/d1/threads_8h.html#a109">00383</a> LARGE_INTEGER   <a class="code" href="../../d3/d1/threads_8h.html#a109">Last64BitTickCount</a> ;
<a name="l00384"></a><a class="code" href="../../d3/d1/threads_8h.html#a110">00384</a> LARGE_INTEGER   <a class="code" href="../../d3/d1/threads_8h.html#a110">Resync64BitTickCount</a> ;
<a name="l00385"></a><a class="code" href="../../d3/d1/threads_8h.html#a111">00385</a> LARGE_INTEGER   <a class="code" href="../../d3/d1/threads_8h.html#a111">Firing64BitTickCount</a> ;
00386 
<a name="l00387"></a><a class="code" href="../../d3/d1/threads_8h.html#a26">00387</a> <span class="preprocessor">#define RtlpGetResync64BitTickCount()  Resync64BitTickCount.QuadPart</span>
<a name="l00388"></a><a class="code" href="../../d3/d1/threads_8h.html#a27">00388</a> <span class="preprocessor"></span><span class="preprocessor">#define RtlpSetFiring64BitTickCount(Timeout) \</span>
00389 <span class="preprocessor">            Firing64BitTickCount.QuadPart = (Timeout)</span>
00390 <span class="preprocessor"></span>
00391 
00392     
00393 <span class="comment">// signature for timer and wait entries</span>
00394 
<a name="l00395"></a><a class="code" href="../../d3/d1/threads_8h.html#a28">00395</a> <span class="preprocessor">#define SET_SIGNATURE(ptr)          (ptr)-&gt;State |= 0xfedc0000</span>
<a name="l00396"></a><a class="code" href="../../d3/d1/threads_8h.html#a29">00396</a> <span class="preprocessor"></span><span class="preprocessor">#define CHECK_SIGNATURE(ptr)        ASSERT( ((ptr)-&gt;State &amp; 0xffff0000) == 0xfedc0000 )</span>
<a name="l00397"></a><a class="code" href="../../d3/d1/threads_8h.html#a30">00397</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_DEL_SIGNATURE(ptr)      ((ptr)-&gt;State |= 0xfedcb000)</span>
<a name="l00398"></a><a class="code" href="../../d3/d1/threads_8h.html#a31">00398</a> <span class="preprocessor"></span><span class="preprocessor">#define CHECK_DEL_SIGNATURE(ptr)    ASSERT( (((ptr)-&gt;State &amp; 0xffff0000) == 0xfedc0000) \</span>
00399 <span class="preprocessor">                                        &amp;&amp; ( ! ((ptr)-&gt;State &amp; 0x0000f000)) )</span>
<a name="l00400"></a><a class="code" href="../../d3/d1/threads_8h.html#a32">00400</a> <span class="preprocessor"></span><span class="preprocessor">#define CLEAR_SIGNATURE(ptr)        ((ptr)-&gt;State = ((ptr)-&gt;State &amp; 0x0000ffff) | 0xcdef0000)</span>
<a name="l00401"></a><a class="code" href="../../d3/d1/threads_8h.html#a33">00401</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_DEL_TIMERQ_SIGNATURE(ptr)  ((ptr)-&gt;State |= 0x00000a00)</span>
00402 <span class="preprocessor"></span>
00403 
00404 <span class="comment">// debug prints</span>
00405 
<a name="l00406"></a><a class="code" href="../../d3/d1/threads_8h.html#a34">00406</a> <span class="preprocessor">#define DPRN0 (DPRN &amp; 0x1)</span>
<a name="l00407"></a><a class="code" href="../../d3/d1/threads_8h.html#a35">00407</a> <span class="preprocessor"></span><span class="preprocessor">#define DPRN1 (DPRN &amp; 0x2)</span>
<a name="l00408"></a><a class="code" href="../../d3/d1/threads_8h.html#a36">00408</a> <span class="preprocessor"></span><span class="preprocessor">#define DPRN2 (DPRN &amp; 0x4)</span>
<a name="l00409"></a><a class="code" href="../../d3/d1/threads_8h.html#a37">00409</a> <span class="preprocessor"></span><span class="preprocessor">#define DPRN3 (DPRN &amp; 0x8)</span>
<a name="l00410"></a><a class="code" href="../../d3/d1/threads_8h.html#a38">00410</a> <span class="preprocessor"></span><span class="preprocessor">#define DPRN4 (DPRN &amp; 0x10)</span>
00411 <span class="preprocessor"></span>
00412 
00413 
00414 <span class="comment">// Prototypes for thread pool private functions</span>
00415 
00416 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00417 <a class="code" href="../../d2/d1/threads_8c.html#a24">RtlpInitializeWorkerThreadPool</a> (
00418     ) ;
00419 
00420 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00421 <a class="code" href="../../d2/d1/threads_8c.html#a32">RtlpInitializeWaitThreadPool</a> (
00422     ) ;
00423 
00424 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00425 <a class="code" href="../../d2/d1/threads_8c.html#a63">RtlpInitializeTimerThreadPool</a> (
00426     ) ;
00427 
00428 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00429 <a class="code" href="../../d3/d1/threads_8h.html#a116">RtlpStartThread</a> (
00430     IN  PUSER_THREAD_START_ROUTINE Function,
00431     OUT HANDLE *ThreadHandle
00432     ) ;
00433 
00434 LONG
00435 <a class="code" href="../../d3/d1/threads_8h.html#a117">RtlpWaitThread</a> (
00436     IN PVOID  WaitHandle
00437     ) ;
00438 
00439 LONG
00440 <a class="code" href="../../d3/d1/threads_8h.html#a118">RtlpWorkerThread</a> (
00441     PVOID  NotUsed
00442     ) ;
00443 
00444 LONG
00445 <a class="code" href="../../d3/d1/threads_8h.html#a119">RtlpIOWorkerThread</a> (
00446     PVOID  NotUsed
00447     ) ;
00448 
00449 LONG
00450 <a class="code" href="../../d3/d1/threads_8h.html#a120">RtlpTimerThread</a> (
00451     PVOID  NotUsed
00452     ) ;
00453 
00454 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00455 <a class="code" href="../../d3/d1/threads_8h.html#a121">RtlpAddTimerQueue</a> (
00456     PVOID Queue
00457     ) ;
00458 
00459 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00460 <a class="code" href="../../d3/d1/threads_8h.html#a122">RtlpAddTimer</a> (
00461     PRTLP_TIMER Timer
00462     ) ;
00463 
00464 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00465 <a class="code" href="../../d3/d1/threads_8h.html#a123">RtlpResetTimer</a> (
00466     HANDLE TimerHandle,
00467     ULONG DueTime,
00468     PRTLP_WAIT_THREAD_CONTROL_BLOCK ThreadCB
00469     ) ;
00470 
00471 
00472 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00473 <a class="code" href="../../d3/d1/threads_8h.html#a124">RtlpFireTimersAndReorder</a> (
00474     PRTLP_TIMER_QUEUE Queue,
00475     ULONG *NewFiringTime,
00476     PLIST_ENTRY TimersToFireList
00477     ) ;
00478 
00479 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00480 <a class="code" href="../../d3/d1/threads_8h.html#a125">RtlpFireTimers</a> (
00481     PLIST_ENTRY TimersToFireList
00482     ) ;
00483 
00484 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00485 <a class="code" href="../../d3/d1/threads_8h.html#a126">RtlpInsertTimersIntoDeltaList</a> (
00486     PLIST_ENTRY NewTimerList,
00487     PLIST_ENTRY DeltaTimerList,
00488     ULONG TimeRemaining,
00489     ULONG *NewFiringTime
00490     ) ;
00491 
00492 BOOLEAN
00493 <a class="code" href="../../d3/d1/threads_8h.html#a127">RtlpInsertInDeltaList</a> (
00494     PLIST_ENTRY DeltaList,
00495     PRTLP_GENERIC_TIMER NewTimer,
00496     ULONG TimeRemaining,
00497     ULONG *NewFiringTime
00498     ) ;
00499 
00500 BOOLEAN
00501 <a class="code" href="../../d3/d1/threads_8h.html#a128">RtlpRemoveFromDeltaList</a> (
00502     PLIST_ENTRY DeltaList,
00503     PRTLP_GENERIC_TIMER Timer,
00504     ULONG TimeRemaining,
00505     ULONG* NewFiringTime
00506     ) ;
00507 
00508 BOOLEAN
00509 <a class="code" href="../../d3/d1/threads_8h.html#a129">RtlpReOrderDeltaList</a> (
00510     PLIST_ENTRY DeltaList,
00511     PRTLP_GENERIC_TIMER Timer,
00512     ULONG TimeRemaining,
00513     ULONG* NewFiringTime,
00514     ULONG ChangedFiringTime
00515     ) ;
00516 
00517 
00518 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00519 <a class="code" href="../../d3/d1/threads_8h.html#a130">RtlpAddWait</a> (
00520     PRTLP_WAIT Wait
00521     ) ;
00522 
00523 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00524 <a class="code" href="../../d3/d1/threads_8h.html#a131">RtlpDeregisterWait</a> (
00525     PRTLP_WAIT Wait,
00526     HANDLE PartialCompletionEvent,
00527     PULONG StatusPtr
00528     ) ;
00529 
00530 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00531 <a class="code" href="../../d3/d1/threads_8h.html#a132">RtlpDeactivateWait</a> (
00532     PRTLP_WAIT Wait
00533     ) ;
00534 
00535 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00536 <a class="code" href="../../d3/d1/threads_8h.html#a133">RtlpDeleteWait</a> (
00537     PRTLP_WAIT Wait
00538     ) ;
00539 
00540 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00541 <a class="code" href="../../d3/d1/threads_8h.html#a134">RtlpProcessWaitCompletion</a> (
00542     PRTLP_WAIT Wait,
00543     ULONG ArrayIndex
00544     ) ;
00545 
00546 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00547 <a class="code" href="../../d3/d1/threads_8h.html#a135">RtlpProcessTimeouts</a> (
00548     PRTLP_WAIT_THREAD_CONTROL_BLOCK ThreadCB
00549     ) ;
00550 
00551 ULONG
00552 <a class="code" href="../../d3/d1/threads_8h.html#a136">RtlpGetTimeRemaining</a> (
00553     HANDLE TimerHandle
00554     ) ;
00555 
00556 
00557 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00558 <a class="code" href="../../d3/d1/threads_8h.html#a137">RtlpServiceTimer</a> (
00559     PVOID NotUsedArg,
00560     ULONG NotUsedLowTimer,
00561     LONG NotUsedHighTimer
00562     ) ;
00563 
00564 ULONG
00565 <a class="code" href="../../d3/d1/threads_8h.html#a138">RtlpGetQueueRelativeTime</a> (
00566     PRTLP_TIMER_QUEUE Queue
00567     ) ;
00568 
00569 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00570 <a class="code" href="../../d3/d1/threads_8h.html#a139">RtlpCancelTimer</a> (
00571     PRTLP_TIMER TimerToCancel
00572     ) ;
00573 
00574 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00575 <a class="code" href="../../d3/d1/threads_8h.html#a140">RtlpCancelTimerEx</a> (
00576     PRTLP_TIMER Timer,
00577     BOOLEAN DeletingQueue
00578     ) ;
00579 
00580 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00581 <a class="code" href="../../d3/d1/threads_8h.html#a141">RtlpDeactivateTimer</a> (
00582     PRTLP_TIMER_QUEUE Queue,
00583     PRTLP_TIMER Timer
00584     ) ;
00585 
00586 
00587 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00588 <a class="code" href="../../d3/d1/threads_8h.html#a142">RtlpDeleteTimerQueue</a> (
00589     PRTLP_TIMER_QUEUE Queue
00590     ) ;
00591 
00592 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00593 <a class="code" href="../../d3/d1/threads_8h.html#a143">RtlpDeleteTimerQueueComplete</a> (
00594     PRTLP_TIMER_QUEUE Queue
00595     ) ;
00596 
00597 LONGLONG
00598 <a class="code" href="../../d3/d1/threads_8h.html#a144">Rtlp64BitTickCount</a>(
00599     ) ;
00600 
00601 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00602 <a class="code" href="../../d3/d1/threads_8h.html#a145">RtlpFindWaitThread</a> (
00603     PRTLP_WAIT_THREAD_CONTROL_BLOCK *ThreadCB
00604     ) ;
00605 
00606 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00607 <a class="code" href="../../d3/d1/threads_8h.html#a146">RtlpExecuteIOWorkItem</a> (
00608     PVOID Function,
00609     PVOID Context,
00610     PVOID NotUsed
00611     ) ;
00612 
00613 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00614 <a class="code" href="../../d3/d1/threads_8h.html#a147">RtlpExecuteLongIOWorkItem</a> (
00615     PVOID Function,
00616     PVOID Context,
00617     PVOID NotUsed
00618     ) ;
00619 
00620 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00621 <a class="code" href="../../d3/d1/threads_8h.html#a148">RtlpQueueIOWorkerRequest</a> (
00622     WORKERCALLBACKFUNC Function,
00623     PVOID Context,
00624     ULONG Flags
00625     ) ;
00626 
00627 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00628 <a class="code" href="../../d2/d1/threads_8c.html#a21">RtlpStartWorkerThread</a> (
00629     ) ;
00630 
00631 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00632 <a class="code" href="../../d2/d1/threads_8c.html#a22">RtlpStartIOWorkerThread</a> (
00633     ) ;
00634 
00635 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00636 <a class="code" href="../../d3/d1/threads_8h.html#a151">RtlpWorkerThreadTimerCallback</a>(
00637     PVOID Context,
00638     BOOLEAN NotUsed
00639     ) ;
00640 
00641 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00642 <a class="code" href="../../d3/d1/threads_8h.html#a152">RtlpQueueWorkerRequest</a> (
00643     WORKERCALLBACKFUNC Function,
00644     PVOID Context,
00645     ULONG Flags
00646     ) ;
00647 
00648 
<a name="l00649"></a><a class="code" href="../../d3/d1/threads_8h.html#a39">00649</a> <span class="preprocessor">#define THREAD_TYPE_WORKER 1</span>
<a name="l00650"></a><a class="code" href="../../d3/d1/threads_8h.html#a40">00650</a> <span class="preprocessor"></span><span class="preprocessor">#define THREAD_TYPE_IO_WORKER 2</span>
00651 <span class="preprocessor"></span>
00652 BOOLEAN
00653 <a class="code" href="../../d3/d1/threads_8h.html#a153">RtlpDoWeNeedNewWorkerThread</a> (
00654     ULONG ThreadType
00655     ) ;
00656 
00657 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00658 <a class="code" href="../../d3/d1/threads_8h.html#a154">RtlpUpdateTimer</a> (
00659     PRTLP_TIMER Timer,
00660     PRTLP_TIMER UpdatedTimer
00661     ) ;
00662 
00663 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00664 <a class="code" href="../../d3/d1/threads_8h.html#a155">RtlpDeleteTimer</a> (
00665     PRTLP_TIMER Timer
00666     ) ;
00667 
00668 <a class="code" href="../../d3/d1/threads_8h.html#a61">PRTLP_EVENT</a>
00669 <a class="code" href="../../d3/d1/threads_8h.html#a158">RtlpGetWaitEvent</a> (
00670     VOID
00671     ) ;
00672 
00673 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00674 <a class="code" href="../../d3/d1/threads_8h.html#a156">RtlpFreeWaitEvent</a> (
00675     PRTLP_EVENT Event
00676     ) ;
00677 
00678 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00679 <a class="code" href="../../d3/d1/threads_8h.html#a157">RtlpInitializeEventCache</a> (
00680     VOID
00681     ) ;
00682 
00683 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00684 <a class="code" href="../../d3/d1/threads_8h.html#a156">RtlpFreeWaitEvent</a> (
00685     PRTLP_EVENT Event
00686     ) ;
00687 
00688 <a class="code" href="../../d3/d1/threads_8h.html#a61">PRTLP_EVENT</a>
00689 <a class="code" href="../../d3/d1/threads_8h.html#a158">RtlpGetWaitEvent</a> (
00690     VOID
00691     ) ;
00692 
00693 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00694 <a class="code" href="../../d3/d1/threads_8h.html#a159">RtlpDeleteWaitAPC</a> (
00695     PRTLP_WAIT_THREAD_CONTROL_BLOCK ThreadCB,
00696     PRTLP_WAIT Wait,
00697     HANDLE Handle
00698     ) ;
00699 
00700 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00701 <a class="code" href="../../d3/d1/threads_8h.html#a160">RtlpDoNothing</a> (
00702     PVOID NotUsed1,
00703     PVOID NotUsed2,
00704     PVOID NotUsed3
00705     ) ;
00706 
00707 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00708 <a class="code" href="../../d3/d1/threads_8h.html#a161">RtlpExecuteWorkerRequest</a> (
00709     NTSTATUS Status,
00710     PVOID Context,
00711     PVOID ActualFunction
00712     ) ;
00713 
00714 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00715 <a class="code" href="../../d3/d1/threads_8h.html#a162">RtlpInitializeTPHeap</a> (
00716     ) ;
00717 
00718 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00719 <a class="code" href="../../d3/d1/threads_8h.html#a163">RtlpWaitForEvent</a> (
00720     HANDLE Event,
00721     HANDLE ThreadHandle
00722     ) ;
00723 
00724 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00725 <a class="code" href="../../d2/d1/threads_8c.html#a66">RtlpThreadCleanup</a> (
00726     ) ;
00727 
00728 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00729 <a class="code" href="../../d3/d1/threads_8h.html#a165">RtlpWorkerThreadCleanup</a> (
00730     NTSTATUS Status,
00731     PVOID NotUsed,
00732     PVOID NotUsed2
00733     ) ;
00734 
00735 PVOID
00736 <a class="code" href="../../d3/d1/threads_8h.html#a166">RtlpForceAllocateTPHeap</a>(
00737     ULONG dwSize,
00738     ULONG dwFlags
00739     );
00740     
00741 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00742 <a class="code" href="../../d3/d1/threads_8h.html#a167">RtlpWorkerThreadInitializeTimers</a>(
00743     PVOID Context
00744     );
00745 
00746 
00747 NTSYSAPI
00748 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00749 NTAPI
00750 <a class="code" href="../../d3/d1/threads_8h.html#a168">RtlThreadPoolCleanup</a> (
00751     ULONG Flags
00752     ) ;
00753 
00754 <span class="comment">//to make sure that a wait is not deleted before being registered</span>
<a name="l00755"></a><a class="code" href="../../d3/d1/threads_8h.html#a41">00755</a> <span class="preprocessor">#define STATE_REGISTERED   0x0001</span>
00756 <span class="preprocessor"></span>
00757 <span class="comment">//set when wait registered. Removed when one shot wait fired.</span>
00758 <span class="comment">//when deregisterWait called, tells whether to be removed from ActiveArray</span>
00759 <span class="comment">//If timer active, then have to remove it from delta list and reset the timer.</span>
<a name="l00760"></a><a class="code" href="../../d3/d1/threads_8h.html#a42">00760</a> <span class="preprocessor">#define STATE_ACTIVE       0x0002</span>
00761 <span class="preprocessor"></span>
00762 <span class="comment">//when deregister wait is called(RefCount may be &gt;0)</span>
<a name="l00763"></a><a class="code" href="../../d3/d1/threads_8h.html#a43">00763</a> <span class="preprocessor">#define STATE_DELETE       0x0004</span>
00764 <span class="preprocessor"></span>
00765 <span class="comment">//set when cancel timer called. The APC will clean it up.</span>
<a name="l00766"></a><a class="code" href="../../d3/d1/threads_8h.html#a44">00766</a> <span class="preprocessor">#define STATE_DONTFIRE     0x0008</span>
00767 <span class="preprocessor"></span>
00768 <span class="comment">//set when one shot timer fired.</span>
<a name="l00769"></a><a class="code" href="../../d3/d1/threads_8h.html#a45">00769</a> <span class="preprocessor">#define STATE_ONE_SHOT_FIRED 0x0010</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:58 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
