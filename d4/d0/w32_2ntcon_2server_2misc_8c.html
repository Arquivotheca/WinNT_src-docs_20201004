<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: w32/ntcon/server/misc.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>misc.c File Reference</h1><code>#include "<a class="el" href="../../d7/d2/w32_2ntcon_2server_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/struct__FONTENUMDC.html">_FONTENUMDC</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a0">FONT_BUFFER_SIZE</a>&nbsp;&nbsp;&nbsp;12</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a1">FE_ABANDONFONT</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a2">FE_FONTOK</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a3">NOT_CREATED_NOR_FOUND</a>&nbsp;&nbsp;&nbsp;-1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a4">CREATED_BUT_NOT_FOUND</a>&nbsp;&nbsp;&nbsp;-2</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d9/struct__FONTENUMDC.html">_FONTENUMDC</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a13">FONTENUMDC</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d9/struct__FONTENUMDC.html">_FONTENUMDC</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a14">PFONTENUMDC</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a18">GetMouseButtons</a> (PULONG NumButtons)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a19">InitializeMouseButtons</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a20">AddFaceNode</a> (<a class="el" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a> *ppStart, LPWSTR pwsz)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a21">InitializeFonts</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a22">FontEnum</a> (LPENUMLOGFONTW lpLogFont, LPNEWTEXTMETRICW lpTextMetric, int nFontType, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a23">DoFontEnum</a> (HDC hDC, LPWSTR pwszFace, <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> TTPointSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a24">EnumerateFonts</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a25">FindCreateFont</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Family, LPWSTR pwszFace, COORD <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, LONG Weight, UINT CodePage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a26">FindTextBufferFontInfo</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN UINT CodePage, OUT <a class="el" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> TextFontInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a27">StoreTextBufferFontInfo</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN ULONG FontIndex, IN COORD FontSize, IN <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> FontFamily, IN LONG FontWeight, IN LPWSTR FaceName, IN UINT CodePage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a28">RemoveTextBufferFontInfo</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a29">GetNumFonts</a> (OUT PULONG NumFonts)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a30">GetAvailableFonts</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN BOOLEAN MaximumWindow, OUT PVOID <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN OUT PULONG NumFonts)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a31">GetFontSize</a> (IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> FontIndex, OUT PCOORD FontSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a32">GetCurrentFont</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN BOOLEAN MaximumWindow, OUT PULONG FontIndex, OUT PCOORD FontSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a33">SetScreenBufferFont</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN ULONG FontIndex, IN UINT CodePage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a34">SetFont</a> (IN OUT <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a> (IN UINT Codepage, IN LPWSTR Source, IN int SourceLength, OUT LPSTR Target, IN int TargetLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a> (IN UINT Codepage, IN LPSTR Source, IN int SourceLength, OUT LPWSTR Target, IN int TargetLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a37">ConvertOutputToUnicode</a> (IN UINT Codepage, IN LPSTR Source, IN int SourceLength, OUT LPWSTR Target, IN int TargetLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a38">CharToWcharGlyph</a> (IN UINT Codepage, IN char Ch)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a39">CharToWchar</a> (IN UINT Codepage, IN char Ch)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>char&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a40">WcharToChar</a> (IN UINT Codepage, IN WCHAR Wchar)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a41">ConvertOutputToOem</a> (IN UINT Codepage, IN LPWSTR Source, IN int SourceLength, OUT LPSTR Target, IN int TargetLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a42">RealUnicodeToFalseUnicode</a> (IN OUT LPWSTR Source, IN int SourceLength, IN UINT Codepage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a43">FalseUnicodeToRealUnicode</a> (IN OUT LPWSTR Source, IN int SourceLength, IN UINT Codepage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a44">InitializeCustomCP</a> ()</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a5">NumberOfMouseButtons</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d9/struct__FONT__INFO.html">PFONT_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a6">FontInfo</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a7">FontInfoLength</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a8">NumberOfFonts</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a9">DefaultFaceName</a> [LF_FACESIZE]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>COORD&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a10">DefaultFontSize</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a11">DefaultFontFamily</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a12">DefaultFontIndex</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CPTABLEINFO&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a15">GlyphCP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a16">GlyphTable</a> [256]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a17">gpFaceNames</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a4" doxytag="w32/ntcon/server/misc.c::CREATED_BUT_NOT_FOUND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CREATED_BUT_NOT_FOUND&nbsp;&nbsp;&nbsp;-2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="w32/ntcon/server/misc.c::FE_ABANDONFONT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FE_ABANDONFONT&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00056">56</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="w32/ntcon/server/misc.c::FE_FONTOK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FE_FONTOK&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00057">57</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00478">DoFontEnum()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="w32/ntcon/server/misc.c::FONT_BUFFER_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FONT_BUFFER_SIZE&nbsp;&nbsp;&nbsp;12          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00054">54</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="w32/ntcon/server/misc.c::NOT_CREATED_NOR_FOUND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NOT_CREATED_NOR_FOUND&nbsp;&nbsp;&nbsp;-1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a13" doxytag="w32/ntcon/server/misc.c::FONTENUMDC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d9/struct__FONTENUMDC.html">_FONTENUMDC</a>  <a class="el" href="../../d8/d9/struct__FONTENUMDC.html">FONTENUMDC</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="w32/ntcon/server/misc.c::PFONTENUMDC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d9/struct__FONTENUMDC.html">_FONTENUMDC</a> * <a class="el" href="../../d8/d9/struct__FONTENUMDC.html">PFONTENUMDC</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a20" doxytag="w32/ntcon/server/misc.c::AddFaceNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a> AddFaceNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppStart</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwsz</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00080">80</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l01106">tagFACENODE::awch</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l01105">tagFACENODE::dwFlag</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00072">FONT_TAG</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l01104">tagFACENODE::pNext</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>.
<p>
<pre class="fragment"><div>00080                                                        {
00081     <a class="code" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a> pNew;
00082     <a class="code" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a> *ppTmp;
00083     <span class="keywordtype">int</span> cb;
00084 
00085     <span class="comment">/*</span>
00086 <span class="comment">     * Is it already here?</span>
00087 <span class="comment">     */</span>
00088     <span class="keywordflow">for</span> (ppTmp = ppStart; *ppTmp; ppTmp = &amp;((*ppTmp)-&gt;pNext)) {
00089         <span class="keywordflow">if</span> (wcscmp(((*ppTmp)-&gt;awch), pwsz) == 0) {
00090             <span class="comment">// already there !</span>
00091             <span class="keywordflow">return</span> *ppTmp;
00092         }
00093     }
00094 
00095     cb = (wcslen(pwsz) + 1) * <span class="keyword">sizeof</span>(WCHAR);
00096     pNew = (<a class="code" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( FONT_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d4/structtagFACENODE.html">FACENODE</a>) + cb);
00097     <span class="keywordflow">if</span> (pNew == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00098         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00099     }
00100 
00101     pNew-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o0">pNext</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00102     pNew-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> = 0;
00103     wcscpy(pNew-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o2">awch</a>, pwsz);
00104     *ppTmp = pNew;
00105     <span class="keywordflow">return</span> pNew;
00106 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="w32/ntcon/server/misc.c::CharToWchar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR CharToWchar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN char&nbsp;</td>
          <td class="mdname" nowrap> <em>Ch</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01469">1469</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, and <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00576">RtlOemToUnicodeN()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00976">SB_TranslateOutputToUnicode()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00882">SrvScrollConsoleScreenBuffer()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l00165">TranslateInputToUnicode()</a>.
<p>
<pre class="fragment"><div>01473 {
01474     WCHAR wch;
01475     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01476         <a class="code" href="../../d9/d6/nlsxlat_8c.html#a34">RtlOemToUnicodeN</a>(&amp;wch, <span class="keyword">sizeof</span>(wch), NULL, &amp;Ch, <span class="keyword">sizeof</span>(Ch));
01477     } <span class="keywordflow">else</span> {
01478         MultiByteToWideChar(Codepage, 0, &amp;Ch, 1, &amp;wch, 1);
01479     }
01480 <span class="preprocessor">#ifdef DEBUG_PRINT</span>
01481 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Ch &gt; 0x7F) {
01482         <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"CharToWchar %d 0x%02x -&gt; 0x%04x\n"</span>,Codepage,(UCHAR)Ch,wch));
01483     }
01484 <span class="preprocessor">#endif</span>
01485 <span class="preprocessor"></span>    <span class="keywordflow">return</span> wch;
01486 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="w32/ntcon/server/misc.c::CharToWcharGlyph" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR CharToWcharGlyph           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN char&nbsp;</td>
          <td class="mdname" nowrap> <em>Ch</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01443">1443</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00050">GlyphCP</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, and <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01757">RtlCustomCPToUnicodeN()</a>.
<p>
<pre class="fragment"><div>01447 {
01448     WCHAR wch;
01449     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01450         <a class="code" href="../../d9/d6/nlsxlat_8c.html#a42">RtlCustomCPToUnicodeN</a>(&amp;GlyphCP, &amp;wch, <span class="keyword">sizeof</span>(wch), NULL, &amp;Ch, <span class="keyword">sizeof</span>(Ch));
01451     } <span class="keywordflow">else</span> {
01452         MultiByteToWideChar(Codepage, MB_USEGLYPHCHARS, &amp;Ch, 1, &amp;wch, 1);
01453     }
01454 <span class="preprocessor">#ifdef DEBUG_PRINT</span>
01455 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Ch &gt; 0x7F) {
01456         <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"CharToWcharGlyph %d 0x%02x -&gt; 0x%04x\n"</span>,Codepage,(UCHAR)Ch,wch));
01457     }
01458 <span class="preprocessor">#endif</span>
01459 <span class="preprocessor"></span>    <span class="keywordflow">return</span> wch;
01460 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="w32/ntcon/server/misc.c::ConvertInputToUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int ConvertInputToUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">1345</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00576">RtlOemToUnicodeN()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00329">AddExeAliasList()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04929">SrvSetConsoleTitle()</a>.
<p>
<pre class="fragment"><div>01355 {
01356     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"ConvertInputToUnicode %d-&gt;U %.*s\n"</span>, Codepage,
01357             SourceLength &gt; 10 ? 10 : SourceLength, Source));
01358     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01359         ULONG Length;
01360         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01361 
01362         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a34">RtlOemToUnicodeN</a>(Target,
01363                                   TargetLength * <span class="keyword">sizeof</span>(WCHAR),
01364                                   &amp;Length,
01365                                   Source,
01366                                   SourceLength
01367                                  );
01368         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01369             <span class="keywordflow">return</span> 0;
01370         } <span class="keywordflow">else</span> {
01371             <span class="keywordflow">return</span> Length / <span class="keyword">sizeof</span>(WCHAR);
01372         }
01373     } <span class="keywordflow">else</span> {
01374         <span class="keywordflow">return</span> MultiByteToWideChar(Codepage,
01375                                    0,
01376                                    Source,
01377                                    SourceLength,
01378                                    Target,
01379                                    TargetLength);
01380     }
01381 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="w32/ntcon/server/misc.c::ConvertOutputToOem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int ConvertOutputToOem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01508">1508</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01277">RtlUnicodeToOemN()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00467">STACK_BUFFER_SIZE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, and <a class="el" href="../../d4/d9/w32_2ntcon_2fullscr_2vga_2misc_8c-source.html#l00086">TranslateOutputToOem()</a>.
<p>
<pre class="fragment"><div>01521 {
01522     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01523         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01524         ULONG Length;
01525         <span class="comment">// Can do this in place</span>
01526         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a39">RtlUnicodeToOemN</a>(Target,
01527                                   TargetLength,
01528                                   &amp;Length,
01529                                   Source,
01530                                   SourceLength * <span class="keyword">sizeof</span>(WCHAR)
01531                                  );
01532         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01533             <span class="keywordflow">return</span> Length;
01534         } <span class="keywordflow">else</span> {
01535             <span class="keywordflow">return</span> 0;
01536         }
01537     } <span class="keywordflow">else</span> {
01538         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Source != (LPWSTR)Target);
01539 <span class="preprocessor">#ifdef SOURCE_EQ_TARGET</span>
01540 <span class="preprocessor"></span>        LPSTR pszDestTmp;
01541         <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> StackBuffer[<a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>];
01542 
01543         <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"ConvertOutputToOem U-&gt;%d %.*ls\n"</span>, Codepage,
01544                 SourceLength &gt; 10 ? 10 : SourceLength, Source));
01545 
01546         <span class="keywordflow">if</span> (TargetLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01547             pszDestTmp = (LPSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),TargetLength);
01548             <span class="keywordflow">if</span> (pszDestTmp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01549                 <span class="keywordflow">return</span> 0;
01550             }
01551         } <span class="keywordflow">else</span> {
01552             pszDestTmp = StackBuffer;
01553         }
01554         TargetLength = WideCharToMultiByte(Codepage, 0,
01555                 Source, SourceLength,
01556                 pszDestTmp, TargetLength, NULL, NULL);
01557 
01558         RtlCopyMemory(Target, pszDestTmp, TargetLength);
01559         <span class="keywordflow">if</span> (pszDestTmp != StackBuffer) {
01560             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(pszDestTmp);
01561         }
01562         <span class="keywordflow">return</span> TargetLength;
01563 <span class="preprocessor">#else</span>
01564 <span class="preprocessor"></span>        <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"ConvertOutputToOem U-&gt;%d %.*ls\n"</span>, Codepage,
01565                 SourceLength &gt; 10 ? 10 : SourceLength, Source));
01566         <span class="keywordflow">return</span> WideCharToMultiByte(Codepage, 0,
01567                 Source, SourceLength, Target, TargetLength, NULL, NULL);
01568 <span class="preprocessor">#endif</span>
01569 <span class="preprocessor"></span>    }
01570 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="w32/ntcon/server/misc.c::ConvertOutputToUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int ConvertOutputToUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01384">1384</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00050">GlyphCP</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01757">RtlCustomCPToUnicodeN()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00467">STACK_BUFFER_SIZE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/__stream_8h-source.html#l01020">WWSB_DoSrvWriteConsole()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01530">WWSB_FillOutput()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01002">WWSB_WriteOutputString()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l00187">WWSB_WriteRectToScreenBuffer()</a>.
<p>
<pre class="fragment"><div>01396 {
01397     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01398     ULONG Length;
01399     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> StackBuffer[<a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>];
01400     LPSTR pszT;
01401 
01402     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"ConvertOutputToUnicode %d-&gt;U %.*s\n"</span>, Codepage,
01403             SourceLength &gt; 10 ? 10 : SourceLength, Source));
01404     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01405         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a42">RtlCustomCPToUnicodeN</a>(&amp;GlyphCP,
01406                            Target,
01407                            TargetLength * <span class="keyword">sizeof</span>(WCHAR),
01408                            &amp;Length,
01409                            Source,
01410                            SourceLength
01411                           );
01412         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01413             <span class="keywordflow">return</span> 0;
01414         } <span class="keywordflow">else</span> {
01415             <span class="keywordflow">return</span> Length / <span class="keyword">sizeof</span>(WCHAR);
01416         }
01417     }
01418 
01419     <span class="keywordflow">if</span> (TargetLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01420         pszT = (LPSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),SourceLength);
01421         <span class="keywordflow">if</span> (pszT == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01422             <span class="keywordflow">return</span> 0;
01423         }
01424     } <span class="keywordflow">else</span> {
01425         pszT = StackBuffer;
01426     }
01427     RtlCopyMemory(pszT, Source, SourceLength);
01428     Length = MultiByteToWideChar(Codepage, MB_USEGLYPHCHARS,
01429             pszT, SourceLength, Target, TargetLength);
01430     <span class="keywordflow">if</span> (pszT != StackBuffer) {
01431         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(pszT);
01432     }
01433     <span class="keywordflow">return</span> Length;
01434 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="w32/ntcon/server/misc.c::ConvertToOem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int ConvertToOem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">1307</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01277">RtlUnicodeToOemN()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00835">DoStringPaste()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00471">RawReadWaitRoutine()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00903">SrvGetConsoleAliases()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01029">SrvGetConsoleAliasExes()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01500">SrvGetConsoleCommandHistory()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04879">SrvGetConsoleTitle()</a>.
<p>
<pre class="fragment"><div>01314 {
01315     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"ConvertToOem U-&gt;%d %.*ls\n"</span>, Codepage,
01316             SourceLength &gt; 10 ? 10 : SourceLength, Source));
01317     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01318         ULONG Length;
01319         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01320 
01321         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a39">RtlUnicodeToOemN</a>(Target,
01322                                   TargetLength,
01323                                   &amp;Length,
01324                                   Source,
01325                                   SourceLength * <span class="keyword">sizeof</span>(WCHAR)
01326                                  );
01327         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01328             <span class="keywordflow">return</span> 0;
01329         } <span class="keywordflow">else</span> {
01330             <span class="keywordflow">return</span> Length;
01331         }
01332     } <span class="keywordflow">else</span> {
01333         <span class="keywordflow">return</span> WideCharToMultiByte(Codepage,
01334                                    0,
01335                                    Source,
01336                                    SourceLength,
01337                                    Target,
01338                                    TargetLength,
01339                                    NULL,
01340                                    NULL);
01341     }
01342 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="w32/ntcon/server/misc.c::DoFontEnum" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DoFontEnum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hDC</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwszFace</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TTPointSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00478">478</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00042">_FONTENUMDC::bFindFaces</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00038">DBGFONTS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00057">FE_FONTOK</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00041">_FONTENUMDC::hDC</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00043">_FONTENUMDC::TTPointSize</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00044">_FONTENUMDC::ulFE</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>.
<p>
<pre class="fragment"><div>00482 {
00483     ULONG ulFE = 0;
00484     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bDeleteDC = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00485     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bFindFaces = (pwszFace == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00486     <a class="code" href="../../d8/d9/struct__FONTENUMDC.html">FONTENUMDC</a> fed;
00487     LOGFONTW LogFont;
00488 
00489     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"DoFontEnum \"%ls\"\n"</span>, pwszFace));
00490     <span class="keywordflow">if</span> (hDC == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00491         hDC = CreateDCW(L<span class="stringliteral">"DISPLAY"</span>,NULL,NULL,NULL);
00492         bDeleteDC = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00493     }
00494 
00495     fed.<a class="code" href="../../d8/d9/struct__FONTENUMDC.html#o0">hDC</a> = hDC;
00496     fed.<a class="code" href="../../d8/d9/struct__FONTENUMDC.html#o1">bFindFaces</a> = bFindFaces;
00497     fed.<a class="code" href="../../d8/d9/struct__FONTENUMDC.html#o3">ulFE</a> = 0;
00498     fed.<a class="code" href="../../d8/d9/struct__FONTENUMDC.html#o2">TTPointSize</a> = TTPointSize;
00499     RtlZeroMemory(&amp;LogFont, <span class="keyword">sizeof</span>(LOGFONT));
00500     LogFont.lfCharSet = DEFAULT_CHARSET;
00501     <span class="keywordflow">if</span> (pwszFace)
00502         wcscpy(LogFont.lfFaceName, pwszFace);
00503     <span class="comment">/*</span>
00504 <span class="comment">     * EnumFontFamiliesEx function enumerates one font in every face in every character set.</span>
00505 <span class="comment">     */</span>
00506     EnumFontFamiliesExW(hDC, &amp;LogFont, (FONTENUMPROC)FontEnum, (LPARAM)&amp;fed, 0);
00507     <span class="keywordflow">if</span> (bDeleteDC) {
00508         DeleteDC(hDC);
00509     }
00510     <span class="keywordflow">return</span> (fed.<a class="code" href="../../d8/d9/struct__FONTENUMDC.html#o3">ulFE</a> &amp; <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a2">FE_FONTOK</a>) != 0;
00511 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="w32/ntcon/server/misc.c::EnumerateFonts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS EnumerateFonts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Flags</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">515</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00080">AddFaceNode()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l01106">tagFACENODE::awch</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00038">DBGFONTS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00035">DefaultFaceName</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00045">DefaultFontFamily</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00043">DefaultFontIndex</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00044">DefaultFontSize</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00478">DoFontEnum()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l01105">tagFACENODE::dwFlag</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00930">EF_DEFFACE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00927">EF_ENUMERATED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00925">EF_NEW</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00928">EF_OEMFONT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00926">EF_OLD</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00929">EF_TTFONT</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00044">_FONT_INFO::Family</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00072">FONT_TAG</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00032">FontInfoLength</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00062">gpFaceNames</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00022">INITIAL_FONTS</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l01104">tagFACENODE::pNext</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d8/d5/font_8h-source.html#l00040">_FONT_INFO::Size</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01946">ConsoleInputThread()</a>.
<p>
<pre class="fragment"><div>00517 {
00518     TEXTMETRIC tmi;
00519     HDC hDC;
00520     <a class="code" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a> pFN;
00521     ULONG ulOldEnumFilter;
00522     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> FontIndex;
00523     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwFontType = 0;
00524 
00525     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"EnumerateFonts %lx\n"</span>, Flags));
00526 
00527     dwFontType = (<a class="code" href="../../d8/d5/consrv_8h.html#a54">EF_TTFONT</a>|<a class="code" href="../../d8/d5/consrv_8h.html#a53">EF_OEMFONT</a>|<a class="code" href="../../d8/d5/consrv_8h.html#a55">EF_DEFFACE</a>) &amp; Flags;
00528 
00529     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00530         <span class="comment">//</span>
00531         <span class="comment">// allocate memory for the font array</span>
00532         <span class="comment">//</span>
00533         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a> = 0;
00534 
00535         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a> = (<a class="code" href="../../d5/d9/struct__FONT__INFO.html">PFONT_INFO</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( FONT_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d9/struct__FONT__INFO.html">FONT_INFO</a>) * INITIAL_FONTS);
00536         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00537             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00538         <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a7">FontInfoLength</a> = <a class="code" href="../../d7/d6/font_8h.html#a0">INITIAL_FONTS</a>;
00539     }
00540 
00541     hDC = CreateDCW(L<span class="stringliteral">"DISPLAY"</span>,NULL,NULL,NULL);
00542 
00543     <span class="comment">// Before enumeration, turn off font enumeration filters.</span>
00544     ulOldEnumFilter = SetFontEnumeration(0);
00545     <span class="comment">// restore all the other flags</span>
00546     SetFontEnumeration(ulOldEnumFilter &amp; ~FE_FILTER_TRUETYPE);
00547 
00548     <span class="keywordflow">if</span> (Flags &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a55">EF_DEFFACE</a>) {
00549         SelectObject(hDC,GetStockObject(OEM_FIXED_FONT));
00550 
00551         <span class="keywordflow">if</span> (GetTextMetricsW(hDC, &amp;tmi)) {
00552             <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(tmi.tmMaxCharWidth);
00553             <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(tmi.tmHeight+tmi.tmExternalLeading);
00554             <a class="code" href="../../d0/d3/dbcs_8h.html#a15">DefaultFontFamily</a> = tmi.tmPitchAndFamily;
00555 <span class="preprocessor">#if defined(FE_SB)</span>
00556 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (IS_ANY_DBCS_CHARSET(tmi.tmCharSet))
00557                 <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X /= 2;
00558 <span class="preprocessor">#endif</span>
00559 <span class="preprocessor"></span>        }
00560         GetTextFaceW(hDC, LF_FACESIZE, DefaultFaceName);
00561 <span class="preprocessor">#if defined(FE_SB)</span>
00562 <span class="preprocessor"></span>        <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"Default (OEM) Font %ls (%d,%d) CharSet 0x%02X\n"</span>, DefaultFaceName,
00563                 <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X, <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y,
00564                 tmi.tmCharSet));
00565 <span class="preprocessor">#else</span>
00566 <span class="preprocessor"></span>        <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"Default (OEM) Font %ls (%d,%d)\n"</span>, DefaultFaceName,
00567                 <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X, <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y));
00568 <span class="preprocessor">#endif</span>
00569 <span class="preprocessor"></span>
00570         <span class="comment">// Make sure we are going to enumerate the OEM face.</span>
00571         pFN = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a20">AddFaceNode</a>(&amp;gpFaceNames, DefaultFaceName);
00572         pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> |= <a class="code" href="../../d8/d5/consrv_8h.html#a55">EF_DEFFACE</a> | <a class="code" href="../../d8/d5/consrv_8h.html#a53">EF_OEMFONT</a>;
00573     }
00574 
00575     <span class="comment">// Use DoFontEnum to get all fonts from the system.  Our FontEnum</span>
00576     <span class="comment">// proc puts just the ones we want into an array</span>
00577     <span class="comment">//</span>
00578     <span class="keywordflow">for</span> (pFN = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a17">gpFaceNames</a>; pFN; pFN = pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o0">pNext</a>) {
00579         <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"\"%ls\" is %s%s%s%s%s%s\n"</span>, pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o2">awch</a>,
00580             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_NEW        ? <span class="stringliteral">"NEW "</span>        : <span class="stringliteral">" "</span>,
00581             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_OLD        ? <span class="stringliteral">"OLD "</span>        : <span class="stringliteral">" "</span>,
00582             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_ENUMERATED ? <span class="stringliteral">"ENUMERATED "</span> : <span class="stringliteral">" "</span>,
00583             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_OEMFONT    ? <span class="stringliteral">"OEMFONT "</span>    : <span class="stringliteral">" "</span>,
00584             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_TTFONT     ? <span class="stringliteral">"TTFONT "</span>     : <span class="stringliteral">" "</span>,
00585             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; EF_DEFFACE    ? <span class="stringliteral">"DEFFACE "</span>    : <span class="stringliteral">" "</span>));
00586 
00587         <span class="keywordflow">if</span> ((pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; dwFontType) == 0) {
00588             <span class="comment">// not the kind of face we want</span>
00589             <span class="keywordflow">continue</span>;
00590         }
00591         <span class="keywordflow">if</span> (pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> &amp; <a class="code" href="../../d8/d5/consrv_8h.html#a52">EF_ENUMERATED</a>) {
00592             <span class="comment">// we already enumerated this face</span>
00593             <span class="keywordflow">continue</span>;
00594         }
00595 
00596         <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a23">DoFontEnum</a>(hDC, pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o2">awch</a>, <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y);
00597         pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> |= <a class="code" href="../../d8/d5/consrv_8h.html#a52">EF_ENUMERATED</a>;
00598     }
00599 
00600 
00601     <span class="comment">// After enumerating fonts, restore the font enumeration filter.</span>
00602     SetFontEnumeration(ulOldEnumFilter);
00603 
00604     DeleteDC(hDC);
00605 
00606     <span class="comment">// Make sure the default font is set correctly</span>
00607     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a> &gt; 0 &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X == 0 &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y == 0) {
00608         <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[0].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X;
00609         <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[0].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y;
00610         <a class="code" href="../../d0/d3/dbcs_8h.html#a15">DefaultFontFamily</a> = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[0].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a>;
00611     }
00612 
00613     <span class="keywordflow">for</span> (FontIndex = 0; FontIndex &lt; <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>; FontIndex++) {
00614         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndex].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X == <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X &amp;&amp;
00615             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndex].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y == <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y &amp;&amp;
00616             <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndex].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a> == <a class="code" href="../../d0/d3/dbcs_8h.html#a15">DefaultFontFamily</a>) {
00617 <span class="preprocessor">#if defined(FE_SB)</span>
00618 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00619                 !IS_ANY_DBCS_CHARSET(FontInfo[FontIndex].tmCharSet))
00620             {
00621                 <span class="keywordflow">continue</span> ;
00622             }
00623 <span class="preprocessor">#endif</span>
00624 <span class="preprocessor"></span>            <span class="keywordflow">break</span>;
00625         }
00626     }
00627     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FontIndex &lt; NumberOfFonts);
00628     <span class="keywordflow">if</span> (FontIndex &lt; <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>) {
00629         <a class="code" href="../../d0/d3/dbcs_8h.html#a13">DefaultFontIndex</a> = FontIndex;
00630     } <span class="keywordflow">else</span> {
00631         <a class="code" href="../../d0/d3/dbcs_8h.html#a13">DefaultFontIndex</a> = 0;
00632     }
00633     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"EnumerateFonts : DefaultFontIndex = %ld\n"</span>, DefaultFontIndex));
00634 
00635     <span class="keywordflow">return</span> STATUS_SUCCESS;
00636 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="w32/ntcon/server/misc.c::FalseUnicodeToRealUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FalseUnicodeToRealUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">1676</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00050">GlyphCP</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01757">RtlCustomCPToUnicodeN()</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00905">RtlUnicodeToMultiByteN()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00467">STACK_BUFFER_SIZE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00026">USACP</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00026">WINDOWSCP</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04346">DrawCommandListPopup()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00924">SB_TranslateOutputToOemUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, and <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00452">StoreSelection()</a>.
<p>
<pre class="fragment"><div>01689 {
01690     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01691     LPSTR Temp;
01692     ULONG TempLength;
01693     ULONG Length;
01694     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> StackBuffer[<a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>];
01695     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> NormalChars;
01696     <span class="keywordtype">int</span> i;
01697 
01698     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"UnicodeAnsiToUnicodeAnsi U-&gt;ACP:%d-&gt;U %.*ls\n"</span>, Codepage,
01699             SourceLength &gt; 10 ? 10 : SourceLength, Source));
01700 <span class="preprocessor">#if defined(FE_SB)</span>
01701 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a> == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a> &amp;&amp; Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>)
01702         <span class="keywordflow">return</span> STATUS_SUCCESS;
01703     <span class="keywordflow">if</span> (SourceLength == 0 )
01704         <span class="keywordflow">return</span> STATUS_SUCCESS;
01705 <span class="preprocessor">#endif</span>
01706 <span class="preprocessor"></span>    NormalChars = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01707     <span class="comment">/*</span>
01708 <span class="comment">     * Test for characters &lt; 0x20 or &gt;= 0x7F.  If none are found, we don't have</span>
01709 <span class="comment">     * any conversion to do!</span>
01710 <span class="comment">     */</span>
01711     <span class="keywordflow">for</span> (i=0;i&lt;SourceLength;i++) {
01712         <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Source[i] - 0x20) &gt; 0x5e) {
01713             NormalChars = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01714             <span class="keywordflow">break</span>;
01715         }
01716     }
01717     <span class="keywordflow">if</span> (NormalChars) {
01718         <span class="keywordflow">return</span> STATUS_SUCCESS;
01719     }
01720 
01721     TempLength = SourceLength;
01722     <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01723         Temp = (LPSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),TempLength);
01724         <span class="keywordflow">if</span> (Temp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01725             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01726         }
01727     } <span class="keywordflow">else</span> {
01728         Temp = StackBuffer;
01729     }
01730     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>()) {
01731         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = WideCharToMultiByte(USACP,
01732                                  0,
01733                                  Source,
01734                                  SourceLength,
01735                                  Temp,
01736                                  TempLength,
01737                                  NULL,
01738                                  NULL);
01739     } <span class="keywordflow">else</span> {
01740         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a37">RtlUnicodeToMultiByteN</a>(Temp,
01741                                     TempLength,
01742                                     &amp;Length,
01743                                     Source,
01744                                     SourceLength * <span class="keyword">sizeof</span>(WCHAR)
01745                                    );
01746     }
01747 
01748     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01749         <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01750             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Temp);
01751         }
01752         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01753     }
01754     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01755         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a42">RtlCustomCPToUnicodeN</a>(&amp;GlyphCP,
01756                                   Source,
01757                                   SourceLength * <span class="keyword">sizeof</span>(WCHAR),
01758                                   &amp;Length,
01759                                   Temp,
01760                                   TempLength
01761                                  );
01762     } <span class="keywordflow">else</span> {
01763         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = MultiByteToWideChar(Codepage,
01764                                    MB_USEGLYPHCHARS,
01765                                    Temp,
01766                                    TempLength*<span class="keyword">sizeof</span>(WCHAR),
01767                                    Source,
01768                                    SourceLength);
01769     }
01770 <span class="preprocessor">#if defined(FE_SB)</span>
01771 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (SourceLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01772         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Temp);
01773     }
01774 <span class="preprocessor">#else</span>
01775 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01776         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Temp);
01777     }
01778 <span class="preprocessor">#endif</span>
01779 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01780         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01781     } <span class="keywordflow">else</span> {
01782         <span class="keywordflow">return</span> STATUS_SUCCESS;
01783     }
01784 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="w32/ntcon/server/misc.c::FindCreateFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int FindCreateFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Family</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwszFace</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Weight</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>CodePage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">650</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a45">CodePageToCharSet()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a4">CREATED_BUT_NOT_FOUND</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00038">DBGFONTS</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00035">DefaultFaceName</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00043">DefaultFontIndex</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00044">DefaultFontSize</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00478">DoFontEnum()</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00044">_FONT_INFO::Family</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a50">GetAltFaceName()</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage()</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a48">IsAvailableTTFont()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a43">MakeAltRasterFont()</a>, <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a3">NOT_CREATED_NOR_FOUND</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00040">_FONT_INFO::Size</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00052">SIZE_EQUAL</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00041">_FONT_INFO::SizeWant</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00050">TM_IS_TT_FONT</a>, and <a class="el" href="../../d8/d5/font_8h-source.html#l00042">_FONT_INFO::Weight</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00270">DoCreateScreenBuffer()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l01607">SrvCreateConsoleScreenBuffer()</a>.
<p>
<pre class="fragment"><div>00656 {
00657 <span class="preprocessor">#define NOT_CREATED_NOR_FOUND -1</span>
00658 <span class="preprocessor"></span><span class="preprocessor">#define CREATED_BUT_NOT_FOUND -2</span>
00659 <span class="preprocessor"></span>
00660     <span class="keywordtype">int</span> i;
00661     <span class="keywordtype">int</span> FontIndex = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a3">NOT_CREATED_NOR_FOUND</a>;
00662     <span class="keywordtype">int</span> BestMatch = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a3">NOT_CREATED_NOR_FOUND</a>;
00663     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bFontOK;
00664     WCHAR AltFaceName[LF_FACESIZE];
00665     COORD AltFontSize;
00666     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>  AltFontFamily;
00667     ULONG AltFontIndex = 0;
00668     LPWSTR pwszAltFace = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00669 
00670     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> CharSet = <a class="code" href="../../d0/d3/dbcs_8h.html#a45">CodePageToCharSet</a>(CodePage);
00671 
00672     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"FindCreateFont Family=%x %ls (%d,%d) %d %d %x\n"</span>,
00673             Family, pwszFace, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y, Weight, CodePage, CharSet));
00674 
00675     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00676         !IS_ANY_DBCS_CHARSET(CharSet))
00677     {
00678         <a class="code" href="../../d0/d3/dbcs_8h.html#a43">MakeAltRasterFont</a>(CodePage, FontInfo[DefaultFontIndex].Size,
00679                           &amp;AltFontSize, &amp;AltFontFamily, &amp;AltFontIndex, AltFaceName);
00680 
00681         <span class="keywordflow">if</span> (pwszFace == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || *pwszFace == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>) {
00682             pwszFace = AltFaceName;
00683         }
00684         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y == 0) {
00685             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X = AltFontSize.X;
00686             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y = AltFontSize.Y;
00687         }
00688     }
00689     <span class="keywordflow">else</span> {
00690         <span class="keywordflow">if</span> (pwszFace == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || *pwszFace == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>) {
00691             pwszFace = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a9">DefaultFaceName</a>;
00692         }
00693         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y == 0) {
00694             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X = <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.X;
00695             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y = <a class="code" href="../../d0/d3/dbcs_8h.html#a14">DefaultFontSize</a>.Y;
00696         }
00697     }
00698 
00699     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d3/dbcs_8h.html#a48">IsAvailableTTFont</a>(pwszFace)) {
00700         pwszAltFace = <a class="code" href="../../d0/d3/dbcs_8h.html#a50">GetAltFaceName</a>(pwszFace);
00701     }
00702     <span class="keywordflow">else</span> {
00703         pwszAltFace = pwszFace;
00704     }
00705 
00706     <span class="comment">/*</span>
00707 <span class="comment">     * Try to find the exact font</span>
00708 <span class="comment">     */</span>
00709 TryFindExactFont:
00710     <span class="keywordflow">for</span> (i=0; i &lt; (<span class="keywordtype">int</span>)<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>; i++) {
00711         <span class="comment">/*</span>
00712 <span class="comment">         * If looking for a particular Family, skip non-matches</span>
00713 <span class="comment">         */</span>
00714         <span class="keywordflow">if</span> ((Family != 0) &amp;&amp;
00715                 ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)Family != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a>)) {
00716             <span class="keywordflow">continue</span>;
00717         }
00718 
00719         <span class="comment">/*</span>
00720 <span class="comment">         * Skip non-matching sizes</span>
00721 <span class="comment">         */</span>
00722         <span class="keywordflow">if</span> ((<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.Y != <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y) &amp;&amp;
00723              !<a class="code" href="../../d7/d6/font_8h.html#a4">SIZE_EQUAL</a>(FontInfo[i].Size, Size)) {
00724             <span class="keywordflow">continue</span>;
00725         }
00726 
00727         <span class="comment">/*</span>
00728 <span class="comment">         * Skip non-matching weights</span>
00729 <span class="comment">         */</span>
00730         <span class="keywordflow">if</span> ((Weight != 0) &amp;&amp; (Weight != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o3">Weight</a>)) {
00731             <span class="keywordflow">continue</span>;
00732         }
00733 <span class="preprocessor">#if defined(FE_SB)</span>
00734 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6/font_8h.html#a2">TM_IS_TT_FONT</a>(FontInfo[i].Family) &amp;&amp;
00735                 <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].tmCharSet != CharSet) {
00736             <span class="keywordflow">continue</span>;
00737         }
00738 <span class="preprocessor">#endif</span>
00739 <span class="preprocessor"></span>
00740         <span class="comment">/*</span>
00741 <span class="comment">         * Size (and maybe Family) match.</span>
00742 <span class="comment">         *  If we don't care about the name, or if it matches, use this font.</span>
00743 <span class="comment">         *  Else if name doesn't match and it is a raster font, consider it.</span>
00744 <span class="comment">         */</span>
00745         <span class="keywordflow">if</span> ((pwszFace == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (pwszFace[0] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>) ||
00746                 wcscmp(FontInfo[i].FaceName, pwszFace) == 0 ||
00747                 wcscmp(FontInfo[i].FaceName, pwszAltFace) == 0
00748            ) {
00749             FontIndex = i;
00750             <span class="keywordflow">goto</span> FoundFont;
00751         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6/font_8h.html#a2">TM_IS_TT_FONT</a>(FontInfo[i].Family)) {
00752             BestMatch = i;
00753         }
00754     }
00755 
00756     <span class="comment">/*</span>
00757 <span class="comment">     * Didn't find the exact font, so try to create it</span>
00758 <span class="comment">     */</span>
00759     <span class="keywordflow">if</span> (FontIndex == <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a3">NOT_CREATED_NOR_FOUND</a>) {
00760         ULONG ulOldEnumFilter;
00761         ulOldEnumFilter = SetFontEnumeration(0);
00762         <span class="comment">// restore all the other flags</span>
00763         SetFontEnumeration(ulOldEnumFilter &amp; ~FE_FILTER_TRUETYPE);
00764         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y &lt; 0) {
00765             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y = -<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y;
00766         }
00767         bFontOK = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a23">DoFontEnum</a>(NULL, pwszFace, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y);
00768         SetFontEnumeration(ulOldEnumFilter);
00769         <span class="keywordflow">if</span> (bFontOK) {
00770             <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"FindCreateFont created font!\n"</span>));
00771             FontIndex = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a4">CREATED_BUT_NOT_FOUND</a>;
00772             <span class="keywordflow">goto</span> TryFindExactFont;
00773         } <span class="keywordflow">else</span> {
00774             <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"FindCreateFont failed to create font!\n"</span>));
00775         }
00776     }
00777 
00778     <span class="comment">/*</span>
00779 <span class="comment">     * Failed to find exact match, but we have a close Raster Font</span>
00780 <span class="comment">     * fit - only the name doesn't match.</span>
00781 <span class="comment">     */</span>
00782     <span class="keywordflow">if</span> (BestMatch &gt;= 0) {
00783         FontIndex = BestMatch;
00784         <span class="keywordflow">goto</span> FoundFont;
00785     }
00786 
00787     <span class="comment">/*</span>
00788 <span class="comment">     * Failed to find exact match, even after enumeration, so now try</span>
00789 <span class="comment">     * to find a font of same family and same size or bigger</span>
00790 <span class="comment">     */</span>
00791     <span class="keywordflow">for</span> (i=0; i &lt; (<span class="keywordtype">int</span>)<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>; i++) {
00792 <span class="preprocessor">#if defined(FE_SB)</span>
00793 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>()) {
00794             <span class="keywordflow">if</span> ((Family != 0) &amp;&amp;
00795                     ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)Family != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a>)) {
00796                 <span class="keywordflow">continue</span>;
00797             }
00798 
00799             <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d6/font_8h.html#a2">TM_IS_TT_FONT</a>(FontInfo[i].Family) &amp;&amp;
00800                     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].tmCharSet != CharSet) {
00801                 <span class="keywordflow">continue</span>;
00802             }
00803         }
00804         <span class="keywordflow">else</span> {
00805 <span class="preprocessor">#endif</span>
00806 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)Family != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a>) {
00807             <span class="keywordflow">continue</span>;
00808         }
00809 <span class="preprocessor">#if defined(FE_SB)</span>
00810 <span class="preprocessor"></span>        }
00811 <span class="preprocessor">#endif</span>
00812 <span class="preprocessor"></span>
00813         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y &gt;= <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y &amp;&amp;
00814                 <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X &gt;= <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X) {
00815             <span class="comment">// Same family, size &gt;= desired.</span>
00816             FontIndex = i;
00817             <span class="keywordflow">break</span>;
00818         }
00819     }
00820 
00821     <span class="keywordflow">if</span> (FontIndex &lt; 0) {
00822         <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"FindCreateFont defaults!\n"</span>));
00823 <span class="preprocessor">#if defined(FE_SB)</span>
00824 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00825             !<a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(CodePage))
00826         {
00827             FontIndex = AltFontIndex;
00828         }
00829         <span class="keywordflow">else</span>
00830 <span class="preprocessor">#endif</span>
00831 <span class="preprocessor"></span>        FontIndex = <a class="code" href="../../d0/d3/dbcs_8h.html#a13">DefaultFontIndex</a>;
00832     }
00833 
00834 FoundFont:
00835     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"FindCreateFont returns %x : %ls (%d,%d)\n"</span>, FontIndex,
00836             FontInfo[FontIndex].FaceName,
00837             FontInfo[FontIndex].<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X, FontInfo[FontIndex].Size.Y));
00838     <span class="keywordflow">return</span> FontIndex;
00839 
00840 <span class="preprocessor">#undef NOT_CREATED_NOR_FOUND</span>
00841 <span class="preprocessor"></span><span class="preprocessor">#undef CREATED_BUT_NOT_FOUND</span>
00842 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="w32/ntcon/server/misc.c::FindTextBufferFontInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS FindTextBufferFontInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>CodePage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TextFontInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00846">846</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00102">_TEXT_BUFFER_FONT_INFO::FontCodePage</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00096">_TEXT_BUFFER_FONT_INFO::NextTextBufferFont</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00854                    :
00855 
00856     This routine find a font information which correspond to code page value.
00857 
00858 Arguments:
00859 
00860 Return Value:
00861 
00862 --*/
00863 
00864 {
00865     <a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> CurrentFont;
00866 
00867     CurrentFont = ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont;
00868 
00869     <span class="keywordflow">while</span> (CurrentFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00870         <span class="keywordflow">if</span> (CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o6">FontCodePage</a> == CodePage) {
00871             *TextFontInfo = *CurrentFont;
00872             <span class="keywordflow">return</span> STATUS_SUCCESS;
00873         }
00874         CurrentFont = CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a>;
00875     }
00876 
00877     <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00878 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="w32/ntcon/server/misc.c::FontEnum" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int CALLBACK FontEnum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPENUMLOGFONTW&nbsp;</td>
          <td class="mdname" nowrap> <em>lpLogFont</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPNEWTEXTMETRICW&nbsp;</td>
          <td class="mdname" nowrap> <em>lpTextMetric</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>nFontType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">152</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00080">AddFaceNode()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l01106">tagFACENODE::awch</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00042">_FONTENUMDC::bFindFaces</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00183">ConsoleHeapReAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00038">DBGFONTS</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00039">DBGFONTS2</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00043">DefaultFontIndex</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l01105">tagFACENODE::dwFlag</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00928">EF_OEMFONT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00929">EF_TTFONT</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00043">_FONT_INFO::FaceName</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00044">_FONT_INFO::Family</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00057">FE_FONTOK</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00023">FONT_INCREMENT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00072">FONT_TAG</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00032">FontInfoLength</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00062">gpFaceNames</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00041">_FONTENUMDC::hDC</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00039">_FONT_INFO::hFont</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00051">IS_BOLD</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a48">IsAvailableTTFont()</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a49">IsAvailableTTFontCP()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>, <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a14">PFONTENUMDC</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00040">_FONT_INFO::Size</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00052">SIZE_EQUAL</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00041">_FONT_INFO::SizeWant</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00050">TM_IS_TT_FONT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00043">_FONTENUMDC::TTPointSize</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00044">_FONTENUMDC::ulFE</a>, and <a class="el" href="../../d8/d5/font_8h-source.html#l00042">_FONT_INFO::Weight</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00478">DoFontEnum()</a>.
<p>
<pre class="fragment"><div>00166 {
00167     <a class="code" href="../../d8/d9/struct__FONTENUMDC.html">PFONTENUMDC</a> pfed = (<a class="code" href="../../d8/d9/struct__FONTENUMDC.html">PFONTENUMDC</a>)lParam;
00168     HDC hDC = pfed-&gt;<a class="code" href="../../d8/d9/struct__FONTENUMDC.html#o0">hDC</a>;
00169     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bFindFaces = pfed-&gt;<a class="code" href="../../d8/d9/struct__FONTENUMDC.html#o1">bFindFaces</a>;
00170     HFONT hFont;
00171     TEXTMETRICW tmi;
00172     LONG nFont;
00173     LONG nFontNew;
00174     COORD SizeToShow;
00175     COORD SizeActual;
00176     COORD SizeWant;
00177     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> tmFamily;
00178     SIZE <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00179     LPWSTR pwszFace = lpLogFont-&gt;elfLogFont.lfFaceName;
00180     <a class="code" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a> pFN;
00181 
00182     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"  FontEnum \"%ls\" (%d,%d) weight 0x%lx(%d) -- %s\n"</span>,
00183             pwszFace,
00184             lpLogFont-&gt;elfLogFont.lfWidth, lpLogFont-&gt;elfLogFont.lfHeight,
00185             lpLogFont-&gt;elfLogFont.lfWeight, lpLogFont-&gt;elfLogFont.lfWeight,
00186             bFindFaces ? <span class="stringliteral">"Finding Faces"</span> : <span class="stringliteral">"Creating Fonts"</span>));
00187 
00188     <span class="comment">//</span>
00189     <span class="comment">// reject variable width and italic fonts, also tt fonts with neg ac</span>
00190     <span class="comment">//</span>
00191 
00192     <span class="keywordflow">if</span>
00193     (
00194       !(lpLogFont-&gt;elfLogFont.lfPitchAndFamily &amp; FIXED_PITCH) ||
00195       (lpLogFont-&gt;elfLogFont.lfItalic)                        ||
00196       !(lpTextMetric-&gt;ntmFlags &amp; NTM_NONNEGATIVE_AC)
00197     )
00198     {
00199         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d3/dbcs_8h.html#a48">IsAvailableTTFont</a>(pwszFace))
00200         {
00201             <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"    REJECT  face (variable pitch, italic, or neg a&amp;c)\n"</span>));
00202             <span class="keywordflow">return</span> bFindFaces ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;  <span class="comment">// unsuitable font</span>
00203         }
00204     }
00205 
00206     <span class="keywordflow">if</span> (nFontType == TRUETYPE_FONTTYPE) {
00207         lpLogFont-&gt;elfLogFont.lfHeight = pfed-&gt;<a class="code" href="../../d8/d9/struct__FONTENUMDC.html#o2">TTPointSize</a>;
00208         lpLogFont-&gt;elfLogFont.lfWidth  = 0;
00209         lpLogFont-&gt;elfLogFont.lfWeight = FW_NORMAL;
00210     }
00211 
00212     <span class="comment">/*</span>
00213 <span class="comment">     * reject TT fonts for whoom family is not modern, that is do not use</span>
00214 <span class="comment">     * FF_DONTCARE    // may be surprised unpleasantly</span>
00215 <span class="comment">     * FF_DECORATIVE  // likely to be symbol fonts</span>
00216 <span class="comment">     * FF_SCRIPT      // cursive, inappropriate for console</span>
00217 <span class="comment">     * FF_SWISS OR FF_ROMAN // variable pitch</span>
00218 <span class="comment">     */</span>
00219 
00220     <span class="keywordflow">if</span> ((nFontType == TRUETYPE_FONTTYPE) &amp;&amp;
00221             ((lpLogFont-&gt;elfLogFont.lfPitchAndFamily &amp; 0xf0) != FF_MODERN)) {
00222         <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"    REJECT  face (TT but not FF_MODERN)\n"</span>));
00223         <span class="keywordflow">return</span> bFindFaces ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;  <span class="comment">// unsuitable font</span>
00224     }
00225 
00226     <span class="comment">/*</span>
00227 <span class="comment">     * reject non-TT fonts that aren't OEM</span>
00228 <span class="comment">     */</span>
00229     <span class="keywordflow">if</span> ((nFontType != TRUETYPE_FONTTYPE) &amp;&amp;
00230 <span class="preprocessor">#if defined(FE_SB)</span>
00231 <span class="preprocessor"></span>            (!<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() ||
00232             !IS_ANY_DBCS_CHARSET(lpLogFont-&gt;elfLogFont.lfCharSet)) &amp;&amp;
00233 <span class="preprocessor">#endif</span>
00234 <span class="preprocessor"></span>            (lpLogFont-&gt;elfLogFont.lfCharSet != OEM_CHARSET)) {
00235         <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"    REJECT  face (not TT nor OEM)\n"</span>));
00236         <span class="keywordflow">return</span> bFindFaces ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;  <span class="comment">// unsuitable font</span>
00237     }
00238 
00239     <span class="comment">/*</span>
00240 <span class="comment">     * reject non-TT fonts that are virtical font</span>
00241 <span class="comment">     */</span>
00242     <span class="keywordflow">if</span> ((nFontType != TRUETYPE_FONTTYPE) &amp;&amp;
00243             (pwszFace[0] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'@'</span>)) {
00244         <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"    REJECT  face (not TT and TATEGAKI)\n"</span>));
00245         <span class="keywordflow">return</span> bFindFaces ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;  <span class="comment">// unsuitable font</span>
00246     }
00247 
00248     <span class="comment">/*</span>
00249 <span class="comment">     * reject non-TT fonts that aren't Terminal</span>
00250 <span class="comment">     */</span>
00251     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp;
00252         (nFontType != TRUETYPE_FONTTYPE) &amp;&amp;
00253             (wcscmp(pwszFace, L<span class="stringliteral">"Terminal"</span>) != 0)) {
00254         <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"    REJECT  face (not TT nor Terminal)\n"</span>));
00255         <span class="keywordflow">return</span> bFindFaces ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;  <span class="comment">// unsuitable font</span>
00256     }
00257 
00258     <span class="comment">/*</span>
00259 <span class="comment">     * reject Far East TT fonts that aren't Far East charset.</span>
00260 <span class="comment">     */</span>
00261     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d3/dbcs_8h.html#a48">IsAvailableTTFont</a>(pwszFace) &amp;&amp;
00262         !IS_ANY_DBCS_CHARSET(lpLogFont-&gt;elfLogFont.lfCharSet) &amp;&amp;
00263         !<a class="code" href="../../d0/d3/dbcs_8h.html#a49">IsAvailableTTFontCP</a>(pwszFace,0)
00264        ) {
00265         <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"    REJECT  face (Far East TT and not Far East charset)\n"</span>));
00266         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;    <span class="comment">// should be enumerate next charset.</span>
00267     }
00268 
00269     <span class="comment">/*</span>
00270 <span class="comment">     * Add or find the facename</span>
00271 <span class="comment">     */</span>
00272     pFN = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a20">AddFaceNode</a>(&amp;gpFaceNames, pwszFace);
00273     <span class="keywordflow">if</span> (pFN == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00274         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00275     }
00276 
00277     <span class="keywordflow">if</span> (bFindFaces) {
00278         <span class="keywordflow">if</span> (nFontType == TRUETYPE_FONTTYPE) {
00279             <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"NEW TT FACE %ls\n"</span>, pwszFace));
00280             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> |= <a class="code" href="../../d8/d5/consrv_8h.html#a54">EF_TTFONT</a>;
00281         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nFontType == RASTER_FONTTYPE) {
00282             <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"NEW OEM FACE %ls\n"</span>,pwszFace));
00283             pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o1">dwFlag</a> |= <a class="code" href="../../d8/d5/consrv_8h.html#a53">EF_OEMFONT</a>;
00284         }
00285         <span class="keywordflow">return</span> 0;
00286     }
00287 
00288 
00289     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6/font_8h.html#a3">IS_BOLD</a>(lpLogFont-&gt;elfLogFont.lfWeight)) {
00290         <a class="code" href="../../d8/d5/consrv_8h.html#a1">DBGFONTS2</a>((<span class="stringliteral">"    A bold font (weight %d)\n"</span>, lpLogFont-&gt;elfLogFont.lfWeight));
00291         <span class="comment">// return 0;</span>
00292     }
00293 
00294     <span class="comment">/* get font info */</span>
00295     SizeWant.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)lpLogFont-&gt;elfLogFont.lfHeight;
00296     SizeWant.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)lpLogFont-&gt;elfLogFont.lfWidth;
00297 CreateBoldFont:
00298     lpLogFont-&gt;elfLogFont.lfQuality = NONANTIALIASED_QUALITY;
00299     hFont = CreateFontIndirectW(&amp;lpLogFont-&gt;elfLogFont);
00300     <span class="keywordflow">if</span> (!hFont) {
00301         <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"    REJECT  font (can't create)\n"</span>));
00302         RIPMSG0(RIP_WARNING, <span class="stringliteral">"FontEnum: CreateFontIndirectW returned NULL hFont."</span>);
00303         <span class="keywordflow">return</span> 0;  <span class="comment">// same font in other sizes may still be suitable</span>
00304     }
00305 
00306     <a class="code" href="../../d8/d5/consrv_8h.html#a1">DBGFONTS2</a>((<span class="stringliteral">"    hFont = %lx\n"</span>, hFont));
00307 
00308     <span class="comment">//</span>
00309     <span class="comment">// for reasons unbeknownst to me, removing this code causes GDI</span>
00310     <span class="comment">// to yack, claiming that the font is owned by another process.</span>
00311     <span class="comment">//</span>
00312 
00313     SelectObject(hDC,hFont);
00314     <span class="keywordflow">if</span> (!GetTextMetricsW(hDC, &amp;tmi)) {
00315         tmi = *((LPTEXTMETRICW)lpTextMetric);
00316     }
00317 
00318     <span class="keywordflow">if</span> (GetTextExtentPoint32W(hDC, L<span class="stringliteral">"0"</span>, 1, &amp;Size)) {
00319         SizeActual.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.cx;
00320     } <span class="keywordflow">else</span> {
00321         SizeActual.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(tmi.tmMaxCharWidth);
00322     }
00323     SizeActual.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(tmi.tmHeight + tmi.tmExternalLeading);
00324     <a class="code" href="../../d8/d5/consrv_8h.html#a1">DBGFONTS2</a>((<span class="stringliteral">"    actual size %d,%d\n"</span>, SizeActual.X, SizeActual.Y));
00325     tmFamily = tmi.tmPitchAndFamily;
00326     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6/font_8h.html#a2">TM_IS_TT_FONT</a>(tmFamily) &amp;&amp; (SizeWant.Y &gt;= 0)) {
00327         SizeToShow = SizeWant;
00328         <span class="keywordflow">if</span> (SizeWant.X == 0) {
00329             <span class="comment">// Asking for zero width height gets a default aspect-ratio width</span>
00330             <span class="comment">// It's better to show that width rather than 0.</span>
00331             SizeToShow.X = SizeActual.X;
00332         }
00333     } <span class="keywordflow">else</span> {
00334         SizeToShow = SizeActual;
00335     }
00336     <a class="code" href="../../d8/d5/consrv_8h.html#a1">DBGFONTS2</a>((<span class="stringliteral">"    SizeToShow = (%d,%d), SizeActual = (%d,%d)\n"</span>,
00337             SizeToShow.X, SizeToShow.Y, SizeActual.X, SizeActual.Y));
00338 
00339     <span class="comment">// there's a GDI bug - this assert fails occasionally</span>
00340     <span class="comment">//ASSERT (tmi.tmw.tmMaxCharWidth == lpTextMetric-&gt;tmMaxCharWidth);</span>
00341 
00342     <span class="comment">/*</span>
00343 <span class="comment">     * NOW, determine whether this font entry has already been cached</span>
00344 <span class="comment">     * LATER : it may be possible to do this before creating the font, if</span>
00345 <span class="comment">     * we can trust the dimensions &amp; other info from lpTextMetric.</span>
00346 <span class="comment">     * Sort by size:</span>
00347 <span class="comment">     *  1) By pixelheight (negative Y values)</span>
00348 <span class="comment">     *  2) By height (as shown)</span>
00349 <span class="comment">     *  3) By width (as shown)</span>
00350 <span class="comment">     */</span>
00351     <span class="keywordflow">for</span> (nFont = 0; nFont &lt; (LONG)<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>; ++nFont) {
00352         COORD SizeShown;
00353 
00354         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o0">hFont</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00355             <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"!   Font %x has a NULL hFont\n"</span>, nFont));
00356             <span class="keywordflow">continue</span>;
00357         }
00358 
00359 
00360         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.X &gt; 0) {
00361             SizeShown.X = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.X;
00362         } <span class="keywordflow">else</span> {
00363             SizeShown.X = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X;
00364         }
00365 
00366         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.Y &gt; 0) {
00367             <span class="comment">// This is a font specified by cell height.</span>
00368             SizeShown.Y = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.Y;
00369         } <span class="keywordflow">else</span> {
00370             SizeShown.Y = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y;
00371             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.Y &lt; 0) {
00372                 <span class="comment">// This is a TT font specified by character height.</span>
00373                 <span class="keywordflow">if</span> (SizeWant.Y &lt; 0 &amp;&amp; SizeWant.Y &gt; <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.Y) {
00374                     <span class="comment">// Requested pixelheight is smaller than this one.</span>
00375                     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"INSERT %d pt at %x, before %d pt\n"</span>,
00376                             -SizeWant.Y, nFont, -FontInfo[nFont].SizeWant.Y));
00377                     nFontNew = nFont;
00378                     <span class="keywordflow">goto</span> InsertNewFont;
00379                 }
00380             }
00381         }
00382 
00383         <span class="comment">// DBGFONTS(("    SizeShown(%x) = (%d,%d)\n",nFont,SizeShown.X,SizeShown.Y));</span>
00384 
00385         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6/font_8h.html#a4">SIZE_EQUAL</a>(SizeShown, SizeToShow) &amp;&amp;
00386                 <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a> == tmFamily &amp;&amp;
00387                 <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o3">Weight</a> == tmi.tmWeight &amp;&amp;
00388                 wcscmp(FontInfo[nFont].FaceName, pwszFace) == 0) {
00389             <span class="comment">/*</span>
00390 <span class="comment">             * Already have this font</span>
00391 <span class="comment">             */</span>
00392             <a class="code" href="../../d8/d5/consrv_8h.html#a1">DBGFONTS2</a>((<span class="stringliteral">"    Already have the font\n"</span>));
00393             DeleteObject(hFont);
00394             pfed-&gt;<a class="code" href="../../d8/d9/struct__FONTENUMDC.html#o3">ulFE</a> |= <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a2">FE_FONTOK</a>;
00395             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00396         }
00397 
00398 
00399         <span class="keywordflow">if</span> ((SizeToShow.Y &lt; SizeShown.Y) ||
00400                 (SizeToShow.Y == SizeShown.Y &amp;&amp; SizeToShow.X &lt; SizeShown.X)) {
00401             <span class="comment">/*</span>
00402 <span class="comment">             * This new font is smaller than nFont</span>
00403 <span class="comment">             */</span>
00404             <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"INSERT at %x, SizeToShow = (%d,%d)\n"</span>, nFont,
00405                     SizeToShow.X,SizeToShow.Y));
00406             nFontNew = nFont;
00407             <span class="keywordflow">goto</span> InsertNewFont;
00408         }
00409     }
00410 
00411     <span class="comment">/*</span>
00412 <span class="comment">     * The font we are adding should be appended to the list,</span>
00413 <span class="comment">     * since it is bigger (or equal) to the last one.</span>
00414 <span class="comment">     */</span>
00415     nFontNew = (LONG)<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>;
00416 
00417 InsertNewFont: <span class="comment">// at nFontNew</span>
00418 
00419 <span class="comment">//  ASSERT ((lpTextMetric-&gt;tmPitchAndFamily &amp; 1) == 0);</span>
00420     <span class="comment">/* If we have to grow our font table, do it */</span>
00421 
00422     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a> == <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a7">FontInfoLength</a>) {
00423         <a class="code" href="../../d5/d9/struct__FONT__INFO.html">PFONT_INFO</a> Temp;
00424 
00425         <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a7">FontInfoLength</a> += <a class="code" href="../../d7/d6/font_8h.html#a1">FONT_INCREMENT</a>;
00426         Temp = (<a class="code" href="../../d5/d9/struct__FONT__INFO.html">PFONT_INFO</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a37">ConsoleHeapReAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( FONT_TAG ),FontInfo,<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d9/struct__FONT__INFO.html">FONT_INFO</a>) * FontInfoLength);
00427         <span class="keywordflow">if</span> (Temp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00428             RIPMSG0(RIP_WARNING, <span class="stringliteral">"FontEnum: failed to allocate PFONT_INFO"</span>);
00429             <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a7">FontInfoLength</a> -= <a class="code" href="../../d7/d6/font_8h.html#a1">FONT_INCREMENT</a>;
00430             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00431         }
00432         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a> = Temp;
00433     }
00434 
00435     <span class="keywordflow">if</span> (nFontNew &lt; (LONG)<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>) {
00436         RtlMoveMemory(&amp;FontInfo[nFontNew+1],
00437                 &amp;FontInfo[nFontNew],
00438                 <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d9/struct__FONT__INFO.html">FONT_INFO</a>)*(NumberOfFonts - nFontNew));
00439         <span class="comment">//</span>
00440         <span class="comment">// Fix up DefaultFontIndex if nFontNew less than DefaultFontIndex.</span>
00441         <span class="comment">//</span>
00442         <span class="keywordflow">if</span> (nFontNew &lt; (LONG)<a class="code" href="../../d0/d3/dbcs_8h.html#a13">DefaultFontIndex</a> &amp;&amp;
00443             <a class="code" href="../../d0/d3/dbcs_8h.html#a13">DefaultFontIndex</a>+1 &lt; <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>) {
00444             <a class="code" href="../../d0/d3/dbcs_8h.html#a13">DefaultFontIndex</a>++;
00445         }
00446     }
00447 
00448     <span class="comment">/*</span>
00449 <span class="comment">     * Store the font info</span>
00450 <span class="comment">     */</span>
00451     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFontNew].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o0">hFont</a> = hFont;
00452     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFontNew].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o5">Family</a> = tmFamily;
00453     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFontNew].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a> = SizeActual;
00454     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6/font_8h.html#a2">TM_IS_TT_FONT</a>(tmFamily)) {
00455         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFontNew].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a> = SizeWant;
00456     } <span class="keywordflow">else</span> {
00457         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFontNew].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.X = 0;
00458         <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFontNew].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o2">SizeWant</a>.Y = 0;
00459     }
00460     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFontNew].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o3">Weight</a> = tmi.tmWeight;
00461     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFont].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o4">FaceName</a> = pFN-&gt;<a class="code" href="../../d9/d4/structtagFACENODE.html#o2">awch</a>;
00462 <span class="preprocessor">#if defined(FE_SB)</span>
00463 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[nFontNew].tmCharSet = tmi.tmCharSet;
00464 <span class="preprocessor">#endif</span>
00465 <span class="preprocessor"></span>
00466     ++<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>;
00467 
00468     <span class="keywordflow">if</span> (nFontType == TRUETYPE_FONTTYPE &amp;&amp; !<a class="code" href="../../d7/d6/font_8h.html#a3">IS_BOLD</a>(FontInfo[nFontNew].Weight)) {
00469           lpLogFont-&gt;elfLogFont.lfWeight = FW_BOLD;
00470           <span class="keywordflow">goto</span> CreateBoldFont;
00471     }
00472 
00473     pfed-&gt;<a class="code" href="../../d8/d9/struct__FONTENUMDC.html#o3">ulFE</a> |= <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a2">FE_FONTOK</a>;  <span class="comment">// and continue enumeration</span>
00474     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00475 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="w32/ntcon/server/misc.c::GetAvailableFonts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetAvailableFonts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>MaximumWindow</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumFonts</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00998">998</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00203">_WINDOW_LIMITS::MaximumWindowSize</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d8/d5/font_8h-source.html#l00040">_FONT_INFO::Size</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00233">SrvGetConsoleFontInfo()</a>.
<p>
<pre class="fragment"><div>01004 {
01005     PCONSOLE_FONT_INFO BufPtr;
01006     ULONG i;
01007     COORD WindowSize;
01008     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
01009 
01010     <span class="comment">//</span>
01011     <span class="comment">// if the buffer is too small to return all the fonts, return</span>
01012     <span class="comment">// the number that will fit.</span>
01013     <span class="comment">//</span>
01014 
01015     *NumFonts = (*NumFonts &gt; <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>) ? <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a> : *NumFonts;
01016 
01017     <span class="comment">//</span>
01018     <span class="comment">// convert font size in pixels to font size in rows/columns</span>
01019     <span class="comment">//</span>
01020 
01021     BufPtr = (PCONSOLE_FONT_INFO)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01022 
01023     <span class="keywordflow">if</span> (MaximumWindow) {
01024         <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
01025         WindowSize = WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>;
01026     }
01027     <span class="keywordflow">else</span> {
01028         WindowSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo);
01029         WindowSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
01030     }
01031     <span class="keywordflow">for</span> (i=0;i&lt;*NumFonts;i++,BufPtr++) {
01032         BufPtr-&gt;nFont = i;
01033         BufPtr-&gt;dwFontSize.X = WindowSize.X * <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).X / <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.X;
01034         BufPtr-&gt;dwFontSize.Y = WindowSize.Y * <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo).Y / <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[i].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>.Y;
01035     }
01036 
01037     <span class="keywordflow">return</span> STATUS_SUCCESS;
01038 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="w32/ntcon/server/misc.c::GetCurrentFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetCurrentFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>MaximumWindow</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FontIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCOORD&nbsp;</td>
          <td class="mdname" nowrap> <em>FontSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01053">1053</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00203">_WINDOW_LIMITS::MaximumWindowSize</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00108">SCR_FONTNUMBER()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00315">SrvGetConsoleCurrentFont()</a>.
<p>
<pre class="fragment"><div>01059 {
01060     COORD WindowSize;
01061     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
01062 
01063     <span class="keywordflow">if</span> (MaximumWindow) {
01064         <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
01065         WindowSize = WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>;
01066     }
01067     <span class="keywordflow">else</span> {
01068         WindowSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo);
01069         WindowSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
01070     }
01071     *FontIndex = <a class="code" href="../../d8/d5/consrv_8h.html#a64">SCR_FONTNUMBER</a>(ScreenInfo);
01072     *FontSize = WindowSize;
01073     <span class="keywordflow">return</span> STATUS_SUCCESS;
01074 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="w32/ntcon/server/misc.c::GetFontSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetFontSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FontIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCOORD&nbsp;</td>
          <td class="mdname" nowrap> <em>FontSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01041">1041</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>, and <a class="el" href="../../d8/d5/font_8h-source.html#l00040">_FONT_INFO::Size</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00278">SrvGetConsoleFontSize()</a>.
<p>
<pre class="fragment"><div>01045 {
01046     <span class="keywordflow">if</span> (FontIndex &gt;= <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>)
01047         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01048     *FontSize = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a1">FontInfo</a>[FontIndex].<a class="code" href="../../d5/d9/struct__FONT__INFO.html#o1">Size</a>;
01049     <span class="keywordflow">return</span> STATUS_SUCCESS;
01050 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="w32/ntcon/server/misc.c::GetMouseButtons" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetMouseButtons           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NumButtons</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00066">66</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00029">NumberOfMouseButtons</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00211">SrvGetConsoleMouseInfo()</a>.
<p>
<pre class="fragment"><div>00069 {
00070     *NumButtons = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a5">NumberOfMouseButtons</a>;
00071     <span class="keywordflow">return</span> STATUS_SUCCESS;
00072 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="w32/ntcon/server/misc.c::GetNumFonts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetNumFonts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NumFonts</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00988">988</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00060">NumberOfFonts</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00082">SrvGetConsoleNumberOfFonts()</a>.
<p>
<pre class="fragment"><div>00991 {
00992     *NumFonts = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a27">NumberOfFonts</a>;
00993     <span class="keywordflow">return</span> STATUS_SUCCESS;
00994 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="w32/ntcon/server/misc.c::InitializeCustomCP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InitializeCustomCP           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01787">1787</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00050">GlyphCP</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00051">GlyphTable</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l02353">RtlInitCodePageTable()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01946">ConsoleInputThread()</a>.
<p>
<pre class="fragment"><div>01787                           {
01788     PPEB pPeb;
01789 
01790     pPeb = NtCurrentPeb();
01791     <span class="keywordflow">if</span> ((pPeb == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (pPeb-&gt;OemCodePageData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01792         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01793     }
01794 
01795     <span class="comment">/*</span>
01796 <span class="comment">     * Fill in the CPTABLEINFO struct</span>
01797 <span class="comment">     */</span>
01798     <a class="code" href="../../d9/d6/nlsxlat_8c.html#a45">RtlInitCodePageTable</a>(pPeb-&gt;OemCodePageData, &amp;GlyphCP);
01799 
01800     <span class="comment">/*</span>
01801 <span class="comment">     * Make a copy of the MultiByteToWideChar table</span>
01802 <span class="comment">     */</span>
01803     RtlCopyMemory(GlyphTable, <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a15">GlyphCP</a>.MultiByteTable, 256 * <span class="keyword">sizeof</span>(USHORT));
01804 
01805     <span class="comment">/*</span>
01806 <span class="comment">     * Modify the first 0x20 bytes so that they are glyphs.</span>
01807 <span class="comment">     */</span>
01808     MultiByteToWideChar(CP_OEMCP, MB_USEGLYPHCHARS,
01809             <span class="stringliteral">"\x20\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0A\x0B\x0C\x0D\x0E\x0F"</span>
01810             <span class="stringliteral">"\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1A\x1B\x1C\x1D\x1E\x1F"</span>,
01811             0x20, GlyphTable, 0x20);
01812     MultiByteToWideChar(CP_OEMCP, MB_USEGLYPHCHARS,
01813             <span class="stringliteral">"\x7f"</span>, 1, &amp;GlyphTable[0x7f], 1);
01814 
01815 
01816     <span class="comment">/*</span>
01817 <span class="comment">     * Point the Custom CP at the glyph table</span>
01818 <span class="comment">     */</span>
01819     <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a15">GlyphCP</a>.MultiByteTable = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a16">GlyphTable</a>;
01820 
01821 <span class="preprocessor">#if defined(FE_SB) &amp;&amp; defined(i386)</span>
01822 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (ISNECPC98(gdwMachineId)) {
01823         InitializeNEC_OS2_CP();
01824     }
01825 <span class="preprocessor">#endif</span>
01826 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01827 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="w32/ntcon/server/misc.c::InitializeFonts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeFonts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00109">109</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00055">CONSOLE_MAX_FONT_NAME_LENGTH</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d3/d2/tnlsxlat_8c-source.html#l00026">NELEM</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l00737">ConServerDllInitialization()</a>.
<p>
<pre class="fragment"><div>00110 {
00111     WCHAR FontName[<a class="code" href="../../d8/d5/consrv_8h.html#a6">CONSOLE_MAX_FONT_NAME_LENGTH</a>];
00112     <span class="keywordtype">int</span> i;
00113     <span class="keyword">static</span> CONST LPWSTR FontList[] = {<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"woafont"</span>,
00114                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ega80woa.fon"</span>,
00115                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"ega40woa.fon"</span>,
00116                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"cga80woa.fon"</span>,
00117                                       <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"cga40woa.fon"</span>};
00118 
00119     <span class="comment">//</span>
00120     <span class="comment">// Read software.ini to get the values for "woafont",</span>
00121     <span class="comment">// "ega80woa.fon", "ega40woa.fon", "cga80woa.fon", and</span>
00122     <span class="comment">// "cga40woa.fon", respectively, to pass to AddFontResource.</span>
00123     <span class="comment">//</span>
00124     <span class="comment">// If any of the entries are empty or non-existent,</span>
00125     <span class="comment">// GetPrivateProfileString will return a NULL (empty) string.</span>
00126     <span class="comment">// If such is the case, the call to AddPermanentFontResource will</span>
00127     <span class="comment">// simply fail.</span>
00128     <span class="comment">//</span>
00129 
00130     OpenProfileUserMapping();
00131 
00132     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d2/d3/tnlsxlat_8c.html#a0">NELEM</a>(FontList); i++) {
00133         GetPrivateProfileString(L<span class="stringliteral">"386enh"</span>, FontList[i], L<span class="stringliteral">""</span>,
00134                 FontName, <a class="code" href="../../d2/d3/tnlsxlat_8c.html#a0">NELEM</a>(FontName), L<span class="stringliteral">"system.ini"</span>);
00135         GdiAddFontResourceW(FontName, AFRW_ADD_LOCAL_FONT,NULL);
00136     }
00137 
00138     CloseProfileUserMapping();
00139 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="w32/ntcon/server/misc.c::InitializeMouseButtons" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeMouseButtons           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00075">75</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00401">GetSystemMetrics()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00029">NumberOfMouseButtons</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00253">InitializeScreenInfo()</a>.
<p>
<pre class="fragment"><div>00076 {
00077     <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a5">NumberOfMouseButtons</a> = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>(SM_CMOUSEBUTTONS);
00078 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="w32/ntcon/server/misc.c::RealUnicodeToFalseUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RealUnicodeToFalseUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">1573</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l00369">RtlMultiByteToUnicodeN()</a>, <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01277">RtlUnicodeToOemN()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00467">STACK_BUFFER_SIZE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d2/dbcs_8h-source.html#l00026">USACP</a>, and <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00026">WINDOWSCP</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01115">FE_TranslateOutputToAnsiUnicodeInternal()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l01093">SB_TranslateOutputToAnsiUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>, <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l00882">SrvScrollConsoleScreenBuffer()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l01020">WWSB_DoSrvWriteConsole()</a>, <a class="el" href="../../d9/d1/__output_8h-source.html#l01530">WWSB_FillOutput()</a>, <a class="el" href="../../d1/d2/__stream_8h-source.html#l00203">WWSB_WriteChars()</a>, and <a class="el" href="../../d9/d1/__output_8h-source.html#l01002">WWSB_WriteOutputString()</a>.
<p>
<pre class="fragment"><div>01588 {
01589     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01590     LPSTR Temp;
01591     ULONG TempLength;
01592     ULONG Length;
01593     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> StackBuffer[<a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>];
01594     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> NormalChars;
01595     <span class="keywordtype">int</span> i;
01596 
01597     <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"RealUnicodeToFalseUnicode U-&gt;%d:ACP-&gt;U %.*ls\n"</span>, Codepage,
01598             SourceLength &gt; 10 ? 10 : SourceLength, Source));
01599 <span class="preprocessor">#if defined(FE_SB)</span>
01600 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a> == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a> &amp;&amp; Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a3">WINDOWSCP</a>)
01601         <span class="keywordflow">return</span> STATUS_SUCCESS;
01602     <span class="keywordflow">if</span> (SourceLength == 0 )
01603         <span class="keywordflow">return</span> STATUS_SUCCESS;
01604 <span class="preprocessor">#endif</span>
01605 <span class="preprocessor"></span>    NormalChars = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01606     <span class="keywordflow">for</span> (i=0;i&lt;SourceLength;i++) {
01607         <span class="keywordflow">if</span> (Source[i] &gt; 0x7f) {
01608             NormalChars = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01609             <span class="keywordflow">break</span>;
01610         }
01611     }
01612     <span class="keywordflow">if</span> (NormalChars) {
01613         <span class="keywordflow">return</span> STATUS_SUCCESS;
01614     }
01615     TempLength = SourceLength;
01616     <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01617         Temp = (LPSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),TempLength);
01618         <span class="keywordflow">if</span> (Temp == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01619             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01620         }
01621     } <span class="keywordflow">else</span> {
01622         Temp = StackBuffer;
01623     }
01624     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01625         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a39">RtlUnicodeToOemN</a>(Temp,
01626                                   TempLength,
01627                                   &amp;Length,
01628                                   Source,
01629                                   SourceLength * <span class="keyword">sizeof</span>(WCHAR)
01630                                  );
01631     } <span class="keywordflow">else</span> {
01632         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = WideCharToMultiByte(Codepage,
01633                                    0,
01634                                    Source,
01635                                    SourceLength,
01636                                    Temp,
01637                                    TempLength,
01638                                    NULL,
01639                                    NULL);
01640     }
01641     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01642         <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01643             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Temp);
01644         }
01645         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01646     }
01647 
01648     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>()) {
01649         MultiByteToWideChar(USACP,
01650                         0,
01651                         Temp,
01652                         TempLength,
01653                         Source,
01654                         SourceLength
01655                        );
01656     } <span class="keywordflow">else</span> {
01657         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a33">RtlMultiByteToUnicodeN</a>(Source,
01658                            SourceLength * <span class="keyword">sizeof</span>(WCHAR),
01659                            &amp;Length,
01660                            Temp,
01661                            TempLength
01662                           );
01663     }
01664 
01665     <span class="keywordflow">if</span> (TempLength &gt; <a class="code" href="../../d1/d7/server_8h.html#a95">STACK_BUFFER_SIZE</a>) {
01666         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Temp);
01667     }
01668     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01669         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01670     } <span class="keywordflow">else</span> {
01671         <span class="keywordflow">return</span> STATUS_SUCCESS;
01672     }
01673 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="w32/ntcon/server/misc.c::RemoveTextBufferFontInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RemoveTextBufferFontInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00952">952</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00096">_TEXT_BUFFER_FONT_INFO::NextTextBufferFont</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l01021">FreeScreenBuffer()</a>.
<p>
<pre class="fragment"><div>00958                    :
00959 
00960     This routine all remove a font information in ListOfTextBufferFont.
00961 
00962 Arguments:
00963 
00964 Return Value:
00965 
00966 --*/
00967 
00968 {
00969     <a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> CurrentFont;
00970 
00971     CurrentFont = ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont;
00972 
00973     <span class="keywordflow">while</span> (CurrentFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00974         <a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> NextFont;
00975 
00976         NextFont = CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a>;
00977         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CurrentFont);
00978 
00979         CurrentFont = NextFont;
00980     }
00981 
00982     ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00983 
00984     <span class="keywordflow">return</span> STATUS_SUCCESS;
00985 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="w32/ntcon/server/misc.c::SetFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ScreenInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">1260</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00258">ACTIVE_SCREEN_BUFFER</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00264">ConvertAttrToRGB</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00039">_FONT_INFO::hFont</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00112">SCR_FACENAME()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00104">SCR_FAMILY()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00124">SCR_FONTCODEPAGE()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00108">SCR_FONTNUMBER()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00120">SCR_FONTWEIGHT()</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00881">StoreTextBufferFontInfo()</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00834">CreateWindowsWindow()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l04072">SetActiveScreenBuffer()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>.
<p>
<pre class="fragment"><div>01263 {
01264     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/output_8h.html#a12">ACTIVE_SCREEN_BUFFER</a>(ScreenInfo)) {
01265         <span class="keywordtype">int</span> FontIndex = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a25">FindCreateFont</a>(<a class="code" href="../../d8/d5/consrv_8h.html#a63">SCR_FAMILY</a>(ScreenInfo),
01266                                        <a class="code" href="../../d8/d5/consrv_8h.html#a65">SCR_FACENAME</a>(ScreenInfo),
01267                                        <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo),
01268                                        <a class="code" href="../../d8/d5/consrv_8h.html#a67">SCR_FONTWEIGHT</a>(ScreenInfo),
01269                                        <a class="code" href="../../d8/d5/consrv_8h.html#a68">SCR_FONTCODEPAGE</a>(ScreenInfo));
01270         <span class="keywordflow">if</span> (SelectObject(ScreenInfo-&gt;Console-&gt;hDC,FontInfo[FontIndex].hFont)==0)
01271             <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01272 
01273         <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)FontIndex != <a class="code" href="../../d8/d5/consrv_8h.html#a64">SCR_FONTNUMBER</a>(ScreenInfo)) {
01274             <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01275             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a27">StoreTextBufferFontInfo</a>(ScreenInfo,
01276                                              FontIndex,
01277                                              FontInfo[FontIndex].Size,
01278                                              FontInfo[FontIndex].Family,
01279                                              FontInfo[FontIndex].Weight,
01280                                              FontInfo[FontIndex].FaceName,
01281                                              ScreenInfo-&gt;Console-&gt;OutputCP);
01282             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01283                 <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01284             }
01285         }
01286 
01287         <span class="comment">// hack to get text realized into DC.  this is to force the</span>
01288         <span class="comment">// attribute cache to get flushed to the server side, since</span>
01289         <span class="comment">// we select the font with a client side DC and call ExtTextOut</span>
01290         <span class="comment">// with a server side DC.</span>
01291         <span class="comment">// we then need to reset the text color, since the incorrect</span>
01292         <span class="comment">// client side color has been flushed to the server.</span>
01293         {
01294         TEXTMETRIC tmi;
01295 
01296         GetTextMetricsW( ScreenInfo-&gt;Console-&gt;hDC, &amp;tmi);
01297         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> ((tmi.tmPitchAndFamily &amp; 1) == 0);
01298         ScreenInfo-&gt;Console-&gt;LastAttributes = ScreenInfo-&gt;Attributes;
01299         SetTextColor(ScreenInfo-&gt;Console-&gt;hDC,<a class="code" href="../../d8/d5/consrv_8h.html#a43">ConvertAttrToRGB</a>(ScreenInfo-&gt;Console, <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(ScreenInfo-&gt;Attributes)));
01300         SetBkColor(ScreenInfo-&gt;Console-&gt;hDC,<a class="code" href="../../d8/d5/consrv_8h.html#a43">ConvertAttrToRGB</a>(ScreenInfo-&gt;Console, <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(ScreenInfo-&gt;Attributes &gt;&gt; 4)));
01301         }
01302     }
01303     <span class="keywordflow">return</span> STATUS_SUCCESS;
01304 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="w32/ntcon/server/misc.c::SetScreenBufferFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SetScreenBufferFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FontIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>CodePage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">1077</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d8/d1/output_8h-source.html#l00258">ACTIVE_SCREEN_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00148">CONSOLE_TEXTMODE_BUFFER</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00038">DBGFONTS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00023">FontInfo</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01041">GetFontSize()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00207">GetWindowLimits()</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00203">_WINDOW_LIMITS::MaximumWindowSize</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00202">_WINDOW_LIMITS::MinimumWindowSize</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01573">RealUnicodeToFalseUnicode()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l02231">ResizeScreenBuffer()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00112">SCR_FACENAME()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00104">SCR_FAMILY()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00124">SCR_FONTCODEPAGE()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00108">SCR_FONTNUMBER()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00116">SCR_FONTSIZE()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00120">SCR_FONTWEIGHT()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00243">SetCursorInformation()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, <a class="el" href="../../d0/d3/dbcs_8h.html#a29">SetLineChar()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03953">SetWindowSize()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00881">StoreTextBufferFontInfo()</a>, <a class="el" href="../../d8/d5/font_8h-source.html#l00050">TM_IS_TT_FONT</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>, and <a class="el" href="../../d0/d4/ntcon_2server_2getset_8c-source.html#l01118">SrvSetConsoleFont()</a>.
<p>
<pre class="fragment"><div>01082 {
01083     COORD FontSize;
01084     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
01085     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01086     ULONG ulFlagPrev;
01087     <a class="code" href="../../d8/d5/consrv_8h.html#a0">DBGFONTS</a>((<span class="stringliteral">"SetScreenBufferFont %lx %x\n"</span>, ScreenInfo, FontIndex));
01088 
01089     <span class="keywordflow">if</span> (ScreenInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01090         <span class="comment">/* If shutdown occurs with font dlg up */</span>
01091         <span class="keywordflow">return</span> STATUS_SUCCESS;
01092     }
01093 
01094     <span class="comment">/*</span>
01095 <span class="comment">     * Don't try to set the font if we're not in text mode</span>
01096 <span class="comment">     */</span>
01097     <span class="keywordflow">if</span> (!(ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>)) {
01098         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01099     }
01100 
01101     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a31">GetFontSize</a>(FontIndex, &amp;FontSize);
01102     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01103         <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01104     }
01105 
01106     ulFlagPrev = ScreenInfo-&gt;Flags;
01107     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6/font_8h.html#a2">TM_IS_TT_FONT</a>(FontInfo[FontIndex].Family)) {
01108         ScreenInfo-&gt;Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>;
01109     } <span class="keywordflow">else</span> {
01110         ScreenInfo-&gt;Flags |= <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>;
01111     }
01112 
01113     <span class="comment">/*</span>
01114 <span class="comment">     * Convert from UnicodeOem to Unicode or vice-versa if necessary</span>
01115 <span class="comment">     */</span>
01116     <span class="keywordflow">if</span> ((ulFlagPrev &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) != (ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>)) {
01117         <span class="keywordflow">if</span> (ulFlagPrev &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) {
01118             <span class="comment">/*</span>
01119 <span class="comment">             * Must convert from UnicodeOem to real Unicode</span>
01120 <span class="comment">             */</span>
01121             <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"SetScreenBufferFont converts UnicodeOem to Unicode\n"</span>));
01122             <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a43">FalseUnicodeToRealUnicode</a>(
01123                     ScreenInfo-&gt;BufferInfo.TextInfo.TextRows,
01124                     ScreenInfo-&gt;ScreenBufferSize.X * ScreenInfo-&gt;ScreenBufferSize.Y,
01125                     ScreenInfo-&gt;Console-&gt;OutputCP);
01126         } <span class="keywordflow">else</span> {
01127             <span class="comment">/*</span>
01128 <span class="comment">             * Must convert from real Unicode to UnicodeOem</span>
01129 <span class="comment">             */</span>
01130             <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"SetScreenBufferFont converts Unicode to UnicodeOem\n"</span>));
01131             <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a42">RealUnicodeToFalseUnicode</a>(
01132                     ScreenInfo-&gt;BufferInfo.TextInfo.TextRows,
01133                     ScreenInfo-&gt;ScreenBufferSize.X * ScreenInfo-&gt;ScreenBufferSize.Y,
01134                     ScreenInfo-&gt;Console-&gt;OutputCP);
01135         }
01136     }
01137 
01138     <span class="comment">/*</span>
01139 <span class="comment">     * Store font properties</span>
01140 <span class="comment">     */</span>
01141     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a27">StoreTextBufferFontInfo</a>(ScreenInfo,
01142                                      FontIndex,
01143                                      FontSize,
01144                                      FontInfo[FontIndex].Family,
01145                                      FontInfo[FontIndex].Weight,
01146                                      FontInfo[FontIndex].FaceName,
01147                                      CodePage);
01148     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01149         <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01150     }
01151 
01152     <span class="comment">//</span>
01153     <span class="comment">// set font</span>
01154     <span class="comment">//</span>
01155     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a34">SetFont</a>(ScreenInfo);
01156     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01157         <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01158     }
01159 
01160     <span class="comment">//</span>
01161     <span class="comment">// if window is growing, make sure it's not bigger than the screen.</span>
01162     <span class="comment">//</span>
01163 
01164     <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
01165     <span class="keywordflow">if</span> (WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>.X &lt; <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo)) {
01166         ScreenInfo-&gt;Window.Right -= <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo) - WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>.X;
01167         ScreenInfo-&gt;WindowMaximizedX = (ScreenInfo-&gt;Window.Left == 0 &amp;&amp;
01168                                         (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInfo-&gt;Window.Right+1) == ScreenInfo-&gt;ScreenBufferSize.X);
01169     }
01170     <span class="keywordflow">if</span> (WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>.Y &lt; <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo)) {
01171         ScreenInfo-&gt;Window.Bottom -= <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo) - WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>.Y;
01172         <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.Y &gt; ScreenInfo-&gt;Window.Bottom) {
01173             ScreenInfo-&gt;Window.Top += ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.Y - ScreenInfo-&gt;Window.Bottom;
01174             ScreenInfo-&gt;Window.Bottom += ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.Y - ScreenInfo-&gt;Window.Bottom;
01175         }
01176         ScreenInfo-&gt;WindowMaximizedY = (ScreenInfo-&gt;Window.Top == 0 &amp;&amp;
01177                                         (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInfo-&gt;Window.Bottom+1) == ScreenInfo-&gt;ScreenBufferSize.Y);
01178     }
01179     <span class="keywordflow">if</span> (WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.X &gt; <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo)) {
01180         <span class="keywordflow">if</span> (WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.X &gt; ScreenInfo-&gt;ScreenBufferSize.X) {
01181             COORD NewBufferSize;
01182 
01183             NewBufferSize.X = WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.X;
01184             NewBufferSize.Y = ScreenInfo-&gt;ScreenBufferSize.Y;
01185             <a class="code" href="../../d6/d2/output_8c.html#a58">ResizeScreenBuffer</a>(ScreenInfo,
01186                                NewBufferSize,
01187                                FALSE
01188                               );
01189         }
01190         <span class="keywordflow">if</span> ((ScreenInfo-&gt;Window.Left+WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.X) &gt; ScreenInfo-&gt;ScreenBufferSize.X) {
01191             ScreenInfo-&gt;Window.Left = 0;
01192             ScreenInfo-&gt;Window.Right = WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.X-1;
01193         } <span class="keywordflow">else</span> {
01194             ScreenInfo-&gt;Window.Right = ScreenInfo-&gt;Window.Left+WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.X-1;
01195         }
01196         ScreenInfo-&gt;WindowMaximizedX = (ScreenInfo-&gt;Window.Left == 0 &amp;&amp;
01197                                         (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ScreenInfo-&gt;Window.Right+1) == ScreenInfo-&gt;ScreenBufferSize.X);
01198     }
01199 
01200     <a class="code" href="../../d0/d3/dbcs_8h.html#a29">SetLineChar</a>(ScreenInfo);
01201     {
01202         COORD WindowedWindowSize;
01203 
01204         WindowedWindowSize.X = <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo);
01205         WindowedWindowSize.Y = <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
01206 
01207 
01208 <span class="preprocessor">#if defined(FE_IME)</span>
01209 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(ScreenInfo-&gt;Console))
01210         {
01211             PCONVERSIONAREA_INFORMATION ConvAreaInfo;
01212 
01213             ConvAreaInfo = ScreenInfo-&gt;Console-&gt;ConsoleIme.ConvAreaRoot;
01214             <span class="keywordflow">while</span> (ConvAreaInfo) {
01215 
01216                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a27">StoreTextBufferFontInfo</a>(ConvAreaInfo-&gt;ScreenBuffer,
01217                                                  <a class="code" href="../../d8/d5/consrv_8h.html#a64">SCR_FONTNUMBER</a>(ScreenInfo),
01218                                                  <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo),
01219                                                  <a class="code" href="../../d8/d5/consrv_8h.html#a63">SCR_FAMILY</a>(ScreenInfo),
01220                                                  <a class="code" href="../../d8/d5/consrv_8h.html#a67">SCR_FONTWEIGHT</a>(ScreenInfo),
01221                                                  <a class="code" href="../../d8/d5/consrv_8h.html#a65">SCR_FACENAME</a>(ScreenInfo),
01222                                                  <a class="code" href="../../d8/d5/consrv_8h.html#a68">SCR_FONTCODEPAGE</a>(ScreenInfo));
01223                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01224                     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01225                 }
01226 
01227                 ConvAreaInfo-&gt;ScreenBuffer-&gt;Window = ScreenInfo-&gt;Window;
01228                 ConvAreaInfo-&gt;ScreenBuffer-&gt;BufferInfo.TextInfo.ModeIndex = ScreenInfo-&gt;BufferInfo.TextInfo.ModeIndex;
01229 
01230                 ConvAreaInfo = ConvAreaInfo-&gt;ConvAreaNext;
01231             }
01232         }
01233 <span class="preprocessor">#endif // FE_IME</span>
01234 <span class="preprocessor"></span>    }
01235 
01236     <span class="comment">//</span>
01237     <span class="comment">// resize window.  this will take care of the scroll bars too.</span>
01238     <span class="comment">//</span>
01239 
01240     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/output_8h.html#a12">ACTIVE_SCREEN_BUFFER</a>(ScreenInfo)) {
01241         <a class="code" href="../../d6/d2/output_8c.html#a68">SetWindowSize</a>(ScreenInfo);
01242     }
01243 
01244     <span class="comment">//</span>
01245     <span class="comment">// adjust cursor size.</span>
01246     <span class="comment">//</span>
01247 
01248     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a4">SetCursorInformation</a>(ScreenInfo,
01249                          ScreenInfo-&gt;BufferInfo.TextInfo.CursorSize,
01250                          (BOOLEAN)ScreenInfo-&gt;BufferInfo.TextInfo.CursorVisible
01251                         );
01252 
01253     <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,
01254                   &amp;ScreenInfo-&gt;Window);
01255     <span class="keywordflow">return</span> STATUS_SUCCESS;
01256 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="w32/ntcon/server/misc.c::StoreTextBufferFontInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS StoreTextBufferFontInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FontIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>FontSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FontFamily</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FontWeight</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>FaceName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>CodePage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00881">881</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00099">_TEXT_BUFFER_FONT_INFO::FaceName</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00101">_TEXT_BUFFER_FONT_INFO::Family</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00072">FONT_TAG</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00102">_TEXT_BUFFER_FONT_INFO::FontCodePage</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00098">_TEXT_BUFFER_FONT_INFO::FontNumber</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00097">_TEXT_BUFFER_FONT_INFO::FontSize</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00096">_TEXT_BUFFER_FONT_INFO::NextTextBufferFont</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00100">_TEXT_BUFFER_FONT_INFO::Weight</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00603">ConvertToFullScreen()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l00747">ConvertToWindowed()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>.
<p>
<pre class="fragment"><div>00893                    :
00894 
00895     This routine store a font information in CurrentTextBufferFont and ListOfTextBufferFont.
00896     If specified code page does not exist in ListOfTextBufferFont, then create <span class="keyword">new</span> list.
00897 
00898 Arguments:
00899 
00900 Return Value:
00901 
00902 --*/
00903 
00904 {
00905     <a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">PTEXT_BUFFER_FONT_INFO</a> CurrentFont, PrevFont;
00906 
00907     CurrentFont = ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont;
00908 
00909     <span class="keywordflow">while</span> (CurrentFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00910         <span class="keywordflow">if</span> (CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o6">FontCodePage</a> == CodePage) {
00911             CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o2">FontNumber</a>   = FontIndex;
00912             CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o1">FontSize</a>     = FontSize;
00913             CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o5">Family</a>       = FontFamily;
00914             CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o4">Weight</a>       = FontWeight;
00915             <span class="comment">// CurrentFont-&gt;FontCodePage = CodePage; // Redundant</span>
00916             wcscpy(CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o3">FaceName</a>, FaceName);
00917             <span class="keywordflow">break</span>;
00918         }
00919         PrevFont    = CurrentFont;
00920         CurrentFont = CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a>;
00921     }
00922 
00923     <span class="keywordflow">if</span> (CurrentFont == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00924         CurrentFont = <a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( FONT_TAG ), <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html">TEXT_BUFFER_FONT_INFO</a>));
00925         <span class="keywordflow">if</span> (CurrentFont == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00926             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00927         }
00928 
00929         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00930         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o2">FontNumber</a>   = FontIndex;
00931         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o1">FontSize</a>     = FontSize;
00932         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o5">Family</a>       = FontFamily;
00933         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o4">Weight</a>       = FontWeight;
00934         CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o6">FontCodePage</a> = CodePage;
00935         wcscpy(CurrentFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o3">FaceName</a>, FaceName);
00936 
00937         <span class="keywordflow">if</span> (ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00938             ScreenInfo-&gt;BufferInfo.TextInfo.ListOfTextBufferFont = CurrentFont;
00939         }
00940         <span class="keywordflow">else</span> {
00941             PrevFont-&gt;<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a> = CurrentFont;
00942         }
00943     }
00944 
00945     ScreenInfo-&gt;BufferInfo.TextInfo.CurrentTextBufferFont = *CurrentFont;
00946     ScreenInfo-&gt;BufferInfo.TextInfo.CurrentTextBufferFont.<a class="code" href="../../d7/d0/struct__TEXT__BUFFER__FONT__INFO.html#o0">NextTextBufferFont</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00947 
00948     <span class="keywordflow">return</span> STATUS_SUCCESS;
00949 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="w32/ntcon/server/misc.c::WcharToChar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> char WcharToChar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Codepage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Wchar</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01489">1489</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00040">DBGCHARS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, and <a class="el" href="../../d0/d6/nlsxlat_8c-source.html#l01277">RtlUnicodeToOemN()</a>.
<p>
Referenced by <a class="el" href="../../d0/d2/__priv_8h-source.html#l00041">FE_WriteRegionToScreenHW()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01795">ReadOutputString()</a>, <a class="el" href="../../d3/d7/directio_8c-source.html#l00801">SB_TranslateOutputToOem()</a>, and <a class="el" href="../../d3/d7/directio_8c-source.html#l00045">TranslateInputToOem()</a>.
<p>
<pre class="fragment"><div>01492 {
01493     <span class="keywordtype">char</span> ch;
01494     <span class="keywordflow">if</span> (Codepage == <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>) {
01495         <a class="code" href="../../d9/d6/nlsxlat_8c.html#a39">RtlUnicodeToOemN</a>(&amp;ch, <span class="keyword">sizeof</span>(ch), NULL, &amp;Wchar, <span class="keyword">sizeof</span>(Wchar));
01496     } <span class="keywordflow">else</span> {
01497         WideCharToMultiByte(Codepage, 0, &amp;Wchar, 1, &amp;ch, 1, NULL, NULL);
01498     }
01499 <span class="preprocessor">#ifdef DEBUG_PRINT</span>
01500 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Wchar &gt; 0x007F) {
01501         <a class="code" href="../../d8/d5/consrv_8h.html#a2">DBGCHARS</a>((<span class="stringliteral">"WcharToChar %d 0x%04x -&gt; 0x%02x\n"</span>,Codepage,Wchar,(UCHAR)ch));
01502     }
01503 <span class="preprocessor">#endif</span>
01504 <span class="preprocessor"></span>    <span class="keywordflow">return</span> ch;
01505 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a9" doxytag="w32/ntcon/server/misc.c::DefaultFaceName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a9">DefaultFaceName</a>[LF_FACESIZE]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00035">35</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="w32/ntcon/server/misc.c::DefaultFontFamily" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a11">DefaultFontFamily</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00037">37</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="w32/ntcon/server/misc.c::DefaultFontIndex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a12">DefaultFontIndex</a> = 0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00038">38</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="w32/ntcon/server/misc.c::DefaultFontSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> COORD <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a10">DefaultFontSize</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00036">36</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="w32/ntcon/server/misc.c::FontInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d9/struct__FONT__INFO.html">PFONT_INFO</a> <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a6">FontInfo</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00031">31</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00270">DoCreateScreenBuffer()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00998">GetAvailableFonts()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01041">GetFontSize()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01260">SetFont()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03336">SetRAMFont()</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03175">SetRAMFontCodePage()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01077">SetScreenBufferFont()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="w32/ntcon/server/misc.c::FontInfoLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a7">FontInfoLength</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00032">32</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="w32/ntcon/server/misc.c::GlyphCP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CPTABLEINFO <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a15">GlyphCP</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00050">50</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01443">CharToWcharGlyph()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01384">ConvertOutputToUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01787">InitializeCustomCP()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="w32/ntcon/server/misc.c::GlyphTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a16">GlyphTable</a>[256]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00051">51</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01787">InitializeCustomCP()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="w32/ntcon/server/misc.c::gpFaceNames" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d4/structtagFACENODE.html">PFACENODE</a> <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a17">gpFaceNames</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00062">62</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="w32/ntcon/server/misc.c::NumberOfFonts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a8">NumberOfFonts</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00033">33</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l00485">CreateScreenBuffer()</a>, <a class="el" href="../../d8/d3/conexts_8c-source.html#l00848">df()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00515">EnumerateFonts()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00650">FindCreateFont()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00152">FontEnum()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00998">GetAvailableFonts()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01041">GetFontSize()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00988">GetNumFonts()</a>, and <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00287">PropertiesDlgShow()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="w32/ntcon/server/misc.c::NumberOfMouseButtons" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a5">NumberOfMouseButtons</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00029">29</a> of file <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html">w32/ntcon/server/misc.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00066">GetMouseButtons()</a>, and <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l00075">InitializeMouseButtons()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:43 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
