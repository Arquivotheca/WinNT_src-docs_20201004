<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: cmconfig.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cmconfig.c File Reference</h1><code>#include "<a class="el" href="../../d2/d1/cmp_8h-source.html">cmp.h</a>"</code><br>

<p>
<a href="../../d5/d9/cmconfig_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a0">TITLE_INDEX_VALUE</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a1">EISA_ADAPTER_INDEX</a>&nbsp;&nbsp;&nbsp;EisaAdapter</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a2">TURBOCHANNEL_ADAPTER_INDEX</a>&nbsp;&nbsp;&nbsp;TcAdapter</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a11">CmpSetupConfigurationTree</a> (IN <a class="el" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> CurrentEntry, IN HANDLE ParentHandle, IN INTERFACE_TYPE <a class="el" href="../../d6/d0/cmdat_8c.html#a4">InterfaceType</a>, IN ULONG <a class="el" href="../../d2/d7/hal_8h.html#a75">BusNumber</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a12">CmpInitializeHardwareConfiguration</a> (IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a> LoaderBlock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a13">CmpInitializeRegistryNode</a> (IN <a class="el" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> CurrentEntry, IN HANDLE ParentHandle, OUT PHANDLE NewHandle, IN INTERFACE_TYPE <a class="el" href="../../d6/d0/cmdat_8c.html#a4">InterfaceType</a>, IN ULONG <a class="el" href="../../d2/d7/hal_8h.html#a75">BusNumber</a>, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a22">PUSHORT</a> DeviceIndexTable)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a3">CmpTypeCount</a> []</td></tr>

<tr><td class="memItemLeft" nowrap>struct {</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;PUCHAR&nbsp;&nbsp;&nbsp;<a class="el" href="../../d4/d0/cmconfig_8c.html#a4">AscString</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>&nbsp;&nbsp;&nbsp;<a class="el" href="../../d4/d0/cmconfig_8c.html#a5">InterfaceType</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;&nbsp;&nbsp;<a class="el" href="../../d4/d0/cmconfig_8c.html#a6">Count</a></td></tr>

<tr><td class="memItemLeft" nowrap valign=top>}&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a7">CmpMultifunctionTypes</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a8">CmpUnknownBusCount</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a9">CmpConfigurationAreaSize</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PCM_FULL_RESOURCE_DESCRIPTOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="cmconfig.c::EISA_ADAPTER_INDEX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EISA_ADAPTER_INDEX&nbsp;&nbsp;&nbsp;EisaAdapter          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00040">40</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00294">CmpSetupConfigurationTree()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="cmconfig.c::TITLE_INDEX_VALUE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TITLE_INDEX_VALUE&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00034">34</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="cmconfig.c::TURBOCHANNEL_ADAPTER_INDEX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TURBOCHANNEL_ADAPTER_INDEX&nbsp;&nbsp;&nbsp;TcAdapter          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00041">41</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00294">CmpSetupConfigurationTree()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a12" doxytag="cmconfig.c::CmpInitializeHardwareConfiguration" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpInitializeHardwareConfiguration           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>LoaderBlock</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00087">87</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00064">CmpConfigurationAreaSize</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00065">CmpConfigurationData</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00294">CmpSetupConfigurationTree()</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00169">CmRegistryMachineHardwareDescriptionName</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00171">CmRegistryMachineHardwareDeviceMapName</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01630">_CONFIGURATION_COMPONENT_DATA::ComponentEntry</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00288">_CONFIGURATION_COMPONENT::Identifier</a>, <a class="el" href="../../d0/d4/config_8c-source.html#l00034">KeFindConfigurationEntry()</a>, <a class="el" href="../../d8/d2/i386init_8c-source.html#l00038">KeI386MachineType</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a227">MaximumType</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d1/d9/arc_8h.html#a314a179">SystemClass</a>, and <a class="el" href="../../d5/d0/config_2alpha_2init_8c-source.html#l00034">TITLE_INDEX_VALUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00293">CmInitSystem1()</a>.
<p>
<pre class="fragment"><div>00092                    :
00093 
00094     This routine creates \\Registry\Machine\Hardware node in
00095     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry and calls SetupTree routine to put <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> hardware
00096     information to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.
00097 
00098 Arguments:
00099 
00100     LoaderBlock - supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LoaderBlock passed in from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00101                   OS Loader.
00102 
00103 Returns:
00104 
00105     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> code <span class="keywordflow">for</span> sucess or <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> of <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>.
00106 
00107 --*/
00108 {
00109     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00110     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00111     HANDLE BaseHandle;
00112     <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> ConfigurationRoot;
00113     ULONG Disposition;
00114 
00115     ConfigurationRoot = (<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a>)LoaderBlock-&gt;ConfigurationRoot;
00116     <span class="keywordflow">if</span> (ConfigurationRoot) {
00117 
00118 <span class="preprocessor">#ifdef _X86_</span>
00119 <span class="preprocessor"></span>
00120         <span class="comment">//</span>
00121         <span class="comment">//  The following strings found in the registry identify obscure,</span>
00122         <span class="comment">//  yet market dominant, non PC/AT compatible i386 machine in Japan.</span>
00123         <span class="comment">//</span>
00124 
00125 <span class="preprocessor">#define MACHINE_TYPE_FUJITSU_FMR_NAME_A    "FUJITSU FMR-"</span>
00126 <span class="preprocessor"></span><span class="preprocessor">#define MACHINE_TYPE_NEC_PC98_NAME_A       "NEC PC-98"</span>
00127 <span class="preprocessor"></span>
00128         {
00129             <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> SystemNode;
00130             ULONG JapanMachineId;
00131 
00132             <span class="comment">//</span>
00133             <span class="comment">// For Japan, we have to special case some non PC/AT machines, so</span>
00134             <span class="comment">// determine at this time what kind of platform we are on:</span>
00135             <span class="comment">//</span>
00136             <span class="comment">// NEC PC9800 Compatibles/Fujitsu FM-R Compatibles/IBM PC/AT Compatibles</span>
00137             <span class="comment">//</span>
00138             <span class="comment">// Default is PC/AT compatible.</span>
00139             <span class="comment">//</span>
00140 
00141             JapanMachineId = MACHINE_TYPE_PC_AT_COMPATIBLE;
00142 
00143             <span class="comment">//</span>
00144             <span class="comment">// Find the hardware description node</span>
00145             <span class="comment">//</span>
00146 
00147             SystemNode = <a class="code" href="../../d9/d4/config_8c.html#a0">KeFindConfigurationEntry</a>(ConfigurationRoot,
00148                                                   SystemClass,
00149                                                   MaximumType,
00150                                                   NULL);
00151 
00152             <span class="comment">//</span>
00153             <span class="comment">// Did we find something?</span>
00154             <span class="comment">//</span>
00155 
00156             <span class="keywordflow">if</span> (SystemNode) {
00157 
00158                 <span class="comment">//</span>
00159                 <span class="comment">// Check platform from identifier string</span>
00160                 <span class="comment">//</span>
00161 
00162                 <span class="keywordflow">if</span> (RtlCompareMemory(SystemNode-&gt;<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html#o3">ComponentEntry</a>.<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o9">Identifier</a>,
00163                                      MACHINE_TYPE_NEC_PC98_NAME_A,
00164                                      <span class="keyword">sizeof</span>(MACHINE_TYPE_NEC_PC98_NAME_A) - 1) ==
00165                     <span class="keyword">sizeof</span>(MACHINE_TYPE_NEC_PC98_NAME_A) - 1) {
00166 
00167                     <span class="comment">//</span>
00168                     <span class="comment">// we are running on NEC PC-9800 comaptibles.</span>
00169                     <span class="comment">//</span>
00170 
00171                     JapanMachineId = MACHINE_TYPE_PC_9800_COMPATIBLE;
00172                     SetNEC_98;
00173 
00174                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (RtlCompareMemory(SystemNode-&gt;<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html#o3">ComponentEntry</a>.<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o9">Identifier</a>,
00175                                             MACHINE_TYPE_FUJITSU_FMR_NAME_A,
00176                                             <span class="keyword">sizeof</span>(MACHINE_TYPE_FUJITSU_FMR_NAME_A) - 1) ==
00177                            <span class="keyword">sizeof</span>(MACHINE_TYPE_FUJITSU_FMR_NAME_A) - 1) {
00178 
00179                     <span class="comment">//</span>
00180                     <span class="comment">// we are running on Fujitsu FMR comaptibles.</span>
00181                     <span class="comment">//</span>
00182 
00183                     JapanMachineId = MACHINE_TYPE_FMR_COMPATIBLE;
00184                 }
00185             }
00186 
00187             <span class="comment">//</span>
00188             <span class="comment">//  Now 'or' this value into the kernel global.</span>
00189             <span class="comment">//</span>
00190 
00191             <a class="code" href="../../d7/d3/i386init_8c.html#a1">KeI386MachineType</a> |= JapanMachineId;
00192         }
00193 <span class="preprocessor">#endif //_X86_</span>
00194 <span class="preprocessor"></span>
00195         <span class="comment">//</span>
00196         <span class="comment">// Create \\Registry\Machine\Hardware\DeviceMap</span>
00197         <span class="comment">//</span>
00198 
00199         InitializeObjectAttributes(
00200             &amp;ObjectAttributes,
00201             &amp;CmRegistryMachineHardwareDeviceMapName,
00202             0,
00203             (HANDLE)NULL,
00204             NULL
00205             );
00206         <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Attributes |= OBJ_CASE_INSENSITIVE;
00207 
00208         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(                   <span class="comment">// Paht may already exist</span>
00209                     &amp;BaseHandle,
00210                     KEY_READ | KEY_WRITE,
00211                     &amp;ObjectAttributes,
00212                     TITLE_INDEX_VALUE,
00213                     NULL,
00214                     0,
00215                     &amp;Disposition
00216                     );
00217 
00218         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00219             <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00220         }
00221 
00222         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(BaseHandle);
00223 
00224         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Disposition == REG_CREATED_NEW_KEY);
00225 
00226         <span class="comment">//</span>
00227         <span class="comment">// Create \\Registry\Machine\Hardware\Description and use the</span>
00228         <span class="comment">// returned handle as the BaseHandle to build the hardware tree.</span>
00229         <span class="comment">//</span>
00230 
00231         InitializeObjectAttributes(
00232             &amp;ObjectAttributes,
00233             &amp;CmRegistryMachineHardwareDescriptionName,
00234             0,
00235             (HANDLE)NULL,
00236             NULL
00237             );
00238         <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Attributes |= OBJ_CASE_INSENSITIVE;
00239 
00240         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(                   <span class="comment">// Path may already exist</span>
00241                     &amp;BaseHandle,
00242                     KEY_READ | KEY_WRITE,
00243                     &amp;ObjectAttributes,
00244                     TITLE_INDEX_VALUE,
00245                     NULL,
00246                     0,
00247                     &amp;Disposition
00248                     );
00249 
00250         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00251             <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00252         }
00253 
00254         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Disposition == REG_CREATED_NEW_KEY);
00255 
00256         <span class="comment">//</span>
00257         <span class="comment">// Allocate 16K bytes memory from paged pool for constructing</span>
00258         <span class="comment">// configuration data for controller component.</span>
00259         <span class="comment">// NOTE:  The configuration Data for controller component</span>
00260         <span class="comment">//    usually takes less than 100 bytes.  But on EISA machine, the</span>
00261         <span class="comment">//    EISA configuration information takes more than 10K and up to</span>
00262         <span class="comment">//    64K.  I believe 16K is the reasonable number to handler 99.9%</span>
00263         <span class="comment">//    of the machines.  Therefore, 16K is the initial value.</span>
00264         <span class="comment">//</span>
00265 
00266         <a class="code" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a> = (PCM_FULL_RESOURCE_DESCRIPTOR)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(
00267                                             PagedPool,
00268                                             CmpConfigurationAreaSize
00269                                             );
00270 
00271         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00272             <span class="keywordflow">return</span>(STATUS_INSUFFICIENT_RESOURCES);
00273         }
00274 
00275         <span class="comment">//</span>
00276         <span class="comment">// Call SetupConfigurationTree routine to go over each component</span>
00277         <span class="comment">// of the tree and add component information to registry database.</span>
00278         <span class="comment">//</span>
00279 
00280         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/cmconfig_8c.html#a11">CmpSetupConfigurationTree</a>(ConfigurationRoot,
00281                                            BaseHandle,
00282                                            -1,
00283                                            (ULONG)-1
00284                                            );
00285         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>((PVOID)CmpConfigurationData);
00286         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(BaseHandle);
00287         <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00288     } <span class="keywordflow">else</span> {
00289         <span class="keywordflow">return</span>(STATUS_SUCCESS);
00290     }
00291 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="cmconfig.c::CmpInitializeRegistryNode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpInitializeRegistryNode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CurrentEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ParentHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>NewHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN INTERFACE_TYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>InterfaceType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BusNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a22">PUSHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceIndexTable</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00458">458</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
References <a class="el" href="../../d1/d9/arc_8h.html#a315a187">ArcSystem</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l01170">BusNumber</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00279">_CONFIGURATION_COMPONENT::Class</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00052">CmClassName</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00064">CmpConfigurationAreaSize</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00065">CmpConfigurationData</a>, <a class="el" href="../../d7/d9/cmdat_8c-source.html#l00108">CmTypeName</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00286">_CONFIGURATION_COMPONENT::ConfigurationDataLength</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00281">_CONFIGURATION_COMPONENT::Flags</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00288">_CONFIGURATION_COMPONENT::Identifier</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00287">_CONFIGURATION_COMPONENT::IdentifierLength</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00050">InterfaceType</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00102">RtlInitAnsiString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00040">RtlIntegerToChar()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d1/d9/arc_8h.html#a314a179">SystemClass</a>, <a class="el" href="../../d5/d0/config_2alpha_2init_8c-source.html#l00034">TITLE_INDEX_VALUE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00280">_CONFIGURATION_COMPONENT::Type</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00465">CmpInitializeMachineDependentConfiguration()</a>, and <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00294">CmpSetupConfigurationTree()</a>.
<p>
<pre class="fragment"><div>00469                    :
00470 
00471     This routine creates a node <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current firmware component
00472     and puts component data to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data part of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> node.
00473 
00474 Arguments:
00475 
00476     CurrentEntry - Supplies a pointer to a configuration component.
00477 
00478     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent handle of CurrentEntry node.
00479 
00480     NewHandle - Suppiles a pointer to a HANDLE to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle of
00481         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> newly created node.
00482 
00483     <a class="code" href="../../d4/d0/cmconfig_8c.html#a5">InterfaceType</a> - Specify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Interface <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bus that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00484         CurrentEntry component resides. (See <a class="code" href="../../d2/d7/hal_8h.html#a75">BusNumber</a> also)
00485 
00486     <a class="code" href="../../d2/d7/hal_8h.html#a75">BusNumber</a> - Specify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Bus Number of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bus that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CurrentEntry
00487         component resides on.  If Bus number <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> -1, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> means <a class="code" href="../../d4/d0/cmconfig_8c.html#a5">InterfaceType</a>
00488         and <a class="code" href="../../d2/d7/hal_8h.html#a75">BusNumber</a> are meaningless <span class="keywordflow">for</span> <span class="keyword">this</span> component.
00489 
00490 Returns:
00491 
00492     None.
00493 
00494 --*/
00495 {
00496 
00497     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00498     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00499     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00500     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00501     UNICODE_STRING ValueData;
00502     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00503     HANDLE OldHandle;
00504     ANSI_STRING AnsiString;
00505     UCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[12];
00506     WCHAR UnicodeBuffer[12];
00507     <a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">CONFIGURATION_COMPONENT</a> *Component;
00508     ULONG Disposition;
00509     ULONG ConfigurationDataLength;
00510     PCM_FULL_RESOURCE_DESCRIPTOR NewArea;
00511 
00512     Component = &amp;CurrentEntry-&gt;ComponentEntry;
00513 
00514     <span class="comment">//</span>
00515     <span class="comment">// If the component class is SystemClass, we set its Type to be</span>
00516     <span class="comment">// ArcSystem.  The reason is because the detection code sets</span>
00517     <span class="comment">// its type to MaximumType to indicate it is NOT ARC compatible.</span>
00518     <span class="comment">// Here, we are only interested in building a System Node.  So we</span>
00519     <span class="comment">// change its Type to ArcSystem to ease the setup.</span>
00520     <span class="comment">//</span>
00521 
00522     <span class="keywordflow">if</span> (Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o0">Class</a> == <a class="code" href="../../d1/d9/arc_8h.html#a314a179">SystemClass</a>) {
00523         Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o1">Type</a> = <a class="code" href="../../d1/d9/arc_8h.html#a315a187">ArcSystem</a>;
00524     }
00525 
00526     <span class="comment">//</span>
00527     <span class="comment">// Create a new key to describe the Component.</span>
00528     <span class="comment">//</span>
00529     <span class="comment">// The type of the component will be used as the keyname of the</span>
00530     <span class="comment">// registry node.  The class is the class of the component.</span>
00531     <span class="comment">//</span>
00532 
00533     InitializeObjectAttributes(
00534         &amp;ObjectAttributes,
00535         &amp;(CmTypeName[Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o1">Type</a>]),
00536         0,
00537         ParentHandle,
00538         NULL
00539         );
00540     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Attributes |= OBJ_CASE_INSENSITIVE;
00541 
00542     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(                   <span class="comment">// Paht may already exist</span>
00543                 &amp;Handle,
00544                 KEY_READ | KEY_WRITE,
00545                 &amp;ObjectAttributes,
00546                 TITLE_INDEX_VALUE,
00547                 &amp;(CmClassName[Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o0">Class</a>]),
00548                 0,
00549                 &amp;Disposition
00550                 );
00551 
00552     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00553         <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00554     }
00555 
00556     <span class="comment">//</span>
00557     <span class="comment">// If this component is NOT a SystemClass component, we will</span>
00558     <span class="comment">// create a subkey to identify the component's ordering.</span>
00559     <span class="comment">//</span>
00560 
00561     <span class="keywordflow">if</span> (Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o0">Class</a> != <a class="code" href="../../d1/d9/arc_8h.html#a314a179">SystemClass</a>) {
00562 
00563         <a class="code" href="../../d9/d3/cnvint_8c.html#a2">RtlIntegerToChar</a>(
00564             DeviceIndexTable[Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o1">Type</a>]++,
00565             10,
00566             12,
00567             Buffer
00568             );
00569 
00570         <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(
00571             &amp;AnsiString,
00572             Buffer
00573             );
00574 
00575         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Buffer = (PWSTR)UnicodeBuffer;
00576         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length = 0;
00577         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.MaximumLength = <span class="keyword">sizeof</span>(UnicodeBuffer);
00578 
00579         <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(
00580             &amp;KeyName,
00581             &amp;AnsiString,
00582             FALSE
00583             );
00584 
00585         OldHandle = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00586 
00587         InitializeObjectAttributes(
00588             &amp;ObjectAttributes,
00589             &amp;KeyName,
00590             0,
00591             OldHandle,
00592             NULL
00593             );
00594         <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Attributes |= OBJ_CASE_INSENSITIVE;
00595 
00596         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(
00597                     &amp;Handle,
00598                     KEY_READ | KEY_WRITE,
00599                     &amp;ObjectAttributes,
00600                     TITLE_INDEX_VALUE,
00601                     &amp;(CmClassName[Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o0">Class</a>]),
00602                     0,
00603                     &amp;Disposition
00604                     );
00605 
00606         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(OldHandle);
00607 
00608         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00609             <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00610         }
00611 
00612         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Disposition == REG_CREATED_NEW_KEY);
00613     }
00614 
00615     <span class="comment">//</span>
00616     <span class="comment">// Create a value which describes the following component information:</span>
00617     <span class="comment">//     Flags, Cersion, Key, AffinityMask.</span>
00618     <span class="comment">//</span>
00619 
00620     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00621         &amp;ValueName,
00622         L<span class="stringliteral">"Component Information"</span>
00623         );
00624 
00625     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00626                 Handle,
00627                 &amp;ValueName,
00628                 TITLE_INDEX_VALUE,
00629                 REG_BINARY,
00630                 &amp;Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o2">Flags</a>,
00631                 FIELD_OFFSET(<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">CONFIGURATION_COMPONENT</a>, ConfigurationDataLength) -
00632                     FIELD_OFFSET(<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">CONFIGURATION_COMPONENT</a>, Flags)
00633                 );
00634 
00635     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00636         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle);
00637         <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00638     }
00639 
00640     <span class="comment">//</span>
00641     <span class="comment">// Create a value which describes the component identifier, if any.</span>
00642     <span class="comment">//</span>
00643 
00644     <span class="keywordflow">if</span> (Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o8">IdentifierLength</a>) {
00645 
00646         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00647             &amp;ValueName,
00648             L<span class="stringliteral">"Identifier"</span>
00649             );
00650 
00651         <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(
00652             &amp;AnsiString,
00653             Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o9">Identifier</a>
00654             );
00655 
00656         <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(
00657             &amp;ValueData,
00658             &amp;AnsiString,
00659             TRUE
00660             );
00661 
00662         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00663                     Handle,
00664                     &amp;ValueName,
00665                     TITLE_INDEX_VALUE,
00666                     REG_SZ,
00667                     ValueData.Buffer,
00668                     ValueData.Length + <span class="keyword">sizeof</span>( UNICODE_NULL )
00669                     );
00670 
00671         <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;ValueData);
00672 
00673         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00674             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle);
00675             <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00676         }
00677     }
00678 
00679     <span class="comment">//</span>
00680     <span class="comment">// Create a value entry for component configuration data.</span>
00681     <span class="comment">//</span>
00682 
00683     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00684         &amp;ValueName,
00685         L<span class="stringliteral">"Configuration Data"</span>
00686         );
00687 
00688     <span class="comment">//</span>
00689     <span class="comment">// Create the configuration data based on CM_FULL_RESOURCE_DESCRIPTOR.</span>
00690     <span class="comment">//</span>
00691     <span class="comment">// Note the configuration data in firmware tree may be in the form of</span>
00692     <span class="comment">// CM_PARTIAL_RESOURCE_LIST or nothing.  In both cases, we need to</span>
00693     <span class="comment">// set up the registry configuration data to be in the form of</span>
00694     <span class="comment">// CM_FULL_RESOURCE_DESCRIPTOR.</span>
00695     <span class="comment">//</span>
00696 
00697     <span class="keywordflow">if</span> (CurrentEntry-&gt;ConfigurationData) {
00698 
00699         <span class="comment">//</span>
00700         <span class="comment">// This component has configuration data, we copy the data</span>
00701         <span class="comment">// to our work area, add some more data items and copy the new</span>
00702         <span class="comment">// configuration data to the registry.</span>
00703         <span class="comment">//</span>
00704 
00705         ConfigurationDataLength = Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o7">ConfigurationDataLength</a> +
00706                       FIELD_OFFSET(CM_FULL_RESOURCE_DESCRIPTOR,
00707                       PartialResourceList);
00708 
00709         <span class="comment">//</span>
00710         <span class="comment">// Make sure our reserved area is big enough to hold the data.</span>
00711         <span class="comment">//</span>
00712 
00713         <span class="keywordflow">if</span> (ConfigurationDataLength &gt; <a class="code" href="../../d4/d0/cmconfig_8c.html#a9">CmpConfigurationAreaSize</a>) {
00714 
00715             <span class="comment">//</span>
00716             <span class="comment">// If reserved area is not big enough, we resize our reserved</span>
00717             <span class="comment">// area.  If, unfortunately, the reallocation fails, we simply</span>
00718             <span class="comment">// loss the configuration data of this particular component.</span>
00719             <span class="comment">//</span>
00720 
00721             NewArea = (PCM_FULL_RESOURCE_DESCRIPTOR)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(
00722                                             PagedPool,
00723                                             ConfigurationDataLength
00724                                             );
00725 
00726             <span class="keywordflow">if</span> (NewArea) {
00727                 <a class="code" href="../../d4/d0/cmconfig_8c.html#a9">CmpConfigurationAreaSize</a> = ConfigurationDataLength;
00728                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(CmpConfigurationData);
00729                 <a class="code" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a> = NewArea;
00730                 RtlMoveMemory(
00731                     (PUCHAR)&amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a>-&gt;PartialResourceList.Version,
00732                     CurrentEntry-&gt;ConfigurationData,
00733                     Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o7">ConfigurationDataLength</a>
00734                     );
00735             } <span class="keywordflow">else</span> {
00736                 Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o7">ConfigurationDataLength</a> = 0;
00737                 CurrentEntry-&gt;ConfigurationData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00738             }
00739         } <span class="keywordflow">else</span> {
00740             RtlMoveMemory(
00741                 (PUCHAR)&amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a>-&gt;PartialResourceList.Version,
00742                 CurrentEntry-&gt;ConfigurationData,
00743                 Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o7">ConfigurationDataLength</a>
00744                 );
00745         }
00746 
00747     }
00748 
00749     <span class="keywordflow">if</span> (CurrentEntry-&gt;ConfigurationData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00750 
00751         <span class="comment">//</span>
00752         <span class="comment">// This component has NO configuration data (or we can't resize</span>
00753         <span class="comment">// our reserved area to hold the data), we simple add whatever</span>
00754         <span class="comment">// is required to set up a CM_FULL_RESOURCE_LIST.</span>
00755         <span class="comment">//</span>
00756 
00757         <a class="code" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a>-&gt;PartialResourceList.Version = 0;
00758         <a class="code" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a>-&gt;PartialResourceList.Revision = 0;
00759         <a class="code" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a>-&gt;PartialResourceList.Count = 0;
00760         ConfigurationDataLength = FIELD_OFFSET(CM_FULL_RESOURCE_DESCRIPTOR,
00761                                                PartialResourceList) +
00762                                   FIELD_OFFSET(CM_PARTIAL_RESOURCE_LIST,
00763                                                PartialDescriptors);
00764     }
00765 
00766     <span class="comment">//</span>
00767     <span class="comment">// Set up InterfaceType and BusNumber for the component.</span>
00768     <span class="comment">//</span>
00769 
00770     <a class="code" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a>-&gt;InterfaceType = <a class="code" href="../../d4/d0/cmconfig_8c.html#a5">InterfaceType</a>;
00771     <a class="code" href="../../d4/d0/cmconfig_8c.html#a10">CmpConfigurationData</a>-&gt;BusNumber = <a class="code" href="../../d2/d7/hal_8h.html#a75">BusNumber</a>;
00772 
00773     <span class="comment">//</span>
00774     <span class="comment">// Write the newly constructed configuration data to the hardware registry</span>
00775     <span class="comment">//</span>
00776 
00777     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00778                 Handle,
00779                 &amp;ValueName,
00780                 TITLE_INDEX_VALUE,
00781                 REG_FULL_RESOURCE_DESCRIPTOR,
00782                 CmpConfigurationData,
00783                 ConfigurationDataLength
00784                 );
00785 
00786     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00787         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle);
00788         <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00789     }
00790 
00791     *NewHandle = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00792     <span class="keywordflow">return</span>(STATUS_SUCCESS);
00793 
00794 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="cmconfig.c::CmpSetupConfigurationTree" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CmpSetupConfigurationTree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CurrentEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ParentHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN INTERFACE_TYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>InterfaceType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BusNumber</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00294">294</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
References <a class="el" href="../../d1/d9/arc_8h.html#a314a182">AdapterClass</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00049">AscString</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l01170">BusNumber</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00279">_CONFIGURATION_COMPONENT::Class</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00458">CmpInitializeRegistryNode()</a>, <a class="el" href="../../d4/d0/cmconfig_8c.html#a7">CmpMultifunctionTypes</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00037">CmpTypeCount</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00054">CmpUnknownBusCount</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00040">EISA_ADAPTER_INDEX</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a195">EisaAdapter</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00288">_CONFIGURATION_COMPONENT::Identifier</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00050">InterfaceType</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a199">MultiFunctionAdapter</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d1/cmp_8h-source.html#l00420">NUMBER_TYPES</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a197">ScsiAdapter</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d1/d9/arc_8h.html#a314a179">SystemClass</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a196">TcAdapter</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00041">TURBOCHANNEL_ADAPTER_INDEX</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00280">_CONFIGURATION_COMPONENT::Type</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00087">CmpInitializeHardwareConfiguration()</a>.
<p>
<pre class="fragment"><div>00302                    :
00303 
00304     This routine traverses loader configuration tree and <span class="keyword">register</span>
00305     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> hardware information to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry data base.
00306 
00307     Note to reduce <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> stack usage on machines with large number of PCI buses,
00308     we <span class="keywordflow">do</span> not recursively process <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sibling nodes.  We <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> recursively
00309     process <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> child trees.
00310 
00311 Arguments:
00312 
00313     CurrentEntry - Supplies a pointer to a loader configuration
00314         tree or subtree.
00315 
00316     ParentHandle - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent handle of CurrentEntry node.
00317 
00318     <a class="code" href="../../d4/d0/cmconfig_8c.html#a5">InterfaceType</a> - Specify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Interface <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bus that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00319         CurrentEntry component resides.
00320 
00321     <a class="code" href="../../d2/d7/hal_8h.html#a75">BusNumber</a> - Specify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Bus Number of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bus that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CurrentEntry
00322         component resides.  If Bus number <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> -1, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> means <a class="code" href="../../d4/d0/cmconfig_8c.html#a5">InterfaceType</a>
00323         and <a class="code" href="../../d2/d7/hal_8h.html#a75">BusNumber</a> are meaningless <span class="keywordflow">for</span> <span class="keyword">this</span> component.
00324 
00325 Returns:
00326 
00327     None.
00328 
00329 --*/
00330 {
00331     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00332     HANDLE NewHandle;
00333     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> i;
00334     <a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">CONFIGURATION_COMPONENT</a> *Component;
00335     INTERFACE_TYPE LocalInterfaceType = <a class="code" href="../../d4/d0/cmconfig_8c.html#a5">InterfaceType</a>;
00336     ULONG LocalBusNumber = <a class="code" href="../../d2/d7/hal_8h.html#a75">BusNumber</a>;
00337     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> DeviceIndexTable[<a class="code" href="../../d1/d2/cmp_8h.html#a68">NUMBER_TYPES</a>];
00338 
00339     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d1/d2/cmp_8h.html#a68">NUMBER_TYPES</a>; i++) {
00340         DeviceIndexTable[i] = 0;
00341     }
00342 
00343     <span class="comment">//</span>
00344     <span class="comment">// Process current entry and its siblings</span>
00345     <span class="comment">//</span>
00346 
00347     <span class="keywordflow">while</span> (CurrentEntry) {
00348 
00349         <span class="comment">//</span>
00350         <span class="comment">// Register current entry first before going down to its children</span>
00351         <span class="comment">//</span>
00352 
00353         Component = &amp;CurrentEntry-&gt;ComponentEntry;
00354 
00355         <span class="comment">//</span>
00356         <span class="comment">// If the current component is a bus component, we will set up</span>
00357         <span class="comment">// its bus number and Interface type and use them to initialize</span>
00358         <span class="comment">// its subtree.</span>
00359         <span class="comment">//</span>
00360 
00361         <span class="keywordflow">if</span> (Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o0">Class</a> == <a class="code" href="../../d1/d9/arc_8h.html#a314a182">AdapterClass</a> &amp;&amp;
00362             CurrentEntry-&gt;Parent-&gt;ComponentEntry.Class == <a class="code" href="../../d1/d9/arc_8h.html#a314a179">SystemClass</a>) {
00363 
00364             <span class="keywordflow">switch</span> (Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o1">Type</a>) {
00365 
00366             <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a195">EisaAdapter</a>:
00367                 LocalInterfaceType = Eisa;
00368                 LocalBusNumber = <a class="code" href="../../d4/d0/cmconfig_8c.html#a3">CmpTypeCount</a>[<a class="code" href="../../d4/d0/cmconfig_8c.html#a1">EISA_ADAPTER_INDEX</a>]++;
00369                 <span class="keywordflow">break</span>;
00370             <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a196">TcAdapter</a>:
00371                 LocalInterfaceType = TurboChannel;
00372                 LocalBusNumber = <a class="code" href="../../d4/d0/cmconfig_8c.html#a3">CmpTypeCount</a>[<a class="code" href="../../d4/d0/cmconfig_8c.html#a2">TURBOCHANNEL_ADAPTER_INDEX</a>]++;
00373                 <span class="keywordflow">break</span>;
00374             <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a199">MultiFunctionAdapter</a>:
00375 
00376                 <span class="comment">//</span>
00377                 <span class="comment">// Here we try to distinguish if the Multifunction adapter is</span>
00378                 <span class="comment">// Isa, Mca, Internal bus and assign BusNumber based on</span>
00379                 <span class="comment">// its interface type (bus type.)</span>
00380                 <span class="comment">//</span>
00381 
00382                 <span class="keywordflow">if</span> (Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o9">Identifier</a>) {
00383                     <span class="keywordflow">for</span> (i=0; <a class="code" href="../../d4/d0/cmconfig_8c.html#a7">CmpMultifunctionTypes</a>[i].AscString; i++) {
00384                         <span class="keywordflow">if</span> (_stricmp(CmpMultifunctionTypes[i].AscString,
00385                                     Component-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o9">Identifier</a>) == 0) {
00386                                         <span class="keywordflow">break</span>;
00387                         }
00388                     }
00389 
00390                     LocalInterfaceType = <a class="code" href="../../d4/d0/cmconfig_8c.html#a7">CmpMultifunctionTypes</a>[i].InterfaceType;
00391                     LocalBusNumber = <a class="code" href="../../d4/d0/cmconfig_8c.html#a7">CmpMultifunctionTypes</a>[i].Count++;
00392                 }
00393                 <span class="keywordflow">break</span>;
00394 
00395             <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/arc_8h.html#a315a197">ScsiAdapter</a>:
00396 
00397                 <span class="comment">//</span>
00398                 <span class="comment">// Set the bus type to internal.</span>
00399                 <span class="comment">//</span>
00400 
00401                 LocalInterfaceType = Internal;
00402                 LocalBusNumber = <a class="code" href="../../d4/d0/cmconfig_8c.html#a3">CmpTypeCount</a>[<a class="code" href="../../d1/d9/arc_8h.html#a315a197">ScsiAdapter</a>]++;
00403                 <span class="keywordflow">break</span>;
00404 
00405             <span class="keywordflow">default</span>:
00406                 LocalInterfaceType = -1;
00407                 LocalBusNumber = <a class="code" href="../../d4/d0/cmconfig_8c.html#a8">CmpUnknownBusCount</a>++;
00408                 <span class="keywordflow">break</span>;
00409             }
00410         }
00411 
00412         <span class="comment">//</span>
00413         <span class="comment">// Initialize and copy current component to hardware registry</span>
00414         <span class="comment">//</span>
00415 
00416         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/cmp_8h.html#a274">CmpInitializeRegistryNode</a>(
00417                      CurrentEntry,
00418                      ParentHandle,
00419                      &amp;NewHandle,
00420                      LocalInterfaceType,
00421                      LocalBusNumber,
00422                      DeviceIndexTable
00423                      );
00424 
00425         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00426             <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00427         }
00428 
00429         <span class="comment">//</span>
00430         <span class="comment">// Once we are going one level down, we need to clear the TypeCount</span>
00431         <span class="comment">// table for everything under the current component class ...</span>
00432         <span class="comment">//</span>
00433 
00434         <span class="keywordflow">if</span> (CurrentEntry-&gt;Child) {
00435 
00436             <span class="comment">//</span>
00437             <span class="comment">// Process the child entry of current entry</span>
00438             <span class="comment">//</span>
00439 
00440             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/cmconfig_8c.html#a11">CmpSetupConfigurationTree</a>(CurrentEntry-&gt;Child,
00441                                                NewHandle,
00442                                                LocalInterfaceType,
00443                                                LocalBusNumber
00444                                                );
00445             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00446                 <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(NewHandle);
00447                 <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00448             }
00449         }
00450         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(NewHandle);
00451         CurrentEntry = CurrentEntry-&gt;Sibling;
00452     }
00453     <span class="keywordflow">return</span>(STATUS_SUCCESS);
00454 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a4" doxytag="cmconfig.c::AscString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PUCHAR <a class="el" href="../../d6/d0/cmdat_8c.html#a3">AscString</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00049">49</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00294">CmpSetupConfigurationTree()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="cmconfig.c::CmpConfigurationAreaSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d2/config_2ia64_2initia64_8c.html#a26">CmpConfigurationAreaSize</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00064">64</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00087">CmpInitializeHardwareConfiguration()</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00465">CmpInitializeMachineDependentConfiguration()</a>, and <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00458">CmpInitializeRegistryNode()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="cmconfig.c::CmpConfigurationData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PCM_FULL_RESOURCE_DESCRIPTOR <a class="el" href="../../d5/d2/config_2ia64_2initia64_8c.html#a27">CmpConfigurationData</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00065">65</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00087">CmpInitializeHardwareConfiguration()</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00465">CmpInitializeMachineDependentConfiguration()</a>, and <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00458">CmpInitializeRegistryNode()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="cmconfig.c::CmpMultifunctionTypes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct { ... }   <a class="el" href="../../d6/d0/cmdat_8c.html#a6">CmpMultifunctionTypes</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00294">CmpSetupConfigurationTree()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="cmconfig.c::CmpTypeCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d6/d0/cmdat_8c.html#a11">CmpTypeCount</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00037">37</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00294">CmpSetupConfigurationTree()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="cmconfig.c::CmpUnknownBusCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d6/d0/cmdat_8c.html#a7">CmpUnknownBusCount</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00054">54</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00294">CmpSetupConfigurationTree()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="cmconfig.c::Count" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d6/d0/cmdat_8c.html#a5">Count</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">51</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/almisc_8c-source.html#l01508">AlGetString()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l01483">AlPrint()</a>, <a class="el" href="../../d9/d7/arbiter_8c-source.html#l04033">ArbpIndent()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02439">CcCalculateVacbLevelLockCount()</a>, <a class="el" href="../../d3/d7/api_8c-source.html#l01169">CleanupSessionObjectDirectories()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00588">CmpCheckValueList()</a>, <a class="el" href="../../d8/d0/cmindex_8c-source.html#l00615">CmpCompareInIndex()</a>, <a class="el" href="../../d8/d0/cmindex_8c-source.html#l00833">CmpDoFindSubKeyByNumber()</a>, <a class="el" href="../../d9/d1/cmsubs_8c-source.html#l00180">CmpSearchForOpenSubKeys()</a>, <a class="el" href="../../d5/d3/prefix_8c-source.html#l00750">ComputeNameLength()</a>, <a class="el" href="../../d5/d3/prefix_8c-source.html#l02126">ComputeUnicodeNameLength()</a>, <a class="el" href="../../d8/d2/partit_8c-source.html#l00074">Confirm()</a>, <a class="el" href="../../d3/d8/sirens_8c-source.html#l00128">DoBeep()</a>, <a class="el" href="../../d9/d7/aug98_2dll32_2csprof_8c-source.html#l00403">DoesCPTagExist()</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l00362">DoMutantTest()</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l00591">DoSemaphoreTest()</a>, <a class="el" href="../../d8/d3/conexts_8c-source.html#l01164">ds()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01924">FsRtlNumberOfRunsInLargeMcb()</a>, <a class="el" href="../../d9/d7/aug98_2dll32_2csprof_8c-source.html#l00232">GetCPElementInfo()</a>, <a class="el" href="../../d9/d7/aug98_2dll32_2csprof_8c-source.html#l00426">GetCPTagIndex()</a>, <a class="el" href="../../d1/d1/hivesync_8c-source.html#l00775">HvpDoWriteHive()</a>, <a class="el" href="../../d1/d1/hivesync_8c-source.html#l00495">HvpGrowLog1()</a>, <a class="el" href="../../d1/d1/hivesync_8c-source.html#l01025">HvpWriteLog()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l05121">IopFindResourcesForArbiter()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l01066">IopGetResourceRequirementsForAssignTable()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l01878">IopRearrangeAssignTable()</a>, <a class="el" href="../../d7/d7/jzcrap_8c-source.html#l00005">JzDeleteVariableSegment()</a>, <a class="el" href="../../d2/d4/alpha_2kdcpuapi_8c-source.html#l00036">KdpSetLoadState()</a>, <a class="el" href="../../d2/d4/alpha_2kdcpuapi_8c-source.html#l00098">KdpSetStateChange()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00815">KeAddSystemServiceTable()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00036">KeInitializeQueue()</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00039">KeInitializeSemaphore()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00418">Ki386VdmDispatchStringIo()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00732">KiScanReadyQueues()</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00333">KiTimerListExpire()</a>, <a class="el" href="../../d9/d6/lfs_2strucsup_8c-source.html#l00041">LfsAllocateLfcb()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l00551">LfsFlushLfcb()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02514">LfsUpdateLfcbFromNoRestart()</a>, <a class="el" href="../../d6/d0/rtdmpval_8c-source.html#l00052">main()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l02095">MiDownPfnReferenceCount()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l04726">MiEmptyWorkingSet()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l03300">MiGrowWsleHash()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l04607">MiInsertPageFileInList()</a>, <a class="el" href="../../d4/d6/freevm_8c-source.html#l01510">MiProcessValidPteList()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03953">MiResolveImageReferences()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l02076">MiUpPfnReferenceCount()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l03180">MmOutPageKernelStack()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05920">MmSetAddressRangeModified()</a>, <a class="el" href="../../d0/d6/ia64_2vunwind_8c-source.html#l01712">NewParsePrologueRegionPhase1()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00051">NtCreateIoCompletion()</a>, <a class="el" href="../../d2/d7/super_8c-source.html#l00056">NtCreateSuperSection()</a>, <a class="el" href="../../d2/d7/super_8c-source.html#l00311">NtMapViewOfSuperSection()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01319">NtNotifyChangeMultipleKeys()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00380">NtQueryMutant()</a>, <a class="el" href="../../d3/d5/semphore_8c-source.html#l00360">NtQuerySemaphore()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00521">NtReleaseMutant()</a>, <a class="el" href="../../d3/d5/semphore_8c-source.html#l00494">NtReleaseSemaphore()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00406">NtWaitForMultipleObjects()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00607">ObpCreateTypeArray()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02053">PnPBiosGetDescription()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l05745">PrintTimerQueue()</a>, <a class="el" href="../../d0/d6/ia64_2vunwind_8c-source.html#l00412">ReadLEB128()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l05895">RtlCancelTimer()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l05767">RtlDebugPrintTimes()</a>, <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00162">RtlDispatchException()</a>, <a class="el" href="../../d2/d6/guid_8c-source.html#l00191">RtlGUIDFromString()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03458">RtlpDebugPageHeapGetProcessHeaps()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l05026">RtlpDphLogStackTrace()</a>, <a class="el" href="../../d7/d8/heappage_8c-source.html#l03906">RtlpDphShouldAllocateInPageHeap()</a>, <a class="el" href="../../d5/d5/rtl_2ia64_2context_8c-source.html#l00153">RtlRemoteCall()</a>, <a class="el" href="../../d3/d0/threads_8c-source.html#l05818">RtlSetTimer()</a>, <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00883">RtlUnwind2()</a>, <a class="el" href="../../d7/d8/unwindr_8c-source.html#l00492">RtlUnwindReturn()</a>, <a class="el" href="../../d7/d8/unwindr_8c-source.html#l00076">RtlUnwindRfp()</a>, <a class="el" href="../../d8/d5/stktrace_8c-source.html#l00741">RtlWalkFrameChain()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l00075">Test1()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l03440">Test10()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l03640">Test11()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l04201">Test12()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l04391">Test13()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l04581">Test14()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l04899">Test15()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l05217">Test16()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l05679">Test17()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l06769">Test18()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l07401">Test19()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l00425">Test2()</a>, <a class="el" href="../../d7/d3/flpt2_8c-source.html#l00028">Test20()</a>, <a class="el" href="../../d7/d3/flpt2_8c-source.html#l00273">Test21()</a>, <a class="el" href="../../d7/d3/flpt2_8c-source.html#l00592">Test22()</a>, <a class="el" href="../../d7/d3/flpt2_8c-source.html#l00745">Test23()</a>, <a class="el" href="../../d7/d3/flpt2_8c-source.html#l01208">Test24()</a>, <a class="el" href="../../d7/d3/flpt2_8c-source.html#l01763">Test25()</a>, <a class="el" href="../../d7/d3/flpt2_8c-source.html#l01986">Test26()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l00568">Test3()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l00711">Test4()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l00942">Test5()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l01173">Test6()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l01510">Test7()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l02322">Test8()</a>, <a class="el" href="../../d5/d3/flpt_8c-source.html#l02781">Test9()</a>, <a class="el" href="../../d3/d4/transsub_8c-source.html#l00399">TransGetOpenJ()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l01301">UdfCreateIrpContext()</a>, <a class="el" href="../../d6/d4/namesup_8c-source.html#l00176">UdfIs8dot3Name()</a>, <a class="el" href="../../d0/d6/almisc_8c-source.html#l00947">vAlStatusMsg()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00882">VdmCallStringIoHandler()</a>, and <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00777">VdmDispatchStringIoToHandler()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="cmconfig.c::InterfaceType" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> <a class="el" href="../../d6/d0/cmdat_8c.html#a4">InterfaceType</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00050">50</a> of file <a class="el" href="../../d5/d9/cmconfig_8c-source.html">cmconfig.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00458">CmpInitializeRegistryNode()</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00294">CmpSetupConfigurationTree()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l03933">IopChildToRootTranslation()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l06801">IopCreateCmResourceList()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l06408">IopFindBusDeviceNode()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l06474">IopFindBusDeviceNodeInternal()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08729">IopLookupBusStringFromID()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l02793">IopQueryLegacyBusInformation()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l02885">IopQueryPnpBusInformation()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l06996">IopReserveLegacyBootResources()</a>, <a class="el" href="../../d2/d4/alpha_2kdcpuapi_8c-source.html#l00499">KdpReadIoSpace()</a>, <a class="el" href="../../d2/d4/alpha_2kdcpuapi_8c-source.html#l00623">KdpReadIoSpaceExtended()</a>, <a class="el" href="../../d2/d4/alpha_2kdcpuapi_8c-source.html#l00779">KdpWriteIoSpace()</a>, and <a class="el" href="../../d2/d4/alpha_2kdcpuapi_8c-source.html#l00899">KdpWriteIoSpaceExtended()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:07 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
