<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ob.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ob.h File Reference</h1>
<p>
<a href="../../d5/d9/ob_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">_OBJECT_HANDLE_INFORMATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">_OBJECT_DUMP_CONTROL</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">_OBJECT_TYPE_INITIALIZER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">_OBJECT_TYPE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">_OBJECT_DIRECTORY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/struct__OBJECT__DIRECTORY__ENTRY.html">_OBJECT_DIRECTORY_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/struct__OBJECT__SYMBOLIC__LINK.html">_OBJECT_SYMBOLIC_LINK</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d4/struct__DEVICE__MAP.html">_DEVICE_MAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/struct__OBJECT__HANDLE__COUNT__ENTRY.html">_OBJECT_HANDLE_COUNT_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/struct__OBJECT__HANDLE__COUNT__DATABASE.html">_OBJECT_HANDLE_COUNT_DATABASE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">_OBJECT_CREATE_INFORMATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">_OBJECT_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">_OBJECT_HEADER_QUOTA_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">_OBJECT_HEADER_HANDLE_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">_OBJECT_HEADER_NAME_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">_OBJECT_HEADER_CREATOR_INFO</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a0">NUMBER_HASH_BUCKETS</a>&nbsp;&nbsp;&nbsp;37</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a1">OB_FLAG_NEW_OBJECT</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a2">OB_FLAG_KERNEL_OBJECT</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a3">OB_FLAG_CREATOR_INFO</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a4">OB_FLAG_EXCLUSIVE_OBJECT</a>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a5">OB_FLAG_PERMANENT_OBJECT</a>&nbsp;&nbsp;&nbsp;0x10</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a6">OB_FLAG_DEFAULT_SECURITY_QUOTA</a>&nbsp;&nbsp;&nbsp;0x20</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a7">OB_FLAG_SINGLE_HANDLE_ENTRY</a>&nbsp;&nbsp;&nbsp;0x40</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(o)&nbsp;&nbsp;&nbsp;CONTAINING_RECORD( (o), <a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">OBJECT_HEADER</a>, Body )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a9">OBJECT_HEADER_TO_EXCLUSIVE_PROCESS</a>(oh)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a10">OBJECT_HEADER_TO_QUOTA_INFO</a>(oh)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a11">OBJECT_HEADER_TO_HANDLE_INFO</a>(oh)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>(oh)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a13">OBJECT_HEADER_TO_CREATOR_INFO</a>(oh)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(a)&nbsp;&nbsp;&nbsp;ObfDereferenceObject(a)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(Object)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">_OBJECT_HANDLE_INFORMATION</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a16">OBJECT_HANDLE_INFORMATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">_OBJECT_HANDLE_INFORMATION</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a17">POBJECT_HANDLE_INFORMATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">_OBJECT_DUMP_CONTROL</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a18">OB_DUMP_CONTROL</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">_OBJECT_DUMP_CONTROL</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a19">POB_DUMP_CONTROL</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a20">OB_DUMP_METHOD</a> )(IN PVOID Object, IN <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">POB_DUMP_CONTROL</a> Control OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d4/d0/ob_8h.html#a100">_OB_OPEN_REASON</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a21">OB_OPEN_REASON</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a22">OB_OPEN_METHOD</a> )(IN <a class="el" href="../../d4/d0/ob_8h.html#a21">OB_OPEN_REASON</a> OpenReason, IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process OPTIONAL, IN PVOID Object, IN ACCESS_MASK GrantedAccess, IN ULONG HandleCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOLEAN(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a23">OB_OKAYTOCLOSE_METHOD</a> )(IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process OPTIONAL, IN PVOID Object, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a24">OB_CLOSE_METHOD</a> )(IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process OPTIONAL, IN PVOID Object, IN ACCESS_MASK GrantedAccess, IN ULONG ProcessHandleCount, IN ULONG SystemHandleCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a25">OB_DELETE_METHOD</a> )(IN PVOID Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef NTSTATUS(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a26">OB_PARSE_METHOD</a> )(IN PVOID ParseObject, IN PVOID ObjectType, IN OUT <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, IN ULONG Attributes, IN OUT PUNICODE_STRING CompleteName, IN OUT PUNICODE_STRING RemainingName, IN OUT PVOID Context OPTIONAL, IN PSECURITY_QUALITY_OF_SERVICE <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a9">SecurityQos</a> OPTIONAL, OUT PVOID *Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef NTSTATUS(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a27">OB_SECURITY_METHOD</a> )(IN PVOID Object, IN <a class="el" href="../../d0/d5/se_8h.html#a19">SECURITY_OPERATION_CODE</a> OperationCode, IN PSECURITY_INFORMATION SecurityInformation, IN OUT PSECURITY_DESCRIPTOR SecurityDescriptor, IN OUT PULONG CapturedLength, IN OUT PSECURITY_DESCRIPTOR *ObjectsSecurityDescriptor, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN PGENERIC_MAPPING GenericMapping)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef NTSTATUS(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a28">OB_QUERYNAME_METHOD</a> )(IN PVOID Object, IN BOOLEAN HasObjectName, OUT POBJECT_NAME_INFORMATION ObjectNameInfo, IN ULONG Length, OUT PULONG ReturnLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">_OBJECT_TYPE_INITIALIZER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a29">OBJECT_TYPE_INITIALIZER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">_OBJECT_TYPE_INITIALIZER</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a30">POBJECT_TYPE_INITIALIZER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">_OBJECT_TYPE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a31">OBJECT_TYPE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">_OBJECT_TYPE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a32">POBJECT_TYPE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">_OBJECT_DIRECTORY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a33">OBJECT_DIRECTORY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">_OBJECT_DIRECTORY</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a34">POBJECT_DIRECTORY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d4/struct__OBJECT__DIRECTORY__ENTRY.html">_OBJECT_DIRECTORY_ENTRY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a35">OBJECT_DIRECTORY_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d4/struct__OBJECT__DIRECTORY__ENTRY.html">_OBJECT_DIRECTORY_ENTRY</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a36">POBJECT_DIRECTORY_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d6/struct__OBJECT__SYMBOLIC__LINK.html">_OBJECT_SYMBOLIC_LINK</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a37">OBJECT_SYMBOLIC_LINK</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d6/struct__OBJECT__SYMBOLIC__LINK.html">_OBJECT_SYMBOLIC_LINK</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a38">POBJECT_SYMBOLIC_LINK</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d4/struct__DEVICE__MAP.html">_DEVICE_MAP</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a39">DEVICE_MAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d4/struct__DEVICE__MAP.html">_DEVICE_MAP</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a40">PDEVICE_MAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d5/struct__OBJECT__HANDLE__COUNT__ENTRY.html">_OBJECT_HANDLE_COUNT_ENTRY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a42">OBJECT_HANDLE_COUNT_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d5/struct__OBJECT__HANDLE__COUNT__ENTRY.html">_OBJECT_HANDLE_COUNT_ENTRY</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a43">POBJECT_HANDLE_COUNT_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d5/struct__OBJECT__HANDLE__COUNT__DATABASE.html">_OBJECT_HANDLE_COUNT_DATABASE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a44">OBJECT_HANDLE_COUNT_DATABASE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d5/struct__OBJECT__HANDLE__COUNT__DATABASE.html">_OBJECT_HANDLE_COUNT_DATABASE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a45">POBJECT_HANDLE_COUNT_DATABASE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">_OBJECT_CREATE_INFORMATION</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a46">OBJECT_CREATE_INFORMATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">_OBJECT_CREATE_INFORMATION</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a47">POBJECT_CREATE_INFORMATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">_OBJECT_HEADER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a48">OBJECT_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">_OBJECT_HEADER</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a49">POBJECT_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">_OBJECT_HEADER_QUOTA_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a50">OBJECT_HEADER_QUOTA_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">_OBJECT_HEADER_QUOTA_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a51">POBJECT_HEADER_QUOTA_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">_OBJECT_HEADER_HANDLE_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a52">OBJECT_HEADER_HANDLE_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">_OBJECT_HEADER_HANDLE_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a53">POBJECT_HEADER_HANDLE_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">_OBJECT_HEADER_NAME_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a54">OBJECT_HEADER_NAME_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">_OBJECT_HEADER_NAME_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a55">POBJECT_HEADER_NAME_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">_OBJECT_HEADER_CREATOR_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a56">OBJECT_HEADER_CREATOR_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">_OBJECT_HEADER_CREATOR_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a57">POBJECT_HEADER_CREATOR_INFO</a></td></tr>

<tr><td colspan=2><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a100">_OB_OPEN_REASON</a> { <br>
&nbsp;&nbsp;<a class="el" href="../../d4/d0/ob_8h.html#a100a58">ObCreateHandle</a>, 
<a class="el" href="../../d4/d0/ob_8h.html#a100a59">ObOpenHandle</a>, 
<a class="el" href="../../d4/d0/ob_8h.html#a100a60">ObDuplicateHandle</a>, 
<a class="el" href="../../d4/d0/ob_8h.html#a100a61">ObInheritHandle</a>, 
<br>
&nbsp;&nbsp;<a class="el" href="../../d4/d0/ob_8h.html#a100a62">ObMaxOpenReason</a>
<br>
 }</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a63">ObInitSystem</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a64">ObInitProcess</a> (<a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> ParentProcess OPTIONAL, <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> NewProcess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a65">ObInitProcess2</a> (<a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> NewProcess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a66">ObKillProcess</a> (BOOLEAN AcquireLock, <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a67">ObCreateObjectType</a> (IN PUNICODE_STRING TypeName, IN <a class="el" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">POBJECT_TYPE_INITIALIZER</a> ObjectTypeInitializer, IN PSECURITY_DESCRIPTOR SecurityDescriptor OPTIONAL, OUT <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> *ObjectType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a68">ObFreeObjectCreateInfoBuffer</a> (IN <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a> ObjectCreateInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a69">ObDeleteCapturedInsertInfo</a> (IN PVOID Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a70">ObCreateObject</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> ProbeMode, IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a> OPTIONAL, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> OwnershipMode, IN OUT PVOID ParseContext OPTIONAL, IN ULONG ObjectBodySize, IN ULONG PagedPoolCharge, IN ULONG NonPagedPoolCharge, OUT PVOID *Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a71">ObInsertObject</a> (IN PVOID Object, IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> PassedAccessState OPTIONAL, IN ACCESS_MASK DesiredAccess OPTIONAL, IN ULONG ObjectPointerBias, OUT PVOID *NewObject OPTIONAL, OUT PHANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a72">ObReferenceObjectByHandle</a> (IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, IN ACCESS_MASK DesiredAccess, IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType OPTIONAL, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, OUT PVOID *Object, OUT <a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">POBJECT_HANDLE_INFORMATION</a> HandleInformation OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a73">ObOpenObjectByName</a> (IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>, IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, IN OUT <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> PassedAccessState OPTIONAL, IN ACCESS_MASK DesiredAccess OPTIONAL, IN OUT PVOID ParseContext OPTIONAL, OUT PHANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a74">ObOpenObjectByPointer</a> (IN PVOID Object, IN ULONG HandleAttributes, IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> PassedAccessState OPTIONAL, IN ACCESS_MASK DesiredAccess OPTIONAL, IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType OPTIONAL, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, OUT PHANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a75">ObReferenceObjectByName</a> (IN PUNICODE_STRING ObjectName, IN ULONG Attributes, IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> PassedAccessState OPTIONAL, IN ACCESS_MASK DesiredAccess OPTIONAL, IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, IN OUT PVOID ParseContext OPTIONAL, OUT PVOID *Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a76">ObMakeTemporaryObject</a> (IN PVOID Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a77">ObFindHandleForObject</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN PVOID Object, IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType OPTIONAL, IN <a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">POBJECT_HANDLE_INFORMATION</a> MatchCriteria OPTIONAL, OUT PHANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a78">ObReferenceObjectByPointer</a> (IN PVOID Object, IN ACCESS_MASK DesiredAccess, IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a79">ObfDereferenceObject</a> (IN PVOID Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a80">ObWaitForSingleObject</a> (IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, IN BOOLEAN Alertable, IN PLARGE_INTEGER Timeout OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a81">ObQueryNameString</a> (IN PVOID Object, OUT POBJECT_NAME_INFORMATION ObjectNameInfo, IN ULONG Length, OUT PULONG ReturnLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a82">ObGetObjectPointerCount</a> (IN PVOID Object)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a83">ObQueryTypeName</a> (IN PVOID Object, PUNICODE_STRING ObjectTypeName, IN ULONG Length, OUT PULONG ReturnLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a84">ObQueryTypeInfo</a> (IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType, OUT POBJECT_TYPE_INFORMATION ObjectTypeInfo, IN ULONG Length, OUT PULONG ReturnLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a85">ObDumpObjectByHandle</a> (IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, IN <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">POB_DUMP_CONTROL</a> Control OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a86">ObDumpObjectByPointer</a> (IN PVOID Object, IN <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">POB_DUMP_CONTROL</a> Control OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a87">ObSetDeviceMap</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> TargetProcess, IN HANDLE <a class="el" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a88">ObQueryDeviceMapInformation</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> TargetProcess, OUT PPROCESS_DEVICEMAP_INFORMATION DeviceMapInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a89">ObInheritDeviceMap</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> NewProcess, IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> ParentProcess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a90">ObDereferenceDeviceMap</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a91">ObGetObjectSecurity</a> (IN PVOID Object, OUT PSECURITY_DESCRIPTOR *SecurityDescriptor, OUT PBOOLEAN MemoryAllocated)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a92">ObReleaseObjectSecurity</a> (IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN BOOLEAN MemoryAllocated)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a93">ObAssignObjectSecurityDescriptor</a> (IN PVOID Object, IN PSECURITY_DESCRIPTOR SecurityDescriptor OPTIONAL, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a94">ObValidateSecurityQuota</a> (IN PVOID Object, IN ULONG NewSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a95">ObCheckCreateObjectAccess</a> (IN PVOID DirectoryObject, IN ACCESS_MASK CreateAccess, IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState OPTIONAL, IN PUNICODE_STRING ComponentName, IN BOOLEAN TypeMutexLocked, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode, OUT PNTSTATUS AccessStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a96">ObCheckObjectAccess</a> (IN PVOID Object, IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState, IN BOOLEAN TypeMutexLocked, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, OUT PNTSTATUS AccessStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a97">ObAssignSecurity</a> (IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState, IN PSECURITY_DESCRIPTOR ParentDescriptor OPTIONAL, IN PVOID Object, IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a98">ObQueryObjectAuditingByHandle</a> (IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, OUT PBOOLEAN GenerateOnClose)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a99">ObSetSecurityObjectByPointer</a> (IN PVOID Object, IN SECURITY_INFORMATION SecurityInformation, IN PSECURITY_DESCRIPTOR SecurityDescriptor)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d4/struct__DEVICE__MAP.html">PDEVICE_MAP</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d0/ob_8h.html#a41">ObSystemDeviceMap</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="ob.h::NUMBER_HASH_BUCKETS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NUMBER_HASH_BUCKETS&nbsp;&nbsp;&nbsp;37          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00206">206</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/obdir_8c-source.html#l00229">NtQueryDirectoryObject()</a>, and <a class="el" href="../../d9/d9/obdir_8c-source.html#l00705">ObpLookupDirectoryEntry()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ob.h::OB_FLAG_CREATOR_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OB_FLAG_CREATOR_INFO&nbsp;&nbsp;&nbsp;0x04          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00349">349</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ob.h::OB_FLAG_DEFAULT_SECURITY_QUOTA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OB_FLAG_DEFAULT_SECURITY_QUOTA&nbsp;&nbsp;&nbsp;0x20          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00352">352</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01861">ObpChargeQuotaForObject()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01473">ObValidateSecurityQuota()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ob.h::OB_FLAG_EXCLUSIVE_OBJECT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OB_FLAG_EXCLUSIVE_OBJECT&nbsp;&nbsp;&nbsp;0x08          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00350">350</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01967">ObpDecrementHandleCount()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01232">ObpIncrementHandleCount()</a>, and <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01587">ObpIncrementUnnamedHandleCount()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ob.h::OB_FLAG_KERNEL_OBJECT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OB_FLAG_KERNEL_OBJECT&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00348">348</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>, and <a class="el" href="../../d7/d0/obquery_8c-source.html#l01469">ObpSetHandleAttributes()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ob.h::OB_FLAG_NEW_OBJECT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OB_FLAG_NEW_OBJECT&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00347">347</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00713">ObDeleteCapturedInsertInfo()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00095">ObOpenObjectByName()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01861">ObpChargeQuotaForObject()</a>, and <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ob.h::OB_FLAG_PERMANENT_OBJECT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OB_FLAG_PERMANENT_OBJECT&nbsp;&nbsp;&nbsp;0x10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00351">351</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00055">ObCreateObject()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00484">ObMakeTemporaryObject()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>, and <a class="el" href="../../d8/d0/obref_8c-source.html#l01497">ObpDeleteNameCheck()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ob.h::OB_FLAG_SINGLE_HANDLE_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OB_FLAG_SINGLE_HANDLE_ENTRY&nbsp;&nbsp;&nbsp;0x40          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00353">353</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01967">ObpDecrementHandleCount()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01058">ObpIncrementHandleDataBase()</a>, and <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00908">ObpInsertHandleCount()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ob.h::ObDereferenceObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ObDereferenceObject          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ObfDereferenceObject(a)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">494</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00626">_GetUserObjectInformation()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00764">_SetUserObjectInformation()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00057">BuildQueryDirectoryIrp()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l00222">CheckAllowForeground()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02169">CmGetSystemDriverList()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01028">CmNotifyRunDown()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03262">CmpCloneControlSet()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01900">CmpDelayedDerefKeys()</a>, <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00226">CmpDoCreateChild()</a>, <a class="el" href="../../d3/d1/cmparse_8c-source.html#l00963">CmpDoOpen()</a>, <a class="el" href="../../d8/d2/cmwrapr_8c-source.html#l00351">CmpFileRead()</a>, <a class="el" href="../../d8/d2/cmwrapr_8c-source.html#l00516">CmpFileWrite()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03764">CmpFreePostBlock()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01421">CmpLinkHiveToMaster()</a>, <a class="el" href="../../d9/d0/cminit_8c-source.html#l00046">CmpOpenHiveFiles()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00804">CmpPostApc()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00922">CmpPostApcRunDown()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00487">CmpPostNotify()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03458">CmpSaveBootControlSet()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04976">DestroyProcessInfo()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00310">DeviceClassCDROMNotify()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02760">ExFreePoolWithTag()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00145">ExpProfileDelete()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00081">ExpTimerApcRoutine()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00378">ExRegisterCallback()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03480">ExReturnPoolQuota()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00346">ExTimerRundown()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00479">ExUnregisterCallback()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00745">FreeWindowStation()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01678">FsRtlAcknowledgeOplockBreak()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l03519">FsRtlCancelExclusiveIrp()</a>, <a class="el" href="../../d4/d8/fsrtl_2pnp_8c-source.html#l00041">FsRtlNotifyVolumeEvent()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01937">FsRtlOpBatchBreakClosePending()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02454">FsRtlOplockBreakToII()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02690">FsRtlOplockBreakToNone()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02249">FsRtlOplockCleanup()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l04722">FsRtlPrivateCheckWaitingLocks()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l03867">FsRtlPrivateLock()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02952">FsRtlRemoveAndCompleteIrp()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l00413">FsRtlUninitializeOplock()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00162">GetDeviceChangeInfo()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00050">GetProcessLuid()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l01022">HalpEnableAutomaticDriveLetterAssignment()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l01171">HalpIsOldStyleFloppy()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00851">HalpNextMountLetter()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00792">HalpQueryDriveLayout()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00706">HalpQueryPartitionType()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l01078">HalpSetMountLetter()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02146">InitiateWin32kCleanup()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l01067">IoAttachDevice()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01071">IoCreateDriver()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l04502">IoCreateFile()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05299">IoCreateNotificationEvent()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05733">IoCreateSynchronizationEvent()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05898">IoDeleteController()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01264">IoDeleteDriver()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l01300">IoFreeDumpStack()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l11641">IoGetBootDiskInformation()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08307">IoGetDmaAdapter()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l00166">IopAddDevicesToBootDriverWorker()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l00284">IopAllocateIrpCleanup()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00728">IopBusCheck()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l02525">IopCallDriverAddDevice()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l03165">IopCallDriverAddDeviceQueryRoutine()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00181">IopCheckUnloadDriver()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l04061">IopCompleteDumpInitialization()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01019">IopCompleteRequest()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l00657">IopCompleteUnloadOrDelete()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l04746">IopConfigureCrashDump()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l01047">IopCreateArcNames()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00769">IopDeleteDevice()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00417">IopDeleteFile()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l05453">IopDeleteLegacyKey()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00232">IopDeleteLockedDeviceNode()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06600">IopDereferenceNotify()</a>, <a class="el" href="../../d5/d6/devnode_8c-source.html#l00297">IopDestroyDeviceNode()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00307">IopDeviceActionWorker()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l02779">IopDriverLoadingFailed()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01821">IopDropIrp()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01163">IopEnumerateDevice()</a>, <a class="el" href="../../d8/d6/errorlog_8c-source.html#l00088">IopErrorLogThread()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01934">IopExceptionCleanup()</a>, <a class="el" href="../../d5/d0/pnppower_8c-source.html#l00321">IopFreePoDeviceNotifyListHead()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l00709">IopFreeRelationList()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l01516">IopGetDriverDeviceListWorker()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l00384">IopGetDumpStack()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09565">IopGetLegacyVetoListDrivers()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00680">IopGetRootDevices()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00975">IopGetSetSecurityObject()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02327">IopInitializeBootDrivers()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02812">IopInitializeBuiltinDriver()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l03146">IopInitializeSystemDrivers()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06387">IopInvalidateDeviceStateWorker()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l01250">IopInvalidateRelationsInList()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l04710">IopInvalidateVolumesForDevice()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03181">IopIsAnyDeviceInstanceEnabled()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03443">IopIsDeviceInstanceEnabled()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00725">IopLockDeviceRemovalRelations()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l03479">IopMarkBootPartition()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l04282">IopMountVolume()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l07055">IopNotifyTargetDeviceChange()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l05126">IopOpenLinkOrRenameTarget()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09301">IopOrphanNotification()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01538">IopProcessNewDeviceNode()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00917">IopProcessRelation()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09922">IopProcessSetInterfaceState()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l01016">IopProcessWorkItem()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l05397">IopQueryXxxInformation()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l05215">IopRebalance()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l01013">IopRemoveIndirectRelationsFromList()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l01090">IopRemoveRelationFromList()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06242">IopReportTargetDeviceChangeAsyncWorker()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01520">IopRequestDeviceEjectWorker()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06127">IopSendMessageToTrackService()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00877">IopSetDeviceSecurityDescriptors()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06326">IopSetEaOrQuotaInformationFile()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l01740">IopStartDriverDevices()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l07272">IopTrackLink()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l01572">IopUnlockDeviceRemovalRelations()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08084">IopXxxControlFile()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l07495">IoRegisterPlugPlayNotification()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01548">IoReportDetectedDevice()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l09835">IoSetInformation()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l11178">IoUnregisterFsRegistrationChange()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l00191">IovpAssertNewRequest()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l03680">IovpAssertNonLegacyDevice()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l00493">IovpCallDriver1()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l00948">IovpCallDriver2()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l03379">IovpDeleteDevice()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l03537">IovpExamineDevObjForwarding()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l01722">IovpStopObRefMonitoring()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l01531">IovpThrowBogusSynchronousIrp()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l01392">IovpThrowChaffAtStartedPdoStack()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l11556">IoWriteErrorLogEntry()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00095">IsRestricted()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00453">KdUpdateTimeSlipEvent()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00368">LockObjectAssignment()</a>, <a class="el" href="../../d4/d5/lpcclose_8c-source.html#l00281">LpcExitThread()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00915">LpcpCopyRequestData()</a>, <a class="el" href="../../d7/d5/lpccreat_8c-source.html#l00136">LpcpCreatePort()</a>, <a class="el" href="../../d4/d5/lpcclose_8c-source.html#l00110">LpcpDeletePort()</a>, <a class="el" href="../../d4/d6/lpcqueue_8c-source.html#l00104">LpcpDestroyPortQueue()</a>, <a class="el" href="../../d4/d6/lpcqueue_8c-source.html#l00642">LpcpFreeToPortZone()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l01407">LpcRequestWaitReplyPort()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l01474">MiLoadImageSection()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00191">MiSegmentDelete()</a>, <a class="el" href="../../d2/d7/super_8c-source.html#l00535">MiSuperSectionDelete()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l00390">MmCreateSection()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l01721">MmGetFileNameForSection()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l07311">MmSetBankedSection()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02896">MmUnloadSystemImage()</a>, <a class="el" href="../../d5/d5/lpccompl_8c-source.html#l00040">NtAcceptConnectPort()</a>, <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00432">NtAdjustGroupsToken()</a>, <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00046">NtAdjustPrivilegesToken()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00267">NtAlertResumeThread()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00214">NtAlertThread()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00970">NtAllocateUserPhysicalPages()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00266">NtAssignProcessToJobObject()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00049">NtCancelIoFile()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00679">NtCancelTimer()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00126">NtClearEvent()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d5/d5/lpccompl_8c-source.html#l00836">NtCompleteConnectPort()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00048">NtCreateJobObject()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l00297">NtCreatePagingFile()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00199">NtCreateProfile()</a>, <a class="el" href="../../d2/d7/super_8c-source.html#l00056">NtCreateSuperSection()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00052">NtCreateSymbolicLinkObject()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00411">NtDeleteKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00504">NtDeleteValueKey()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00046">NtDuplicateToken()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00610">NtEnumerateKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00756">NtEnumerateValueKey()</a>, <a class="el" href="../../d9/d9/extsect_8c-source.html#l00085">NtExtendSection()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01306">NtFilterToken()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00386">NtFlushBuffersFile()</a>, <a class="el" href="../../d6/d4/flushbuf_8c-source.html#l00142">NtFlushInstructionCache()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00904">NtFlushKey()</a>, <a class="el" href="../../d7/d4/flushsec_8c-source.html#l00055">NtFlushVirtualMemory()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l01624">NtFreeUserPhysicalPages()</a>, <a class="el" href="../../d4/d6/freevm_8c-source.html#l00066">NtFreeVirtualMemory()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00151">NtGetContextThread()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l03038">NtImpersonateAnonymousToken()</a>, <a class="el" href="../../d2/d6/lpcpriv_8c-source.html#l00032">NtImpersonateClientOfPort()</a>, <a class="el" href="../../d0/d0/psimpers_8c-source.html#l00026">NtImpersonateThread()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00236">NtListenChannel()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00035">NtLockFile()</a>, <a class="el" href="../../d4/d4/lockvm_8c-source.html#l00033">NtLockVirtualMemory()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00414">NtMakeTemporaryObject()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l00199">NtMapViewOfSection()</a>, <a class="el" href="../../d2/d7/super_8c-source.html#l00311">NtMapViewOfSuperSection()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00821">NtNotifyChangeDirectoryFile()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01319">NtNotifyChangeMultipleKeys()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00348">NtOpenChannel()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00030">NtOpenProcess()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00178">NtOpenProcessToken()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00280">NtOpenThread()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00231">NtPrivilegeCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d1/d8/protect_8c-source.html#l00069">NtProtectVirtualMemory()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00412">NtPulseEvent()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00229">NtQueryDirectoryObject()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00035">NtQueryEaFile()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00514">NtQueryEvent()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00814">NtQueryInformationJobObject()</a>, <a class="el" href="../../d3/d6/lpcquery_8c-source.html#l00030">NtQueryInformationPort()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00531">NtQueryInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l02706">NtQueryInformationThread()</a>, <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l00034">NtQueryInformationToken()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00282">NtQueryIoCompletion()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02018">NtQueryKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03461">NtQueryMultipleValueKey()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00380">NtQueryMutant()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l04090">NtQueryOpenSubKeys()</a>, <a class="el" href="../../d1/d2/qsquota_8c-source.html#l00035">NtQueryQuotaInformationFile()</a>, <a class="el" href="../../d5/d2/querysec_8c-source.html#l00031">NtQuerySection()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00255">NtQuerySecurityObject()</a>, <a class="el" href="../../d3/d5/semphore_8c-source.html#l00360">NtQuerySemaphore()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00333">NtQuerySymbolicLinkObject()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00822">NtQueryTimer()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d6/d2/queryvm_8c-source.html#l00061">NtQueryVirtualMemory()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00037">NtQueryVolumeInformationFile()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00056">NtQueueApcThread()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00036">NtReadFile()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00730">NtReadFileScatter()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00102">NtReadVirtualMemory()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01472">NtRegisterThreadTerminatePort()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00521">NtReleaseMutant()</a>, <a class="el" href="../../d3/d5/semphore_8c-source.html#l00494">NtReleaseSemaphore()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00485">NtRemoveIoCompletion()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03336">NtReplaceKey()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00044">NtReplyPort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00029">NtReplyWaitReceivePort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00635">NtReplyWaitReceivePortEx()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00375">NtReplyWaitReplyPort()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00525">NtReplyWaitSendChannel()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00395">NtRequestWaitReplyPort()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00648">NtResetEvent()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02348">NtRestoreKey()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00138">NtResumeThread()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02471">NtSaveKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02559">NtSaveMergedKeys()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00807">NtSendWaitReplyChannel()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00352">NtSetContextThread()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00652">NtSetEaFile()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00651">NtSetHighEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00532">NtSetHighWaitLowEventPair()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00849">NtSetInformationFile()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03235">NtSetInformationKey()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00417">NtSetIoCompletion()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00592">NtSetLowEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00472">NtSetLowWaitHighEventPair()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00046">NtSetSecurityObject()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00960">NtSetTimer()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00492">NtSetVolumeInformationFile()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00038">NtSignalAndWaitForSingleObject()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00517">NtStartProfile()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00680">NtStopProfile()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00033">NtSuspendThread()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02358">NtTerminateJobObject()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00227">NtTerminateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00461">NtTerminateThread()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00244">NtUnloadDriver()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03093">NtUnloadKey()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00458">NtUnlockFile()</a>, <a class="el" href="../../d4/d4/lockvm_8c-source.html#l00605">NtUnlockVirtualMemory()</a>, <a class="el" href="../../d5/d8/umapview_8c-source.html#l00033">NtUnmapViewOfSection()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08222">NtUserBuildHwndList()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08365">NtUserBuildNameList()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01118">NtUserCloseWindowStation()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l02329">NtUserGetGuiResources()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07070">NtUserLockWindowStation()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02788">NtUserProcessConnect()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01434">NtUserSetThreadDesktop()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07110">NtUserSetWindowStationUser()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01467">NtUserSwitchDesktop()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07090">NtUserUnlockWindowStation()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07905">NtUserUserHandleGrantAccess()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00406">NtWaitForMultipleObjects()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00412">NtWaitHighEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00352">NtWaitLowEventPair()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00035">NtWriteFile()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00801">NtWriteFileGather()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00231">NtWriteVirtualMemory()</a>, <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00416">ObDereferenceDeviceMap()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00095">ObOpenObjectByName()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00367">ObOpenObjectByPointer()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01497">ObpDeleteNameCheck()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00951">ObpDeleteSymbolicLinkName()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00738">ObpDestroyTypeArray()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01121">ObpProcessDosDeviceSymbolicLink()</a>, <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00030">ObSetDeviceMap()</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00187">obtest()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00837">ObWaitForSingleObject()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00263">OpenCacheKeyEx()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00225">OpenDeviceReparseIndex()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02396">PsEnforceExecutionTimeLimits()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00492">PsOpenTokenOfProcess()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00326">PsOpenTokenOfThread()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01256">PspAssignPrimaryToken()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01436">PspDeleteThreadSecurity()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01232">PspExitProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00709">PspJobClose()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00636">PspJobDelete()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01363">PspProcessDelete()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00291">PspQueryPooledQuotaLimits()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00209">PspQueryQuotaLimits()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00113">PspQueryWorkingSetWatch()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00057">PspReaper()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01211">PspSetQuotaLimits()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02570">PspTerminateAllProcessesInJob()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00384">PspTerminateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00160">PspTerminateThreadByPointer()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01438">PspThreadDelete()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00990">PsRestoreImpersonation()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01051">PsRevertToSelf()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l03858">RawInputThread()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l01366">ReferenceWindowStation()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00929">RegisterForDeviceChangeNotifications()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00302">SeDeassignPrimaryToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02867">SeIsChildToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01010">SeMakeAnonymousLogonToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00294">SepOpenTokenOfThread()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l02425">SmbTraceToClient()</a>, <a class="el" href="../../d9/d1/udfs_2cachesup_8c-source.html#l00046">UdfCreateInternalStream()</a>, <a class="el" href="../../d9/d1/udfs_2cachesup_8c-source.html#l00215">UdfDeleteInternalStream()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l01210">UdfDeleteVcb()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01271">UdfInvalidateVolumes()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01444">UdfMountVolume()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l02043">UdfVerifyVolume()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00421">UnlockObjectAssignment()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l02385">UserDeleteW32Thread()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00448">UserDereferenceObject()</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00092">ValidateHdesk()</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00046">ValidateHwinsta()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01583">VdmpDelayIntDpcRoutine()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01235">VdmpDelayInterrupt()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01922">VdmpIsThreadTerminating()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00146">VdmpQueueInterrupt()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00408">VdmpQueueIntNormalRoutine()</a>, <a class="el" href="../../d4/d3/vdm_2vdm_8c-source.html#l00087">VdmQueryDirectoryFile()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l00773">Win32KDriverUnload()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l00097">Win32kNtUserCleanup()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04332">xxxCloseDesktop()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l06445">xxxConsoleControl()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01797">xxxCreateDesktop()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01343">xxxCreateDesktop2()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l01501">xxxCreateThreadInfo()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00114">xxxDesktopThread()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04211">xxxGetThreadDesktop()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00026">xxxInitTerminal()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l03265">xxxOpenDesktop()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04821">xxxResolveDesktop()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l05804">xxxRestoreCsrssThreadDesktop()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l05713">xxxSetCsrssThreadDesktop()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l06114">xxxSetInformationThread()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l01077">xxxSetProcessWindowStation()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l03823">zzzSetDesktop()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ob.h::OBJECT_HEADER_TO_CREATOR_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBJECT_HEADER_TO_CREATOR_INFO          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">oh&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>((<a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">POBJECT_HEADER_CREATOR_INFO</a>) \
    (((oh)-&gt;Flags &amp; <a class="code" href="../../d4/d0/ob_8h.html#a3">OB_FLAG_CREATOR_INFO</a>) == 0 ? <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> : ((PCHAR)(oh) - <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">OBJECT_HEADER_CREATOR_INFO</a>))))
</div></pre>
<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00371">371</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01967">ObpDecrementHandleCount()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01232">ObpIncrementHandleCount()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01587">ObpIncrementUnnamedHandleCount()</a>, and <a class="el" href="../../d8/d0/obref_8c-source.html#l01370">ObpRemoveObjectRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ob.h::OBJECT_HEADER_TO_EXCLUSIVE_PROCESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBJECT_HEADER_TO_EXCLUSIVE_PROCESS          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">oh&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>((oh-&gt;Flags &amp; <a class="code" href="../../d4/d0/ob_8h.html#a4">OB_FLAG_EXCLUSIVE_OBJECT</a>) == 0 ? \
    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> : (((<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">POBJECT_HEADER_QUOTA_INFO</a>)((PCHAR)(oh) - (oh)-&gt;QuotaInfoOffset))-&gt;ExclusiveProcess))
</div></pre>
<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00358">358</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01232">ObpIncrementHandleCount()</a>, and <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01587">ObpIncrementUnnamedHandleCount()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ob.h::OBJECT_HEADER_TO_HANDLE_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBJECT_HEADER_TO_HANDLE_INFO          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">oh&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>((<a class="code" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">POBJECT_HEADER_HANDLE_INFO</a>) \
    ((oh)-&gt;HandleInfoOffset == 0 ? <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> : ((PCHAR)(oh) - (oh)-&gt;HandleInfoOffset)))
</div></pre>
<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00365">365</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01967">ObpDecrementHandleCount()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01058">ObpIncrementHandleDataBase()</a>, and <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00908">ObpInsertHandleCount()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ob.h::OBJECT_HEADER_TO_NAME_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBJECT_HEADER_TO_NAME_INFO          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">oh&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>((<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a>) \
    ((oh)-&gt;NameInfoOffset == 0 ? <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> : ((PCHAR)(oh) - (oh)-&gt;NameInfoOffset)))
</div></pre>
<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00368">368</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/winsta_8c-source.html#l01264">_BuildNameList()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l01664">IovpStartObRefMonitoring()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l01722">IovpStopObRefMonitoring()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00229">NtQueryDirectoryObject()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00478">ObEnumerateObjectsByType()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01124">ObfDereferenceObject()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01015">ObpCreateSymbolicLinkName()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01497">ObpDeleteNameCheck()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00903">ObpInsertDirectoryEntry()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00705">ObpLookupDirectoryEntry()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01121">ObpProcessDosDeviceSymbolicLink()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01370">ObpRemoveObjectRoutine()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00713">ObQueryNameString()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ob.h::OBJECT_HEADER_TO_QUOTA_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBJECT_HEADER_TO_QUOTA_INFO          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">oh&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>((<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">POBJECT_HEADER_QUOTA_INFO</a>) \
    ((oh)-&gt;QuotaInfoOffset == 0 ? <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> : ((PCHAR)(oh) - (oh)-&gt;QuotaInfoOffset)))
</div></pre>
<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00362">362</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00800">ObGetObjectInformation()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01861">ObpChargeQuotaForObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01967">ObpDecrementHandleCount()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01232">ObpIncrementHandleCount()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01587">ObpIncrementUnnamedHandleCount()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01473">ObValidateSecurityQuota()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ob.h::OBJECT_TO_OBJECT_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define OBJECT_TO_OBJECT_HEADER          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">o&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;CONTAINING_RECORD( (o), <a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">OBJECT_HEADER</a>, Body )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">355</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/winsta_8c-source.html#l01264">_BuildNameList()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00626">_GetUserObjectInformation()</a>, <a class="el" href="../../d6/d4/logon_8c-source.html#l00057">_LockWindowStation()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00764">_SetUserObjectInformation()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00830">DestroyWindowStation()</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l04145">DumpConvInfo()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l02535">FreeDesktop()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00745">FreeWindowStation()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05535">IoCreateStreamFileObjectLite()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l01664">IovpStartObRefMonitoring()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l01722">IovpStopObRefMonitoring()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00368">LockObjectAssignment()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l02836">MapDesktop()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00229">NtQueryDirectoryObject()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00255">NtQuerySecurityObject()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00038">NtSignalAndWaitForSingleObject()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01183">ObAssignObjectSecurityDescriptor()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00713">ObDeleteCapturedInsertInfo()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01124">ObfDereferenceObject()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l01234">ObFindHandleForObject()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01087">ObfReferenceObject()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00058">ObGetObjectPointerCount()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01258">ObGetObjectSecurity()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00484">ObMakeTemporaryObject()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00095">ObOpenObjectByName()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00367">ObOpenObjectByPointer()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00602">ObpCheckObjectReference()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l02160">ObpCreateHandle()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01015">ObpCreateSymbolicLinkName()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l02507">ObpCreateUnnamedHandle()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01497">ObpDeleteNameCheck()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01232">ObpIncrementHandleCount()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01587">ObpIncrementUnnamedHandleCount()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00903">ObpInsertDirectoryEntry()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00705">ObpLookupDirectoryEntry()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01121">ObpProcessDosDeviceSymbolicLink()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00559">ObpReferenceSecurityDescriptor()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01370">ObpRemoveObjectRoutine()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00713">ObQueryNameString()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l01082">ObQueryTypeName()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01022">ObReferenceObjectByPointer()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01748">ObSetSecurityDescriptorInfo()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00174">ObSetSecurityObjectByPointer()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01473">ObValidateSecurityQuota()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00837">ObWaitForSingleObject()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l03089">OkayToCloseDesktop()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00981">OkayToCloseWindowStation()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l02391">ParseDesktop()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00911">ParseWindowStation()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00421">UnlockObjectAssignment()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l03017">UnmapDesktop()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01343">xxxCreateDesktop2()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ob.h::ObReferenceObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ObReferenceObject          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Object&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                                \
    <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(Object); \
    InterlockedIncrement(&amp;ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o0">PointerCount</a>);             \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">514</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">ExAllocatePoolWithQuota()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02607">ExAllocatePoolWithQuotaTag()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00378">ExRegisterCallback()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00346">ExTimerRundown()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l04722">FsRtlPrivateCheckWaitingLocks()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l03867">FsRtlPrivateLock()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01299">FsRtlRequestExclusiveOplock()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01514">FsRtlRequestOplockII()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02146">InitiateWin32kCleanup()</a>, <a class="el" href="../../d5/d0/pnppower_8c-source.html#l00048">IoBuildPoDeviceNotifyList()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l04073">IoCreateDevice()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l06829">IoGetAttachedDeviceReference()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l00055">IopAddRelationToList()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l00542">IopAllocateErrorLogEntry()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00728">IopBusCheck()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00036">IopCloseFile()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00232">IopDeleteLockedDeviceNode()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00307">IopDeviceActionWorker()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03759">IopDeviceObjectFromDeviceInstance()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01163">IopEnumerateDevice()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03967">IopGetDeviceAttachmentBaseRef()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00826">IopGetDevicePDO()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02256">IopGetFileName()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02718">IopGetSetObjectId()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00975">IopGetSetSecurityObject()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02851">IopGetVolumeId()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02327">IopInitializeBootDrivers()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00879">IopInitializeDeviceInstanceKey()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l04654">IopLoadBootFilterDriver()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00725">IopLockDeviceRemovalRelations()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l03479">IopMarkBootPartition()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l04282">IopMountVolume()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l07055">IopNotifyTargetDeviceChange()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l00648">IopPnPDispatch()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00917">IopProcessRelation()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l05397">IopQueryXxxInformation()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06327">IopQueueDeviceWorkItem()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00207">IopRequestDeviceAction()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00877">IopSetDeviceSecurityDescriptors()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06716">IopSetRemoteLink()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l04767">IopTestForReconfiguration()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00953">IoQueueWorkItem()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l09422">IoRegisterFsRegistrationChange()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01548">IoReportDetectedDevice()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06118">IoReportTargetDeviceChangeAsynchronous()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l09835">IoSetInformation()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l03620">IovpGetDeviceAttachedTo()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l03648">IovpGetLowestDevice()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l01664">IovpStartObRefMonitoring()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00368">LockObjectAssignment()</a>, <a class="el" href="../../d7/d5/lpccreat_8c-source.html#l00136">LpcpCreatePort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l01407">LpcRequestWaitReplyPort()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l00166">MiCheckPageFilePath()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l01474">MiLoadImageSection()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l00390">MmCreateSection()</a>, <a class="el" href="../../d5/d5/lpccompl_8c-source.html#l00040">NtAcceptConnectPort()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00266">NtAssignProcessToJobObject()</a>, <a class="el" href="../../d2/d6/lpcpriv_8c-source.html#l00032">NtImpersonateClientOfPort()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00814">NtQueryInformationJobObject()</a>, <a class="el" href="../../d6/d2/queryvm_8c-source.html#l00061">NtQueryVirtualMemory()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00044">NtReplyPort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00029">NtReplyWaitReceivePort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00635">NtReplyWaitReceivePortEx()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00375">NtReplyWaitReplyPort()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00525">NtReplyWaitSendChannel()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00395">NtRequestWaitReplyPort()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00807">NtSendWaitReplyChannel()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00607">ObpCreateTypeArray()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00951">ObpDeleteSymbolicLinkName()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01121">ObpProcessDosDeviceSymbolicLink()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l02391">ParseDesktop()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00911">ParseWindowStation()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02396">PsEnforceExecutionTimeLimits()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">PsImpersonateClient()</a>, <a class="el" href="../../d2/d9/pscid_8c-source.html#l00094">PsLookupProcessByProcessId()</a>, <a class="el" href="../../d2/d9/pscid_8c-source.html#l00027">PsLookupProcessThreadByCid()</a>, <a class="el" href="../../d2/d9/pscid_8c-source.html#l00146">PsLookupThreadByThreadId()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00586">PsOpenTokenOfJobObject()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02210">PspApplyJobLimitsToProcessSet()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02570">PspTerminateAllProcessesInJob()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00208">PsReferenceEffectiveToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00097">PsReferenceImpersonationToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00028">PsReferencePrimaryToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00241">SeAssignPrimaryToken()</a>, <a class="el" href="../../d5/d4/seclient_8c-source.html#l00712">SeCreateClientSecurityFromSubjectContext()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00346">SeExchangePrimaryToken()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00466">SepRmCommandServerThreadInit()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00331">UdfInitializeVcb()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01444">UdfMountVolume()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l02043">UdfVerifyVolume()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01235">VdmpDelayInterrupt()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00026">xxxInitTerminal()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a39" doxytag="ob.h::DEVICE_MAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d4/struct__DEVICE__MAP.html">_DEVICE_MAP</a>  <a class="el" href="../../d2/d4/struct__DEVICE__MAP.html">DEVICE_MAP</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="ob.h::OB_CLOSE_METHOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d4/d0/ob_8h.html#a24">OB_CLOSE_METHOD</a>)(IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process OPTIONAL, IN PVOID Object, IN ACCESS_MASK GrantedAccess, IN ULONG ProcessHandleCount, IN ULONG SystemHandleCount)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00095">95</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="ob.h::OB_DELETE_METHOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d4/d0/ob_8h.html#a25">OB_DELETE_METHOD</a>)(IN PVOID Object)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00103">103</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ob.h::OB_DUMP_CONTROL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">_OBJECT_DUMP_CONTROL</a>  <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">OB_DUMP_CONTROL</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="ob.h::OB_DUMP_METHOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d4/d0/ob_8h.html#a20">OB_DUMP_METHOD</a>)(IN PVOID Object, IN <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">POB_DUMP_CONTROL</a> Control OPTIONAL)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00067">67</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="ob.h::OB_OKAYTOCLOSE_METHOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOLEAN(* <a class="el" href="../../d4/d0/ob_8h.html#a23">OB_OKAYTOCLOSE_METHOD</a>)(IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process OPTIONAL, IN PVOID Object, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00089">89</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="ob.h::OB_OPEN_METHOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d4/d0/ob_8h.html#a22">OB_OPEN_METHOD</a>)(IN <a class="el" href="../../d4/d0/ob_8h.html#a21">OB_OPEN_REASON</a> OpenReason, IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process OPTIONAL, IN PVOID Object, IN ACCESS_MASK GrantedAccess, IN ULONG HandleCount)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00081">81</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="ob.h::OB_OPEN_REASON" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d4/d0/ob_8h.html#a100">_OB_OPEN_REASON</a>  <a class="el" href="../../d4/d0/ob_8h.html#a21">OB_OPEN_REASON</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d6/desktop_8c-source.html#l02836">MapDesktop()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, and <a class="el" href="../../d8/d0/obref_8c-source.html#l00095">ObOpenObjectByName()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="ob.h::OB_PARSE_METHOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef NTSTATUS(* <a class="el" href="../../d4/d0/ob_8h.html#a26">OB_PARSE_METHOD</a>)(IN PVOID ParseObject, IN PVOID ObjectType, IN OUT <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, IN ULONG Attributes, IN OUT PUNICODE_STRING CompleteName, IN OUT PUNICODE_STRING RemainingName, IN OUT PVOID Context OPTIONAL, IN PSECURITY_QUALITY_OF_SERVICE <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a9">SecurityQos</a> OPTIONAL, OUT PVOID *Object)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00107">107</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ioinit_8c-source.html#l01936">IopCreateObjectTypes()</a>, and <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="ob.h::OB_QUERYNAME_METHOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef NTSTATUS(* <a class="el" href="../../d4/d0/ob_8h.html#a28">OB_QUERYNAME_METHOD</a>)(IN PVOID Object, IN BOOLEAN HasObjectName, OUT POBJECT_NAME_INFORMATION ObjectNameInfo, IN ULONG Length, OUT PULONG ReturnLength)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00131">131</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ioinit_8c-source.html#l01936">IopCreateObjectTypes()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="ob.h::OB_SECURITY_METHOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef NTSTATUS(* <a class="el" href="../../d4/d0/ob_8h.html#a27">OB_SECURITY_METHOD</a>)(IN PVOID Object, IN <a class="el" href="../../d0/d5/se_8h.html#a19">SECURITY_OPERATION_CODE</a> OperationCode, IN PSECURITY_INFORMATION SecurityInformation, IN OUT PSECURITY_DESCRIPTOR SecurityDescriptor, IN OUT PULONG CapturedLength, IN OUT PSECURITY_DESCRIPTOR *ObjectsSecurityDescriptor, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN PGENERIC_MAPPING GenericMapping)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00120">120</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ioinit_8c-source.html#l01936">IopCreateObjectTypes()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="ob.h::OBJECT_CREATE_INFORMATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">_OBJECT_CREATE_INFORMATION</a>  <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">OBJECT_CREATE_INFORMATION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="ob.h::OBJECT_DIRECTORY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">_OBJECT_DIRECTORY</a>  <a class="el" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">OBJECT_DIRECTORY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="ob.h::OBJECT_DIRECTORY_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d4/struct__OBJECT__DIRECTORY__ENTRY.html">_OBJECT_DIRECTORY_ENTRY</a>  <a class="el" href="../../d9/d4/struct__OBJECT__DIRECTORY__ENTRY.html">OBJECT_DIRECTORY_ENTRY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="ob.h::OBJECT_HANDLE_COUNT_DATABASE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d5/struct__OBJECT__HANDLE__COUNT__DATABASE.html">_OBJECT_HANDLE_COUNT_DATABASE</a>  <a class="el" href="../../d1/d5/struct__OBJECT__HANDLE__COUNT__DATABASE.html">OBJECT_HANDLE_COUNT_DATABASE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="ob.h::OBJECT_HANDLE_COUNT_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d5/struct__OBJECT__HANDLE__COUNT__ENTRY.html">_OBJECT_HANDLE_COUNT_ENTRY</a>  <a class="el" href="../../d2/d5/struct__OBJECT__HANDLE__COUNT__ENTRY.html">OBJECT_HANDLE_COUNT_ENTRY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ob.h::OBJECT_HANDLE_INFORMATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">_OBJECT_HANDLE_INFORMATION</a>  <a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">OBJECT_HANDLE_INFORMATION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d6/desktop_8c-source.html#l03823">zzzSetDesktop()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="ob.h::OBJECT_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">_OBJECT_HEADER</a>  <a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">OBJECT_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="ob.h::OBJECT_HEADER_CREATOR_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">_OBJECT_HEADER_CREATOR_INFO</a>  <a class="el" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">OBJECT_HEADER_CREATOR_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="ob.h::OBJECT_HEADER_HANDLE_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">_OBJECT_HEADER_HANDLE_INFO</a>  <a class="el" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">OBJECT_HEADER_HANDLE_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="ob.h::OBJECT_HEADER_NAME_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">_OBJECT_HEADER_NAME_INFO</a>  <a class="el" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">OBJECT_HEADER_NAME_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="ob.h::OBJECT_HEADER_QUOTA_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">_OBJECT_HEADER_QUOTA_INFO</a>  <a class="el" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">OBJECT_HEADER_QUOTA_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="ob.h::OBJECT_SYMBOLIC_LINK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d6/struct__OBJECT__SYMBOLIC__LINK.html">_OBJECT_SYMBOLIC_LINK</a>  <a class="el" href="../../d2/d6/struct__OBJECT__SYMBOLIC__LINK.html">OBJECT_SYMBOLIC_LINK</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="ob.h::OBJECT_TYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">_OBJECT_TYPE</a>  <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">OBJECT_TYPE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="ob.h::OBJECT_TYPE_INITIALIZER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">_OBJECT_TYPE_INITIALIZER</a>  <a class="el" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">OBJECT_TYPE_INITIALIZER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00101">ExpInitializeCallbacks()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="ob.h::PDEVICE_MAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d4/struct__DEVICE__MAP.html">_DEVICE_MAP</a> * <a class="el" href="../../d2/d4/struct__DEVICE__MAP.html">PDEVICE_MAP</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="ob.h::POB_DUMP_CONTROL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">_OBJECT_DUMP_CONTROL</a> * <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">POB_DUMP_CONTROL</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="ob.h::POBJECT_CREATE_INFORMATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">_OBJECT_CREATE_INFORMATION</a> * <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="ob.h::POBJECT_DIRECTORY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">_OBJECT_DIRECTORY</a> * <a class="el" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">POBJECT_DIRECTORY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="ob.h::POBJECT_DIRECTORY_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d4/struct__OBJECT__DIRECTORY__ENTRY.html">_OBJECT_DIRECTORY_ENTRY</a> * <a class="el" href="../../d9/d4/struct__OBJECT__DIRECTORY__ENTRY.html">POBJECT_DIRECTORY_ENTRY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="ob.h::POBJECT_HANDLE_COUNT_DATABASE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d5/struct__OBJECT__HANDLE__COUNT__DATABASE.html">_OBJECT_HANDLE_COUNT_DATABASE</a> * <a class="el" href="../../d1/d5/struct__OBJECT__HANDLE__COUNT__DATABASE.html">POBJECT_HANDLE_COUNT_DATABASE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="ob.h::POBJECT_HANDLE_COUNT_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d5/struct__OBJECT__HANDLE__COUNT__ENTRY.html">_OBJECT_HANDLE_COUNT_ENTRY</a> * <a class="el" href="../../d2/d5/struct__OBJECT__HANDLE__COUNT__ENTRY.html">POBJECT_HANDLE_COUNT_ENTRY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ob.h::POBJECT_HANDLE_INFORMATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">_OBJECT_HANDLE_INFORMATION</a> * <a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">POBJECT_HANDLE_INFORMATION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d6/desktop_8c-source.html#l04171">xxxUserFindHandleForObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="ob.h::POBJECT_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">_OBJECT_HEADER</a> * <a class="el" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="ob.h::POBJECT_HEADER_CREATOR_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">_OBJECT_HEADER_CREATOR_INFO</a> * <a class="el" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">POBJECT_HEADER_CREATOR_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="ob.h::POBJECT_HEADER_HANDLE_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">_OBJECT_HEADER_HANDLE_INFO</a> * <a class="el" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">POBJECT_HEADER_HANDLE_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="ob.h::POBJECT_HEADER_NAME_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">_OBJECT_HEADER_NAME_INFO</a> * <a class="el" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="ob.h::POBJECT_HEADER_QUOTA_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">_OBJECT_HEADER_QUOTA_INFO</a> * <a class="el" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">POBJECT_HEADER_QUOTA_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="ob.h::POBJECT_SYMBOLIC_LINK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d6/struct__OBJECT__SYMBOLIC__LINK.html">_OBJECT_SYMBOLIC_LINK</a> * <a class="el" href="../../d2/d6/struct__OBJECT__SYMBOLIC__LINK.html">POBJECT_SYMBOLIC_LINK</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="ob.h::POBJECT_TYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">_OBJECT_TYPE</a> * <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="ob.h::POBJECT_TYPE_INITIALIZER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">_OBJECT_TYPE_INITIALIZER</a> * <a class="el" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">POBJECT_TYPE_INITIALIZER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="a100" doxytag="ob.h::_OB_OPEN_REASON" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d4/d0/ob_8h.html#a100">_OB_OPEN_REASON</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a100a58" doxytag="ObCreateHandle" ></a>ObCreateHandle</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a100a59" doxytag="ObOpenHandle" ></a>ObOpenHandle</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a100a60" doxytag="ObDuplicateHandle" ></a>ObDuplicateHandle</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a100a61" doxytag="ObInheritHandle" ></a>ObInheritHandle</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a100a62" doxytag="ObMaxOpenReason" ></a>ObMaxOpenReason</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00072">72</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
<pre class="fragment"><div>00072                              {
00073     <a class="code" href="../../d4/d0/ob_8h.html#a100a58">ObCreateHandle</a>,
00074     <a class="code" href="../../d4/d0/ob_8h.html#a100a59">ObOpenHandle</a>,
00075     <a class="code" href="../../d4/d0/ob_8h.html#a100a60">ObDuplicateHandle</a>,
00076     <a class="code" href="../../d4/d0/ob_8h.html#a100a61">ObInheritHandle</a>,
00077     <a class="code" href="../../d4/d0/ob_8h.html#a100a62">ObMaxOpenReason</a>
00078 } <a class="code" href="../../d4/d0/ob_8h.html#a21">OB_OPEN_REASON</a>;
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a93" doxytag="ob.h::ObAssignObjectSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObAssignObjectSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR SecurityDescriptor&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/obse_8c-source.html#l01183">1183</a> of file <a class="el" href="../../d0/d1/obse_8c-source.html">obse.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00297">ObpLogSecurityDescriptor()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/cmse_8c-source.html#l00158">CmpSecurityMethod()</a>, <a class="el" href="../../d1/d5/semethod_8c-source.html#l00195">SeDefaultObjectMethod()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01010">SeMakeAnonymousLogonToken()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>.
<p>
<pre class="fragment"><div>01191                    :
01192 
01193     Takes a pointer to an object and sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SecurityDescriptor field
01194     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object's header.
01195 
01196 Arguments:
01197 
01198     Object - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
01199 
01200     SecurityDescriptor - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor
01201         to be assigned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  This pointer may be null <span class="keywordflow">if</span> there
01202         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no security on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.
01203 
01204     PoolType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> memory used to allocate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01205         security descriptor.  This field <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently ignored.
01206 
01207 Return Value:
01208 
01209     An appropriate <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> value.
01210 
01211 --*/
01212 
01213 {
01214     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01215     PSECURITY_DESCRIPTOR OutputSecurityDescriptor;
01216 
01217     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01218 
01219     <span class="comment">//</span>
01220     <span class="comment">//  If the security descriptor isn't supplied then we set the</span>
01221     <span class="comment">//  object header's security descriptor to null and return</span>
01222     <span class="comment">//  to our caller</span>
01223     <span class="comment">//</span>
01224 
01225     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(SecurityDescriptor)) {
01226 
01227         <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object )-&gt;SecurityDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01228 
01229         <span class="keywordflow">return</span>( STATUS_SUCCESS );
01230     }
01231 
01232     <span class="comment">//</span>
01233     <span class="comment">//  Log the new security descriptor into our security database and</span>
01234     <span class="comment">//  get back the real security descriptor to use</span>
01235     <span class="comment">//</span>
01236 
01237     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d1/obsdata_8c.html#a16">ObpLogSecurityDescriptor</a>( SecurityDescriptor, &amp;OutputSecurityDescriptor );
01238 
01239     <span class="comment">//</span>
01240     <span class="comment">//  If we've been successful so far then set the object's</span>
01241     <span class="comment">//  security descriptor to the newly allocated one.</span>
01242     <span class="comment">//</span>
01243 
01244     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01245 
01246         <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object )-&gt;SecurityDescriptor = OutputSecurityDescriptor;
01247     }
01248 
01249     <span class="comment">//</span>
01250     <span class="comment">//  And return to our caller</span>
01251     <span class="comment">//</span>
01252 
01253     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01254 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a97" doxytag="ob.h::ObAssignSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS ObAssignSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR ParentDescriptor&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/obse_8c-source.html#l01574">1574</a> of file <a class="el" href="../../d0/d1/obse_8c-source.html">obse.c</a>.
<p>
References <a class="el" href="../../d0/d5/se_8h.html#a200a111">AssignSecurityDescriptor</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00056">ObpBeginTypeSpecificCallOut</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00367">ObpDirectoryObjectType</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00057">ObpEndTypeSpecificCallOut</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00089">SeAssignSecurity()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00373">SeDeassignSecurity()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l01343">xxxCreateDesktop2()</a>.
<p>
<pre class="fragment"><div>01583                    :
01584 
01585     This routine will assign a security descriptor to a newly created object.
01586     It assumes that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> AccessState parameter contains a captured security
01587     descriptor.
01588 
01589 Arguments:
01590 
01591      AccessState - The AccessState containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security information
01592         <span class="keywordflow">for</span> <span class="keyword">this</span> object creation.
01593 
01594      ParentDescriptor - The security descriptor from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent object, <span class="keywordflow">if</span>
01595         available.
01596 
01597      Object - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being created.
01598 
01599      ObjectType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of object being created.
01600 
01601 Return Value:
01602 
01603     STATUS_SUCCESS - indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation was successful.
01604 
01605     STATUS_INVALID_OWNER - The owner SID provided as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01606         target security descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not one <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> authorized
01607         to assign as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of an object.
01608 
01609     STATUS_PRIVILEGE_NOT_HELD - The caller does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege
01610         necessary to explicitly assign <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified system ACL.
01611         <a class="code" href="../../d0/d5/se_8h.html#a85">SeSecurityPrivilege</a> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to explicitly assign
01612         system ACLs to objects.
01613 
01614 --*/
01615 
01616 {
01617     PSECURITY_DESCRIPTOR NewDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01618     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01619     KIRQL SaveIrql;
01620 
01621     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01622 
01623     <span class="comment">//</span>
01624     <span class="comment">//  SeAssignSecurity will construct the final version</span>
01625     <span class="comment">//  of the security  descriptor</span>
01626     <span class="comment">//</span>
01627 
01628     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( ParentDescriptor,
01629                                AccessState-&gt;SecurityDescriptor,
01630                                &amp;NewDescriptor,
01631                                (BOOLEAN)(ObjectType == ObpDirectoryObjectType),
01632                                &amp;AccessState-&gt;SubjectSecurityContext,
01633                                &amp;ObjectType-&gt;TypeInfo.GenericMapping,
01634                                PagedPool );
01635 
01636     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01637 
01638         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01639     }
01640 
01641     <a class="code" href="../../d5/d1/obp_8h.html#a0">ObpBeginTypeSpecificCallOut</a>( SaveIrql );
01642 
01643     <span class="comment">//</span>
01644     <span class="comment">//  Now invoke the security method callback to finish</span>
01645     <span class="comment">//  the assignment.</span>
01646     <span class="comment">//</span>
01647 
01648     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (*ObjectType-&gt;TypeInfo.SecurityProcedure)( Object,
01649                                                         <a class="code" href="../../d0/d5/se_8h.html#a200a111">AssignSecurityDescriptor</a>,
01650                                                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01651                                                         NewDescriptor,
01652                                                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01653                                                         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01654                                                         <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>,
01655                                                         &amp;ObjectType-&gt;TypeInfo.GenericMapping );
01656 
01657     <a class="code" href="../../d5/d1/obp_8h.html#a1">ObpEndTypeSpecificCallOut</a>( SaveIrql, <span class="stringliteral">"Security"</span>, ObjectType, Object );
01658 
01659     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01660 
01661         <span class="comment">//</span>
01662         <span class="comment">// The attempt to assign the security descriptor to the object</span>
01663         <span class="comment">// failed.  Free the space used by the new security descriptor.</span>
01664         <span class="comment">//</span>
01665 
01666         <a class="code" href="../../d1/d5/seassign_8c.html#a3">SeDeassignSecurity</a>( &amp;NewDescriptor );
01667     }
01668 
01669     <span class="comment">//</span>
01670     <span class="comment">//  And return to our caller</span>
01671     <span class="comment">//</span>
01672 
01673     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01674 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a95" doxytag="ob.h::ObCheckCreateObjectAccess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN ObCheckCreateObjectAccess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DirectoryObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>CreateAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ComponentName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>TypeMutexLocked</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PNTSTATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">983</a> of file <a class="el" href="../../d0/d1/obse_8c-source.html">obse.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00168">_OBJECT_TYPE_INITIALIZER::GenericMapping</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01258">ObGetObjectSecurity()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00163">ObpEnterObjectTypeMutex</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00176">ObpLeaveObjectTypeMutex</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01418">ObReleaseObjectSecurity()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00434">SeAppendPrivileges()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03538">SeCreateObjectAuditAlarm()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03294">SeFreePrivileges()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00115">SeLockSubjectContext()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00159">SeUnlockSubjectContext()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00196">_OBJECT_TYPE::TypeInfo</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l01343">xxxCreateDesktop2()</a>.
<p>
<pre class="fragment"><div>00995                    :
00996 
00997     This routine checks to see <span class="keywordflow">if</span> we are allowed to create an object in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00998     given directory, and performs auditing as appropriate.
00999 
01000 Arguments:
01001 
01002     DirectoryObject - The directory object being examined.
01003 
01004     CreateAccess - The access mask corresponding to create access <span class="keywordflow">for</span>
01005         <span class="keyword">this</span> directory <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
01006 
01007     AccessState - Checks <span class="keywordflow">for</span> traverse access will typically be incidental
01008         to some other access attempt.  Information on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current state of
01009         that access attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> required so that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> constituent access
01010         attempts may be associated with each other in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> audit log.
01011 
01012     ComponentName - Pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> string containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of
01013         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being created.
01014 
01015     TypeMutexLocked - Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> mutex <span class="keywordflow">for</span> <span class="keyword">this</span> object's
01016         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> locked.  The <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> mutex <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to protect <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object's
01017         security descriptor from being modified <span class="keywordflow">while</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being accessed.
01018 
01019     PreviousMode - The previous processor mode.
01020 
01021     AccessStatus - Pointer to a variable to <span class="keywordflow">return</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status code of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01022         access attempt.  In <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">case</span> of <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a> <span class="keyword">this</span> status code must be
01023         propagated back to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user.
01024 
01025 Return Value:
01026 
01027     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allowed and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise.  AccessStatus
01028     contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status code to be passed back to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
01029     correct to simply pass back STATUS_ACCESS_DENIED, since <span class="keyword">this</span> will have
01030     to change with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> advent of mandatory access <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a>.
01031 
01032 --*/
01033 
01034 {
01035     BOOLEAN AccessAllowed;
01036     ACCESS_MASK GrantedAccess = 0;
01037     PSECURITY_DESCRIPTOR SecurityDescriptor;
01038     BOOLEAN MemoryAllocated;
01039     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01040     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
01041     <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType;
01042     PPRIVILEGE_SET Privileges = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01043     BOOLEAN AuditPerformed = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01044 
01045     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01046 
01047     <span class="comment">//</span>
01048     <span class="comment">//  Map the object body to its object header and corresponding</span>
01049     <span class="comment">//  object type</span>
01050     <span class="comment">//</span>
01051 
01052     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( DirectoryObject );
01053     ObjectType = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>;
01054 
01055     <span class="comment">//</span>
01056     <span class="comment">//  If the caller didn't lock the object type down then</span>
01057     <span class="comment">//  we'll do it now</span>
01058     <span class="comment">//</span>
01059 
01060     <span class="keywordflow">if</span> (!TypeMutexLocked) {
01061 
01062         <a class="code" href="../../d5/d1/obp_8h.html#a8">ObpEnterObjectTypeMutex</a>( ObjectType );
01063     }
01064 
01065     <span class="comment">//</span>
01066     <span class="comment">//  Obtain the object's security descriptor and make it was</span>
01067     <span class="comment">//  successful</span>
01068     <span class="comment">//</span>
01069 
01070     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d1/obse_8c.html#a8">ObGetObjectSecurity</a>( DirectoryObject,
01071                                   &amp;SecurityDescriptor,
01072                                   &amp;MemoryAllocated );
01073 
01074     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01075 
01076         <span class="keywordflow">if</span> (!TypeMutexLocked) {
01077 
01078             <a class="code" href="../../d5/d1/obp_8h.html#a9">ObpLeaveObjectTypeMutex</a>( ObjectType );
01079         }
01080 
01081         *AccessStatus = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01082 
01083         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01084     }
01085 
01086     <span class="comment">//</span>
01087     <span class="comment">//  lock the caller's tokens until after auditing has been</span>
01088     <span class="comment">//  performed.</span>
01089     <span class="comment">//</span>
01090 
01091     <a class="code" href="../../d0/d8/subject_8c.html#a1">SeLockSubjectContext</a>( &amp;AccessState-&gt;SubjectSecurityContext );
01092 
01093     <span class="comment">//</span>
01094     <span class="comment">//  if we have a security descriptor then do an access</span>
01095     <span class="comment">//  check to see if access is allowed and set in the</span>
01096     <span class="comment">//  privileges if necessary</span>
01097     <span class="comment">//</span>
01098 
01099     <span class="keywordflow">if</span> (SecurityDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01100 
01101         AccessAllowed = <a class="code" href="../../d0/d4/accessck_8c.html#a18">SeAccessCheck</a>( SecurityDescriptor,
01102                                        &amp;AccessState-&gt;SubjectSecurityContext,
01103                                        TRUE,            <span class="comment">// Tokens are locked</span>
01104                                        CreateAccess,
01105                                        0,
01106                                        &amp;Privileges,
01107                                        &amp;ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o4">GenericMapping</a>,
01108                                        PreviousMode,
01109                                        &amp;GrantedAccess,
01110                                        AccessStatus );
01111 
01112         <span class="keywordflow">if</span> (Privileges != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01113 
01114             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d5/seastate_8c.html#a5">SeAppendPrivileges</a>( AccessState,
01115                                          Privileges );
01116 
01117             <a class="code" href="../../d0/d4/accessck_8c.html#a17">SeFreePrivileges</a>( Privileges );
01118         }
01119 
01120         <span class="comment">//</span>
01121         <span class="comment">//  This is wrong, but leave for reference.</span>
01122         <span class="comment">//</span>
01123         <span class="comment">//  if (AccessAllowed) {</span>
01124         <span class="comment">//</span>
01125         <span class="comment">//      AccessState-&gt;PreviouslyGrantedAccess |= GrantedAccess;</span>
01126         <span class="comment">//      AccessState-&gt;RemainingDesiredAccess &amp;= ~GrantedAccess;</span>
01127         <span class="comment">//  }</span>
01128         <span class="comment">//</span>
01129 
01130 <span class="preprocessor">#if 0</span>
01131 <span class="preprocessor"></span>        <a class="code" href="../../d3/d5/seaudit_8c.html#a26">SeCreateObjectAuditAlarm</a>( &amp;AccessState-&gt;OperationID,
01132                                   DirectoryObject,
01133                                   ComponentName,
01134                                   SecurityDescriptor,
01135                                   &amp;AccessState-&gt;SubjectSecurityContext,
01136                                   CreateAccess,
01137                                   AccessState-&gt;PrivilegesUsed,
01138                                   AccessAllowed,
01139                                   &amp;AuditPerformed,
01140                                   PreviousMode );
01141 
01142         <span class="keywordflow">if</span> ( AuditPerformed ) {
01143 
01144             AccessState-&gt;AuditHandleCreation = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01145         }
01146 <span class="preprocessor">#endif</span>
01147 <span class="preprocessor"></span>
01148     } <span class="keywordflow">else</span> {
01149 
01150         <span class="comment">//</span>
01151         <span class="comment">//  At this point there is not a security descriptor</span>
01152         <span class="comment">//  so we'll assume access is allowed</span>
01153         <span class="comment">//</span>
01154 
01155         AccessAllowed = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01156     }
01157 
01158     <span class="comment">//</span>
01159     <span class="comment">//  Free the caller's token and if the caller didn't have the</span>
01160     <span class="comment">//  object type locked we need to free it.</span>
01161     <span class="comment">//</span>
01162 
01163     <a class="code" href="../../d0/d8/subject_8c.html#a2">SeUnlockSubjectContext</a>( &amp;AccessState-&gt;SubjectSecurityContext );
01164 
01165     <span class="keywordflow">if</span> (!TypeMutexLocked) {
01166 
01167         <a class="code" href="../../d5/d1/obp_8h.html#a9">ObpLeaveObjectTypeMutex</a>( ObjectType );
01168     }
01169 
01170     <span class="comment">//</span>
01171     <span class="comment">//  Finally free the security descriptor</span>
01172     <span class="comment">//  and return to our caller</span>
01173     <span class="comment">//</span>
01174 
01175     <a class="code" href="../../d9/d1/obse_8c.html#a9">ObReleaseObjectSecurity</a>( SecurityDescriptor,
01176                              MemoryAllocated );
01177 
01178     <span class="keywordflow">return</span>( AccessAllowed );
01179 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a96" doxytag="ob.h::ObCheckObjectAccess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN ObCheckObjectAccess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>TypeMutexLocked</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PNTSTATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a70" doxytag="ob.h::ObCreateObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS ObCreateObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProbeMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OwnershipMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID ParseContext&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectBodySize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PagedPoolCharge</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NonPagedPoolCharge</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00055">55</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00284">_OBJECT_CREATE_INFORMATION::Attributes</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00313">_OBJECT_HEADER::Body</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00306">_OBJECT_HEADER::Flags</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00289">_OBJECT_CREATE_INFORMATION::NonPagedPoolCharge</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00351">OB_FLAG_PERMANENT_OBJECT</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00519">ObpAllocateObjectCreateInfoBuffer</a>, <a class="el" href="../../d5/d1/obp_8h.html#a58">ObpCaptureObjectCreateInformation()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00547">ObpFreeObjectCreateInfoBuffer</a>, <a class="el" href="../../d5/d1/obp_8h.html#a61">ObpFreeObjectNameBuffer()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00436">ObpReleaseObjectCreateInformation</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00288">_OBJECT_CREATE_INFORMATION::PagedPoolCharge</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01684">SeCreatePermanentPrivilege</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01165">CmpCreateRegistryRoot()</a>, <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00226">CmpDoCreateChild()</a>, <a class="el" href="../../d3/d1/cmparse_8c-source.html#l00963">CmpDoOpen()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00222">ExCreateCallback()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l03917">IoCreateController()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l04073">IoCreateDevice()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01071">IoCreateDriver()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05378">IoCreateStreamFileObject()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05535">IoCreateStreamFileObjectLite()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02272">IopInitializeAttributesAndCreateObject()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d7/d5/lpccreat_8c-source.html#l00136">LpcpCreatePort()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00768">MiSectionInitialization()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l00390">MmCreateSection()</a>, <a class="el" href="../../d5/d5/lpccompl_8c-source.html#l00040">NtAcceptConnectPort()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00101">NtCreateChannel()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00032">NtCreateDirectoryObject()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00180">NtCreateEvent()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00131">NtCreateEventPair()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00051">NtCreateIoCompletion()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00048">NtCreateJobObject()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00156">NtCreateMutant()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00199">NtCreateProfile()</a>, <a class="el" href="../../d3/d5/semphore_8c-source.html#l00123">NtCreateSemaphore()</a>, <a class="el" href="../../d2/d7/super_8c-source.html#l00056">NtCreateSuperSection()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00052">NtCreateSymbolicLinkObject()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00444">NtCreateTimer()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00348">NtOpenChannel()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00187">obtest()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01343">xxxCreateDesktop2()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00069                    :
00070 
00071     This <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a16">functions</a> allocates space <span class="keywordflow">for</span> an NT Object from either
00072     Paged or NonPaged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>. It captures <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> optional name and
00073     SECURITY_DESCRIPTOR parameters <span class="keywordflow">for</span> later use when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00074     inserted into an object table.  No quota <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> charged at <span class="keyword">this</span> time.
00075     That occurs when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted into an object table.
00076 
00077 Arguments:
00078 
00079     ProbeMode - The processor mode to consider when doing a probe
00080         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input parameters
00081 
00082     ObjectType - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> returned by <a class="code" href="../../d4/d0/ob_8h.html#a67">ObCreateObjectType</a>
00083         that gives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of object being created.
00084 
00085     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> attributes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00086         being created (such as its name)
00087 
00088     OwnershipMode - The processor mode of who <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> going to own <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00089 
00090     ParseContext - Ignored
00091 
00092     ObjectBodySize - Number of bytes to allocate <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object body.  The
00093         object body immediately follows <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object header in memory and are
00094         part of a single allocation.
00095 
00096     PagedPoolCharge - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount of paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> to charge <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00097         object.  If zero <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> charge <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00098         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used.
00099 
00100     NonPagedPoolCharge - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount of nonpaged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> to charge <span class="keywordflow">for</span>
00101         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  If zero <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> charge <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00102         object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used.
00103 
00104     Object - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> newly created object
00105 
00106 Return Value:
00107 
00108     Following errors can occur:
00109 
00110         - invalid object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>
00111         - insufficient memory
00112 
00113 --*/
00114 
00115 {
00116     UNICODE_STRING CapturedObjectName;
00117     <a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a> ObjectCreateInfo;
00118     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00119     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00120 
00121     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00122 
00123     <span class="comment">//</span>
00124     <span class="comment">//  Allocate a buffer to capture the object creation information.</span>
00125     <span class="comment">//</span>
00126 
00127     ObjectCreateInfo = <a class="code" href="../../d5/d1/obp_8h.html#a31">ObpAllocateObjectCreateInfoBuffer</a>();
00128 
00129     <span class="keywordflow">if</span> (ObjectCreateInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00130 
00131         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INSUFFICIENT_RESOURCES;
00132 
00133     } <span class="keywordflow">else</span> {
00134 
00135         <span class="comment">//</span>
00136         <span class="comment">//  Capture the object attributes, quality of service, and object</span>
00137         <span class="comment">//  name, if specified. Otherwise, initialize the captured object</span>
00138         <span class="comment">//  name, the security quality of service, and the create attributes</span>
00139         <span class="comment">//  to default values.</span>
00140         <span class="comment">//</span>
00141 
00142         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d1/obp_8h.html#a58">ObpCaptureObjectCreateInformation</a>( ObjectType,
00143                                                     ProbeMode,
00144                                                     ObjectAttributes,
00145                                                     &amp;CapturedObjectName,
00146                                                     ObjectCreateInfo,
00147                                                     FALSE );
00148 
00149         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00150 
00151             <span class="comment">//</span>
00152             <span class="comment">//  If the creation attributes are invalid, then return an error</span>
00153             <span class="comment">//  status.</span>
00154             <span class="comment">//</span>
00155 
00156             <span class="keywordflow">if</span> (ObjectType-&gt;TypeInfo.InvalidAttributes &amp; ObjectCreateInfo-&gt;<a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html#o0">Attributes</a>) {
00157 
00158                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00159 
00160             } <span class="keywordflow">else</span> {
00161 
00162                 <span class="comment">//</span>
00163                 <span class="comment">//  Set the paged and nonpaged pool quota charges for the</span>
00164                 <span class="comment">//  object allocation.</span>
00165                 <span class="comment">//</span>
00166 
00167                 <span class="keywordflow">if</span> (PagedPoolCharge == 0) {
00168 
00169                     PagedPoolCharge = ObjectType-&gt;TypeInfo.DefaultPagedPoolCharge;
00170                 }
00171 
00172                 <span class="keywordflow">if</span> (NonPagedPoolCharge == 0) {
00173 
00174                     NonPagedPoolCharge = ObjectType-&gt;TypeInfo.DefaultNonPagedPoolCharge;
00175                 }
00176 
00177                 ObjectCreateInfo-&gt;<a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html#o4">PagedPoolCharge</a> = PagedPoolCharge;
00178                 ObjectCreateInfo-&gt;<a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html#o5">NonPagedPoolCharge</a> = NonPagedPoolCharge;
00179 
00180                 <span class="comment">//</span>
00181                 <span class="comment">//  Allocate and initialize the object.</span>
00182                 <span class="comment">//</span>
00183 
00184                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d1/obp_8h.html#a62">ObpAllocateObject</a>( ObjectCreateInfo,
00185                                             OwnershipMode,
00186                                             ObjectType,
00187                                             &amp;CapturedObjectName,
00188                                             ObjectBodySize,
00189                                             &amp;ObjectHeader );
00190 
00191                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00192 
00193                     <span class="comment">//</span>
00194                     <span class="comment">//  If a permanent object is being created, then check if</span>
00195                     <span class="comment">//  the caller has the appropriate privilege.</span>
00196                     <span class="comment">//</span>
00197 
00198                     *Object = &amp;ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o11">Body</a>;
00199 
00200                     <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> &amp; <a class="code" href="../../d4/d0/ob_8h.html#a5">OB_FLAG_PERMANENT_OBJECT</a>) {
00201 
00202                         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d4/privileg_8c.html#a3">SeSinglePrivilegeCheck</a>( SeCreatePermanentPrivilege,
00203                                                      ProbeMode)) {
00204 
00205                             <a class="code" href="../../d5/d1/obp_8h.html#a63">ObpFreeObject</a>(*Object);
00206 
00207                             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_PRIVILEGE_NOT_HELD;
00208                         }
00209                     }
00210 
00211                     <span class="comment">//</span>
00212                     <span class="comment">//  Here is the only successful path out of this module but</span>
00213                     <span class="comment">//  this path can also return privilege not held.</span>
00214                     <span class="comment">//</span>
00215 
00216                     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00217                 }
00218             }
00219 
00220             <span class="comment">//</span>
00221             <span class="comment">//  An error path, free the create information.</span>
00222             <span class="comment">//</span>
00223 
00224             <a class="code" href="../../d5/d1/obp_8h.html#a30">ObpReleaseObjectCreateInformation</a>(ObjectCreateInfo);
00225 
00226             <span class="keywordflow">if</span> (CapturedObjectName.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00227 
00228                 <a class="code" href="../../d5/d1/obp_8h.html#a61">ObpFreeObjectNameBuffer</a>(&amp;CapturedObjectName);
00229             }
00230         }
00231 
00232         <span class="comment">//</span>
00233         <span class="comment">//  An error path, free object creation information buffer.</span>
00234         <span class="comment">//</span>
00235 
00236         <a class="code" href="../../d5/d1/obp_8h.html#a32">ObpFreeObjectCreateInfoBuffer</a>(ObjectCreateInfo);
00237     }
00238 
00239     <span class="comment">//</span>
00240     <span class="comment">//  An error path</span>
00241     <span class="comment">//</span>
00242 
00243     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00244 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a67" doxytag="ob.h::ObCreateObjectType" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS ObCreateObjectType           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>TypeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">POBJECT_TYPE_INITIALIZER</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectTypeInitializer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR SecurityDescriptor&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">69</a> of file <a class="el" href="../../d1/d1/obtype_8c-source.html">obtype.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00313">_OBJECT_HEADER::Body</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00175">_OBJECT_TYPE_INITIALIZER::DefaultNonPagedPoolCharge</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00190">_OBJECT_TYPE::DefaultObject</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00174">_OBJECT_TYPE_INITIALIZER::DefaultPagedPoolCharge</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00086">Event()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00209">ExInitializeResourceLite()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00306">_OBJECT_HEADER::Flags</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00191">_OBJECT_TYPE::Index</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00172">_OBJECT_TYPE_INITIALIZER::MaintainTypeList</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00187">_OBJECT_TYPE::Mutex</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00189">_OBJECT_TYPE::Name</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00370">NtGlobalFlag</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00348">OB_FLAG_KERNEL_OBJECT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00351">OB_FLAG_PERMANENT_OBJECT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00371">OBJECT_HEADER_TO_CREATOR_INFO</a>, <a class="el" href="../../d4/d0/ob_8h.html#a31">OBJECT_TYPE</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00228">OBP_MAX_DEFINED_OBJECT_TYPES</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00088">ObpDefaultObject</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00163">ObpEnterObjectTypeMutex</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00189">ObpEnterRootDirectoryMutex</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00903">ObpInsertDirectoryEntry()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00176">ObpLeaveObjectTypeMutex</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00202">ObpLeaveRootDirectoryMutex</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00705">ObpLookupDirectoryEntry()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00229">ObpObjectTypes</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00371">ObpTypeDirectoryObject</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00047">ObpTypeObjectType</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00071">ObpValidateIrql</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00173">_OBJECT_TYPE_INITIALIZER::PoolType</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01763">RtlCopyUnicodeString()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00246">RtlUnicodeStringToAnsiString()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00181">_OBJECT_TYPE_INITIALIZER::SecurityProcedure</a>, <a class="el" href="../../d1/d5/semethod_8c-source.html#l00195">SeDefaultObjectMethod()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00192">_OBJECT_TYPE::TotalNumberOfObjects</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00196">_OBJECT_TYPE::TypeInfo</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00188">_OBJECT_TYPE::TypeList</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00341">_OBJECT_HEADER_CREATOR_INFO::TypeList</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00165">_OBJECT_TYPE_INITIALIZER::UseDefaultObject</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00169">_OBJECT_TYPE_INITIALIZER::ValidAccessMask</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01074">CmpCreateObjectTypes()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00067">ExpEventInitialization()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00070">ExpEventPairInitialization()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00101">ExpInitializeCallbacks()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00095">ExpMutantInitialization()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00079">ExpProfileInitialization()</a>, <a class="el" href="../../d3/d5/semphore_8c-source.html#l00064">ExpSemaphoreInitialization()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00281">ExpTimerInitialization()</a>, <a class="el" href="../../d4/d6/win32_8c-source.html#l00060">ExpWin32Initialization()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l01936">IopCreateObjectTypes()</a>, <a class="el" href="../../d8/d5/lpcinit_8c-source.html#l00076">LpcInitSystem()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00768">MiSectionInitialization()</a>, <a class="el" href="../../d2/d7/super_8c-source.html#l00588">MiSuperSectionInitialization()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00187">obtest()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l01460">SepTokenInitialization()</a>.
<p>
<pre class="fragment"><div>00078                    :
00079 
00080     This routine creates a <span class="keyword">new</span> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
00081 
00082 Arguments:
00083 
00084     TypeName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>
00085 
00086     ObjectTypeInitializer - Supplies a object initialization
00087         structure.  This structure denotes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> object
00088         behavior including callbacks.
00089 
00090     SecurityDescriptor - Currently ignored
00091 
00092     ObjectType - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> newly created object
00093         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
00094 
00095 Return Value:
00096 
00097     An appropriate <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> value.
00098 
00099 --*/
00100 
00101 {
00102     <a class="code" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType;
00103     <a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">POBJECT_HEADER_CREATOR_INFO</a> CreatorInfo;
00104     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> NewObjectTypeHeader;
00105     <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> NewObjectType;
00106     ULONG i;
00107     UNICODE_STRING ObjectName;
00108     PWCH s;
00109     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00110     ULONG StandardHeaderCharge;
00111 
00112     <a class="code" href="../../d5/d1/obp_8h.html#a2">ObpValidateIrql</a>( <span class="stringliteral">"ObCreateObjectType"</span> );
00113 
00114     <span class="comment">//</span>
00115     <span class="comment">//  Return an error if invalid type attributes or no type name specified.</span>
00116     <span class="comment">//  No type name is okay if the type directory object does not exist</span>
00117     <span class="comment">//  yet (see init.c).</span>
00118     <span class="comment">//</span>
00119 
00120     PoolType = ObjectTypeInitializer-&gt;PoolType;
00121 
00122     <span class="keywordflow">if</span> ((!TypeName)
00123 
00124             ||
00125 
00126         (!TypeName-&gt;Length)
00127 
00128             ||
00129 
00130         (TypeName-&gt;Length % <span class="keyword">sizeof</span>( WCHAR ))
00131 
00132             ||
00133 
00134         (ObjectTypeInitializer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00135 
00136             ||
00137 
00138         (ObjectTypeInitializer-&gt;InvalidAttributes &amp; ~OBJ_VALID_ATTRIBUTES)
00139 
00140             ||
00141 
00142         (ObjectTypeInitializer-&gt;Length != <span class="keyword">sizeof</span>( *ObjectTypeInitializer ))
00143 
00144             ||
00145 
00146         (ObjectTypeInitializer-&gt;MaintainHandleCount &amp;&amp;
00147             (ObjectTypeInitializer-&gt;OpenProcedure == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00148              ObjectTypeInitializer-&gt;CloseProcedure == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ))
00149 
00150             ||
00151 
00152         ((!ObjectTypeInitializer-&gt;UseDefaultObject) &amp;&amp;
00153             (PoolType != <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>))) {
00154 
00155         <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00156     }
00157 
00158     <span class="comment">//</span>
00159     <span class="comment">//  Make sure that the type name does not contain an</span>
00160     <span class="comment">//  path name separator</span>
00161     <span class="comment">//</span>
00162 
00163     s = TypeName-&gt;Buffer;
00164     i = TypeName-&gt;Length / <span class="keyword">sizeof</span>( WCHAR );
00165 
00166     <span class="keywordflow">while</span> (i--) {
00167 
00168         <span class="keywordflow">if</span> (*s++ == OBJ_NAME_PATH_SEPARATOR) {
00169 
00170             <span class="keywordflow">return</span>( STATUS_OBJECT_NAME_INVALID );
00171         }
00172     }
00173 
00174     <span class="comment">//</span>
00175     <span class="comment">//  See if TypeName string already exists in the \ObjectTypes directory</span>
00176     <span class="comment">//  Return an error if it does.  Otherwise add the name to the directory.</span>
00177     <span class="comment">//  Note that there may not necessarily be a type directory.</span>
00178     <span class="comment">//</span>
00179 
00180     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/obp_8h.html#a46">ObpTypeDirectoryObject</a>) {
00181 
00182         <a class="code" href="../../d5/d1/obp_8h.html#a10">ObpEnterRootDirectoryMutex</a>();
00183 
00184         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/obp_8h.html#a68">ObpLookupDirectoryEntry</a>( ObpTypeDirectoryObject,
00185                                      TypeName,
00186                                      OBJ_CASE_INSENSITIVE )) {
00187 
00188             <a class="code" href="../../d5/d1/obp_8h.html#a11">ObpLeaveRootDirectoryMutex</a>();
00189 
00190             <span class="keywordflow">return</span>( STATUS_OBJECT_NAME_COLLISION );
00191         }
00192     }
00193 
00194     <span class="comment">//</span>
00195     <span class="comment">//  Allocate a buffer for the type name and then</span>
00196     <span class="comment">//  copy over the name</span>
00197     <span class="comment">//</span>
00198 
00199     ObjectName.Buffer = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool,
00200                                                (ULONG)TypeName-&gt;MaximumLength,
00201                                                'mNbO' );
00202 
00203     <span class="keywordflow">if</span> (ObjectName.Buffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00204 
00205         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/obp_8h.html#a46">ObpTypeDirectoryObject</a>)
00206 
00207             <a class="code" href="../../d5/d1/obp_8h.html#a11">ObpLeaveRootDirectoryMutex</a>();
00208 
00209         <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;
00210     }
00211 
00212     ObjectName.MaximumLength = TypeName-&gt;MaximumLength;
00213 
00214     <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>( &amp;ObjectName, TypeName );
00215 
00216     <span class="comment">//</span>
00217     <span class="comment">//  Allocate memory for the object</span>
00218     <span class="comment">//</span>
00219 
00220     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d1/obp_8h.html#a62">ObpAllocateObject</a>( NULL,
00221                                 KernelMode,
00222                                 ObpTypeObjectType,
00223                                 &amp;ObjectName,
00224                                 <span class="keyword">sizeof</span>( <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">OBJECT_TYPE</a> ),
00225                                 &amp;NewObjectTypeHeader );
00226 
00227     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00228 
00229         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/obp_8h.html#a46">ObpTypeDirectoryObject</a>)
00230 
00231             <a class="code" href="../../d5/d1/obp_8h.html#a11">ObpLeaveRootDirectoryMutex</a>();
00232 
00233         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(ObjectName.Buffer);
00234 
00235         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00236     }
00237 
00238     <span class="comment">//</span>
00239     <span class="comment">//  Initialize the create attributes, object ownership. parse context,</span>
00240     <span class="comment">//  and object body pointer.</span>
00241     <span class="comment">//</span>
00242     <span class="comment">//  N.B. This is required since these fields are not initialized.</span>
00243     <span class="comment">//</span>
00244 
00245     NewObjectTypeHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> |= <a class="code" href="../../d4/d0/ob_8h.html#a2">OB_FLAG_KERNEL_OBJECT</a> |
00246                                   <a class="code" href="../../d4/d0/ob_8h.html#a5">OB_FLAG_PERMANENT_OBJECT</a>;
00247 
00248     NewObjectType = (<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>)&amp;NewObjectTypeHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o11">Body</a>;
00249     NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o2">Name</a> = ObjectName;
00250 
00251     <span class="comment">//</span>
00252     <span class="comment">//  The following call zeros out the number of handles and objects</span>
00253     <span class="comment">//  field plus high water marks</span>
00254     <span class="comment">//</span>
00255 
00256     RtlZeroMemory( &amp;NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o5">TotalNumberOfObjects</a>,
00257                    FIELD_OFFSET( <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">OBJECT_TYPE</a>, TypeInfo ) -
00258                    FIELD_OFFSET( <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">OBJECT_TYPE</a>, TotalNumberOfObjects ));
00259 
00260     <span class="comment">//</span>
00261     <span class="comment">//  If there is not a type object type yet then this must be</span>
00262     <span class="comment">//  that type (i.e., type object type must be the first object type</span>
00263     <span class="comment">//  ever created.  Consequently we'll need to setup some self</span>
00264     <span class="comment">//  referencing pointers.</span>
00265     <span class="comment">//</span>
00266 
00267     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d5/kddata_8c.html#a10">ObpTypeObjectType</a>) {
00268 
00269         <a class="code" href="../../d8/d5/kddata_8c.html#a10">ObpTypeObjectType</a> = NewObjectType;
00270         NewObjectTypeHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a> = <a class="code" href="../../d8/d5/kddata_8c.html#a10">ObpTypeObjectType</a>;
00271         NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o5">TotalNumberOfObjects</a> = 1;
00272 
00273 <span class="preprocessor">#ifdef POOL_TAGGING</span>
00274 <span class="preprocessor"></span>
00275         NewObjectType-&gt;Key = 'TjbO';
00276 
00277     } <span class="keywordflow">else</span> {
00278 
00279         <span class="comment">//</span>
00280         <span class="comment">//  Otherwise this is not the type object type so we'll</span>
00281         <span class="comment">//  try and generate a tag for the new object type provided</span>
00282         <span class="comment">//  pool tagging is turned on.</span>
00283         <span class="comment">//</span>
00284 
00285         ANSI_STRING AnsiName;
00286 
00287         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d6/d6/nls_8c.html#a23">RtlUnicodeStringToAnsiString</a>( &amp;AnsiName, TypeName, TRUE ) )) {
00288 
00289             <span class="keywordflow">for</span> (i=3; i&gt;=AnsiName.Length; i--) {
00290 
00291                 AnsiName.Buffer[ i ] = <span class="charliteral">' '</span>;
00292 
00293             }
00294 
00295             NewObjectType-&gt;Key = *(PULONG)AnsiName.Buffer;
00296             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( AnsiName.Buffer );
00297 
00298         } <span class="keywordflow">else</span> {
00299 
00300             NewObjectType-&gt;Key = *(PULONG)TypeName-&gt;Buffer;
00301         }
00302 
00303 <span class="preprocessor">#endif //POOL_TAGGING</span>
00304 <span class="preprocessor"></span>
00305     }
00306 
00307     <span class="comment">//</span>
00308     <span class="comment">//  Continue initializing the new object type fields</span>
00309     <span class="comment">//</span>
00310 
00311     NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a> = *ObjectTypeInitializer;
00312     NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o9">PoolType</a> = PoolType;
00313 
00314     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2/ldrp_8h.html#a33">NtGlobalFlag</a> &amp; FLG_MAINTAIN_OBJECT_TYPELIST) {
00315 
00316         NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o8">MaintainTypeList</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00317     }
00318 
00319     <span class="comment">//</span>
00320     <span class="comment">//  Whack quotas passed in so that headers are properly charged</span>
00321     <span class="comment">//</span>
00322     <span class="comment">//  Quota for object name is charged independently</span>
00323     <span class="comment">//</span>
00324 
00325     StandardHeaderCharge = <span class="keyword">sizeof</span>( <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">OBJECT_HEADER</a> ) +
00326                            <span class="keyword">sizeof</span>( <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">OBJECT_HEADER_NAME_INFO</a> ) +
00327                            (ObjectTypeInitializer-&gt;MaintainHandleCount ?
00328                                 <span class="keyword">sizeof</span>( <a class="code" href="../../d8/d5/struct__OBJECT__HEADER__HANDLE__INFO.html">OBJECT_HEADER_HANDLE_INFO</a> )
00329                               : 0 );
00330 
00331     <span class="keywordflow">if</span> ( PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a> ) {
00332 
00333         NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o11">DefaultNonPagedPoolCharge</a> += StandardHeaderCharge;
00334 
00335     } <span class="keywordflow">else</span> {
00336 
00337         NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o10">DefaultPagedPoolCharge</a> += StandardHeaderCharge;
00338     }
00339 
00340     <span class="comment">//</span>
00341     <span class="comment">//  If there is not an object type specific security procedure then set</span>
00342     <span class="comment">//  the default one supplied by Se.</span>
00343     <span class="comment">//</span>
00344 
00345     <span class="keywordflow">if</span> (ObjectTypeInitializer-&gt;SecurityProcedure == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00346 
00347         NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o17">SecurityProcedure</a> = <a class="code" href="../../d0/d5/se_8h.html#a115">SeDefaultObjectMethod</a>;
00348     }
00349 
00350     <span class="comment">//</span>
00351     <span class="comment">//  Initialize the object type lock and its list of objects created</span>
00352     <span class="comment">//  of this type</span>
00353     <span class="comment">//</span>
00354 
00355     <a class="code" href="../../d5/d8/ex_8h.html#a266">ExInitializeResourceLite</a>( &amp;NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o0">Mutex</a> );
00356 
00357     InitializeListHead( &amp;NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o1">TypeList</a> );
00358 
00359     <span class="comment">//</span>
00360     <span class="comment">//  If we are to use the default object (meaning that we'll have our</span>
00361     <span class="comment">//  private event as our default object) then the type must allow</span>
00362     <span class="comment">//  synchronize and we'll set the default object</span>
00363     <span class="comment">//</span>
00364 
00365     <span class="keywordflow">if</span> (NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o1">UseDefaultObject</a>) {
00366 
00367         NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o5">ValidAccessMask</a> |= SYNCHRONIZE;
00368         NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o3">DefaultObject</a> = &amp;<a class="code" href="../../d5/d1/obp_8h.html#a34">ObpDefaultObject</a>;
00369 
00370     <span class="comment">//</span>
00371     <span class="comment">//  Otherwise if this is the type file object then we'll put</span>
00372     <span class="comment">//  in the offset to the event of a file object.</span>
00373     <span class="comment">//</span>
00374     <span class="comment">//  **** What a hack</span>
00375     <span class="comment">//</span>
00376 
00377     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ObjectName.Length == 8 &amp;&amp; !wcscmp( ObjectName.Buffer, L<span class="stringliteral">"File"</span> )) {
00378 
00379         NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o3">DefaultObject</a> = ULongToPtr( FIELD_OFFSET( <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">FILE_OBJECT</a>, Event ) );
00380 
00381 
00382     <span class="comment">//</span>
00383     <span class="comment">// If this is a waitable port, set the offset to the event in the</span>
00384     <span class="comment">// waitableport object.  Another hack</span>
00385     <span class="comment">//</span>
00386 
00387     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ObjectName.Length == 24 &amp;&amp; !wcscmp( ObjectName.Buffer, L<span class="stringliteral">"WaitablePort"</span>)) {
00388 
00389         NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o3">DefaultObject</a> = ULongToPtr( FIELD_OFFSET( <a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html">LPCP_PORT_OBJECT</a>, WaitEvent ) );
00390 
00391     <span class="comment">//</span>
00392     <span class="comment">//  Otherwise indicate that there isn't a default object to wait</span>
00393     <span class="comment">//  on</span>
00394     <span class="comment">//</span>
00395 
00396     } <span class="keywordflow">else</span> {
00397 
00398         NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o3">DefaultObject</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00399     }
00400 
00401     <span class="comment">//</span>
00402     <span class="comment">//  Lock down the type object type and if there is a creator info</span>
00403     <span class="comment">//  record then insert this object on that list</span>
00404     <span class="comment">//</span>
00405 
00406     <a class="code" href="../../d5/d1/obp_8h.html#a8">ObpEnterObjectTypeMutex</a>( ObpTypeObjectType );
00407 
00408     CreatorInfo = <a class="code" href="../../d4/d0/ob_8h.html#a13">OBJECT_HEADER_TO_CREATOR_INFO</a>( NewObjectTypeHeader );
00409 
00410     <span class="keywordflow">if</span> (CreatorInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00411 
00412         InsertTailList( &amp;<a class="code" href="../../d8/d5/kddata_8c.html#a10">ObpTypeObjectType</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o1">TypeList</a>, &amp;CreatorInfo-&gt;<a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html#o0">TypeList</a> );
00413     }
00414 
00415     <span class="comment">//</span>
00416     <span class="comment">//  Store a pointer to this new object type in the</span>
00417     <span class="comment">//  global object types array.  We'll use the index from</span>
00418     <span class="comment">//  the type object type number of objects count</span>
00419     <span class="comment">//</span>
00420 
00421     NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o4">Index</a> = <a class="code" href="../../d8/d5/kddata_8c.html#a10">ObpTypeObjectType</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o5">TotalNumberOfObjects</a>;
00422 
00423     <span class="keywordflow">if</span> (NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o4">Index</a> &lt; <a class="code" href="../../d5/d1/obp_8h.html#a14">OBP_MAX_DEFINED_OBJECT_TYPES</a>) {
00424 
00425         <a class="code" href="../../d5/d1/obp_8h.html#a38">ObpObjectTypes</a>[ NewObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o4">Index</a> - 1 ] = NewObjectType;
00426     }
00427 
00428     <span class="comment">//</span>
00429     <span class="comment">//  Unlock the type object type lock</span>
00430     <span class="comment">//</span>
00431 
00432     <a class="code" href="../../d5/d1/obp_8h.html#a9">ObpLeaveObjectTypeMutex</a>( ObpTypeObjectType );
00433 
00434     <span class="comment">//</span>
00435     <span class="comment">//  Lastly if there is not a directory object type yet then the following</span>
00436     <span class="comment">//  code will actually drop through and set the output object type</span>
00437     <span class="comment">//  and return success.</span>
00438     <span class="comment">//</span>
00439     <span class="comment">//  Otherwise, there is a directory object type and we try to insert the</span>
00440     <span class="comment">//  new type into the directory.  If this succeeds then we'll reference</span>
00441     <span class="comment">//  the directory type object, unlock the root directory, set the</span>
00442     <span class="comment">//  output type and return success</span>
00443     <span class="comment">//</span>
00444 
00445     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d1/obp_8h.html#a46">ObpTypeDirectoryObject</a> ||
00446         <a class="code" href="../../d5/d1/obp_8h.html#a69">ObpInsertDirectoryEntry</a>( ObpTypeDirectoryObject, NewObjectType )) {
00447 
00448         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/obp_8h.html#a46">ObpTypeDirectoryObject</a>) {
00449 
00450             <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>( ObpTypeDirectoryObject );
00451         }
00452 
00453         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/obp_8h.html#a46">ObpTypeDirectoryObject</a>) {
00454 
00455             <a class="code" href="../../d5/d1/obp_8h.html#a11">ObpLeaveRootDirectoryMutex</a>();
00456         }
00457 
00458         *ObjectType = NewObjectType;
00459 
00460         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00461 
00462     } <span class="keywordflow">else</span> {
00463 
00464         <span class="comment">//</span>
00465         <span class="comment">//  Otherwise there is a directory object type and</span>
00466         <span class="comment">//  the insertion failed.  So release the root directory</span>
00467         <span class="comment">//  and return failure to our caller.</span>
00468         <span class="comment">//</span>
00469 
00470         <a class="code" href="../../d5/d1/obp_8h.html#a11">ObpLeaveRootDirectoryMutex</a>();
00471 
00472         <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
00473     }
00474 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a69" doxytag="ob.h::ObDeleteCapturedInsertInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID ObDeleteCapturedInsertInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Object</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00713">713</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00306">_OBJECT_HEADER::Flags</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00347">OB_FLAG_NEW_OBJECT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00308">_OBJECT_HEADER::ObjectCreateInfo</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00431">ObpFreeObjectCreateInformation</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d5/d4/seclient_8c-source.html#l00062">SepCreateClientSecurity()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>.
<p>
<pre class="fragment"><div>00719                    :
00720 
00721     This function frees <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> creation information that could be pointed at
00722     by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object header.
00723 
00724 Arguments:
00725 
00726     Object - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being modified
00727 
00728 Return Value:
00729 
00730     None.
00731 
00732 --*/
00733 
00734 {
00735     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00736 
00737     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00738 
00739     <span class="comment">//</span>
00740     <span class="comment">//  Get the address of the object header and free the object create</span>
00741     <span class="comment">//  information object if the object is being created.</span>
00742     <span class="comment">//</span>
00743 
00744     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(Object);
00745 
00746     <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> &amp; <a class="code" href="../../d4/d0/ob_8h.html#a1">OB_FLAG_NEW_OBJECT</a>) {
00747 
00748         <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o8">ObjectCreateInfo</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00749 
00750             <a class="code" href="../../d5/d1/obp_8h.html#a29">ObpFreeObjectCreateInformation</a>(ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o8">ObjectCreateInfo</a>);
00751 
00752             ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o8">ObjectCreateInfo</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00753         }
00754     }
00755 
00756     <span class="keywordflow">return</span>;
00757 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a90" doxytag="ob.h::ObDereferenceDeviceMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ObDereferenceDeviceMap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Process</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00416">416</a> of file <a class="el" href="../../d8/d9/obdevmap_8c-source.html">obdevmap.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00213">_OBJECT_DIRECTORY::DeviceMap</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00244">_DEVICE_MAP::DosDevicesDirectory</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00098">ObpDeviceMapLock</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00243">_DEVICE_MAP::ReferenceCount</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00030">ObSetDeviceMap()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01363">PspProcessDelete()</a>.
<p>
<pre class="fragment"><div>00422                    :
00423 
00424     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called at process tear down time to decrement <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00425     reference count on a device map.  When <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference count goes to
00426     zero, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> means no more processes are <span class="keyword">using</span> <span class="keyword">this</span>, so <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> can be freed
00427     and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> associated object directory can be released.
00428 
00429 Arguments:
00430 
00431     Process - Process being destroyed.
00432 
00433 Return Value:
00434 
00435     None.
00436 
00437 --*/
00438 
00439 {
00440     <a class="code" href="../../d2/d4/struct__DEVICE__MAP.html">PDEVICE_MAP</a> DeviceMap;
00441     KIRQL OldIrql;
00442 
00443     <span class="comment">//</span>
00444     <span class="comment">//  Grab the device map and then we only have work to do</span>
00445     <span class="comment">//  it there is one</span>
00446     <span class="comment">//</span>
00447 
00448     DeviceMap = Process-&gt;DeviceMap;
00449 
00450     <span class="keywordflow">if</span> (DeviceMap != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00451 
00452         <span class="comment">//</span>
00453         <span class="comment">//  To dereference the device map we need to null out the</span>
00454         <span class="comment">//  processes device map pointer, and decrement its ref count</span>
00455         <span class="comment">//  If the ref count goes to zero we can free up the memory</span>
00456         <span class="comment">//  and dereference the dos device directory object</span>
00457         <span class="comment">//</span>
00458 
00459         ExAcquireSpinLock( &amp;ObpDeviceMapLock, &amp;OldIrql );
00460 
00461         Process-&gt;DeviceMap = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00462         DeviceMap-&gt;<a class="code" href="../../d2/d4/struct__DEVICE__MAP.html#o0">ReferenceCount</a>--;
00463 
00464         <span class="keywordflow">if</span> (DeviceMap-&gt;<a class="code" href="../../d2/d4/struct__DEVICE__MAP.html#o0">ReferenceCount</a> == 0) {
00465 
00466             DeviceMap-&gt;<a class="code" href="../../d2/d4/struct__DEVICE__MAP.html#o1">DosDevicesDirectory</a>-&gt;<a class="code" href="../../d8/d4/struct__OBJECT__DIRECTORY.html#o4">DeviceMap</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00467 
00468             ExReleaseSpinLock( &amp;ObpDeviceMapLock, OldIrql );
00469 
00470             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( DeviceMap-&gt;<a class="code" href="../../d2/d4/struct__DEVICE__MAP.html#o1">DosDevicesDirectory</a> );
00471 
00472             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( DeviceMap );
00473 
00474         } <span class="keywordflow">else</span> {
00475 
00476             ExReleaseSpinLock( &amp;ObpDeviceMapLock, OldIrql );
00477         }
00478     }
00479 
00480     <span class="comment">//</span>
00481     <span class="comment">//  And return to our caller</span>
00482     <span class="comment">//</span>
00483 
00484     <span class="keywordflow">return</span>;
00485 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a85" doxytag="ob.h::ObDumpObjectByHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObDumpObjectByHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">POB_DUMP_CONTROL</a> Control&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a86" doxytag="ob.h::ObDumpObjectByPointer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObDumpObjectByPointer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/struct__OBJECT__DUMP__CONTROL.html">POB_DUMP_CONTROL</a> Control&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a79" doxytag="ob.h::ObfDereferenceObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID FASTCALL ObfDereferenceObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Object</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/obref_8c-source.html#l01124">1124</a> of file <a class="el" href="../../d8/d0/obref_8c-source.html">obref.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a205">CriticalWorkQueue</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01961">ExInitializeWorkItem</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00375">ExQueueWorkItem()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d5/lpc_8h-source.html#l00106">_LPCP_PORT_OBJECT::Flags</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00299">_OBJECT_HEADER::HandleCount</a>, <a class="el" href="../../d1/d6/lpcp_8h-source.html#l00093">LpcpAcquireLpcpLock</a>, <a class="el" href="../../d0/d8/ntos_8h-source.html#l00091">LpcPortObjectType</a>, <a class="el" href="../../d1/d6/lpcp_8h-source.html#l00108">LpcpReleaseLpcpLock</a>, <a class="el" href="../../d0/d8/ntos_8h-source.html#l00092">LpcWaitablePortObjectType</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00368">OBJECT_HEADER_TO_NAME_INFO</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00145">ObpDecrPointerCountWithResult</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00087">ObpLock</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01299">ObpProcessRemoveObjectQueue()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00090">ObpRemoveObjectQueue</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01370">ObpRemoveObjectRoutine()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00089">ObpRemoveObjectWorkItem</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00027">ObpRemoveQueueActive</a>, <a class="el" href="../../d2/d2/ppcdef_8h-source.html#l00079">PASSIVE_LEVEL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00173">_OBJECT_TYPE_INITIALIZER::PoolType</a>, <a class="el" href="../../d3/d5/lpc_8h-source.html#l00138">PORT_DELETED</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00300">_OBJECT_HEADER::SEntry</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00196">_OBJECT_TYPE::TypeInfo</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/obref_8c-source.html#l01679">ObDereferenceObject()</a>.
<p>
<pre class="fragment"><div>01130                    :
01131 
01132     This routine decrments <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> refernce count of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified object and
01133     does whatever cleanup there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> count goes to zero.
01134 
01135 Arguments:
01136 
01137     Object - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> body of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being dereferenced
01138 
01139 Return Value:
01140 
01141     None.
01142 
01143 --*/
01144 
01145 {
01146     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
01147     <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType;
01148     KIRQL OldIrql;
01149     BOOLEAN StartWorkerThread;
01150 
01151     <a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html">PLPCP_PORT_OBJECT</a> Port = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01152 
01153 <span class="preprocessor">#if DBG</span>
01154 <span class="preprocessor"></span>
01155     <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a> NameInfo;
01156 
01157 <span class="preprocessor">#endif</span>
01158 <span class="preprocessor"></span>
01159     <span class="comment">//</span>
01160     <span class="comment">//  Translate a pointer to the object body to a pointer to the object</span>
01161     <span class="comment">//  header.</span>
01162     <span class="comment">//</span>
01163 
01164     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
01165 
01166 <span class="preprocessor">#if DBG</span>
01167 <span class="preprocessor"></span>
01168     NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectHeader );
01169 
01170     <span class="keywordflow">if</span> (NameInfo) {
01171 
01172        InterlockedDecrement(&amp;NameInfo-&gt;DbgDereferenceCount) ;
01173     }
01174 
01175 <span class="preprocessor">#endif</span>
01176 <span class="preprocessor"></span>
01177 
01178     <span class="comment">//</span>
01179     <span class="comment">//  Decrement the point count and if the result is now then</span>
01180     <span class="comment">//  there is extra work to do</span>
01181     <span class="comment">//</span>
01182 
01183     ObjectType = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>;
01184 
01185     <span class="keywordflow">if</span> ( (ObjectType == <a class="code" href="../../d9/d8/ntos_8h.html#a5">LpcPortObjectType</a>) ||
01186          (ObjectType == <a class="code" href="../../d9/d8/ntos_8h.html#a6">LpcWaitablePortObjectType</a>) ) {
01187 
01188         Port = Object;
01189         <a class="code" href="../../d0/d7/lpcp_8h.html#a3">LpcpAcquireLpcpLock</a>();
01190     }
01191 
01192     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/obp_8h.html#a5">ObpDecrPointerCountWithResult</a>( ObjectHeader )) {
01193 
01194         <span class="comment">//</span>
01195         <span class="comment">//  Find out the level we're at and the object type</span>
01196         <span class="comment">//</span>
01197 
01198         OldIrql = KeGetCurrentIrql();
01199 
01200         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o1">HandleCount</a> == 0);
01201 
01202 
01203         <span class="keywordflow">if</span> (Port != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01204 
01205             Port-&gt;<a class="code" href="../../d9/d4/struct__LPCP__PORT__OBJECT.html#o1">Flags</a> |= <a class="code" href="../../d2/d6/lpc_8h.html#a11">PORT_DELETED</a>;
01206             Port = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01207 
01208             <a class="code" href="../../d0/d7/lpcp_8h.html#a4">LpcpReleaseLpcpLock</a>();
01209         }
01210 
01211 
01212         <span class="comment">//</span>
01213         <span class="comment">//  If we're at the passive level then go ahead and delete the</span>
01214         <span class="comment">//  object now.  Or if we're at APC level and object say's we're</span>
01215         <span class="comment">//  allocated out of paged pool then also go ahead and delete</span>
01216         <span class="comment">//  the object right now.</span>
01217         <span class="comment">//</span>
01218 
01219         <span class="keywordflow">if</span> ((OldIrql == <a class="code" href="../../d1/d3/ppcdef_8h.html#a21">PASSIVE_LEVEL</a>) ||
01220             ((OldIrql == <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) &amp;&amp;
01221              ((ObjectType != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o9">PoolType</a> != <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>)))) {
01222 
01223 
01224                 <a class="code" href="../../d7/d1/obref_8c.html#a10">ObpRemoveObjectRoutine</a>( Object );
01225 
01226                 <span class="keywordflow">return</span>;    
01227 
01228         } <span class="keywordflow">else</span> {
01229 
01230             <span class="comment">//</span>
01231             <span class="comment">//  Objects can't be deleted from an IRQL above APC_LEVEL.</span>
01232             <span class="comment">//  Nonpaged objects can't be deleted from APC_LEVEL.</span>
01233             <span class="comment">//  So queue the delete operation.</span>
01234             <span class="comment">//</span>
01235 
01236             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a> == NULL) || (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o9">PoolType</a> == NonPagedPool));
01237 
01238             <span class="comment">//</span>
01239             <span class="comment">//  Lock the work queue, enqueue the new work item, and if the</span>
01240             <span class="comment">//  work queue is not active then make it active, indicate that</span>
01241             <span class="comment">//  we need to start the worker thread, and unlock the work</span>
01242             <span class="comment">//  queue.</span>
01243             <span class="comment">//</span>
01244 
01245             ExAcquireSpinLock( &amp;ObpLock, &amp;OldIrql );
01246 
01247             PushEntryList((PSINGLE_LIST_ENTRY)&amp;ObpRemoveObjectQueue, (PSINGLE_LIST_ENTRY)&amp;ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o2">SEntry</a> );
01248 
01249             <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d1/obref_8c.html#a0">ObpRemoveQueueActive</a>) {
01250 
01251                 <a class="code" href="../../d7/d1/obref_8c.html#a0">ObpRemoveQueueActive</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01252                 StartWorkerThread = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01253 
01254             } <span class="keywordflow">else</span> {
01255 
01256                 StartWorkerThread = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01257             }
01258 
01259 <span class="preprocessor">#if 0</span>
01260 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (StartWorkerThread) {
01261 
01262                 KdPrint(( <span class="stringliteral">"OB: %08x Starting ObpProcessRemoveObjectQueue thread.\n"</span>, Object ));
01263 
01264             } <span class="keywordflow">else</span> {
01265 
01266                 KdPrint(( <span class="stringliteral">"OB: %08x Queued to ObpProcessRemoveObjectQueue thread.\n"</span>, Object ));
01267             }
01268 
01269 <span class="preprocessor">#endif  // 1</span>
01270 <span class="preprocessor"></span>
01271             ExReleaseSpinLock( &amp;ObpLock, OldIrql );
01272 
01273             <span class="comment">//</span>
01274             <span class="comment">//  If we have to start the worker thread then go ahead</span>
01275             <span class="comment">//  and enqueue the work item</span>
01276             <span class="comment">//</span>
01277 
01278             <span class="keywordflow">if</span> (StartWorkerThread) {
01279 
01280                 <a class="code" href="../../d5/d8/ex_8h.html#a55">ExInitializeWorkItem</a>( &amp;ObpRemoveObjectWorkItem,
01281                                       ObpProcessRemoveObjectQueue,
01282                                       NULL );
01283 
01284                 <a class="code" href="../../d5/d8/ex_8h.html#a261">ExQueueWorkItem</a>( &amp;ObpRemoveObjectWorkItem, CriticalWorkQueue );
01285             }
01286         }
01287     }
01288 
01289     <span class="keywordflow">if</span> ( Port != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01290 
01291         <a class="code" href="../../d0/d7/lpcp_8h.html#a4">LpcpReleaseLpcpLock</a>();
01292     }
01293 
01294     <span class="keywordflow">return</span>;
01295 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a77" doxytag="ob.h::ObFindHandleForObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN ObFindHandleForObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">POBJECT_HANDLE_INFORMATION</a> MatchCriteria&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a68" doxytag="ob.h::ObFreeObjectCreateInfoBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL ObFreeObjectCreateInfoBuffer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">POBJECT_CREATE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ObjectCreateInfo</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01279">1279</a> of file <a class="el" href="../../d7/d9/obcreate_8c-source.html">obcreate.c</a>.
<p>
References <a class="el" href="../../d6/d0/obp_8h-source.html#l00547">ObpFreeObjectCreateInfoBuffer</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05535">IoCreateStreamFileObjectLite()</a>.
<p>
<pre class="fragment"><div>01285                    :
01286 
01287     This function frees a create information buffer.  Called from IO component
01288 
01289     N.B. This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> nonpageable.
01290 
01291 Arguments:
01292 
01293     ObjectCreateInfo - Supplies a pointer to a create information buffer.
01294 
01295 Return Value:
01296 
01297     None.
01298 
01299 --*/
01300 
01301 {
01302     <a class="code" href="../../d5/d1/obp_8h.html#a32">ObpFreeObjectCreateInfoBuffer</a>( ObjectCreateInfo );
01303 
01304     <span class="keywordflow">return</span>;
01305 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a82" doxytag="ob.h::ObGetObjectPointerCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI ULONG ObGetObjectPointerCount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Object</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/obref_8c-source.html#l00058">58</a> of file <a class="el" href="../../d8/d0/obref_8c-source.html">obref.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l02396">PsEnforceExecutionTimeLimits()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02210">PspApplyJobLimitsToProcessSet()</a>, and <a class="el" href="../../d2/d0/psjob_8c-source.html#l02570">PspTerminateAllProcessesInJob()</a>.
<p>
<pre class="fragment"><div>00064                    :
00065 
00066     This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current pointer count <span class="keywordflow">for</span> a specified object.
00067 
00068 Arguments:
00069 
00070     Object - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object whose pointer count <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be returned.
00071 
00072 Return Value:
00073 
00074     The current pointer count <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00075 
00076 Note:
00077 
00078     This function cannot be <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> a macro, since fields in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread object
00079     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a> from release to release, so <span class="keyword">this</span> must remain a full function.
00080 
00081 --*/
00082 
00083 {
00084     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00085 
00086     <span class="comment">//</span>
00087     <span class="comment">//  Simply return the current pointer count for the object.</span>
00088     <span class="comment">//</span>
00089 
00090     <span class="keywordflow">return</span> <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object )-&gt;PointerCount;
00091 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a91" doxytag="ob.h::ObGetObjectSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObGetObjectSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryAllocated</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/obse_8c-source.html#l01258">1258</a> of file <a class="el" href="../../d0/d1/obse_8c-source.html">obse.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00168">_OBJECT_TYPE_INITIALIZER::GenericMapping</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00056">ObpBeginTypeSpecificCallOut</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00221">ObpCentralizedSecurity</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00057">ObpEndTypeSpecificCallOut</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00559">ObpReferenceSecurityDescriptor()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00173">_OBJECT_TYPE_INITIALIZER::PoolType</a>, <a class="el" href="../../d0/d5/se_8h.html#a200a109">QuerySecurityDescriptor</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00312">_OBJECT_HEADER::SecurityDescriptor</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00181">_OBJECT_TYPE_INITIALIZER::SecurityProcedure</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00196">_OBJECT_TYPE::TypeInfo</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00602">ObpCheckObjectReference()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01121">ObpProcessDosDeviceSymbolicLink()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, and <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>.
<p>
<pre class="fragment"><div>01266                    :
01267 
01268     Given an object, <span class="keyword">this</span> routine will find its security descriptor.
01269     It will <span class="keywordflow">do</span> <span class="keyword">this</span> by calling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object's security method.
01270 
01271     It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> possible <span class="keywordflow">for</span> an object not to have a security descriptor
01272     at all.  Unnamed objects such as events that can <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be referenced
01273     by a handle are an example of an object that does not have a
01274     security descriptor.
01275 
01276 Arguments:
01277 
01278     Object - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object body being queried.
01279 
01280     SecurityDescriptor - Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object's security
01281         descriptor.
01282 
01283     MemoryAllocated - indicates whether we had to allocate <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
01284         memory to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor or not.  This should
01285         be passed back into <a class="code" href="../../d4/d0/ob_8h.html#a92">ObReleaseObjectSecurity</a>.
01286 
01287 Return Value:
01288 
01289     STATUS_SUCCESS - The operation was successful.  Note that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01290         operation may be successful and still <span class="keywordflow">return</span> a <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> security
01291         descriptor.
01292 
01293     STATUS_INSUFFICIENT_RESOURCES - Insufficient memory was available
01294         to satisfy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request.
01295 
01296 --*/
01297 
01298 {
01299     SECURITY_INFORMATION SecurityInformation;
01300     ULONG Length = 0;
01301     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01302     <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType;
01303     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
01304     KIRQL SaveIrql;
01305 
01306     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01307 
01308     <span class="comment">//</span>
01309     <span class="comment">//  Map the object body to its object header and corresponding</span>
01310     <span class="comment">//  object type</span>
01311     <span class="comment">//</span>
01312 
01313     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
01314     ObjectType = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>;
01315 
01316     <span class="comment">//</span>
01317     <span class="comment">//  If the object is one that uses the default object method,</span>
01318     <span class="comment">//  its security descriptor is contained in ob's security</span>
01319     <span class="comment">//  descriptor cache.</span>
01320     <span class="comment">//</span>
01321     <span class="comment">//  Reference it so that it doesn't go away out from under us.</span>
01322     <span class="comment">//</span>
01323 
01324     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/obp_8h.html#a13">ObpCentralizedSecurity</a>(ObjectType))  {
01325 
01326         *SecurityDescriptor = <a class="code" href="../../d8/d1/obsdata_8c.html#a18">ObpReferenceSecurityDescriptor</a>( Object );
01327 
01328         *MemoryAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01329 
01330         <span class="keywordflow">return</span>( STATUS_SUCCESS );
01331     }
01332 
01333     <span class="comment">//</span>
01334     <span class="comment">//  Request a complete security descriptor</span>
01335     <span class="comment">//</span>
01336 
01337     SecurityInformation = OWNER_SECURITY_INFORMATION |
01338                           GROUP_SECURITY_INFORMATION |
01339                           DACL_SECURITY_INFORMATION  |
01340                           SACL_SECURITY_INFORMATION;
01341 
01342     <span class="comment">//</span>
01343     <span class="comment">//  Call the security method with Length = 0 to find out</span>
01344     <span class="comment">//  how much memory we need to store the final result.</span>
01345     <span class="comment">//</span>
01346     <span class="comment">//  Note that the ObjectsSecurityDescriptor parameter is NULL,</span>
01347     <span class="comment">//  because we expect whoever is on the other end of this call</span>
01348     <span class="comment">//  to find the security descriptor for us.  We pass in a pool</span>
01349     <span class="comment">//  type to keep the compiler happy, it will not be used for a</span>
01350     <span class="comment">//  query operation.</span>
01351     <span class="comment">//</span>
01352 
01353 
01354     <a class="code" href="../../d5/d1/obp_8h.html#a0">ObpBeginTypeSpecificCallOut</a>( SaveIrql );
01355 
01356     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (*ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o17">SecurityProcedure</a>)( Object,
01357                                                         <a class="code" href="../../d0/d5/se_8h.html#a200a109">QuerySecurityDescriptor</a>,
01358                                                         &amp;SecurityInformation,
01359                                                         *SecurityDescriptor,
01360                                                         &amp;Length,
01361                                                         &amp;ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o10">SecurityDescriptor</a>,         <span class="comment">// not used</span>
01362                                                         ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o9">PoolType</a>,
01363                                                         &amp;ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o4">GenericMapping</a> );
01364 
01365     <a class="code" href="../../d5/d1/obp_8h.html#a1">ObpEndTypeSpecificCallOut</a>( SaveIrql, <span class="stringliteral">"Security"</span>, ObjectType, Object );
01366 
01367     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_BUFFER_TOO_SMALL) {
01368 
01369         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01370     }
01371 
01372     <span class="comment">//</span>
01373     <span class="comment">//  Now that we know how large the security descriptor is we</span>
01374     <span class="comment">//  can allocate space for it</span>
01375     <span class="comment">//</span>
01376 
01377     *SecurityDescriptor = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, Length, 'qSbO' );
01378 
01379     <span class="keywordflow">if</span> (*SecurityDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01380 
01381         <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01382     }
01383 
01384     *MemoryAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01385 
01386     <span class="comment">//</span>
01387     <span class="comment">//  The security method will return an absolute format</span>
01388     <span class="comment">//  security descriptor that just happens to be in a self</span>
01389     <span class="comment">//  contained buffer (not to be confused with a self-relative</span>
01390     <span class="comment">//  security descriptor).</span>
01391     <span class="comment">//</span>
01392 
01393     <a class="code" href="../../d5/d1/obp_8h.html#a0">ObpBeginTypeSpecificCallOut</a>( SaveIrql );
01394 
01395     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (*ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o17">SecurityProcedure</a>)( Object,
01396                                                         <a class="code" href="../../d0/d5/se_8h.html#a200a109">QuerySecurityDescriptor</a>,
01397                                                         &amp;SecurityInformation,
01398                                                         *SecurityDescriptor,
01399                                                         &amp;Length,
01400                                                         &amp;ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o10">SecurityDescriptor</a>,
01401                                                         ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o9">PoolType</a>,
01402                                                         &amp;ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o4">GenericMapping</a> );
01403 
01404     <a class="code" href="../../d5/d1/obp_8h.html#a1">ObpEndTypeSpecificCallOut</a>( SaveIrql, <span class="stringliteral">"Security"</span>, ObjectType, Object );
01405 
01406     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01407 
01408         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( *SecurityDescriptor );
01409 
01410         *MemoryAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01411     }
01412 
01413     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01414 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a89" doxytag="ob.h::ObInheritDeviceMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ObInheritDeviceMap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NewProcess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ParentProcess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00343">343</a> of file <a class="el" href="../../d8/d9/obdevmap_8c-source.html">obdevmap.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00098">ObpDeviceMapLock</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00249">ObSystemDeviceMap</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00243">_DEVICE_MAP::ReferenceCount</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>.
<p>
<pre class="fragment"><div>00350                    :
00351 
00352     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called at process initialization time to inherit <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00353     device map <span class="keywordflow">for</span> a process.  If no parent process, then inherits from
00354     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system device map.
00355 
00356 Arguments:
00357 
00358     NewProcess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process being initialized that needs a <span class="keyword">new</span>
00359         dos device map
00360 
00361     ParentProcess - - Optionally specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent process whose device
00362         map we inherit.  This process <span class="keywordflow">if</span> specified must have a device map
00363 
00364 Return Value:
00365 
00366     None.
00367 
00368 --*/
00369 
00370 {
00371     <a class="code" href="../../d2/d4/struct__DEVICE__MAP.html">PDEVICE_MAP</a> DeviceMap;
00372     KIRQL OldIrql;
00373 
00374     <span class="comment">//</span>
00375     <span class="comment">//  If we are called with a parent process then grab its device map</span>
00376     <span class="comment">//  otherwise grab the system wide device map and check that is does</span>
00377     <span class="comment">//  exist</span>
00378     <span class="comment">//</span>
00379 
00380     <span class="keywordflow">if</span> (ParentProcess) {
00381 
00382         DeviceMap = ParentProcess-&gt;DeviceMap;
00383 
00384     } <span class="keywordflow">else</span> {
00385 
00386         <span class="comment">//</span>
00387         <span class="comment">//  Note: WindowStation guys may want a callout here to get the</span>
00388         <span class="comment">//  device map to use for this case.</span>
00389         <span class="comment">//</span>
00390 
00391         DeviceMap = <a class="code" href="../../d4/d0/ob_8h.html#a41">ObSystemDeviceMap</a>;
00392 
00393         <span class="keywordflow">if</span> (DeviceMap == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00394 
00395             <span class="keywordflow">return</span>;
00396         }
00397     }
00398 
00399     <span class="comment">//</span>
00400     <span class="comment">//  With the device map bumps its reference count and add it to the</span>
00401     <span class="comment">//  new process</span>
00402     <span class="comment">//</span>
00403 
00404     ExAcquireSpinLock( &amp;ObpDeviceMapLock, &amp;OldIrql );
00405 
00406     DeviceMap-&gt;<a class="code" href="../../d2/d4/struct__DEVICE__MAP.html#o0">ReferenceCount</a>++;
00407     NewProcess-&gt;DeviceMap = DeviceMap;
00408 
00409     ExReleaseSpinLock( &amp;ObpDeviceMapLock, OldIrql );
00410 
00411     <span class="keywordflow">return</span>;
00412 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a64" doxytag="ob.h::ObInitProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObInitProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> ParentProcess&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NewProcess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/obinit_8c-source.html#l00815">815</a> of file <a class="el" href="../../d1/d0/obinit_8c-source.html">obinit.c</a>.
<p>
References <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00457">ExCreateHandleTable()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00765">ExDupHandleTable()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00623">Executive</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00634">ExEnumHandleTable()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00178">KeReleaseMutant()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a180">MaxPoolType</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00759">ObAuditInheritedHandleProcedure()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00658">ObDupHandleProcedure()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00201">_EPROCESS::ObjectTable</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00034">ObpInitKillMutant</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00305">_SE_PROCESS_AUDIT_INFO::Parent</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00304">_SE_PROCESS_AUDIT_INFO::Process</a>, <a class="el" href="../../d0/d5/se_8h.html#a31">SE_PROCESS_AUDIT_INFO</a>, and <a class="el" href="../../d1/d4/se_8h-source.html#l01709">SeDetailedAuditing</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>.
<p>
<pre class="fragment"><div>00822                    :
00823 
00824     This function initializes a process object table.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ParentProcess
00825     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified, then all object handles with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> OBJ_INHERIT attribute are
00826     copied from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent object table to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> process' object table.
00827     The HandleCount field of each object copied <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incremented by one.  Both
00828     object table mutexes remained locked <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> duration of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> copy
00829     operation.
00830 
00831 Arguments:
00832 
00833     ParentProcess - optional pointer to a process object that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00834         parent process to inherit object handles from.
00835 
00836     NewProcess - pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process object being initialized.
00837 
00838 Return Value:
00839 
00840     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> code.
00841 
00842     The following errors can occur:
00843 
00844     - insufficient memory
00845 
00846 --*/
00847 
00848 {
00849     <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html">PHANDLE_TABLE</a> OldObjectTable;
00850     <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html">PHANDLE_TABLE</a> NewObjectTable;
00851     ULONG PoolCharges[ <a class="code" href="../../d5/d8/ex_8h.html#a329a180">MaxPoolType</a> ];
00852     <a class="code" href="../../d3/d0/struct__SE__PROCESS__AUDIT__INFO.html">SE_PROCESS_AUDIT_INFO</a> ProcessAuditInfo;
00853 
00854     RtlZeroMemory( PoolCharges, <span class="keyword">sizeof</span>( PoolCharges ) );
00855 
00856     <span class="comment">//</span>
00857     <span class="comment">//  If we have a parent process then we need to lock it down</span>
00858     <span class="comment">//  check that it is not going away and then make a copy</span>
00859     <span class="comment">//  of its handle table.  If there isn't a parent then</span>
00860     <span class="comment">//  we'll start with an empty handle table.</span>
00861     <span class="comment">//</span>
00862 
00863     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ParentProcess )) {
00864 
00865         <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
00866         <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>( &amp;ObpInitKillMutant,
00867                                Executive,
00868                                KernelMode,
00869                                FALSE,
00870                                NULL );
00871 
00872         OldObjectTable = ParentProcess-&gt;ObjectTable;
00873 
00874         <span class="keywordflow">if</span> ( !OldObjectTable ) {
00875 
00876             <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a>( &amp;ObpInitKillMutant, 0, FALSE, FALSE );
00877             <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00878 
00879             <span class="keywordflow">return</span> STATUS_PROCESS_IS_TERMINATING;
00880         }
00881 
00882         NewObjectTable = <a class="code" href="../../d5/d8/ex_8h.html#a294">ExDupHandleTable</a>( NewProcess,
00883                                            OldObjectTable,
00884                                            ObDupHandleProcedure );
00885 
00886     } <span class="keywordflow">else</span> {
00887 
00888         OldObjectTable = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00889         NewObjectTable = <a class="code" href="../../d5/d8/ex_8h.html#a290">ExCreateHandleTable</a>( NewProcess );
00890     }
00891 
00892     <span class="comment">//</span>
00893     <span class="comment">//  Check that we really have a new handle table otherwise</span>
00894     <span class="comment">//  we must be out of resources</span>
00895     <span class="comment">//</span>
00896 
00897     <span class="keywordflow">if</span> (NewObjectTable) {
00898 
00899         <span class="comment">//</span>
00900         <span class="comment">//  Set the new processes object table and if we are</span>
00901         <span class="comment">//  auditing then enumerate the new table calling</span>
00902         <span class="comment">//  the audit procedure</span>
00903         <span class="comment">//</span>
00904 
00905         NewProcess-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o20">ObjectTable</a> = NewObjectTable;
00906 
00907         <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d5/se_8h.html#a106">SeDetailedAuditing</a> ) {
00908 
00909             ProcessAuditInfo.<a class="code" href="../../d3/d0/struct__SE__PROCESS__AUDIT__INFO.html#o0">Process</a> = NewProcess;
00910             ProcessAuditInfo.<a class="code" href="../../d3/d0/struct__SE__PROCESS__AUDIT__INFO.html#o1">Parent</a>  = ParentProcess;
00911 
00912             <a class="code" href="../../d5/d8/ex_8h.html#a293">ExEnumHandleTable</a>( NewObjectTable,
00913                                ObAuditInheritedHandleProcedure,
00914                                (PVOID)&amp;ProcessAuditInfo,
00915                                (PHANDLE)NULL );
00916         }
00917 
00918         <span class="comment">//</span>
00919         <span class="comment">//  Free the old table if it exists and then</span>
00920         <span class="comment">//  return our caller</span>
00921         <span class="comment">//</span>
00922 
00923         <span class="keywordflow">if</span> ( OldObjectTable ) {
00924 
00925             <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a>( &amp;ObpInitKillMutant, 0, FALSE, FALSE );
00926             <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00927         }
00928 
00929         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00930 
00931     } <span class="keywordflow">else</span> {
00932 
00933         <span class="comment">//</span>
00934         <span class="comment">//  We're out of resources to null out the new object table field,</span>
00935         <span class="comment">//  unlock the old object table, and tell our caller that this</span>
00936         <span class="comment">//  didn't work</span>
00937         <span class="comment">//</span>
00938 
00939         NewProcess-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o20">ObjectTable</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00940 
00941         <span class="keywordflow">if</span> ( OldObjectTable ) {
00942 
00943             <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a>( &amp;ObpInitKillMutant, 0, FALSE, FALSE );
00944             <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00945         }
00946 
00947         <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
00948     }
00949 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a65" doxytag="ob.h::ObInitProcess2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ObInitProcess2           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NewProcess</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/obinit_8c-source.html#l00953">953</a> of file <a class="el" href="../../d1/d0/obinit_8c-source.html">obinit.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l02975">ExSetHandleTableOrder</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00201">_EPROCESS::ObjectTable</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00282">_EPROCESS::SubSystemVersion</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>.
<p>
<pre class="fragment"><div>00959                    :
00960 
00961     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called after an image <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> has been mapped into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address
00962     space of a newly created process.  Allows <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object manager to set LIFO/FIFO
00963     ordering <span class="keywordflow">for</span> handle allocation based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SubSystemVersion number in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00964     image.
00965 
00966 Arguments:
00967 
00968     NewProcess - pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process object being initialized.
00969 
00970 Return Value:
00971 
00972     None.
00973 
00974 --*/
00975 
00976 {
00977     <span class="comment">//</span>
00978     <span class="comment">//  Set LIFO ordering of handles for images &lt;= SubSystemVersion 3.50</span>
00979     <span class="comment">//</span>
00980 
00981     <span class="keywordflow">if</span> (NewProcess-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o20">ObjectTable</a>) {
00982 
00983         <a class="code" href="../../d5/d8/ex_8h.html#a78">ExSetHandleTableOrder</a>( NewProcess-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o20">ObjectTable</a>, (BOOLEAN)(NewProcess-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o71">SubSystemVersion</a> &lt;= 0x332) );
00984     }
00985 
00986     <span class="keywordflow">return</span>;
00987 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a63" doxytag="ob.h::ObInitSystem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN ObInitSystem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">117</a> of file <a class="el" href="../../d1/d0/obinit_8c-source.html">obinit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00313">_OBJECT_HEADER::Body</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00331">_OBJECT_HEADER_NAME_INFO::Directory</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00457">ExCreateHandleTable()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00408">ExInitializeNPagedLookasideList()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00209">ExInitializeResourceLite()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d9/d0/init_8h-source.html#l00070">InitializationPhase</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01066">KeInitializeEvent</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00040">KeInitializeMutant()</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00755">_NPAGED_LOOKASIDE_LIST::L</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d8/ex_8h.html#a331a200">LookasideCreateInfoList</a>, <a class="el" href="../../d5/d8/ex_8h.html#a331a201">LookasideNameBufferList</a>, <a class="el" href="../../d2/d1/mm_8h.html#a140">MM_SYSTEMSIZE</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l03087">MmIsThisAnNtAsSystem()</a>, <a class="el" href="../../d2/d1/mm_8h.html#a343a167">MmLargeSystem</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l03073">MmQuerySystemSize()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00332">_OBJECT_HEADER_NAME_INFO::Name</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d8/ex_8h.html#a104">NPAGED_LOOKASIDE_LIST</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00032">NtCreateDirectoryObject()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00368">OBJECT_HEADER_TO_NAME_INFO</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00390">OBJECT_NAME_BUFFER_SIZE</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00071">ObpAuditBaseDirectories</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00072">ObpAuditBaseObjects</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l01349">ObpCreateDosDevicesDirectory()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00384">ObpCreateInfoLookasideList</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00088">ObpDefaultObject</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00904">ObpDeleteSymbolicLink()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00098">ObpDeviceMapLock</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00034">ObpDirectoryMapping</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00367">ObpDirectoryObjectType</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00189">ObpEnterRootDirectoryMutex</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00034">ObpInitKillMutant</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00118">ObpInitSecurityDescriptorCache()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00903">ObpInsertDirectoryEntry()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00399">ObpKernelHandleTable</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00202">ObpLeaveRootDirectoryMutex</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00087">ObpLock</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00705">ObpLookupDirectoryEntry()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00392">ObpNameBufferLookasideList</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00501">ObpParseSymbolicLink()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00090">ObpRemoveObjectQueue</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00377">ObpRootDirectoryMutex</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00046">ObpRootDirectoryObject</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00047">ObpSymbolicLinkMapping</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00368">ObpSymbolicLinkObjectType</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00371">ObpTypeDirectoryObject</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00027">ObpTypeMapping</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00047">ObpTypeObjectType</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00114">_EPROCESS_QUOTA_BLOCK::PagefileLimit</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00046">PspDefaultQuotaBlock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00107">_EPROCESS_QUOTA_BLOCK::QuotaLock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00111">_EPROCESS_QUOTA_BLOCK::QuotaPoolLimit</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00108">_EPROCESS_QUOTA_BLOCK::ReferenceCount</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l01849">RtlAddAuditAccessAce()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l00099">RtlCreateAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01945">RtlCreateSecurityDescriptor()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l00996">RtlGetAce()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02543">RtlSetDaclSecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02756">RtlSetSaclSecurityDescriptor()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00540">SeLengthSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01659">SePublicDefaultUnrestrictedDacl</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01652">SePublicDefaultUnrestrictedSd</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01609">SeWorldSid</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00188">_OBJECT_TYPE::TypeList</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00123                    :
00124 
00125     This function performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system initialization <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00126     manager.  The object manager data structures are <span class="keyword">self</span> describing
00127     with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root directory, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> and
00128     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> directory object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.  The initialization code then constructs
00129     these objects by hand to get <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ball rolling.
00130 
00131 Arguments:
00132 
00133     None.
00134 
00135 Return Value:
00136 
00137     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> successful and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> an error occurred.
00138 
00139     The following errors can occur:
00140 
00141     - insufficient memory
00142 
00143 --*/
00144 
00145 {
00146     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> CreateInfoMaxDepth;
00147     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> NameBufferMaxDepth;
00148     ULONG RegionSegmentSize;
00149     <a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">OBJECT_TYPE_INITIALIZER</a> ObjectTypeInitializer;
00150     UNICODE_STRING TypeTypeName;
00151     UNICODE_STRING SymbolicLinkTypeName;
00152     UNICODE_STRING DosDevicesDirectoryName;
00153     UNICODE_STRING DirectoryTypeName;
00154     UNICODE_STRING RootDirectoryName;
00155     UNICODE_STRING TypeDirectoryName;
00156     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00157     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00158     HANDLE RootDirectoryHandle;
00159     HANDLE TypeDirectoryHandle;
00160     PLIST_ENTRY Next, Head;
00161     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectTypeHeader;
00162     <a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">POBJECT_HEADER_CREATOR_INFO</a> CreatorInfo;
00163     <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a> NameInfo;
00164     <a class="code" href="../../d2/d1/mm_8h.html#a140">MM_SYSTEMSIZE</a> SystemSize;
00165     SECURITY_DESCRIPTOR AuditSd;
00166     PSECURITY_DESCRIPTOR EffectiveSd;
00167     PACL    AuditAllAcl;
00168     UCHAR   AuditAllBuffer[250];  <span class="comment">// Ample room for the ACL</span>
00169     ULONG   AuditAllLength;
00170     PACE_HEADER Ace;
00171     <a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">PNPAGED_LOOKASIDE_LIST</a> Lookaside;
00172     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00173     PKPRCB Prcb;
00174 
00175     <span class="comment">//</span>
00176     <span class="comment">//  Determine the the size of the object creation and the name buffer</span>
00177     <span class="comment">//  lookaside lists.</span>
00178     <span class="comment">//</span>
00179 
00180     SystemSize = <a class="code" href="../../d5/d1/mminit_8c.html#a57">MmQuerySystemSize</a>();
00181 
00182     <span class="keywordflow">if</span> (SystemSize == <a class="code" href="../../d2/d1/mm_8h.html#a343a167">MmLargeSystem</a>) {
00183 
00184         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d1/mminit_8c.html#a58">MmIsThisAnNtAsSystem</a>()) {
00185 
00186             CreateInfoMaxDepth = 64;
00187             NameBufferMaxDepth = 32;
00188 
00189         } <span class="keywordflow">else</span> {
00190 
00191             CreateInfoMaxDepth = 32;
00192             NameBufferMaxDepth = 16;
00193         }
00194 
00195     } <span class="keywordflow">else</span> {
00196 
00197         CreateInfoMaxDepth = 3;
00198         NameBufferMaxDepth = 3;
00199     }
00200 
00201     <span class="comment">//</span>
00202     <span class="comment">//  PHASE 0 Initialization</span>
00203     <span class="comment">//</span>
00204 
00205     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/init_8h.html#a21">InitializationPhase</a> == 0) {
00206 
00207         <span class="comment">//</span>
00208         <span class="comment">//  Initialize the object creation lookaside list.</span>
00209         <span class="comment">//</span>
00210 
00211         <a class="code" href="../../d5/d8/ex_8h.html#a246">ExInitializeNPagedLookasideList</a>( &amp;ObpCreateInfoLookasideList,
00212                                          NULL,
00213                                          NULL,
00214                                          0,
00215                                          <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">OBJECT_CREATE_INFORMATION</a>),
00216                                          'iCbO',
00217                                          CreateInfoMaxDepth );
00218 
00219         <span class="comment">//</span>
00220         <span class="comment">//  Initialize the name buffer lookaside list.</span>
00221         <span class="comment">//</span>
00222 
00223         <a class="code" href="../../d5/d8/ex_8h.html#a246">ExInitializeNPagedLookasideList</a>( &amp;ObpNameBufferLookasideList,
00224                                          NULL,
00225                                          NULL,
00226                                          0,
00227                                          OBJECT_NAME_BUFFER_SIZE,
00228                                          'mNbO',
00229                                          NameBufferMaxDepth );
00230 
00231         <span class="comment">//</span>
00232         <span class="comment">//  Initialize the system create info and name buffer lookaside lists</span>
00233         <span class="comment">//  for the current processor.</span>
00234         <span class="comment">//</span>
00235         <span class="comment">// N.B. Temporarily during the initialization of the system both</span>
00236         <span class="comment">//      lookaside list pointers in the processor block point to</span>
00237         <span class="comment">//      the same lookaside list structure. Later in initialization</span>
00238         <span class="comment">//      another lookaside list structure is allocated and filled</span>
00239         <span class="comment">//      for the per processor list.</span>
00240         <span class="comment">//</span>
00241 
00242         Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00243         Prcb-&gt;PPLookasideList[<a class="code" href="../../d5/d8/ex_8h.html#a331a200">LookasideCreateInfoList</a>].L = &amp;<a class="code" href="../../d5/d1/obp_8h.html#a52">ObpCreateInfoLookasideList</a>;
00244         Prcb-&gt;PPLookasideList[<a class="code" href="../../d5/d8/ex_8h.html#a331a200">LookasideCreateInfoList</a>].P = &amp;<a class="code" href="../../d5/d1/obp_8h.html#a52">ObpCreateInfoLookasideList</a>;
00245         Prcb-&gt;PPLookasideList[<a class="code" href="../../d5/d8/ex_8h.html#a331a201">LookasideNameBufferList</a>].<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a> = &amp;<a class="code" href="../../d5/d1/obp_8h.html#a53">ObpNameBufferLookasideList</a>;
00246         Prcb-&gt;PPLookasideList[<a class="code" href="../../d5/d8/ex_8h.html#a331a201">LookasideNameBufferList</a>].P = &amp;<a class="code" href="../../d5/d1/obp_8h.html#a53">ObpNameBufferLookasideList</a>;
00247 
00248         <span class="comment">//</span>
00249         <span class="comment">//  Initialize the object removal queue listhead.</span>
00250         <span class="comment">//</span>
00251 
00252         <a class="code" href="../../d5/d1/obp_8h.html#a36">ObpRemoveObjectQueue</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00253 
00254         <span class="comment">//</span>
00255         <span class="comment">//  Initialize security descriptor cache</span>
00256         <span class="comment">//</span>
00257 
00258         <a class="code" href="../../d8/d1/obsdata_8c.html#a13">ObpInitSecurityDescriptorCache</a>();
00259 
00260         <a class="code" href="../../d3/d5/mutntobj_8c.html#a1">KeInitializeMutant</a>( &amp;ObpInitKillMutant, FALSE );
00261         <a class="code" href="../../d4/d9/ke_8h.html#a20">KeInitializeEvent</a>( &amp;ObpDefaultObject, NotificationEvent, TRUE );
00262         <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>( &amp;ObpLock );
00263         <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;GrantedAccess = PROCESS_ALL_ACCESS;
00264         <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;GrantedAccess = THREAD_ALL_ACCESS;
00265 
00266         <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>( &amp;ObpDeviceMapLock );
00267 
00268         <span class="comment">//</span>
00269         <span class="comment">//  Initialize the quota block and have the eprocess structure</span>
00270         <span class="comment">//  point to it.</span>
00271         <span class="comment">//</span>
00272 
00273         <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>(&amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>);
00274         <a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o1">ReferenceCount</a> = 1;
00275         <a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] = (ULONG)-1;
00276         <a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] = (ULONG)-1;
00277         <a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o7">PagefileLimit</a> = (ULONG)-1;
00278 
00279         <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;QuotaBlock = &amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>;
00280 
00281         <span class="comment">//</span>
00282         <span class="comment">//  Initialize the handle table for the system process and also the global</span>
00283         <span class="comment">//  kernel handle table</span>
00284         <span class="comment">//</span>
00285 
00286         <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;ObjectTable = <a class="code" href="../../d5/d8/ex_8h.html#a290">ExCreateHandleTable</a>( NULL );
00287         <a class="code" href="../../d5/d1/obp_8h.html#a54">ObpKernelHandleTable</a> = <a class="code" href="../../d5/d8/ex_8h.html#a290">ExCreateHandleTable</a>( NULL );
00288 
00289         <span class="comment">//</span>
00290         <span class="comment">//  Create an object type for the "Type" object.  This is the start of</span>
00291         <span class="comment">//  of the object types and goes in the ObpTypeDirectoryObject.</span>
00292         <span class="comment">//</span>
00293 
00294         RtlZeroMemory( &amp;ObjectTypeInitializer, <span class="keyword">sizeof</span>( ObjectTypeInitializer ) );
00295         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o0">Length</a> = <span class="keyword">sizeof</span>( ObjectTypeInitializer );
00296         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o3">InvalidAttributes</a> = OBJ_OPENLINK;
00297         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o9">PoolType</a> = <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>;
00298 
00299         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;TypeTypeName, L<span class="stringliteral">"Type"</span> );
00300         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o5">ValidAccessMask</a> = OBJECT_TYPE_ALL_ACCESS;
00301         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o4">GenericMapping</a> = <a class="code" href="../../d0/d1/obinit_8c.html#a0">ObpTypeMapping</a>;
00302         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o11">DefaultNonPagedPoolCharge</a> = <span class="keyword">sizeof</span>( <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">OBJECT_TYPE</a> );
00303         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o8">MaintainTypeList</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00304         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o1">UseDefaultObject</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00305         <a class="code" href="../../d0/d2/obtype_8c.html#a2">ObCreateObjectType</a>( &amp;TypeTypeName,
00306                             &amp;ObjectTypeInitializer,
00307                             (PSECURITY_DESCRIPTOR)NULL,
00308                             &amp;ObpTypeObjectType );
00309 
00310         <span class="comment">//</span>
00311         <span class="comment">//  Create the object type for the "Directory" object.</span>
00312         <span class="comment">//</span>
00313 
00314         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;DirectoryTypeName, L<span class="stringliteral">"Directory"</span> );
00315         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o11">DefaultNonPagedPoolCharge</a> = <span class="keyword">sizeof</span>( <a class="code" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">OBJECT_DIRECTORY</a> );
00316         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o5">ValidAccessMask</a> = DIRECTORY_ALL_ACCESS;
00317         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o4">GenericMapping</a> = <a class="code" href="../../d0/d1/obinit_8c.html#a1">ObpDirectoryMapping</a>;
00318         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o1">UseDefaultObject</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00319         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o8">MaintainTypeList</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00320         <a class="code" href="../../d0/d2/obtype_8c.html#a2">ObCreateObjectType</a>( &amp;DirectoryTypeName,
00321                             &amp;ObjectTypeInitializer,
00322                             (PSECURITY_DESCRIPTOR)NULL,
00323                             &amp;ObpDirectoryObjectType );
00324 
00325         <span class="comment">//</span>
00326         <span class="comment">//  Create the object type for the "SymbolicLink" object.</span>
00327         <span class="comment">//</span>
00328 
00329         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;SymbolicLinkTypeName, L<span class="stringliteral">"SymbolicLink"</span> );
00330         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o11">DefaultNonPagedPoolCharge</a> = <span class="keyword">sizeof</span>( <a class="code" href="../../d2/d6/struct__OBJECT__SYMBOLIC__LINK.html">OBJECT_SYMBOLIC_LINK</a> );
00331         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o5">ValidAccessMask</a> = SYMBOLIC_LINK_ALL_ACCESS;
00332         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o4">GenericMapping</a> = <a class="code" href="../../d0/d1/obinit_8c.html#a2">ObpSymbolicLinkMapping</a>;
00333         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o15">DeleteProcedure</a> = <a class="code" href="../../d4/d1/oblink_8c.html#a9">ObpDeleteSymbolicLink</a>;
00334         ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o16">ParseProcedure</a> = <a class="code" href="../../d4/d1/oblink_8c.html#a8">ObpParseSymbolicLink</a>;
00335         <a class="code" href="../../d0/d2/obtype_8c.html#a2">ObCreateObjectType</a>( &amp;SymbolicLinkTypeName,
00336                             &amp;ObjectTypeInitializer,
00337                             (PSECURITY_DESCRIPTOR)NULL,
00338                             &amp;ObpSymbolicLinkObjectType );
00339 
00340         <span class="comment">//</span>
00341         <span class="comment">//  Initialize the resource that protects the object name space directory structure</span>
00342         <span class="comment">//</span>
00343 
00344         <a class="code" href="../../d5/d8/ex_8h.html#a266">ExInitializeResourceLite</a>( &amp;ObpRootDirectoryMutex );
00345 
00346 <span class="preprocessor">#if i386 &amp;&amp; !FPO</span>
00347 <span class="preprocessor"></span>
00348         <span class="comment">//</span>
00349         <span class="comment">//  Initialize the cached granted access structure.  These variables are used</span>
00350         <span class="comment">//  in place of the access mask in the object table entry.</span>
00351         <span class="comment">//</span>
00352 
00353         ObpCurCachedGrantedAccessIndex = 0;
00354         ObpMaxCachedGrantedAccessIndex = <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> / <span class="keyword">sizeof</span>( ACCESS_MASK );
00355         ObpCachedGrantedAccesses = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( NonPagedPool, PAGE_SIZE, 'gAbO' );
00356 
00357 <span class="preprocessor">#endif // i386 &amp;&amp; !FPO</span>
00358 <span class="preprocessor"></span>
00359     } <span class="comment">// End of Phase 0 Initialization</span>
00360 
00361 
00362     <span class="comment">//</span>
00363     <span class="comment">//  PHASE 1 Initialization</span>
00364     <span class="comment">//</span>
00365 
00366     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/init_8h.html#a21">InitializationPhase</a> == 1) {
00367 
00368         <span class="comment">//</span>
00369         <span class="comment">//  Initialize the per processor nonpaged lookaside lists and descriptors.</span>
00370         <span class="comment">//</span>
00371 
00372         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; (ULONG)<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00373             Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00374 
00375             <span class="comment">//</span>
00376             <span class="comment">//  Initialize the create information per processor lookaside pointers.</span>
00377             <span class="comment">//</span>
00378 
00379             Prcb-&gt;PPLookasideList[<a class="code" href="../../d5/d8/ex_8h.html#a331a200">LookasideCreateInfoList</a>].L = &amp;<a class="code" href="../../d5/d1/obp_8h.html#a52">ObpCreateInfoLookasideList</a>;
00380             Lookaside = (<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">PNPAGED_LOOKASIDE_LIST</a>)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( NonPagedPool,
00381                                                                        <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">NPAGED_LOOKASIDE_LIST</a>),
00382                                                                        'ICbO');
00383 
00384             <span class="keywordflow">if</span> (Lookaside != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00385                 <a class="code" href="../../d5/d8/ex_8h.html#a246">ExInitializeNPagedLookasideList</a>( Lookaside,
00386                                                  NULL,
00387                                                  NULL,
00388                                                  0,
00389                                                  <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/struct__OBJECT__CREATE__INFORMATION.html">OBJECT_CREATE_INFORMATION</a>),
00390                                                  'ICbO',
00391                                                  CreateInfoMaxDepth );
00392 
00393             } <span class="keywordflow">else</span> {
00394                 Lookaside = &amp;<a class="code" href="../../d5/d1/obp_8h.html#a52">ObpCreateInfoLookasideList</a>;
00395             }
00396 
00397             Prcb-&gt;PPLookasideList[<a class="code" href="../../d5/d8/ex_8h.html#a331a200">LookasideCreateInfoList</a>].P = Lookaside;
00398 
00399             <span class="comment">//</span>
00400             <span class="comment">//  Initialize the name buffer per processor lookaside pointers.</span>
00401             <span class="comment">//</span>
00402 
00403             Prcb-&gt;PPLookasideList[<a class="code" href="../../d5/d8/ex_8h.html#a331a201">LookasideNameBufferList</a>].<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html#o0">L</a> = &amp;<a class="code" href="../../d5/d1/obp_8h.html#a53">ObpNameBufferLookasideList</a>;
00404             Lookaside = (<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">PNPAGED_LOOKASIDE_LIST</a>)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( NonPagedPool,
00405                                                                        <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">NPAGED_LOOKASIDE_LIST</a>),
00406                                                                        'MNbO');
00407 
00408             <span class="keywordflow">if</span> (Lookaside != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00409                 <a class="code" href="../../d5/d8/ex_8h.html#a246">ExInitializeNPagedLookasideList</a>( Lookaside,
00410                                                  NULL,
00411                                                  NULL,
00412                                                  0,
00413                                                  OBJECT_NAME_BUFFER_SIZE,
00414                                                  'MNbO',
00415                                                  NameBufferMaxDepth);
00416 
00417             } <span class="keywordflow">else</span> {
00418                 Lookaside = &amp;<a class="code" href="../../d5/d1/obp_8h.html#a53">ObpNameBufferLookasideList</a>;
00419             }
00420 
00421             Prcb-&gt;PPLookasideList[<a class="code" href="../../d5/d8/ex_8h.html#a331a201">LookasideNameBufferList</a>].P = Lookaside;
00422         }
00423 
00424         EffectiveSd = <a class="code" href="../../d0/d5/se_8h.html#a68">SePublicDefaultUnrestrictedSd</a>;
00425 
00426         <span class="comment">//</span>
00427         <span class="comment">//  This code is only executed if base auditing is turned on.</span>
00428         <span class="comment">//</span>
00429 
00430         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d0/cmdat3_8c.html#a15">ObpAuditBaseDirectories</a> != 0) || (<a class="code" href="../../d8/d0/cmdat3_8c.html#a16">ObpAuditBaseObjects</a> != 0)) {
00431 
00432             <span class="comment">//</span>
00433             <span class="comment">//  build an SACL to audit</span>
00434             <span class="comment">//</span>
00435 
00436             AuditAllAcl = (PACL)AuditAllBuffer;
00437             AuditAllLength = (ULONG)<span class="keyword">sizeof</span>(ACL) +
00438                                ((ULONG)<span class="keyword">sizeof</span>(SYSTEM_AUDIT_ACE)) +
00439                                <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>(SeWorldSid);
00440 
00441             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <span class="keyword">sizeof</span>(AuditAllBuffer)   &gt;   AuditAllLength );
00442 
00443             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d4/acledit_8c.html#a6">RtlCreateAcl</a>( AuditAllAcl, AuditAllLength, ACL_REVISION2);
00444 
00445             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00446 
00447             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d4/acledit_8c.html#a20">RtlAddAuditAccessAce</a> ( AuditAllAcl,
00448                                             ACL_REVISION2,
00449                                             GENERIC_ALL,
00450                                             SeWorldSid,
00451                                             TRUE,  TRUE ); <span class="comment">//Audit success and failure</span>
00452             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00453 
00454             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d4/acledit_8c.html#a12">RtlGetAce</a>( AuditAllAcl, 0,  (PVOID)&amp;Ace );
00455 
00456             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00457 
00458             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/cmdat3_8c.html#a15">ObpAuditBaseDirectories</a> != 0) {
00459 
00460                 Ace-&gt;AceFlags |= (CONTAINER_INHERIT_ACE | INHERIT_ONLY_ACE);
00461             }
00462 
00463             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/cmdat3_8c.html#a16">ObpAuditBaseObjects</a> != 0) {
00464 
00465                 Ace-&gt;AceFlags |= (OBJECT_INHERIT_ACE    |
00466                                   CONTAINER_INHERIT_ACE |
00467                                   INHERIT_ONLY_ACE);
00468             }
00469 
00470             <span class="comment">//</span>
00471             <span class="comment">//  Now create a security descriptor that looks just like</span>
00472             <span class="comment">//  the public default, but has auditing in it as well.</span>
00473             <span class="comment">//</span>
00474 
00475             EffectiveSd = (PSECURITY_DESCRIPTOR)&amp;AuditSd;
00476             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a53">RtlCreateSecurityDescriptor</a>( EffectiveSd,
00477                                                   SECURITY_DESCRIPTOR_REVISION1 );
00478 
00479             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00480 
00481             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a60">RtlSetDaclSecurityDescriptor</a>( EffectiveSd,
00482                                                    TRUE,        <span class="comment">// DaclPresent</span>
00483                                                    SePublicDefaultUnrestrictedDacl,
00484                                                    FALSE );     <span class="comment">// DaclDefaulted</span>
00485 
00486             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00487 
00488             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a62">RtlSetSaclSecurityDescriptor</a>( EffectiveSd,
00489                                                    TRUE,        <span class="comment">// DaclPresent</span>
00490                                                    AuditAllAcl,
00491                                                    FALSE );     <span class="comment">// DaclDefaulted</span>
00492 
00493             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00494         }
00495 
00496         <span class="comment">//</span>
00497         <span class="comment">//  We only need to use the EffectiveSd on the root.  The SACL</span>
00498         <span class="comment">//  will be inherited by all other objects.</span>
00499         <span class="comment">//</span>
00500 
00501         <span class="comment">//</span>
00502         <span class="comment">//  Create an directory object for the root directory</span>
00503         <span class="comment">//</span>
00504 
00505         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RootDirectoryName, L<span class="stringliteral">"\\"</span> );
00506 
00507         InitializeObjectAttributes( &amp;ObjectAttributes,
00508                                     &amp;RootDirectoryName,
00509                                     OBJ_CASE_INSENSITIVE |
00510                                     OBJ_PERMANENT,
00511                                     NULL,
00512                                     EffectiveSd );
00513 
00514         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;RootDirectoryHandle,
00515                                           DIRECTORY_ALL_ACCESS,
00516                                           &amp;ObjectAttributes );
00517 
00518         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00519 
00520             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00521         }
00522 
00523         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>( RootDirectoryHandle,
00524                                             0,
00525                                             ObpDirectoryObjectType,
00526                                             KernelMode,
00527                                             (PVOID *)&amp;ObpRootDirectoryObject,
00528                                             NULL );
00529 
00530         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00531 
00532             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00533         }
00534 
00535         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( RootDirectoryHandle );
00536 
00537         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00538 
00539             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00540         }
00541 
00542         <span class="comment">//</span>
00543         <span class="comment">//  Create an directory object for the directory of object types</span>
00544         <span class="comment">//</span>
00545 
00546         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;TypeDirectoryName, L<span class="stringliteral">"\\ObjectTypes"</span> );
00547 
00548         InitializeObjectAttributes( &amp;ObjectAttributes,
00549                                     &amp;TypeDirectoryName,
00550                                     OBJ_CASE_INSENSITIVE |
00551                                     OBJ_PERMANENT,
00552                                     NULL,
00553                                     NULL );
00554 
00555         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d0/obdir_8c.html#a0">NtCreateDirectoryObject</a>( &amp;TypeDirectoryHandle,
00556                                           DIRECTORY_ALL_ACCESS,
00557                                           &amp;ObjectAttributes );
00558 
00559         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00560 
00561             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00562         }
00563 
00564         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>( TypeDirectoryHandle,
00565                                             0,
00566                                             ObpDirectoryObjectType,
00567                                             KernelMode,
00568                                             (PVOID *)&amp;ObpTypeDirectoryObject,
00569                                             NULL );
00570 
00571         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00572 
00573             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00574         }
00575 
00576         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( TypeDirectoryHandle );
00577 
00578         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00579 
00580             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00581         }
00582 
00583         <span class="comment">//</span>
00584         <span class="comment">//  Lock the object directory name space</span>
00585         <span class="comment">//</span>
00586 
00587         <a class="code" href="../../d5/d1/obp_8h.html#a10">ObpEnterRootDirectoryMutex</a>();
00588 
00589         <span class="comment">//</span>
00590         <span class="comment">//  For every object type that has already been created we will</span>
00591         <span class="comment">//  insert it in the type directory.  We do this looking down the</span>
00592         <span class="comment">//  linked list of type objects and for every one that has a name</span>
00593         <span class="comment">//  and isn't already in a directory we'll look the name up and</span>
00594         <span class="comment">//  then put it in the directory.  Be sure to skip the first</span>
00595         <span class="comment">//  entry in the type object types lists.</span>
00596         <span class="comment">//</span>
00597 
00598         Head = &amp;<a class="code" href="../../d8/d5/kddata_8c.html#a10">ObpTypeObjectType</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o1">TypeList</a>;
00599         Next = Head-&gt;Flink;
00600 
00601         <span class="keywordflow">while</span> (Next != Head) {
00602 
00603             <span class="comment">//</span>
00604             <span class="comment">//  Right after the creator info is the object header.  Get\</span>
00605             <span class="comment">//  the object header and then see if there is a name</span>
00606             <span class="comment">//</span>
00607 
00608             CreatorInfo = CONTAINING_RECORD( Next,
00609                                              <a class="code" href="../../d7/d5/struct__OBJECT__HEADER__CREATOR__INFO.html">OBJECT_HEADER_CREATOR_INFO</a>,
00610                                              TypeList );
00611 
00612             ObjectTypeHeader = (<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a>)(CreatorInfo+1);
00613 
00614             NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectTypeHeader );
00615 
00616             <span class="comment">//</span>
00617             <span class="comment">//  Check if we have a name and we're not in a directory</span>
00618             <span class="comment">//</span>
00619 
00620 
00621             <span class="keywordflow">if</span> ((NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00622 
00623                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d1/obp_8h.html#a68">ObpLookupDirectoryEntry</a>( ObpTypeDirectoryObject,
00624                                               &amp;NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>,
00625                                               OBJ_CASE_INSENSITIVE )) {
00626 
00627                     <a class="code" href="../../d5/d1/obp_8h.html#a69">ObpInsertDirectoryEntry</a>( ObpTypeDirectoryObject,
00628                                              &amp;ObjectTypeHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o11">Body</a> );
00629                 }
00630             }
00631 
00632             Next = Next-&gt;Flink;
00633         }
00634 
00635         <span class="comment">//</span>
00636         <span class="comment">//  Unlock the object directory name space</span>
00637         <span class="comment">//</span>
00638 
00639         <a class="code" href="../../d5/d1/obp_8h.html#a11">ObpLeaveRootDirectoryMutex</a>();
00640 
00641         <span class="comment">//</span>
00642         <span class="comment">//  Create \DosDevices object directory for drive letters and Win32 device names</span>
00643         <span class="comment">//</span>
00644 
00645         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d1/obinit_8c.html#a14">ObpCreateDosDevicesDirectory</a>();
00646 
00647         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00648 
00649             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00650         }
00651     }
00652 
00653     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00654 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a71" doxytag="ob.h::ObInsertObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS ObInsertObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> PassedAccessState&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK DesiredAccess&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectPointerBias</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *NewObject&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a66" doxytag="ob.h::ObKillProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ObKillProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AcquireLock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/obinit_8c-source.html#l01022">1022</a> of file <a class="el" href="../../d1/d0/obinit_8c-source.html">obinit.c</a>.
<p>
References <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00560">ExDestroyHandleTable()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00623">Executive</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10281">IoSetThreadHardErrorMode()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00178">KeReleaseMutant()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00991">ObDestroyHandleProcedure()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00201">_EPROCESS::ObjectTable</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00034">ObpInitKillMutant</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00071">ObpValidateIrql</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01232">PspExitProcess()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>.
<p>
<pre class="fragment"><div>01028                    :
01029 
01030     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called whenever a process <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> destroyed.  It loops over
01031     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process' object table and closes all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handles.
01032 
01033 Arguments:
01034 
01035     AcquireLock - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> there are other pointers to <span class="keyword">this</span> process and therefore
01036         <span class="keyword">this</span> operation needs to be <span class="keyword">synchronized</span>.  False <span class="keywordflow">if</span> <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being called
01037         from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Process <span class="keyword">delete</span> routine and therefore <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> pointer
01038         to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process.
01039 
01040     Process - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being destroyed.
01041 
01042 Return Value:
01043 
01044     None.
01045 
01046 --*/
01047 
01048 {
01049     PVOID ObjectTable;
01050     BOOLEAN PreviousIOHardError;
01051 
01052     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01053 
01054     <a class="code" href="../../d5/d1/obp_8h.html#a2">ObpValidateIrql</a>( <span class="stringliteral">"ObKillProcess"</span> );
01055 
01056     <span class="comment">//</span>
01057     <span class="comment">//  Check if we need to get the lock</span>
01058     <span class="comment">//</span>
01059 
01060     <span class="keywordflow">if</span> (AcquireLock) {
01061 
01062         <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
01063 
01064         <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>( &amp;ObpInitKillMutant,
01065                                Executive,
01066                                KernelMode,
01067                                FALSE,
01068                                NULL );
01069     }
01070 
01071     <span class="comment">//</span>
01072     <span class="comment">//  If the process does NOT have an object table, return</span>
01073     <span class="comment">//</span>
01074 
01075     ObjectTable = Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o20">ObjectTable</a>;
01076 
01077     <span class="keywordflow">if</span> (ObjectTable != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01078         
01079         PreviousIOHardError = <a class="code" href="../../d4/d6/iosubs_8c.html#a108">IoSetThreadHardErrorMode</a>(FALSE); 
01080         
01081         <span class="comment">//</span>
01082         <span class="comment">//  For each valid entry in the object table, close the handle</span>
01083         <span class="comment">//  that points to that entry.</span>
01084         <span class="comment">//</span>
01085 
01086         <a class="code" href="../../d5/d8/ex_8h.html#a292">ExDestroyHandleTable</a>( ObjectTable, ObDestroyHandleProcedure );
01087 
01088         Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o20">ObjectTable</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01089         
01090         <a class="code" href="../../d4/d6/iosubs_8c.html#a108">IoSetThreadHardErrorMode</a>( PreviousIOHardError ); 
01091     }
01092 
01093     <span class="comment">//</span>
01094     <span class="comment">//  Release the lock</span>
01095     <span class="comment">//</span>
01096 
01097     <span class="keywordflow">if</span> (AcquireLock) {
01098 
01099         <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a>( &amp;ObpInitKillMutant, 0, FALSE, FALSE );
01100 
01101         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
01102     }
01103 
01104     <span class="comment">//</span>
01105     <span class="comment">//  And return to our caller</span>
01106     <span class="comment">//</span>
01107 
01108     <span class="keywordflow">return</span>;
01109 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a76" doxytag="ob.h::ObMakeTemporaryObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID ObMakeTemporaryObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Object</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d9/obclose_8c-source.html#l00484">484</a> of file <a class="el" href="../../d6/d9/obclose_8c-source.html">obclose.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00306">_OBJECT_HEADER::Flags</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00351">OB_FLAG_PERMANENT_OBJECT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01497">ObpDeleteNameCheck()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01071">IoCreateDriver()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05951">IoDeleteDevice()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l00657">IopCompleteUnloadOrDelete()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02327">IopInitializeBootDrivers()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02812">IopInitializeBuiltinDriver()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00414">NtMakeTemporaryObject()</a>, and <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00244">NtUnloadDriver()</a>.
<p>
<pre class="fragment"><div>00490                    :
00491 
00492     This routine removes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object from its parent
00493     directory.  The object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> removed <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> has a non zero
00494     handle count and a name.  Otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> simply
00495     <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> non permanent
00496 
00497 Arguments:
00498 
00499     Object - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being modified
00500 
00501 Return Value:
00502 
00503     None.
00504 
00505 --*/
00506 
00507 {
00508     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00509 
00510     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00511 
00512     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
00513     ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> &amp;= ~<a class="code" href="../../d4/d0/ob_8h.html#a5">OB_FLAG_PERMANENT_OBJECT</a>;
00514 
00515     <a class="code" href="../../d7/d1/obref_8c.html#a11">ObpDeleteNameCheck</a>( Object, FALSE );
00516 
00517     <span class="keywordflow">return</span>;
00518 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a73" doxytag="ob.h::ObOpenObjectByName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS ObOpenObjectByName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN POBJECT_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectAttributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> PassedAccessState&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK DesiredAccess&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID ParseContext&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a74" doxytag="ob.h::ObOpenObjectByPointer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS ObOpenObjectByPointer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleAttributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> PassedAccessState&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK DesiredAccess&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/obref_8c-source.html#l00367">367</a> of file <a class="el" href="../../d8/d0/obref_8c-source.html">obref.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00168">_OBJECT_TYPE_INITIALIZER::GenericMapping</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00167">_OBJECT_TYPE_INITIALIZER::InvalidAttributes</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d4/d0/ob_8h.html#a100a59">ObOpenHandle</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l02160">ObpCreateHandle()</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00071">ObpValidateIrql</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01022">ObReferenceObjectByPointer()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00180">SeCreateAccessState()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00348">SeDeleteAccessState()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00196">_OBJECT_TYPE::TypeInfo</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/ex_8c-source.html#l00131">CreateSystemThread()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l04710">IopInvalidateVolumesForDevice()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l00297">NtCreatePagingFile()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00030">NtOpenProcess()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00178">NtOpenProcessToken()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00280">NtOpenThread()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01235">NtUserOpenInputDesktop()</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00187">obtest()</a>, <a class="el" href="../../d1/d0/base_8c-source.html#l00102">UserBeep()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01654">xxxCreateDisconnectDesktop()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04821">xxxResolveDesktop()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l05713">xxxSetCsrssThreadDesktop()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l03358">xxxSwitchDesktop()</a>.
<p>
<pre class="fragment"><div>00379                    :
00380 
00381     This routine opens an object referenced by a pointer.
00382 
00383 Arguments:
00384 
00385     Object - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being opened.
00386 
00387     HandleAttributes - The desired attributes <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle, such
00388         as OBJ_INHERIT, OBJ_PERMANENT, OBJ_EXCLUSIVE, OBJ_CASE_INSENSITIVE,
00389         OBJ_OPENIF, and OBJ_OPENLINK
00390 
00391     PassedAccessState - Supplies an optional pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current access
00392         status describing already granted access types, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privileges used
00393         to get them, and any access types yet to be granted.
00394 
00395     DesiredAcess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.
00396 
00397     ObjectType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being opened
00398 
00399     AccessMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access.
00400 
00401     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - Supplies a pointer to a variable that receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle value.
00402 
00403 Return Value:
00404 
00405     An appropriate <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> value
00406 
00407 --*/
00408 
00409 {
00410     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00411     HANDLE NewHandle;
00412     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00413     <a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">ACCESS_STATE</a> LocalAccessState;
00414     <a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00415     <a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">AUX_ACCESS_DATA</a> AuxData;
00416 
00417     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00418 
00419     <a class="code" href="../../d5/d1/obp_8h.html#a2">ObpValidateIrql</a>( <span class="stringliteral">"ObOpenObjectByPointer"</span> );
00420 
00421     <span class="comment">//</span>
00422     <span class="comment">//  First increment the pointer count for the object.  This routine</span>
00423     <span class="comment">//  also checks the object types</span>
00424     <span class="comment">//</span>
00425 
00426     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a6">ObReferenceObjectByPointer</a>( Object,
00427                                          0,
00428                                          ObjectType,
00429                                          AccessMode );
00430 
00431     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00432 
00433         <span class="comment">//</span>
00434         <span class="comment">//  Get the object header for the input object body</span>
00435         <span class="comment">//</span>
00436 
00437         ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
00438 
00439         <span class="comment">//</span>
00440         <span class="comment">//  If the caller did not pass in an access state then</span>
00441         <span class="comment">//  we will create a new one based on the desired access</span>
00442         <span class="comment">//  and the object types generic mapping</span>
00443         <span class="comment">//</span>
00444 
00445         <span class="keywordflow">if</span> (!ARGUMENT_PRESENT( PassedAccessState )) {
00446 
00447             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d5/seastate_8c.html#a2">SeCreateAccessState</a>( &amp;LocalAccessState,
00448                                           &amp;AuxData,
00449                                           DesiredAccess,
00450                                           &amp;ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o4">GenericMapping</a> );
00451 
00452             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00453 
00454                 <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Object );
00455 
00456                 <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00457             }
00458 
00459             AccessState = &amp;LocalAccessState;
00460 
00461         <span class="comment">//</span>
00462         <span class="comment">//  Otherwise the caller did specify an access state so</span>
00463         <span class="comment">//  we use the one passed in.</span>
00464         <span class="comment">//</span>
00465 
00466         } <span class="keywordflow">else</span> {
00467 
00468             AccessState = PassedAccessState;
00469         }
00470 
00471         <span class="comment">//</span>
00472         <span class="comment">//  Make sure the caller is asking for handle attributes that are</span>
00473         <span class="comment">//  valid for the given object type</span>
00474         <span class="comment">//</span>
00475 
00476         <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o3">InvalidAttributes</a> &amp; HandleAttributes) {
00477 
00478             <span class="keywordflow">if</span> (AccessState == &amp;LocalAccessState) {
00479 
00480                 <a class="code" href="../../d2/d5/seastate_8c.html#a3">SeDeleteAccessState</a>( AccessState );
00481             }
00482 
00483             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Object );
00484 
00485             <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00486         }
00487 
00488         <span class="comment">//</span>
00489         <span class="comment">//  We've referenced the object and have an access state to give</span>
00490         <span class="comment">//  the new handle so now create a new handle for the object.</span>
00491         <span class="comment">//</span>
00492 
00493         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d1/obp_8h.html#a79">ObpCreateHandle</a>( ObOpenHandle,
00494                                   Object,
00495                                   ObjectType,
00496                                   AccessState,
00497                                   0,
00498                                   HandleAttributes,
00499                                   FALSE,
00500                                   AccessMode,
00501                                   (PVOID *)NULL,
00502                                   &amp;NewHandle );
00503 
00504         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00505 
00506             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Object );
00507         }
00508     }
00509 
00510     <span class="comment">//</span>
00511     <span class="comment">//  If we successfully opened by object and created a new handle</span>
00512     <span class="comment">//  then set the output variable correctly</span>
00513     <span class="comment">//</span>
00514 
00515     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00516 
00517         *<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = NewHandle;
00518 
00519     } <span class="keywordflow">else</span> {
00520 
00521         *<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00522     }
00523 
00524     <span class="comment">//</span>
00525     <span class="comment">//  Check if we used our own access state and now need to cleanup</span>
00526     <span class="comment">//</span>
00527 
00528     <span class="keywordflow">if</span> (AccessState == &amp;LocalAccessState) {
00529 
00530         <a class="code" href="../../d2/d5/seastate_8c.html#a3">SeDeleteAccessState</a>( AccessState );
00531     }
00532 
00533     <span class="comment">//</span>
00534     <span class="comment">//  And return to our caller</span>
00535     <span class="comment">//</span>
00536 
00537     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00538 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a88" doxytag="ob.h::ObQueryDeviceMapInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObQueryDeviceMapInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetProcess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PPROCESS_DEVICEMAP_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceMapInformation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00236">236</a> of file <a class="el" href="../../d8/d9/obdevmap_8c-source.html">obdevmap.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00245">_DEVICE_MAP::DriveMap</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00098">ObpDeviceMapLock</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00249">ObSystemDeviceMap</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l00531">NtQueryInformationProcess()</a>.
<p>
<pre class="fragment"><div>00243                    :
00244 
00245     This function queries information from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device map associated with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00246     specified process.  The returned information contains a bit map indicating
00247     which drive letters are defined in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> associated object directory, along
00248     with an array of drive types that give <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of each drive letter.
00249 
00250 Arguments:
00251 
00252     TargetProcess - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target process to retreive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device map
00253         from.  If not specified then we <span class="keywordflow">return</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global <span class="keywordflow">default</span> device map
00254 
00255     DeviceMapInformation - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> location where to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> results.
00256 
00257 Return Value:
00258 
00259     Returns one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following status codes:
00260 
00261         STATUS_SUCCESS - normal, successful completion.
00262 
00263         STATUS_END_OF_FILE - The specified process was not associated with
00264             a device map.
00265 
00266         STATUS_ACCESS_VIOLATION - The DeviceMapInformation buffer pointer
00267             value specified an invalid address.
00268 
00269 --*/
00270 
00271 {
00272     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00273     <a class="code" href="../../d2/d4/struct__DEVICE__MAP.html">PDEVICE_MAP</a> DeviceMap;
00274     KIRQL OldIrql;
00275     PROCESS_DEVICEMAP_INFORMATION LocalMapInformation;
00276 
00277     <span class="comment">//</span>
00278     <span class="comment">//  Check if the caller gave us a target process and if not then use</span>
00279     <span class="comment">//  the globally defined one</span>
00280     <span class="comment">//</span>
00281 
00282     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( TargetProcess )) {
00283 
00284         DeviceMap = TargetProcess-&gt;DeviceMap;
00285 
00286     } <span class="keywordflow">else</span> {
00287 
00288         DeviceMap = <a class="code" href="../../d4/d0/ob_8h.html#a41">ObSystemDeviceMap</a>;
00289     }
00290 
00291     <span class="comment">//</span>
00292     <span class="comment">//  If we do not have a device map then we'll return an error otherwise</span>
00293     <span class="comment">//  we simply copy over the device map structure (bitmap and drive type</span>
00294     <span class="comment">//  array) into the output buffer</span>
00295     <span class="comment">//</span>
00296 
00297     <span class="keywordflow">if</span> (DeviceMap == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00298 
00299         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_END_OF_FILE;
00300 
00301     } <span class="keywordflow">else</span> {
00302 
00303         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00304 
00305         <span class="comment">//</span>
00306         <span class="comment">//  First, while using a spinlock to protect the device map from</span>
00307         <span class="comment">//  going away we will make local copy of the information.</span>
00308         <span class="comment">//</span>
00309 
00310         ExAcquireSpinLock( &amp;ObpDeviceMapLock, &amp;OldIrql );
00311 
00312         RtlMoveMemory( &amp;LocalMapInformation.Query,
00313                        &amp;DeviceMap-&gt;<a class="code" href="../../d2/d4/struct__DEVICE__MAP.html#o2">DriveMap</a>,
00314                        <span class="keyword">sizeof</span>( DeviceMapInformation-&gt;Query ));
00315 
00316         ExReleaseSpinLock( &amp;ObpDeviceMapLock, OldIrql );
00317 
00318         <span class="comment">//</span>
00319         <span class="comment">//  Now we can copy the information to the caller buffer using</span>
00320         <span class="comment">//  a try-except to guard against the output buffer changing.</span>
00321         <span class="comment">//  Note that the caller must have already probed the buffer</span>
00322         <span class="comment">//  for write.</span>
00323         <span class="comment">//</span>
00324 
00325         <span class="keywordflow">try</span> {
00326 
00327             RtlMoveMemory( &amp;DeviceMapInformation-&gt;Query,
00328                            &amp;LocalMapInformation.Query,
00329                            <span class="keyword">sizeof</span>( DeviceMapInformation-&gt;Query ));
00330 
00331         } except( EXCEPTION_EXECUTE_HANDLER ) {
00332 
00333             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00334         }
00335 
00336     }
00337 
00338     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00339 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a81" doxytag="ob.h::ObQueryNameString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS ObQueryNameString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT POBJECT_NAME_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectNameInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ReturnLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d0/obquery_8c-source.html#l00713">713</a> of file <a class="el" href="../../d7/d0/obquery_8c-source.html">obquery.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00331">_OBJECT_HEADER_NAME_INFO::Directory</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00332">_OBJECT_HEADER_NAME_INFO::Name</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00368">OBJECT_HEADER_TO_NAME_INFO</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00709">OBP_MISSING_NAME_LITERAL</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00710">OBP_MISSING_NAME_LITERAL_SIZE</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00056">ObpBeginTypeSpecificCallOut</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00057">ObpEndTypeSpecificCallOut</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00189">ObpEnterRootDirectoryMutex</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00202">ObpLeaveRootDirectoryMutex</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00046">ObpRootDirectoryObject</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00182">_OBJECT_TYPE_INITIALIZER::QueryNameProcedure</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d8/talloc_8c-source.html#l00027">String</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00196">_OBJECT_TYPE::TypeInfo</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l00373">IoGetDeviceProperty()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l02034">IopBuildCmResourceList()</a>, <a class="el" href="../../d5/d0/pnppower_8c-source.html#l00386">IopCaptureObjectName()</a>, <a class="el" href="../../d8/d6/errorlog_8c-source.html#l00088">IopErrorLogThread()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l01811">IopQueryName()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l05617">IopRaiseHardError()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l01721">MmGetFileNameForSection()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, <a class="el" href="../../d6/d2/queryvm_8c-source.html#l00061">NtQueryVirtualMemory()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00800">ObGetObjectInformation()</a>, and <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02324">SepQueryNameString()</a>.
<p>
<pre class="fragment"><div>00722                    :
00723 
00724     This routine processes a query of an object's name information
00725 
00726 Arguments:
00727 
00728     Object - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being queried
00729 
00730     ObjectNameInfo - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name string
00731         information
00732 
00733     Length - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length, in bytes, of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> original object
00734         name info buffer.
00735 
00736     ReturnLength - Contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes already used up
00737         in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object name info. On <span class="keywordflow">return</span> <span class="keyword">this</span> receives an updated
00738         byte count.
00739 
00740         (Length minus ReturnLength) <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> really now many bytes are left
00741         in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output buffer.  The buffer supplied to <span class="keyword">this</span> call may
00742         actually be offset within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> original users buffer
00743 
00744 Return Value:
00745 
00746     An appropriate status value
00747 
00748 --*/
00749 
00750 {
00751     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00752     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00753     <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">POBJECT_HEADER_NAME_INFO</a> NameInfo;
00754     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectDirectoryHeader;
00755     <a class="code" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">POBJECT_DIRECTORY</a> ObjectDirectory;
00756     ULONG NameInfoSize;
00757     PUNICODE_STRING <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>;
00758     PWCH StringBuffer;
00759     ULONG NameSize;
00760 
00761     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00762 
00763     <span class="comment">//</span>
00764     <span class="comment">//  Get the object header and name info record if it exists</span>
00765     <span class="comment">//</span>
00766 
00767     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
00768     NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectHeader );
00769 
00770     <span class="comment">//</span>
00771     <span class="comment">//  If the object type has a query name callback routine then</span>
00772     <span class="comment">//  that is how we get the name</span>
00773     <span class="comment">//</span>
00774 
00775     <span class="keywordflow">if</span> (ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o18">QueryNameProcedure</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00776 
00777         <span class="keywordflow">try</span> {
00778 
00779             KIRQL SaveIrql;
00780 
00781             <a class="code" href="../../d5/d1/obp_8h.html#a0">ObpBeginTypeSpecificCallOut</a>( SaveIrql );
00782             <a class="code" href="../../d5/d1/obp_8h.html#a1">ObpEndTypeSpecificCallOut</a>( SaveIrql, <span class="stringliteral">"Query"</span>, ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>, Object );
00783 
00784             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (*ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o18">QueryNameProcedure</a>)( Object,
00785                                                                          (BOOLEAN)((NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length != 0)),
00786                                                                          ObjectNameInfo,
00787                                                                          Length,
00788                                                                          ReturnLength );
00789 
00790         } except( EXCEPTION_EXECUTE_HANDLER ) {
00791 
00792             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00793         }
00794 
00795         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00796     }
00797 
00798     <span class="comment">//</span>
00799     <span class="comment">//  Otherwise, the object type does not specify a query name</span>
00800     <span class="comment">//  procedure so we get to do the work.  The first thing</span>
00801     <span class="comment">//  to check is if the object doesn't even have a name.  If</span>
00802     <span class="comment">//  object doesn't have a name then we'll return an empty name</span>
00803     <span class="comment">//  info structure.</span>
00804     <span class="comment">//</span>
00805 
00806     <span class="keywordflow">if</span> ((NameInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Buffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00807 
00808         <span class="comment">//</span>
00809         <span class="comment">//  Compute the length of our return buffer, set the output</span>
00810         <span class="comment">//  if necessary and make sure the supplied buffer is large</span>
00811         <span class="comment">//  enough</span>
00812         <span class="comment">//</span>
00813 
00814         NameInfoSize = <span class="keyword">sizeof</span>( OBJECT_NAME_INFORMATION );
00815 
00816         <span class="keywordflow">try</span> {
00817 
00818             *ReturnLength = NameInfoSize;
00819 
00820         } except( EXCEPTION_EXECUTE_HANDLER ) {
00821 
00822             <span class="keywordflow">return</span>( GetExceptionCode() );
00823         }
00824 
00825         <span class="keywordflow">if</span> (Length &lt; NameInfoSize) {
00826 
00827             <span class="keywordflow">return</span>( STATUS_INFO_LENGTH_MISMATCH );
00828         }
00829 
00830         <span class="comment">//</span>
00831         <span class="comment">//  Initialize the output buffer to be an empty string</span>
00832         <span class="comment">//  and then return to our caller</span>
00833         <span class="comment">//</span>
00834 
00835         <span class="keywordflow">try</span> {
00836 
00837             ObjectNameInfo-&gt;Name.Length = 0;
00838             ObjectNameInfo-&gt;Name.MaximumLength = 0;
00839             ObjectNameInfo-&gt;Name.Buffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00840 
00841         } except( EXCEPTION_EXECUTE_HANDLER ) {
00842 
00843             <span class="comment">//</span>
00844             <span class="comment">//  Fall through, since we cannot undo what we have done.</span>
00845             <span class="comment">//</span>
00846             <span class="comment">//  **** This should probably get the exception code and return</span>
00847             <span class="comment">//  that value</span>
00848             <span class="comment">//</span>
00849         }
00850 
00851         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00852     }
00853 
00854     <span class="comment">//</span>
00855     <span class="comment">//  First lock the directory mutex to stop before we chase stuff down</span>
00856     <span class="comment">//</span>
00857 
00858     <a class="code" href="../../d5/d1/obp_8h.html#a10">ObpEnterRootDirectoryMutex</a>();
00859 
00860     <span class="keywordflow">try</span> {
00861 
00862         <span class="comment">//</span>
00863         <span class="comment">//  The object does have a name but now see if this is</span>
00864         <span class="comment">//  just the root directory object in which case the name size</span>
00865         <span class="comment">//  is only the "\" character</span>
00866         <span class="comment">//</span>
00867 
00868         <span class="keywordflow">if</span> (Object == <a class="code" href="../../d8/d5/kddata_8c.html#a9">ObpRootDirectoryObject</a>) {
00869 
00870             NameSize = <span class="keyword">sizeof</span>( OBJ_NAME_PATH_SEPARATOR );
00871 
00872         } <span class="keywordflow">else</span> {
00873 
00874             <span class="comment">//</span>
00875             <span class="comment">//  The named object is not the root so for every directory</span>
00876             <span class="comment">//  working out way up we'll add its size to the name keeping</span>
00877             <span class="comment">//  track of "\" characters inbetween each component.  We first</span>
00878             <span class="comment">//  start with the object name itself and then move on to</span>
00879             <span class="comment">//  the directories</span>
00880             <span class="comment">//</span>
00881 
00882             ObjectDirectory = NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a>;
00883             NameSize = <span class="keyword">sizeof</span>( OBJ_NAME_PATH_SEPARATOR ) + NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length;
00884 
00885             <span class="comment">//</span>
00886             <span class="comment">//  While we are not at the root we'll keep moving up</span>
00887             <span class="comment">//</span>
00888 
00889             <span class="keywordflow">while</span> ((ObjectDirectory != <a class="code" href="../../d8/d5/kddata_8c.html#a9">ObpRootDirectoryObject</a>) &amp;&amp; (ObjectDirectory)) {
00890 
00891                 <span class="comment">//</span>
00892                 <span class="comment">//  Get the name information for this directory</span>
00893                 <span class="comment">//</span>
00894 
00895                 ObjectDirectoryHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( ObjectDirectory );
00896                 NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectDirectoryHeader );
00897 
00898                 <span class="keywordflow">if</span> ((NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00899 
00900                     <span class="comment">//</span>
00901                     <span class="comment">//  This directory has a name so add it to the accomulated</span>
00902                     <span class="comment">//  size and move up the tree</span>
00903                     <span class="comment">//</span>
00904 
00905                     NameSize += <span class="keyword">sizeof</span>( OBJ_NAME_PATH_SEPARATOR ) + NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length;
00906                     ObjectDirectory = NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a>;
00907 
00908                 } <span class="keywordflow">else</span> {
00909 
00910                     <span class="comment">//</span>
00911                     <span class="comment">//  This directory does not have a name so we'll give it</span>
00912                     <span class="comment">//  the "..." name and stop the loop</span>
00913                     <span class="comment">//</span>
00914 
00915                     NameSize += <span class="keyword">sizeof</span>( OBJ_NAME_PATH_SEPARATOR ) + <a class="code" href="../../d6/d1/obquery_8c.html#a1">OBP_MISSING_NAME_LITERAL_SIZE</a>;
00916                     <span class="keywordflow">break</span>;
00917                 }
00918             }
00919         }
00920 
00921         <span class="comment">//</span>
00922         <span class="comment">//  At this point NameSize is the number of bytes we need to store the</span>
00923         <span class="comment">//  name of the object from the root down.  The total buffer size we are</span>
00924         <span class="comment">//  going to need will include this size, plus object name information</span>
00925         <span class="comment">//  structure, plus an ending null character</span>
00926         <span class="comment">//</span>
00927 
00928         NameInfoSize = NameSize + <span class="keyword">sizeof</span>( OBJECT_NAME_INFORMATION ) + <span class="keyword">sizeof</span>( UNICODE_NULL );
00929 
00930         <span class="comment">//</span>
00931         <span class="comment">//  Set the output size and make sure the supplied buffer is large enough</span>
00932         <span class="comment">//  to hold the information</span>
00933         <span class="comment">//</span>
00934 
00935         <span class="keywordflow">try</span> {
00936 
00937             *ReturnLength = NameInfoSize;
00938 
00939         } except( EXCEPTION_EXECUTE_HANDLER ) {
00940 
00941             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00942             leave;
00943         }
00944 
00945         <span class="keywordflow">if</span> (Length &lt; NameInfoSize) {
00946 
00947             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INFO_LENGTH_MISMATCH;
00948             leave;
00949         }
00950 
00951         <span class="comment">//</span>
00952         <span class="comment">//  **** the following IF isn't necessary because name info size is</span>
00953         <span class="comment">//  already guaranteed to be nonzero from about 23 lines above</span>
00954         <span class="comment">//</span>
00955 
00956         <span class="keywordflow">if</span> (NameInfoSize != 0) {
00957 
00958             <span class="comment">//</span>
00959             <span class="comment">//  Set the String buffer to point to the byte right after the</span>
00960             <span class="comment">//  last byte in the output string.  This following logic actually</span>
00961             <span class="comment">//  fills in the buffer backwards working from the name back to the</span>
00962             <span class="comment">//  root</span>
00963             <span class="comment">//</span>
00964 
00965             StringBuffer = (PWCH)ObjectNameInfo;
00966             StringBuffer = (PWCH)((PCH)StringBuffer + NameInfoSize);
00967 
00968             NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectHeader );
00969 
00970             <span class="keywordflow">try</span> {
00971 
00972                 <span class="comment">//</span>
00973                 <span class="comment">//  Terminate the string with a null and backup one unicode</span>
00974                 <span class="comment">//  character</span>
00975                 <span class="comment">//</span>
00976 
00977                 *--StringBuffer = UNICODE_NULL;
00978 
00979                 <span class="comment">//</span>
00980                 <span class="comment">//  If the object in question is not the root directory</span>
00981                 <span class="comment">//  then we are going to put its name in the string buffer</span>
00982                 <span class="comment">//  When we finally reach the root directory we'll append on</span>
00983                 <span class="comment">//  the final "\"</span>
00984                 <span class="comment">//</span>
00985 
00986                 <span class="keywordflow">if</span> (Object != <a class="code" href="../../d8/d5/kddata_8c.html#a9">ObpRootDirectoryObject</a>) {
00987 
00988                     <span class="comment">//</span>
00989                     <span class="comment">//  Add in the objects name</span>
00990                     <span class="comment">//</span>
00991 
00992                     <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> = &amp;NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>;
00993                     StringBuffer = (PWCH)((PCH)StringBuffer - <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length);
00994                     RtlMoveMemory( StringBuffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length );
00995 
00996                     <span class="comment">//</span>
00997                     <span class="comment">//  While we are not at the root directory we'll keep</span>
00998                     <span class="comment">//  moving up</span>
00999                     <span class="comment">//</span>
01000 
01001                     ObjectDirectory = NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a>;
01002 
01003                     <span class="keywordflow">while</span> ((ObjectDirectory != <a class="code" href="../../d8/d5/kddata_8c.html#a9">ObpRootDirectoryObject</a>) &amp;&amp; (ObjectDirectory)) {
01004 
01005                         <span class="comment">//</span>
01006                         <span class="comment">//  Get the name information for this directory</span>
01007                         <span class="comment">//</span>
01008 
01009                         ObjectDirectoryHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( ObjectDirectory );
01010                         NameInfo = <a class="code" href="../../d4/d0/ob_8h.html#a12">OBJECT_HEADER_TO_NAME_INFO</a>( ObjectDirectoryHeader );
01011 
01012                         <span class="comment">//</span>
01013                         <span class="comment">//  Tack on the "\" between the last name we added and</span>
01014                         <span class="comment">//  this new name</span>
01015                         <span class="comment">//</span>
01016 
01017                         *--StringBuffer = OBJ_NAME_PATH_SEPARATOR;
01018 
01019                         <span class="comment">//</span>
01020                         <span class="comment">//  Preappend the directory name, if it has one, and</span>
01021                         <span class="comment">//  move up to the next directory.</span>
01022                         <span class="comment">//</span>
01023 
01024                         <span class="keywordflow">if</span> ((NameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01025 
01026                             <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> = &amp;NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>;
01027                             StringBuffer = (PWCH)((PCH)StringBuffer - <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length);
01028                             RtlMoveMemory( StringBuffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length );
01029                             ObjectDirectory = NameInfo-&gt;<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o0">Directory</a>;
01030 
01031                         } <span class="keywordflow">else</span> {
01032 
01033                             <span class="comment">//</span>
01034                             <span class="comment">//  The directory is nameless so use the "..." for</span>
01035                             <span class="comment">//  its name and break out of the loop</span>
01036                             <span class="comment">//</span>
01037 
01038                             StringBuffer = (PWCH)((PCH)StringBuffer - <a class="code" href="../../d6/d1/obquery_8c.html#a1">OBP_MISSING_NAME_LITERAL_SIZE</a>);
01039                             RtlMoveMemory( StringBuffer,
01040                                            OBP_MISSING_NAME_LITERAL,
01041                                            OBP_MISSING_NAME_LITERAL_SIZE );
01042                             <span class="keywordflow">break</span>;
01043                         }
01044                     }
01045                 }
01046 
01047                 <span class="comment">//</span>
01048                 <span class="comment">//  Tack on the "\" for the root directory and then set the</span>
01049                 <span class="comment">//  output unicode string variable to have the right size</span>
01050                 <span class="comment">//  and point to the right spot.</span>
01051                 <span class="comment">//</span>
01052 
01053                 *--StringBuffer = OBJ_NAME_PATH_SEPARATOR;
01054 
01055                 ObjectNameInfo-&gt;Name.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)NameSize;
01056                 ObjectNameInfo-&gt;Name.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(NameSize+<span class="keyword">sizeof</span>( UNICODE_NULL ));
01057                 ObjectNameInfo-&gt;Name.Buffer = StringBuffer;
01058 
01059             } except( EXCEPTION_EXECUTE_HANDLER ) {
01060 
01061                 <span class="comment">//</span>
01062                 <span class="comment">// Fall through, since we cannot undo what we have done.</span>
01063                 <span class="comment">//</span>
01064                 <span class="comment">//  **** This should probably get the exception code and return</span>
01065                 <span class="comment">//  that value</span>
01066                 <span class="comment">//</span>
01067             }
01068         }
01069 
01070         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01071 
01072     } finally {
01073 
01074         <a class="code" href="../../d5/d1/obp_8h.html#a11">ObpLeaveRootDirectoryMutex</a>();
01075     }
01076 
01077     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01078 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a98" doxytag="ob.h::ObQueryObjectAuditingByHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObQueryObjectAuditingByHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateOnClose</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d0/obquery_8c-source.html#l01319">1319</a> of file <a class="el" href="../../d7/d0/obquery_8c-source.html">obquery.c</a>.
<p>
References <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01403">ExMapHandleToPointer()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00336">ExUnlockHandleTableEntry()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02674">_HANDLE_TABLE_ENTRY::ObAttributes</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00408">OBJ_AUDIT_OBJECT_CLOSE</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00213">ObpGetObjectTable</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00071">ObpValidateIrql</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01326                    :
01327 
01328     This routine tells <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> indicated handle will
01329     generate an audit <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> closed
01330 
01331 Arguments:
01332 
01333     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle being queried
01334 
01335     GenerateOnClose - Receives <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle will generate
01336         an audit <span class="keywordflow">if</span> closed and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise
01337 
01338 Return Value:
01339 
01340     An appropriate status value
01341 
01342 --*/
01343 
01344 {
01345     <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html">PHANDLE_TABLE</a> ObjectTable;
01346     <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a> ObjectTableEntry;
01347     PVOID Object;
01348     ULONG CapturedGrantedAccess;
01349     ULONG CapturedAttributes;
01350     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01351 
01352     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01353 
01354     <span class="comment">//</span>
01355     <span class="comment">//  Protect ourselves from being interrupted while we hold a handle table</span>
01356     <span class="comment">//  entry lock</span>
01357     <span class="comment">//</span>
01358 
01359     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
01360 
01361     <span class="keywordflow">try</span> {
01362 
01363         <a class="code" href="../../d5/d1/obp_8h.html#a2">ObpValidateIrql</a>( <span class="stringliteral">"ObQueryObjectAuditingByHandle"</span> );
01364 
01365 
01366         <span class="comment">//</span>
01367         <span class="comment">//  For the current process we'll grab its object table and</span>
01368         <span class="comment">//  then get the object table entry</span>
01369         <span class="comment">//</span>
01370 
01371         ObjectTable = <a class="code" href="../../d5/d1/obp_8h.html#a12">ObpGetObjectTable</a>();
01372 
01373         ObjectTableEntry = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>( ObjectTable,
01374                                                   Handle );
01375 
01376         <span class="comment">//</span>
01377         <span class="comment">//  If we were given a valid handle we'll look at the attributes</span>
01378         <span class="comment">//  stored in the object table entry to decide if we generate</span>
01379         <span class="comment">//  an audit on close</span>
01380         <span class="comment">//</span>
01381 
01382         <span class="keywordflow">if</span> (ObjectTableEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01383 
01384             CapturedAttributes = ObjectTableEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o1">ObAttributes</a>;
01385 
01386             <span class="keywordflow">if</span> (CapturedAttributes &amp; <a class="code" href="../../d7/d7/ntapi_8c.html#a2">OBJ_AUDIT_OBJECT_CLOSE</a>) {
01387 
01388                 *GenerateOnClose = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01389 
01390             } <span class="keywordflow">else</span> {
01391 
01392                 *GenerateOnClose = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01393             }
01394 
01395             <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a>( ObjectTable, ObjectTableEntry );
01396 
01397             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01398 
01399         } <span class="keywordflow">else</span> {
01400 
01401             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_HANDLE;
01402         }
01403 
01404     } finally {
01405 
01406         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
01407     }
01408 
01409     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01410 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a84" doxytag="ob.h::ObQueryTypeInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObQueryTypeInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT POBJECT_TYPE_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectTypeInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ReturnLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d0/obquery_8c-source.html#l01216">1216</a> of file <a class="el" href="../../d7/d0/obquery_8c-source.html">obquery.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00126">ALIGN_UP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>.
<p>
<pre class="fragment"><div>01225                    :
01226 
01227     This routine processes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query <span class="keywordflow">for</span> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> information
01228 
01229 Arguments:
01230 
01231     Object - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> being queried
01232 
01233     ObjectTypeInfo - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> information
01234 
01235     Length - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length, in bytes, of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>
01236         information buffer
01237 
01238     ReturnLength - Contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes already used up
01239         in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> information buffer. On <span class="keywordflow">return</span> <span class="keyword">this</span> receives
01240         an updated byte count
01241 
01242         (Length minus ReturnLength) <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> really now many bytes are left
01243         in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output buffer.  The buffer supplied to <span class="keyword">this</span> call may
01244         actually be offset within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> original users buffer
01245 
01246 Return Value:
01247 
01248     An appropriate status value
01249 
01250 --*/
01251 
01252 {
01253     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01254 
01255     <span class="keywordflow">try</span> {
01256 
01257         <span class="comment">//</span>
01258         <span class="comment">//  The total number of bytes needed for this query includes the</span>
01259         <span class="comment">//  object type information structure plus the name of the type</span>
01260         <span class="comment">//  rounded up to a ulong boundary</span>
01261         <span class="comment">//</span>
01262 
01263         *ReturnLength += <span class="keyword">sizeof</span>( *ObjectTypeInfo ) + <a class="code" href="../../d0/d9/ntosdef_8h.html#a4">ALIGN_UP</a>( ObjectType-&gt;Name.MaximumLength, ULONG );
01264 
01265         <span class="comment">//</span>
01266         <span class="comment">//  Make sure the buffer is large enough for this information and</span>
01267         <span class="comment">//  then fill in the record</span>
01268         <span class="comment">//</span>
01269 
01270         <span class="keywordflow">if</span> (Length &lt; *ReturnLength) {
01271 
01272             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INFO_LENGTH_MISMATCH;
01273 
01274         } <span class="keywordflow">else</span> {
01275 
01276             ObjectTypeInfo-&gt;TotalNumberOfObjects = ObjectType-&gt;TotalNumberOfObjects;
01277             ObjectTypeInfo-&gt;TotalNumberOfHandles = ObjectType-&gt;TotalNumberOfHandles;
01278             ObjectTypeInfo-&gt;HighWaterNumberOfObjects = ObjectType-&gt;HighWaterNumberOfObjects;
01279             ObjectTypeInfo-&gt;HighWaterNumberOfHandles = ObjectType-&gt;HighWaterNumberOfHandles;
01280             ObjectTypeInfo-&gt;InvalidAttributes = ObjectType-&gt;TypeInfo.InvalidAttributes;
01281             ObjectTypeInfo-&gt;GenericMapping = ObjectType-&gt;TypeInfo.GenericMapping;
01282             ObjectTypeInfo-&gt;ValidAccessMask = ObjectType-&gt;TypeInfo.ValidAccessMask;
01283             ObjectTypeInfo-&gt;SecurityRequired = ObjectType-&gt;TypeInfo.SecurityRequired;
01284             ObjectTypeInfo-&gt;MaintainHandleCount = ObjectType-&gt;TypeInfo.MaintainHandleCount;
01285             ObjectTypeInfo-&gt;PoolType = ObjectType-&gt;TypeInfo.PoolType;
01286             ObjectTypeInfo-&gt;DefaultPagedPoolCharge = ObjectType-&gt;TypeInfo.DefaultPagedPoolCharge;
01287             ObjectTypeInfo-&gt;DefaultNonPagedPoolCharge = ObjectType-&gt;TypeInfo.DefaultNonPagedPoolCharge;
01288 
01289             <span class="comment">//</span>
01290             <span class="comment">//  The type name goes right after this structure.  We cannot use</span>
01291             <span class="comment">//  rtl routine like RtlCopyUnicodeString that might use the local</span>
01292             <span class="comment">//  memory to keep state, because this is the user buffer and it</span>
01293             <span class="comment">//  could be changing by user</span>
01294             <span class="comment">//</span>
01295 
01296             ObjectTypeInfo-&gt;TypeName.Buffer = (PWSTR)(ObjectTypeInfo+1);
01297             ObjectTypeInfo-&gt;TypeName.Length = ObjectType-&gt;Name.Length;
01298             ObjectTypeInfo-&gt;TypeName.MaximumLength = ObjectType-&gt;Name.MaximumLength;
01299 
01300             RtlMoveMemory( (PWSTR)(ObjectTypeInfo+1),
01301                            ObjectType-&gt;Name.Buffer,
01302                            ObjectType-&gt;Name.Length );
01303 
01304             ((PWSTR)(ObjectTypeInfo+1))[ ObjectType-&gt;Name.Length/<span class="keyword">sizeof</span>(WCHAR) ] = UNICODE_NULL;
01305 
01306             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01307         }
01308 
01309     } except( EXCEPTION_EXECUTE_HANDLER ) {
01310 
01311         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
01312     }
01313 
01314     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01315 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a83" doxytag="ob.h::ObQueryTypeName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObQueryTypeName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectTypeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ReturnLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d0/obquery_8c-source.html#l01082">1082</a> of file <a class="el" href="../../d7/d0/obquery_8c-source.html">obquery.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00189">_OBJECT_TYPE::Name</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/talloc_8c-source.html#l00027">String</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d1/d1/obtype_8c-source.html#l00800">ObGetObjectInformation()</a>, and <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02400">SepQueryTypeString()</a>.
<p>
<pre class="fragment"><div>01091                    :
01092 
01093     This routine processes a query of an object's <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> name
01094 
01095 Arguments:
01096 
01097     Object - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being queried
01098 
01099     ObjectTypeName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> name
01100         string information
01101 
01102     Length - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length, in bytes, of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>
01103         name buffer
01104 
01105     ReturnLength - Contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes already used up
01106         in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> name buffer. On <span class="keywordflow">return</span> <span class="keyword">this</span> receives
01107         an updated byte count
01108 
01109         (Length minus ReturnLength) <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> really now many bytes are left
01110         in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> output buffer.  The buffer supplied to <span class="keyword">this</span> call may
01111         actually be offset within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> original users buffer
01112 
01113 Return Value:
01114 
01115     An appropriate status value
01116 
01117 --*/
01118 
01119 {
01120     <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType;
01121     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
01122     ULONG TypeNameSize;
01123     PUNICODE_STRING <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>;
01124     PWCH StringBuffer;
01125     ULONG NameSize;
01126 
01127     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01128 
01129     <span class="comment">//</span>
01130     <span class="comment">//  From the object get its object type and from that get the size of</span>
01131     <span class="comment">//  the object type name.  The total size for we need for the output</span>
01132     <span class="comment">//  buffer must fit the name, a terminating null, and a preceding</span>
01133     <span class="comment">//  unicode string structure</span>
01134     <span class="comment">//</span>
01135 
01136     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
01137     ObjectType = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>;
01138 
01139     NameSize = ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o2">Name</a>.Length;
01140     TypeNameSize = NameSize + <span class="keyword">sizeof</span>( UNICODE_NULL ) + <span class="keyword">sizeof</span>( UNICODE_STRING );
01141 
01142     <span class="comment">//</span>
01143     <span class="comment">//  Update the number of bytes we need and make sure the output buffer is</span>
01144     <span class="comment">//  large enough</span>
01145     <span class="comment">//</span>
01146     <span class="comment">//  **** to be consistent with all our callers and other routines in</span>
01147     <span class="comment">//  this module this should probably be a "+=" and not just "="</span>
01148     <span class="comment">//</span>
01149 
01150     <span class="keywordflow">try</span> {
01151 
01152         *ReturnLength = TypeNameSize;
01153 
01154     } except( EXCEPTION_EXECUTE_HANDLER ) {
01155 
01156         <span class="keywordflow">return</span>( GetExceptionCode() );
01157     }
01158 
01159     <span class="keywordflow">if</span> (Length &lt; TypeNameSize) {
01160 
01161         <span class="keywordflow">return</span>( STATUS_INFO_LENGTH_MISMATCH );
01162     }
01163 
01164     <span class="comment">//</span>
01165     <span class="comment">//  **** this IF is probably not needed because of the earlier computation</span>
01166     <span class="comment">//  of type name size</span>
01167     <span class="comment">//</span>
01168 
01169     <span class="keywordflow">if</span> (TypeNameSize != 0) {
01170 
01171         <span class="comment">//</span>
01172         <span class="comment">//  Set string buffer to point to the one byte beyond the</span>
01173         <span class="comment">//  buffer that we're going to fill in</span>
01174         <span class="comment">//</span>
01175 
01176         StringBuffer = (PWCH)ObjectTypeName;
01177         StringBuffer = (PWCH)((PCH)StringBuffer + TypeNameSize);
01178 
01179         <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> = &amp;ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o2">Name</a>;
01180 
01181         <span class="keywordflow">try</span> {
01182 
01183             <span class="comment">//</span>
01184             <span class="comment">//  Tack on the terminating null character and copy over</span>
01185             <span class="comment">//  the type name</span>
01186             <span class="comment">//</span>
01187 
01188             *--StringBuffer = UNICODE_NULL;
01189 
01190             StringBuffer = (PWCH)((PCH)StringBuffer - <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length);
01191 
01192             RtlMoveMemory( StringBuffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length );
01193 
01194             <span class="comment">//</span>
01195             <span class="comment">//  Now set the preceding unicode string to have the right</span>
01196             <span class="comment">//  lengths and to point to this buffer</span>
01197             <span class="comment">//</span>
01198 
01199             ObjectTypeName-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)NameSize;
01200             ObjectTypeName-&gt;MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(NameSize+<span class="keyword">sizeof</span>( UNICODE_NULL ));
01201             ObjectTypeName-&gt;Buffer = StringBuffer;
01202 
01203         } except( EXCEPTION_EXECUTE_HANDLER ) {
01204 
01205             <span class="comment">//</span>
01206             <span class="comment">// Fall through, since we cannot undo what we have done.</span>
01207             <span class="comment">//</span>
01208         }
01209     }
01210 
01211     <span class="keywordflow">return</span>( STATUS_SUCCESS );
01212 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a72" doxytag="ob.h::ObReferenceObjectByHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS ObReferenceObjectByHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">POBJECT_HANDLE_INFORMATION</a> HandleInformation&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">542</a> of file <a class="el" href="../../d8/d0/obref_8c-source.html">obref.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00313">_OBJECT_HEADER::Body</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00418">DecodeKernelHandle</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01403">ExMapHandleToPointer()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00336">ExUnlockHandleTableEntry()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00254">_EPROCESS::GrantedAccess</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00440">_ETHREAD::GrantedAccess</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02690">_HANDLE_TABLE_ENTRY::GrantedAccess</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02694">_HANDLE_TABLE_ENTRY::GrantedAccessIndex</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d7/d5/ioverifier_8c-source.html#l00057">IsKernelHandle</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00405">KeDetachProcess()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00370">NtGlobalFlag</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02674">_HANDLE_TABLE_ENTRY::ObAttributes</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00289">OBJ_HANDLE_ATTRIBUTES</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02672">_HANDLE_TABLE_ENTRY::Object</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00213">ObpGetObjectTable</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00143">ObpIncrPointerCount</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00399">ObpKernelHandleTable</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00071">ObpValidateIrql</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d0/d8/ntos_8h-source.html#l00088">PsProcessType</a>, <a class="el" href="../../d0/d8/ntos_8h-source.html#l00089">PsThreadType</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00480">SeComputeDeniedAccesses</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00626">_GetUserObjectInformation()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00764">_SetUserObjectInformation()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00057">BuildQueryDirectoryIrp()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02169">CmGetSystemDriverList()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03262">CmpCloneControlSet()</a>, <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l01869">CmpCloneHwProfile()</a>, <a class="el" href="../../d8/d2/cmwrapr_8c-source.html#l00313">CmpCreateEvent()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01165">CmpCreateRegistryRoot()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01421">CmpLinkHiveToMaster()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03458">CmpSaveBootControlSet()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00222">ExCreateCallback()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00119">InitializeMediaChange()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00180">InitializePowerRequestList()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l01067">IoAttachDevice()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01071">IoCreateDriver()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05299">IoCreateNotificationEvent()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05733">IoCreateSynchronizationEvent()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l06998">IoGetDeviceObjectPointer()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l00270">IoInitSystem()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l04061">IopCompleteDumpInitialization()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l04746">IopConfigureCrashDump()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01506">IopConnectLinkTrackingPort()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l00384">IopGetDumpStack()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02812">IopInitializeBuiltinDriver()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l03479">IopMarkBootPartition()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l05126">IopOpenLinkOrRenameTarget()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03686">IopReferenceDriverObjectByName()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06326">IopSetEaOrQuotaInformationFile()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l07272">IopTrackLink()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08084">IopXxxControlFile()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l00390">MmCreateSection()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l01721">MmGetFileNameForSection()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l07311">MmSetBankedSection()</a>, <a class="el" href="../../d5/d5/lpccompl_8c-source.html#l00040">NtAcceptConnectPort()</a>, <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00432">NtAdjustGroupsToken()</a>, <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00046">NtAdjustPrivilegesToken()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00267">NtAlertResumeThread()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00214">NtAlertThread()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00970">NtAllocateUserPhysicalPages()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00266">NtAssignProcessToJobObject()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00049">NtCancelIoFile()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00679">NtCancelTimer()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00126">NtClearEvent()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l00297">NtCreatePagingFile()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00199">NtCreateProfile()</a>, <a class="el" href="../../d2/d7/super_8c-source.html#l00056">NtCreateSuperSection()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00411">NtDeleteKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00504">NtDeleteValueKey()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00046">NtDuplicateToken()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00610">NtEnumerateKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00756">NtEnumerateValueKey()</a>, <a class="el" href="../../d9/d9/extsect_8c-source.html#l00085">NtExtendSection()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01306">NtFilterToken()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00386">NtFlushBuffersFile()</a>, <a class="el" href="../../d6/d4/flushbuf_8c-source.html#l00142">NtFlushInstructionCache()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00904">NtFlushKey()</a>, <a class="el" href="../../d7/d4/flushsec_8c-source.html#l00055">NtFlushVirtualMemory()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l01624">NtFreeUserPhysicalPages()</a>, <a class="el" href="../../d4/d6/freevm_8c-source.html#l00066">NtFreeVirtualMemory()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00151">NtGetContextThread()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l03038">NtImpersonateAnonymousToken()</a>, <a class="el" href="../../d0/d0/psimpers_8c-source.html#l00026">NtImpersonateThread()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00236">NtListenChannel()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00035">NtLockFile()</a>, <a class="el" href="../../d4/d4/lockvm_8c-source.html#l00033">NtLockVirtualMemory()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00414">NtMakeTemporaryObject()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l00199">NtMapViewOfSection()</a>, <a class="el" href="../../d2/d7/super_8c-source.html#l00311">NtMapViewOfSuperSection()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00821">NtNotifyChangeDirectoryFile()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01319">NtNotifyChangeMultipleKeys()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00231">NtPrivilegeCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d1/d8/protect_8c-source.html#l00069">NtProtectVirtualMemory()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00412">NtPulseEvent()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00229">NtQueryDirectoryObject()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00035">NtQueryEaFile()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00514">NtQueryEvent()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00814">NtQueryInformationJobObject()</a>, <a class="el" href="../../d3/d6/lpcquery_8c-source.html#l00030">NtQueryInformationPort()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00531">NtQueryInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l02706">NtQueryInformationThread()</a>, <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l00034">NtQueryInformationToken()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00282">NtQueryIoCompletion()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02018">NtQueryKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03461">NtQueryMultipleValueKey()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00380">NtQueryMutant()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00058">NtQueryObject()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l04090">NtQueryOpenSubKeys()</a>, <a class="el" href="../../d1/d2/qsquota_8c-source.html#l00035">NtQueryQuotaInformationFile()</a>, <a class="el" href="../../d5/d2/querysec_8c-source.html#l00031">NtQuerySection()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00255">NtQuerySecurityObject()</a>, <a class="el" href="../../d3/d5/semphore_8c-source.html#l00360">NtQuerySemaphore()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00333">NtQuerySymbolicLinkObject()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00822">NtQueryTimer()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d6/d2/queryvm_8c-source.html#l00061">NtQueryVirtualMemory()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00037">NtQueryVolumeInformationFile()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00056">NtQueueApcThread()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00036">NtReadFile()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00730">NtReadFileScatter()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00102">NtReadVirtualMemory()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01472">NtRegisterThreadTerminatePort()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00521">NtReleaseMutant()</a>, <a class="el" href="../../d3/d5/semphore_8c-source.html#l00494">NtReleaseSemaphore()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00485">NtRemoveIoCompletion()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03336">NtReplaceKey()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00029">NtReplyWaitReceivePort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00635">NtReplyWaitReceivePortEx()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00648">NtResetEvent()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02348">NtRestoreKey()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00138">NtResumeThread()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02471">NtSaveKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02559">NtSaveMergedKeys()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00807">NtSendWaitReplyChannel()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00352">NtSetContextThread()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00886">NtSetDefaultHardErrorPort()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00652">NtSetEaFile()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00651">NtSetHighEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00532">NtSetHighWaitLowEventPair()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00849">NtSetInformationFile()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03235">NtSetInformationKey()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00417">NtSetIoCompletion()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00592">NtSetLowEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00472">NtSetLowWaitHighEventPair()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00046">NtSetSecurityObject()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00960">NtSetTimer()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00492">NtSetVolumeInformationFile()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00038">NtSignalAndWaitForSingleObject()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00517">NtStartProfile()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00680">NtStopProfile()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00033">NtSuspendThread()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02358">NtTerminateJobObject()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00227">NtTerminateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00461">NtTerminateThread()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00244">NtUnloadDriver()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03093">NtUnloadKey()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00458">NtUnlockFile()</a>, <a class="el" href="../../d4/d4/lockvm_8c-source.html#l00605">NtUnlockVirtualMemory()</a>, <a class="el" href="../../d5/d8/umapview_8c-source.html#l00033">NtUnmapViewOfSection()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l02329">NtUserGetGuiResources()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02788">NtUserProcessConnect()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07905">NtUserUserHandleGrantAccess()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00282">NtWaitForSingleObject()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00412">NtWaitHighEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00352">NtWaitLowEventPair()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00035">NtWriteFile()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00801">NtWriteFileGather()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00231">NtWriteVirtualMemory()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>, <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00030">ObSetDeviceMap()</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00187">obtest()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00837">ObWaitForSingleObject()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00263">OpenCacheKeyEx()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00525">PsLocateSystemDll()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00586">PsOpenTokenOfJobObject()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00492">PsOpenTokenOfProcess()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00326">PsOpenTokenOfThread()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01256">PspAssignPrimaryToken()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00291">PspQueryPooledQuotaLimits()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00209">PspQueryQuotaLimits()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00113">PspQueryWorkingSetWatch()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01211">PspSetQuotaLimits()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l03858">RawInputThread()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l01366">ReferenceWindowStation()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00929">RegisterForDeviceChangeNotifications()</a>, <a class="el" href="../../d7/d9/w32_2ntuser_2kernel_2misc_8c-source.html#l00020">RemoteConnect()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01634">SeFilterToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02867">SeIsChildToken()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00294">SepOpenTokenOfThread()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l06357">SetInformationProcess()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l02425">SmbTraceToClient()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01271">UdfInvalidateVolumes()</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00092">ValidateHdesk()</a>, <a class="el" href="../../d8/d2/validate_8c-source.html#l00046">ValidateHwinsta()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01235">VdmpDelayInterrupt()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00146">VdmpQueueInterrupt()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00408">VdmpQueueIntNormalRoutine()</a>, <a class="el" href="../../d4/d3/vdm_2vdm_8c-source.html#l00087">VdmQueryDirectoryFile()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l05671">WaitOnPseudoEvent()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04332">xxxCloseDesktop()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l06445">xxxConsoleControl()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01797">xxxCreateDesktop()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01654">xxxCreateDisconnectDesktop()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l01501">xxxCreateThreadInfo()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04211">xxxGetThreadDesktop()</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2kernel_2random_8c-source.html#l00276">xxxHardErrorControl()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00026">xxxInitTerminal()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l03265">xxxOpenDesktop()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l05901">xxxQueryInformationThread()</a>, <a class="el" href="../../d2/d9/kernel_2exitwin_8c-source.html#l00565">xxxRegisterUserHungAppHandlers()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04821">xxxResolveDesktop()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l06114">xxxSetInformationThread()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l01077">xxxSetProcessWindowStation()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l03823">zzzSetDesktop()</a>.
<p>
<pre class="fragment"><div>00553                    :
00554 
00555     Given a handle to an object <span class="keyword">this</span> routine returns a pointer
00556     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> body of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object with proper ref counts
00557 
00558 Arguments:
00559 
00560     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - Supplies a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being referenced.  It can
00561         also be <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> result of NtCurrentProcess or NtCurrentThread
00562 
00563     DesiredAccess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access being requested by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller
00564 
00565     ObjectType - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object we
00566         are expecting
00567 
00568     AccessMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access
00569 
00570     Object - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object body <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation
00571         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successful
00572 
00573     HandleInformation - Optionally receives information regarding <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00574         input handle.
00575 
00576 Return Value:
00577 
00578     An appropriate <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> value
00579 
00580 --*/
00581 
00582 {
00583     ACCESS_MASK GrantedAccess;
00584     <a class="code" href="../../d6/d3/struct__HANDLE__TABLE.html">PHANDLE_TABLE</a> HandleTable;
00585     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00586     <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a> ObjectTableEntry;
00587     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process;
00588     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00589     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread;
00590     BOOLEAN AttachedToProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00591 
00592     <a class="code" href="../../d5/d1/obp_8h.html#a2">ObpValidateIrql</a>(<span class="stringliteral">"ObReferenceObjectByHandle"</span>);
00593 
00594     <span class="comment">//</span>
00595     <span class="comment">//  Protect ourselves from being interrupted while we hold a handle table</span>
00596     <span class="comment">//  entry lock</span>
00597     <span class="comment">//</span>
00598 
00599     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
00600 
00601     <span class="keywordflow">try</span> {
00602 
00603         <span class="comment">//</span>
00604         <span class="comment">//  If the handle is equal to the current process handle and the object</span>
00605         <span class="comment">//  type is NULL or type process, then attempt to translate a handle to</span>
00606         <span class="comment">//  the current process. Otherwise, check if the handle is the current</span>
00607         <span class="comment">//  thread handle.</span>
00608         <span class="comment">//</span>
00609 
00610         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> == NtCurrentProcess()) {
00611 
00612             <span class="keywordflow">if</span> ((ObjectType == <a class="code" href="../../d9/d8/ntos_8h.html#a2">PsProcessType</a>) || (ObjectType == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00613 
00614                 Process = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>();
00615                 GrantedAccess = Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o54">GrantedAccess</a>;
00616 
00617                 <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/se_8h.html#a8">SeComputeDeniedAccesses</a>(GrantedAccess, DesiredAccess) == 0) ||
00618                     (AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>)) {
00619 
00620                     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(Process);
00621 
00622                     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(HandleInformation)) {
00623 
00624                         HandleInformation-&gt;GrantedAccess = GrantedAccess;
00625                         HandleInformation-&gt;HandleAttributes = 0;
00626                     }
00627 
00628                     <a class="code" href="../../d5/d1/obp_8h.html#a3">ObpIncrPointerCount</a>(ObjectHeader);
00629                     *Object = Process;
00630 
00631                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( *Object != NULL );
00632 
00633                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00634                     leave;
00635 
00636                 } <span class="keywordflow">else</span> {
00637 
00638                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_ACCESS_DENIED;
00639                 }
00640 
00641             } <span class="keywordflow">else</span> {
00642 
00643                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_OBJECT_TYPE_MISMATCH;
00644             }
00645 
00646         <span class="comment">//</span>
00647         <span class="comment">//  If the handle is equal to the current thread handle and the object</span>
00648         <span class="comment">//  type is NULL or type thread, then attempt to translate a handle to</span>
00649         <span class="comment">//  the current thread. Otherwise, the we'll try and translate the</span>
00650         <span class="comment">//  handle</span>
00651         <span class="comment">//</span>
00652 
00653         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> == NtCurrentThread()) {
00654 
00655             <span class="keywordflow">if</span> ((ObjectType == <a class="code" href="../../d9/d8/ntos_8h.html#a3">PsThreadType</a>) || (ObjectType == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00656 
00657                 Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
00658                 GrantedAccess = Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o27">GrantedAccess</a>;
00659 
00660                 <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/se_8h.html#a8">SeComputeDeniedAccesses</a>(GrantedAccess, DesiredAccess) == 0) ||
00661                     (AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>)) {
00662 
00663                     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(Thread);
00664 
00665                     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(HandleInformation)) {
00666 
00667                         HandleInformation-&gt;GrantedAccess = GrantedAccess;
00668                         HandleInformation-&gt;HandleAttributes = 0;
00669                     }
00670 
00671                     <a class="code" href="../../d5/d1/obp_8h.html#a3">ObpIncrPointerCount</a>(ObjectHeader);
00672                     *Object = Thread;
00673 
00674                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( *Object != NULL );
00675 
00676                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00677                     leave;
00678 
00679                 } <span class="keywordflow">else</span> {
00680 
00681                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_ACCESS_DENIED;
00682                 }
00683 
00684             } <span class="keywordflow">else</span> {
00685 
00686                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_OBJECT_TYPE_MISMATCH;
00687             }
00688 
00689         <span class="comment">//</span>
00690         <span class="comment">//  Otherwise the handle is not a built in value.  It must be an index</span>
00691         <span class="comment">//  into a handle table.</span>
00692         <span class="comment">//</span>
00693 
00694         } <span class="keywordflow">else</span> {
00695 
00696 <span class="preprocessor">    #if DBG</span>
00697 <span class="preprocessor"></span>            <span class="comment">//</span>
00698             <span class="comment">//  On checked builds, check that if the Kernel handle bit is set,</span>
00699             <span class="comment">//  then we're coming from Kernel mode. We should probably fail the</span>
00700             <span class="comment">//  call if bit set &amp;&amp; !Kmode</span>
00701             <span class="comment">//</span>
00702             <span class="comment">//  We know we're NOT a builtin handle at this point</span>
00703             <span class="comment">//</span>
00704 
00705             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((Handle &lt; 0) ? (AccessMode == KernelMode) : TRUE);
00706 <span class="preprocessor">    #endif</span>
00707 <span class="preprocessor"></span>
00708             <span class="comment">//</span>
00709             <span class="comment">//  First get a pointer to either the processes handle table or the</span>
00710             <span class="comment">//  global kernel handle table.  If it is the kernel handle then we</span>
00711             <span class="comment">//  need to clear the handle bit and attach to the system process</span>
00712             <span class="comment">//</span>
00713 
00714             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ioverifier_8c.html#a14">IsKernelHandle</a>( Handle, AccessMode )) {
00715 
00716                 <span class="comment">//</span>
00717                 <span class="comment">//  Make the handle look like a regular handle</span>
00718                 <span class="comment">//</span>
00719 
00720                 <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = <a class="code" href="../../d5/d1/obp_8h.html#a27">DecodeKernelHandle</a>( Handle );
00721 
00722                 <span class="comment">//</span>
00723                 <span class="comment">//  The global kernel handle table</span>
00724                 <span class="comment">//</span>
00725 
00726                 HandleTable = <a class="code" href="../../d5/d1/obp_8h.html#a54">ObpKernelHandleTable</a>;
00727 
00728             } <span class="keywordflow">else</span> {
00729 
00730                 HandleTable = <a class="code" href="../../d5/d1/obp_8h.html#a12">ObpGetObjectTable</a>();
00731             }
00732 
00733             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(HandleTable != NULL);
00734 
00735             <span class="comment">//</span>
00736             <span class="comment">//  Translate the specified handle to an object table index.</span>
00737             <span class="comment">//</span>
00738 
00739             ObjectTableEntry = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>( HandleTable, Handle );
00740 
00741             <span class="comment">//</span>
00742             <span class="comment">//  Make sure the object table entry really does exist</span>
00743             <span class="comment">//</span>
00744 
00745             <span class="keywordflow">if</span> (ObjectTableEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00746 
00747                 ObjectHeader = (<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a>)(((ULONG_PTR)(ObjectTableEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o0">Object</a>)) &amp; ~<a class="code" href="../../d5/d1/obp_8h.html#a17">OBJ_HANDLE_ATTRIBUTES</a>);
00748 
00749                 <span class="keywordflow">if</span> ((ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a> == ObjectType) || (ObjectType == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00750 
00751 <span class="preprocessor">    #if i386 &amp;&amp; !FPO</span>
00752 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (<a class="code" href="../../d9/d2/ldrp_8h.html#a33">NtGlobalFlag</a> &amp; FLG_KERNEL_STACK_TRACE_DB) {
00753 
00754                         <span class="keywordflow">if</span> ((AccessMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) || ARGUMENT_PRESENT(HandleInformation)) {
00755 
00756                             GrantedAccess = ObpTranslateGrantedAccessIndex( ObjectTableEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o3">GrantedAccessIndex</a> );
00757                         }
00758 
00759                     } <span class="keywordflow">else</span> {
00760 
00761                         GrantedAccess = ObjectTableEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o2">GrantedAccess</a>;
00762                     }
00763 <span class="preprocessor">    #else</span>
00764 <span class="preprocessor"></span>                    GrantedAccess = ObjectTableEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o2">GrantedAccess</a>;
00765 
00766 <span class="preprocessor">    #endif // i386 &amp;&amp; !FPO</span>
00767 <span class="preprocessor"></span>
00768                     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/se_8h.html#a8">SeComputeDeniedAccesses</a>(GrantedAccess, DesiredAccess) == 0) ||
00769                         (AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>)) {
00770 
00771                         <span class="comment">//</span>
00772                         <span class="comment">//  Access to the object is allowed. Return the handle</span>
00773                         <span class="comment">//  information is requested, increment the object</span>
00774                         <span class="comment">//  pointer count, unlock the handle table and return</span>
00775                         <span class="comment">//  a success status.</span>
00776                         <span class="comment">//</span>
00777                         <span class="comment">//  Note that this is the only successful return path</span>
00778                         <span class="comment">//  out of this routine if the user did not specify</span>
00779                         <span class="comment">//  the current process or current thread in the input</span>
00780                         <span class="comment">//  handle.</span>
00781                         <span class="comment">//</span>
00782 
00783                         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(HandleInformation)) {
00784 
00785                             HandleInformation-&gt;GrantedAccess = GrantedAccess;
00786                             HandleInformation-&gt;HandleAttributes = ObjectTableEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o1">ObAttributes</a> &amp; <a class="code" href="../../d5/d1/obp_8h.html#a17">OBJ_HANDLE_ATTRIBUTES</a>;
00787                         }
00788 
00789                         <a class="code" href="../../d5/d1/obp_8h.html#a3">ObpIncrPointerCount</a>(ObjectHeader);
00790                         *Object = &amp;ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o11">Body</a>;
00791 
00792                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( *Object != NULL );
00793 
00794                         <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a>( HandleTable, ObjectTableEntry );
00795 
00796                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00797                         leave;
00798 
00799                     } <span class="keywordflow">else</span> {
00800 
00801                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_ACCESS_DENIED;
00802                     }
00803 
00804                 } <span class="keywordflow">else</span> {
00805 
00806                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_OBJECT_TYPE_MISMATCH;
00807                 }
00808 
00809                 <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a>( HandleTable, ObjectTableEntry );
00810 
00811             } <span class="keywordflow">else</span> {
00812 
00813                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_HANDLE;
00814             }
00815         }
00816 
00817         <span class="comment">//</span>
00818         <span class="comment">//  If we are attached to the system process then return</span>
00819         <span class="comment">//  back to our caller</span>
00820         <span class="comment">//</span>
00821 
00822         <span class="keywordflow">if</span> (AttachedToProcess) {
00823 
00824             <a class="code" href="../../d3/d5/procobj_8c.html#a7">KeDetachProcess</a>();
00825         }
00826 
00827         <span class="comment">//</span>
00828         <span class="comment">//  No handle translation is possible. Set the object address to NULL</span>
00829         <span class="comment">//  and return an error status.</span>
00830         <span class="comment">//</span>
00831 
00832         *Object = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00833 
00834     } finally {
00835 
00836         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00837     }
00838 
00839     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00840 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a75" doxytag="ob.h::ObReferenceObjectByName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObReferenceObjectByName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Attributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> PassedAccessState&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK DesiredAccess&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID ParseContext&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a78" doxytag="ob.h::ObReferenceObjectByPointer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS ObReferenceObjectByPointer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d0/obref_8c-source.html#l01022">1022</a> of file <a class="el" href="../../d8/d0/obref_8c-source.html">obref.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00143">ObpIncrPointerCount</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00368">ObpSymbolicLinkObjectType</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l07495">IoRegisterPlugPlayNotification()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l03038">NtImpersonateAnonymousToken()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00367">ObOpenObjectByPointer()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00501">ObpParseSymbolicLink()</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00187">obtest()</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00133">ParseAProc()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l03858">RawInputThread()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01235">VdmpDelayInterrupt()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00114">xxxDesktopThread()</a>, and <a class="el" href="../../d7/d2/queue_8c-source.html#l05713">xxxSetCsrssThreadDesktop()</a>.
<p>
<pre class="fragment"><div>01031                    :
01032 
01033     This routine adds another reference count to an object denoted by
01034     a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object body
01035 
01036 Arguments:
01037 
01038     Object - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being referenced
01039 
01040     DesiredAccess - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired access <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference
01041 
01042     ObjectType - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> according to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller
01043 
01044     AccessMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access
01045 
01046 Return Value:
01047 
01048     STATUS_SUCCESS <span class="keywordflow">if</span> successful and STATUS_OBJECT_TYPE_MISMATCH otherwise
01049 
01050 --*/
01051 
01052 {
01053     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
01054 
01055     <span class="comment">//</span>
01056     <span class="comment">//  Translate the pointer to the object body to a pointer to the</span>
01057     <span class="comment">//  object header</span>
01058     <span class="comment">//</span>
01059 
01060     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
01061 
01062     <span class="comment">//</span>
01063     <span class="comment">//  If the specified object type does not match and either the caller is</span>
01064     <span class="comment">//  not kernel mode or it is not a symbolic link object then it is an</span>
01065     <span class="comment">//  error</span>
01066     <span class="comment">//</span>
01067 
01068     <span class="keywordflow">if</span> ((ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a> != ObjectType) &amp;&amp; (AccessMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ||
01069                                                ObjectType == <a class="code" href="../../d5/d1/obp_8h.html#a43">ObpSymbolicLinkObjectType</a>)) {
01070 
01071         <span class="keywordflow">return</span>( STATUS_OBJECT_TYPE_MISMATCH );
01072     }
01073 
01074     <span class="comment">//</span>
01075     <span class="comment">//  Otherwise increment the pointer count and return success to</span>
01076     <span class="comment">//  our caller</span>
01077     <span class="comment">//</span>
01078 
01079     <a class="code" href="../../d5/d1/obp_8h.html#a3">ObpIncrPointerCount</a>( ObjectHeader );
01080 
01081     <span class="keywordflow">return</span>( STATUS_SUCCESS );
01082 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a92" doxytag="ob.h::ObReleaseObjectSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ObReleaseObjectSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryAllocated</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/obse_8c-source.html#l01418">1418</a> of file <a class="el" href="../../d0/d1/obse_8c-source.html">obse.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00700">ObpDereferenceSecurityDescriptor()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00602">ObpCheckObjectReference()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01121">ObpProcessDosDeviceSymbolicLink()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, and <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>.
<p>
<pre class="fragment"><div>01425                    :
01426 
01427     This function will free up any memory associated with a queried
01428     security descriptor.  This undoes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function <a class="code" href="../../d4/d0/ob_8h.html#a91">ObGetObjectSecurity</a>
01429 
01430 Arguments:
01431 
01432     SecurityDescriptor - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor
01433         to be freed.
01434 
01435     MemoryAllocated - Supplies whether or not we should free <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01436         memory pointed to by SecurityDescriptor.
01437 
01438 Return Value:
01439 
01440     None.
01441 
01442 --*/
01443 
01444 {
01445     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01446 
01447     <span class="comment">//</span>
01448     <span class="comment">//  Check if there is a security descriptor to actually free</span>
01449     <span class="comment">//</span>
01450 
01451     <span class="keywordflow">if</span> ( SecurityDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01452 
01453         <span class="comment">//</span>
01454         <span class="comment">//  If ObGetObjectSecurity allocated memory then we</span>
01455         <span class="comment">//  need to free it. Otherwise what the earlier routine did</span>
01456         <span class="comment">//  was reference the object to keep the security descriptor</span>
01457         <span class="comment">//  to keep it from going away</span>
01458         <span class="comment">//</span>
01459 
01460         <span class="keywordflow">if</span> (MemoryAllocated) {
01461 
01462             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( SecurityDescriptor );
01463 
01464         } <span class="keywordflow">else</span> {
01465 
01466             <a class="code" href="../../d8/d1/obsdata_8c.html#a20">ObpDereferenceSecurityDescriptor</a>( SecurityDescriptor );
01467         }
01468     }
01469 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a87" doxytag="ob.h::ObSetDeviceMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObSetDeviceMap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetProcess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>DirectoryHandle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00030">30</a> of file <a class="el" href="../../d8/d9/obdevmap_8c-source.html">obdevmap.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00213">_OBJECT_DIRECTORY::DeviceMap</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00259">_EPROCESS::DeviceMap</a>, <a class="el" href="../../d4/d2/tob_8c-source.html#l00063">DirectoryHandle</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00416">ObDereferenceDeviceMap()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00098">ObpDeviceMapLock</a>, <a class="el" href="../../d6/d0/obp_8h-source.html#l00367">ObpDirectoryObjectType</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00249">ObSystemDeviceMap</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00243">_DEVICE_MAP::ReferenceCount</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, and <a class="el" href="../../d1/d0/obinit_8c-source.html#l01349">ObpCreateDosDevicesDirectory()</a>.
<p>
<pre class="fragment"><div>00037                    :
00038 
00039     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device map <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified process, <span class="keyword">using</span>
00040     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified object directory.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> device map <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a structure
00041     associated with an object directory and a process.  When <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00042     manager sees a references to a name beginning with \??\ or just \??,
00043     then <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> follows <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device map object in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling process's
00044     <a class="code" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a> structure to get to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object directory to use <span class="keywordflow">for</span> that
00045     reference.  This allows multiple <span class="keyword">virtual</span> \??  object directories on
00046     a per process basis.  The WindowStation logic will use <span class="keyword">this</span>
00047     functionality to allocate devices unique to each WindowStation.
00048 
00049 Arguments:
00050 
00051     TargetProcess - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target process to associate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device map
00052         with.  If null then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> directory
00053         becomes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system <span class="keywordflow">default</span> dos device map.
00054 
00055     <a class="code" href="../../d3/d3/tob_8c.html#a23">DirectoryHandle</a> - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object directory to associate with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00056         device map.
00057 
00058 
00059 Return Value:
00060 
00061     Returns one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following status codes:
00062 
00063         STATUS_SUCCESS - normal, successful completion.
00064 
00065         STATUS_SHARING_VIOLATION - The specified object directory <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already
00066             associated with a device map.
00067 
00068         STATUS_INSUFFICIENT_RESOURCES - Unable to allocate <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device
00069             map data structure;
00070 
00071         STATUS_ACCESS_DENIED - Caller did not have DIRECTORY_TRAVERSE access
00072             to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified object directory.
00073 
00074 --*/
00075 
00076 {
00077     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00078     <a class="code" href="../../d8/d4/struct__OBJECT__DIRECTORY.html">POBJECT_DIRECTORY</a> DosDevicesDirectory;
00079     <a class="code" href="../../d2/d4/struct__DEVICE__MAP.html">PDEVICE_MAP</a> DeviceMap;
00080     PVOID Object;
00081     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00082     KIRQL OldIrql;
00083 
00084     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00085 
00086     <span class="comment">//</span>
00087     <span class="comment">//  Reference the object directory handle and see if it is already</span>
00088     <span class="comment">//  associated with a device map structure.  If so, fail this call.</span>
00089     <span class="comment">//</span>
00090 
00091     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>( DirectoryHandle,
00092                                         DIRECTORY_TRAVERSE,
00093                                         ObpDirectoryObjectType,
00094                                         KeGetPreviousMode(),
00095                                         &amp;DosDevicesDirectory,
00096                                         NULL );
00097 
00098     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00099 
00100         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00101     }
00102 
00103     <span class="comment">//</span>
00104     <span class="comment">//  Capture the device map</span>
00105     <span class="comment">//</span>
00106     
00107     ExAcquireSpinLock( &amp;ObpDeviceMapLock, &amp;OldIrql );
00108     
00109     DeviceMap = DosDevicesDirectory-&gt;<a class="code" href="../../d8/d4/struct__OBJECT__DIRECTORY.html#o4">DeviceMap</a>;
00110     
00111     <span class="comment">//</span>
00112     <span class="comment">//  Check if the directory already has a dos device map</span>
00113     <span class="comment">//</span>
00114     
00115     <span class="keywordflow">if</span> (DeviceMap != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00116         
00117         <span class="comment">//</span>
00118         <span class="comment">//  Test if the DeviceMap is about to delete and has the</span>
00119         <span class="comment">//  ReferenceCount 0</span>
00120         <span class="comment">//</span>
00121     
00122         <span class="keywordflow">if</span> (DeviceMap-&gt;<a class="code" href="../../d2/d4/struct__DEVICE__MAP.html#o0">ReferenceCount</a> != 0) {
00123         
00124             <span class="comment">//</span>
00125             <span class="comment">//  We have a dos device map, so setup the target process to be either</span>
00126             <span class="comment">//  what the caller specified or the current process</span>
00127             <span class="comment">//</span>
00128 
00129             <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Target = TargetProcess;
00130 
00131             <span class="keywordflow">if</span> (Target == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00132 
00133                 Target = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>();
00134             }
00135 
00136             <span class="comment">//</span>
00137             <span class="comment">//  If the current process already has the exact same dos device map</span>
00138             <span class="comment">//  then everything is already done and nothing left for us to do.</span>
00139             <span class="comment">//</span>
00140 
00141             <span class="keywordflow">if</span> (Target-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o59">DeviceMap</a> == DeviceMap) {
00142 
00143                 ExReleaseSpinLock( &amp;ObpDeviceMapLock, OldIrql );
00144                 
00145                 <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( DosDevicesDirectory );
00146 
00147                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00148             }
00149 
00150             <span class="comment">//</span>
00151             <span class="comment">//  Add a new reference before releasing the spinlock</span>
00152             <span class="comment">//  to make sure nobody will release the devicemap while</span>
00153             <span class="comment">//  we try to attach to the process.</span>
00154             <span class="comment">//</span>
00155             
00156             DeviceMap-&gt;<a class="code" href="../../d2/d4/struct__DEVICE__MAP.html#o0">ReferenceCount</a>++;
00157 
00158             ExReleaseSpinLock( &amp;ObpDeviceMapLock, OldIrql );
00159         
00160             <span class="comment">//</span>
00161             <span class="comment">//  We can dereference the target processes device map because it</span>
00162             <span class="comment">//  no longer will have it's old dos device map.</span>
00163             <span class="comment">//</span>
00164 
00165             <a class="code" href="../../d7/d0/obdevmap_8c.html#a3">ObDereferenceDeviceMap</a> ( Target );
00166 
00167             <span class="comment">//</span>
00168             <span class="comment">//  Now setup the new device map that we were feed in.  We lock it</span>
00169             <span class="comment">//  bump its ref count, make the targe process point to it, unlock it,</span>
00170             <span class="comment">//  and return to our caller</span>
00171             <span class="comment">//</span>
00172 
00173             ExAcquireSpinLock( &amp;ObpDeviceMapLock, &amp;OldIrql );
00174 
00175             Target-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o59">DeviceMap</a> = DeviceMap;
00176 
00177             ExReleaseSpinLock( &amp;ObpDeviceMapLock, OldIrql );
00178 
00179             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( DosDevicesDirectory );
00180 
00181             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00182         }
00183     }
00184 
00185     ExReleaseSpinLock( &amp;ObpDeviceMapLock, OldIrql );
00186     
00187     <span class="comment">//</span>
00188     <span class="comment">//  The input directory does not have a dos device map. so we'll</span>
00189     <span class="comment">//  allocate and initialize a new device map structure.</span>
00190     <span class="comment">//</span>
00191 
00192     DeviceMap = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( NonPagedPool, <span class="keyword">sizeof</span>( *DeviceMap ), 'mDbO' );
00193 
00194     <span class="keywordflow">if</span> (DeviceMap == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00195 
00196         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( DosDevicesDirectory );
00197         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INSUFFICIENT_RESOURCES;
00198 
00199     } <span class="keywordflow">else</span> {
00200 
00201         RtlZeroMemory( DeviceMap, <span class="keyword">sizeof</span>( *DeviceMap ) );
00202 
00203         DeviceMap-&gt;<a class="code" href="../../d2/d4/struct__DEVICE__MAP.html#o0">ReferenceCount</a> = 1;
00204         DeviceMap-&gt;<a class="code" href="../../d2/d4/struct__DEVICE__MAP.html#o1">DosDevicesDirectory</a> = DosDevicesDirectory;
00205 
00206         DosDevicesDirectory-&gt;<a class="code" href="../../d8/d4/struct__OBJECT__DIRECTORY.html#o4">DeviceMap</a> = DeviceMap;
00207 
00208         <span class="comment">//</span>
00209         <span class="comment">//  If the caller specified a target process then remove the</span>
00210         <span class="comment">//  processes device map if in use and replace it with the new</span>
00211         <span class="comment">//  one, otherwise set this new device map to the system wide one</span>
00212         <span class="comment">//  and put it into the current process</span>
00213         <span class="comment">//</span>
00214 
00215         <span class="keywordflow">if</span> (TargetProcess != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00216 
00217             <a class="code" href="../../d7/d0/obdevmap_8c.html#a3">ObDereferenceDeviceMap</a> ( TargetProcess );
00218 
00219             TargetProcess-&gt;DeviceMap = DeviceMap;
00220 
00221         } <span class="keywordflow">else</span> {
00222 
00223             <a class="code" href="../../d4/d0/ob_8h.html#a41">ObSystemDeviceMap</a> = DeviceMap;
00224 
00225             <a class="code" href="../../d7/d0/obdevmap_8c.html#a3">ObDereferenceDeviceMap</a> ( <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>() );
00226 
00227             <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;DeviceMap = DeviceMap;
00228         }
00229     }
00230 
00231     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00232 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a99" doxytag="ob.h::ObSetSecurityObjectByPointer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObSetSecurityObjectByPointer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SECURITY_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/obse_8c-source.html#l00174">174</a> of file <a class="el" href="../../d0/d1/obse_8c-source.html">obse.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00168">_OBJECT_TYPE_INITIALIZER::GenericMapping</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00173">_OBJECT_TYPE_INITIALIZER::PoolType</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00312">_OBJECT_HEADER::SecurityDescriptor</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00181">_OBJECT_TYPE_INITIALIZER::SecurityProcedure</a>, <a class="el" href="../../d0/d5/se_8h.html#a200a108">SetSecurityDescriptor</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00196">_OBJECT_TYPE::TypeInfo</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04759">IopChangeDeviceObjectFromRegistryProperties()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08959">IopSetSecurityObjectFromRegistry()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l00046">NtSetSecurityObject()</a>.
<p>
<pre class="fragment"><div>00182                    :
00183 
00184     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to invoke an object's security routine.  It
00185     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object's security state.
00186 
00187     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> accessible <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel and assumes that all
00188     necessary validation of parameters has been done by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.
00189 
00190 Arguments:
00191 
00192     Object - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being modified
00193 
00194     SecurityInformation - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of information we are
00195         interested in setting. e.g., owner, group, dacl, or sacl.
00196 
00197     SecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00198         object being modified.
00199 
00200 Return Value:
00201 
00202     An appropriate <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> value
00203 
00204 --*/
00205 
00206 {
00207     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00208     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00209     <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> ObjectType;
00210 
00211     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00212 
00213 <span class="comment">//    DbgPrint("ObSetSecurityObjectByPointer called for object %#08lx with info "</span>
00214 <span class="comment">//             "%x and descriptor %#08lx\n",</span>
00215 <span class="comment">//             Object, SecurityInformation, SecurityDescriptor);</span>
00216 
00217     <span class="comment">//</span>
00218     <span class="comment">//  Map the object body to an object header and the corresponding</span>
00219     <span class="comment">//  object type</span>
00220     <span class="comment">//</span>
00221 
00222     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
00223     ObjectType = ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>;
00224 
00225     <span class="comment">//</span>
00226     <span class="comment">//  Make sure the passed security descriptor is really there.</span>
00227     <span class="comment">//</span>
00228 
00229     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ARGUMENT_PRESENT( SecurityDescriptor ));
00230 
00231     <span class="comment">//</span>
00232     <span class="comment">//  Now invoke the security procedure call back to set the security</span>
00233     <span class="comment">//  descriptor for the object</span>
00234     <span class="comment">//</span>
00235 
00236     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o17">SecurityProcedure</a>)
00237                 ( Object,
00238                   <a class="code" href="../../d0/d5/se_8h.html#a200a108">SetSecurityDescriptor</a>,
00239                   &amp;SecurityInformation,
00240                   SecurityDescriptor,
00241                   <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00242                   &amp;ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o10">SecurityDescriptor</a>,
00243                   ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o9">PoolType</a>,
00244                   &amp;ObjectType-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o9">TypeInfo</a>.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o4">GenericMapping</a> );
00245 
00246 
00247 <span class="comment">//    DbgPrint("ObSetSecurityObjectByPointer: object security routine returned "</span>
00248 <span class="comment">//             "%#08lx\n", Status);</span>
00249 
00250     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00251 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a94" doxytag="ob.h::ObValidateSecurityQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObValidateSecurityQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NewSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/obse_8c-source.html#l01473">1473</a> of file <a class="el" href="../../d0/d1/obse_8c-source.html">obse.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00306">_OBJECT_HEADER::Flags</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00352">OB_FLAG_DEFAULT_SECURITY_QUOTA</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00362">OBJECT_HEADER_TO_QUOTA_INFO</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00062">SE_DEFAULT_SECURITY_QUOTA</a>, and <a class="el" href="../../d5/d9/ob_8h-source.html#l00319">_OBJECT_HEADER_QUOTA_INFO::SecurityDescriptorCharge</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>.
<p>
<pre class="fragment"><div>01480                    :
01481 
01482     This routine will check to see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> security information
01483     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> larger than <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allowed by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object's pre-allocated quota.
01484 
01485 Arguments:
01486 
01487     Object - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object whose information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
01488         modified.
01489 
01490     NewSize - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> proposed <span class="keyword">new</span> security
01491         information.
01492 
01493 Return Value:
01494 
01495     STATUS_SUCCESS - New size <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within alloted quota.
01496 
01497     STATUS_QUOTA_EXCEEDED - The desired adjustment would have exceeded
01498         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> permitted security quota <span class="keywordflow">for</span> <span class="keyword">this</span> object.
01499 
01500 --*/
01501 
01502 {
01503     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
01504     <a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html">POBJECT_HEADER_QUOTA_INFO</a> QuotaInfo;
01505 
01506     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01507 
01508     <span class="comment">//</span>
01509     <span class="comment">//  Map the object body to its object header and corresponding</span>
01510     <span class="comment">//  quota information block</span>
01511     <span class="comment">//</span>
01512 
01513     ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
01514     QuotaInfo = <a class="code" href="../../d4/d0/ob_8h.html#a10">OBJECT_HEADER_TO_QUOTA_INFO</a>( ObjectHeader );
01515 
01516     <span class="comment">//</span>
01517     <span class="comment">//  If there isn't any quota info and the new size is greater</span>
01518     <span class="comment">//  then the default security quota then if the object uses</span>
01519     <span class="comment">//  the default value then we've exceeded quota otherwise</span>
01520     <span class="comment">//  let the caller get the quota</span>
01521     <span class="comment">//</span>
01522 
01523     <span class="keywordflow">if</span> ((QuotaInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NewSize &gt; <a class="code" href="../../d0/d5/se_8h.html#a0">SE_DEFAULT_SECURITY_QUOTA</a>)) {
01524 
01525         <span class="keywordflow">if</span> (!(ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o7">Flags</a> &amp; <a class="code" href="../../d4/d0/ob_8h.html#a6">OB_FLAG_DEFAULT_SECURITY_QUOTA</a>)) {
01526 
01527             <span class="comment">//</span>
01528             <span class="comment">//  Should really charge quota here.</span>
01529             <span class="comment">//</span>
01530 
01531             <span class="keywordflow">return</span>( STATUS_SUCCESS );
01532         }
01533 
01534         <span class="keywordflow">return</span>( STATUS_QUOTA_EXCEEDED );
01535 
01536     <span class="comment">//</span>
01537     <span class="comment">//  If the quota is not null and the new size is greater than the</span>
01538     <span class="comment">//  allowed quota charge then if the charge is zero we grant the</span>
01539     <span class="comment">//  request otherwise we've exceeded quota.</span>
01540     <span class="comment">//</span>
01541     <span class="comment">//  **** this logic seems wierd</span>
01542     <span class="comment">//</span>
01543 
01544     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((QuotaInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (NewSize &gt; QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o2">SecurityDescriptorCharge</a>)) {
01545 
01546         <span class="keywordflow">if</span> (QuotaInfo-&gt;<a class="code" href="../../d1/d6/struct__OBJECT__HEADER__QUOTA__INFO.html#o2">SecurityDescriptorCharge</a> == 0) {
01547 
01548             <span class="comment">//</span>
01549             <span class="comment">//  Should really charge quota here.</span>
01550             <span class="comment">//</span>
01551 
01552             <span class="comment">//  QuotaInfo-&gt;SecurityDescriptorCharge = SeComputeSecurityQuota( NewSize );</span>
01553 
01554             <span class="keywordflow">return</span>( STATUS_SUCCESS );
01555         }
01556 
01557         <span class="keywordflow">return</span>( STATUS_QUOTA_EXCEEDED );
01558 
01559     <span class="comment">//</span>
01560     <span class="comment">//  Otherwise we have two cases.  (1) there isn't any quota info but</span>
01561     <span class="comment">//  the size is within limits or (2) there is a quota info block and</span>
01562     <span class="comment">//  the size is within the specified security descriptor charge so</span>
01563     <span class="comment">//  return success to our caller</span>
01564     <span class="comment">//</span>
01565 
01566     } <span class="keywordflow">else</span> {
01567 
01568         <span class="keywordflow">return</span>( STATUS_SUCCESS );
01569     }
01570 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a80" doxytag="ob.h::ObWaitForSingleObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ObWaitForSingleObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Alertable</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER Timeout&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d1/obwait_8c-source.html#l00837">837</a> of file <a class="el" href="../../d2/d1/obwait_8c-source.html">obwait.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00190">_OBJECT_TYPE::DefaultObject</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00302">_OBJECT_HEADER::Type</a>, and <a class="el" href="../../d4/d9/ke_8h.html#a407a204">UserRequest</a>.
<p>
<pre class="fragment"><div>00845                    :
00846 
00847     Please refer to <a class="code" href="../../d1/d2/obwait_8c.html#a4">NtWaitForSingleObject</a>
00848 
00849 Arguments:
00850 
00851     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>  - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wait object.
00852 
00853     Alertable - Supplies a <span class="keywordtype">boolean</span> value that specifies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wait
00854         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> alertable.
00855 
00856     Timeout - Supplies an pointer to an absolute or relative time over
00857         which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wait <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to occur.
00858 
00859 Return Value:
00860 
00861     The wait completion status. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of STATUS_TIMEOUT <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> a
00862     timeout occurred.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of STATUS_SUCCESS <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00863     object satisfied <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wait.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of STATUS_ALERTED <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00864     wait was aborted to deliver an alert to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of
00865     STATUS_USER_APC <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wait was aborted to deliver a user
00866     APC to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread.
00867 
00868 --*/
00869 
00870 {
00871     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">POBJECT_HEADER</a> ObjectHeader;
00872     PVOID Object;
00873     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00874     PVOID WaitObject;
00875 
00876     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00877 
00878     <span class="comment">//</span>
00879     <span class="comment">//  Get a referenced pointer to the specified object with synchronize</span>
00880     <span class="comment">//  access.</span>
00881     <span class="comment">//</span>
00882 
00883     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>( Handle,
00884                                         SYNCHRONIZE,
00885                                         (<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>)NULL,
00886                                         KernelMode,
00887                                         &amp;Object,
00888                                         NULL );
00889 
00890     <span class="comment">//</span>
00891     <span class="comment">//  If access is granted, then check to determine if the specified object</span>
00892     <span class="comment">//  can be waited on.</span>
00893     <span class="comment">//</span>
00894 
00895     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00896 
00897         ObjectHeader = <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>( Object );
00898 
00899         <span class="keywordflow">if</span> ((LONG_PTR)ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o3">DefaultObject</a> &lt; 0) {
00900 
00901             WaitObject = (PVOID)ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o3">DefaultObject</a>;
00902 
00903         } <span class="keywordflow">else</span> {
00904 
00905             WaitObject = (PVOID)((PCHAR)Object + (ULONG_PTR)ObjectHeader-&gt;<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o3">Type</a>-&gt;<a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html#o3">DefaultObject</a>);
00906         }
00907 
00908         <span class="comment">//</span>
00909         <span class="comment">//  Protect the wait call just in case KeWait decides</span>
00910         <span class="comment">//  to raise For example, a mutant level is exceeded</span>
00911         <span class="comment">//</span>
00912 
00913         <span class="keywordflow">try</span> {
00914 
00915             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>( WaitObject,
00916                                             UserRequest,
00917                                             KernelMode,
00918                                             Alertable,
00919                                             Timeout );
00920 
00921         } except(EXCEPTION_EXECUTE_HANDLER) {
00922 
00923             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00924         }
00925 
00926         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(Object);
00927     }
00928 
00929     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00930 }
}
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a41" doxytag="ob.h::ObSystemDeviceMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d4/struct__DEVICE__MAP.html">PDEVICE_MAP</a> <a class="el" href="../../d0/d1/obinit_8c.html#a11">ObSystemDeviceMap</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d9/ob_8h-source.html#l00249">249</a> of file <a class="el" href="../../d5/d9/ob_8h-source.html">ob.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00343">ObInheritDeviceMap()</a>, <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00236">ObQueryDeviceMapInformation()</a>, and <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00030">ObSetDeviceMap()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:57 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
