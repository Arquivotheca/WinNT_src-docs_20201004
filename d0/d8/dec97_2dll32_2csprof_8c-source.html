<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: csprof.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>csprof.c</h1><a href="../../d9/d8/dec97_2dll32_2csprof_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="preprocessor">#include "<a class="code" href="../../d0/d0/dec97_2dll32_2generic_8h.html">generic.h</a>"</span>
00002 
00003 <span class="comment">//#pragma code_seg(_ICM2SEG)</span>
00004 <span class="preprocessor">#pragma optimize("",off)</span>
00005 <span class="preprocessor"></span>
<a name="l00006"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a1">00006</a> <span class="preprocessor">#define TempBfSize 128</span>
<a name="l00007"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a2">00007</a> <span class="preprocessor"></span><span class="preprocessor">#define LINELENG   128</span>
00008 <span class="preprocessor"></span>
<a name="l00009"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a3">00009</a> <span class="keyword">static</span>  <span class="keywordtype">char</span>    <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>[]       = <span class="stringliteral">"\n"</span> ;
<a name="l00010"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a4">00010</a> <span class="keyword">static</span>  <span class="keywordtype">char</span>    <a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a4">ASCII85DecodeBegine</a>[] = <span class="stringliteral">"&lt;~"</span>;
<a name="l00011"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a5">00011</a> <span class="keyword">static</span>  <span class="keywordtype">char</span>    <a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a5">ASCII85DecodeEnd</a>[] = <span class="stringliteral">"~&gt; cvx exec "</span>;
00012 
00013 <span class="comment">//******************************************************************</span>
00014 <span class="comment">//   Local functions to deal with output to the memory buffer</span>
00015 
<a name="l00016"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a6">00016</a> <span class="keyword">static</span>  <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a6">CPLastError</a>;
00017 
<a name="l00018"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a7">00018</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a>     <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(SINT LastError)
00019 {
00020     <a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a6">CPLastError</a> = LastError;
00021     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00022 }
00023 
<a name="l00024"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a8">00024</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a>     <a class="code" href="../../d8/d8/aug98_2dll32_2csprof_8c.html#a8">GetCPLastError</a>()
00025 {
00026     <span class="keywordflow">return</span>(<a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a6">CPLastError</a>);
00027 }
00028 
<a name="l00029"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a9">00029</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(SINT Size, HGLOBAL FAR *hMemory, LPMEMPTR lpMH)
00030 {
00031     HGLOBAL hMem;
00032     <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>  lpMem;
00033 
00034     *hMemory = 0;
00035     <span class="keywordflow">if</span>(lpMH == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
00036     {
00037         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00038         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00039     }
00040 
00041     hMem = GlobalAlloc(GHND, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) ;
00042     <span class="keywordflow">if</span>(hMem == 0 )
00043     {
00044         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a40">CP_MEMORY_ALLOC_ERR</a>);
00045         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00046     }
00047 
00048     lpMem = GlobalLock(hMem);
00049     <span class="keywordflow">if</span>(lpMem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
00050     {
00051         GlobalFree(hMem);
00052         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a40">CP_MEMORY_ALLOC_ERR</a>);
00053         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00054     }
00055     *lpMH = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>)lpMem ;
00056     *hMemory = hMem;
00057     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00058 }
00059 
<a name="l00060"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a10">00060</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(HGLOBAL hMem)
00061 {
00062     <span class="keywordflow">if</span>(hMem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
00063     {
00064         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00065         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00066     }
00067 
00068     GlobalUnlock(hMem);
00069     GlobalFree(hMem) ;
00070     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00071 }
00072 
00073 <span class="comment">//******************************************************************</span>
00074 <span class="comment">//      Low-level Profile functions - used for individual tag access</span>
00075 <span class="comment">//******************************************************************</span>
00076 
<a name="l00077"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a11">00077</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a7">LoadCP</a>(LPCSTR filename, HGLOBAL FAR *phMem, LPCHANDLE lpCP)
00078 {
00079     <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>    CPHeader;
00080     HFILE       hFile;
00081     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>        Res, CPSize;
00082     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>      mpCP;
00083     OFSTRUCT    OFStruct;
00084 
00085     *phMem = 0;
00086     <span class="keywordflow">if</span> (lpCP == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00087     {
00088         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00089         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00090     }
00091 
00092     hFile = OpenFile(filename, &amp;OFStruct, OF_READ );
00093     <span class="keywordflow">if</span>( hFile == HFILE_ERROR )
00094     {
00095         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a41">CP_FILE_OPEN_ERR</a>);
00096         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00097     }
00098  
00099     Res = _lread(hFile, (<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>) &amp;CPHeader, <span class="keyword">sizeof</span>(CPHeader));
00100     <span class="keywordflow">if</span>( (Res == HFILE_ERROR) ||
00101         (Res != <span class="keyword">sizeof</span>(CPHeader)) )
00102     {
00103         _close(hFile);
00104         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a42">CP_FILE_READ_ERR</a>);
00105         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00106     }
00107 
00108     <span class="comment">// Make the initial check for validity of the profile</span>
00109     <span class="keywordflow">if</span>( <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>(CPHeader.magic) != <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a0">icMagicNumber</a> )
00110     {
00111         _close(hFile);
00112         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a43">CP_FORMAT_ERR</a>);
00113         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00114     }
00115 
00116     CPSize = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>(CPHeader.size);
00117     <span class="keywordflow">if</span>( <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(CPSize, phMem, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;mpCP) )
00118     {
00119 
00120         *lpCP = (<a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a5">CHANDLE</a>) mpCP;  <span class="comment">// Put the memory pointer as  handle</span>
00121         <span class="comment">// Read profile into  memory</span>
00122          _lseek(hFile, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>, SEEK_SET);
00123 
00124         <span class="keywordflow">while</span>(CPSize)
00125         {
00126             Res = _lread(hFile, (<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>) mpCP, 4096);
00127             <span class="keywordflow">if</span> (Res == HFILE_ERROR) 
00128             {
00129                 _close(hFile);
00130                 <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a42">CP_FILE_READ_ERR</a>);
00131                 <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00132             }
00133             mpCP    += Res;
00134             CPSize  -= Res;
00135         }
00136     }<span class="keywordflow">else</span>
00137     {
00138         *phMem = 0;
00139         _close(hFile);
00140         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00141     }
00142     _close(hFile);
00143     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00144 }
00145 
00146 <span class="preprocessor">#ifdef ICMDLL</span>
00147 <span class="preprocessor"></span><span class="comment">//******************************************************************</span>
00148 <span class="comment">//      Low-level Profile functions - used for individual tag access</span>
00149 <span class="comment">//******************************************************************</span>
00150 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a8">LoadCP32</a>(LPCSTR filename, HGLOBAL *phMem, LPCHANDLE lpCP)
00151 {
00152     <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>    CPHeader;
00153     HANDLE      hFile;
00154     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>        Res, CPSize;
00155     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>      mpCP;
00156     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        Success;
00157 
00158     <span class="keywordflow">if</span> (lpCP == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00159     {
00160         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(CP_NULL_POINTER_ERR);
00161         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00162     }
00163     hFile = CreateFile(filename, GENERIC_READ, 0, NULL, OPEN_EXISTING, 0, NULL);
00164     <span class="keywordflow">if</span>( hFile == <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a> )
00165     {
00166         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(CP_FILE_OPEN_ERR);
00167         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00168     }
00169 
00170     Success = ReadFile(hFile, (LPVOID) &amp;CPHeader, <span class="keyword">sizeof</span>(CPHeader), &amp;Res, NULL);
00171     <span class="keywordflow">if</span>( ( !Success ) || (Res != <span class="keyword">sizeof</span>(CPHeader)) )
00172     {
00173         CloseHandle(hFile);
00174         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(CP_FILE_READ_ERR);
00175         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00176     }
00177 
00178     <span class="comment">// Make the initial check for validity of the profile</span>
00179     <span class="keywordflow">if</span>( <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>(CPHeader.magic) != <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a0">icMagicNumber</a> )
00180     {
00181         CloseHandle(hFile);
00182         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(CP_FORMAT_ERR);
00183         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00184     }
00185 
00186     CPSize = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>(CPHeader.size);
00187     <span class="keywordflow">if</span>( <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(CPSize, phMem, (LPMEMPTR) &amp;mpCP) )
00188     {
00189 
00190         *lpCP = (<a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a5">CHANDLE</a>) mpCP;  <span class="comment">// Put the memory pointer as  handle</span>
00191         <span class="comment">// Read profile into  memory</span>
00192         SetFilePointer(hFile, 0L, NULL, FILE_BEGIN);
00193         Success = ReadFile(hFile, (LPVOID) (LPVOID)mpCP, CPSize, &amp;Res, NULL);
00194         <span class="keywordflow">if</span> (!Success) 
00195         {
00196             CloseHandle(hFile);
00197             <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(CP_FILE_READ_ERR);
00198             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00199         }
00200     }<span class="keywordflow">else</span>
00201     {
00202         CloseHandle(hFile);
00203         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00204     }
00205     CloseHandle(hFile);
00206     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00207 }
00208 <span class="preprocessor">#endif</span>
00209 <span class="preprocessor"></span>
<a name="l00210"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a12">00210</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a9">FreeCP</a>(HGLOBAL hMem)
00211 {
00212     <span class="keywordflow">return</span>( <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(hMem) );
00213 }
00214 
00215 
<a name="l00216"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a13">00216</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a13">GetCPElementCount</a>(CHANDLE CP, LPSINT lpCount)
00217 {
00218     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a32">lpcpTagList</a> lpTL;
00219     <span class="keywordflow">if</span> (lpCount == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00220     {
00221         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00222         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00223     }
00224     lpTL = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a32">lpcpTagList</a>) &amp;(((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a30">lpcpProfile</a>)CP)-&gt;count);
00225     *lpCount = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>(lpTL-&gt;count);
00226     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00227 }
00228 
00229 
<a name="l00230"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a14">00230</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a14">GetCPElementInfo</a>(CHANDLE CP, SINT Index,
00231                                 LPMEMPTR lpTagData, LPMEMPTR lpElemData)
00232 {
00233     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00234     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a32">lpcpTagList</a> lpTL;
00235 
00236     <span class="keywordflow">if</span> ( (lpTagData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (lpElemData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) )
00237     {
00238         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00239         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00240     }
00241 
00242     lpTL = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a32">lpcpTagList</a>) &amp;(((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a30">lpcpProfile</a>)CP)-&gt;count);
00243     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>   = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>(lpTL-&gt;count);
00244     <span class="keywordflow">if</span> ( <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> &lt;= <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> )
00245     {
00246         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a44">CP_OUT_OF_RANGE_ERR</a>);
00247         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00248     }
00249     *lpTagData      = ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>) &amp;(lpTL-&gt;tags[0])) + (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d4/structicTag.html">icTag</a>)) ;
00250     *lpElemData     = ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>) CP) +
00251                                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a33">lpcpTag</a>)*lpTagData)-&gt;offset);
00252     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00253 }
00254 
00255 
00256 <span class="comment">/* Checks if the profile has all required fields  for</span>
00257 <span class="comment">    this specific type of the color profile             */</span>
<a name="l00258"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a15">00258</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a10">ValidateCP</a>(CHANDLE CP)
00259 {
00260     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    Result;
00261     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a17">CSIG</a>    ProfileClass;
00262 
00263     <span class="keywordflow">if</span>(<a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a25">GetCPClass</a>(CP, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a27">LPCSIG</a>) &amp;ProfileClass) )
00264     {
00265         <span class="comment">// All profiles must have a ProfileDescription and</span>
00266         <span class="comment">//  a Copyright  tags.</span>
00267 
00268         <span class="keywordflow">if</span>( !<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a44">icSigProfileDescriptionTag</a>) || 
00269             !<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a29">icSigCopyrightTag</a> ) )
00270         {
00271             <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a46">CP_NOT_FOUND_ERR</a>);
00272             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00273         }
00274 
00275         <span class="comment">// All profiles, except Device-link, must have a mediaWhitePoint Tag</span>
00276         <span class="keywordflow">switch</span>( ProfileClass )
00277         {
00278             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a125">icSigLinkClass</a> :        <span class="comment">/* 'link' */</span>
00279                 <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>) &amp;&amp;
00280                     <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a45">icSigProfileSequenceDescTag</a>)
00281                   )
00282                 {
00283                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00284                 }<span class="keywordflow">else</span>
00285                 {
00286                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00287                 }
00288                 <span class="keywordflow">break</span>;
00289 
00290             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a122">icSigInputClass</a>:       <span class="comment">/* 'scnr' */</span>
00291                 <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a33">icSigGrayTRCTag</a>) ||
00292                     <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>)      )
00293                 {
00294                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00295                 }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a34">icSigGreenColorantTag</a>) )
00296                 {
00297                     <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a55">icSigRedColorantTag</a>) &amp;&amp;
00298                         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a21">icSigBlueColorantTag</a>) &amp;&amp;
00299                         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a56">icSigRedTRCTag</a>) &amp;&amp;
00300                         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a35">icSigGreenTRCTag</a>) &amp;&amp;
00301                         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a22">icSigBlueTRCTag</a>)
00302                       )
00303                     {
00304                         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00305                     }<span class="keywordflow">else</span>
00306                     {
00307                         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00308                     }
00309                 }<span class="keywordflow">else</span>
00310                 {
00311                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00312                 }
00313                 Result  &amp;= <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a39">icSigMediaWhitePointTag</a>);
00314                 <span class="keywordflow">break</span>;
00315 
00316             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a123">icSigDisplayClass</a>:     <span class="comment">/* 'mntr' */</span>
00317                 <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a33">icSigGrayTRCTag</a>) )
00318                 {
00319                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00320                 }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a34">icSigGreenColorantTag</a>) )
00321                 {
00322                     <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a55">icSigRedColorantTag</a>) &amp;&amp;
00323                         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a21">icSigBlueColorantTag</a>) &amp;&amp;
00324                         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a56">icSigRedTRCTag</a>) &amp;&amp;
00325                         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a35">icSigGreenTRCTag</a>) &amp;&amp;
00326                         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a22">icSigBlueTRCTag</a>)
00327                       )
00328                     {
00329                         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00330                     }<span class="keywordflow">else</span>
00331                     {
00332                         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00333                     }
00334                 }<span class="keywordflow">else</span>
00335                 {
00336                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00337                 }
00338                 Result  &amp;= <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a39">icSigMediaWhitePointTag</a>);
00339                 <span class="keywordflow">break</span>;
00340 
00341             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a124">icSigOutputClass</a>:      <span class="comment">/* 'prtr' */</span>
00342                 <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a33">icSigGrayTRCTag</a>) )
00343                 {
00344                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00345                 }<span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>) &amp;&amp;
00346                           <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a18">icSigAToB1Tag</a>) &amp;&amp;
00347                           <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a19">icSigAToB2Tag</a>) &amp;&amp;
00348                           <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a23">icSigBToA0Tag</a>) &amp;&amp;
00349                           <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a24">icSigBToA1Tag</a>) &amp;&amp;
00350                           <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a25">icSigBToA2Tag</a>) &amp;&amp;
00351                           <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a32">icSigGamutTag</a>) 
00352                         )
00353                 {
00354                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00355                 }<span class="keywordflow">else</span>
00356                 {
00357                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00358                 }
00359                 Result  &amp;= <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a39">icSigMediaWhitePointTag</a>);
00360                 <span class="keywordflow">break</span>;
00361 
00362             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a126">icSigAbstractClass</a>:    <span class="comment">/* 'abst' */</span>
00363                 <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>) )
00364                 {
00365                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00366                 }<span class="keywordflow">else</span>
00367                 {
00368                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00369                 }
00370                 Result  &amp;= <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a39">icSigMediaWhitePointTag</a>);
00371                 <span class="keywordflow">break</span>;
00372 
00373             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a127">icSigColorSpaceClass</a>:  <span class="comment">/* 'spac' */</span>
00374                 <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>) &amp;&amp;
00375                     <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a23">icSigBToA0Tag</a>)
00376                   )
00377                 {
00378                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00379                 }<span class="keywordflow">else</span>
00380                 {
00381                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00382                 }
00383                 Result  &amp;= <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CP, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a39">icSigMediaWhitePointTag</a>);
00384                 <span class="keywordflow">break</span>;
00385 
00386             <span class="keywordflow">default</span>:
00387                 Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00388                 <span class="keywordflow">break</span>;
00389         }
00390     }<span class="keywordflow">else</span>
00391     {
00392         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00393     }
00394     <span class="keywordflow">if</span>( Result == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> )
00395     {
00396         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a46">CP_NOT_FOUND_ERR</a>);
00397     }
00398     <span class="keywordflow">return</span>(Result);
00399 }
00400 
<a name="l00401"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a16">00401</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(CHANDLE CP, CSIG CPTag)
00402 {
00403     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00404     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>   Data;
00405     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a32">lpcpTagList</a> lpTL;
00406 
00407     lpTL = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a32">lpcpTagList</a>) &amp;(((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a30">lpcpProfile</a>)CP)-&gt;count);
00408     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>   = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>(lpTL-&gt;count);
00409     Data    = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>)  &amp;(lpTL-&gt;tags[0]) ; 
00410     <span class="keywordflow">while</span> ( <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>-- )
00411     {
00412         <span class="keywordflow">if</span>(  <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a33">lpcpTag</a>)Data)-&gt;sig) == CPTag )
00413         {
00414             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00415         }<span class="keywordflow">else</span>
00416         {
00417             Data    += <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d4/structicTag.html">icTag</a>);   <span class="comment">// Bump pointer to the next tag</span>
00418         }
00419     }
00420     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00421 }
00422 
00423 
<a name="l00424"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a17">00424</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a12">GetCPTagIndex</a>(CHANDLE CP, CSIG CPTag, LPSINT lpIndex)
00425 {
00426     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00427     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>   Data;
00428     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    i;
00429     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a32">lpcpTagList</a> lpTL;
00430 
00431     <span class="keywordflow">if</span> (lpIndex == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00432     {
00433         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00434         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00435     }
00436 
00437     lpTL = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a32">lpcpTagList</a>) &amp;(((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a30">lpcpProfile</a>)CP)-&gt;count);
00438     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>   = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>(lpTL-&gt;count);
00439     Data    = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>)  &amp;(lpTL-&gt;tags[0]) ;
00440 
00441     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>; i++ )
00442     {
00443         <span class="keywordflow">if</span>(  <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a33">lpcpTag</a>)Data)-&gt;sig) == CPTag )
00444         {
00445             *lpIndex = i;
00446             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00447         }<span class="keywordflow">else</span>
00448         {
00449             Data    += <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d4/structicTag.html">icTag</a>);   <span class="comment">// Bump pointer to the next tag</span>
00450         }
00451     }
00452 
00453     <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a46">CP_NOT_FOUND_ERR</a>);
00454     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00455 }
00456 
00457 
00458 
<a name="l00459"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a18">00459</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a15">GetCPTagSig</a>(CHANDLE CP, SINT Index, LPCSIG lpCPTag)
00460 {
00461     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>   TagData, ElemData;
00462     <span class="keywordflow">if</span> (lpCPTag == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00463     {
00464         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00465         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00466     }
00467     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a14">GetCPElementInfo</a>(CP, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;TagData,
00468             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;ElemData) )
00469     {
00470         *lpCPTag    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a33">lpcpTag</a>)TagData)-&gt;sig ) ;
00471     }<span class="keywordflow">else</span>
00472     {
00473         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00474     }
00475     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00476 }
00477 
00478 <span class="comment">//***************************************************************</span>
00479 <span class="comment">//      Function applicable to the elements</span>
00480 <span class="comment">//</span>
00481 <span class="comment">//***************************************************************</span>
00482 
<a name="l00483"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a19">00483</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a16">GetCPElementType</a>(CHANDLE CP, SINT Index, LPCSIG lpCSig)
00484 {
00485     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>   TagData, ElemData;
00486     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a14">GetCPElementInfo</a>(CP, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;TagData,
00487             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;ElemData) )
00488     {
00489         *lpCSig    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a34">lpcpTagBase</a>)ElemData)-&gt;sig ) ;
00490     }<span class="keywordflow">else</span>
00491     {
00492         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00493     }
00494     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00495 }
00496 
00497 
00498 
<a name="l00499"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a20">00499</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d9/ps2_8c.html#a194">GetCPElementSize</a>(CHANDLE CP, SINT Index, LPSINT lpSize)
00500 {
00501     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>   TagData, ElemData;
00502     <span class="keywordflow">if</span> (lpSize == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00503     {
00504         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00505         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00506     }
00507 
00508     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a14">GetCPElementInfo</a>(CP, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;TagData,
00509             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;ElemData) )
00510     {
00511         *lpSize     = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a33">lpcpTag</a>)TagData)-&gt;size );
00512     }<span class="keywordflow">else</span>
00513     {
00514         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00515     }
00516 
00517     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00518 }
00519 
<a name="l00520"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a21">00520</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(CHANDLE CP, SINT Index, LPSINT lpSize)
00521 {
00522     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>  TagData, ElemData;
00523     <span class="keywordflow">if</span> (lpSize == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00524     {
00525         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00526         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00527     }
00528 
00529     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a14">GetCPElementInfo</a>(CP, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;TagData,
00530             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;ElemData) )
00531     {
00532 <span class="comment">//  Changed by jjia 8/24/95</span>
00533 <span class="comment">//        *lpSize     = ui32toSINT( ((lpcpTag)TagData)-&gt;size ) -</span>
00534 <span class="comment">//                                             sizeof(lpcpTagBase);</span>
00535     *lpSize    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a33">lpcpTag</a>)TagData)-&gt;size) - 
00536                     <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d4/structicTagBase.html">icTagBase</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a186">icUInt32Number</a>);
00537     }<span class="keywordflow">else</span>
00538     {
00539         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00540     }
00541 
00542     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00543 }
00544 
00545 <span class="comment">//***************************************************************</span>
00546 <span class="comment">//  The difference between GetCPElement and GetCPElementData</span>
00547 <span class="comment">//  is that GetCPElement reads all fields of the element,</span>
00548 <span class="comment">//  including the data tag, reserved fields and element data,</span>
00549 <span class="comment">//  while GetCPElementData only reads the actual data.</span>
00550 <span class="comment">//  Number of bytes that are required to hold the whole data element can be</span>
00551 <span class="comment">//  obtained by calling the function GetCPElementSize().</span>
00552 <span class="comment">//  The actulal number of data bytes is determined by</span>
00553 <span class="comment">//  the call to GetCPElementDataSize().</span>
00554 <span class="comment">//***************************************************************</span>
<a name="l00555"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a22">00555</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a19">GetCPElement</a>(CHANDLE CP, SINT Index,
00556                                MEMPTR lpData, SINT Size)
00557 {
00558     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>        ElemSize;
00559     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>      TagData, ElemData;
00560     <span class="keywordflow">if</span> (lpData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00561     {
00562         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00563         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00564     }
00565 
00566     <span class="keywordflow">if</span> ( !<a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a14">GetCPElementInfo</a>(CP, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;TagData,
00567             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;ElemData) )
00568     {
00569         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00570     }
00571     ElemSize    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a33">lpcpTag</a>)TagData)-&gt;size);
00572     <span class="keywordflow">if</span>(ElemSize &gt; <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> )
00573     {
00574         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a45">CP_NO_MEMORY_ERR</a>);
00575         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00576     }
00577     MemCopy(lpData, ElemData, ElemSize);
00578     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00579 
00580 }
00581 
00582 
<a name="l00583"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a23">00583</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(CHANDLE CP, SINT Index,
00584                                 MEMPTR lpData, SINT Size)
00585 {
00586     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>     ElemSize;
00587     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>   TagData, ElemData;
00588     <span class="keywordflow">if</span> (lpData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00589     {
00590         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00591         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00592     }
00593 
00594     <span class="keywordflow">if</span> ( !<a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a14">GetCPElementInfo</a>(CP, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;TagData,
00595             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;ElemData) )
00596     {
00597         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00598     }
00599 <span class="comment">//  Changed by jjia 8/24/95</span>
00600 <span class="comment">//    ElemData    +=  sizeof(lpcpTagBase);</span>
00601 <span class="comment">//    ElemSize    = ui32toSINT( ((lpcpTag)TagData)-&gt;size) - </span>
00602 <span class="comment">//                     sizeof(lpcpTagBase);</span>
00603     ElemData    +=  <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d4/structicTagBase.html">icTagBase</a>) + <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a186">icUInt32Number</a>);
00604     ElemSize    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a33">lpcpTag</a>)TagData)-&gt;size) - 
00605                     <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d4/structicTagBase.html">icTagBase</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a186">icUInt32Number</a>);
00606 
00607     <span class="keywordflow">if</span>(ElemSize &gt; <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> )
00608     {
00609         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a45">CP_NO_MEMORY_ERR</a>);
00610         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00611     }
00612 
00613     MemCopy(lpData, ElemData, ElemSize);
00614     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00615 }
00616 
00617 <span class="comment">// Check the data format is binary or ascii    8/22/95  jjia</span>
00618 
<a name="l00619"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a24">00619</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d9/ps2_8c.html#a195">GetCPElementDataType</a>(CHANDLE CP, SINT Index, <span class="keywordtype">long</span> far *lpDataType)
00620 {
00621     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>   TagData, ElemData;
00622 
00623     <span class="keywordflow">if</span> (lpDataType == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00624     {
00625         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00626         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00627     }
00628 
00629     <span class="keywordflow">if</span> ( !<a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a14">GetCPElementInfo</a>(CP, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;TagData,
00630             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp;ElemData) )
00631     {
00632         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00633     }
00634     ElemData    +=  <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d4/structicTagBase.html">icTagBase</a>);
00635     *lpDataType = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>( ((<a class="code" href="../../d6/d1/structicData.html">icData</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a0">__huge</a> *)ElemData)-&gt;dataFlag);
00636     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00637 }
00638 
<a name="l00639"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a25">00639</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a14">ValidateCPElement</a>(CHANDLE CP, SINT Index)
00640 {
00641     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a17">CSIG</a>    TagSig, DataSig;
00642     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    Result;
00643     <span class="keywordflow">if</span>( <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a15">GetCPTagSig</a>(CP, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a27">LPCSIG</a>) &amp;TagSig) &amp;&amp;
00644         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a16">GetCPElementType</a>(CP, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a27">LPCSIG</a>) &amp;DataSig) )
00645     {
00646         <span class="keywordflow">switch</span>(TagSig)
00647         {
00648             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>:
00649             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a18">icSigAToB1Tag</a>:
00650             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a19">icSigAToB2Tag</a>:
00651             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a23">icSigBToA0Tag</a>:
00652             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a24">icSigBToA1Tag</a>:
00653             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a25">icSigBToA2Tag</a>:
00654             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a32">icSigGamutTag</a>:
00655             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a41">icSigPreview0Tag</a>:
00656             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a42">icSigPreview1Tag</a>:
00657             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a43">icSigPreview2Tag</a>:
00658                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a90">icSigLut16Type</a>) ||
00659                          (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a91">icSigLut8Type</a>) ;
00660                 <span class="keywordflow">break</span>;
00661 
00662             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a55">icSigRedColorantTag</a>: 
00663             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a34">icSigGreenColorantTag</a>:
00664             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a21">icSigBlueColorantTag</a>:
00665             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a36">icSigLuminanceTag</a>:
00666             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a38">icSigMediaBlackPointTag</a>:
00667             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a39">icSigMediaWhitePointTag</a>:
00668                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a107">icSigXYZType</a>);
00669                 <span class="keywordflow">break</span>;
00670 
00671             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a56">icSigRedTRCTag</a>:
00672             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a35">icSigGreenTRCTag</a>:
00673             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a22">icSigBlueTRCTag</a>:
00674             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a33">icSigGrayTRCTag</a>:
00675                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a87">icSigCurveType</a>);
00676                 <span class="keywordflow">break</span>;
00677 
00678             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a46">icSigPs2CRD0Tag</a>:
00679             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a47">icSigPs2CRD1Tag</a>:
00680             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a48">icSigPs2CRD2Tag</a>:
00681             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a49">icSigPs2CRD3Tag</a>:
00682             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a50">icSigPs2CSATag</a>:
00683             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a51">icSigPs2Intent0Tag</a>:
00684             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a52">icSigPs2Intent1Tag</a>:
00685             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a53">icSigPs2Intent2Tag</a>:
00686             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a54">icSigPs2Intent3Tag</a>:
00687                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a88">icSigDataType</a>);
00688                 <span class="keywordflow">break</span>;
00689 
00690             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a28">icSigCharTargetTag</a>:
00691             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a29">icSigCopyrightTag</a>:
00692                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a98">icSigTextType</a>);
00693                 <span class="keywordflow">break</span>;
00694 
00695             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a27">icSigCalibrationDateTimeTag</a>:
00696                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a89">icSigDateTimeType</a>);
00697                 <span class="keywordflow">break</span>;
00698 
00699             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a30">icSigDeviceMfgDescTag</a>:
00700             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a31">icSigDeviceModelDescTag</a>:
00701             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a44">icSigProfileDescriptionTag</a>:
00702             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a57">icSigScreeningDescTag</a>:
00703             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a61">icSigViewingCondDescTag</a>:
00704                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a99">icSigTextDescriptionType</a>);
00705                 <span class="keywordflow">break</span>;
00706 
00707             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a37">icSigMeasurementTag</a>:
00708                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a37">icSigMeasurementTag</a>);
00709                 <span class="keywordflow">break</span>;
00710 
00711             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a40">icSigNamedColorTag</a>:
00712                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a40">icSigNamedColorTag</a>);
00713                 <span class="keywordflow">break</span>;
00714         
00715             <span class="keywordflow">case</span>      <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a45">icSigProfileSequenceDescTag</a>:
00716                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a45">icSigProfileSequenceDescTag</a>);
00717                 <span class="keywordflow">break</span>;
00718 
00719             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a58">icSigScreeningTag</a>:
00720                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a58">icSigScreeningTag</a>);
00721                 <span class="keywordflow">break</span>;
00722 
00723             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a59">icSigTechnologyTag</a>:
00724                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a97">icSigSignatureType</a>);
00725                 <span class="keywordflow">break</span>;
00726 
00727             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a60">icSigUcrBgTag</a>:
00728                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a60">icSigUcrBgTag</a>);
00729                 <span class="keywordflow">break</span>;
00730 
00731             <span class="keywordflow">case</span>     <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a62">icSigViewingConditionsTag</a>:
00732                 Result = (DataSig == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a62">icSigViewingConditionsTag</a>);
00733                 <span class="keywordflow">break</span>;
00734 
00735             <span class="keywordflow">default</span>:
00736                 Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00737                 <span class="keywordflow">break</span>;
00738         }
00739     }<span class="keywordflow">else</span>
00740     {
00741         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00742     }
00743     <span class="keywordflow">return</span>(Result);
00744 }
00745 
00746 <span class="comment">//******************************************************************</span>
00747 <span class="comment">// Functions that get all information from the Color Profile Header</span>
00748 <span class="comment">//******************************************************************</span>
<a name="l00749"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a26">00749</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a22">GetCPSize</a>(CHANDLE CP, LPSINT lpSize)
00750 {
00751     <span class="keywordflow">if</span> (lpSize == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00752     {
00753         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00754         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00755     }
00756     *lpSize    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;size);
00757     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00758 }
00759 
<a name="l00760"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a27">00760</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a23">GetCPCMMType</a>(CHANDLE CP, LPCSIG lpType)
00761 {
00762     <span class="keywordflow">if</span> (lpType == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00763     {
00764         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00765         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00766     }
00767     *lpType    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;cmmId);
00768     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00769 }
00770 
<a name="l00771"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a28">00771</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a24">GetCPVersion</a>(CHANDLE CP, LPSINT lpVers)
00772 {
00773     <span class="keywordflow">if</span> (lpVers == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00774     {
00775         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00776         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00777     }
00778     *lpVers    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;version);
00779     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00780 }
00781 
<a name="l00782"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a29">00782</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a25">GetCPClass</a>(CHANDLE CP, LPCSIG lpClass)
00783 {
00784     <span class="keywordflow">if</span> (lpClass == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00785     {
00786         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00787         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00788     }
00789     *lpClass    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;deviceClass);
00790     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00791 }
00792 
<a name="l00793"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a30">00793</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d9/ps2_8c.html#a41">GetCPDevSpace</a>(CHANDLE CP, LPCSIG lpInSpace)
00794 {
00795     <span class="keywordflow">if</span> (lpInSpace == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00796     {
00797         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00798         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00799     }
00800     *lpInSpace    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;colorSpace);
00801     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00802 }
00803 
<a name="l00804"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a31">00804</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d9/ps2_8c.html#a40">GetCPConnSpace</a>(CHANDLE CP, LPCSIG lpOutSpace)
00805 {
00806     <span class="keywordflow">if</span> (lpOutSpace == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00807     {
00808         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00809         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00810     }
00811     *lpOutSpace    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;<a class="code" href="../../d7/d3/monitor_8c.html#a2">pcs</a>);
00812     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00813 }
00814 
<a name="l00815"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a32">00815</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a28">GetCPTarget</a>(CHANDLE CP, LPCSIG lpTarget)
00816 {
00817     <span class="keywordflow">if</span> (lpTarget == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00818     {
00819         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00820         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00821     }
00822     *lpTarget    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;platform);
00823     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00824 }
00825 
<a name="l00826"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a33">00826</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a29">GetCPManufacturer</a>(CHANDLE CP, LPCSIG lpManuf)
00827 {
00828     <span class="keywordflow">if</span> (lpManuf == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00829     {
00830         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00831         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00832     }
00833     *lpManuf    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;manufacturer);
00834     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00835 }
00836 
<a name="l00837"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a34">00837</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a30">GetCPModel</a>(CHANDLE CP, LPCSIG lpModel)
00838 {
00839     <span class="keywordflow">if</span> (lpModel == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00840     {
00841         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00842         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00843     }
00844     *lpModel    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;model);
00845     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00846 }
00847 
<a name="l00848"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a35">00848</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a31">GetCPFlags</a>(CHANDLE CP, LPSINT lpFlags)
00849 {
00850     <span class="keywordflow">if</span> (lpFlags == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00851     {
00852         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00853         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00854     }
00855     *lpFlags    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;flags);
00856     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00857 }
00858 
<a name="l00859"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a36">00859</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d9/ps2_8c.html#a42">GetCPRenderIntent</a>(CHANDLE CP, LPSINT lpIntent)
00860 {
00861     <span class="keywordflow">if</span> (lpIntent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00862     {
00863         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00864         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00865     }
00866     *lpIntent    = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a3">ui32toSINT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;renderingIntent);
00867     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00868 }
00869 
<a name="l00870"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a37">00870</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(CHANDLE CP,  LPSFLOAT lpWP)
00871 {
00872     <span class="keywordflow">if</span> (lpWP == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00873     {
00874         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a39">SetCPLastError</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a48a39">CP_NULL_POINTER_ERR</a>);
00875         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00876     }
00877     lpWP[0]    = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a16">SFLOAT</a>) <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a9">si16f16toSFLOAT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;illuminant.X);
00878     lpWP[1]    = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a16">SFLOAT</a>) <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a9">si16f16toSFLOAT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;illuminant.Y);
00879     lpWP[2]    = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a16">SFLOAT</a>) <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a9">si16f16toSFLOAT</a>( ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a31">lpcpHeader</a>)CP)-&gt;illuminant.Z);
00880     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00881 }
00882 
<a name="l00883"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a38">00883</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a32">GetCPAttributes</a>(CHANDLE CP, LPATTRIB lpAttributes)
00884 {
00885     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00886 }
00887 
<a name="l00888"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a39">00888</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d2/d9/ps2_8c.html#a192">GetCPMediaWhitePoint</a>(CHANDLE cp,  LPSFLOAT lpMediaWP)
00889 {
00890     HGLOBAL   hTempMem;
00891     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>      TempSize;
00892     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>    TempBuff;
00893     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>    lpTable;
00894     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>      i, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00895 
00896     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a> (cp, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a39">icSigMediaWhitePointTag</a>) &amp;&amp;
00897         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a12">GetCPTagIndex</a> (cp, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a39">icSigMediaWhitePointTag</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a25">LPSINT</a>) &amp; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>) &amp;&amp;
00898         <a class="code" href="../../d2/d9/ps2_8c.html#a194">GetCPElementSize</a> (cp, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a25">LPSINT</a>) &amp; TempSize) &amp;&amp;
00899         <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a> (TempSize, (HGLOBAL *) &amp; hTempMem, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a29">LPMEMPTR</a>) &amp; TempBuff) &amp;&amp;
00900         <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a19">GetCPElement</a> (cp, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, TempBuff, TempSize))
00901     {
00902         lpTable = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>) &amp; (((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a38">lpcpXYZType</a>) TempBuff)-&gt;data);
00903         <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++)
00904         {
00905             lpMediaWP[i] = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a16">SFLOAT</a>) <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a9">si16f16toSFLOAT</a> (lpTable);
00906             lpTable += <span class="keyword">sizeof</span> (<a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a192">icS15Fixed16Number</a>);
00907         }
00908         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a> (hTempMem);
00909         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00910     }
00911     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00912 }
00913 
00914 <span class="comment">/***************************************************************************</span>
00915 <span class="comment">*                               GetPS2ColorRenderingIntent</span>
00916 <span class="comment">*  function:</span>
00917 <span class="comment">*    this is the function which creates the Intent string </span>
00918 <span class="comment">*    from the data supplied in the Profile that can be used</span>
00919 <span class="comment">*    in --findcolorrendering-- operator.</span>
00920 <span class="comment">*  prototype:</span>
00921 <span class="comment">*       BOOL EXTERN GetPS2ColorRenderingIntent(</span>
00922 <span class="comment">*                          char         *FileName,</span>
00923 <span class="comment">*                          DWORD        Intent, </span>
00924 <span class="comment">*                          MEMPTR       lpMem,</span>
00925 <span class="comment">*                          LPDWORD      lpcbSize )</span>
00926 <span class="comment">*  parameters:</span>
00927 <span class="comment">*       FileName    --  Color Profile Filename</span>
00928 <span class="comment">*       Intent      --  Intent </span>
00929 <span class="comment">*       lpMem       --  Pointer to the memory block</span>
00930 <span class="comment">*       lpcbSize        --  Size of the memory block</span>
00931 <span class="comment">*                       Returns number of bytes required/transferred</span>
00932 <span class="comment">*  returns:</span>
00933 <span class="comment">*       BOOL        --  TRUE   if the function was successful,</span>
00934 <span class="comment">*                       FALSE  otherwise.</span>
00935 <span class="comment">***************************************************************************/</span>
<a name="l00936"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a40">00936</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a28">GetPS2ColorRenderingIntent</a>(CHANDLE cp, DWORD Intent,
00937                                        MEMPTR lpMem, LPDWORD lpcbSize)
00938 {
00939     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>       <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00940     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>       <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00941         
00942     <span class="keywordflow">if</span> (!cp)
00943         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00944 
00945     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = (<a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>) *lpcbSize;
00946     <span class="keywordflow">if</span>( ( lpMem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) || ( <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> == 0 ) )
00947     {
00948         lpMem = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00949         <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = 0;
00950         *lpcbSize = 0;
00951     }
00952         
00953     <span class="keywordflow">switch</span>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a28">Intent</a>)
00954     {
00955         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a142">icPerceptual</a>:
00956         <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(cp, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a51">icSigPs2Intent0Tag</a>) &amp;&amp;
00957             <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a12">GetCPTagIndex</a>(cp, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a51">icSigPs2Intent0Tag</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a25">LPSINT</a>) &amp;<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>) &amp;&amp;
00958             <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(cp, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a25">LPSINT</a>) &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) &amp;&amp;
00959             ( ( lpMem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) ||
00960                 <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(cp, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, lpMem, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) ) )
00961         {
00962         }
00963         <span class="keywordflow">break</span>;
00964         
00965         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a143">icRelativeColorimetric</a>:
00966         <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(cp, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a52">icSigPs2Intent1Tag</a>) &amp;&amp;
00967             <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a12">GetCPTagIndex</a>(cp, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a52">icSigPs2Intent1Tag</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a25">LPSINT</a>) &amp;<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>) &amp;&amp;
00968             <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(cp, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a25">LPSINT</a>) &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) &amp;&amp;
00969             ( ( lpMem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) ||
00970                 <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(cp, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, lpMem, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) ) )
00971         {
00972         }
00973         <span class="keywordflow">break</span>;
00974     
00975         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a144">icSaturation</a>:
00976         <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(cp, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a53">icSigPs2Intent2Tag</a>) &amp;&amp;
00977             <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a12">GetCPTagIndex</a>(cp, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a53">icSigPs2Intent2Tag</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a25">LPSINT</a>) &amp;<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>) &amp;&amp;
00978             <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(cp, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a25">LPSINT</a>) &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) &amp;&amp;
00979             ( ( lpMem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) ||
00980                 <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(cp, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, lpMem, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> ) )
00981           )
00982         {
00983         }
00984         <span class="keywordflow">break</span>;
00985         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a>:
00986         <span class="keywordflow">if</span>( <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(cp, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a54">icSigPs2Intent3Tag</a>) &amp;&amp;
00987             <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a12">GetCPTagIndex</a>(cp, <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a54">icSigPs2Intent3Tag</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a25">LPSINT</a>) &amp;<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>) &amp;&amp;
00988             <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(cp, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a25">LPSINT</a>) &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) &amp;&amp;
00989             ( ( lpMem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) ||
00990                 <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(cp, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, lpMem, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) ) )
00991         {
00992         }
00993         <span class="keywordflow">break</span>;
00994         <span class="keywordflow">default</span>:
00995             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = 0 ;
00996         <span class="keywordflow">break</span>;
00997     }
00998         
00999     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> != 0)
01000     {
01001         <span class="keywordflow">if</span> (lpMem)
01002         {
01003             lpMem[<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>] = <span class="charliteral">'\0'</span>;
01004         }
01005         <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> ++;
01006         *lpcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
01007         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01008     }
01009     <span class="keywordflow">else</span>
01010     {
01011         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01012     }
01013 }
01014 
01015 <span class="comment">/***************************************************************************</span>
01016 <span class="comment">*</span>
01017 <span class="comment">*  Function to check if color matching mathod and icc profile type is </span>
01018 <span class="comment">*       supported by driver.</span>
01019 <span class="comment">*  parameters:</span>
01020 <span class="comment">*</span>
01021 <span class="comment">*  returns:</span>
01022 <span class="comment">*       BOOL:   TRUE or FALSE.</span>
01023 <span class="comment">*</span>
01024 <span class="comment">***************************************************************************/</span>
01025 
01026 <span class="preprocessor">#ifndef ICMDLL</span>
<a name="l01027"></a><a class="code" href="../../d5/d9/dec97_2test_2csprof_8h.html#a40">01027</a> <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a0">EXTERN</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a40">ValidColorSpace</a>(LPPDEVICE lppd, <a class="code" href="../../d0/d7/structtagICMINFO.html">LPICMINFO</a> lpICMI)
01028 {
01029     <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>    CPHeader;
01030     HFILE       hFile;
01031     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>        Res;
01032     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a17">CSIG</a>        CPColorSpaceTag;
01033 
01034     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> == lpICMI)
01035     {
01036         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01037     }
01038     hFile = _lopen(lpICMI-&gt;<a class="code" href="../../d0/d7/structtagICMINFO.html#o2">lcsDestFilename</a>, READ);
01039     <span class="keywordflow">if</span>( hFile == HFILE_ERROR )
01040     {
01041         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01042     }
01043 
01044     Res = _lread(hFile, (<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>) &amp;CPHeader, <span class="keyword">sizeof</span>(CPHeader));
01045     _lclose(hFile);
01046     <span class="keywordflow">if</span>( (Res == HFILE_ERROR) || (Res != <span class="keyword">sizeof</span>(CPHeader)) )
01047     {
01048         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01049     }
01050 
01051     <span class="comment">// Make the initial check for validity of the profile</span>
01052     <span class="keywordflow">if</span>( <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>(CPHeader.magic) != <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a0">icMagicNumber</a> )
01053     {
01054         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01055     }
01056     <span class="comment">// Make sure the profile is 'prtr'</span>
01057     <span class="keywordflow">if</span>( <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>(CPHeader.deviceClass) != <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a124">icSigOutputClass</a> )
01058     {
01059         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01060     }
01061     CPColorSpaceTag = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a10">SigtoCSIG</a>(CPHeader.colorSpace);
01062 
01063     <span class="keywordflow">switch</span> ( lppd-&gt;lpPSExtDevmode-&gt;dm.iColorMatchingMethod )
01064     {
01065         <span class="keywordflow">case</span> COLOR_MATCHING_ON_HOST:
01066             <span class="keywordflow">if</span> ((CPColorSpaceTag == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a119">icSigCmyData</a>) ||
01067                 (CPColorSpaceTag == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a114">icSigRgbData</a>))
01068 <span class="comment">//                (CPColorSpaceTag == icSigGrayData))</span>
01069             {
01070                 <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01071             }
01072             <span class="keywordflow">break</span>;
01073             <span class="keywordflow">case</span> COLOR_MATCHING_ON_PRINTER:
01074             <span class="keywordflow">if</span> ((CPColorSpaceTag == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a119">icSigCmyData</a>))
01075 <span class="comment">//                (CPColorSpaceTag == icSigGrayData))</span>
01076             {
01077                 <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01078             }
01079             <span class="keywordflow">break</span>;
01080         <span class="keywordflow">case</span> COLOR_MATCHING_PRINTER_CALIBRATION:
01081         <span class="keywordflow">default</span>:
01082             <span class="keywordflow">break</span>;
01083     }
01084     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01085 }
01086 <span class="preprocessor">#endif</span>
01087 <span class="preprocessor"></span>
01088 <span class="comment">//***************************************************************************</span>
01089 <span class="comment">//</span>
01090 <span class="comment">//      Set of functions to output data into memory buffer</span>
01091 <span class="comment">//</span>
01092 <span class="comment">//***************************************************************************</span>
01093 
01094 
01095 <span class="comment">/***************************************************************************</span>
01096 <span class="comment">*</span>
01097 <span class="comment">*   Function to put the chunk of memory as string of Hex</span>
01098 <span class="comment">*</span>
01099 <span class="comment">***************************************************************************/</span>
<a name="l01100"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a42">01100</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d2/d9/ps2_8c.html#a227">WriteHexBuffer</a>(MEMPTR lpMem, MEMPTR lpBuff, MEMPTR lpLineStart, DWORD dwBytes)
01101 {
01102     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    Res;
01103     <span class="keywordtype">char</span>    TempArray[<a class="code" href="../../d8/d8/aug98_2dll32_2csprof_8c.html#a1">TempBfSize</a>];
01104     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>  lpOldPtr = lpMem;
01105 
01106     <span class="keywordflow">for</span> ( ; dwBytes ; dwBytes-- )
01107     {
01108         Res = wsprintf( (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>)TempArray, (LPSTR) <span class="stringliteral">"%2.2x"</span>, *lpBuff );
01109         *lpMem++ = TempArray[0];
01110         *lpMem++ = TempArray[1];
01111         lpBuff++;
01112         <span class="keywordflow">if</span> (((<a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>)(lpMem - lpLineStart)) &gt; <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a4">MAX_LINELENG</a>)
01113         {
01114             lpLineStart = lpMem;
01115             lpMem += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(lpMem,  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01116         }
01117     }
01118     <span class="keywordflow">return</span>( (<a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>)(lpMem - lpOldPtr)); 
01119 }
01120 
01121 <span class="comment">/***************************************************************************</span>
01122 <span class="comment">*</span>
01123 <span class="comment">*   Function to put the string into the buffer</span>
01124 <span class="comment">*</span>
01125 <span class="comment">***************************************************************************/</span>
<a name="l01126"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a43">01126</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(MEMPTR lpMem, MEMPTR Obj)
01127 {
01128     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    Res;
01129 
01130     Res = lstrlen(Obj);
01131     MemCopy(lpMem, Obj, Res);
01132     <span class="keywordflow">return</span>( Res );
01133 }
01134 
<a name="l01135"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a44">01135</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a44">WriteObjectN</a>(MEMPTR lpMem, MEMPTR Obj, SINT n)
01136 {
01137     MemCopy(lpMem, Obj, <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>);
01138     <span class="keywordflow">return</span>( <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> );
01139 }
01140 <span class="comment">/***************************************************************************</span>
01141 <span class="comment">*</span>
01142 <span class="comment">*   Function to write the integer into the buffer</span>
01143 <span class="comment">*</span>
01144 <span class="comment">***************************************************************************/</span>
<a name="l01145"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a45">01145</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a> <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(MEMPTR lpMem, SINT Number)
01146 {
01147     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    Res;
01148     <span class="keywordtype">char</span>    TempArray[<a class="code" href="../../d8/d8/aug98_2dll32_2csprof_8c.html#a1">TempBfSize</a>];
01149     
01150     Res = wsprintf( (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>)TempArray, <span class="stringliteral">"%lu "</span>, Number );
01151     MemCopy(lpMem, TempArray, lstrlen(TempArray));
01152     <span class="keywordflow">return</span>( Res );
01153 }
01154 
01155 <span class="comment">/***************************************************************************</span>
01156 <span class="comment">*</span>
01157 <span class="comment">*   Function to write the integer into the buffer as hex</span>
01158 <span class="comment">*</span>
01159 <span class="comment">***************************************************************************/</span>
<a name="l01160"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a46">01160</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a> <a class="code" href="../../d2/d9/ps2_8c.html#a45">WriteHex</a>(MEMPTR lpMem, SINT Number)
01161 {
01162     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    Res;
01163     <span class="keywordtype">char</span>    TempArray[<a class="code" href="../../d8/d8/aug98_2dll32_2csprof_8c.html#a1">TempBfSize</a>];
01164 
01165     Res = wsprintf( TempArray, <span class="stringliteral">"%2.2x"</span>, (<span class="keywordtype">int</span>)(Number &amp; 0x00FF) );
01166     MemCopy(lpMem, TempArray, lstrlen(TempArray));
01167     <span class="keywordflow">return</span>( Res );
01168 }
01169 
01170 <span class="comment">/***************************************************************************</span>
01171 <span class="comment">*</span>
01172 <span class="comment">*   Function to write the float into the buffer</span>
01173 <span class="comment">*</span>
01174 <span class="comment">***************************************************************************/</span>
01175 
<a name="l01176"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a47">01176</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a> <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a46">WriteFloat</a>(MEMPTR lpMem, <span class="keywordtype">double</span> dFloat)
01177 {
01178     <span class="keywordtype">char</span>    cSign;
01179     <span class="keywordtype">double</span>  dInt ;
01180     <span class="keywordtype">double</span>  dFract ;
01181     LONG    lFloat ;
01182     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    Res;
01183     <span class="keywordtype">char</span>    TempArray[<a class="code" href="../../d8/d8/aug98_2dll32_2csprof_8c.html#a1">TempBfSize</a>];
01184 
01185     lFloat = (LONG) floor( dFloat * 10000.0 + 0.5);
01186 
01187     dFloat = lFloat  / 10000.0 ;
01188 
01189     dInt = floor(fabs(dFloat));
01190     dFract =  fabs(dFloat) - dInt ;
01191 
01192     cSign   = <span class="charliteral">' '</span> ;
01193     <span class="keywordflow">if</span> ( dFloat &lt; 0 )
01194     {
01195         cSign   = <span class="charliteral">'-'</span> ;
01196     }
01197 
01198     Res = wsprintf( (LPSTR) TempArray, (LPSTR) <span class="stringliteral">"%c%d.%0.4lu "</span>,
01199        cSign, (WORD) dInt , (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (dFract *10000.0)  );
01200     MemCopy(lpMem, TempArray, lstrlen(TempArray));
01201     <span class="keywordflow">return</span> ( Res );
01202 }
01203 
01204 <span class="comment">/***************************************************************************</span>
01205 <span class="comment">*</span>
01206 <span class="comment">*   Function to write the string token into the buffer</span>
01207 <span class="comment">*</span>
01208 <span class="comment">***************************************************************************/</span>
01209 
<a name="l01210"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a48">01210</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d2/d9/ps2_8c.html#a228">WriteStringToken</a>(MEMPTR lpMem, BYTE Token, SINT sNum)
01211 {
01212     *lpMem++ = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
01213     *lpMem++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)((sNum &amp; 0xFF00) &gt;&gt; 8);
01214     *lpMem++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(sNum &amp; 0x00FF);
01215     <span class="keywordflow">return</span> (3);
01216 }
01217 
01218 <span class="comment">/***************************************************************************</span>
01219 <span class="comment">*</span>
01220 <span class="comment">*   Function to write the Homogeneous Number Array token into the buffer</span>
01221 <span class="comment">*</span>
01222 <span class="comment">***************************************************************************/</span>
01223 
<a name="l01224"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a49">01224</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d2/d9/ps2_8c.html#a224">WriteHNAToken</a>(MEMPTR lpMem, BYTE Token, SINT sNum)
01225 {
01226     *lpMem++ = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
01227     *lpMem++ = 32;       <span class="comment">// 16-bit fixed integer, high-order byte first</span>
01228     *lpMem++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)((sNum &amp; 0xFF00) &gt;&gt; 8);
01229     *lpMem++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(sNum &amp; 0x00FF);
01230     <span class="keywordflow">return</span> (4);
01231 }
01232 
01233 <span class="comment">/***************************************************************************</span>
01234 <span class="comment">*</span>
01235 <span class="comment">*   Function to convert 2-bytes unsigned integer to 2-bytes signed </span>
01236 <span class="comment">*   integer(-32768) and write them to the buffer. High byte first.</span>
01237 <span class="comment">*</span>
01238 <span class="comment">***************************************************************************/</span>
01239 
<a name="l01240"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a50">01240</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d2/d9/ps2_8c.html#a225">WriteIntStringU2S</a>(MEMPTR lpMem, MEMPTR lpBuff, SINT sNum)
01241 {
01242     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    i;
01243     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    Temp;
01244 
01245     <span class="keywordflow">for</span> (i = 0; i &lt; sNum; i ++)
01246     {
01247         Temp = <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a2">ui16toSINT</a>( lpBuff) - 32768;
01248         *lpMem++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)((Temp &amp; 0xFF00) &gt;&gt; 8);
01249         *lpMem++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(Temp &amp; 0x00FF);
01250         lpBuff += <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a185">icUInt16Number</a>);
01251     }
01252     <span class="keywordflow">return</span>(sNum * 2); 
01253 }
01254 
01255 <span class="comment">/***************************************************************************</span>
01256 <span class="comment">*</span>
01257 <span class="comment">*   Function to convert 2-bytes unsigned integer to 2-bytes signed </span>
01258 <span class="comment">*   integer(-32768) and write them to the buffer. Low-order byte first.</span>
01259 <span class="comment">*</span>
01260 <span class="comment">***************************************************************************/</span>
01261 
<a name="l01262"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a51">01262</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d2/d9/ps2_8c.html#a226">WriteIntStringU2S_L</a>(MEMPTR lpMem, MEMPTR lpBuff, SINT sNum)
01263 {
01264     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    i;
01265     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    Temp;
01266 
01267     <span class="keywordflow">for</span> (i = 0; i &lt; sNum; i ++)
01268     {
01269         Temp = (<a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>)*((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)lpBuff) - 32768;
01270         *lpMem++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)((Temp &amp; 0xFF00) &gt;&gt; 8);
01271         *lpMem++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(Temp &amp; 0x00FF);
01272         lpBuff += <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a185">icUInt16Number</a>);
01273     }
01274     <span class="keywordflow">return</span>(sNum * 2); 
01275 }
01276 
01277 <span class="comment">/***************************************************************************</span>
01278 <span class="comment">*</span>
01279 <span class="comment">*   Function to put the chunk of memory into buffer</span>
01280 <span class="comment">*</span>
01281 <span class="comment">***************************************************************************/</span>
<a name="l01282"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a52">01282</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d2/d9/ps2_8c.html#a229">WriteByteString</a>(MEMPTR lpMem, MEMPTR lpBuff, SINT sBytes)
01283 {
01284     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    i;
01285 
01286     <span class="keywordflow">for</span> (i = 0; i &lt; sBytes; i ++)
01287         *lpMem++ = *lpBuff++;
01288     
01289     <span class="keywordflow">return</span>(sBytes); 
01290 }
01291 
01292 <span class="comment">/***************************************************************************</span>
01293 <span class="comment">*</span>
01294 <span class="comment">*   Function to put the chunk of memory into buffer</span>
01295 <span class="comment">*</span>
01296 <span class="comment">***************************************************************************/</span>
<a name="l01297"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a53">01297</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d2/d9/ps2_8c.html#a230">WriteInt2ByteString</a>(MEMPTR lpMem, MEMPTR lpBuff, SINT sBytes)
01298 {
01299     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    i;
01300 
01301        <span class="keywordflow">for</span>( i = 0; i &lt; sBytes ; i++)
01302     {
01303         *lpMem++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a2">ui16toSINT</a>( lpBuff)/256) ;
01304         lpBuff += <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a185">icUInt16Number</a>);
01305     }
01306     <span class="keywordflow">return</span>(sBytes); 
01307 }
01308 
01309 <span class="comment">/***************************************************************************</span>
01310 <span class="comment">*</span>
01311 <span class="comment">*  Function to control ascii85 encoding.</span>
01312 <span class="comment">*  parameters:</span>
01313 <span class="comment">*       lpDest      --  Pointer to the encording result buffer.</span>
01314 <span class="comment">*       BufSize     --  Size of encording result buffer. </span>
01315 <span class="comment">*       lpSource    --  Pointer to the input buffer</span>
01316 <span class="comment">*       DataSize    --  Size of the input buffer</span>
01317 <span class="comment">*  returns:</span>
01318 <span class="comment">*       SINT        --  Number of bytes actually outputed.</span>
01319 <span class="comment">*</span>
01320 <span class="comment">****************************************************************************/</span>
01321 
<a name="l01322"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a54">01322</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a55">WriteASCII85Cont</a>(MEMPTR lpDest, SINT BufSize, MEMPTR lpSource, SINT DataSize)
01323 {
01324    <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>     incount;
01325    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>   lpPtr, lpSave;
01326    <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>     rem;
01327    <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>     bcount;
01328    <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>     dex;
01329    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> word;
01330    
01331    <span class="comment">/* encode the initial 4-tuples */</span>
01332    lpSave = <a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a>;
01333    lpPtr  = <a class="code" href="../../d6/d3/kcodecnv_8c.html#a3">lpSource</a>;
01334    word   = 0UL;
01335    bcount = 0;
01336 
01337    <span class="keywordflow">for</span> (incount = 0; incount &lt; DataSize; incount ++)
01338    {
01339       <span class="keywordflow">if</span> ( incount  &amp;&amp; ((incount % <a class="code" href="../../d8/d8/aug98_2dll32_2csprof_8c.html#a2">LINELENG</a>) == 0) )
01340       <a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a> += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(<a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a>,  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01341       word = (word&lt;&lt;8);
01342       word |= (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)*lpPtr++;
01343       <span class="keywordflow">if</span> (bcount == 3)
01344       {
01345          <a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a> += <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a53">WriteAscii85</a>(<a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a>, word, 5);
01346          word = 0UL;
01347          bcount = 0;
01348       }
01349       <span class="keywordflow">else</span>
01350       {
01351          bcount ++;
01352       }
01353    }
01354    
01355    <span class="comment">/* now do the last partial 4-tuple -- if there is one */</span>
01356    <span class="comment">/* see the Red Book spec for the rules on how this is done */</span>
01357    <span class="keywordflow">if</span> (bcount &gt; 0)
01358    {
01359       rem = 4 - bcount;  <span class="comment">/* count the remaining bytes */</span>
01360       <span class="keywordflow">for</span> (dex = 0; dex &lt; rem; dex ++) <span class="comment">/* shift left for each of them */</span>
01361       {
01362          word = (word&lt;&lt;8);      <span class="comment">/* (equivalent to adding in ZERO's)*/</span>
01363          word |= (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)32;
01364       }
01365 <span class="comment">//      lpDest += WriteAscii85(lpDest, word, (bcount + 1));  /* output only meaningful</span>
01366       <a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a> += <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a53">WriteAscii85</a>(<a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a>, word, 5);               <span class="comment">/* output only meaningful bytes + 1 */</span>
01367    }
01368    <span class="keywordflow">return</span> (<a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a> - lpSave);
01369 }
01370 
01371 <span class="comment">/************************************************************************</span>
01372 <span class="comment">*</span>
01373 <span class="comment">*  Function to convert 4 bytes binary data to 5 bytes ascii85 encorded data.</span>
01374 <span class="comment">*  parameters:</span>
01375 <span class="comment">*       lpDest      --  Pointer to the encording result buffer.</span>
01376 <span class="comment">*       inWord      --  Input word (4-bytes) </span>
01377 <span class="comment">*       nBytes      --  Number of bytes should be outputed.</span>
01378 <span class="comment">*  returns:</span>
01379 <span class="comment">*       SINT        --  Number of bytes actually outputed.</span>
01380 <span class="comment">* </span>
01381 <span class="comment">*************************************************************************/</span>
01382 
<a name="l01383"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a55">01383</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a53">WriteAscii85</a>(MEMPTR lpDest, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> inWord, SINT nBytes)
01384 {
01385     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> divisor;
01386     <span class="keywordtype">int</span>      bcount;
01387     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>     outchar;
01388     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>   lpSave = <a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a>;
01389 
01390     <span class="keywordflow">if</span> ((inWord == 0UL) &amp;&amp; (nBytes == 5))
01391         *<a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a>++ = <span class="charliteral">'z'</span>;
01392     <span class="keywordflow">else</span>
01393     {
01394         divisor = 52200625UL;
01395         <span class="keywordflow">for</span> (bcount = 0; bcount &lt; nBytes; bcount ++)
01396         { 
01397             outchar = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)((<span class="keywordtype">int</span>)(inWord/divisor) + (<span class="keywordtype">int</span>)<span class="charliteral">'!'</span>);
01398             *<a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a>++ = outchar;
01399             <span class="keywordflow">if</span> (bcount &lt; 4)
01400             {
01401                 inWord = (inWord % divisor);
01402                 divisor =(divisor / 85);
01403             }
01404         }
01405     }
01406     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>)(<a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a> - lpSave);
01407 }
01408 
01409 <span class="comment">/***************************************************************************</span>
01410 <span class="comment">*</span>
01411 <span class="comment">*  Function to convert binary data to ascii by performing ASCII85 encording</span>
01412 <span class="comment">*  parameters:</span>
01413 <span class="comment">*       lpMem       --  A pointer to the buffer. </span>
01414 <span class="comment">*                       as input: contains binary data; </span>
01415 <span class="comment">*                       as output: contains ascii data. </span>
01416 <span class="comment">*       DataSize    --  The size of input binary data. </span>
01417 <span class="comment">*       BufSize     --  The size of buffer pointed by lpMem.</span>
01418 <span class="comment">*  returns:</span>
01419 <span class="comment">*       SINT        --  Number of bytes actually outputed.</span>
01420 <span class="comment">*</span>
01421 <span class="comment">***************************************************************************/</span>
01422 
<a name="l01423"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a56">01423</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a54">ConvertBinaryData2Ascii</a>(MEMPTR lpMem, SINT DataSize, SINT BufSize)
01424 {
01425     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>      intrbuf, Temp;
01426     HANDLE      intrhandle;
01427     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>        AsciiDataSize = 0;
01428 
01429     <span class="keywordflow">if</span> (BufSize &gt;= (<a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>)(DataSize/4*5 + <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a4">ASCII85DecodeBegine</a>)+<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a5">ASCII85DecodeEnd</a>) + 2048))
01430     {
01431         <span class="keywordflow">if</span> ((intrhandle = GlobalAlloc(GHND, BufSize)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01432         {
01433             <span class="keywordflow">if</span> ((intrbuf = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a19">MEMPTR</a>) GlobalLock(intrhandle)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01434             {
01435                 Temp = intrbuf;
01436                 Temp += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(Temp,  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01437                 Temp += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(Temp,  <a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a4">ASCII85DecodeBegine</a>);
01438                 Temp += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(Temp,  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01439                 Temp += <a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a55">WriteASCII85Cont</a>(Temp, BufSize, lpMem, DataSize);
01440                 Temp += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(Temp,  <a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a5">ASCII85DecodeEnd</a>);
01441                 AsciiDataSize = (<a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>)(Temp - intrbuf);
01442                 lstrcpyn(lpMem, intrbuf, (WORD)AsciiDataSize); 
01443                 GlobalUnlock(intrhandle);
01444             }
01445         }
01446         GlobalFree(intrhandle);
01447    }
01448    <span class="keywordflow">return</span> (AsciiDataSize);
01449 }
01450 
01451 <span class="comment">/***************************************************************************</span>
01452 <span class="comment">*</span>
01453 <span class="comment">*  Function to check if it is need to convert a CRD from binary to ascii</span>
01454 <span class="comment">*  parameters:</span>
01455 <span class="comment">*       CP          --  Handle of memory block which contains icm profile.</span>
01456 <span class="comment">*       Index       --  Index of the element data of the profile.</span>
01457 <span class="comment">*       lpData      --  A pointer to the buffer. </span>
01458 <span class="comment">*                       as input: contains binary data; </span>
01459 <span class="comment">*                       as output: contains ascii data. </span>
01460 <span class="comment">*       BufSize     --  The size of the buffer pointed by lpData.</span>
01461 <span class="comment">*       DataSize    --  The size of input binary data.</span>
01462 <span class="comment">*       AllowBinary --  Allow binary or not(1/0).</span>
01463 <span class="comment">*  returns:</span>
01464 <span class="comment">*       SINT        --  Number of bytes required/actually outputed.</span>
01465 <span class="comment">*</span>
01466 <span class="comment">***************************************************************************/</span>
01467 
<a name="l01468"></a><a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a57">01468</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    <a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a55">Convert2Ascii</a>(CHANDLE CP, SINT Index,
01469                       MEMPTR lpData, SINT BufSize, 
01470                       SINT DataSize, BOOL AllowBinary)
01471 {
01472     <span class="keywordtype">long</span>    DataType;
01473 
01474     <a class="code" href="../../d2/d9/ps2_8c.html#a195">GetCPElementDataType</a>(CP, <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>, &amp;DataType);
01475     <span class="keywordflow">if</span> (BufSize == 0)
01476     {
01477         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a27">AllowBinary</a>)
01478             <span class="keywordflow">return</span> (DataSize);
01479         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (DataType == 0)    <span class="comment">// Ascii data in Profile </span>
01480             <span class="keywordflow">return</span> (DataSize);
01481         <span class="keywordflow">else</span>                       <span class="comment">// Keep space for ascii85 encoding.</span>
01482             <span class="keywordflow">return</span> (DataSize / 4 * 5 + <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a4">ASCII85DecodeBegine</a>)+<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d8/dec97_2dll32_2csprof_8c.html#a5">ASCII85DecodeEnd</a>) + 2048);
01483     }
01484     <span class="keywordflow">else</span>
01485     {
01486         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a27">AllowBinary</a>)
01487             <span class="keywordflow">return</span> (DataSize);
01488         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(DataType == 0) 
01489             <span class="keywordflow">return</span> (DataSize);
01490         <span class="keywordflow">else</span> 
01491             <span class="keywordflow">return</span> (<a class="code" href="../../d8/d9/jul98_2test_2csprof_8h.html#a54">ConvertBinaryData2Ascii</a>(lpData, DataSize, BufSize) );
01492     }
01493 }
01494 
01495 <span class="preprocessor">#ifdef ICMDLL</span>
01496 <span class="preprocessor"></span><a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    MemCopy(MEMPTR Dest, MEMPTR Source, SINT Length)
01497 {
01498     <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a6">SINT</a>    i;
01499 
01500     <span class="keywordflow">for</span> (i = 0; i &lt; Length; i++)
01501     {
01502         Dest[i] = Source[i];
01503     }
01504     <span class="keywordflow">return</span>( Length );
01505 }
01506 <span class="preprocessor">#endif</span>
01507 <span class="preprocessor"></span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:36 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
