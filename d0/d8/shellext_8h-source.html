<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: shellext.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>shellext.h</h1><a href="../../d9/d8/shellext_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/******************************************************************************</span>
00002 <span class="comment"></span>
00003 <span class="comment">  Source File:  Shell Extension Classes.H</span>
00004 <span class="comment"></span>
00005 <span class="comment">  This file defines the Shell extension classes.  Since the ICM UI is a shell</span>
00006 <span class="comment">  extension, these are essential.  Rather than slavishly including sample code,</span>
00007 <span class="comment">  this has been written as much as possible from scratch.</span>
00008 <span class="comment"></span>
00009 <span class="comment">  If you're not familiar with OLE, then this is going to be a bit difficult</span>
00010 <span class="comment">  going.</span>
00011 <span class="comment"></span>
00012 <span class="comment">  Copyright (c) 1996 by Microsoft Corporation</span>
00013 <span class="comment"></span>
00014 <span class="comment">  A Pretty Penny Enterprises Production</span>
00015 <span class="comment"></span>
00016 <span class="comment">  Change History:</span>
00017 <span class="comment"></span>
00018 <span class="comment">  10-28-96 A-RobKj (Pretty Penny Enterprises) began coding</span>
00019 <span class="comment">  12-03-96 A-RobKj moved the CGlobals class to the pre-comp header file.</span>
00020 <span class="comment">  01-07-97 KjelgaardR@acm.org   Stubbed IContextMenu interface for profile</span>
00021 <span class="comment">            management in favor of shell association which uses a RunDLL</span>
00022 <span class="comment">            Entry point- this allows invocation via Enter, and double-click</span>
00023 <span class="comment"></span>
00024 <span class="comment">******************************************************************************/</span>
00025 
00026 <span class="comment">// The class ID of this Shell extension is taken from the one used on Win95.</span>
00027 
00028 <span class="comment">//  This was a deliberate decision, to ease the upgrade process.</span>
00029 <span class="comment">//</span>
00030 <span class="comment">// class id:  dbce2480-c732-101b-be72-ba78e9ad5b27</span>
00031 <span class="comment">//</span>
00032                                   
00033 <a class="code" href="../../d9/d8/shellext_8h.html#a7">DEFINE_GUID</a>(CLSID_ICM, 0xDBCE2480L, 0xC732, 0x101B, 0xBE, 0x72, 0xBA, 0x78, 
00034             0xE9, 0xAD, 0x5B, 0x27);
00035 
00036 <span class="comment">//  This class ID is for the printer profile management UI.  It is implemented</span>
00037 <span class="comment">//  within the same module, for now, but having a separate GUID makes it</span>
00038 <span class="comment">//  easier to implement separately later, if so desired.  It also simplifies</span>
00039 <span class="comment">//  implementation.</span>
00040 
00041 <span class="comment">//  Class ID:  675f097e-4c4d-11d0-b6c1-0800091aa605</span>
00042 
00043 <a class="code" href="../../d9/d8/shellext_8h.html#a7">DEFINE_GUID</a>(CLSID_PRINTERUI, 0x675F097EL, 0x4C4D, 0x11D0, 0xB6, 0xC1, 0x08,
00044              0x00, 0x09, 0x1A, 0xA6, 0x05);
00045 
00046 <span class="comment">//  This class ID is used (at least temporarily) for the display profile</span>
00047 <span class="comment">//  management UI.  If I wind up not needing it, I will convert it to a</span>
00048 <span class="comment">//  different class (such as scanners or cameras)</span>
00049 
00050 <span class="comment">//  Class ID: 5db2625a-54df-11d0-b6c4-0800091aa605</span>
00051 
00052 <a class="code" href="../../d9/d8/shellext_8h.html#a7">DEFINE_GUID</a>(CLSID_MONITORUI, 0x5db2625a, 0x54df, 0x11d0, 0xb6, 0xc4, 0x08, 
00053             0x00, 0x09, 0x1a, 0xa6, 0x05);
00054 
00055 <span class="comment">//  This class ID is used (at least temporarily) for the scanner/camera profile</span>
00056 <span class="comment">//  management UI.</span>
00057 
00058 <span class="comment">//  Class ID: 176d6597-26d3-11d1-b350-080036a75b03</span>
00059 
00060 <a class="code" href="../../d9/d8/shellext_8h.html#a7">DEFINE_GUID</a>(CLSID_SCANNERUI, 0x176d6597, 0x26d3, 0x11d1, 0xb3, 0x50, 0x08,
00061             0x00, 0x36, 0xa7, 0x5b, 0x03);
00062 
<a name="l00063"></a><a class="code" href="../../d9/d8/shellext_8h.html#a8">00063</a> <span class="keyword">typedef</span> <span class="keyword">enum</span>    {<a class="code" href="../../d9/d8/shellext_8h.html#a8a0">IsProfile</a>, <a class="code" href="../../d9/d8/shellext_8h.html#a8a1">IsPrinter</a>, <a class="code" href="../../d9/d8/shellext_8h.html#a8a2">IsScanner</a>, <a class="code" href="../../d9/d8/shellext_8h.html#a8a3">IsMonitor</a>} <a class="code" href="../../d9/d8/shellext_8h.html#a8">UITYPE</a>;
00064 
00065 <span class="comment">//  First of all, we're going to need a class factory.  The shell uses this</span>
00066 <span class="comment">//  factory to create instances of the objects which implement the interfaces</span>
00067 <span class="comment">//  it needs.</span>
00068 
<a name="l00069"></a><a class="code" href="../../d3/d3/classCIcmUiFactory.html">00069</a> <span class="keyword">class </span><a class="code" href="../../d3/d3/classCIcmUiFactory.html">CIcmUiFactory</a> : <span class="keyword">public</span> IClassFactory
00070 {
<a name="l00071"></a><a class="code" href="../../d3/d3/classCIcmUiFactory.html#r0">00071</a>     ULONG   <a class="code" href="../../d3/d3/classCIcmUiFactory.html#r0">m_ulcReferences</a>;
<a name="l00072"></a><a class="code" href="../../d3/d3/classCIcmUiFactory.html#r1">00072</a>     <a class="code" href="../../d9/d8/shellext_8h.html#a8">UITYPE</a>  <a class="code" href="../../d3/d3/classCIcmUiFactory.html#r1">m_utThis</a>;
00073 
00074 <span class="keyword">public</span>:
00075     <a class="code" href="../../d3/d3/classCIcmUiFactory.html">CIcmUiFactory</a>(REFCLSID rclsid);
<a name="l00076"></a><a class="code" href="../../d3/d3/classCIcmUiFactory.html#a1">00076</a>     <a class="code" href="../../d3/d3/classCIcmUiFactory.html#a1">~CIcmUiFactory</a>() { <a class="code" href="../../d0/d3/classCGlobals.html#e1">CGlobals::Detach</a>(); }
00077 
00078     <span class="comment">//IUnknown interface</span>
00079     STDMETHODIMP            QueryInterface(REFIID riid, <span class="keywordtype">void</span> **ppvObject);
<a name="l00080"></a><a class="code" href="../../d3/d3/classCIcmUiFactory.html#a3">00080</a>     <a class="code" href="../../d3/d3/classCIcmUiFactory.html#a3">STDMETHODIMP_</a>(ULONG)    AddRef() { <span class="keywordflow">return</span> ++<a class="code" href="../../d3/d3/classCIcmUiFactory.html#r0">m_ulcReferences</a>; }
<a name="l00081"></a><a class="code" href="../../d3/d3/classCIcmUiFactory.html#a4">00081</a>     <a class="code" href="../../d3/d3/classCIcmUiFactory.html#a3">STDMETHODIMP_</a>(ULONG)    Release() {
00082         <span class="keywordflow">if</span>  (--<a class="code" href="../../d3/d3/classCIcmUiFactory.html#r0">m_ulcReferences</a>) 
00083             <span class="keywordflow">return</span>  <a class="code" href="../../d3/d3/classCIcmUiFactory.html#r0">m_ulcReferences</a>;
00084 
00085         <span class="keyword">delete</span>  <span class="keyword">this</span>;
00086         <span class="keywordflow">return</span>  0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00087     }
00088 
00089     <span class="comment">//IClassFactory interface</span>
00090     STDMETHODIMP    CreateInstance(LPUNKNOWN punk, REFIID riid, 
00091                                    <span class="keywordtype">void</span> **ppvObject);
<a name="l00092"></a><a class="code" href="../../d3/d3/classCIcmUiFactory.html#a6">00092</a>     STDMETHODIMP    <a class="code" href="../../d3/d3/classCIcmUiFactory.html#a6">LockServer</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>) { <span class="keywordflow">return</span> NOERROR; }
00093 
00094     <span class="keyword">static</span> SCODE    KeyToTheFactory(REFCLSID rclsid, REFIID riid, 
00095                                     <span class="keywordtype">void</span> **ppvObject);
00096 };
00097 
00098 <span class="comment">//  This class implements the entire extension- it includes a context menu</span>
00099 <span class="comment">//  handler, and Icon handler, and a property sheet extension.</span>
00100 
<a name="l00101"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html">00101</a> <span class="keyword">class </span><a class="code" href="../../d4/d3/classCICMUserInterface.html">CICMUserInterface</a> : <span class="keyword">public</span> IContextMenu, IShellExtInit, IExtractIcon, 
00102                                     IPersistFile, IShellPropSheetExt
00103 {
<a name="l00104"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#r0">00104</a>     ULONG           <a class="code" href="../../d4/d3/classCICMUserInterface.html#r0">m_ulcReferences</a>;
<a name="l00105"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#r1">00105</a>     LPDATAOBJECT    <a class="code" href="../../d4/d3/classCICMUserInterface.html#r1">m_lpdoTarget</a>;
<a name="l00106"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#r2">00106</a>     <a class="code" href="../../d1/d7/classCString.html">CString</a>         <a class="code" href="../../d4/d3/classCICMUserInterface.html#r2">m_csFile</a>;         <span class="comment">//  Profile for icon extraction</span>
00107     <span class="comment">//check this - m_acWork doesn't appear to be referenced anywhere.</span>
<a name="l00108"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#r3">00108</a>     TCHAR           <a class="code" href="../../d4/d3/classCICMUserInterface.html#r3">m_acWork</a>[80];     <span class="comment">//  A little work buffer</span>
<a name="l00109"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#r4">00109</a>     <a class="code" href="../../d9/d8/shellext_8h.html#a8">UITYPE</a>          <a class="code" href="../../d4/d3/classCICMUserInterface.html#r4">m_utThis</a>;
<a name="l00110"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#r6">00110</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            <a class="code" href="../../d4/d3/classCICMUserInterface.html#r5">m_bInstalledContext</a>, <span class="comment">// 'True' when every selected file(s) are installed</span>
00111                     <a class="code" href="../../d4/d3/classCICMUserInterface.html#r6">m_bMultiSelection</a>;
00112 
00113     HRESULT         <a class="code" href="../../d4/d3/classCICMUserInterface.html#d0">AddPrinterTab</a>(LPFNADDPROPSHEETPAGE lpfnAddPage, 
00114                                   LPARAM lParam);
00115 
00116     HRESULT         <a class="code" href="../../d4/d3/classCICMUserInterface.html#d1">AddAssociateTab</a>(LPFNADDPROPSHEETPAGE lpfnAddPage,
00117                                     LPARAM lParam);
00118 
00119     HRESULT         <a class="code" href="../../d4/d3/classCICMUserInterface.html#d2">AddProfileTab</a>(LPFNADDPROPSHEETPAGE lpfnAddPage, 
00120                                   LPARAM lParam);
00121 
00122     HRESULT         <a class="code" href="../../d4/d3/classCICMUserInterface.html#d3">AddScannerTab</a>(LPFNADDPROPSHEETPAGE lpfnAddPage, 
00123                                   LPARAM lParam);
00124 
00125     HRESULT         <a class="code" href="../../d4/d3/classCICMUserInterface.html#d4">AddMonitorTab</a>(LPFNADDPROPSHEETPAGE lpfnAddPage, 
00126                                   LPARAM lParam);
00127 
00128 <span class="keyword">public</span>:
00129     <a class="code" href="../../d4/d3/classCICMUserInterface.html">CICMUserInterface</a>(UITYPE utThis);
00130 
<a name="l00131"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#a1">00131</a>     <a class="code" href="../../d4/d3/classCICMUserInterface.html#a1">~CICMUserInterface</a>() { 
00132 
00133         <span class="keywordflow">if</span>  (<a class="code" href="../../d4/d3/classCICMUserInterface.html#r1">m_lpdoTarget</a>)
00134             <a class="code" href="../../d4/d3/classCICMUserInterface.html#r1">m_lpdoTarget</a> -&gt; Release();
00135         <a class="code" href="../../d0/d3/classCGlobals.html#e1">CGlobals::Detach</a>();
00136     }
00137 
00138     <span class="comment">//IUnknown members</span>
00139     STDMETHODIMP            QueryInterface(REFIID, LPVOID FAR *);
<a name="l00140"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#a3">00140</a>     <a class="code" href="../../d4/d3/classCICMUserInterface.html#a3">STDMETHODIMP_</a>(ULONG)    AddRef() { <span class="keywordflow">return</span> ++<a class="code" href="../../d4/d3/classCICMUserInterface.html#r0">m_ulcReferences</a>; }
<a name="l00141"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#a4">00141</a>     <a class="code" href="../../d4/d3/classCICMUserInterface.html#a3">STDMETHODIMP_</a>(ULONG)    Release() {
00142         <span class="keywordflow">if</span>  (--<a class="code" href="../../d4/d3/classCICMUserInterface.html#r0">m_ulcReferences</a>) 
00143             <span class="keywordflow">return</span>  <a class="code" href="../../d4/d3/classCICMUserInterface.html#r0">m_ulcReferences</a>;
00144         
00145         <span class="keyword">delete</span>  <span class="keyword">this</span>;
00146         <span class="keywordflow">return</span>  0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00147     }
00148 
00149     <span class="comment">//  IContextMenu methods</span>
00150     STDMETHODIMP    QueryContextMenu(HMENU hMenu, UINT indexMenu, 
00151                                      UINT idCmdFirst, UINT idCmdLast, 
00152                                      UINT uFlags);
00153    
00154     STDMETHODIMP    InvokeCommand(LPCMINVOKECOMMANDINFO lpcmi);
00155 
00156     STDMETHODIMP    GetCommandString(UINT_PTR idCmd, UINT uFlags, 
00157                                      UINT FAR *reserved, LPSTR pszName, 
00158                                      UINT cchMax);
00159 
00160     <span class="comment">//  IShellExtInit methods</span>
00161     STDMETHODIMP    Initialize(LPCITEMIDLIST pIDFolder, LPDATAOBJECT pDataObj,
00162                                HKEY hKeyID);
00163 
00164     <span class="comment">//  IExtractIcon methods</span>
00165     STDMETHODIMP    GetIconLocation(UINT uFlags, LPTSTR szIconFile, UINT cchMax,
00166                                     <span class="keywordtype">int</span> *piIndex, UINT *pwFlags);
00167 
00168     STDMETHODIMP    Extract(LPCTSTR pszFile, UINT nIconIndex, 
00169                             HICON *phiconLarge, HICON *phiconSmall, 
00170                             UINT nIconSize);
00171 
00172     <span class="comment">//  IPersistFile methods- note that (as the OLE documentation says) only </span>
00173     <span class="comment">//  Load ever gets used.  GetClassID is from IPersist, from which</span>
00174     <span class="comment">//  IPersistFile is derived.  We fail everything we don't expect to see</span>
00175     <span class="comment">//  called.</span>
00176 
<a name="l00177"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#a11">00177</a>     STDMETHODIMP    <a class="code" href="../../d4/d3/classCICMUserInterface.html#a11">GetClassID</a>(LPCLSID lpClassID) { <span class="keywordflow">return</span> E_FAIL; }
00178 
<a name="l00179"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#a12">00179</a>     STDMETHODIMP    <a class="code" href="../../d4/d3/classCICMUserInterface.html#a12">IsDirty</a>() { <span class="keywordflow">return</span> S_FALSE; }
00180 
00181     STDMETHODIMP    Load(LPCOLESTR lpszFileName, DWORD grfMode);
00182 
<a name="l00183"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#a14">00183</a>     STDMETHODIMP    <a class="code" href="../../d4/d3/classCICMUserInterface.html#a14">Save</a>(LPCOLESTR lpszFileName, BOOL fRemember) {
00184         <span class="keywordflow">return</span>  E_FAIL;
00185     }
00186 
<a name="l00187"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#a15">00187</a>     STDMETHODIMP    <a class="code" href="../../d4/d3/classCICMUserInterface.html#a15">SaveCompleted</a>(LPCOLESTR lpszFileName) { <span class="keywordflow">return</span> E_FAIL; }
00188 
<a name="l00189"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#a16">00189</a>     STDMETHODIMP    <a class="code" href="../../d4/d3/classCICMUserInterface.html#a16">GetCurFile</a>(LPOLESTR FAR* lplpszFileName) {
00190         <span class="keywordflow">return</span>  E_FAIL;
00191     }
00192 
00193     <span class="comment">//  IShellPropSheetExt methods</span>
00194     STDMETHODIMP    AddPages(LPFNADDPROPSHEETPAGE lpfnAddPage, LPARAM lParam);
00195     
<a name="l00196"></a><a class="code" href="../../d4/d3/classCICMUserInterface.html#a18">00196</a>     STDMETHODIMP    <a class="code" href="../../d4/d3/classCICMUserInterface.html#a18">ReplacePage</a>(UINT uPageID, 
00197                                 LPFNADDPROPSHEETPAGE lpfnReplaceWith, 
00198                                 LPARAM lParam) { <span class="keywordflow">return</span> E_FAIL; }
00199 
00200 };
00201 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
