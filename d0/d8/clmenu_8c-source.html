<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: clmenu.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>clmenu.c</h1><a href="../../d9/d8/clmenu_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">*</span>
00003 <span class="comment">* Module Name: clmenu.c</span>
00004 <span class="comment">*</span>
00005 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00006 <span class="comment">*</span>
00007 <span class="comment">* Menu Loading Routines</span>
00008 <span class="comment">*</span>
00009 <span class="comment">* History:</span>
00010 <span class="comment">* 24-Sep-1990 mikeke        From win30</span>
00011 <span class="comment">* 29-Nov-1994 JimA          Moved from server.</span>
00012 <span class="comment">\***************************************************************************/</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00015 <span class="preprocessor">#pragma hdrstop</span>
00016 <span class="preprocessor"></span>
00017 
00018 <span class="comment">/***************************************************************************\</span>
00019 <span class="comment">* MenuLoadWinTemplates</span>
00020 <span class="comment">*</span>
00021 <span class="comment">* Recursive routine that loads in the new style menu template and</span>
00022 <span class="comment">* builds the menu. Assumes that the menu template header has already been</span>
00023 <span class="comment">* read in and processed elsewhere...</span>
00024 <span class="comment">*</span>
00025 <span class="comment">* History:</span>
00026 <span class="comment">* 28-Sep-1990 mikeke     from win30</span>
00027 <span class="comment">\***************************************************************************/</span>
00028 
<a name="l00029"></a><a class="code" href="../../d9/d8/clmenu_8c.html#a0">00029</a> LPBYTE <a class="code" href="../../d9/d8/clmenu_8c.html#a0">MenuLoadWinTemplates</a>(
00030     LPBYTE lpMenuTemplate,
00031     HMENU *phMenu)
00032 {
00033     HMENU hMenu;
00034     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> menuFlags = 0;
00035     ULONG_PTR menuId = 0;
00036     LPWSTR lpmenuText;
00037     MENUITEMINFO    mii;
00038     UNICODE_STRING str;
00039 
00040     <span class="keywordflow">if</span> (!(hMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a214">NtUserCreateMenu</a>()))
00041         <span class="keywordflow">goto</span> memoryerror;
00042 
00043     <span class="keywordflow">do</span> {
00044 
00045         <span class="comment">/*</span>
00046 <span class="comment">         * Get the menu flags.</span>
00047 <span class="comment">         */</span>
00048         menuFlags = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(*(WORD *)lpMenuTemplate);
00049         lpMenuTemplate += 2;
00050 
00051         <span class="keywordflow">if</span> (menuFlags &amp; ~MF_VALID) {
00052             RIPERR1(ERROR_INVALID_DATA, RIP_WARNING, <span class="stringliteral">"Menu Flags %lX are invalid"</span>, menuFlags);
00053             <span class="keywordflow">goto</span> memoryerror;
00054         }
00055 
00056 
00057         <span class="keywordflow">if</span> (!(menuFlags &amp; MF_POPUP)) {
00058             menuId = *(WORD *)lpMenuTemplate;
00059             lpMenuTemplate += 2;
00060         }
00061 
00062         lpmenuText = (LPWSTR)lpMenuTemplate;
00063 
00064         <span class="keywordflow">if</span> (*lpmenuText) {
00065             <span class="comment">/*</span>
00066 <span class="comment">             * Some Win3.1 and Win95 16 bit apps (chessmaster, mavis typing) know that</span>
00067 <span class="comment">             * dwItemData for MFT_OWNERDRAW items is a pointer to a string in the resource data.</span>
00068 <span class="comment">             * So WOW has given us the proper pointer from the 16 bit resource.</span>
00069 <span class="comment">             *</span>
00070 <span class="comment">             * Sundown Note: </span>
00071 <span class="comment">             * __unaligned unsigned long value pointed by lpMenuTemplate is zero-extended to </span>
00072 <span class="comment">             * update lpmenuText. WOW restrictions.</span>
00073 <span class="comment">             */</span>
00074             <span class="keywordflow">if</span> ((menuFlags &amp; MFT_OWNERDRAW)
00075                     &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;dwTIFlags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a796">TIF_16BIT</a>)) {
00076                 lpmenuText = (LPWSTR)ULongToPtr( (*(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> UNALIGNED *)lpMenuTemplate) );
00077                 <span class="comment">/*</span>
00078 <span class="comment">                 * We'll skip one WCHAR later; so skip only the difference now.</span>
00079 <span class="comment">                 */</span>
00080                 lpMenuTemplate += <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) - <span class="keyword">sizeof</span>(WCHAR);
00081             } <span class="keywordflow">else</span> {
00082                 <span class="comment">/*</span>
00083 <span class="comment">                 * If a string exists, then skip to the end of it.</span>
00084 <span class="comment">                 */</span>
00085                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;str, lpmenuText);
00086                 lpMenuTemplate = lpMenuTemplate + str.Length;
00087             }
00088 
00089         } <span class="keywordflow">else</span> {
00090             lpmenuText = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00091         }
00092 
00093         <span class="comment">/*</span>
00094 <span class="comment">         * Skip over terminating NULL of the string (or the single NULL</span>
00095 <span class="comment">         * if empty string).</span>
00096 <span class="comment">         */</span>
00097         lpMenuTemplate += <span class="keyword">sizeof</span>(WCHAR);
00098         lpMenuTemplate = <a class="code" href="../../d6/d0/usercli_8h.html#a123">NextWordBoundary</a>(lpMenuTemplate);
00099 
00100         RtlZeroMemory(&amp;mii, <span class="keyword">sizeof</span>(mii));
00101         mii.cbSize = <span class="keyword">sizeof</span>(MENUITEMINFO);
00102         mii.fMask = MIIM_ID | MIIM_STATE | MIIM_FTYPE;
00103         <span class="keywordflow">if</span> (lpmenuText) {
00104             mii.fMask |= MIIM_STRING;
00105         }
00106 
00107         <span class="keywordflow">if</span> (menuFlags &amp; MF_POPUP) {
00108             mii.fMask |= MIIM_SUBMENU;
00109             lpMenuTemplate = <a class="code" href="../../d9/d8/clmenu_8c.html#a0">MenuLoadWinTemplates</a>(lpMenuTemplate,
00110                     (HMENU *)&amp;menuId);
00111             <span class="keywordflow">if</span> (!lpMenuTemplate)
00112                 <span class="keywordflow">goto</span> memoryerror;
00113 
00114             mii.hSubMenu = (HMENU)menuId;
00115         }
00116 
00117         <span class="comment">/*</span>
00118 <span class="comment">         * We have to take out MF_HILITE since that bit marks the end of a</span>
00119 <span class="comment">         * menu in a resource file.  Since we shouldn't have any pre hilited</span>
00120 <span class="comment">         * items in the menu anyway, this is no big deal.</span>
00121 <span class="comment">         */</span>
00122         <span class="keywordflow">if</span> (menuFlags &amp; MF_BITMAP) {
00123 
00124             <span class="comment">/*</span>
00125 <span class="comment">             * Don't allow bitmaps from the resource file.</span>
00126 <span class="comment">             */</span>
00127             menuFlags = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)((menuFlags | MFT_RIGHTJUSTIFY) &amp; ~MF_BITMAP);
00128         }
00129 
00130         <span class="comment">// We have to take out MFS_HILITE since that bit marks the end of a menu in</span>
00131         <span class="comment">// a resource file.  Since we shouldn't have any pre hilited items in the</span>
00132         <span class="comment">// menu anyway, this is no big deal.</span>
00133         mii.fState = (menuFlags &amp; MFS_OLDAPI_MASK) &amp; ~MFS_HILITE;
00134         mii.fType = (menuFlags &amp; MFT_OLDAPI_MASK);
00135         <span class="keywordflow">if</span> (menuFlags &amp; MFT_OWNERDRAW)
00136         {
00137             mii.fMask |= MIIM_DATA;
00138             mii.dwItemData = (ULONG_PTR) lpmenuText;
00139             lpmenuText = 0;
00140         }
00141         mii.dwTypeData = (LPWSTR) lpmenuText;
00142         mii.cch = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)-1;
00143         mii.wID = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)menuId;
00144 
00145         <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a181">NtUserThunkedMenuItemInfo</a>(hMenu, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00146                     &amp;mii, lpmenuText ? &amp;str : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00147             <span class="keywordflow">if</span> (menuFlags &amp; MF_POPUP)
00148                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a158">NtUserDestroyMenu</a>(mii.hSubMenu);
00149             <span class="keywordflow">goto</span> memoryerror;
00150         }
00151 
00152     } <span class="keywordflow">while</span> (!(menuFlags &amp; MF_END));
00153 
00154     *phMenu = hMenu;
00155     <span class="keywordflow">return</span> lpMenuTemplate;
00156 
00157 memoryerror:
00158     <span class="keywordflow">if</span> (hMenu != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00159         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a158">NtUserDestroyMenu</a>(hMenu);
00160     *phMenu = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00161     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00162 }
00163 
00164 
00165 <span class="comment">/***************************************************************************\</span>
00166 <span class="comment">* MenuLoadChicagoTemplates</span>
00167 <span class="comment">*</span>
00168 <span class="comment">* Recursive routine that loads in the new new style menu template and</span>
00169 <span class="comment">* builds the menu. Assumes that the menu template header has already been</span>
00170 <span class="comment">* read in and processed elsewhere...</span>
00171 <span class="comment">*</span>
00172 <span class="comment">* History:</span>
00173 <span class="comment">* 15-Dec-93 SanfordS    Created</span>
00174 <span class="comment">\***************************************************************************/</span>
00175 
<a name="l00176"></a><a class="code" href="../../d9/d8/clmenu_8c.html#a1">00176</a> PMENUITEMTEMPLATE2 <a class="code" href="../../d9/d8/clmenu_8c.html#a1">MenuLoadChicagoTemplates</a>(
00177     PMENUITEMTEMPLATE2 lpMenuTemplate,
00178     HMENU *phMenu,
00179     WORD wResInfo,
00180     UINT mftRtl)
00181 {
00182     HMENU hMenu;
00183     HMENU hSubMenu;
00184     <span class="keywordtype">long</span> menuId = 0;
00185     LPWSTR lpmenuText;
00186     MENUITEMINFO    mii;
00187     UNICODE_STRING str;
00188     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>           dwHelpID;
00189 
00190     <span class="keywordflow">if</span> (!(hMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a214">NtUserCreateMenu</a>()))
00191         <span class="keywordflow">goto</span> memoryerror;
00192 
00193     <span class="keywordflow">do</span> {
00194         <span class="keywordflow">if</span> (!(wResInfo &amp; MFR_POPUP)) {
00195             <span class="comment">/*</span>
00196 <span class="comment">             * If the PREVIOUS wResInfo field was not a POPUP, the</span>
00197 <span class="comment">             * dwHelpID field is not there.  Back up so things fit.</span>
00198 <span class="comment">             */</span>
00199             lpMenuTemplate = (PMENUITEMTEMPLATE2)(((LPBYTE)lpMenuTemplate) -
00200                     <span class="keyword">sizeof</span>(lpMenuTemplate-&gt;dwHelpID));
00201             dwHelpID = 0;
00202         } <span class="keywordflow">else</span>
00203             dwHelpID = lpMenuTemplate-&gt;dwHelpID;
00204 
00205         menuId = lpMenuTemplate-&gt;menuId;
00206 
00207         RtlZeroMemory(&amp;mii, <span class="keyword">sizeof</span>(mii));
00208         mii.cbSize = <span class="keyword">sizeof</span>(MENUITEMINFO);
00209         mii.fMask = MIIM_ID | MIIM_STATE | MIIM_FTYPE ;
00210 
00211         mii.fType = lpMenuTemplate-&gt;fType | mftRtl;
00212         <span class="keywordflow">if</span> (mii.fType &amp; ~MFT_MASK) {
00213             RIPERR1(ERROR_INVALID_DATA, RIP_WARNING, <span class="stringliteral">"Menu Type flags %lX are invalid"</span>, mii.fType);
00214             <span class="keywordflow">goto</span> memoryerror;
00215         }
00216 
00217         mii.fState  = lpMenuTemplate-&gt;fState;
00218         <span class="keywordflow">if</span> (mii.fState &amp; ~MFS_MASK) {
00219             RIPERR1(ERROR_INVALID_DATA, RIP_WARNING, <span class="stringliteral">"Menu State flags %lX are invalid"</span>, mii.fState);
00220             <span class="keywordflow">goto</span> memoryerror;
00221         }
00222 
00223         wResInfo = lpMenuTemplate-&gt;wResInfo;
00224         <span class="keywordflow">if</span> (wResInfo &amp; ~(MF_END | MFR_POPUP)) {
00225             RIPERR1(ERROR_INVALID_DATA, RIP_WARNING, <span class="stringliteral">"Menu ResInfo flags %lX are invalid"</span>, wResInfo);
00226             <span class="keywordflow">goto</span> memoryerror;
00227         }
00228 
00229         <span class="keywordflow">if</span> (dwHelpID) {
00230             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a184">NtUserSetMenuContextHelpId</a>(hMenu,dwHelpID);
00231         }
00232         <span class="keywordflow">if</span> (lpMenuTemplate-&gt;mtString[0]) {
00233             lpmenuText = lpMenuTemplate-&gt;mtString;
00234             mii.fMask |= MIIM_STRING;
00235         } <span class="keywordflow">else</span> {
00236             lpmenuText = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00237         }
00238         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;str, lpmenuText);
00239 
00240         mii.dwTypeData = (LPWSTR) lpmenuText;
00241 
00242         <span class="comment">/*</span>
00243 <span class="comment">         * skip to next menu item template (DWORD boundary)</span>
00244 <span class="comment">         */</span>
00245         lpMenuTemplate = (PMENUITEMTEMPLATE2)
00246                 (((LPBYTE)lpMenuTemplate) +
00247                 <span class="keyword">sizeof</span>(MENUITEMTEMPLATE2) +
00248                 ((str.Length + 3) &amp; ~3));
00249 
00250         <span class="keywordflow">if</span> (mii.fType &amp; MFT_OWNERDRAW)
00251         {
00252             mii.fMask |= MIIM_DATA;
00253             mii.dwItemData = (ULONG_PTR) mii.dwTypeData;
00254             mii.dwTypeData = 0;
00255         }
00256 
00257         <span class="comment">/*</span>
00258 <span class="comment">         * If MFT_RIGHTORDER is specified then all subsequent</span>
00259 <span class="comment">         * menus are right-to-left as well.</span>
00260 <span class="comment">         */</span>
00261         <span class="keywordflow">if</span> (mii.fType &amp; MFT_RIGHTORDER)
00262         {
00263             mftRtl = MFT_RIGHTORDER;
00264             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a185">NtUserSetMenuFlagRtoL</a>(hMenu);
00265         }
00266 
00267         <span class="keywordflow">if</span> (wResInfo &amp; MFR_POPUP) {
00268             mii.fMask |= MIIM_SUBMENU;
00269             lpMenuTemplate = <a class="code" href="../../d9/d8/clmenu_8c.html#a1">MenuLoadChicagoTemplates</a>(lpMenuTemplate,
00270                     &amp;hSubMenu, MFR_POPUP, mftRtl);
00271             <span class="keywordflow">if</span> (lpMenuTemplate == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00272                 <span class="keywordflow">goto</span> memoryerror;
00273             mii.hSubMenu = hSubMenu;
00274         }
00275 
00276         <span class="keywordflow">if</span> (mii.fType &amp; MFT_BITMAP) {
00277 
00278             <span class="comment">/*</span>
00279 <span class="comment">             * Don't allow bitmaps from the resource file.</span>
00280 <span class="comment">             */</span>
00281             mii.fType = (mii.fType | MFT_RIGHTJUSTIFY) &amp; ~MFT_BITMAP;
00282         }
00283 
00284         mii.cch = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)-1;
00285         mii.wID = menuId;
00286         <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a181">NtUserThunkedMenuItemInfo</a>(hMenu, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00287                     &amp;mii, &amp;str)) {
00288             <span class="keywordflow">if</span> (wResInfo &amp; MFR_POPUP)
00289                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a158">NtUserDestroyMenu</a>(mii.hSubMenu);
00290             <span class="keywordflow">goto</span> memoryerror;
00291         }
00292         wResInfo &amp;= ~MFR_POPUP;
00293     } <span class="keywordflow">while</span> (!(wResInfo &amp; MFR_END));
00294 
00295     *phMenu = hMenu;
00296     <span class="keywordflow">return</span> lpMenuTemplate;
00297 
00298 memoryerror:
00299     <span class="keywordflow">if</span> (hMenu != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00300         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a158">NtUserDestroyMenu</a>(hMenu);
00301     *phMenu = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00302     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00303 }
00304 
00305 
00306 <span class="comment">/***************************************************************************\</span>
00307 <span class="comment">* CreateMenuFromResource</span>
00308 <span class="comment">*</span>
00309 <span class="comment">* Loads the menu resource named by the lpMenuTemplate parameter. The</span>
00310 <span class="comment">* template specified by lpMenuTemplate is a collection of one or more</span>
00311 <span class="comment">* MENUITEMTEMPLATE structures, each of which may contain one or more items</span>
00312 <span class="comment">* and popup menus. If successful, returns a handle to the menu otherwise</span>
00313 <span class="comment">* returns NULL.</span>
00314 <span class="comment">*</span>
00315 <span class="comment">* History:</span>
00316 <span class="comment">* 28-Sep-1990 mikeke     from win30</span>
00317 <span class="comment">\***************************************************************************/</span>
00318 
<a name="l00319"></a><a class="code" href="../../d6/d0/usercli_8h.html#a650">00319</a> HMENU <a class="code" href="../../d6/d0/usercli_8h.html#a650">CreateMenuFromResource</a>(
00320     LPBYTE lpMenuTemplate)
00321 {
00322     HMENU hMenu = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00323     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> menuTemplateVersion;
00324     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> menuTemplateHeaderSize;
00325 
00326     <span class="comment">/*</span>
00327 <span class="comment">     * Win3 menu resource: First, strip version number word out of the menu</span>
00328 <span class="comment">     * template.  This value should be 0 for Win3, 1 for win4.</span>
00329 <span class="comment">     */</span>
00330     menuTemplateVersion = *((WORD *)lpMenuTemplate)++;
00331     <span class="keywordflow">if</span> (menuTemplateVersion &gt; 1) {
00332         RIPMSG0(RIP_WARNING, <span class="stringliteral">"Menu Version number &gt; 1"</span>);
00333         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00334     }
00335     menuTemplateHeaderSize = *((WORD *)lpMenuTemplate)++;
00336     lpMenuTemplate += menuTemplateHeaderSize;
00337     <span class="keywordflow">switch</span> (menuTemplateVersion) {
00338     <span class="keywordflow">case</span> 0:
00339         <a class="code" href="../../d9/d8/clmenu_8c.html#a0">MenuLoadWinTemplates</a>(lpMenuTemplate, &amp;hMenu);
00340         <span class="keywordflow">break</span>;
00341 
00342     <span class="keywordflow">case</span> 1:
00343         <a class="code" href="../../d9/d8/clmenu_8c.html#a1">MenuLoadChicagoTemplates</a>((PMENUITEMTEMPLATE2)lpMenuTemplate, &amp;hMenu, 0, 0);
00344         <span class="keywordflow">break</span>;
00345     }
00346     <span class="keywordflow">return</span> hMenu;
00347 }
00348 
00349 <span class="comment">/***************************************************************************\</span>
00350 <span class="comment">* SetMenu (API)</span>
00351 <span class="comment">*</span>
00352 <span class="comment">* Sets the menu for the hwnd.</span>
00353 <span class="comment">*</span>
00354 <span class="comment">* History:</span>
00355 <span class="comment">* 10-Mar-1996 ChrisWil  Created.</span>
00356 <span class="comment">\***************************************************************************/</span>
00357 
<a name="l00358"></a><a class="code" href="../../d9/d8/clmenu_8c.html#a3">00358</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d8/clmenu_8c.html#a3">SetMenu</a>(
00359     HWND  hwnd,
00360     HMENU hmenu)
00361 {
00362     <span class="keywordflow">return</span> <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a226">NtUserSetMenu</a>(hwnd, hmenu, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00363 }
00364 
00365 <span class="comment">/***************************************************************************\</span>
00366 <span class="comment">* LoadMenu (API)</span>
00367 <span class="comment">*</span>
00368 <span class="comment">* Loads the menu resource named by lpMenuName from the executable</span>
00369 <span class="comment">* file associated by the module specified by the hInstance parameter. The</span>
00370 <span class="comment">* menu is loaded only if it hasn't been previously loaded. Otherwise it</span>
00371 <span class="comment">* retrieves a handle to the loaded resource. Returns NULL if unsuccessful.</span>
00372 <span class="comment">*</span>
00373 <span class="comment">* History:</span>
00374 <span class="comment">* 04-05-91 ScottLu Fixed to work with client/server.</span>
00375 <span class="comment">* 28-Sep-1990 mikeke from win30</span>
00376 <span class="comment">\***************************************************************************/</span>
00377 
<a name="l00378"></a><a class="code" href="../../d9/d8/clmenu_8c.html#a4">00378</a> HMENU <a class="code" href="../../d9/d8/clmenu_8c.html#a4">CommonLoadMenu</a>(
00379     HINSTANCE hmod,
00380     HANDLE hResInfo
00381     )
00382 {
00383     HANDLE h;
00384     PVOID p;
00385     HMENU hMenu = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00386 
00387     <span class="keywordflow">if</span> (h = <a class="code" href="../../d6/d0/usercli_8h.html#a129">LOADRESOURCE</a>(hmod, hResInfo)) {
00388 
00389         <span class="keywordflow">if</span> (p = <a class="code" href="../../d6/d0/usercli_8h.html#a130">LOCKRESOURCE</a>(h, hmod)) {
00390 
00391             hMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a650">CreateMenuFromResource</a>(p);
00392 
00393             <a class="code" href="../../d6/d0/usercli_8h.html#a131">UNLOCKRESOURCE</a>(h, hmod);
00394         }
00395         <span class="comment">/*</span>
00396 <span class="comment">         * Win95 and Win3.1 do not free this resource; some 16 bit apps (chessmaster</span>
00397 <span class="comment">         * and mavis typing) require this for their ownerdraw menu stuff.</span>
00398 <span class="comment">         * For 32 bit apps, FreeResource is a nop anyway. For 16 bit apps,</span>
00399 <span class="comment">         * Wow frees the 32 bit resource (returned by LockResource16)</span>
00400 <span class="comment">         * in UnlockResource16; the actual 16 bit resource is freed when the task</span>
00401 <span class="comment">         * goes away.</span>
00402 <span class="comment">         *</span>
00403 <span class="comment">         *   FREERESOURCE(h, hmod);</span>
00404 <span class="comment">         */</span>
00405     }
00406 
00407     <span class="keywordflow">return</span> (hMenu);
00408 }
00409 
<a name="l00410"></a><a class="code" href="../../d9/d8/clmenu_8c.html#a5">00410</a> HMENU WINAPI <a class="code" href="../../d9/d8/clmenu_8c.html#a5">LoadMenuA</a>(
00411     HINSTANCE hmod,
00412     LPCSTR lpName)
00413 {
00414     HANDLE hRes;
00415 
00416     <span class="keywordflow">if</span> (hRes = <a class="code" href="../../d6/d0/usercli_8h.html#a125">FINDRESOURCEA</a>(hmod, (LPSTR)lpName, (LPSTR)RT_MENU))
00417         <span class="keywordflow">return</span> <a class="code" href="../../d9/d8/clmenu_8c.html#a4">CommonLoadMenu</a>(hmod, hRes);
00418     <span class="keywordflow">else</span>
00419         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00420 }
00421 
<a name="l00422"></a><a class="code" href="../../d9/d8/clmenu_8c.html#a6">00422</a> HMENU WINAPI <a class="code" href="../../d9/d8/clmenu_8c.html#a6">LoadMenuW</a>(
00423     HINSTANCE hmod,
00424     LPCWSTR lpName)
00425 {
00426     HANDLE hRes;
00427 
00428     <span class="keywordflow">if</span> (hRes = <a class="code" href="../../d6/d0/usercli_8h.html#a126">FINDRESOURCEW</a>(hmod, (LPWSTR)lpName, RT_MENU))
00429         <span class="keywordflow">return</span> <a class="code" href="../../d9/d8/clmenu_8c.html#a4">CommonLoadMenu</a>(hmod, hRes);
00430     <span class="keywordflow">else</span>
00431         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00432 }
00433 <span class="comment">/***************************************************************************\</span>
00434 <span class="comment">* InternalInsertMenuItem</span>
00435 <span class="comment">*</span>
00436 <span class="comment">* History:</span>
00437 <span class="comment">*  09/20/96 GerardoB - Created</span>
00438 <span class="comment">\***************************************************************************/</span>
<a name="l00439"></a><a class="code" href="../../d6/d0/usercli_8h.html#a768">00439</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d0/usercli_8h.html#a768">InternalInsertMenuItem</a> (HMENU hMenu, UINT uID, BOOL fByPosition, LPCMENUITEMINFO lpmii)
00440 {
00441  <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a771">ThunkedMenuItemInfo</a>(hMenu, uID, fByPosition, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, (LPMENUITEMINFOW)lpmii, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00442 }
00443 
00444 <span class="comment">/***************************************************************************\</span>
00445 <span class="comment">* ValidateMENUITEMINFO() -</span>
00446 <span class="comment">*   it converts and validates a MENUITEMINFO95 or a new-MENUITEMINFO-with-old-flags</span>
00447 <span class="comment">*     to a new MENUITEMINFO -- this way all internal code can assume one look for the</span>
00448 <span class="comment">*   structure</span>
00449 <span class="comment">*</span>
00450 <span class="comment">* History:</span>
00451 <span class="comment">*  12-08-95 Ported from Nashville - jjk</span>
00452 <span class="comment">*  07-19-96 GerardoB - Fixed up for 5.0</span>
00453 <span class="comment">\***************************************************************************/</span>
<a name="l00454"></a><a class="code" href="../../d9/d8/clmenu_8c.html#a8">00454</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d0/usercli_8h.html#a769">ValidateMENUITEMINFO</a>(LPMENUITEMINFO lpmiiIn, LPMENUITEMINFO lpmii, DWORD dwAPICode)
00455 {
00456 
00457     VALIDATIONFNNAME(<a class="code" href="../../d9/d8/clmenu_8c.html#a8">ValidateMENUITEMINFO</a>)
00458     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fOldApp;
00459 
00460     <span class="keywordflow">if</span> (lpmiiIn == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00461         VALIDATIONFAIL(lpmiiIn);
00462     }
00463 
00464     <span class="comment">/*</span>
00465 <span class="comment">     * In order to map the old flags to the new ones, we might have to modify</span>
00466 <span class="comment">     *  the lpmiiIn structure. So we make a copy to avoid breaking anyone.</span>
00467 <span class="comment">     */</span>
00468     fOldApp = (lpmiiIn-&gt;cbSize == SIZEOFMENUITEMINFO95);
00469     UserAssert(SIZEOFMENUITEMINFO95 &lt; <span class="keyword">sizeof</span>(MENUITEMINFO));
00470     RtlCopyMemory(lpmii, lpmiiIn, SIZEOFMENUITEMINFO95);
00471     <span class="keywordflow">if</span> (fOldApp) {
00472         lpmii-&gt;cbSize = <span class="keyword">sizeof</span>(MENUITEMINFO);
00473         lpmii-&gt;hbmpItem = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00474     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lpmiiIn-&gt;cbSize == <span class="keyword">sizeof</span>(MENUITEMINFO)) {
00475         lpmii-&gt;hbmpItem = lpmiiIn-&gt;hbmpItem;
00476     } <span class="keywordflow">else</span> {
00477         VALIDATIONFAIL(lpmiiIn-&gt;cbSize);
00478     }
00479 
00480 
00481     <span class="keywordflow">if</span> (lpmii-&gt;fMask &amp; ~MIIM_MASK) {
00482         VALIDATIONFAIL(lpmii-&gt;fMask);
00483     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((lpmii-&gt;fMask &amp; MIIM_TYPE)
00484             &amp;&amp; (lpmii-&gt;fMask &amp; (MIIM_FTYPE | MIIM_STRING | MIIM_BITMAP))) {
00485         <span class="comment">/*</span>
00486 <span class="comment">         * Don't let them mix new and old flags</span>
00487 <span class="comment">         */</span>
00488         VALIDATIONFAIL(lpmii-&gt;fMask);
00489     }
00490 
00491     <span class="comment">/*</span>
00492 <span class="comment">     * No more validation needed for Get calls</span>
00493 <span class="comment">     */</span>
00494     <span class="keywordflow">if</span> (dwAPICode == <a class="code" href="../../d6/d0/usercli_8h.html#a255">MENUAPI_GET</a>) {
00495         <span class="comment">/*</span>
00496 <span class="comment">         * Map MIIM_TYPE for old apps doing a Get.</span>
00497 <span class="comment">         * Keep the MIIM_TYPE flag so we'll know this guy passed the old flags.</span>
00498 <span class="comment">         * GetMenuItemInfo uses lpmii-&gt;hbmpItem to determine if a bitmap</span>
00499 <span class="comment">         *  was returned. So we NULL it out here. The caller is using the</span>
00500 <span class="comment">         *  old flags so he shouldn't care about it.</span>
00501 <span class="comment">         */</span>
00502         <span class="keywordflow">if</span> (lpmii-&gt;fMask &amp; MIIM_TYPE) {
00503             lpmii-&gt;fMask |= MIIM_FTYPE | MIIM_BITMAP | MIIM_STRING;
00504             lpmii-&gt;hbmpItem = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00505         }
00506         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00507     }
00508 
00509     <span class="comment">/*</span>
00510 <span class="comment">     * Map MIIM_TYPE to MIIM_FTYPE</span>
00511 <span class="comment">     */</span>
00512     <span class="keywordflow">if</span> (lpmii-&gt;fMask &amp; MIIM_TYPE) {
00513         lpmii-&gt;fMask |= MIIM_FTYPE;
00514     }
00515 
00516     <span class="keywordflow">if</span> (lpmii-&gt;fMask &amp; MIIM_FTYPE) {
00517         <span class="keywordflow">if</span> (lpmii-&gt;fType &amp; ~MFT_MASK) {
00518             VALIDATIONFAIL(lpmii-&gt;fType);
00519         }
00520         <span class="comment">/*</span>
00521 <span class="comment">         * If using MIIM_TYPE, Map MFT_BITMAP to MIIM_BITMAP</span>
00522 <span class="comment">         *  and MFT_NONSTRING to MIIM_STRING.</span>
00523 <span class="comment">         * Old applications couldn't use string and bitmap simultaneously</span>
00524 <span class="comment">         *  so setting one implies clearing the other.</span>
00525 <span class="comment">         */</span>
00526         <span class="keywordflow">if</span> (lpmii-&gt;fMask &amp; MIIM_TYPE) {
00527             <span class="keywordflow">if</span> (lpmii-&gt;fType &amp; MFT_BITMAP) {
00528                 <span class="comment">/*</span>
00529 <span class="comment">                 * Don't display a warning. A lot of shell menus hit this</span>
00530 <span class="comment">                 * if (!fOldApp) {</span>
00531 <span class="comment">                 *     VALIDATIONOBSOLETE(MFT_BITMAP, MIIM_BITMAP);</span>
00532 <span class="comment">                 *  }</span>
00533 <span class="comment">                 */</span>
00534                 lpmii-&gt;fMask |= MIIM_BITMAP | MIIM_STRING;
00535                 lpmii-&gt;hbmpItem = (HBITMAP)lpmii-&gt;dwTypeData;
00536                 lpmii-&gt;dwTypeData = 0;
00537             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(lpmii-&gt;fType &amp; MFT_NONSTRING)) {
00538                 <span class="comment">/*</span>
00539 <span class="comment">                 * Don't display a warning. A lot of shell menus hit this</span>
00540 <span class="comment">                 * if (!fOldApp) {</span>
00541 <span class="comment">                 *     VALIDATIONOBSOLETE(MFT_STRING, MIIM_STRING);</span>
00542 <span class="comment">                 *  }</span>
00543 <span class="comment">                 */</span>
00544                 lpmii-&gt;fMask |= MIIM_BITMAP | MIIM_STRING;
00545                 lpmii-&gt;hbmpItem = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00546             }
00547         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lpmii-&gt;fType &amp; MFT_BITMAP) {
00548             <span class="comment">/*</span>
00549 <span class="comment">             * Don't let them mix new and old flags</span>
00550 <span class="comment">             */</span>
00551             VALIDATIONFAIL(lpmii-&gt;fType);
00552         }
00553     }
00554 
00555     <span class="keywordflow">if</span> ((lpmii-&gt;fMask &amp; MIIM_STATE) &amp;&amp; (lpmii-&gt;fState &amp; ~MFS_MASK)){
00556         VALIDATIONFAIL(lpmii-&gt;fState);
00557     }
00558 
00559     <span class="keywordflow">if</span> (lpmii-&gt;fMask &amp; MIIM_CHECKMARKS) {
00560         <span class="keywordflow">if</span> ((lpmii-&gt;hbmpChecked != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; !GdiValidateHandle((HBITMAP)lpmii-&gt;hbmpChecked)) {
00561             VALIDATIONFAIL(lpmii-&gt;hbmpChecked);
00562         }
00563         <span class="keywordflow">if</span> ((lpmii-&gt;hbmpUnchecked != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; !GdiValidateHandle((HBITMAP)lpmii-&gt;hbmpUnchecked)) {
00564             VALIDATIONFAIL(lpmii-&gt;hbmpUnchecked);
00565         }
00566     }
00567 
00568     <span class="keywordflow">if</span> (lpmii-&gt;fMask &amp; MIIM_SUBMENU) {
00569         <span class="keywordflow">if</span> ((lpmii-&gt;hSubMenu != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; !<a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(lpmii-&gt;hSubMenu)) {
00570             VALIDATIONFAIL(lpmii-&gt;hSubMenu);
00571         }
00572     }
00573 
00574     <span class="comment">/*</span>
00575 <span class="comment">     * Warning: NULL lpmii-&gt;hbmpItem accepted as valid (or the explorer breaks)</span>
00576 <span class="comment">     */</span>
00577     <span class="keywordflow">if</span> (lpmii-&gt;fMask &amp; MIIM_BITMAP) {
00578         <span class="keywordflow">if</span> ((lpmii-&gt;hbmpItem != HBMMENU_CALLBACK)
00579                 &amp;&amp; (lpmii-&gt;hbmpItem &gt;= HBMMENU_MAX)
00580                 &amp;&amp; !GdiValidateHandle(lpmii-&gt;hbmpItem)) {
00581 
00582             <span class="comment">/*</span>
00583 <span class="comment">             * Compatibility hack</span>
00584 <span class="comment">             */</span>
00585             <span class="keywordflow">if</span> (((HBITMAP)LOWORD(HandleToUlong(lpmii-&gt;hbmpItem)) &gt;= HBMMENU_MAX) || !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lpmii-&gt;hbmpItem)) {
00586                 VALIDATIONFAIL(lpmii-&gt;hbmpItem);
00587             }
00588         }
00589     }
00590 
00591     <span class="comment">/*</span>
00592 <span class="comment">     * Warning: No dwTypeData / cch validation</span>
00593 <span class="comment">     */</span>
00594 
00595     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00596 
00597     VALIDATIONERROR(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00598 }
00599 
00600 <span class="comment">/***************************************************************************\</span>
00601 <span class="comment">* ValidateMENUINFO() -</span>
00602 <span class="comment">*</span>
00603 <span class="comment">* History:</span>
00604 <span class="comment">*  07-22-96 GerardoB - Added header and Fixed up for 5.0</span>
00605 <span class="comment">\***************************************************************************/</span>
00606 
<a name="l00607"></a><a class="code" href="../../d6/d0/usercli_8h.html#a770">00607</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d0/usercli_8h.html#a770">ValidateMENUINFO</a>(LPCMENUINFO lpmi, DWORD dwAPICode)
00608 {
00609     VALIDATIONFNNAME(<a class="code" href="../../d9/d8/clmenu_8c.html#a9">ValidateMENUINFO</a>)
00610 
00611     <span class="keywordflow">if</span> (lpmi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00612         VALIDATIONFAIL(lpmi);
00613     }
00614 
00615     <span class="keywordflow">if</span> (lpmi-&gt;cbSize != <span class="keyword">sizeof</span>(MENUINFO)) {
00616         VALIDATIONFAIL(lpmi-&gt;cbSize);
00617     }
00618 
00619     <span class="keywordflow">if</span> (lpmi-&gt;fMask &amp; ~MIM_MASK) {
00620         VALIDATIONFAIL(lpmi-&gt;fMask);
00621     }
00622 
00623     <span class="comment">/*</span>
00624 <span class="comment">     * No more validation needed for Get calls</span>
00625 <span class="comment">     */</span>
00626     <span class="keywordflow">if</span> (dwAPICode == <a class="code" href="../../d6/d0/usercli_8h.html#a255">MENUAPI_GET</a>){
00627         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00628     }
00629 
00630     <span class="keywordflow">if</span> ((lpmi-&gt;fMask &amp; MIM_STYLE) &amp;&amp; (lpmi-&gt;dwStyle &amp; ~MNS_VALID)) {
00631         VALIDATIONFAIL(lpmi-&gt;dwStyle);
00632     }
00633 
00634     <span class="keywordflow">if</span> (lpmi-&gt;fMask &amp; MIM_BACKGROUND) {
00635         <span class="keywordflow">if</span> ((lpmi-&gt;hbrBack != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00636                 &amp;&amp; !GdiValidateHandle((HBRUSH)lpmi-&gt;hbrBack)) {
00637 
00638             VALIDATIONFAIL(lpmi-&gt;hbrBack);
00639         }
00640     }
00641 
00642     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00643 
00644     VALIDATIONERROR(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00645 }
00646 <span class="comment">/***************************************************************************\</span>
00647 <span class="comment">* GetMenuInfo</span>
00648 <span class="comment">*</span>
00649 <span class="comment">* History:</span>
00650 <span class="comment">*  07-22-96 GerardoB - Added header and Fixed up for 5.0</span>
00651 <span class="comment">\***************************************************************************/</span>
<a name="l00652"></a><a class="code" href="../../d9/d8/clmenu_8c.html#a10">00652</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d8/clmenu_8c.html#a10">GetMenuInfo</a>(HMENU hMenu, LPMENUINFO lpmi)
00653 {
00654     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00655 
00656     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a770">ValidateMENUINFO</a>(lpmi, <a class="code" href="../../d6/d0/usercli_8h.html#a255">MENUAPI_GET</a>)) {
00657         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00658     }
00659 
00660     pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a22">VALIDATEHMENU</a>(hMenu);
00661     <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00662         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00663     }
00664 
00665     <span class="keywordflow">if</span> (lpmi-&gt;fMask &amp; MIM_STYLE) {
00666         lpmi-&gt;dwStyle = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o1">fFlags</a> &amp; MNS_VALID;
00667     }
00668 
00669     <span class="keywordflow">if</span> (lpmi-&gt;fMask &amp; MIM_MAXHEIGHT) {
00670         lpmi-&gt;cyMax = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o11">cyMax</a>;
00671     }
00672 
00673     <span class="keywordflow">if</span> (lpmi-&gt;fMask &amp; MIM_BACKGROUND) {
00674         lpmi-&gt;hbrBack = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o13">hbrBack</a>;
00675     }
00676 
00677     <span class="keywordflow">if</span> (lpmi-&gt;fMask &amp; MIM_HELPID) {
00678         lpmi-&gt;dwContextHelpID = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o10">dwContextHelpId</a>;
00679     }
00680 
00681     <span class="keywordflow">if</span> (lpmi-&gt;fMask &amp; MIM_MENUDATA) {
00682         lpmi-&gt;dwMenuData = KERNEL_ULONG_PTR_TO_ULONG_PTR(pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o12">dwMenuData</a>);
00683     }
00684 
00685     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00686 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
