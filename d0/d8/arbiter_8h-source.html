<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: arbiter.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>arbiter.h</h1><a href="../../d9/d8/arbiter_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1997  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    arbiter.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains support routines for the Pnp resource arbiters.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Andrew Thornton (andrewth) 1-April-1997</span>
00016 <span class="comment"></span>
00017 <span class="comment"></span>
00018 <span class="comment">Environment:</span>
00019 <span class="comment"></span>
00020 <span class="comment">    Kernel mode</span>
00021 <span class="comment"></span>
00022 <span class="comment">--*/</span>
00023 
00024 <span class="preprocessor">#ifndef _ARBITER_</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define _ARBITER_</span>
00026 <span class="preprocessor"></span>
00027 <span class="preprocessor">#if !defined(MAXULONGLONG)</span>
<a name="l00028"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a0">00028</a> <span class="preprocessor"></span><span class="preprocessor">#define MAXULONGLONG ((ULONGLONG)-1)</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00030 <span class="preprocessor"></span>
00031 
00032 <span class="preprocessor">#if ARB_DBG</span>
00033 <span class="preprocessor"></span>
00034 <span class="comment">//</span>
00035 <span class="comment">// Debug print level:</span>
00036 <span class="comment">//    -1 = no messages</span>
00037 <span class="comment">//     0 = vital messages only</span>
00038 <span class="comment">//     1 = call trace</span>
00039 <span class="comment">//     2 = verbose messages</span>
00040 <span class="comment">//</span>
00041 
00042 <span class="keyword">extern</span> LONG <a class="code" href="../../d8/d4/arb_2debug_8c.html#a0">ArbDebugLevel</a>;
00043 
00044 <span class="preprocessor">#define ARB_PRINT(Level, Message) \</span>
00045 <span class="preprocessor">    if (Level &lt;= ArbDebugLevel) DbgPrint Message</span>
00046 <span class="preprocessor"></span>
00047 <span class="preprocessor">#define ARB_INDENT(Level, Count) \</span>
00048 <span class="preprocessor">    if (Level &lt; ArbDebugLevel) ArbpIndent(Count)</span>
00049 <span class="preprocessor"></span>
00050 <span class="preprocessor">#else</span>
00051 <span class="preprocessor"></span>
<a name="l00052"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a1">00052</a> <span class="preprocessor">#define ARB_PRINT(Level, Message)</span>
<a name="l00053"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a2">00053</a> <span class="preprocessor"></span><span class="preprocessor">#define ARB_INDENT(Level, Count)</span>
00054 <span class="preprocessor"></span>
00055 <span class="preprocessor">#endif // ARB_DBG</span>
00056 <span class="preprocessor"></span>
00057 
00058 <span class="comment">//</span>
00059 <span class="comment">// The ARBITER_ORDRING_LIST abstract data type</span>
00060 <span class="comment">//</span>
00061 
<a name="l00062"></a><a class="code" href="../../d1/d8/struct__ARBITER__ORDERING.html">00062</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d8/struct__ARBITER__ORDERING.html">_ARBITER_ORDERING</a> {
<a name="l00063"></a><a class="code" href="../../d1/d8/struct__ARBITER__ORDERING.html#o0">00063</a>     ULONGLONG <a class="code" href="../../d1/d8/struct__ARBITER__ORDERING.html#o0">Start</a>;
<a name="l00064"></a><a class="code" href="../../d1/d8/struct__ARBITER__ORDERING.html#o1">00064</a>     ULONGLONG <a class="code" href="../../d1/d8/struct__ARBITER__ORDERING.html#o1">End</a>;
00065 } <a class="code" href="../../d1/d8/struct__ARBITER__ORDERING.html">ARBITER_ORDERING</a>, *<a class="code" href="../../d1/d8/struct__ARBITER__ORDERING.html">PARBITER_ORDERING</a>;
00066 
00067 
<a name="l00068"></a><a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html">00068</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html">_ARBITER_ORDERING_LIST</a> {
00069 
00070     <span class="comment">//</span>
00071     <span class="comment">// The number of valid entries in the array</span>
00072     <span class="comment">//</span>
<a name="l00073"></a><a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html#o0">00073</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html#o0">Count</a>;
00074 
00075     <span class="comment">//</span>
00076     <span class="comment">// The maximum number of entries that can fit in the Ordering buffer</span>
00077     <span class="comment">//</span>
<a name="l00078"></a><a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html#o1">00078</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html#o1">Maximum</a>;
00079 
00080     <span class="comment">//</span>
00081     <span class="comment">// Array of orderings</span>
00082     <span class="comment">//</span>
<a name="l00083"></a><a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html#o2">00083</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a32">PARBITER_ORDERING</a> <a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html#o2">Orderings</a>;
00084 
00085 } <a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html">ARBITER_ORDERING_LIST</a>, *<a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html">PARBITER_ORDERING_LIST</a>;
00086 
00087 
00088 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00089 <a class="code" href="../../d9/d8/arbiter_8h.html#a62">ArbInitializeOrderingList</a>(
00090     IN OUT PARBITER_ORDERING_LIST List
00091     );
00092 
00093 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00094 <a class="code" href="../../d9/d8/arbiter_8h.html#a63">ArbFreeOrderingList</a>(
00095     IN OUT PARBITER_ORDERING_LIST List
00096     );
00097 
00098 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00099 <a class="code" href="../../d9/d8/arbiter_8h.html#a64">ArbCopyOrderingList</a>(
00100     OUT PARBITER_ORDERING_LIST Destination,
00101     IN PARBITER_ORDERING_LIST Source
00102     );
00103 
00104 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00105 <a class="code" href="../../d9/d8/arbiter_8h.html#a65">ArbAddOrdering</a>(
00106     OUT PARBITER_ORDERING_LIST List,
00107     IN ULONGLONG Start,
00108     IN ULONGLONG End
00109     );
00110 
00111 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00112 <a class="code" href="../../d9/d8/arbiter_8h.html#a66">ArbPruneOrdering</a>(
00113     IN OUT PARBITER_ORDERING_LIST OrderingList,
00114     IN ULONGLONG Start,
00115     IN ULONGLONG End
00116     );
00117 
00118 <span class="comment">//</span>
00119 <span class="comment">// ULONGLONG</span>
00120 <span class="comment">// ALIGN_ADDRESS_DOWN(</span>
00121 <span class="comment">//    ULONGLONG address,</span>
00122 <span class="comment">//    ULONG alignment</span>
00123 <span class="comment">//    );</span>
00124 <span class="comment">//</span>
00125 <span class="comment">// This aligns address to the previously correctly aligned value</span>
00126 <span class="comment">//</span>
<a name="l00127"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a3">00127</a> <span class="preprocessor">#define ALIGN_ADDRESS_DOWN(address, alignment) \</span>
00128 <span class="preprocessor">    ((address) &amp; ~((ULONGLONG)alignment - 1))</span>
00129 <span class="preprocessor"></span>
00130 <span class="comment">//</span>
00131 <span class="comment">// ULONGLONG</span>
00132 <span class="comment">// ALIGN_ADDRESS_UP(</span>
00133 <span class="comment">//    ULONGLONG address,</span>
00134 <span class="comment">//    ULONG alignment</span>
00135 <span class="comment">//    );</span>
00136 <span class="comment">//</span>
00137 <span class="comment">// This aligns address to the next correctly aligned value</span>
00138 <span class="comment">//</span>
<a name="l00139"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a4">00139</a> <span class="preprocessor">#define ALIGN_ADDRESS_UP(address, alignment) \</span>
00140 <span class="preprocessor">    (ALIGN_ADDRESS_DOWN( (address + alignment - 1), alignment))</span>
00141 <span class="preprocessor"></span>
00142 
<a name="l00143"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a5">00143</a> <span class="preprocessor">#define LENGTH_OF(_start, _end) \</span>
00144 <span class="preprocessor">    ((_end) - (_start) + 1)</span>
00145 <span class="preprocessor"></span>
00146 <span class="comment">//</span>
00147 <span class="comment">// This indicates that the alternative can coexist with shared resources and</span>
00148 <span class="comment">// should be added to the range lists shared</span>
00149 <span class="comment">//</span>
<a name="l00150"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a6">00150</a> <span class="preprocessor">#define ARBITER_ALTERNATIVE_FLAG_SHARED         0x00000001</span>
00151 <span class="preprocessor"></span>
00152 <span class="comment">//</span>
00153 <span class="comment">// This indicates that the request if for a specific range with no alternatives.</span>
00154 <span class="comment">// ie (End - Start + 1 == Length) eg port 60-60 L1 A1</span>
00155 <span class="comment">//</span>
<a name="l00156"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a7">00156</a> <span class="preprocessor">#define ARBITER_ALTERNATIVE_FLAG_FIXED          0x00000002</span>
00157 <span class="preprocessor"></span>
00158 <span class="comment">//</span>
00159 <span class="comment">// This indicates that request is invalid</span>
00160 <span class="comment">//</span>
<a name="l00161"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a8">00161</a> <span class="preprocessor">#define ARBITER_ALTERNATIVE_FLAG_INVALID        0x00000004</span>
00162 <span class="preprocessor"></span>
<a name="l00163"></a><a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html">00163</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html">_ARBITER_ALTERNATIVE</a> {
00164 
00165     <span class="comment">//</span>
00166     <span class="comment">// The minimum acceptable start value from the requirement descriptor</span>
00167     <span class="comment">//</span>
<a name="l00168"></a><a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o0">00168</a>     ULONGLONG <a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o0">Minimum</a>;
00169 
00170     <span class="comment">//</span>
00171     <span class="comment">// The maximum acceptable end value from the requirement descriptor</span>
00172     <span class="comment">//</span>
<a name="l00173"></a><a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o1">00173</a>     ULONGLONG <a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o1">Maximum</a>;
00174 
00175     <span class="comment">//</span>
00176     <span class="comment">// The length from the requirement descriptor</span>
00177     <span class="comment">//</span>
<a name="l00178"></a><a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o2">00178</a>     ULONG <a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o2">Length</a>;
00179 
00180     <span class="comment">//</span>
00181     <span class="comment">// The alignment from the requirement descriptor</span>
00182     <span class="comment">//</span>
<a name="l00183"></a><a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o3">00183</a>     ULONG <a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o3">Alignment</a>;
00184 
00185     <span class="comment">//</span>
00186     <span class="comment">// Priority index - BUGBUG - explain better</span>
00187     <span class="comment">//</span>
00188 
<a name="l00189"></a><a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o4">00189</a>     LONG <a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o4">Priority</a>;
00190 
00191     <span class="comment">//</span>
00192     <span class="comment">// Flags - ARBITER_ALTERNATIVE_FLAG_SHARED - indicates the current</span>
00193     <span class="comment">//             requirement was for a shared resource.</span>
00194     <span class="comment">//         ARBITER_ALTERNATIVE_FLAG_FIXED - indicates the current</span>
00195     <span class="comment">//             requirement is for a specific resource (eg ports 220-230 and</span>
00196     <span class="comment">//             nothing else)</span>
00197     <span class="comment">//</span>
<a name="l00198"></a><a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o5">00198</a>     ULONG <a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o5">Flags</a>;
00199 
00200     <span class="comment">//</span>
00201     <span class="comment">// Descriptor - the descriptor describing this alternative</span>
00202     <span class="comment">//</span>
<a name="l00203"></a><a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o6">00203</a>     PIO_RESOURCE_DESCRIPTOR <a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o6">Descriptor</a>;
00204 
00205     <span class="comment">//</span>
00206     <span class="comment">// Packing...</span>
00207     <span class="comment">//</span>
<a name="l00208"></a><a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o7">00208</a>     ULONG <a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html#o7">Reserved</a>[3];
00209 
00210 } <a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html">ARBITER_ALTERNATIVE</a>, *<a class="code" href="../../d6/d7/struct__ARBITER__ALTERNATIVE.html">PARBITER_ALTERNATIVE</a>;
00211 
00212 <span class="comment">//</span>
00213 <span class="comment">// The least significant 16 bits are reserved for the base arbitration code</span>
00214 <span class="comment">// the most significant are arbiter specific</span>
00215 <span class="comment">//</span>
00216 
<a name="l00217"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a9">00217</a> <span class="preprocessor">#define ARBITER_STATE_FLAG_RETEST           0x0001</span>
<a name="l00218"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a10">00218</a> <span class="preprocessor"></span><span class="preprocessor">#define ARBITER_STATE_FLAG_BOOT             0x0002</span>
<a name="l00219"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a11">00219</a> <span class="preprocessor"></span><span class="preprocessor">#define ARBITER_STATE_FLAG_CONFLICT         0x0004</span>
<a name="l00220"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a12">00220</a> <span class="preprocessor"></span><span class="preprocessor">#define ARBITER_STATE_FLAG_NULL_CONFLICT_OK 0x0008</span>
00221 <span class="preprocessor"></span>
<a name="l00222"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html">00222</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html">_ARBITER_ALLOCATION_STATE</a> {
00223 
00224     <span class="comment">//</span>
00225     <span class="comment">// The current value being considered as a possible start value</span>
00226     <span class="comment">//</span>
<a name="l00227"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o0">00227</a>     ULONGLONG <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o0">Start</a>;
00228 
00229     <span class="comment">//</span>
00230     <span class="comment">// The current value being considered as a possible end value</span>
00231     <span class="comment">//</span>
<a name="l00232"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o1">00232</a>     ULONGLONG <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o1">End</a>;
00233 
00234     <span class="comment">//</span>
00235     <span class="comment">// The values currently being considered as the Minimum and Maximum (this is</span>
00236     <span class="comment">// different because the prefered orderings can restrict the ranges where</span>
00237     <span class="comment">// we can allocate)</span>
00238     <span class="comment">//</span>
<a name="l00239"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o2">00239</a>     ULONGLONG <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o2">CurrentMinimum</a>;
<a name="l00240"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o3">00240</a>     ULONGLONG <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o3">CurrentMaximum</a>;
00241 
00242     <span class="comment">//</span>
00243     <span class="comment">// The entry in the arbitration list containing this request.</span>
00244     <span class="comment">//</span>
<a name="l00245"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o4">00245</a>     <a class="code" href="../../d0/d8/struct__ARBITER__LIST__ENTRY.html">PARBITER_LIST_ENTRY</a> <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o4">Entry</a>;
00246 
00247     <span class="comment">//</span>
00248     <span class="comment">// The alternative currently being considered</span>
00249     <span class="comment">//</span>
<a name="l00250"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o5">00250</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a36">PARBITER_ALTERNATIVE</a> <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o5">CurrentAlternative</a>;
00251 
00252     <span class="comment">//</span>
00253     <span class="comment">// The number of alternatives in the Alternatives array</span>
00254     <span class="comment">//</span>
<a name="l00255"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o6">00255</a>     ULONG <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o6">AlternativeCount</a>;
00256 
00257     <span class="comment">//</span>
00258     <span class="comment">// The arbiters representation of the alternatives being considered</span>
00259     <span class="comment">//</span>
<a name="l00260"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o7">00260</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a36">PARBITER_ALTERNATIVE</a> <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o7">Alternatives</a>;
00261 
00262     <span class="comment">//</span>
00263     <span class="comment">// Flags - ARBITER_STATE_FLAG_RETEST - indicates that we are in a retest</span>
00264     <span class="comment">//              operation not a test.</span>
00265     <span class="comment">//         ARBITER_STATE_FLAG_BOOT - indicates we are in a boot allocation</span>
00266     <span class="comment">//              operation not a test.</span>
00267     <span class="comment">//</span>
<a name="l00268"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o8">00268</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o8">Flags</a>;
00269 
00270     <span class="comment">//</span>
00271     <span class="comment">// RangeAttributes - these are logically ORed in to the attributes for all</span>
00272     <span class="comment">// ranges added to the range list.</span>
00273     <span class="comment">//</span>
<a name="l00274"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o9">00274</a>     UCHAR <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o9">RangeAttributes</a>;
00275 
00276     <span class="comment">//</span>
00277     <span class="comment">// Ranges that are to be considered available</span>
00278     <span class="comment">//</span>
<a name="l00279"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o10">00279</a>     UCHAR <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o10">RangeAvailableAttributes</a>;
00280 
00281     <span class="comment">//</span>
00282     <span class="comment">// Space for the arbiter to use as it wishes</span>
00283     <span class="comment">//</span>
<a name="l00284"></a><a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o11">00284</a>     ULONG_PTR <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html#o11">WorkSpace</a>;
00285 
00286 } <a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html">ARBITER_ALLOCATION_STATE</a>, *<a class="code" href="../../d5/d7/struct__ARBITER__ALLOCATION__STATE.html">PARBITER_ALLOCATION_STATE</a>;
00287 
<a name="l00288"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a39">00288</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html">_ARBITER_INSTANCE</a> <a class="code" href="../../d9/d8/arbiter_8h.html#a60">ARBITER_INSTANCE</a>, *<a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a>;
00289 
00290 <span class="keyword">typedef</span>
00291 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00292"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a40">00292</a> (*PARBITER_UNPACK_REQUIREMENT) (
00293     IN PIO_RESOURCE_DESCRIPTOR Descriptor,
00294     OUT PULONGLONG Minimum,
00295     OUT PULONGLONG Maximum,
00296     OUT PULONG Length,
00297     OUT PULONG Alignment
00298     );
00299 
00300 <span class="keyword">typedef</span>
00301 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00302"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a41">00302</a> (*PARBITER_PACK_RESOURCE) (
00303     IN PIO_RESOURCE_DESCRIPTOR Requirement,
00304     IN ULONGLONG <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a>,
00305     OUT PCM_PARTIAL_RESOURCE_DESCRIPTOR Descriptor
00306     );
00307 
00308 <span class="keyword">typedef</span>
00309 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00310"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a42">00310</a> (*PARBITER_UNPACK_RESOURCE) (
00311     IN PCM_PARTIAL_RESOURCE_DESCRIPTOR Descriptor,
00312     OUT PULONGLONG <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a>,
00313     OUT PULONG Length
00314     );
00315 
00316 <span class="keyword">typedef</span>
00317 LONG
<a name="l00318"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a43">00318</a> (*PARBITER_SCORE_REQUIREMENT) (
00319     IN PIO_RESOURCE_DESCRIPTOR Descriptor
00320     );
00321 
00322 <span class="keyword">typedef</span>
00323 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00324"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a44">00324</a> (*PARBITER_PREPROCESS_ENTRY)(
00325     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00326     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a38">PARBITER_ALLOCATION_STATE</a> Entry
00327     );
00328 
00329 <span class="keyword">typedef</span>
00330 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00331"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a45">00331</a> (*PARBITER_ALLOCATE_ENTRY)(
00332     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00333     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a38">PARBITER_ALLOCATION_STATE</a> Entry
00334     );
00335 
00336 <span class="keyword">typedef</span>
00337 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00338"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a46">00338</a> (*PARBITER_TEST_ALLOCATION)(
00339     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00340     IN OUT PLIST_ENTRY ArbitrationList
00341     );
00342 
00343 <span class="keyword">typedef</span>
00344 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00345"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a47">00345</a> (*PARBITER_COMMIT_ALLOCATION)(
00346     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter
00347     );
00348 
00349 <span class="keyword">typedef</span>
00350 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00351"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a48">00351</a> (*PARBITER_ROLLBACK_ALLOCATION)(
00352     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter
00353     );
00354 
00355 <span class="keyword">typedef</span>
00356 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00357"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a49">00357</a> (*PARBITER_RETEST_ALLOCATION)(
00358     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00359     IN OUT PLIST_ENTRY ArbitrationList
00360     );
00361 
00362 <span class="keyword">typedef</span>
00363 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00364"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a50">00364</a> (*PARBITER_BOOT_ALLOCATION)(
00365     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00366     IN OUT PLIST_ENTRY ArbitrationList
00367     );
00368 
00369 <span class="keyword">typedef</span>
00370 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00371"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a51">00371</a> (*PARBITER_ADD_RESERVED)(
00372     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00373     IN PIO_RESOURCE_DESCRIPTOR Requirement      OPTIONAL,
00374     IN PCM_PARTIAL_RESOURCE_DESCRIPTOR <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a> OPTIONAL
00375     );
00376 
00377 <span class="keyword">typedef</span>
00378 BOOLEAN
<a name="l00379"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a52">00379</a> (*PARBITER_GET_NEXT_ALLOCATION_RANGE)(
00380     <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00381     <a class="code" href="../../d9/d8/arbiter_8h.html#a38">PARBITER_ALLOCATION_STATE</a> State
00382     );
00383 
00384 <span class="keyword">typedef</span>
00385 BOOLEAN
<a name="l00386"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a53">00386</a> (*PARBITER_FIND_SUITABLE_RANGE)(
00387     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00388     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a38">PARBITER_ALLOCATION_STATE</a> State
00389     );
00390 
00391 <span class="keyword">typedef</span>
00392 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00393"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a54">00393</a> (*PARBITER_ADD_ALLOCATION)(
00394     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00395     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a38">PARBITER_ALLOCATION_STATE</a> State
00396     );
00397 
00398 <span class="keyword">typedef</span>
00399 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00400"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a55">00400</a> (*PARBITER_BACKTRACK_ALLOCATION)(
00401     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00402     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a38">PARBITER_ALLOCATION_STATE</a> State
00403     );
00404 
00405 <span class="keyword">typedef</span>
00406 BOOLEAN
<a name="l00407"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a56">00407</a> (*PARBITER_OVERRIDE_CONFLICT)(
00408     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00409     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a38">PARBITER_ALLOCATION_STATE</a> State
00410     );
00411 
00412 <span class="keyword">typedef</span>
00413 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00414"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a57">00414</a> (*PARBITER_QUERY_ARBITRATE)(
00415     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00416     IN PLIST_ENTRY ArbitrationList
00417     );
00418 
00419 <span class="keyword">typedef</span>
00420 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00421"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a58">00421</a> (*PARBITER_QUERY_CONFLICT)(
00422     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00423     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PhysicalDeviceObject,
00424     IN PIO_RESOURCE_DESCRIPTOR ConflictingResource,
00425     OUT PULONG ConflictCount,
00426     OUT <a class="code" href="../../d7/d7/struct__ARBITER__CONFLICT__INFO.html">PARBITER_CONFLICT_INFO</a> *Conflicts
00427     );
00428 
00429 <span class="keyword">typedef</span>
00430 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00431"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a59">00431</a> (*PARBITER_START_ARBITER)(
00432     IN <a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a> Arbiter,
00433     IN PCM_RESOURCE_LIST StartResources
00434     );
00435 
00436 <span class="comment">//</span>
00437 <span class="comment">// Attributes for the ranges</span>
00438 <span class="comment">//</span>
00439 
<a name="l00440"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a13">00440</a> <span class="preprocessor">#define ARBITER_RANGE_BOOT_ALLOCATED    0x01</span>
00441 <span class="preprocessor"></span>
<a name="l00442"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a14">00442</a> <span class="preprocessor">#define ARBITER_RANGE_ALIAS             0x10</span>
<a name="l00443"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a15">00443</a> <span class="preprocessor"></span><span class="preprocessor">#define ARBITER_RANGE_POSITIVE_DECODE   0x20</span>
00444 <span class="preprocessor"></span>
<a name="l00445"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a16">00445</a> <span class="preprocessor">#define INITIAL_ALLOCATION_STATE_SIZE   PAGE_SIZE</span>
00446 <span class="preprocessor"></span>
<a name="l00447"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a17">00447</a> <span class="preprocessor">#define ARBITER_INSTANCE_SIGNATURE      'sbrA'</span>
00448 <span class="preprocessor"></span>
00449 
<a name="l00450"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html">00450</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html">_ARBITER_INSTANCE</a> {
00451     <span class="comment">//</span>
00452     <span class="comment">// Signature - must be ARBITER_INSTANCE_SIGNATURE</span>
00453     <span class="comment">//</span>
<a name="l00454"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o0">00454</a>     ULONG <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o0">Signature</a>;
00455 
00456     <span class="comment">//</span>
00457     <span class="comment">// Synchronisation lock</span>
00458     <span class="comment">//</span>
<a name="l00459"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o1">00459</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o1">MutexEvent</a>;
00460 
00461     <span class="comment">//</span>
00462     <span class="comment">// The name of this arbiter - used for debugging and registry storage</span>
00463     <span class="comment">//</span>
<a name="l00464"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o2">00464</a>     PWSTR <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o2">Name</a>;
00465 
00466     <span class="comment">//</span>
00467     <span class="comment">// The resource type this arbiter arbitrates.</span>
00468     <span class="comment">//</span>
<a name="l00469"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o3">00469</a>     CM_RESOURCE_TYPE <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o3">ResourceType</a>;
00470 
00471     <span class="comment">//</span>
00472     <span class="comment">// Pointer to a pool allocated range list which contains the current</span>
00473     <span class="comment">// allocation</span>
00474     <span class="comment">//</span>
<a name="l00475"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o4">00475</a>     PRTL_RANGE_LIST <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o4">Allocation</a>;
00476 
00477     <span class="comment">//</span>
00478     <span class="comment">// Pointer to a pool allocated range list which contains the allocation</span>
00479     <span class="comment">// under considetation.  This is set by test allocation.</span>
00480     <span class="comment">//</span>
<a name="l00481"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o5">00481</a>     PRTL_RANGE_LIST <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o5">PossibleAllocation</a>;
00482 
00483     <span class="comment">//</span>
00484     <span class="comment">// The order in which these resources should be allocated.  Taken from the</span>
00485     <span class="comment">// HKLM\System\CurrentControlSet\Control\SystemResources\AssignmentOrdering</span>
00486     <span class="comment">// key and modified based on the reserved resources.</span>
00487     <span class="comment">//</span>
<a name="l00488"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o6">00488</a>     <a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html">ARBITER_ORDERING_LIST</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o6">OrderingList</a>;
00489 
00490     <span class="comment">//</span>
00491     <span class="comment">// The resources that should be reserved (not allocated until absolutley</span>
00492     <span class="comment">// necessary)</span>
00493     <span class="comment">//</span>
<a name="l00494"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o7">00494</a>     <a class="code" href="../../d2/d8/struct__ARBITER__ORDERING__LIST.html">ARBITER_ORDERING_LIST</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o7">ReservedList</a>;
00495 
00496     <span class="comment">//</span>
00497     <span class="comment">// The reference count of the number of entities that are using the</span>
00498     <span class="comment">// ARBITER_INTERFACE associated with this instance.</span>
00499     <span class="comment">//</span>
<a name="l00500"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o8">00500</a>     LONG <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o8">ReferenceCount</a>;
00501 
00502     <span class="comment">//</span>
00503     <span class="comment">// The ARBITER_INTERFACE associated with this instance.</span>
00504     <span class="comment">//</span>
<a name="l00505"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o9">00505</a>     <a class="code" href="../../d9/d7/struct__ARBITER__INTERFACE.html">PARBITER_INTERFACE</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o9">Interface</a>;
00506 
00507     <span class="comment">//</span>
00508     <span class="comment">// The size in bytes of the currently allocated AllocationStack</span>
00509     <span class="comment">//</span>
<a name="l00510"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o10">00510</a>     ULONG <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o10">AllocationStackMaxSize</a>;
00511 
00512     <span class="comment">//</span>
00513     <span class="comment">// A pointer to an array of ARBITER_ALLOCATION_STATE entries encapsulating</span>
00514     <span class="comment">// the state of the current arbitration</span>
00515     <span class="comment">//</span>
<a name="l00516"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o11">00516</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a38">PARBITER_ALLOCATION_STATE</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o11">AllocationStack</a>;
00517 
00518 
00519     <span class="comment">//</span>
00520     <span class="comment">// Required helper function dispatches - these functions must always be</span>
00521     <span class="comment">// provided</span>
00522     <span class="comment">//</span>
00523 
<a name="l00524"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o12">00524</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a40">PARBITER_UNPACK_REQUIREMENT</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o12">UnpackRequirement</a>;
<a name="l00525"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o13">00525</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a41">PARBITER_PACK_RESOURCE</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o13">PackResource</a>;
<a name="l00526"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o14">00526</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a42">PARBITER_UNPACK_RESOURCE</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o14">UnpackResource</a>;
<a name="l00527"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o15">00527</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a43">PARBITER_SCORE_REQUIREMENT</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o15">ScoreRequirement</a>;
00528 
00529 
00530     <span class="comment">//</span>
00531     <span class="comment">// Main arbiter action dispatches</span>
00532     <span class="comment">//</span>
<a name="l00533"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o16">00533</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a46">PARBITER_TEST_ALLOCATION</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o16">TestAllocation</a>;                    OPTIONAL
<a name="l00534"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o17">00534</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a49">PARBITER_RETEST_ALLOCATION</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o17">RetestAllocation</a>;                OPTIONAL
<a name="l00535"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o18">00535</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a47">PARBITER_COMMIT_ALLOCATION</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o18">CommitAllocation</a>;                OPTIONAL
<a name="l00536"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o19">00536</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a48">PARBITER_ROLLBACK_ALLOCATION</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o19">RollbackAllocation</a>;            OPTIONAL
<a name="l00537"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o20">00537</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a50">PARBITER_BOOT_ALLOCATION</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o20">BootAllocation</a>;                    OPTIONAL
<a name="l00538"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o21">00538</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a57">PARBITER_QUERY_ARBITRATE</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o21">QueryArbitrate</a>;                    OPTIONAL
<a name="l00539"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o22">00539</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a58">PARBITER_QUERY_CONFLICT</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o22">QueryConflict</a>;                      OPTIONAL
<a name="l00540"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o23">00540</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a51">PARBITER_ADD_RESERVED</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o23">AddReserved</a>;                          OPTIONAL
<a name="l00541"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o24">00541</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a59">PARBITER_START_ARBITER</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o24">StartArbiter</a>;                        OPTIONAL
00542     <span class="comment">//</span>
00543     <span class="comment">// Optional helper functions</span>
00544     <span class="comment">//</span>
<a name="l00545"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o25">00545</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a44">PARBITER_PREPROCESS_ENTRY</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o25">PreprocessEntry</a>;                  OPTIONAL
<a name="l00546"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o26">00546</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a45">PARBITER_ALLOCATE_ENTRY</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o26">AllocateEntry</a>;                      OPTIONAL
<a name="l00547"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o27">00547</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a52">PARBITER_GET_NEXT_ALLOCATION_RANGE</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o27">GetNextAllocationRange</a>;  OPTIONAL
<a name="l00548"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o28">00548</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a53">PARBITER_FIND_SUITABLE_RANGE</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o28">FindSuitableRange</a>;             OPTIONAL
<a name="l00549"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o29">00549</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a54">PARBITER_ADD_ALLOCATION</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o29">AddAllocation</a>;                      OPTIONAL
<a name="l00550"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o30">00550</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a55">PARBITER_BACKTRACK_ALLOCATION</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o30">BacktrackAllocation</a>;          OPTIONAL
<a name="l00551"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o31">00551</a>     <a class="code" href="../../d9/d8/arbiter_8h.html#a56">PARBITER_OVERRIDE_CONFLICT</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o31">OverrideConflict</a>;                OPTIONAL
00552 
00553     <span class="comment">//</span>
00554     <span class="comment">// Debugging support</span>
00555     <span class="comment">//</span>
<a name="l00556"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o32">00556</a>     BOOLEAN <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o32">TransactionInProgress</a>;
00557 
00558     <span class="comment">//</span>
00559     <span class="comment">// Arbiter specific extension - can be used to store extra arbiter specific</span>
00560     <span class="comment">// information</span>
00561     <span class="comment">//</span>
<a name="l00562"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o33">00562</a>     PVOID <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o33">Extension</a>;
00563 
00564     <span class="comment">//</span>
00565     <span class="comment">// The bus device we arbitrate for</span>
00566     <span class="comment">//</span>
<a name="l00567"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o34">00567</a>     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o34">BusDeviceObject</a>;
00568 
00569     <span class="comment">//</span>
00570     <span class="comment">// Callback and context for RtlFindRange/RtlIsRangeAvailable to allow</span>
00571     <span class="comment">// complex conflicts</span>
00572     <span class="comment">//</span>
<a name="l00573"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o35">00573</a>     PVOID <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o35">ConflictCallbackContext</a>;
<a name="l00574"></a><a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o36">00574</a>     PRTL_CONFLICT_RANGE_CALLBACK <a class="code" href="../../d8/d7/struct__ARBITER__INSTANCE.html#o36">ConflictCallback</a>;
00575 
00576 } <a class="code" href="../../d9/d8/arbiter_8h.html#a60">ARBITER_INSTANCE</a>, *<a class="code" href="../../d9/d8/arbiter_8h.html#a39">PARBITER_INSTANCE</a>;
00577 
00578 
00579 <span class="comment">//</span>
00580 <span class="comment">// Lock primitives that leave us at PASSIVE_LEVEL after acquiring the lock.</span>
00581 <span class="comment">// (A FAST_MUTEX or CriticalRegion leave us at APC level and some people (ACPI)</span>
00582 <span class="comment">// need to be at passive level in their arbiter)</span>
00583 <span class="comment">//</span>
00584 
<a name="l00585"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a18">00585</a> <span class="preprocessor">#define ArbAcquireArbiterLock(_Arbiter) \</span>
00586 <span class="preprocessor">    KeWaitForSingleObject( (_Arbiter)-&gt;MutexEvent, Executive, KernelMode, FALSE, NULL )</span>
00587 <span class="preprocessor"></span>
<a name="l00588"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a19">00588</a> <span class="preprocessor">#define ArbReleaseArbiterLock(_Arbiter) \</span>
00589 <span class="preprocessor">    KeSetEvent( (_Arbiter)-&gt;MutexEvent, 0, FALSE )</span>
00590 <span class="preprocessor"></span>
00591 <span class="comment">//</span>
00592 <span class="comment">// Iteration macros</span>
00593 <span class="comment">//</span>
00594 
00595 <span class="comment">//</span>
00596 <span class="comment">// Control macro (used like a for loop) which iterates over all entries in</span>
00597 <span class="comment">// a standard doubly linked list.  Head is the list head and the entries are of</span>
00598 <span class="comment">// type Type.  A member called ListEntry is assumed to be the LIST_ENTRY</span>
00599 <span class="comment">// structure linking the entries together.  Current contains a pointer to each</span>
00600 <span class="comment">// entry in turn.</span>
00601 <span class="comment">//</span>
<a name="l00602"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a20">00602</a> <span class="preprocessor">#define FOR_ALL_IN_LIST(Type, Head, Current)                            \</span>
00603 <span class="preprocessor">    for((Current) = CONTAINING_RECORD((Head)-&gt;Flink, Type, ListEntry);  \</span>
00604 <span class="preprocessor">       (Head) != &amp;(Current)-&gt;ListEntry;                                 \</span>
00605 <span class="preprocessor">       (Current) = CONTAINING_RECORD((Current)-&gt;ListEntry.Flink,        \</span>
00606 <span class="preprocessor">                                     Type,                              \</span>
00607 <span class="preprocessor">                                     ListEntry)                         \</span>
00608 <span class="preprocessor">       )</span>
00609 <span class="preprocessor"></span><span class="comment">//</span>
00610 <span class="comment">// Similar to the above only iteration is over an array of length _Size.</span>
00611 <span class="comment">//</span>
<a name="l00612"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a21">00612</a> <span class="preprocessor">#define FOR_ALL_IN_ARRAY(_Array, _Size, _Current)                       \</span>
00613 <span class="preprocessor">    for ( (_Current) = (_Array);                                        \</span>
00614 <span class="preprocessor">          (_Current) &lt; (_Array) + (_Size);                              \</span>
00615 <span class="preprocessor">          (_Current)++ )</span>
00616 <span class="preprocessor"></span>
00617 <span class="comment">//</span>
00618 <span class="comment">// As above only iteration begins with the entry _Current</span>
00619 <span class="comment">//</span>
<a name="l00620"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a22">00620</a> <span class="preprocessor">#define FOR_REST_IN_ARRAY(_Array, _Size, _Current)                      \</span>
00621 <span class="preprocessor">    for ( ;                                                             \</span>
00622 <span class="preprocessor">          (_Current) &lt; (_Array) + (_Size);                              \</span>
00623 <span class="preprocessor">          (_Current)++ )</span>
00624 <span class="preprocessor"></span>
00625 <span class="comment">//</span>
00626 <span class="comment">// BOOLEAN</span>
00627 <span class="comment">// INTERSECT(</span>
00628 <span class="comment">//      ULONGLONG s1,</span>
00629 <span class="comment">//      ULONGLONG e1,</span>
00630 <span class="comment">//      ULONGLONG s2,</span>
00631 <span class="comment">//      ULONGLONG e2</span>
00632 <span class="comment">//  );</span>
00633 <span class="comment">//</span>
00634 <span class="comment">// Determines if the ranges s1-e1 and s2-e2 intersect</span>
00635 <span class="comment">//</span>
<a name="l00636"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a23">00636</a> <span class="preprocessor">#define INTERSECT(s1,e1,s2,e2)                                          \</span>
00637 <span class="preprocessor">    !( ((s1) &lt; (s2) &amp;&amp; (e1) &lt; (s2))                                     \</span>
00638 <span class="preprocessor">    ||((s2) &lt; (s1) &amp;&amp; (e2) &lt; (s1)) )</span>
00639 <span class="preprocessor"></span>
00640 
00641 <span class="comment">//</span>
00642 <span class="comment">// ULONGLONG</span>
00643 <span class="comment">// INTERSECT_SIZE(</span>
00644 <span class="comment">//      ULONGLONG s1,</span>
00645 <span class="comment">//      ULONGLONG e1,</span>
00646 <span class="comment">//      ULONGLONG s2,</span>
00647 <span class="comment">//      ULONGLONG e2</span>
00648 <span class="comment">//  );</span>
00649 <span class="comment">//</span>
00650 <span class="comment">// Returns the size of the intersection of s1-e1 and s2-e2, undefined if they</span>
00651 <span class="comment">// don't intersect</span>
00652 <span class="comment">//</span>
<a name="l00653"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a24">00653</a> <span class="preprocessor">#define INTERSECT_SIZE(s1,e1,s2,e2)                                     \</span>
00654 <span class="preprocessor">    ( __min((e1),(e2)) - __max((s1),(s2)) + 1)</span>
00655 <span class="preprocessor"></span>
00656 
<a name="l00657"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a25">00657</a> <span class="preprocessor">#define LEGACY_REQUEST(_Entry)                                                \</span>
00658 <span class="preprocessor">    ((_Entry)-&gt;RequestSource == ArbiterRequestLegacyReported ||               \</span>
00659 <span class="preprocessor">        (_Entry)-&gt;RequestSource == ArbiterRequestLegacyAssigned)</span>
00660 <span class="preprocessor"></span>
<a name="l00661"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a26">00661</a> <span class="preprocessor">#define PNP_REQUEST(_Entry)                                                   \</span>
00662 <span class="preprocessor">    ((_Entry)-&gt;RequestSource == ArbiterRequestPnpDetected ||                  \</span>
00663 <span class="preprocessor">        (_Entry)-&gt;RequestSource == ArbiterRequestPnpEnumerated)</span>
00664 <span class="preprocessor"></span>
00665 <span class="comment">//</span>
00666 <span class="comment">// Priorities used in ArbGetNextAllocationRange</span>
00667 <span class="comment">//</span>
00668 
<a name="l00669"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a27">00669</a> <span class="preprocessor">#define ARBITER_PRIORITY_NULL                 0</span>
<a name="l00670"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a28">00670</a> <span class="preprocessor"></span><span class="preprocessor">#define ARBITER_PRIORITY_PREFERRED_RESERVED   (MAXLONG-2)</span>
<a name="l00671"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a29">00671</a> <span class="preprocessor"></span><span class="preprocessor">#define ARBITER_PRIORITY_RESERVED             (MAXLONG-1)</span>
<a name="l00672"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a30">00672</a> <span class="preprocessor"></span><span class="preprocessor">#define ARBITER_PRIORITY_EXHAUSTED            (MAXLONG)</span>
00673 <span class="preprocessor"></span>
00674 
00675 <span class="keyword">typedef</span>
00676 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00677"></a><a class="code" href="../../d9/d8/arbiter_8h.html#a61">00677</a> (*PARBITER_TRANSLATE_ALLOCATION_ORDER)(
00678     OUT PIO_RESOURCE_DESCRIPTOR TranslatedDescriptor,
00679     IN PIO_RESOURCE_DESCRIPTOR RawDescriptor
00680     );
00681 
00682 <span class="comment">//</span>
00683 <span class="comment">// Common arbiter routines</span>
00684 <span class="comment">//</span>
00685 
00686 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00687 <a class="code" href="../../d9/d8/arbiter_8h.html#a67">ArbInitializeArbiterInstance</a>(
00688     OUT PARBITER_INSTANCE Arbiter,
00689     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> BusDevice,
00690     IN CM_RESOURCE_TYPE ResourceType,
00691     IN PWSTR Name,
00692     IN PWSTR OrderingName,
00693     IN PARBITER_TRANSLATE_ALLOCATION_ORDER TranslateOrdering
00694     );
00695 
00696 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00697 <a class="code" href="../../d9/d8/arbiter_8h.html#a68">ArbDeleteArbiterInstance</a>(
00698     IN PARBITER_INSTANCE Arbiter
00699     );
00700 
00701 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00702 <a class="code" href="../../d9/d8/arbiter_8h.html#a69">ArbArbiterHandler</a>(
00703     IN PVOID Context,
00704     IN ARBITER_ACTION Action,
00705     IN OUT <a class="code" href="../../d3/d8/struct__ARBITER__PARAMETERS.html">PARBITER_PARAMETERS</a> Params
00706     );
00707 
00708 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00709 <a class="code" href="../../d9/d8/arbiter_8h.html#a70">ArbTestAllocation</a>(
00710     IN PARBITER_INSTANCE Arbiter,
00711     IN OUT PLIST_ENTRY ArbitrationList
00712     );
00713 
00714 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00715 <a class="code" href="../../d9/d8/arbiter_8h.html#a71">ArbRetestAllocation</a>(
00716     IN PARBITER_INSTANCE Arbiter,
00717     IN OUT PLIST_ENTRY ArbitrationList
00718     );
00719 
00720 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00721 <a class="code" href="../../d9/d8/arbiter_8h.html#a72">ArbCommitAllocation</a>(
00722     PARBITER_INSTANCE Arbiter
00723     );
00724 
00725 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00726 <a class="code" href="../../d9/d8/arbiter_8h.html#a73">ArbRollbackAllocation</a>(
00727     PARBITER_INSTANCE Arbiter
00728     );
00729 
00730 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00731 <a class="code" href="../../d9/d8/arbiter_8h.html#a74">ArbAddReserved</a>(
00732     IN PARBITER_INSTANCE Arbiter,
00733     IN PIO_RESOURCE_DESCRIPTOR Requirement      OPTIONAL,
00734     IN PCM_PARTIAL_RESOURCE_DESCRIPTOR Resource OPTIONAL
00735     );
00736 
00737 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00738 <a class="code" href="../../d9/d8/arbiter_8h.html#a75">ArbPreprocessEntry</a>(
00739     IN PARBITER_INSTANCE Arbiter,
00740     IN PARBITER_ALLOCATION_STATE State
00741     );
00742 
00743 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00744 <a class="code" href="../../d9/d8/arbiter_8h.html#a76">ArbAllocateEntry</a>(
00745     IN PARBITER_INSTANCE Arbiter,
00746     IN PARBITER_ALLOCATION_STATE State
00747     );
00748 
00749 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00750 <a class="code" href="../../d9/d8/arbiter_8h.html#a77">ArbSortArbitrationList</a>(
00751     IN OUT PLIST_ENTRY ArbitrationList
00752     );
00753 
00754 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00755 <a class="code" href="../../d9/d8/arbiter_8h.html#a78">ArbConfirmAllocation</a>(
00756      IN PARBITER_INSTANCE Arbiter,
00757      IN PARBITER_ALLOCATION_STATE State
00758      );
00759 
00760 BOOLEAN
00761 <a class="code" href="../../d9/d8/arbiter_8h.html#a79">ArbOverrideConflict</a>(
00762      IN PARBITER_INSTANCE Arbiter,
00763      IN PARBITER_ALLOCATION_STATE State
00764      );
00765 
00766 
00767 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00768 <a class="code" href="../../d9/d8/arbiter_8h.html#a80">ArbQueryConflict</a>(
00769      IN PARBITER_INSTANCE Arbiter,
00770      IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PhysicalDeviceObject,
00771      IN PIO_RESOURCE_DESCRIPTOR ConflictingResource,
00772      OUT PULONG ConflictCount,
00773      OUT <a class="code" href="../../d7/d7/struct__ARBITER__CONFLICT__INFO.html">PARBITER_CONFLICT_INFO</a> *Conflicts
00774      );
00775 
00776 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00777 <a class="code" href="../../d9/d8/arbiter_8h.html#a81">ArbBacktrackAllocation</a>(
00778      IN PARBITER_INSTANCE Arbiter,
00779      IN PARBITER_ALLOCATION_STATE State
00780      );
00781 
00782 BOOLEAN
00783 <a class="code" href="../../d9/d8/arbiter_8h.html#a82">ArbGetNextAllocationRange</a>(
00784     PARBITER_INSTANCE Arbiter,
00785     PARBITER_ALLOCATION_STATE State
00786     );
00787 
00788 BOOLEAN
00789 <a class="code" href="../../d9/d8/arbiter_8h.html#a83">ArbFindSuitableRange</a>(
00790     PARBITER_INSTANCE Arbiter,
00791     PARBITER_ALLOCATION_STATE State
00792     );
00793 
00794 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00795 <a class="code" href="../../d9/d8/arbiter_8h.html#a84">ArbAddAllocation</a>(
00796      IN PARBITER_INSTANCE Arbiter,
00797      IN PARBITER_ALLOCATION_STATE State
00798      );
00799 
00800 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00801 <a class="code" href="../../d9/d8/arbiter_8h.html#a85">ArbBootAllocation</a>(
00802     IN PARBITER_INSTANCE Arbiter,
00803     IN OUT PLIST_ENTRY ArbitrationList
00804     );
00805 
00806 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00807 <a class="code" href="../../d9/d8/arbiter_8h.html#a86">ArbStartArbiter</a>(
00808     IN PARBITER_INSTANCE Arbiter,
00809     IN PCM_RESOURCE_LIST StartResources
00810     );
00811 
00812 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00813 <a class="code" href="../../d9/d8/arbiter_8h.html#a87">ArbBuildAssignmentOrdering</a>(
00814     IN OUT PARBITER_INSTANCE Arbiter,
00815     IN PWSTR AllocationOrderName,
00816     IN PWSTR ReservedResourcesName,
00817     IN PARBITER_TRANSLATE_ALLOCATION_ORDER Translate OPTIONAL
00818     );
00819 
00820 
00821 <span class="preprocessor">#if ARB_DBG</span>
00822 <span class="preprocessor"></span>
00823 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00824 <a class="code" href="../../d8/d8/arbiter_8c.html#a48">ArbpIndent</a>(
00825     ULONG Count
00826     );
00827 
00828 <span class="preprocessor">#endif // DBG</span>
00829 <span class="preprocessor"></span>
00830 
00831 <span class="preprocessor">#endif</span>
00832 <span class="preprocessor"></span>
00833 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:16 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
