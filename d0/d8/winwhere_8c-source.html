<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: winwhere.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>winwhere.c</h1><a href="../../d9/d8/winwhere_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: winwhere.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* History:</span>
00007 <span class="comment">* 08-Nov-1990 DavidPe   Created.</span>
00008 <span class="comment">* 23-Jan-1991 IanJa     Serialization: Handle revalidation added</span>
00009 <span class="comment">* 19-Feb-1991 JimA      Added enum access checks</span>
00010 <span class="comment">\***************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="../../d0/d4/w32_2ntuser_2kernel_2precomp_8h.html">precomp.h</a>"</span>
00013 <span class="preprocessor">#pragma hdrstop</span>
00014 <span class="preprocessor"></span>
00015 <span class="comment">/***************************************************************************\</span>
00016 <span class="comment">* LayerHitTest</span>
00017 <span class="comment">*</span>
00018 <span class="comment">* 9/21/1998        vadimg      created</span>
00019 <span class="comment">\***************************************************************************/</span>
00020 
<a name="l00021"></a><a class="code" href="../../d9/d8/winwhere_8c.html#a0">00021</a> __inline <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d8/winwhere_8c.html#a0">LayerHitTest</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, POINT pt)
00022 {
00023     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a621">WEFLAYERED</a>));
00024 
00025     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a617">WEFTRANSPARENT</a>))
00026         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00027 
00028     <span class="keywordflow">if</span> (!GrePtInSprite(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o0">hDev</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a449">PtoHq</a>(pwnd), pt.x, pt.y))
00029         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00030 
00031     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00032 }
00033 
00034 <span class="comment">/***************************************************************************\</span>
00035 <span class="comment">* ChildWindowFromPoint (API)</span>
00036 <span class="comment">*</span>
00037 <span class="comment">* Returns NULL if pt is not in parent's client area at all,</span>
00038 <span class="comment">* hwndParent if point is not over any children, and a child window if it is</span>
00039 <span class="comment">* over a child.  Will return hidden and disabled windows if they are at the</span>
00040 <span class="comment">* given point.</span>
00041 <span class="comment">*</span>
00042 <span class="comment">* History:</span>
00043 <span class="comment">* 19-Nov-1990 DavidPe   Created.</span>
00044 <span class="comment">* 19-Feb-1991 JimA      Added enum access check</span>
00045 <span class="comment">\***************************************************************************/</span>
00046 
<a name="l00047"></a><a class="code" href="../../d9/d8/winwhere_8c.html#a1">00047</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d9/d8/winwhere_8c.html#a1">_ChildWindowFromPointEx</a>(
00048     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>  pwnd,
00049     POINT pt,
00050     UINT  uFlags)
00051 {
00052     <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd)) {
00053 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00054 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL)) {
00055             pt.x = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right - pt.x;
00056         } <span class="keywordflow">else</span> 
00057 <span class="preprocessor">#endif</span>
00058 <span class="preprocessor"></span>        {
00059             pt.x += pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left;
00060         }
00061         pt.y += pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top;
00062     }
00063 
00064     <span class="comment">// _ClientToScreen(pwndParent, (LPPOINT)&amp;pt);</span>
00065 
00066     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>, pt)) {
00067 
00068         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndChild;
00069 
00070         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00071             <span class="keywordflow">if</span> (!GrePtInRegion(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a>, pt.x, pt.y))
00072                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00073         }
00074 
00075         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a621">WEFLAYERED</a>)) {
00076             <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d8/winwhere_8c.html#a0">LayerHitTest</a>(pwnd, pt))
00077                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00078         }
00079         
00080         <span class="comment">/*</span>
00081 <span class="comment">         * Enumerate the children, skipping disabled and invisible ones</span>
00082 <span class="comment">         * if so desired.  Still doesn't work for WS_EX_TRANSPARENT windows.</span>
00083 <span class="comment">         */</span>
00084         <span class="keywordflow">for</span> (pwndChild = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>;
00085                  pwndChild;
00086                  pwndChild = pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>) {
00087 
00088             <span class="comment">/*</span>
00089 <span class="comment">             * Skip windows as desired.</span>
00090 <span class="comment">             */</span>
00091             <span class="keywordflow">if</span> ((uFlags &amp; CWP_SKIPINVISIBLE) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>))
00092                 <span class="keywordflow">continue</span>;
00093 
00094             <span class="keywordflow">if</span> ((uFlags &amp; CWP_SKIPDISABLED) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>))
00095                 <span class="keywordflow">continue</span>;
00096 
00097             <span class="keywordflow">if</span> ((uFlags &amp; CWP_SKIPTRANSPARENT) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a617">WEFTRANSPARENT</a>))
00098                 <span class="keywordflow">continue</span>;
00099 
00100             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, pt)) {
00101 
00102                 <span class="keywordflow">if</span> (pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00103                     <span class="keywordflow">if</span> (!GrePtInRegion(pwndChild-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a>, pt.x, pt.y))
00104                         <span class="keywordflow">continue</span>;
00105                 }
00106                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndChild, <a class="code" href="../../d1/d0/inc_2user_8h.html#a621">WEFLAYERED</a>)) {
00107                     <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d8/winwhere_8c.html#a0">LayerHitTest</a>(pwndChild, pt))
00108                         <span class="keywordflow">continue</span>;
00109                 }
00110                 <span class="keywordflow">return</span>(pwndChild);
00111             }
00112         }
00113 
00114         <span class="keywordflow">return</span> pwnd;
00115     }
00116 
00117     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00118 }
00119 
00120 <span class="comment">/***************************************************************************\</span>
00121 <span class="comment">* xxxWindowFromPoint (API)</span>
00122 <span class="comment">*</span>
00123 <span class="comment">* History:</span>
00124 <span class="comment">* 19-Nov-1990 DavidPe   Created.</span>
00125 <span class="comment">* 19-Feb-1991 JimA      Added enum access check</span>
00126 <span class="comment">\***************************************************************************/</span>
00127 
<a name="l00128"></a><a class="code" href="../../d9/d8/winwhere_8c.html#a2">00128</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d9/d8/winwhere_8c.html#a2">xxxWindowFromPoint</a>(
00129     POINT pt)
00130 {
00131     HWND hwnd;
00132     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
00133     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>   tlpwndT;
00134 
00135     pwndT = <a class="code" href="../../d3/d9/client_2wow_8c.html#a3">_GetDesktopWindow</a>();
00136     <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndT, &amp;tlpwndT);
00137     
00138     hwnd = <a class="code" href="../../d9/d8/winwhere_8c.html#a5">xxxWindowHitTest2</a>(pwndT, pt, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d1/userk_8h.html#a505">WHT_IGNOREDISABLED</a>);
00139 
00140     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndT);
00141 
00142     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(hwnd);
00143 }
00144 
00145 <span class="preprocessor">#ifdef REDIRECTION</span>
00146 <span class="preprocessor"></span>
00147 <span class="comment">/***************************************************************************\</span>
00148 <span class="comment">* xxxCallSpeedHitTestHook</span>
00149 <span class="comment">*</span>
00150 <span class="comment">* Call the speed hit test hook to give the opportunity to the hook to fake</span>
00151 <span class="comment">* where the mouse pointer is.</span>
00152 <span class="comment">*</span>
00153 <span class="comment">* 25-Jan-1999 CLupu   Created.</span>
00154 <span class="comment">\***************************************************************************/</span>
00155 
00156 <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> xxxCallSpeedHitTestHook(POINT* ppt)
00157 {
00158     <a class="code" href="../../d5/d6/structtagHOOK.html">PHOOK</a> pHook;
00159     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>  pwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00160 
00161     <span class="comment">/*</span>
00162 <span class="comment">     * Call the hit test hooks to give them the opportunity to change</span>
00163 <span class="comment">     * the coordinates and the hwnd</span>
00164 <span class="comment">     */</span>
00165     <span class="keywordflow">if</span> ((pHook = <a class="code" href="../../d4/d1/userk_8h.html#a1518">PhkFirstValid</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>(), WH_HITTEST)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00166         HTHOOKSTRUCT ht;
00167         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>         bAnsiHook;
00168 
00169         ht.pt      = *ppt;
00170         ht.hwndHit = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00171 
00172         <a class="code" href="../../d4/d1/userk_8h.html#a1522">xxxCallHook2</a>(pHook, HC_ACTION, 0, (LPARAM)&amp;ht, &amp;bAnsiHook);
00173 
00174         <span class="keywordflow">if</span> (ht.hwndHit != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00175             
00176             pwnd = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a6">HMValidateHandle</a>(ht.hwndHit, TYPE_WINDOW);
00177 
00178             <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00179                 ppt-&gt;x = ht.pt.x;
00180                 ppt-&gt;y = ht.pt.y;
00181             }
00182         }
00183     }
00184     <span class="keywordflow">return</span> pwnd;
00185 }
00186 
00187 <span class="preprocessor">#endif // REDIRECTION</span>
00188 <span class="preprocessor"></span>
00189 <span class="comment">/***************************************************************************\</span>
00190 <span class="comment">* SpeedHitTest</span>
00191 <span class="comment">*</span>
00192 <span class="comment">* This routine quickly finds out what top level window this mouse point</span>
00193 <span class="comment">* belongs to. Used purely for ownership purposes.</span>
00194 <span class="comment">*</span>
00195 <span class="comment">* 12-Nov-1992 ScottLu   Created.</span>
00196 <span class="comment">\***************************************************************************/</span>
00197 
<a name="l00198"></a><a class="code" href="../../d9/d8/winwhere_8c.html#a3">00198</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d9/d8/winwhere_8c.html#a3">SpeedHitTest</a>(
00199     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>   pwndParent,
00200     POINT  pt)
00201 {
00202     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
00203     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00204 
00205     <span class="keywordflow">if</span> (pwndParent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00206         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00207 
00208     <span class="keywordflow">for</span> (pwnd = pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>; pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>) {
00209 
00210         <span class="comment">/*</span>
00211 <span class="comment">         * Are we looking at an hidden window?</span>
00212 <span class="comment">         */</span>
00213         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>))
00214             <span class="keywordflow">continue</span>;
00215 
00216         <span class="comment">/*</span>
00217 <span class="comment">         * Are we barking up the wrong tree?</span>
00218 <span class="comment">         */</span>
00219         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>((LPRECT)&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, pt)) {
00220             <span class="keywordflow">continue</span>;
00221         }
00222 
00223         <span class="comment">/*</span>
00224 <span class="comment">         * Check to see if in window region (if it has one)</span>
00225 <span class="comment">         */</span>
00226         <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00227             <span class="keywordflow">if</span> (!GrePtInRegion(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a>, pt.x, pt.y))
00228                 <span class="keywordflow">continue</span>;
00229         }
00230 
00231         <span class="comment">/*</span>
00232 <span class="comment">         * Is this a sprite?</span>
00233 <span class="comment">         */</span>
00234         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a621">WEFLAYERED</a>)) {
00235             <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d8/winwhere_8c.html#a0">LayerHitTest</a>(pwnd, pt))
00236                 <span class="keywordflow">continue</span>;
00237         }
00238 
00239 <span class="preprocessor">#ifdef REDIRECTION</span>
00240 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFREDIRECTED)) {
00241             <span class="keywordflow">continue</span>;
00242         }
00243 <span class="preprocessor">#endif // REDIRECTION</span>
00244 <span class="preprocessor"></span>
00245         <span class="comment">/*</span>
00246 <span class="comment">         * Children?</span>
00247 <span class="comment">         */</span>
00248         <span class="keywordflow">if</span> ((pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00249                 <a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>((LPRECT)&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>, pt)) {
00250 
00251             pwndT = <a class="code" href="../../d9/d8/winwhere_8c.html#a3">SpeedHitTest</a>(pwnd, pt);
00252             <span class="keywordflow">if</span> (pwndT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00253                 <span class="keywordflow">return</span> pwndT;
00254         }
00255 
00256         <span class="keywordflow">return</span> pwnd;
00257     }
00258 
00259     <span class="keywordflow">return</span> pwndParent;
00260 }
00261 
00262 <span class="comment">/***************************************************************************\</span>
00263 <span class="comment">* xxxWindowHitTest</span>
00264 <span class="comment">*</span>
00265 <span class="comment">* History:</span>
00266 <span class="comment">* 08-Nov-1990 DavidPe   Ported.</span>
00267 <span class="comment">* 28-Nov-1990 DavidPe   Add pwndTransparent support for HTTRANSPARENT.</span>
00268 <span class="comment">* 25-Jan-1991 IanJa     change PWNDPOS parameter to int *</span>
00269 <span class="comment">* 19-Feb-1991 JimA      Added enum access check</span>
00270 <span class="comment">* 02-Nov-1992 ScottLu   Removed pwndTransparent.</span>
00271 <span class="comment">* 12-Nov-1992 ScottLu   Took out fSendHitTest, fixed locking bug</span>
00272 <span class="comment">\***************************************************************************/</span>
00273 
<a name="l00274"></a><a class="code" href="../../d9/d8/winwhere_8c.html#a4">00274</a> HWND <a class="code" href="../../d9/d8/winwhere_8c.html#a4">xxxWindowHitTest</a>(
00275     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>  pwnd,
00276     POINT pt,
00277     <span class="keywordtype">int</span>   *piPos,
00278     DWORD dwHitTestFlags)
00279 {
00280     HWND hwndT;
00281     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>   tlpwnd;
00282 
00283     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00284 
00285     hwndT = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00286     <a class="code" href="../../d4/d1/userk_8h.html#a115">ThreadLockNever</a>(&amp;tlpwnd);
00287     <span class="keywordflow">while</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00288         <a class="code" href="../../d4/d1/userk_8h.html#a983">ThreadLockExchangeAlways</a>(pwnd, &amp;tlpwnd);
00289         hwndT = <a class="code" href="../../d9/d8/winwhere_8c.html#a5">xxxWindowHitTest2</a>(pwnd, pt, piPos, dwHitTestFlags);
00290         <span class="keywordflow">if</span> (hwndT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00291             <span class="keywordflow">break</span>;
00292 
00293         pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>;
00294     }
00295 
00296     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00297     <span class="keywordflow">return</span> hwndT;
00298 }
00299 
00300 <span class="comment">/***************************************************************************\</span>
00301 <span class="comment">* xxxWindowHitTest2</span>
00302 <span class="comment">*</span>
00303 <span class="comment">* When this routine is entered, all windows must be locked.  When this</span>
00304 <span class="comment">* routine returns a window handle, it locks that window handle and unlocks</span>
00305 <span class="comment">* all windows.  If this routine returns NULL, all windows are still locked.</span>
00306 <span class="comment">* Ignores disabled and hidden windows.</span>
00307 <span class="comment">*</span>
00308 <span class="comment">* History:</span>
00309 <span class="comment">* 08-Nov-1990 DavidPe   Ported.</span>
00310 <span class="comment">* 25-Jan-1991 IanJa     change PWNDPOS parameter to int *</span>
00311 <span class="comment">* 19-Feb-1991 JimA      Added enum access check</span>
00312 <span class="comment">* 12-Nov-1992 ScottLu   Took out fSendHitTest</span>
00313 <span class="comment">\***************************************************************************/</span>
00314 
<a name="l00315"></a><a class="code" href="../../d9/d8/winwhere_8c.html#a5">00315</a> HWND <a class="code" href="../../d9/d8/winwhere_8c.html#a5">xxxWindowHitTest2</a>(
00316     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>  pwnd,
00317     POINT pt,
00318     <span class="keywordtype">int</span>   *piPos,
00319     DWORD dwHitTestFlags)
00320 {
00321     <span class="keywordtype">int</span>  ht = HTERROR, htGrip=HTBOTTOMRIGHT;
00322     HWND hwndT;
00323     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>   tlpwndChild;
00324 
00325     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00326 
00327     <span class="comment">/*</span>
00328 <span class="comment">     * Are we at the bottom of the window chain?</span>
00329 <span class="comment">     */</span>
00330     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00331         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00332 
00333     <span class="comment">/*</span>
00334 <span class="comment">     * Are we looking at an hidden window?</span>
00335 <span class="comment">     */</span>
00336     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>))
00337         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00338 
00339     <span class="comment">/*</span>
00340 <span class="comment">     * Are we barking up the wrong tree?</span>
00341 <span class="comment">     */</span>
00342     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>((LPRECT)&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, pt)) {
00343         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00344     }
00345 
00346     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00347         <span class="keywordflow">if</span> (!GrePtInRegion(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a>, pt.x, pt.y))
00348             <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00349     }
00350     
00351     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d1/d0/inc_2user_8h.html#a621">WEFLAYERED</a>)) {
00352         <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d8/winwhere_8c.html#a0">LayerHitTest</a>(pwnd, pt))
00353             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00354     }
00355     
00356 <span class="preprocessor">#ifdef REDIRECTION</span>
00357 <span class="preprocessor"></span>    <span class="comment">/*</span>
00358 <span class="comment">     * If this is called when the layered window is actually trying</span>
00359 <span class="comment">     * to process the message then let it see the hit test</span>
00360 <span class="comment">     */</span>
00361     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFREDIRECTED) &amp;&amp; <a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>() != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi) {
00362         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00363     }
00364 <span class="preprocessor">#endif // REDIRECTION</span>
00365 <span class="preprocessor"></span>
00366     <span class="comment">/*</span>
00367 <span class="comment">     * Are we looking at an disabled window?</span>
00368 <span class="comment">     */</span>
00369     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>) &amp;&amp; (dwHitTestFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a505">WHT_IGNOREDISABLED</a>)) {
00370         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
00371             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00372         } <span class="keywordflow">else</span> {
00373             ht = HTERROR;
00374             <span class="keywordflow">goto</span> Exit;
00375         }
00376     }
00377 
00378 <span class="preprocessor">#ifdef SYSMODALWINDOWS</span>
00379 <span class="preprocessor"></span>    <span class="comment">/*</span>
00380 <span class="comment">     * If SysModal window present and we're not in it, return an error.</span>
00381 <span class="comment">     * Be sure to assign the point to the SysModal window, so the message</span>
00382 <span class="comment">     * will be sure to be removed from the queue.</span>
00383 <span class="comment">     */</span>
00384     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1220">CheckPwndFilter</a>(pwnd, gspwndSysModal)) {
00385         pwnd = gspwndSysModal;
00386 
00387         <span class="comment">/*</span>
00388 <span class="comment">         * Fix notorious stack overflow bug (some WINABLE fix from Memphis)</span>
00389 <span class="comment">         */</span>
00390         ht = HTCLIENT;
00391         <span class="keywordflow">goto</span> Exit;
00392     }
00393 <span class="preprocessor">#endif</span>
00394 <span class="preprocessor"></span>
00395     <span class="comment">/*</span>
00396 <span class="comment">     * Are we on a minimized window?</span>
00397 <span class="comment">     */</span>
00398     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a653">WFMINIMIZED</a>)) {
00399         <span class="comment">/*</span>
00400 <span class="comment">         * Are we in the window's client area?</span>
00401 <span class="comment">         */</span>
00402         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>((LPRECT)&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>, pt)) {
00403             <span class="comment">/*</span>
00404 <span class="comment">             * Recurse through the children.</span>
00405 <span class="comment">             */</span>
00406             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>, &amp;tlpwndChild);
00407             hwndT = <a class="code" href="../../d9/d8/winwhere_8c.html#a4">xxxWindowHitTest</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>,
00408                                      pt,
00409                                      piPos,
00410                                      dwHitTestFlags);
00411             
00412             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndChild);
00413             <span class="keywordflow">if</span> (hwndT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00414                 <span class="keywordflow">return</span> hwndT;
00415         }
00416 
00417     }
00418 
00419     <span class="comment">/*</span>
00420 <span class="comment">     * If window not in same task, don't send WM_NCHITTEST.</span>
00421 <span class="comment">     */</span>
00422     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd) != <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()) {
00423         ht = HTCLIENT;
00424         <span class="keywordflow">goto</span> Exit;
00425     }
00426 
00427     <span class="comment">/*</span>
00428 <span class="comment">     * Send the message.</span>
00429 <span class="comment">     */</span>
00430     ht = (<span class="keywordtype">int</span>)<a class="code" href="../../d4/d1/userk_8h.html#a1579">xxxSendMessage</a>(pwnd, WM_NCHITTEST, 0, MAKELONG(pt.x, pt.y));
00431 
00432     <span class="comment">/*</span>
00433 <span class="comment">     * If window is transparent keep enumerating.</span>
00434 <span class="comment">     */</span>
00435     <span class="keywordflow">if</span> (ht == HTTRANSPARENT) {
00436         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00437     }
00438 
00439 Exit:
00440 
00441     <span class="comment">/*</span>
00442 <span class="comment">     * Set wndpos accordingly.</span>
00443 <span class="comment">     */</span>
00444     <span class="keywordflow">if</span> (piPos) {
00445         *piPos = ht;
00446     }
00447 
00448     <span class="comment">/*</span>
00449 <span class="comment">     * If this is a RTL mirrored window, then the grip is at</span>
00450 <span class="comment">     * HTBOTTOMLEFT (in terms of screen coordinates since they are</span>
00451 <span class="comment">     * not RTL mirrored).</span>
00452 <span class="comment">     */</span>
00453     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL)) {
00454         htGrip = HTBOTTOMLEFT;
00455     }
00456 
00457     <span class="comment">/*</span>
00458 <span class="comment">     * if the click is in the sizebox of the window and this window itself is</span>
00459 <span class="comment">     * not sizable, return the window that will be sized by this sizebox</span>
00460 <span class="comment">     */</span>
00461     <span class="keywordflow">if</span> ((ht == htGrip) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a638">WFSIZEBOX</a>)) {
00462 
00463         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>  pwndT;
00464          <span class="comment">/*</span>
00465 <span class="comment">          * SizeBoxHwnd() can return NULL!  We don't want to act like this</span>
00466 <span class="comment">          * is transparent if the sizebox isn't a grip</span>
00467 <span class="comment">          */</span>
00468          pwnd = (pwndT = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a8">SizeBoxHwnd</a>(pwnd)) ? pwndT : pwnd;
00469     }
00470 
00471     <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00472 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:26 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
