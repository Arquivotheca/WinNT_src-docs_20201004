<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: subject.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>subject.c File Reference</h1><code>#include "<a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>"</code><br>
<code>#include "seopaque.h"</code><br>
<code>#include "<a class="el" href="../../d9/d2/tokenp_8h-source.html">tokenp.h</a>"</code><br>

<p>
<a href="../../d1/d7/subject_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a> (OUT <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d8/subject_8c.html#a1">SeLockSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d8/subject_8c.html#a2">SeUnlockSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d8/subject_8c.html#a3">SeReleaseSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d8/subject_8c.html#a4">SepGetDefaultsSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext, OUT PSID *<a class="el" href="../../d2/d1/cttoken_8c.html#a53">Owner</a>, OUT PSID *<a class="el" href="../../d2/d1/cttoken_8c.html#a54">Group</a>, OUT PSID *ServerOwner, OUT PSID *ServerGroup, OUT PACL *<a class="el" href="../../d2/d1/cttoken_8c.html#a55">Dacl</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d8/subject_8c.html#a5">SepIdAssignableAsGroup</a> (IN PACCESS_TOKEN AToken, IN PSID <a class="el" href="../../d2/d1/cttoken_8c.html#a54">Group</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d8/subject_8c.html#a6">SepValidOwnerSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext, IN PSID <a class="el" href="../../d2/d1/cttoken_8c.html#a53">Owner</a>, IN BOOLEAN ServerObject)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d8/subject_8c.html#a7">SeQueryAuthenticationIdSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext, OUT PLUID AuthenticationId)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="subject.c::SeCaptureSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeCaptureSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubjectContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">46</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00814">PsProcessAuditId</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00097">PsReferenceImpersonationToken()</a>, and <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00028">PsReferencePrimaryToken()</a>.
<p>
Referenced by <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01378">CmpNotifyChangeKey()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00593">IsPrivileged()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02573">SeAuditHandleDuplication()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02466">SeAuditProcessCreation()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00504">SeCheckPrivilegedObject()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03826">SeCloseObjectAuditAlarm()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00180">SeCreateAccessState()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03892">SeDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00052                    :
00053 
00054     This routine takes a snapshot of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling thread's security
00055     context (locking tokens as necessary to <span class="keywordflow">do</span> so).  This function
00056     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> intended to support <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object manager and other components
00057     that utilize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference monitor's access validation,
00058     privilege test, and audit generation services.
00059 
00060     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> subject's security context should be captured before initiating
00061     access validation and should be released after audit messages
00062     are generated.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> necessary to provide a consistent security
00063     context to all those services.
00064 
00065     After calling access validation, privilege test, and audit generation
00066     services, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured context should be released as soon as possible
00067     <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d0/d8/subject_8c.html#a3">SeReleaseSubjectContext</a>() service.
00068 
00069 Arguments:
00070 
00071     SubjectContext - Points to a <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> data structure
00072         to be filled in with a snapshot of the calling thread's security
00073         profile.
00074 
00075 Return Value:
00076 
00077     none.
00078 
00079 --*/
00080 
00081 {
00082 
00083     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> CurrentProcess;
00084 
00085     <span class="comment">//PVOID Objects[2];</span>
00086 
00087     BOOLEAN IgnoreCopyOnOpen;
00088     BOOLEAN IgnoreEffectiveOnly;
00089 
00090     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00091 
00092     CurrentProcess = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>();
00093     SubjectContext-&gt;ProcessAuditId = <a class="code" href="../../d1/d9/ps_8h.html#a25">PsProcessAuditId</a>( CurrentProcess );
00094 
00095     <span class="comment">//</span>
00096     <span class="comment">// Get pointers to primary and impersonation tokens</span>
00097     <span class="comment">//</span>
00098 
00099     SubjectContext-&gt;ClientToken = <a class="code" href="../../d6/d5/ps_2security_8c.html#a1">PsReferenceImpersonationToken</a>(
00100                                       <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>(),
00101                                       &amp;IgnoreCopyOnOpen,
00102                                       &amp;IgnoreEffectiveOnly,
00103                                       &amp;(SubjectContext-&gt;ImpersonationLevel)
00104                                       );
00105 
00106     SubjectContext-&gt;PrimaryToken = <a class="code" href="../../d6/d5/ps_2security_8c.html#a0">PsReferencePrimaryToken</a>(CurrentProcess);
00107 
00108     <span class="keywordflow">return</span>;
00109 
00110 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="subject.c::SeLockSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeLockSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubjectContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00115">115</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, and <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/cmse_8c-source.html#l00917">CmpCheckCreateAccess()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01032">CmpCheckNotifyAccess()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00593">IsPrivileged()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00602">ObpCheckObjectReference()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00529">SeQueryAuthenticationIdSubjectContext()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">SeTraverseAuditAlarm()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00121                    :
00122 
00123     Acquires READ LOCKS on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary and impersonation tokens
00124     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed SubjectContext.
00125 
00126     This call must be undone by a call to <a class="code" href="../../d0/d8/subject_8c.html#a2">SeUnlockSubjectContext</a>().
00127 
00128     No one outside of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SE component should need to acquire a
00129     write lock to a token.  Therefore there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no <span class="keyword">public</span> interface
00130     to <span class="keywordflow">do</span> <span class="keyword">this</span>.
00131 
00132 Arguments:
00133 
00134     SubjectContext - Points to a <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> data structure
00135         which points to a primary token and an optional impersonation token.
00136 
00137 Return Value:
00138 
00139     None
00140 
00141 --*/
00142 
00143 {
00144     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00145 
00146     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>((PTOKEN)(SubjectContext-&gt;PrimaryToken));
00147 
00148     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(SubjectContext-&gt;ClientToken)) {
00149 
00150         <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>((PTOKEN)(SubjectContext-&gt;ClientToken));
00151     }
00152 
00153     <span class="keywordflow">return</span>;
00154 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="subject.c::SepGetDefaultsSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepGetDefaultsSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Owner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Group</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSID *&nbsp;</td>
          <td class="mdname" nowrap> <em>ServerOwner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSID *&nbsp;</td>
          <td class="mdname" nowrap> <em>ServerGroup</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACL *&nbsp;</td>
          <td class="mdname" nowrap> <em>Dacl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00234">234</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00126">PrimaryToken</a>, and <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, and <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>.
<p>
<pre class="fragment"><div>00244                    :
00245 
00246     This routine retrieves pointers to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> owner, primary group,
00247     and, <span class="keywordflow">if</span> present, discretionary ACL of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> provided subject security
00248     context.
00249 
00250 Arguments:
00251 
00252     SubjectContext - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject security context whose <span class="keywordflow">default</span>
00253         values are to be retrieved.
00254 
00255     <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's <span class="keywordflow">default</span> owner SID.  This
00256         value will always be returned as a non-zero pointer.  That <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>,
00257         a subject's security context must contain a owner SID.
00258 
00259     <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's <span class="keywordflow">default</span> primary group SID.
00260         This value will always be returned as a non-zero pointer.  That <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>,
00261         a subject's security context must contain a primary group.
00262 
00263     <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's <span class="keywordflow">default</span> discretionary ACL,
00264         <span class="keywordflow">if</span> one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> define <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject.  Note that a subject security context
00265         does not have to include a <span class="keywordflow">default</span> discretionary ACL.  In <span class="keyword">this</span> <span class="keywordflow">case</span>,
00266         <span class="keyword">this</span> value will be returned as <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>.
00267 
00268 
00269 
00270 
00271 Return Value:
00272 
00273     none.
00274 
00275 --*/
00276 
00277 {
00278     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>;
00279     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>;
00280 
00281     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00282 
00283     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(SubjectContext-&gt;ClientToken)) {
00284         <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)SubjectContext-&gt;ClientToken;
00285     } <span class="keywordflow">else</span> {
00286         <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)SubjectContext-&gt;PrimaryToken;
00287     }
00288 
00289     (*Owner) = <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;UserAndGroups[<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;DefaultOwnerIndex].Sid;
00290 
00291     (*Group) = <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;PrimaryGroup;
00292 
00293     (*Dacl)  = <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;DefaultDacl;
00294 
00295     <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)SubjectContext-&gt;PrimaryToken;
00296 
00297     *ServerOwner = <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>-&gt;UserAndGroups[<a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>-&gt;DefaultOwnerIndex].Sid;
00298 
00299     *ServerGroup = <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>-&gt;PrimaryGroup;
00300 
00301     <span class="keywordflow">return</span>;
00302 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="subject.c::SepIdAssignableAsGroup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepIdAssignableAsGroup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>AToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>Group</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00306">306</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00160">Group</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>.
<p>
<pre class="fragment"><div>00312                    :
00313 
00314     This routine checks to see whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> provided SID <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> one that
00315     may be assigned to be <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> primary group in a token.
00316 
00317     The current criteria <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed SID be a group in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00318     token, with no other restrictions.
00319 
00320 Arguments:
00321 
00322     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token to be examined.
00323 
00324     <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID to be checked.
00325 
00326 Return Value:
00327 
00328     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - SID passed by be assigned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> primary group in a token.
00329 
00330     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - Passed SID may not be so assigned.
00331 
00332 --*/
00333 
00334 {
00335     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00336     BOOLEAN Found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00337     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00338 
00339     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00340 
00341     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)AToken;
00342 
00343     <span class="comment">//</span>
00344     <span class="comment">// Let's make it invalid to assign a NULL primary group,</span>
00345     <span class="comment">// but we may need to revisit this.</span>
00346     <span class="comment">//</span>
00347 
00348     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00349         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00350     }
00351 
00352     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
00353 
00354     <span class="comment">//</span>
00355     <span class="comment">//  Walk through the list of user and group IDs looking</span>
00356     <span class="comment">//  for a match to the specified SID.</span>
00357     <span class="comment">//</span>
00358 
00359     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0;
00360     <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroupCount) {
00361 
00362         Found = <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(
00363                     Group,
00364                     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroups[Index].Sid
00365                     );
00366 
00367         <span class="keywordflow">if</span> ( Found ) {
00368             <span class="keywordflow">break</span>;
00369         }
00370 
00371         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1;
00372     }
00373 
00374     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
00375 
00376     <span class="keywordflow">return</span> Found;
00377 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="subject.c::SepValidOwnerSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepValidOwnerSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>Owner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ServerObject</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00381">381</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d0/d1/fedefs_8h-source.html#l00051">exit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00159">Owner</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02813">SepIdAssignableAsOwner()</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01686">SeRestorePrivilege</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, and <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>.
<p>
<pre class="fragment"><div>00388                    :
00389 
00390     This routine checks to see whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> provided SID <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> one <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject
00391     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> authorized to assign as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of objects.  It will also check to
00392     see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller has <a class="code" href="../../d0/d5/se_8h.html#a95">SeRestorePrivilege</a>, <span class="keywordflow">if</span> so, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> granted.
00393 
00394 Arguments:
00395 
00396     SubjectContext - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's security context.
00397 
00398     <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID to be checked.
00399 
00400 
00401 
00402 Return Value:
00403 
00404     none.
00405 
00406 --*/
00407 
00408 {
00409 
00410     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00411     BOOLEAN Found;
00412     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>;
00413     BOOLEAN Rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00414 
00415     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00416 
00417     <span class="comment">//</span>
00418     <span class="comment">// It is invalid to assign a NULL owner, regardless of</span>
00419     <span class="comment">// whether you have SeRestorePrivilege or not.</span>
00420     <span class="comment">//</span>
00421 
00422     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00423         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00424     }
00425 
00426     <span class="comment">//</span>
00427     <span class="comment">// Allowable owners come from the primary if it's a server object.</span>
00428     <span class="comment">//</span>
00429 
00430     <span class="keywordflow">if</span> (!ServerObject &amp;&amp; ARGUMENT_PRESENT(SubjectContext-&gt;ClientToken)) {
00431         <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)SubjectContext-&gt;ClientToken;
00432     } <span class="keywordflow">else</span> {
00433         <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)SubjectContext-&gt;PrimaryToken;
00434     }
00435 
00436 
00437     <span class="comment">//</span>
00438     <span class="comment">// If we're impersonating, make sure we're at TokenImpersonation</span>
00439     <span class="comment">// or above.  This prevents someone from setting the owner of an</span>
00440     <span class="comment">// object when impersonating at less Identify or Anonymous.</span>
00441     <span class="comment">//</span>
00442 
00443     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;TokenType == TokenImpersonation) {
00444 
00445         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;ImpersonationLevel &lt; SecurityImpersonation) {
00446 
00447             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00448 
00449         }
00450     }
00451 
00452     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( EffectiveToken );
00453 
00454     <span class="comment">//</span>
00455     <span class="comment">//  Walk through the list of user and group IDs looking</span>
00456     <span class="comment">//  for a match to the specified SID.  If one is found,</span>
00457     <span class="comment">//  make sure it may be assigned as an owner.</span>
00458     <span class="comment">//</span>
00459     <span class="comment">//  This code is similar to that performed to set the default</span>
00460     <span class="comment">//  owner of a token (NtSetInformationToken).</span>
00461     <span class="comment">//</span>
00462 
00463     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0;
00464     <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;UserAndGroupCount) {
00465 
00466 
00467         Found = <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(
00468                     Owner,
00469                     <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>-&gt;UserAndGroups[Index].Sid
00470                     );
00471 
00472         <span class="keywordflow">if</span> ( Found ) {
00473 
00474             <span class="comment">//</span>
00475             <span class="comment">// We may return success if the Sid is one that may be assigned</span>
00476             <span class="comment">// as an owner, or if the caller has SeRestorePrivilege</span>
00477             <span class="comment">//</span>
00478 
00479             <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d3/tokenp_8h.html#a33">SepIdAssignableAsOwner</a>(EffectiveToken,Index) ) {
00480 
00481                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( EffectiveToken );
00482                 Rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00483                 <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>;
00484 
00485             } <span class="keywordflow">else</span> {
00486 
00487                 <span class="comment">//</span>
00488                 <span class="comment">// Rc is already set to FALSE, just exit.</span>
00489                 <span class="comment">//</span>
00490 
00491                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( EffectiveToken );
00492                 <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>;
00493 
00494             } <span class="comment">//endif assignable</span>
00495 
00496 
00497         }  <span class="comment">//endif Found</span>
00498 
00499 
00500         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1;
00501 
00502     } <span class="comment">//endwhile</span>
00503 
00504 
00505     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( EffectiveToken );
00506 
00507 <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>:
00508 
00509     <span class="comment">//</span>
00510     <span class="comment">// If we are going to fail this call, check for Restore privilege,</span>
00511     <span class="comment">// and succeed if he has it.</span>
00512     <span class="comment">//</span>
00513 
00514     <span class="comment">//</span>
00515     <span class="comment">// We should really have gotten PreviousMode from the caller, but we</span>
00516     <span class="comment">// didn't, so hard wire it to be user-mode here.</span>
00517     <span class="comment">//</span>
00518 
00519     <span class="keywordflow">if</span> ( Rc == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ) {
00520         Rc = <a class="code" href="../../d8/d4/privileg_8c.html#a3">SeSinglePrivilegeCheck</a>( SeRestorePrivilege, UserMode );
00521     }
00522 
00523     <span class="keywordflow">return</span> Rc;
00524 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="subject.c::SeQueryAuthenticationIdSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeQueryAuthenticationIdSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLUID&nbsp;</td>
          <td class="mdname" nowrap> <em>AuthenticationId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00529">529</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00115">SeLockSubjectContext()</a>, <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l01152">SeQueryAuthenticationIdToken()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00159">SeUnlockSubjectContext()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00535                        :
00536 
00537         This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> authentication <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> effective token
00538         in a subject context
00539 
00540     Parameters:
00541 
00542         SubjectContext - The subject context to get <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> from
00543 
00544         AuthenticationId - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> authentication <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token
00545 
00546     Return Value:
00547 
00548         Errors from SeQueryAuthenticationidToken.
00549 
00550 --*/
00551 {
00552     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00553 
00554     <a class="code" href="../../d0/d8/subject_8c.html#a1">SeLockSubjectContext</a>( SubjectContext );
00555 
00556 
00557     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/tokenqry_8c.html#a1">SeQueryAuthenticationIdToken</a>(
00558                 <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>(SubjectContext),
00559                 AuthenticationId
00560                 );
00561 
00562     <a class="code" href="../../d0/d8/subject_8c.html#a2">SeUnlockSubjectContext</a>( SubjectContext );
00563 
00564     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00565 
00566 
00567 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="subject.c::SeReleaseSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeReleaseSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubjectContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">196</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00840">PsDereferenceImpersonationToken</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00810">PsDereferencePrimaryToken</a>.
<p>
Referenced by <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01235">CmpFlushNotify()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02555">FsRtlCancelNotify()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l01795">FsRtlNotifyCleanup()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00547">FsRtlNotifyFullChangeDirectory()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00593">IsPrivileged()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02573">SeAuditHandleDuplication()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02466">SeAuditProcessCreation()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00504">SeCheckPrivilegedObject()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03826">SeCloseObjectAuditAlarm()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00348">SeDeleteAccessState()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03892">SeDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00203                    :
00204 
00205     This routine releases a subject security context previously captured by
00206     <a class="code" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a>().
00207 
00208 Arguments:
00209 
00210     SubjectContext - Points to a <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> data structure
00211         containing a subject's previously captured security context.
00212 
00213 Return Value:
00214 
00215     none.
00216 
00217 --*/
00218 
00219 {
00220     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00221 
00222     <a class="code" href="../../d1/d9/ps_8h.html#a24">PsDereferencePrimaryToken</a>( SubjectContext-&gt;PrimaryToken );
00223     SubjectContext-&gt;PrimaryToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00224 
00225 
00226     <a class="code" href="../../d1/d9/ps_8h.html#a26">PsDereferenceImpersonationToken</a>( SubjectContext-&gt;ClientToken );
00227     SubjectContext-&gt;ClientToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00228 
00229     <span class="keywordflow">return</span>;
00230 
00231 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="subject.c::SeUnlockSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeUnlockSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubjectContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00159">159</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, and <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/cmse_8c-source.html#l00917">CmpCheckCreateAccess()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01032">CmpCheckNotifyAccess()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00593">IsPrivileged()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00602">ObpCheckObjectReference()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00529">SeQueryAuthenticationIdSubjectContext()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">SeTraverseAuditAlarm()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00165                    :
00166 
00167     Releases <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> read locks on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token(s) in the passed SubjectContext.
00168 
00169 Arguments:
00170 
00171     SubjectContext - Points to a <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> data structure
00172         which points to a primary token and an optional impersonation token.
00173 
00174 Return Value:
00175 
00176     None
00177 
00178 --*/
00179 
00180 {
00181     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00182 
00183     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>((PTOKEN)(SubjectContext-&gt;PrimaryToken));
00184 
00185     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(SubjectContext-&gt;ClientToken)) {
00186 
00187         <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>((PTOKEN)(SubjectContext-&gt;ClientToken));
00188     }
00189 
00190 
00191 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:42 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
