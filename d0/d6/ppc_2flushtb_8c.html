<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ppc/flushtb.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>flushtb.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d1/d5/ppc_2flushtb_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d6/ppc_2flushtb_8c.html#a0">KeFlushEntireTb</a> (IN BOOLEAN Invalid, IN BOOLEAN AllProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d6/ppc_2flushtb_8c.html#a1">KeFlushMultipleTb</a> (IN ULONG Number, IN PVOID *Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE *PtePointer OPTIONAL, IN HARDWARE_PTE PteValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HARDWARE_PTE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d6/ppc_2flushtb_8c.html#a2">KeFlushSingleTb</a> (IN PVOID Virtual, IN BOOLEAN Invalid, IN BOOLEAN AllProcessors, IN PHARDWARE_PTE PtePointer, IN HARDWARE_PTE PteValue)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="ppc/flushtb.c::KeFlushEntireTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushEntireTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d5/ppc_2flushtb_8c-source.html#l00033">33</a> of file <a class="el" href="../../d1/d5/ppc_2flushtb_8c-source.html">ppc/flushtb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00092">SYNCH_LEVEL</a>.
<p>
Referenced by <a class="el" href="../../d9/d1/pagfault_8c-source.html#l02880">MiCheckVirtualAddress()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l02341">MiDownShareCountFlushEntireTb()</a>, <a class="el" href="../../d9/d5/deleteva_8c-source.html#l01160">MiFlushPteList()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l02488">MiFlushUserPhysicalPteList()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l04374">MiHandleBankedSection()</a>, <a class="el" href="../../d2/d1/mm_2i386_2init386_8c-source.html#l00058">MiInitMachineDependent()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l01440">MiMapBBTMemory()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02785">MiMapLockedPagesInUserSpace()</a>, <a class="el" href="../../d8/d1/alpha_2hypermap_8c-source.html#l00035">MiMapPageInHyperSpace()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02395">MiMapSinglePage()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l01028">MiMapViewOfPhysicalSection()</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l01354">MiReleaseSystemPtes()</a>, <a class="el" href="../../d5/d8/umapview_8c-source.html#l00265">MiRemoveMappedView()</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l00524">MiReserveSystemPtes()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l01989">MiResolveMappedFileFault()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05581">MmAllocateNonCachedMemory()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l02005">MmFreeLoaderBlock()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03415">MmMapIoSpace()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02058">MmMapLockedPagesSpecifyCache()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05161">MmMapUserAddressesToPage()</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l00063">MmMapViewInSystemCache()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l03180">MmOutPageKernelStack()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05920">MmSetAddressRangeModified()</a>, and <a class="el" href="../../d6/d5/iosup_8c-source.html#l07311">MmSetBankedSection()</a>.
<p>
<pre class="fragment"><div>00040                    :
00041 
00042     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer (TB) on all
00043     processors that are currently running threads which are children
00044     of the current process or flushes the entire translation buffer
00045     on all processors in the host configuration.
00046 
00047     N.B. The entire translation buffer on all processors in the host
00048          configuration is always flushed since PowerPC TB is tagged by
00049          VSID and translations are held across context switch boundaries.
00050 
00051 Arguments:
00052 
00053     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies the reason for
00054         flushing the translation buffer.
00055 
00056     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00057         translation buffers are to be flushed.
00058 
00059 Return Value:
00060 
00061     None.
00062 
00063 --*/
00064 
00065 {
00066 
00067     KIRQL OldIrql;
00068 
00069     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= SYNCH_LEVEL);
00070 
00071 <span class="preprocessor">#if !defined(NT_UP)</span>
00072 <span class="preprocessor"></span>
00073     <span class="comment">//</span>
00074     <span class="comment">// Raise IRQL to synchronization level to avoid a possible context switch.</span>
00075     <span class="comment">//</span>
00076 
00077     OldIrql = KeRaiseIrqlToSynchLevel();
00078 
00079     <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number, FlushEntireTb);
00080 
00081 <span class="preprocessor">#endif</span>
00082 <span class="preprocessor"></span>
00083     <span class="comment">//</span>
00084     <span class="comment">// Flush TB on current processor.</span>
00085     <span class="comment">// PowerPC hardware broadcasts if MP.</span>
00086     <span class="comment">//</span>
00087 
00088     <a class="code" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb</a>();
00089 
00090 <span class="preprocessor">#if !defined(NT_UP)</span>
00091 <span class="preprocessor"></span>
00092     <span class="comment">//</span>
00093     <span class="comment">// Lower IRQL to previous level.</span>
00094     <span class="comment">//</span>
00095 
00096     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00097 
00098 <span class="preprocessor">#endif</span>
00099 <span class="preprocessor"></span>
00100     <span class="keywordflow">return</span>;
00101 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ppc/flushtb.c::KeFlushMultipleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushMultipleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE *PtePointer&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d5/ppc_2flushtb_8c-source.html#l00104">104</a> of file <a class="el" href="../../d1/d5/ppc_2flushtb_8c-source.html">ppc/flushtb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/deleteva_8c-source.html#l01160">MiFlushPteList()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l02488">MiFlushUserPhysicalPteList()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l03180">MmOutPageKernelStack()</a>, and <a class="el" href="../../d6/d5/iosup_8c-source.html#l05920">MmSetAddressRangeModified()</a>.
<p>
<pre class="fragment"><div>00115                    :
00116 
00117     This function flushes multiple entries from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer
00118     on all processors that are currently running threads which are
00119     children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes multiple entries from
00120     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00121 
00122     N.B. The specified <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> entries on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host
00123          configuration are always flushed since PowerPC TB <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> tagged by
00124          VSID and <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a52">translations</a> are held across context <span class="keywordflow">switch</span> boundaries.
00125 
00126 Arguments:
00127 
00128     Number - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of TB entries to flush.
00129 
00130     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a pointer to an array of <span class="keyword">virtual</span> addresses that
00131         are within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pages whose <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entries are to be
00132         flushed.
00133 
00134     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span>
00135         flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer.
00136 
00137     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00138         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffers are to be flushed.
00139 
00140     PtePointer - Supplies an optional pointer to an array of pointers to
00141        page table entries that receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry
00142        value.
00143 
00144     PteValue - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> page table entry value.
00145 
00146 Return Value:
00147 
00148     None.
00149 
00150 --*/
00151 
00152 {
00153 
00154     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00155 
00156     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() == DISPATCH_LEVEL);
00157 
00158     <span class="comment">//</span>
00159     <span class="comment">// If a page table entry address array is specified, then set the</span>
00160     <span class="comment">// specified page table entries to the specific value.</span>
00161     <span class="comment">//</span>
00162 
00163     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(PtePointer)) {
00164         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00165             *PtePointer[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = PteValue;
00166         }
00167     }
00168 
00169 <span class="preprocessor">#if !defined(NT_UP)</span>
00170 <span class="preprocessor"></span>
00171     <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number, FlushSingleTb);
00172 
00173 <span class="preprocessor">#endif</span>
00174 <span class="preprocessor"></span>
00175     <span class="comment">//</span>
00176     <span class="comment">// Flush the specified entries from the TB on the current processor.</span>
00177     <span class="comment">// PowerPC hardware broadcasts if MP.</span>
00178     <span class="comment">//</span>
00179 
00180     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; Number; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00181         <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a>(Invalid, Virtual[Index]);
00182     }
00183 
00184     <span class="keywordflow">return</span>;
00185 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ppc/flushtb.c::KeFlushSingleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HARDWARE_PTE KeFlushSingleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PHARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PtePointer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HARDWARE_PTE&nbsp;</td>
          <td class="mdname" nowrap> <em>PteValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d5/ppc_2flushtb_8c-source.html#l00188">188</a> of file <a class="el" href="../../d1/d5/ppc_2flushtb_8c-source.html">ppc/flushtb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">IPI_INSTRUMENT_COUNT</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l01119">KiFlushSingleCallData</a>, <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00054">RECORD_CALL_DATA</a>, and <a class="el" href="../../d6/d8/alpha_2exdsptch_8c-source.html#l00105">Virtual</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00747">Ki386UseSynchronousTbFlush()</a>, <a class="el" href="../../d4/d9/wrtfault_8c-source.html#l00025">MiCopyOnWrite()</a>, <a class="el" href="../../d9/d5/deleteva_8c-source.html#l00506">MiDeletePte()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l03974">MiEliminateWorkingSetEntry()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l02944">MiEnablePagingOfDriverAtInit()</a>, <a class="el" href="../../d7/d4/flushsec_8c-source.html#l02281">MiFlushDirtyBitsToPfn()</a>, <a class="el" href="../../d9/d5/deleteva_8c-source.html#l01160">MiFlushPteList()</a>, <a class="el" href="../../d1/d8/protect_8c-source.html#l02079">MiFlushTbAndCapture()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l02488">MiFlushUserPhysicalPteList()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00708">MiFreeNonPagedPool()</a>, <a class="el" href="../../d3/d0/inialpha_8c-source.html#l00041">MiInitMachineDependent()</a>, <a class="el" href="../../d8/d1/alpha_2hypermap_8c-source.html#l00313">MiMapPageToZeroInHyperSpace()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02395">MiMapSinglePage()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00150">MiProtectFreeNonPagedPool()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l05278">MiProtectSpecialPool()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l01953">MiResetVirtualMemory()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l03060">MiSetPageModified()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02309">MiSetPagingOfDriver()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l05448">MiSetSystemCodeProtection()</a>, <a class="el" href="../../d8/d1/alpha_2hypermap_8c-source.html#l00243">MiUnmapImageHeaderInHyperSpace()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03253">MiUnmapLockedPagesInUserSpace()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l03742">MmFreeSpecialPool()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05161">MmMapUserAddressesToPage()</a>, <a class="el" href="../../d0/d3/dynmem_8c-source.html#l00437">MmRemovePhysicalMemory()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05920">MmSetAddressRangeModified()</a>, and <a class="el" href="../../d6/d5/iosup_8c-source.html#l04027">MmSetPageProtection()</a>.
<p>
<pre class="fragment"><div>00198                    :
00199 
00200     This function flushes a single entry from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer
00201     on all processors that are currently running threads which are
00202     children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes a single entry from
00203     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00204 
00205     N.B. The specified <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> entry on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host
00206          configuration <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> always flushed since PowerPC TB <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> tagged by
00207          VSID and <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a52">translations</a> are held across context <span class="keywordflow">switch</span> boundaries.
00208 
00209 Arguments:
00210 
00211     <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> - Supplies a <span class="keyword">virtual</span> address that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page whose
00212         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be flushed.
00213 
00214     Invalid - Supplies a <span class="keywordtype">boolean</span> value that specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> <span class="keywordflow">for</span>
00215         flushing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffer.
00216 
00217     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which
00218         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a46">translation</a> buffers are to be flushed.
00219 
00220     PtePointer - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page table entry which
00221         receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified value.
00222 
00223     PteValue - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> page table entry value.
00224 
00225 Return Value:
00226 
00227     The previous contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified page table entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned
00228     as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00229 
00230 --*/
00231 
00232 {
00233 
00234     HARDWARE_PTE OldPte;
00235 
00236     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() == DISPATCH_LEVEL);
00237 
00238     <span class="comment">//</span>
00239     <span class="comment">// Collect call data.</span>
00240     <span class="comment">//</span>
00241 
00242 <span class="preprocessor">#if defined(_COLLECT_FLUSH_SINGLE_CALLDATA_)</span>
00243 <span class="preprocessor"></span>
00244     <a class="code" href="../../d5/d8/ex_8h.html#a1">RECORD_CALL_DATA</a>(&amp;KiFlushSingleCallData);
00245 
00246 <span class="preprocessor">#endif</span>
00247 <span class="preprocessor"></span>
00248     <span class="comment">//</span>
00249     <span class="comment">// Capture the previous contents of the page table entry and set the</span>
00250     <span class="comment">// page table entry to the new value.</span>
00251     <span class="comment">//</span>
00252 
00253     OldPte = *PtePointer;
00254     *PtePointer = PteValue;
00255 
00256 <span class="preprocessor">#if !defined(NT_UP)</span>
00257 <span class="preprocessor"></span>
00258     <a class="code" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number, FlushSingleTb);
00259 
00260 <span class="preprocessor">#endif</span>
00261 <span class="preprocessor"></span>
00262     <span class="comment">//</span>
00263     <span class="comment">// Flush the specified entry from the TB on the current processor.</span>
00264     <span class="comment">// PowerPC hardware broadcasts if MP.</span>
00265     <span class="comment">//</span>
00266 
00267     <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a>(Invalid, Virtual);
00268 
00269     <span class="comment">//</span>
00270     <span class="comment">// Return the previous page table entry value.</span>
00271     <span class="comment">//</span>
00272 
00273     <span class="keywordflow">return</span> OldPte;
00274 }
}
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:44 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
