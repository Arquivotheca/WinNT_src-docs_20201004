<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: almisc.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>almisc.c</h1><a href="../../d9/d6/almisc_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="preprocessor">#include "<a class="code" href="../../d3/d3/arcinst_2precomp_8h.html">precomp.h</a>"</span>
00002 <span class="preprocessor">#pragma hdrstop</span>
00003 <span class="preprocessor"></span>
00004 
00005 <span class="comment">//</span>
00006 <span class="comment">// Internal function definitions</span>
00007 <span class="comment">//</span>
00008 
00009 <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>
00010 <a class="code" href="../../d9/d6/almisc_8c.html#a11">AlpFreeComponents</a>(
00011     IN PCHAR *EnvVarComponents
00012     );
00013 
00014 BOOLEAN
00015 <a class="code" href="../../d9/d6/almisc_8c.html#a12">AlpMatchComponent</a>(
00016     IN PCHAR Value1,
00017     IN PCHAR Value2
00018     );
00019 
00020 <span class="comment">//</span>
00021 <span class="comment">// Function implementations</span>
00022 <span class="comment">//</span>
00023 
00024 
00025 <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>
<a name="l00026"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a81">00026</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a81">AlGetEnvVarComponents</a> (
00027     IN  PCHAR  EnvValue,
00028     OUT PCHAR  **EnvVarComponents,
00029     OUT PULONG PNumComponents
00030     )
00031 
00032 <span class="comment">/*++</span>
00033 <span class="comment"></span>
00034 <span class="comment">Routine Description:</span>
00035 <span class="comment"></span>
00036 <span class="comment">    This routine takes an environment variable string and turns it into</span>
00037 <span class="comment">    the constituent value strings:</span>
00038 <span class="comment"></span>
00039 <span class="comment">    Example EnvValue = "Value1;Value2;Value3" is turned into:</span>
00040 <span class="comment"></span>
00041 <span class="comment">    "Value1", "Value2", "Value3"</span>
00042 <span class="comment"></span>
00043 <span class="comment">    The following are valid value strings:</span>
00044 <span class="comment"></span>
00045 <span class="comment">    1. "     "                                      :one null value is found</span>
00046 <span class="comment">    2. ";;;;    "                                   :five null values are found</span>
00047 <span class="comment">    3. " ;Value1    ;   Value2;Value3;;;;;;;   ;"   :12 value strings are found,</span>
00048 <span class="comment">                                                    :9 of which are null</span>
00049 <span class="comment"></span>
00050 <span class="comment">    If an invalid component (contains embedded white space) is found in the</span>
00051 <span class="comment">    string then this routine attempts to resynch to the next value, no error</span>
00052 <span class="comment">    is returned, and a the first part of the invalid value is returned for the</span>
00053 <span class="comment">    bad component.</span>
00054 <span class="comment"></span>
00055 <span class="comment">    1.  "    Value1;Bad   Value2; Value3"           : 2 value strings are found</span>
00056 <span class="comment"></span>
00057 <span class="comment">    The value strings returned suppress all whitespace before and after the</span>
00058 <span class="comment">    value.</span>
00059 <span class="comment"></span>
00060 <span class="comment"></span>
00061 <span class="comment">Arguments:</span>
00062 <span class="comment"></span>
00063 <span class="comment">    EnvValue:  ptr to zero terminated environment value string</span>
00064 <span class="comment"></span>
00065 <span class="comment">    EnvVarComponents: ptr to a PCHAR * variable to receive the buffer of</span>
00066 <span class="comment">                      ptrs to the constituent value strings.</span>
00067 <span class="comment"></span>
00068 <span class="comment">    PNumComponents: ptr to a ULONG to receive the number of value strings found</span>
00069 <span class="comment"></span>
00070 <span class="comment">Return Value:</span>
00071 <span class="comment"></span>
00072 <span class="comment">    The function returns the following error codes:</span>
00073 <span class="comment">         EACCES if EnvValue is NULL</span>
00074 <span class="comment">         ENOMEM if the memory allocation fails</span>
00075 <span class="comment"></span>
00076 <span class="comment"></span>
00077 <span class="comment">    The function returns the following success codes:</span>
00078 <span class="comment">         ESUCCESS.</span>
00079 <span class="comment"></span>
00080 <span class="comment">    When the function returns ESUCCESS:</span>
00081 <span class="comment">         - *PNumComponent field gets the number of value strings found</span>
00082 <span class="comment">         - if the number is non zero the *EnvVarComponents field gets the</span>
00083 <span class="comment">           ptr to the buffer containing ptrs to value strings</span>
00084 <span class="comment"></span>
00085 <span class="comment">--*/</span>
00086 
00087 
00088 {
00089     PCHAR pchStart, pchEnd, pchNext;
00090     PCHAR pchComponents[<a class="code" href="../../d4/d9/arcinst_8h.html#a12">MAX_COMPONENTS</a> + 1];
00091     ULONG NumComponents, i;
00092     PCHAR pch;
00093     ULONG size;
00094 
00095     <span class="comment">//</span>
00096     <span class="comment">// Validate the EnvValue</span>
00097     <span class="comment">//</span>
00098     <span class="keywordflow">if</span> (EnvValue == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00099         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d9/arccodes_8h.html#a24a3">EACCES</a>);
00100     }
00101 
00102     <span class="comment">//</span>
00103     <span class="comment">// Initialise the ptr array with nulls</span>
00104     <span class="comment">//</span>
00105     <span class="keywordflow">for</span> (i = 0; i &lt; (<a class="code" href="../../d4/d9/arcinst_8h.html#a12">MAX_COMPONENTS</a>+1); i++) {
00106         pchComponents[i] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00107     }
00108 
00109     <span class="comment">//</span>
00110     <span class="comment">// Initialise ptrs to search components</span>
00111     <span class="comment">//</span>
00112     pchStart      = EnvValue;
00113     NumComponents = 0;
00114 
00115 
00116     <span class="comment">//</span>
00117     <span class="comment">// search till either pchStart reaches the end or till max components</span>
00118     <span class="comment">// is reached, the below has been programmed from a dfsa.</span>
00119     <span class="comment">//</span>
00120     <span class="keywordflow">while</span> (*pchStart &amp;&amp; NumComponents &lt; <a class="code" href="../../d4/d9/arcinst_8h.html#a12">MAX_COMPONENTS</a>) {
00121 
00122         <span class="comment">//</span>
00123         <span class="comment">// STATE 1: find the beginning of next variable value</span>
00124         <span class="comment">//</span>
00125         <span class="keywordflow">while</span> (*pchStart!=0 &amp;&amp; isspace(*pchStart)) {
00126             pchStart++;
00127         }
00128 
00129 
00130         <span class="keywordflow">if</span> (*pchStart == 0) {
00131             <span class="keywordflow">break</span>;
00132         }
00133 
00134         <span class="comment">//</span>
00135         <span class="comment">// STATE 2: In the midst of a value</span>
00136         <span class="comment">//</span>
00137         pchEnd = pchStart;
00138         <span class="keywordflow">while</span> (*pchEnd!=0 &amp;&amp; !isspace(*pchEnd) &amp;&amp; *pchEnd!=<span class="charliteral">';'</span>) {
00139             pchEnd++;
00140         }
00141 
00142         <span class="comment">//</span>
00143         <span class="comment">// STATE 3: spit out the value found</span>
00144         <span class="comment">//</span>
00145 
00146         size = pchEnd - pchStart;
00147         <span class="keywordflow">if</span> ((pch = <a class="code" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a>(size+1)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00148             <a class="code" href="../../d9/d6/almisc_8c.html#a11">AlpFreeComponents</a>(pchComponents);
00149             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>);
00150         }
00151         strncpy (pch, pchStart, size);
00152         pch[size]=0;
00153         pchComponents[NumComponents++]=pch;
00154 
00155         <span class="comment">//</span>
00156         <span class="comment">// STATE 4: variable value end has been reached, find the beginning</span>
00157         <span class="comment">// of the next value</span>
00158         <span class="comment">//</span>
00159         <span class="keywordflow">if</span> ((pchNext = strchr(pchEnd, <span class="charliteral">';'</span>)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00160             <span class="keywordflow">break</span>; <span class="comment">// out of the big while loop because we are done</span>
00161         }
00162 
00163         <span class="comment">//</span>
00164         <span class="comment">// Advance beyond the semicolon.</span>
00165         <span class="comment">//</span>
00166 
00167         pchNext++;
00168 
00169         <span class="comment">//</span>
00170         <span class="comment">// reinitialise to begin STATE 1</span>
00171         <span class="comment">//</span>
00172         pchStart = pchNext;
00173 
00174     } <span class="comment">// end while.</span>
00175 
00176     <span class="comment">//</span>
00177     <span class="comment">// Get memory to hold an environment pointer and return that</span>
00178     <span class="comment">//</span>
00179 
00180     <span class="keywordflow">if</span> ( NumComponents!=0 ) {
00181         PCHAR *pch;
00182 
00183         <span class="keywordflow">if</span> ((pch = (PCHAR *)<a class="code" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a>((NumComponents+1)*<span class="keyword">sizeof</span>(PCHAR))) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00184             <a class="code" href="../../d9/d6/almisc_8c.html#a11">AlpFreeComponents</a>(pchComponents);
00185             <span class="keywordflow">return</span> (<a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>);
00186         }
00187 
00188         <span class="comment">//</span>
00189         <span class="comment">// the last one is NULL because we initialised the array with NULLs</span>
00190         <span class="comment">//</span>
00191 
00192         <span class="keywordflow">for</span> ( i = 0; i &lt;= NumComponents; i++) {
00193             pch[i] = pchComponents[i];
00194         }
00195 
00196 
00197         *EnvVarComponents = pch;
00198     }
00199 
00200     <span class="comment">//</span>
00201     <span class="comment">// Update the number of elements field and return success</span>
00202     <span class="comment">//</span>
00203     *PNumComponents = NumComponents;
00204     <span class="keywordflow">return</span> (<a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>);
00205 }
00206 
00207 
00208 <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>
<a name="l00209"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a82">00209</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a82">AlFreeEnvVarComponents</a> (
00210     IN PCHAR *EnvVarComponents
00211     )
00212 <span class="comment">/*++</span>
00213 <span class="comment"></span>
00214 <span class="comment">Routine Description:</span>
00215 <span class="comment"></span>
00216 <span class="comment">    This routine frees up all the components in the ptr array and frees</span>
00217 <span class="comment">    up the storage for the ptr array itself too</span>
00218 <span class="comment"></span>
00219 <span class="comment">Arguments:</span>
00220 <span class="comment"></span>
00221 <span class="comment">    EnvVarComponents: the ptr to the PCHAR * Buffer</span>
00222 <span class="comment"></span>
00223 <span class="comment">Return Value:</span>
00224 <span class="comment"></span>
00225 <span class="comment">    ESUCCESS if freeing successful</span>
00226 <span class="comment">    EACCES   if memory ptr invalid</span>
00227 <span class="comment"></span>
00228 <span class="comment"></span>
00229 <span class="comment"></span>
00230 <span class="comment">--*/</span>
00231 
00232 
00233 {
00234     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00235 
00236     <span class="comment">//</span>
00237     <span class="comment">// if the pointer is NULL just return success</span>
00238     <span class="comment">//</span>
00239     <span class="keywordflow">if</span> (EnvVarComponents == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00240         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>);
00241     }
00242 
00243     <span class="comment">//</span>
00244     <span class="comment">// free all the components first, if error in freeing return</span>
00245     <span class="comment">//</span>
00246     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/almisc_8c.html#a11">AlpFreeComponents</a>(EnvVarComponents);
00247     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00248         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00249     }
00250 
00251     <span class="comment">//</span>
00252     <span class="comment">// free the component holder too</span>
00253     <span class="comment">//</span>
00254     <span class="keywordflow">if</span>( <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(EnvVarComponents) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00255         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d9/arccodes_8h.html#a24a3">EACCES</a>);
00256     }
00257     <span class="keywordflow">else</span> {
00258         <span class="keywordflow">return</span> (<a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>);
00259     }
00260 
00261 }
00262 
00263 
00264 <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>
<a name="l00265"></a><a class="code" href="../../d9/d6/almisc_8c.html#a11">00265</a> <a class="code" href="../../d9/d6/almisc_8c.html#a11">AlpFreeComponents</a>(
00266     IN PCHAR *EnvVarComponents
00267     )
00268 
00269 <span class="comment">/*++</span>
00270 <span class="comment"></span>
00271 <span class="comment">Routine Description:</span>
00272 <span class="comment"></span>
00273 <span class="comment">   This routine frees up only the components in the ptr array, but doesn't</span>
00274 <span class="comment">   free the ptr array storage itself.</span>
00275 <span class="comment"></span>
00276 <span class="comment">Arguments:</span>
00277 <span class="comment"></span>
00278 <span class="comment">    EnvVarComponents: the ptr to the PCHAR * Buffer</span>
00279 <span class="comment"></span>
00280 <span class="comment">Return Value:</span>
00281 <span class="comment"></span>
00282 <span class="comment">    ESUCCESS if freeing successful</span>
00283 <span class="comment">    EACCES   if memory ptr invalid</span>
00284 <span class="comment"></span>
00285 <span class="comment">--*/</span>
00286 
00287 {
00288 
00289     <span class="comment">//</span>
00290     <span class="comment">// get all the components and free them</span>
00291     <span class="comment">//</span>
00292     <span class="keywordflow">while</span> (*EnvVarComponents != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00293         <span class="keywordflow">if</span>(<a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(*EnvVarComponents++) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00294             <span class="keywordflow">return</span>(<a class="code" href="../../d2/d9/arccodes_8h.html#a24a3">EACCES</a>);
00295         }
00296     }
00297 
00298     <span class="keywordflow">return</span>(<a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>);
00299 }
00300 
00301 
00302 BOOLEAN
<a name="l00303"></a><a class="code" href="../../d9/d6/almisc_8c.html#a12">00303</a> <a class="code" href="../../d9/d6/almisc_8c.html#a12">AlpMatchComponent</a>(
00304     IN PCHAR Value1,
00305     IN PCHAR Value2
00306     )
00307 
00308 <span class="comment">/*++</span>
00309 <span class="comment"></span>
00310 <span class="comment">Routine Description:</span>
00311 <span class="comment"></span>
00312 <span class="comment">    This routine compares two components to see if they are equal.  This is</span>
00313 <span class="comment">    essentially comparing strings except that leading zeros are stripped from</span>
00314 <span class="comment">    key values.</span>
00315 <span class="comment"></span>
00316 <span class="comment">Arguments:</span>
00317 <span class="comment"></span>
00318 <span class="comment">    Value1 - Supplies a pointer to the first value to match.</span>
00319 <span class="comment"></span>
00320 <span class="comment">    Value2 - Supplies a pointer to the second value to match.</span>
00321 <span class="comment"></span>
00322 <span class="comment"></span>
00323 <span class="comment">Return Value:</span>
00324 <span class="comment"></span>
00325 <span class="comment">    If the components match, TRUE is returned, otherwise FALSE is returned.</span>
00326 <span class="comment"></span>
00327 <span class="comment">--*/</span>
00328 
00329 {
00330     <span class="keywordflow">while</span> ((*Value1 != 0) &amp;&amp; (*Value2 != 0)) {
00331         <span class="keywordflow">if</span> (tolower(*Value1) != tolower(*Value2)) {
00332             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00333         }
00334 
00335         <span class="keywordflow">if</span> (*Value1 == <span class="charliteral">'('</span>) {
00336             <span class="keywordflow">do</span> {
00337                 *Value1++;
00338             } <span class="keywordflow">while</span> (*Value1 == <span class="charliteral">'0'</span>);
00339         } <span class="keywordflow">else</span> {
00340             *Value1++;
00341         }
00342 
00343         <span class="keywordflow">if</span> (*Value2 == <span class="charliteral">'('</span>) {
00344             <span class="keywordflow">do</span> {
00345                 *Value2++;
00346             } <span class="keywordflow">while</span> (*Value2 == <span class="charliteral">'0'</span>);
00347         } <span class="keywordflow">else</span> {
00348             *Value2++;
00349         }
00350     }
00351 
00352     <span class="keywordflow">if</span> ((*Value1 == 0) &amp;&amp; (*Value2 == 0)) {
00353         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00354     }
00355 
00356     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00357 }
00358 
00359 
00360 BOOLEAN
<a name="l00361"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a83">00361</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a83">AlFindNextMatchComponent</a>(
00362     IN PCHAR EnvValue,
00363     IN PCHAR MatchValue,
00364     IN ULONG StartComponent,
00365     OUT PULONG MatchComponent OPTIONAL
00366     )
00367 
00368 <span class="comment">/*++</span>
00369 <span class="comment"></span>
00370 <span class="comment">Routine Description:</span>
00371 <span class="comment"></span>
00372 <span class="comment">    This routine compares each component of EnvValue, starting with</span>
00373 <span class="comment">    StartComponent, until a match is found or there are no more components.</span>
00374 <span class="comment"></span>
00375 <span class="comment">Arguments:</span>
00376 <span class="comment"></span>
00377 <span class="comment">    EnvValue - Supplies a pointer to the environment variable value.</span>
00378 <span class="comment"></span>
00379 <span class="comment">    MatchValue - Supplies a pointer to the value to match.</span>
00380 <span class="comment"></span>
00381 <span class="comment">    StartComponent - Supplies the component number to start the match.</span>
00382 <span class="comment"></span>
00383 <span class="comment">    MatchComponent - Supplies an optional pointer to a variable to receive</span>
00384 <span class="comment">                     the number of the component that matched.</span>
00385 <span class="comment"></span>
00386 <span class="comment">Return Value:</span>
00387 <span class="comment"></span>
00388 <span class="comment">    If a match is found, TRUE is returned, otherwise FALSE is returned.</span>
00389 <span class="comment"></span>
00390 <span class="comment">--*/</span>
00391 
00392 {
00393     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00394     PCHAR *EnvVarComponents;
00395     ULONG NumComponents;
00396     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00397     BOOLEAN Match;
00398 
00399 
00400     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d9/arcinst_8h.html#a81">AlGetEnvVarComponents</a>(EnvValue, &amp;EnvVarComponents, &amp;NumComponents);
00401 
00402     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00403         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00404     }
00405 
00406     Match = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00407     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = StartComponent ; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; NumComponents ; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++ ) {
00408         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d6/almisc_8c.html#a12">AlpMatchComponent</a>(EnvVarComponents[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>], MatchValue)) {
00409             Match = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00410             <span class="keywordflow">break</span>;
00411         }
00412     }
00413 
00414     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(MatchComponent)) {
00415         *MatchComponent = <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00416     }
00417 
00418     <a class="code" href="../../d4/d9/arcinst_8h.html#a82">AlFreeEnvVarComponents</a>(EnvVarComponents);
00419     <span class="keywordflow">return</span> Match;
00420 }
00421 
00422 
00423 <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>
<a name="l00424"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a84">00424</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a84">AlAddSystemPartition</a>(
00425     IN PCHAR NewSystemPartition
00426     )
00427 
00428 <span class="comment">/*++</span>
00429 <span class="comment"></span>
00430 <span class="comment">Routine Description:</span>
00431 <span class="comment"></span>
00432 <span class="comment">    This routine adds a system partition to the SystemPartition environment</span>
00433 <span class="comment">    variable, and updates the Osloader, OsloadPartition, OsloadFilename,</span>
00434 <span class="comment">    and OsloadOptions variables.</span>
00435 <span class="comment"></span>
00436 <span class="comment">Arguments:</span>
00437 <span class="comment"></span>
00438 <span class="comment">    SystemPartition - Supplies a pointer to the pathname of the system</span>
00439 <span class="comment">                      partition to add.</span>
00440 <span class="comment"></span>
00441 <span class="comment">Return Value:</span>
00442 <span class="comment"></span>
00443 <span class="comment">    If the system partition was successfully added, ESUCCESS is returned,</span>
00444 <span class="comment">    otherwise an error code is returned.</span>
00445 <span class="comment"></span>
00446 <span class="comment">    BUGBUG - This program is simplistic and doesn't attempt to make sure all</span>
00447 <span class="comment">    the variables are consistent.  It also doesn't fail gracefully.</span>
00448 <span class="comment"></span>
00449 <span class="comment">--*/</span>
00450 
00451 {
00452     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00453     PCHAR SystemPartition;
00454     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> TempValue[<a class="code" href="../../d4/d9/arcinst_8h.html#a38">MAXIMUM_ENVIRONMENT_VALUE</a>];
00455     <span class="comment">//PCHAR Osloader;</span>
00456     <span class="comment">//PCHAR OsloadPartition;</span>
00457     <span class="comment">//PCHAR OsloadFilename;</span>
00458     <span class="comment">//PCHAR OsloadOptions;</span>
00459 
00460     <span class="comment">//</span>
00461     <span class="comment">// Get the system partition environment variable.</span>
00462     <span class="comment">//</span>
00463 
00464     SystemPartition = <a class="code" href="../../d1/d9/arc_8h.html#a39">ArcGetEnvironmentVariable</a>(<span class="stringliteral">"SystemPartition"</span>);
00465 
00466     <span class="comment">//</span>
00467     <span class="comment">// If the variable doesn't exist, add it and exit.</span>
00468     <span class="comment">//</span>
00469 
00470     <span class="keywordflow">if</span> (SystemPartition == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00471         <span class="keywordflow">if</span>(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(NewSystemPartition) &lt; <a class="code" href="../../d4/d9/arcinst_8h.html#a38">MAXIMUM_ENVIRONMENT_VALUE</a>) {
00472             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d9/arc_8h.html#a40">ArcSetEnvironmentVariable</a>(<span class="stringliteral">"SystemPartition"</span>,
00473                                                NewSystemPartition);
00474         } <span class="keywordflow">else</span> {
00475             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d9/arccodes_8h.html#a24a2">E2BIG</a>;
00476         }
00477         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00478     }
00479 
00480     <span class="comment">//</span>
00481     <span class="comment">// If the variable exists, add the new partition to the end.</span>
00482     <span class="comment">//</span>
00483     <span class="keywordflow">if</span>(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(SystemPartition)+<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(NewSystemPartition)+2 &gt; <a class="code" href="../../d4/d9/arcinst_8h.html#a38">MAXIMUM_ENVIRONMENT_VALUE</a>) {
00484         <span class="keywordflow">return</span>(<a class="code" href="../../d2/d9/arccodes_8h.html#a24a2">E2BIG</a>);
00485     }
00486 
00487     strcpy(TempValue, SystemPartition);
00488     strcat(TempValue, <span class="stringliteral">";"</span>);
00489     strcat(TempValue, NewSystemPartition);
00490     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d9/arc_8h.html#a40">ArcSetEnvironmentVariable</a>(<span class="stringliteral">"SystemPartition"</span>,
00491                                        TempValue);
00492 
00493     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00494         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00495     }
00496 
00497 <span class="preprocessor">#if 0</span>
00498 <span class="preprocessor"></span>    <span class="comment">//</span>
00499     <span class="comment">// Add semicolons to the end of each of the associated variables.</span>
00500     <span class="comment">// If they don't exist add them.</span>
00501     <span class="comment">//</span>
00502 
00503     <span class="comment">//</span>
00504     <span class="comment">// Get the Osloader environment variable and add a semicolon to the end.</span>
00505     <span class="comment">//</span>
00506 
00507     Osloader = <a class="code" href="../../d1/d9/arc_8h.html#a39">ArcGetEnvironmentVariable</a>(<span class="stringliteral">"Osloader"</span>);
00508     <span class="keywordflow">if</span> (Osloader == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00509         *TempValue = 0;
00510     } <span class="keywordflow">else</span> {
00511         strcpy(TempValue, Osloader);
00512     }
00513     strcat(TempValue, <span class="stringliteral">";"</span>);
00514     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d9/arc_8h.html#a40">ArcSetEnvironmentVariable</a>(<span class="stringliteral">"Osloader"</span>,TempValue);
00515 
00516     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00517         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00518     }
00519 
00520     <span class="comment">//</span>
00521     <span class="comment">// Get the OsloadPartition environment variable and add a semicolon to the end.</span>
00522     <span class="comment">//</span>
00523 
00524     OsloadPartition = <a class="code" href="../../d1/d9/arc_8h.html#a39">ArcGetEnvironmentVariable</a>(<span class="stringliteral">"OsloadPartition"</span>);
00525     <span class="keywordflow">if</span> (OsloadPartition == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00526         *TempValue = 0;
00527     } <span class="keywordflow">else</span> {
00528         strcpy(TempValue, OsloadPartition);
00529     }
00530     strcat(TempValue, <span class="stringliteral">";"</span>);
00531     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d9/arc_8h.html#a40">ArcSetEnvironmentVariable</a>(<span class="stringliteral">"OsloadPartition"</span>,TempValue);
00532 
00533     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00534         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00535     }
00536 
00537     <span class="comment">//</span>
00538     <span class="comment">// Get the OsloadFilename environment variable and add a semicolon to the end.</span>
00539     <span class="comment">//</span>
00540 
00541     OsloadFilename = <a class="code" href="../../d1/d9/arc_8h.html#a39">ArcGetEnvironmentVariable</a>(<span class="stringliteral">"OsloadFilename"</span>);
00542     <span class="keywordflow">if</span> (OsloadFilename == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00543         *TempValue = 0;
00544     } <span class="keywordflow">else</span> {
00545         strcpy(TempValue, OsloadFilename);
00546     }
00547     strcat(TempValue, <span class="stringliteral">";"</span>);
00548     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d9/arc_8h.html#a40">ArcSetEnvironmentVariable</a>(<span class="stringliteral">"OsloadFilename"</span>,TempValue);
00549 
00550     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00551         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00552     }
00553 
00554     <span class="comment">//</span>
00555     <span class="comment">// Get the OsloadOptions environment variable and add a semicolon to the end.</span>
00556     <span class="comment">//</span>
00557 
00558     OsloadOptions = <a class="code" href="../../d1/d9/arc_8h.html#a39">ArcGetEnvironmentVariable</a>(<span class="stringliteral">"OsloadOptions"</span>);
00559     <span class="keywordflow">if</span> (OsloadOptions == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00560         *TempValue = 0;
00561     } <span class="keywordflow">else</span> {
00562         strcpy(TempValue, OsloadOptions);
00563     }
00564     strcat(TempValue, <span class="stringliteral">";"</span>);
00565     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d9/arc_8h.html#a40">ArcSetEnvironmentVariable</a>(<span class="stringliteral">"OsloadOptions"</span>,TempValue);
00566 <span class="preprocessor">#endif</span>
00567 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00568 }
00569 
00570 
<a name="l00571"></a><a class="code" href="../../d1/d9/struct__tagMENUITEM.html">00571</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d9/struct__tagMENUITEM.html">_tagMENUITEM</a> {
<a name="l00572"></a><a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o0">00572</a>     PCHAR <a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o0">Text</a>;
<a name="l00573"></a><a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o1">00573</a>     ULONG <a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o1">AssociatedData</a>;
00574 } <a class="code" href="../../d1/d9/struct__tagMENUITEM.html">MENUITEM</a>,*<a class="code" href="../../d1/d9/struct__tagMENUITEM.html">PMENUITEM</a>;
00575 
<a name="l00576"></a><a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html">00576</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html">_tagMENUCOOKIE</a> {
<a name="l00577"></a><a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o0">00577</a>     ULONG     <a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o0">ItemCount</a>;
<a name="l00578"></a><a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">00578</a>     <a class="code" href="../../d9/d6/almisc_8c.html#a3">PMENUITEM</a> <a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>;
00579 } <a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html">MENUCOOKIE</a>,*<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html">PMENUCOOKIE</a>;
00580 
00581 
00582 <span class="comment">// indent for menus, status, etc.</span>
00583 
<a name="l00584"></a><a class="code" href="../../d9/d6/almisc_8c.html#a6">00584</a> <span class="keywordtype">char</span> <a class="code" href="../../d9/d6/almisc_8c.html#a6">MARGIN</a>[] = <span class="stringliteral">"          "</span>;
<a name="l00585"></a><a class="code" href="../../d9/d6/almisc_8c.html#a7">00585</a> <span class="keywordtype">char</span> <a class="code" href="../../d9/d6/almisc_8c.html#a7">MSGMARGIN</a>[] = <span class="stringliteral">" "</span>;
00586 
00587 <span class="comment">// special constants used when fetching keystrokes</span>
00588 
<a name="l00589"></a><a class="code" href="../../d9/d6/almisc_8c.html#a0">00589</a> <span class="preprocessor">#define KEY_UP 1</span>
<a name="l00590"></a><a class="code" href="../../d9/d6/almisc_8c.html#a1">00590</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_DOWN 2</span>
00591 <span class="preprocessor"></span>
00592 
00593 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00594 <a class="code" href="../../d9/d6/almisc_8c.html#a17">MarkLine</a>(
00595     ULONG   Line,
00596     BOOLEAN Selected,
00597     PCHAR String
00598     );
00599 
00600 BOOLEAN
00601 <a class="code" href="../../d9/d6/almisc_8c.html#a18">CommonMenuDisplay</a>(
00602     PMENUCOOKIE Menu,
00603     BOOLEAN     StaticMenu,
00604     PCHAR       Items[],
00605     ULONG       ItemCount,
00606     BOOLEAN     PrintOnly,
00607     ULONG       AssociatedDataOfDefaultChoice,
00608     ULONG      *AssociatedDataOfChoice,
00609     PCHAR       MenuName,
00610     ULONG       Row
00611     );
00612 
00613 <span class="keywordtype">char</span>
00614 <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(
00615     VOID
00616     );
00617 
00618 
00619 BOOLEAN
<a name="l00620"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a90">00620</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a90">AlInitializeMenuPackage</a>(
00621     VOID
00622     )
00623 {
00624     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00625 }
00626 
00627 
00628 ULONG
<a name="l00629"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a96">00629</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a96">AlGetMenuNumberItems</a>(
00630     PVOID MenuID
00631     )
00632 {
00633     <span class="keywordflow">return</span>(((<a class="code" href="../../d9/d6/almisc_8c.html#a5">PMENUCOOKIE</a>)MenuID)-&gt;ItemCount);
00634 }
00635 
00636 
00637 ULONG
<a name="l00638"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a97">00638</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a97">AlGetMenuAssociatedData</a>(
00639     PVOID MenuID,
00640     ULONG n
00641     )
00642 {
00643     <span class="keywordflow">return</span>(((<a class="code" href="../../d9/d6/almisc_8c.html#a5">PMENUCOOKIE</a>)MenuID)-&gt;Items[<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>].AssociatedData);
00644 }
00645 
00646 BOOLEAN
<a name="l00647"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a91">00647</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a91">AlNewMenu</a>(
00648     PVOID *MenuID
00649     )
00650 {
00651     <a class="code" href="../../d9/d6/almisc_8c.html#a5">PMENUCOOKIE</a> p;
00652 
00653     <span class="keywordflow">if</span>(!(p = <a class="code" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html">MENUCOOKIE</a>)))) {
00654         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00655     }
00656     p-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o0">ItemCount</a> = 0;
00657     p-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00658     *MenuID = p;
00659     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00660 }
00661 
00662 
00663 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00664"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a92">00664</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a92">AlFreeMenu</a>(
00665     PVOID MenuID
00666     )
00667 {
00668     <a class="code" href="../../d9/d6/almisc_8c.html#a5">PMENUCOOKIE</a> p = MenuID;
00669     ULONG       i;
00670 
00671     <span class="keywordflow">for</span>(i=0; i&lt;p-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o0">ItemCount</a>; i++) {
00672         <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>[i].<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o0">Text</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00673             <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(p-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>[i].<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o0">Text</a>);
00674         }
00675     }
00676     <span class="keywordflow">if</span>(p-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>) {
00677         <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(p-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>);
00678     }
00679     <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(p);
00680 }
00681 
00682 
00683 BOOLEAN
<a name="l00684"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a93">00684</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a93">AlAddMenuItem</a>(
00685     PVOID MenuID,
00686     PCHAR Text,
00687     ULONG AssociatedData,
00688     ULONG Attributes                <span class="comment">// unused</span>
00689     )
00690 {
00691     <a class="code" href="../../d9/d6/almisc_8c.html#a5">PMENUCOOKIE</a> Menu = MenuID;
00692     <a class="code" href="../../d9/d6/almisc_8c.html#a3">PMENUITEM</a>   p;
00693 
00694     DBG_UNREFERENCED_PARAMETER(Attributes);
00695 
00696     <span class="keywordflow">if</span>(!Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o0">ItemCount</a>) {
00697         <span class="keywordflow">if</span>((Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a> = <a class="code" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d9/struct__tagMENUITEM.html">MENUITEM</a>))) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00698             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00699         }
00700         Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o0">ItemCount</a> = 1;
00701         p = Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>;
00702     } <span class="keywordflow">else</span> {
00703         <span class="keywordflow">if</span>((p = <a class="code" href="../../d4/d6/memory_8c.html#a24">AlReallocateHeap</a>(Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>,<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d9/struct__tagMENUITEM.html">MENUITEM</a>)*(Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o0">ItemCount</a>+1))) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00704             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00705         }
00706         Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a> = p;
00707         p = &amp;Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>[Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o0">ItemCount</a>++];
00708     }
00709 
00710     <span class="keywordflow">if</span>((p-&gt;<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o0">Text</a> = <a class="code" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a>(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(Text)+1)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00711         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00712     }
00713     strcpy(p-&gt;<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o0">Text</a>,Text);
00714     p-&gt;<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o1">AssociatedData</a> = AssociatedData;
00715     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00716 }
00717 
00718 
00719 BOOLEAN
<a name="l00720"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a94">00720</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a94">AlAddMenuItems</a>(
00721     PVOID MenuID,
00722     PCHAR Text[],
00723     ULONG ItemCount
00724     )
00725 {
00726     ULONG base,i;
00727 
00728     base = <a class="code" href="../../d4/d9/arcinst_8h.html#a96">AlGetMenuNumberItems</a>(MenuID);
00729 
00730     <span class="keywordflow">for</span>(i=0; i&lt;ItemCount; i++) {
00731     <span class="keywordflow">if</span>(!<a class="code" href="../../d4/d9/arcinst_8h.html#a93">AlAddMenuItem</a>(MenuID,Text[i],i+base,0)) {
00732             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00733         }
00734     }
00735     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00736 }
00737 
00738 
00739 BOOLEAN
<a name="l00740"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a95">00740</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a95">AlDisplayMenu</a>(
00741     PVOID   MenuID,
00742     BOOLEAN PrintOnly,
00743     ULONG   AssociatedDataOfDefaultChoice,
00744     ULONG  *AssociatedDataOfChoice,
00745     ULONG   Row,
00746     PCHAR   MenuName
00747     )
00748 {
00749     <span class="keywordflow">return</span>(<a class="code" href="../../d9/d6/almisc_8c.html#a18">CommonMenuDisplay</a>((<a class="code" href="../../d9/d6/almisc_8c.html#a5">PMENUCOOKIE</a>)MenuID,
00750                              <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00751                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00752                              ((<a class="code" href="../../d9/d6/almisc_8c.html#a5">PMENUCOOKIE</a>)MenuID)-&gt;ItemCount,
00753                              PrintOnly,
00754                              AssociatedDataOfDefaultChoice,
00755                              AssociatedDataOfChoice,
00756                              MenuName,
00757                              Row
00758                             )
00759           );
00760 }
00761 
00762 
00763 BOOLEAN
<a name="l00764"></a><a class="code" href="../../d9/d6/almisc_8c.html#a28">00764</a> <a class="code" href="../../d9/d6/almisc_8c.html#a28">AlDisplayStaticMenu</a>(
00765     PCHAR  Items[],
00766     ULONG  ItemCount,
00767     ULONG  DefaultChoice,
00768     ULONG  Row,
00769     ULONG *IndexOfChoice
00770     )
00771 {
00772     <span class="keywordflow">return</span>(<a class="code" href="../../d9/d6/almisc_8c.html#a18">CommonMenuDisplay</a>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00773                              <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00774                              Items,
00775                              ItemCount,
00776                              <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00777                              DefaultChoice,
00778                              IndexOfChoice,
00779                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00780                              Row
00781                             )
00782           );
00783 }
00784 
00785 
00786 
00787 BOOLEAN
<a name="l00788"></a><a class="code" href="../../d9/d6/almisc_8c.html#a18">00788</a> <a class="code" href="../../d9/d6/almisc_8c.html#a18">CommonMenuDisplay</a>(
00789     PMENUCOOKIE Menu,
00790     BOOLEAN     StaticMenu,
00791     PCHAR       Items[],
00792     ULONG       ItemCount,
00793     BOOLEAN     PrintOnly,
00794     ULONG       AssociatedDataOfDefaultChoice,
00795     ULONG      *AssociatedDataOfChoice,
00796     PCHAR       MenuName,
00797     ULONG       Row
00798     )
00799 {
00800 <span class="comment">//    ULONG x;</span>
00801     ULONG i,MenuBaseLine,Selection;
00802     <span class="keywordtype">char</span>  <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
00803     PCHAR <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>;
00804 
00805     <a class="code" href="../../d4/d9/arcinst_8h.html#a19">AlSetPosition</a>(Row,0);
00806     <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(<span class="stringliteral">"%cJ"</span>,<a class="code" href="../../d4/d9/arcinst_8h.html#a8">ASCI_CSI</a>);            <span class="comment">// clear to end of screen.</span>
00807     MenuBaseLine = Row;
00808 
00809     <a class="code" href="../../d4/d9/arcinst_8h.html#a17">AlSetScreenColor</a>(7,4);              <span class="comment">// white on blue</span>
00810 
00811 <span class="comment">//    if(MenuName) {</span>
00812 <span class="comment">//        AlPrint("%s%s\r\n%s",MARGIN,MenuName,MARGIN);</span>
00813 <span class="comment">//        x = strlen(MenuName);</span>
00814 <span class="comment">//        for(i=0; i&lt;x; i++) {</span>
00815 <span class="comment">//            AlPrint("-");</span>
00816 <span class="comment">//        }</span>
00817 <span class="comment">//        AlPrint("\r\n\r\n");</span>
00818 <span class="comment">//        MenuBaseLine += 3;</span>
00819 <span class="comment">//    }</span>
00820 
00821     <span class="keywordflow">for</span>(i=0; i&lt;ItemCount; i++) {
00822         <a class="code" href="../../d4/d9/arcinst_8h.html#a18">AlSetScreenAttributes</a>(1,0,0);   <span class="comment">// hi intensity</span>
00823         <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(<span class="stringliteral">"%s%s\r\n"</span>,<a class="code" href="../../d9/d6/almisc_8c.html#a6">MARGIN</a>,StaticMenu ? Items[i] : Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>[i].<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o0">Text</a>);
00824     }
00825 
00826     <span class="keywordflow">if</span>(PrintOnly) {
00827 
00828         <span class="keywordtype">char</span> <a class="code" href="../../d0/d2/config_2test_2init386_8c.html#a0">dummy</a>;
00829         <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(<span class="stringliteral">"\r\nPress any key to continue."</span>);
00830         <a class="code" href="../../d4/d9/arcinst_8h.html#a115">AlGetString</a>(&amp;<a class="code" href="../../d0/d2/config_2test_2init386_8c.html#a0">dummy</a>,0);
00831 
00832     } <span class="keywordflow">else</span> {
00833 
00834 <span class="comment">//        AlPrint("\r\n%sMake Selection using arrow keys and return,\r\n%sor escape to cancel",MARGIN,MARGIN);</span>
00835 
00836         Selection = 0;
00837         <span class="keywordflow">if</span>(StaticMenu) {
00838             Selection = AssociatedDataOfDefaultChoice;
00839         } <span class="keywordflow">else</span> {
00840             <span class="keywordflow">for</span>(i=0; i&lt;ItemCount; i++) {
00841                 <span class="keywordflow">if</span>(Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>[i].<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o1">AssociatedData</a> == AssociatedDataOfDefaultChoice) {
00842                     Selection = i;
00843                     <span class="keywordflow">break</span>;
00844                 }
00845             }
00846         }
00847 
00848         <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> = StaticMenu ? Items[Selection] : Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>[Selection].<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o0">Text</a>;
00849         <a class="code" href="../../d9/d6/almisc_8c.html#a17">MarkLine</a>(MenuBaseLine+Selection,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>);
00850 
00851         <span class="keywordflow">while</span>(((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>()) != <a class="code" href="../../d4/d9/arcinst_8h.html#a9">ASCI_ESC</a>) &amp;&amp; (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> != <a class="code" href="../../d4/d9/arcinst_8h.html#a4">ASCI_LF</a>) &amp;&amp; (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> != <a class="code" href="../../d4/d9/arcinst_8h.html#a7">ASCI_CR</a>)) {
00852 
00853             <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> = StaticMenu ? Items[Selection] : Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>[Selection].<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o0">Text</a>;
00854             <a class="code" href="../../d9/d6/almisc_8c.html#a17">MarkLine</a>(MenuBaseLine+Selection,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>);
00855 
00856             <span class="keywordflow">if</span>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d9/d6/almisc_8c.html#a0">KEY_UP</a>) {
00857                 <span class="keywordflow">if</span>(!Selection--) {
00858                     Selection = ItemCount - 1;
00859                 }
00860             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d9/d6/almisc_8c.html#a1">KEY_DOWN</a>) {
00861                 <span class="keywordflow">if</span>(++Selection == ItemCount) {
00862                     Selection = 0;
00863                 }
00864             }
00865 
00866             <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> = StaticMenu ? Items[Selection] : Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>[Selection].<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o0">Text</a>;
00867             <a class="code" href="../../d9/d6/almisc_8c.html#a17">MarkLine</a>(MenuBaseLine+Selection,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>);
00868         }
00869 
00870         <span class="comment">// set cursor to a free place on the screen.</span>
00871         <a class="code" href="../../d4/d9/arcinst_8h.html#a19">AlSetPosition</a>(MenuBaseLine + ItemCount + 4,0);
00872 
00873         <span class="keywordflow">if</span>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d4/d9/arcinst_8h.html#a9">ASCI_ESC</a>) {
00874             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00875         }
00876 
00877         *AssociatedDataOfChoice = StaticMenu ? Selection : Menu-&gt;<a class="code" href="../../d0/d9/struct__tagMENUCOOKIE.html#o1">Items</a>[Selection].<a class="code" href="../../d1/d9/struct__tagMENUITEM.html#o1">AssociatedData</a>;
00878     }
00879     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00880 }
00881 
00882 
00883 
00884 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00885"></a><a class="code" href="../../d9/d6/almisc_8c.html#a17">00885</a> <a class="code" href="../../d9/d6/almisc_8c.html#a17">MarkLine</a>(
00886     ULONG Line,
00887     BOOLEAN Selected,
00888     PCHAR String
00889     )
00890 {
00891     <a class="code" href="../../d4/d9/arcinst_8h.html#a19">AlSetPosition</a>(Line,<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d6/almisc_8c.html#a6">MARGIN</a>));
00892     <span class="keywordflow">if</span> (Selected) {
00893         <a class="code" href="../../d4/d9/arcinst_8h.html#a18">AlSetScreenAttributes</a>(1,0,1);   <span class="comment">// hi intensity, Reverse Video</span>
00894     }
00895     <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(<span class="stringliteral">"%s\r\n"</span>, <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>);
00896     <a class="code" href="../../d4/d9/arcinst_8h.html#a18">AlSetScreenAttributes</a>(1,0,0);       <span class="comment">// hi intensity</span>
00897 }
00898 
00899 
00900 
00901 <span class="keywordtype">char</span>
<a name="l00902"></a><a class="code" href="../../d9/d6/almisc_8c.html#a19">00902</a> <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(
00903     VOID
00904     )
00905 {
00906     UCHAR <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
00907     ULONG count;
00908 
00909     <a class="code" href="../../d1/d9/arc_8h.html#a33">ArcRead</a>(<a class="code" href="../../d1/d9/arc_8h.html#a0">ARC_CONSOLE_INPUT</a>,&amp;<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>,1,&amp;count);
00910     <span class="keywordflow">switch</span>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>) {
00911 <span class="comment">//  case ASCI_ESC:</span>
00912 <span class="comment">//      ArcRead(ARC_CONSOLE_INPUT,&amp;c,1,&amp;count);</span>
00913 <span class="comment">//      if(c != '[') {</span>
00914 <span class="comment">//          break;</span>
00915 <span class="comment">//      }</span>
00916     <span class="keywordflow">case</span> <a class="code" href="../../d4/d9/arcinst_8h.html#a8">ASCI_CSI</a>:
00917         <a class="code" href="../../d1/d9/arc_8h.html#a33">ArcRead</a>(<a class="code" href="../../d1/d9/arc_8h.html#a0">ARC_CONSOLE_INPUT</a>,&amp;<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>,1,&amp;count);
00918         <span class="keywordflow">switch</span>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>) {
00919         <span class="keywordflow">case</span> <span class="charliteral">'A'</span>:
00920         <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
00921             <span class="keywordflow">return</span>(<a class="code" href="../../d9/d6/almisc_8c.html#a0">KEY_UP</a>);
00922         <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:
00923         <span class="keywordflow">case</span> <span class="charliteral">'C'</span>:
00924             <span class="keywordflow">return</span>(<a class="code" href="../../d9/d6/almisc_8c.html#a1">KEY_DOWN</a>);
00925         }
00926     <span class="keywordflow">default</span>:
00927         <span class="keywordflow">return</span>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>);
00928     }
00929 }
00930 
00931 
00932 
00933 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00934"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a99">00934</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a99">AlWaitKey</a>(
00935     PCHAR Prompt
00936     )
00937 {
00938     <span class="keywordtype">char</span> buff[1];
00939 
00940     <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(<a class="code" href="../../d9/d6/almisc_8c.html#a7">MSGMARGIN</a>);
00941     <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(Prompt ? Prompt : <span class="stringliteral">"Press any key to continue..."</span>);
00942     <a class="code" href="../../d4/d9/arcinst_8h.html#a115">AlGetString</a>(buff,0);
00943 }
00944 
00945 
00946 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00947"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a100">00947</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a100">vAlStatusMsg</a>(
00948     IN ULONG   Row,
00949     IN BOOLEAN Error,
00950     IN PCHAR   FormatString,
00951     IN va_list ArgumentList
00952     )
00953 {
00954     <span class="keywordtype">char</span>  <a class="code" href="../../d7/d1/genuedef_8c.html#a5">text</a>[256];
00955     ULONG Length,<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00956 
00957     <a class="code" href="../../d4/d9/arcinst_8h.html#a19">AlSetPosition</a>(Row,0);
00958     <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(<a class="code" href="../../d9/d6/almisc_8c.html#a7">MSGMARGIN</a>);
00959     Length = vsprintf(<a class="code" href="../../d7/d1/genuedef_8c.html#a5">text</a>,FormatString,ArgumentList);
00960     <span class="keywordflow">if</span>(<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a1">Error</a>) {
00961         <a class="code" href="../../d4/d9/arcinst_8h.html#a17">AlSetScreenColor</a>(1,4);         <span class="comment">// red on blue</span>
00962     } <span class="keywordflow">else</span> {
00963         <a class="code" href="../../d4/d9/arcinst_8h.html#a17">AlSetScreenColor</a>(3,4);         <span class="comment">// yellow on blue</span>
00964     }
00965     <a class="code" href="../../d4/d9/arcinst_8h.html#a18">AlSetScreenAttributes</a>(1,0,0);      <span class="comment">// hi intensity</span>
00966     <a class="code" href="../../d1/d9/arc_8h.html#a35">ArcWrite</a>(<a class="code" href="../../d1/d9/arc_8h.html#a1">ARC_CONSOLE_OUTPUT</a>,<a class="code" href="../../d7/d1/genuedef_8c.html#a5">text</a>,Length,&amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00967     <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a>(<span class="stringliteral">"\r\n"</span>);
00968     <a class="code" href="../../d4/d9/arcinst_8h.html#a17">AlSetScreenColor</a>(7,4);             <span class="comment">// white on blue</span>
00969     <a class="code" href="../../d4/d9/arcinst_8h.html#a18">AlSetScreenAttributes</a>(1,0,0);      <span class="comment">// hi intensity</span>
00970 }
00971 
00972 
00973 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00974"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a101">00974</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a101">AlStatusMsg</a>(
00975     IN ULONG   TopRow,
00976     IN ULONG   BottomRow,
00977     IN BOOLEAN Error,
00978     IN PCHAR   FormatString,
00979     ...
00980     )
00981 {
00982     va_list ArgList;
00983 
00984     va_start(ArgList,FormatString);
00985     <a class="code" href="../../d4/d9/arcinst_8h.html#a100">vAlStatusMsg</a>(TopRow,<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a1">Error</a>,FormatString,ArgList);
00986 
00987     <a class="code" href="../../d4/d9/arcinst_8h.html#a99">AlWaitKey</a>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00988     <a class="code" href="../../d4/d9/arcinst_8h.html#a103">AlClearStatusArea</a>(TopRow,BottomRow);
00989 }
00990 
00991 
00992 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00993"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a102">00993</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a102">AlStatusMsgNoWait</a>(
00994     IN ULONG   TopRow,
00995     IN ULONG   BottomRow,
00996     IN BOOLEAN Error,
00997     IN PCHAR   FormatString,
00998     ...
00999     )
01000 {
01001     va_list ArgList;
01002 
01003     <a class="code" href="../../d4/d9/arcinst_8h.html#a103">AlClearStatusArea</a>(TopRow,BottomRow);
01004     va_start(ArgList,FormatString);
01005     <a class="code" href="../../d4/d9/arcinst_8h.html#a100">vAlStatusMsg</a>(TopRow,<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a1">Error</a>,FormatString,ArgList);
01006 }
01007 
01008 
01009 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01010"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a103">01010</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a103">AlClearStatusArea</a>(
01011     IN ULONG TopRow,
01012     IN ULONG BottomRow
01013     )
01014 {
01015     ULONG i;
01016 
01017     <span class="keywordflow">for</span>(i=BottomRow; i&gt;=TopRow; --i) {
01018         <a class="code" href="../../d4/d9/arcinst_8h.html#a19">AlSetPosition</a>(i,0);
01019         <a class="code" href="../../d4/d9/arcinst_8h.html#a16">AlClearLine</a>();
01020     }
01021 }
01022 
01023 
01024 <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>
<a name="l01025"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a98">01025</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a98">AlGetMenuSelection</a>(
01026 
01027     IN  PCHAR   szTitle,
01028     IN  PCHAR   *rgszSelections,
01029     IN  ULONG   crgsz,
01030     IN  ULONG   crow,
01031     IN  ULONG   irgszDefault,
01032     OUT PULONG  pirgsz,
01033     OUT PCHAR   *pszSelection
01034     )
01035 <span class="comment">/*++</span>
01036 <span class="comment"></span>
01037 <span class="comment">Routine Description:</span>
01038 <span class="comment"></span>
01039 <span class="comment">    This routine takes an array of strings, turns them into a menu</span>
01040 <span class="comment">    and gets a selection. If ESC hit then ESUCCESS is returned with</span>
01041 <span class="comment">    the *pszSelection NULL.</span>
01042 <span class="comment"></span>
01043 <span class="comment">    crgsz is assume to be 1 or greater.</span>
01044 <span class="comment"></span>
01045 <span class="comment"></span>
01046 <span class="comment">Arguments:</span>
01047 <span class="comment"></span>
01048 <span class="comment">    szTitle - Pointer to menu title to pass to AlDisplayMenu</span>
01049 <span class="comment">    prgszSelection - pointer to an array of strings for menu</span>
01050 <span class="comment">    crgsz - count of strings</span>
01051 <span class="comment">    irgszDefault - index in rgszSelection to use as default selection</span>
01052 <span class="comment"></span>
01053 <span class="comment">Return Value:</span>
01054 <span class="comment"></span>
01055 <span class="comment">    irgsz - index to selection</span>
01056 <span class="comment">    pszSelection - pointer int rgszSelection for selection. Note that</span>
01057 <span class="comment">                   this is not a dup and should not be freed seperately</span>
01058 <span class="comment">                   then rgszSelections.</span>
01059 <span class="comment"></span>
01060 <span class="comment">    Note: if ARC_STATUS == ESUCCESS and pszSelection == NULL then the</span>
01061 <span class="comment">          menu was successfully displayed but the user hit ESC to select</span>
01062 <span class="comment">          nothing from the menu.</span>
01063 <span class="comment"></span>
01064 <span class="comment">--*/</span>
01065 
01066 
01067 {
01068 
01069     PVOID  hdMenuId;
01070 
01071     *pszSelection = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01072     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d9/arcinst_8h.html#a91">AlNewMenu</a>(&amp;hdMenuId)) {
01073 
01074         <span class="keywordflow">return</span>( <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a> );
01075 
01076     }
01077 
01078     <span class="comment">//</span>
01079     <span class="comment">// BUGBUG for now 1 selection will also build a menu, in the</span>
01080     <span class="comment">// future once this is working we should just return that selection</span>
01081     <span class="comment">//</span>
01082 
01083     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d9/arcinst_8h.html#a94">AlAddMenuItems</a>(hdMenuId, rgszSelections, crgsz)) {
01084 
01085         <a class="code" href="../../d4/d9/arcinst_8h.html#a92">AlFreeMenu</a>(hdMenuId);
01086         <span class="keywordflow">return</span>( <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a> );
01087 
01088     }
01089 
01090     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d9/arcinst_8h.html#a95">AlDisplayMenu</a>(hdMenuId,
01091                        <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
01092                        irgszDefault,
01093                        pirgsz,
01094                        crow,
01095                        <a class="code" href="../../d5/d6/ntcon_2conime_2globals_8h.html#a2">szTitle</a>)) {
01096 
01097         <span class="comment">//</span>
01098         <span class="comment">// User did not pick a system partition. return NULL</span>
01099         <span class="comment">// can caller should abort</span>
01100         <span class="comment">//</span>
01101         <a class="code" href="../../d4/d9/arcinst_8h.html#a92">AlFreeMenu</a>(hdMenuId);
01102         <span class="keywordflow">return</span>( <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a> );
01103 
01104     }
01105 
01106     <a class="code" href="../../d4/d9/arcinst_8h.html#a92">AlFreeMenu</a>(hdMenuId);
01107     *pszSelection = rgszSelections[*pirgsz];
01108     <span class="keywordflow">return</span>( <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a> );
01109 
01110 }
01111 
01112 PCHAR
<a name="l01113"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a104">01113</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a104">AlStrDup</a>(
01114 
01115     IN  PCHAR   szString
01116     )
01117 
01118 <span class="comment">/*++</span>
01119 <span class="comment"></span>
01120 <span class="comment">Routine Description:</span>
01121 <span class="comment"></span>
01122 <span class="comment">    This routine makes a copy of the passed in string. I do not use</span>
01123 <span class="comment">    the CRT strdup since it uses malloc.</span>
01124 <span class="comment"></span>
01125 <span class="comment">Arguments:</span>
01126 <span class="comment"></span>
01127 <span class="comment">    szString - pointer of string to dup.</span>
01128 <span class="comment"></span>
01129 <span class="comment">Return Value:</span>
01130 <span class="comment"></span>
01131 <span class="comment">    pointer to dup'd string. NULL if could not allocate</span>
01132 <span class="comment"></span>
01133 <span class="comment">--*/</span>
01134 {
01135 
01136     PCHAR   szT;
01137 
01138     <span class="keywordflow">if</span> (szT = <a class="code" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a>(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(szString) + 1)) {
01139 
01140         strcpy(szT, szString);
01141         <span class="keywordflow">return</span>(szT);
01142 
01143     }
01144     <span class="keywordflow">return</span>( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01145 
01146 }
01147 
01148 
01149 PCHAR
<a name="l01150"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a105">01150</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a105">AlCombinePaths</a> (
01151 
01152     IN  PCHAR   szPath1,
01153     IN  PCHAR   szPath2
01154     )
01155 
01156 <span class="comment">/*++</span>
01157 <span class="comment"></span>
01158 <span class="comment">Routine Description:</span>
01159 <span class="comment"></span>
01160 <span class="comment">    This routine combines to strings. It allocate a new string</span>
01161 <span class="comment">    to hold both strings.</span>
01162 <span class="comment"></span>
01163 <span class="comment">Arguments:</span>
01164 <span class="comment"></span>
01165 <span class="comment">    pointer to combined path. NULL if failed to allocate.</span>
01166 <span class="comment"></span>
01167 <span class="comment">Return Value:</span>
01168 <span class="comment"></span>
01169 <span class="comment"></span>
01170 <span class="comment">--*/</span>
01171 {
01172 
01173     PCHAR   szT;
01174 
01175     <span class="keywordflow">if</span> (szT = <a class="code" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a>(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(szPath1) + <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(szPath2) + 1)) {
01176 
01177         strcpy(szT, szPath1);
01178         strcat(szT, szPath2);
01179         <span class="keywordflow">return</span>( szT );
01180 
01181     } <span class="keywordflow">else</span> {
01182 
01183         <span class="keywordflow">return</span> ( <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01184 
01185     }
01186 
01187 }
01188 
01189 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01190"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a106">01190</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a106">AlFreeArray</a> (
01191 
01192     IN  BOOLEAN fFreeArray,
01193     IN  PCHAR   *rgsz,
01194     IN  ULONG   csz
01195     )
01196 <span class="comment">/*++</span>
01197 <span class="comment"></span>
01198 <span class="comment">Routine Description:</span>
01199 <span class="comment"></span>
01200 <span class="comment">    This routine iterates through an array of pointers to strings freeing</span>
01201 <span class="comment">    each string and finally the array itself.</span>
01202 <span class="comment"></span>
01203 <span class="comment">Arguments:</span>
01204 <span class="comment"></span>
01205 <span class="comment">    fFreeArray - flag wither to free the array itself.</span>
01206 <span class="comment">    rgsz - pointer to array of strings.</span>
01207 <span class="comment">    csz - size of array.</span>
01208 <span class="comment"></span>
01209 <span class="comment">Return Value:</span>
01210 <span class="comment"></span>
01211 <span class="comment"></span>
01212 <span class="comment">--*/</span>
01213 
01214 {
01215 
01216     ULONG   irgsz;
01217 
01218     <span class="keywordflow">if</span> (!csz) {
01219 
01220         <span class="keywordflow">return</span>;
01221 
01222     }
01223 
01224     <span class="keywordflow">for</span>( irgsz = 0; irgsz &lt; csz; irgsz++ ) {
01225 
01226         <span class="keywordflow">if</span> (rgsz[irgsz]) {
01227 
01228             <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(rgsz[irgsz]);
01229 
01230         } <span class="keywordflow">else</span> {
01231 
01232             <span class="keywordflow">break</span>;
01233 
01234         }
01235 
01236     }
01237     <span class="keywordflow">if</span> (fFreeArray) {
01238         <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>( rgsz );
01239     }
01240 
01241 }
01242 
01243 <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>
<a name="l01244"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a107">01244</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a107">AlGetBase</a> (
01245     IN  PCHAR   szPath,
01246     OUT PCHAR   *pszBase
01247     )
01248 
01249 <span class="comment">/*++</span>
01250 <span class="comment"></span>
01251 <span class="comment">Routine Description:</span>
01252 <span class="comment"></span>
01253 <span class="comment"></span>
01254 <span class="comment">    This routine strips the filename off a path.</span>
01255 <span class="comment"></span>
01256 <span class="comment">Arguments:</span>
01257 <span class="comment"></span>
01258 <span class="comment">    szPath - path to strip.</span>
01259 <span class="comment"></span>
01260 <span class="comment">Return Value:</span>
01261 <span class="comment"></span>
01262 <span class="comment">    pszBaseh - pointer to buffer holding new base. (this is a copy)</span>
01263 <span class="comment"></span>
01264 <span class="comment">--*/</span>
01265 
01266 {
01267 
01268     PCHAR   szPathT;
01269 
01270     <span class="comment">//</span>
01271     <span class="comment">// Make local copy of szArcInstPath so we can alter it</span>
01272     <span class="comment">//</span>
01273     *pszBase = <a class="code" href="../../d4/d9/arcinst_8h.html#a104">AlStrDup</a>(szPath);
01274     <span class="keywordflow">if</span> ( *pszBase == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01275 
01276         <span class="keywordflow">return</span>( <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a> );
01277     }
01278 
01279     <span class="comment">//</span>
01280     <span class="comment">// The start of the path part should be either a \ or a ) where</span>
01281     <span class="comment">// ) is the end of the arc name</span>
01282     <span class="comment">//</span>
01283     <span class="keywordflow">if</span> ((szPathT = strrchr(*pszBase,<span class="charliteral">'\\'</span>)) == 0) {
01284         <span class="keywordflow">if</span> ((szPathT = strrchr(*pszBase, <span class="charliteral">')'</span>)) == 0) {
01285 
01286             <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(*pszBase);
01287             <span class="keywordflow">return</span>( <a class="code" href="../../d4/d9/arcinst_8h.html#a11">EBADSYNTAX</a> );
01288         }
01289     }
01290 
01291 
01292     <span class="comment">//</span>
01293     <span class="comment">// Cut filename out</span>
01294     <span class="comment">//</span>
01295     <span class="comment">// szPath points to either ')' or '\' so need to move over that</span>
01296     <span class="comment">// onto actual name</span>
01297     <span class="comment">//</span>
01298     *(szPathT + 1) = 0;
01299     <span class="keywordflow">return</span>( <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a> );
01300 
01301 
01302 }
01303 
01304 <span class="comment">//</span>
01305 <span class="comment">// Define static data.</span>
01306 <span class="comment">//</span>
01307 
01308 
<a name="l01309"></a><a class="code" href="../../d9/d6/almisc_8c.html#a8">01309</a> PCHAR <a class="code" href="../../d9/d6/almisc_8c.html#a8">AdapterTypes</a>[<a class="code" href="../../d4/d9/arcinst_8h.html#a171a57">AdapterMaximum</a> + 1] = {<span class="stringliteral">"eisa"</span>,<span class="stringliteral">"scsi"</span>, <span class="stringliteral">"multi"</span>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>};
01310 
<a name="l01311"></a><a class="code" href="../../d9/d6/almisc_8c.html#a9">01311</a> PCHAR <a class="code" href="../../d9/d6/almisc_8c.html#a9">ControllerTypes</a>[<a class="code" href="../../d4/d9/arcinst_8h.html#a172a60">ControllerMaximum</a> + 1] = {<span class="stringliteral">"cdrom"</span>, <span class="stringliteral">"disk"</span>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>};
01312 
<a name="l01313"></a><a class="code" href="../../d9/d6/almisc_8c.html#a10">01313</a> PCHAR <a class="code" href="../../d9/d6/almisc_8c.html#a10">PeripheralTypes</a>[<a class="code" href="../../d4/d9/arcinst_8h.html#a173a63">PeripheralMaximum</a> + 1] = {<span class="stringliteral">"rdisk"</span>, <span class="stringliteral">"fdisk"</span>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>};
01314 
01315 
01316 
01317 PCHAR
<a name="l01318"></a><a class="code" href="../../d7/d3/partit_8c.html#a26">01318</a> <a class="code" href="../../d7/d3/partit_8c.html#a26">AlGetNextArcNamToken</a> (
01319     IN PCHAR TokenString,
01320     OUT PCHAR OutputToken,
01321     OUT PULONG UnitNumber
01322     )
01323 
01324 <span class="comment">/*++</span>
01325 <span class="comment"></span>
01326 <span class="comment">Routine Description:</span>
01327 <span class="comment"></span>
01328 <span class="comment">    This routine scans the specified token string for the next token and</span>
01329 <span class="comment">    unit number. The token format is:</span>
01330 <span class="comment"></span>
01331 <span class="comment">        name[(unit)]</span>
01332 <span class="comment"></span>
01333 <span class="comment">Arguments:</span>
01334 <span class="comment"></span>
01335 <span class="comment">    TokenString - Supplies a pointer to a zero terminated token string.</span>
01336 <span class="comment"></span>
01337 <span class="comment">    OutputToken - Supplies a pointer to a variable that receives the next</span>
01338 <span class="comment">        token.</span>
01339 <span class="comment"></span>
01340 <span class="comment">    UnitNumber - Supplies a pointer to a variable that receives the unit</span>
01341 <span class="comment">        number.</span>
01342 <span class="comment"></span>
01343 <span class="comment">Return Value:</span>
01344 <span class="comment"></span>
01345 <span class="comment">    If another token exists in the token string, then a pointer to the</span>
01346 <span class="comment">    start of the next token is returned. Otherwise, a value of NULL is</span>
01347 <span class="comment">    returned.</span>
01348 <span class="comment"></span>
01349 <span class="comment">--*/</span>
01350 
01351 {
01352 
01353     <span class="comment">//</span>
01354     <span class="comment">// If there are more characters in the token string, then parse the</span>
01355     <span class="comment">// next token. Otherwise, return a value of NULL.</span>
01356     <span class="comment">//</span>
01357 
01358     <span class="keywordflow">if</span> (*TokenString == <span class="charliteral">'\0'</span>) {
01359         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01360 
01361     } <span class="keywordflow">else</span> {
01362         <span class="keywordflow">while</span> ((*TokenString != <span class="charliteral">'\0'</span>) &amp;&amp; (*TokenString != <span class="charliteral">'('</span>)) {
01363             *OutputToken++ = *TokenString++;
01364         }
01365 
01366         *OutputToken = <span class="charliteral">'\0'</span>;
01367 
01368         <span class="comment">//</span>
01369         <span class="comment">// If a unit number is specified, then convert it to binary.</span>
01370         <span class="comment">// Otherwise, default the unit number to zero.</span>
01371         <span class="comment">//</span>
01372 
01373         *UnitNumber = 0;
01374         <span class="keywordflow">if</span> (*TokenString == <span class="charliteral">'('</span>) {
01375             TokenString += 1;
01376             <span class="keywordflow">while</span> ((*TokenString != <span class="charliteral">'\0'</span>) &amp;&amp; (*TokenString != <span class="charliteral">')'</span>)) {
01377                 *UnitNumber = (*UnitNumber * 10) + (*TokenString++ - <span class="charliteral">'0'</span>);
01378             }
01379 
01380             <span class="keywordflow">if</span> (*TokenString == <span class="charliteral">')'</span>) {
01381                 TokenString += 1;
01382             }
01383         }
01384     }
01385 
01386     <span class="keywordflow">return</span> TokenString;
01387 }
01388 
01389 
01390 ULONG
<a name="l01391"></a><a class="code" href="../../d9/d6/almisc_8c.html#a40">01391</a> <a class="code" href="../../d9/d6/almisc_8c.html#a40">AlMatchArcNamToken</a> (
01392     IN PCHAR TokenValue,
01393     IN TOKEN_TYPE TokenType
01394     )
01395 
01396 <span class="comment">/*++</span>
01397 <span class="comment"></span>
01398 <span class="comment">Routine Description:</span>
01399 <span class="comment"></span>
01400 <span class="comment">    This routine attempts to match a token with an array of possible</span>
01401 <span class="comment">    values.</span>
01402 <span class="comment"></span>
01403 <span class="comment">Arguments:</span>
01404 <span class="comment"></span>
01405 <span class="comment">    TokenValue - Supplies a pointer to a zero terminated token value.</span>
01406 <span class="comment"></span>
01407 <span class="comment">    TokenType  - Indicates which type of token we are dealing with</span>
01408 <span class="comment">                 (AdapterType/ControllerType/PeripheralType)</span>
01409 <span class="comment"></span>
01410 <span class="comment">Return Value:</span>
01411 <span class="comment"></span>
01412 <span class="comment">    If the token type is invalid, INVALID_TOKEN_TYPE is returned.</span>
01413 <span class="comment"></span>
01414 <span class="comment">    If a token match is not located, then a value INVALID_TOKEN_VALUE</span>
01415 <span class="comment">    is returned.</span>
01416 <span class="comment"></span>
01417 <span class="comment">    If a token match is located, then the ENUM value of the token is</span>
01418 <span class="comment">    returned.</span>
01419 <span class="comment"></span>
01420 <span class="comment">--*/</span>
01421 
01422 {
01423 
01424     ULONG   <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01425     PCHAR   MatchString;
01426     PCHAR   TokenString;
01427     PCHAR   *TokenArray;
01428     BOOLEAN Found;
01429 
01430     <span class="comment">//</span>
01431     <span class="comment">// Depending on token type choose the appropriate token string array</span>
01432     <span class="comment">//</span>
01433     <span class="keywordflow">switch</span> (TokenType) {
01434         <span class="keywordflow">case</span> AdapterType:
01435             TokenArray = <a class="code" href="../../d9/d6/almisc_8c.html#a8">AdapterTypes</a>;
01436             <span class="keywordflow">break</span>;
01437 
01438         <span class="keywordflow">case</span> <a class="code" href="../../d4/d9/arcinst_8h.html#a174a65">ControllerType</a>:
01439             TokenArray =  <a class="code" href="../../d9/d6/almisc_8c.html#a9">ControllerTypes</a>;
01440             <span class="keywordflow">break</span>;
01441 
01442         <span class="keywordflow">case</span> <a class="code" href="../../d4/d9/arcinst_8h.html#a174a66">PeripheralType</a>:
01443             TokenArray = <a class="code" href="../../d9/d6/almisc_8c.html#a10">PeripheralTypes</a>;
01444             <span class="keywordflow">break</span>;
01445 
01446         <span class="keywordflow">default</span>:
01447             <span class="keywordflow">return</span> ((ULONG)<a class="code" href="../../d4/d9/arcinst_8h.html#a13">INVALID_TOKEN_TYPE</a>);
01448     }
01449 
01450     <span class="comment">//</span>
01451     <span class="comment">// Scan the match array until either a match is found or all of</span>
01452     <span class="comment">// the match strings have been scanned.</span>
01453     <span class="comment">//</span>
01454     <span class="comment">// BUGBUG** The code below can be easily implemented using _strcmpi.</span>
01455     <span class="comment">//</span>
01456 
01457     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0;
01458     Found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01459     <span class="keywordflow">while</span> (TokenArray[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01460         MatchString = TokenArray[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
01461         TokenString = TokenValue;
01462         <span class="keywordflow">while</span> ((*MatchString != <span class="charliteral">'\0'</span>) &amp;&amp; (*TokenString != <span class="charliteral">'\0'</span>)) {
01463             <span class="keywordflow">if</span> (toupper(*MatchString) != toupper(*TokenString)) {
01464                 <span class="keywordflow">break</span>;
01465             }
01466 
01467             MatchString += 1;
01468             TokenString += 1;
01469         }
01470 
01471         <span class="keywordflow">if</span> ((*MatchString == <span class="charliteral">'\0'</span>) &amp;&amp; (*TokenString == <span class="charliteral">'\0'</span>)) {
01472             Found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01473             <span class="keywordflow">break</span>;
01474         }
01475 
01476         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1;
01477     }
01478 
01479     <span class="keywordflow">return</span> (Found ? <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> : <a class="code" href="../../d4/d9/arcinst_8h.html#a14">INVALID_TOKEN_VALUE</a>);
01480 }
01481 
01482 ULONG
<a name="l01483"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a114">01483</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a114">AlPrint</a> (
01484     PCHAR Format,
01485     ...
01486     )
01487 
01488 {
01489 
01490     va_list arglist;
01491     UCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[256];
01492     ULONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
01493     ULONG Length;
01494 
01495     <span class="comment">//</span>
01496     <span class="comment">// Format the output into a buffer and then print it.</span>
01497     <span class="comment">//</span>
01498 
01499     va_start(arglist, Format);
01500     Length = vsprintf(<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>, Format, arglist);
01501     <a class="code" href="../../d1/d9/arc_8h.html#a35">ArcWrite</a>( <a class="code" href="../../d1/d9/arc_8h.html#a1">ARC_CONSOLE_OUTPUT</a>, <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>, Length, &amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
01502     va_end(arglist);
01503     <span class="keywordflow">return</span> 0;
01504 }
01505 
01506 
01507 BOOLEAN
<a name="l01508"></a><a class="code" href="../../d4/d9/arcinst_8h.html#a115">01508</a> <a class="code" href="../../d4/d9/arcinst_8h.html#a115">AlGetString</a>(
01509     OUT PCHAR String,
01510     IN  ULONG StringLength
01511     )
01512 
01513 <span class="comment">/*++</span>
01514 <span class="comment"></span>
01515 <span class="comment">Routine Description:</span>
01516 <span class="comment"></span>
01517 <span class="comment">    This routine reads a string from standardin until a</span>
01518 <span class="comment">    carriage return or escape is found or StringLength is reached.</span>
01519 <span class="comment"></span>
01520 <span class="comment">Arguments:</span>
01521 <span class="comment"></span>
01522 <span class="comment">    String - Supplies a pointer to where the string will be stored.</span>
01523 <span class="comment"></span>
01524 <span class="comment">    StringLength - Supplies the Max Length to read.</span>
01525 <span class="comment"></span>
01526 <span class="comment">Return Value:</span>
01527 <span class="comment"></span>
01528 <span class="comment">    FALSE if user pressed esc, TRUE otherwise.</span>
01529 <span class="comment"></span>
01530 <span class="comment">--*/</span>
01531 
01532 {
01533     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>    <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
01534     ULONG   <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
01535     PCHAR   <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01536 
01537     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>;
01538     <span class="keywordflow">while</span> (<a class="code" href="../../d1/d9/arc_8h.html#a33">ArcRead</a>(<a class="code" href="../../d1/d9/arc_8h.html#a0">ARC_CONSOLE_INPUT</a>,&amp;<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>,1,&amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>)==<a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
01539         <span class="keywordflow">if</span>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d4/d9/arcinst_8h.html#a9">ASCI_ESC</a>) {
01540             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01541         }
01542         <span class="keywordflow">if</span> ((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>==<span class="charliteral">'\r'</span>) || (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>==<span class="charliteral">'\n'</span>) || ((ULONG)(<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>-<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a>)) {
01543             *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>=<span class="charliteral">'\0'</span>;
01544             <a class="code" href="../../d1/d9/arc_8h.html#a35">ArcWrite</a>(<a class="code" href="../../d1/d9/arc_8h.html#a1">ARC_CONSOLE_OUTPUT</a>,<span class="stringliteral">"\r\n"</span>,2,&amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
01545             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01546         }
01547         <span class="comment">//</span>
01548         <span class="comment">// Check for backspace;</span>
01549         <span class="comment">//</span>
01550         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>==<span class="charliteral">'\b'</span>) {
01551             <span class="keywordflow">if</span> (((ULONG)<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> &gt; (ULONG)<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>)) {
01552                 <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>--;
01553                 <a class="code" href="../../d1/d9/arc_8h.html#a35">ArcWrite</a>(<a class="code" href="../../d1/d9/arc_8h.html#a1">ARC_CONSOLE_OUTPUT</a>,<span class="stringliteral">"\b \b"</span>,3,&amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
01554             }
01555         } <span class="keywordflow">else</span> {
01556             <span class="comment">//</span>
01557             <span class="comment">// If it's a printable char store it and display it.</span>
01558             <span class="comment">//</span>
01559             <span class="keywordflow">if</span> (isprint(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>)) {
01560                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
01561                 <a class="code" href="../../d1/d9/arc_8h.html#a35">ArcWrite</a>(<a class="code" href="../../d1/d9/arc_8h.html#a1">ARC_CONSOLE_OUTPUT</a>,&amp;<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>,1,&amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
01562             }
01563         }
01564     }
01565 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:15 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
