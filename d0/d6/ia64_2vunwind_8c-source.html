<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: vunwind.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>vunwind.c</h1><a href="../../d9/d6/ia64_2vunwind_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 
00018 <span class="preprocessor">#if !defined(BUILD_DBGHELP) &amp;&amp; !defined(BUILD_IMAGEHLP)</span>
00019 <span class="preprocessor"></span>
00020 <span class="preprocessor">#include "<a class="code" href="../../d5/d9/ntrtlp_8h.html">ntrtlp.h</a>"</span>
00021 
00022 <span class="preprocessor">#else  // !BUILD_DBGHELP &amp;&amp; !BUILD_IMAGEHLP</span>
00023 <span class="preprocessor"></span>
00024 <span class="preprocessor">#define TARGET_IA64</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define _CROSS_PLATFORM_</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#define _IA64REG_</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#include "walk.h"</span>
00028 <span class="preprocessor">#include "private.h"</span>
00029 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00030 
00031 <span class="preprocessor">#endif // !BUILD_DBGHELP &amp;&amp; !BUILD_IMAGEHLP</span>
00032 <span class="preprocessor"></span>
00033 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#define NOT_IMAGEHLP(E)</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define FUNCTION_ENTRY_IS_IMAGE_STYLE</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#define RtlVirtualUnwind VirtualUnwindIa64</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define PRUNTIME_FUNCTION PIMAGE_RUNTIME_FUNCTION_ENTRY</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define RUNTIME_FUNCTION IMAGE_RUNTIME_FUNCTION_ENTRY</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define VUW_DEBUG_PRINT OutputDebugString</span>
00041 <span class="preprocessor"></span>
00042 <span class="preprocessor">#else  // !_IMAGEHLP_SOURCE_</span>
00043 <span class="preprocessor"></span>
<a name="l00044"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a0">00044</a> <span class="preprocessor">#define NOT_IMAGEHLP(E) E</span>
<a name="l00045"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a1">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define VUW_DEBUG_PRINT DbgPrint</span>
00046 <span class="preprocessor"></span>
00047 <span class="preprocessor">#endif // !_IMAGEHLP_SOURCE_</span>
00048 <span class="preprocessor"></span>
00049 <span class="preprocessor">#ifdef MASK</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#undef MASK</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#endif // MASK</span>
<a name="l00052"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define MASK(bp,value)  (value &lt;&lt; bp)</span>
00053 <span class="preprocessor"></span>
00054 <span class="comment">//</span>
00055 <span class="comment">// ABI values</span>
00056 <span class="comment">//</span>
00057 
<a name="l00058"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a3">00058</a> <span class="preprocessor">#define SVR4_ABI      0</span>
<a name="l00059"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a4">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define HPUX_ABI      1</span>
<a name="l00060"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a5">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define NT_ABI        2</span>
00061 <span class="preprocessor"></span>
00062 
00063 <span class="preprocessor">#ifdef KERNEL_DEBUGGER</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#define FUNCTION_ENTRY_IS_IMAGE_STYLE</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#define RtlVirtualUnwind VirtualUnwind</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00067 <span class="preprocessor"></span>
<a name="l00068"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a6">00068</a> <span class="preprocessor">#define STATE_RECORD_STACK_SIZE 32</span>
00069 <span class="preprocessor"></span>
<a name="l00070"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a7">00070</a> <span class="preprocessor">#define SPILLSIZE_OF_FLOAT128_IN_DWORDS   4</span>
<a name="l00071"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a8">00071</a> <span class="preprocessor"></span><span class="preprocessor">#define SPILLSIZE_OF_ULONGLONG_IN_DWORDS  2</span>
00072 <span class="preprocessor"></span>
<a name="l00073"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a9">00073</a> <span class="preprocessor">#define REGISTER_SIZE                sizeof(ULONGLONG)</span>
<a name="l00074"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a10">00074</a> <span class="preprocessor"></span><span class="preprocessor">#define STATIC_REGISTER_SET_SIZE     32</span>
<a name="l00075"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a11">00075</a> <span class="preprocessor"></span><span class="preprocessor">#define SLOTS_PER_BUNDLE             3</span>
00076 <span class="preprocessor"></span>
<a name="l00077"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a12">00077</a> <span class="preprocessor">#define R1_MASK              0xC0</span>
<a name="l00078"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a13">00078</a> <span class="preprocessor"></span><span class="preprocessor">#define R1_PREFIX            0x0</span>
<a name="l00079"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a14">00079</a> <span class="preprocessor"></span><span class="preprocessor">#define R1_REGION_TYPE_MASK  0x20</span>
<a name="l00080"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a15">00080</a> <span class="preprocessor"></span><span class="preprocessor">#define R1_LENGTH_MASK       0x1F</span>
00081 <span class="preprocessor"></span>
<a name="l00082"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a16">00082</a> <span class="preprocessor">#define R2_MASK              0xE0</span>
<a name="l00083"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a17">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define R2_PREFIX            0x40</span>
00084 <span class="preprocessor"></span>
<a name="l00085"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a18">00085</a> <span class="preprocessor">#define R3_MASK              0xE0</span>
<a name="l00086"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a19">00086</a> <span class="preprocessor"></span><span class="preprocessor">#define R3_PREFIX            0x60</span>
<a name="l00087"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a20">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define R3_REGION_TYPE_MASK  0x3</span>
00088 <span class="preprocessor"></span>
<a name="l00089"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a21">00089</a> <span class="preprocessor">#define P1_MASK              0xE0</span>
<a name="l00090"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a22">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define P1_PREFIX            0x80</span>
<a name="l00091"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a23">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define P2_MASK              0xF0</span>
<a name="l00092"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a24">00092</a> <span class="preprocessor"></span><span class="preprocessor">#define P2_PREFIX            0xA0</span>
<a name="l00093"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a25">00093</a> <span class="preprocessor"></span><span class="preprocessor">#define P3_MASK              0xF8</span>
<a name="l00094"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a26">00094</a> <span class="preprocessor"></span><span class="preprocessor">#define P3_PREFIX            0xB0</span>
<a name="l00095"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a27">00095</a> <span class="preprocessor"></span><span class="preprocessor">#define P4_MASK              0xFF</span>
<a name="l00096"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a28">00096</a> <span class="preprocessor"></span><span class="preprocessor">#define P4_PREFIX            0xB8</span>
<a name="l00097"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a29">00097</a> <span class="preprocessor"></span><span class="preprocessor">#define P5_MASK              0xFF</span>
<a name="l00098"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a30">00098</a> <span class="preprocessor"></span><span class="preprocessor">#define P5_PREFIX            0xB9</span>
<a name="l00099"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a31">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define P6_MASK              0xE0</span>
<a name="l00100"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a32">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define P6_PREFIX            0xC0</span>
<a name="l00101"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a33">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define P7_MASK              0xF0</span>
<a name="l00102"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a34">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define P7_PREFIX            0xE0</span>
<a name="l00103"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a35">00103</a> <span class="preprocessor"></span><span class="preprocessor">#define P8_MASK              0xFF</span>
<a name="l00104"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a36">00104</a> <span class="preprocessor"></span><span class="preprocessor">#define P8_PREFIX            0xF0</span>
<a name="l00105"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a37">00105</a> <span class="preprocessor"></span><span class="preprocessor">#define P9_MASK              0xFF</span>
<a name="l00106"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a38">00106</a> <span class="preprocessor"></span><span class="preprocessor">#define P9_PREFIX            0xF1</span>
<a name="l00107"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a39">00107</a> <span class="preprocessor"></span><span class="preprocessor">#define P10_MASK             0xFF</span>
<a name="l00108"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a40">00108</a> <span class="preprocessor"></span><span class="preprocessor">#define P10_PREFIX           0xFF</span>
00109 <span class="preprocessor"></span>
<a name="l00110"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a41">00110</a> <span class="preprocessor">#define B1_MASK              0xC0</span>
<a name="l00111"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a42">00111</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_PREFIX            0x80</span>
<a name="l00112"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a43">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_TYPE_MASK         0x20</span>
<a name="l00113"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a44">00113</a> <span class="preprocessor"></span><span class="preprocessor">#define B1_LABEL_MASK        0x1F</span>
<a name="l00114"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a45">00114</a> <span class="preprocessor"></span><span class="preprocessor">#define B2_MASK              0xE0</span>
<a name="l00115"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a46">00115</a> <span class="preprocessor"></span><span class="preprocessor">#define B2_PREFIX            0xC0</span>
<a name="l00116"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a47">00116</a> <span class="preprocessor"></span><span class="preprocessor">#define B2_ECOUNT_MASK       0x1F</span>
<a name="l00117"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a48">00117</a> <span class="preprocessor"></span><span class="preprocessor">#define B3_MASK              0xF0</span>
<a name="l00118"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a49">00118</a> <span class="preprocessor"></span><span class="preprocessor">#define B3_PREFIX            0xE0</span>
<a name="l00119"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a50">00119</a> <span class="preprocessor"></span><span class="preprocessor">#define B4_MASK              0xF0</span>
<a name="l00120"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a51">00120</a> <span class="preprocessor"></span><span class="preprocessor">#define B4_PREFIX            0xF0</span>
<a name="l00121"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a52">00121</a> <span class="preprocessor"></span><span class="preprocessor">#define B4_TYPE_MASK         0x08</span>
00122 <span class="preprocessor"></span>
00123 <span class="comment">//</span>
00124 <span class="comment">// P3 descriptor type</span>
00125 <span class="comment">//</span>
00126 
<a name="l00127"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a53">00127</a> <span class="preprocessor">#define PSP_GR               0</span>
<a name="l00128"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a54">00128</a> <span class="preprocessor"></span><span class="preprocessor">#define RP_GR                1</span>
<a name="l00129"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a55">00129</a> <span class="preprocessor"></span><span class="preprocessor">#define PFS_GR               2</span>
<a name="l00130"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a56">00130</a> <span class="preprocessor"></span><span class="preprocessor">#define PREDS_GR             3</span>
<a name="l00131"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a57">00131</a> <span class="preprocessor"></span><span class="preprocessor">#define UNAT_GR              4</span>
<a name="l00132"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a58">00132</a> <span class="preprocessor"></span><span class="preprocessor">#define LC_GR                5</span>
<a name="l00133"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a59">00133</a> <span class="preprocessor"></span><span class="preprocessor">#define RP_BR                6</span>
<a name="l00134"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a60">00134</a> <span class="preprocessor"></span><span class="preprocessor">#define RNAT_GR              7</span>
<a name="l00135"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a61">00135</a> <span class="preprocessor"></span><span class="preprocessor">#define BSP_GR               8</span>
<a name="l00136"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a62">00136</a> <span class="preprocessor"></span><span class="preprocessor">#define BSPSTORE_GR          9</span>
<a name="l00137"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a63">00137</a> <span class="preprocessor"></span><span class="preprocessor">#define FPSR_GR              10</span>
<a name="l00138"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a64">00138</a> <span class="preprocessor"></span><span class="preprocessor">#define PRIUNAT_GR           11</span>
00139 <span class="preprocessor"></span>
00140 <span class="comment">//</span>
00141 <span class="comment">// P7 descriptor type</span>
00142 <span class="comment">//</span>
00143 
<a name="l00144"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a65">00144</a> <span class="preprocessor">#define MEM_STACK_F          0</span>
<a name="l00145"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a66">00145</a> <span class="preprocessor"></span><span class="preprocessor">#define MEM_STACK_V          1</span>
<a name="l00146"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a67">00146</a> <span class="preprocessor"></span><span class="preprocessor">#define SPILL_BASE           2</span>
<a name="l00147"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a68">00147</a> <span class="preprocessor"></span><span class="preprocessor">#define PSP_SPREL            3</span>
<a name="l00148"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a69">00148</a> <span class="preprocessor"></span><span class="preprocessor">#define RP_WHEN              4</span>
<a name="l00149"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a70">00149</a> <span class="preprocessor"></span><span class="preprocessor">#define RP_PSPREL            5</span>
<a name="l00150"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a71">00150</a> <span class="preprocessor"></span><span class="preprocessor">#define PFS_WHEN             6</span>
<a name="l00151"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a72">00151</a> <span class="preprocessor"></span><span class="preprocessor">#define PFS_PSPREL           7</span>
<a name="l00152"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a73">00152</a> <span class="preprocessor"></span><span class="preprocessor">#define PREDS_WHEN           8</span>
<a name="l00153"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a74">00153</a> <span class="preprocessor"></span><span class="preprocessor">#define PREDS_PSPREL         9</span>
<a name="l00154"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a75">00154</a> <span class="preprocessor"></span><span class="preprocessor">#define LC_WHEN              10</span>
<a name="l00155"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a76">00155</a> <span class="preprocessor"></span><span class="preprocessor">#define LC_PSPREL            11</span>
<a name="l00156"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a77">00156</a> <span class="preprocessor"></span><span class="preprocessor">#define UNAT_WHEN            12</span>
<a name="l00157"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a78">00157</a> <span class="preprocessor"></span><span class="preprocessor">#define UNAT_PSPREL          13</span>
<a name="l00158"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a79">00158</a> <span class="preprocessor"></span><span class="preprocessor">#define FPSR_WHEN            14</span>
<a name="l00159"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a80">00159</a> <span class="preprocessor"></span><span class="preprocessor">#define FPSR_PSPREL          15</span>
00160 <span class="preprocessor"></span>
00161 <span class="comment">//</span>
00162 <span class="comment">// P8 descriptor type</span>
00163 <span class="comment">//</span>
00164 
<a name="l00165"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a81">00165</a> <span class="preprocessor">#define PSP_PSPREL           0</span>
<a name="l00166"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a82">00166</a> <span class="preprocessor"></span><span class="preprocessor">#define RP_SPREL             1</span>
<a name="l00167"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a83">00167</a> <span class="preprocessor"></span><span class="preprocessor">#define PFS_SPREL            2</span>
<a name="l00168"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a84">00168</a> <span class="preprocessor"></span><span class="preprocessor">#define PREDS_SPREL          3</span>
<a name="l00169"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a85">00169</a> <span class="preprocessor"></span><span class="preprocessor">#define LC_SPREL             4</span>
<a name="l00170"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a86">00170</a> <span class="preprocessor"></span><span class="preprocessor">#define UNAT_SPREL           5</span>
<a name="l00171"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a87">00171</a> <span class="preprocessor"></span><span class="preprocessor">#define FPSR_SPREL           6</span>
<a name="l00172"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a88">00172</a> <span class="preprocessor"></span><span class="preprocessor">#define BSP_WHEN             7</span>
<a name="l00173"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a89">00173</a> <span class="preprocessor"></span><span class="preprocessor">#define BSP_PSPREL           8</span>
<a name="l00174"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a90">00174</a> <span class="preprocessor"></span><span class="preprocessor">#define BSP_SPREL            9</span>
<a name="l00175"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a91">00175</a> <span class="preprocessor"></span><span class="preprocessor">#define BSPSTORE_WHEN        10</span>
<a name="l00176"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a92">00176</a> <span class="preprocessor"></span><span class="preprocessor">#define BSPSTORE_PSPREL      11</span>
<a name="l00177"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a93">00177</a> <span class="preprocessor"></span><span class="preprocessor">#define BSPSTORE_SPREL       12</span>
<a name="l00178"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a94">00178</a> <span class="preprocessor"></span><span class="preprocessor">#define RNAT_WHEN            13</span>
<a name="l00179"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a95">00179</a> <span class="preprocessor"></span><span class="preprocessor">#define RNAT_PSPREL          14</span>
<a name="l00180"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a96">00180</a> <span class="preprocessor"></span><span class="preprocessor">#define RNAT_SPREL           15</span>
<a name="l00181"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a97">00181</a> <span class="preprocessor"></span><span class="preprocessor">#define PRIUNAT_WHEN         16</span>
<a name="l00182"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a98">00182</a> <span class="preprocessor"></span><span class="preprocessor">#define PRIUNAT_PSPREL       17</span>
<a name="l00183"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a99">00183</a> <span class="preprocessor"></span><span class="preprocessor">#define PRIUNAT_SPREL        18</span>
00184 <span class="preprocessor"></span>
00185 
<a name="l00186"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a100">00186</a> <span class="preprocessor">#define STACK_POINTER_GR     12</span>
00187 <span class="preprocessor"></span>
<a name="l00188"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a101">00188</a> <span class="preprocessor">#define FIRST_PRESERVED_GR                4</span>
<a name="l00189"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a102">00189</a> <span class="preprocessor"></span><span class="preprocessor">#define LAST_PRESERVED_GR                 7</span>
<a name="l00190"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a103">00190</a> <span class="preprocessor"></span><span class="preprocessor">#define NUMBER_OF_PRESERVED_GR            4</span>
00191 <span class="preprocessor"></span>
<a name="l00192"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a104">00192</a> <span class="preprocessor">#define FIRST_LOW_PRESERVED_FR            2</span>
<a name="l00193"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a105">00193</a> <span class="preprocessor"></span><span class="preprocessor">#define LAST_LOW_PRESERVED_FR             5</span>
<a name="l00194"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a106">00194</a> <span class="preprocessor"></span><span class="preprocessor">#define NUMBER_OF_LOW_PRESERVED_FR        4</span>
00195 <span class="preprocessor"></span>
<a name="l00196"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a107">00196</a> <span class="preprocessor">#define FIRST_HIGH_PRESERVED_FR           16</span>
<a name="l00197"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a108">00197</a> <span class="preprocessor"></span><span class="preprocessor">#define LAST_HIGH_PRESERVED_FR            31</span>
<a name="l00198"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a109">00198</a> <span class="preprocessor"></span><span class="preprocessor">#define NUMBER_OF_HIGH_PRESERVED_FR       16</span>
<a name="l00199"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a110">00199</a> <span class="preprocessor"></span><span class="preprocessor">#define NUMBER_OF_PRESERVED_FR            NUMBER_OF_LOW_PRESERVED_FR+NUMBER_OF_HIGH_PRESERVED_FR</span>
00200 <span class="preprocessor"></span>
<a name="l00201"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a111">00201</a> <span class="preprocessor">#define FIRST_PRESERVED_BR                1</span>
<a name="l00202"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a112">00202</a> <span class="preprocessor"></span><span class="preprocessor">#define LAST_PRESERVED_BR                 5</span>
<a name="l00203"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a113">00203</a> <span class="preprocessor"></span><span class="preprocessor">#define NUMBER_OF_PRESERVED_BR            5</span>
00204 <span class="preprocessor"></span>
<a name="l00205"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a114">00205</a> <span class="preprocessor">#define NUMBER_OF_PRESERVED_MISC          7</span>
00206 <span class="preprocessor"></span>
<a name="l00207"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a115">00207</a> <span class="preprocessor">#define NUMBER_OF_PRESERVED_REGISTERS     12</span>
00208 <span class="preprocessor"></span>
00209 
<a name="l00210"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a116">00210</a> <span class="preprocessor">#define REG_MISC_BASE        0</span>
<a name="l00211"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a117">00211</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_PREDS            REG_MISC_BASE+0</span>
<a name="l00212"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">00212</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_SP               REG_MISC_BASE+1</span>
<a name="l00213"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a119">00213</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_PFS              REG_MISC_BASE+2</span>
<a name="l00214"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a120">00214</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_RP               REG_MISC_BASE+3</span>
<a name="l00215"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a121">00215</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_UNAT             REG_MISC_BASE+4</span>
<a name="l00216"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a122">00216</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_LC               REG_MISC_BASE+5</span>
<a name="l00217"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a123">00217</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_NATS             REG_MISC_BASE+6</span>
00218 <span class="preprocessor"></span>
<a name="l00219"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">00219</a> <span class="preprocessor">#define REG_BR_BASE          REG_MISC_BASE+NUMBER_OF_PRESERVED_MISC</span>
00220 <span class="preprocessor"></span>
<a name="l00221"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a125">00221</a> <span class="preprocessor">#define REG_FPSR             0xff // REG_MISC_BASE+7</span>
<a name="l00222"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a126">00222</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_BSP              0xff // REG_MISC_BASE+8</span>
<a name="l00223"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a127">00223</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_BSPSTORE         0xff // REG_MISC_BASE+9</span>
<a name="l00224"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a128">00224</a> <span class="preprocessor"></span><span class="preprocessor">#define REG_RNAT             0xff // REG_MISC_BASE+10</span>
00225 <span class="preprocessor"></span>
00226 <span class="comment">//</span>
00227 <span class="comment">// Where is a preserved register saved?</span>
00228 <span class="comment">//</span>
00229 <span class="comment">//     1. stack general register</span>
00230 <span class="comment">//     2. memory stack (pspoff)</span>
00231 <span class="comment">//     3. memory stack (spoff)</span>
00232 <span class="comment">//     4. branch register</span>
00233 <span class="comment">//</span>
00234 
<a name="l00235"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a129">00235</a> <span class="preprocessor">#define GENERAL_REG          0</span>
<a name="l00236"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a130">00236</a> <span class="preprocessor"></span><span class="preprocessor">#define PSP_RELATIVE         1</span>
<a name="l00237"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a131">00237</a> <span class="preprocessor"></span><span class="preprocessor">#define SP_RELATIVE          2</span>
<a name="l00238"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a132">00238</a> <span class="preprocessor"></span><span class="preprocessor">#define BRANCH_REG           3</span>
00239 <span class="preprocessor"></span>
00240 
<a name="l00241"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a133">00241</a> <span class="preprocessor">#define ADD_STATE_RECORD(States, RegionLength, DescBeginIndex)       \</span>
00242 <span class="preprocessor">    States.Top++;                                                    \</span>
00243 <span class="preprocessor">    States.Top-&gt;IsTarget = FALSE;                                    \</span>
00244 <span class="preprocessor">    States.Top-&gt;MiscMask = 0;                                        \</span>
00245 <span class="preprocessor">    States.Top-&gt;FrMask = 0;                                          \</span>
00246 <span class="preprocessor">    States.Top-&gt;GrMask = 0;                                          \</span>
00247 <span class="preprocessor">    States.Top-&gt;Label = (LABEL)0;                                    \</span>
00248 <span class="preprocessor">    States.Top-&gt;Ecount = 0;                                          \</span>
00249 <span class="preprocessor">    States.Top-&gt;RegionLen = RegionLength;                            \</span>
00250 <span class="preprocessor">    States.Top-&gt;RegionBegin = UnwindContext.SlotCount;               \</span>
00251 <span class="preprocessor">    States.Top-&gt;SpWhen = 0;                                          \</span>
00252 <span class="preprocessor">    States.Top-&gt;SpAdjustment = 0;                                    \</span>
00253 <span class="preprocessor">    States.Top-&gt;SpillBase = (States.Top-1)-&gt;SpillPtr;                \</span>
00254 <span class="preprocessor">    States.Top-&gt;SpillPtr = (States.Top-1)-&gt;SpillPtr;                 \</span>
00255 <span class="preprocessor">    States.Top-&gt;Previous = States.Current;                           \</span>
00256 <span class="preprocessor">    States.Top-&gt;DescBegin = DescBeginIndex;                          \</span>
00257 <span class="preprocessor">    States.Current = States.Top</span>
00258 <span class="preprocessor"></span>
00259 
<a name="l00260"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a134">00260</a> <span class="preprocessor">#define VALID_LABEL_BIT_POSITION    15</span>
00261 <span class="preprocessor"></span>
<a name="l00262"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a135">00262</a> <span class="preprocessor">#define LABEL_REGION(Region, Label)                                    \</span>
00263 <span class="preprocessor">    Region-&gt;Label = Label;                                             \</span>
00264 <span class="preprocessor">    Region-&gt;MiscMask |= (1 &lt;&lt; VALID_LABEL_BIT_POSITION)</span>
00265 <span class="preprocessor"></span>
<a name="l00266"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a136">00266</a> <span class="preprocessor">#define IS_REGION_LABELED(Region)  \</span>
00267 <span class="preprocessor">    (Region-&gt;MiscMask &amp; (1 &lt;&lt; VALID_LABEL_BIT_POSITION))</span>
00268 <span class="preprocessor"></span>
<a name="l00269"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a137">00269</a> <span class="preprocessor">#define CHECK_LABEL(State, Label) \</span>
00270 <span class="preprocessor">    ( (IS_REGION_LABELED(State)) &amp;&amp; (Label == State-&gt;Label) )</span>
00271 <span class="preprocessor"></span>
00272 
<a name="l00273"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a138">00273</a> <span class="preprocessor">#define EXTRACT_NAT_FROM_UNAT(NatBit)  \</span>
00274 <span class="preprocessor">    NatBit = (UCHAR)((IntNats &gt;&gt; (((ULONG_PTR)Source &amp; 0x1F8) &gt;&gt; 3)) &amp; 0x1);</span>
00275 <span class="preprocessor"></span>
00276 
00277 <span class="preprocessor">#if DBG</span>
00278 <span class="preprocessor"></span><span class="keywordtype">int</span> UnwindDebugLevel = 0;
00279 <span class="preprocessor"># ifdef _IMAGEHLP_SOURCE_</span>
00280 <span class="preprocessor"></span><span class="preprocessor">#  define UW_DEBUG(x) if (UnwindDebugLevel) dbPrint##x</span>
00281 <span class="preprocessor"></span><span class="preprocessor"># else</span>
00282 <span class="preprocessor"></span><span class="preprocessor">#  define UW_DEBUG(x) if (UnwindDebugLevel) DbgPrint##x</span>
00283 <span class="preprocessor"></span><span class="preprocessor"># endif</span>
00284 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00285"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">00285</a> <span class="preprocessor"></span><span class="preprocessor"># define UW_DEBUG(x)</span>
00286 <span class="preprocessor"></span><span class="preprocessor">#endif // DBG</span>
00287 <span class="preprocessor"></span>
00288 
00289 
<a name="l00290"></a><a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html">00290</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html">_REGISTER_RECORD</a> {
<a name="l00291"></a><a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o0">00291</a>     ULONG <a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o0">Where</a> : 2;                  <span class="comment">// 2-bit field</span>
<a name="l00292"></a><a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">00292</a>     ULONG <a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a> : 30;            <span class="comment">// 30 bits for offset, big enough?</span>
<a name="l00293"></a><a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o2">00293</a>     ULONG <a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o2">When</a>;                       <span class="comment">// slot offset relative to region</span>
00294 } <a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html">REGISTER_RECORD</a>, *<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html">PREGISTER_RECORD</a>;
00295 
<a name="l00296"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a143">00296</a> <span class="keyword">typedef</span> ULONG <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a143">LABEL</a>;
00297 
<a name="l00298"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html">00298</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d6/struct__STATE__RECORD.html">_STATE_RECORD</a> {
<a name="l00299"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o0">00299</a>     <span class="keyword">struct </span><a class="code" href="../../d1/d6/struct__STATE__RECORD.html">_STATE_RECORD</a> *<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o0">Previous</a>;   <span class="comment">// pointer to outer nested prologue</span>
<a name="l00300"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o1">00300</a>     BOOLEAN <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o1">IsTarget</a>;       <span class="comment">// TRUE if the control pc is in this prologue</span>
<a name="l00301"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o2">00301</a>     UCHAR <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o2">GrMask</a>;           <span class="comment">// Mask that specifies which GRs to be restored</span>
<a name="l00302"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o3">00302</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o3">MiscMask</a>;        <span class="comment">// Mask that specifies which BRs and misc. registers</span>
00303                             <span class="comment">// are to be restored.</span>
00304                             <span class="comment">// N.B. MSBit indicates Label is valid or not.</span>
<a name="l00305"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o4">00305</a>     ULONG <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o4">FrMask</a>;           <span class="comment">// Mask that specifies which FRs to be restored</span>
<a name="l00306"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o5">00306</a>     ULONG <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o5">SpAdjustment</a>;     <span class="comment">// size of stack frame allocated in the prologue</span>
<a name="l00307"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o6">00307</a>     ULONG <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o6">SpWhen</a>;           <span class="comment">// slot offset relative to region</span>
<a name="l00308"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o7">00308</a>     ULONG <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o7">SpillPtr</a>;         <span class="comment">// current spill location</span>
<a name="l00309"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o8">00309</a>     ULONG <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o8">SpillBase</a>;        <span class="comment">// spill base of the region</span>
<a name="l00310"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o9">00310</a>     ULONG <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o9">RegionBegin</a>;      <span class="comment">// first slot of region relative to function entry</span>
<a name="l00311"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o10">00311</a>     ULONG <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o10">RegionLen</a>;        <span class="comment">// number of slots in the region</span>
<a name="l00312"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o11">00312</a>     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a143">LABEL</a> <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o11">Label</a>;            <span class="comment">// label that identifies a post-prologue state</span>
<a name="l00313"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o12">00313</a>     ULONG <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o12">Ecount</a>;           <span class="comment">// number of prologue regions to pop</span>
<a name="l00314"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o13">00314</a>     ULONG <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o13">DescBegin</a>;        <span class="comment">// first prologue descriptor for the region</span>
<a name="l00315"></a><a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o14">00315</a>     ULONG <a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o14">DescEnd</a>;          <span class="comment">// last prologue descriptor for the region</span>
00316 } <a class="code" href="../../d1/d6/struct__STATE__RECORD.html">STATE_RECORD</a>, *<a class="code" href="../../d1/d6/struct__STATE__RECORD.html">PSTATE_RECORD</a>;
00317 
<a name="l00318"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html">00318</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html">_UNWIND_CONTEXT</a> {
<a name="l00319"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">00319</a>     <a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html">REGISTER_RECORD</a> <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a115">NUMBER_OF_PRESERVED_REGISTERS</a>];
<a name="l00320"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o1">00320</a>     <a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html">REGISTER_RECORD</a> <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o1">Float</a>[<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a110">NUMBER_OF_PRESERVED_FR</a>];
<a name="l00321"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o2">00321</a>     <a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html">REGISTER_RECORD</a> <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o2">Integer</a>[<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a103">NUMBER_OF_PRESERVED_GR</a>];
<a name="l00322"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o3">00322</a>     BOOLEAN <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o3">ActiveRegionFound</a>;
<a name="l00323"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o4">00323</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o4">Version</a>;
<a name="l00324"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o5">00324</a>     PUCHAR <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o5">Descriptors</a>;               <span class="comment">// beginning of descriptor data</span>
<a name="l00325"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o6">00325</a>     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;                       <span class="comment">// total size of all descriptors</span>
<a name="l00326"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">00326</a>     ULONG <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">DescCount</a>;                  <span class="comment">// number of descriptor bytes processed</span>
<a name="l00327"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o8">00327</a>     ULONG <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o8">TargetSlot</a>;
<a name="l00328"></a><a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o9">00328</a>     ULONG <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o9">SlotCount</a>;
00329 } <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html">UNWIND_CONTEXT</a>, *<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html">PUNWIND_CONTEXT</a>;
00330 
<a name="l00331"></a><a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html">00331</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html">_STATE_RECORD_STACK</a> {
<a name="l00332"></a><a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o0">00332</a>     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
<a name="l00333"></a><a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o1">00333</a>     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a145">PSTATE_RECORD</a> <a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o1">Current</a>;
<a name="l00334"></a><a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o2">00334</a>     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a145">PSTATE_RECORD</a> <a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o2">Top</a>;
<a name="l00335"></a><a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o3">00335</a>     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a145">PSTATE_RECORD</a> <a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o3">Base</a>;
00336 } <a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html">STATE_RECORD_STACK</a>, *<a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html">PSTATE_RECORD_STACK</a>;
00337 
<a name="l00338"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a140">00338</a> <span class="preprocessor">#define OFFSET(type, field) ((ULONG_PTR)(&amp;((type *)0)-&gt;field))</span>
00339 <span class="preprocessor"></span>
<a name="l00340"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a150">00340</a> <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a150">MiscContextOffset</a>[<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a115">NUMBER_OF_PRESERVED_REGISTERS</a>] = {
00341     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, Preds),
00342     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, IntSp),
00343     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, RsPFS),
00344     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, BrRp),
00345     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, ApUNAT),
00346     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, ApLC),
00347     0,
00348     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, BrS0),
00349     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, BrS1),
00350     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, BrS2),
00351     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, BrS3),
00352     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(CONTEXT, BrS4)
00353 };
00354 
<a name="l00355"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a151">00355</a> <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a151">MiscContextPointersOffset</a>[<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a115">NUMBER_OF_PRESERVED_REGISTERS</a>] = {
00356     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, Preds),
00357     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, IntSp),
00358     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, RsPFS),
00359     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, BrRp),
00360     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, ApUNAT),
00361     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, ApLC),
00362     0,
00363     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, BrS0),
00364     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, BrS1),
00365     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, BrS2),
00366     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, BrS3),
00367     <a class="code" href="../../d0/d2/genxx_8h.html#a43">OFFSET</a>(KNONVOLATILE_CONTEXT_POINTERS, BrS4)
00368 };
00369 
<a name="l00370"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a152">00370</a> <span class="keyword">static</span> UCHAR <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a152">P3RecordTypeToRegisterIndex</a>[] =
00371     {<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">REG_SP</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a120">REG_RP</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a119">REG_PFS</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a117">REG_PREDS</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a121">REG_UNAT</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a122">REG_LC</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a120">REG_RP</a>};
00372 
<a name="l00373"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a153">00373</a> <span class="keyword">static</span> UCHAR <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a153">P7RecordTypeToRegisterIndex</a>[] =
00374     {0, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">REG_SP</a>, 0, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">REG_SP</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a120">REG_RP</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a120">REG_RP</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a119">REG_PFS</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a119">REG_PFS</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a117">REG_PREDS</a>,
00375      <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a117">REG_PREDS</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a122">REG_LC</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a122">REG_LC</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a121">REG_UNAT</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a121">REG_UNAT</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a125">REG_FPSR</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a125">REG_FPSR</a>};
00376 
<a name="l00377"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a154">00377</a> <span class="keyword">static</span> UCHAR <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a154">P8RecordTypeToRegisterIndex</a>[] =
00378     {<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">REG_SP</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a120">REG_RP</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a119">REG_PFS</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a117">REG_PREDS</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a122">REG_LC</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a121">REG_UNAT</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a125">REG_FPSR</a>,
00379      <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a126">REG_BSP</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a126">REG_BSP</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a126">REG_BSP</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a127">REG_BSPSTORE</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a127">REG_BSPSTORE</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a127">REG_BSPSTORE</a>,
00380      <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a128">REG_RNAT</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a128">REG_RNAT</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a128">REG_RNAT</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a123">REG_NATS</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a123">REG_NATS</a>, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a123">REG_NATS</a>};
00381 
00382 UCHAR
00383 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a155">NewParsePrologueRegionPhase0</a> (
00384     IN PUNWIND_CONTEXT UwContext,
00385     IN PSTATE_RECORD StateRecord,
00386     IN OUT PUCHAR AbiImmContext
00387     );
00388 
00389 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00390 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a156">NewParsePrologueRegionPhase1</a> (
00391     IN PUNWIND_CONTEXT UwContext,
00392     IN PSTATE_RECORD StateRecord
00393     );
00394 
00395 
00396 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00397"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a157">00397</a> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a157">SrInitialize</a> (
00398     IN PSTATE_RECORD_STACK StateTable,
00399     IN PSTATE_RECORD StateRecord,
00400     IN ULONG Size
00401     )
00402 {
00403     StateTable-&gt;Size = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00404     StateTable-&gt;Base = StateRecord;
00405     StateTable-&gt;Top = StateRecord;
00406     StateTable-&gt;Current = StateRecord;
00407     RtlZeroMemory(StateTable-&gt;Top, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d6/struct__STATE__RECORD.html">STATE_RECORD</a>));
00408 }
00409 
00410 
00411 ULONG
<a name="l00412"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">00412</a> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a> (
00413     IN PUCHAR Descriptors,
00414     IN OUT PULONG CurrentDescIndex
00415     )
00416 {
00417     PUCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00418     ULONG Value;
00419     ULONG ShiftCount = 7;
00420     ULONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00421 
00422     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = Descriptors + *CurrentDescIndex;
00423     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 1;
00424 
00425     Value = <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[0] &amp; 0x7F;
00426     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[0] &amp; 0x80) {
00427         <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00428             Value += ((<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>] &amp; 0x7F) &lt;&lt; ShiftCount);
00429             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>++] &amp; 0x80) {
00430                 ShiftCount += 7;
00431             } <span class="keywordflow">else</span> {
00432                 <span class="keywordflow">break</span>;
00433             }
00434         }
00435     }
00436 
00437     *CurrentDescIndex += <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00438 
00439     <span class="keywordflow">return</span> Value;
00440 }
00441 
00442 
00443 ULONGLONG
<a name="l00444"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a159">00444</a> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a159">RestorePreservedRegisterFromGR</a> (
00445     IN PCONTEXT Context,
00446     IN SHORT BsFrameSize,
00447     IN SHORT RNatSaveIndex,
00448     IN SHORT GrNumber,
00449 #ifdef _IMAGEHLP_SOURCE_
00450     IN HANDLE hProcess,
00451     IN PREAD_PROCESS_MEMORY_ROUTINE64 ReadMemory,
00452     OUT BOOL *Succeed,
00453 #<span class="keywordflow">else</span>
00454     OUT ULONG64 *SourceAddress,
00455 #endif <span class="comment">// _IMAGEHLP_SOURCE_</span>
00456     OUT PUCHAR Nat OPTIONAL
00457     )
00458 {
00459     ULONGLONG Result;
00460     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
00461     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> Temp;
00462 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00463 <span class="preprocessor"></span>    ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00464 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
00465 <span class="preprocessor"></span>
00466 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00467 <span class="preprocessor"></span>    *Succeed = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00468 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
00469 <span class="preprocessor"></span>
00470     <span class="keywordflow">if</span> (GrNumber &gt;= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a10">STATIC_REGISTER_SET_SIZE</a>) {
00471 
00472         <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = GrNumber - <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a10">STATIC_REGISTER_SET_SIZE</a>;
00473         <span class="keywordflow">if</span> ( <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> &lt; BsFrameSize ) {
00474 
00475             Temp = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> + RNatSaveIndex - NAT_BITS_PER_RNAT_REG;
00476             <span class="keywordflow">while</span> (Temp &gt;= 0) {
00477                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>++;
00478                 Temp -= NAT_BITS_PER_RNAT_REG;
00479             }
00480             <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> * <span class="keyword">sizeof</span>(ULONGLONG);
00481 
00482 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00483 <span class="preprocessor"></span>            *Succeed = ReadMemory(hProcess, Context-&gt;RsBSP + <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>,
00484                                   &amp;Result, <span class="keyword">sizeof</span>(ULONGLONG), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>);
00485 <span class="preprocessor">#else</span>
00486 <span class="preprocessor"></span>            *SourceAddress = (ULONG64)(Context-&gt;RsBSP + <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>);
00487             Result = *(PULONGLONG)(Context-&gt;RsBSP + <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>);
00488 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
00489 <span class="preprocessor"></span>
00490         } <span class="keywordflow">else</span> {
00491 
00492             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"ERROR: Invalid GR!\n"</span>));
00493         }
00494 
00495     } <span class="keywordflow">else</span> {
00496 
00497         <span class="keywordflow">if</span> (GrNumber == 0 || GrNumber == 12) {
00498 
00499             <span class="comment">//</span>
00500             <span class="comment">// Invalid GR number -&gt; Invalid Unwind Descriptor</span>
00501             <span class="comment">//</span>
00502 
00503             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"ERROR: Invalid GR!\n"</span>));
00504 
00505         } <span class="keywordflow">else</span> {
00506 
00507             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"WARNING: Target register is not a stacked GR!\n"</span>));
00508             <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = GrNumber - 1;
00509             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a0">NOT_IMAGEHLP</a>(*SourceAddress = (ULONG64)(&amp;Context-&gt;IntGp + <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>));
00510             Result = *(&amp;Context-&gt;IntGp + <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>);
00511 
00512 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00513 <span class="preprocessor"></span>            *Succeed = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00514 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
00515 <span class="preprocessor"></span>
00516         }
00517     }
00518 
00519     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(Nat)) {
00520 
00521         <span class="comment">//</span>
00522         <span class="comment">// TBD: Pick up the corresponding Nat bit</span>
00523         <span class="comment">//</span>
00524 
00525         *Nat = (UCHAR) 0;
00526 
00527     }
00528 
00529     <span class="keywordflow">return</span> (Result);
00530 }
00531 
00532 
00533 UCHAR
<a name="l00534"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a160">00534</a> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a160">ParseBodyRegionDescriptors</a> (
00535     IN PUNWIND_CONTEXT UnwindContext,
00536     IN PSTATE_RECORD_STACK StateTable,
00537     IN ULONG RegionLen
00538     )
00539 {
00540     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a143">LABEL</a> Label;
00541     UCHAR FirstByte;
00542     BOOLEAN EcountDefined;
00543     BOOLEAN CopyLabel;
00544     ULONG Ecount;
00545     ULONG SlotOffset;
00546     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a145">PSTATE_RECORD</a> StateTablePtr;
00547     PUCHAR Descriptors;
00548 
00549     CopyLabel = EcountDefined = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00550     Descriptors = UnwindContext-&gt;Descriptors;
00551 
00552     <span class="keywordflow">while</span> (UnwindContext-&gt;DescCount &lt; UnwindContext-&gt;Size) {
00553 
00554         FirstByte = Descriptors[UnwindContext-&gt;DescCount++];
00555 
00556         <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a41">B1_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a42">B1_PREFIX</a> ) {
00557 
00558             Label = (<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a143">LABEL</a>)(FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a44">B1_LABEL_MASK</a>);
00559             <span class="keywordflow">if</span> (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a43">B1_TYPE_MASK</a>) {
00560 
00561                 <span class="comment">//</span>
00562                 <span class="comment">// copy the entry state</span>
00563                 <span class="comment">//</span>
00564 
00565                 CopyLabel = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00566 
00567             } <span class="keywordflow">else</span> {
00568 
00569                 <span class="comment">//</span>
00570                 <span class="comment">// label the entry state</span>
00571                 <span class="comment">//</span>
00572 
00573                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a135">LABEL_REGION</a>(StateTable-&gt;Top, Label);
00574             }
00575 
00576             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Body region desc B1: copy=%d, label_num=%d\n"</span>,
00577                      FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a43">B1_TYPE_MASK</a> ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, Label));
00578 
00579         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a45">B2_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a46">B2_PREFIX</a> ) {
00580 
00581             Ecount = FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a47">B2_ECOUNT_MASK</a>;
00582             SlotOffset = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Descriptors, &amp;UnwindContext-&gt;DescCount);
00583             EcountDefined = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00584 
00585             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Epilog desc B2: ecount=%d, LEB128(slot)=%d\n"</span>,
00586                       Ecount, SlotOffset));
00587 
00588         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a48">B3_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a49">B3_PREFIX</a> ) {
00589 
00590             SlotOffset = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Descriptors, &amp;UnwindContext-&gt;DescCount);
00591             Ecount = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Descriptors, &amp;UnwindContext-&gt;DescCount);
00592             EcountDefined = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00593 
00594             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Epilog desc B3: ecount=%d, LEB128 val=%d\n"</span>,
00595                       Ecount, SlotOffset));
00596 
00597         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a50">B4_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a51">B4_PREFIX</a> ) {
00598 
00599             Label = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Descriptors, &amp;UnwindContext-&gt;DescCount);
00600 
00601             <span class="keywordflow">if</span> (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a52">B4_TYPE_MASK</a>) {
00602 
00603                 <span class="comment">//</span>
00604                 <span class="comment">// copy the entry state</span>
00605                 <span class="comment">//</span>
00606 
00607                 CopyLabel = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00608 
00609             } <span class="keywordflow">else</span> {
00610 
00611                 <span class="comment">//</span>
00612                 <span class="comment">// label the current top of stack</span>
00613                 <span class="comment">//</span>
00614 
00615                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a135">LABEL_REGION</a>(StateTable-&gt;Top, Label);
00616             }
00617 
00618             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Body region desc B4: copy=%d, label_num=%d\n"</span>,
00619                      FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a52">B4_TYPE_MASK</a>, Label));
00620 
00621         } <span class="keywordflow">else</span> {
00622 
00623             <span class="comment">//</span>
00624             <span class="comment">// Encounter another region header record</span>
00625             <span class="comment">//</span>
00626 
00627             <span class="keywordflow">break</span>;
00628         }
00629     }
00630 
00631     <span class="keywordflow">if</span> (CopyLabel) {
00632         StateTablePtr = StateTable-&gt;Top;
00633         <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00634             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a137">CHECK_LABEL</a>(StateTablePtr, Label)) {
00635                 StateTable-&gt;Current = StateTablePtr;
00636                 <span class="keywordflow">break</span>;
00637             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((StateTablePtr == StateTable-&gt;Base)) {
00638                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Undefined Label %d\n"</span>, Label));
00639                 <span class="keywordflow">break</span>;
00640             }
00641             StateTablePtr--;
00642         }
00643     }
00644 
00645     <span class="keywordflow">if</span> (EcountDefined) {
00646 
00647         Ecount++;    <span class="comment">// Ecount specifies additional level of prologue</span>
00648                      <span class="comment">// regions to undo (i.e. a value of 0 implies 1</span>
00649                      <span class="comment">// prologue region)</span>
00650 
00651         <span class="keywordflow">if</span> (UnwindContext-&gt;ActiveRegionFound == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00652             <span class="keywordflow">while</span> (Ecount-- &gt; 0) {
00653                 <span class="keywordflow">if</span> (StateTable-&gt;Current-&gt;Previous) {
00654                     StateTable-&gt;Current = StateTable-&gt;Current-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o0">Previous</a>;
00655                 }
00656 
00657 <span class="preprocessor">#if DBG</span>
00658 <span class="preprocessor"></span>                <span class="keywordflow">else</span> {
00659                     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"WARNING: Ecount is greater than the # of active prologues!\n"</span>));
00660                 }
00661 <span class="preprocessor">#endif // DBG</span>
00662 <span class="preprocessor"></span>
00663             }
00664         } <span class="keywordflow">else</span> {
00665 
00666             <span class="comment">//</span>
00667             <span class="comment">// control PC is in this body/epilog region</span>
00668             <span class="comment">//</span>
00669 
00670             <span class="keywordflow">if</span> ((UnwindContext-&gt;SlotCount + RegionLen - SlotOffset)
00671                     &lt;= UnwindContext-&gt;TargetSlot)
00672             {
00673                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a145">PSTATE_RECORD</a> SrPointer;
00674 
00675                 StateTable-&gt;Current-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o12">Ecount</a> = Ecount;
00676                 SrPointer = StateTable-&gt;Current;
00677                 <span class="keywordflow">while</span> (Ecount &gt; 0) {
00678 
00679                     <span class="keywordflow">if</span> (SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o0">Previous</a>) {
00680                         SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o12">Ecount</a> = Ecount;
00681                         SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o6">SpWhen</a> = 0;
00682                         SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o5">SpAdjustment</a> = 0;
00683                         SrPointer = SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o0">Previous</a>;
00684                     }
00685 
00686 <span class="preprocessor">#if DBG</span>
00687 <span class="preprocessor"></span>                    <span class="keywordflow">else</span> {
00688                         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"WARNING: Ecount is greater than the # of active prologues!\n"</span>));
00689                     }
00690 <span class="preprocessor">#endif // DBG</span>
00691 <span class="preprocessor"></span>                    Ecount--;
00692 
00693                 }
00694             }
00695         }
00696     }
00697 
00698     <span class="keywordflow">return</span> FirstByte;
00699 }
00700 
00701 
00702 ULONGLONG
<a name="l00703"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a161">00703</a> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a161">ProcessInterruptRegion</a> (
00704 #ifdef _IMAGEHLP_SOURCE_
00705     IN HANDLE hProcess,
00706     IN PREAD_PROCESS_MEMORY_ROUTINE64 ReadMemory,
00707 #<span class="keywordflow">else</span>
00708     IN PKNONVOLATILE_CONTEXT_POINTERS ContextPointers,
00709 #endif _IMAGEHLP_SOURCE_
00710     IN PUNWIND_CONTEXT UnwindContext,
00711     IN PCONTEXT Context,
00712     IN SHORT BsFrameSize,
00713     IN SHORT RNatSaveIndex,
00714     IN UCHAR AbiImmContext
00715     )
00716 {
00717     <span class="comment">//</span>
00718     <span class="comment">// no prologue descriptor in interrupt region.</span>
00719     <span class="comment">//</span>
00720 
00721     PCONTEXT PrevContext;
00722     ULONGLONG NextPc;
00723     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00724     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> TempFrameSize;
00725     BOOLEAN Success;
00726 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00727 <span class="preprocessor"></span>    ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00728 <span class="preprocessor">#else</span>
00729 <span class="preprocessor"></span>    PVOID *Source;
00730     PVOID Address;
00731 <span class="preprocessor">#endif _IMAGEHLP_SOURCE_</span>
00732 <span class="preprocessor"></span>
00733 
00734     <span class="keywordflow">if</span> (AbiImmContext != CONTEXT_FRAME) {
00735 
00736         PKTRAP_FRAME TrapFrame;
00737         PKEXCEPTION_FRAME ExFrame;
00738 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00739 <span class="preprocessor"></span>        KTRAP_FRAME TF;
00740         KEXCEPTION_FRAME ExF;
00741 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
00742 <span class="preprocessor"></span>
00743         TrapFrame = (PKTRAP_FRAME) Context-&gt;IntSp;
00744 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00745 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!ReadMemory(hProcess, Context-&gt;IntSp, &amp;TF, <span class="keyword">sizeof</span>(KTRAP_FRAME), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>))
00746         {
00747             <span class="keywordflow">return</span> 0;
00748         }
00749         TrapFrame = &amp;TF;
00750 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
00751 <span class="preprocessor"></span>
00752         Context-&gt;ApDCR = TrapFrame-&gt;ApDCR;
00753         Context-&gt;ApUNAT = TrapFrame-&gt;ApUNAT;
00754         Context-&gt;StFPSR = TrapFrame-&gt;StFPSR;
00755         Context-&gt;Preds = TrapFrame-&gt;Preds;
00756         Context-&gt;IntSp = TrapFrame-&gt;IntSp;
00757         Context-&gt;StIPSR = TrapFrame-&gt;StIPSR;
00758         Context-&gt;StIFS = TrapFrame-&gt;StIFS;
00759         Context-&gt;BrRp = TrapFrame-&gt;BrRp;
00760         Context-&gt;RsPFS = TrapFrame-&gt;RsPFS;
00761 
00762 <span class="preprocessor">#ifndef _IMAGEHLP_SOURCE_</span>
00763 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ContextPointers)) {
00764             ContextPointers-&gt;ApUNAT = &amp;TrapFrame-&gt;ApUNAT;
00765             ContextPointers-&gt;IntSp = &amp;TrapFrame-&gt;IntSp;
00766             ContextPointers-&gt;BrRp = &amp;TrapFrame-&gt;BrRp;
00767             ContextPointers-&gt;RsPFS = &amp;TrapFrame-&gt;RsPFS;
00768             ContextPointers-&gt;Preds = &amp;TrapFrame-&gt;Preds;
00769         }
00770 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
00771 <span class="preprocessor"></span>
00772         <span class="keywordflow">switch</span> (AbiImmContext) {
00773 
00774         <span class="keywordflow">case</span> SYSCALL_FRAME:
00775 
00776             <span class="comment">//</span>
00777             <span class="comment">// System Call Handler Frame</span>
00778             <span class="comment">//</span>
00779 
00780             BsFrameSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TrapFrame-&gt;StIFS &gt;&gt; PFS_SIZE_SHIFT);
00781             BsFrameSize &amp;= PFS_SIZE_MASK;
00782             <span class="keywordflow">break</span>;
00783 
00784         <span class="keywordflow">case</span> INTERRUPT_FRAME:
00785         <span class="keywordflow">case</span> EXCEPTION_FRAME:
00786 
00787             <span class="comment">//</span>
00788             <span class="comment">// External Interrupt Frame / Exception Frame</span>
00789             <span class="comment">//</span>
00790 
00791             BsFrameSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)TrapFrame-&gt;StIFS &amp; PFS_SIZE_MASK;
00792             <span class="keywordflow">break</span>;
00793 
00794         <span class="keywordflow">default</span>:
00795 
00796             <span class="keywordflow">break</span>;
00797         }
00798 
00799         RNatSaveIndex = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(TrapFrame-&gt;RsBSP &gt;&gt; 3) &amp; NAT_BITS_PER_RNAT_REG;
00800         TempFrameSize = BsFrameSize - RNatSaveIndex;
00801         <span class="keywordflow">while</span> (TempFrameSize &gt; 0) {
00802             BsFrameSize++;
00803             TempFrameSize -= NAT_BITS_PER_RNAT_REG;
00804         }
00805 
00806         Context-&gt;RsBSP = TrapFrame-&gt;RsBSP - BsFrameSize * <span class="keyword">sizeof</span>(ULONGLONG);
00807         Context-&gt;RsBSPSTORE = Context-&gt;RsBSP;
00808         Context-&gt;RsRNAT = TrapFrame-&gt;RsRNAT;
00809 
00810         NextPc = RtlIa64InsertIPSlotNumber(TrapFrame-&gt;StIIP,
00811                      ((TrapFrame-&gt;StIPSR &gt;&gt; PSR_RI) &amp; 0x3));
00812 
00813         <span class="keywordflow">return</span> (NextPc);
00814     }
00815 
00816     <span class="comment">//</span>
00817     <span class="comment">// Kernel-to-User thunk, context of the previous frame can be</span>
00818     <span class="comment">// found on the user stack (i.e. context's address = sp+SCRATCH_AREA)</span>
00819     <span class="comment">//</span>
00820 
00821     PrevContext = (PCONTEXT)(Context-&gt;IntSp + STACK_SCRATCH_AREA);
00822 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00823 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!ReadMemory(hProcess, (DWORD64)PrevContext, Context, <span class="keyword">sizeof</span>(CONTEXT), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>))
00824     {
00825         <span class="keywordflow">return</span> 0;
00826     }
00827     NextPc = RtlIa64InsertIPSlotNumber(Context-&gt;StIIP,
00828                                        ((Context-&gt;StIPSR &gt;&gt; PSR_RI) &amp; 0x3));
00829 <span class="preprocessor">#else</span>
00830 <span class="preprocessor"></span>
00831     RtlCopyMemory(&amp;Context-&gt;BrRp, &amp;PrevContext-&gt;BrRp,
00832                   (<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a113">NUMBER_OF_PRESERVED_BR</a>+1) * <span class="keyword">sizeof</span>(ULONGLONG));
00833     RtlCopyMemory(&amp;Context-&gt;FltS0, &amp;PrevContext-&gt;FltS0,
00834                   <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a106">NUMBER_OF_LOW_PRESERVED_FR</a> * <span class="keyword">sizeof</span>(FLOAT128));
00835     RtlCopyMemory(&amp;Context-&gt;FltS4, &amp;PrevContext-&gt;FltS4,
00836                   <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a109">NUMBER_OF_HIGH_PRESERVED_FR</a> * <span class="keyword">sizeof</span>(FLOAT128));
00837     RtlCopyMemory(&amp;Context-&gt;IntS0, &amp;PrevContext-&gt;IntS0,
00838                   <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a103">NUMBER_OF_PRESERVED_GR</a> * <span class="keyword">sizeof</span>(ULONGLONG));
00839 
00840     Context-&gt;IntSp = PrevContext-&gt;IntSp;
00841     Context-&gt;IntNats = PrevContext-&gt;IntNats;
00842     Context-&gt;ApUNAT = PrevContext-&gt;ApUNAT;
00843     Context-&gt;ApLC = PrevContext-&gt;ApLC;
00844     Context-&gt;ApEC = PrevContext-&gt;ApEC;
00845     Context-&gt;Preds = PrevContext-&gt;Preds;
00846     Context-&gt;RsPFS = PrevContext-&gt;RsPFS;
00847     Context-&gt;RsBSP = PrevContext-&gt;RsBSP;
00848     Context-&gt;RsBSPSTORE = PrevContext-&gt;RsBSPSTORE;
00849     Context-&gt;RsRSC = PrevContext-&gt;RsRSC;
00850     Context-&gt;RsRNAT = PrevContext-&gt;RsRNAT;
00851     Context-&gt;StIFS = PrevContext-&gt;StIFS;
00852     Context-&gt;StIPSR = PrevContext-&gt;StIPSR;
00853     NextPc = RtlIa64InsertIPSlotNumber(PrevContext-&gt;StIIP,
00854                  ((PrevContext-&gt;StIPSR &gt;&gt; PSR_RI) &amp; 0x3));
00855 
00856 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
00857 <span class="preprocessor"></span>
00858     <span class="keywordflow">return</span>(NextPc);
00859 }
00860 
00861 
00862 ULONGLONG
<a name="l00863"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a162">00863</a> <a class="code" href="../../d0/d7/ppc_2vunwind_8c.html#a38">RtlVirtualUnwind</a> (
00864 #ifdef _IMAGEHLP_SOURCE_
00865     HANDLE hProcess,
00866     ULONGLONG ImageBase,
00867     ULONGLONG ControlPc,
00868     PRUNTIME_FUNCTION FunctionEntry,
00869     PCONTEXT ContextRecord,
00870     PREAD_PROCESS_MEMORY_ROUTINE64 ReadMemory
00871 #define ContextPointers ((PKNONVOLATILE_CONTEXT_POINTERS)0)
00872 #<span class="keywordflow">else</span>
00873     IN ULONGLONG ImageBase,
00874     IN ULONGLONG ControlPc,
00875     IN PRUNTIME_FUNCTION FunctionEntry,
00876     IN OUT PCONTEXT ContextRecord,
00877     OUT PBOOLEAN InFunction,
00878     OUT PFRAME_POINTERS EstablisherFrame,
00879     IN OUT PKNONVOLATILE_CONTEXT_POINTERS ContextPointers OPTIONAL
00880 #endif
00881     )
00882 
00883 <span class="comment">/*++</span>
00884 <span class="comment"></span>
00885 <span class="comment">Routine Description:</span>
00886 <span class="comment"></span>
00887 <span class="comment">    This function virtually unwinds the specfified function by executing its</span>
00888 <span class="comment">    prologue code backwards.</span>
00889 <span class="comment"></span>
00890 <span class="comment">    If the function is a leaf function, then the address where control left</span>
00891 <span class="comment">    the previous frame is obtained from the context record. If the function</span>
00892 <span class="comment">    is a nested function, but not an exception or interrupt frame, then the</span>
00893 <span class="comment">    prologue code is executed backwards and the address where control left</span>
00894 <span class="comment">    the previous frame is obtained from the updated context record.</span>
00895 <span class="comment"></span>
00896 <span class="comment">    Otherwise, an exception or interrupt entry to the system is being unwound</span>
00897 <span class="comment">    and an especially coded prologue restores the return address twice. Once</span>
00898 <span class="comment">    from the fault instruction address and once from the saved return address</span>
00899 <span class="comment">    register. The first restore is returned as the function value and the</span>
00900 <span class="comment">    second restore is placed in the updated context record.</span>
00901 <span class="comment"></span>
00902 <span class="comment">    If a context pointers record is specified, then the address where each</span>
00903 <span class="comment">    nonvolatile registers is restored from is recorded in the appropriate</span>
00904 <span class="comment">    element of the context pointers record.</span>
00905 <span class="comment"></span>
00906 <span class="comment">Arguments:</span>
00907 <span class="comment"></span>
00908 <span class="comment">    ImageBase - Supplies the base address of the module to which the</span>
00909 <span class="comment">        function belongs.</span>
00910 <span class="comment"></span>
00911 <span class="comment">    ControlPc - Supplies the address where control left the specified</span>
00912 <span class="comment">        function.</span>
00913 <span class="comment"></span>
00914 <span class="comment">    FunctionEntry - Supplies the address of the function table entry for the</span>
00915 <span class="comment">        specified function.</span>
00916 <span class="comment"></span>
00917 <span class="comment">    ContextRecord - Supplies the address of a context record.</span>
00918 <span class="comment"></span>
00919 <span class="comment">    InFunction - Supplies a pointer to a variable that receives whether the</span>
00920 <span class="comment">        control PC is within the current function.</span>
00921 <span class="comment"></span>
00922 <span class="comment">    EstablisherFrame - Supplies a pointer to a variable that receives the</span>
00923 <span class="comment">        the establisher frame pointer value.</span>
00924 <span class="comment"></span>
00925 <span class="comment">    ContextPointers - Supplies an optional pointer to a context pointers</span>
00926 <span class="comment">        record.</span>
00927 <span class="comment"></span>
00928 <span class="comment">Return Value:</span>
00929 <span class="comment"></span>
00930 <span class="comment">    The address where control left the previous frame is returned as the</span>
00931 <span class="comment">    function value.</span>
00932 <span class="comment"></span>
00933 <span class="comment">--*/</span>
00934 
00935 {
00936 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00937 <span class="preprocessor"></span>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Succeed;
00938 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
00939 <span class="preprocessor"></span>    PUCHAR Descriptors = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00940     UCHAR AbiImmContext = 0xFF;
00941     ULONG Mask;
00942     ULONGLONG NextPc;
00943     ULONG RegionLen;
00944     UCHAR FirstByte;
00945     UCHAR Nat;
00946     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> BsFrameSize;                  <span class="comment">// in 8-byte units</span>
00947     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> LocalFrameSize;                  <span class="comment">// in 8-byte units</span>
00948     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> TempFrameSize;                <span class="comment">// in 8-byte units</span>
00949     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> RNatSaveIndex;
00950     ULONG i;
00951     PULONG <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00952     BOOLEAN IsPrologueRegion;
00953     BOOLEAN PspRestored;
00954     ULONGLONG PreviousIntSp;
00955     PVOID Destination;
00956     ULONG64 Source;
00957     ULONG64 *CtxPtr;
00958     ULONG64 *NatCtxPtr;
00959     ULONG64 IntNatsSource;
00960     ULONG64 IntNats;
00961     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00962     ULONGLONG OldTopRnat;
00963     ULONGLONG NewTopRnat;
00964     UNWIND_INFO UnwindInfo;
00965     ULONG64 UnwindInfoPtr;
00966     <a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html">UNWIND_CONTEXT</a> UnwindContext;
00967     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a145">PSTATE_RECORD</a> SrPointer;
00968     <a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html">STATE_RECORD_STACK</a> StateTable;
00969     <a class="code" href="../../d1/d6/struct__STATE__RECORD.html">STATE_RECORD</a> StateRecords[<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a6">STATE_RECORD_STACK_SIZE</a>];
00970 
00971 
00972     BsFrameSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)ContextRecord-&gt;StIFS &amp; PFS_SIZE_MASK;
00973     RNatSaveIndex = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ContextRecord-&gt;RsBSP &gt;&gt; 3) &amp; NAT_BITS_PER_RNAT_REG;
00974     TempFrameSize = RNatSaveIndex + BsFrameSize - NAT_BITS_PER_RNAT_REG;
00975     <span class="keywordflow">while</span> (TempFrameSize &gt;= 0) {
00976         BsFrameSize++;
00977         TempFrameSize -= NAT_BITS_PER_RNAT_REG;
00978     }
00979 
00980     UnwindInfoPtr = ImageBase + FunctionEntry-&gt;UnwindInfoAddress;
00981 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
00982 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!ReadMemory( hProcess, (ULONG64)UnwindInfoPtr,
00983                      &amp;UnwindInfo, <span class="keyword">sizeof</span>(UNWIND_INFO), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>))
00984     {
00985         <span class="keywordflow">return</span> 0;
00986     }
00987 
00988     UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o4">Version</a> = UnwindInfo.Version;
00989     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = UnwindInfo.DataLength * <span class="keyword">sizeof</span>(ULONGLONG);
00990     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
00991         Descriptors = (PUCHAR) <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>);
00992         <span class="keywordflow">if</span> (!ReadMemory(hProcess,(ULONG64)(UnwindInfoPtr+<span class="keyword">sizeof</span>(UNWIND_INFO)), Descriptors, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>, &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>)) {
00993             <span class="keywordflow">return</span> 0;
00994         }
00995     }
00996 <span class="preprocessor">#else</span>
00997 <span class="preprocessor"></span>    UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o4">Version</a> = ((PUNWIND_INFO)UnwindInfoPtr)-&gt;Version;
00998     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = ((PUNWIND_INFO)UnwindInfoPtr)-&gt;DataLength * <span class="keyword">sizeof</span>(ULONGLONG);
00999     Descriptors = (PUCHAR)UnwindInfoPtr + <span class="keyword">sizeof</span>(UNWIND_INFO);
01000 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01001 <span class="preprocessor"></span>
01002     UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o6">Size</a> = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
01003     UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o3">ActiveRegionFound</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01004     UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">DescCount</a> = 0;
01005     UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o9">SlotCount</a> = 0;
01006     UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o8">TargetSlot</a> = (ULONG)(((ControlPc - FunctionEntry-&gt;BeginAddress - ImageBase) &gt;&gt; 4) * <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a11">SLOTS_PER_BUNDLE</a> + ((ControlPc &gt;&gt; 2) &amp; 0x3));
01007     UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o5">Descriptors</a> = Descriptors;
01008 
01009     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a157">SrInitialize</a>(&amp;StateTable, StateRecords, <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a6">STATE_RECORD_STACK_SIZE</a>);
01010 
01011     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
01012         FirstByte = Descriptors[UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">DescCount</a>++];
01013     }
01014 
01015 
01016     <span class="keywordflow">while</span> ( (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">DescCount</a> &lt; UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o6">Size</a>) &amp;&amp;
01017             (!UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o3">ActiveRegionFound</a>) )
01018     {
01019 
01020         <span class="comment">//</span>
01021         <span class="comment">// Assume a prologue region but not an interrupt region.</span>
01022         <span class="comment">//</span>
01023 
01024         IsPrologueRegion = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01025 
01026         <span class="comment">//</span>
01027         <span class="comment">// Based on the type of region header, dispatch</span>
01028         <span class="comment">// to the corresponding routine that processes</span>
01029         <span class="comment">// the succeeding descriptors until the next</span>
01030         <span class="comment">// region header record.</span>
01031         <span class="comment">//</span>
01032 
01033         <span class="keywordflow">if</span> ((FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a12">R1_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a13">R1_PREFIX</a>) {
01034 
01035             <span class="comment">//</span>
01036             <span class="comment">// region header record in short format</span>
01037             <span class="comment">//</span>
01038 
01039             RegionLen = FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a15">R1_LENGTH_MASK</a>;
01040 
01041             <span class="keywordflow">if</span> (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a14">R1_REGION_TYPE_MASK</a>) {
01042                 IsPrologueRegion = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01043             } <span class="keywordflow">else</span> {
01044                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a133">ADD_STATE_RECORD</a>(StateTable, RegionLen, UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">DescCount</a>);
01045             }
01046 
01047             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Region R1 format: body=%x, length=%d\n"</span>,
01048                      IsPrologueRegion ? 0 : 1, RegionLen));
01049 
01050         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a16">R2_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a17">R2_PREFIX</a>) {
01051 
01052             <span class="comment">//</span>
01053             <span class="comment">// general prologue region header</span>
01054             <span class="comment">// N.B. Skip the 2nd byte of the header and proceed to read</span>
01055             <span class="comment">//      the region length; the header descriptors will be</span>
01056             <span class="comment">//      processed again in phase 1.</span>
01057             <span class="comment">//</span>
01058 
01059             ULONG R2DescIndex;
01060 
01061             R2DescIndex = UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">DescCount</a> - 1;
01062             UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">DescCount</a>++;
01063             RegionLen = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Descriptors, &amp;UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">DescCount</a>);
01064             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a133">ADD_STATE_RECORD</a>(StateTable, RegionLen, R2DescIndex);
01065             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Region R2: body=0, length=%d\n"</span>, RegionLen));
01066 
01067         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a18">R3_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a19">R3_PREFIX</a>) {
01068 
01069             <span class="comment">//</span>
01070             <span class="comment">// region header record in long format</span>
01071             <span class="comment">//</span>
01072 
01073             RegionLen = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Descriptors, &amp;UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">DescCount</a>);
01074 
01075             <span class="keywordflow">switch</span> (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a20">R3_REGION_TYPE_MASK</a>) {
01076 
01077             <span class="keywordflow">case</span> 0:      <span class="comment">// prologue region header</span>
01078 
01079                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a133">ADD_STATE_RECORD</a>(StateTable, RegionLen, UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o7">DescCount</a>);
01080                 <span class="keywordflow">break</span>;
01081 
01082             <span class="keywordflow">case</span> 1:      <span class="comment">// body region header</span>
01083 
01084                 IsPrologueRegion = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01085                 <span class="keywordflow">break</span>;
01086 
01087             }
01088 
01089             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Region R3: body=%x, length=%d\n"</span>,
01090                       IsPrologueRegion ? 0 : 1, RegionLen));
01091 
01092         } <span class="keywordflow">else</span> {
01093 
01094             <span class="comment">//</span>
01095             <span class="comment">// Not a region header record -&gt; Invalid unwind descriptor.</span>
01096             <span class="comment">//</span>
01097 
01098             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Invalid unwind descriptor!\n"</span>));
01099 
01100         }
01101 
01102         <span class="keywordflow">if</span> (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o8">TargetSlot</a> &lt; (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o9">SlotCount</a> + RegionLen)) {
01103             UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o3">ActiveRegionFound</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01104             StateTable.<a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o1">Current</a>-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o1">IsTarget</a> = IsPrologueRegion;
01105         }
01106 
01107         <span class="keywordflow">if</span> (IsPrologueRegion) {
01108             FirstByte = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a155">NewParsePrologueRegionPhase0</a>(&amp;UnwindContext,
01109                                                      StateTable.<a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o1">Current</a>,
01110                                                      &amp;AbiImmContext);
01111         } <span class="keywordflow">else</span> {
01112             FirstByte = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a160">ParseBodyRegionDescriptors</a>(&amp;UnwindContext,
01113                                                    &amp;StateTable,
01114                                                    RegionLen);
01115         }
01116 
01117         UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o9">SlotCount</a> += RegionLen;
01118     }
01119 
01120     <span class="comment">//</span>
01121     <span class="comment">// Restore the value of psp and save the current NatCr.</span>
01122     <span class="comment">// N.B. If the value is restored from stack/bstore, turn off the</span>
01123     <span class="comment">//      corresponding sp bit in the saved mask associated with the</span>
01124     <span class="comment">//      prologue region in which psp is saved.</span>
01125     <span class="comment">//</span>
01126 
01127     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ContextPointers)) {
01128         IntNatsSource = (ULONG64)ContextPointers-&gt;ApUNAT;
01129     } 
01130     IntNats = ContextRecord-&gt;ApUNAT;
01131     PreviousIntSp = ContextRecord-&gt;IntSp;
01132     PspRestored = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01133 
01134     SrPointer = StateTable.<a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o1">Current</a>;
01135     <span class="keywordflow">while</span> (SrPointer != StateTable.<a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o3">Base</a>) {
01136         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a156">NewParsePrologueRegionPhase1</a>(&amp;UnwindContext, SrPointer);
01137 
01138         <span class="keywordflow">if</span> (SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o3">MiscMask</a> &amp; (1 &lt;&lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">REG_SP</a>)) {
01139             <span class="keywordflow">if</span> (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">REG_SP</a>].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o0">Where</a> == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a129">GENERAL_REG</a>) {
01140                 PreviousIntSp = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a159">RestorePreservedRegisterFromGR</a> (
01141                                     ContextRecord,
01142                                     BsFrameSize,
01143                                     RNatSaveIndex,
01144                                     (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">REG_SP</a>].SaveOffset,
01145 #ifdef _IMAGEHLP_SOURCE_
01146                                     hProcess,
01147                                     ReadMemory,
01148                                     &amp;Succeed,
01149 #<span class="keywordflow">else</span>
01150                                     &amp;Source,
01151 #endif <span class="comment">// _IMAGEHLP_SOURCE_</span>
01152                                     &amp;Nat
01153                                     );
01154 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01155 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (!Succeed) {
01156                     <span class="keywordflow">return</span> 0;
01157                 }
01158 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01159 <span class="preprocessor"></span>
01160             } <span class="keywordflow">else</span> {
01161 
01162                 Source = ContextRecord-&gt;IntSp + UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">REG_SP</a>].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a>*4;
01163 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01164 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (!ReadMemory(hProcess, (ULONG64)(Source), &amp;PreviousIntSp, <span class="keyword">sizeof</span>(ULONGLONG), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>)) {
01165                     <span class="keywordflow">return</span> 0;
01166                 }
01167 <span class="preprocessor">#else</span>
01168 <span class="preprocessor"></span>                PreviousIntSp = *(PULONGLONG)Source;
01169 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01170 <span class="preprocessor"></span>                <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a138">EXTRACT_NAT_FROM_UNAT</a>(Nat);
01171 
01172             }
01173             ContextRecord-&gt;IntNats &amp;= ~(0x1 &lt;&lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a100">STACK_POINTER_GR</a>);
01174             ContextRecord-&gt;IntNats |= (Nat &lt;&lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a100">STACK_POINTER_GR</a>);
01175             SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o3">MiscMask</a> &amp;= ~(1 &lt;&lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">REG_SP</a>);
01176             <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ContextPointers)) {
01177                 CtxPtr = (ULONG64 *)((ULONG_PTR)ContextPointers +
01178                                    <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a151">MiscContextPointersOffset</a>[<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a118">REG_SP</a>]);
01179                 *CtxPtr = Source;
01180             }
01181             PspRestored = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01182         }
01183         <span class="keywordflow">if</span> (PspRestored == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01184             PreviousIntSp += SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o5">SpAdjustment</a> * 4;
01185         }
01186         SrPointer = SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o0">Previous</a>;
01187     }
01188 
01189     <span class="keywordflow">if</span> (AbiImmContext != 0xFF) {
01190 
01191         ContextRecord-&gt;IntSp = PreviousIntSp;  <span class="comment">// trap/context frame address</span>
01192         NextPc = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a161">ProcessInterruptRegion</a>(
01193 #ifdef _IMAGEHLP_SOURCE_
01194                      hProcess,
01195                      ReadMemory,
01196 #<span class="keywordflow">else</span>
01197                      ContextPointers,
01198 #endif _IMAGEHLP_SOURCE_
01199                      &amp;UnwindContext,
01200                      ContextRecord,
01201                      BsFrameSize,
01202                      RNatSaveIndex,
01203                      AbiImmContext);
01204 
01205         <span class="keywordflow">goto</span> FastExit;
01206     }
01207 
01208     <span class="comment">//</span>
01209     <span class="comment">// Restore the contents of any preserved registers saved in this frame.</span>
01210     <span class="comment">//</span>
01211 
01212     SrPointer = StateTable.<a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o1">Current</a>;
01213     <span class="keywordflow">while</span> (SrPointer != StateTable.<a class="code" href="../../d2/d6/struct__STATE__RECORD__STACK.html#o3">Base</a>) {
01214 
01215         Mask = SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o3">MiscMask</a>;
01216         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"MiscMask = 0x%x\n"</span>, Mask));
01217 
01218         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a115">NUMBER_OF_PRESERVED_REGISTERS</a>; i++) {
01219             Destination = (PVOID)((ULONG_PTR)ContextRecord + <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a150">MiscContextOffset</a>[i]);
01220             <span class="keywordflow">if</span> (Mask &amp; 0x1) {
01221 
01222                 <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ContextPointers)) {
01223                     CtxPtr = (ULONG64 *)((ULONG_PTR)ContextPointers +
01224                                        <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a151">MiscContextPointersOffset</a>[i]);
01225                     Source = *CtxPtr;
01226                 }
01227 
01228                 <span class="keywordflow">if</span> (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o0">Where</a> == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a129">GENERAL_REG</a>) {
01229 
01230                     *(PULONGLONG)Destination =
01231                         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a159">RestorePreservedRegisterFromGR</a> (
01232                             ContextRecord,
01233                             BsFrameSize,
01234                             RNatSaveIndex,
01235                             (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a>,
01236 #ifdef _IMAGEHLP_SOURCE_
01237                             hProcess,
01238                             ReadMemory,
01239                             &amp;Succeed,
01240 #<span class="keywordflow">else</span>
01241                             &amp;Source,
01242 #endif <span class="comment">// _IMAGEHLP_SOURCE_</span>
01243                             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01244                             );
01245 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01246 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (!Succeed) {
01247                         <span class="keywordflow">return</span> 0;
01248                     }
01249 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01250 <span class="preprocessor"></span>
01251                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o0">Where</a> == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a132">BRANCH_REG</a>) {
01252 
01253                     <span class="comment">//</span>
01254                     <span class="comment">// restore return pointer from branch register</span>
01255                     <span class="comment">//</span>
01256 
01257                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
01258 
01259                     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a>-<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a111">FIRST_PRESERVED_BR</a>;
01260                     Source = (ULONG64)(&amp;ContextRecord-&gt;BrS0 + <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>);
01261 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01262 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (!ReadMemory(hProcess, (ULONG64)(Source), Destination, <span class="keyword">sizeof</span>(ULONGLONG), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>)) {
01263                         <span class="keywordflow">return</span> 0;
01264                     }
01265 <span class="preprocessor">#else</span>
01266 <span class="preprocessor"></span>                    *(PULONGLONG)Destination = *(PULONGLONG)(Source);
01267 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01268 <span class="preprocessor"></span>
01269                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o0">Where</a> == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a130">PSP_RELATIVE</a>) {
01270 
01271                     <span class="keywordflow">if</span> ((SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o12">Ecount</a> == 0) || (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a> &lt;= (STACK_SCRATCH_AREA/<span class="keyword">sizeof</span>(ULONG)))) {
01272                         Source = PreviousIntSp + STACK_SCRATCH_AREA
01273                                      - UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a>*4;
01274 
01275                         <span class="keywordflow">if</span> (i == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a123">REG_NATS</a>) {
01276                             Destination = (PVOID)&amp;IntNats;
01277                             IntNatsSource = Source;
01278                         }
01279 
01280 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01281 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (!ReadMemory(hProcess, (ULONG64)(Source), Destination, <span class="keyword">sizeof</span>(ULONGLONG), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>)) {
01282                             <span class="keywordflow">return</span> 0;
01283                         }
01284 <span class="preprocessor">#else</span>
01285 <span class="preprocessor"></span>                        *(PULONGLONG)Destination = *(PULONGLONG)(Source);
01286 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01287 <span class="preprocessor"></span>                    }
01288 
01289                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o0">Where</a> == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a131">SP_RELATIVE</a>) {
01290 
01291                     <span class="comment">//</span>
01292                     <span class="comment">// Make the necessary adjustment depending on whether</span>
01293                     <span class="comment">// the preserved register is saved before or after the</span>
01294                     <span class="comment">// stack pointer has been adjusted in this prologue.</span>
01295                     <span class="comment">//</span>
01296 
01297                     <span class="keywordflow">if</span> (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o2">When</a> &gt;= SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o6">SpWhen</a>)
01298                         Source = ContextRecord-&gt;IntSp
01299                                      + UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a>*4;
01300                     <span class="keywordflow">else</span>
01301                         Source = ContextRecord-&gt;IntSp+SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o5">SpAdjustment</a>*4
01302                                      + UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o0">MiscRegs</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a>*4;
01303 
01304                         <span class="keywordflow">if</span> (i == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a123">REG_NATS</a>) {
01305                             Destination = (PVOID)&amp;IntNats;
01306                             IntNatsSource = Source;
01307                         }
01308 
01309 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01310 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (!ReadMemory(hProcess, (ULONG64)(Source), Destination, <span class="keyword">sizeof</span>(ULONGLONG), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>)) {
01311                         <span class="keywordflow">return</span> 0;
01312                     }
01313 <span class="preprocessor">#else</span>
01314 <span class="preprocessor"></span>                    *(PULONGLONG)Destination = *(PULONGLONG)(Source);
01315 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01316 <span class="preprocessor"></span>                }
01317 
01318                 <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ContextPointers) &amp;&amp; (i != <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a123">REG_NATS</a>)) {
01319                     *CtxPtr = Source;
01320                 }
01321 
01322             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Mask == 0) {
01323 
01324                 <span class="comment">//</span>
01325                 <span class="comment">// No more registers to restore</span>
01326                 <span class="comment">//</span>
01327 
01328                 <span class="keywordflow">break</span>;
01329             }
01330 
01331             Mask = Mask &gt;&gt; 1;
01332         }
01333 
01334         <span class="comment">//</span>
01335         <span class="comment">// Restore preserved FRs (f2 - f5, f16 - f31)</span>
01336         <span class="comment">//</span>
01337 
01338         Mask = SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o4">FrMask</a>;
01339         Destination = (PVOID)&amp;ContextRecord-&gt;FltS0;
01340         CtxPtr = (ULONG64 *)&amp;ContextPointers-&gt;FltS0;
01341 
01342         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"FrMask = 0x%x\n"</span>, Mask));
01343         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a110">NUMBER_OF_PRESERVED_FR</a>; i++) {
01344             <span class="keywordflow">if</span> (Mask &amp; 0x1) {
01345 
01346                 <span class="keywordflow">if</span> ((SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o12">Ecount</a> == 0) || (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o1">Float</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a> &lt;= (STACK_SCRATCH_AREA/<span class="keyword">sizeof</span>(ULONG)))) {
01347                     Source = PreviousIntSp + STACK_SCRATCH_AREA
01348                                  - UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o1">Float</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a>*4;
01349 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01350 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (!ReadMemory(hProcess, (ULONG64)(Source), Destination, <span class="keyword">sizeof</span>(FLOAT128), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>)) {
01351                         <span class="keywordflow">return</span> 0;
01352                     }
01353 <span class="preprocessor">#else</span>
01354 <span class="preprocessor"></span>                    *(FLOAT128 *)Destination = *(FLOAT128 *)Source;
01355 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01356 <span class="preprocessor"></span>
01357                     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ContextPointers)) {
01358                         *CtxPtr = Source;
01359                     }
01360                 }
01361 
01362             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Mask == 0) {
01363                 <span class="keywordflow">break</span>;
01364             }
01365 
01366             Mask = Mask &gt;&gt; 1;
01367 
01368             <span class="keywordflow">if</span> (i == (<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a106">NUMBER_OF_LOW_PRESERVED_FR</a> - 1)) {
01369                 Destination = (PVOID)&amp;ContextRecord-&gt;FltS4;
01370                 CtxPtr = (ULONG64 *)(&amp;ContextPointers-&gt;FltS4);
01371             } <span class="keywordflow">else</span> {
01372                 Destination = (PVOID)((FLOAT128 *)Destination+1);
01373                 CtxPtr++;
01374             }
01375         }
01376 
01377         <span class="comment">//</span>
01378         <span class="comment">// Restore preserved GRs (r4 - r7)</span>
01379         <span class="comment">//</span>
01380 
01381         Mask = SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o2">GrMask</a>;
01382         Destination = (PVOID)&amp;ContextRecord-&gt;IntS0;
01383         CtxPtr = (ULONG64 *)&amp;ContextPointers-&gt;IntS0;
01384         NatCtxPtr = (ULONG64 *)&amp;ContextPointers-&gt;IntS0Nat;
01385 
01386         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"GrMask = 0x%x\n"</span>, Mask));
01387         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a103">NUMBER_OF_PRESERVED_GR</a>; i++)
01388         {
01389             <span class="keywordflow">if</span> (Mask &amp; 0x1) {
01390 
01391                 <span class="keywordflow">if</span> ((SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o12">Ecount</a> == 0) || (UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o2">Integer</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a> &lt;= (STACK_SCRATCH_AREA/<span class="keyword">sizeof</span>(ULONG)))) {
01392                     Source = PreviousIntSp + STACK_SCRATCH_AREA
01393                                  - UnwindContext.<a class="code" href="../../d1/d4/struct__UNWIND__CONTEXT.html#o2">Integer</a>[i].<a class="code" href="../../d2/d3/struct__REGISTER__RECORD.html#o1">SaveOffset</a>*4;
01394 
01395 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01396 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (!ReadMemory(hProcess, (ULONG64)(Source), Destination, <span class="keyword">sizeof</span>(ULONGLONG), &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>)) {
01397                         <span class="keywordflow">return</span> 0;
01398                     }
01399 <span class="preprocessor">#else</span>
01400 <span class="preprocessor"></span>                    *(PULONGLONG)Destination = *(PULONGLONG)Source;
01401 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01402 <span class="preprocessor"></span>                    <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a138">EXTRACT_NAT_FROM_UNAT</a>(Nat);
01403                     Nat = (UCHAR)((IntNats &gt;&gt; (((ULONG_PTR)Source &amp; 0x1F8) &gt;&gt; 3)) &amp; 0x1);
01404                     ContextRecord-&gt;IntNats &amp;= ~(0x1 &lt;&lt; (i+<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a101">FIRST_PRESERVED_GR</a>));
01405                     ContextRecord-&gt;IntNats |= (Nat &lt;&lt; (i+<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a101">FIRST_PRESERVED_GR</a>));
01406 
01407 <span class="preprocessor">#ifndef _IMAGEHLP_SOURCE_</span>
01408 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ContextPointers)) {
01409                         *CtxPtr = Source;
01410                         *NatCtxPtr = IntNatsSource;
01411                     }
01412 <span class="preprocessor">#endif</span>
01413 <span class="preprocessor"></span>                }
01414 
01415             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Mask == 0) {
01416                 <span class="keywordflow">break</span>;
01417             }
01418 
01419             Mask = Mask &gt;&gt; 1;
01420             Destination = (PVOID)((PULONGLONG)Destination+1);
01421             CtxPtr++;
01422             NatCtxPtr++;
01423         }
01424 
01425         ContextRecord-&gt;IntSp += SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o5">SpAdjustment</a> * 4;
01426         SrPointer = SrPointer-&gt;<a class="code" href="../../d1/d6/struct__STATE__RECORD.html#o0">Previous</a>;
01427     }
01428 
01429     ContextRecord-&gt;IntSp = PreviousIntSp;
01430 
01431     <span class="comment">//</span>
01432     <span class="comment">// Restore the value of the epilogue count from the PFS</span>
01433     <span class="comment">//</span>
01434 
01435     ContextRecord-&gt;ApEC = (ContextRecord-&gt;RsPFS &gt;&gt; PFS_EC_SHIFT) &amp;
01436                                ~(((ULONGLONG)1 &lt;&lt; PFS_EC_SIZE) - 1);
01437     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ContextPointers)) {
01438         ContextPointers-&gt;ApEC = ContextPointers-&gt;RsPFS;
01439     }
01440 
01441 
01442 FastExit:
01443 
01444     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a0">NOT_IMAGEHLP</a>(*InFunction = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01445     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a0">NOT_IMAGEHLP</a>(EstablisherFrame-&gt;MemoryStackFp = ContextRecord-&gt;IntSp);
01446     <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a0">NOT_IMAGEHLP</a>(EstablisherFrame-&gt;BackingStoreFp = ContextRecord-&gt;RsBSP);
01447 
01448 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01449 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Descriptors)
01450         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(Descriptors);
01451 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01452 <span class="preprocessor"></span>
01453     <span class="keywordflow">if</span> (AbiImmContext == 0xFF) {
01454 
01455 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01456 <span class="preprocessor"></span>        NextPc = ContextRecord-&gt;BrRp;
01457 <span class="preprocessor">#else</span>
01458 <span class="preprocessor"></span>        NextPc = RtlIa64InsertIPSlotNumber((ContextRecord-&gt;BrRp-16), 2);
01459 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01460 <span class="preprocessor"></span>
01461         <span class="comment">//</span>
01462         <span class="comment">// determine the local frame size of previous frame and compute</span>
01463         <span class="comment">// the new bsp.</span>
01464         <span class="comment">//</span>
01465 
01466         OldTopRnat = (ContextRecord-&gt;RsBSP+(BsFrameSize-1)*8) | RNAT_ALIGNMENT;
01467 
01468         ContextRecord-&gt;StIFS = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(IFS_V, (ULONGLONG)1) | ContextRecord-&gt;RsPFS;
01469         BsFrameSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)ContextRecord-&gt;StIFS &amp; PFS_SIZE_MASK;
01470         LocalFrameSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(ContextRecord-&gt;StIFS &gt;&gt; PFS_SIZE_SHIFT) &amp; PFS_SIZE_MASK;
01471         TempFrameSize = LocalFrameSize - RNatSaveIndex;
01472         <span class="keywordflow">while</span> (TempFrameSize &gt; 0) {
01473             LocalFrameSize++;
01474             BsFrameSize++;
01475             TempFrameSize -= NAT_BITS_PER_RNAT_REG;
01476         }
01477         ContextRecord-&gt;RsBSP -= LocalFrameSize * 8;
01478         ContextRecord-&gt;RsBSPSTORE = ContextRecord-&gt;RsBSP;
01479 
01480         <span class="comment">//</span>
01481         <span class="comment">// determine if the RNAT field needs to be updated.</span>
01482         <span class="comment">//</span>
01483 
01484         NewTopRnat = (ContextRecord-&gt;RsBSP+(BsFrameSize-1)*8) | RNAT_ALIGNMENT;
01485 
01486         <span class="keywordflow">if</span> (NewTopRnat &lt; OldTopRnat) {
01487 
01488 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01489 <span class="preprocessor"></span>            Destination = &amp;ContextRecord-&gt;RsRNAT;
01490             Source = NewTopRnat;
01491             <span class="keywordflow">if</span> (!ReadMemory(hProcess, (ULONG64)Source, Destination, 8, &amp;<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>)) {
01492                 <span class="keywordflow">return</span> 0;
01493             }
01494 <span class="preprocessor">#else</span>
01495 <span class="preprocessor"></span>            ContextRecord-&gt;RsRNAT = *(PULONGLONG)(NewTopRnat);
01496 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01497 <span class="preprocessor"></span>
01498         }
01499     }
01500 
01501 <span class="preprocessor">#ifdef _IMAGEHLP_SOURCE_</span>
01502 <span class="preprocessor"></span>    <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"NextPc = 0x%lx, PSP = 0x%lx, BSP = 0x%lx\n"</span>,
01503                (ULONGLONG)NextPc,
01504                (ULONGLONG)ContextRecord-&gt;IntSp,
01505                (ULONGLONG)ContextRecord-&gt;RsBSP));
01506 <span class="preprocessor">#else</span>
01507 <span class="preprocessor"></span>    <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"NextPc = 0x%lx, PSP = 0x%lx, BSP = 0x%lx\n"</span>,
01508                (ULONGLONG)NextPc,
01509                EstablisherFrame-&gt;MemoryStackFp,
01510                EstablisherFrame-&gt;BackingStoreFp));
01511 <span class="preprocessor">#endif // _IMAGEHLP_SOURCE_</span>
01512 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (NextPc);
01513 }
01514 
01515 
01516 UCHAR
<a name="l01517"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a155">01517</a> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a155">NewParsePrologueRegionPhase0</a> (
01518     IN PUNWIND_CONTEXT UwContext,
01519     IN PSTATE_RECORD State,
01520     IN OUT PUCHAR AbiImmContext
01521     )
01522 {
01523     PUCHAR Desc = UwContext-&gt;Descriptors;
01524     ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
01525     ULONG FrameSize;
01526     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01527     UCHAR RecType;
01528     UCHAR FirstByte;
01529     UCHAR SecondByte;
01530     ULONG GrSave;
01531     ULONG TempMask;
01532     ULONG i;
01533 
01534     <span class="keywordflow">while</span> (UwContext-&gt;DescCount &lt; UwContext-&gt;Size) {
01535 
01536         FirstByte = Desc[UwContext-&gt;DescCount++];
01537 
01538         <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a21">P1_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a22">P1_PREFIX</a>) {
01539 
01540             <span class="keywordflow">continue</span>;
01541 
01542         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a23">P2_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a24">P2_PREFIX</a> ) {
01543 
01544             UwContext-&gt;DescCount++;
01545 
01546         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a25">P3_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a26">P3_PREFIX</a> ) {
01547 
01548             UwContext-&gt;DescCount++;
01549 
01550         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a27">P4_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a28">P4_PREFIX</a> ) {
01551 
01552             UwContext-&gt;DescCount += ((State-&gt;RegionLen+3) &gt;&gt; 2);
01553 
01554         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a29">P5_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a30">P5_PREFIX</a> ) {
01555 
01556             UwContext-&gt;DescCount += 3;
01557 
01558         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a31">P6_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a32">P6_PREFIX</a> ) {
01559 
01560             <span class="keywordflow">continue</span>;
01561 
01562         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a33">P7_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a34">P7_PREFIX</a> ) {
01563 
01564             RecType = FirstByte &amp; ~<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a33">P7_MASK</a>;
01565 
01566             <span class="keywordflow">switch</span> (RecType) {
01567 
01568             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a65">MEM_STACK_F</a>:
01569 
01570                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;UwContext-&gt;DescCount);
01571                 FrameSize = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;UwContext-&gt;DescCount);
01572 
01573                 <span class="keywordflow">if</span> (UwContext-&gt;TargetSlot &gt; (UwContext-&gt;SlotCount+<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>))
01574                 {
01575                     State-&gt;SpAdjustment += FrameSize*4;
01576                     State-&gt;SpWhen = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
01577                 }
01578                 <span class="keywordflow">break</span>;
01579 
01580             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a67">SPILL_BASE</a>:
01581 
01582                 State-&gt;SpillBase = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;UwContext-&gt;DescCount);
01583                 State-&gt;SpillPtr = State-&gt;SpillBase;
01584                 <span class="keywordflow">break</span>;
01585 
01586             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a66">MEM_STACK_V</a>:
01587             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a69">RP_WHEN</a>:
01588             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a71">PFS_WHEN</a>:
01589             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a73">PREDS_WHEN</a>:
01590             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a75">LC_WHEN</a>:
01591             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a77">UNAT_WHEN</a>:
01592             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a79">FPSR_WHEN</a>:
01593 
01594                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;UwContext-&gt;DescCount);
01595                 <span class="keywordflow">if</span> ((State-&gt;IsTarget) &amp;&amp;
01596                     (UwContext-&gt;TargetSlot &gt; (UwContext-&gt;SlotCount+<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>)))
01597                 {
01598                     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a153">P7RecordTypeToRegisterIndex</a>[RecType];
01599                     <span class="keywordflow">if</span> (!(State-&gt;MiscMask &amp; (1 &lt;&lt; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>))) {
01600                         State-&gt;MiscMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1);
01601                         UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].When = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
01602                     } <span class="keywordflow">else</span> {
01603                         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Duplicate descriptors,"</span>));
01604                         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"unwinder may produce incorrect result!\n"</span>));
01605                     }
01606                 }
01607                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P7: type=%d slot= %d\n"</span>, RecType, <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>));
01608                 <span class="keywordflow">break</span>;
01609 
01610             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a68">PSP_SPREL</a>:
01611             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a70">RP_PSPREL</a>:
01612             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a72">PFS_PSPREL</a>:
01613             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a74">PREDS_PSPREL</a>:
01614             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a76">LC_PSPREL</a>:
01615             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a78">UNAT_PSPREL</a>:
01616             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a80">FPSR_PSPREL</a>:
01617 
01618                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;UwContext-&gt;DescCount);
01619                 <span class="keywordflow">break</span>;
01620 
01621             <span class="keywordflow">default</span>:
01622 
01623                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Invalid record type for descriptor P7!\n"</span>));
01624 
01625             }
01626 
01627         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a35">P8_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a36">P8_PREFIX</a> ) {
01628 
01629             RecType = Desc[UwContext-&gt;DescCount++];
01630 
01631             <span class="keywordflow">switch</span> (RecType) {
01632 
01633             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a81">PSP_PSPREL</a>:
01634             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a82">RP_SPREL</a>:
01635             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a83">PFS_SPREL</a>:
01636             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a84">PREDS_SPREL</a>:
01637             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a85">LC_SPREL</a>:
01638             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a86">UNAT_SPREL</a>:
01639             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a87">FPSR_SPREL</a>:
01640             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a89">BSP_PSPREL</a>:
01641             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a90">BSP_SPREL</a>:
01642             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a92">BSPSTORE_PSPREL</a>:
01643             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a93">BSPSTORE_SPREL</a>:
01644             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a95">RNAT_PSPREL</a>:
01645             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a96">RNAT_SPREL</a>:
01646             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a98">PRIUNAT_PSPREL</a>:
01647             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a99">PRIUNAT_SPREL</a>:
01648 
01649                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;UwContext-&gt;DescCount);
01650                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P8: type=%d slot= %d\n"</span>, RecType, <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>));
01651                 <span class="keywordflow">break</span>;
01652 
01653             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a88">BSP_WHEN</a>:
01654             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a91">BSPSTORE_WHEN</a>:
01655             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a94">RNAT_WHEN</a>:
01656             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a97">PRIUNAT_WHEN</a>:
01657 
01658                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;UwContext-&gt;DescCount);
01659                 <span class="keywordflow">if</span> ((State-&gt;IsTarget) &amp;&amp;
01660                     (UwContext-&gt;TargetSlot &gt; (UwContext-&gt;SlotCount+<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>)))
01661                 {
01662                     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a153">P7RecordTypeToRegisterIndex</a>[RecType];
01663                     <span class="keywordflow">if</span> (!(State-&gt;MiscMask &amp; (1 &lt;&lt; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>))) {
01664                         State-&gt;MiscMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1);
01665                         UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].When = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
01666                     } <span class="keywordflow">else</span> {
01667                         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Duplicate descriptors,"</span>));
01668                         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"unwinder may produce incorrect result!\n"</span>));
01669                     }
01670                 }
01671                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P8: type=%d slot= %d\n"</span>, RecType, <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>));
01672                 <span class="keywordflow">break</span>;
01673 
01674             <span class="keywordflow">default</span>:
01675 
01676                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Invalid record type for descriptor P8!\n"</span>));
01677 
01678             }
01679 
01680         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a37">P9_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a38">P9_PREFIX</a> ) {
01681 
01682             UwContext-&gt;DescCount += 2;
01683             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a1">VUW_DEBUG_PRINT</a>(<span class="stringliteral">"Format P9 not supported yet!\n"</span>);
01684 
01685         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a39">P10_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a40">P10_PREFIX</a> ) {
01686 
01687             UCHAR Abi = Desc[UwContext-&gt;DescCount++];
01688             UCHAR Context = Desc[UwContext-&gt;DescCount++];
01689 
01690             *AbiImmContext = Context;
01691 
01692             <span class="keywordflow">if</span> (Abi != <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a5">NT_ABI</a>) {
01693                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a1">VUW_DEBUG_PRINT</a>(<span class="stringliteral">"Unknown ABI unwind descriptor\n"</span>);
01694             }
01695 
01696         } <span class="keywordflow">else</span> {
01697 
01698             <span class="comment">//</span>
01699             <span class="comment">// Encounter another region header record</span>
01700             <span class="comment">//</span>
01701 
01702             <span class="keywordflow">break</span>;
01703         }
01704     }
01705 
01706     State-&gt;DescEnd = UwContext-&gt;DescCount - 2;
01707 
01708     <span class="keywordflow">return</span> FirstByte;
01709 }
01710 
01711 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01712"></a><a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a156">01712</a> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a156">NewParsePrologueRegionPhase1</a> (
01713     IN PUNWIND_CONTEXT UwContext,
01714     IN PSTATE_RECORD State
01715     )
01716 {
01717     ULONG FrameSize;
01718     ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
01719     ULONG GrSave;
01720     ULONG BrBase;
01721     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01722     ULONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
01723     UCHAR RecType;
01724     UCHAR FirstByte, SecondByte;   <span class="comment">// 1st &amp; 2nd bytes of a region header record</span>
01725     ULONG DescIndex;
01726     ULONG ImaskBegin;
01727     UCHAR NextBr, NextGr, NextFr;
01728     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> MiscMask;
01729     ULONG TempMask;
01730     ULONG FrMask = 0;
01731     UCHAR BrMask = 0;
01732     UCHAR GrMask = 0;
01733     PUCHAR Desc = UwContext-&gt;Descriptors;
01734     BOOLEAN SpillMaskOmitted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01735 
01736     DescIndex = State-&gt;DescBegin;
01737 
01738     FirstByte = Desc[DescIndex];
01739 
01740     <span class="keywordflow">if</span> ((FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a16">R2_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a17">R2_PREFIX</a>) {
01741 
01742         <span class="comment">//</span>
01743         <span class="comment">// general prologue region header; need to process it first</span>
01744         <span class="comment">//</span>
01745 
01746         ULONG GrSave, <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
01747         UCHAR MiscMask;
01748         UCHAR SecondByte;
01749         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> i;
01750 
01751         DescIndex++;
01752         SecondByte = Desc[DescIndex++];
01753         MiscMask = ((FirstByte &amp; 0x7) &lt;&lt; 1) | ((SecondByte &amp; 0x80) &gt;&gt; 7);
01754         GrSave = SecondByte &amp; 0x7F;
01755         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;DescIndex);    <span class="comment">// advance the descriptor index</span>
01756 
01757         <span class="keywordflow">if</span> (GrSave &lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a10">STATIC_REGISTER_SET_SIZE</a>) {
01758             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Invalid unwind descriptor!\n"</span>));
01759         }
01760 
01761         <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Region R2: rmask=%x,grsave=%d,length=%d\n"</span>,
01762                   MiscMask, GrSave, State-&gt;RegionLen));
01763 
01764         <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 0;
01765         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a117">REG_PREDS</a>; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt;= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a120">REG_RP</a>; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++) {
01766             <span class="keywordflow">if</span> (MiscMask &amp; 0x1) {
01767                 <span class="keywordflow">if</span> (!(State-&gt;IsTarget) ||
01768                     (State-&gt;MiscMask &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1)))
01769                 {
01770                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Where = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a129">GENERAL_REG</a>;
01771                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].SaveOffset = GrSave+<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
01772                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].When = 0;
01773                     State-&gt;MiscMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1);
01774                 }
01775                 <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>++;
01776             }
01777             MiscMask = MiscMask &gt;&gt; 1;
01778         }
01779     }
01780 
01781     <span class="keywordflow">while</span> (DescIndex &lt;= State-&gt;DescEnd) {
01782 
01783         FirstByte = Desc[DescIndex++];
01784 
01785         <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a21">P1_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a22">P1_PREFIX</a>) {
01786 
01787             BrMask = FirstByte &amp; ~<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a21">P1_MASK</a>;
01788             State-&gt;MiscMask |= (BrMask &lt;&lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a>);
01789 
01790             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P1: brmask=%x\n"</span>, BrMask));
01791 
01792             <span class="keywordflow">for</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a>;
01793                  <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> &lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a>+<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a113">NUMBER_OF_PRESERVED_BR</a>;
01794                  <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>++)
01795             {
01796                 <span class="keywordflow">if</span> (BrMask &amp; 0x1) {
01797                     UwContext-&gt;MiscRegs[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>].Where = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a130">PSP_RELATIVE</a>;
01798                     UwContext-&gt;MiscRegs[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>].When = State-&gt;RegionLen;
01799                 }
01800                 BrMask = BrMask &gt;&gt; 1;
01801             }
01802 
01803         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a23">P2_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a24">P2_PREFIX</a> ) {
01804 
01805             SecondByte = Desc[DescIndex++];
01806             GrSave = SecondByte &amp; 0x7F;
01807             BrMask = ((FirstByte &amp; ~<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a23">P2_MASK</a>) &lt;&lt; 1) | ((SecondByte &amp; 0x80) &gt;&gt; 7);
01808             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P2: brmask=%x reg base=%d\n"</span>, BrMask, GrSave));
01809 
01810             State-&gt;MiscMask |= (BrMask &lt;&lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a>);
01811 
01812             <span class="keywordflow">for</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a>;
01813                  <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> &lt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a>+<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a113">NUMBER_OF_PRESERVED_BR</a>;
01814                  <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>++)
01815             {
01816                 <span class="keywordflow">if</span> (BrMask &amp; 0x1) {
01817                     UwContext-&gt;MiscRegs[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>].Where = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a129">GENERAL_REG</a>;
01818                     UwContext-&gt;MiscRegs[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>].SaveOffset = GrSave++;
01819                 }
01820                 BrMask = BrMask &gt;&gt; 1;
01821             }
01822 
01823         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a25">P3_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a26">P3_PREFIX</a> ) {
01824 
01825             SecondByte = Desc[DescIndex++];
01826             RecType = ((SecondByte &amp; 0x80) &gt;&gt; 7) | ((FirstByte &amp; 0x7) &lt;&lt; 1);
01827             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a152">P3RecordTypeToRegisterIndex</a>[RecType];
01828 
01829             <span class="keywordflow">if</span> (!(State-&gt;IsTarget) ||
01830                 (State-&gt;MiscMask &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1)))
01831             {
01832                 <span class="keywordflow">if</span> (RecType == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a59">RP_BR</a>) {
01833                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Where = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a132">BRANCH_REG</a>;
01834                 } <span class="keywordflow">else</span> {
01835                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Where = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a129">GENERAL_REG</a>;
01836                 }
01837                 UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].SaveOffset = SecondByte &amp; 0x7F;
01838                 UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].When = 0;
01839                 State-&gt;MiscMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1);
01840 
01841                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P3: type=%d reg=%d\n"</span>,
01842                           RecType, UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].SaveOffset));
01843             }
01844 
01845         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a27">P4_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a28">P4_PREFIX</a> ) {
01846 
01847             SpillMaskOmitted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01848             ImaskBegin = DescIndex;
01849             DescIndex += ((State-&gt;RegionLen+3) &gt;&gt; 2);
01850 
01851         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a29">P5_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a30">P5_PREFIX</a> ) {
01852 
01853             GrMask = (Desc[DescIndex] &amp; 0xF0) &gt;&gt; 4;
01854             FrMask = ((ULONG)(Desc[DescIndex] &amp; 0xF) &lt;&lt; 16) |
01855                          ((ULONG)Desc[DescIndex+1] &lt;&lt; 8) |
01856                          ((ULONG)Desc[DescIndex+2]);
01857 
01858             DescIndex += 3;    <span class="comment">// increment the descriptor index</span>
01859 
01860             State-&gt;GrMask |= GrMask;
01861             State-&gt;FrMask |= FrMask;
01862 
01863             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P5: grmask = %x, frmask = %x\n"</span>,
01864                       State-&gt;GrMask, State-&gt;FrMask));
01865 
01866         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a31">P6_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a32">P6_PREFIX</a> ) {
01867 
01868             <span class="keywordflow">if</span> (FirstByte &amp; 0x10) {
01869 
01870                 GrMask = FirstByte &amp; 0xF;
01871                 State-&gt;GrMask |= GrMask;
01872 
01873             } <span class="keywordflow">else</span> {
01874 
01875                 FrMask = FirstByte &amp; 0xF;
01876                 State-&gt;FrMask |= FrMask;
01877 
01878             }
01879 
01880             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P6: is_gr = %d, mask = %x\n"</span>,
01881                       (FirstByte &amp; 0x10) ? 1 : 0,
01882                       (FirstByte &amp; 0x10) ? State-&gt;GrMask : State-&gt;FrMask));
01883 
01884         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a33">P7_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a34">P7_PREFIX</a> ) {
01885 
01886             RecType = FirstByte &amp; ~<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a33">P7_MASK</a>;
01887 
01888             <span class="keywordflow">switch</span> (RecType) {
01889 
01890             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a68">PSP_SPREL</a>:
01891 
01892                 <span class="comment">//</span>
01893                 <span class="comment">// sp-relative location</span>
01894                 <span class="comment">//</span>
01895 
01896                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a153">P7RecordTypeToRegisterIndex</a>[RecType];
01897                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;DescIndex);
01898                 <span class="keywordflow">if</span> (!(State-&gt;IsTarget) || (State-&gt;MiscMask &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1)))
01899                 {
01900                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Where = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a131">SP_RELATIVE</a>;
01901                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].SaveOffset = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
01902                     <span class="keywordflow">if</span> (!(State-&gt;MiscMask &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1))) {
01903                         UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].When = State-&gt;RegionLen;
01904                         State-&gt;MiscMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1);
01905                     }
01906                 }
01907                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P7: type=%d spoff = %d\n"</span>, RecType, <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>));
01908                 <span class="keywordflow">break</span>;
01909 
01910 
01911             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a70">RP_PSPREL</a>:
01912             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a72">PFS_PSPREL</a>:
01913             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a74">PREDS_PSPREL</a>:
01914             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a76">LC_PSPREL</a>:
01915             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a78">UNAT_PSPREL</a>:
01916             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a80">FPSR_PSPREL</a>:
01917 
01918                 <span class="comment">//</span>
01919                 <span class="comment">// psp-relative location</span>
01920                 <span class="comment">//</span>
01921 
01922                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a153">P7RecordTypeToRegisterIndex</a>[RecType];
01923                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;DescIndex);
01924                 <span class="keywordflow">if</span> (!(State-&gt;IsTarget) || (State-&gt;MiscMask &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1)))
01925                 {
01926                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Where = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a130">PSP_RELATIVE</a>;
01927                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].SaveOffset = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
01928                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].When = 0;
01929                     State-&gt;MiscMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1);
01930                 }
01931                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P7: type=%d pspoff= %d\n"</span>, RecType, <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>));
01932                 <span class="keywordflow">break</span>;
01933 
01934             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a66">MEM_STACK_V</a>:
01935             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a69">RP_WHEN</a>:
01936             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a71">PFS_WHEN</a>:
01937             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a73">PREDS_WHEN</a>:
01938             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a75">LC_WHEN</a>:
01939             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a77">UNAT_WHEN</a>:
01940             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a79">FPSR_WHEN</a>:
01941 
01942                 <span class="comment">//</span>
01943                 <span class="comment">// Nevermind processing these descriptors because they</span>
01944                 <span class="comment">// have been taken care of in phase 0</span>
01945                 <span class="comment">//</span>
01946 
01947                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;DescIndex);
01948                 <span class="keywordflow">break</span>;
01949 
01950             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a65">MEM_STACK_F</a>:
01951 
01952                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;DescIndex);
01953                 FrameSize = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;DescIndex);
01954 
01955                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P7: type=%d Slot=%d FrameSize=%d\n"</span>,
01956                           RecType, <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>, FrameSize));
01957                 <span class="keywordflow">break</span>;
01958 
01959             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a67">SPILL_BASE</a>:
01960 
01961                 State-&gt;SpillBase = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;DescIndex);
01962                 State-&gt;SpillPtr = State-&gt;SpillBase;
01963                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P7: type=%d, spillbase=%d\n"</span>,
01964                           RecType, State-&gt;SpillBase));
01965                 <span class="keywordflow">break</span>;
01966 
01967             <span class="keywordflow">default</span>:
01968 
01969                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"invalid unwind descriptors\n"</span>));
01970 
01971             }
01972 
01973         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a35">P8_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a36">P8_PREFIX</a> ) {
01974 
01975             RecType = Desc[DescIndex++];
01976 
01977             <span class="keywordflow">switch</span> (RecType) {
01978 
01979             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a81">PSP_PSPREL</a>:
01980                  <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a1">VUW_DEBUG_PRINT</a>(<span class="stringliteral">"Unsupported Unwind Descriptor!\n"</span>);
01981                  <span class="keywordflow">break</span>;
01982 
01983             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a82">RP_SPREL</a>:
01984             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a83">PFS_SPREL</a>:
01985             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a84">PREDS_SPREL</a>:
01986             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a85">LC_SPREL</a>:
01987             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a86">UNAT_SPREL</a>:
01988             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a87">FPSR_SPREL</a>:
01989             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a90">BSP_SPREL</a>:
01990             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a93">BSPSTORE_SPREL</a>:
01991             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a96">RNAT_SPREL</a>:
01992             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a99">PRIUNAT_SPREL</a>:
01993 
01994                 <span class="comment">//</span>
01995                 <span class="comment">// sp-relative location</span>
01996                 <span class="comment">//</span>
01997 
01998                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a154">P8RecordTypeToRegisterIndex</a>[RecType];
01999                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;DescIndex);
02000                 <span class="keywordflow">if</span> (!(State-&gt;IsTarget) || (State-&gt;MiscMask &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1)))
02001                 {
02002                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Where = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a131">SP_RELATIVE</a>;
02003                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].SaveOffset = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
02004                     <span class="keywordflow">if</span> (!(State-&gt;MiscMask &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1))) {
02005                         UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].When=State-&gt;RegionLen;
02006                         State-&gt;MiscMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1);
02007                     }
02008                 }
02009                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P8: type=%d spoff= %d\n"</span>, RecType, <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>));
02010                 <span class="keywordflow">break</span>;
02011 
02012             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a89">BSP_PSPREL</a>:
02013             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a92">BSPSTORE_PSPREL</a>:
02014             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a95">RNAT_PSPREL</a>:
02015             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a98">PRIUNAT_PSPREL</a>:
02016 
02017                 <span class="comment">//</span>
02018                 <span class="comment">// psp-relative location</span>
02019                 <span class="comment">//</span>
02020 
02021                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a154">P8RecordTypeToRegisterIndex</a>[RecType];
02022                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;DescIndex);
02023                 <span class="keywordflow">if</span> (!(State-&gt;IsTarget) || (State-&gt;MiscMask &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1)))
02024                 {
02025                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Where = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a130">PSP_RELATIVE</a>;
02026                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].SaveOffset = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
02027                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].When = 0;
02028                     State-&gt;MiscMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1);
02029                 }
02030                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Prolog P8: type=%d pspoff= %d\n"</span>, RecType, <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>));
02031                 <span class="keywordflow">break</span>;
02032 
02033             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a88">BSP_WHEN</a>:
02034             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a91">BSPSTORE_WHEN</a>:
02035             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a94">RNAT_WHEN</a>:
02036             <span class="keywordflow">case</span> <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a97">PRIUNAT_WHEN</a>:
02037 
02038                 <span class="comment">//</span>
02039                 <span class="comment">// Nevermind processing these descriptors because they</span>
02040                 <span class="comment">// have been taken care of in phase 0</span>
02041                 <span class="comment">//</span>
02042 
02043                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a158">ReadLEB128</a>(Desc, &amp;DescIndex);
02044                 <span class="keywordflow">break</span>;
02045 
02046             <span class="keywordflow">default</span>:
02047 
02048                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Invalid record type for descriptor P8!\n"</span>));
02049 
02050             }
02051 
02052         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a37">P9_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a38">P9_PREFIX</a> ) {
02053 
02054             DescIndex += 2;
02055             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a1">VUW_DEBUG_PRINT</a>(<span class="stringliteral">"Format P9 not supported yet!\n"</span>);
02056 
02057         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (FirstByte &amp; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a39">P10_MASK</a>) == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a40">P10_PREFIX</a> ) {
02058 
02059             UCHAR Abi = Desc[DescIndex++];
02060             UCHAR Context = Desc[DescIndex++];
02061 
02062         } <span class="keywordflow">else</span> {
02063 
02064             <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"Invalid descriptor!\n"</span>));
02065 
02066         }
02067     }
02068 
02069     GrMask = State-&gt;GrMask;
02070     FrMask = State-&gt;FrMask;
02071     BrMask = State-&gt;MiscMask &gt;&gt; <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a>;
02072 
02073     <span class="keywordflow">if</span> (!(GrMask | FrMask | BrMask)) {
02074 
02075         <span class="keywordflow">return</span>;
02076 
02077     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SpillMaskOmitted &amp;&amp; !(State-&gt;IsTarget)) {
02078 
02079         <span class="comment">//</span>
02080         <span class="comment">// When spillmask is omitted, floating point registers, general</span>
02081         <span class="comment">// registers, and then branch regisers are spilled in order.</span>
02082         <span class="comment">// They are not modified in the prologue region; therefore, there</span>
02083         <span class="comment">// is no need to restore their contents when the control ip is</span>
02084         <span class="comment">// in this prologue region.</span>
02085         <span class="comment">//</span>
02086 
02087         <span class="comment">// 1. floating point registers</span>
02088 
02089         State-&gt;SpillPtr &amp;= ~(<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a7">SPILLSIZE_OF_FLOAT128_IN_DWORDS</a> - 1);
02090         NextFr = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a110">NUMBER_OF_PRESERVED_FR</a> - 1;
02091         <span class="keywordflow">while</span> (FrMask &amp; 0xFFFFF) {
02092             <span class="keywordflow">if</span> (FrMask &amp; 0x80000) {
02093                 State-&gt;SpillPtr += <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a7">SPILLSIZE_OF_FLOAT128_IN_DWORDS</a>;
02094                 UwContext-&gt;Float[NextFr].SaveOffset = State-&gt;SpillPtr;
02095             }
02096             FrMask = FrMask &lt;&lt; 1;
02097             NextFr--;
02098         }
02099 
02100         <span class="comment">// 2. branch registers</span>
02101 
02102         NextBr = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a> + <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a113">NUMBER_OF_PRESERVED_BR</a> - 1;
02103         <span class="keywordflow">while</span> (BrMask &amp; 0x1F) {
02104             <span class="keywordflow">if</span> (BrMask &amp; 0x10) {
02105                 <span class="keywordflow">if</span> (UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Where == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a130">PSP_RELATIVE</a>) {
02106                     State-&gt;SpillPtr += <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a8">SPILLSIZE_OF_ULONGLONG_IN_DWORDS</a>;
02107                     UwContext-&gt;MiscRegs[NextBr].SaveOffset = State-&gt;SpillPtr;
02108                 }
02109             }
02110             BrMask = BrMask &lt;&lt; 1;
02111             NextBr--;
02112         }
02113 
02114         <span class="comment">// 3. general registers</span>
02115 
02116         NextGr = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a103">NUMBER_OF_PRESERVED_GR</a> - 1;
02117         <span class="keywordflow">while</span> (GrMask &amp; 0xF) {
02118             <span class="keywordflow">if</span> (GrMask &amp; 0x8) {
02119                 State-&gt;SpillPtr += <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a8">SPILLSIZE_OF_ULONGLONG_IN_DWORDS</a>;
02120                 UwContext-&gt;Integer[NextGr].SaveOffset = State-&gt;SpillPtr;
02121             }
02122             GrMask = GrMask &lt;&lt; 1;
02123             NextGr--;
02124         }
02125 
02126     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SpillMaskOmitted &amp;&amp; State-&gt;IsTarget) {
02127 
02128         State-&gt;GrMask = 0;
02129         State-&gt;FrMask = 0;
02130         State-&gt;MiscMask &amp;= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a>, 1) - 1;
02131 
02132     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SpillMaskOmitted == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
02133 
02134         ULONG Length;
02135 
02136         <span class="keywordflow">if</span> (State-&gt;IsTarget) {
02137 
02138             <span class="comment">//</span>
02139             <span class="comment">// control ip is in the prologue region; clear the masks</span>
02140             <span class="comment">// and then process the imask to determine which preserved</span>
02141             <span class="comment">// Gr/Fr/Br have been saved and set the corresponding bits.</span>
02142             <span class="comment">//</span>
02143 
02144             State-&gt;GrMask = 0;
02145             State-&gt;FrMask = 0;
02146             State-&gt;MiscMask &amp;= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a>, 1) - 1;
02147             Length = UwContext-&gt;TargetSlot - State-&gt;RegionBegin;
02148         } <span class="keywordflow">else</span> {
02149             Length = State-&gt;RegionLen;
02150         }
02151 
02152         NextGr = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a103">NUMBER_OF_PRESERVED_GR</a> - 1;
02153         NextBr = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a113">NUMBER_OF_PRESERVED_BR</a> - 1;
02154         NextFr = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a110">NUMBER_OF_PRESERVED_FR</a> - 1;
02155         <span class="keywordflow">for</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 0; <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> &lt; Length; <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>++) {
02156 
02157             <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> % 4) == 0) {
02158                 FirstByte = Desc[ImaskBegin++];
02159             } <span class="keywordflow">else</span> {
02160                 FirstByte = FirstByte &lt;&lt; 2;
02161             }
02162 
02163             <span class="keywordflow">switch</span> (FirstByte &amp; 0xC0) {
02164 
02165             <span class="keywordflow">case</span> 0x40:                  <span class="comment">// 0x01 - save next fr</span>
02166 
02167                 <span class="keywordflow">while</span> ( !(FrMask &amp; 0x80000) &amp;&amp; (NextFr &gt; 0) ) {
02168                     NextFr--;
02169                     FrMask = FrMask &lt;&lt; 1;
02170                 }
02171 
02172                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"spilled register FS%lx\n"</span>, (ULONG)NextFr));
02173 
02174                 State-&gt;FrMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(NextFr,1);
02175                 UwContext-&gt;Float[NextFr].When = <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
02176                 State-&gt;SpillPtr += <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a8">SPILLSIZE_OF_ULONGLONG_IN_DWORDS</a>;
02177                 State-&gt;SpillPtr &amp;= ~(<a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a7">SPILLSIZE_OF_FLOAT128_IN_DWORDS</a> - 1);
02178                 State-&gt;SpillPtr += <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a7">SPILLSIZE_OF_FLOAT128_IN_DWORDS</a>;
02179                 UwContext-&gt;Float[NextFr].SaveOffset = State-&gt;SpillPtr;
02180 
02181                 NextFr--;
02182                 FrMask = FrMask &lt;&lt; 1;
02183                 <span class="keywordflow">break</span>;
02184 
02185             <span class="keywordflow">case</span> 0x80:                  <span class="comment">// 0x10 - save next gr</span>
02186 
02187                 <span class="keywordflow">while</span> ( !(GrMask &amp; 0x8) &amp;&amp; (NextGr &gt; 0) ) {
02188                     NextGr--;
02189                     GrMask = GrMask &lt;&lt; 1;
02190                 }
02191 
02192                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"spilled register S%lx\n"</span>, (ULONG)NextGr));
02193 
02194                 State-&gt;GrMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(NextGr,1);
02195                 UwContext-&gt;Integer[NextGr].When = <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
02196                 State-&gt;SpillPtr += <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a8">SPILLSIZE_OF_ULONGLONG_IN_DWORDS</a>;
02197                 UwContext-&gt;Integer[NextGr].SaveOffset = State-&gt;SpillPtr;
02198 
02199                 NextGr--;
02200                 GrMask = GrMask &lt;&lt; 1;
02201                 <span class="keywordflow">break</span>;
02202 
02203             <span class="keywordflow">case</span> 0xC0:                  <span class="comment">// 0x11 - save next br</span>
02204 
02205                 <span class="keywordflow">while</span> ( !(BrMask &amp; 0x10) &amp;&amp; (NextBr &gt; 0) ) {
02206                     NextBr--;
02207                     BrMask = BrMask &lt;&lt; 1;
02208                 }
02209 
02210                 <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a139">UW_DEBUG</a>((<span class="stringliteral">"spilled register BS%lx\n"</span>, (ULONG)NextBr));
02211 
02212                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a124">REG_BR_BASE</a> + NextBr;
02213                 State-&gt;MiscMask |= <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a2">MASK</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,1);
02214                 UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].When = <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
02215                 <span class="keywordflow">if</span> (UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Where == <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a130">PSP_RELATIVE</a>) {
02216                     State-&gt;SpillPtr += <a class="code" href="../../d9/d6/ia64_2vunwind_8c.html#a8">SPILLSIZE_OF_ULONGLONG_IN_DWORDS</a>;
02217                     UwContext-&gt;MiscRegs[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].SaveOffset = State-&gt;SpillPtr;
02218                 }
02219 
02220                 NextBr--;
02221                 BrMask = BrMask &lt;&lt; 1;
02222                 <span class="keywordflow">break</span>;
02223 
02224             <span class="keywordflow">default</span>:                    <span class="comment">// 0x00 - save no register</span>
02225                 <span class="keywordflow">break</span>;
02226 
02227             }
02228         }
02229     }
02230 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
