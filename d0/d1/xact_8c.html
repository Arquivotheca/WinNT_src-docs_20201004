<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: xact.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>xact.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d1/d0/xact_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HDDEDATA&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a0">DdeClientTransaction</a> (LPBYTE pData, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbData, HCONV hConv, HSZ hszItem, UINT wFmt, UINT wType, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ulTimeout, LPDWORD pulResult)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a1">GetConvContext</a> (HWND hwnd, LONG *pl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a2">SetConvContext</a> (HWND hwnd, LONG *pl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a3">DdeQueryConvInfo</a> (HCONV hConv, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idTransaction, PCONVINFO pConvInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a4">DdeSetUserHandle</a> (HCONV hConv, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> id, DWORD_PTR hUser)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a5">AbandonTransaction</a> (<a class="el" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> pcoi, <a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a6">AbandonEnumerateProc</a> (HWND hwnd, LPARAM idTransaction)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a7">DdeAbandonTransaction</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idInst, HCONV hConv, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idTransaction)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a8">UpdateLinkIfChanged</a> (<a class="el" href="../../d2/d8/structtagADVISE__LINK.html">PADVISE_LINK</a> paLink, <a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi, <a class="el" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> pcoi, <a class="el" href="../../d2/d8/structtagADVISE__LINK.html">PADVISE_LINK</a> paLinkLast, PBOOL pfSwapped, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cLinksToGo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a9">DdePostAdvise</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idInst, HSZ hszTopic, HSZ hszItem)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a10">LinkTransaction</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a11">UnlinkTransaction</a> (<a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/xact_8c.html#a12">ValidateTransaction</a> (HCONV hConv, HANDLE hXact, <a class="el" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> *ppcoi, <a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> *ppxi)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a6" doxytag="xact.c::AbandonEnumerateProc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL AbandonEnumerateProc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>idTransaction</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00532">532</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d1/d0/xact_8c-source.html#l00517">AbandonTransaction()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00388">GetWindowLongPtr()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00673">GWLP_PCI</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00211">tagCONV_INFO::next</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00219">tagCONV_INFO::state</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00560">DdeAbandonTransaction()</a>.
<p>
<pre class="fragment"><div>00535 {
00536     <a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> pcoi;
00537 
00538     pcoi = (<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hwnd, GWLP_PCI);
00539     <span class="keywordflow">if</span> (!pcoi || !(pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_CLIENT)) {
00540         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00541     }
00542     <span class="keywordflow">while</span> (pcoi) {
00543         <a class="code" href="../../d0/d1/xact_8c.html#a5">AbandonTransaction</a>(pcoi, (<a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>)idTransaction);
00544         pcoi = pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o0">next</a>;
00545     }
00546     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00547 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="xact.c::AbandonTransaction" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID AbandonTransaction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pcoi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pxi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00517">517</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00130">tagXACT_INFO::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00121">tagXACT_INFO::next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00221">tagCONV_INFO::pxiIn</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00138">XIF_ABANDONED</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00532">AbandonEnumerateProc()</a>, and <a class="el" href="../../d1/d0/xact_8c-source.html#l00560">DdeAbandonTransaction()</a>.
<p>
<pre class="fragment"><div>00520 {
00521     <span class="keywordflow">if</span> (pxi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00522         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a> |= <a class="code" href="../../d0/d4/ddemlcli_8h.html#a45">XIF_ABANDONED</a>;
00523     } <span class="keywordflow">else</span> {
00524         <span class="keywordflow">for</span> (pxi = pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o10">pxiIn</a>; pxi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; pxi = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>) {
00525             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a> |= <a class="code" href="../../d0/d4/ddemlcli_8h.html#a45">XIF_ABANDONED</a>;
00526         }
00527     }
00528 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="xact.c::DdeAbandonTransaction" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DdeAbandonTransaction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>idInst</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HCONV&nbsp;</td>
          <td class="mdname" nowrap> <em>hConv</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>idTransaction</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00560">560</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d1/d0/xact_8c-source.html#l00532">AbandonEnumerateProc()</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00517">AbandonTransaction()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d1/d7/clenum_8c-source.html#l00188">EnumChildWindows()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00188">tagCL_INSTANCE_INFO::hwndMother</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00111">ValidateInstance()</a>, and <a class="el" href="../../d1/d0/xact_8c-source.html#l00909">ValidateTransaction()</a>.
<p>
<pre class="fragment"><div>00564 {
00565     <a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> pcoi;
00566     <a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi;
00567     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00568     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00569 
00570     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00571 
00572     pcii = <a class="code" href="../../d0/d4/instance_8c.html#a7">ValidateInstance</a>((HANDLE)LongToHandle( idInst ));
00573 
00574     <span class="keywordflow">if</span> (hConv == 0 &amp;&amp; idTransaction == 0) {
00575         <a class="code" href="../../d0/d8/clenum_8c.html#a8">EnumChildWindows</a>(pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o4">hwndMother</a>, AbandonEnumerateProc, 0);
00576         <span class="keywordflow">goto</span> Exit;
00577     }
00578     <span class="keywordflow">if</span> (idTransaction == 0) {
00579         idTransaction = QID_SYNC;
00580     }
00581     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d1/xact_8c.html#a12">ValidateTransaction</a>(hConv, (HANDLE)LongToHandle( idTransaction ), &amp;pcoi, &amp;pxi)) {
00582         <span class="keywordflow">goto</span> Exit;
00583     }
00584     <span class="keywordflow">if</span> (pcii == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a> != pcii) {
00585         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_INVALIDPARAMETER);
00586         <span class="keywordflow">goto</span> Exit;
00587     }
00588     <a class="code" href="../../d0/d1/xact_8c.html#a5">AbandonTransaction</a>(pcoi, pxi);
00589     fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00590 
00591 Exit:
00592     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00593     <span class="keywordflow">return</span> (fRet);
00594 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="xact.c::DdeClientTransaction" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HDDEDATA DdeClientTransaction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>pData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cbData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HCONV&nbsp;</td>
          <td class="mdname" nowrap> <em>hConv</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HSZ&nbsp;</td>
          <td class="mdname" nowrap> <em>hszItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wFmt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ulTimeout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pulResult</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00024">24</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00191">tagCL_INSTANCE_INFO::afCmd</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01479">AllocAndSetDDEData()</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00336">BestSetLastDDEMLError()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l01460">CallMsgFilter()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00059">CheckDDECritOut</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00231">tagCL_CONV_INFO::ci</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00547">CI_IN_SYNC_TRANSACTION</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00201">tagCL_INSTANCE_INFO::cInDDEMLCallback</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00067">ClStartAdvise()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00852">ClStartExecute()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01012">ClStartPoke()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01176">ClStartRequest()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00561">ClStartUnadvise()</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00660">CopyDDEData()</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00075">CreateHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00016">DDEMLAlloc</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d0/d3/ddemlcli_8c-source.html#l00196">DdeUninitialize()</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00137">DestroyHandle()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00874">DispatchMessage()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00130">tagXACT_INFO::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00200">tagCL_INSTANCE_INFO::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00257">tagDDEMLDATA::flags</a>, <a class="el" href="../../d7/d4/connect_8c-source.html#l01354">FreeConversationResources()</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00491">FreeDDEData()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00192">GetClientInfo</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00249">GetMessage()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00256">tagDDEMLDATA::hDDE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00133">tagXACT_INFO::hDDEResult</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00132">tagXACT_INFO::hDDESent</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00112">HINST_ANY</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00186">tagCL_INSTANCE_INFO::hInstClient</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00105">HTYPE_CLIENT_CONVERSATION</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00108">HTYPE_DATA_HANDLE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00107">HTYPE_TRANSACTION</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00124">tagXACT_INFO::hXact</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00205">IIF_IN_SYNC_XACT</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00095">InstFromHandle</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00094">InternalCreateDataHandle()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00069">LATOM_FROM_HSZ</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00438">LocalToGlobalAtom()</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05388">NtUserKillTimer()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06092">NtUserSetTimer()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00125">tagXACT_INFO::pfnResponse</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00219">tagCONV_INFO::state</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00140">TID_TIMEOUT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00204">ValidateCHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00019">tagDDE_DATA::wFmt</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00129">tagXACT_INFO::wStatus</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00018">tagDDE_DATA::wStatus</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00128">tagXACT_INFO::wType</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00138">XIF_ABANDONED</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00137">XIF_COMPLETE</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00136">XIF_SYNCHRONOUS</a>.
<p>
<pre class="fragment"><div>00033 {
00034     MSG <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00035     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00036     HDDEDATA hRet = 0;
00037     <a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a> pci;
00038     <a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a> pdd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00039     <a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi;
00040     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fStarted;
00041     <a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a> pdde;
00042 
00043     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00044 
00045     pci = (<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)hConv,
00046             HTYPE_CLIENT_CONVERSATION, HINST_ANY);
00047     <span class="keywordflow">if</span> (pci == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00048         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00049         <span class="keywordflow">goto</span> Exit;
00050     }
00051     pcii = pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>;
00052     <span class="keywordflow">if</span> (ulTimeout != TIMEOUT_ASYNC &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;CI_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a112">CI_IN_SYNC_TRANSACTION</a>) {
00053         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_REENTRANCY);
00054         <span class="keywordflow">goto</span> Exit;
00055     }
00056     <span class="keywordflow">if</span> (!(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_CONNECTED)) {
00057         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_NO_CONV_ESTABLISHED);
00058         <span class="keywordflow">goto</span> Exit;
00059     }
00060 
00061     <span class="keywordflow">switch</span> (wType) {
00062     <span class="keywordflow">case</span> XTYP_POKE:
00063     <span class="keywordflow">case</span> XTYP_ADVSTART:
00064     <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_NODATA:
00065     <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_ACKREQ:
00066     <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_NODATA | XTYPF_ACKREQ:
00067     <span class="keywordflow">case</span> XTYP_REQUEST:
00068     <span class="keywordflow">case</span> XTYP_ADVSTOP:
00069         <span class="keywordflow">if</span> (hszItem == 0) {
00070             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00071             <span class="keywordflow">goto</span> Exit;
00072         }
00073         <span class="keywordflow">break</span>;
00074 
00075     <span class="keywordflow">case</span> XTYP_EXECUTE: <span class="comment">// just ignore wFmt &amp; hszItem</span>
00076         <span class="keywordflow">break</span>;
00077 
00078     <span class="keywordflow">default</span>:
00079         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00080         <span class="keywordflow">goto</span> Exit;
00081     }
00082 
00083     pxi = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a0">DDEMLAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d0/structtagXACT__INFO.html">XACT_INFO</a>));
00084     <span class="keywordflow">if</span> (pxi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00085         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_MEMORY_ERROR);
00086         <span class="keywordflow">goto</span> Exit;
00087     }
00088 
00089     <span class="keywordflow">switch</span> (wType) {
00090     <span class="keywordflow">case</span> XTYP_EXECUTE:
00091     <span class="keywordflow">case</span> XTYP_POKE:
00092         <span class="keywordflow">if</span> ((LONG)cbData == -1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>) {
00093 
00094             <span class="comment">// We are accepting an existing data handle for export to another</span>
00095             <span class="comment">// app.</span>
00096 
00097             pdd = (<a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)pData,
00098                     HTYPE_DATA_HANDLE, HINST_ANY);
00099             <span class="keywordflow">if</span> (pdd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00100 InvParam:
00101                 <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00102                 <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxi);
00103                 <span class="keywordflow">goto</span> Exit;
00104             }
00105 
00106             <span class="comment">// make sure data handle holds apropriate data for this transaction</span>
00107 
00108             <span class="keywordflow">if</span> ((pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; HDATA_EXECUTE &amp;&amp; wType != XTYP_EXECUTE) ||
00109                     (!(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; HDATA_EXECUTE) &amp;&amp; wType == XTYP_EXECUTE)) {
00110                 <span class="keywordflow">goto</span> InvParam;
00111             }
00112 
00113             <span class="comment">// To simplify life, use a copy if this handle is potentially</span>
00114             <span class="comment">// a relay or APPOWNED handle.</span>
00115 
00116             <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; (HDATA_APPOWNED | HDATA_NOAPPFREE)) {
00117                 pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a> = <a class="code" href="../../d0/d9/hdata_8c.html#a13">CopyDDEData</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>, wType == XTYP_EXECUTE);
00118                 <span class="keywordflow">if</span> (!pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>) {
00119 MemErr:
00120                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxi);
00121                     <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_MEMORY_ERROR);
00122                     <span class="keywordflow">goto</span> Exit;
00123                 }
00124                 <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>, pdde);
00125                 <span class="keywordflow">if</span> (pdde == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00126                     <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>, TRUE, TRUE);
00127                     <span class="keywordflow">goto</span> MemErr;
00128                 }
00129                 pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o0">wStatus</a> = DDE_FRELEASE;
00130                 <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>);
00131             } <span class="keywordflow">else</span> {
00132                 pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a> = pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>;
00133             }
00134 
00135             <span class="comment">// make sure handle has proper format</span>
00136 
00137             <span class="keywordflow">if</span> (wType == XTYP_POKE) {
00138                 <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>, pdde);
00139                 <span class="keywordflow">if</span> (pdde == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00140                     <span class="keywordflow">goto</span> InvParam;
00141                 }
00142                 pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o1">wFmt</a> = (WORD)wFmt;
00143                 <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>);
00144             }
00145 
00146         } <span class="keywordflow">else</span> {  <span class="comment">// Convert data in buffer into an apropriate hDDE</span>
00147 
00148             <span class="keywordflow">if</span> (wType == XTYP_POKE) {
00149                 pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a> = <a class="code" href="../../d2/d6/stdptcl_8c.html#a22">AllocAndSetDDEData</a>(pData, cbData,
00150                         DDE_FRELEASE, (WORD)wFmt);
00151             } <span class="keywordflow">else</span> {
00152                 pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a> = <a class="code" href="../../d2/d6/stdptcl_8c.html#a22">AllocAndSetDDEData</a>(pData, cbData, 0, 0);
00153             }
00154             <span class="keywordflow">if</span> (!pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>) {
00155                 <span class="keywordflow">goto</span> MemErr;
00156             }
00157         }
00158     }
00159 
00160     <span class="comment">// FINALLY - start the transaction</span>
00161 
00162     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a> = (<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)pci;
00163     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a> = <a class="code" href="../../d4/d2/hsz_8c.html#a12">LocalToGlobalAtom</a>(<a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hszItem)); <span class="comment">// pxi copy</span>
00164     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a> = (WORD)wFmt;
00165     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a> = (WORD)wType;
00166 
00167     <span class="keywordflow">switch</span> (wType) {
00168     <span class="keywordflow">case</span> XTYP_ADVSTART:
00169     <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_NODATA:
00170     <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_ACKREQ:
00171     <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_NODATA | XTYPF_ACKREQ:
00172         fStarted = <a class="code" href="../../d2/d6/stdptcl_8c.html#a0">ClStartAdvise</a>(pxi);
00173         <span class="keywordflow">break</span>;
00174 
00175     <span class="keywordflow">case</span> XTYP_ADVSTOP:
00176         fStarted = <a class="code" href="../../d2/d6/stdptcl_8c.html#a6">ClStartUnadvise</a>(pxi);
00177         <span class="keywordflow">break</span>;
00178 
00179     <span class="keywordflow">case</span> XTYP_EXECUTE:
00180         fStarted = <a class="code" href="../../d2/d6/stdptcl_8c.html#a11">ClStartExecute</a>(pxi);
00181         <span class="keywordflow">break</span>;
00182 
00183     <span class="keywordflow">case</span> XTYP_POKE:
00184         fStarted = <a class="code" href="../../d2/d6/stdptcl_8c.html#a14">ClStartPoke</a>(pxi);
00185         <span class="keywordflow">break</span>;
00186 
00187     <span class="keywordflow">case</span> XTYP_REQUEST:
00188         fStarted = <a class="code" href="../../d2/d6/stdptcl_8c.html#a17">ClStartRequest</a>(pxi);
00189     }
00190 
00191     <span class="keywordflow">if</span> (!fStarted) {
00192         <span class="comment">// if we copied or allocated data - free it.</span>
00193         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a> &amp;&amp; (pdd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a> != pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>)) {
00194             <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>, FALSE, TRUE);     <span class="comment">// free data copy</span>
00195         }
00196         GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>); <span class="comment">// pxi copy</span>
00197         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxi);
00198         <span class="keywordflow">goto</span> Exit;
00199     }
00200 
00201     <span class="keywordflow">if</span> (pdd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; !(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; (HDATA_NOAPPFREE | HDATA_APPOWNED))) {
00202 
00203         <span class="comment">// invalidate given handle on success - unless we copied it because</span>
00204         <span class="comment">// the app will either be return ing it from a callback or potentially</span>
00205         <span class="comment">// using it again.</span>
00206 
00207         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pdd);
00208         <a class="code" href="../../d3/d8/handles_8c.html#a7">DestroyHandle</a>((HANDLE)pData);
00209     }
00210 
00211     <span class="keywordflow">if</span> (ulTimeout == TIMEOUT_ASYNC) {
00212 
00213         <span class="comment">// asynchronous transaction</span>
00214 
00215         <span class="keywordflow">if</span> (pulResult != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00216             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a> = <a class="code" href="../../d3/d8/handles_8c.html#a6">CreateHandle</a>((ULONG_PTR)pxi, HTYPE_TRANSACTION,
00217                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a28">InstFromHandle</a>(pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o2">hInstClient</a>));
00218             *pulResult = HandleToUlong(pxi-&gt;hXact);
00219         }
00220         hRet = (HDDEDATA)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00221 
00222     } <span class="keywordflow">else</span> {
00223 
00224         <span class="comment">// synchronous transaction</span>
00225 
00226         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;CI_flags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a112">CI_IN_SYNC_TRANSACTION</a>;
00227         pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o16">flags</a> |= <a class="code" href="../../d0/d4/ddemlcli_8h.html#a49">IIF_IN_SYNC_XACT</a>;
00228 
00229         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a> |= <a class="code" href="../../d0/d4/ddemlcli_8h.html#a43">XIF_SYNCHRONOUS</a>;
00230         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a230">NtUserSetTimer</a>(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, TID_TIMEOUT, ulTimeout, NULL);
00231 
00232         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00233         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a9">CheckDDECritOut</a>;
00234 
00235         <a class="code" href="../../d0/d8/ntcftxt_8h.html#a16">GetMessage</a>(&amp;msg, (HWND)NULL, 0, 0);
00236 
00237         <span class="comment">/*</span>
00238 <span class="comment">         * stay in modal loop until a timeout happens.</span>
00239 <span class="comment">         */</span>
00240         <span class="keywordflow">while</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.hwnd != pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a> || <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.message != WM_TIMER ||
00241             (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.wParam != <a class="code" href="../../d0/d4/ddemlcli_8h.html#a46">TID_TIMEOUT</a>)) {
00242 
00243             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d8/ntcftxt_8h.html#a38">CallMsgFilter</a>(&amp;msg, MSGF_DDEMGR))
00244                 <a class="code" href="../../d5/d9/cltxt_8h.html#a24">DispatchMessage</a>(&amp;msg);
00245 
00246             <a class="code" href="../../d0/d8/ntcftxt_8h.html#a16">GetMessage</a>(&amp;msg, (HWND)NULL, 0, 0);
00247         }
00248 
00249         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00250 
00251         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a208">NtUserKillTimer</a>(pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, TID_TIMEOUT);
00252         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;CI_flags &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a112">CI_IN_SYNC_TRANSACTION</a>;
00253         pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o16">flags</a> &amp;= ~<a class="code" href="../../d0/d4/ddemlcli_8h.html#a49">IIF_IN_SYNC_XACT</a>;
00254 
00255         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a> &amp; <a class="code" href="../../d0/d4/ddemlcli_8h.html#a44">XIF_COMPLETE</a>) {
00256             <span class="keywordflow">if</span> (pulResult != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00257                 *pulResult = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a>; <span class="comment">// NACK status bits</span>
00258             }
00259             <span class="keywordflow">switch</span> (wType) {
00260             <span class="keywordflow">case</span> XTYP_ADVSTART:
00261             <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_NODATA:
00262             <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_ACKREQ:
00263             <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_NODATA | XTYPF_ACKREQ:
00264             <span class="keywordflow">case</span> XTYP_ADVSTOP:
00265             <span class="keywordflow">case</span> XTYP_EXECUTE:
00266             <span class="keywordflow">case</span> XTYP_POKE:
00267                 hRet = (HDDEDATA)((pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> &amp; DDE_FACK) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00268                 <span class="keywordflow">if</span> (!hRet) {
00269                     <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> &amp; DDE_FBUSY) {
00270                         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_BUSY);
00271                     } <span class="keywordflow">else</span> {
00272                         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_NOTPROCESSED);
00273                     }
00274                 }
00275                 <span class="keywordflow">break</span>;
00276 
00277             <span class="keywordflow">case</span> XTYP_REQUEST:
00278                 <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a> == 0) {
00279                     hRet = (HDDEDATA)((pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> &amp; DDE_FACK) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00280                     <span class="keywordflow">if</span> (!hRet) {
00281                         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a> &amp; DDE_FBUSY) {
00282                             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_BUSY);
00283                         } <span class="keywordflow">else</span> {
00284                             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_NOTPROCESSED);
00285                         }
00286                     }
00287                     <span class="keywordflow">break</span>;
00288                 }
00289                 <span class="comment">// Note that if the incoming data didn't have the DDE_FRELEASE</span>
00290                 <span class="comment">// bit set, the transaction code would have made a copy so</span>
00291                 <span class="comment">// the app is free to keep is as long as he likes.</span>
00292 
00293                 hRet = <a class="code" href="../../d0/d9/hdata_8c.html#a2">InternalCreateDataHandle</a>(pcii, (LPBYTE)pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a>, (DWORD)-1, 0,
00294                         HDATA_READONLY, 0, 0);
00295                 pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a> = 0; <span class="comment">// so cleanup doesn't free it.</span>
00296             }
00297 
00298             (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o4">pfnResponse</a>)((<span class="keyword">struct </span><a class="code" href="../../d0/d0/structtagXACT__INFO.html">tagXACT_INFO</a> *)pxi, 0, 0); <span class="comment">// cleanup transaction</span>
00299 
00300         } <span class="keywordflow">else</span> {    <span class="comment">// Timed out</span>
00301 
00302             <span class="comment">// abandon the transaction and make it asyncronous so it will</span>
00303             <span class="comment">// clean itself up when the response finally comes in.</span>
00304 
00305             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a> &amp;= ~<a class="code" href="../../d0/d4/ddemlcli_8h.html#a43">XIF_SYNCHRONOUS</a>;
00306             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a> |= <a class="code" href="../../d0/d4/ddemlcli_8h.html#a45">XIF_ABANDONED</a>;
00307 
00308             <span class="keywordflow">switch</span> (wType) {
00309             <span class="keywordflow">case</span> XTYP_ADVSTART:
00310             <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_NODATA:
00311             <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_ACKREQ:
00312             <span class="keywordflow">case</span> XTYP_ADVSTART | XTYPF_NODATA | XTYPF_ACKREQ:
00313                 <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_ADVACKTIMEOUT);
00314                 <span class="keywordflow">break</span>;
00315             <span class="keywordflow">case</span> XTYP_ADVSTOP:
00316                 <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_UNADVACKTIMEOUT);
00317                 <span class="keywordflow">break</span>;
00318             <span class="keywordflow">case</span> XTYP_EXECUTE:
00319                 <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_EXECACKTIMEOUT);
00320                 <span class="keywordflow">break</span>;
00321             <span class="keywordflow">case</span> XTYP_POKE:
00322                 <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_POKEACKTIMEOUT);
00323                 <span class="keywordflow">break</span>;
00324             <span class="keywordflow">case</span> XTYP_REQUEST:
00325                 <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_DATAACKTIMEOUT);
00326                 <span class="keywordflow">break</span>;
00327             }
00328             <span class="comment">// cleanup of pxi happens when transaction actually completes.</span>
00329         }
00330     }
00331     <span class="keywordflow">if</span> (pci-&gt;<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_FREE_CONV_RES_NOW) {
00332         <span class="comment">/*</span>
00333 <span class="comment">         * The conversation was terminated during the synchronous transaction</span>
00334 <span class="comment">         * so we need to clean up now that we are out of the loop.</span>
00335 <span class="comment">         */</span>
00336          <a class="code" href="../../d0/d4/ddemlcli_8h.html#a114">FreeConversationResources</a>((<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)pci);
00337     }
00338 
00339 Exit:
00340     <span class="comment">/*</span>
00341 <span class="comment">     * Because this API is capable of blocking DdeUninitialize(), we check</span>
00342 <span class="comment">     * before exit to see if it needs to be called.</span>
00343 <span class="comment">     */</span>
00344     <span class="keywordflow">if</span> (pcii != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00345             (pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o7">afCmd</a> &amp; APPCMD_UNINIT_ASAP) &amp;&amp;
00346             <span class="comment">// !(pcii-&gt;flags &amp; IIF_IN_SYNC_XACT) &amp;&amp;</span>
00347             !pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o17">cInDDEMLCallback</a>) {
00348         <a class="code" href="../../d9/d3/ddemlcli_8c.html#a5">DdeUninitialize</a>(HandleToUlong(pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o2">hInstClient</a>));
00349         hRet = 0;
00350     }
00351     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00352     <span class="keywordflow">return</span> (hRet);
00353 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="xact.c::DdePostAdvise" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DdePostAdvise           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>idInst</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HSZ&nbsp;</td>
          <td class="mdname" nowrap> <em>hszTopic</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HSZ&nbsp;</td>
          <td class="mdname" nowrap> <em>hszItem</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00665">665</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00154">ADVST_CHANGED</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00191">tagCL_INSTANCE_INFO::afCmd</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00225">tagCONV_INFO::aLinks</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00197">tagCL_INSTANCE_INFO::aServerLookup</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00336">BestSetLastDDEMLError()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00237">tagSVR_CONV_INFO::ci</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00201">tagCL_INSTANCE_INFO::cInDDEMLCallback</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00226">tagCONV_INFO::cLinks</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00227">tagCONV_INFO::cLocks</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00180">tagLINK_COUNT::Count</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00198">tagCL_INSTANCE_INFO::cServerLookupAlloc</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00016">DDEMLAlloc</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d0/d3/ddemlcli_8c-source.html#l00196">DdeUninitialize()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00200">tagCL_INSTANCE_INFO::flags</a>, <a class="el" href="../../d7/d4/connect_8c-source.html#l01354">FreeConversationResources()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00388">GetWindowLongPtr()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00685">GWLP_PSI</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00186">tagCL_INSTANCE_INFO::hInstClient</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00065">HSZT_INVALID</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00170">tagSERVER_LOOKUP::hwndServer</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00205">IIF_IN_SYNC_XACT</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00147">tagADVISE_LINK::laItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00177">tagLINK_COUNT::laItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00069">LATOM_FROM_HSZ</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00169">tagSERVER_LOOKUP::laTopic</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00175">tagLINK_COUNT::laTopic</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00211">tagCONV_INFO::next</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00174">tagLINK_COUNT::next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00146">tagADVISE_LINK::pLinkCount</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00202">tagCL_INSTANCE_INFO::pLinkCount</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00219">tagCONV_INFO::state</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00150">tagADVISE_LINK::state</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00179">tagLINK_COUNT::Total</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00611">UpdateLinkIfChanged()</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00340">ValidateHSZ()</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00111">ValidateInstance()</a>, and <a class="el" href="../../d0/d4/ddemlcli_8h.html#a59">XACT_INFO</a>.
<p>
<pre class="fragment"><div>00669 {
00670     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00671     <a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a> psi;
00672     <a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi;
00673     <a class="code" href="../../d2/d8/structtagADVISE__LINK.html">PADVISE_LINK</a> paLink;
00674     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, fSwapped, fFound;
00675     <span class="keywordtype">int</span> iServer, iLink;
00676     <a class="code" href="../../d0/d0/structtagLINK__COUNT.html">PLINK_COUNT</a> pLinkCount;
00677 <span class="preprocessor">#if DBG</span>
00678 <span class="preprocessor"></span>    <span class="keywordtype">int</span> cLinks;
00679 <span class="preprocessor">#endif</span>
00680 <span class="preprocessor"></span>
00681     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00682 
00683     pcii = <a class="code" href="../../d0/d4/instance_8c.html#a7">ValidateInstance</a>((HANDLE)LongToHandle( idInst ));
00684     <span class="keywordflow">if</span> (pcii == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00685         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00686         <span class="keywordflow">goto</span> Exit;
00687     }
00688     <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d2/hsz_8c.html#a9">ValidateHSZ</a>(hszTopic) == <a class="code" href="../../d0/d4/ddemlcli_8h.html#a10">HSZT_INVALID</a>) ||
00689             (<a class="code" href="../../d4/d2/hsz_8c.html#a9">ValidateHSZ</a>(hszItem) == <a class="code" href="../../d0/d4/ddemlcli_8h.html#a10">HSZT_INVALID</a>)) {
00690         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00691         <span class="keywordflow">goto</span> Exit;
00692     }
00693 
00694     <span class="comment">/*</span>
00695 <span class="comment">     * Initialize all link counters and check if any links qualify</span>
00696 <span class="comment">     */</span>
00697     fFound = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00698     <span class="keywordflow">for</span> (pLinkCount = pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o18">pLinkCount</a>;
00699             pLinkCount; pLinkCount = pLinkCount-&gt;<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o0">next</a>) {
00700         pLinkCount-&gt;<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o6">Count</a> = pLinkCount-&gt;<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o5">Total</a>;
00701         fFound |= pLinkCount-&gt;<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o1">laTopic</a> == <a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hszTopic) &amp;&amp;
00702                   pLinkCount-&gt;<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o3">laItem</a> == <a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hszItem);
00703     }
00704     <span class="keywordflow">if</span> (!fFound &amp;&amp; hszTopic &amp;&amp; hszItem) {
00705         fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00706         <span class="keywordflow">goto</span> Exit;
00707     }
00708 
00709     <span class="comment">/*</span>
00710 <span class="comment">     * preallocate incase we are low on memory.</span>
00711 <span class="comment">     */</span>
00712     pxi = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a0">DDEMLAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d0/structtagXACT__INFO.html">XACT_INFO</a>));
00713     <span class="keywordflow">if</span> (pxi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00714         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_MEMORY_ERROR);
00715         fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00716         <span class="keywordflow">goto</span> Exit;
00717     }
00718 
00719     <span class="comment">/*</span>
00720 <span class="comment">     * For each server window on the specified topic</span>
00721 <span class="comment">     */</span>
00722     <span class="keywordflow">for</span> (iServer = 0; iServer &lt; pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o14">cServerLookupAlloc</a>; iServer++) {
00723         <span class="keywordflow">if</span> (hszTopic == 0 ||
00724                 pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o13">aServerLookup</a>[iServer].<a class="code" href="../../d1/d6/structtagSERVER__LOOKUP.html#o1">laTopic</a> == <a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hszTopic)) {
00725 
00726             <span class="comment">/*</span>
00727 <span class="comment">             * For each conversation within that window</span>
00728 <span class="comment">             */</span>
00729             psi = (<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(
00730                     pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o13">aServerLookup</a>[iServer].<a class="code" href="../../d1/d6/structtagSERVER__LOOKUP.html#o2">hwndServer</a>, GWLP_PSI);
00731             UserAssert(psi != NULL &amp;&amp; psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a> == pcii);    <span class="comment">// sanity check</span>
00732             <span class="keywordflow">while</span> (psi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00733 
00734 
00735                 <span class="comment">/*</span>
00736 <span class="comment">                 * UpdateLinkIfChanged might leave the critical section so lock this conversation</span>
00737 <span class="comment">                 */</span>
00738                 psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o16">cLocks</a>++;
00739 
00740 <span class="preprocessor">                #if DBG</span>
00741 <span class="preprocessor"></span>                <span class="comment">/*</span>
00742 <span class="comment">                 * Rememeber the number of links so we can assert if they change during the loop below</span>
00743 <span class="comment">                 */</span>
00744                 cLinks = psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>;
00745 <span class="preprocessor">                #endif</span>
00746 <span class="preprocessor"></span>                <span class="comment">/*</span>
00747 <span class="comment">                 * For each active link on the given item...</span>
00748 <span class="comment">                 */</span>
00749                 <span class="keywordflow">for</span> (paLink = psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o14">aLinks</a>, iLink = 0;
00750                         iLink &lt; psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>; paLink++, iLink++) {
00751                     <span class="keywordflow">if</span> (hszItem == 0 ||
00752                             paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o1">laItem</a> == <a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hszItem)) {
00753 
00754 <span class="comment">// Bit of a hack here. For FACKREQ links, we don't want the server to</span>
00755 <span class="comment">// outrun the client so we set the ADVST_WAITING bit till the ack is</span>
00756 <span class="comment">// received. When the ack comes in, the protocol code has to search</span>
00757 <span class="comment">// the aLinks array again to locate the apropriate link state flags and</span>
00758 <span class="comment">// clear the ADVST_WAITING flag. At that time, if the ADVST_CHANGED flag</span>
00759 <span class="comment">// is set, it is cleared and another SvStartAdviseUpdate transaction</span>
00760 <span class="comment">// is started to get the link up to date.  To complicate matters,</span>
00761 <span class="comment">// the ACK contains no format information.  Thus we need to move</span>
00762 <span class="comment">// the Link info to the end of the list so that the right format</span>
00763 <span class="comment">// is updated when the ack comes in.</span>
00764 
00765                         paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o4">state</a> |= <a class="code" href="../../d0/d4/ddemlcli_8h.html#a48">ADVST_CHANGED</a>;
00766                         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d1/xact_8c.html#a8">UpdateLinkIfChanged</a>(paLink, pxi, &amp;psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>,
00767                                 &amp;psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o14">aLinks</a>[psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a> - 1],
00768                                 &amp;fSwapped, --paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o0">pLinkCount</a>-&gt;<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o6">Count</a>)) {
00769                             <span class="keywordflow">if</span> (fSwapped) {
00770                                 paLink--;
00771                             }
00772                             <span class="comment">/*</span>
00773 <span class="comment">                             * preallocate for next advise</span>
00774 <span class="comment">                             */</span>
00775                             pxi = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a0">DDEMLAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d0/structtagXACT__INFO.html">XACT_INFO</a>));
00776                             <span class="keywordflow">if</span> (pxi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00777                                 <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_MEMORY_ERROR);
00778                                 <span class="comment">/*</span>
00779 <span class="comment">                                 * Unlock the conversation</span>
00780 <span class="comment">                                 */</span>
00781                                 psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o16">cLocks</a>--;
00782                                 <span class="keywordflow">if</span> ((psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o16">cLocks</a> == 0) &amp;&amp; (psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_FREE_CONV_RES_NOW)) {
00783                                     RIPMSG1(RIP_ERROR, <span class="stringliteral">"DdePostAdvise: Conversation terminated. psi:%#p"</span>, psi);
00784                                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a114">FreeConversationResources</a>((<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)psi);
00785                                 }
00786                                 <span class="keywordflow">goto</span> Exit;
00787                             }
00788                         }
00789                         <span class="comment">/*</span>
00790 <span class="comment">                         * We might have left the crit sect...</span>
00791 <span class="comment">                         */</span>
00792                         UserAssert(pcii == <a class="code" href="../../d0/d4/instance_8c.html#a7">ValidateInstance</a>((HANDLE)LongToHandle( idInst )));
00793                     }
00794                 }
00795 <span class="preprocessor">                #if DBG</span>
00796 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (cLinks != psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>) {
00797                     RIPMSG1(RIP_ERROR, <span class="stringliteral">"DdePostAdvise: cLinks changed. psi:%#p"</span>, psi);
00798                 }
00799 <span class="preprocessor">                #endif</span>
00800 <span class="preprocessor"></span>
00801                 <span class="comment">/*</span>
00802 <span class="comment">                 * If the converstaion got nuked, stop working on this conversation chain.</span>
00803 <span class="comment">                 */</span>
00804                 psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o16">cLocks</a>--;
00805                 <span class="keywordflow">if</span> ((psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o16">cLocks</a> == 0) &amp;&amp; (psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_FREE_CONV_RES_NOW)) {
00806                     RIPMSG1(RIP_ERROR, <span class="stringliteral">"DdePostAdvise: Conversation terminated. psi:%#p"</span>, psi);
00807                     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a114">FreeConversationResources</a>((<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)psi);
00808                     <span class="keywordflow">break</span>;
00809                 }
00810 
00811                 psi = (<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html">PSVR_CONV_INFO</a>)psi-&gt;<a class="code" href="../../d5/d7/structtagSVR__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o0">next</a>;     <span class="comment">// next conversation</span>
00812             }
00813         }
00814     }
00815     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pxi);
00816     fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00817 
00818 Exit:
00819     <span class="comment">/*</span>
00820 <span class="comment">     * Because callbacks are capable of blocking DdeUninitialize(), we check</span>
00821 <span class="comment">     * before exit to see if it needs to be called.</span>
00822 <span class="comment">     */</span>
00823     UserAssert(pcii == <a class="code" href="../../d0/d4/instance_8c.html#a7">ValidateInstance</a>((HANDLE)LongToHandle( idInst )));
00824     <span class="keywordflow">if</span> (pcii != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00825             pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o7">afCmd</a> &amp; APPCMD_UNINIT_ASAP &amp;&amp;
00826             !(pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o16">flags</a> &amp; <a class="code" href="../../d0/d4/ddemlcli_8h.html#a49">IIF_IN_SYNC_XACT</a>) &amp;&amp;
00827             !pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o17">cInDDEMLCallback</a>) {
00828         <a class="code" href="../../d9/d3/ddemlcli_8c.html#a5">DdeUninitialize</a>(HandleToUlong(pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o2">hInstClient</a>));
00829         fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00830     }
00831     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00832     <span class="keywordflow">return</span> (fRet);
00833 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="xact.c::DdeQueryConvInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT DdeQueryConvInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HCONV&nbsp;</td>
          <td class="mdname" nowrap> <em>hConv</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>idTransaction</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCONVINFO&nbsp;</td>
          <td class="mdname" nowrap> <em>pConvInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00411">411</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d7/d4/connect_8c-source.html#l00107">DefConvContext</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00368">GetConvContext()</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00464">GlobalToLocalAtom()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00123">tagXACT_INFO::hUser</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00213">tagCONV_INFO::hUser</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00218">tagCONV_INFO::hwndConv</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00217">tagCONV_INFO::hwndPartner</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00215">tagCONV_INFO::laService</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00220">tagCONV_INFO::laServiceRequested</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00193">tagCL_INSTANCE_INFO::LastError</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00216">tagCONV_INFO::laTopic</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00070">NORMAL_HSZ_FROM_LATOM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00212">tagCONV_INFO::pcii</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00131">tagXACT_INFO::state</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00219">tagCONV_INFO::state</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00909">ValidateTransaction()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00128">tagXACT_INFO::wType</a>.
<p>
<pre class="fragment"><div>00415 {
00416     <a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> pcoi;
00417     <a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi;
00418     CONVINFO ci;
00419     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uiRet = 0;
00420 
00421     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00422 
00423     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d1/xact_8c.html#a12">ValidateTransaction</a>(hConv, (HANDLE)LongToHandle( idTransaction ), &amp;pcoi, &amp;pxi)) {
00424         <span class="keywordflow">goto</span> Exit;
00425     }
00426 
00427     <span class="keywordflow">try</span> {
00428         <span class="keywordflow">if</span> (pConvInfo-&gt;cb &gt; <span class="keyword">sizeof</span>(CONVINFO)) {
00429             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_INVALIDPARAMETER);
00430             <span class="keywordflow">goto</span> Exit;
00431         }
00432         ci.cb = pConvInfo-&gt;cb;
00433         ci.hConvPartner = 0; <span class="comment">// no longer supported.</span>
00434         ci.hszSvcPartner = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o4">laService</a>);
00435         ci.hszServiceReq = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o9">laServiceRequested</a>);
00436         ci.hszTopic = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>);
00437         ci.wStatus = pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a>;
00438         ci.wLastError = (WORD)pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o9">LastError</a>;
00439         <span class="keywordflow">if</span> (pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_CLIENT) {
00440             ci.hConvList = ((<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)pcoi)-&gt;hConvList;
00441             <a class="code" href="../../d0/d1/xact_8c.html#a1">GetConvContext</a>(pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>, (LONG *)&amp;ci.ConvCtxt);
00442         } <span class="keywordflow">else</span> {
00443             ci.hConvList = 0;
00444             <span class="keywordflow">if</span> (pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_ISLOCAL) {
00445                 <a class="code" href="../../d0/d1/xact_8c.html#a1">GetConvContext</a>(pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>, (LONG *)&amp;ci.ConvCtxt);
00446             } <span class="keywordflow">else</span> {
00447                 ci.ConvCtxt = <a class="code" href="../../d6/d5/connect_8c.html#a4">DefConvContext</a>;
00448             }
00449         }
00450         <span class="keywordflow">if</span> (pxi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00451             ci.hUser = pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o2">hUser</a>;
00452             ci.hszItem = 0;
00453             ci.wFmt = 0;
00454             ci.wType = 0;
00455             ci.wConvst = XST_CONNECTED;
00456         } <span class="keywordflow">else</span> {
00457             ci.hUser = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o2">hUser</a>;
00458             <span class="comment">// BUG - not fixable - This will result in extra local atoms</span>
00459             <span class="comment">// since we can never know when he is done with them.</span>
00460             ci.hszItem = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(<a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>));
00461             ci.wFmt = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>;
00462             ci.wType = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a>;
00463             ci.wConvst = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a>;
00464         }
00465         ci.hwnd = pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>;
00466         ci.hwndPartner = pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>;
00467         RtlCopyMemory((LPSTR)pConvInfo, (LPSTR)&amp;ci, pConvInfo-&gt;cb);
00468     } except(W32ExceptionHandler(FALSE, RIP_WARNING)) {
00469         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>, DMLERR_INVALIDPARAMETER);
00470         <span class="keywordflow">goto</span> Exit;
00471     }
00472     uiRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00473 
00474 Exit:
00475     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00476     <span class="keywordflow">return</span> (uiRet);
00477 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="xact.c::DdeSetUserHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DdeSetUserHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HCONV&nbsp;</td>
          <td class="mdname" nowrap> <em>hConv</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>DWORD_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>hUser</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00489">489</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00123">tagXACT_INFO::hUser</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00213">tagCONV_INFO::hUser</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d1/d0/xact_8c-source.html#l00909">ValidateTransaction()</a>.
<p>
<pre class="fragment"><div>00493 {
00494     <a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> pcoi;
00495     <a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxi;
00496     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00497 
00498     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00499 
00500     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d1/xact_8c.html#a12">ValidateTransaction</a>(hConv, (HANDLE)LongToHandle( <span class="keywordtype">id</span> ), &amp;pcoi, &amp;pxi)) {
00501         <span class="keywordflow">goto</span> Exit;
00502     }
00503     <span class="keywordflow">if</span> (pxi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00504         pcoi-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o2">hUser</a> = hUser;
00505     } <span class="keywordflow">else</span> {
00506         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o2">hUser</a> = hUser;
00507     }
00508     fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00509 
00510 Exit:
00511     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00512     <span class="keywordflow">return</span> (fRet);
00513 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="xact.c::GetConvContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID GetConvContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG *&nbsp;</td>
          <td class="mdname" nowrap> <em>pl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00368">368</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00674">GWL_CONVCONTEXT</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00411">DdeQueryConvInfo()</a>, <a class="el" href="../../d7/d4/connect_8c-source.html#l00409">DdeReconnect()</a>, and <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00059">ProcessDDEMLInitiate()</a>.
<p>
<pre class="fragment"><div>00371 {
00372     <span class="keywordtype">int</span> i;
00373 
00374     <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(CONVCONTEXT); i += 4) {
00375         *pl++ = GetWindowLong(hwnd, GWL_CONVCONTEXT + i);
00376     }
00377 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="xact.c::LinkTransaction" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID LinkTransaction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pxi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00846">846</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00058">CheckDDECritIn</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00121">tagXACT_INFO::next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00221">tagCONV_INFO::pxiIn</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00222">tagCONV_INFO::pxiOut</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00067">ClStartAdvise()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00852">ClStartExecute()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01012">ClStartPoke()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01176">ClStartRequest()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00561">ClStartUnadvise()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00263">SvStartAdviseUpdate()</a>.
<p>
<pre class="fragment"><div>00848 {
00849     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a8">CheckDDECritIn</a>;
00850 
00851     pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00852     <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00853         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o10">pxiIn</a> = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a> = pxi;
00854     } <span class="keywordflow">else</span> {
00855         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o10">pxiIn</a>-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a> = pxi;
00856         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o10">pxiIn</a> = pxi;
00857     }
00858 <span class="preprocessor">#if DBG</span>
00859 <span class="preprocessor"></span>    <span class="comment">/*</span>
00860 <span class="comment">     * Temporary check to find stress bug - make sure pxi list is not</span>
00861 <span class="comment">     * looped on itself.  If it is, this loop will never exit and things</span>
00862 <span class="comment">     * will get investigated. (sanfords)</span>
00863 <span class="comment">     */</span>
00864     {
00865         <a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> pxiT;
00866 
00867         <span class="keywordflow">for</span> (pxiT = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a>; pxiT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; pxiT = pxiT-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>) {
00868             ;
00869         }
00870     }
00871 <span class="preprocessor">#endif // DBG</span>
00872 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="xact.c::SetConvContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetConvContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG *&nbsp;</td>
          <td class="mdname" nowrap> <em>pl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00387">387</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00674">GWL_CONVCONTEXT</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/connect_8c-source.html#l00607">ConnectConv()</a>.
<p>
<pre class="fragment"><div>00390 {
00391     <span class="keywordtype">int</span> i;
00392 
00393     <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(CONVCONTEXT); i += 4) {
00394         SetWindowLong(hwnd, GWL_CONVCONTEXT + i, *pl++);
00395     }
00396 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="xact.c::UnlinkTransaction" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UnlinkTransaction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pxi</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00885">885</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00058">CheckDDECritIn</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00121">tagXACT_INFO::next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00221">tagCONV_INFO::pxiIn</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00222">tagCONV_INFO::pxiOut</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00190">ClRespAdviseAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00958">ClRespExecuteAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01116">ClRespPokeAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">ClRespRequestData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00719">ClRespUnadviseAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00470">SvRespAdviseDataAck()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01624">TransactionComplete()</a>.
<p>
<pre class="fragment"><div>00887 {
00888     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a8">CheckDDECritIn</a>;
00889     <span class="keywordflow">if</span> (pxi == pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a>) {
00890         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a> = pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>;
00891         <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00892             pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>-&gt;<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o10">pxiIn</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00893         }
00894     }
00895 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="xact.c::UpdateLinkIfChanged" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL UpdateLinkIfChanged           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d8/structtagADVISE__LINK.html">PADVISE_LINK</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>paLink</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pxi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pcoi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d2/d8/structtagADVISE__LINK.html">PADVISE_LINK</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>paLinkLast</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PBOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>pfSwapped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cLinksToGo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00611">611</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00154">ADVST_CHANGED</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00153">ADVST_WAITING</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00058">CheckDDECritIn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00126">tagXACT_INFO::gaItem</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00147">tagADVISE_LINK::laItem</a>, <a class="el" href="../../d5/d1/hsz_8c-source.html#l00438">LocalToGlobalAtom()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00122">tagXACT_INFO::pcoi</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00125">tagXACT_INFO::pfnResponse</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00150">tagADVISE_LINK::state</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00470">SvRespAdviseDataAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00263">SvStartAdviseUpdate()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00148">tagADVISE_LINK::wFmt</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00127">tagXACT_INFO::wFmt</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00149">tagADVISE_LINK::wType</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00128">tagXACT_INFO::wType</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00665">DdePostAdvise()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00470">SvRespAdviseDataAck()</a>.
<p>
<pre class="fragment"><div>00618 {
00619     <a class="code" href="../../d2/d8/structtagADVISE__LINK.html">ADVISE_LINK</a> aLinkT;
00620 
00621     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a8">CheckDDECritIn</a>;
00622 
00623     *pfSwapped = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00624     <span class="keywordflow">if</span> (paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o4">state</a> &amp; <a class="code" href="../../d0/d4/ddemlcli_8h.html#a48">ADVST_CHANGED</a> &amp;&amp; !(paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o4">state</a> &amp; <a class="code" href="../../d0/d4/ddemlcli_8h.html#a47">ADVST_WAITING</a>)) {
00625         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o4">pfnResponse</a> = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a146">SvRespAdviseDataAck</a>;
00626         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a> = pcoi;
00627         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a> = <a class="code" href="../../d4/d2/hsz_8c.html#a12">LocalToGlobalAtom</a>(paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o1">laItem</a>);    <span class="comment">// pxi copy</span>
00628         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a> = paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o2">wFmt</a>;
00629         pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a> = paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o3">wType</a>;
00630         paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o4">state</a> &amp;= ~<a class="code" href="../../d0/d4/ddemlcli_8h.html#a48">ADVST_CHANGED</a>;
00631         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/stdptcl_8c.html#a3">SvStartAdviseUpdate</a>(pxi, cLinksToGo)) {
00632             <span class="keywordflow">if</span> (pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a> &amp; DDE_FACKREQ) {
00633                 paLink-&gt;<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o4">state</a> |= <a class="code" href="../../d0/d4/ddemlcli_8h.html#a47">ADVST_WAITING</a>;
00634                 <span class="comment">/*</span>
00635 <span class="comment">                 * swap paLink with the last non-moved link to make ack search find</span>
00636 <span class="comment">                 * oldest updated format.</span>
00637 <span class="comment">                 */</span>
00638                 <span class="keywordflow">if</span> (paLink != paLinkLast) {
00639                     aLinkT = *paLink;
00640                     RtlMoveMemory(paLink, paLink + 1,
00641                             (PBYTE)paLinkLast - (PBYTE)paLink);
00642                     *paLinkLast = aLinkT;
00643                     *pfSwapped = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00644                 }
00645             }
00646             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00647         } <span class="keywordflow">else</span> {
00648             GlobalDeleteAtom(pxi-&gt;<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>);  <span class="comment">// pxi copy</span>
00649             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00650         }
00651     }
00652     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00653 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="xact.c::ValidateTransaction" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ValidateTransaction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HCONV&nbsp;</td>
          <td class="mdname" nowrap> <em>hConv</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hXact</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppcoi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppxi</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/xact_8c-source.html#l00909">909</a> of file <a class="el" href="../../d1/d0/xact_8c-source.html">xact.c</a>.
<p>
References <a class="el" href="../../d4/d7/handles_8c-source.html#l00336">BestSetLastDDEMLError()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00112">HINST_ANY</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00105">HTYPE_CLIENT_CONVERSATION</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00104">HTYPE_SERVER_CONVERSATION</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00107">HTYPE_TRANSACTION</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00095">InstFromHandle</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00204">ValidateCHandle()</a>, and <a class="el" href="../../d1/d3/instance_8c-source.html#l00111">ValidateInstance()</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00560">DdeAbandonTransaction()</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00411">DdeQueryConvInfo()</a>, and <a class="el" href="../../d1/d0/xact_8c-source.html#l00489">DdeSetUserHandle()</a>.
<p>
<pre class="fragment"><div>00914 {
00915     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00916 
00917     *ppcoi = (<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)hConv,
00918             HTYPE_CLIENT_CONVERSATION, HINST_ANY);
00919     <span class="keywordflow">if</span> (*ppcoi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00920         *ppcoi = (<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)hConv,
00921                 HTYPE_SERVER_CONVERSATION, HINST_ANY);
00922     }
00923     <span class="keywordflow">if</span> (*ppcoi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00924         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00925         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00926     }
00927     pcii = <a class="code" href="../../d0/d4/instance_8c.html#a7">ValidateInstance</a>((*ppcoi)-&gt;pcii-&gt;hInstClient);
00928     <span class="keywordflow">if</span> (pcii != (*ppcoi)-&gt;pcii) {
00929         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00930         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00931     }
00932 
00933     <span class="keywordflow">if</span> (hXact == (HANDLE)IntToPtr( QID_SYNC )) {
00934         *ppxi = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00935     } <span class="keywordflow">else</span> {
00936         *ppxi = (<a class="code" href="../../d0/d0/structtagXACT__INFO.html">PXACT_INFO</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>(hXact, HTYPE_TRANSACTION,
00937                 <a class="code" href="../../d0/d4/ddemlcli_8h.html#a28">InstFromHandle</a>((*ppcoi)-&gt;pcii-&gt;hInstClient));
00938         <span class="keywordflow">if</span> (*ppxi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00939             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>((*ppcoi)-&gt;pcii, DMLERR_INVALIDPARAMETER);
00940             <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00941         }
00942     }
00943     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00944 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:46:10 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
