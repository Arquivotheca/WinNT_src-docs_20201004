<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: psquota.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>psquota.c File Reference</h1><code>#include "<a class="el" href="../../d9/d0/psp_8h-source.html">psp.h</a>"</code><br>

<p>
<a href="../../d1/d1/psquota_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d2/psquota_8c.html#a0">PsChargeSharedPoolQuota</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN SIZE_T PagedAmount, IN SIZE_T NonPagedAmount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d2/psquota_8c.html#a1">PsReturnSharedPoolQuota</a> (IN <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a> QuotaBlock, IN SIZE_T PagedAmount, IN SIZE_T NonPagedAmount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d2/psquota_8c.html#a2">PsChargePoolQuota</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN SIZE_T Amount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d2/psquota_8c.html#a3">PsReturnPoolQuota</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN SIZE_T Amount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d2/psquota_8c.html#a4">PspInheritQuota</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> NewProcess, IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> ParentProcess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d2/psquota_8c.html#a5">MiReturnPageFileQuota</a> (IN SIZE_T QuotaCharge, IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> CurrentProcess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d2/psquota_8c.html#a6">PspDereferenceQuota</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="psquota.c::MiReturnPageFileQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID MiReturnPageFileQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>QuotaCharge</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CurrentProcess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00133">133</a> of file <a class="el" href="../../d7/d0/mmquota_8c-source.html">mmquota.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00113">_EPROCESS_QUOTA_BLOCK::PagefileUsage</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00046">PspDefaultQuotaBlock</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00107">_EPROCESS_QUOTA_BLOCK::QuotaLock</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00030">MiInsertVad()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00256">MiRemoveVad()</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00869">MiReturnPageTablePageCommitment()</a>, <a class="el" href="../../d1/d8/protect_8c-source.html#l01110">MiSetProtectionOnSection()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, <a class="el" href="../../d4/d6/freevm_8c-source.html#l00066">NtFreeVirtualMemory()</a>, and <a class="el" href="../../d1/d1/psquota_8c-source.html#l00494">PspDereferenceQuota()</a>.
<p>
<pre class="fragment"><div>00140                    :
00141 
00142     This routine releases page <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> quota.
00143 
00144 Arguments:
00145 
00146     QuotaCharge - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> quota amount to charge.
00147 
00148     CurrentProcess - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process.
00149 
00150 Return Value:
00151 
00152     none.
00153 
00154 Environment:
00155 
00156     Kernel mode, APCs disabled, WorkingSetLock and AddressCreation mutexes
00157     held.
00158 
00159 --*/
00160 
00161 {
00162 
00163     <a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a> QuotaBlock;
00164     KIRQL OldIrql;
00165 
00166     QuotaBlock = CurrentProcess-&gt;QuotaBlock;
00167 
00168 retry_return:
00169     <span class="keywordflow">if</span> ( QuotaBlock != &amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>) {
00170         ExAcquireFastLock (&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>, &amp;OldIrql);
00171 do_return:
00172         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (CurrentProcess-&gt;PagefileUsage &gt;= QuotaCharge);
00173         CurrentProcess-&gt;PagefileUsage -= QuotaCharge;
00174 
00175         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o6">PagefileUsage</a> &gt;= QuotaCharge);
00176         QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o6">PagefileUsage</a> -= QuotaCharge;
00177         ExReleaseFastLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00178     } <span class="keywordflow">else</span> {
00179         ExAcquireFastLock (&amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>, &amp;OldIrql);
00180         <span class="keywordflow">if</span> ( (QuotaBlock = CurrentProcess-&gt;QuotaBlock) != &amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a> ) {
00181             ExReleaseFastLock(&amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00182             <span class="keywordflow">goto</span> retry_return;
00183         }
00184         <span class="keywordflow">goto</span> do_return;
00185     }
00186     <span class="keywordflow">return</span>;
00187 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="psquota.c::PsChargePoolQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsChargePoolQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>Amount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/psquota_8c-source.html#l00246">246</a> of file <a class="el" href="../../d1/d1/psquota_8c-source.html">psquota.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l01118">MmRaisePoolQuota()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a160">ProcessObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00579">PsInitialSystemProcess</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00098">PspDefaultNonPagedLimit</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00097">PspDefaultPagedLimit</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00046">PspDefaultQuotaBlock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00107">_EPROCESS_QUOTA_BLOCK::QuotaLock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00109">_EPROCESS_QUOTA_BLOCK::QuotaPeakPoolUsage</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00111">_EPROCESS_QUOTA_BLOCK::QuotaPoolLimit</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00110">_EPROCESS_QUOTA_BLOCK::QuotaPoolUsage</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">ExAllocatePoolWithQuota()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02607">ExAllocatePoolWithQuotaTag()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01475">ExpAllocateHandleTable()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01825">ExpAllocateHandleTableEntry()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02555">FsRtlCancelNotify()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00973">FsRtlNotifyFullReportChange()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l00100">MiCloneProcessAddressSpace()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00030">MiInsertVad()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00970">NtAllocateUserPhysicalPages()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l01235">NtSetLdtEntries()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00503">PspSetLdtInformation()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01235">VdmpDelayInterrupt()</a>, and <a class="el" href="../../d8/d3/vdminit_8c-source.html#l00019">VdmpInitialize()</a>.
<p>
<pre class="fragment"><div>00254                    :
00255 
00256     This function charges <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to
00257     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified process. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> quota charge would exceed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> limits
00258     allowed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process, then an exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> raised and quota <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00259     not charged.
00260 
00261 Arguments:
00262 
00263     Process - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process to charge quota to.
00264 
00265     PoolType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota to charge.
00266 
00267     Amount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota to charge.
00268 
00269 Return Value:
00270 
00271     Raises STATUS_QUOTA_EXCEEDED <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> quota charge would exceed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00272         limits allowed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process.
00273 
00274 --*/
00275 
00276 {
00277 
00278     KIRQL OldIrql;
00279     SIZE_T NewPoolUsage;
00280     <a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a> QuotaBlock;
00281     SIZE_T NewLimit;
00282     SIZE_T HardLimit;
00283 
00284     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((Process-&gt;Pcb.Header.Type == ProcessObject) || (Process-&gt;Pcb.Header.Type == 0));
00285 
00286     QuotaBlock = Process-&gt;QuotaBlock;
00287 
00288 retry_charge:
00289     <span class="keywordflow">if</span> ( QuotaBlock != &amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a> ) {
00290         ExAcquireSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,&amp;OldIrql);
00291 do_charge:
00292         NewPoolUsage = QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[PoolType] + Amount;
00293 
00294         <span class="comment">//</span>
00295         <span class="comment">// See if enough quota exists in the block to satisfy the</span>
00296         <span class="comment">// request</span>
00297         <span class="comment">//</span>
00298 
00299         <span class="keywordflow">if</span> ( NewPoolUsage &gt; QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[PoolType] ) {
00300             <span class="keywordflow">if</span> ( PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> ) {
00301                 HardLimit = <a class="code" href="../../d8/d0/cmdat3_8c.html#a41">PspDefaultPagedLimit</a>;
00302                 }
00303             <span class="keywordflow">else</span> {
00304                 HardLimit = <a class="code" href="../../d8/d0/cmdat3_8c.html#a42">PspDefaultNonPagedLimit</a>;
00305                 }
00306 
00307             <span class="keywordflow">while</span> ( (HardLimit == 0) &amp;&amp; <a class="code" href="../../d6/d1/mmquota_8c.html#a23">MmRaisePoolQuota</a>(PoolType,QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[PoolType],&amp;NewLimit) ) {
00308                 QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[PoolType] = NewLimit;
00309                 <span class="keywordflow">if</span> ( NewPoolUsage &lt;= NewLimit ) {
00310                     <span class="keywordflow">goto</span> LimitRaised2;
00311                     }
00312                 }
00313 
00314 <span class="comment">//DbgPrint("PS: ChargePool Failed P %8x QB %8x PT %8x Amount %8x\n",Process,QuotaBlock,PoolType,Amount);DbgBreakPoint();</span>
00315             ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00316             <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>(STATUS_QUOTA_EXCEEDED);
00317             }
00318 LimitRaised2:
00319         <span class="keywordflow">if</span> ( NewPoolUsage &lt; QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[PoolType] ||
00320              NewPoolUsage &lt; Amount ) {
00321 
00322             ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00323             <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>(STATUS_QUOTA_EXCEEDED);
00324             }
00325 
00326         QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[PoolType] = NewPoolUsage;
00327         <span class="keywordflow">if</span> ( NewPoolUsage &gt; QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o2">QuotaPeakPoolUsage</a>[PoolType] ) {
00328             QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o2">QuotaPeakPoolUsage</a>[PoolType] = NewPoolUsage;
00329             }
00330 
00331         NewPoolUsage = Process-&gt;QuotaPoolUsage[PoolType] + Amount;
00332         Process-&gt;QuotaPoolUsage[PoolType] = NewPoolUsage;
00333         <span class="keywordflow">if</span> ( NewPoolUsage &gt; Process-&gt;QuotaPeakPoolUsage[PoolType] ) {
00334             Process-&gt;QuotaPeakPoolUsage[PoolType] = NewPoolUsage;
00335             }
00336 
00337         ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00338         }
00339     <span class="keywordflow">else</span> {
00340         <span class="keywordflow">if</span> ( Process == <a class="code" href="../../d1/d9/ps_8h.html#a53">PsInitialSystemProcess</a> ) {
00341             <span class="keywordflow">return</span>;
00342             }
00343 
00344         ExAcquireSpinLock(&amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,&amp;OldIrql);
00345         <span class="keywordflow">if</span> ( (QuotaBlock = Process-&gt;QuotaBlock) != &amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a> ) {
00346             ExReleaseSpinLock(&amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00347             <span class="keywordflow">goto</span> retry_charge;
00348             }
00349         <span class="keywordflow">goto</span> do_charge;
00350 
00351         }
00352 
00353 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="psquota.c::PsChargeSharedPoolQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a> PsChargeSharedPoolQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>PagedAmount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NonPagedAmount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/psquota_8c-source.html#l00024">24</a> of file <a class="el" href="../../d1/d1/psquota_8c-source.html">psquota.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l01118">MmRaisePoolQuota()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a160">ProcessObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00579">PsInitialSystemProcess</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00098">PspDefaultNonPagedLimit</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00097">PspDefaultPagedLimit</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00046">PspDefaultQuotaBlock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00107">_EPROCESS_QUOTA_BLOCK::QuotaLock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00109">_EPROCESS_QUOTA_BLOCK::QuotaPeakPoolUsage</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00111">_EPROCESS_QUOTA_BLOCK::QuotaPoolLimit</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00110">_EPROCESS_QUOTA_BLOCK::QuotaPoolUsage</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00108">_EPROCESS_QUOTA_BLOCK::ReferenceCount</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01861">ObpChargeQuotaForObject()</a>.
<p>
<pre class="fragment"><div>00032                    :
00033 
00034     This function charges shared <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>
00035     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified process's pooled quota block.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> quota charge
00036     would exceed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> limits allowed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process, then an exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00037     raised and quota <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not charged.
00038 
00039 Arguments:
00040 
00041     Process - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process to charge quota to.
00042 
00043     PagedAmount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount of paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota to charge.
00044 
00045     PagedAmount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount of non paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota to charge.
00046 
00047 Return Value:
00048 
00049     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Quota was exceeded
00050 
00051     NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> referenced pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> quota block that was charged
00052 
00053 --*/
00054 
00055 {
00056 
00057     KIRQL OldIrql;
00058     SIZE_T NewPoolUsage;
00059     <a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a> QuotaBlock;
00060     SIZE_T NewLimit;
00061 
00062     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((Process-&gt;Pcb.Header.Type == ProcessObject) || (Process-&gt;Pcb.Header.Type == 0));
00063 
00064     QuotaBlock = Process-&gt;QuotaBlock;
00065 
00066 retry_charge:
00067     <span class="keywordflow">if</span> ( QuotaBlock != &amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a> ) {
00068         ExAcquireSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,&amp;OldIrql);
00069 do_charge:
00070 
00071         <span class="keywordflow">if</span> ( PagedAmount ) {
00072 
00073             NewPoolUsage = QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] + PagedAmount;
00074 
00075             <span class="comment">//</span>
00076             <span class="comment">// See if enough quota exists in the block to satisfy the</span>
00077             <span class="comment">// request</span>
00078             <span class="comment">//</span>
00079 
00080             <span class="keywordflow">if</span> ( NewPoolUsage &gt; QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] ) {
00081                 <span class="keywordflow">while</span> ( (<a class="code" href="../../d8/d0/cmdat3_8c.html#a41">PspDefaultPagedLimit</a> == 0) &amp;&amp; <a class="code" href="../../d6/d1/mmquota_8c.html#a23">MmRaisePoolQuota</a>(PagedPool,QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[PagedPool],&amp;NewLimit) ) {
00082                     QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] = NewLimit;
00083                     <span class="keywordflow">if</span> ( NewPoolUsage &lt;= NewLimit ) {
00084                         <span class="keywordflow">goto</span> LimitRaised0;
00085                         }
00086                     }
00087 <span class="comment">//DbgPrint("PS: ChargeShared(0) Failed P %8x QB %8x PA %8x NPA %8x\n",Process,QuotaBlock,PagedAmount,NonPagedAmount);DbgBreakPoint();</span>
00088                 ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00089                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00090                 }
00091 LimitRaised0:
00092             <span class="keywordflow">if</span> ( NewPoolUsage &lt; QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] ||
00093                  NewPoolUsage &lt; PagedAmount ) {
00094 
00095                 ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00096 <span class="comment">//DbgPrint("PS: ChargeShared(1) Failed P %8x QB %8x PA %8x NPA %8x\n",Process,QuotaBlock,PagedAmount,NonPagedAmount);DbgBreakPoint();</span>
00097                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00098                 }
00099 
00100             QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] = NewPoolUsage;
00101             <span class="keywordflow">if</span> ( NewPoolUsage &gt; QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o2">QuotaPeakPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] ) {
00102                 QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o2">QuotaPeakPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] = NewPoolUsage;
00103                 }
00104             }
00105 
00106         <span class="keywordflow">if</span> ( NonPagedAmount ) {
00107 
00108             NewPoolUsage = QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] + NonPagedAmount;
00109 
00110             <span class="comment">//</span>
00111             <span class="comment">// See if enough quota exists in the block to satisfy the</span>
00112             <span class="comment">// request</span>
00113             <span class="comment">//</span>
00114 
00115             <span class="keywordflow">if</span> ( NewPoolUsage &gt; QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] ) {
00116                 <span class="keywordflow">while</span> ( (<a class="code" href="../../d8/d0/cmdat3_8c.html#a42">PspDefaultNonPagedLimit</a> == 0) &amp;&amp; <a class="code" href="../../d6/d1/mmquota_8c.html#a23">MmRaisePoolQuota</a>(NonPagedPool,QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[NonPagedPool],&amp;NewLimit) ) {
00117                     QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] = NewLimit;
00118                     <span class="keywordflow">if</span> ( NewPoolUsage &lt;= NewLimit ) {
00119                         <span class="keywordflow">goto</span> LimitRaised1;
00120                         }
00121                     }
00122                 <span class="keywordflow">if</span> ( PagedAmount ) {
00123                     QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] -= PagedAmount;
00124                     }
00125                 ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00126 <span class="comment">//DbgPrint("PS: ChargeShared(2) Failed P %8x QB %8x PA %8x NPA %8x\n",Process,QuotaBlock,PagedAmount,NonPagedAmount);DbgBreakPoint();</span>
00127                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00128                 }
00129 
00130 LimitRaised1:
00131             <span class="keywordflow">if</span> ( NewPoolUsage &lt; QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] ||
00132                  NewPoolUsage &lt; NonPagedAmount ) {
00133                 <span class="keywordflow">if</span> ( PagedAmount ) {
00134                     QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] -= PagedAmount;
00135                     }
00136 
00137                 ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00138 <span class="comment">//DbgPrint("PS: ChargeShared(3) Failed P %8x QB %8x PA %8x NPA %8x\n",Process,QuotaBlock,PagedAmount,NonPagedAmount);DbgBreakPoint();</span>
00139                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00140                 }
00141 
00142             QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] = NewPoolUsage;
00143             <span class="keywordflow">if</span> ( NewPoolUsage &gt; QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o2">QuotaPeakPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] ) {
00144                 QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o2">QuotaPeakPoolUsage</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] = NewPoolUsage;
00145                 }
00146             }
00147 
00148         QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o1">ReferenceCount</a>++;
00149         ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00150         }
00151     <span class="keywordflow">else</span> {
00152 
00153         <span class="comment">//</span>
00154         <span class="comment">// Don't do ANY quota operations on the initial system process</span>
00155         <span class="comment">//</span>
00156 
00157         <span class="keywordflow">if</span> ( Process == <a class="code" href="../../d1/d9/ps_8h.html#a53">PsInitialSystemProcess</a> ) {
00158             <span class="keywordflow">return</span> (<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a>)1;
00159             }
00160 
00161         ExAcquireSpinLock(&amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,&amp;OldIrql);
00162         <span class="keywordflow">if</span> ( (QuotaBlock = Process-&gt;QuotaBlock) != &amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a> ) {
00163             ExReleaseSpinLock(&amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00164             <span class="keywordflow">goto</span> retry_charge;
00165             }
00166         <span class="keywordflow">goto</span> do_charge;
00167 
00168         }
00169     <span class="keywordflow">return</span> QuotaBlock;
00170 
00171 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="psquota.c::PspDereferenceQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspDereferenceQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Process</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/psquota_8c-source.html#l00494">494</a> of file <a class="el" href="../../d1/d1/psquota_8c-source.html">psquota.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00133">MiReturnPageFileQuota()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d1/psquota_8c-source.html#l00356">PsReturnPoolQuota()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00107">_EPROCESS_QUOTA_BLOCK::QuotaLock</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00108">_EPROCESS_QUOTA_BLOCK::ReferenceCount</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01363">PspProcessDelete()</a>.
<p>
<pre class="fragment"><div>00497 {
00498     <a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a> QuotaBlock;
00499     KIRQL OldIrql;
00500 
00501     QuotaBlock = Process-&gt;QuotaBlock;
00502 
00503     <a class="code" href="../../d0/d2/psquota_8c.html#a3">PsReturnPoolQuota</a>(Process,NonPagedPool,Process-&gt;QuotaPoolUsage[NonPagedPool]);
00504     <a class="code" href="../../d0/d2/psquota_8c.html#a3">PsReturnPoolQuota</a>(Process,PagedPool,Process-&gt;QuotaPoolUsage[PagedPool]);
00505     <a class="code" href="../../d0/d2/psquota_8c.html#a5">MiReturnPageFileQuota</a>(Process-&gt;PagefileUsage,Process);
00506 
00507     ExAcquireSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,&amp;OldIrql);
00508 
00509     QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o1">ReferenceCount</a>--;
00510     <span class="keywordflow">if</span> ( QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o1">ReferenceCount</a> == 0 ) {
00511         ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00512         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(QuotaBlock);
00513         }
00514     <span class="keywordflow">else</span> {
00515         ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00516         }
00517 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="psquota.c::PspInheritQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspInheritQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NewProcess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ParentProcess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/psquota_8c-source.html#l00466">466</a> of file <a class="el" href="../../d1/d1/psquota_8c-source.html">psquota.c</a>.
<p>
References <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00046">PspDefaultQuotaBlock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00107">_EPROCESS_QUOTA_BLOCK::QuotaLock</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00108">_EPROCESS_QUOTA_BLOCK::ReferenceCount</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>.
<p>
<pre class="fragment"><div>00470 {
00471     <a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a> QuotaBlock;
00472     KIRQL OldIrql;
00473 
00474     <span class="keywordflow">if</span> ( ParentProcess ) {
00475         QuotaBlock = ParentProcess-&gt;QuotaBlock;
00476         }
00477     <span class="keywordflow">else</span> {
00478         QuotaBlock = &amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>;
00479         }
00480 
00481     ExAcquireSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,&amp;OldIrql);
00482     QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o1">ReferenceCount</a>++;
00483     NewProcess-&gt;QuotaBlock = QuotaBlock;
00484     ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00485 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="psquota.c::PsReturnPoolQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsReturnPoolQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>Amount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/psquota_8c-source.html#l00356">356</a> of file <a class="el" href="../../d1/d1/psquota_8c-source.html">psquota.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l02010">MMNONPAGED_QUOTA_INCREASE</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l02012">MMPAGED_QUOTA_INCREASE</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l01212">MmReturnPoolQuota()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a160">ProcessObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00579">PsInitialSystemProcess</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00046">PspDefaultQuotaBlock</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00116">PspDoingGiveBacks</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00107">_EPROCESS_QUOTA_BLOCK::QuotaLock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00111">_EPROCESS_QUOTA_BLOCK::QuotaPoolLimit</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00110">_EPROCESS_QUOTA_BLOCK::QuotaPoolUsage</a>, and <a class="el" href="../../d3/d0/mm_8h-source.html#l00117">ROUND_TO_PAGES</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02760">ExFreePoolWithTag()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01475">ExpAllocateHandleTable()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01825">ExpAllocateHandleTableEntry()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01667">ExpFreeHandleTable()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03480">ExReturnPoolQuota()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02555">FsRtlCancelNotify()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l01795">FsRtlNotifyCleanup()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02000">FsRtlNotifyCompleteIrp()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00973">FsRtlNotifyFullReportChange()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l02313">MiCleanPhysicalProcessPages()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l00100">MiCloneProcessAddressSpace()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l01745">MiDecrementCloneBlockReference()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00030">MiInsertVad()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02641">MiPhysicalViewRemover()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00256">MiRemoveVad()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00970">NtAllocateUserPhysicalPages()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, <a class="el" href="../../d1/d1/psquota_8c-source.html#l00494">PspDereferenceQuota()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00503">PspSetLdtInformation()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00308">PspSetLdtSize()</a>, and <a class="el" href="../../d8/d3/vdminit_8c-source.html#l00019">VdmpInitialize()</a>.
<p>
<pre class="fragment"><div>00364                    :
00365 
00366     This function returns <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00367     specified process.
00368 
00369 Arguments:
00370 
00371     Process - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process to <span class="keywordflow">return</span> quota to.
00372 
00373     PoolType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota to <span class="keywordflow">return</span>.
00374 
00375     Amount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota to <span class="keywordflow">return</span>
00376 
00377 Return Value:
00378 
00379     Raises STATUS_QUOTA_EXCEEDED <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> quota charge would exceed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00380         limits allowed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process.
00381 
00382 --*/
00383 
00384 {
00385 
00386     KIRQL OldIrql;
00387     <a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a> QuotaBlock;
00388     SIZE_T GiveBackLimit;
00389     SIZE_T RoundedUsage;
00390 
00391     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((Process-&gt;Pcb.Header.Type == ProcessObject) || (Process-&gt;Pcb.Header.Type == 0));
00392 
00393     QuotaBlock = Process-&gt;QuotaBlock;
00394 retry_return:
00395     <span class="keywordflow">if</span> ( QuotaBlock != &amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>) {
00396         ExAcquireSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,&amp;OldIrql);
00397 
00398         <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d1/psinit_8c.html#a23">PspDoingGiveBacks</a> ) {
00399             <span class="keywordflow">if</span> ( PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a> ) {
00400                 GiveBackLimit = <a class="code" href="../../d2/d1/mm_8h.html#a29">MMPAGED_QUOTA_INCREASE</a>;
00401                 }
00402             <span class="keywordflow">else</span> {
00403                 GiveBackLimit = <a class="code" href="../../d2/d1/mm_8h.html#a28">MMNONPAGED_QUOTA_INCREASE</a>;
00404                 }
00405             }
00406         <span class="keywordflow">else</span> {
00407             GiveBackLimit = 0;
00408             }
00409 do_return:
00410         <span class="keywordflow">if</span> ( Amount &lt;= Process-&gt;QuotaPoolUsage[PoolType] ) {
00411             Process-&gt;QuotaPoolUsage[PoolType] -= Amount;
00412             }
00413         <span class="keywordflow">else</span> {
00414             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
00415             GiveBackLimit = 0;
00416             Process-&gt;QuotaPoolUsage[PoolType] = 0;
00417             }
00418 
00419         <span class="keywordflow">if</span> ( Amount &lt;= QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[PoolType] ) {
00420             QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[PoolType] -= Amount;
00421             }
00422         <span class="keywordflow">else</span> {
00423             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
00424             GiveBackLimit = 0;
00425             QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[PoolType] = 0;
00426             }
00427 
00428         <span class="keywordflow">if</span> ( GiveBackLimit ) {
00429             <span class="keywordflow">if</span> (QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[PoolType] - QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[PoolType] &gt; GiveBackLimit ) {
00430 
00431                 <span class="comment">//</span>
00432                 <span class="comment">// round up the current usage to a page multiple</span>
00433                 <span class="comment">//</span>
00434 
00435                 RoundedUsage = <a class="code" href="../../d2/d1/mm_8h.html#a4">ROUND_TO_PAGES</a>(QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o3">QuotaPoolUsage</a>[PoolType]);
00436 
00437                 <span class="comment">//</span>
00438                 <span class="comment">// Give back the limit minus the rounded usage</span>
00439                 <span class="comment">//</span>
00440 
00441                 GiveBackLimit = QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[PoolType] - RoundedUsage;
00442                 QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o4">QuotaPoolLimit</a>[PoolType] -= GiveBackLimit;
00443                 <a class="code" href="../../d6/d1/mmquota_8c.html#a24">MmReturnPoolQuota</a>(PoolType,GiveBackLimit);
00444 
00445                 }
00446             }
00447         ExReleaseSpinLock(&amp;QuotaBlock-&gt;<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00448         }
00449     <span class="keywordflow">else</span> {
00450 
00451         <span class="keywordflow">if</span> ( Process == <a class="code" href="../../d1/d9/ps_8h.html#a53">PsInitialSystemProcess</a> ) {
00452             <span class="keywordflow">return</span>;
00453             }
00454 
00455         ExAcquireSpinLock(&amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,&amp;OldIrql);
00456         <span class="keywordflow">if</span> ( (QuotaBlock = Process-&gt;QuotaBlock) != &amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>) {
00457             ExReleaseSpinLock(&amp;<a class="code" href="../../d6/d1/mmquota_8c.html#a11">PspDefaultQuotaBlock</a>.<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html#o0">QuotaLock</a>,OldIrql);
00458             <span class="keywordflow">goto</span> retry_return;
00459             }
00460         GiveBackLimit = 0;
00461         <span class="keywordflow">goto</span> do_return;
00462         }
00463 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="psquota.c::PsReturnSharedPoolQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsReturnSharedPoolQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>QuotaBlock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>PagedAmount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SIZE_T&nbsp;</td>
          <td class="mdname" nowrap> <em>NonPagedAmount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/psquota_8c-source.html#l00174">174</a> of file <a class="el" href="../../d1/d1/psquota_8c-source.html">psquota.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, and <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>.
<p>
<pre class="fragment"><div>00182                    :
00183 
00184     This function returns <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00185     specified process.
00186 
00187 Arguments:
00188 
00189     QuotaBlock - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> quota block to <span class="keywordflow">return</span> quota to.
00190 
00191     PagedAmount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount of paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota to <span class="keywordflow">return</span>.
00192 
00193     PagedAmount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount of non paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota to <span class="keywordflow">return</span>.
00194 
00195 Return Value:
00196 
00197     None.
00198 
00199 --*/
00200 
00201 {
00202 
00203     KIRQL OldIrql;
00204 
00205     <span class="comment">//</span>
00206     <span class="comment">// if we bypassed the quota charge, don't do anything here either</span>
00207     <span class="comment">//</span>
00208 
00209     <span class="keywordflow">if</span> ( QuotaBlock == (<a class="code" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a>)1 ) {
00210         <span class="keywordflow">return</span>;
00211         }
00212 
00213     ExAcquireSpinLock(&amp;QuotaBlock-&gt;QuotaLock,&amp;OldIrql);
00214 
00215     <span class="keywordflow">if</span> ( PagedAmount ) {
00216 
00217         <span class="keywordflow">if</span> ( PagedAmount &lt;= QuotaBlock-&gt;QuotaPoolUsage[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] ) {
00218             QuotaBlock-&gt;QuotaPoolUsage[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] -= PagedAmount;
00219             }
00220         <span class="keywordflow">else</span> {
00221             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
00222             QuotaBlock-&gt;QuotaPoolUsage[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>] = 0;
00223             }
00224         }
00225     <span class="keywordflow">if</span> ( NonPagedAmount ) {
00226 
00227         <span class="keywordflow">if</span> ( NonPagedAmount &lt;= QuotaBlock-&gt;QuotaPoolUsage[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] ) {
00228             QuotaBlock-&gt;QuotaPoolUsage[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] -= NonPagedAmount;
00229             }
00230         <span class="keywordflow">else</span> {
00231             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
00232             QuotaBlock-&gt;QuotaPoolUsage[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>] = 0;
00233             }
00234         }
00235     QuotaBlock-&gt;ReferenceCount--;
00236     <span class="keywordflow">if</span> ( QuotaBlock-&gt;ReferenceCount == 0 ) {
00237         ExReleaseSpinLock(&amp;QuotaBlock-&gt;QuotaLock,OldIrql);
00238         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(QuotaBlock);
00239         }
00240     <span class="keywordflow">else</span> {
00241         ExReleaseSpinLock(&amp;QuotaBlock-&gt;QuotaLock,OldIrql);
00242         }
00243 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
