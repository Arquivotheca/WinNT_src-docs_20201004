<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ntcb.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ntcb.h</h1><a href="../../d9/d7/ntcb_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: ntcb.h</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* Kernel mode sending stubs</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* 07-06-91 ScottLu      Created.</span>
00009 <span class="comment">\***************************************************************************/</span>
00010 
00011 <span class="comment">// If SERVER is UNICODE</span>
00012 <span class="comment">//   Copy UNICODE -&gt; UNICODE</span>
00013 <span class="comment">//   or Copy ANSI -&gt; UNICODE</span>
00014 
00015 <span class="comment">// prototypes to client side functions only called by these stubs</span>
00016 
00017 <span class="comment">// ddetrack.c</span>
00018 
00019 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   <a class="code" href="../../d9/d7/ntcb_8h.html#a90">_ClientCopyDDEIn1</a>(HANDLE hClient, <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi);
00020 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>   <a class="code" href="../../d9/d7/ntcb_8h.html#a91">_ClientCopyDDEIn2</a>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi);
00021 HANDLE <a class="code" href="../../d9/d7/ntcb_8h.html#a92">_ClientCopyDDEOut1</a>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi);
00022 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d7/ntcb_8h.html#a93">xxxClientCopyDDEIn2</a>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi);
00023 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d7/ntcb_8h.html#a94">FixupDdeExecuteIfNecessary</a>(HGLOBAL *phCommands, BOOL fNeedUnicode);
00024 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   <a class="code" href="../../d9/d7/ntcb_8h.html#a95">_ClientCopyDDEOut2</a>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi);
00025 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   <a class="code" href="../../d9/d7/ntcb_8h.html#a96">_ClientFreeDDEHandle</a>(HANDLE hDDE, DWORD flags);
00026 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  <a class="code" href="../../d9/d7/ntcb_8h.html#a97">_ClientGetDDEFlags</a>(HANDLE hDDE, DWORD flags);
00027 
00028 
<a name="l00029"></a><a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">00029</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">_GENERICHOOKHEADER</a> {
<a name="l00030"></a><a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o0">00030</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o0">nCode</a>;
<a name="l00031"></a><a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">00031</a>     WPARAM <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>;
<a name="l00032"></a><a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">00032</a>     ULONG_PTR <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>;
<a name="l00033"></a><a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">00033</a>     PROC <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>;
00034 } <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">GENERICHOOKHEADER</a>, * <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">LPGENERICHOOKHEADER</a>;
00035 
00036 <span class="preprocessor">#ifdef RECVSIDE</span>
00037 <span class="preprocessor"></span>ULONG_PTR CallHookWithSEH(<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">GENERICHOOKHEADER</a> *pmsg, LPVOID pData, LPDWORD pFlags, ULONG_PTR retval) {
00038 
00039     <span class="keywordflow">try</span> {
00040         retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
00041                 pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o0">nCode</a>,
00042                 pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
00043                 pData,
00044                 pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
00045 
00046     } except ((*pFlags &amp; HF_GLOBAL) ? W32ExceptionHandler(FALSE, RIP_WARNING) : EXCEPTION_CONTINUE_SEARCH) {
00047         RIPMSG0(RIP_WARNING, <span class="stringliteral">"Hook Faulted"</span>);
00048         *pFlags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a506">HF_HOOKFAULTED</a>;
00049     }
00050 
00051     <span class="keywordflow">return</span> retval;
00052 }
00053 <span class="preprocessor">#endif // RECVSIDE</span>
00054 <span class="preprocessor"></span>
00055 <span class="preprocessor">#if DBG</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#ifdef SENDSIDE</span>
00057 <span class="preprocessor"></span>__inline <span class="keywordtype">void</span> CheckPublicDC (LPSTR lpszStr, HDC hdc)
00058 {
00059     W32PID pid;
00060     pid = GreGetObjectOwner((HOBJ)hdc, DC_TYPE);
00061     <span class="keywordflow">if</span>(pid == OBJECT_OWNER_PUBLIC) {
00062         RIPMSG1(RIP_ERROR, lpszStr, hdc);
00063     }
00064 }
00065 <span class="preprocessor">#endif // SENDSIDE</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00067 <span class="preprocessor"></span>
00068 
00069 <span class="comment">/**************************************************************************\</span>
00070 <span class="comment">* fnOUTDWORDDWORD</span>
00071 <span class="comment">*</span>
00072 <span class="comment">* 14-Aug-1992 mikeke    created</span>
00073 <span class="comment">\**************************************************************************/</span>
00074 
<a name="l00075"></a><a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html">00075</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html">_FNOUTDWORDDWORDMSG</a> {
<a name="l00076"></a><a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html#o0">00076</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html#o0">pwnd</a>;
<a name="l00077"></a><a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html#o1">00077</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html#o1">msg</a>;
<a name="l00078"></a><a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html#o2">00078</a>     ULONG_PTR <a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html#o2">xParam</a>;
<a name="l00079"></a><a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html#o3">00079</a>     PROC <a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html#o3">xpfnProc</a>;
00080 } <a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html">FNOUTDWORDDWORDMSG</a>;
00081 
00082 <span class="preprocessor">#ifdef SENDSIDE</span>
00083 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(OUTDWORDDWORD)
00084 {
00085     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNOUTDWORDDWORD)
00086 
00087     UNREFERENCED_PARAMETER(dwSCMSFlags);
00088 
00089     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNOUTDWORDDWORD)
00090 
00091         LPDWORD lpdwW = (LPDWORD)wParam;
00092         LPDWORD lpdwL = (LPDWORD)lParam;
00093 
00094         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
00095         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00096         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00097         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00098 
00099         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00100         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNOUTDWORDDWORD);
00101         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00102         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00103 
00104         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
00105             <span class="keywordflow">try</span> {
00106                 *lpdwW = <a class="code" href="../../d5/d8/ex_8h.html#a20">ProbeAndReadUlong</a>((LPDWORD)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput);
00107                 *lpdwL = <a class="code" href="../../d5/d8/ex_8h.html#a20">ProbeAndReadUlong</a>((LPDWORD)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput + 1);
00108             } except (W32ExceptionHandler(TRUE, RIP_WARNING)) {
00109                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00110             }
00111         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
00112 
00113     TRACECALLBACKMSG("SfnOUTDWORDDWORD");
00114     ENDSEND(DWORD,0);
00115 }
00116 #endif <span class="comment">// SENDSIDE</span>
00117 
00118 #ifdef RECVSIDE
00119 RECVCALL(fnOUTDWORDDWORD, <a class="code" href="../../d3/d8/struct__FNOUTDWORDDWORDMSG.html">FNOUTDWORDDWORDMSG</a>)
00120 {
00121     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> adwOut[2];
00122     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, adwOut, <span class="keyword">sizeof</span>(adwOut));
00123 
00124     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
00125             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
00126             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
00127             &amp;adwOut[0],
00128             &amp;adwOut[1],
00129             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
00130 
00131     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
00132 }
00133 <span class="preprocessor">#endif // RECVSIDE</span>
00134 <span class="preprocessor"></span>
00135 <span class="comment">/**************************************************************************\</span>
00136 <span class="comment">* fnOUTDWORDINDWORD</span>
00137 <span class="comment">*</span>
00138 <span class="comment">* 04-May-1993 IanJa     created (for MN_FINDMENUWINDOWFROMPOINT)</span>
00139 <span class="comment">\**************************************************************************/</span>
00140 
<a name="l00141"></a><a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html">00141</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html">_FNOUTDWORDINDWORDMSG</a> {
<a name="l00142"></a><a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o0">00142</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o0">pwnd</a>;
<a name="l00143"></a><a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o1">00143</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o1">msg</a>;
<a name="l00144"></a><a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o2">00144</a>     WPARAM <a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o2">wParam</a>;
<a name="l00145"></a><a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o3">00145</a>     LPARAM <a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o3">lParam</a>;
<a name="l00146"></a><a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o4">00146</a>     ULONG_PTR <a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o4">xParam</a>;
<a name="l00147"></a><a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o5">00147</a>     PROC <a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html#o5">xpfnProc</a>;
00148 } <a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html">FNOUTDWORDINDWORDMSG</a>;
00149 
00150 <span class="preprocessor">#ifdef SENDSIDE</span>
00151 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(OUTDWORDINDWORD)
00152 {
00153     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNOUTDWORDINDWORD)
00154 
00155     UNREFERENCED_PARAMETER(dwSCMSFlags);
00156 
00157     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNOUTDWORDINDWORD)
00158 
00159         LPDWORD lpdwW = (LPDWORD)wParam;
00160 
00161         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
00162         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00163         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = lParam;
00164         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00165         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00166 
00167         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00168         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNOUTDWORDINDWORD);
00169         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00170         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00171 
00172         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
00173             <span class="keywordflow">try</span> {
00174                 *lpdwW = <a class="code" href="../../d5/d8/ex_8h.html#a20">ProbeAndReadUlong</a>((LPDWORD)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput);
00175             } except (W32ExceptionHandler(TRUE, RIP_WARNING)) {
00176                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00177             }
00178         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
00179 
00180     TRACECALLBACKMSG("SfnOUTDWORDINDWORD");
00181     ENDSEND(DWORD,0);
00182 }
00183 #endif <span class="comment">// SENDSIDE</span>
00184 
00185 #ifdef RECVSIDE
00186 RECVCALL(fnOUTDWORDINDWORD, <a class="code" href="../../d4/d8/struct__FNOUTDWORDINDWORDMSG.html">FNOUTDWORDINDWORDMSG</a>)
00187 {
00188     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOut;
00189     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;dwOut, <span class="keyword">sizeof</span>(dwOut));
00190 
00191     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
00192             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
00193             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
00194             &amp;dwOut,
00195             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(lParam),
00196             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
00197 
00198     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
00199 }
00200 <span class="preprocessor">#endif // RECVSIDE</span>
00201 <span class="preprocessor"></span>
00202 <span class="comment">/**************************************************************************\</span>
00203 <span class="comment">* fnOPTOUTLPDWORDOPTOUTLPDWORD</span>
00204 <span class="comment">*</span>
00205 <span class="comment">* 25-Nov-1992 JonPa    created</span>
00206 <span class="comment">\**************************************************************************/</span>
00207 
<a name="l00208"></a><a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html">00208</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html">_FNOPTOUTLPDWORDOPTOUTLPDWORDMSG</a> {
<a name="l00209"></a><a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html#o0">00209</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html#o0">pwnd</a>;
<a name="l00210"></a><a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html#o1">00210</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html#o1">msg</a>;
<a name="l00211"></a><a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html#o2">00211</a>     ULONG_PTR <a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html#o2">xParam</a>;
<a name="l00212"></a><a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html#o3">00212</a>     PROC <a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html#o3">xpfnProc</a>;
00213 } <a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html">FNOPTOUTLPDWORDOPTOUTLPDWORDMSG</a>;
00214 
00215 <span class="preprocessor">#ifdef SENDSIDE</span>
00216 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(OPTOUTLPDWORDOPTOUTLPDWORD)
00217 {
00218     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNOPTOUTLPDWORDOPTOUTLPDWORD)
00219 
00220     UNREFERENCED_PARAMETER(dwSCMSFlags);
00221 
00222     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNOPTOUTLPDWORDOPTOUTLPDWORD)
00223 
00224         LPDWORD lpdwW = (LPDWORD)wParam;
00225         LPDWORD lpdwL = (LPDWORD)lParam;
00226 
00227         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
00228         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00229         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00230         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00231 
00232         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00233         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNOPTOUTLPDWORDOPTOUTLPDWORD);
00234         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00235         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00236 
00237         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
00238             <span class="keywordflow">try</span> {
00239                 <span class="keywordflow">if</span> (lpdwW != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00240                     *lpdwW = <a class="code" href="../../d5/d8/ex_8h.html#a20">ProbeAndReadUlong</a>((LPDWORD)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput);
00241                 <span class="keywordflow">if</span> (lpdwL != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00242                     *lpdwL = <a class="code" href="../../d5/d8/ex_8h.html#a20">ProbeAndReadUlong</a>((LPDWORD)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput + 1);
00243             } except (W32ExceptionHandler(TRUE, RIP_WARNING)) {
00244                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00245             }
00246         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
00247 
00248     TRACECALLBACKMSG("SfnOPTOUTLPDWORDOPTOUTLPDWORD");
00249     ENDSEND(DWORD,0);
00250 }
00251 #endif <span class="comment">// SENDSIDE</span>
00252 
00253 #ifdef RECVSIDE
00254 RECVCALL(fnOPTOUTLPDWORDOPTOUTLPDWORD, <a class="code" href="../../d2/d8/struct__FNOPTOUTLPDWORDOPTOUTLPDWORDMSG.html">FNOPTOUTLPDWORDOPTOUTLPDWORDMSG</a>)
00255 {
00256     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> adwOut[2];
00257     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, adwOut, <span class="keyword">sizeof</span>(adwOut));
00258 
00259     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
00260             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
00261             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
00262             &amp;adwOut[0],
00263             &amp;adwOut[1],
00264             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
00265 
00266     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
00267 }
00268 <span class="preprocessor">#endif // RECVSIDE</span>
00269 <span class="preprocessor"></span>
00270 <span class="comment">/**************************************************************************\</span>
00271 <span class="comment">* fnDWORDOPTINLPMSG</span>
00272 <span class="comment">*</span>
00273 <span class="comment">* 03-30-92 scottlu      Created</span>
00274 <span class="comment">\**************************************************************************/</span>
00275 
<a name="l00276"></a><a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html">00276</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html">_FNDWORDOPTINLPMSGMSG</a> {
<a name="l00277"></a><a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o0">00277</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o0">pwnd</a>;
<a name="l00278"></a><a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o1">00278</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o1">msg</a>;
<a name="l00279"></a><a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o2">00279</a>     WPARAM <a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o2">wParam</a>;
<a name="l00280"></a><a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o3">00280</a>     LPMSG <a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o3">pmsgstruct</a>;
<a name="l00281"></a><a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o4">00281</a>     ULONG_PTR <a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o4">xParam</a>;
<a name="l00282"></a><a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o5">00282</a>     PROC <a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o5">xpfnProc</a>;
<a name="l00283"></a><a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o6">00283</a>     MSG <a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html#o6">msgstruct</a>;
00284 } <a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html">FNDWORDOPTINLPMSGMSG</a>;
00285 
00286 <span class="preprocessor">#ifdef SENDSIDE</span>
00287 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(DWORDOPTINLPMSG)
00288 {
00289     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNDWORDOPTINLPMSG)
00290 
00291     UNREFERENCED_PARAMETER(dwSCMSFlags);
00292     UNREFERENCED_PARAMETER(psms);
00293 
00294     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNDWORDOPTINLPMSG)
00295 
00296         LPMSG pmsgstruct = (LPMSG)lParam;
00297 
00298         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
00299         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00300         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
00301         <a class="code" href="../../d3/d5/ssend_8c.html#a36">COPYSTRUCTOPT</a>(msgstruct);
00302         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00303         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00304 
00305         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00306         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNDWORDOPTINLPMSG);
00307         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00308         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00309 
00310     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnDWORDOPTINLPMSG"</span>);
00311     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
00312 }
00313 <span class="preprocessor">#endif // SENDSIDE</span>
00314 <span class="preprocessor"></span>
00315 <span class="preprocessor">#ifdef RECVSIDE</span>
00316 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnDWORDOPTINLPMSG, <a class="code" href="../../d4/d3/struct__FNDWORDOPTINLPMSGMSG.html">FNDWORDOPTINLPMSGMSG</a>)
00317 {
00318     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
00319 
00320     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
00321             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
00322             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
00323             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
00324             <a class="code" href="../../d5/d8/crecv_8c.html#a12">PCALLDATAOPT</a>(msgstruct),
00325             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
00326 
00327     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
00328 }
00329 <span class="preprocessor">#endif // RECVSIDE</span>
00330 <span class="preprocessor"></span>
00331 <span class="comment">/**************************************************************************\</span>
00332 <span class="comment">* fnCOPYGLOBALDATA</span>
00333 <span class="comment">*</span>
00334 <span class="comment">* 6-20-92 Sanfords created</span>
00335 <span class="comment">\**************************************************************************/</span>
00336 
<a name="l00337"></a><a class="code" href="../../d2/d3/struct__FNCOPYGLOBALDATAMSG.html">00337</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d3/struct__FNCOPYGLOBALDATAMSG.html">_FNCOPYGLOBALDATAMSG</a> {
<a name="l00338"></a><a class="code" href="../../d2/d3/struct__FNCOPYGLOBALDATAMSG.html#o0">00338</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d2/d3/struct__FNCOPYGLOBALDATAMSG.html#o0">CaptureBuf</a>;
<a name="l00339"></a><a class="code" href="../../d2/d3/struct__FNCOPYGLOBALDATAMSG.html#o1">00339</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d3/struct__FNCOPYGLOBALDATAMSG.html#o1">cbSize</a>;
<a name="l00340"></a><a class="code" href="../../d2/d3/struct__FNCOPYGLOBALDATAMSG.html#o2">00340</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pData;
00341 } <a class="code" href="../../d2/d3/struct__FNCOPYGLOBALDATAMSG.html">FNCOPYGLOBALDATAMSG</a>;
00342 
00343 <span class="preprocessor">#ifdef SENDSIDE</span>
00344 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(COPYGLOBALDATA)
00345 {
00346     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pData = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lParam;
00347 
00348     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNCOPYGLOBALDATA)
00349 
00350     UNREFERENCED_PARAMETER(<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>);
00351     UNREFERENCED_PARAMETER(xParam);
00352     UNREFERENCED_PARAMETER(xpfnProc);
00353     UNREFERENCED_PARAMETER(dwSCMSFlags);
00354     UNREFERENCED_PARAMETER(psms);
00355 
00356     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNCOPYGLOBALDATA, 1, wParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
00357 
00358         <span class="keywordflow">if</span> (pData == 0) {
00359             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
00360         }
00361 
00362         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)wParam;
00363         <a class="code" href="../../d3/d5/ssend_8c.html#a40">LARGECOPYBYTES</a>(pData, (DWORD)wParam);
00364 
00365         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00366         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNCOPYGLOBALDATA);
00367         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00368         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00369 
00370     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnCOPYGLOBALDATA"</span>);
00371     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(DWORD,0);
00372 }
00373 <span class="preprocessor">#endif // SENDSIDE</span>
00374 <span class="preprocessor"></span>
00375 <span class="preprocessor">#ifdef RECVSIDE</span>
00376 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnCOPYGLOBALDATA, <a class="code" href="../../d2/d3/struct__FNCOPYGLOBALDATAMSG.html">FNCOPYGLOBALDATAMSG</a>)
00377 {
00378     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> p;
00379 
00380     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
00381     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
00382 
00383     retval = (ULONG_PTR)GlobalAlloc(GMEM_MOVEABLE, <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(cbSize));
00384     <span class="keywordflow">if</span> (p = GlobalLock((HANDLE)retval)) {
00385 
00386         memcpy(p, (PVOID)<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pData), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(cbSize));
00387         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>((HANDLE)retval);
00388 
00389     }
00390 
00391     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
00392 }
00393 <span class="preprocessor">#endif // RECVSIDE</span>
00394 <span class="preprocessor"></span>
00395 <span class="comment">/**************************************************************************\</span>
00396 <span class="comment">* fnCOPYDATA</span>
00397 <span class="comment">*</span>
00398 <span class="comment">* 7-14-92 Sanfords created</span>
00399 <span class="comment">\**************************************************************************/</span>
00400 
<a name="l00401"></a><a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html">00401</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html">_FNCOPYDATAMSG</a> {
<a name="l00402"></a><a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o0">00402</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o0">CaptureBuf</a>;
<a name="l00403"></a><a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o1">00403</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o1">pwnd</a>;
<a name="l00404"></a><a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o2">00404</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o2">msg</a>;
<a name="l00405"></a><a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o3">00405</a>     HWND <a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o3">hwndFrom</a>;
<a name="l00406"></a><a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o4">00406</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o4">fDataPresent</a>;
<a name="l00407"></a><a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o5">00407</a>     COPYDATASTRUCT <a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o5">cds</a>;
<a name="l00408"></a><a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o6">00408</a>     ULONG_PTR <a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o6">xParam</a>;
<a name="l00409"></a><a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o7">00409</a>     PROC <a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html#o7">xpfnProc</a>;
00410 } <a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html">FNCOPYDATAMSG</a>;
00411 
00412 <span class="preprocessor">#ifdef SENDSIDE</span>
00413 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(COPYDATA)
00414 {
00415     HWND hwndFrom = (HWND)wParam;
00416     PCOPYDATASTRUCT pcds = (PCOPYDATASTRUCT)lParam;
00417     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cCapture, cbCapture;
00418 
00419     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNCOPYDATA)
00420 
00421     UNREFERENCED_PARAMETER(dwSCMSFlags);
00422     UNREFERENCED_PARAMETER(psms);
00423 
00424     <span class="keywordflow">if</span> (pcds == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00425         cCapture = cbCapture = 0;
00426     } <span class="keywordflow">else</span> {
00427         cCapture = 1;
00428         cbCapture = pcds-&gt;cbData;
00429     }
00430     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNCOPYDATA, cCapture, cbCapture, TRUE);
00431 
00432         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
00433         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00434         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hwndFrom = hwndFrom;
00435         <span class="keywordflow">if</span> (pcds != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00436             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;fDataPresent = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00437             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cds = *pcds;
00438             <a class="code" href="../../d3/d5/ssend_8c.html#a41">LARGECOPYBYTES2</a>(pcds-&gt;lpData, cbCapture, cds.lpData);
00439         } <span class="keywordflow">else</span> {
00440             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;fDataPresent = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00441         }
00442         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00443         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00444 
00445         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00446         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNCOPYDATA);
00447         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00448         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00449 
00450     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnCOPYDATA"</span>);
00451     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(DWORD,0);
00452 }
00453 <span class="preprocessor">#endif // SENDSIDE</span>
00454 <span class="preprocessor"></span>
00455 <span class="preprocessor">#ifdef RECVSIDE</span>
00456 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnCOPYDATA, <a class="code" href="../../d1/d3/struct__FNCOPYDATAMSG.html">FNCOPYDATAMSG</a>)
00457 {
00458     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
00459     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
00460 
00461     retval = <a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
00462         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
00463         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
00464         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hwndFrom),
00465         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(fDataPresent) ? <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(cds) : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00466         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
00467 
00468     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
00469 }
00470 <span class="preprocessor">#endif // RECVSIDE</span>
00471 <span class="preprocessor"></span>
00472 
00473 <span class="comment">/**************************************************************************\</span>
00474 <span class="comment">* fnSENTDDEMSG</span>
00475 <span class="comment">*</span>
00476 <span class="comment">* 11-5-92 Sanfords created</span>
00477 <span class="comment">*</span>
00478 <span class="comment">*   This thunks DDE messages that SHOULD be posted.  It will only work for</span>
00479 <span class="comment">*   WOW apps.  This thunking is strictly for WOW compatability.  No 32 bit</span>
00480 <span class="comment">*   app should be allowed to get away with this practice because it opens</span>
00481 <span class="comment">*   the DDE protocol up to deadlocks.</span>
00482 <span class="comment">\**************************************************************************/</span>
00483 
<a name="l00484"></a><a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html">00484</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html">_FNSENTDDEMSGMSG</a> {
<a name="l00485"></a><a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o0">00485</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o0">pwnd</a>;
<a name="l00486"></a><a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o1">00486</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o1">msg</a>;
<a name="l00487"></a><a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o2">00487</a>     WPARAM <a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o2">wParam</a>;
<a name="l00488"></a><a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o3">00488</a>     LPARAM <a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o3">lParam</a>;
<a name="l00489"></a><a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o4">00489</a>     ULONG_PTR <a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o4">xParam</a>;
<a name="l00490"></a><a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o5">00490</a>     PROC <a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o5">xpfnProc</a>;
<a name="l00491"></a><a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o6">00491</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html#o6">fIsUnicodeProc</a>;
00492 } <a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html">FNSENTDDEMSGMSG</a>;
00493 
00494 <span class="preprocessor">#ifdef SENDSIDE</span>
00495 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(SENTDDEMSG)
00496 {
00497     MSG msgs;
00498 
00499     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNSENTDDEMSG)
00500 
00501     UNREFERENCED_PARAMETER(psms);
00502 
00503     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNSENTDDEMSG)
00504 
00505         <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a546">MSGFLAG_DDE_SPECIAL_SEND</a>;
00506         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a545">MSGFLAG_DDE_MID_THUNK</a>) {
00507             <span class="comment">/*</span>
00508 <span class="comment">             * complete the thunking here.</span>
00509 <span class="comment">             */</span>
00510             msgs.hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd);
00511             msgs.message = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a545">MSGFLAG_DDE_MID_THUNK</a>;
00512             msgs.wParam = wParam;
00513             msgs.lParam = lParam;
00514             <a class="code" href="../../d4/d1/userk_8h.html#a1876">xxxDDETrackGetMessageHook</a>((PMSG)&amp;msgs);
00515 
00516             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)<a class="code" href="../../d4/d1/userk_8h.html#a104">PW</a>(msgs.hwnd) -
00517                     pci-&gt;ulClientDelta);
00518             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = msgs.message;
00519             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = msgs.wParam;
00520             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = msgs.lParam;
00521         } <span class="keywordflow">else</span> {
00522             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
00523             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00524             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
00525             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = lParam;
00526         }
00527         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00528         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00529         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;fIsUnicodeProc = !(dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
00530 
00531         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00532         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNSENTDDEMSG);
00533         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00534         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00535 
00536     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnSENTDDEMSG"</span>);
00537     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(DWORD,0);
00538 }
00539 <span class="preprocessor">#endif // SENDSIDE</span>
00540 <span class="preprocessor"></span>
00541 <span class="preprocessor">#ifdef RECVSIDE</span>
00542 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnSENTDDEMSG, <a class="code" href="../../d9/d8/struct__FNSENTDDEMSGMSG.html">FNSENTDDEMSGMSG</a>)
00543 {
00544     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
00545 
00546     <span class="comment">/*</span>
00547 <span class="comment">     * A DDE message may have been sent via CallWindowProc due to subclassing.</span>
00548 <span class="comment">     * Since IsWindowUnicode() cannot properly tell what proc a message will</span>
00549 <span class="comment">     * ultimately reach, we make sure that the Ansi/Unicode form of any</span>
00550 <span class="comment">     * WM_DDE_EXECUTE data is correct for the documented convention and</span>
00551 <span class="comment">     * translate it as necessary.</span>
00552 <span class="comment">     */</span>
00553     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg) == WM_DDE_EXECUTE) {
00554         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fHandleChanged;
00555 
00556         fHandleChanged = <a class="code" href="../../d9/d7/ntcb_8h.html#a94">FixupDdeExecuteIfNecessary</a>((HGLOBAL *)<a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(lParam),
00557                 <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(fIsUnicodeProc) &amp;&amp;
00558                 <a class="code" href="../../d3/d8/winmgrc_8c.html#a27">IsWindowUnicode</a>((HWND)<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam)));
00559         <span class="comment">/*</span>
00560 <span class="comment">         * BUGBUG:</span>
00561 <span class="comment">         * If the app didn't allocate this DDE memory GMEM_MOVEABLE,</span>
00562 <span class="comment">         * the fixup may require the handle value to change.</span>
00563 <span class="comment">         * If this happens things will fall appart when the other side</span>
00564 <span class="comment">         * or the tracking layer tries to free the old handle value.</span>
00565 <span class="comment">         */</span>
00566         UserAssert(!fHandleChanged);
00567     }
00568     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
00569             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
00570             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
00571             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
00572             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(lParam),
00573             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
00574 
00575     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
00576 }
00577 <span class="preprocessor">#endif // RECVSIDE</span>
00578 <span class="preprocessor"></span>
00579 <span class="comment">/**************************************************************************\</span>
00580 <span class="comment">* fnDWORD</span>
00581 <span class="comment">*</span>
00582 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
00583 <span class="comment">\**************************************************************************/</span>
00584 
<a name="l00585"></a><a class="code" href="../../d3/d3/struct__FNDWORDMSG.html">00585</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d3/struct__FNDWORDMSG.html">_FNDWORDMSG</a> {
<a name="l00586"></a><a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o0">00586</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o0">pwnd</a>;
<a name="l00587"></a><a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o1">00587</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o1">msg</a>;
<a name="l00588"></a><a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o2">00588</a>     WPARAM <a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o2">wParam</a>;
<a name="l00589"></a><a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o3">00589</a>     LPARAM lParam;
<a name="l00590"></a><a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o4">00590</a>     ULONG_PTR <a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o4">xParam</a>;
<a name="l00591"></a><a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o5">00591</a>     PROC <a class="code" href="../../d3/d3/struct__FNDWORDMSG.html#o5">xpfnProc</a>;
00592 } <a class="code" href="../../d3/d3/struct__FNDWORDMSG.html">FNDWORDMSG</a>;
00593 
00594 <span class="preprocessor">#ifdef SENDSIDE</span>
00595 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(DWORD)
00596 {
00597     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNDWORD)
00598 
00599     UNREFERENCED_PARAMETER(dwSCMSFlags);
00600     UNREFERENCED_PARAMETER(psms);
00601 
00602     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNDWORD)
00603 
00604         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
00605         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00606         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
00607         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = lParam;
00608         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00609         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00610 
00611         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00612         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNDWORD);
00613         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00614         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00615 
00616     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnDWORD"</span>);
00617     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
00618 }
00619 <span class="preprocessor">#endif // SENDSIDE</span>
00620 <span class="preprocessor"></span>
00621 <span class="preprocessor">#ifdef RECVSIDE</span>
00622 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnDWORD, <a class="code" href="../../d3/d3/struct__FNDWORDMSG.html">FNDWORDMSG</a>)
00623 {
00624     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
00625 
00626     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
00627             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
00628             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
00629             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
00630             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(lParam),
00631             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
00632 
00633     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
00634 }
00635 <span class="preprocessor">#endif // RECVSIDE</span>
00636 <span class="preprocessor"></span>
00637 <span class="comment">/**************************************************************************\</span>
00638 <span class="comment">* fnINWPARAMCHAR</span>
00639 <span class="comment">*</span>
00640 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
00641 <span class="comment">\**************************************************************************/</span>
00642 
<a name="l00643"></a><a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html">00643</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html">_FNINWPARAMCHARMSG</a> {
<a name="l00644"></a><a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o0">00644</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o0">pwnd</a>;
<a name="l00645"></a><a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o1">00645</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o1">msg</a>;
<a name="l00646"></a><a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o2">00646</a>     WPARAM <a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o2">wParam</a>;
<a name="l00647"></a><a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o3">00647</a>     LPARAM lParam;
<a name="l00648"></a><a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o4">00648</a>     ULONG_PTR <a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o4">xParam</a>;
<a name="l00649"></a><a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o5">00649</a>     PROC <a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html#o5">xpfnProc</a>;
00650 } <a class="code" href="../../d9/d7/struct__FNINWPARAMCHARMSG.html">FNINWPARAMCHARMSG</a>;
00651 
00652 <span class="preprocessor">#ifdef SENDSIDE</span>
00653 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INWPARAMCHAR)
00654 {
00655     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINWPARAMCHAR)
00656 
00657     UNREFERENCED_PARAMETER(psms);
00658 
00659     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINWPARAMCHAR)
00660 
00661         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
00662         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00663 
00664         <span class="comment">/*</span>
00665 <span class="comment">         * WM_CHARTOITEM has an index in the hi-word of wParam</span>
00666 <span class="comment">         */</span>
00667         <span class="keywordflow">if</span> (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>) {
00668             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> == WM_CHARTOITEM || <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> == WM_MENUCHAR) {
00669                 WPARAM dwT = wParam &amp; 0xFFFF;                <span class="comment">// mask of caret pos</span>
00670                 <a class="code" href="../../d5/d6/chartran_8c.html#a4">RtlWCSMessageWParamCharToMB</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>, &amp;dwT);     <span class="comment">// convert key portion</span>
00671                 UserAssert(HIWORD(dwT) == 0);
00672                 wParam = MAKELONG(LOWORD(dwT),HIWORD(wParam));  <span class="comment">// rebuild pos &amp; key wParam</span>
00673             } <span class="keywordflow">else</span> {
00674                 <a class="code" href="../../d5/d6/chartran_8c.html#a4">RtlWCSMessageWParamCharToMB</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>, &amp;wParam);
00675             }
00676         }
00677 
00678         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
00679 
00680         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = lParam;
00681         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00682         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00683 
00684         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00685         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNDWORD);
00686         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00687         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00688 
00689     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINWPARAMCHAR"</span>);
00690     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(DWORD,0);
00691 }
00692 <span class="preprocessor">#endif // SENDSIDE</span>
00693 <span class="preprocessor"></span>
00694 <span class="preprocessor">#ifdef RECVSIDE</span>
00695 <span class="preprocessor"></span><span class="comment">/*</span>
00696 <span class="comment"> * The fnDWORD routine is used for this message</span>
00697 <span class="comment"> */</span>
00698 <span class="preprocessor">#endif // RECVSIDE</span>
00699 <span class="preprocessor"></span>
00700 <span class="comment">/**************************************************************************\</span>
00701 <span class="comment">* fnINWPARAMDBCSCHAR</span>
00702 <span class="comment">*</span>
00703 <span class="comment">* 12-Feb-1996 hideyukn   Created</span>
00704 <span class="comment">\**************************************************************************/</span>
00705 
<a name="l00706"></a><a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html">00706</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html">_FNINWPARAMDBCSCHARMSG</a> {
<a name="l00707"></a><a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o0">00707</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o0">pwnd</a>;
<a name="l00708"></a><a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o1">00708</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o1">msg</a>;
<a name="l00709"></a><a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o2">00709</a>     WPARAM <a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o2">wParam</a>;
<a name="l00710"></a><a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o3">00710</a>     LPARAM lParam;
<a name="l00711"></a><a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o4">00711</a>     ULONG_PTR <a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o4">xParam</a>;
<a name="l00712"></a><a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o5">00712</a>     PROC <a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o5">xpfnProc</a>;
<a name="l00713"></a><a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o6">00713</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html#o6">bAnsi</a>;
00714 } <a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html">FNINWPARAMDBCSCHARMSG</a>;
00715 
00716 <span class="preprocessor">#ifdef SENDSIDE</span>
00717 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INWPARAMDBCSCHAR)
00718 {
00719     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINWPARAMDBCSCHAR)
00720 
00721     UNREFERENCED_PARAMETER(psms);
00722 
00723     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINWPARAMDBCSCHAR)
00724 
00725         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd  = pwndClient;
00726         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg   = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00727         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;bAnsi = dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>;
00728 
00729         <span class="comment">/*</span>
00730 <span class="comment">         * wParam in WM_CHAR/EM_SETPASSWORDCHAR should be converted to ANSI</span>
00731 <span class="comment">         * ,if target is ANSI.</span>
00732 <span class="comment">         */</span>
00733         <span class="keywordflow">if</span> (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>) {
00734             <a class="code" href="../../d5/d6/chartran_8c.html#a4">RtlWCSMessageWParamCharToMB</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>, &amp;wParam);
00735         }
00736 
00737         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
00738         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = lParam;
00739         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00740         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00741 
00742         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00743         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINWPARAMDBCSCHAR);
00744         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00745         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00746 
00747     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINWPARAMDBCSCHAR"</span>);
00748     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(DWORD,0);
00749 }
00750 <span class="preprocessor">#endif // SENDSIDE</span>
00751 <span class="preprocessor"></span>
00752 <span class="preprocessor">#ifdef RECVSIDE</span>
00753 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINWPARAMDBCSCHAR, <a class="code" href="../../d0/d8/struct__FNINWPARAMDBCSCHARMSG.html">FNINWPARAMDBCSCHARMSG</a>)
00754 {
00755     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bAnsiWndProc;
00756 
00757     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0,NULL,0);
00758 
00759         bAnsiWndProc = <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(bAnsi);
00760 
00761         <span class="keywordflow">if</span> (bAnsiWndProc) {
00762 
00763             PKERNEL_MSG  pmsgDbcsCB = <a class="code" href="../../d6/d0/usercli_8h.html#a292">GetCallBackDbcsInfo</a>();
00764             WPARAM wParam         = pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>;
00765             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  bDbcsMessaging = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00766 
00767             <span class="comment">//</span>
00768             <span class="comment">// Check wParam has Dbcs character or not..</span>
00769             <span class="comment">//</span>
00770             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a120">IS_DBCS_MESSAGE</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>)) {
00771 
00772                 <span class="keywordflow">if</span> (pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a119">WMCR_IR_DBCSCHAR</a>) {
00773 
00774                     <span class="comment">//</span>
00775                     <span class="comment">// This is reply for WM_IME_REPORT:IR_DBCSCHAR, then</span>
00776                     <span class="comment">// We send DBCS chararcter at one time...</span>
00777                     <span class="comment">// (Do not need to send twice for DBCS LeadByte and TrailByte).</span>
00778                     <span class="comment">//</span>
00779                     <span class="comment">// Validation for wParam.. (mask off the secret bit).</span>
00780                     <span class="comment">//</span>
00781                     wParam = (pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a> &amp; 0x0000FFFF);
00782 
00783                 } <span class="keywordflow">else</span> {
00784 
00785                     <span class="comment">//</span>
00786                     <span class="comment">// Mark the wParam keeps Dbcs character..</span>
00787                     <span class="comment">//</span>
00788                     bDbcsMessaging = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00789 
00790                     <span class="comment">//</span>
00791                     <span class="comment">// Backup current message. this backupped message will be used</span>
00792                     <span class="comment">// when Apps peek (or get) message from thier WndProc.</span>
00793                     <span class="comment">// (see GetMessageA(), PeekMessageA()...)</span>
00794                     <span class="comment">//</span>
00795                     <span class="comment">// pmsgDbcsCB-&gt;hwnd    = HW(pmsg-&gt;pwnd);</span>
00796                     <span class="comment">// pmsgDbcsCB-&gt;message = pmsg-&gt;msg;</span>
00797                     <span class="comment">// pmsgDbcsCB-&gt;wParam  = pmsg-&gt;wParam;</span>
00798                     <span class="comment">// pmsgDbcsCB-&gt;lParam  = pmsg-&gt;lParam;</span>
00799                     <span class="comment">// pmsgDbcsCB-&gt;time    = pmsg-&gt;time;</span>
00800                     <span class="comment">// pmsgDbcsCB-&gt;pt      = pmsg-&gt;pt;</span>
00801                     <span class="comment">//</span>
00802                     COPY_MSG_TO_KERNELMSG(pmsgDbcsCB,(PMSG)pmsg);
00803 
00804                     <span class="comment">//</span>
00805                     <span class="comment">// pwnd should be converted to hwnd.</span>
00806                     <span class="comment">//</span>
00807                     pmsgDbcsCB-&gt;hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pmsg-&gt;pwnd);
00808 
00809                     <span class="comment">//</span>
00810                     <span class="comment">// DbcsLeadByte will be sent below soon, we just need DbcsTrailByte</span>
00811                     <span class="comment">// for further usage..</span>
00812                     <span class="comment">//</span>
00813                     pmsgDbcsCB-&gt;wParam = (pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a> &amp; 0x000000FF);
00814 
00815                     <span class="comment">//</span>
00816                     <span class="comment">// Pass the LeadingByte of the DBCS character to an ANSI WndProc.</span>
00817                     <span class="comment">//</span>
00818                     wParam = (pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a> &amp; 0x0000FF00) &gt;&gt; 8;
00819                 }
00820             }
00821 
00822             <span class="comment">//</span>
00823             <span class="comment">// Forward Dbcs LeadingByte or Sbcs character to Apps WndProc.</span>
00824             <span class="comment">//</span>
00825             retval = <a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
00826                     <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
00827                     <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
00828                     wParam,
00829                     <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(lParam),
00830                     <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam) );
00831 
00832             <span class="comment">//</span>
00833             <span class="comment">// Check we need to send trailing byte or not, if the wParam has Dbcs character.</span>
00834             <span class="comment">//</span>
00835             <span class="keywordflow">if</span> (bDbcsMessaging &amp;&amp; pmsgDbcsCB-&gt;wParam) {
00836 
00837                 <span class="comment">//</span>
00838                 <span class="comment">// If an app didn't peek (or get) the trailing byte from within</span>
00839                 <span class="comment">// WndProc, and then pass the DBCS TrailingByte to the ANSI WndProc here</span>
00840                 <span class="comment">// pmsgDbcsCB-&gt;wParam has DBCS TrailingByte here.. see above..</span>
00841                 <span class="comment">//</span>
00842                 wParam = KERNEL_WPARAM_TO_WPARAM(pmsgDbcsCB-&gt;wParam);
00843 
00844                 <span class="comment">//</span>
00845                 <span class="comment">// Invalidate cached message.</span>
00846                 <span class="comment">//</span>
00847                 pmsgDbcsCB-&gt;wParam = 0;
00848 
00849                 retval = <a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
00850                         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
00851                         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
00852                         wParam,
00853                         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(lParam),
00854                         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam) );
00855             } <span class="keywordflow">else</span> {
00856 
00857                 <span class="comment">//</span>
00858                 <span class="comment">// If an app called Get/PeekMessageA from its</span>
00859                 <span class="comment">// WndProc, do not do anything.</span>
00860                 <span class="comment">//</span>
00861             }
00862 
00863         } <span class="keywordflow">else</span> {
00864 
00865             <span class="comment">//</span>
00866             <span class="comment">// Only LOWORD of WPARAM is valid for WM_CHAR....</span>
00867             <span class="comment">//  (Mask off DBCS messaging information.)</span>
00868             <span class="comment">//</span>
00869             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a> &amp;= 0x0000FFFF;
00870 
00871             retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
00872                     pmsg-&gt;pwnd,
00873                     pmsg-&gt;msg,
00874                     pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
00875                     pmsg-&gt;lParam,
00876                     pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
00877         }
00878 
00879     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
00880 }
00881 <span class="preprocessor">#endif // RECVSIDE</span>
00882 <span class="preprocessor"></span>
00883 <span class="comment">/**************************************************************************\</span>
00884 <span class="comment">* yyy</span>
00885 <span class="comment">*</span>
00886 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
00887 <span class="comment">\**************************************************************************/</span>
00888 
<a name="l00889"></a><a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html">00889</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html">_FNINOUTDRAGMSG</a> {
<a name="l00890"></a><a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o0">00890</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o0">pwnd</a>;
<a name="l00891"></a><a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o1">00891</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o1">msg</a>;
<a name="l00892"></a><a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o2">00892</a>     WPARAM wParam;
<a name="l00893"></a><a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o3">00893</a>     ULONG_PTR <a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o3">xParam</a>;
<a name="l00894"></a><a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o4">00894</a>     PROC <a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o4">xpfnProc</a>;
<a name="l00895"></a><a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o5">00895</a>     DROPSTRUCT <a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html#o5">ds</a>;
00896 } <a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html">FNINOUTDRAGMSG</a>;
00897 
00898 <span class="preprocessor">#ifdef SENDSIDE</span>
00899 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INOUTDRAG)
00900 {
00901     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINOUTDRAG)
00902 
00903     UNREFERENCED_PARAMETER(dwSCMSFlags);
00904 
00905     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINOUTDRAG)
00906 
00907         LPDROPSTRUCT pds = (LPDROPSTRUCT)lParam;
00908 
00909         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
00910         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00911         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
00912         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ds = *pds;
00913         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00914         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00915 
00916         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00917         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINOUTDRAG);
00918         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00919         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00920 
00921         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
00922             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(pds, DROPSTRUCT);
00923         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
00924 
00925     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINOUTDRAG"</span>);
00926     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
00927 }
00928 <span class="preprocessor">#endif // SENDSIDE</span>
00929 <span class="preprocessor"></span>
00930 <span class="preprocessor">#ifdef RECVSIDE</span>
00931 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINOUTDRAG, <a class="code" href="../../d3/d6/struct__FNINOUTDRAGMSG.html">FNINOUTDRAGMSG</a>)
00932 {
00933     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;ds, <span class="keyword">sizeof</span>(pmsg-&gt;ds));
00934 
00935     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
00936             pmsg-&gt;pwnd,
00937             pmsg-&gt;msg,
00938             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
00939             &amp;pmsg-&gt;ds,
00940             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
00941 
00942     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
00943 }
00944 <span class="preprocessor">#endif // RECVSIDE</span>
00945 <span class="preprocessor"></span>
00946 <span class="comment">/**************************************************************************\</span>
00947 <span class="comment">* fnGETTEXTLENGTHS</span>
00948 <span class="comment">*</span>
00949 <span class="comment">* Gets the Unicode &amp; ANSI lengths</span>
00950 <span class="comment">* Internally, lParam pints to the ANSI length in bytes and the return value</span>
00951 <span class="comment">* is the Unicode length in bytes.  However, the public definition is maintained</span>
00952 <span class="comment">* on the  client side, where lParam is not used and either ANSI or Unicode is</span>
00953 <span class="comment">* returned.</span>
00954 <span class="comment">*</span>
00955 <span class="comment">* 10-Feb-1992 IanJa    Created</span>
00956 <span class="comment">\**************************************************************************/</span>
00957 
<a name="l00958"></a><a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html">00958</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html">_FNGETTEXTLENGTHSMSG</a> {
<a name="l00959"></a><a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html#o0">00959</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html#o0">pwnd</a>;
<a name="l00960"></a><a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html#o1">00960</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html#o1">msg</a>;
<a name="l00961"></a><a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html#o2">00961</a>     WPARAM wParam;
<a name="l00962"></a><a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html#o3">00962</a>     ULONG_PTR <a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html#o3">xParam</a>;
<a name="l00963"></a><a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html#o4">00963</a>     PROC <a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html#o4">xpfnProc</a>;
00964 } <a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html">FNGETTEXTLENGTHSMSG</a>;
00965 
00966 <span class="preprocessor">#ifdef SENDSIDE</span>
00967 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(GETTEXTLENGTHS)
00968 {
00969     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNGETTEXTLENGTHS)
00970 
00971     UNREFERENCED_PARAMETER(lParam);
00972     UNREFERENCED_PARAMETER(dwSCMSFlags);
00973     UNREFERENCED_PARAMETER(psms);
00974 
00975     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNGETTEXTLENGTHS)
00976 
00977         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
00978         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00979         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
00980         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
00981         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
00982 
00983         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
00984         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNGETTEXTLENGTHS);
00985         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
00986         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
00987 
00988         <span class="comment">/*</span>
00989 <span class="comment">         * ANSI client wndproc returns us cbANSI.  We want cchUnicode,</span>
00990 <span class="comment">         * so we guess cchUnicode = cbANSI. (It may be less if</span>
00991 <span class="comment">         * multi-byte characters are involved, but it will never be more).</span>
00992 <span class="comment">         * Save cbANSI in *lParam in case the server ultimately returns</span>
00993 <span class="comment">         * the length to an ANSI caller.</span>
00994 <span class="comment">         *</span>
00995 <span class="comment">         * Unicode client wndproc returns us cchUnicode.  If we want to know</span>
00996 <span class="comment">         * cbANSI, we must guess how many 'ANSI' chars we would need.</span>
00997 <span class="comment">         * We guess cbANSI = cchUnicode * 2. (It may be this much if all</span>
00998 <span class="comment">         * 'ANSI' characters are multi-byte, but it will never be more).</span>
00999 <span class="comment">         *</span>
01000 <span class="comment">         * Return cchUnicode (server code is all Unicode internally).</span>
01001 <span class="comment">         * Put cbANSI in *lParam to be passed along within the server in case</span>
01002 <span class="comment">         * we ultimately need to return it to the client.</span>
01003 <span class="comment">         *</span>
01004 <span class="comment">         * NOTE: this will sometimes cause text lengths to be misreported</span>
01005 <span class="comment">         * up to twice the real length, but that is expected to be harmless.</span>
01006 <span class="comment">         * This will only * happen if an app sends WM_GETcode TEXTLENGTH to a</span>
01007 <span class="comment">         * window with an ANSI client-side wndproc, or a ANSI WM_GETTEXTLENGTH</span>
01008 <span class="comment">         * is sent to a Unicode client-side wndproc.</span>
01009 <span class="comment">         */</span>
01010 
01011     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnGETTEXTLENGTHS"</span>);
01012     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
01013 }
01014 <span class="preprocessor">#endif // SENDSIDE</span>
01015 <span class="preprocessor"></span>
01016 <span class="preprocessor">#ifdef RECVSIDE</span>
01017 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnGETTEXTLENGTHS, <a class="code" href="../../d6/d3/struct__FNGETTEXTLENGTHSMSG.html">FNGETTEXTLENGTHSMSG</a>)
01018 {
01019     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
01020 
01021     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01022             pmsg-&gt;pwnd,
01023             pmsg-&gt;msg,
01024             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
01025             0,                      <span class="comment">// so we don't pass &amp;cbAnsi to apps</span>
01026             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01027 
01028     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01029 }
01030 <span class="preprocessor">#endif // RECVSIDE</span>
01031 <span class="preprocessor"></span>
01032 <span class="comment">/**************************************************************************\</span>
01033 <span class="comment">* yyy</span>
01034 <span class="comment">*</span>
01035 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
01036 <span class="comment">\**************************************************************************/</span>
01037 
<a name="l01038"></a><a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html">01038</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html">_FNINLPCREATESTRUCTMSG</a> {
<a name="l01039"></a><a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o0">01039</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o0">CaptureBuf</a>;
<a name="l01040"></a><a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o1">01040</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o1">pwnd</a>;
<a name="l01041"></a><a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o2">01041</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o2">msg</a>;
<a name="l01042"></a><a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o3">01042</a>     WPARAM wParam;
<a name="l01043"></a><a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o4">01043</a>     LPARAM lParam;
<a name="l01044"></a><a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o5">01044</a>     CREATESTRUCT <a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o5">cs</a>;
<a name="l01045"></a><a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o6">01045</a>     ULONG_PTR <a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o6">xParam</a>;
<a name="l01046"></a><a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o7">01046</a>     PROC <a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html#o7">xpfnProc</a>;
01047 } <a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html">FNINLPCREATESTRUCTMSG</a>;
01048 
01049 <span class="preprocessor">#ifdef SENDSIDE</span>
01050 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INLPCREATESTRUCT)
01051 {
01052     <a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html">PCREATESTRUCTEX</a> pcreatestruct = (<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html">PCREATESTRUCTEX</a>)lParam;
01053     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbName = 0, cbClass = 0;
01054     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cCapture = 0;
01055     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiReceiver = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
01056 
01057     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINLPCREATESTRUCT)
01058 
01059     UNREFERENCED_PARAMETER(psms);
01060 
01061     <span class="comment">/*</span>
01062 <span class="comment">     * Compute ANSI capture lengths.  Don't capture if</span>
01063 <span class="comment">     * the strings are in the client's address space.</span>
01064 <span class="comment">     */</span>
01065     <span class="keywordflow">if</span> (pcreatestruct) {
01066         <span class="keywordflow">if</span> (pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName &amp;&amp;
01067                 ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> != fAnsiReceiver ||
01068                 <a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>((PVOID)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName))) {
01069             <a class="code" href="../../d3/d5/ssend_8c.html#a9">CALC_SIZE_IN</a>(cbName, &amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>);
01070             cCapture++;
01071         }
01072         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszClass) &amp;&amp;
01073                 ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> != fAnsiReceiver ||
01074                 <a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>((PVOID)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszClass))) {
01075             <a class="code" href="../../d3/d5/ssend_8c.html#a9">CALC_SIZE_IN</a>(cbClass, &amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>);
01076             cCapture++;
01077         }
01078     }
01079 
01080     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNINLPCREATESTRUCT, cCapture, cbName + cbClass, TRUE)
01081 
01082         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;pwnd = pwndClient;
01083         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;msg = msg;
01084         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;wParam = wParam;
01085         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;lParam = lParam;  <span class="comment">// this could be NULL in WOW apps!</span>
01086 
01087         if (pcreatestruct != NULL) {
01088             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cs = pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>;
01089 
01090             <span class="comment">// Make it a "Large" copy because it could be an Edit control</span>
01091             <span class="keywordflow">if</span> (cbName) {
01092                 <span class="keywordflow">if</span> (!pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
01093                     <span class="keywordflow">if</span> (*(PWORD)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName == 0xffff) {
01094 
01095                         <span class="comment">/*</span>
01096 <span class="comment">                         * Copy out an ordinal of the form 0xffff, ID.</span>
01097 <span class="comment">                         * If the receiver is ANSI, skip the first 0xff.</span>
01098 <span class="comment">                         */</span>
01099                         <span class="keywordflow">if</span> (fAnsiReceiver) {
01100                             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d3/d5/ssend_8c.html#a59">CaptureCallbackData</a>(&amp;mp-&gt;CaptureBuf,
01101                                     (PBYTE)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName + 1,
01102                                     3, (PVOID *)&amp;mp-&gt;cs.lpszName)))
01103                                 <span class="keywordflow">goto</span> errorexit;
01104                         } <span class="keywordflow">else</span> {
01105                             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d3/d5/ssend_8c.html#a59">CaptureCallbackData</a>(&amp;mp-&gt;CaptureBuf,
01106                                     (PBYTE)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName,
01107                                     4, (PVOID *)&amp;mp-&gt;cs.lpszName)))
01108                                 <span class="keywordflow">goto</span> errorexit;
01109                         }
01110                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fAnsiReceiver) {
01111                         <a class="code" href="../../d3/d5/ssend_8c.html#a47">LARGECOPYSTRINGLPWSTRA</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>, cs.lpszName);
01112                     } <span class="keywordflow">else</span> {
01113                         <a class="code" href="../../d3/d5/ssend_8c.html#a45">LARGECOPYSTRINGLPWSTR</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>, cs.lpszName);
01114                     }
01115                 } <span class="keywordflow">else</span> {
01116                     <span class="keywordflow">if</span> (*(<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName == 0xff) {
01117 
01118                         <span class="comment">/*</span>
01119 <span class="comment">                         * Copy out an ordinal of the form 0xff, ID.</span>
01120 <span class="comment">                         * If the receiver is UNICODE, expand the 0xff to 0xffff.</span>
01121 <span class="comment">                         */</span>
01122                         <span class="keywordflow">if</span> (fAnsiReceiver) {
01123                             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d3/d5/ssend_8c.html#a59">CaptureCallbackData</a>(&amp;mp-&gt;CaptureBuf,
01124                                     (PBYTE)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName,
01125                                     3, (PVOID *)&amp;mp-&gt;cs.lpszName)))
01126                                 <span class="keywordflow">goto</span> errorexit;
01127                         } <span class="keywordflow">else</span> {
01128                             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOrdinal;
01129 
01130                             dwOrdinal = MAKELONG(0xffff,
01131                                     (*(DWORD UNALIGNED *)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName &gt;&gt; 8));
01132                             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d3/d5/ssend_8c.html#a59">CaptureCallbackData</a>(&amp;mp-&gt;CaptureBuf,
01133                                     &amp;dwOrdinal,
01134                                     4, (PVOID *)&amp;mp-&gt;cs.lpszName)))
01135                                 <span class="keywordflow">goto</span> errorexit;
01136                         }
01137                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fAnsiReceiver) {
01138                         <a class="code" href="../../d3/d5/ssend_8c.html#a46">LARGECOPYSTRINGLPSTR</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>, cs.lpszName);
01139                     } <span class="keywordflow">else</span> {
01140                         <a class="code" href="../../d3/d5/ssend_8c.html#a48">LARGECOPYSTRINGLPSTRW</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>, cs.lpszName);
01141                     }
01142                 }
01143             }
01144             <span class="keywordflow">if</span> (cbClass) {
01145                 <span class="keywordflow">if</span> (!pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
01146                     <span class="keywordflow">if</span> (fAnsiReceiver) {
01147                         <a class="code" href="../../d3/d5/ssend_8c.html#a47">LARGECOPYSTRINGLPWSTRA</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>, cs.lpszClass);
01148                     } <span class="keywordflow">else</span> {
01149                         <a class="code" href="../../d3/d5/ssend_8c.html#a45">LARGECOPYSTRINGLPWSTR</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>, cs.lpszClass);
01150                     }
01151                 } <span class="keywordflow">else</span> {
01152                     <span class="keywordflow">if</span> (fAnsiReceiver) {
01153                         <a class="code" href="../../d3/d5/ssend_8c.html#a46">LARGECOPYSTRINGLPSTR</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>, cs.lpszClass);
01154                     } <span class="keywordflow">else</span> {
01155                         <a class="code" href="../../d3/d5/ssend_8c.html#a48">LARGECOPYSTRINGLPSTRW</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>, cs.lpszClass);
01156                     }
01157                 }
01158             }
01159         }
01160 
01161         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01162         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01163 
01164         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01165         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNINLPCREATESTRUCT);
01166         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01167         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01168 
01169     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINLPCREATESTRUCT"</span>);
01170     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(DWORD,0);
01171 }
01172 <span class="preprocessor">#endif // SENDSIDE</span>
01173 <span class="preprocessor"></span>
01174 <span class="preprocessor">#ifdef RECVSIDE</span>
01175 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINLPCREATESTRUCT, <a class="code" href="../../d5/d5/struct__FNINLPCREATESTRUCTMSG.html">FNINLPCREATESTRUCTMSG</a>)
01176 {
01177     LPARAM lParam;
01178 
01179     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
01180     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
01181 
01182     <span class="keywordflow">if</span> (pmsg-&gt;lParam != 0) {
01183         <span class="keywordflow">if</span> ((ULONG_PTR)pmsg-&gt;cs.lpszName &gt; <a class="code" href="../../d1/d8/clglobal_8c.html#a7">gHighestUserAddress</a>)
01184             pmsg-&gt;cs.lpszName = <a class="code" href="../../d6/d0/usercli_8h.html#a25">REBASEPTR</a>(pmsg-&gt;pwnd, pmsg-&gt;cs.lpszName);
01185         <span class="keywordflow">if</span> ((ULONG_PTR)pmsg-&gt;cs.lpszClass &gt; <a class="code" href="../../d1/d8/clglobal_8c.html#a7">gHighestUserAddress</a>)
01186             pmsg-&gt;cs.lpszClass = <a class="code" href="../../d6/d0/usercli_8h.html#a25">REBASEPTR</a>(pmsg-&gt;pwnd, pmsg-&gt;cs.lpszClass);
01187         lParam = (LPARAM)&amp;pmsg-&gt;cs;
01188 
01189         <span class="keywordflow">if</span> ((pmsg-&gt;cs.lpCreateParams != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
01190             (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pmsg-&gt;pwnd, WEFMDICHILD))) {
01191                <span class="comment">// Note -- do not test the flag in cs.dwExStyle -- it gets zapped for Old UI apps, like Quicken</span>
01192             ((LPMDICREATESTRUCT)(pmsg-&gt;cs.lpCreateParams))-&gt;szClass = pmsg-&gt;cs.lpszClass;
01193             ((LPMDICREATESTRUCT)(pmsg-&gt;cs.lpCreateParams))-&gt;szTitle = pmsg-&gt;cs.lpszName;
01194         }
01195     } <span class="keywordflow">else</span>
01196         lParam = 0;
01197 
01198 
01199     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01200             pmsg-&gt;pwnd,
01201             pmsg-&gt;msg,
01202             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
01203             lParam,
01204             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01205 
01206     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01207 }
01208 <span class="preprocessor">#endif // RECVSIDE</span>
01209 <span class="preprocessor"></span>
01210 <span class="comment">/**************************************************************************\</span>
01211 <span class="comment">* fnINLPMDICREATESTRUCT</span>
01212 <span class="comment">*</span>
01213 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
01214 <span class="comment">\**************************************************************************/</span>
01215 
<a name="l01216"></a><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html">01216</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html">_FNINLPMDICREATESTRUCTMSG</a> {
<a name="l01217"></a><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o0">01217</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o0">CaptureBuf</a>;
<a name="l01218"></a><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o1">01218</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o1">pwnd</a>;
<a name="l01219"></a><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o2">01219</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01220"></a><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o3">01220</a>     WPARAM wParam;
<a name="l01221"></a><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o4">01221</a>     MDICREATESTRUCT <a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o4">mdics</a>;
<a name="l01222"></a><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o5">01222</a>     ULONG_PTR <a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o5">xParam</a>;
<a name="l01223"></a><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o6">01223</a>     PROC <a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o6">xpfnProc</a>;
<a name="l01224"></a><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o7">01224</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o7">szClass</a>;
<a name="l01225"></a><a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o8">01225</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html#o8">szTitle</a>;
01226 } <a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html">FNINLPMDICREATESTRUCTMSG</a>;
01227 
01228 <span class="preprocessor">#ifdef SENDSIDE</span>
01229 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INLPMDICREATESTRUCT)
01230 {
01231     <a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html">PMDICREATESTRUCTEX</a> pmdicreatestruct = (<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html">PMDICREATESTRUCTEX</a>)lParam;
01232     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbTitle = 0, cbClass = 0;
01233     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cCapture = 0;
01234     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiReceiver = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
01235 
01236     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINLPMDICREATESTRUCT)
01237 
01238     UNREFERENCED_PARAMETER(psms);
01239 
01240     <span class="comment">/*</span>
01241 <span class="comment">     * Compute ANSI capture lengths.  Don't capture if</span>
01242 <span class="comment">     * the strings are in the client's address space and</span>
01243 <span class="comment">     * are Unicode.</span>
01244 <span class="comment">     */</span>
01245     <span class="keywordflow">if</span> (pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o0">mdics</a>.szTitle &amp;&amp;
01246             (<a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>((PVOID)pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o0">mdics</a>.szTitle) ||
01247             ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o1">strTitle</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> != fAnsiReceiver))) {
01248         <a class="code" href="../../d3/d5/ssend_8c.html#a9">CALC_SIZE_IN</a>(cbTitle, &amp;pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o1">strTitle</a>);
01249         cCapture = 1;
01250     }
01251     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o0">mdics</a>.szClass) &amp;&amp;
01252             (<a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>((PVOID)pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o0">mdics</a>.szClass) ||
01253             ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o2">strClass</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> != fAnsiReceiver))) {
01254         <a class="code" href="../../d3/d5/ssend_8c.html#a9">CALC_SIZE_IN</a>(cbClass, &amp;pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o2">strClass</a>);
01255         cCapture++;
01256     }
01257 
01258     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNINLPMDICREATESTRUCT, cCapture, cbTitle + cbClass, TRUE)
01259 
01260         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;pwnd = pwndClient;
01261         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;msg = msg;
01262         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;wParam = wParam;
01263         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;mdics = pmdicreatestruct-&gt;mdics;
01264 
01265         if (cbTitle) {
01266             <span class="keywordflow">if</span> (!pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o1">strTitle</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
01267                 <span class="keywordflow">if</span> (fAnsiReceiver) {
01268                     <a class="code" href="../../d3/d5/ssend_8c.html#a47">LARGECOPYSTRINGLPWSTRA</a>(&amp;pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o1">strTitle</a>, mdics.szTitle);
01269                 } <span class="keywordflow">else</span> {
01270                     <a class="code" href="../../d3/d5/ssend_8c.html#a45">LARGECOPYSTRINGLPWSTR</a>(&amp;pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o1">strTitle</a>, mdics.szTitle);
01271                 }
01272             } <span class="keywordflow">else</span> {
01273                 <span class="keywordflow">if</span> (fAnsiReceiver) {
01274                     <a class="code" href="../../d3/d5/ssend_8c.html#a46">LARGECOPYSTRINGLPSTR</a>(&amp;pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o1">strTitle</a>, mdics.szTitle);
01275                 } <span class="keywordflow">else</span> {
01276                     <a class="code" href="../../d3/d5/ssend_8c.html#a48">LARGECOPYSTRINGLPSTRW</a>(&amp;pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o1">strTitle</a>, mdics.szTitle);
01277                 }
01278             }
01279         }
01280         <span class="keywordflow">if</span> (cbClass) {
01281             <span class="keywordflow">if</span> (!pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o2">strClass</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
01282                 <span class="keywordflow">if</span> (fAnsiReceiver) {
01283                     <a class="code" href="../../d3/d5/ssend_8c.html#a47">LARGECOPYSTRINGLPWSTRA</a>(&amp;pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o2">strClass</a>, mdics.szClass);
01284                 } <span class="keywordflow">else</span> {
01285                     <a class="code" href="../../d3/d5/ssend_8c.html#a45">LARGECOPYSTRINGLPWSTR</a>(&amp;pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o2">strClass</a>, mdics.szClass);
01286                 }
01287             } <span class="keywordflow">else</span> {
01288                 <span class="keywordflow">if</span> (fAnsiReceiver) {
01289                     <a class="code" href="../../d3/d5/ssend_8c.html#a46">LARGECOPYSTRINGLPSTR</a>(&amp;pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o2">strClass</a>, mdics.szClass);
01290                 } <span class="keywordflow">else</span> {
01291                     <a class="code" href="../../d3/d5/ssend_8c.html#a48">LARGECOPYSTRINGLPSTRW</a>(&amp;pmdicreatestruct-&gt;<a class="code" href="../../d5/d7/struct__MDICREATESTRUCTEX.html#o2">strClass</a>, mdics.szClass);
01292                 }
01293             }
01294         }
01295         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01296         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01297 
01298         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01299         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNINLPMDICREATESTRUCT);
01300         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01301         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01302 
01303     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINLPMDICREATESTRUCT"</span>);
01304     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(DWORD,0);
01305     DBG_UNREFERENCED_PARAMETER(wParam);
01306 }
01307 <span class="preprocessor">#endif // SENDSIDE</span>
01308 <span class="preprocessor"></span>
01309 <span class="preprocessor">#ifdef RECVSIDE</span>
01310 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINLPMDICREATESTRUCT, <a class="code" href="../../d1/d6/struct__FNINLPMDICREATESTRUCTMSG.html">FNINLPMDICREATESTRUCTMSG</a>)
01311 {
01312     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
01313     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
01314 
01315     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01316             pmsg-&gt;pwnd,
01317             pmsg-&gt;msg,
01318             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
01319             &amp;pmsg-&gt;mdics,
01320             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01321 
01322     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01323 }
01324 <span class="preprocessor">#endif // RECVSIDE</span>
01325 <span class="preprocessor"></span>
01326 <span class="comment">/**************************************************************************\</span>
01327 <span class="comment">* fnINPAINTCLIPBRD</span>
01328 <span class="comment">*</span>
01329 <span class="comment">* lParam is a supposed to be a Global Handle to DDESHARE memory.</span>
01330 <span class="comment">*</span>
01331 <span class="comment">* 22-Jul-1991 johnc     Created</span>
01332 <span class="comment">\**************************************************************************/</span>
01333 
<a name="l01334"></a><a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html">01334</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html">_FNINPAINTCLIPBRDMSG</a> {
<a name="l01335"></a><a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html#o0">01335</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html#o0">pwnd</a>;
<a name="l01336"></a><a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html#o1">01336</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01337"></a><a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html#o2">01337</a>     WPARAM wParam;
<a name="l01338"></a><a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html#o3">01338</a>     PAINTSTRUCT <a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html#o3">ps</a>;
<a name="l01339"></a><a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html#o4">01339</a>     ULONG_PTR <a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html#o4">xParam</a>;
<a name="l01340"></a><a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html#o5">01340</a>     PROC <a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html#o5">xpfnProc</a>;
01341 } <a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html">FNINPAINTCLIPBRDMSG</a>;
01342 
01343 <span class="preprocessor">#ifdef SENDSIDE</span>
01344 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INPAINTCLIPBRD)
01345 {
01346     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDCOwner;
01347 
01348     <span class="comment">/*</span>
01349 <span class="comment">     * We need to check clipboard access rights because the app could</span>
01350 <span class="comment">     * get the clipboard owner's window handle by enumeration etc and</span>
01351 <span class="comment">     * send this message</span>
01352 <span class="comment">     */</span>
01353 
01354     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINPAINTCLIPBRD)
01355 
01356     UNREFERENCED_PARAMETER(dwSCMSFlags);
01357     UNREFERENCED_PARAMETER(psms);
01358 
01359     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINPAINTCLIPBRD)
01360 
01361         LPPAINTSTRUCT pps = (LPPAINTSTRUCT)lParam;
01362 
01363         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a68">RtlAreAllAccessesGranted</a>(<a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>()-&gt;amwinsta,
01364                 WINSTA_ACCESSCLIPBOARD)) {
01365 
01366             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
01367             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
01368             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
01369             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ps = *pps;
01370             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01371             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01372 
01373             <span class="comment">/*</span>
01374 <span class="comment">             * We can't just set the owner of the DC and pass the original DC</span>
01375 <span class="comment">             * because currently GDI won't let you query the current owner</span>
01376 <span class="comment">             * and we don't know if it is a public or privately owned DC</span>
01377 <span class="comment">             */</span>
01378             pwndDCOwner = <a class="code" href="../../d4/d1/userk_8h.html#a1903">_WindowFromDC</a>(pps-&gt;hdc);
01379             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ps.hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1694">_GetDC</a>(pwndDCOwner);
01380 
01381             <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01382             <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINPAINTCLIPBRD);
01383             <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01384             <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01385 
01386             <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(<a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ps.hdc);
01387         }
01388 
01389     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINPAINTCLIPBRD"</span>);
01390     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(DWORD,0);
01391 }
01392 <span class="preprocessor">#endif // SENDSIDE</span>
01393 <span class="preprocessor"></span>
01394 <span class="preprocessor">#ifdef RECVSIDE</span>
01395 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINPAINTCLIPBRD, <a class="code" href="../../d5/d7/struct__FNINPAINTCLIPBRDMSG.html">FNINPAINTCLIPBRDMSG</a>)
01396 {
01397     LPPAINTSTRUCT lpps;
01398 
01399     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
01400 
01401     lpps = (LPPAINTSTRUCT)GlobalAlloc(GMEM_FIXED | GMEM_DDESHARE, <span class="keyword">sizeof</span>(PAINTSTRUCT));
01402     UserAssert(lpps);
01403 
01404     <span class="keywordflow">if</span> (lpps) {
01405         *lpps = pmsg-&gt;ps;
01406 
01407         UserAssert(lpps-&gt;hdc);
01408 
01409         retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01410                 pmsg-&gt;pwnd,
01411                 pmsg-&gt;msg,
01412                 pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
01413                 lpps,
01414                 pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01415 
01416         GlobalFree((HGLOBAL)lpps);
01417     }
01418 
01419     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01420 }
01421 <span class="preprocessor">#endif // RECVSIDE</span>
01422 <span class="preprocessor"></span>
01423 <span class="comment">/**************************************************************************\</span>
01424 <span class="comment">* fnINSIZECLIPBRD</span>
01425 <span class="comment">*</span>
01426 <span class="comment">* lParam is a supposed to be a Global Handle to DDESHARE memory.</span>
01427 <span class="comment">*</span>
01428 <span class="comment">* 11-Jun-1992 sanfords  Created</span>
01429 <span class="comment">\**************************************************************************/</span>
01430 
<a name="l01431"></a><a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html">01431</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html">_FNINSIZECLIPBRDMSG</a> {
<a name="l01432"></a><a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html#o0">01432</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html#o0">pwnd</a>;
<a name="l01433"></a><a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html#o1">01433</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01434"></a><a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html#o2">01434</a>     WPARAM wParam;
<a name="l01435"></a><a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html#o3">01435</a>     RECT <a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html#o3">rc</a>;
<a name="l01436"></a><a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html#o4">01436</a>     ULONG_PTR <a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html#o4">xParam</a>;
<a name="l01437"></a><a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html#o5">01437</a>     PROC <a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html#o5">xpfnProc</a>;
01438 } <a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html">FNINSIZECLIPBRDMSG</a>;
01439 
01440 <span class="preprocessor">#ifdef SENDSIDE</span>
01441 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INSIZECLIPBRD)
01442 {
01443     <span class="comment">/*</span>
01444 <span class="comment">     * We need to check clipboard access rights because the app could</span>
01445 <span class="comment">     * get the clipboard owner's window handle by enumeration etc and</span>
01446 <span class="comment">     * send this message</span>
01447 <span class="comment">     */</span>
01448 
01449     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINSIZECLIPBRD)
01450 
01451     UNREFERENCED_PARAMETER(dwSCMSFlags);
01452     UNREFERENCED_PARAMETER(psms);
01453 
01454     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINSIZECLIPBRD)
01455 
01456         LPRECT prc = (LPRECT)lParam;
01457 
01458         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a68">RtlAreAllAccessesGranted</a>(<a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>()-&gt;amwinsta,
01459                 WINSTA_ACCESSCLIPBOARD)) {
01460 
01461             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
01462             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
01463             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
01464             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;rc = *prc;
01465             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01466             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01467 
01468             <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01469             <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINSIZECLIPBRD);
01470             <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01471             <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01472         }
01473 
01474     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINSIZECLIPBRD"</span>);
01475     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(DWORD,0);
01476 }
01477 <span class="preprocessor">#endif // SENDSIDE</span>
01478 <span class="preprocessor"></span>
01479 <span class="preprocessor">#ifdef RECVSIDE</span>
01480 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINSIZECLIPBRD, <a class="code" href="../../d6/d7/struct__FNINSIZECLIPBRDMSG.html">FNINSIZECLIPBRDMSG</a>)
01481 {
01482     LPRECT lprc;
01483 
01484     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
01485 
01486     lprc = (LPRECT)GlobalAlloc(GMEM_FIXED | GMEM_DDESHARE, <span class="keyword">sizeof</span>(RECT));
01487     UserAssert(lprc);
01488 
01489     <span class="keywordflow">if</span> (lprc) {
01490         *lprc = pmsg-&gt;rc;
01491 
01492         retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01493                 pmsg-&gt;pwnd,
01494                 pmsg-&gt;msg,
01495                 pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
01496                 lprc,
01497                 pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01498 
01499         GlobalFree((HGLOBAL)lprc);
01500     }
01501 
01502     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01503 }
01504 <span class="preprocessor">#endif // RECVSIDE</span>
01505 <span class="preprocessor"></span>
01506 
01507 <span class="comment">/**************************************************************************\</span>
01508 <span class="comment">* fnINDESTROYCLIPBRD</span>
01509 <span class="comment">*</span>
01510 <span class="comment">* Special handler so we can call ClientEmptyClipboard on client</span>
01511 <span class="comment">*</span>
01512 <span class="comment">* 01-16-93 scottlu  Created</span>
01513 <span class="comment">\**************************************************************************/</span>
01514 
<a name="l01515"></a><a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html">01515</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html">_FNINDESTROYCLIPBRDMSG</a> {
<a name="l01516"></a><a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html#o0">01516</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html#o0">pwnd</a>;
<a name="l01517"></a><a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html#o1">01517</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01518"></a><a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html#o2">01518</a>     WPARAM wParam;
<a name="l01519"></a><a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html#o3">01519</a>     LPARAM lParam;
<a name="l01520"></a><a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html#o4">01520</a>     ULONG_PTR <a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html#o4">xParam</a>;
<a name="l01521"></a><a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html#o5">01521</a>     PROC <a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html#o5">xpfnProc</a>;
01522 } <a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html">FNINDESTROYCLIPBRDMSG</a>;
01523 
01524 <span class="preprocessor">#ifdef SENDSIDE</span>
01525 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INDESTROYCLIPBRD)
01526 {
01527     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINDESTROYCLIPBRD)
01528 
01529     UNREFERENCED_PARAMETER(dwSCMSFlags);
01530     UNREFERENCED_PARAMETER(psms);
01531 
01532     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINDESTROYCLIPBRD)
01533 
01534         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
01535         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
01536         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
01537         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = lParam;
01538         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01539         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01540 
01541         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01542         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINDESTROYCLIPBRD);
01543         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01544         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01545 
01546     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINDESTROYCLIPBRD"</span>);
01547     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
01548 }
01549 <span class="preprocessor">#endif // SENDSIDE</span>
01550 <span class="preprocessor"></span>
01551 <span class="preprocessor">#ifdef RECVSIDE</span>
01552 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINDESTROYCLIPBRD, <a class="code" href="../../d2/d5/struct__FNINDESTROYCLIPBRDMSG.html">FNINDESTROYCLIPBRDMSG</a>)
01553 {
01554     <span class="keywordtype">void</span> <a class="code" href="../../d3/d8/client_8c.html#a41">ClientEmptyClipboard</a>(<span class="keywordtype">void</span>);
01555 
01556     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
01557 
01558     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01559             pmsg-&gt;pwnd,
01560             pmsg-&gt;msg,
01561             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
01562             pmsg-&gt;lParam,
01563             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01564 
01565     <span class="comment">/*</span>
01566 <span class="comment">     * Now empty the client side clipboard cache.</span>
01567 <span class="comment">     * Don't do this if this is a 16bit app.  We don't want to clear out the</span>
01568 <span class="comment">     * clipboard just because one app is going away.  All of the 16bit apps</span>
01569 <span class="comment">     * share one clipboard.</span>
01570 <span class="comment">     */</span>
01571     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a16">GetClientInfo</a>()-&gt;CI_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a114">CI_16BIT</a>) == 0) {
01572         <a class="code" href="../../d3/d8/client_8c.html#a41">ClientEmptyClipboard</a>();
01573     }
01574 
01575     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01576 }
01577 <span class="preprocessor">#endif // RECVSIDE</span>
01578 <span class="preprocessor"></span>
01579 <span class="comment">/**************************************************************************\</span>
01580 <span class="comment">* yyy</span>
01581 <span class="comment">*</span>
01582 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
01583 <span class="comment">\**************************************************************************/</span>
01584 
<a name="l01585"></a><a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html">01585</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html">_FNINOUTLPSCROLLINFOMSG</a> {
<a name="l01586"></a><a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html#o0">01586</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html#o0">pwnd</a>;
<a name="l01587"></a><a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html#o1">01587</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01588"></a><a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html#o2">01588</a>     WPARAM wParam;
<a name="l01589"></a><a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html#o3">01589</a>     SCROLLINFO <a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html#o3">info</a>;
<a name="l01590"></a><a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html#o4">01590</a>     ULONG_PTR <a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html#o4">xParam</a>;
<a name="l01591"></a><a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html#o5">01591</a>     PROC <a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html#o5">xpfnProc</a>;
01592 } <a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html">FNINOUTLPSCROLLINFOMSG</a>;
01593 
01594 <span class="preprocessor">#ifdef SENDSIDE</span>
01595 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INOUTLPSCROLLINFO)
01596 {
01597     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINOUTLPSCROLLINFO)
01598 
01599     UNREFERENCED_PARAMETER(dwSCMSFlags);
01600 
01601     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINOUTLPSCROLLINFO)
01602 
01603         LPSCROLLINFO pinfo = (LPSCROLLINFO)lParam;
01604 
01605         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
01606         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
01607         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
01608         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;info = *pinfo;
01609         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01610         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01611 
01612         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01613         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINOUTLPSCROLLINFO);
01614         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01615         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01616 
01617         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
01618             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(pinfo, SCROLLINFO);
01619         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
01620 
01621     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINOUTLPSCROLLINFO"</span>);
01622     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
01623 }
01624 <span class="preprocessor">#endif // SENDSIDE</span>
01625 <span class="preprocessor"></span>
01626 <span class="preprocessor">#ifdef RECVSIDE</span>
01627 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINOUTLPSCROLLINFO, <a class="code" href="../../d7/d6/struct__FNINOUTLPSCROLLINFOMSG.html">FNINOUTLPSCROLLINFOMSG</a>)
01628 {
01629     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;info, <span class="keyword">sizeof</span>(pmsg-&gt;info));
01630 
01631     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01632             pmsg-&gt;pwnd,
01633             pmsg-&gt;msg,
01634             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
01635             &amp;pmsg-&gt;info,
01636             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01637 
01638     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01639 }
01640 <span class="preprocessor">#endif // RECVSIDE</span>
01641 <span class="preprocessor"></span>
01642 <span class="comment">/**************************************************************************\</span>
01643 <span class="comment">* yyy</span>
01644 <span class="comment">*</span>
01645 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
01646 <span class="comment">\**************************************************************************/</span>
01647 
<a name="l01648"></a><a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html">01648</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html">_FNINOUTLPPOINT5MSG</a> {
<a name="l01649"></a><a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html#o0">01649</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html#o0">pwnd</a>;
<a name="l01650"></a><a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html#o1">01650</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01651"></a><a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html#o2">01651</a>     WPARAM wParam;
<a name="l01652"></a><a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html#o3">01652</a>     <a class="code" href="../../d8/d5/structPOINT5.html">POINT5</a> <a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html#o3">point5</a>;
<a name="l01653"></a><a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html#o4">01653</a>     ULONG_PTR <a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html#o4">xParam</a>;
<a name="l01654"></a><a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html#o5">01654</a>     PROC <a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html#o5">xpfnProc</a>;
01655 } <a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html">FNINOUTLPPOINT5MSG</a>;
01656 
01657 <span class="preprocessor">#ifdef SENDSIDE</span>
01658 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INOUTLPPOINT5)
01659 {
01660     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINOUTLPPOINT5)
01661 
01662     UNREFERENCED_PARAMETER(dwSCMSFlags);
01663 
01664     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINOUTLPPOINT5)
01665 
01666         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a986">LPPOINT5</a> ppoint5 = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a986">LPPOINT5</a>)lParam;
01667 
01668         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
01669         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
01670         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
01671         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;point5 = *ppoint5;
01672         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01673         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01674 
01675         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01676         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINOUTLPPOINT5);
01677         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01678         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01679 
01680         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
01681              <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(ppoint5, <a class="code" href="../../d8/d5/structPOINT5.html">POINT5</a>);
01682         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
01683 
01684     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINOUTLPPOINT5"</span>);
01685     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
01686 }
01687 <span class="preprocessor">#endif // SENDSIDE</span>
01688 <span class="preprocessor"></span>
01689 <span class="preprocessor">#ifdef RECVSIDE</span>
01690 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINOUTLPPOINT5, <a class="code" href="../../d5/d6/struct__FNINOUTLPPOINT5MSG.html">FNINOUTLPPOINT5MSG</a>)
01691 {
01692     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;point5, <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d5/structPOINT5.html">POINT5</a>));
01693 
01694     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01695             pmsg-&gt;pwnd,
01696             pmsg-&gt;msg,
01697             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
01698             &amp;pmsg-&gt;point5,
01699             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01700 
01701     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01702 }
01703 <span class="preprocessor">#endif // RECVSIDE</span>
01704 <span class="preprocessor"></span>
01705 <span class="comment">/**************************************************************************\</span>
01706 <span class="comment">* yyy</span>
01707 <span class="comment">*</span>
01708 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
01709 <span class="comment">\**************************************************************************/</span>
01710 
<a name="l01711"></a><a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html">01711</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html">_FNINOUTLPRECTMSG</a> {
<a name="l01712"></a><a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html#o0">01712</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html#o0">pwnd</a>;
<a name="l01713"></a><a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html#o1">01713</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01714"></a><a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html#o2">01714</a>     WPARAM wParam;
<a name="l01715"></a><a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html#o3">01715</a>     RECT <a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html#o3">rect</a>;
<a name="l01716"></a><a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html#o4">01716</a>     ULONG_PTR <a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html#o4">xParam</a>;
<a name="l01717"></a><a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html#o5">01717</a>     PROC <a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html#o5">xpfnProc</a>;
01718 } <a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html">FNINOUTLPRECTMSG</a>;
01719 
01720 <span class="preprocessor">#ifdef SENDSIDE</span>
01721 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INOUTLPRECT)
01722 {
01723     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINOUTLPRECT)
01724 
01725     UNREFERENCED_PARAMETER(dwSCMSFlags);
01726 
01727     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINOUTLPRECT)
01728 
01729         LPRECT prect = (LPRECT)lParam;
01730 
01731         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
01732         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
01733         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
01734         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;rect = *prect;
01735         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01736         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01737 
01738         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01739         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINOUTLPRECT);
01740         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01741         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01742 
01743         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
01744             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(prect, RECT);
01745         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
01746 
01747     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINOUTLPRECT"</span>);
01748     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
01749 }
01750 <span class="preprocessor">#endif // SENDSIDE</span>
01751 <span class="preprocessor"></span>
01752 <span class="preprocessor">#ifdef RECVSIDE</span>
01753 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINOUTLPRECT, <a class="code" href="../../d6/d6/struct__FNINOUTLPRECTMSG.html">FNINOUTLPRECTMSG</a>)
01754 {
01755     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;rect, <span class="keyword">sizeof</span>(pmsg-&gt;rect));
01756 
01757     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01758             pmsg-&gt;pwnd,
01759             pmsg-&gt;msg,
01760             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
01761             &amp;pmsg-&gt;rect,
01762             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01763 
01764     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01765 }
01766 <span class="preprocessor">#endif // RECVSIDE</span>
01767 <span class="preprocessor"></span>
01768 <span class="comment">/**************************************************************************\</span>
01769 <span class="comment">* yyy</span>
01770 <span class="comment">*</span>
01771 <span class="comment">* 11-25-92 ScottLu      Created.</span>
01772 <span class="comment">\**************************************************************************/</span>
01773 
<a name="l01774"></a><a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html">01774</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html">_FNINOUTNCCALCSIZEMSG</a> {
<a name="l01775"></a><a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o0">01775</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o0">pwnd</a>;
<a name="l01776"></a><a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o1">01776</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01777"></a><a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o2">01777</a>     WPARAM wParam;
<a name="l01778"></a><a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o3">01778</a>     ULONG_PTR <a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o3">xParam</a>;
<a name="l01779"></a><a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o4">01779</a>     PROC <a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o4">xpfnProc</a>;
01780     <span class="keyword">union </span>{
<a name="l01781"></a><a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o5">01781</a>         RECT <a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o5">rc</a>;
01782         <span class="keyword">struct </span>{
<a name="l01783"></a><a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o6">01783</a>             NCCALCSIZE_PARAMS <a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o6">params</a>;
<a name="l01784"></a><a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o7">01784</a>             WINDOWPOS <a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o7">pos</a>;
01785         } p;
01786     } <a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html#o9">u</a>;
01787 } <a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html">FNINOUTNCCALCSIZEMSG</a>;
01788 
<a name="l01789"></a><a class="code" href="../../d5/d7/struct__OUTNCCALCSIZE.html">01789</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d7/struct__OUTNCCALCSIZE.html">_OUTNCCALCSIZE</a> {
<a name="l01790"></a><a class="code" href="../../d5/d7/struct__OUTNCCALCSIZE.html#o0">01790</a>     NCCALCSIZE_PARAMS <a class="code" href="../../d5/d7/struct__OUTNCCALCSIZE.html#o0">params</a>;
<a name="l01791"></a><a class="code" href="../../d5/d7/struct__OUTNCCALCSIZE.html#o1">01791</a>     WINDOWPOS <a class="code" href="../../d5/d7/struct__OUTNCCALCSIZE.html#o1">pos</a>;
01792 } <a class="code" href="../../d5/d7/struct__OUTNCCALCSIZE.html">OUTNCCALCSIZE</a>, *<a class="code" href="../../d5/d7/struct__OUTNCCALCSIZE.html">POUTNCCALCSIZE</a>;
01793 
01794 <span class="preprocessor">#ifdef SENDSIDE</span>
01795 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INOUTNCCALCSIZE)
01796 {
01797     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINOUTNCCALCSIZE)
01798 
01799     UNREFERENCED_PARAMETER(dwSCMSFlags);
01800 
01801     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINOUTNCCALCSIZE)
01802 
01803         LPWINDOWPOS lppos;
01804         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cbCallback;
01805 
01806         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
01807         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
01808         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
01809         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01810         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01811 
01812         <span class="comment">/*</span>
01813 <span class="comment">         * If wParam != 0, lParam points to a NCCALCSIZE_PARAMS structure,</span>
01814 <span class="comment">         * otherwise it points to a rectangle.</span>
01815 <span class="comment">         */</span>
01816         <span class="keywordflow">if</span> (wParam != 0) {
01817             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;u.p.params = *((LPNCCALCSIZE_PARAMS)lParam);
01818             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;u.p.pos = *(<a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;u.p.params.lppos);
01819             cbCallback = <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html">FNINOUTNCCALCSIZEMSG</a>);
01820         } <span class="keywordflow">else</span> {
01821             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;u.rc = *((LPRECT)lParam);
01822             cbCallback = FIELD_OFFSET(<a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html">FNINOUTNCCALCSIZEMSG</a>, u) +
01823                     <span class="keyword">sizeof</span>(RECT);
01824         }
01825 
01826         <span class="comment">/*</span>
01827 <span class="comment">         * Don't use the MAKECALL macro so we can</span>
01828 <span class="comment">         * select the callback data size</span>
01829 <span class="comment">         */</span>
01830         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01831         <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
01832         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d7/d4/ke_2ppc_2callback_8c.html#a0">KeUserModeCallback</a>(
01833             FI_FNINOUTNCCALCSIZE,
01834             mp,
01835             cbCallback,
01836             &amp;pcbs,
01837             &amp;cbCBStatus);
01838         <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
01839         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01840         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01841 
01842         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
01843             try {
01844                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput, <a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;cbOutput, <span class="keyword">sizeof</span>(DWORD));
01845                 <span class="keywordflow">if</span> (wParam != 0) {
01846                     lppos = ((LPNCCALCSIZE_PARAMS)lParam)-&gt;lppos;
01847                     *((LPNCCALCSIZE_PARAMS)lParam) =
01848                             ((<a class="code" href="../../d9/d7/ntcb_8h.html#a25">POUTNCCALCSIZE</a>)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput)-&gt;params;
01849                     *lppos = ((<a class="code" href="../../d9/d7/ntcb_8h.html#a25">POUTNCCALCSIZE</a>)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput)-&gt;pos;
01850                     ((LPNCCALCSIZE_PARAMS)lParam)-&gt;lppos = lppos;
01851                 } <span class="keywordflow">else</span> {
01852                     *((LPRECT)lParam) = *(PRECT)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput;
01853                 }
01854             } except (W32ExceptionHandler(TRUE, RIP_WARNING)) {
01855                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
01856             }
01857         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
01858 
01859     TRACECALLBACKMSG("SfnINOUTNCCALCSIZE");
01860     ENDSEND(DWORD,0);
01861 }
01862 #endif <span class="comment">// SENDSIDE</span>
01863 
01864 #ifdef RECVSIDE
01865 RECVCALL(fnINOUTNCCALCSIZE, <a class="code" href="../../d0/d7/struct__FNINOUTNCCALCSIZEMSG.html">FNINOUTNCCALCSIZEMSG</a>)
01866 {
01867     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;u, <span class="keyword">sizeof</span>(pmsg-&gt;u));
01868 
01869     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam) != 0)
01870         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(u.p.params).lppos = <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(u.p.pos);
01871 
01872     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01873             pmsg-&gt;pwnd,
01874             pmsg-&gt;msg,
01875             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
01876             (LPARAM)&amp;pmsg-&gt;u,
01877             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01878 
01879     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01880 }
01881 <span class="preprocessor">#endif // RECVSIDE</span>
01882 <span class="preprocessor"></span>
01883 <span class="comment">/**************************************************************************\</span>
01884 <span class="comment">* yyy</span>
01885 <span class="comment">*</span>
01886 <span class="comment">* 9/30/94 Sanfords created</span>
01887 <span class="comment">\**************************************************************************/</span>
01888 
<a name="l01889"></a><a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html">01889</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html">_FNINOUTSTYLECHANGEMSG</a> {
<a name="l01890"></a><a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html#o0">01890</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html#o0">pwnd</a>;
<a name="l01891"></a><a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html#o1">01891</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01892"></a><a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html#o2">01892</a>     WPARAM wParam;
<a name="l01893"></a><a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html#o3">01893</a>     STYLESTRUCT <a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html#o3">ss</a>;
<a name="l01894"></a><a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html#o4">01894</a>     ULONG_PTR <a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html#o4">xParam</a>;
<a name="l01895"></a><a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html#o5">01895</a>     PROC <a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html#o5">xpfnProc</a>;
01896 } <a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html">FNINOUTSTYLECHANGEMSG</a>;
01897 
01898 <span class="preprocessor">#ifdef SENDSIDE</span>
01899 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INOUTSTYLECHANGE)
01900 {
01901     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINOUTSTYLECHANGE)
01902 
01903     UNREFERENCED_PARAMETER(dwSCMSFlags);
01904     UNREFERENCED_PARAMETER(psms);
01905 
01906     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINOUTSTYLECHANGE)
01907 
01908         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
01909         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
01910         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
01911         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01912         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01913         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ss = *((LPSTYLESTRUCT)lParam);
01914 
01915         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01916         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINOUTSTYLECHANGE);
01917         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01918         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01919 
01920         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> == WM_STYLECHANGING)
01921             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(((LPSTYLESTRUCT)lParam), STYLESTRUCT);
01922 
01923     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINOUTSTYLECHANGE"</span>);
01924     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
01925 }
01926 <span class="preprocessor">#endif // SENDSIDE</span>
01927 <span class="preprocessor"></span>
01928 <span class="preprocessor">#ifdef RECVSIDE</span>
01929 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINOUTSTYLECHANGE, <a class="code" href="../../d4/d7/struct__FNINOUTSTYLECHANGEMSG.html">FNINOUTSTYLECHANGEMSG</a>)
01930 {
01931     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;ss, <span class="keyword">sizeof</span>(pmsg-&gt;ss));
01932 
01933     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
01934             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
01935             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
01936             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
01937             (LPARAM)&amp;pmsg-&gt;ss,
01938             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
01939 
01940     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
01941 }
01942 <span class="preprocessor">#endif // RECVSIDE</span>
01943 <span class="preprocessor"></span>
01944 <span class="comment">/**************************************************************************\</span>
01945 <span class="comment">* yyy</span>
01946 <span class="comment">*</span>
01947 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
01948 <span class="comment">\**************************************************************************/</span>
01949 
<a name="l01950"></a><a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html">01950</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html">_FNOUTLPRECTMSG</a> {
<a name="l01951"></a><a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html#o0">01951</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html#o0">pwnd</a>;
<a name="l01952"></a><a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html#o1">01952</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01953"></a><a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html#o2">01953</a>     WPARAM wParam;
<a name="l01954"></a><a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html#o3">01954</a>     ULONG_PTR <a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html#o3">xParam</a>;
<a name="l01955"></a><a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html#o4">01955</a>     PROC <a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html#o4">xpfnProc</a>;
01956 } <a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html">FNOUTLPRECTMSG</a>;
01957 
01958 <span class="preprocessor">#ifdef SENDSIDE</span>
01959 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(OUTLPRECT)
01960 {
01961     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNOUTLPRECT)
01962 
01963     UNREFERENCED_PARAMETER(dwSCMSFlags);
01964 
01965     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNOUTLPRECT)
01966 
01967         LPRECT prect = (LPRECT)lParam;
01968 
01969         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
01970         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
01971         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
01972         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
01973         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
01974 
01975         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
01976         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNOUTLPRECT);
01977         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
01978         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
01979 
01980         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
01981             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(prect, RECT);
01982         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
01983 
01984     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnOUTLPRECT"</span>);
01985     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
01986 }
01987 <span class="preprocessor">#endif // SENDSIDE</span>
01988 <span class="preprocessor"></span>
01989 <span class="preprocessor">#ifdef RECVSIDE</span>
01990 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnOUTLPRECT, <a class="code" href="../../d5/d8/struct__FNOUTLPRECTMSG.html">FNOUTLPRECTMSG</a>)
01991 {
01992     RECT rc;
01993 
01994     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;rc, <span class="keyword">sizeof</span>(rc));
01995 
01996     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
01997             pmsg-&gt;pwnd,
01998             pmsg-&gt;msg,
01999             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02000             &amp;rc,
02001             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
02002 
02003     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02004 }
02005 <span class="preprocessor">#endif // RECVSIDE</span>
02006 <span class="preprocessor"></span>
02007 <span class="comment">/**************************************************************************\</span>
02008 <span class="comment">* yyy</span>
02009 <span class="comment">*</span>
02010 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
02011 <span class="comment">\**************************************************************************/</span>
02012 
<a name="l02013"></a><a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html">02013</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html">_FNINLPCOMPAREITEMSTRUCTMSG</a> {
<a name="l02014"></a><a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html#o0">02014</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html#o0">pwnd</a>;
<a name="l02015"></a><a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html#o1">02015</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02016"></a><a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html#o2">02016</a>     WPARAM wParam;
<a name="l02017"></a><a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html#o3">02017</a>     COMPAREITEMSTRUCT <a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html#o3">compareitemstruct</a>;
<a name="l02018"></a><a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html#o4">02018</a>     ULONG_PTR <a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html#o4">xParam</a>;
<a name="l02019"></a><a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html#o5">02019</a>     PROC <a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html#o5">xpfnProc</a>;
02020 } <a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html">FNINLPCOMPAREITEMSTRUCTMSG</a>;
02021 
02022 <span class="preprocessor">#ifdef SENDSIDE</span>
02023 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INLPCOMPAREITEMSTRUCT)
02024 {
02025     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINLPCOMPAREITEMSTRUCT)
02026 
02027     UNREFERENCED_PARAMETER(dwSCMSFlags);
02028     UNREFERENCED_PARAMETER(psms);
02029 
02030     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINLPCOMPAREITEMSTRUCT)
02031 
02032         LPCOMPAREITEMSTRUCT pcompareitemstruct = (LPCOMPAREITEMSTRUCT)lParam;
02033 
02034         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
02035         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
02036         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
02037         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;compareitemstruct = *pcompareitemstruct;
02038         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
02039         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02040 
02041         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02042         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINLPCOMPAREITEMSTRUCT);
02043         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02044         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02045 
02046     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINLPCOMPAREITEMSTRUCT"</span>);
02047     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
02048 }
02049 <span class="preprocessor">#endif // SENDSIDE</span>
02050 <span class="preprocessor"></span>
02051 <span class="preprocessor">#ifdef RECVSIDE</span>
02052 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINLPCOMPAREITEMSTRUCT, <a class="code" href="../../d4/d5/struct__FNINLPCOMPAREITEMSTRUCTMSG.html">FNINLPCOMPAREITEMSTRUCTMSG</a>)
02053 {
02054     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
02055 
02056     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
02057             pmsg-&gt;pwnd,
02058             pmsg-&gt;msg,
02059             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02060             &amp;(pmsg-&gt;compareitemstruct),
02061             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
02062 
02063     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02064 }
02065 <span class="preprocessor">#endif // RECVSIDE</span>
02066 <span class="preprocessor"></span>
02067 <span class="comment">/**************************************************************************\</span>
02068 <span class="comment">* yyy</span>
02069 <span class="comment">*</span>
02070 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
02071 <span class="comment">\**************************************************************************/</span>
02072 
<a name="l02073"></a><a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html">02073</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html">_FNINLPDELETEITEMSTRUCTMSG</a> {
<a name="l02074"></a><a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html#o0">02074</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html#o0">pwnd</a>;
<a name="l02075"></a><a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html#o1">02075</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02076"></a><a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html#o2">02076</a>     WPARAM wParam;
<a name="l02077"></a><a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html#o3">02077</a>     DELETEITEMSTRUCT <a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html#o3">deleteitemstruct</a>;
<a name="l02078"></a><a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html#o4">02078</a>     ULONG_PTR <a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html#o4">xParam</a>;
<a name="l02079"></a><a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html#o5">02079</a>     PROC <a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html#o5">xpfnProc</a>;
02080 } <a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html">FNINLPDELETEITEMSTRUCTMSG</a>;
02081 
02082 <span class="preprocessor">#ifdef SENDSIDE</span>
02083 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INLPDELETEITEMSTRUCT)
02084 {
02085     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINLPDELETEITEMSTRUCT)
02086 
02087     UNREFERENCED_PARAMETER(dwSCMSFlags);
02088     UNREFERENCED_PARAMETER(psms);
02089 
02090     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINLPDELETEITEMSTRUCT)
02091 
02092         LPDELETEITEMSTRUCT pdeleteitemstruct = (LPDELETEITEMSTRUCT)lParam;
02093 
02094         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
02095         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
02096         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
02097         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;deleteitemstruct = *pdeleteitemstruct;
02098         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
02099         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02100 
02101         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02102         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINLPDELETEITEMSTRUCT);
02103         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02104         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02105 
02106     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINLPDELETEITEMSTRUCT"</span>);
02107     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
02108 }
02109 <span class="preprocessor">#endif // SENDSIDE</span>
02110 <span class="preprocessor"></span>
02111 <span class="preprocessor">#ifdef RECVSIDE</span>
02112 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINLPDELETEITEMSTRUCT, <a class="code" href="../../d6/d5/struct__FNINLPDELETEITEMSTRUCTMSG.html">FNINLPDELETEITEMSTRUCTMSG</a>)
02113 {
02114     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
02115 
02116     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
02117             pmsg-&gt;pwnd,
02118             pmsg-&gt;msg,
02119             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02120             &amp;(pmsg-&gt;deleteitemstruct),
02121             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
02122 
02123     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02124 }
02125 <span class="preprocessor">#endif // RECVSIDE</span>
02126 <span class="preprocessor"></span>
02127 <span class="comment">/**************************************************************************\</span>
02128 <span class="comment">* FNINHLPSTRUCT</span>
02129 <span class="comment">*</span>
02130 <span class="comment">* 06-08-92 SanfordS Created</span>
02131 <span class="comment">\**************************************************************************/</span>
02132 
<a name="l02133"></a><a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html">02133</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html">_FNINLPHLPSTRUCTMSG</a> {
<a name="l02134"></a><a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o0">02134</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o0">CaptureBuf</a>;
<a name="l02135"></a><a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o1">02135</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o1">pwnd</a>;
<a name="l02136"></a><a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o2">02136</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02137"></a><a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o3">02137</a>     WPARAM wParam;
<a name="l02138"></a><a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o4">02138</a>     LPHLP <a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o4">lphlp</a>;
<a name="l02139"></a><a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o5">02139</a>     ULONG_PTR <a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o5">xParam</a>;
<a name="l02140"></a><a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o6">02140</a>     PROC <a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html#o6">xpfnProc</a>;
02141 } <a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html">FNINLPHLPSTRUCTMSG</a>;
02142 
02143 <span class="preprocessor">#ifdef SENDSIDE</span>
02144 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INLPHLPSTRUCT)
02145 {
02146     LPHLP lphlp = (LPHLP)lParam;
02147 
02148     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINLPHLPSTRUCT)
02149 
02150     UNREFERENCED_PARAMETER(dwSCMSFlags);
02151     UNREFERENCED_PARAMETER(psms);
02152 
02153     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNINLPHLPSTRUCT, 1, lphlp-&gt;cbData, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
02154 
02155         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
02156         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
02157         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
02158         <a class="code" href="../../d3/d5/ssend_8c.html#a38">COPYBYTES</a>(lphlp, lphlp-&gt;cbData);
02159         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
02160         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02161 
02162         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02163         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNINLPHLPSTRUCT);
02164         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02165         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02166 
02167     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINLPHLPSTRUCT"</span>);
02168     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
02169 }
02170 <span class="preprocessor">#endif // SENDSIDE</span>
02171 <span class="preprocessor"></span>
02172 <span class="preprocessor">#ifdef RECVSIDE</span>
02173 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINLPHLPSTRUCT, <a class="code" href="../../d9/d5/struct__FNINLPHLPSTRUCTMSG.html">FNINLPHLPSTRUCTMSG</a>)
02174 {
02175     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
02176     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
02177 
02178     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
02179             pmsg-&gt;pwnd,
02180             pmsg-&gt;msg,
02181             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02182             <a class="code" href="../../d5/d8/crecv_8c.html#a16">FIXUP</a>(lphlp),
02183             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
02184 
02185     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02186 }
02187 <span class="preprocessor">#endif // RECVSIDE</span>
02188 <span class="preprocessor"></span>
02189 <span class="preprocessor">#ifndef WINHELP4</span>
02190 <span class="preprocessor"></span>
02191 <span class="comment">/**************************************************************************\</span>
02192 <span class="comment">* FNINHELPINFOSTRUCT</span>
02193 <span class="comment">*</span>
02194 <span class="comment">* 06-08-92 SanfordS Created</span>
02195 <span class="comment">\**************************************************************************/</span>
02196 
<a name="l02197"></a><a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html">02197</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html">_FNINLPHELPFINFOSTRUCTMSG</a> {
<a name="l02198"></a><a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o0">02198</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o0">CaptureBuf</a>;
<a name="l02199"></a><a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o1">02199</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o1">pwnd</a>;
<a name="l02200"></a><a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o2">02200</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02201"></a><a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o3">02201</a>     WPARAM wParam;
<a name="l02202"></a><a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o4">02202</a>     LPHELPINFO <a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o4">lphlp</a>;
<a name="l02203"></a><a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o5">02203</a>     ULONG_PTR <a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o5">xParam</a>;
<a name="l02204"></a><a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o6">02204</a>     PROC <a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html#o6">xpfnProc</a>;
02205 } <a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html">FNINLPHELPINFOSTRUCTMSG</a>;
02206 
02207 <span class="preprocessor">#ifdef SENDSIDE</span>
02208 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INLPHELPINFOSTRUCT)
02209 {
02210     LPHELPINFO lphlp = (LPHELPINFO)lParam;
02211 
02212     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINLPHELPINFOSTRUCT)
02213 
02214     UNREFERENCED_PARAMETER(dwSCMSFlags);
02215     UNREFERENCED_PARAMETER(psms);
02216 
02217     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNINLPHELPINFOSTRUCT, 1, lphlp-&gt;cbSize, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
02218 
02219         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
02220         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
02221         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
02222         <a class="code" href="../../d3/d5/ssend_8c.html#a38">COPYBYTES</a>(lphlp, lphlp-&gt;cbSize);
02223         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
02224         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02225 
02226         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02227         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNINLPHELPINFOSTRUCT);
02228         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02229         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02230 
02231     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINLPHELPINFOSTRUCT"</span>);
02232     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
02233 }
02234 <span class="preprocessor">#endif // SENDSIDE</span>
02235 <span class="preprocessor"></span>
02236 <span class="preprocessor">#ifdef RECVSIDE</span>
02237 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINLPHELPINFOSTRUCT, <a class="code" href="../../d8/d5/struct__FNINLPHELPFINFOSTRUCTMSG.html">FNINLPHELPINFOSTRUCTMSG</a>)
02238 {
02239     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
02240     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
02241 
02242     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
02243             pmsg-&gt;pwnd,
02244             pmsg-&gt;msg,
02245             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02246             <a class="code" href="../../d5/d8/crecv_8c.html#a16">FIXUP</a>(lphlp),
02247             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
02248 
02249     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02250 }
02251 <span class="preprocessor">#endif // RECVSIDE</span>
02252 <span class="preprocessor"></span><span class="preprocessor">#endif // WINHELP4</span>
02253 <span class="preprocessor"></span>
02254 <span class="comment">/**************************************************************************\</span>
02255 <span class="comment">* yyy</span>
02256 <span class="comment">*</span>
02257 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
02258 <span class="comment">\**************************************************************************/</span>
02259 
<a name="l02260"></a><a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html">02260</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html">_FNINLPDRAWITEMSTRUCTMSG</a> {
<a name="l02261"></a><a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html#o0">02261</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html#o0">pwnd</a>;
<a name="l02262"></a><a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html#o1">02262</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02263"></a><a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html#o2">02263</a>     WPARAM wParam;
<a name="l02264"></a><a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html#o3">02264</a>     DRAWITEMSTRUCT <a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html#o3">drawitemstruct</a>;
<a name="l02265"></a><a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html#o4">02265</a>     ULONG_PTR <a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html#o4">xParam</a>;
<a name="l02266"></a><a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html#o5">02266</a>     PROC <a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html#o5">xpfnProc</a>;
02267 } <a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html">FNINLPDRAWITEMSTRUCTMSG</a>;
02268 
02269 <span class="preprocessor">#ifdef SENDSIDE</span>
02270 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INLPDRAWITEMSTRUCT)
02271 {
02272     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINLPDRAWITEMSTRUCT)
02273 
02274     UNREFERENCED_PARAMETER(dwSCMSFlags);
02275     UNREFERENCED_PARAMETER(psms);
02276 
02277     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINLPDRAWITEMSTRUCT)
02278 
02279         LPDRAWITEMSTRUCT pdrawitemstruct = (LPDRAWITEMSTRUCT)lParam;
02280         HDC hdcOriginal = (HDC)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02281 
02282         <span class="comment">/*</span>
02283 <span class="comment">         * Make sure that this is not an OLE inter-process DrawItem</span>
02284 <span class="comment">         */</span>
02285         <span class="keywordflow">if</span> (GreGetObjectOwner((HOBJ)pdrawitemstruct-&gt;hDC, DC_TYPE) !=
02286                 W32GetCurrentPID()) {
02287             <span class="keywordflow">if</span> (pdrawitemstruct-&gt;hDC) {
02288                 <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndItem;
02289 
02290                 pwndItem = <a class="code" href="../../d4/d1/userk_8h.html#a1903">_WindowFromDC</a>(pdrawitemstruct-&gt;hDC);
02291 
02292                 <span class="keywordflow">if</span> (pwndItem) {
02293                     hdcOriginal = pdrawitemstruct-&gt;hDC;
02294                     pdrawitemstruct-&gt;hDC = <a class="code" href="../../d4/d1/userk_8h.html#a1694">_GetDC</a>(pwndItem);
02295                 }
02296             }
02297         }
02298 
02299 
02300         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
02301         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
02302         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
02303         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;drawitemstruct = *pdrawitemstruct;
02304         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
02305         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02306 
02307         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02308         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINLPDRAWITEMSTRUCT);
02309         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02310         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02311 
02312         <span class="keywordflow">if</span> (hdcOriginal) {
02313             <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(pdrawitemstruct-&gt;hDC);
02314             pdrawitemstruct-&gt;hDC = hdcOriginal;
02315         }
02316     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINLPDRAWITEMSTRUCT"</span>);
02317     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(DWORD,0);
02318 }
02319 <span class="preprocessor">#endif // SENDSIDE</span>
02320 <span class="preprocessor"></span>
02321 <span class="preprocessor">#ifdef RECVSIDE</span>
02322 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINLPDRAWITEMSTRUCT, <a class="code" href="../../d7/d5/struct__FNINLPDRAWITEMSTRUCTMSG.html">FNINLPDRAWITEMSTRUCTMSG</a>)
02323 {
02324     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
02325 
02326     <span class="keywordflow">if</span> (pmsg-&gt;drawitemstruct.hDC == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02327         <a class="code" href="../../d5/d8/crecv_8c.html#a8">MSGERRORCODE</a>(ERROR_INVALID_HANDLE);
02328 
02329     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
02330             pmsg-&gt;pwnd,
02331             pmsg-&gt;msg,
02332             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02333             &amp;(pmsg-&gt;drawitemstruct),
02334             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
02335 
02336     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02337 }
02338 <span class="preprocessor">#endif // RECVSIDE</span>
02339 <span class="preprocessor"></span>
02340 <span class="comment">/**************************************************************************\</span>
02341 <span class="comment">* fnINOUTLPMEASUREITEMSTRUCT</span>
02342 <span class="comment">*</span>
02343 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
02344 <span class="comment">\**************************************************************************/</span>
02345 
<a name="l02346"></a><a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html">02346</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html">_FNINOUTLPMEASUREITEMSTRUCTMSG</a> {
<a name="l02347"></a><a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html#o0">02347</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html#o0">pwnd</a>;
<a name="l02348"></a><a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html#o1">02348</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02349"></a><a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html#o2">02349</a>     WPARAM wParam;
<a name="l02350"></a><a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html#o3">02350</a>     MEASUREITEMSTRUCT <a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html#o3">measureitemstruct</a>;
<a name="l02351"></a><a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html#o4">02351</a>     ULONG_PTR <a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html#o4">xParam</a>;
<a name="l02352"></a><a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html#o5">02352</a>     PROC <a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html#o5">xpfnProc</a>;
02353 } <a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html">FNINOUTLPMEASUREITEMSTRUCTMSG</a>;
02354 
02355 <span class="preprocessor">#ifdef SENDSIDE</span>
02356 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INOUTLPMEASUREITEMSTRUCT)
02357 {
02358     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINOUTLPMEASUREITEMSTRUCT)
02359 
02360     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINOUTLPMEASUREITEMSTRUCT)
02361 
02362         PMEASUREITEMSTRUCT pmeasureitemstruct = (PMEASUREITEMSTRUCT)lParam;
02363 
02364         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
02365         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a543">MSGFLAG_MASK</a>;
02366         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
02367         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;measureitemstruct = *pmeasureitemstruct;
02368         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
02369         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02370 
02371         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02372         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINOUTLPMEASUREITEMSTRUCT);
02373         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02374         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02375 
02376         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
02377             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(pmeasureitemstruct, MEASUREITEMSTRUCT);
02378         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
02379 
02380     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINOUTLPMEASUREITEMSTRUCT"</span>);
02381     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
02382 }
02383 <span class="preprocessor">#endif // SENDSIDE</span>
02384 <span class="preprocessor"></span>
02385 <span class="preprocessor">#ifdef RECVSIDE</span>
02386 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINOUTLPMEASUREITEMSTRUCT, <a class="code" href="../../d4/d6/struct__FNINOUTLPMEASUREITEMSTRUCTMSG.html">FNINOUTLPMEASUREITEMSTRUCTMSG</a>)
02387 {
02388     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;measureitemstruct, <span class="keyword">sizeof</span>(pmsg-&gt;measureitemstruct));
02389 
02390     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
02391             pmsg-&gt;pwnd,
02392             pmsg-&gt;msg,
02393             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02394             &amp;pmsg-&gt;measureitemstruct,
02395             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
02396 
02397     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02398 }
02399 <span class="preprocessor">#endif // RECVSIDE</span>
02400 <span class="preprocessor"></span>
02401 <span class="comment">/**************************************************************************\</span>
02402 <span class="comment">* fnINSTRING</span>
02403 <span class="comment">*</span>
02404 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
02405 <span class="comment">* 27-Jan-1992 IanJa     Unicode/ANSI</span>
02406 <span class="comment">\**************************************************************************/</span>
02407 
<a name="l02408"></a><a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html">02408</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html">_FNINSTRINGMSG</a> {
<a name="l02409"></a><a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o0">02409</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o0">CaptureBuf</a>;
<a name="l02410"></a><a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o1">02410</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>       <a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o1">pwnd</a>;
<a name="l02411"></a><a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o2">02411</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>       <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02412"></a><a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o3">02412</a>     WPARAM     wParam;
<a name="l02413"></a><a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o4">02413</a>     ULONG_PTR   <a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o4">xParam</a>;
<a name="l02414"></a><a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o5">02414</a>     PROC       <a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o5">xpfnProc</a>;
<a name="l02415"></a><a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o6">02415</a>     LPTSTR     <a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html#o6">pwsz</a>;
02416 } <a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html">FNINSTRINGMSG</a>;
02417 
02418 <span class="preprocessor">#ifdef SENDSIDE</span>
02419 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INSTRING)
02420 {
02421     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> pstr = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)lParam;
02422     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>         cbCapture;
02423     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>         cCapture;
02424     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>          fAnsiReceiver = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
02425 
02426     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINSTRING)
02427 
02428     UNREFERENCED_PARAMETER(psms);
02429 
02430     <span class="comment">/*</span>
02431 <span class="comment">     * Compute ANSI capture lengths.  Don't capture if</span>
02432 <span class="comment">     * the strings are in the client's address space and</span>
02433 <span class="comment">     * of the correct type.</span>
02434 <span class="comment">     */</span>
02435     <span class="keywordflow">if</span> (pstr &amp;&amp;
02436         (<a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>((PVOID)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>) ||
02437         ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> != fAnsiReceiver))) {
02438 
02439         cCapture = 1;
02440         <a class="code" href="../../d3/d5/ssend_8c.html#a9">CALC_SIZE_IN</a>(cbCapture, pstr);
02441 
02442     } <span class="keywordflow">else</span> {
02443 
02444         cbCapture = 0;
02445         cCapture  = 0;
02446     }
02447 
02448     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNINSTRING, cCapture, cbCapture, TRUE)
02449 
02450         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;pwnd   = pwndClient;
02451         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;msg    = msg;
02452         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;wParam = wParam;
02453 
02454         if (cCapture) {
02455 
02456             <span class="keywordflow">if</span> (!pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
02457 
02458                 <span class="keywordflow">if</span> (fAnsiReceiver) {
02459                     <a class="code" href="../../d3/d5/ssend_8c.html#a47">LARGECOPYSTRINGLPWSTRA</a>(pstr, pwsz);
02460                 } <span class="keywordflow">else</span> {
02461                     <a class="code" href="../../d3/d5/ssend_8c.html#a45">LARGECOPYSTRINGLPWSTR</a>(pstr, pwsz);
02462                 }
02463 
02464             } <span class="keywordflow">else</span> {
02465 
02466                 <span class="keywordflow">if</span> (fAnsiReceiver) {
02467                     <a class="code" href="../../d3/d5/ssend_8c.html#a46">LARGECOPYSTRINGLPSTR</a>(pstr, pwsz);
02468                 } <span class="keywordflow">else</span> {
02469                     <a class="code" href="../../d3/d5/ssend_8c.html#a48">LARGECOPYSTRINGLPSTRW</a>(pstr, pwsz);
02470                 }
02471             }
02472 
02473         } <span class="keywordflow">else</span> {
02474 
02475             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwsz = (pstr ? pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02476         }
02477 
02478         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam   = xParam;
02479         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02480 
02481         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02482         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNINSTRING);
02483         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02484         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02485 
02486     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINSTRING"</span>);
02487     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(DWORD,0);
02488 }
02489 <span class="preprocessor">#endif // SENDSIDE</span>
02490 <span class="preprocessor"></span>
02491 <span class="preprocessor">#ifdef RECVSIDE</span>
02492 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINSTRING, <a class="code" href="../../d7/d7/struct__FNINSTRINGMSG.html">FNINSTRINGMSG</a>)
02493 {
02494     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
02495     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
02496 
02497     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
02498             pmsg-&gt;pwnd,
02499             pmsg-&gt;msg,
02500             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02501             pmsg-&gt;pwsz,
02502             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
02503 
02504     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02505 }
02506 <span class="preprocessor">#endif // RECVSIDE</span>
02507 <span class="preprocessor"></span>
02508 <span class="comment">/**************************************************************************\</span>
02509 <span class="comment">* fnINSTRINGNULL</span>
02510 <span class="comment">*</span>
02511 <span class="comment">* Server-side stub translates Unicode to ANSI if required.</span>
02512 <span class="comment">*</span>
02513 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
02514 <span class="comment">* 28-Jan-1992 IanJa     Unicode/ANSI  (Server translate to ANSI if rquired)</span>
02515 <span class="comment">\**************************************************************************/</span>
02516 
<a name="l02517"></a><a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html">02517</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html">_FNINSTRINGNULLMSG</a> {
<a name="l02518"></a><a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o0">02518</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o0">CaptureBuf</a>;
<a name="l02519"></a><a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o1">02519</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o1">pwnd</a>;
<a name="l02520"></a><a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o2">02520</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02521"></a><a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o3">02521</a>     WPARAM wParam;
<a name="l02522"></a><a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o4">02522</a>     ULONG_PTR <a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o4">xParam</a>;
<a name="l02523"></a><a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o5">02523</a>     PROC <a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o5">xpfnProc</a>;
<a name="l02524"></a><a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o6">02524</a>     LPTSTR <a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html#o6">pwsz</a>;
02525 } <a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html">FNINSTRINGNULLMSG</a>;
02526 
02527 <span class="preprocessor">#ifdef SENDSIDE</span>
02528 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INSTRINGNULL)
02529 {
02530     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> pstr = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)lParam;
02531     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCapture;
02532     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cCapture;
02533     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiReceiver = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
02534 
02535     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINSTRINGNULL)
02536 
02537     UNREFERENCED_PARAMETER(psms);
02538 
02539     cCapture = 0;
02540     cbCapture = 0;
02541     <span class="keywordflow">if</span> (pstr) {
02542 
02543         <span class="comment">/*</span>
02544 <span class="comment">         * Compute ANSI capture lengths.  Don't capture if</span>
02545 <span class="comment">         * the strings are in the client's address space and</span>
02546 <span class="comment">         * of the correct type.</span>
02547 <span class="comment">         */</span>
02548         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>((PVOID)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>) ||
02549                 (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> != fAnsiReceiver) {
02550             cCapture = 1;
02551             <a class="code" href="../../d3/d5/ssend_8c.html#a9">CALC_SIZE_IN</a>(cbCapture, pstr);
02552         }
02553     }
02554 
02555     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNINSTRINGNULL, cCapture, cbCapture, TRUE)
02556 
02557 
02558         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;pwnd = pwndClient;
02559         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;msg = msg;
02560         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;wParam = wParam;
02561         if (cCapture) {
02562             <span class="keywordflow">if</span> (!pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
02563                 <span class="keywordflow">if</span> (fAnsiReceiver) {
02564                     <a class="code" href="../../d3/d5/ssend_8c.html#a47">LARGECOPYSTRINGLPWSTRA</a>(pstr, pwsz);
02565                 } <span class="keywordflow">else</span> {
02566                     <a class="code" href="../../d3/d5/ssend_8c.html#a45">LARGECOPYSTRINGLPWSTR</a>(pstr, pwsz);
02567                 }
02568             } <span class="keywordflow">else</span> {
02569                 <span class="keywordflow">if</span> (fAnsiReceiver) {
02570                     <a class="code" href="../../d3/d5/ssend_8c.html#a46">LARGECOPYSTRINGLPSTR</a>(pstr, pwsz);
02571                 } <span class="keywordflow">else</span> {
02572                     <a class="code" href="../../d3/d5/ssend_8c.html#a48">LARGECOPYSTRINGLPSTRW</a>(pstr, pwsz);
02573                 }
02574             }
02575         } <span class="keywordflow">else</span>
02576             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwsz = pstr ? pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02577         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
02578         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02579 
02580         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02581         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNINSTRINGNULL);
02582         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02583         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02584 
02585     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINSTRINGNULL"</span>);
02586     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(DWORD,0);
02587 }
02588 <span class="preprocessor">#endif // SENDSIDE</span>
02589 <span class="preprocessor"></span>
02590 <span class="preprocessor">#ifdef RECVSIDE</span>
02591 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINSTRINGNULL, <a class="code" href="../../d8/d7/struct__FNINSTRINGNULLMSG.html">FNINSTRINGNULLMSG</a>)
02592 {
02593     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
02594     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
02595 
02596     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
02597             pmsg-&gt;pwnd,
02598             pmsg-&gt;msg,
02599             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02600             pmsg-&gt;pwsz,
02601             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
02602 
02603     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02604 }
02605 <span class="preprocessor">#endif // RECVSIDE</span>
02606 <span class="preprocessor"></span>
02607 <span class="comment">/**************************************************************************\</span>
02608 <span class="comment">* yyy</span>
02609 <span class="comment">*</span>
02610 <span class="comment">* 27-May-1997 GregoryW  Created</span>
02611 <span class="comment">\**************************************************************************/</span>
02612 
<a name="l02613"></a><a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html">02613</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html">_FNINLPKDRAWSWITCHWNDMSG</a> {
<a name="l02614"></a><a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o0">02614</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o0">CaptureBuf</a>;
<a name="l02615"></a><a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o1">02615</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o1">pwnd</a>;
<a name="l02616"></a><a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o2">02616</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02617"></a><a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o3">02617</a>     WPARAM wParam;
<a name="l02618"></a><a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o4">02618</a>     ULONG_PTR <a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o4">xParam</a>;
<a name="l02619"></a><a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o5">02619</a>     PROC <a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o5">xpfnProc</a>;
<a name="l02620"></a><a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o6">02620</a>     LPWSTR <a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o6">pwsz</a>;
<a name="l02621"></a><a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o7">02621</a>     RECT <a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html#o7">rcRect</a>;
02622 } <a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html">FNINLPKDRAWSWITCHWNDMSG</a>;
02623 
02624 <span class="preprocessor">#ifdef SENDSIDE</span>
02625 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INLPKDRAWSWITCHWND)
02626 {
02627     <a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html">PLARGE_UNICODE_STRING</a> pstr = &amp;((<a class="code" href="../../d6/d5/struct__LPKDRAWSWITCHWND.html">LPKDRAWSWITCHWND</a> *)lParam)-&gt;strName;
02628     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCapture;
02629     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cCapture = 1;  <span class="comment">// Always capture the string</span>
02630     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDCOwner;
02631     HDC hdcSwitch;
02632     COLORREF clrOldText, clrOldBk;
02633     HFONT hOldFont;
02634     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiReceiver = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;  <span class="comment">// The string is always Unicode</span>
02635 
02636     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINLPKDRAWSWITCHWND)
02637 
02638     UNREFERENCED_PARAMETER(psms);
02639     UNREFERENCED_PARAMETER(dwSCMSFlags);
02640 
02641     <a class="code" href="../../d3/d5/ssend_8c.html#a9">CALC_SIZE_IN</a>(cbCapture, pstr);
02642 
02643     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNINLPKDRAWSWITCHWND, cCapture, cbCapture, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
02644 
02645         <a class="code" href="../../d3/d5/ssend_8c.html#a45">LARGECOPYSTRINGLPWSTR</a>(pstr, pwsz);
02646 
02647         pwndDCOwner = <a class="code" href="../../d4/d1/userk_8h.html#a1903">_WindowFromDC</a>((HDC)wParam);
02648         hdcSwitch = <a class="code" href="../../d4/d1/userk_8h.html#a1694">_GetDC</a>(pwndDCOwner);
02649         clrOldText = GreSetTextColor(hdcSwitch, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(BTNTEXT));
02650         clrOldBk   = GreSetBkColor(hdcSwitch, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DFACE));
02651         hOldFont = GreSelectFont(hdcSwitch, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hCaptionFont);
02652 
02653         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
02654         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
02655         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = (WPARAM)hdcSwitch;
02656         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;rcRect = ((<a class="code" href="../../d6/d5/struct__LPKDRAWSWITCHWND.html">LPKDRAWSWITCHWND</a> *)lParam)-&gt;rcRect;
02657         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
02658         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02659 
02660         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02661         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNINLPKDRAWSWITCHWND);
02662         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02663 
02664         GreSelectFont(hdcSwitch, hOldFont);
02665         GreSetBkColor(hdcSwitch, clrOldBk);
02666         GreSetTextColor(hdcSwitch, clrOldText);
02667         <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdcSwitch);
02668 
02669         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02670 
02671     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINLPKDRAWSWITCHWND"</span>);
02672     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
02673 }
02674 <span class="preprocessor">#endif // SENDSIDE</span>
02675 <span class="preprocessor"></span>
02676 <span class="preprocessor">#ifdef RECVSIDE</span>
02677 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINLPKDRAWSWITCHWND, <a class="code" href="../../d0/d6/struct__FNINLPKDRAWSWITCHWNDMSG.html">FNINLPKDRAWSWITCHWNDMSG</a>)
02678 {
02679     DRAWTEXTPARAMS  dtp;
02680 
02681     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
02682     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
02683 
02684     dtp.cbSize = <span class="keyword">sizeof</span>(dtp);
02685     dtp.iLeftMargin = 0;
02686     dtp.iRightMargin = 0;
02687     retval = <a class="code" href="../../d5/d2/rtl_2drawtext_8c.html#a51">DrawTextExW</a>(
02688                  (HDC)pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02689                  pmsg-&gt;pwsz,
02690                  -1,
02691                  &amp;(pmsg-&gt;rcRect),
02692                  DT_NOPREFIX | DT_END_ELLIPSIS | DT_SINGLELINE,
02693                  &amp;dtp
02694                  );
02695     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02696 }
02697 <span class="preprocessor">#endif // RECVSIDE</span>
02698 <span class="preprocessor"></span>
<a name="l02699"></a><a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html">02699</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html">_FNINDEVICECHANGEMSG</a> {
<a name="l02700"></a><a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o0">02700</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o0">CaptureBuf</a>;
<a name="l02701"></a><a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o1">02701</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o1">pwnd</a>;
<a name="l02702"></a><a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o2">02702</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02703"></a><a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o3">02703</a>     WPARAM wParam;
<a name="l02704"></a><a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o4">02704</a>     ULONG_PTR <a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o4">xParam</a>;
<a name="l02705"></a><a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o5">02705</a>     PROC <a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o5">xpfnProc</a>;
<a name="l02706"></a><a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o6">02706</a>     LPTSTR <a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o6">pwsz</a>;
<a name="l02707"></a><a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o7">02707</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html#o7">fAnsi</a>;
02708 } <a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html">FNINDEVICECHANGEMSG</a>;
02709 
02710 <span class="preprocessor">#ifdef SENDSIDE</span>
02711 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INDEVICECHANGE)
02712 {
02713     PVOID pstr = (PVOID)lParam;
02714     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCapture;
02715     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiReceiver = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
02716     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fPtr    = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)((wParam &amp; 0x8000) == 0x8000);
02717 
02718     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINDEVICECHANGE)
02719 
02720     UNREFERENCED_PARAMETER(psms);
02721 
02722     cbCapture = 0;
02723     <span class="keywordflow">if</span> (fPtr &amp;&amp; (pstr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
02724 
02725         <span class="comment">/*</span>
02726 <span class="comment">         * Compute ANSI capture lengths.  Don't capture if</span>
02727 <span class="comment">         * the strings are in the client's address space and</span>
02728 <span class="comment">         * of the correct type.</span>
02729 <span class="comment">         */</span>
02730         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>((PVOID)pstr)) {
02731             cbCapture = *((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)pstr);
02732         }
02733     }
02734 
02735     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNINDEVICECHANGE, 1, cbCapture, TRUE)
02736 
02737         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;pwnd = pwndClient;
02738         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;msg = msg;
02739         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;wParam = wParam;
02740         if (cbCapture) {
02741            <a class="code" href="../../d3/d5/ssend_8c.html#a41">LARGECOPYBYTES2</a>(pstr, *((DWORD *)pstr), pwsz);
02742         } <span class="keywordflow">else</span> {
02743            <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwsz = (LPTSTR)pstr;
02744         }
02745 
02746         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;fAnsi = fAnsiReceiver;
02747         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
02748         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02749 
02750         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02751         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNINDEVICECHANGE);
02752         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02753         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02754 
02755     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINDEVICECHANGE"</span>);
02756     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(DWORD,0);
02757 }
02758 <span class="preprocessor">#endif // SENDSIDE</span>
02759 <span class="preprocessor"></span>
02760 <span class="preprocessor">#ifdef RECVSIDE</span>
02761 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINDEVICECHANGE, <a class="code" href="../../d3/d5/struct__FNINDEVICECHANGEMSG.html">FNINDEVICECHANGEMSG</a>)
02762 {
02763 
02764     <span class="keyword">struct </span>_DEV_BROADCAST_HEADER *pHdr;
02765     PDEV_BROADCAST_PORT_A pPortA = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02766     PDEV_BROADCAST_PORT_W pPortW;
02767     PDEV_BROADCAST_DEVICEINTERFACE_A pInterfaceA = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02768     PDEV_BROADCAST_DEVICEINTERFACE_W pInterfaceW;
02769     PDEV_BROADCAST_HANDLE pHandleA = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02770     PDEV_BROADCAST_HANDLE pHandleW;
02771 
02772     <span class="keywordtype">int</span> iStr, iSize;
02773     LPSTR lpStr;
02774     LPARAM lParam;
02775 
02776     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
02777     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
02778 
02779     <span class="keywordflow">if</span> (!(lParam = (LPARAM)pmsg-&gt;pwsz) || !(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a> &amp; 0x8000) || !pmsg-&gt;fAnsi) {
02780         <span class="keywordflow">goto</span> shipit;
02781     }
02782 
02783     pHdr = (<span class="keyword">struct </span>_DEV_BROADCAST_HEADER *)lParam;
02784     <span class="keywordflow">switch</span> (pHdr-&gt;dbcd_devicetype) {
02785     <span class="keywordflow">case</span> DBT_DEVTYP_PORT:
02786         pPortW = (PDEV_BROADCAST_PORT_W)lParam;
02787         iStr = wcslen(pPortW-&gt;dbcp_name);
02788         iSize = FIELD_OFFSET(DEV_BROADCAST_PORT_A, dbcp_name) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a123">DBCS_CHARSIZE</a>*(iStr+1);
02789         pPortA = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, iSize);
02790         <span class="keywordflow">if</span> (pPortA == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02791             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02792         RtlCopyMemory(pPortA, pPortW, FIELD_OFFSET(DEV_BROADCAST_PORT_A, dbcp_name));
02793         lpStr = pPortA-&gt;dbcp_name;
02794         <span class="keywordflow">if</span> (iStr) {
02795             WCSToMB(pPortW-&gt;dbcp_name, -1, &amp;lpStr, iStr, FALSE);
02796         }
02797         lpStr[iStr] = 0;
02798         pPortA-&gt;dbcp_size = iSize;
02799         lParam = (LPARAM)pPortA;
02800         <span class="keywordflow">break</span>;
02801     <span class="keywordflow">case</span> DBT_DEVTYP_DEVICEINTERFACE:
02802         pInterfaceW = (PDEV_BROADCAST_DEVICEINTERFACE_W)lParam;
02803         iStr = wcslen(pInterfaceW-&gt;dbcc_name);
02804         iSize = FIELD_OFFSET(DEV_BROADCAST_DEVICEINTERFACE_A, dbcc_name) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a123">DBCS_CHARSIZE</a>*(iStr+1);
02805         pInterfaceA = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, iSize);
02806         <span class="keywordflow">if</span> (pInterfaceA == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02807             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02808         RtlCopyMemory(pInterfaceA, pInterfaceW, FIELD_OFFSET(DEV_BROADCAST_DEVICEINTERFACE_A, dbcc_name));
02809         lpStr = pInterfaceA-&gt;dbcc_name;
02810         <span class="keywordflow">if</span> (iStr) {
02811             WCSToMB(pInterfaceW-&gt;dbcc_name, -1, &amp;lpStr, iStr, FALSE);
02812         }
02813         lpStr[iStr] = 0;
02814         pInterfaceA-&gt;dbcc_size = iSize;
02815         lParam = (LPARAM)pInterfaceA;
02816         <span class="keywordflow">break</span>;
02817     <span class="keywordflow">case</span> DBT_DEVTYP_HANDLE:
02818         pHandleW = (PDEV_BROADCAST_HANDLE)lParam;
02819         <span class="keywordflow">if</span> ((pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a> != DBT_CUSTOMEVENT) || (pHandleW-&gt;dbch_nameoffset &lt; 0)) <span class="keywordflow">break</span>;
02820         iStr = wcslen((LPWSTR)(pHandleW-&gt;dbch_data+pHandleW-&gt;dbch_nameoffset));
02821         iSize = pHandleW-&gt;dbch_size;
02822         <span class="comment">/*</span>
02823 <span class="comment">         * MB size can't be bigger than UNICODE size</span>
02824 <span class="comment">         */</span>
02825         pHandleA = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, iSize);
02826         <span class="keywordflow">if</span> (pHandleA == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
02827             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
02828         RtlCopyMemory(pHandleA, pHandleW, FIELD_OFFSET(DEV_BROADCAST_HANDLE, dbch_data)+ pHandleW-&gt;dbch_nameoffset);
02829         lpStr = pHandleA-&gt;dbch_data+pHandleA-&gt;dbch_nameoffset;
02830         <span class="keywordflow">if</span> (iStr) {
02831             WCSToMB((LPWSTR)(pHandleW-&gt;dbch_data+pHandleW-&gt;dbch_nameoffset), -1, &amp;lpStr, iStr, FALSE);
02832         }
02833         lpStr[iStr] = 0;
02834         pHandleA-&gt;dbch_size = iSize;
02835         lParam = (LPARAM)pHandleA;
02836 
02837 
02838         <span class="keywordflow">break</span>;
02839     }
02840 shipit:
02841     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
02842             pmsg-&gt;pwnd,
02843             pmsg-&gt;msg,
02844             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
02845             lParam,
02846             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
02847 
02848     <span class="keywordflow">if</span> (pInterfaceA) <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pInterfaceA);
02849     <span class="keywordflow">if</span> (pPortA) <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pPortA);
02850     <span class="keywordflow">if</span> (pHandleA) <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pHandleA);
02851 
02852     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02853 }
02854 <span class="preprocessor">#endif // RECVSIDE</span>
02855 <span class="preprocessor"></span>
02856 
02857 <span class="comment">/**************************************************************************\</span>
02858 <span class="comment">* fnOUTSTRING</span>
02859 <span class="comment">*</span>
02860 <span class="comment">* Warning this message copies but does not count the NULL in retval</span>
02861 <span class="comment">* as in WM_GETTEXT</span>
02862 <span class="comment">*</span>
02863 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
02864 <span class="comment">\**************************************************************************/</span>
02865 
<a name="l02866"></a><a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html">02866</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html">_FNOUTSTRINGMSG</a> {
<a name="l02867"></a><a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o0">02867</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o0">CaptureBuf</a>;
<a name="l02868"></a><a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o1">02868</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o1">pwnd</a>;
<a name="l02869"></a><a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o2">02869</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02870"></a><a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o3">02870</a>     WPARAM wParam;
<a name="l02871"></a><a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o4">02871</a>     ULONG_PTR <a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o4">xParam</a>;
<a name="l02872"></a><a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o5">02872</a>     PROC <a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o5">xpfnProc</a>;
<a name="l02873"></a><a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o6">02873</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> <a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o6">pOutput</a>;
<a name="l02874"></a><a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o7">02874</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html#o7">cbOutput</a>;
02875 } <a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html">FNOUTSTRINGMSG</a>;
02876 
02877 <span class="preprocessor">#ifdef SENDSIDE</span>
02878 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(OUTSTRING)
02879 {
02880     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> pstr = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)lParam;
02881     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCapture;
02882     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiReceiver = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
02883     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bInflateWParam = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02884 
02885     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNOUTSTRING)
02886 
02887     CALC_SIZE_OUT_STRING(cbCapture, pstr);
02888 
02889     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNOUTSTRING, 1, cbCapture, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
02890 
02891         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
02892         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
02893 
02894         <span class="comment">/*</span>
02895 <span class="comment">         * Need to wParam MBCS bytes may be required to form wParam Unicode bytes</span>
02896 <span class="comment">         */</span>
02897         <span class="keywordflow">if</span> (fAnsiReceiver &amp;&amp; !(pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>)) {
02898             <span class="comment">/*</span>
02899 <span class="comment">             * Unicode -&gt; Ansi</span>
02900 <span class="comment">             */</span>
02901             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = (wParam * <span class="keyword">sizeof</span>(WCHAR));
02902             <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;TIF_flags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a819">TIF_ANSILENGTH</a>;
02903             bInflateWParam = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02904         } <span class="keywordflow">else</span> {
02905             <span class="comment">/*</span>
02906 <span class="comment">             * if wParam is already adjusted for ANSI, we need to re-adjust for Unicode...</span>
02907 <span class="comment">             *</span>
02908 <span class="comment">             * This logic is for following cases...</span>
02909 <span class="comment">             *</span>
02910 <span class="comment">             * +========+===============+=============+================+=============+</span>
02911 <span class="comment">             * |WndProc |Unicode WndProc-&gt;Ansi WndProc-&gt;Unicode WndProc-&gt;Ansi WndProc|</span>
02912 <span class="comment">             * +--------+---------------+-------------+----------------+-------------+</span>
02913 <span class="comment">             * |Length  |      X        -&gt;  (X * 2)   -&gt;       X       -&gt;  (X * 2)   |</span>
02914 <span class="comment">             * +--------+---------------+-------------+----------------+-------------+</span>
02915 <span class="comment">             */</span>
02916             <span class="keywordflow">if</span> (!fAnsiReceiver &amp;&amp; (<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;TIF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a819">TIF_ANSILENGTH</a>)) {
02917                 <span class="comment">/* adjust limit also... */</span>
02918                 <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam = (wParam / <span class="keyword">sizeof</span>(WCHAR));
02919                 <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;TIF_flags &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a819">TIF_ANSILENGTH</a>;
02920             } <span class="keywordflow">else</span> {
02921                 <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
02922             }
02923         }
02924         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
02925         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
02926 
02927         <a class="code" href="../../d3/d5/ssend_8c.html#a57">RESERVEBYTES</a>(cbCapture, pOutput, cbOutput);
02928 
02929         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
02930         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNOUTSTRING);
02931         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
02932         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
02933 
02934         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
02935             if (retval) {
02936                 <span class="comment">/*</span>
02937 <span class="comment">                 * Non-zero retval means some text to copy out.  Do not copy out</span>
02938 <span class="comment">                 * more than the requested byte count 'wParam'.</span>
02939 <span class="comment">                 */</span>
02940                 <a class="code" href="../../d3/d5/ssend_8c.html#a56">COPYOUTLPWSTRLIMIT</a>(pstr, (<span class="keywordtype">int</span>)wParam);
02941             } <span class="keywordflow">else</span> {
02942                 <span class="comment">/*</span>
02943 <span class="comment">                 * A dialog function returning FALSE means no text to copy out,</span>
02944 <span class="comment">                 * but an empty string also has retval == 0: put a null char in</span>
02945 <span class="comment">                 * pstr for the latter case.</span>
02946 <span class="comment">                 */</span>
02947                 <span class="keywordflow">if</span> (wParam != 0) {
02948                     <span class="keywordflow">if</span> (pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
02949                          *(PCHAR)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> = 0;
02950                     } <span class="keywordflow">else</span> {
02951                          *(PWCHAR)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> = 0;
02952                     }
02953                 }
02954             }
02955         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
02956 
02957     TRACECALLBACKMSG("SfnOUTSTRING");
02958     ENDSENDCAPTUREOUTSTRING(DWORD,0);
02959 }
02960 #endif <span class="comment">// SENDSIDE</span>
02961 
02962 #ifdef RECVSIDE
02963 RECVCALL(fnOUTSTRING, <a class="code" href="../../d6/d8/struct__FNOUTSTRINGMSG.html">FNOUTSTRINGMSG</a>)
02964 {
02965     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> abOutput[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>];
02966 
02967     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, pmsg-&gt;cbOutput);
02968     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
02969     <span class="keywordflow">if</span> (pmsg-&gt;cbOutput &lt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>)
02970         CallbackStatus.pOutput = abOutput;
02971     <span class="keywordflow">else</span>
02972         CallbackStatus.pOutput = pmsg-&gt;pOutput;
02973 
02974     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
02975             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
02976             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
02977             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
02978             (LPARAM)CallbackStatus.pOutput,
02979             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
02980 
02981     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
02982 }
02983 <span class="preprocessor">#endif // RECVSIDE</span>
02984 <span class="preprocessor"></span>
02985 <span class="comment">/**************************************************************************\</span>
02986 <span class="comment">* fnINCNTOUTSTRING</span>
02987 <span class="comment">*</span>
02988 <span class="comment">* Does NOT NULL terminate string</span>
02989 <span class="comment">*</span>
02990 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
02991 <span class="comment">\**************************************************************************/</span>
02992 
<a name="l02993"></a><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html">02993</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html">_FNINCNTOUTSTRING</a> {
<a name="l02994"></a><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o0">02994</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o0">CaptureBuf</a>;
<a name="l02995"></a><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o1">02995</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o1">pwnd</a>;
<a name="l02996"></a><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o2">02996</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l02997"></a><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o3">02997</a>     WPARAM wParam;
<a name="l02998"></a><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o4">02998</a>     ULONG_PTR <a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o4">xParam</a>;
<a name="l02999"></a><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o5">02999</a>     PROC <a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o5">xpfnProc</a>;
<a name="l03000"></a><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o6">03000</a>     WORD <a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o6">cchMax</a>;
<a name="l03001"></a><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o7">03001</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> <a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o7">pOutput</a>;
<a name="l03002"></a><a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o8">03002</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html#o8">cbOutput</a>;
03003 } <a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html">FNINCNTOUTSTRINGMSG</a>;
03004 
03005 <span class="preprocessor">#ifdef SENDSIDE</span>
03006 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INCNTOUTSTRING)
03007 {
03008     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> pstr = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)lParam;
03009     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCapture;
03010     WORD cchOriginal;
03011     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiReceiver = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
03012 
03013     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINCNTOUTSTRING)
03014 
03015     <a class="code" href="../../d3/d5/ssend_8c.html#a10">CALC_SIZE_OUT</a>(cbCapture, pstr);
03016 
03017     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNINCNTOUTSTRING, 1, cbCapture, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
03018 
03019         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
03020         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
03021         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
03022         cchOriginal = (WORD)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o1">MaximumLength</a>;
03023         <span class="keywordflow">if</span> (!pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>)
03024             cchOriginal /= <span class="keyword">sizeof</span>(WCHAR);
03025 
03026         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cchMax = (WORD)<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cchOriginal, 0xffff);
03027         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
03028         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
03029 
03030         <a class="code" href="../../d3/d5/ssend_8c.html#a57">RESERVEBYTES</a>(cbCapture, pOutput, cbOutput);
03031 
03032         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
03033         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNINCNTOUTSTRING)
03034         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
03035         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
03036 
03037         <span class="comment">/*</span>
03038 <span class="comment">         * We don't want to do the copy out of the sender died or if</span>
03039 <span class="comment">         * this message was just sent as part of a CALLWNDPROC hook processing</span>
03040 <span class="comment">         */</span>
03041         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
03042             <span class="keywordflow">if</span> (retval) {
03043                 <span class="comment">/*</span>
03044 <span class="comment">                 * Non-zero retval means some text to copy out.  Do not copy out</span>
03045 <span class="comment">                 * more than the requested char count 'wParam'.</span>
03046 <span class="comment">                 */</span>
03047                 <a class="code" href="../../d3/d5/ssend_8c.html#a56">COPYOUTLPWSTRLIMIT</a>(pstr, (<span class="keywordtype">int</span>)cchOriginal);
03048             } <span class="keywordflow">else</span> {
03049                 <span class="comment">/*</span>
03050 <span class="comment">                 * A dialog function returning FALSE means no text to copy out,</span>
03051 <span class="comment">                 * but an empty string also has retval == 0: put a null char in</span>
03052 <span class="comment">                 * pstr for the latter case.</span>
03053 <span class="comment">                 */</span>
03054                 <span class="keywordflow">if</span> (pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
03055                     *(PCHAR)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> = 0;
03056                 } <span class="keywordflow">else</span> {
03057                     *(PWCHAR)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a> = 0;
03058                 }
03059             }
03060         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
03061 
03062     TRACECALLBACKMSG("SfnINCNTOUTSTRING");
03063     ENDSENDCAPTURE(DWORD,0);
03064 }
03065 #endif <span class="comment">// SENDSIDE</span>
03066 
03067 #ifdef RECVSIDE
03068 RECVCALL(fnINCNTOUTSTRING, <a class="code" href="../../d0/d5/struct__FNINCNTOUTSTRING.html">FNINCNTOUTSTRINGMSG</a>)
03069 {
03070     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> abOutput[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>];
03071 
03072     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, pmsg-&gt;cbOutput);
03073     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
03074     <span class="keywordflow">if</span> (pmsg-&gt;cbOutput &lt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>)
03075         CallbackStatus.pOutput = abOutput;
03076     <span class="keywordflow">else</span>
03077         CallbackStatus.pOutput = pmsg-&gt;pOutput;
03078 
03079     *(LPWORD)CallbackStatus.pOutput = <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(cchMax);
03080 
03081     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
03082             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
03083             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
03084             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
03085             (LPSTR)CallbackStatus.pOutput,
03086             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
03087 
03088     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03089 }
03090 <span class="preprocessor">#endif // RECVSIDE</span>
03091 <span class="preprocessor"></span>
03092 <span class="comment">/**************************************************************************\</span>
03093 <span class="comment">* fnINCNTOUTSTRINGNULL</span>
03094 <span class="comment">*</span>
03095 <span class="comment">* wParam specifies the maximum number of bytes to copy</span>
03096 <span class="comment">* the string is NULL terminated</span>
03097 <span class="comment">*</span>
03098 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
03099 <span class="comment">\**************************************************************************/</span>
03100 
<a name="l03101"></a><a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html">03101</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html">_FNINCNTOUTSTRINGNULL</a> {
<a name="l03102"></a><a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o0">03102</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o0">CaptureBuf</a>;
<a name="l03103"></a><a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o1">03103</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o1">pwnd</a>;
<a name="l03104"></a><a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o2">03104</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l03105"></a><a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o3">03105</a>     WPARAM wParam;
<a name="l03106"></a><a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o4">03106</a>     ULONG_PTR <a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o4">xParam</a>;
<a name="l03107"></a><a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o5">03107</a>     PROC <a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o5">xpfnProc</a>;
<a name="l03108"></a><a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o6">03108</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> <a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o6">pOutput</a>;
<a name="l03109"></a><a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o7">03109</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html#o7">cbOutput</a>;
03110 } <a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html">FNINCNTOUTSTRINGNULLMSG</a>;
03111 
03112 <span class="preprocessor">#ifdef SENDSIDE</span>
03113 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INCNTOUTSTRINGNULL)
03114 {
03115     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> pstr = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)lParam;
03116     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCapture;
03117     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiReceiver = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
03118 
03119     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINCNTOUTSTRINGNULL)
03120 
03121     <a class="code" href="../../d3/d5/ssend_8c.html#a10">CALC_SIZE_OUT</a>(cbCapture, pstr);
03122 
03123     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNINCNTOUTSTRINGNULL, 1, cbCapture, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
03124 
03125         <span class="keywordflow">if</span> (wParam &lt; 2) {   <span class="comment">// However unlikely, this prevents a possible GP</span>
03126             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();     <span class="comment">// on the server side.</span>
03127         }
03128 
03129         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
03130         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
03131         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
03132         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
03133         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
03134 
03135         <a class="code" href="../../d3/d5/ssend_8c.html#a57">RESERVEBYTES</a>(cbCapture, pOutput, cbOutput);
03136 
03137         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
03138         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNINCNTOUTSTRINGNULL)
03139         UNLOCKPWND();
03140         CHECKRETURN();
03141 
03142         <span class="comment">/*</span>
03143 <span class="comment">         * We don't want to do the copy out of the sender died or if</span>
03144 <span class="comment">         * this message was just sent as part of a CALLWNDPROC hook processing</span>
03145 <span class="comment">         */</span>
03146         BEGINCOPYOUT()
03147             if (pcbs-&gt;cbOutput != 0) {
03148 
03149                 <span class="comment">/*</span>
03150 <span class="comment">                 * Buffer changed means some text to copy out.  Do not copy out</span>
03151 <span class="comment">                 * more than the requested byte count 'wParam'.</span>
03152 <span class="comment">                 */</span>
03153                 <a class="code" href="../../d3/d5/ssend_8c.html#a56">COPYOUTLPWSTRLIMIT</a>(pstr, (<span class="keywordtype">int</span>)wParam);
03154             }
03155         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
03156 
03157     TRACECALLBACKMSG("SfnINCNTOUTSTRINGNULL");
03158     ENDSENDCAPTURE(DWORD,0);
03159 }
03160 #endif <span class="comment">// SENDSIDE</span>
03161 
03162 #ifdef RECVSIDE
03163 RECVCALL(fnINCNTOUTSTRINGNULL, <a class="code" href="../../d1/d5/struct__FNINCNTOUTSTRINGNULL.html">FNINCNTOUTSTRINGNULLMSG</a>)
03164 {
03165     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> abOutput[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>];
03166 
03167     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, pmsg-&gt;cbOutput);
03168     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
03169     <span class="keywordflow">if</span> (pmsg-&gt;cbOutput &lt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>)
03170         CallbackStatus.pOutput = abOutput;
03171     <span class="keywordflow">else</span>
03172         CallbackStatus.pOutput = pmsg-&gt;pOutput;
03173 
03174     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
03175             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
03176             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
03177             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
03178             (LPSTR)CallbackStatus.pOutput,
03179             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
03180 
03181     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03182 }
03183 <span class="preprocessor">#endif // RECVSIDE</span>
03184 <span class="preprocessor"></span>
03185 <span class="comment">/**************************************************************************\</span>
03186 <span class="comment">* fnPOUTLPINT</span>
03187 <span class="comment">*</span>
03188 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
03189 <span class="comment">\**************************************************************************/</span>
03190 
<a name="l03191"></a><a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html">03191</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html">_FNPOUTLPINTMSG</a> {
<a name="l03192"></a><a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o0">03192</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o0">CaptureBuf</a>;
<a name="l03193"></a><a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o1">03193</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o1">pwnd</a>;
<a name="l03194"></a><a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o2">03194</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l03195"></a><a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o3">03195</a>     WPARAM wParam;
<a name="l03196"></a><a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o4">03196</a>     ULONG_PTR <a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o4">xParam</a>;
<a name="l03197"></a><a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o5">03197</a>     PROC <a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o5">xpfnProc</a>;
<a name="l03198"></a><a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o6">03198</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> <a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o6">pOutput</a>;
<a name="l03199"></a><a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html#o7">03199</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOutput;
03200 } <a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html">FNPOUTLPINTMSG</a>;
03201 
03202 <span class="preprocessor">#ifdef SENDSIDE</span>
03203 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(POUTLPINT)
03204 {
03205     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCapture;
03206     LPINT pint = (LPINT)lParam;
03207 
03208     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNPOUTLPINT)
03209 
03210     cbCapture = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)wParam * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>);
03211 
03212     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNPOUTLPINT, 1, cbCapture, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
03213 
03214         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
03215         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
03216         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
03217         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
03218         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
03219 
03220         <span class="comment">/*</span>
03221 <span class="comment">         * Hooks should see the buffer content</span>
03222 <span class="comment">         */</span>
03223         <span class="keywordflow">if</span> (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a241">SCMS_FLAGS_INONLY</a>) {
03224             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cbOutput = cbCapture;
03225             <a class="code" href="../../d3/d5/ssend_8c.html#a41">LARGECOPYBYTES2</a>(pint, cbCapture, pOutput);
03226         } <span class="keywordflow">else</span> {
03227             <a class="code" href="../../d3/d5/ssend_8c.html#a57">RESERVEBYTES</a>(cbCapture, pOutput, cbOutput);
03228         }
03229 
03230         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
03231         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNPOUTLPINT);
03232         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
03233         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
03234 
03235         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
03236             try {
03237                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput, <a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;cbOutput, <span class="keyword">sizeof</span>(DWORD));
03238                 memcpy(pint, <a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput, cbCapture);
03239             } except (W32ExceptionHandler(TRUE, RIP_WARNING)) {
03240                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
03241             }
03242         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
03243 
03244     TRACECALLBACKMSG("SfnPOUTLPINT");
03245     ENDSENDCAPTURE(DWORD,0);
03246 }
03247 #endif <span class="comment">// SENDSIDE</span>
03248 
03249 #ifdef RECVSIDE
03250 RECVCALL(fnPOUTLPINT, <a class="code" href="../../d8/d8/struct__FNPOUTLPINTMSG.html">FNPOUTLPINTMSG</a>)
03251 {
03252     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> abOutput[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>];
03253 
03254     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, pmsg-&gt;cbOutput);
03255     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
03256     <span class="keywordflow">if</span> (pmsg-&gt;cbOutput &lt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>)
03257         CallbackStatus.pOutput = abOutput;
03258     <span class="keywordflow">else</span>
03259         CallbackStatus.pOutput = pmsg-&gt;pOutput;
03260 
03261     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
03262             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
03263             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
03264             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
03265             (LPINT)CallbackStatus.pOutput,
03266             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
03267 
03268     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03269 }
03270 <span class="preprocessor">#endif // RECVSIDE</span>
03271 <span class="preprocessor"></span>
03272 <span class="comment">/**************************************************************************\</span>
03273 <span class="comment">* fnPOPTINLPUINT</span>
03274 <span class="comment">*</span>
03275 <span class="comment">* NOTE!!! -- This function actually thunks arrays of INTs (32bit) and not</span>
03276 <span class="comment">* WORDs (16bit).  The name was left the same to prevent a global rebuild</span>
03277 <span class="comment">* of client and server.  The name should be changed to fnPOPTINLPINT as</span>
03278 <span class="comment">* soon as we ship the beta!  The corresponding callforward function in</span>
03279 <span class="comment">* cf2.h should also have its name changed.</span>
03280 <span class="comment">*</span>
03281 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
03282 <span class="comment">* 07-Jan-1993 JonPa     Changed to pass INTs instead of WORDs</span>
03283 <span class="comment">\**************************************************************************/</span>
03284 
<a name="l03285"></a><a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html">03285</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html">_FNPOPTINLPUINTMSG</a> {
<a name="l03286"></a><a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o0">03286</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o0">CaptureBuf</a>;
<a name="l03287"></a><a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o1">03287</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o1">pwnd</a>;
<a name="l03288"></a><a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o2">03288</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l03289"></a><a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o3">03289</a>     WPARAM wParam;
<a name="l03290"></a><a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o4">03290</a>     LPWORD <a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o4">pw</a>;
<a name="l03291"></a><a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o5">03291</a>     ULONG_PTR <a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o5">xParam</a>;
<a name="l03292"></a><a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o6">03292</a>     PROC <a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html#o6">xpfnProc</a>;
03293 } <a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html">FNPOPTINLPUINTMSG</a>;
03294 
03295 <span class="preprocessor">#ifdef SENDSIDE</span>
03296 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(POPTINLPUINT)
03297 {
03298     LPWORD pw = (LPWORD)lParam;
03299     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cCapture, cbCapture;
03300 
03301     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNPOPTINLPUINT);
03302 
03303     UNREFERENCED_PARAMETER(dwSCMSFlags);
03304     UNREFERENCED_PARAMETER(psms);
03305 
03306     <span class="keywordflow">if</span> (lParam) {
03307         cCapture = 1;
03308         cbCapture = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)wParam * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>);
03309     } <span class="keywordflow">else</span> {
03310         cCapture = cbCapture = 0;
03311     }
03312 
03313     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNPOPTINLPUINT, cCapture, cbCapture, TRUE)
03314 
03315         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;pwnd = pwndClient;
03316         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;msg = msg;
03317         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;wParam = wParam;
03318         COPYBYTESOPT(pw, cbCapture);
03319         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;xParam = xParam;
03320         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
03321 
03322         LOCKPWND();
03323         MAKECALLCAPTURE(FNPOPTINLPUINT);
03324         UNLOCKPWND();
03325         CHECKRETURN();
03326 
03327     TRACECALLBACKMSG("SfnPOPTINLPUINT");
03328     ENDSENDCAPTURE(DWORD,0);
03329 }
03330 #endif <span class="comment">// SENDSIDE</span>
03331 
03332 #ifdef RECVSIDE
03333 RECVCALL(fnPOPTINLPUINT, <a class="code" href="../../d7/d8/struct__FNPOPTINLPUINTMSG.html">FNPOPTINLPUINTMSG</a>)
03334 {
03335     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
03336     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
03337 
03338     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
03339             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
03340             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
03341             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
03342             (LPDWORD)<a class="code" href="../../d5/d8/crecv_8c.html#a15">FIRSTFIXUPOPT</a>(pw),
03343             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
03344 
03345     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03346 }
03347 <span class="preprocessor">#endif // RECVSIDE</span>
03348 <span class="preprocessor"></span>
03349 <span class="comment">/**************************************************************************\</span>
03350 <span class="comment">* fnINOUTLPWINDOWPOS (for WM_WINDOWPOSCHANGING message)</span>
03351 <span class="comment">*</span>
03352 <span class="comment">* 08-11-91 darrinm      Created.</span>
03353 <span class="comment">\**************************************************************************/</span>
03354 
<a name="l03355"></a><a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html">03355</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html">_FNINOUTLPWINDOWPOSMSG</a> {
<a name="l03356"></a><a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html#o0">03356</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html#o0">pwnd</a>;
<a name="l03357"></a><a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html#o1">03357</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l03358"></a><a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html#o2">03358</a>     WPARAM wParam;
<a name="l03359"></a><a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html#o3">03359</a>     WINDOWPOS <a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html#o3">wp</a>;
<a name="l03360"></a><a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html#o4">03360</a>     ULONG_PTR xParam;
<a name="l03361"></a><a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html#o5">03361</a>     PROC xpfnProc;
03362 } <a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html">FNINOUTLPWINDOWPOSMSG</a>;
03363 
03364 <span class="preprocessor">#ifdef SENDSIDE</span>
03365 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INOUTLPWINDOWPOS)
03366 {
03367     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINOUTLPWINDOWPOS)
03368 
03369     UNREFERENCED_PARAMETER(dwSCMSFlags);
03370 
03371     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINOUTLPWINDOWPOS)
03372 
03373         LPWINDOWPOS pwp = (LPWINDOWPOS)lParam;
03374 
03375         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
03376         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
03377         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
03378         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wp = *pwp;
03379         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
03380         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
03381 
03382         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
03383         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINOUTLPWINDOWPOS);
03384         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
03385         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
03386 
03387         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
03388             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(pwp, WINDOWPOS);
03389         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
03390 
03391     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINOUTLPWINDOWPOS"</span>);
03392     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
03393 }
03394 <span class="preprocessor">#endif // SENDSIDE</span>
03395 <span class="preprocessor"></span>
03396 <span class="preprocessor">#ifdef RECVSIDE</span>
03397 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINOUTLPWINDOWPOS, <a class="code" href="../../d8/d6/struct__FNINOUTLPWINDOWPOSMSG.html">FNINOUTLPWINDOWPOSMSG</a>)
03398 {
03399     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;wp, <span class="keyword">sizeof</span>(pmsg-&gt;wp));
03400 
03401     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
03402             pmsg-&gt;pwnd,
03403             pmsg-&gt;msg,
03404             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
03405             <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(wp),
03406             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
03407 
03408     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03409 }
03410 <span class="preprocessor">#endif // RECVSIDE</span>
03411 <span class="preprocessor"></span>
03412 
03413 <span class="comment">/**************************************************************************\</span>
03414 <span class="comment">* fnINLPWINDOWPOS (for WM_WINDOWPOSCHANGED message)</span>
03415 <span class="comment">*</span>
03416 <span class="comment">* 08-11-91 darrinm      Created.</span>
03417 <span class="comment">\**************************************************************************/</span>
03418 
<a name="l03419"></a><a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html">03419</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html">_FNINLPWINDOWPOSMSG</a> {
<a name="l03420"></a><a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html#o0">03420</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html#o0">pwnd</a>;
<a name="l03421"></a><a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html#o1">03421</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l03422"></a><a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html#o2">03422</a>     WPARAM wParam;
<a name="l03423"></a><a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html#o3">03423</a>     WINDOWPOS <a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html#o3">wp</a>;
<a name="l03424"></a><a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html#o4">03424</a>     ULONG_PTR xParam;
<a name="l03425"></a><a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html#o5">03425</a>     PROC xpfnProc;
03426 } <a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html">FNINLPWINDOWPOSMSG</a>;
03427 
03428 <span class="preprocessor">#ifdef SENDSIDE</span>
03429 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INLPWINDOWPOS)
03430 {
03431     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINLPWINDOWPOS)
03432 
03433     UNREFERENCED_PARAMETER(dwSCMSFlags);
03434     UNREFERENCED_PARAMETER(psms);
03435 
03436     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINLPWINDOWPOS)
03437 
03438         LPWINDOWPOS pwp = (LPWINDOWPOS)lParam;
03439 
03440         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
03441         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
03442         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
03443         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wp = *pwp;
03444         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
03445         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
03446 
03447         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
03448         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINLPWINDOWPOS);
03449         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
03450         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
03451 
03452     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINLPWINDOWPOS"</span>);
03453     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
03454 }
03455 <span class="preprocessor">#endif // SENDSIDE</span>
03456 <span class="preprocessor"></span>
03457 <span class="preprocessor">#ifdef RECVSIDE</span>
03458 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINLPWINDOWPOS, <a class="code" href="../../d2/d6/struct__FNINLPWINDOWPOSMSG.html">FNINLPWINDOWPOSMSG</a>)
03459 {
03460     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
03461 
03462     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
03463             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
03464             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
03465             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
03466             <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(wp),
03467             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
03468 
03469     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03470 }
03471 <span class="preprocessor">#endif // RECVSIDE</span>
03472 <span class="preprocessor"></span>
03473 
03474 
03475 
03476 <span class="comment">/**************************************************************************\</span>
03477 <span class="comment">* fnINOUTNEXTMENU</span>
03478 <span class="comment">*</span>
03479 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
03480 <span class="comment">\**************************************************************************/</span>
03481 
<a name="l03482"></a><a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html">03482</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html">_FNINOUTNEXTMENUMSG</a> {
<a name="l03483"></a><a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html#o0">03483</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html#o0">pwnd</a>;
<a name="l03484"></a><a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html#o1">03484</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l03485"></a><a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html#o2">03485</a>     WPARAM wParam;
<a name="l03486"></a><a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html#o3">03486</a>     MDINEXTMENU <a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html#o3">mnm</a>;
<a name="l03487"></a><a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html#o4">03487</a>     ULONG_PTR xParam;
<a name="l03488"></a><a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html#o5">03488</a>     PROC xpfnProc;
03489 } <a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html">FNINOUTNEXTMENUMSG</a>;
03490 
03491 <span class="preprocessor">#ifdef SENDSIDE</span>
03492 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INOUTNEXTMENU)
03493 {
03494     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINOUTNEXTMENU)
03495 
03496     UNREFERENCED_PARAMETER(dwSCMSFlags);
03497 
03498     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNINOUTNEXTMENU)
03499 
03500         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
03501         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
03502         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
03503         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
03504         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
03505         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;mnm = *((PMDINEXTMENU)lParam);
03506 
03507         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
03508         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINOUTNEXTMENU);
03509         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
03510         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
03511 
03512         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
03513             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(((PMDINEXTMENU)lParam), MDINEXTMENU);
03514         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
03515 
03516     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINOUTNEXTMENU"</span>);
03517     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
03518 }
03519 <span class="preprocessor">#endif // SENDSIDE</span>
03520 <span class="preprocessor"></span>
03521 <span class="preprocessor">#ifdef RECVSIDE</span>
03522 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnINOUTNEXTMENU, <a class="code" href="../../d3/d7/struct__FNINOUTNEXTMENUMSG.html">FNINOUTNEXTMENUMSG</a>)
03523 {
03524     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;mnm, <span class="keyword">sizeof</span>(pmsg-&gt;mnm));
03525 
03526     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
03527             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
03528             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
03529             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
03530             &amp;<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(mnm),
03531             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
03532 
03533     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03534 }
03535 <span class="preprocessor">#endif // RECVSIDE</span>
03536 <span class="preprocessor"></span>
03537 <span class="comment">/**************************************************************************\</span>
03538 <span class="comment">* fnHkINLPCBTCREATESTRUCT</span>
03539 <span class="comment">*</span>
03540 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
03541 <span class="comment">\**************************************************************************/</span>
03542 
<a name="l03543"></a><a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html">03543</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html">_CREATESTRUCTDATA</a> {
<a name="l03544"></a><a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html#o0">03544</a>     CREATESTRUCT <a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html#o0">cs</a>;
<a name="l03545"></a><a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html#o1">03545</a>     HWND <a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html#o1">hwndInsertAfter</a>;
03546 } <a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html">CREATESTRUCTDATA</a>;
03547 
<a name="l03548"></a><a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html">03548</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html">_FNHKINLPCBTCREATESTRUCTMSG</a> {
<a name="l03549"></a><a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o0">03549</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o0">CaptureBuf</a>;
<a name="l03550"></a><a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o1">03550</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o1">pwnd</a>;
<a name="l03551"></a><a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o2">03551</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l03552"></a><a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o3">03552</a>     WPARAM wParam;
<a name="l03553"></a><a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o4">03553</a>     <a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html">CREATESTRUCTDATA</a> <a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o4">d</a>;
<a name="l03554"></a><a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o5">03554</a>     PROC xpfnProc;
<a name="l03555"></a><a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o6">03555</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html#o6">bAnsi</a>;
03556 } <a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html">FNHKINLPCBTCREATESTRUCTMSG</a>;
03557 
03558 <span class="preprocessor">#ifdef SENDSIDE</span>
03559 <span class="preprocessor"></span>LRESULT <a class="code" href="../../d9/d4/srvhook_8c.html#a0">fnHkINLPCBTCREATESTRUCT</a>(
03560     UINT msg,
03561     WPARAM wParam,
03562     LPCBT_CREATEWND pcbt,
03563     PROC xpfnProc,
03564     BOOL fAnsiReceiver)
03565 {
03566     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbTitle = 0, cbClass = 0;
03567     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cCapture = 0;
03568     <a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html">CREATESTRUCTDATA</a> csdOut;
03569     <a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html">PCREATESTRUCTEX</a> pcreatestruct;
03570     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = <a class="code" href="../../d3/d9/client_2wow_8c.html#a3">_GetDesktopWindow</a>();
03571 
03572     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNHKINLPCBTCREATESTRUCT)
03573 
03574     <span class="comment">/*</span>
03575 <span class="comment">     * Compute ANSI capture lengths.  Don't capture if</span>
03576 <span class="comment">     * the strings are in the client's address space.</span>
03577 <span class="comment">     */</span>
03578     pcreatestruct = (<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html">PCREATESTRUCTEX</a>)pcbt-&gt;lpcs;
03579     <span class="keywordflow">if</span> (pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName &amp;&amp;
03580             ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> != fAnsiReceiver ||
03581             <a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>((PVOID)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName))) {
03582         <a class="code" href="../../d3/d5/ssend_8c.html#a9">CALC_SIZE_IN</a>(cbTitle, &amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>);
03583         cCapture++;
03584     }
03585     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszClass) &amp;&amp;
03586             ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> != fAnsiReceiver ||
03587             <a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>((PVOID)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszClass))) {
03588         <a class="code" href="../../d3/d5/ssend_8c.html#a9">CALC_SIZE_IN</a>(cbClass, &amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>);
03589         cCapture++;
03590     }
03591 
03592     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNHKINLPCBTCREATESTRUCT, cCapture, cbTitle + cbClass, TRUE)
03593 
03594         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;pwnd = pwndClient;
03595         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;msg = msg;
03596         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;wParam = wParam;
03597 
03598         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;d.cs = *(pcbt-&gt;lpcs);
03599 
03600         if (cbTitle) {
03601             <span class="keywordflow">if</span> (!pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
03602                 <span class="keywordflow">if</span> (*(PWORD)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName == 0xffff) {
03603 
03604                     <span class="comment">/*</span>
03605 <span class="comment">                     * Copy out an ordinal of the form 0xffff, ID.</span>
03606 <span class="comment">                     * If the receiver is ANSI, skip the first 0xff.</span>
03607 <span class="comment">                     */</span>
03608                     <span class="keywordflow">if</span> (fAnsiReceiver) {
03609                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d3/d5/ssend_8c.html#a59">CaptureCallbackData</a>(&amp;mp-&gt;CaptureBuf,
03610                                 (PBYTE)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName + 1,
03611                                 3, (PVOID *)&amp;mp-&gt;d.cs.lpszName)))
03612                             <span class="keywordflow">goto</span> errorexit;
03613                     } <span class="keywordflow">else</span> {
03614                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d3/d5/ssend_8c.html#a59">CaptureCallbackData</a>(&amp;mp-&gt;CaptureBuf,
03615                                 (PBYTE)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName,
03616                                 4, (PVOID *)&amp;mp-&gt;d.cs.lpszName)))
03617                             <span class="keywordflow">goto</span> errorexit;
03618                     }
03619                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fAnsiReceiver) {
03620                     <a class="code" href="../../d3/d5/ssend_8c.html#a47">LARGECOPYSTRINGLPWSTRA</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>, d.cs.lpszName);
03621                 } <span class="keywordflow">else</span> {
03622                     <a class="code" href="../../d3/d5/ssend_8c.html#a45">LARGECOPYSTRINGLPWSTR</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>, d.cs.lpszName);
03623                 }
03624             } <span class="keywordflow">else</span> {
03625                 <span class="keywordflow">if</span> (*(<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName == 0xff) {
03626 
03627                     <span class="comment">/*</span>
03628 <span class="comment">                     * Copy out an ordinal of the form 0xff, ID.</span>
03629 <span class="comment">                     * If the receiver is UNICODE, expand the 0xff to 0xffff.</span>
03630 <span class="comment">                     */</span>
03631                     <span class="keywordflow">if</span> (fAnsiReceiver) {
03632                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d3/d5/ssend_8c.html#a59">CaptureCallbackData</a>(&amp;mp-&gt;CaptureBuf,
03633                                 (PBYTE)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName,
03634                                 3, (PVOID *)&amp;mp-&gt;d.cs.lpszName)))
03635                             <span class="keywordflow">goto</span> errorexit;
03636                     } <span class="keywordflow">else</span> {
03637                         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOrdinal;
03638 
03639                         dwOrdinal = MAKELONG(0xffff,
03640                                 (*(DWORD UNALIGNED *)pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o0">cs</a>.lpszName &gt;&gt; 8));
03641                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d3/d5/ssend_8c.html#a59">CaptureCallbackData</a>(&amp;mp-&gt;CaptureBuf,
03642                                 &amp;dwOrdinal,
03643                                 4, (PVOID *)&amp;mp-&gt;d.cs.lpszName)))
03644                             <span class="keywordflow">goto</span> errorexit;
03645                     }
03646                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fAnsiReceiver) {
03647                     <a class="code" href="../../d3/d5/ssend_8c.html#a46">LARGECOPYSTRINGLPSTR</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>, d.cs.lpszName);
03648                 } <span class="keywordflow">else</span> {
03649                     <a class="code" href="../../d3/d5/ssend_8c.html#a48">LARGECOPYSTRINGLPSTRW</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o1">strName</a>, d.cs.lpszName);
03650                 }
03651             }
03652         }
03653         <span class="keywordflow">if</span> (cbClass) {
03654             <span class="keywordflow">if</span> (!pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>.<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>) {
03655                 <span class="keywordflow">if</span> (fAnsiReceiver) {
03656                     <a class="code" href="../../d3/d5/ssend_8c.html#a47">LARGECOPYSTRINGLPWSTRA</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>, d.cs.lpszClass);
03657                 } <span class="keywordflow">else</span> {
03658                     <a class="code" href="../../d3/d5/ssend_8c.html#a45">LARGECOPYSTRINGLPWSTR</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>, d.cs.lpszClass);
03659                 }
03660             } <span class="keywordflow">else</span> {
03661                 <span class="keywordflow">if</span> (fAnsiReceiver) {
03662                     <a class="code" href="../../d3/d5/ssend_8c.html#a46">LARGECOPYSTRINGLPSTR</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>, d.cs.lpszClass);
03663                 } <span class="keywordflow">else</span> {
03664                     <a class="code" href="../../d3/d5/ssend_8c.html#a48">LARGECOPYSTRINGLPSTRW</a>(&amp;pcreatestruct-&gt;<a class="code" href="../../d6/d9/struct__CREATESTRUCTEX.html#o2">strClass</a>, d.cs.lpszClass);
03665                 }
03666             }
03667         }
03668 
03669         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;d.hwndInsertAfter = pcbt-&gt;hwndInsertAfter;
03670         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
03671         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;bAnsi = fAnsiReceiver;
03672 
03673         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
03674         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNHKINLPCBTCREATESTRUCT);
03675         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
03676         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
03677 
03678         <span class="comment">/*</span>
03679 <span class="comment">         * Probe output data</span>
03680 <span class="comment">         */</span>
03681         <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(&amp;csdOut, <a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html">CREATESTRUCTDATA</a>);
03682 
03683         <span class="comment">// MS Visual C centers its dialogs with the CBT_CREATEHOOK</span>
03684         pcbt-&gt;hwndInsertAfter = csdOut.<a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html#o1">hwndInsertAfter</a>;
03685         pcbt-&gt;lpcs-&gt;x  = csdOut.<a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html#o0">cs</a>.x;
03686         pcbt-&gt;lpcs-&gt;y  = csdOut.<a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html#o0">cs</a>.y;
03687         pcbt-&gt;lpcs-&gt;cx = csdOut.<a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html#o0">cs</a>.cx;
03688         pcbt-&gt;lpcs-&gt;cy = csdOut.<a class="code" href="../../d5/d9/struct__CREATESTRUCTDATA.html#o0">cs</a>.cy;
03689 
03690     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SfnHkINLPCBTCREATESTRUCT"</span>);
03691     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(DWORD,0);
03692 }
03693 <span class="preprocessor">#endif // SENDSIDE</span>
03694 <span class="preprocessor"></span>
03695 <span class="preprocessor">#ifdef RECVSIDE</span>
03696 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnHkINLPCBTCREATESTRUCT, <a class="code" href="../../d9/d3/struct__FNHKINLPCBTCREATESTRUCTMSG.html">FNHKINLPCBTCREATESTRUCTMSG</a>)
03697 {
03698     CBT_CREATEWND cbt;
03699 
03700     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;d, <span class="keyword">sizeof</span>(pmsg-&gt;d));
03701     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
03702 
03703     cbt.lpcs = &amp;pmsg-&gt;d.cs;
03704     cbt.hwndInsertAfter = pmsg-&gt;d.hwndInsertAfter;
03705     <span class="keywordflow">if</span> ((ULONG_PTR)pmsg-&gt;d.cs.lpszName &gt; <a class="code" href="../../d1/d8/clglobal_8c.html#a7">gHighestUserAddress</a>)
03706         pmsg-&gt;d.cs.lpszName = <a class="code" href="../../d6/d0/usercli_8h.html#a25">REBASEPTR</a>(pmsg-&gt;pwnd, pmsg-&gt;d.cs.lpszName);
03707     <span class="keywordflow">if</span> ((ULONG_PTR)pmsg-&gt;d.cs.lpszClass &gt; <a class="code" href="../../d1/d8/clglobal_8c.html#a7">gHighestUserAddress</a>)
03708         pmsg-&gt;d.cs.lpszClass = <a class="code" href="../../d6/d0/usercli_8h.html#a25">REBASEPTR</a>(pmsg-&gt;pwnd, pmsg-&gt;d.cs.lpszClass);
03709 
03710     <span class="keywordflow">if</span> (pmsg-&gt;bAnsi) {
03711         retval = <a class="code" href="../../d6/d0/usercli_8h.html#a573">DispatchHookA</a>(
03712                 pmsg-&gt;msg,
03713                 pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
03714                 (LPARAM)&amp;cbt,
03715                 (HOOKPROC)pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>);
03716     } <span class="keywordflow">else</span> {
03717         retval = <a class="code" href="../../d6/d0/usercli_8h.html#a572">DispatchHookW</a>(
03718                 pmsg-&gt;msg,
03719                 pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
03720                 (LPARAM)&amp;cbt,
03721                 (HOOKPROC)pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>);
03722     }
03723 
03724     pmsg-&gt;d.hwndInsertAfter = cbt.hwndInsertAfter;
03725     pmsg-&gt;d.cs.x  = cbt.lpcs-&gt;x;
03726     pmsg-&gt;d.cs.y  = cbt.lpcs-&gt;y;
03727     pmsg-&gt;d.cs.cx = cbt.lpcs-&gt;cx;
03728     pmsg-&gt;d.cs.cy = cbt.lpcs-&gt;cy;
03729 
03730     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03731 }
03732 <span class="preprocessor">#endif // RECVSIDE</span>
03733 <span class="preprocessor"></span>
03734 <span class="preprocessor">#ifdef REDIRECTION</span>
03735 <span class="preprocessor"></span>
03736 <span class="comment">/**************************************************************************\</span>
03737 <span class="comment">* fnHkINLPPOINT</span>
03738 <span class="comment">*</span>
03739 <span class="comment">* 29-Jan-1999 clupu    Created</span>
03740 <span class="comment">\**************************************************************************/</span>
03741 
03742 <span class="keyword">typedef</span> <span class="keyword">struct </span>_FNHKINLPPOINTMSG {
03743     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nCode;
03744     WPARAM wParam;
03745     POINT pt;
03746     ULONG_PTR xParam;
03747     PROC xpfnProc;
03748 } FNHKINLPPOINTMSG;
03749 
03750 <span class="preprocessor">#ifdef SENDSIDE</span>
03751 <span class="preprocessor"></span>LRESULT fnHkINLPPOINT(
03752     IN DWORD nCode,
03753     IN WPARAM wParam,
03754     IN OUT LPPOINT ppt,
03755     IN ULONG_PTR xParam,
03756     IN PROC xpfnProc)
03757 {
03758     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKINLPPOINT)
03759 
03760     BEGINSEND(FNHKINLPPOINT)
03761 
03762         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;nCode = nCode;
03763         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;wParam = wParam;
03764         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;pt = *ppt;
03765         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;xParam = xParam;
03766         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
03767 
03768         MAKECALL(FNHKINLPPOINT);
03769         CHECKRETURN();
03770 
03771         <span class="comment">/*</span>
03772 <span class="comment">         * Probe output data</span>
03773 <span class="comment">         */</span>
03774         OUTSTRUCT(ppt, POINT);
03775 
03776     TRACECALLBACK("SfnHkINLPPOINT");
03777     ENDSEND(DWORD,0);
03778 }
03779 #endif <span class="comment">// SENDSIDE</span>
03780 
03781 #ifdef RECVSIDE
03782 RECVCALL(fnHkINLPPOINT, FNHKINLPPOINTMSG)
03783 {
03784     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;pt, <span class="keyword">sizeof</span>(POINT));
03785 
03786     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
03787             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o0">nCode</a>,
03788             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
03789             <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(pt),
03790             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
03791 
03792     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03793 }
03794 <span class="preprocessor">#endif // RECVSIDE</span>
03795 <span class="preprocessor"></span>
03796 <span class="preprocessor">#endif // REDIRECTION</span>
03797 <span class="preprocessor"></span>
03798 
03799 <span class="comment">/**************************************************************************\</span>
03800 <span class="comment">* fnHkINLPRECT</span>
03801 <span class="comment">*</span>
03802 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
03803 <span class="comment">\**************************************************************************/</span>
03804 
<a name="l03805"></a><a class="code" href="../../d6/d4/struct__FNHKINLPRECTMSG.html">03805</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d4/struct__FNHKINLPRECTMSG.html">_FNHKINLPRECTMSG</a> {
<a name="l03806"></a><a class="code" href="../../d6/d4/struct__FNHKINLPRECTMSG.html#o0">03806</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nCode;
<a name="l03807"></a><a class="code" href="../../d6/d4/struct__FNHKINLPRECTMSG.html#o1">03807</a>     WPARAM wParam;
<a name="l03808"></a><a class="code" href="../../d6/d4/struct__FNHKINLPRECTMSG.html#o2">03808</a>     RECT <a class="code" href="../../d6/d4/struct__FNHKINLPRECTMSG.html#o2">rect</a>;
<a name="l03809"></a><a class="code" href="../../d6/d4/struct__FNHKINLPRECTMSG.html#o3">03809</a>     ULONG_PTR xParam;
<a name="l03810"></a><a class="code" href="../../d6/d4/struct__FNHKINLPRECTMSG.html#o4">03810</a>     PROC xpfnProc;
03811 } <a class="code" href="../../d6/d4/struct__FNHKINLPRECTMSG.html">FNHKINLPRECTMSG</a>;
03812 
03813 <span class="preprocessor">#ifdef SENDSIDE</span>
03814 <span class="preprocessor"></span>LRESULT <a class="code" href="../../d1/d0/inc_2user_8h.html#a1160">fnHkINLPRECT</a>(
03815     IN DWORD nCode,
03816     IN WPARAM wParam,
03817     IN OUT LPRECT prect,
03818     IN ULONG_PTR xParam,
03819     IN PROC xpfnProc)
03820 {
03821     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKINLPRECT)
03822 
03823     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNHKINLPRECT)
03824 
03825         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;nCode = nCode;
03826         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
03827         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;rect = *prect;
03828         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
03829         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
03830 
03831         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNHKINLPRECT);
03832         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
03833 
03834         <span class="comment">/*</span>
03835 <span class="comment">         * Probe output data</span>
03836 <span class="comment">         */</span>
03837         <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(prect, RECT);
03838 
03839     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SfnHkINLPRECT"</span>);
03840     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
03841 }
03842 <span class="preprocessor">#endif // SENDSIDE</span>
03843 <span class="preprocessor"></span>
03844 <span class="preprocessor">#ifdef RECVSIDE</span>
03845 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnHkINLPRECT, <a class="code" href="../../d6/d4/struct__FNHKINLPRECTMSG.html">FNHKINLPRECTMSG</a>)
03846 {
03847     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;rect, <span class="keyword">sizeof</span>(RECT));
03848 
03849     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o3">xpfnProc</a>)(
03850             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o0">nCode</a>,
03851             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o1">wParam</a>,
03852             <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(rect),
03853             pmsg-&gt;<a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html#o2">xParam</a>);
03854 
03855     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03856 }
03857 <span class="preprocessor">#endif // RECVSIDE</span>
03858 <span class="preprocessor"></span>
03859 <span class="comment">/**************************************************************************\</span>
03860 <span class="comment">* yyy</span>
03861 <span class="comment">*</span>
03862 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
03863 <span class="comment">\**************************************************************************/</span>
03864 
<a name="l03865"></a><a class="code" href="../../d7/d3/struct__FNHKINDWORDMSG.html">03865</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d3/struct__FNHKINDWORDMSG.html">_FNHKINDWORDMSG</a> {
<a name="l03866"></a><a class="code" href="../../d7/d3/struct__FNHKINDWORDMSG.html#o0">03866</a>     <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">GENERICHOOKHEADER</a> <a class="code" href="../../d7/d3/struct__FNHKINDWORDMSG.html#o0">ghh</a>;
<a name="l03867"></a><a class="code" href="../../d7/d3/struct__FNHKINDWORDMSG.html#o1">03867</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d7/d3/struct__FNHKINDWORDMSG.html#o1">flags</a>;
<a name="l03868"></a><a class="code" href="../../d7/d3/struct__FNHKINDWORDMSG.html#o2">03868</a>     LPARAM lParam;
03869 } <a class="code" href="../../d7/d3/struct__FNHKINDWORDMSG.html">FNHKINDWORDMSG</a>;
03870 
03871 <span class="preprocessor">#ifdef SENDSIDE</span>
03872 <span class="preprocessor"></span>LRESULT <a class="code" href="../../d1/d0/inc_2user_8h.html#a1161">fnHkINDWORD</a>(
03873     IN DWORD nCode,
03874     IN WPARAM wParam,
03875     IN LPARAM lParam,
03876     IN ULONG_PTR xParam,
03877     IN PROC xpfnProc,
03878     IN OUT LPDWORD lpFlags)
03879 {
03880     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKINDWORD)
03881 
03882     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNHKINDWORD)
03883 
03884         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.nCode = nCode;
03885         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.wParam = wParam;
03886         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = lParam;
03887         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.xParam = xParam;
03888         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.xpfnProc = xpfnProc;
03889         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;flags = *lpFlags;
03890 
03891         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNHKINDWORD);
03892         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
03893 
03894         <span class="comment">/*</span>
03895 <span class="comment">         * Probe output data</span>
03896 <span class="comment">         */</span>
03897         <a class="code" href="../../d3/d5/ssend_8c.html#a55">OUTBITMASK</a>(lpFlags, <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a506">HF_HOOKFAULTED</a>);
03898 
03899     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SfnHkINDWORD"</span>);
03900     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
03901 }
03902 <span class="preprocessor">#endif // SENDSIDE</span>
03903 <span class="preprocessor"></span>
03904 <span class="preprocessor">#ifdef RECVSIDE</span>
03905 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnHkINDWORD, <a class="code" href="../../d7/d3/struct__FNHKINDWORDMSG.html">FNHKINDWORDMSG</a>)
03906 {
03907     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;flags, <span class="keyword">sizeof</span>(pmsg-&gt;flags));
03908 
03909     retval = CallHookWithSEH((LPGENERICHOOKHEADER)pmsg, (LPVOID)pmsg-&gt;lParam, &amp;pmsg-&gt;flags, retval);
03910 
03911     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
03912 }
03913 <span class="preprocessor">#endif // RECVSIDE</span>
03914 <span class="preprocessor"></span>
03915 <span class="comment">/**************************************************************************\</span>
03916 <span class="comment">* yyy</span>
03917 <span class="comment">*</span>
03918 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
03919 <span class="comment">\**************************************************************************/</span>
03920 
<a name="l03921"></a><a class="code" href="../../d3/d4/struct__FNHKINLPMSGDATA.html">03921</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d4/struct__FNHKINLPMSGDATA.html">_FNHKINLPMSGDATA</a> {
<a name="l03922"></a><a class="code" href="../../d3/d4/struct__FNHKINLPMSGDATA.html#o0">03922</a>     MSG <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l03923"></a><a class="code" href="../../d3/d4/struct__FNHKINLPMSGDATA.html#o1">03923</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d4/struct__FNHKINLPMSGDATA.html#o1">flags</a>;
03924 } <a class="code" href="../../d3/d4/struct__FNHKINLPMSGDATA.html">FNHKINLPMSGDATA</a>;
03925 
<a name="l03926"></a><a class="code" href="../../d4/d4/struct__FNHKINLPMSGMSG.html">03926</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d4/struct__FNHKINLPMSGMSG.html">_FNHKINLPMSGMSG</a> {
<a name="l03927"></a><a class="code" href="../../d4/d4/struct__FNHKINLPMSGMSG.html#o0">03927</a>     <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">GENERICHOOKHEADER</a> <a class="code" href="../../d4/d4/struct__FNHKINLPMSGMSG.html#o0">ghh</a>;
<a name="l03928"></a><a class="code" href="../../d4/d4/struct__FNHKINLPMSGMSG.html#o1">03928</a>     <a class="code" href="../../d3/d4/struct__FNHKINLPMSGDATA.html">FNHKINLPMSGDATA</a> <a class="code" href="../../d4/d4/struct__FNHKINLPMSGMSG.html#o1">d</a>;
03929 } <a class="code" href="../../d4/d4/struct__FNHKINLPMSGMSG.html">FNHKINLPMSGMSG</a>;
03930 
03931 <span class="preprocessor">#ifdef SENDSIDE</span>
03932 <span class="preprocessor"></span>LRESULT <a class="code" href="../../d1/d0/inc_2user_8h.html#a1162">fnHkINLPMSG</a>(
03933     DWORD nCode,
03934     WPARAM wParam,
03935     LPMSG pmsg,
03936     ULONG_PTR xParam,
03937     PROC xpfnProc,
03938     BOOL bAnsi,
03939     LPDWORD lpFlags)
03940 {
03941     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKINLPMSG)
03942     WPARAM wParamOriginal;
03943 
03944     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNHKINLPMSG)
03945 
03946         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.nCode = nCode;
03947         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.wParam = wParam;
03948 
03949         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;d.msg = *pmsg;
03950         <span class="keywordflow">if</span> (((WM_CHAR == pmsg-&gt;message) || (WM_SYSCHAR == pmsg-&gt;message)) &amp;&amp; bAnsi) {
03951             wParamOriginal = pmsg-&gt;wParam;
03952             <a class="code" href="../../d5/d6/chartran_8c.html#a4">RtlWCSMessageWParamCharToMB</a>(pmsg-&gt;message, &amp;(<a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;d.msg.wParam));
03953         }
03954 
03955         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.xParam = xParam;
03956         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.xpfnProc = xpfnProc;
03957         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;d.flags = *lpFlags;
03958 
03959         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNHKINLPMSG);
03960         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
03961 
03962         <span class="comment">/*</span>
03963 <span class="comment">         * Probe output data</span>
03964 <span class="comment">         */</span>
03965         <span class="keywordflow">try</span> {
03966             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput, <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d4/struct__FNHKINLPMSGDATA.html">FNHKINLPMSGDATA</a>), <span class="keyword">sizeof</span>(DWORD));
03967             *pmsg = ((<a class="code" href="../../d3/d4/struct__FNHKINLPMSGDATA.html">FNHKINLPMSGDATA</a> *)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput)-&gt;msg;
03968             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a14">COPY_FLAG</a>(*lpFlags, ((<a class="code" href="../../d3/d4/struct__FNHKINLPMSGDATA.html">FNHKINLPMSGDATA</a> *)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput)-&gt;flags, HF_HOOKFAULTED);
03969         } except (W32ExceptionHandler(TRUE, RIP_WARNING)) {
03970             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
03971         }
03972 
03973         <span class="keywordflow">if</span> (((WM_CHAR == pmsg-&gt;message) || (WM_SYSCHAR == pmsg-&gt;message)) &amp;&amp; bAnsi) {
03974             <span class="comment">/*</span>
03975 <span class="comment">             * LATER, DBCS should be handled correctly.</span>
03976 <span class="comment">             */</span>
03977             <span class="comment">/*</span>
03978 <span class="comment">             * If the ANSI hook didn't change the wParam we sent it, restore</span>
03979 <span class="comment">             * the Unicode value we started with, otherwise we just collapse</span>
03980 <span class="comment">             * Unicode chars to an ANSI codepage (best visual fit or ?)</span>
03981 <span class="comment">             * The rotten "Intellitype" point32.exe does this.</span>
03982 <span class="comment">             */</span>
03983             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;d.msg.wParam == pmsg-&gt;wParam) {
03984                 pmsg-&gt;wParam = wParamOriginal;
03985             } <span class="keywordflow">else</span> {
03986                 <a class="code" href="../../d5/d6/chartran_8c.html#a5">RtlMBMessageWParamCharToWCS</a>(pmsg-&gt;message, &amp;pmsg-&gt;wParam);
03987             }
03988         }
03989 
03990     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SfnHkINLPMSG"</span>);
03991     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(DWORD,0);
03992 }
03993 <span class="preprocessor">#endif // SENDSIDE</span>
03994 <span class="preprocessor"></span>
03995 <span class="preprocessor">#ifdef RECVSIDE</span>
03996 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnHkINLPMSG, <a class="code" href="../../d4/d4/struct__FNHKINLPMSGMSG.html">FNHKINLPMSGMSG</a>)
03997 {
03998     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;d, <span class="keyword">sizeof</span>(pmsg-&gt;d));
03999 
04000     <span class="comment">/*</span>
04001 <span class="comment">     * LATER, DBCS should be handled correctly.</span>
04002 <span class="comment">     */</span>
04003 
04004     retval = CallHookWithSEH((LPGENERICHOOKHEADER)pmsg, &amp;pmsg-&gt;d.msg, &amp;pmsg-&gt;d.flags, retval);
04005 
04006     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04007 }
04008 <span class="preprocessor">#endif // RECVSIDE</span>
04009 <span class="preprocessor"></span>
04010 <span class="comment">/**************************************************************************\</span>
04011 <span class="comment">* yyy</span>
04012 <span class="comment">*</span>
04013 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
04014 <span class="comment">\**************************************************************************/</span>
04015 
<a name="l04016"></a><a class="code" href="../../d2/d4/struct__FNHKINLPMOUSEHOOKSTRUCTEXMSG.html">04016</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d4/struct__FNHKINLPMOUSEHOOKSTRUCTEXMSG.html">_FNHKINLPMOUSEHOOKSTRUCTEXMSG</a> {
<a name="l04017"></a><a class="code" href="../../d2/d4/struct__FNHKINLPMOUSEHOOKSTRUCTEXMSG.html#o0">04017</a>     <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">GENERICHOOKHEADER</a> <a class="code" href="../../d2/d4/struct__FNHKINLPMOUSEHOOKSTRUCTEXMSG.html#o0">ghh</a>;
<a name="l04018"></a><a class="code" href="../../d2/d4/struct__FNHKINLPMOUSEHOOKSTRUCTEXMSG.html#o1">04018</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d4/struct__FNHKINLPMOUSEHOOKSTRUCTEXMSG.html#o1">flags</a>;
<a name="l04019"></a><a class="code" href="../../d2/d4/struct__FNHKINLPMOUSEHOOKSTRUCTEXMSG.html#o2">04019</a>     MOUSEHOOKSTRUCTEX <a class="code" href="../../d2/d4/struct__FNHKINLPMOUSEHOOKSTRUCTEXMSG.html#o2">mousehookstructex</a>;
04020 } <a class="code" href="../../d2/d4/struct__FNHKINLPMOUSEHOOKSTRUCTEXMSG.html">FNHKINLPMOUSEHOOKSTRUCTEXMSG</a>;
04021 
04022 <span class="preprocessor">#ifdef SENDSIDE</span>
04023 <span class="preprocessor"></span>LRESULT <a class="code" href="../../d1/d0/inc_2user_8h.html#a1165">fnHkINLPMOUSEHOOKSTRUCTEX</a>(
04024     IN DWORD nCode,
04025     IN WPARAM wParam,
04026     IN LPMOUSEHOOKSTRUCTEX pmousehookstructex,
04027     IN ULONG_PTR xParam,
04028     IN PROC xpfnProc,
04029     IN OUT LPDWORD lpFlags)
04030 {
04031     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKINLPMOUSEHOOKSTRUCTEX)
04032 
04033     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNHKINLPMOUSEHOOKSTRUCTEX)
04034 
04035         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.nCode = nCode;
04036         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.wParam = wParam;
04037         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;mousehookstructex = *pmousehookstructex;
04038         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.xParam = xParam;
04039         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.xpfnProc = xpfnProc;
04040         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;flags = *lpFlags;
04041 
04042         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNHKINLPMOUSEHOOKSTRUCTEX);
04043         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
04044 
04045         <span class="comment">/*</span>
04046 <span class="comment">         * Probe output data</span>
04047 <span class="comment">         */</span>
04048         <a class="code" href="../../d3/d5/ssend_8c.html#a55">OUTBITMASK</a>(lpFlags, <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a506">HF_HOOKFAULTED</a>);
04049 
04050     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SfnHkINLPMOUSEHOOKSTRUCTEX"</span>);
04051     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
04052 }
04053 <span class="preprocessor">#endif // SENDSIDE</span>
04054 <span class="preprocessor"></span>
04055 <span class="preprocessor">#ifdef RECVSIDE</span>
04056 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnHkINLPMOUSEHOOKSTRUCTEX, <a class="code" href="../../d2/d4/struct__FNHKINLPMOUSEHOOKSTRUCTEXMSG.html">FNHKINLPMOUSEHOOKSTRUCTEXMSG</a>)
04057 {
04058     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;flags, <span class="keyword">sizeof</span>(pmsg-&gt;flags));
04059 
04060     retval = CallHookWithSEH((LPGENERICHOOKHEADER)pmsg, &amp;pmsg-&gt;mousehookstructex, &amp;pmsg-&gt;flags, retval);
04061 
04062     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04063 }
04064 <span class="preprocessor">#endif // RECVSIDE</span>
04065 <span class="preprocessor"></span>
04066 <span class="comment">/**************************************************************************\</span>
04067 <span class="comment">* kbdll</span>
04068 <span class="comment">*</span>
04069 <span class="comment">* 06-Jun-1996 clupu    Created</span>
04070 <span class="comment">\**************************************************************************/</span>
04071 
<a name="l04072"></a><a class="code" href="../../d1/d4/struct__FNHKINLPKBDLLHOOKSTRUCTMSG.html">04072</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d4/struct__FNHKINLPKBDLLHOOKSTRUCTMSG.html">_FNHKINLPKBDLLHOOKSTRUCTMSG</a> {
<a name="l04073"></a><a class="code" href="../../d1/d4/struct__FNHKINLPKBDLLHOOKSTRUCTMSG.html#o0">04073</a>     <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">GENERICHOOKHEADER</a> <a class="code" href="../../d1/d4/struct__FNHKINLPKBDLLHOOKSTRUCTMSG.html#o0">ghh</a>;
<a name="l04074"></a><a class="code" href="../../d1/d4/struct__FNHKINLPKBDLLHOOKSTRUCTMSG.html#o1">04074</a>     KBDLLHOOKSTRUCT   <a class="code" href="../../d1/d4/struct__FNHKINLPKBDLLHOOKSTRUCTMSG.html#o1">kbdllhookstruct</a>;
04075 } <a class="code" href="../../d1/d4/struct__FNHKINLPKBDLLHOOKSTRUCTMSG.html">FNHKINLPKBDLLHOOKSTRUCTMSG</a>;
04076 
04077 <span class="preprocessor">#ifdef SENDSIDE</span>
04078 <span class="preprocessor"></span>LRESULT <a class="code" href="../../d1/d0/inc_2user_8h.html#a1166">fnHkINLPKBDLLHOOKSTRUCT</a>(
04079     IN DWORD nCode,
04080     IN WPARAM wParam,
04081     IN LPKBDLLHOOKSTRUCT pkbdllhookstruct,
04082     IN ULONG_PTR xParam,
04083     IN PROC xpfnProc)
04084 {
04085     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKINLPKBDLLHOOKSTRUCT)
04086 
04087     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNHKINLPKBDLLHOOKSTRUCT)
04088 
04089         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.nCode       = nCode;
04090         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.wParam      = wParam;
04091         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;kbdllhookstruct = *pkbdllhookstruct;
04092         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.xParam      = xParam;
04093         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.xpfnProc    = xpfnProc;
04094 
04095         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNHKINLPKBDLLHOOKSTRUCT);
04096         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
04097 
04098     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SfnHkINLPKBDLLHOOKSTRUCT"</span>);
04099     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
04100 }
04101 <span class="preprocessor">#endif // SENDSIDE</span>
04102 <span class="preprocessor"></span>
04103 <span class="preprocessor">#ifdef RECVSIDE</span>
04104 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnHkINLPKBDLLHOOKSTRUCT, <a class="code" href="../../d1/d4/struct__FNHKINLPKBDLLHOOKSTRUCTMSG.html">FNHKINLPKBDLLHOOKSTRUCTMSG</a>)
04105 {
04106     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;kbdllhookstruct, <span class="keyword">sizeof</span>(pmsg-&gt;kbdllhookstruct));
04107 
04108     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;ghh.xpfnProc)(
04109             pmsg-&gt;ghh.nCode,
04110             pmsg-&gt;ghh.wParam,
04111             &amp;pmsg-&gt;kbdllhookstruct,
04112             pmsg-&gt;ghh.xParam);
04113 
04114     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04115 }
04116 <span class="preprocessor">#endif // RECVSIDE</span>
04117 <span class="preprocessor"></span>
04118 
04119 <span class="comment">/**************************************************************************\</span>
04120 <span class="comment">* msll</span>
04121 <span class="comment">*</span>
04122 <span class="comment">* 06-Jun-1996 clupu    Created</span>
04123 <span class="comment">\**************************************************************************/</span>
04124 
<a name="l04125"></a><a class="code" href="../../d5/d4/struct__FNHKINLPMSLLHOOKSTRUCTMSG.html">04125</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d4/struct__FNHKINLPMSLLHOOKSTRUCTMSG.html">_FNHKINLPMSLLHOOKSTRUCTMSG</a> {
<a name="l04126"></a><a class="code" href="../../d5/d4/struct__FNHKINLPMSLLHOOKSTRUCTMSG.html#o0">04126</a>     <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">GENERICHOOKHEADER</a> <a class="code" href="../../d5/d4/struct__FNHKINLPMSLLHOOKSTRUCTMSG.html#o0">ghh</a>;
<a name="l04127"></a><a class="code" href="../../d5/d4/struct__FNHKINLPMSLLHOOKSTRUCTMSG.html#o1">04127</a>     MSLLHOOKSTRUCT    <a class="code" href="../../d5/d4/struct__FNHKINLPMSLLHOOKSTRUCTMSG.html#o1">msllhookstruct</a>;
04128 } <a class="code" href="../../d5/d4/struct__FNHKINLPMSLLHOOKSTRUCTMSG.html">FNHKINLPMSLLHOOKSTRUCTMSG</a>;
04129 
04130 <span class="preprocessor">#ifdef SENDSIDE</span>
04131 <span class="preprocessor"></span>LRESULT <a class="code" href="../../d1/d0/inc_2user_8h.html#a1167">fnHkINLPMSLLHOOKSTRUCT</a>(
04132     IN DWORD nCode,
04133     IN WPARAM wParam,
04134     IN LPMSLLHOOKSTRUCT pmsllhookstruct,
04135     IN ULONG_PTR xParam,
04136     IN PROC xpfnProc)
04137 {
04138     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKINLPMSLLHOOKSTRUCT)
04139 
04140     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNHKINLPMSLLHOOKSTRUCT)
04141 
04142         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.nCode      = nCode;
04143         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.wParam     = wParam;
04144         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msllhookstruct = *pmsllhookstruct;
04145         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.xParam     = xParam;
04146         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ghh.xpfnProc   = xpfnProc;
04147 
04148         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNHKINLPMSLLHOOKSTRUCT);
04149         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
04150 
04151     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SfnHkINLPMSLLHOOKSTRUCT"</span>);
04152     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
04153 }
04154 <span class="preprocessor">#endif // SENDSIDE</span>
04155 <span class="preprocessor"></span>
04156 <span class="preprocessor">#ifdef RECVSIDE</span>
04157 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnHkINLPMSLLHOOKSTRUCT, <a class="code" href="../../d5/d4/struct__FNHKINLPMSLLHOOKSTRUCTMSG.html">FNHKINLPMSLLHOOKSTRUCTMSG</a>)
04158 {
04159     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;msllhookstruct, <span class="keyword">sizeof</span>(pmsg-&gt;msllhookstruct));
04160 
04161     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;ghh.xpfnProc)(
04162             pmsg-&gt;ghh.nCode,
04163             pmsg-&gt;ghh.wParam,
04164             &amp;pmsg-&gt;msllhookstruct,
04165             pmsg-&gt;ghh.xParam);
04166 
04167     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04168 }
04169 <span class="preprocessor">#endif // RECVSIDE</span>
04170 <span class="preprocessor"></span>
04171 <span class="preprocessor">#ifdef REDIRECTION</span>
04172 <span class="preprocessor"></span><span class="comment">/**************************************************************************\</span>
04173 <span class="comment">* ht</span>
04174 <span class="comment">*</span>
04175 <span class="comment">* 21-Jan-1999 clupu    Created</span>
04176 <span class="comment">\**************************************************************************/</span>
04177 
04178 <span class="keyword">typedef</span> <span class="keyword">struct </span>_FNHKINLPHTHOOKSTRUCTMSG {
04179     <a class="code" href="../../d0/d2/struct__GENERICHOOKHEADER.html">GENERICHOOKHEADER</a> ghh;
04180     HTHOOKSTRUCT      hthookstruct;
04181 } FNHKINLPHTHOOKSTRUCTMSG;
04182 
04183 <span class="preprocessor">#ifdef SENDSIDE</span>
04184 <span class="preprocessor"></span>LRESULT fnHkINLPHTHOOKSTRUCT(
04185     IN DWORD nCode,
04186     IN WPARAM wParam,
04187     IN OUT LPHTHOOKSTRUCT phthookstruct,
04188     IN ULONG_PTR xParam,
04189     IN PROC xpfnProc)
04190 {
04191     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKINLPHTHOOKSTRUCT)
04192 
04193     BEGINSEND(FNHKINLPHTHOOKSTRUCT)
04194 
04195         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;ghh.nCode      = nCode;
04196         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;ghh.wParam     = wParam;
04197         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;hthookstruct   = *phthookstruct;
04198         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;ghh.xParam     = xParam;
04199         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;ghh.xpfnProc   = xpfnProc;
04200 
04201         MAKECALL(FNHKINLPHTHOOKSTRUCT);
04202         CHECKRETURN();
04203 
04204         <span class="comment">/*</span>
04205 <span class="comment">         * Probe output data</span>
04206 <span class="comment">         */</span>
04207         if (phthookstruct != NULL)
04208             OUTSTRUCT(phthookstruct, HTHOOKSTRUCT);
04209 
04210     TRACECALLBACK("SfnHkINLPHTHOOKSTRUCT");
04211     ENDSEND(DWORD,0);
04212 }
04213 #endif <span class="comment">// SENDSIDE</span>
04214 
04215 #ifdef RECVSIDE
04216 RECVCALL(fnHkINLPHTHOOKSTRUCT, FNHKINLPHTHOOKSTRUCTMSG)
04217 {
04218     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;hthookstruct, <span class="keyword">sizeof</span>(pmsg-&gt;hthookstruct));
04219 
04220     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;ghh.xpfnProc)(
04221             pmsg-&gt;ghh.nCode,
04222             pmsg-&gt;ghh.wParam,
04223             &amp;pmsg-&gt;hthookstruct,
04224             pmsg-&gt;ghh.xParam);
04225 
04226     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04227 }
04228 <span class="preprocessor">#endif // RECVSIDE</span>
04229 <span class="preprocessor"></span>
04230 <span class="preprocessor">#endif // REDIRECTION</span>
04231 <span class="preprocessor"></span>
04232 <span class="comment">/**************************************************************************\</span>
04233 <span class="comment">* yyy</span>
04234 <span class="comment">*</span>
04235 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
04236 <span class="comment">\**************************************************************************/</span>
04237 
<a name="l04238"></a><a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html">04238</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html">_FNHKOPTINLPEVENTMSGMSG</a> {
<a name="l04239"></a><a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html#o0">04239</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nCode;
<a name="l04240"></a><a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html#o1">04240</a>     WPARAM wParam;
<a name="l04241"></a><a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html#o2">04241</a>     LPEVENTMSGMSG <a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html#o2">peventmsgmsg</a>;
<a name="l04242"></a><a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html#o3">04242</a>     ULONG_PTR xParam;
<a name="l04243"></a><a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html#o4">04243</a>     PROC xpfnProc;
<a name="l04244"></a><a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html#o5">04244</a>     EVENTMSG <a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html#o5">eventmsgmsg</a>;
04245 } <a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html">FNHKOPTINLPEVENTMSGMSG</a>;
04246 
04247 <span class="preprocessor">#ifdef SENDSIDE</span>
04248 <span class="preprocessor"></span>LRESULT <a class="code" href="../../d1/d0/inc_2user_8h.html#a1163">fnHkOPTINLPEVENTMSG</a>(
04249     IN DWORD nCode,
04250     IN WPARAM wParam,
04251     IN OUT LPEVENTMSGMSG peventmsgmsg,
04252     IN ULONG_PTR xParam,
04253     IN PROC xpfnProc)
04254 {
04255     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKOPTINLPEVENTMSG)
04256 
04257     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNHKOPTINLPEVENTMSG)
04258 
04259         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;nCode = nCode;
04260         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
04261         <a class="code" href="../../d3/d5/ssend_8c.html#a36">COPYSTRUCTOPT</a>(eventmsgmsg);
04262         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
04263         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
04264 
04265         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNHKOPTINLPEVENTMSG);
04266         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
04267 
04268         <span class="comment">/*</span>
04269 <span class="comment">         * Probe output data</span>
04270 <span class="comment">         */</span>
04271         <span class="keywordflow">if</span> (peventmsgmsg != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
04272             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(peventmsgmsg, EVENTMSG);
04273 
04274     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SfnHkOPTINLPEVENTMSG"</span>);
04275     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,-1);
04276 }
04277 <span class="preprocessor">#endif // SENDSIDE</span>
04278 <span class="preprocessor"></span>
04279 <span class="preprocessor">#ifdef RECVSIDE</span>
04280 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnHkOPTINLPEVENTMSG, <a class="code" href="../../d7/d4/struct__FNHKOPTINLPEVENTMSGMSG.html">FNHKOPTINLPEVENTMSGMSG</a>)
04281 {
04282     <a class="code" href="../../d5/d6/structtagHOOK.html">PHOOK</a> phk;
04283 
04284     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(-1, &amp;pmsg-&gt;eventmsgmsg, <span class="keyword">sizeof</span>(pmsg-&gt;eventmsgmsg));
04285 
04286     <span class="keywordflow">if</span> (pmsg-&gt;wParam) {
04287         phk = (<a class="code" href="../../d5/d6/structtagHOOK.html">PHOOK</a>)<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a6">HMValidateHandle</a>((HANDLE)pmsg-&gt;wParam, TYPE_HOOK);
04288 
04289         <span class="keywordflow">if</span> (phk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04290             <span class="comment">/*</span>
04291 <span class="comment">             * The HF_NEEDHC_SKIP bit is passed on from the pti when we need to</span>
04292 <span class="comment">             * pass on a HC_SKIP</span>
04293 <span class="comment">             */</span>
04294             <span class="keywordflow">if</span> ((phk-&gt;<a class="code" href="../../d5/d6/structtagHOOK.html#o4">flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a504">HF_NEEDHC_SKIP</a>) &amp;&amp;
04295                     (HIWORD(pmsg-&gt;nCode) == WH_JOURNALPLAYBACK)) {
04296                 UserAssert(LOWORD(pmsg-&gt;nCode) == HC_GETNEXT);
04297                 <a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;xpfnProc)(
04298                     MAKELONG(HC_SKIP, HIWORD(pmsg-&gt;nCode)),
04299                     0,
04300                     0,
04301                     pmsg-&gt;xParam);
04302             }
04303 
04304             <span class="comment">/*</span>
04305 <span class="comment">             * Make sure the hook wasn't free'd during the last call to the app</span>
04306 <span class="comment">             */</span>
04307             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a438">HMIsMarkDestroy</a>(phk)) {
04308                 retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1;
04309                 <span class="keywordflow">goto</span> AllDoneHere;
04310             }
04311         }
04312     }
04313 
04314     pmsg-&gt;wParam = 0;
04315 
04316     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;xpfnProc)(
04317             pmsg-&gt;nCode,
04318             pmsg-&gt;wParam,
04319             <a class="code" href="../../d5/d8/crecv_8c.html#a12">PCALLDATAOPT</a>(eventmsgmsg),
04320             pmsg-&gt;xParam);
04321 
04322 AllDoneHere:
04323     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04324 }
04325 <span class="preprocessor">#endif // RECVSIDE</span>
04326 <span class="preprocessor"></span>
04327 <span class="comment">/**************************************************************************\</span>
04328 <span class="comment">* yyy</span>
04329 <span class="comment">*</span>
04330 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
04331 <span class="comment">\**************************************************************************/</span>
04332 
04333 <span class="comment">/*</span>
04334 <span class="comment"> * Create a structure big enough to hold the larges item LPARAM points to.</span>
04335 <span class="comment"> */</span>
<a name="l04336"></a><a class="code" href="../../d2/d2/union__DEBUGLPARAM.html">04336</a> <span class="keyword">typedef</span> <span class="keyword">union </span><a class="code" href="../../d2/d2/union__DEBUGLPARAM.html">_DEBUGLPARAM</a> {
<a name="l04337"></a><a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o0">04337</a>     MSG <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;                <span class="comment">// WH_GETMESSAGE, WH_MSGFILTER, WH_SYSMSGFILTER</span>
<a name="l04338"></a><a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o1">04338</a>     CWPSTRUCT <a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o1">cwp</a>;          <span class="comment">// WH_CALLWNDPROC</span>
<a name="l04339"></a><a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o2">04339</a>     CWPRETSTRUCT <a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o2">cwpret</a>;    <span class="comment">// WH_CALLWNDPROCRET</span>
<a name="l04340"></a><a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o3">04340</a>     MOUSEHOOKSTRUCTEX <a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o3">mhs</a>;  <span class="comment">// WH_MOUSE, HCBT_CLICKSKIPPED</span>
<a name="l04341"></a><a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o4">04341</a>     EVENTMSG <a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o4">em</a>;            <span class="comment">// WH_JOURNALRECORD, WH_JOURNALPLAYBACK</span>
<a name="l04342"></a><a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o5">04342</a>     CBTACTIVATESTRUCT <a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o5">as</a>;   <span class="comment">// HCBT_ACTIVATE</span>
<a name="l04343"></a><a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o6">04343</a>     CBT_CREATEWND <a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o6">cw</a>;       <span class="comment">// HCBT_CREATEWND</span>
<a name="l04344"></a><a class="code" href="../../d2/d2/union__DEBUGLPARAM.html#o7">04344</a>     RECT rc;                <span class="comment">// HCBT_MOVESIZE</span>
04345 } <a class="code" href="../../d2/d2/union__DEBUGLPARAM.html">DEBUGLPARAM</a>;
04346 
04347 
<a name="l04348"></a><a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html">04348</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html">_FNHKINLPDEBUGHOOKSTRUCTMSG</a> {
<a name="l04349"></a><a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html#o0">04349</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nCode;
<a name="l04350"></a><a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html#o1">04350</a>     WPARAM wParam;
<a name="l04351"></a><a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html#o2">04351</a>     DEBUGHOOKINFO <a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html#o2">debughookstruct</a>;
<a name="l04352"></a><a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html#o3">04352</a>     <a class="code" href="../../d2/d2/union__DEBUGLPARAM.html">DEBUGLPARAM</a> <a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html#o3">dbgLParam</a>;
<a name="l04353"></a><a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html#o4">04353</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html#o4">cbDbgLParam</a>;
<a name="l04354"></a><a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html#o5">04354</a>     ULONG_PTR xParam;
<a name="l04355"></a><a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html#o6">04355</a>     PROC xpfnProc;
04356 } <a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html">FNHKINLPDEBUGHOOKSTRUCTMSG</a>;
04357 
04358 <span class="preprocessor">#ifdef SENDSIDE</span>
04359 <span class="preprocessor"></span>LRESULT <a class="code" href="../../d1/d0/inc_2user_8h.html#a1164">fnHkINLPDEBUGHOOKSTRUCT</a>(
04360     IN DWORD nCode,
04361     IN WPARAM wParam,
04362     IN LPDEBUGHOOKINFO pdebughookstruct,
04363     IN ULONG_PTR xParam,
04364     IN PROC xpfnProc)
04365 {
04366     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKINLPDEBUGHOOKSTRUCT)
04367 
04368     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNHKINLPDEBUGHOOKSTRUCT)
04369 
04370         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;nCode = nCode;
04371         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
04372         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;debughookstruct = *pdebughookstruct;
04373         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
04374         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
04375         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cbDbgLParam = <a class="code" href="../../d4/d1/userk_8h.html#a1907">GetDebugHookLParamSize</a>(wParam, pdebughookstruct);
04376 
04377         <span class="keywordflow">switch</span>(wParam) {
04378         <span class="keywordflow">case</span> WH_MOUSE_LL:
04379         <span class="keywordflow">case</span> WH_KEYBOARD_LL:
04380             <span class="keywordflow">return</span> 0;
04381          }
04382 
04383         <span class="comment">/*</span>
04384 <span class="comment">         * if LPARAM in the debug hook points to struct then copy it over</span>
04385 <span class="comment">         */</span>
04386         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cbDbgLParam) {
04387             <span class="keywordflow">try</span> {
04388                 RtlCopyMemory(&amp;<a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;dbgLParam, (BYTE *)pdebughookstruct-&gt;lParam,
04389                         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;cbDbgLParam);
04390             } except (W32ExceptionHandler(FALSE, RIP_WARNING)) {
04391                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
04392             }
04393         }
04394 
04395         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNHKINLPDEBUGHOOKSTRUCT);
04396         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
04397 
04398     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SfnHkINLPDEBUGHOOKSTRUCT"</span>);
04399     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(DWORD,0);
04400 }
04401 <span class="preprocessor">#endif // SENDSIDE</span>
04402 <span class="preprocessor"></span>
04403 <span class="preprocessor">#ifdef RECVSIDE</span>
04404 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnHkINLPDEBUGHOOKSTRUCT, <a class="code" href="../../d0/d4/struct__FNHKINLPDEBUGHOOKSTRUCTMSG.html">FNHKINLPDEBUGHOOKSTRUCTMSG</a>)
04405 {
04406     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
04407 
04408     <span class="keywordflow">if</span> (pmsg-&gt;cbDbgLParam) {
04409         pmsg-&gt;debughookstruct.lParam = (LPARAM)&amp;(pmsg-&gt;dbgLParam);
04410     }
04411 
04412     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;xpfnProc)(
04413             pmsg-&gt;nCode,
04414             pmsg-&gt;wParam,
04415             &amp;(pmsg-&gt;debughookstruct),
04416             pmsg-&gt;xParam);
04417 
04418     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04419 }
04420 <span class="preprocessor">#endif // RECVSIDE</span>
04421 <span class="preprocessor"></span>
<a name="l04422"></a><a class="code" href="../../d9/d7/ntcb_8h.html#a98">04422</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d4/d1/userk_8h.html#a1907">GetDebugHookLParamSize</a>(
04423     IN WPARAM wParam,
04424     IN PDEBUGHOOKINFO pdebughookstruct)
04425 {
04426     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbDbgLParam = 0;
04427 
04428     <span class="keywordflow">switch</span>(wParam) {
04429     <span class="keywordflow">case</span> WH_MSGFILTER:
04430     <span class="keywordflow">case</span> WH_SYSMSGFILTER:
04431     <span class="keywordflow">case</span> WH_GETMESSAGE:
04432         cbDbgLParam = <span class="keyword">sizeof</span>(MSG);
04433         <span class="keywordflow">break</span>;
04434 
04435     <span class="keywordflow">case</span> WH_CALLWNDPROC:
04436         cbDbgLParam = <span class="keyword">sizeof</span>(CWPSTRUCT);
04437         <span class="keywordflow">break</span>;
04438 
04439     <span class="keywordflow">case</span> WH_CALLWNDPROCRET:
04440         cbDbgLParam = <span class="keyword">sizeof</span>(CWPRETSTRUCT);
04441         <span class="keywordflow">break</span>;
04442 
04443     <span class="keywordflow">case</span> WH_MOUSE:
04444         cbDbgLParam = <span class="keyword">sizeof</span>(MOUSEHOOKSTRUCTEX);
04445         <span class="keywordflow">break</span>;
04446 
04447     <span class="keywordflow">case</span> WH_JOURNALRECORD:
04448     <span class="keywordflow">case</span> WH_JOURNALPLAYBACK:
04449         cbDbgLParam = <span class="keyword">sizeof</span>(EVENTMSG);
04450         <span class="keywordflow">break</span>;
04451 
04452     <span class="keywordflow">case</span> WH_CBT:
04453         <span class="keywordflow">switch</span> (pdebughookstruct-&gt;code) {
04454         <span class="keywordflow">case</span> HCBT_ACTIVATE:
04455             cbDbgLParam = <span class="keyword">sizeof</span>(CBTACTIVATESTRUCT);
04456             <span class="keywordflow">break</span>;
04457         <span class="keywordflow">case</span> HCBT_CLICKSKIPPED:
04458             cbDbgLParam = <span class="keyword">sizeof</span>(MOUSEHOOKSTRUCTEX);
04459             <span class="keywordflow">break</span>;
04460         <span class="keywordflow">case</span> HCBT_CREATEWND:
04461             cbDbgLParam = <span class="keyword">sizeof</span>(CBT_CREATEWND);
04462             <span class="keywordflow">break</span>;
04463         <span class="keywordflow">case</span> HCBT_MOVESIZE:
04464             cbDbgLParam = <span class="keyword">sizeof</span>(RECT);
04465             <span class="keywordflow">break</span>;
04466         }
04467         <span class="keywordflow">break</span>;
04468 
04469     <span class="keywordflow">case</span> WH_SHELL:
04470         <span class="keywordflow">if</span> (pdebughookstruct-&gt;code == HSHELL_GETMINRECT) {
04471             cbDbgLParam = <span class="keyword">sizeof</span>(RECT);
04472         }
04473         <span class="keywordflow">break</span>;
04474     }
04475     <span class="keywordflow">return</span> cbDbgLParam;
04476 }
04477 
04478 <span class="comment">/**************************************************************************\</span>
04479 <span class="comment">* fnHkINLPCBTACTIVATESTRUCT</span>
04480 <span class="comment">*</span>
04481 <span class="comment">* 17-Mar-1992 jonpa    Created</span>
04482 <span class="comment">\**************************************************************************/</span>
04483 
<a name="l04484"></a><a class="code" href="../../d8/d3/struct__FNHKINLPCBTACTIVATESTRUCTMSG.html">04484</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d3/struct__FNHKINLPCBTACTIVATESTRUCTMSG.html">_FNHKINLPCBTACTIVATESTRUCTMSG</a> {
<a name="l04485"></a><a class="code" href="../../d8/d3/struct__FNHKINLPCBTACTIVATESTRUCTMSG.html#o0">04485</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nCode;
<a name="l04486"></a><a class="code" href="../../d8/d3/struct__FNHKINLPCBTACTIVATESTRUCTMSG.html#o1">04486</a>     WPARAM wParam;
<a name="l04487"></a><a class="code" href="../../d8/d3/struct__FNHKINLPCBTACTIVATESTRUCTMSG.html#o2">04487</a>     CBTACTIVATESTRUCT <a class="code" href="../../d8/d3/struct__FNHKINLPCBTACTIVATESTRUCTMSG.html#o2">cbtactivatestruct</a>;
<a name="l04488"></a><a class="code" href="../../d8/d3/struct__FNHKINLPCBTACTIVATESTRUCTMSG.html#o3">04488</a>     ULONG_PTR xParam;
<a name="l04489"></a><a class="code" href="../../d8/d3/struct__FNHKINLPCBTACTIVATESTRUCTMSG.html#o4">04489</a>     PROC xpfnProc;
04490 } <a class="code" href="../../d8/d3/struct__FNHKINLPCBTACTIVATESTRUCTMSG.html">FNHKINLPCBTACTIVATESTRUCTMSG</a>;
04491 
04492 <span class="preprocessor">#ifdef SENDSIDE</span>
04493 <span class="preprocessor"></span>LRESULT <a class="code" href="../../d1/d0/inc_2user_8h.html#a1168">fnHkINLPCBTACTIVATESTRUCT</a>(
04494     IN DWORD nCode,
04495     IN WPARAM wParam,
04496     IN LPCBTACTIVATESTRUCT pcbtactivatestruct,
04497     IN ULONG_PTR xParam,
04498     IN PROC xpfnProc)
04499 {
04500     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(FNHKINLPCBTACTIVATESTRUCT)
04501 
04502     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNHKINLPCBTACTIVATESTRUCT)
04503 
04504         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;nCode = nCode;
04505         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
04506         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cbtactivatestruct = *pcbtactivatestruct;
04507         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
04508         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
04509 
04510         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNHKINLPCBTACTIVATESTRUCT);
04511         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
04512 
04513     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SfnHkINLPCBTACTIVATESTRUCT"</span>);
04514     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
04515 }
04516 <span class="preprocessor">#endif // SENDSIDE</span>
04517 <span class="preprocessor"></span>
04518 <span class="preprocessor">#ifdef RECVSIDE</span>
04519 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnHkINLPCBTACTIVATESTRUCT, <a class="code" href="../../d8/d3/struct__FNHKINLPCBTACTIVATESTRUCTMSG.html">FNHKINLPCBTACTIVATESTRUCTMSG</a>)
04520 {
04521     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
04522 
04523     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;xpfnProc)(
04524             pmsg-&gt;nCode,
04525             pmsg-&gt;wParam,
04526             &amp;(pmsg-&gt;cbtactivatestruct),
04527             pmsg-&gt;xParam);
04528 
04529     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04530 }
04531 <span class="preprocessor">#endif // RECVSIDE</span>
04532 <span class="preprocessor"></span>
04533 
04534 <span class="comment">/**************************************************************************\</span>
04535 <span class="comment">* ClientLoadMenu</span>
04536 <span class="comment">*</span>
04537 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
04538 <span class="comment">\**************************************************************************/</span>
04539 
<a name="l04540"></a><a class="code" href="../../d5/d2/struct__CLIENTLOADMENUMSG.html">04540</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d2/struct__CLIENTLOADMENUMSG.html">_CLIENTLOADMENUMSG</a> {
<a name="l04541"></a><a class="code" href="../../d5/d2/struct__CLIENTLOADMENUMSG.html#o0">04541</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d5/d2/struct__CLIENTLOADMENUMSG.html#o0">CaptureBuf</a>;
<a name="l04542"></a><a class="code" href="../../d5/d2/struct__CLIENTLOADMENUMSG.html#o1">04542</a>     HANDLE <a class="code" href="../../d5/d2/struct__CLIENTLOADMENUMSG.html#o1">hmod</a>;
<a name="l04543"></a><a class="code" href="../../d5/d2/struct__CLIENTLOADMENUMSG.html#o2">04543</a>     UNICODE_STRING <a class="code" href="../../d5/d2/struct__CLIENTLOADMENUMSG.html#o2">strName</a>;
04544 } <a class="code" href="../../d5/d2/struct__CLIENTLOADMENUMSG.html">CLIENTLOADMENUMSG</a>;
04545 
04546 <span class="preprocessor">#ifdef SENDSIDE</span>
04547 <span class="preprocessor"></span><a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> <a class="code" href="../../d4/d1/userk_8h.html#a1009">xxxClientLoadMenu</a>(
04548     IN HANDLE hmod,
04549     IN PUNICODE_STRING pstrName)
04550 {
04551     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cCapture, cbCapture;
04552 
04553     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTLOADMENU)
04554 
04555     <span class="keywordflow">if</span> (pstrName-&gt;MaximumLength) {
04556         cCapture = 1;
04557         cbCapture = pstrName-&gt;MaximumLength;
04558     } <span class="keywordflow">else</span>
04559         cCapture = cbCapture = 0;
04560 
04561     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(CLIENTLOADMENU, cCapture, cbCapture, TRUE)
04562 
04563         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;hmod = hmod;
04564         COPYSTRINGID(strName);
04565 
04566         MAKECALLCAPTURE(CLIENTLOADMENU);
04567         CHECKRETURN();
04568 
04569         retval = (ULONG_PTR)HtoP((HMENU)retval);
04570 
04571     TRACECALLBACK("ClientLoadMenu");
04572     ENDSENDCAPTURE(<a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>,0);
04573 }
04574 #endif <span class="comment">// SENDSIDE</span>
04575 
04576 #ifdef RECVSIDE
04577 RECVCALL(ClientLoadMenu, <a class="code" href="../../d5/d2/struct__CLIENTLOADMENUMSG.html">CLIENTLOADMENUMSG</a>)
04578 {
04579     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
04580     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
04581 
04582     retval = (ULONG_PTR)LoadMenu(
04583             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hmod) ? <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hmod) : hmodUser,
04584             (LPTSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a20">FIXUPSTRINGID</a>(strName));
04585 
04586     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04587 }
04588 <span class="preprocessor">#endif // RECVSIDE</span>
04589 <span class="preprocessor"></span>
04590 <span class="comment">/**************************************************************************\</span>
04591 <span class="comment">* xxxClientLoadImage</span>
04592 <span class="comment">*</span>
04593 <span class="comment">* 28-Aug-1995 ChrisWil    Created</span>
04594 <span class="comment">\**************************************************************************/</span>
04595 
<a name="l04596"></a><a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html">04596</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html">_CLIENTLOADIMAGEMSG</a> {
<a name="l04597"></a><a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o0">04597</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a>     <a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o0">CaptureBuf</a>;
<a name="l04598"></a><a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o1">04598</a>     UNICODE_STRING <a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o1">strModName</a>;
<a name="l04599"></a><a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o2">04599</a>     UNICODE_STRING strName;
<a name="l04600"></a><a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o3">04600</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>           <a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o3">uImageType</a>;
<a name="l04601"></a><a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o4">04601</a>     <span class="keywordtype">int</span>            <a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o4">cxDesired</a>;
<a name="l04602"></a><a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o5">04602</a>     <span class="keywordtype">int</span>            <a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o5">cyDesired</a>;
<a name="l04603"></a><a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o6">04603</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>           <a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o6">LR_flags</a>;
<a name="l04604"></a><a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o7">04604</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>           <a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html#o7">fWallpaper</a>;
04605 } <a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html">CLIENTLOADIMAGEMSG</a>;
04606 
04607 <span class="preprocessor">#ifdef SENDSIDE</span>
04608 <span class="preprocessor"></span>HANDLE <a class="code" href="../../d4/d1/userk_8h.html#a1007">xxxClientLoadImage</a>(
04609     IN PUNICODE_STRING pstrName,
04610     IN ATOM            atomModName,
04611     IN WORD            wImageType,
04612     IN <span class="keywordtype">int</span>             cxDesired,
04613     IN <span class="keywordtype">int</span>             cyDesired,
04614     IN UINT            LR_flags,
04615     IN BOOL            fWallpaper)
04616 {
04617     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>           cCapture;
04618     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>           cbCapture;
04619     WCHAR           awszModName[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
04620     UNICODE_STRING  strModName;
04621     PUNICODE_STRING pstrModName = &amp;strModName;
04622 
04623     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTLOADIMAGE)
04624 
04625     <span class="keywordflow">if</span> (pstrName-&gt;MaximumLength) {
04626         cCapture  = 1;
04627         cbCapture = pstrName-&gt;MaximumLength;
04628     } <span class="keywordflow">else</span> {
04629         cCapture  =
04630         cbCapture = 0;
04631     }
04632     <span class="keywordflow">if</span> (atomModName &amp;&amp; atomModName != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a297">atomUSER32</a>) {
04633         <a class="code" href="../../d4/d1/userk_8h.html#a1300">UserGetAtomName</a>(atomModName, awszModName, MAX_PATH);
04634         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;strModName, awszModName);
04635     } <span class="keywordflow">else</span> {
04636         strModName.Length = strModName.MaximumLength = 0;
04637         strModName.Buffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04638     }
04639     <span class="keywordflow">if</span> (pstrModName-&gt;MaximumLength) {
04640         cCapture++;
04641         cbCapture += pstrModName-&gt;MaximumLength;
04642     }
04643 
04644     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(CLIENTLOADIMAGE, cCapture, cbCapture, TRUE)
04645 
04646         COPYSTRINGOPT(strModName);
04647         COPYSTRINGID(strName);
04648         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;uImageType = (UINT)wImageType;
04649         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;cxDesired  = cxDesired;
04650         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;cyDesired  = cyDesired;
04651         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;LR_flags   = LR_flags;
04652         <a class="code" href="../../d8/d9/struct__msgdata.html">MSGDATA</a>()-&gt;fWallpaper = fWallpaper;
04653 
04654         MAKECALLCAPTURE(CLIENTLOADIMAGE);
04655         CHECKRETURN();
04656 
04657         if (retval &amp;&amp; (wImageType != IMAGE_BITMAP)) {
04658             retval = (ULONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a439">HMRevalidateHandle</a>((HANDLE)retval);
04659         }
04660 
04661     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientLoadImage"</span>);
04662     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>,0);
04663 }
04664 <span class="preprocessor">#endif // SENDSIDE</span>
04665 <span class="preprocessor"></span>
04666 <span class="preprocessor">#ifdef RECVSIDE</span>
04667 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientLoadImage, <a class="code" href="../../d3/d2/struct__CLIENTLOADIMAGEMSG.html">CLIENTLOADIMAGEMSG</a>)
04668 {
04669     HMODULE hmod;
04670     LPTSTR  filepart;
04671     LPTSTR  lpszName;
04672     TCHAR   szFullPath[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
04673 
04674     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
04675     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
04676 
04677     <span class="keywordflow">if</span> (hmod = (HMODULE)<a class="code" href="../../d5/d8/crecv_8c.html#a21">FIXUPSTRINGIDOPT</a>(strModName)) {
04678 
04679         <span class="keywordflow">if</span> ((hmod = GetModuleHandle((LPTSTR)hmod)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04680             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
04681         }
04682     }
04683 
04684     <span class="comment">/*</span>
04685 <span class="comment">     * Find the file.  This normalizes the filename.</span>
04686 <span class="comment">     */</span>
04687     lpszName = (LPTSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a20">FIXUPSTRINGID</a>(strName);
04688 
04689     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(fWallpaper)) {
04690 
04691         <span class="keywordflow">if</span> (!SearchPath(NULL,
04692                        lpszName,
04693                        TEXT(<span class="stringliteral">".bmp"</span>),
04694                        <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szFullPath),
04695                        szFullPath,
04696                        &amp;filepart)) {
04697 
04698             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
04699         }
04700 
04701         lpszName = szFullPath;
04702     }
04703 
04704     retval = (ULONG_PTR)LoadImage(hmod,
04705                               lpszName,
04706                               <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(uImageType),
04707                               <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(cxDesired),
04708                               <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(cyDesired),
04709                               <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(LR_flags));
04710 
04711     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04712 }
04713 <span class="preprocessor">#endif // RECVSIDE</span>
04714 <span class="preprocessor"></span>
04715 <span class="comment">/***********************************************************************\</span>
04716 <span class="comment">* xxxClientCopyImage</span>
04717 <span class="comment">*</span>
04718 <span class="comment">* Returns: hIconCopy - note LR_flags could cause this to be the same as</span>
04719 <span class="comment">*       what came in.</span>
04720 <span class="comment">*</span>
04721 <span class="comment">* 11/3/1995 Created SanfordS</span>
04722 <span class="comment">\***********************************************************************/</span>
04723 
<a name="l04724"></a><a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html">04724</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html">_CLIENTCOPYIMAGEMSG</a> {
<a name="l04725"></a><a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html#o0">04725</a>     HANDLE         <a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html#o0">hImage</a>;
<a name="l04726"></a><a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html#o1">04726</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>           <a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html#o1">uImageType</a>;
<a name="l04727"></a><a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html#o2">04727</a>     <span class="keywordtype">int</span>            cxDesired;
<a name="l04728"></a><a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html#o3">04728</a>     <span class="keywordtype">int</span>            cyDesired;
<a name="l04729"></a><a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html#o4">04729</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>           LR_flags;
04730 } <a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html">CLIENTCOPYIMAGEMSG</a>;
04731 
04732 <span class="preprocessor">#ifdef SENDSIDE</span>
04733 <span class="preprocessor"></span>HANDLE <a class="code" href="../../d4/d1/userk_8h.html#a1997">xxxClientCopyImage</a>(
04734     IN HANDLE          hImage,
04735     IN UINT            uImageType,
04736     IN <span class="keywordtype">int</span>             cxDesired,
04737     IN <span class="keywordtype">int</span>             cyDesired,
04738     IN UINT            LR_flags)
04739 {
04740     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTCOPYIMAGE)
04741 
04742     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTCOPYIMAGE)
04743 
04744         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hImage     = hImage;
04745         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;uImageType = uImageType;
04746         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cxDesired  = cxDesired;
04747         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cyDesired  = cyDesired;
04748         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;LR_flags   = LR_flags;
04749 
04750         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTCOPYIMAGE);
04751         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
04752 
04753         <span class="keywordflow">if</span> (retval &amp;&amp; (uImageType != IMAGE_BITMAP)) {
04754             retval = (ULONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a439">HMRevalidateHandle</a>((HANDLE)retval);
04755         }
04756 
04757     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientCopyImage"</span>);
04758     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(HANDLE,0);
04759 }
04760 <span class="preprocessor">#endif // SENDSIDE</span>
04761 <span class="preprocessor"></span>
04762 <span class="preprocessor">#ifdef RECVSIDE</span>
04763 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientCopyImage, <a class="code" href="../../d9/d0/struct__CLIENTCOPYIMAGEMSG.html">CLIENTCOPYIMAGEMSG</a>)
04764 {
04765     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
04766 
04767     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a649">InternalCopyImage</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hImage),
04768                                       <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(uImageType),
04769                                       <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(cxDesired),
04770                                       <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(cyDesired),
04771                                       <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(LR_flags));
04772 
04773     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04774 }
04775 <span class="preprocessor">#endif // RECVSIDE</span>
04776 <span class="preprocessor"></span>
04777 <span class="comment">/**************************************************************************\</span>
04778 <span class="comment">* yyy</span>
04779 <span class="comment">*</span>
04780 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
04781 <span class="comment">\**************************************************************************/</span>
04782 
<a name="l04783"></a><a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html">04783</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html">_CLIENTGETLISTBOXSTRINGMSG</a> {
<a name="l04784"></a><a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o0">04784</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o0">CaptureBuf</a>;
<a name="l04785"></a><a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o1">04785</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
<a name="l04786"></a><a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o2">04786</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l04787"></a><a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o3">04787</a>     WPARAM wParam;
<a name="l04788"></a><a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o4">04788</a>     ULONG_PTR xParam;
<a name="l04789"></a><a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o5">04789</a>     PROC <a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o5">xpfn</a>;
<a name="l04790"></a><a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o6">04790</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> <a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o6">pOutput</a>;
<a name="l04791"></a><a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html#o7">04791</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOutput;
04792 } <a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html">CLIENTGETLISTBOXSTRINGMSG</a>;
04793 
04794 <span class="preprocessor">#ifdef SENDSIDE</span>
04795 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d4/d1/userk_8h.html#a1918">ClientGetListboxString</a>(
04796     IN <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
04797     IN UINT msg,
04798     IN WPARAM wParam,
04799     OUT PVOID pdata,
04800     IN ULONG_PTR xParam,
04801     IN PROC xpfn,
04802     IN DWORD dwSCMSFlags,
04803     IN BOOL bNotString,
04804     IN PSMS psms)
04805 {
04806     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCapture;
04807     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cchRet;
04808     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a> pstr;
04809     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiReceiver = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
04810 
04811     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(CLIENTGETLISTBOXSTRING)
04812 
04813     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
04814 
04815     pstr = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)pdata;
04816     cbCapture = pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o1">MaximumLength</a>;
04817 
04818     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(CLIENTGETLISTBOXSTRING, 1, cbCapture, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
04819 
04820         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
04821         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
04822         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
04823         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
04824         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfn = xpfn;
04825 
04826         <a class="code" href="../../d3/d5/ssend_8c.html#a57">RESERVEBYTES</a>(cbCapture, pOutput, cbOutput);
04827 
04828         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
04829         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(CLIENTGETLISTBOXSTRING);
04830         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
04831         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
04832 
04833         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
04834             <span class="keywordflow">if</span> (bNotString) {
04835                 <span class="comment">/*</span>
04836 <span class="comment">                 * This is a 4-byte "object" for ownerdraw listboxes without</span>
04837 <span class="comment">                 * the LBS_HASSTRINGS style.</span>
04838 <span class="comment">                 */</span>
04839                 <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>((PULONG_PTR)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o3">Buffer</a>, ULONG_PTR);
04840             } <span class="keywordflow">else</span> {
04841                 <a class="code" href="../../d3/d5/ssend_8c.html#a56">COPYOUTLPWSTRLIMIT</a>(pstr,
04842                         pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a> ? (<span class="keywordtype">int</span>)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o1">MaximumLength</a> :
04843                         (<span class="keywordtype">int</span>)pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o1">MaximumLength</a> / <span class="keyword">sizeof</span>(WCHAR));
04844             }
04845 
04846             cchRet = pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o0">Length</a>;
04847             <span class="keywordflow">if</span> (!pstr-&gt;<a class="code" href="../../d1/d9/struct__LARGE__STRING.html#o2">bAnsi</a>)
04848                 cchRet *= <span class="keyword">sizeof</span>(WCHAR);
04849             <span class="keywordflow">if</span> (!bNotString &amp;&amp; retval != LB_ERR &amp;&amp; retval &gt; cchRet) {
04850                 RIPMSG2(RIP_WARNING, <span class="stringliteral">"GetListBoxString: limit %lX chars to %lX\n"</span>,
04851                         retval, cchRet);
04852                 retval = cchRet;
04853             }
04854         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
04855 
04856     TRACECALLBACK("ClientGetListboxString");
04857     ENDSENDCAPTURE(DWORD,0);
04858 }
04859 #endif <span class="comment">// SENDSIDE</span>
04860 
04861 #ifdef RECVSIDE
04862 RECVCALL(ClientGetListboxString, <a class="code" href="../../d8/d1/struct__CLIENTGETLISTBOXSTRINGMSG.html">CLIENTGETLISTBOXSTRINGMSG</a>)
04863 {
04864     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> abOutput[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>];
04865 
04866     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, pmsg-&gt;cbOutput);
04867     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
04868     <span class="keywordflow">if</span> (pmsg-&gt;cbOutput &lt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>)
04869         CallbackStatus.pOutput = abOutput;
04870     <span class="keywordflow">else</span>
04871         CallbackStatus.pOutput = pmsg-&gt;pOutput;
04872 
04873     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a551">_ClientGetListboxString</a>(
04874             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
04875             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
04876             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
04877             (LPSTR)CallbackStatus.pOutput,
04878             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam),
04879             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfn));
04880 
04881     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
04882 }
04883 <span class="preprocessor">#endif // RECVSIDE</span>
04884 <span class="preprocessor"></span>
04885 <span class="comment">/**************************************************************************\</span>
04886 <span class="comment">* yyy</span>
04887 <span class="comment">*</span>
04888 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
04889 <span class="comment">\**************************************************************************/</span>
04890 
<a name="l04891"></a><a class="code" href="../../d4/d2/struct__CLIENTLOADLIBRARYMSG.html">04891</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d2/struct__CLIENTLOADLIBRARYMSG.html">_CLIENTLOADLIBRARYMSG</a> {
<a name="l04892"></a><a class="code" href="../../d4/d2/struct__CLIENTLOADLIBRARYMSG.html#o0">04892</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d4/d2/struct__CLIENTLOADLIBRARYMSG.html#o0">CaptureBuf</a>;
<a name="l04893"></a><a class="code" href="../../d4/d2/struct__CLIENTLOADLIBRARYMSG.html#o1">04893</a>     UNICODE_STRING <a class="code" href="../../d4/d2/struct__CLIENTLOADLIBRARYMSG.html#o1">strLib</a>;
<a name="l04894"></a><a class="code" href="../../d4/d2/struct__CLIENTLOADLIBRARYMSG.html#o2">04894</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>       <a class="code" href="../../d4/d2/struct__CLIENTLOADLIBRARYMSG.html#o2">bWx86KnownDll</a>;
04895 } <a class="code" href="../../d4/d2/struct__CLIENTLOADLIBRARYMSG.html">CLIENTLOADLIBRARYMSG</a>;
04896 
04897 <span class="preprocessor">#ifdef SENDSIDE</span>
04898 <span class="preprocessor"></span>HANDLE <a class="code" href="../../d4/d1/userk_8h.html#a1919">ClientLoadLibrary</a>(
04899     IN PUNICODE_STRING pstrLib,
04900     IN BOOL bWx86KnownDll)
04901 {
04902     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTLOADLIBRARY)
04903 
04904     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(CLIENTLOADLIBRARY, 1, pstrLib-&gt;MaximumLength, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
04905 
04906         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;bWx86KnownDll = bWx86KnownDll;
04907         <a class="code" href="../../d3/d5/ssend_8c.html#a42">COPYSTRING</a>(strLib);
04908 
04909         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(CLIENTLOADLIBRARY);
04910         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
04911 
04912     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientLoadLibrary"</span>);
04913     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(HANDLE,0);
04914 }
04915 <span class="preprocessor">#endif // SENDSIDE</span>
04916 <span class="preprocessor"></span>
04917 <span class="preprocessor">#ifdef RECVSIDE</span>
04918 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientLoadLibrary, <a class="code" href="../../d4/d2/struct__CLIENTLOADLIBRARYMSG.html">CLIENTLOADLIBRARYMSG</a>)
04919 {
04920     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
04921     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
04922 
04923 <span class="preprocessor">#if defined(WX86)</span>
04924 <span class="preprocessor"></span>
04925     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(bWx86KnownDll)) {
04926 
04927         <span class="comment">//</span>
04928         <span class="comment">// If we haven't done so yet, setup this process to use Wx86</span>
04929         <span class="comment">// to emulate x86 hook procedures. Wx86 once loaded into the client</span>
04930         <span class="comment">// process is NEVER freed. This avoids having to load\free wx86 every</span>
04931         <span class="comment">// time a client hook dll is loaded, and hence every time a</span>
04932         <span class="comment">// sethook\unsethook cycle occurs.</span>
04933         <span class="comment">//</span>
04934 
04935 
04936         RtlEnterCriticalSection(&amp;gcsWx86Load);
04937 
04938         <span class="keywordflow">if</span> (Wx86LoadCount &gt; 0) {
04939             Wx86LoadCount++;
04940             }
04941         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!Wx86LoadCount){
04942             Wx86LoadCount++;
04943             hWx86Dll = LoadLibraryExW(L<span class="stringliteral">"Wx86.dll"</span>, NULL, 0);
04944             <span class="keywordflow">if</span> (hWx86Dll) {
04945                 pfnWx86HookCallBack = (PVOID)GetProcAddress(hWx86Dll,
04946                                                             <span class="stringliteral">"Wx86HookCallBack"</span>
04947                                                             );
04948 
04949                 pfnWx86LoadX86Dll = (PVOID)GetProcAddress(hWx86Dll,
04950                                                           <span class="stringliteral">"Wx86LoadX86Dll"</span>
04951                                                           );
04952 
04953 
04954                 pfnWx86FreeX86Dll = (PVOID)GetProcAddress(hWx86Dll,
04955                                                           <span class="stringliteral">"Wx86FreeX86Dll"</span>
04956                                                           );
04957                 }
04958 
04959 
04960             <span class="keywordflow">if</span> (!hWx86Dll || !pfnWx86HookCallBack || !pfnWx86LoadX86Dll || !pfnWx86FreeX86Dll) {
04961                 pfnWx86HookCallBack = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04962                 pfnWx86LoadX86Dll = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04963                 pfnWx86FreeX86Dll = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04964                 Wx86LoadCount = -1;
04965                 retval = 0;
04966                 RtlLeaveCriticalSection(&amp;gcsWx86Load);
04967                 <span class="keywordflow">goto</span> CLLFail;
04968                 }
04969             }
04970 
04971            <span class="comment">//</span>
04972            <span class="comment">// Wx86LoadCount == -1, means load has previously failed</span>
04973            <span class="comment">// and can't load the x86 dll.</span>
04974            <span class="comment">//</span>
04975         <span class="keywordflow">else</span> {
04976             retval = 0;
04977             RtlLeaveCriticalSection(&amp;gcsWx86Load);
04978             <span class="keywordflow">goto</span> CLLFail;
04979             }
04980 
04981         RtlLeaveCriticalSection(&amp;gcsWx86Load);
04982 
04983 
04984 
04985 
04986 
04987         retval = (ULONG_PTR)pfnWx86LoadX86Dll((LPTSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a19">FIXUPSTRING</a>(strLib),
04988                                           LOAD_WITH_ALTERED_SEARCH_PATH
04989                                           );
04990 
04991         }
04992     <span class="keywordflow">else</span> {
04993         retval = (ULONG_PTR)LoadLibraryEx((LPTSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a19">FIXUPSTRING</a>(strLib),
04994                                       NULL,
04995                                       LOAD_WITH_ALTERED_SEARCH_PATH
04996                                       );
04997         }
04998 
04999 <span class="preprocessor">#else</span>
05000 <span class="preprocessor"></span>
05001     retval = (ULONG_PTR)LoadLibraryEx((LPTSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a19">FIXUPSTRING</a>(strLib), NULL, LOAD_WITH_ALTERED_SEARCH_PATH);
05002 
05003 <span class="preprocessor">#endif</span>
05004 <span class="preprocessor"></span>
05005 
05006 <span class="preprocessor">#if defined(WX86)</span>
05007 <span class="preprocessor"></span>CLLFail:
05008 <span class="preprocessor">#endif</span>
05009 <span class="preprocessor"></span>
05010     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05011 }
05012 <span class="preprocessor">#endif // RECVSIDE</span>
05013 <span class="preprocessor"></span>
05014 <span class="comment">/**************************************************************************\</span>
05015 <span class="comment">* yyy</span>
05016 <span class="comment">*</span>
05017 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
05018 <span class="comment">\**************************************************************************/</span>
05019 
<a name="l05020"></a><a class="code" href="../../d4/d1/struct__CLIENTFREELIBRARYMSG.html">05020</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d1/struct__CLIENTFREELIBRARYMSG.html">_CLIENTFREELIBRARYMSG</a> {
<a name="l05021"></a><a class="code" href="../../d4/d1/struct__CLIENTFREELIBRARYMSG.html#o0">05021</a>     HANDLE hmod;
05022 } <a class="code" href="../../d4/d1/struct__CLIENTFREELIBRARYMSG.html">CLIENTFREELIBRARYMSG</a>;
05023 
05024 <span class="preprocessor">#ifdef SENDSIDE</span>
05025 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1920">ClientFreeLibrary</a>(
05026     IN HANDLE hmod)
05027 {
05028     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTFREELIBRARY)
05029 
05030     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTFREELIBRARY)
05031 
05032         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hmod = hmod;
05033 
05034         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTFREELIBRARY);
05035         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05036 
05037     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientFreeLibrary"</span>);
05038     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>,0);
05039 }
05040 <span class="preprocessor">#endif // SENDSIDE</span>
05041 <span class="preprocessor"></span>
05042 <span class="preprocessor">#ifdef RECVSIDE</span>
05043 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientFreeLibrary, <a class="code" href="../../d4/d1/struct__CLIENTFREELIBRARYMSG.html">CLIENTFREELIBRARYMSG</a>)
05044 {
05045     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05046 
05047 <span class="preprocessor">#if defined(WX86)</span>
05048 <span class="preprocessor"></span>
05049     <span class="comment">//</span>
05050     <span class="comment">// if the Hook Module is an X86 image, notify Wx86, so that</span>
05051     <span class="comment">// it can clear its hook cache.</span>
05052     <span class="comment">//</span>
05053 
05054     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d9/imagedir_8c.html#a0">RtlImageNtHeader</a>(pmsg-&gt;hmod)-&gt;FileHeader.Machine == IMAGE_FILE_MACHINE_I386) {
05055 
05056         RtlEnterCriticalSection(&amp;gcsWx86Load);
05057 
05058         <span class="keywordflow">if</span> (Wx86LoadCount &gt; 0) {
05059             pfnWx86HookCallBack(0, NULL);
05060             retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pfnWx86FreeX86Dll(pmsg-&gt;hmod);
05061             <span class="keywordflow">if</span> (!--Wx86LoadCount) {
05062                 FreeLibrary(hWx86Dll);
05063                 }
05064             }
05065         <span class="keywordflow">else</span> {
05066             retval = 0; <span class="comment">// FALSE</span>
05067             }
05068 
05069         RtlLeaveCriticalSection(&amp;gcsWx86Load);
05070 
05071         }
05072     <span class="keywordflow">else</span> {
05073         retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)FreeLibrary(pmsg-&gt;hmod);
05074         }
05075 
05076 <span class="preprocessor">#else</span>
05077 <span class="preprocessor"></span>
05078     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)FreeLibrary(pmsg-&gt;hmod);
05079 
05080 <span class="preprocessor">#endif</span>
05081 <span class="preprocessor"></span>
05082     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05083 }
05084 <span class="preprocessor">#endif // RECVSIDE</span>
05085 <span class="preprocessor"></span>
05086 <span class="comment">/**************************************************************************\</span>
05087 <span class="comment">* xxxClientGetCharsetInfo</span>
05088 <span class="comment">*</span>
05089 <span class="comment">* 96-06-11  IanJa     Created</span>
05090 <span class="comment">\**************************************************************************/</span>
05091 
<a name="l05092"></a><a class="code" href="../../d5/d1/struct__CLIENTGETCHARSETINFOMSG.html">05092</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d1/struct__CLIENTGETCHARSETINFOMSG.html">_CLIENTGETCHARSETINFOMSG</a> {
<a name="l05093"></a><a class="code" href="../../d5/d1/struct__CLIENTGETCHARSETINFOMSG.html#o0">05093</a>     LCID <a class="code" href="../../d5/d1/struct__CLIENTGETCHARSETINFOMSG.html#o0">lcid</a>;
<a name="l05094"></a><a class="code" href="../../d5/d1/struct__CLIENTGETCHARSETINFOMSG.html#o1">05094</a>     CHARSETINFO <a class="code" href="../../d5/d1/struct__CLIENTGETCHARSETINFOMSG.html#o1">cs</a>;
05095 } <a class="code" href="../../d5/d1/struct__CLIENTGETCHARSETINFOMSG.html">CLIENTGETCHARSETINFOMSG</a>;
05096 
05097 <span class="preprocessor">#ifdef SENDSIDE</span>
05098 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1921">xxxClientGetCharsetInfo</a>(
05099     IN LCID lcid,
05100     OUT PCHARSETINFO pcs)
05101 {
05102     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTGETCHARSETINFO)
05103 
05104     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTGETSCHARSETINFO)
05105 
05106         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lcid = lcid;
05107 
05108         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTGETCHARSETINFO);
05109         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05110 
05111         <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(<a class="code" href="../../d7/d3/monitor_8c.html#a2">pcs</a>, CHARSETINFO);
05112 
05113     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientGetCharsetInfo"</span>);
05114     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>,0);
05115 }
05116 <span class="preprocessor">#endif // SENDSIDE</span>
05117 <span class="preprocessor"></span>
05118 <span class="preprocessor">#ifdef RECVSIDE</span>
05119 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientGetCharsetInfo, <a class="code" href="../../d5/d1/struct__CLIENTGETCHARSETINFOMSG.html">CLIENTGETCHARSETINFOMSG</a>)
05120 {
05121     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;cs, <span class="keyword">sizeof</span>(CHARSETINFO));
05122 
05123     <span class="comment">// TCI_SRCLOCALE = 0x1000</span>
05124     <span class="comment">// Sundown: lcid value should be zero-extended in the TCI_SRCLOCALE case.</span>
05125     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)TranslateCharsetInfo((DWORD *)ULongToPtr( pmsg-&gt;lcid ), &amp;pmsg-&gt;cs, TCI_SRCLOCALE);
05126 
05127     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05128 }
05129 <span class="preprocessor">#endif // RECVSIDE</span>
05130 <span class="preprocessor"></span>
05131 <span class="comment">/**************************************************************************\</span>
05132 <span class="comment">* ClientFreeDDEHandle</span>
05133 <span class="comment">*</span>
05134 <span class="comment">* 9-29-91 sanfords     Created.</span>
05135 <span class="comment">\**************************************************************************/</span>
05136 
<a name="l05137"></a><a class="code" href="../../d3/d1/struct__CLIENTFREEDDEHANDLEMSG.html">05137</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d1/struct__CLIENTFREEDDEHANDLEMSG.html">_CLIENTFREEDDEHANDLEMSG</a> {
<a name="l05138"></a><a class="code" href="../../d3/d1/struct__CLIENTFREEDDEHANDLEMSG.html#o0">05138</a>     HANDLE <a class="code" href="../../d3/d1/struct__CLIENTFREEDDEHANDLEMSG.html#o0">hClient</a>;
<a name="l05139"></a><a class="code" href="../../d3/d1/struct__CLIENTFREEDDEHANDLEMSG.html#o1">05139</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d1/struct__CLIENTFREEDDEHANDLEMSG.html#o1">flags</a>;
05140 } <a class="code" href="../../d3/d1/struct__CLIENTFREEDDEHANDLEMSG.html">CLIENTFREEDDEHANDLEMSG</a>;
05141 
05142 <span class="preprocessor">#ifdef SENDSIDE</span>
05143 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d5/d4/kernel_2ddetrack_8c.html#a37">ClientFreeDDEHandle</a>(
05144     IN HANDLE hClient,
05145     IN DWORD flags)
05146 {
05147     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTFREEDDEHANDLE)
05148 
05149     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTFREEDDEHANDLE)
05150 
05151         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hClient = hClient;
05152         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;flags = flags;
05153 
05154         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTFREEDDEHANDLE);
05155         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05156 
05157     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientFreeDDEHandle"</span>);
05158     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, 0);
05159 }
05160 <span class="preprocessor">#endif // SENDSIDE</span>
05161 <span class="preprocessor"></span>
05162 
05163 
05164 <span class="preprocessor">#ifdef RECVSIDE</span>
05165 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientFreeDDEHandle, <a class="code" href="../../d3/d1/struct__CLIENTFREEDDEHANDLEMSG.html">CLIENTFREEDDEHANDLEMSG</a>)
05166 {
05167     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05168     <a class="code" href="../../d9/d7/ntcb_8h.html#a96">_ClientFreeDDEHandle</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hClient), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(flags));
05169     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05170 }
05171 <span class="preprocessor">#endif // RECVSIDE</span>
05172 <span class="preprocessor"></span>
05173 
05174 
05175 
05176 <span class="comment">/**************************************************************************\</span>
05177 <span class="comment">* ClientGetDDEFlags</span>
05178 <span class="comment">*</span>
05179 <span class="comment">* This function is used to get a peek at the wStatus flags packed within</span>
05180 <span class="comment">* DDE handles - this could either be within the DdePack structure directly</span>
05181 <span class="comment">* or within the direct data handle given or referenced via the DdePack</span>
05182 <span class="comment">* structure.  flags is used to figure out the right thing to do.</span>
05183 <span class="comment">*</span>
05184 <span class="comment">* 9-29-91 sanfords     Created.</span>
05185 <span class="comment">\**************************************************************************/</span>
05186 
<a name="l05187"></a><a class="code" href="../../d6/d1/struct__CLIENTGETDDEFLAGSMSG.html">05187</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d1/struct__CLIENTGETDDEFLAGSMSG.html">_CLIENTGETDDEFLAGSMSG</a> {
<a name="l05188"></a><a class="code" href="../../d6/d1/struct__CLIENTGETDDEFLAGSMSG.html#o0">05188</a>     HANDLE <a class="code" href="../../d6/d1/struct__CLIENTGETDDEFLAGSMSG.html#o0">hClient</a>;
<a name="l05189"></a><a class="code" href="../../d6/d1/struct__CLIENTGETDDEFLAGSMSG.html#o1">05189</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d6/d1/struct__CLIENTGETDDEFLAGSMSG.html#o1">flags</a>;
05190 } <a class="code" href="../../d6/d1/struct__CLIENTGETDDEFLAGSMSG.html">CLIENTGETDDEFLAGSMSG</a>;
05191 
05192 <span class="preprocessor">#ifdef SENDSIDE</span>
05193 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d5/d4/kernel_2ddetrack_8c.html#a38">ClientGetDDEFlags</a>(
05194     IN HANDLE hClient,
05195     IN DWORD flags)
05196 {
05197     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTGETDDEFLAGS)
05198 
05199     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTGETDDEFLAGS)
05200 
05201         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hClient = hClient;
05202         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;flags = flags;
05203 
05204         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTGETDDEFLAGS);
05205         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05206 
05207     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientGetDDEFlags"</span>);
05208     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, 0);
05209 }
05210 <span class="preprocessor">#endif // SENDSIDE</span>
05211 <span class="preprocessor"></span>
05212 
05213 
05214 <span class="preprocessor">#ifdef RECVSIDE</span>
05215 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientGetDDEFlags, <a class="code" href="../../d6/d1/struct__CLIENTGETDDEFLAGSMSG.html">CLIENTGETDDEFLAGSMSG</a>)
05216 {
05217     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05218     retval = <a class="code" href="../../d9/d7/ntcb_8h.html#a97">_ClientGetDDEFlags</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hClient), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(flags));
05219     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05220 }
05221 <span class="preprocessor">#endif // RECVSIDE</span>
05222 <span class="preprocessor"></span>
05223 
05224 
05225 <span class="comment">/************************************************************************</span>
05226 <span class="comment">* ClientCopyDDEIn1</span>
05227 <span class="comment">*</span>
05228 <span class="comment">* History:</span>
05229 <span class="comment">* 10-22-91    sanfords    Created</span>
05230 <span class="comment">\***********************************************************************/</span>
05231 
<a name="l05232"></a><a class="code" href="../../d5/d0/struct__CLIENTCOPYDDEIN1MSG.html">05232</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d0/struct__CLIENTCOPYDDEIN1MSG.html">_CLIENTCOPYDDEIN1MSG</a> {
<a name="l05233"></a><a class="code" href="../../d5/d0/struct__CLIENTCOPYDDEIN1MSG.html#o0">05233</a>     HANDLE <a class="code" href="../../d5/d0/struct__CLIENTCOPYDDEIN1MSG.html#o0">hClient</a>;      <span class="comment">// client side DDE handle - non-0 on initial call</span>
<a name="l05234"></a><a class="code" href="../../d5/d0/struct__CLIENTCOPYDDEIN1MSG.html#o1">05234</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d5/d0/struct__CLIENTCOPYDDEIN1MSG.html#o1">flags</a>;
05235 } <a class="code" href="../../d5/d0/struct__CLIENTCOPYDDEIN1MSG.html">CLIENTCOPYDDEIN1MSG</a>;
05236 
05237 <span class="preprocessor">#ifdef SENDSIDE</span>
05238 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d5/d4/kernel_2ddetrack_8c.html#a39">xxxClientCopyDDEIn1</a>(
05239     HANDLE hClient,
05240     DWORD flags,
05241     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> *ppi)
05242 {
05243     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi;
05244     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a> IntDdeInfo;
05245 
05246     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTCOPYDDEIN1)
05247 
05248     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTCOPYDDEIN1)
05249 
05250         retval = <a class="code" href="../../d6/d4/ddetrack_8h.html#a17">FAIL_POST</a>;
05251         *ppi = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
05252         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hClient = hClient;
05253         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;flags = flags;
05254 
05255         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTCOPYDDEIN1);
05256         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05257 
05258         <span class="keywordflow">if</span> (retval != <a class="code" href="../../d6/d4/ddetrack_8h.html#a19">DO_POST</a>) {
05259             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
05260         }
05261 
05262         <span class="keywordflow">try</span> {
05263             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(&amp;IntDdeInfo, <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a>);
05264 
05265             pi = (<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a>)UserAllocPool(
05266                     <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a>) + IntDdeInfo.<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a> +
05267                     IntDdeInfo.<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o7">cbIndirect</a>, TAG_DDE);
05268 
05269             <span class="keywordflow">if</span> (pi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05270                 *ppi = pi;
05271                 *pi = IntDdeInfo;
05272 
05273                 <span class="keywordflow">if</span> (IntDdeInfo.cbDirect) {
05274                     RtlCopyMemory((PBYTE)pi + <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a>),
05275                             IntDdeInfo.pDirect,
05276                             IntDdeInfo.cbDirect);
05277                 }
05278 
05279                 <span class="keywordflow">if</span> (IntDdeInfo.cbIndirect) {
05280                     RtlCopyMemory((PBYTE)pi + <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a>) +
05281                                 IntDdeInfo.cbDirect,
05282                             IntDdeInfo.pIndirect,
05283                             IntDdeInfo.cbIndirect);
05284                 }
05285 
05286                 <a class="code" href="../../d9/d7/ntcb_8h.html#a93">xxxClientCopyDDEIn2</a>(pi);
05287 
05288             } <span class="keywordflow">else</span> {
05289                 retval = <a class="code" href="../../d6/d4/ddetrack_8h.html#a20">FAILNOFREE_POST</a>;
05290             }
05291         } except (W32ExceptionHandler(TRUE, RIP_WARNING)) {
05292             <span class="keywordflow">if</span> (pi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
05293                 UserFreePool(pi);
05294             retval = <a class="code" href="../../d6/d4/ddetrack_8h.html#a20">FAILNOFREE_POST</a>;
05295             <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
05296         }
05297 
05298     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientCopyDDEIn1"</span>);
05299     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(DWORD, retval);
05300 }
05301 <span class="preprocessor">#endif // SENDSIDE</span>
05302 <span class="preprocessor"></span>
05303 <span class="preprocessor">#ifdef RECVSIDE</span>
05304 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientCopyDDEIn1, <a class="code" href="../../d5/d0/struct__CLIENTCOPYDDEIN1MSG.html">CLIENTCOPYDDEIN1MSG</a>)
05305 {
05306     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a> IntDdeInfo;
05307 
05308     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;IntDdeInfo, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a>));
05309 
05310     IntDdeInfo.<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> = <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(flags);
05311     retval = <a class="code" href="../../d9/d7/ntcb_8h.html#a90">_ClientCopyDDEIn1</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hClient), &amp;IntDdeInfo);
05312 
05313     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05314 }
05315 <span class="preprocessor">#endif // RECVSIDE</span>
05316 <span class="preprocessor"></span>
05317 
05318 <span class="comment">/************************************************************************</span>
05319 <span class="comment">* ClientCopyDDEIn2</span>
05320 <span class="comment">*</span>
05321 <span class="comment">* History:</span>
05322 <span class="comment">* 9-3-91    sanfords    Created</span>
05323 <span class="comment">\***********************************************************************/</span>
05324 
<a name="l05325"></a><a class="code" href="../../d6/d0/struct__CLIENTCOPYDDEIN2MSG.html">05325</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d0/struct__CLIENTCOPYDDEIN2MSG.html">_CLIENTCOPYDDEIN2MSG</a> {
<a name="l05326"></a><a class="code" href="../../d6/d0/struct__CLIENTCOPYDDEIN2MSG.html#o0">05326</a>     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a> IntDdeInfo;
05327 } <a class="code" href="../../d6/d0/struct__CLIENTCOPYDDEIN2MSG.html">CLIENTCOPYDDEIN2MSG</a>;
05328 
05329 <span class="preprocessor">#ifdef SENDSIDE</span>
05330 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d9/d7/ntcb_8h.html#a93">xxxClientCopyDDEIn2</a>(
05331     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi)
05332 {
05333     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTCOPYDDEIN2)
05334 
05335     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTCOPYDDEIN2)
05336 
05337         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;IntDdeInfo = *pi;
05338 
05339         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTCOPYDDEIN2);
05340         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05341 
05342     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientCopyDDEIn2"</span>);
05343     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>, 0);
05344 }
05345 <span class="preprocessor">#endif // SENDSIDE</span>
05346 <span class="preprocessor"></span>
05347 <span class="preprocessor">#ifdef RECVSIDE</span>
05348 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientCopyDDEIn2, <a class="code" href="../../d6/d0/struct__CLIENTCOPYDDEIN2MSG.html">CLIENTCOPYDDEIN2MSG</a>)
05349 {
05350     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05351 
05352     <a class="code" href="../../d9/d7/ntcb_8h.html#a91">_ClientCopyDDEIn2</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(IntDdeInfo));
05353 
05354     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05355 }
05356 <span class="preprocessor">#endif // RECVSIDE</span>
05357 <span class="preprocessor"></span>
05358 
05359 
05360 <span class="comment">/************************************************************************</span>
05361 <span class="comment">* ClientCopyDDEOut2</span>
05362 <span class="comment">*</span>
05363 <span class="comment">* History:</span>
05364 <span class="comment">* 10-22-91    sanfords    Created</span>
05365 <span class="comment">\***********************************************************************/</span>
05366 
<a name="l05367"></a><a class="code" href="../../d8/d0/struct__CLIENTCOPYDDEOUT2MSG.html">05367</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d0/struct__CLIENTCOPYDDEOUT2MSG.html">_CLIENTCOPYDDEOUT2MSG</a> {
<a name="l05368"></a><a class="code" href="../../d8/d0/struct__CLIENTCOPYDDEOUT2MSG.html#o0">05368</a>     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a> IntDdeInfo;
05369 } <a class="code" href="../../d8/d0/struct__CLIENTCOPYDDEOUT2MSG.html">CLIENTCOPYDDEOUT2MSG</a>;
05370 
05371 <span class="preprocessor">#ifdef SENDSIDE</span>
05372 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d5/d4/kernel_2ddetrack_8c.html#a41">xxxClientCopyDDEOut2</a>(
05373     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi)
05374 {
05375     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTCOPYDDEOUT2)
05376 
05377     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTCOPYDDEOUT2)
05378 
05379         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;IntDdeInfo = *pi;
05380 
05381         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTCOPYDDEOUT2);
05382         <span class="comment">/*</span>
05383 <span class="comment">         * This read is covered by a try/except in ClientCopyDDEOut1.</span>
05384 <span class="comment">         */</span>
05385         pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a> = <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;IntDdeInfo.hDirect;
05386         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05387 
05388     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientCopyDDEOut2"</span>);
05389     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, 0);
05390 }
05391 <span class="preprocessor">#endif // SENDSIDE</span>
05392 <span class="preprocessor"></span>
05393 <span class="preprocessor">#ifdef RECVSIDE</span>
05394 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientCopyDDEOut2, <a class="code" href="../../d8/d0/struct__CLIENTCOPYDDEOUT2MSG.html">CLIENTCOPYDDEOUT2MSG</a>)
05395 {
05396     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05397 
05398     retval = <a class="code" href="../../d9/d7/ntcb_8h.html#a95">_ClientCopyDDEOut2</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(IntDdeInfo));
05399 
05400     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05401 }
05402 <span class="preprocessor">#endif // RECVSIDE</span>
05403 <span class="preprocessor"></span>
05404 <span class="comment">/************************************************************************</span>
05405 <span class="comment">* ClientCopyDDEOut1</span>
05406 <span class="comment">*</span>
05407 <span class="comment">* History:</span>
05408 <span class="comment">* 10-22-91    sanfords    Created</span>
05409 <span class="comment">\***********************************************************************/</span>
05410 
<a name="l05411"></a><a class="code" href="../../d7/d0/struct__CLIENTCOPYDDEOUT1MSG.html">05411</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d0/struct__CLIENTCOPYDDEOUT1MSG.html">_CLIENTCOPYDDEOUT1MSG</a> {
<a name="l05412"></a><a class="code" href="../../d7/d0/struct__CLIENTCOPYDDEOUT1MSG.html#o0">05412</a>     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a> IntDdeInfo;
05413 } <a class="code" href="../../d7/d0/struct__CLIENTCOPYDDEOUT1MSG.html">CLIENTCOPYDDEOUT1MSG</a>;
05414 
05415 <span class="preprocessor">#ifdef SENDSIDE</span>
05416 <span class="preprocessor"></span>HANDLE <a class="code" href="../../d5/d4/kernel_2ddetrack_8c.html#a40">xxxClientCopyDDEOut1</a>(
05417     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">PINTDDEINFO</a> pi)
05418 {
05419     <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a> IntDdeInfo;
05420 
05421     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTCOPYDDEOUT1)
05422 
05423     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTCOPYDDEOUT1)
05424 
05425         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;IntDdeInfo = *pi;
05426 
05427         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTCOPYDDEOUT1);
05428         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05429 
05430         <span class="keywordflow">if</span> (retval) {
05431             <span class="keywordflow">try</span> {
05432                 <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(&amp;IntDdeInfo, <a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a>);
05433 
05434                 <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a>) {
05435                     RtlCopyMemory(IntDdeInfo.<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o3">pDirect</a>,
05436                             (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pi + <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a>),
05437                             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a>);
05438                 }
05439 
05440                 <span class="keywordflow">if</span> (pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o7">cbIndirect</a>) {
05441                     RtlCopyMemory(IntDdeInfo.<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o6">pIndirect</a>,
05442                             (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pi + <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a>) + pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o4">cbDirect</a>,
05443                             pi-&gt;<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o7">cbIndirect</a>);
05444                 }
05445 
05446                 <span class="keywordflow">if</span> (IntDdeInfo.<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05447                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSuccess = <a class="code" href="../../d5/d4/kernel_2ddetrack_8c.html#a41">xxxClientCopyDDEOut2</a>(&amp;IntDdeInfo);
05448                     <span class="keywordflow">if</span> (fSuccess &amp;&amp; IntDdeInfo.<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o1">flags</a> &amp; <a class="code" href="../../d6/d4/ddetrack_8h.html#a11">XS_EXECUTE</a>) {
05449                         <span class="comment">/*</span>
05450 <span class="comment">                         * In case value was changed by Execute Fixup.</span>
05451 <span class="comment">                         */</span>
05452                         retval = (ULONG_PTR)IntDdeInfo.<a class="code" href="../../d7/d8/structtagINTDDEINFO.html#o2">hDirect</a>;
05453                     }
05454                 }
05455                 *pi = IntDdeInfo;
05456             } except (W32ExceptionHandler(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, RIP_WARNING)) {
05457                 retval = 0;
05458                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
05459             }
05460         }
05461 
05462     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientCopyDDEOut1"</span>);
05463     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(HANDLE, 0);
05464 }
05465 <span class="preprocessor">#endif // SENDSIDE</span>
05466 <span class="preprocessor"></span>
05467 
05468 
05469 <span class="preprocessor">#ifdef RECVSIDE</span>
05470 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientCopyDDEOut1, <a class="code" href="../../d7/d0/struct__CLIENTCOPYDDEOUT1MSG.html">CLIENTCOPYDDEOUT1MSG</a>)
05471 {
05472     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;IntDdeInfo, <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d8/structtagINTDDEINFO.html">INTDDEINFO</a>));
05473 
05474     retval = (ULONG_PTR)<a class="code" href="../../d9/d7/ntcb_8h.html#a92">_ClientCopyDDEOut1</a>(&amp;pmsg-&gt;IntDdeInfo);
05475 
05476     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05477 }
05478 <span class="preprocessor">#endif // RECVSIDE</span>
05479 <span class="preprocessor"></span>
05480 
05481 
05482 <span class="comment">/**************************************************************************\</span>
05483 <span class="comment">* ClientEventCallback</span>
05484 <span class="comment">*</span>
05485 <span class="comment">* 11-11-91  sanfords    Created</span>
05486 <span class="comment">\**************************************************************************/</span>
05487 
<a name="l05488"></a><a class="code" href="../../d0/d1/struct__CLIENTEVENTCALLBACKMSG.html">05488</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d1/struct__CLIENTEVENTCALLBACKMSG.html">_CLIENTEVENTCALLBACKMSG</a> {
<a name="l05489"></a><a class="code" href="../../d0/d1/struct__CLIENTEVENTCALLBACKMSG.html#o0">05489</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d0/d1/struct__CLIENTEVENTCALLBACKMSG.html#o0">CaptureBuf</a>;
<a name="l05490"></a><a class="code" href="../../d0/d1/struct__CLIENTEVENTCALLBACKMSG.html#o1">05490</a>     PVOID <a class="code" href="../../d0/d1/struct__CLIENTEVENTCALLBACKMSG.html#o1">pcii</a>;
<a name="l05491"></a><a class="code" href="../../d0/d1/struct__CLIENTEVENTCALLBACKMSG.html#o2">05491</a>     PVOID <a class="code" href="../../d0/d1/struct__CLIENTEVENTCALLBACKMSG.html#o2">pep</a>;
05492 } <a class="code" href="../../d0/d1/struct__CLIENTEVENTCALLBACKMSG.html">CLIENTEVENTCALLBACKMSG</a>;
05493 
05494 <span class="preprocessor">#ifdef SENDSIDE</span>
05495 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d4/ddemlsvr_8h.html#a13">ClientEventCallback</a>(
05496     IN PVOID pcii,
05497     IN <a class="code" href="../../d7/d4/structtagEVENT__PACKET.html">PEVENT_PACKET</a> pep)
05498 {
05499     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCapture = <a class="code" href="../../d1/d8/w32_2ntuser_2kernel_2event_8c.html#a2">pep</a>-&gt;cbEventData +
05500             <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d4/structtagEVENT__PACKET.html">EVENT_PACKET</a>) - <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
05501 
05502     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTEVENTCALLBACK)
05503 
05504     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(CLIENTEVENTCALLBACK, 1, cbCapture, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
05505 
05506         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pcii = pcii;
05507         <a class="code" href="../../d3/d5/ssend_8c.html#a38">COPYBYTES</a>(<a class="code" href="../../d1/d8/w32_2ntuser_2kernel_2event_8c.html#a2">pep</a>, cbCapture);
05508 
05509         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(CLIENTEVENTCALLBACK);
05510         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05511 
05512     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientEventCallback"</span>);
05513     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
05514 }
05515 <span class="preprocessor">#endif // SENDSIDE</span>
05516 <span class="preprocessor"></span>
05517 <span class="preprocessor">#ifdef RECVSIDE</span>
05518 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientEventCallback, <a class="code" href="../../d0/d1/struct__CLIENTEVENTCALLBACKMSG.html">CLIENTEVENTCALLBACKMSG</a>)
05519 {
05520     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05521     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
05522 
05523     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a128">_ClientEventCallback</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pcii), (<a class="code" href="../../d7/d4/structtagEVENT__PACKET.html">PEVENT_PACKET</a>)<a class="code" href="../../d5/d8/crecv_8c.html#a16">FIXUP</a>(pep));
05524 
05525     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05526 }
05527 <span class="preprocessor">#endif // RECVSIDE</span>
05528 <span class="preprocessor"></span>
05529 <span class="comment">/**************************************************************************\</span>
05530 <span class="comment">* ClientGetDDEHookData</span>
05531 <span class="comment">*</span>
05532 <span class="comment">* 11-11-91  sanfords    Created</span>
05533 <span class="comment">\**************************************************************************/</span>
05534 
<a name="l05535"></a><a class="code" href="../../d7/d1/struct__CLIENTGETDDEHOOKDATAMSG.html">05535</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d1/struct__CLIENTGETDDEHOOKDATAMSG.html">_CLIENTGETDDEHOOKDATAMSG</a> {
<a name="l05536"></a><a class="code" href="../../d7/d1/struct__CLIENTGETDDEHOOKDATAMSG.html#o0">05536</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d7/d1/struct__CLIENTGETDDEHOOKDATAMSG.html#o0">message</a>;
<a name="l05537"></a><a class="code" href="../../d7/d1/struct__CLIENTGETDDEHOOKDATAMSG.html#o1">05537</a>     LPARAM lParam;
<a name="l05538"></a><a class="code" href="../../d7/d1/struct__CLIENTGETDDEHOOKDATAMSG.html#o2">05538</a>     DDEML_MSG_HOOK_DATA <a class="code" href="../../d7/d1/struct__CLIENTGETDDEHOOKDATAMSG.html#o2">dmhd</a>;
05539 } <a class="code" href="../../d7/d1/struct__CLIENTGETDDEHOOKDATAMSG.html">CLIENTGETDDEHOOKDATAMSG</a>;
05540 
05541 <span class="preprocessor">#ifdef SENDSIDE</span>
05542 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d4/ddemlsvr_8h.html#a14">ClientGetDDEHookData</a>(
05543     IN UINT message,
05544     IN LPARAM lParam,
05545     OUT PDDEML_MSG_HOOK_DATA pdmhd)
05546 {
05547     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTGETDDEHOOKDATA)
05548 
05549     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTGETDDEHOOKDATA)
05550 
05551         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = lParam;
05552         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;message = message;
05553 
05554         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTGETDDEHOOKDATA);
05555         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05556 
05557         <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(pdmhd, DDEML_MSG_HOOK_DATA);
05558 
05559     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientGetDDEHookData"</span>);
05560     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
05561 }
05562 <span class="preprocessor">#endif // SENDSIDE</span>
05563 <span class="preprocessor"></span>
05564 <span class="preprocessor">#ifdef RECVSIDE</span>
05565 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientGetDDEHookData, <a class="code" href="../../d7/d1/struct__CLIENTGETDDEHOOKDATAMSG.html">CLIENTGETDDEHOOKDATAMSG</a>)
05566 {
05567     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;dmhd, <span class="keyword">sizeof</span>(DDEML_MSG_HOOK_DATA));
05568 
05569     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a130">_ClientGetDDEHookData</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(message), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(lParam),
05570             (PDDEML_MSG_HOOK_DATA)&amp;pmsg-&gt;dmhd);
05571 
05572     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05573 }
05574 <span class="preprocessor">#endif // RECVSIDE</span>
05575 <span class="preprocessor"></span>
05576 <span class="comment">/**************************************************************************\</span>
05577 <span class="comment">*</span>
05578 <span class="comment">*</span>
05579 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
05580 <span class="comment">\**************************************************************************/</span>
05581 
<a name="l05582"></a><a class="code" href="../../d4/d0/struct__CLIENTCHARTOWCHARMSG.html">05582</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d0/struct__CLIENTCHARTOWCHARMSG.html">_CLIENTCHARTOWCHARMSG</a> {
<a name="l05583"></a><a class="code" href="../../d4/d0/struct__CLIENTCHARTOWCHARMSG.html#o0">05583</a>     WORD <a class="code" href="../../d4/d0/struct__CLIENTCHARTOWCHARMSG.html#o0">CodePage</a>;
<a name="l05584"></a><a class="code" href="../../d4/d0/struct__CLIENTCHARTOWCHARMSG.html#o1">05584</a>     WORD <a class="code" href="../../d4/d0/struct__CLIENTCHARTOWCHARMSG.html#o1">wch</a>;
05585 } <a class="code" href="../../d4/d0/struct__CLIENTCHARTOWCHARMSG.html">CLIENTCHARTOWCHARMSG</a>;
05586 
05587 <span class="preprocessor">#ifdef SENDSIDE</span>
05588 <span class="preprocessor"></span>WCHAR <a class="code" href="../../d2/d4/tounicod_8c.html#a10">xxxClientCharToWchar</a>(
05589     IN WORD CodePage,
05590     IN WORD wch)
05591 {
05592     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTCHARTOWCHAR)
05593 
05594     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTCHARTOWCHAR)
05595 
05596         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;CodePage = CodePage;
05597         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wch = wch;
05598 
05599         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTCHARTOWCHAR);
05600         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05601 
05602     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientCharToWchar"</span>);
05603     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(WCHAR, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'_'</span>);
05604 }
05605 <span class="preprocessor">#endif // SENDSIDE</span>
05606 <span class="preprocessor"></span>
05607 <span class="preprocessor">#ifdef RECVSIDE</span>
05608 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientCharToWchar, <a class="code" href="../../d4/d0/struct__CLIENTCHARTOWCHARMSG.html">CLIENTCHARTOWCHARMSG</a>)
05609 {
05610     <span class="keywordtype">char</span> ach[2];
05611     WCHAR wch = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'_'</span>;
05612 
05613     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05614 
05615     ach[0] = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wch));
05616     ach[1] = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wch));
05617 
05618     MultiByteToWideChar(
05619             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(CodePage),                <span class="comment">// CP_THREAD_ACP, 437, 850 etc.</span>
05620             MB_PRECOMPOSED | MB_USEGLYPHCHARS, <span class="comment">// visual map to precomposed</span>
05621             ach, ach[1] ? 2 : 1,               <span class="comment">// source &amp; length</span>
05622             &amp;wch,                              <span class="comment">// destination</span>
05623             1);                                <span class="comment">// max poss. precomposed length</span>
05624 
05625     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)wch;
05626 
05627     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05628 }
05629 <span class="preprocessor">#endif // RECVSIDE</span>
05630 <span class="preprocessor"></span>
05631 <span class="comment">/**************************************************************************\</span>
05632 <span class="comment">*</span>
05633 <span class="comment">*</span>
05634 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
05635 <span class="comment">\**************************************************************************/</span>
05636 
<a name="l05637"></a><a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html">05637</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html">_CLIENTFINDMNEMCHARMSG</a> {
<a name="l05638"></a><a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html#o0">05638</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html#o0">CaptureBuf</a>;
<a name="l05639"></a><a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html#o1">05639</a>     UNICODE_STRING <a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html#o1">strSrc</a>;
<a name="l05640"></a><a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html#o2">05640</a>     WCHAR <a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html#o2">ch</a>;
<a name="l05641"></a><a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html#o3">05641</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html#o3">fFirst</a>;
<a name="l05642"></a><a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html#o4">05642</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html#o4">fPrefix</a>;
05643 } <a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html">CLIENTFINDMNEMCHARMSG</a>;
05644 
05645 <span class="preprocessor">#ifdef SENDSIDE</span>
05646 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="../../d0/d3/mnkey_8c.html#a2">xxxClientFindMnemChar</a>(
05647     IN PUNICODE_STRING pstrSrc,
05648     IN WCHAR ch,
05649     IN BOOL fFirst,
05650     IN BOOL fPrefix)
05651 {
05652     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTFINDMNEMCHAR)
05653 
05654     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(CLIENTFINDMNEMCHAR, 1, pstrSrc-&gt;MaximumLength, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
05655 
05656         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;ch = ch;
05657         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;fFirst = fFirst;
05658         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;fPrefix = fPrefix;
05659         <a class="code" href="../../d3/d5/ssend_8c.html#a42">COPYSTRING</a>(strSrc);
05660 
05661         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(CLIENTFINDMNEMCHAR);
05662         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05663 
05664     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientFindMnemChar"</span>);
05665     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>,0);
05666 }
05667 <span class="preprocessor">#endif // SENDSIDE</span>
05668 <span class="preprocessor"></span>
05669 <span class="preprocessor">#ifdef RECVSIDE</span>
05670 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientFindMnemChar, <a class="code" href="../../d2/d1/struct__CLIENTFINDMNEMCHARMSG.html">CLIENTFINDMNEMCHARMSG</a>)
05671 {
05672     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05673     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
05674 
05675     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a646">FindMnemChar</a>((LPWSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a19">FIXUPSTRING</a>(strSrc),
05676             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(ch), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(fFirst), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(fPrefix));
05677 
05678     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05679 }
05680 <span class="preprocessor">#endif // RECVSIDE</span>
05681 <span class="preprocessor"></span>
05682 <span class="comment">/**************************************************************************\</span>
05683 <span class="comment">* xxxClientPSMTextOut</span>
05684 <span class="comment">*</span>
05685 <span class="comment">* Called when a client-side LanguagePack (LPK) is installed</span>
05686 <span class="comment">*</span>
05687 <span class="comment">* 18-Sep-1996 GregoryW  Created</span>
05688 <span class="comment">* 11-Dec-1997 SamerA    Calling LPK with user-mode accessible DC</span>
05689 <span class="comment">\**************************************************************************/</span>
05690 
<a name="l05691"></a><a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html">05691</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html">_CLIENTPSMTEXTOUTMSG</a> {
<a name="l05692"></a><a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o0">05692</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o0">CaptureBuf</a>;
<a name="l05693"></a><a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o1">05693</a>     UNICODE_STRING strSrc;
<a name="l05694"></a><a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o2">05694</a>     HDC hdc;
<a name="l05695"></a><a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o3">05695</a>     <span class="keywordtype">int</span> <a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o3">xLeft</a>;
<a name="l05696"></a><a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o4">05696</a>     <span class="keywordtype">int</span> <a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o4">yTop</a>;
<a name="l05697"></a><a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o5">05697</a>     <span class="keywordtype">int</span> <a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o5">cch</a>;
<a name="l05698"></a><a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html#o6">05698</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
05699 } <a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html">CLIENTPSMTEXTOUTMSG</a>;
05700 
05701 <span class="preprocessor">#ifdef SENDSIDE</span>
05702 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="../../d4/d1/userk_8h.html#a1409">xxxClientPSMTextOut</a>(
05703     IN HDC hdc,
05704     IN <span class="keywordtype">int</span> xLeft,
05705     IN <span class="keywordtype">int</span> yTop,
05706     IN PUNICODE_STRING pstrSrc,
05707     IN <span class="keywordtype">int</span> cch,
05708     IN DWORD dwFlags)
05709 {
05710     <a class="code" href="../../d3/d5/ssend_8c.html#a7">SETUPDC</a>(CLIENTPSMTEXTOUT)
05711 
05712     <span class="comment">/*</span>
05713 <span class="comment">     * Make sure this routine is called when a client LanguagePack (LPK)</span>
05714 <span class="comment">     * is installed.</span>
05715 <span class="comment">     */</span>
05716     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(<a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>()));
05717 
05718     <a class="code" href="../../d3/d5/ssend_8c.html#a13">BEGINSENDCAPTUREVOIDDC</a>(CLIENTPSMTEXTOUT, 1, pstrSrc-&gt;MaximumLength, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
05719 
05720 #<span class="keywordflow">if</span> <a class="code" href="../../d0/d9/ntosdef_8h.html#a8">DBG</a>
05721     CheckPublicDC (<span class="stringliteral">"xxxClientPSMTextOut: Public DC passed to LPK. hdcUse=%lX"</span>, hdcUse);
05722 <span class="preprocessor">#endif</span>
05723 <span class="preprocessor"></span>
05724         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hdc = hdcUse;
05725         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xLeft = xLeft;
05726         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;yTop = yTop;
05727         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cch = cch;
05728         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;dwFlags = <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
05729         <a class="code" href="../../d3/d5/ssend_8c.html#a42">COPYSTRING</a>(strSrc);
05730 
05731         <a class="code" href="../../d3/d5/ssend_8c.html#a19">MAKECALLCAPTUREDC</a>(CLIENTPSMTEXTOUT);
05732 
05733         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05734 
05735     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientPSMTextOut"</span>);
05736     <a class="code" href="../../d3/d5/ssend_8c.html#a31">ENDSENDCAPTUREVOIDDC</a>();
05737 }
05738 <span class="preprocessor">#endif // SENDSIDE</span>
05739 <span class="preprocessor"></span>
05740 <span class="preprocessor">#ifdef RECVSIDE</span>
05741 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientPSMTextOut, <a class="code" href="../../d8/d2/struct__CLIENTPSMTEXTOUTMSG.html">CLIENTPSMTEXTOUTMSG</a>)
05742 {
05743     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05744     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
05745 
05746     <a class="code" href="../../d6/d0/usercli_8h.html#a425">PSMTextOut</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hdc), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xLeft), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(yTop),
05747         (LPWSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a19">FIXUPSTRING</a>(strSrc), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(cch), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(dwFlags));
05748 
05749     retval = 0;
05750     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05751 }
05752 <span class="preprocessor">#endif // RECVSIDE</span>
05753 <span class="preprocessor"></span>
05754 <span class="comment">/**************************************************************************\</span>
05755 <span class="comment">* xxxClientLpkDrawTextEx</span>
05756 <span class="comment">*</span>
05757 <span class="comment">* Called when a client-side LanguagePack (LPK) is installed</span>
05758 <span class="comment">*</span>
05759 <span class="comment">* 18-Sep-1996 GregoryW  Created</span>
05760 <span class="comment">* 11-Dec-1997 SamerA    Calling LPK with user-mode accessible DC</span>
05761 <span class="comment">\**************************************************************************/</span>
05762 
<a name="l05763"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html">05763</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html">_CLIENTLPKDRAWTEXTEXMSG</a> {
<a name="l05764"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o0">05764</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o0">CaptureBuf</a>;
<a name="l05765"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o1">05765</a>     UNICODE_STRING strSrc;
<a name="l05766"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o2">05766</a>     HDC hdc;
<a name="l05767"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o3">05767</a>     <span class="keywordtype">int</span> <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o3">xLeft</a>;
<a name="l05768"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o4">05768</a>     <span class="keywordtype">int</span> <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o4">yTop</a>;
<a name="l05769"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o5">05769</a>     <span class="keywordtype">int</span> <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o5">nCount</a>;
<a name="l05770"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o6">05770</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o6">fDraw</a>;
<a name="l05771"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o7">05771</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o7">wFormat</a>;
<a name="l05772"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o8">05772</a>     <a class="code" href="../../d2/d8/structDRAWTEXTDATA.html">DRAWTEXTDATA</a> <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o8">DrawInfo</a>;
<a name="l05773"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o9">05773</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o9">bAction</a>;
<a name="l05774"></a><a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o10">05774</a>     <span class="keywordtype">int</span> <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html#o10">iCharSet</a>;
05775 } <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html">CLIENTLPKDRAWTEXTEXMSG</a>;
05776 
05777 <span class="preprocessor">#ifdef SENDSIDE</span>
05778 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="../../d4/d1/userk_8h.html#a1410">xxxClientLpkDrawTextEx</a>(
05779     IN HDC hdc,
05780     IN <span class="keywordtype">int</span> xLeft,
05781     IN <span class="keywordtype">int</span> yTop,
05782     IN LPCWSTR lpsz,
05783     IN <span class="keywordtype">int</span> nCount,
05784     IN BOOL fDraw,
05785     IN UINT wFormat,
05786     IN <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1109">LPDRAWTEXTDATA</a> lpDrawInfo,
05787     IN UINT bAction,
05788     IN <span class="keywordtype">int</span> iCharSet)
05789 {
05790     <a class="code" href="../../d3/d5/ssend_8c.html#a7">SETUPDC</a>(CLIENTLPKDRAWTEXTEX)
05791     UNICODE_STRING strSrc;
05792     UNICODE_STRING *pstrSrc   = &amp;strSrc;
05793 
05794     <span class="comment">/*</span>
05795 <span class="comment">     * Make sure this routine is called when a client LanguagePack (LPK)</span>
05796 <span class="comment">     * is installed.</span>
05797 <span class="comment">     */</span>
05798     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(<a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>()));
05799 
05800 
05801     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(pstrSrc, lpsz);
05802 
05803     <a class="code" href="../../d3/d5/ssend_8c.html#a14">BEGINSENDCAPTUREDC</a>(CLIENTLPKDRAWTEXTEX, 1, pstrSrc-&gt;MaximumLength, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
05804 
05805 #<span class="keywordflow">if</span> <a class="code" href="../../d0/d9/ntosdef_8h.html#a8">DBG</a>
05806     CheckPublicDC (<span class="stringliteral">"xxxClientLpkDrawTextEx: Public DC passed to LPK. hdcUse=%lX"</span>, hdcUse);
05807 <span class="preprocessor">#endif</span>
05808 <span class="preprocessor"></span>
05809         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hdc = hdcUse;
05810         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xLeft = xLeft;
05811         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;yTop = yTop;
05812         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;nCount = nCount;
05813         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;fDraw = fDraw;
05814         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wFormat = wFormat;
05815         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;DrawInfo = *lpDrawInfo;
05816         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;bAction = bAction;
05817         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;iCharSet = iCharSet;
05818         <a class="code" href="../../d3/d5/ssend_8c.html#a42">COPYSTRING</a>(strSrc);
05819 
05820         <a class="code" href="../../d3/d5/ssend_8c.html#a19">MAKECALLCAPTUREDC</a>(CLIENTLPKDRAWTEXTEX);
05821 
05822         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05823 
05824     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientLpkDrawTextEx"</span>);
05825     <a class="code" href="../../d3/d5/ssend_8c.html#a26">ENDSENDCAPTUREDC</a>(<span class="keywordtype">int</span>, 0);
05826 }
05827 <span class="preprocessor">#endif // SENDSIDE</span>
05828 <span class="preprocessor"></span>
05829 <span class="preprocessor">#ifdef RECVSIDE</span>
05830 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientLpkDrawTextEx, <a class="code" href="../../d6/d2/struct__CLIENTLPKDRAWTEXTEXMSG.html">CLIENTLPKDRAWTEXTEXMSG</a>)
05831 {
05832     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05833     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
05834 
05835     retval = (*fpLpkDrawTextEx)(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hdc), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xLeft), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(yTop),
05836         (LPWSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a19">FIXUPSTRING</a>(strSrc), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(nCount), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(fDraw),
05837         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wFormat), <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(DrawInfo), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(bAction), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(iCharSet));
05838 
05839     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05840 }
05841 <span class="preprocessor">#endif // RECVSIDE</span>
05842 <span class="preprocessor"></span>
05843 <span class="comment">/**************************************************************************\</span>
05844 <span class="comment">* xxxClientExtTextOutW</span>
05845 <span class="comment">*</span>
05846 <span class="comment">* Called when a client-side LanguagePack (LPK) is installed</span>
05847 <span class="comment">*</span>
05848 <span class="comment">* 26-Jan-1997 GregoryW  Created</span>
05849 <span class="comment">* 11-Dec-1997 SamerA    Calling LPK with user-mode accessible DC</span>
05850 <span class="comment">\**************************************************************************/</span>
05851 
<a name="l05852"></a><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html">05852</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html">_CLIENTEXTTEXTOUTW</a> {
<a name="l05853"></a><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o0">05853</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o0">CaptureBuf</a>;
<a name="l05854"></a><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o1">05854</a>     UNICODE_STRING strSrc;
<a name="l05855"></a><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o2">05855</a>     HDC hdc;
<a name="l05856"></a><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o3">05856</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o3">x</a>;
<a name="l05857"></a><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o4">05857</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o4">y</a>;
<a name="l05858"></a><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o5">05858</a>     <span class="keywordtype">int</span> <a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o5">flOpts</a>;
<a name="l05859"></a><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o6">05859</a>     RECT <a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o6">rcl</a>;
<a name="l05860"></a><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o7">05860</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o7">cwc</a>;
<a name="l05861"></a><a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o8">05861</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html#o8">fNullRect</a>;
05862 } <a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html">CLIENTEXTTEXTOUTWMSG</a>;
05863 
05864 <span class="preprocessor">#ifdef SENDSIDE</span>
05865 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1411">xxxClientExtTextOutW</a>(
05866     IN HDC hdc,
05867     IN <span class="keywordtype">int</span> x,
05868     IN <span class="keywordtype">int</span> y,
05869     IN <span class="keywordtype">int</span> flOpts,
05870     IN RECT *prcl,
05871     IN LPCWSTR pwsz,
05872     IN UINT cwc,
05873     IN INT *pdx)
05874 {
05875     <a class="code" href="../../d3/d5/ssend_8c.html#a7">SETUPDC</a>(CLIENTEXTTEXTOUTW)
05876     UNICODE_STRING strSrc;
05877     UNICODE_STRING *pstrSrc = &amp;strSrc;
05878 
05879     <span class="comment">/*</span>
05880 <span class="comment">     * Make sure this routine is called when a client LanguagePack (LPK)</span>
05881 <span class="comment">     * is installed.</span>
05882 <span class="comment">     */</span>
05883     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(<a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>()));
05884 
05885 
05886     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(pstrSrc, pwsz);
05887 
05888     <a class="code" href="../../d3/d5/ssend_8c.html#a14">BEGINSENDCAPTUREDC</a>(CLIENTEXTTEXTOUTW, 1, pstrSrc-&gt;MaximumLength, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
05889 
05890 #<span class="keywordflow">if</span> <a class="code" href="../../d0/d9/ntosdef_8h.html#a8">DBG</a>
05891     CheckPublicDC (<span class="stringliteral">"xxxClientExtTextOutW: Public DC passed to LPK. hdcUse=%lX"</span>, hdcUse);
05892 <span class="preprocessor">#endif</span>
05893 <span class="preprocessor"></span>
05894         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hdc = hdcUse;
05895         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;x = x;
05896         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;y = y;
05897         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;flOpts = flOpts;
05898         <span class="comment">/* In order not to pass a NULL ptr */</span>
05899         <span class="keywordflow">if</span>( prcl ){
05900             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;rcl = *prcl;
05901             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;fNullRect=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05902         }
05903         <span class="keywordflow">else</span> {
05904             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;fNullRect=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05905         }
05906         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cwc = cwc;
05907         <a class="code" href="../../d3/d5/ssend_8c.html#a42">COPYSTRING</a>(strSrc);
05908 
05909         <a class="code" href="../../d3/d5/ssend_8c.html#a19">MAKECALLCAPTUREDC</a>(CLIENTEXTTEXTOUTW);
05910 
05911         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05912 
05913     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientExtTextOutW"</span>);
05914     <a class="code" href="../../d3/d5/ssend_8c.html#a26">ENDSENDCAPTUREDC</a>(BOOL, 0);
05915 
05916     UNREFERENCED_PARAMETER(pdx);
05917 }
05918 <span class="preprocessor">#endif // SENDSIDE</span>
05919 <span class="preprocessor"></span>
05920 <span class="preprocessor">#ifdef RECVSIDE</span>
05921 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientExtTextOutW, <a class="code" href="../../d1/d1/struct__CLIENTEXTTEXTOUTW.html">CLIENTEXTTEXTOUTWMSG</a>)
05922 {
05923     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
05924     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
05925 
05926     retval = ExtTextOutW(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hdc), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(x), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(y),
05927         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(flOpts), (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(fNullRect)) ? <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(rcl) : NULL , (LPWSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a19">FIXUPSTRING</a>(strSrc),
05928         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(cwc), NULL);
05929 
05930     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
05931 }
05932 <span class="preprocessor">#endif // RECVSIDE</span>
05933 <span class="preprocessor"></span>
05934 <span class="comment">/**************************************************************************\</span>
05935 <span class="comment">* xxxClientGetTextExtentPointW</span>
05936 <span class="comment">*</span>
05937 <span class="comment">* Called when a client-side LanguagePack (LPK) is installed</span>
05938 <span class="comment">*</span>
05939 <span class="comment">* 06-Feb-1997 GregoryW  Created</span>
05940 <span class="comment">* 19-Jan-1998 SamerA    EIP_ERROR if a public DC is passed other than hdcGray</span>
05941 <span class="comment">\**************************************************************************/</span>
05942 
<a name="l05943"></a><a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html">05943</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html">_CLIENTGETTEXTEXTENTPOINTW</a> {
<a name="l05944"></a><a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html#o0">05944</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html#o0">CaptureBuf</a>;
<a name="l05945"></a><a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html#o1">05945</a>     UNICODE_STRING strSrc;
<a name="l05946"></a><a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html#o2">05946</a>     HDC hdc;
<a name="l05947"></a><a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html#o3">05947</a>     <span class="keywordtype">int</span> <a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html#o3">cch</a>;
<a name="l05948"></a><a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html#o4">05948</a>     SIZE <a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html#o4">size</a>;
05949 } <a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html">CLIENTGETTEXTEXTENTPOINTWMSG</a>;
05950 
05951 <span class="preprocessor">#ifdef SENDSIDE</span>
05952 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1412">xxxClientGetTextExtentPointW</a>(
05953     IN HDC hdc,
05954     IN LPCWSTR lpstr,
05955     IN <span class="keywordtype">int</span> cch,
05956     OUT PSIZE psize)
05957 {
05958     <a class="code" href="../../d3/d5/ssend_8c.html#a7">SETUPDC</a>(CLIENTGETTEXTEXTENTPOINTW)
05959     UNICODE_STRING strSrc;
05960     UNICODE_STRING *pstrSrc = &amp;strSrc;
05961 
05962     <span class="comment">/*</span>
05963 <span class="comment">     * Make sure this routine is called when a client LanguagePack (LPK)</span>
05964 <span class="comment">     * is installed.</span>
05965 <span class="comment">     */</span>
05966     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(<a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>()));
05967 
05968     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(pstrSrc, lpstr);
05969 
05970     <a class="code" href="../../d3/d5/ssend_8c.html#a14">BEGINSENDCAPTUREDC</a>(CLIENTGETTEXTEXTENTPOINTW, 1, pstrSrc-&gt;MaximumLength, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
05971 
05972 #<span class="keywordflow">if</span> <a class="code" href="../../d0/d9/ntosdef_8h.html#a8">DBG</a>
05973     CheckPublicDC (<span class="stringliteral">"xxxGetTextExtentPointW: Public DC passed to LPK. hdcUse=%lX"</span>, hdcUse);
05974 <span class="preprocessor">#endif</span>
05975 <span class="preprocessor"></span>
05976         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hdc = hdcUse;
05977         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;cch = cch;
05978         <a class="code" href="../../d3/d5/ssend_8c.html#a42">COPYSTRING</a>(strSrc);
05979 
05980         <a class="code" href="../../d3/d5/ssend_8c.html#a19">MAKECALLCAPTUREDC</a>(CLIENTGETTEXTEXTENTPOINTW);
05981 
05982         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
05983 
05984         <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(psize, SIZE);
05985 
05986     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientGetTextExtentPointW"</span>);
05987     <a class="code" href="../../d3/d5/ssend_8c.html#a26">ENDSENDCAPTUREDC</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>, 0);
05988 
05989 }
05990 <span class="preprocessor">#endif // SENDSIDE</span>
05991 <span class="preprocessor"></span>
05992 <span class="preprocessor">#ifdef RECVSIDE</span>
05993 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientGetTextExtentPointW, <a class="code" href="../../d9/d1/struct__CLIENTGETTEXTEXTENTPOINTW.html">CLIENTGETTEXTEXTENTPOINTWMSG</a>)
05994 {
05995     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;pmsg-&gt;size, <span class="keyword">sizeof</span>(SIZE));
05996     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
05997 
05998     retval = GetTextExtentPointW(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hdc), (LPWSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a19">FIXUPSTRING</a>(strSrc),
05999         <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(cch), <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(size));
06000 
06001     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
06002 }
06003 <span class="preprocessor">#endif // RECVSIDE</span>
06004 <span class="preprocessor"></span>
06005 <span class="comment">/**************************************************************************\</span>
06006 <span class="comment">*</span>
06007 <span class="comment">*</span>
06008 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
06009 <span class="comment">\**************************************************************************/</span>
06010 
<a name="l06011"></a><a class="code" href="../../d2/d0/struct__CLIENTADDFONTRESOURCEWMSG.html">06011</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d0/struct__CLIENTADDFONTRESOURCEWMSG.html">_CLIENTADDFONTRESOURCEWMSG</a> {
<a name="l06012"></a><a class="code" href="../../d2/d0/struct__CLIENTADDFONTRESOURCEWMSG.html#o0">06012</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d2/d0/struct__CLIENTADDFONTRESOURCEWMSG.html#o0">CaptureBuf</a>;
<a name="l06013"></a><a class="code" href="../../d2/d0/struct__CLIENTADDFONTRESOURCEWMSG.html#o1">06013</a>     UNICODE_STRING strSrc;
<a name="l06014"></a><a class="code" href="../../d2/d0/struct__CLIENTADDFONTRESOURCEWMSG.html#o2">06014</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
<a name="l06015"></a><a class="code" href="../../d2/d0/struct__CLIENTADDFONTRESOURCEWMSG.html#o3">06015</a>     DESIGNVECTOR   <a class="code" href="../../d2/d0/struct__CLIENTADDFONTRESOURCEWMSG.html#o3">dv</a>;
06016 } <a class="code" href="../../d2/d0/struct__CLIENTADDFONTRESOURCEWMSG.html">CLIENTADDFONTRESOURCEWMSG</a>;
06017 
06018 <span class="preprocessor">#ifdef SENDSIDE</span>
06019 <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="../../d4/d1/userk_8h.html#a1010">xxxClientAddFontResourceW</a>(
06020     IN PUNICODE_STRING pstrSrc,
06021     IN DWORD dwFlags,
06022     IN DESIGNVECTOR *pdv)
06023 {
06024     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTADDFONTRESOURCEW)
06025 
06026     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(CLIENTADDFONTRESOURCEW, 1, pstrSrc-&gt;MaximumLength, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)
06027 
06028         <a class="code" href="../../d3/d5/ssend_8c.html#a42">COPYSTRING</a>(strSrc);
06029         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;dwFlags = <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
06030 
06031         <span class="keywordflow">if</span> (pdv &amp;&amp; pdv-&gt;dvNumAxes) {
06032             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;dv = *pdv;
06033         } <span class="keywordflow">else</span> {
06034             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;dv.dvNumAxes = 0;
06035         }
06036 
06037         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(CLIENTADDFONTRESOURCEW);
06038         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
06039 
06040     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientAddFontResourceW"</span>);
06041     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(<span class="keywordtype">int</span>,0);
06042 }
06043 <span class="preprocessor">#endif // SENDSIDE</span>
06044 <span class="preprocessor"></span>
06045 <span class="preprocessor">#ifdef RECVSIDE</span>
06046 <span class="preprocessor"></span>
06047 
06048 <a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientAddFontResourceW, <a class="code" href="../../d2/d0/struct__CLIENTADDFONTRESOURCEWMSG.html">CLIENTADDFONTRESOURCEWMSG</a>)
06049 {
06050     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> AddFont(LPWSTR, DWORD, DESIGNVECTOR*);
06051 
06052     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
06053     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
06054 
06055     retval = GdiAddFontResourceW((LPWSTR)<a class="code" href="../../d5/d8/crecv_8c.html#a19">FIXUPSTRING</a>(strSrc),
06056                                   <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(dwFlags), <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(dv).dvNumAxes ? &amp;<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(dv) : NULL);
06057 
06058     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
06059 }
06060 <span class="preprocessor">#endif // RECVSIDE</span>
06061 <span class="preprocessor"></span>
06062 
06063 
06064 <span class="comment">/******************************Public*Routine******************************\</span>
06065 <span class="comment">*</span>
06066 <span class="comment">* FontSweep()</span>
06067 <span class="comment">*</span>
06068 <span class="comment">* History:</span>
06069 <span class="comment">*  23-Oct-1995 -by- Bodin Dresevic [BodinD]</span>
06070 <span class="comment">* Wrote it.</span>
06071 <span class="comment">\**************************************************************************/</span>
06072 
06073 
06074 
06075 <span class="preprocessor">#ifdef SENDSIDE</span>
06076 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a1011">ClientFontSweep</a>(VOID)
06077 {
06078     PVOID p;
06079     ULONG cb;
06080 
06081     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
06082     <a class="code" href="../../d7/d4/ke_2ppc_2callback_8c.html#a0">KeUserModeCallback</a>(
06083         FI_CLIENTFONTSWEEP,
06084         NULL,
06085         0,
06086         &amp;p,
06087         &amp;cb);
06088     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
06089     <span class="keywordflow">return</span>;
06090 }
06091 <span class="preprocessor">#endif // SENDSIDE</span>
06092 <span class="preprocessor"></span>
06093 <span class="preprocessor">#ifdef RECVSIDE</span>
06094 <span class="preprocessor"></span>
06095 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> __ClientFontSweep(
06096     PVOID p)
06097 {
06098     UNREFERENCED_PARAMETER(p);
06099     <a class="code" href="../../d2/d6/fntsweep_8c.html#a29">vFontSweep</a>();
06100     <span class="keywordflow">return</span> NtCallbackReturn(NULL, 0, STATUS_SUCCESS);
06101 }
06102 <span class="preprocessor">#endif // RECVSIDE</span>
06103 <span class="preprocessor"></span>
06104 
06105 <span class="comment">/******************************Public*Routine******************************\</span>
06106 <span class="comment">*</span>
06107 <span class="comment">* VOID ClientLoadLocalT1Fonts(VOID)</span>
06108 <span class="comment">* very similar to above, only done for t1 fonts</span>
06109 <span class="comment">*</span>
06110 <span class="comment">* History:</span>
06111 <span class="comment">*  25-Apr-1996 -by- Bodin Dresevic [BodinD]</span>
06112 <span class="comment">* Wrote it.</span>
06113 <span class="comment">\**************************************************************************/</span>
06114 
06115 
06116 
06117 <span class="preprocessor">#ifdef SENDSIDE</span>
06118 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a1012">ClientLoadLocalT1Fonts</a>(VOID)
06119 {
06120     PVOID p;
06121     ULONG cb;
06122 
06123     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
06124     <a class="code" href="../../d7/d4/ke_2ppc_2callback_8c.html#a0">KeUserModeCallback</a>(
06125         FI_CLIENTLOADLOCALT1FONTS,
06126         NULL,
06127         0,
06128         &amp;p,
06129         &amp;cb);
06130     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
06131     <span class="keywordflow">return</span>;
06132 }
06133 <span class="preprocessor">#endif // SENDSIDE</span>
06134 <span class="preprocessor"></span>
06135 <span class="preprocessor">#ifdef RECVSIDE</span>
06136 <span class="preprocessor"></span>
06137 
06138 
06139 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> __ClientLoadLocalT1Fonts(
06140     PVOID p)
06141 {
06142     UNREFERENCED_PARAMETER(p);
06143     <a class="code" href="../../d2/d6/fntsweep_8c.html#a31">vLoadLocalT1Fonts</a>();
06144     <span class="keywordflow">return</span> NtCallbackReturn(NULL, 0, STATUS_SUCCESS);
06145 }
06146 <span class="preprocessor">#endif // RECVSIDE</span>
06147 <span class="preprocessor"></span>
06148 
06149 
06150 <span class="comment">/******************************Public*Routine******************************\</span>
06151 <span class="comment">*</span>
06152 <span class="comment">* VOID ClientLoadRemoteT1Fonts(VOID)</span>
06153 <span class="comment">* very similar to above, only done for t1 fonts</span>
06154 <span class="comment">*</span>
06155 <span class="comment">* History:</span>
06156 <span class="comment">*  25-Apr-1996 -by- Bodin Dresevic [BodinD]</span>
06157 <span class="comment">* Wrote it.</span>
06158 <span class="comment">\**************************************************************************/</span>
06159 
06160 
06161 
06162 <span class="preprocessor">#ifdef SENDSIDE</span>
06163 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a1013">ClientLoadRemoteT1Fonts</a>(VOID)
06164 {
06165     PVOID p;
06166     ULONG cb;
06167 
06168     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
06169     <a class="code" href="../../d7/d4/ke_2ppc_2callback_8c.html#a0">KeUserModeCallback</a>(
06170         FI_CLIENTLOADREMOTET1FONTS,
06171         NULL,
06172         0,
06173         &amp;p,
06174         &amp;cb);
06175     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
06176     <span class="keywordflow">return</span>;
06177 }
06178 <span class="preprocessor">#endif // SENDSIDE</span>
06179 <span class="preprocessor"></span>
06180 <span class="preprocessor">#ifdef RECVSIDE</span>
06181 <span class="preprocessor"></span>
06182 
06183 
06184 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> __ClientLoadRemoteT1Fonts(
06185     PVOID p)
06186 {
06187     UNREFERENCED_PARAMETER(p);
06188     <a class="code" href="../../d2/d6/fntsweep_8c.html#a32">vLoadRemoteT1Fonts</a>();
06189     <span class="keywordflow">return</span> NtCallbackReturn(NULL, 0, STATUS_SUCCESS);
06190 }
06191 <span class="preprocessor">#endif // RECVSIDE</span>
06192 <span class="preprocessor"></span>
06193 <span class="comment">/**************************************************************************\</span>
06194 <span class="comment">* pppUserModeCallback</span>
06195 <span class="comment">*</span>
06196 <span class="comment">* Same as xxxUserModeCallback except not leaving/re-entering critical section</span>
06197 <span class="comment">*</span>
06198 <span class="comment">* 12/9/97 LingyunW     Copied from xxxUserModeCallback</span>
06199 <span class="comment">\**************************************************************************/</span>
06200 <span class="preprocessor">#ifdef SENDSIDE</span>
06201 <span class="preprocessor"></span><a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> pppUserModeCallback (ULONG uApi, PVOID pIn, ULONG cbIn, PVOID pOut, ULONG cbOut)
06202 {
06203     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
06204     PVOID pLocalOut;
06205     ULONG cbLocalOut;
06206 
06207     <span class="comment">/*</span>
06208 <span class="comment">     * Call the client</span>
06209 <span class="comment">     */</span>
06210     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d4/ke_2ppc_2callback_8c.html#a0">KeUserModeCallback</a>(uApi, pIn, cbIn, &amp;pLocalOut, &amp;cbLocalOut);
06211 
06212     <span class="comment">/*</span>
06213 <span class="comment">     * If it failed, bail</span>
06214 <span class="comment">     */</span>
06215     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
06216         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
06217     }
06218 
06219     <span class="comment">/*</span>
06220 <span class="comment">     * If we didn't get the right amount of data, fail.</span>
06221 <span class="comment">     */</span>
06222     <span class="keywordflow">if</span> (cbLocalOut != cbOut) {
06223         RIPMSG3(RIP_WARNING, <span class="stringliteral">"pppUserModeCallback: uAPi: %#lx cbOut: %#lx cbLocalOut: %#lx"</span>,
06224                 uApi, cbOut, cbLocalOut);
06225         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
06226     }
06227 
06228     <span class="comment">/*</span>
06229 <span class="comment">     * If we were expecting some data, copy it.</span>
06230 <span class="comment">     */</span>
06231     <span class="keywordflow">if</span> (cbOut != 0) {
06232         <span class="keywordflow">try</span> {
06233             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(pLocalOut, cbLocalOut, <span class="keyword">sizeof</span>(DWORD));
06234             RtlCopyMemory(pOut, pLocalOut, cbLocalOut);
06235         } except (W32ExceptionHandler(FALSE, RIP_WARNING)) {
06236             RIPMSG2(RIP_WARNING, <span class="stringliteral">"pppUserModeCallback: uAPi: %#lx Exception: %#lx"</span>, uApi, GetExceptionCode());
06237             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
06238         }
06239     }
06240 
06241     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
06242 }
06243 <span class="preprocessor">#endif // SENDSIDE</span>
06244 <span class="preprocessor"></span>
06245 <span class="comment">/******************************Public*Routine******************************\</span>
06246 <span class="comment">* ClientPrinterThunk</span>
06247 <span class="comment">*</span>
06248 <span class="comment">* Callback used as the kernel-to-user transport layer.</span>
06249 <span class="comment">*</span>
06250 <span class="comment">* Note: User critical section is not held by the caller.</span>
06251 <span class="comment">*</span>
06252 <span class="comment">* History:</span>
06253 <span class="comment">*  22-Jun-1997 -by- Gilman Wong [gilmanw]</span>
06254 <span class="comment">*  11/13/97 -by- Lingyun Wang [lingyunw] clean up</span>
06255 <span class="comment">*</span>
06256 <span class="comment">* Wrote it.</span>
06257 <span class="comment">\**************************************************************************/</span>
06258 
<a name="l06259"></a><a class="code" href="../../d9/d7/ntcb_8h.html#a0">06259</a> <span class="preprocessor">#define CLIENTPRINTERTHUNKMSG UMTHDR</span>
06260 <span class="preprocessor"></span>
06261 <span class="preprocessor">#ifdef SENDSIDE</span>
06262 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ClientPrinterThunk(PVOID pvIn, ULONG cjIn, PVOID pvOut, ULONG cjOut)
06263 {
06264     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
06265 
06266     <span class="comment">/*</span>
06267 <span class="comment">     * (Temporarly..) we return failure if we are holding USERK's crit section</span>
06268 <span class="comment">     */</span>
06269     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/ex_8h.html#a281">ExIsResourceAcquiredExclusiveLite</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a278">gpresUser</a>)
06270             || (<a class="code" href="../../d5/d8/ex_8h.html#a282">ExIsResourceAcquiredSharedLite</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a278">gpresUser</a>) != 0)) {
06271         RIPMSG0(RIP_ERROR, <span class="stringliteral">"ClientPrinterThunk: Holding USERK critical section!"</span>);
06272         <span class="keywordflow">return</span> 0xffffffff;
06273     }
06274 
06275     <span class="comment">/*</span>
06276 <span class="comment">     * The pvIn buffer must have at least a CLIENTPRINTERTHUNK header.</span>
06277 <span class="comment">     */</span>
06278     UserAssertMsg1(cjIn &gt;= <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/ntcb_8h.html#a0">CLIENTPRINTERTHUNKMSG</a>), <span class="stringliteral">"ClientPrinterThunk: incorrect cjIn:%#lx"</span>, cjIn);
06279 
06280     <span class="comment">/*</span>
06281 <span class="comment">     * Set the private cjOut.  The receive-side uses this to allocate</span>
06282 <span class="comment">     *  a return buffer.</span>
06283 <span class="comment">     */</span>
06284     ((<a class="code" href="../../d9/d7/ntcb_8h.html#a0">CLIENTPRINTERTHUNKMSG</a> *) pvIn)-&gt;ulReserved1      = cjOut;
06285     ((<a class="code" href="../../d9/d7/ntcb_8h.html#a0">CLIENTPRINTERTHUNKMSG</a> *) pvIn)-&gt;ulReserved2 = 0;
06286 
06287 
06288     <span class="comment">/*</span>
06289 <span class="comment">     * Do the callback.</span>
06290 <span class="comment">     */</span>
06291     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = pppUserModeCallback(FI_CLIENTPRINTERTHUNK, pvIn, cjIn, pvOut, cjOut);
06292 
06293     <span class="keywordflow">return</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) ? 0 : 0xFFFFFFFF);
06294 }
06295 <span class="preprocessor">#endif // SENDSIDE</span>
06296 <span class="preprocessor"></span>
06297 <span class="preprocessor">#ifdef RECVSIDE</span>
06298 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> __ClientPrinterThunk(CLIENTPRINTERTHUNKMSG *pMsg)
06299 {
06300     PVOID pv;
06301     ULONG aul[526];
06302     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
06303 
06304     <span class="comment">/*</span>
06305 <span class="comment">     * Check that the local buffer is big enough.</span>
06306 <span class="comment">     */</span>
06307     <span class="keywordflow">if</span> (pMsg-&gt;ulReserved1 &lt;= <span class="keyword">sizeof</span>(aul)) {
06308         pv = (PVOID) aul;
06309         <span class="comment">/*</span>
06310 <span class="comment">         * Call GDI to process command.</span>
06311 <span class="comment">         */</span>
06312         <span class="keywordflow">if</span> (GdiPrinterThunk((UMTHDR *) pMsg, pv, pMsg-&gt;ulReserved1) != GPT_ERROR) {
06313             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
06314         } <span class="keywordflow">else</span> {
06315             RIPMSG0(RIP_WARNING, <span class="stringliteral">"ClientPrinterThunk failed"</span>);
06316             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
06317         }
06318     } <span class="keywordflow">else</span> {
06319         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ClientPrinterThunk: buffer too big!"</span>);
06320         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
06321     }
06322 
06323 
06324     <span class="comment">/*</span>
06325 <span class="comment">     * Return to kernel.</span>
06326 <span class="comment">     */</span>
06327     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
06328         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a283">UserCallbackReturn</a>(pv, pMsg-&gt;ulReserved1, Status);
06329     } <span class="keywordflow">else</span> {
06330         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a283">UserCallbackReturn</a>(NULL, 0, Status);
06331     }
06332 }
06333 <span class="preprocessor">#endif // RECVSIDE</span>
06334 <span class="preprocessor"></span>
06335 <span class="comment">/**************************************************************************\</span>
06336 <span class="comment">*</span>
06337 <span class="comment">*</span>
06338 <span class="comment">* 22-Jul-1991 mikeke    Created</span>
06339 <span class="comment">\**************************************************************************/</span>
06340 
06341 <span class="preprocessor">#ifdef SENDSIDE</span>
06342 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a1926">ClientNoMemoryPopup</a>(VOID)
06343 {
06344     PVOID p;
06345     ULONG cb;
06346 
06347     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
06348     <a class="code" href="../../d7/d4/ke_2ppc_2callback_8c.html#a0">KeUserModeCallback</a>(
06349         FI_CLIENTNOMEMORYPOPUP,
06350         NULL,
06351         0,
06352         &amp;p,
06353         &amp;cb);
06354     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
06355     <span class="keywordflow">return</span>;
06356 }
06357 <span class="preprocessor">#endif // SENDSIDE</span>
06358 <span class="preprocessor"></span>
06359 <span class="preprocessor">#ifdef RECVSIDE</span>
06360 <span class="preprocessor"></span>
06361 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> __ClientNoMemoryPopup(
06362     PVOID p)
06363 {
06364     WCHAR szNoMem[200];
06365 
06366     UNREFERENCED_PARAMETER(p);
06367 
06368     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/clres_8c.html#a42">LoadStringW</a>(hmodUser, STR_NOMEMBITMAP, szNoMem,
06369             <span class="keyword">sizeof</span>(szNoMem) / <span class="keyword">sizeof</span>(WCHAR))) {
06370         <a class="code" href="../../d6/d4/msgbox_8c.html#a23">MessageBoxW</a>(<a class="code" href="../../d3/d8/winmgrc_8c.html#a22">GetActiveWindow</a>(), szNoMem, NULL, MB_OK);
06371     }
06372 
06373     <span class="keywordflow">return</span> NtCallbackReturn(NULL, 0, STATUS_SUCCESS);
06374 }
06375 <span class="preprocessor">#endif // RECVSIDE</span>
06376 <span class="preprocessor"></span>
06377 <span class="comment">/**************************************************************************\</span>
06378 <span class="comment">* ClientThreadSetup</span>
06379 <span class="comment">*</span>
06380 <span class="comment">* Callback to the client to perform thread initialization.</span>
06381 <span class="comment">*</span>
06382 <span class="comment">* 04-07-95 JimA         Created.</span>
06383 <span class="comment">\**************************************************************************/</span>
06384 
06385 <span class="preprocessor">#ifdef SENDSIDE</span>
06386 <span class="preprocessor"></span><a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d4/d1/userk_8h.html#a1927">ClientThreadSetup</a>(VOID)
06387 {
06388     PVOID p;
06389     ULONG cb;
06390     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
06391 
06392     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
06393     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d4/ke_2ppc_2callback_8c.html#a0">KeUserModeCallback</a>(
06394         FI_CLIENTTHREADSETUP,
06395         NULL,
06396         0,
06397         &amp;p,
06398         &amp;cb);
06399     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
06400     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
06401 }
06402 <span class="preprocessor">#endif // SENDSIDE</span>
06403 <span class="preprocessor"></span>
06404 <span class="preprocessor">#ifdef RECVSIDE</span>
06405 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> __ClientThreadSetup(
06406     PVOID p)
06407 {
06408     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSuccess;
06409     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1927">ClientThreadSetup</a>(VOID);
06410 
06411     UNREFERENCED_PARAMETER(p);
06412 
06413     fSuccess = <a class="code" href="../../d4/d1/userk_8h.html#a1927">ClientThreadSetup</a>();
06414     <span class="keywordflow">return</span> NtCallbackReturn(NULL, 0,
06415             fSuccess ? STATUS_SUCCESS : STATUS_UNSUCCESSFUL);
06416 }
06417 <span class="preprocessor">#endif // RECVSIDE</span>
06418 <span class="preprocessor"></span>
06419 <span class="comment">/**************************************************************************\</span>
06420 <span class="comment">* ClientDeliverUserApc</span>
06421 <span class="comment">*</span>
06422 <span class="comment">* Callback to the client to handle a user APC.  This is needed to</span>
06423 <span class="comment">* ensure that a thread will exit promptly when terminated.</span>
06424 <span class="comment">*</span>
06425 <span class="comment">* 08-12-95 JimA         Created.</span>
06426 <span class="comment">\**************************************************************************/</span>
06427 
06428 <span class="preprocessor">#ifdef SENDSIDE</span>
06429 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a1928">ClientDeliverUserApc</a>(VOID)
06430 {
06431     PVOID p;
06432     ULONG cb;
06433 
06434     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
06435     <a class="code" href="../../d7/d4/ke_2ppc_2callback_8c.html#a0">KeUserModeCallback</a>(
06436         FI_CLIENTDELIVERUSERAPC,
06437         NULL,
06438         0,
06439         &amp;p,
06440         &amp;cb);
06441     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
06442 }
06443 <span class="preprocessor">#endif // SENDSIDE</span>
06444 <span class="preprocessor"></span>
06445 <span class="preprocessor">#ifdef RECVSIDE</span>
06446 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> __ClientDeliverUserApc(
06447     PVOID p)
06448 {
06449     UNREFERENCED_PARAMETER(p);
06450     <span class="keywordflow">return</span> NtCallbackReturn(NULL, 0, STATUS_SUCCESS);
06451 }
06452 <span class="preprocessor">#endif // RECVSIDE</span>
06453 <span class="preprocessor"></span>
06454 
06455 <span class="comment">/**************************************************************************\</span>
06456 <span class="comment">* ClientImmLoadLayout</span>
06457 <span class="comment">*</span>
06458 <span class="comment">* 29-Jan-1996 wkwok   Created</span>
06459 <span class="comment">\**************************************************************************/</span>
06460 
<a name="l06461"></a><a class="code" href="../../d0/d2/struct__CLIENTIMMLOADLAYOUTMSG.html">06461</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d2/struct__CLIENTIMMLOADLAYOUTMSG.html">_CLIENTIMMLOADLAYOUTMSG</a> {
<a name="l06462"></a><a class="code" href="../../d0/d2/struct__CLIENTIMMLOADLAYOUTMSG.html#o0">06462</a>     HKL <a class="code" href="../../d0/d2/struct__CLIENTIMMLOADLAYOUTMSG.html#o0">hKL</a>;
06463 } <a class="code" href="../../d0/d2/struct__CLIENTIMMLOADLAYOUTMSG.html">CLIENTIMMLOADLAYOUTMSG</a>;
06464 
06465 <span class="preprocessor">#ifdef SENDSIDE</span>
06466 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1929">ClientImmLoadLayout</a>(
06467     IN HKL hKL,
06468     OUT <a class="code" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a> piiex)
06469 {
06470     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTIMMLOADLAYOUT)
06471 
06472     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTIMMLOADLAYOUT)
06473 
06474         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hKL = hKL;
06475 
06476         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTIMMLOADLAYOUT);
06477         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
06478 
06479         <span class="keywordflow">if</span> (retval)
06480             <a class="code" href="../../d3/d5/ssend_8c.html#a54">OUTSTRUCT</a>(piiex, <a class="code" href="../../d0/d8/structtagIMEINFOEX.html">IMEINFOEX</a>);
06481 
06482     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientImmLoadLayout"</span>);
06483     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>, 0);
06484 }
06485 <span class="preprocessor">#endif // SENDSIDE</span>
06486 <span class="preprocessor"></span>
06487 <span class="preprocessor">#ifdef RECVSIDE</span>
06488 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientImmLoadLayout, <a class="code" href="../../d0/d2/struct__CLIENTIMMLOADLAYOUTMSG.html">CLIENTIMMLOADLAYOUTMSG</a>)
06489 {
06490     <a class="code" href="../../d0/d8/structtagIMEINFOEX.html">IMEINFOEX</a> iiex;
06491 
06492     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;iiex, <span class="keyword">sizeof</span>(iiex));
06493 
06494     retval = <a class="code" href="../../d6/d0/usercli_8h.html#a339">fpImmLoadLayout</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hKL), &amp;iiex);
06495 
06496     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
06497 }
06498 <span class="preprocessor">#endif // RECVSIDE</span>
06499 <span class="preprocessor"></span>
06500 <span class="comment">/**************************************************************************\</span>
06501 <span class="comment">* ClientImmProcessKey</span>
06502 <span class="comment">*</span>
06503 <span class="comment">* 03-Mar-1996 TakaoK   Created</span>
06504 <span class="comment">\**************************************************************************/</span>
06505 
<a name="l06506"></a><a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html">06506</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html">_CLIENTIMMPROCESSKEYMSG</a> {
<a name="l06507"></a><a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html#o0">06507</a>     HWND <a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html#o0">hWnd</a>;
<a name="l06508"></a><a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html#o1">06508</a>     HKL  <a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html#o1">hkl</a>;
<a name="l06509"></a><a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html#o2">06509</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html#o2">uVKey</a>;
<a name="l06510"></a><a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html#o3">06510</a>     LPARAM lParam;
<a name="l06511"></a><a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html#o4">06511</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html#o4">dwHotKeyID</a>;
06512 } <a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html">CLIENTIMMPROCESSKEYMSG</a>;
06513 
06514 <span class="preprocessor">#ifdef SENDSIDE</span>
06515 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d4/d1/userk_8h.html#a1930">ClientImmProcessKey</a>(
06516     IN HWND hWnd,
06517     IN HKL  hkl,
06518     IN UINT uVKey,
06519     IN LPARAM lParam,
06520     IN DWORD dwHotKeyID)
06521 {
06522     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTIMMPROCESSKEY)
06523 
06524     UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>());
06525 
06526     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTIMMPROCESSKEY)
06527 
06528         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hWnd = <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>,
06529         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hkl = hkl;
06530         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;uVKey = uVKey;
06531         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = lParam;
06532         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;dwHotKeyID = dwHotKeyID;
06533 
06534         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTIMMPROCESSKEY);
06535         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
06536 
06537     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"ClientImmProcessKey"</span>);
06538     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, 0);
06539 }
06540 <span class="preprocessor">#endif // SENDSIDE</span>
06541 <span class="preprocessor"></span>
06542 <span class="preprocessor">#ifdef RECVSIDE</span>
06543 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientImmProcessKey, <a class="code" href="../../d1/d2/struct__CLIENTIMMPROCESSKEYMSG.html">CLIENTIMMPROCESSKEYMSG</a>)
06544 {
06545     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
06546 
06547     retval = <a class="code" href="../../d6/d0/usercli_8h.html#a340">fpImmProcessKey</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hWnd),
06548                 <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hkl),
06549                 <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(uVKey),
06550                 <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(lParam),
06551                 <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(dwHotKeyID));
06552 
06553     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
06554 }
06555 <span class="preprocessor">#endif // RECVSIDE</span>
06556 <span class="preprocessor"></span>
06557 <span class="comment">/**************************************************************************\</span>
06558 <span class="comment">* fnIMECONTROL</span>
06559 <span class="comment">*</span>
06560 <span class="comment">* 22-Apr-1996 wkwok    Created</span>
06561 <span class="comment">\**************************************************************************/</span>
06562 
<a name="l06563"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html">06563</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html">_FNIMECONTROL</a> {
<a name="l06564"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o0">06564</a>     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> <a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o0">CaptureBuf</a>;
<a name="l06565"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o1">06565</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
<a name="l06566"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o2">06566</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l06567"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o3">06567</a>     WPARAM wParam;
06568     <span class="keyword">union </span>{
<a name="l06569"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o4">06569</a>         PCANDIDATEFORM <a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o4">pCandForm</a>;
<a name="l06570"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o5">06570</a>         PCOMPOSITIONFORM <a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o5">pCompForm</a>;
<a name="l06571"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o6">06571</a>         PLOGFONTA <a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o6">pLogFontA</a>;
<a name="l06572"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o7">06572</a>         PLOGFONTW <a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o7">pLogFontW</a>;
<a name="l06573"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o8">06573</a>         PSOFTKBDDATA <a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o8">pSoftKbdData</a>;
<a name="l06574"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o9">06574</a>         LPARAM lParam;
06575     } u;
<a name="l06576"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o11">06576</a>     ULONG_PTR xParam;
<a name="l06577"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o12">06577</a>     PROC xpfnProc;
<a name="l06578"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o13">06578</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> <a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o13">pOutput</a>;
<a name="l06579"></a><a class="code" href="../../d8/d4/struct__FNIMECONTROL.html#o14">06579</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOutput;
06580 } <a class="code" href="../../d8/d4/struct__FNIMECONTROL.html">FNIMECONTROLMSG</a>;
06581 
06582 <span class="preprocessor">#ifdef SENDSIDE</span>
06583 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a637">CopyLogFontAtoW</a>(
06584     PLOGFONTW pdest,
06585     PLOGFONTA psrc)
06586 {
06587     LPSTR lpstrFont = (LPSTR)(&amp;psrc-&gt;lfFaceName);
06588     LPWSTR lpstrFontW = (LPWSTR)(&amp;pdest-&gt;lfFaceName);
06589 
06590     memcpy((LPBYTE)pdest, psrc, <span class="keyword">sizeof</span>(LOGFONTA) - LF_FACESIZE);
06591     memset(pdest-&gt;lfFaceName, 0, LF_FACESIZE * <span class="keyword">sizeof</span>(WCHAR));
06592     MBToWCS(lpstrFont, -1, &amp;lpstrFontW, LF_FACESIZE, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
06593 }
06594 
06595 <a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(IMECONTROL)
06596 {
06597     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cCapture, cbCapture;
06598 
06599     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNIMECONTROL)
06600 
06601     switch (wParam) {
06602         <span class="keywordflow">case</span> IMC_GETCANDIDATEPOS:
06603         <span class="keywordflow">case</span> IMC_SETCANDIDATEPOS:
06604             cCapture  = 1;
06605             cbCapture = <span class="keyword">sizeof</span>(CANDIDATEFORM);
06606             <span class="keywordflow">break</span>;
06607 
06608         <span class="keywordflow">case</span> IMC_GETCOMPOSITIONWINDOW:
06609         <span class="keywordflow">case</span> IMC_SETCOMPOSITIONWINDOW:
06610             cCapture  = 1;
06611             cbCapture = <span class="keyword">sizeof</span>(COMPOSITIONFORM);
06612             <span class="keywordflow">break</span>;
06613 
06614         <span class="keywordflow">case</span> IMC_GETCOMPOSITIONFONT:
06615         <span class="keywordflow">case</span> IMC_SETCOMPOSITIONFONT:
06616         <span class="keywordflow">case</span> IMC_GETSOFTKBDFONT:
06617             cCapture  = 1;
06618             cbCapture = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>)
06619                       ? <span class="keyword">sizeof</span>(LOGFONTA) : <span class="keyword">sizeof</span>(LOGFONTW) ;
06620             <span class="keywordflow">break</span>;
06621 
06622         <span class="keywordflow">case</span> IMC_SETSOFTKBDDATA:
06623             cCapture  = 1;
06624             cbCapture = FIELD_OFFSET(SOFTKBDDATA, wCode[0])
06625                       + ((PSOFTKBDDATA)lParam)-&gt;uCount * <span class="keyword">sizeof</span>(WORD) * 256;
06626 
06627             <span class="keywordflow">break</span>;
06628 
06629         <span class="keywordflow">default</span>:
06630             cCapture  = 0;
06631             cbCapture = 0;
06632             <span class="keywordflow">break</span>;
06633     }
06634 
06635     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNIMECONTROL, cCapture, cbCapture, TRUE);
06636 
06637         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd     = pwndClient;
06638         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg      = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
06639         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam   = wParam;
06640         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;u.lParam = lParam;
06641         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam   = xParam;
06642         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
06643 
06644         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
06645 
06646         <span class="keywordflow">switch</span> (wParam) {
06647 
06648         <span class="keywordflow">case</span> IMC_GETCANDIDATEPOS:
06649         <span class="keywordflow">case</span> IMC_GETCOMPOSITIONWINDOW:
06650         <span class="keywordflow">case</span> IMC_GETCOMPOSITIONFONT:
06651         <span class="keywordflow">case</span> IMC_GETSOFTKBDFONT:
06652 
06653             <a class="code" href="../../d3/d5/ssend_8c.html#a57">RESERVEBYTES</a>(cbCapture, pOutput, cbOutput);
06654             <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNIMECONTROL);
06655             <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
06656             <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
06657 
06658             <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
06659                 try {
06660                     <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput, <a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;cbOutput, <span class="keyword">sizeof</span>(DWORD));
06661                     <span class="keywordflow">switch</span> (wParam) {
06662                     <span class="keywordflow">case</span> IMC_GETCANDIDATEPOS:
06663                     <span class="keywordflow">case</span> IMC_GETCOMPOSITIONWINDOW:
06664                         memcpy((LPBYTE)lParam, <a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput, cbCapture);
06665                         <span class="keywordflow">break</span>;
06666 
06667                     <span class="keywordflow">case</span> IMC_GETCOMPOSITIONFONT:
06668                     <span class="keywordflow">case</span> IMC_GETSOFTKBDFONT:
06669                         <span class="keywordflow">if</span> (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>) {
06670                             <a class="code" href="../../d6/d0/usercli_8h.html#a637">CopyLogFontAtoW</a>((PLOGFONTW)lParam, (PLOGFONTA)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput);
06671                         }
06672                         <span class="keywordflow">else</span> {
06673                             memcpy((LPBYTE)lParam, <a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput, cbCapture);
06674                         }
06675                         <span class="keywordflow">break</span>;
06676                     }
06677                 } except (W32ExceptionHandler(TRUE, RIP_WARNING)) {
06678                     <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
06679                 }
06680             <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
06681 
06682             break;
06683 
06684         case IMC_SETCANDIDATEPOS:
06685         case IMC_SETCOMPOSITIONWINDOW:
06686         case IMC_SETCOMPOSITIONFONT:
06687         case IMC_SETSOFTKBDDATA:
06688             if (wParam == IMC_SETCANDIDATEPOS) {
06689                 PCANDIDATEFORM pCandForm = (PCANDIDATEFORM)lParam;
06690                 <a class="code" href="../../d3/d5/ssend_8c.html#a41">LARGECOPYBYTES2</a>(pCandForm, <span class="keyword">sizeof</span>(CANDIDATEFORM), u.pCandForm);
06691             }
06692             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == IMC_SETCOMPOSITIONWINDOW) {
06693                 PCOMPOSITIONFORM pCompForm = (PCOMPOSITIONFORM)lParam;
06694                 <a class="code" href="../../d3/d5/ssend_8c.html#a41">LARGECOPYBYTES2</a>(pCompForm, <span class="keyword">sizeof</span>(COMPOSITIONFORM), u.pCompForm);
06695             }
06696             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == IMC_SETCOMPOSITIONFONT) {
06697                 <span class="keywordflow">if</span> (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>) {
06698                     LOGFONTA LogFontA;
06699                     LPSTR  lpstrFontA = LogFontA.lfFaceName;
06700                     LPWSTR lpstrFontW = ((PLOGFONTW)lParam)-&gt;lfFaceName;
06701 
06702                     memcpy(&amp;LogFontA, (PBYTE)lParam, <span class="keyword">sizeof</span>(LOGFONTA)-LF_FACESIZE);
06703                     memset(lpstrFontA, 0, LF_FACESIZE * <span class="keyword">sizeof</span>(CHAR));
06704                     WCSToMB(lpstrFontW, -1, &amp;lpstrFontA, LF_FACESIZE, FALSE);
06705                     <a class="code" href="../../d3/d5/ssend_8c.html#a41">LARGECOPYBYTES2</a>(&amp;LogFontA, <span class="keyword">sizeof</span>(LOGFONTA), u.pLogFontA);
06706                 }
06707                 <span class="keywordflow">else</span> {
06708                     PLOGFONTW pLogFontW = (PLOGFONTW)lParam;
06709                     <a class="code" href="../../d3/d5/ssend_8c.html#a41">LARGECOPYBYTES2</a>(pLogFontW, <span class="keyword">sizeof</span>(LOGFONTW), u.pLogFontW);
06710                 }
06711             }
06712             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wParam == IMC_SETSOFTKBDDATA) {
06713                 PSOFTKBDDATA pSoftKbdData;
06714 
06715                 <span class="keywordflow">if</span> (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>) {
06716                     PWORD pCodeA;
06717                     PWSTR pCodeW;
06718                     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>  ch[2];
06719                     PSTR  pch = (PSTR)&amp;ch;
06720                     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  i;
06721 
06722                     pSoftKbdData = (PSOFTKBDDATA)UserAllocPool(cbCapture, TAG_IME);
06723                     <span class="keywordflow">if</span> (pSoftKbdData == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
06724                         <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
06725 
06726                     pCodeA = &amp;pSoftKbdData-&gt;wCode[0][0];
06727                     pCodeW = (PWSTR)&amp;((PSOFTKBDDATA)lParam)-&gt;wCode[0][0];
06728 
06729                     pSoftKbdData-&gt;uCount = ((PSOFTKBDDATA)lParam)-&gt;uCount;
06730 
06731                     i = pSoftKbdData-&gt;uCount * 256;
06732 
06733                     <span class="keywordflow">while</span> (i--) {
06734                         pch[1] = <span class="charliteral">'\0'</span>;
06735                         WCSToMBEx(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a118">THREAD_CODEPAGE</a>(), pCodeW, 1, &amp;pch, 2, FALSE);
06736                         <span class="keywordflow">if</span> (pch[1]) {
06737                             *pCodeA = MAKEWORD(pch[1], pch[0]);
06738                         } <span class="keywordflow">else</span> {
06739                             *pCodeA = MAKEWORD(pch[0], 0);
06740                         }
06741                         pCodeA++; pCodeW++;
06742                     }
06743 
06744                     <a class="code" href="../../d3/d5/ssend_8c.html#a41">LARGECOPYBYTES2</a>(pSoftKbdData, cbCapture, u.pSoftKbdData);
06745 
06746                     UserFreePool(pSoftKbdData);
06747                 }
06748                 <span class="keywordflow">else</span> {
06749                     pSoftKbdData = (PSOFTKBDDATA)lParam;
06750                     <a class="code" href="../../d3/d5/ssend_8c.html#a41">LARGECOPYBYTES2</a>(pSoftKbdData, cbCapture, u.pSoftKbdData);
06751                 }
06752             }
06753 
06754             <span class="comment">/*</span>
06755 <span class="comment">             * Fall thur.</span>
06756 <span class="comment">             */</span>
06757 
06758         <span class="keywordflow">default</span>:
06759             <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNIMECONTROL);
06760             <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
06761             <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
06762             <span class="keywordflow">break</span>;
06763         }
06764 
06765 
06766     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnINSTRINGNULL"</span>);
06767     <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(DWORD,0);
06768 }
06769 <span class="preprocessor">#endif // SENDSIDE</span>
06770 <span class="preprocessor"></span>
06771 <span class="preprocessor">#ifdef RECVSIDE</span>
06772 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnIMECONTROL, <a class="code" href="../../d8/d4/struct__FNIMECONTROL.html">FNIMECONTROLMSG</a>)
06773 {
06774     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> abOutput[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>];
06775     LPARAM lParam;
06776 
06777     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, pmsg-&gt;cbOutput);
06778     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
06779     <span class="keywordflow">if</span> (pmsg-&gt;cbOutput &lt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>)
06780         CallbackStatus.pOutput = abOutput;
06781     <span class="keywordflow">else</span>
06782         CallbackStatus.pOutput = pmsg-&gt;pOutput;
06783 
06784     <span class="keywordflow">switch</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam)) {
06785         <span class="keywordflow">case</span> IMC_GETCANDIDATEPOS:
06786         <span class="keywordflow">case</span> IMC_GETCOMPOSITIONWINDOW:
06787         <span class="keywordflow">case</span> IMC_GETCOMPOSITIONFONT:
06788         <span class="keywordflow">case</span> IMC_GETSOFTKBDFONT:
06789             lParam = (LPARAM)CallbackStatus.pOutput;
06790             <span class="keywordflow">break</span>;
06791 
06792         <span class="keywordflow">case</span> IMC_SETCANDIDATEPOS:
06793         <span class="keywordflow">case</span> IMC_SETCOMPOSITIONWINDOW:
06794         <span class="keywordflow">case</span> IMC_SETCOMPOSITIONFONT:
06795         <span class="keywordflow">case</span> IMC_SETSOFTKBDDATA:
06796             lParam = <a class="code" href="../../d5/d8/crecv_8c.html#a13">FIRSTFIXUP</a>(u.lParam);
06797             <span class="keywordflow">break</span>;
06798 
06799        <span class="keywordflow">default</span>:
06800             lParam = <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(u.lParam);
06801             <span class="keywordflow">break</span>;
06802     }
06803 
06804     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
06805             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
06806             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
06807             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
06808             lParam,
06809             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
06810 
06811 
06812     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
06813 }
06814 <span class="preprocessor">#endif // RECVSIDE</span>
06815 <span class="preprocessor"></span>
06816 <span class="comment">/**************************************************************************\</span>
06817 <span class="comment">* fnIMEREQUEST</span>
06818 <span class="comment">*</span>
06819 <span class="comment">* 22-Apr-1996     Created</span>
06820 <span class="comment">\**************************************************************************/</span>
06821 
06822 <span class="preprocessor">#ifdef LATER</span>
06823 <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span>_FNIMEREQUEST {
06824     <a class="code" href="../../d4/d7/struct__CAPTUREBUF.html">CAPTUREBUF</a> CaptureBuf;
06825     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
06826     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
06827     WPARAM wParam;
06828     <span class="keyword">union </span>{
06829         LPCANDIDATEFORM         pCandidateForm;
06830         LPLOGFONTA              pLogFontA;
06831         LPLOGFONTW              pLogFontW;
06832         LPCOMPOSITIONFORM       pCompositionForm;
06833         LPRECONVERTSTRING       pReconvertString;
06834         LPPrivateIMECHARPOSITION pImeCharPosition;
06835         LPARAM                  lParam;
06836     } u;
06837     ULONG_PTR xParam;
06838     PROC xpfnProc;
06839     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pOutput;
06840     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOutput;
06841     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsi;
06842 } FNIMEREQUESTMSG;
06843 
06844 <span class="preprocessor">#ifdef SENDSIDE</span>
06845 <span class="preprocessor"></span>
06846 <a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(IMEREQUEST)
06847 {
06848     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cCapture, cbCapture;
06849 
06850     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNIMEREQUEST)
06851 
06852     <span class="comment">//</span>
06853     <span class="comment">// IMEREQUEST assumes the callback is within the thread</span>
06854     <span class="comment">// (see MESSAGECALL(IMEREQUEST) in kernel/ntstubs.c.)</span>
06855     <span class="comment">//</span>
06856     <span class="comment">// All the data pointed by lParam should point the valid</span>
06857     <span class="comment">// client side address. Thus all the validation and copy</span>
06858     <span class="comment">// (if needed) will be done in the receiver side.</span>
06859     <span class="comment">//</span>
06860     UserAssert(psms == NULL || psms-&gt;ptiSender == psms-&gt;ptiReceiver);
06861 
06862     switch (wParam) {
06863     <span class="keywordflow">case</span> IMR_CANDIDATEWINDOW:
06864         cCapture  = 1;
06865         cbCapture = <span class="keyword">sizeof</span>(CANDIDATEFORM);
06866         <span class="keywordflow">break</span>;
06867 
06868     <span class="keywordflow">case</span> IMR_COMPOSITIONWINDOW:
06869         cCapture = 1;
06870         cbCapture = <span class="keyword">sizeof</span>(COMPOSITIONFORM);
06871         <span class="keywordflow">break</span>;
06872 
06873     <span class="keywordflow">case</span> IMR_CONFIRMRECONVERTSTRING:
06874     <span class="keywordflow">case</span> IMR_RECONVERTSTRING:
06875     <span class="keywordflow">case</span> IMR_DOCUMENTFEED:
06876     <span class="keywordflow">case</span> IMR_QUERYCHARPOSITION:
06877         cCapture = 0;
06878         cbCapture = 0;
06879         <span class="keywordflow">break</span>;
06880 
06881     <span class="keywordflow">case</span> IMR_COMPOSITIONFONT:   <span class="comment">// only the exception to the rule above.</span>
06882         cCapture = 1;
06883         cbCapture = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>) ? <span class="keyword">sizeof</span>(LOGFONTA) : <span class="keyword">sizeof</span>(LOGFONTW);
06884         <span class="keywordflow">break</span>;
06885 
06886     <span class="keywordflow">default</span>:
06887         UserAssert(FALSE);
06888         cCapture  = 0;
06889         cbCapture = 0;
06890         <span class="keywordflow">break</span>;
06891     }
06892 
06893     <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNIMEREQUEST, cCapture, cbCapture, TRUE);
06894 
06895         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd     = pwndClient;
06896         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg      = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
06897         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam   = wParam;
06898         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;u.lParam = lParam;
06899         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam   = xParam;
06900         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
06901         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;fAnsi    = (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>);
06902 
06903         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
06904 
06905         <span class="comment">//</span>
06906         <span class="comment">// Preparation</span>
06907         <span class="comment">//</span>
06908 
06909         <span class="keywordflow">switch</span> (wParam) {
06910         <span class="keywordflow">case</span> IMR_COMPOSITIONFONT:
06911             <a class="code" href="../../d3/d5/ssend_8c.html#a57">RESERVEBYTES</a>(cbCapture, pOutput, cbOutput);
06912             <span class="keywordflow">break</span>;
06913         }
06914 
06915         <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNIMEREQUEST);
06916         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
06917         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
06918 
06919         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
06920             try {
06921                 <span class="keywordflow">switch</span> (wParam) {
06922                 <span class="keywordflow">case</span> IMR_COMPOSITIONFONT:
06923                     <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput, <a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;cbOutput, <span class="keyword">sizeof</span>(DWORD));
06924                     <span class="keywordflow">if</span> (dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>) {
06925                         <a class="code" href="../../d6/d0/usercli_8h.html#a637">CopyLogFontAtoW</a>((PLOGFONTW)lParam, (PLOGFONTA)<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput);
06926                     }
06927                     <span class="keywordflow">else</span> {
06928                         memcpy((LPBYTE)lParam, <a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput, cbCapture);
06929                     }
06930                     <span class="keywordflow">break</span>;
06931                 }
06932             } except (EXCEPTION_EXECUTE_HANDLER) {
06933                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
06934             }
06935         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
06936 
06937     TRACECALLBACKMSG("SfnIMEREQUEST");
06938     ENDSENDCAPTURE(DWORD,0);
06939 }
06940 #endif <span class="comment">// SENDSIDE</span>
06941 
06942 #ifdef RECVSIDE
06943 RECVCALL(fnIMEREQUEST, FNIMEREQUESTMSG)
06944 {
06945     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> abOutput[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>];
06946     <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pvNew = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
06947     LPARAM lParam;
06948 
06949     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, pmsg-&gt;cbOutput);
06950     <a class="code" href="../../d5/d8/crecv_8c.html#a5">FIXUPPOINTERS</a>();
06951     <span class="keywordflow">if</span> (pmsg-&gt;cbOutput &lt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a97">CALLBACKSTACKLIMIT</a>)
06952         CallbackStatus.pOutput = abOutput;
06953     <span class="keywordflow">else</span>
06954         CallbackStatus.pOutput = pmsg-&gt;pOutput;
06955 
06956     lParam = <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(u.lParam);
06957 
06958     <span class="keywordflow">switch</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam)) {
06959     <span class="keywordflow">case</span> IMR_COMPOSITIONWINDOW:
06960     <span class="keywordflow">case</span> IMR_CANDIDATEWINDOW:
06961 <span class="comment">//        lParam = CALLDATA(lParam);</span>
06962         <span class="keywordflow">break</span>;
06963 
06964     <span class="keywordflow">case</span> IMR_COMPOSITIONFONT:
06965         lParam = (LPARAM)CallbackStatus.pOutput;
06966         <span class="keywordflow">break</span>;
06967 
06968     <span class="keywordflow">case</span> IMR_QUERYCHARPOSITION:
06969         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(fAnsi)) {
06970             LPPrivateIMECHARPOSITION lpCharPos;
06971 
06972             pvNew = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, <span class="keyword">sizeof</span>(PrivateIMECHARPOSITION));
06973             <span class="keywordflow">if</span> (pvNew == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
06974                 <span class="keywordflow">goto</span> error_return;
06975             }
06976             lpCharPos = pvNew;
06977             *lpCharPos = *<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(u.pImeCharPosition);
06978             lpCharPos-&gt;dwCharPos = lpCharPos-&gt;dwCharPositionA;
06979         }
06980         <span class="keywordflow">break</span>;
06981 
06982     <span class="keywordflow">case</span> IMR_RECONVERTSTRING:
06983     <span class="keywordflow">case</span> IMR_CONFIRMRECONVERTSTRING:
06984     <span class="keywordflow">case</span> IMR_DOCUMENTFEED:
06985         <span class="comment">// Real W/A conversion may be needed.</span>
06986         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(fAnsi) &amp;&amp; lParam) {
06987             PRECONVERTSTRING Source = (LPRECONVERTSTRING)lParam;
06988             <span class="comment">// Do conversion.</span>
06989             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwNewSize = <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a54">ImmGetReconvertTotalSize</a>(((LPRECONVERTSTRING)lParam)-&gt;dwSize, FROM_IME, TRUE);
06990             <span class="keywordflow">if</span> (dwNewSize == 0) {
06991                 <span class="keywordflow">goto</span> error_return;
06992             }
06993 
06994             pvNew = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, dwNewSize);
06995             <span class="keywordflow">if</span> (pvNew == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
06996                 <span class="keywordflow">goto</span> error_return;
06997             }
06998             lParam = (LPARAM)pvNew;
06999 
07000 <span class="preprocessor">            #define lpReconv ((LPRECONVERTSTRING)lParam)</span>
07001 <span class="preprocessor"></span>            <span class="comment">// setup the information in the allocated structure</span>
07002             lpReconv-&gt;dwVersion = 0;
07003             lpReconv-&gt;dwSize = dwNewSize;
07004             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam) == IMR_CONFIRMRECONVERTSTRING) {
07005                 <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a6">ImmReconversionWorker</a>(lpReconv, (LPRECONVERTSTRING)lParam, TRUE, CP_ACP);
07006             }
07007         }
07008         <span class="keywordflow">break</span>;
07009 
07010    <span class="keywordflow">default</span>:
07011         lParam = <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(u.lParam);
07012         <span class="keywordflow">break</span>;
07013     }
07014 
07015     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
07016             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
07017             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
07018             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
07019             lParam,
07020             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
07021 
07022     <span class="keywordflow">switch</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam)) {
07023     <span class="keywordflow">case</span> IMR_RECONVERTSTRING:
07024     <span class="keywordflow">case</span> IMR_DOCUMENTFEED:
07025         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(fAnsi)) {
07026             retval = <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a54">ImmGetReconvertTotalSize</a>((DWORD)retval, FROM_APP, TRUE);
07027             <span class="keywordflow">if</span> (lParam) {
07028                 retval = <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a6">ImmReconversionWorker</a>((LPRECONVERTSTRING)<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(u.lParam), (LPRECONVERTSTRING)pvNew, FALSE, CP_ACP);
07029             }
07030         }
07031         <span class="keywordflow">break</span>;
07032     }
07033 
07034     <span class="keywordflow">if</span> (pvNew) {
07035         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pvNew);
07036     }
07037 error_return:
07038     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
07039 }
07040 
07041 <span class="preprocessor">#undef lpReconv</span>
07042 <span class="preprocessor"></span>
07043 <span class="preprocessor">#endif // RECVSIDE</span>
07044 <span class="preprocessor"></span>
07045 <span class="preprocessor">#endif</span>
07046 <span class="preprocessor"></span>
07047 <span class="comment">/**************************************************************************\</span>
07048 <span class="comment">* fnGETDBCSTEXTLENGTHS (DBCS-aware Version)</span>
07049 <span class="comment">*</span>
07050 <span class="comment">* Gets the Unicode &amp; ANSI lengths</span>
07051 <span class="comment">* Internally, lParam pints to the ANSI length in bytes and the return value</span>
07052 <span class="comment">* is the Unicode length in bytes.  However, the public definition is maintained</span>
07053 <span class="comment">* on the  client side, where lParam is not used and either ANSI or Unicode is</span>
07054 <span class="comment">* returned.</span>
07055 <span class="comment">*</span>
07056 <span class="comment">* 14-Mar-1996 HideyukN  Created</span>
07057 <span class="comment">\**************************************************************************/</span>
07058 
07059 <span class="preprocessor">#if (WM_GETTEXTLENGTH - WM_GETTEXT) != 1</span>
07060 <span class="preprocessor"></span><span class="preprocessor">#error "WM_GETTEXT Messages no longer 1 apart. Error in code."</span>
07061 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
07062 <span class="preprocessor"></span><span class="preprocessor">#if (LB_GETTEXTLEN - LB_GETTEXT) != 1</span>
07063 <span class="preprocessor"></span><span class="preprocessor">#error "LB_GETTEXT Messages no longer 1 apart. Error in code."</span>
07064 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
07065 <span class="preprocessor"></span><span class="preprocessor">#if (CB_GETLBTEXTLEN - CB_GETLBTEXT) != 1</span>
07066 <span class="preprocessor"></span><span class="preprocessor">#error "CB_GETLBTEXT Messages no longer 1 apart. Error in code."</span>
07067 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
07068 <span class="preprocessor"></span>
<a name="l07069"></a><a class="code" href="../../d5/d3/struct__FNGETDBCSTEXTLENGTHSMSG.html">07069</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d3/struct__FNGETDBCSTEXTLENGTHSMSG.html">_FNGETDBCSTEXTLENGTHSMSG</a> {
<a name="l07070"></a><a class="code" href="../../d5/d3/struct__FNGETDBCSTEXTLENGTHSMSG.html#o0">07070</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
<a name="l07071"></a><a class="code" href="../../d5/d3/struct__FNGETDBCSTEXTLENGTHSMSG.html#o1">07071</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l07072"></a><a class="code" href="../../d5/d3/struct__FNGETDBCSTEXTLENGTHSMSG.html#o2">07072</a>     WPARAM wParam;
<a name="l07073"></a><a class="code" href="../../d5/d3/struct__FNGETDBCSTEXTLENGTHSMSG.html#o3">07073</a>     ULONG_PTR xParam;
<a name="l07074"></a><a class="code" href="../../d5/d3/struct__FNGETDBCSTEXTLENGTHSMSG.html#o4">07074</a>     PROC xpfnProc;
07075 } <a class="code" href="../../d5/d3/struct__FNGETDBCSTEXTLENGTHSMSG.html">FNGETDBCSTEXTLENGTHSMSG</a>;
07076 
07077 <span class="preprocessor">#ifdef SENDSIDE</span>
07078 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(GETDBCSTEXTLENGTHS)
07079 {
07080     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiSender   = !!(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)lParam;
07081     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsiReceiver = ((dwSCMSFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a240">SCMS_FLAGS_ANSI</a>) != 0);
07082     <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pfnSavedWndProc = pwnd-&gt;lpfnWndProc;
07083 
07084     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNGETDBCSTEXTLENGTHS)
07085 
07086     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNGETDBCSTEXTLENGTHS)
07087 
07088     UserAssert((fAnsiReceiver &amp; 1) == fAnsiReceiver &amp;&amp; (fAnsiSender &amp; 1) == fAnsiSender);
07089 
07090     <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
07091     <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
07092     <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
07093     <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
07094     <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
07095 
07096     <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
07097     <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNGETTEXTLENGTHS);
07098     <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
07099     CHECKRETURN1();
07100 
07101     <span class="comment">/*</span>
07102 <span class="comment">     * ANSI client wndproc returns us cbANSI.  We want cchUnicode,</span>
07103 <span class="comment">     * so we guess cchUnicode = cbANSI. (It may be less if</span>
07104 <span class="comment">     * multi-byte characters are involved, but it will never be more).</span>
07105 <span class="comment">     * Save cbANSI in *lParam in case the server ultimately returns</span>
07106 <span class="comment">     * the length to an ANSI caller.</span>
07107 <span class="comment">     *</span>
07108 <span class="comment">     * Unicode client wndproc returns us cchUnicode.  If we want to know</span>
07109 <span class="comment">     * cbANSI, we must guess how many 'ANSI' chars we would need.</span>
07110 <span class="comment">     * We guess cbANSI = cchUnicode * 2. (It may be this much if all</span>
07111 <span class="comment">     * 'ANSI' characters are multi-byte, but it will never be more).</span>
07112 <span class="comment">     *</span>
07113 <span class="comment">     * Return cchUnicode (server code is all Unicode internally).</span>
07114 <span class="comment">     * Put cbANSI in *lParam to be passed along within the server in case</span>
07115 <span class="comment">     * we ultimately need to return it to the client.</span>
07116 <span class="comment">     *</span>
07117 <span class="comment">     * NOTE: this will sometimes cause text lengths to be misreported</span>
07118 <span class="comment">     * up to twice the real length, but that is expected to be harmless.</span>
07119 <span class="comment">     * This will only * happen if an app sends WM_GETcode TEXTLENGTH to a</span>
07120 <span class="comment">     * window with an ANSI client-side wndproc, or a ANSI WM_GETTEXTLENGTH</span>
07121 <span class="comment">     * is sent to a Unicode client-side wndproc.</span>
07122 <span class="comment">     */</span>
07123 
07124     <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
07125 
07126         <span class="comment">//</span>
07127         <span class="comment">// retval can be [CB|LB]_ERR (-1) or [CB|LB]_ERRSPACE (-2)</span>
07128         <span class="comment">// then, it should be grater then zero. otherwise we can handle</span>
07129         <span class="comment">// it as error, or zero length string.</span>
07130         <span class="comment">//</span>
07131         <span class="keywordflow">if</span> ((LONG)retval &gt; 0) {
07132 
07133             <span class="comment">//</span>
07134             <span class="comment">// Check we need to Ansi &lt;-&gt; Unicode conversion.</span>
07135             <span class="comment">//</span>
07136             <span class="keywordflow">if</span> (fAnsiSender != fAnsiReceiver) {
07137                 <span class="keywordflow">if</span> (pwnd-&gt;lpfnWndProc != pfnSavedWndProc) {
07138                     <span class="comment">// The window procedure is changed during the first callback.</span>
07139                     <span class="comment">// Let's take a guess for the worst case.</span>
07140                     RIPMSG1(RIP_WARNING, <span class="stringliteral">"GETTEXTLENGTHS(pwnd=%x): The subclass status of winproc changed during 1st callback."</span>,
07141                             pwnd);
07142                     retval *= 2;
07143                 }
07144                 <span class="keywordflow">else</span> {
07145                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bNotString = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>; <span class="comment">// default is string....</span>
07146 
07147                     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> != WM_GETTEXTLENGTH) {
07148                         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dw;
07149 
07150                         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwnd))) {
07151                             MSGERROR1();
07152                         }
07153 
07154                         <span class="comment">//</span>
07155                         <span class="comment">// Get window style.</span>
07156                         <span class="comment">//</span>
07157                         dw = pwnd-&gt;style;
07158 
07159                         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> == LB_GETTEXTLEN) {
07160                             <span class="comment">//</span>
07161                             <span class="comment">// See if the control is ownerdraw and does not have the LBS_HASSTRINGS</span>
07162                             <span class="comment">// style.</span>
07163                             <span class="comment">//</span>
07164                             bNotString =  (!(dw &amp; LBS_HASSTRINGS) &amp;&amp;
07165                                             (dw &amp; (LBS_OWNERDRAWFIXED | LBS_OWNERDRAWVARIABLE)));
07166                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> == CB_GETLBTEXTLEN) {
07167                             <span class="comment">//</span>
07168                             <span class="comment">// See if the control is ownerdraw and does not have the CBS_HASSTRINGS</span>
07169                             <span class="comment">// style.</span>
07170                             <span class="comment">//</span>
07171                             bNotString = (!(dw &amp; CBS_HASSTRINGS) &amp;&amp;
07172                                            (dw &amp; (CBS_OWNERDRAWFIXED | CBS_OWNERDRAWVARIABLE)));
07173                         } <span class="keywordflow">else</span> {
07174                             MSGERROR1();
07175                         }
07176 
07177                         <span class="comment">//</span>
07178                         <span class="comment">// if so, the length should be ULONG_PTR.</span>
07179                         <span class="comment">//</span>
07180                         <span class="keywordflow">if</span> (bNotString) {
07181                             retval = <span class="keyword">sizeof</span>(ULONG_PTR);
07182                         }
07183                     }
07184 
07185                     <span class="comment">//</span>
07186                     <span class="comment">// if the target data is "string", get it, and compute the length</span>
07187                     <span class="comment">//</span>
07188                     <span class="keywordflow">if</span> (!bNotString) {
07189                         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;TIF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a818">TIF_INGETTEXTLENGTH</a>) {
07190                             <span class="keywordflow">if</span> (fAnsiSender) {
07191                                 UserAssert(!fAnsiReceiver);
07192                                 <span class="comment">//</span>
07193                                 <span class="comment">// retval has Unicode character count, guessed DBCS length.</span>
07194                                 <span class="comment">//</span>
07195                                 retval *= 2;
07196                             }
07197                         } <span class="keywordflow">else</span> {
07198                             <span class="comment">//</span>
07199                             <span class="comment">// fAnsiReceiver == 1, retval has MBCS character count.</span>
07200                             <span class="comment">// fAnsiReceiver == 0, retval has Unicode character count.</span>
07201                             <span class="comment">//</span>
07202                             <span class="comment">// Add 1 to make room for zero-terminator.</span>
07203                             <span class="comment">//</span>
07204                             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cchText   = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)retval + 1;
07205                             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCapture = cchText;
07206 
07207                             <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNOUTSTRING)
07208 
07209                             <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;TIF_flags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a818">TIF_INGETTEXTLENGTH</a>;
07210 
07211                             <span class="comment">//</span>
07212                             <span class="comment">// if reciver is Unicode, The buffder should be reserved as musg as</span>
07213                             <span class="comment">// (TextLength * sizeof(WCHAR).</span>
07214                             <span class="comment">//</span>
07215                             <span class="keywordflow">if</span> (!fAnsiReceiver) {
07216                                 cbCapture *= <span class="keyword">sizeof</span>(WCHAR);
07217                             }
07218 
07219                             <a class="code" href="../../d3/d5/ssend_8c.html#a12">BEGINSENDCAPTURE</a>(FNOUTSTRING, 1, cbCapture, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)
07220 
07221                                 <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
07222 
07223                                 <span class="comment">//</span>
07224                                 <span class="comment">// Use (msg-1) for sending the WM_GETTEXT, LB_GETTEXT or CB_GETLBTEXT</span>
07225                                 <span class="comment">// since the above precompiler checks passed.</span>
07226                                 <span class="comment">//</span>
07227                                 <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>-1;
07228 
07229                                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a> == WM_GETTEXTLENGTH) {
07230                                     <span class="comment">//</span>
07231                                     <span class="comment">// WM_GETTEXT:</span>
07232                                     <span class="comment">//    wParam = cchTextMax; // number of character to copy.</span>
07233                                     <span class="comment">//    lParam = lpszText;   // address of buffer for text.</span>
07234                                     <span class="comment">//</span>
07235                                     <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = cchText;
07236                                 } <span class="keywordflow">else</span> {
07237                                     <span class="comment">//</span>
07238                                     <span class="comment">// LB_GETTEXT:</span>
07239                                     <span class="comment">// CB_GETLBTEXT:</span>
07240                                     <span class="comment">//    wParam = index;      // item index</span>
07241                                     <span class="comment">//    lParam = lpszText;   // address of buffer for text.</span>
07242                                     <span class="comment">//</span>
07243                                     <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
07244                                 }
07245 
07246                                 <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
07247                                 <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
07248 
07249                                 <a class="code" href="../../d3/d5/ssend_8c.html#a57">RESERVEBYTES</a>(cbCapture, pOutput, cbOutput);
07250 
07251                                 <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
07252                                 <a class="code" href="../../d3/d5/ssend_8c.html#a18">MAKECALLCAPTURE</a>(FNOUTSTRING);
07253                                 <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
07254                                 <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
07255 
07256                                 <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
07257                                         <span class="comment">//</span>
07258                                         <span class="comment">// retval can be [CB|LB]_ERR (-1) or [CB|LB]_ERRSPACE (-2)</span>
07259                                         <span class="comment">// then, it should be grater then zero.</span>
07260                                         <span class="comment">//</span>
07261                                         <span class="keywordflow">if</span> ((LONG)retval &gt; 0) {
07262                                         <span class="comment">/*</span>
07263 <span class="comment">                                         * Non-zero retval means some text to copy out.</span>
07264 <span class="comment">                                         */</span>
07265                                         CALC_SIZE_STRING_OUT((LONG)retval);
07266                                     }
07267                                 <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
07268 
07269                                 <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;TIF_flags &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a818">TIF_INGETTEXTLENGTH</a>;
07270 
07271                             <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnOUTSTRING"</span>);
07272                             <a class="code" href="../../d3/d5/ssend_8c.html#a27">ENDSENDCAPTURE</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>,0);
07273                         }
07274                     }
07275                 }
07276             }
07277         }
07278     <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
07279 
07280     TRACECALLBACKMSG("SfnGETDBCSTEXTLENGTHS");
07281     ENDSEND1(DWORD,0);
07282 }
07283 #endif <span class="comment">// SENDSIDE</span>
07284 
07285 #ifdef RECVSIDE
07286 <span class="comment">/*</span>
07287 <span class="comment"> * The fnGETTEXTLENGTHS routine is used for this message (see... client\dispcb.tpl)</span>
07288 <span class="comment"> */</span>
07289 #endif <span class="comment">// RECVSIDE</span>
07290 
07291 <span class="comment">/***************************************************************************\</span>
07292 <span class="comment">* xxxClientMonitorEnumProc</span>
07293 <span class="comment">*</span>
07294 <span class="comment">* Calls the client callback given to EnumDisplayMonitors.</span>
07295 <span class="comment">*</span>
07296 <span class="comment">* History:</span>
07297 <span class="comment">* 05-Sep-1996 adams     Created.</span>
07298 <span class="comment">\***************************************************************************/</span>
07299 
<a name="l07300"></a><a class="code" href="../../d7/d2/struct__CLIENTMONITORENUMPROCMSG.html">07300</a> typedef struct <a class="code" href="../../d7/d2/struct__CLIENTMONITORENUMPROCMSG.html">_CLIENTMONITORENUMPROCMSG</a> {
<a name="l07301"></a><a class="code" href="../../d7/d2/struct__CLIENTMONITORENUMPROCMSG.html#o0">07301</a>     HMONITOR        hMonitor;
<a name="l07302"></a><a class="code" href="../../d7/d2/struct__CLIENTMONITORENUMPROCMSG.html#o1">07302</a>     HDC             hdcMonitor;
<a name="l07303"></a><a class="code" href="../../d7/d2/struct__CLIENTMONITORENUMPROCMSG.html#o2">07303</a>     RECT            rc;
<a name="l07304"></a><a class="code" href="../../d7/d2/struct__CLIENTMONITORENUMPROCMSG.html#o3">07304</a>     LPARAM          dwData;
<a name="l07305"></a><a class="code" href="../../d7/d2/struct__CLIENTMONITORENUMPROCMSG.html#o4">07305</a>     MONITORENUMPROC xpfnProc;
07306 } <a class="code" href="../../d7/d2/struct__CLIENTMONITORENUMPROCMSG.html">CLIENTMONITORENUMPROCMSG</a>;
07307 
07308 <span class="preprocessor">#ifdef SENDSIDE</span>
07309 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a2077">xxxClientMonitorEnumProc</a>(
07310     HMONITOR        hMonitor,
07311     HDC             hdcMonitor,
07312     LPRECT          lprc,
07313     LPARAM          dwData,
07314     MONITORENUMPROC xpfnProc)
07315 {
07316     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTMONITORENUMPROC)
07317 
07318     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(<a class="code" href="../../d7/d2/struct__CLIENTMONITORENUMPROCMSG.html">CLIENTMONITORENUMPROCMSG</a>)
07319 
07320         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hMonitor = hMonitor;
07321         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hdcMonitor = hdcMonitor;
07322         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;rc = *lprc;
07323         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;dwData = dwData;
07324         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
07325 
07326         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTMONITORENUMPROC);
07327         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
07328 
07329     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"SxxxClientMonitorEnumProc"</span>);
07330     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
07331 }
07332 <span class="preprocessor">#endif // SENDSIDE</span>
07333 <span class="preprocessor"></span>
07334 <span class="preprocessor">#ifdef RECVSIDE</span>
07335 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientMonitorEnumProc, <a class="code" href="../../d7/d2/struct__CLIENTMONITORENUMPROCMSG.html">CLIENTMONITORENUMPROCMSG</a>)
07336 {
07337     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(FALSE, NULL, 0);
07338 
07339     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;xpfnProc)(
07340             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hMonitor),
07341             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hdcMonitor),
07342             <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(rc),
07343             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(dwData));
07344 
07345     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
07346 }
07347 <span class="preprocessor">#endif // RECVSIDE</span>
07348 <span class="preprocessor"></span>
07349 <span class="comment">/**************************************************************************\</span>
07350 <span class="comment">* xxxUserModeCallback</span>
07351 <span class="comment">*</span>
07352 <span class="comment">* Generic kernel callback stub</span>
07353 <span class="comment">*</span>
07354 <span class="comment">* 10/28/96 GerardoB     Created</span>
07355 <span class="comment">\**************************************************************************/</span>
07356 <span class="preprocessor">#ifdef SENDSIDE</span>
07357 <span class="preprocessor"></span><a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d4/d1/userk_8h.html#a1931">xxxUserModeCallback</a> (ULONG uApi, PVOID pIn, ULONG cbIn, PVOID pOut, ULONG cbOut)
07358 {
07359     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
07360     PVOID pLocalOut;
07361     ULONG cbLocalOut;
07362 
07363     <span class="comment">/*</span>
07364 <span class="comment">     * Call the client</span>
07365 <span class="comment">     */</span>
07366     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
07367     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d4/ke_2ppc_2callback_8c.html#a0">KeUserModeCallback</a>(uApi, pIn, cbIn, &amp;pLocalOut, &amp;cbLocalOut);
07368     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
07369 
07370     <span class="comment">/*</span>
07371 <span class="comment">     * If it failed, bail</span>
07372 <span class="comment">     */</span>
07373     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
07374         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
07375     }
07376 
07377     <span class="comment">/*</span>
07378 <span class="comment">     * If we didn't get the right amount of data, fail.</span>
07379 <span class="comment">     */</span>
07380     <span class="keywordflow">if</span> (cbLocalOut != cbOut) {
07381         RIPMSG3(RIP_WARNING, <span class="stringliteral">"xxxUserModeCallback: uAPi: %#lx cbOut: %#lx cbLocalOut: %#lx"</span>,
07382                 uApi, cbOut, cbLocalOut);
07383         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
07384     }
07385 
07386     <span class="comment">/*</span>
07387 <span class="comment">     * If we were expecting some data, copy it.</span>
07388 <span class="comment">     */</span>
07389     <span class="keywordflow">if</span> (cbOut != 0) {
07390         <span class="keywordflow">try</span> {
07391             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(pLocalOut, cbLocalOut, <span class="keyword">sizeof</span>(DWORD));
07392             RtlCopyMemory(pOut, pLocalOut, cbLocalOut);
07393         } except (W32ExceptionHandler(FALSE, RIP_WARNING)) {
07394             RIPMSG2(RIP_WARNING, <span class="stringliteral">"xxxUserModeCallback: uAPi: %#lx Exception: %#lx"</span>, uApi, GetExceptionCode());
07395             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
07396         }
07397     }
07398 
07399     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
07400 }
07401 <span class="preprocessor">#endif // SENDSIDE</span>
07402 <span class="preprocessor"></span>
07403 <span class="comment">/**************************************************************************\</span>
07404 <span class="comment">* fnINOUTMENUGETOBJECT</span>
07405 <span class="comment">*</span>
07406 <span class="comment">* 11/12/96 GerardoB     Created</span>
07407 <span class="comment">\**************************************************************************/</span>
<a name="l07408"></a><a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html">07408</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html">_FNINOUTMENUGETOBJECTMSG</a> {
<a name="l07409"></a><a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html#o0">07409</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
<a name="l07410"></a><a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html#o1">07410</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l07411"></a><a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html#o2">07411</a>     WPARAM wParam;
<a name="l07412"></a><a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html#o3">07412</a>     MENUGETOBJECTINFO <a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html#o3">mngoi</a>;
<a name="l07413"></a><a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html#o4">07413</a>     ULONG_PTR xParam;
<a name="l07414"></a><a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html#o5">07414</a>     PROC xpfnProc;
07415 } <a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html">FNINOUTMENUGETOBJECTMSG</a>;
07416 
07417 <span class="preprocessor">#ifdef SENDSIDE</span>
07418 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(INOUTMENUGETOBJECT)
07419 {
07420     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNINOUTMENUGETOBJECT)
07421 
07422     UNREFERENCED_PARAMETER(dwSCMSFlags);
07423 
07424     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNOUTDWORDINDWORD)
07425 
07426     PMENUGETOBJECTINFO pmngoi = (PMENUGETOBJECTINFO)lParam;
07427 
07428         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
07429         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
07430         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
07431         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;mngoi = *pmngoi;
07432         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
07433         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
07434 
07435         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
07436         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNINOUTMENUGETOBJECT);
07437         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
07438         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
07439 
07440         <a class="code" href="../../d3/d5/ssend_8c.html#a52">BEGINCOPYOUT</a>()
07441             <span class="keywordflow">try</span> {
07442                 UserAssert(<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;cbOutput == <span class="keyword">sizeof</span>(pmngoi-&gt;pvObj));
07443                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput, <span class="keyword">sizeof</span>(pmngoi-&gt;pvObj), <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>));
07444                 pmngoi-&gt;pvObj = *((PVOID *)(<a class="code" href="../../d8/d4/w32_2ntuser_2client_2callback_8c.html#a0">pcbs</a>-&gt;pOutput));
07445             } except (W32ExceptionHandler(TRUE, RIP_WARNING)) {
07446                 <a class="code" href="../../d5/d8/crecv_8c.html#a7">MSGERROR</a>();
07447             }
07448         <a class="code" href="../../d3/d5/ssend_8c.html#a53">ENDCOPYOUT</a>()
07449 
07450     TRACECALLBACKMSG("SfnINOUTMENUGETOBJECT");
07451     ENDSEND(DWORD, 0);
07452 }
07453 #endif <span class="comment">// SENDSIDE</span>
07454 
07455 #ifdef RECVSIDE
07456 RECVCALL(fnINOUTMENUGETOBJECT, <a class="code" href="../../d9/d6/struct__FNINOUTMENUGETOBJECTMSG.html">FNINOUTMENUGETOBJECTMSG</a>)
07457 {
07458     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, &amp;(pmsg-&gt;mngoi.pvObj), <span class="keyword">sizeof</span>(pmsg-&gt;mngoi.pvObj));
07459 
07460     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
07461             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
07462             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
07463             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
07464             <a class="code" href="../../d5/d8/crecv_8c.html#a11">PCALLDATA</a>(mngoi),
07465             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
07466 
07467     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
07468 }
07469 <span class="preprocessor">#endif // RECVSIDE</span>
07470 <span class="preprocessor"></span>
07471 <span class="comment">/**************************************************************************\</span>
07472 <span class="comment">* fnLOGONNOTIFY</span>
07473 <span class="comment">*</span>
07474 <span class="comment">* 2/1/97   JerrySh      Created</span>
07475 <span class="comment">\**************************************************************************/</span>
<a name="l07476"></a><a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html">07476</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html">_FNLOGONNOTIFYMSG</a> {
<a name="l07477"></a><a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html#o0">07477</a>     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
<a name="l07478"></a><a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html#o1">07478</a>     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l07479"></a><a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html#o2">07479</a>     WPARAM wParam;
<a name="l07480"></a><a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html#o3">07480</a>     LPARAM lParam;
<a name="l07481"></a><a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html#o4">07481</a>     POWERSTATEPARAMS <a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html#o4">psParams</a>;
<a name="l07482"></a><a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html#o5">07482</a>     ULONG_PTR xParam;
<a name="l07483"></a><a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html#o6">07483</a>     PROC xpfnProc;
07484 } <a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html">FNLOGONNOTIFYMSG</a>;
07485 
07486 <span class="preprocessor">#ifdef SENDSIDE</span>
07487 <span class="preprocessor"></span><a class="code" href="../../d3/d5/ssend_8c.html#a5">SMESSAGECALL</a>(LOGONNOTIFY)
07488 {
07489     <a class="code" href="../../d3/d5/ssend_8c.html#a8">SETUPPWND</a>(FNLOGONNOTIFY)
07490 
07491     UNREFERENCED_PARAMETER(dwSCMSFlags);
07492     UNREFERENCED_PARAMETER(psms);
07493 
07494     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(FNLOGONNOTIFY)
07495 
07496         <span class="keywordflow">if</span> (wParam == LOGON_POWERSTATE)
07497             <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;psParams = *((PPOWERSTATEPARAMS)lParam);
07498 
07499         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pwnd = pwndClient;
07500         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;msg = <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
07501         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;wParam = wParam;
07502         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;lParam = lParam;
07503         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xParam = xParam;
07504         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;xpfnProc = xpfnProc;
07505 
07506         <a class="code" href="../../d3/d5/ssend_8c.html#a15">LOCKPWND</a>();
07507         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(FNLOGONNOTIFY);
07508         <a class="code" href="../../d3/d5/ssend_8c.html#a16">UNLOCKPWND</a>();
07509         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
07510 
07511     <a class="code" href="../../d4/d1/userk_8h.html#a97">TRACECALLBACKMSG</a>(<span class="stringliteral">"SfnLOGONNOTIFY"</span>);
07512     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, 0);
07513 }
07514 <span class="preprocessor">#endif // SENDSIDE</span>
07515 <span class="preprocessor"></span>
07516 <span class="preprocessor">#ifdef RECVSIDE</span>
07517 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(fnLOGONNOTIFY, <a class="code" href="../../d1/d8/struct__FNLOGONNOTIFYMSG.html">FNLOGONNOTIFYMSG</a>)
07518 {
07519     LPARAM lParam;
07520 
07521     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
07522 
07523     lParam = (<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam) == LOGON_POWERSTATE) ? (LPARAM)&amp;<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(psParams) : <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(lParam);
07524 
07525     retval = (ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xpfnProc))(
07526             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pwnd),
07527             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(msg),
07528             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(wParam),
07529             lParam,
07530             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(xParam));
07531 
07532     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
07533 }
07534 <span class="preprocessor">#endif // RECVSIDE</span>
07535 <span class="preprocessor"></span>
07536 <span class="comment">/**************************************************************************\</span>
07537 <span class="comment">* xxxClientCallWinEventProc</span>
07538 <span class="comment">*</span>
07539 <span class="comment">* cf. Win'97 Call32BitEventProc() in user_40\user32\user.c</span>
07540 <span class="comment">*</span>
07541 <span class="comment">* 1996-10-18 IanJa     Created</span>
07542 <span class="comment">\**************************************************************************/</span>
07543 
<a name="l07544"></a><a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html">07544</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html">_CLIENTCALLWINEVENTPROCMSG</a> {
<a name="l07545"></a><a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o0">07545</a>     WINEVENTPROC  <a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o0">pfn</a>;
<a name="l07546"></a><a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o1">07546</a>     HWINEVENTHOOK <a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o1">hWinEventHook</a>;
<a name="l07547"></a><a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o2">07547</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>         <a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o2">event</a>;
<a name="l07548"></a><a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o3">07548</a>     HWND          <a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o3">hwnd</a>;
<a name="l07549"></a><a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o4">07549</a>     LONG          <a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o4">idObject</a>;
<a name="l07550"></a><a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o5">07550</a>     LONG          <a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o5">idChild</a>;
<a name="l07551"></a><a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o6">07551</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>         <a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o6">idEventThread</a>;
<a name="l07552"></a><a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o7">07552</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>         <a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html#o7">dwmsEventTime</a>;
07553 } <a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html">CLIENTCALLWINEVENTPROCMSG</a>;
07554 
07555 <span class="preprocessor">#ifdef SENDSIDE</span>
07556 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1950">xxxClientCallWinEventProc</a>(
07557     WINEVENTPROC pfn,
07558     <a class="code" href="../../d8/d4/structtagEVENTHOOK.html">PEVENTHOOK</a> pEventHook,
07559     <a class="code" href="../../d9/d2/structtagNOTIFY.html">PNOTIFY</a> pNotify)
07560 {
07561     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTCALLWINEVENTPROC)
07562 
07563     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTCALLWINEVENTPROC)
07564 
07565         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pfn = pfn;
07566         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hWinEventHook = (HWINEVENTHOOK)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pEventHook);
07567         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;hwnd = pNotify-&gt;<a class="code" href="../../d9/d2/structtagNOTIFY.html#o3">hwnd</a>;
07568         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;event = pNotify-&gt;<a class="code" href="../../d9/d2/structtagNOTIFY.html#o2">event</a>;
07569         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;idObject = pNotify-&gt;<a class="code" href="../../d9/d2/structtagNOTIFY.html#o4">idObject</a>;
07570         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;idChild = pNotify-&gt;<a class="code" href="../../d9/d2/structtagNOTIFY.html#o5">idChild</a>;
07571         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;idEventThread = pNotify-&gt;<a class="code" href="../../d9/d2/structtagNOTIFY.html#o6">idSenderThread</a>;
07572         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;dwmsEventTime = pNotify-&gt;<a class="code" href="../../d9/d2/structtagNOTIFY.html#o7">dwEventTime</a>;
07573 
07574         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTCALLWINEVENTPROC);
07575         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
07576 
07577     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"xxxClientCallWinEventProc"</span>);
07578     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
07579 }
07580 <span class="preprocessor">#endif // SENDSIDE</span>
07581 <span class="preprocessor"></span>
07582 <span class="preprocessor">#ifdef RECVSIDE</span>
07583 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientCallWinEventProc, <a class="code" href="../../d3/d0/struct__CLIENTCALLWINEVENTPROCMSG.html">CLIENTCALLWINEVENTPROCMSG</a>)
07584 {
07585     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(FALSE, NULL, 0);
07586 
07587     retval = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a17">CALLPROC</a>(pmsg-&gt;pfn)(
07588             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hWinEventHook),
07589             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(event),
07590             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(hwnd),
07591             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(idObject),
07592             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(idChild),
07593             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(idEventThread),
07594             <a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(dwmsEventTime));
07595 
07596     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
07597 
07598 }
07599 <span class="preprocessor">#endif // RECVSIDE</span>
07600 <span class="preprocessor"></span>
07601 
07602 
07603 <span class="comment">/**************************************************************************\</span>
07604 <span class="comment">* WOWGetProcModule</span>
07605 <span class="comment">*</span>
07606 <span class="comment">* 3/25/97 FritzS created</span>
07607 <span class="comment">\**************************************************************************/</span>
07608 
<a name="l07609"></a><a class="code" href="../../d9/d2/struct__CLIENTWOWGETPROCMODULEMSG.html">07609</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d2/struct__CLIENTWOWGETPROCMODULEMSG.html">_CLIENTWOWGETPROCMODULEMSG</a> {
<a name="l07610"></a><a class="code" href="../../d9/d2/struct__CLIENTWOWGETPROCMODULEMSG.html#o0">07610</a>     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a988">WNDPROC_PWND</a> <a class="code" href="../../d9/d2/struct__CLIENTWOWGETPROCMODULEMSG.html#o0">pfn</a>;
07611 } <a class="code" href="../../d9/d2/struct__CLIENTWOWGETPROCMODULEMSG.html">CLIENTWOWGETPROCMODULEMSG</a>;
07612 
07613 
07614 
07615 <span class="preprocessor">#ifdef SENDSIDE</span>
07616 <span class="preprocessor"></span>WORD <a class="code" href="../../d4/d1/userk_8h.html#a1281">xxxClientWOWGetProcModule</a>(
07617     WNDPROC_PWND pfn)
07618 {
07619     <a class="code" href="../../d3/d5/ssend_8c.html#a6">SETUP</a>(CLIENTWOWGETPROCMODULE)
07620 
07621     <a class="code" href="../../d3/d5/ssend_8c.html#a11">BEGINSEND</a>(CLIENTWOWGETPROCMODULE)
07622 
07623         <a class="code" href="../../d3/d5/ssend_8c.html#a35">MSGDATA</a>()-&gt;pfn = pfn;
07624 
07625         <a class="code" href="../../d3/d5/ssend_8c.html#a17">MAKECALL</a>(CLIENTWOWGETPROCMODULE);
07626         <a class="code" href="../../d3/d5/ssend_8c.html#a20">CHECKRETURN</a>();
07627 
07628     <a class="code" href="../../d4/d1/userk_8h.html#a96">TRACECALLBACK</a>(<span class="stringliteral">"xxxWOWGetProcModule"</span>);
07629     <a class="code" href="../../d3/d5/ssend_8c.html#a21">ENDSEND</a>(WORD, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
07630 }
07631 <span class="preprocessor">#endif // SENDSIDE</span>
07632 <span class="preprocessor"></span>
07633 <span class="preprocessor">#ifdef RECVSIDE</span>
07634 <span class="preprocessor"></span><a class="code" href="../../d5/d8/crecv_8c.html#a3">RECVCALL</a>(ClientWOWGetProcModule, <a class="code" href="../../d9/d2/struct__CLIENTWOWGETPROCMODULEMSG.html">CLIENTWOWGETPROCMODULEMSG</a>)
07635 {
07636     ULONG ulReal;
07637     <a class="code" href="../../d5/d8/crecv_8c.html#a4">BEGINRECV</a>(0, NULL, 0);
07638 
07639     <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d8/clglobal_8c.html#a57">pfnWowGetProcModule</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || !IsWOWProc(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pfn))) {
07640         retval = 0;
07641     } <span class="keywordflow">else</span> {
07642         UnMarkWOWProc(<a class="code" href="../../d5/d8/crecv_8c.html#a10">CALLDATA</a>(pfn),ulReal);
07643         retval = (<a class="code" href="../../d1/d8/clglobal_8c.html#a57">pfnWowGetProcModule</a>)(ulReal);
07644     }
07645 
07646     <a class="code" href="../../d5/d8/crecv_8c.html#a6">ENDRECV</a>();
07647 
07648 }
07649 <span class="preprocessor">#endif // RECVSIDE</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:59 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
