<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: w32/ntgdi/icm/mscms/profile.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>profile.c File Reference</h1><code>#include "<a class="el" href="../../d4/d3/mscms_8h-source.html">mscms.h</a>"</code><br>

<p>
<a href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a0">PROFILE_GROWTHCUSHION</a>&nbsp;&nbsp;&nbsp;16*1024</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HPROFILE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a1">InternalOpenColorProfile</a> (PPROFILE, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a2">InternalCreateProfileFromLCS</a> (<a class="el" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a39">LPLOGCOLORSPACE</a>, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> *, BOOL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a3">FreeProfileObject</a> (HPROFILE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a4">AddTagTableEntry</a> (PPROFOBJ, TAGTYPE, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, BOOL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a5">AddTaggedElement</a> (PPROFOBJ, TAGTYPE, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a6">DeleteTaggedElement</a> (PPROFOBJ, PTAGDATA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a7">ChangeTaggedElementSize</a> (PPROFOBJ, PTAGDATA, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a8">GrowProfile</a> (PPROFOBJ, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a9">MoveProfileData</a> (PPROFOBJ, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>, LONG, BOOL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a10">IsReferenceTag</a> (PPROFOBJ, PTAGDATA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HPROFILE WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a11">OpenColorProfileA</a> (PPROFILE pProfile, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDesiredAccess, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwShareMode, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCreationMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HPROFILE WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a12">OpenColorProfileW</a> (PPROFILE pProfile, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDesiredAccess, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwShareMode, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCreationMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a13">CloseColorProfile</a> (HPROFILE hProfile)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a14">GetColorProfileFromHandle</a> (HPROFILE hProfile, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pProfileData, PDWORD pcbSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a15">IsColorProfileValid</a> (HPROFILE hProfile, PBOOL pbValid)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a16">CreateProfileFromLogColorSpaceA</a> (LPLOGCOLORSPACEA pLogColorSpace, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> *pBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a17">CreateProfileFromLogColorSpaceW</a> (LPLOGCOLORSPACEW pLogColorSpace, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> *pBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a18">IsColorProfileTagPresent</a> (HPROFILE hProfile, TAGTYPE tagType, PBOOL pbPresent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a19">GetCountColorProfileElements</a> (HPROFILE hProfile, PDWORD pnCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a20">GetColorProfileElementTag</a> (HPROFILE hProfile, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwIndex, PTAGTYPE pTagType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a21">GetColorProfileElement</a> (HPROFILE hProfile, TAGTYPE tagType, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOffset, PDWORD pcbSize, PVOID pBuffer, PBOOL pbReference)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a22">SetColorProfileElementSize</a> (HPROFILE hProfile, TAGTYPE tagType, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a23">SetColorProfileElement</a> (HPROFILE hProfile, TAGTYPE tagType, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOffset, PDWORD pcbSize, PVOID pBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a24">SetColorProfileElementReference</a> (HPROFILE hProfile, TAGTYPE newTag, TAGTYPE refTag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a25">GetColorProfileHeader</a> (HPROFILE hProfile, PPROFILEHEADER pHeader)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a26">SetColorProfileHeader</a> (HPROFILE hProfile, PPROFILEHEADER pHeader)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a27">GetPS2ColorSpaceArray</a> (HPROFILE hProfile, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwIntent, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCSAType, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pBuffer, PDWORD pcbSize, LPBOOL pbBinary)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a28">GetPS2ColorRenderingIntent</a> (HPROFILE hProfile, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwIntent, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pBuffer, PDWORD pcbSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a29">GetPS2ColorRenderingDictionary</a> (HPROFILE hProfile, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwIntent, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pBuffer, PDWORD pcbSize, PBOOL pbBinary)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a30">GetNamedProfileInfo</a> (HPROFILE hProfile, PNAMED_PROFILE_INFO pNamedProfileInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a31">ConvertColorNameToIndex</a> (HPROFILE hProfile, PCOLOR_NAME paColorName, PDWORD paIndex, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a32">ConvertIndexToColorName</a> (HPROFILE hProfile, PDWORD paIndex, PCOLOR_NAME paColorName, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a33">CreateDeviceLinkProfile</a> (PHPROFILE pahProfiles, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nProfiles, PDWORD padwIntent, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nIntents, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> *pProfileData, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> indexPreferredCMM)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a34">FreeProfileObject</a> (HANDLE hProfile)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="w32/ntgdi/icm/mscms/profile.c::PROFILE_GROWTHCUSHION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PROFILE_GROWTHCUSHION&nbsp;&nbsp;&nbsp;16*1024          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00020">20</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03135">GrowProfile()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02694">InternalOpenColorProfile()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="w32/ntgdi/icm/mscms/profile.c::AddTaggedElement" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL AddTaggedElement           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFOBJ&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TAGTYPE&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03334">3334</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03228">AddTagTableEntry()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03135">GrowProfile()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00986">SetColorProfileElementSize()</a>.
<p>
<pre class="fragment"><div>03339 {
03340     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    dwOffset, newSize;
03341 
03342     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
03343     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(cbSize &gt; 0);
03344 
03345     <span class="comment">//</span>
03346     <span class="comment">// Resize the profile if needed. For memory buffers, we have to realloc,</span>
03347     <span class="comment">// and for mapped objects, we have to close and reopen the view.</span>
03348     <span class="comment">//</span>
03349 
03350     newSize = FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize);
03351     newSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(newSize) + <span class="keyword">sizeof</span>(TAGDATA) + cbSize;
03352 
03353     <span class="comment">//</span>
03354     <span class="comment">// Check for overflow</span>
03355     <span class="comment">//</span>
03356 
03357     <span class="keywordflow">if</span> (newSize &lt; FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize) ||
03358         newSize &lt; cbSize)
03359     {
03360         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Overflow in adding element\n"</span>)));
03361         SetLastError(ERROR_ARITHMETIC_OVERFLOW);
03362         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03363     }
03364 
03365     <span class="keywordflow">if</span> (newSize &gt; pProfObj-&gt;dwMapSize)
03366     {
03367         <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a8">GrowProfile</a>(pProfObj, newSize))
03368         {
03369             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03370         }
03371     }
03372 
03373     <span class="comment">//</span>
03374     <span class="comment">// Calculate location of new data - should be DWORD aligned</span>
03375     <span class="comment">//</span>
03376 
03377     dwOffset = FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize);
03378     dwOffset = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(dwOffset);
03379 
03380     <span class="keywordflow">return</span> <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a4">AddTagTableEntry</a>(pProfObj, tagType, dwOffset, cbSize, TRUE);
03381 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="w32/ntgdi/icm/mscms/profile.c::AddTagTableEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL AddTagTableEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFOBJ&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TAGTYPE&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03228">3228</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00300">MyCopyMemory()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03334">AddTaggedElement()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01422">SetColorProfileElementReference()</a>.
<p>
<pre class="fragment"><div>03235 {
03236     PTAGDATA pTagData;
03237     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>    src, dest;
03238     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    nCount;
03239     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    cnt, i;
03240 
03241     <span class="comment">//</span>
03242     <span class="comment">// Get count of tag items - it is right after the profile header</span>
03243     <span class="comment">//</span>
03244 
03245     nCount = TAG_COUNT(pProfObj);
03246     nCount = FIX_ENDIAN(nCount);
03247 
03248     <span class="comment">//</span>
03249     <span class="comment">// Increase count of tag elements by 1, and add new tag to end of</span>
03250     <span class="comment">// tag table. Move all data below tag table downwards by the size</span>
03251     <span class="comment">// of one tag table entry.</span>
03252     <span class="comment">//</span>
03253 
03254     nCount++;
03255 
03256     dest = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)TAG_DATA(pProfObj) + nCount * <span class="keyword">sizeof</span>(TAGDATA);
03257     src  = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)TAG_DATA(pProfObj) + (nCount - 1) * <span class="keyword">sizeof</span>(TAGDATA);
03258 
03259     <span class="comment">//</span>
03260     <span class="comment">// # bytes to move = file size - header - tag count - tag table</span>
03261     <span class="comment">//</span>
03262 
03263     cnt  = FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize) - <span class="keyword">sizeof</span>(PROFILEHEADER) -
03264                  <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) - (nCount - 1) * <span class="keyword">sizeof</span>(TAGDATA);
03265 
03266     <span class="keywordflow">if</span> (cnt &gt; 0)
03267     {
03268         <span class="comment">//</span>
03269         <span class="comment">// NOTE: CopyMemory() doesn't work for overlapped memory.</span>
03270         <span class="comment">// Use internal function instead.</span>
03271         <span class="comment">//</span>
03272 
03273         <a class="code" href="../../d2/d1/object_8c.html#a10">MyCopyMemory</a>((PVOID)dest, (PVOID)src, cnt);
03274     }
03275 
03276     TAG_COUNT(pProfObj) = FIX_ENDIAN(nCount);
03277 
03278     pTagData = (PTAGDATA)src;
03279     pTagData-&gt;tagType  = FIX_ENDIAN(tagType);
03280     pTagData-&gt;cbSize   = FIX_ENDIAN(cbSize);
03281     pTagData-&gt;dwOffset =  FIX_ENDIAN(dwOffset);
03282 
03283     <span class="comment">//</span>
03284     <span class="comment">// Go through the tag table and update the offsets of all elements</span>
03285     <span class="comment">// by the size of one tag table entry that we inserted.</span>
03286     <span class="comment">//</span>
03287 
03288     pTagData = TAG_DATA(pProfObj);
03289     <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
03290     {
03291         cnt = FIX_ENDIAN(pTagData-&gt;dwOffset);
03292         cnt += <span class="keyword">sizeof</span>(TAGDATA);
03293         pTagData-&gt;dwOffset = FIX_ENDIAN(cnt);
03294         pTagData++;     <span class="comment">// Next element</span>
03295     }
03296 
03297     <span class="comment">//</span>
03298     <span class="comment">// Set final file size</span>
03299     <span class="comment">//</span>
03300 
03301     cnt = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize)) + <span class="keyword">sizeof</span>(TAGDATA);
03302     <span class="keywordflow">if</span> (bNewData)
03303     {
03304         <span class="comment">//</span>
03305         <span class="comment">// The new tag is not a reference to an old tag. Increment</span>
03306         <span class="comment">// file size of size of new data also</span>
03307         <span class="comment">//</span>
03308 
03309         cnt += cbSize;
03310     }
03311     HEADER(pProfObj)-&gt;phSize = FIX_ENDIAN(cnt);
03312 
03313     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03314 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="w32/ntgdi/icm/mscms/profile.c::ChangeTaggedElementSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ChangeTaggedElementSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFOBJ&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTAGDATA&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03490">3490</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03586">MoveProfileData()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00986">SetColorProfileElementSize()</a>.
<p>
<pre class="fragment"><div>03495 {
03496     PTAGDATA pTemp;
03497     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>    pData;
03498     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    nCount, cbOldSize;
03499     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    dwOffset, cnt, i;
03500 
03501     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
03502     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(cbSize &gt; 0);
03503 
03504     <span class="comment">//</span>
03505     <span class="comment">// Get current size of element</span>
03506     <span class="comment">//</span>
03507 
03508     cbOldSize = FIX_ENDIAN(pTagData-&gt;cbSize);
03509 
03510     <span class="keywordflow">if</span> (cbOldSize == cbSize)
03511     {
03512         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;        <span class="comment">// Sizes are the same - Do nothing</span>
03513     }
03514     pData = VIEW(pProfObj) + FIX_ENDIAN(pTagData-&gt;dwOffset);
03515 
03516     <span class="comment">//</span>
03517     <span class="comment">// Do not attempt to move data beyond end of file. There is no need to move</span>
03518     <span class="comment">// anything if the last data item is being resized.</span>
03519     <span class="comment">//</span>
03520 
03521     <span class="keywordflow">if</span> (pData + <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbOldSize) &lt; VIEW(pProfObj) + PROFILE_SIZE(pProfObj))
03522     {
03523         <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a9">MoveProfileData</a>(pProfObj, pData + <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbOldSize), pData + <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbSize),
03524             PROFILE_SIZE(pProfObj) - (LONG)(pData - VIEW(pProfObj)) - <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbOldSize), TRUE);
03525     }
03526 
03527     pTagData-&gt;cbSize = FIX_ENDIAN(cbSize);  <span class="comment">// Set the new size</span>
03528 
03529     <span class="comment">//</span>
03530     <span class="comment">// Get count of tag items - it is right after the profile header</span>
03531     <span class="comment">//</span>
03532 
03533     nCount = TAG_COUNT(pProfObj);
03534     nCount = FIX_ENDIAN(nCount);
03535 
03536     <span class="comment">//</span>
03537     <span class="comment">// Go through the tag table and update the pointers</span>
03538     <span class="comment">//</span>
03539 
03540     pTemp = TAG_DATA(pProfObj);
03541 
03542     dwOffset = FIX_ENDIAN(pTagData-&gt;dwOffset);
03543     <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
03544     {
03545         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwTemp = FIX_ENDIAN(pTemp-&gt;dwOffset);
03546 
03547         <span class="keywordflow">if</span> (dwTemp &gt; dwOffset)
03548         {
03549             dwTemp += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbSize) - <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbOldSize);
03550             pTemp-&gt;dwOffset = FIX_ENDIAN(dwTemp);
03551         }
03552         pTemp++;                     <span class="comment">// Next record</span>
03553     }
03554 
03555     <span class="comment">//</span>
03556     <span class="comment">// Use cnt as a placeholder to calculate file size</span>
03557     <span class="comment">//</span>
03558 
03559     cnt = FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize);
03560     cnt += <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbSize) - <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbOldSize);
03561     HEADER(pProfObj)-&gt;phSize = FIX_ENDIAN(cnt);
03562 
03563     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03564 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="w32/ntgdi/icm/mscms/profile.c::CloseColorProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI CloseColorProfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hProfile</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00271">271</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03053">FreeProfileObject()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/mscmm_2icm32_8c-source.html#l00282">CMCreateTransformExt()</a>, <a class="el" href="../../d9/d5/mscmm_2icm32_8c-source.html#l00167">CMCreateTransformExtInternal()</a>, <a class="el" href="../../d3/d6/profile_8cpp-source.html#l00617">CProfile::CProfile()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l04747">DoesProfileMatchEnumRecord()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l04083">GetProfileClassString()</a>, <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html#l00085">MyNewDeviceLinkFill()</a>, <a class="el" href="../../d3/d6/profile_8cpp-source.html#l00731">CProfile::Uninstall()</a>, and <a class="el" href="../../d3/d6/profile_8cpp-source.html#l00689">CProfile::~CProfile()</a>.
<p>
<pre class="fragment"><div>00274 {
00275     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"CloseColorProfile\n"</span>)));
00276 
00277     <span class="comment">//</span>
00278     <span class="comment">// Validate parameters</span>
00279     <span class="comment">//</span>
00280 
00281     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE))
00282     {
00283         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to CloseColorProfile\n"</span>)));
00284         SetLastError(ERROR_INVALID_PARAMETER);
00285         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00286     }
00287 
00288     <span class="keywordflow">return</span> <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a34">FreeProfileObject</a>(hProfile);
00289 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="w32/ntgdi/icm/mscms/profile.c::ConvertColorNameToIndex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ConvertColorNameToIndex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCOLOR_NAME&nbsp;</td>
          <td class="mdname" nowrap> <em>paColorName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>paIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02283">2283</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00826">GetPreferredCMM()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00149">RIP</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00141">TERSE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>02289 {
02290     PPROFOBJ pProfObj;
02291     PCMMOBJ  pCMMObj;
02292     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    cmmID;
02293     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc;
02294 
02295     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"ConvertColorNameToIndex\n"</span>)));
02296 
02297     <span class="comment">//</span>
02298     <span class="comment">// Validate parameters</span>
02299     <span class="comment">//</span>
02300 
02301     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE)     ||
02302         !paColorName                            ||
02303         dwCount == 0                            ||
02304         IsBadReadPtr(paColorName, dwCount*<span class="keyword">sizeof</span>(COLOR_NAME)) ||
02305         !paIndex                                ||
02306         IsBadWritePtr(paIndex, dwCount*<span class="keyword">sizeof</span>(DWORD)))
02307     {
02308         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to ConvertColorNameToIndex\n"</span>)));
02309         SetLastError(ERROR_INVALID_PARAMETER);
02310         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02311     }
02312 
02313     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
02314 
02315     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
02316 
02317     <span class="comment">//</span>
02318     <span class="comment">// Check the integrity of the profile</span>
02319     <span class="comment">//</span>
02320 
02321     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
02322     {
02323         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to ConvertColorNameToIndex\n"</span>)));
02324         SetLastError(ERROR_INVALID_PROFILE);
02325         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02326     }
02327 
02328     <span class="comment">//</span>
02329     <span class="comment">// Check if application specified CMM is present</span>
02330     <span class="comment">//</span>
02331 
02332     pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a15">GetPreferredCMM</a>();
02333     <span class="keywordflow">if</span> (!pCMMObj ||
02334         !pCMMObj-&gt;fns.pCMConvertColorNameToIndex)
02335     {
02336         <span class="keywordflow">if</span> (pCMMObj)
02337         {
02338             <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02339         }
02340 
02341         <span class="comment">//</span>
02342         <span class="comment">// Get CMM associated with profile. If it does not exist or does not</span>
02343         <span class="comment">// support the CMConvertColorNameToIndex function, get default CMM.</span>
02344         <span class="comment">//</span>
02345 
02346         cmmID = HEADER(pProfObj)-&gt;phCMMType;
02347         cmmID = FIX_ENDIAN(cmmID);
02348 
02349         pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(cmmID);
02350 
02351         <span class="keywordflow">if</span> (!pCMMObj ||
02352             !pCMMObj-&gt;fns.pCMConvertColorNameToIndex)
02353         {
02354             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMM associated with profile could not be used"</span>)));
02355 
02356             <span class="keywordflow">if</span> (pCMMObj)
02357             {
02358                 <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02359             }
02360 
02361             pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
02362 
02363             <span class="keywordflow">if</span> (!pCMMObj || !pCMMObj-&gt;fns.pCMConvertColorNameToIndex)
02364             {
02365                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a9">RIP</a>((__TEXT(<span class="stringliteral">"Default CMM doesn't support CMConvertColorNameToIndex"</span>)));
02366                 SetLastError(ERROR_INVALID_CMM);
02367                 <span class="keywordflow">if</span> (pCMMObj)
02368                 {
02369                     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02370                 }
02371                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02372             }
02373         }
02374     }
02375 
02376     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj-&gt;pView != NULL);
02377 
02378     rc = pCMMObj-&gt;fns.pCMConvertColorNameToIndex(
02379                             hProfile,
02380                             paColorName,
02381                             paIndex,
02382                             dwCount);
02383 
02384     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02385 
02386     <span class="keywordflow">return</span> rc;
02387 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="w32/ntgdi/icm/mscms/profile.c::ConvertIndexToColorName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ConvertIndexToColorName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>paIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCOLOR_NAME&nbsp;</td>
          <td class="mdname" nowrap> <em>paColorName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02409">2409</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00826">GetPreferredCMM()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00149">RIP</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00141">TERSE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>02415 {
02416     PPROFOBJ pProfObj;
02417     PCMMOBJ  pCMMObj;
02418     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    cmmID;
02419     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc;
02420 
02421     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"ConvertIndexToColorName\n"</span>)));
02422 
02423     <span class="comment">//</span>
02424     <span class="comment">// Validate parameters</span>
02425     <span class="comment">//</span>
02426 
02427     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE)     ||
02428         !paIndex                                ||
02429         dwCount == 0                            ||
02430         IsBadWritePtr(paIndex, dwCount*<span class="keyword">sizeof</span>(DWORD))          ||
02431         !paColorName                            ||
02432         IsBadReadPtr(paColorName, dwCount*<span class="keyword">sizeof</span>(COLOR_NAME)))
02433     {
02434         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to ConvertIndexToColorName\n"</span>)));
02435         SetLastError(ERROR_INVALID_PARAMETER);
02436         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02437     }
02438 
02439     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
02440 
02441     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
02442 
02443     <span class="comment">//</span>
02444     <span class="comment">// Check the integrity of the profile</span>
02445     <span class="comment">//</span>
02446 
02447     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
02448     {
02449         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to ConvertIndexToColorName\n"</span>)));
02450         SetLastError(ERROR_INVALID_PROFILE);
02451         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02452     }
02453 
02454     <span class="comment">//</span>
02455     <span class="comment">// Check if application specified CMM is present</span>
02456     <span class="comment">//</span>
02457 
02458     pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a15">GetPreferredCMM</a>();
02459     <span class="keywordflow">if</span> (!pCMMObj ||
02460         !pCMMObj-&gt;fns.pCMConvertIndexToColorName)
02461     {
02462         <span class="keywordflow">if</span> (pCMMObj)
02463         {
02464             <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02465         }
02466 
02467         <span class="comment">//</span>
02468         <span class="comment">// Get CMM associated with profile. If it does not exist or does not</span>
02469         <span class="comment">// support the CMConvertIndexToColorName function, get default CMM.</span>
02470         <span class="comment">//</span>
02471 
02472         cmmID = HEADER(pProfObj)-&gt;phCMMType;
02473         cmmID = FIX_ENDIAN(cmmID);
02474 
02475         pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(cmmID);
02476 
02477         <span class="keywordflow">if</span> (!pCMMObj ||
02478             !pCMMObj-&gt;fns.pCMConvertIndexToColorName)
02479         {
02480             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMM associated with profile could not be used"</span>)));
02481 
02482             <span class="keywordflow">if</span> (pCMMObj)
02483             {
02484                 <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02485             }
02486 
02487             pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
02488 
02489             <span class="keywordflow">if</span> (!pCMMObj || !pCMMObj-&gt;fns.pCMConvertIndexToColorName)
02490             {
02491                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a9">RIP</a>((__TEXT(<span class="stringliteral">"Default CMM doesn't support CMConvertIndexToColorName"</span>)));
02492                 SetLastError(ERROR_INVALID_CMM);
02493                 <span class="keywordflow">if</span> (pCMMObj)
02494                 {
02495                     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02496                 }
02497                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02498             }
02499         }
02500     }
02501 
02502     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj-&gt;pView != NULL);
02503 
02504     rc = pCMMObj-&gt;fns.pCMConvertIndexToColorName(
02505                             hProfile,
02506                             paIndex,
02507                             paColorName,
02508                             dwCount);
02509 
02510     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02511 
02512     <span class="keywordflow">return</span> rc;
02513 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="w32/ntgdi/icm/mscms/profile.c::CreateDeviceLinkProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI CreateDeviceLinkProfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PHPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>pahProfiles</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nProfiles</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>padwIntent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nIntents</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>indexPreferredCMM</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02540">2540</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00149">RIP</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00141">TERSE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>02549 {
02550     PPROFOBJ      pProfObj;
02551     PCMMOBJ       pCMMObj;
02552     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>         cmmID, i;
02553     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>          rc;
02554 
02555     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"CreateDeviceLinkProfile\n"</span>)));
02556 
02557     <span class="comment">//</span>
02558     <span class="comment">// Validate parameters</span>
02559     <span class="comment">//</span>
02560 
02561     <span class="keywordflow">if</span> (nProfiles &lt;= 1 ||
02562         indexPreferredCMM &gt;= nProfiles ||
02563         pahProfiles == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
02564         IsBadReadPtr(pahProfiles, <span class="keyword">sizeof</span>(HPROFILE) * nProfiles) ||
02565         padwIntent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
02566         ((nIntents != nProfiles) &amp;&amp; (nIntents != 1)) ||
02567         IsBadReadPtr(padwIntent, nIntents * <span class="keyword">sizeof</span>(DWORD)))
02568     {
02569         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to CreateDeviceLinkProfile\n"</span>)));
02570         SetLastError(ERROR_INVALID_PARAMETER);
02571         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02572     }
02573 
02574     <span class="keywordflow">for</span> (i=0; i&lt;nProfiles; i++)
02575     {
02576         <span class="keywordflow">if</span> ((pahProfiles[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
02577             ! <a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(pahProfiles[i], OBJ_PROFILE))
02578 
02579         {
02580             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to CreateDeviceLinkProfile\n"</span>)));
02581             SetLastError(ERROR_INVALID_PARAMETER);
02582             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02583         }
02584 
02585         pProfObj = (PPROFOBJ)HDLTOPTR(pahProfiles[i]);
02586 
02587         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
02588 
02589         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj-&gt;pView != NULL);
02590 
02591         <span class="comment">//</span>
02592         <span class="comment">// Quick check on the integrity of the profile</span>
02593         <span class="comment">//</span>
02594 
02595         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
02596         {
02597             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to CreateDeviceLinkProfile\n"</span>)));
02598             SetLastError(ERROR_INVALID_PROFILE);
02599             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02600         }
02601 
02602         <span class="keywordflow">if</span> (i == indexPreferredCMM)
02603         {
02604             <span class="comment">//</span>
02605             <span class="comment">// Get ID of preferred CMM</span>
02606             <span class="comment">//</span>
02607 
02608             cmmID = HEADER(pProfObj)-&gt;phCMMType;
02609             cmmID = FIX_ENDIAN(cmmID);
02610         }
02611     }
02612 
02613     <span class="comment">//</span>
02614     <span class="comment">// Get CMM associated with preferred profile. If it does not exist,</span>
02615     <span class="comment">// get default CMM.</span>
02616     <span class="comment">//</span>
02617 
02618     pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(cmmID);
02619     <span class="keywordflow">if</span> (!pCMMObj || !pCMMObj-&gt;fns.pCMCreateDeviceLinkProfile)
02620     {
02621         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMM associated with profile could not be used"</span>)));
02622 
02623         <span class="keywordflow">if</span> (pCMMObj)
02624         {
02625             <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02626         }
02627 
02628         pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
02629         <span class="keywordflow">if</span> (!pCMMObj)
02630         {
02631             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a9">RIP</a>((__TEXT(<span class="stringliteral">"Default CMM not found\n"</span>)));
02632             SetLastError(ERROR_INVALID_CMM);
02633             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02634         }
02635     }
02636 
02637     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pCMMObj-&gt;fns.pCMCreateDeviceLinkProfile != NULL);
02638 
02639     rc = pCMMObj-&gt;fns.pCMCreateDeviceLinkProfile(
02640                             pahProfiles,
02641                             nProfiles,
02642                             padwIntent,
02643                             nIntents,
02644                             dwFlags,
02645                             pProfileData);
02646 
02647     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02648 
02649     <span class="keywordflow">return</span> rc;
02650 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="w32/ntgdi/icm/mscms/profile.c::CreateProfileFromLogColorSpaceA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI CreateProfileFromLogColorSpaceA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPLOGCOLORSPACEA&nbsp;</td>
          <td class="mdname" nowrap> <em>pLogColorSpace</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>pBuffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00511">511</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02992">InternalCreateProfileFromLCS()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00515 {
00516     <span class="comment">//</span>
00517     <span class="comment">// Internal function is ANSI in Windows 95, call it directly.</span>
00518     <span class="comment">//</span>
00519 
00520     <span class="keywordflow">return</span> <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a2">InternalCreateProfileFromLCS</a>(pLogColorSpace, pBuffer, TRUE);
00521 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="w32/ntgdi/icm/mscms/profile.c::CreateProfileFromLogColorSpaceW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI CreateProfileFromLogColorSpaceW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPLOGCOLORSPACEW&nbsp;</td>
          <td class="mdname" nowrap> <em>pLogColorSpace</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>pBuffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00523">523</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02992">InternalCreateProfileFromLCS()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00527 {
00528     LOGCOLORSPACEA lcs;
00529 
00530     <span class="comment">//</span>
00531     <span class="comment">// Validate Parameters</span>
00532     <span class="comment">//</span>
00533 
00534     <span class="keywordflow">if</span> (! pLogColorSpace ||
00535         IsBadReadPtr(pLogColorSpace, <span class="keyword">sizeof</span>(LOGCOLORSPACEW)) ||
00536         pLogColorSpace-&gt;lcsFilename[0] != <span class="charliteral">'\0'</span>)
00537     {
00538         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to CreateProfileFromLogColorSpace\n"</span>)));
00539         SetLastError(ERROR_INVALID_PARAMETER);
00540         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00541     }
00542 
00543     lcs = *((LPLOGCOLORSPACEA)pLogColorSpace);
00544     lcs.lcsFilename[0] = <span class="charliteral">'\0'</span>;
00545 
00546     <span class="keywordflow">return</span> <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a2">InternalCreateProfileFromLCS</a>(&amp;lcs, pBuffer, FALSE);
00547 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="w32/ntgdi/icm/mscms/profile.c::DeleteTaggedElement" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DeleteTaggedElement           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFOBJ&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTAGDATA&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03400">3400</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03586">MoveProfileData()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00986">SetColorProfileElementSize()</a>.
<p>
<pre class="fragment"><div>03404 {
03405     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>    pData;
03406     PTAGDATA pTemp;
03407     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    cbSize, nCount, dwOffset, i;
03408 
03409     <span class="comment">//</span>
03410     <span class="comment">// Remember location of data and move everything upto the data upwards</span>
03411     <span class="comment">// by size of one tag table entry. Then move everything below the tag data</span>
03412     <span class="comment">// upward by size of data plus size of one tage table entry.</span>
03413     <span class="comment">//</span>
03414 
03415     pData = VIEW(pProfObj) + FIX_ENDIAN(pTagData-&gt;dwOffset);
03416     cbSize = FIX_ENDIAN(pTagData-&gt;cbSize);
03417     cbSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbSize);
03418     dwOffset = FIX_ENDIAN(pTagData-&gt;dwOffset);
03419 
03420     <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a9">MoveProfileData</a>(pProfObj, (PBYTE)(pTagData+1), (PBYTE)pTagData,
03421         (LONG)(pData-(PBYTE)(pTagData+1)), FALSE);
03422 
03423     <span class="comment">//</span>
03424     <span class="comment">// Do not attempt to move data past the tag if we are deleting the last tag</span>
03425     <span class="comment">//</span>
03426 
03427     <span class="keywordflow">if</span> (pData + cbSize &lt; VIEW(pProfObj) + PROFILE_SIZE(pProfObj))
03428     {
03429         <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a9">MoveProfileData</a>(pProfObj, pData+cbSize, pData-<span class="keyword">sizeof</span>(TAGDATA),
03430             PROFILE_SIZE(pProfObj)-(LONG)(pData - VIEW(pProfObj)) - cbSize, TRUE);
03431     }
03432 
03433     <span class="comment">//</span>
03434     <span class="comment">// Get count of tag items - it is right after the profile header, and</span>
03435     <span class="comment">// decrement it by one.</span>
03436     <span class="comment">//</span>
03437 
03438     nCount = TAG_COUNT(pProfObj);
03439     nCount = FIX_ENDIAN(nCount) - 1;
03440     TAG_COUNT(pProfObj) = FIX_ENDIAN(nCount);
03441 
03442     <span class="comment">//</span>
03443     <span class="comment">// Go through the tag table and update the pointers</span>
03444     <span class="comment">//</span>
03445 
03446     pTemp = TAG_DATA(pProfObj);
03447 
03448     <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
03449     {
03450         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwTemp = FIX_ENDIAN(pTemp-&gt;dwOffset);
03451 
03452         <span class="keywordflow">if</span> (dwTemp &gt; dwOffset)
03453         {
03454             dwTemp -= cbSize;        <span class="comment">// cbSize already DWORD aligned</span>
03455         }
03456         dwTemp -= <span class="keyword">sizeof</span>(TAGDATA);
03457         pTemp-&gt;dwOffset = FIX_ENDIAN(dwTemp);
03458         pTemp++;                     <span class="comment">// Next record</span>
03459     }
03460 
03461     <span class="comment">//</span>
03462     <span class="comment">// Use nCount as a placeholder to calculate file size</span>
03463     <span class="comment">//</span>
03464 
03465     nCount = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize));
03466     nCount -= <span class="keyword">sizeof</span>(TAGDATA) + cbSize;
03467     HEADER(pProfObj)-&gt;phSize = FIX_ENDIAN(nCount);
03468 
03469     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03470 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="w32/ntgdi/icm/mscms/profile.c::FreeProfileObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL FreeProfileObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hProfile</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03053">3053</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00088">dwFileSize</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00102">FreeHeapObject()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00260">MemFree()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00271">CloseColorProfile()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02694">InternalOpenColorProfile()</a>.
<p>
<pre class="fragment"><div>03056 {
03057     PPROFOBJ pProfObj;
03058     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a8">dwFileSize</a>;
03059     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    dwErr;
03060 
03061     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(hProfile != NULL);
03062 
03063     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
03064 
03065     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
03066 
03067     dwErr = GetLastError();     <span class="comment">// remember any errors we may have set</span>
03068 
03069     <span class="comment">//</span>
03070     <span class="comment">// Free memory associated with profile data</span>
03071     <span class="comment">//</span>
03072 
03073     <span class="keywordflow">if</span> (pProfObj-&gt;pProfileData)
03074         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>((PVOID)pProfObj-&gt;pProfileData);
03075 
03076     <span class="comment">//</span>
03077     <span class="comment">// If it a memory mapped profile, unmap it</span>
03078     <span class="comment">//</span>
03079 
03080     <span class="keywordflow">if</span> (pProfObj-&gt;dwFlags &amp; MEMORY_MAPPED)
03081     {
03082         <span class="keywordflow">if</span> (pProfObj-&gt;pView)
03083         {
03084             <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a8">dwFileSize</a> = FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize);
03085             UnmapViewOfFile(pProfObj-&gt;pView);
03086         }
03087         <span class="keywordflow">if</span> (pProfObj-&gt;hMap)
03088             CloseHandle(pProfObj-&gt;hMap);
03089 
03090         <span class="keywordflow">if</span> (pProfObj-&gt;hFile)
03091         {
03092 
03093             <span class="comment">//</span>
03094             <span class="comment">// Set the size of the file correctly</span>
03095             <span class="comment">//</span>
03096 
03097             SetFilePointer(pProfObj-&gt;hFile, dwFileSize, NULL, FILE_BEGIN);
03098             SetEndOfFile(pProfObj-&gt;hFile);
03099             CloseHandle(pProfObj-&gt;hFile);
03100         }
03101     }
03102 
03103     <span class="comment">//</span>
03104     <span class="comment">// Free heap object</span>
03105     <span class="comment">//</span>
03106 
03107     pProfObj-&gt;objHdr.dwUseCount--;      <span class="comment">// decrement before freeing</span>
03108     <a class="code" href="../../d2/d1/object_8c.html#a4">FreeHeapObject</a>(hProfile);
03109 
03110     <span class="keywordflow">if</span> (dwErr)
03111     {
03112         SetLastError(dwErr);            <span class="comment">// reset our error</span>
03113     }
03114 
03115     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03116 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="w32/ntgdi/icm/mscms/profile.c::FreeProfileObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL FreeProfileObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="w32/ntgdi/icm/mscms/profile.c::GetColorProfileElement" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI GetColorProfileElement           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TAGTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>tagType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwOffset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pcbSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>pBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PBOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>pbReference</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00817">817</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03646">IsReferenceTag()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d0/d7/profman_8c-source.html#l04841">CheckResMedHftnMatch()</a>, <a class="el" href="../../d7/d2/ntgdi_2icm_2mscmm_2mscmm_2access_8c-source.html#l00085">CMGetPartialProfileElement()</a>, and <a class="el" href="../../d3/d6/profile_8cpp-source.html#l00698">CProfile::TagContents()</a>.
<p>
<pre class="fragment"><div>00825 {
00826     PPROFOBJ pProfObj;
00827     PTAGDATA pTagData;
00828     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    nCount, nBytes, i;
00829     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     found;
00830     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;            <span class="comment">// Assume failure</span>
00831 
00832     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"GetColorProfileElement\n"</span>)));
00833 
00834     <span class="comment">//</span>
00835     <span class="comment">// Validate parameters</span>
00836     <span class="comment">//</span>
00837 
00838     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE) ||
00839         !pcbSize ||
00840         IsBadWritePtr(pcbSize, <span class="keyword">sizeof</span>(DWORD)) ||
00841         !pbReference ||
00842         IsBadWritePtr(pbReference, <span class="keyword">sizeof</span>(BOOL))
00843        )
00844     {
00845         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to GetColorProfileElement\n"</span>)));
00846         SetLastError(ERROR_INVALID_PARAMETER);
00847         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00848     }
00849 
00850     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
00851 
00852     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
00853 
00854     <span class="comment">//</span>
00855     <span class="comment">// Check the integrity of the profile</span>
00856     <span class="comment">//</span>
00857 
00858     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
00859     {
00860         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to GetColorProfileElement\n"</span>)));
00861         SetLastError(ERROR_INVALID_PROFILE);
00862         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00863     }
00864 
00865     <span class="comment">//</span>
00866     <span class="comment">// Get count of tag items - it is right after the profile header</span>
00867     <span class="comment">//</span>
00868 
00869     nCount = TAG_COUNT(pProfObj);
00870     nCount = FIX_ENDIAN(nCount);
00871 
00872     <span class="comment">//</span>
00873     <span class="comment">// Tag data records follow the count.</span>
00874     <span class="comment">//</span>
00875 
00876     pTagData = TAG_DATA(pProfObj);
00877 
00878     <span class="comment">//</span>
00879     <span class="comment">// Check if any of these records match the tag passed in.</span>
00880     <span class="comment">//</span>
00881 
00882     found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00883     tagType = FIX_ENDIAN(tagType);      <span class="comment">// to match tags in profile</span>
00884     <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
00885     {
00886         <span class="keywordflow">if</span> (pTagData-&gt;tagType == tagType)
00887         {
00888             found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00889             <span class="keywordflow">break</span>;
00890         }
00891         pTagData++;                     <span class="comment">// next record</span>
00892     }
00893 
00894     <span class="keywordflow">if</span> (found)
00895     {
00896         <span class="comment">//</span>
00897         <span class="comment">// If pBuffer is NULL, copy size of data</span>
00898         <span class="comment">//</span>
00899 
00900         <span class="keywordflow">if</span> (!pBuffer)
00901         {
00902             *pcbSize = FIX_ENDIAN(pTagData-&gt;cbSize);
00903             SetLastError(ERROR_INSUFFICIENT_BUFFER);
00904         }
00905         <span class="keywordflow">else</span>
00906         {
00907             <span class="comment">//</span>
00908             <span class="comment">// pBuffer is not NULL, get number of bytes to copy</span>
00909             <span class="comment">//</span>
00910 
00911             <span class="keywordflow">if</span> (dwOffset &gt;= FIX_ENDIAN(pTagData-&gt;cbSize))
00912             {
00913                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"dwOffset too large for GetColorProfileElement\n"</span>)));
00914                 SetLastError(ERROR_INVALID_PARAMETER);
00915                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00916             }
00917             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwOffset + *pcbSize &gt; FIX_ENDIAN(pTagData-&gt;cbSize))
00918             {
00919                 nBytes = FIX_ENDIAN(pTagData-&gt;cbSize) - dwOffset;
00920             }
00921             <span class="keywordflow">else</span>
00922             {
00923                 nBytes = *pcbSize;
00924             }
00925 
00926             <span class="comment">//</span>
00927             <span class="comment">// Check if output buffer is large enough</span>
00928             <span class="comment">//</span>
00929 
00930             <span class="keywordflow">if</span> (IsBadWritePtr(pBuffer, nBytes))
00931             {
00932                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Bad buffer passed to GetColorProfileElement\n"</span>)));
00933                 SetLastError(ERROR_INVALID_PARAMETER);
00934                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00935             }
00936 
00937             <span class="comment">//</span>
00938             <span class="comment">// Copy the data into user supplied buffer</span>
00939             <span class="comment">//</span>
00940 
00941             CopyMemory((PVOID)pBuffer,
00942                 (PVOID)(pProfObj-&gt;pView + FIX_ENDIAN(pTagData-&gt;dwOffset)
00943                 + dwOffset), nBytes);
00944             *pcbSize = nBytes;
00945             rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;                      <span class="comment">// Success!</span>
00946         }
00947 
00948         <span class="comment">//</span>
00949         <span class="comment">// Check if multiple tags reference this tag's data</span>
00950         <span class="comment">//</span>
00951 
00952         *pbReference = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a10">IsReferenceTag</a>(pProfObj, pTagData);
00953     }
00954     <span class="keywordflow">else</span>
00955     {
00956         SetLastError(ERROR_TAG_NOT_FOUND);
00957     }
00958 
00959     <span class="keywordflow">return</span> rc;
00960 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="w32/ntgdi/icm/mscms/profile.c::GetColorProfileElementTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI GetColorProfileElementTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTAGTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>pTagType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00725">725</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00730 {
00731     PPROFOBJ pProfObj;
00732     PTAGDATA pTagData;
00733     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    nCount;
00734     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00735 
00736     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"GetColorProfileElementTag\n"</span>)));
00737 
00738     <span class="comment">//</span>
00739     <span class="comment">// Validate parameters</span>
00740     <span class="comment">//</span>
00741 
00742     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE) ||
00743         IsBadWritePtr(pTagType, <span class="keyword">sizeof</span>(TAGTYPE)) ||
00744         dwIndex &lt;= 0)
00745     {
00746         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to GetColorProfileElementTag\n"</span>)));
00747         SetLastError(ERROR_INVALID_PARAMETER);
00748         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00749     }
00750 
00751     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
00752 
00753     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
00754 
00755     <span class="comment">//</span>
00756     <span class="comment">// Check the integrity of the profile</span>
00757     <span class="comment">//</span>
00758 
00759     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
00760     {
00761         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to GetColorProfileElementTag\n"</span>)));
00762         SetLastError(ERROR_INVALID_PROFILE);
00763         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00764     }
00765 
00766     <span class="comment">//</span>
00767     <span class="comment">// Get count of tag items - it is right after the profile header</span>
00768     <span class="comment">//</span>
00769 
00770     nCount = TAG_COUNT(pProfObj);
00771     nCount = FIX_ENDIAN(nCount);
00772 
00773     <span class="keywordflow">if</span> (dwIndex &gt; nCount)
00774     {
00775         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"GetColorProfileElementTag:index (%d) invalid\n"</span>), dwIndex));
00776         SetLastError(ERROR_INVALID_PARAMETER);
00777         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00778     }
00779 
00780     <span class="comment">//</span>
00781     <span class="comment">// Tag data records follow the count.</span>
00782     <span class="comment">//</span>
00783 
00784     pTagData = TAG_DATA(pProfObj);
00785 
00786     *pTagType = FIX_ENDIAN(pTagData[dwIndex-1].tagType);    <span class="comment">// 1-based index</span>
00787 
00788     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00789 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="w32/ntgdi/icm/mscms/profile.c::GetColorProfileFromHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI GetColorProfileFromHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfileData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pcbSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00310">310</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00088">dwFileSize</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00315 {
00316     PPROFOBJ pProfObj;
00317     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a8">dwFileSize</a>;
00318     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00319 
00320     <span class="comment">//</span>
00321     <span class="comment">// ValidatePrameters</span>
00322     <span class="comment">//</span>
00323 
00324     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE) ||
00325         !pcbSize ||
00326         IsBadWritePtr(pcbSize, <span class="keyword">sizeof</span>(DWORD)) ||
00327         (pProfileData &amp;&amp;
00328          IsBadWritePtr(pProfileData, *pcbSize)))
00329     {
00330         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to CloseColorProfile\n"</span>)));
00331         SetLastError(ERROR_INVALID_PARAMETER);
00332         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00333     }
00334 
00335     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
00336 
00337     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
00338 
00339     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a8">dwFileSize</a> = FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize);
00340 
00341     <span class="keywordflow">if</span> (pProfileData &amp;&amp; *pcbSize &gt;= <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a8">dwFileSize</a>)
00342     {
00343         CopyMemory(pProfileData, pProfObj-&gt;pView, dwFileSize);
00344         rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00345     }
00346     <span class="keywordflow">else</span>
00347     {
00348         SetLastError(ERROR_INSUFFICIENT_BUFFER);
00349     }
00350 
00351     *pcbSize = <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a8">dwFileSize</a>;
00352 
00353     <span class="keywordflow">return</span> rc;
00354 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="w32/ntgdi/icm/mscms/profile.c::GetColorProfileHeader" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI GetColorProfileHeader           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PPROFILEHEADER&nbsp;</td>
          <td class="mdname" nowrap> <em>pHeader</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01577">1577</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/ntgdi_2icm_2mscmm_2mscmm_2access_8c-source.html#l00030">CMGetProfileHeader()</a>, <a class="el" href="../../d3/d6/profile_8cpp-source.html#l00617">CProfile::CProfile()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l04747">DoesProfileMatchEnumRecord()</a>, and <a class="el" href="../../d0/d7/profman_8c-source.html#l04083">GetProfileClassString()</a>.
<p>
<pre class="fragment"><div>01581 {
01582     PPROFOBJ pProfObj;
01583     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    nCount, i, temp;
01584 
01585     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"GetColorProfileHeader\n"</span>)));
01586 
01587     <span class="comment">//</span>
01588     <span class="comment">// Validate parameters</span>
01589     <span class="comment">//</span>
01590 
01591     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE) ||
01592         IsBadWritePtr(pHeader, <span class="keyword">sizeof</span>(PROFILEHEADER)))
01593     {
01594         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to GetColorProfileHeader\n"</span>)));
01595         SetLastError(ERROR_INVALID_PARAMETER);
01596         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01597     }
01598 
01599     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
01600 
01601     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
01602 
01603     <span class="comment">//</span>
01604     <span class="comment">// Check the integrity of the profile.</span>
01605     <span class="comment">//</span>
01606 
01607     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
01608     {
01609         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to GetColorProfileHeader\n"</span>)));
01610         SetLastError(ERROR_INVALID_PROFILE);
01611         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01612     }
01613 
01614     CopyMemory((PVOID)pHeader, (PVOID)pProfObj-&gt;pView,
01615         <span class="keyword">sizeof</span>(PROFILEHEADER));
01616 
01617     <span class="comment">//</span>
01618     <span class="comment">// Fix up all fields to platform specific values.</span>
01619     <span class="comment">// The following code assumes that the profile header is a</span>
01620     <span class="comment">// multiple of DWORDs which it is!</span>
01621     <span class="comment">//</span>
01622 
01623     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<span class="keyword">sizeof</span>(PROFILEHEADER) % <span class="keyword">sizeof</span>(DWORD) == 0);
01624 
01625     nCount = <span class="keyword">sizeof</span>(PROFILEHEADER)/<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
01626     <span class="keywordflow">for</span> (i=0; i&lt;nCount;i++)
01627     {
01628         temp = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)((PDWORD)pHeader)[i];
01629         ((PDWORD)pHeader)[i] = FIX_ENDIAN(temp);
01630     }
01631 
01632     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01633 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="w32/ntgdi/icm/mscms/profile.c::GetCountColorProfileElements" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI GetCountColorProfileElements           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pnCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00659">659</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00663 {
00664     PPROFOBJ pProfObj;
00665 
00666     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"GetCountColorProfileElements\n"</span>)));
00667 
00668     <span class="comment">//</span>
00669     <span class="comment">// Validate parameters</span>
00670     <span class="comment">//</span>
00671 
00672     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE) ||
00673         !pnCount ||
00674         IsBadWritePtr(pnCount, <span class="keyword">sizeof</span>(DWORD)))
00675     {
00676         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to GetCountColorProfileElements\n"</span>)));
00677         SetLastError(ERROR_INVALID_PARAMETER);
00678         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00679     }
00680 
00681     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
00682 
00683     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
00684 
00685     <span class="comment">//</span>
00686     <span class="comment">// Check the integrity of the profile</span>
00687     <span class="comment">//</span>
00688 
00689     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
00690     {
00691         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to GetCountColorProfileElements\n"</span>)));
00692         SetLastError(ERROR_INVALID_PROFILE);
00693         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00694     }
00695 
00696     <span class="comment">//</span>
00697     <span class="comment">// Get count of tag items - it is right after the profile header</span>
00698     <span class="comment">//</span>
00699 
00700     *pnCount = TAG_COUNT(pProfObj);
00701     *pnCount = FIX_ENDIAN(*pnCount);
00702 
00703     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00704 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="w32/ntgdi/icm/mscms/profile.c::GetNamedProfileInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI GetNamedProfileInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PNAMED_PROFILE_INFO&nbsp;</td>
          <td class="mdname" nowrap> <em>pNamedProfileInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02166">2166</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00826">GetPreferredCMM()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00149">RIP</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00141">TERSE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>02170 {
02171     PPROFOBJ pProfObj;
02172     PCMMOBJ  pCMMObj;
02173     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    cmmID;
02174     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc;
02175 
02176     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"GetNamedProfileInfo\n"</span>)));
02177 
02178     <span class="comment">//</span>
02179     <span class="comment">// Validate parameters</span>
02180     <span class="comment">//</span>
02181 
02182     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE)     ||
02183         !pNamedProfileInfo                      ||
02184         IsBadWritePtr(pNamedProfileInfo, <span class="keyword">sizeof</span>(NAMED_PROFILE_INFO)))
02185     {
02186         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to GetNamedProfileInfo\n"</span>)));
02187         SetLastError(ERROR_INVALID_PARAMETER);
02188         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02189     }
02190 
02191     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
02192 
02193     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
02194 
02195     <span class="comment">//</span>
02196     <span class="comment">// Check the integrity of the profile</span>
02197     <span class="comment">//</span>
02198 
02199     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
02200     {
02201         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to GetNamedProfileInfo\n"</span>)));
02202         SetLastError(ERROR_INVALID_PROFILE);
02203         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02204     }
02205 
02206     <span class="comment">//</span>
02207     <span class="comment">// Check if application specified CMM is present</span>
02208     <span class="comment">//</span>
02209 
02210     pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a15">GetPreferredCMM</a>();
02211     <span class="keywordflow">if</span> (!pCMMObj ||
02212         !pCMMObj-&gt;fns.pCMGetNamedProfileInfo)
02213     {
02214         <span class="keywordflow">if</span> (pCMMObj)
02215         {
02216             <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02217         }
02218 
02219         <span class="comment">//</span>
02220         <span class="comment">// Get CMM associated with profile. If it does not exist or does not</span>
02221         <span class="comment">// support the CMGetNamedProfileInfo function, get default CMM.</span>
02222         <span class="comment">//</span>
02223 
02224         cmmID = HEADER(pProfObj)-&gt;phCMMType;
02225         cmmID = FIX_ENDIAN(cmmID);
02226 
02227         pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(cmmID);
02228 
02229         <span class="keywordflow">if</span> (!pCMMObj ||
02230             !pCMMObj-&gt;fns.pCMGetNamedProfileInfo)
02231         {
02232             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMM associated with profile could not be used"</span>)));
02233 
02234             <span class="keywordflow">if</span> (pCMMObj)
02235             {
02236                 <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02237             }
02238 
02239             pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
02240 
02241             <span class="keywordflow">if</span> (!pCMMObj || !pCMMObj-&gt;fns.pCMGetNamedProfileInfo)
02242             {
02243                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a9">RIP</a>((__TEXT(<span class="stringliteral">"Default CMM doesn't support CMValidateProfile"</span>)));
02244                 SetLastError(ERROR_INVALID_CMM);
02245                 <span class="keywordflow">if</span> (pCMMObj)
02246                 {
02247                     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02248                 }
02249                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02250             }
02251         }
02252     }
02253 
02254     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj-&gt;pView != NULL);
02255 
02256     rc = pCMMObj-&gt;fns.pCMGetNamedProfileInfo(hProfile, pNamedProfileInfo);
02257 
02258     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02259 
02260     <span class="keywordflow">return</span> rc;
02261 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="w32/ntgdi/icm/mscms/profile.c::GetPS2ColorRenderingDictionary" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI GetPS2ColorRenderingDictionary           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwIntent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pcbSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PBOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>pbBinary</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02027">2027</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00826">GetPreferredCMM()</a>, <a class="el" href="../../d3/d8/ps2_8c-source.html#l00713">InternalGetPS2ColorRenderingDictionary()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00141">TERSE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00140">VERBOSE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00091">CreateCRDControl()</a>.
<p>
<pre class="fragment"><div>02034 {
02035     PPROFOBJ pProfObj;
02036     PCMMOBJ  pCMMObj;
02037     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    cmmID;
02038     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc;
02039 
02040     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"GetPS2ColorRenderingDictionary\n"</span>)));
02041 
02042     <span class="comment">//</span>
02043     <span class="comment">// Validate parameters</span>
02044     <span class="comment">//</span>
02045 
02046     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE)     ||
02047         IsBadWritePtr(pcbSize, <span class="keyword">sizeof</span>(DWORD))   ||
02048         (pBuffer &amp;&amp;
02049          IsBadWritePtr(pBuffer, *pcbSize)
02050         )                                       ||
02051         IsBadWritePtr(pbBinary, <span class="keyword">sizeof</span>(BOOL))
02052        )
02053     {
02054         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to GetPS2ColorRenderingDictionary\n"</span>)));
02055         SetLastError(ERROR_INVALID_PARAMETER);
02056         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02057     }
02058 
02059     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
02060 
02061     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
02062 
02063     <span class="comment">//</span>
02064     <span class="comment">// Check the integrity of the profile</span>
02065     <span class="comment">//</span>
02066 
02067     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
02068     {
02069         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to GetPS2ColorRenderingDictionary\n"</span>)));
02070         SetLastError(ERROR_INVALID_PROFILE);
02071         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02072     }
02073 
02074     <span class="comment">//</span>
02075     <span class="comment">// Check if application specified CMM is present</span>
02076     <span class="comment">//</span>
02077 
02078     pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a15">GetPreferredCMM</a>();
02079     <span class="keywordflow">if</span> (!pCMMObj || (pCMMObj-&gt;dwFlags &amp; CMM_DONT_USE_PS2_FNS) ||
02080         !pCMMObj-&gt;fns.pCMGetPS2ColorRenderingDictionary)
02081     {
02082         <span class="keywordflow">if</span> (pCMMObj)
02083         {
02084             pCMMObj-&gt;dwFlags |= CMM_DONT_USE_PS2_FNS;
02085             <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02086         }
02087 
02088         <span class="comment">//</span>
02089         <span class="comment">// Get CMM associated with profile. If it does not exist or does not</span>
02090         <span class="comment">// support the CMGetPS2ColorSpaceArray function, get default CMM.</span>
02091         <span class="comment">//</span>
02092 
02093         cmmID = HEADER(pProfObj)-&gt;phCMMType;
02094         cmmID = FIX_ENDIAN(cmmID);
02095 
02096         pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(cmmID);
02097 
02098         <span class="keywordflow">if</span> (!pCMMObj || (pCMMObj-&gt;dwFlags &amp; CMM_DONT_USE_PS2_FNS) ||
02099             !pCMMObj-&gt;fns.pCMGetPS2ColorRenderingDictionary)
02100         {
02101             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMM associated with profile could not be used"</span>)));
02102 
02103             <span class="keywordflow">if</span> (pCMMObj)
02104             {
02105                 pCMMObj-&gt;dwFlags |= CMM_DONT_USE_PS2_FNS;
02106                 <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02107             }
02108 
02109             pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
02110 
02111             <span class="keywordflow">if</span> (!pCMMObj || !pCMMObj-&gt;fns.pCMGetPS2ColorRenderingDictionary)
02112             {
02113                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Default CMM doesn't support CMGetPS2ColorRenderingDictionary\n"</span>)));
02114                 <span class="keywordflow">if</span> (pCMMObj)
02115                 {
02116                     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02117                     pCMMObj = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02118                 }
02119             }
02120         }
02121     }
02122 
02123     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj-&gt;pView != NULL);
02124 
02125     <span class="keywordflow">if</span> (pCMMObj)
02126     {
02127         rc = pCMMObj-&gt;fns.pCMGetPS2ColorRenderingDictionary(hProfile, dwIntent,
02128             pBuffer, pcbSize, pbBinary);
02129     }
02130     <span class="keywordflow">else</span>
02131     {
02132         rc = <a class="code" href="../../d2/d9/ps2_8c.html#a256">InternalGetPS2ColorRenderingDictionary</a>(pProfObj-&gt;pView, dwIntent,
02133             pBuffer, pcbSize, pbBinary);
02134     }
02135 
02136     <span class="keywordflow">if</span> (pCMMObj)
02137     {
02138         <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
02139     }
02140 
02141     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a2">VERBOSE</a>((__TEXT(<span class="stringliteral">"GetPS2ColorRenderingDictionary returning %s\n"</span>),
02142         rc ? <span class="stringliteral">"TRUE"</span> : <span class="stringliteral">"FALSE"</span>));
02143 
02144     <span class="keywordflow">return</span> rc;
02145 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="w32/ntgdi/icm/mscms/profile.c::GetPS2ColorRenderingIntent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI GetPS2ColorRenderingIntent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwIntent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pcbSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01887">1887</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00826">GetPreferredCMM()</a>, <a class="el" href="../../d3/d8/ps2_8c-source.html#l00612">InternalGetPS2ColorRenderingIntent()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00141">TERSE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00140">VERBOSE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00025">CreateINTENTControl()</a>.
<p>
<pre class="fragment"><div>01893 {
01894     PPROFOBJ pProfObj;
01895     PCMMOBJ  pCMMObj;
01896     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    cmmID;
01897     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc;
01898 
01899     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"GetPS2ColorRenderingIntent\n"</span>)));
01900 
01901     <span class="comment">//</span>
01902     <span class="comment">// Validate parameters</span>
01903     <span class="comment">//</span>
01904 
01905     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE) ||
01906         IsBadWritePtr(pcbSize, <span class="keyword">sizeof</span>(DWORD)) ||
01907         (pBuffer &amp;&amp;
01908          IsBadWritePtr(pBuffer, *pcbSize)
01909         )
01910        )
01911     {
01912         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to GetPS2ColorRenderingIntent\n"</span>)));
01913         SetLastError(ERROR_INVALID_PARAMETER);
01914         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01915     }
01916 
01917     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
01918 
01919     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
01920 
01921     <span class="comment">//</span>
01922     <span class="comment">// Check the integrity of the profile</span>
01923     <span class="comment">//</span>
01924 
01925     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
01926     {
01927         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to GetPS2ColorRenderingIntent\n"</span>)));
01928         SetLastError(ERROR_INVALID_PROFILE);
01929         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01930     }
01931 
01932     <span class="comment">//</span>
01933     <span class="comment">// Check if application specified CMM is present</span>
01934     <span class="comment">//</span>
01935 
01936     pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a15">GetPreferredCMM</a>();
01937     <span class="keywordflow">if</span> (!pCMMObj || (pCMMObj-&gt;dwFlags &amp; CMM_DONT_USE_PS2_FNS) ||
01938         !pCMMObj-&gt;fns.pCMGetPS2ColorRenderingIntent)
01939     {
01940         <span class="keywordflow">if</span> (pCMMObj)
01941         {
01942             pCMMObj-&gt;dwFlags |= CMM_DONT_USE_PS2_FNS;
01943             <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
01944         }
01945 
01946         <span class="comment">//</span>
01947         <span class="comment">// Get CMM associated with profile. If it does not exist or does not</span>
01948         <span class="comment">// support the CMGetPS2ColorSpaceArray function, get default CMM.</span>
01949         <span class="comment">//</span>
01950 
01951         cmmID = HEADER(pProfObj)-&gt;phCMMType;
01952         cmmID = FIX_ENDIAN(cmmID);
01953 
01954         pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(cmmID);
01955 
01956         <span class="keywordflow">if</span> (!pCMMObj || (pCMMObj-&gt;dwFlags &amp; CMM_DONT_USE_PS2_FNS) ||
01957             !pCMMObj-&gt;fns.pCMGetPS2ColorRenderingIntent)
01958         {
01959             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMM associated with profile could not be used"</span>)));
01960 
01961             <span class="keywordflow">if</span> (pCMMObj)
01962             {
01963                 pCMMObj-&gt;dwFlags |= CMM_DONT_USE_PS2_FNS;
01964                 <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
01965             }
01966 
01967             pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
01968 
01969             <span class="keywordflow">if</span> (!pCMMObj || !pCMMObj-&gt;fns.pCMGetPS2ColorRenderingIntent)
01970             {
01971                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Default CMM doesn't support CMGetPS2ColorRenderingIntent\n"</span>)));
01972                 <span class="keywordflow">if</span> (pCMMObj)
01973                 {
01974                     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
01975                     pCMMObj = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01976                 }
01977             }
01978         }
01979     }
01980 
01981     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj-&gt;pView != NULL);
01982 
01983     <span class="keywordflow">if</span> (pCMMObj)
01984     {
01985         rc = pCMMObj-&gt;fns.pCMGetPS2ColorRenderingIntent(hProfile,
01986             dwIntent, pBuffer, pcbSize);
01987     }
01988     <span class="keywordflow">else</span>
01989     {
01990         rc = <a class="code" href="../../d2/d9/ps2_8c.html#a255">InternalGetPS2ColorRenderingIntent</a>(pProfObj-&gt;pView, dwIntent,
01991             pBuffer, pcbSize);
01992     }
01993 
01994     <span class="keywordflow">if</span> (pCMMObj)
01995     {
01996         <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
01997     }
01998 
01999     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a2">VERBOSE</a>((__TEXT(<span class="stringliteral">"GetPS2ColorRenderingIntent returning %s\n"</span>),
02000         rc ? <span class="stringliteral">"TRUE"</span> : <span class="stringliteral">"FALSE"</span>));
02001 
02002     <span class="keywordflow">return</span> rc;
02003 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="w32/ntgdi/icm/mscms/profile.c::GetPS2ColorSpaceArray" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI GetPS2ColorSpaceArray           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwIntent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwCSAType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pcbSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>pbBinary</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01744">1744</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00826">GetPreferredCMM()</a>, <a class="el" href="../../d3/d8/ps2_8c-source.html#l00464">InternalGetPS2ColorSpaceArray()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00141">TERSE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00140">VERBOSE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/aug98_2test_2control_8c-source.html#l00232">ColorSpaceControl()</a>.
<p>
<pre class="fragment"><div>01752 {
01753     PPROFOBJ pProfObj;
01754     PCMMOBJ  pCMMObj;
01755     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    cmmID;
01756     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc;
01757 
01758     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"GetPS2ColorSpaceArray\n"</span>)));
01759 
01760     <span class="comment">//</span>
01761     <span class="comment">// Validate parameters</span>
01762     <span class="comment">//</span>
01763 
01764     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE)   ||
01765         IsBadWritePtr(pcbSize, <span class="keyword">sizeof</span>(DWORD)) ||
01766         (pBuffer &amp;&amp;
01767          IsBadWritePtr(pBuffer, *pcbSize)
01768         )                                     ||
01769         IsBadWritePtr(pbBinary, <span class="keyword">sizeof</span>(BOOL))
01770        )
01771     {
01772         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to GetPS2ColorSpaceArray\n"</span>)));
01773         SetLastError(ERROR_INVALID_PARAMETER);
01774         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01775     }
01776 
01777     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
01778 
01779     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
01780 
01781     <span class="comment">//</span>
01782     <span class="comment">// Check the integrity of the profile</span>
01783     <span class="comment">//</span>
01784 
01785     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
01786     {
01787         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to GetPS2ColorSpaceArray\n"</span>)));
01788         SetLastError(ERROR_INVALID_PROFILE);
01789         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01790     }
01791 
01792     <span class="comment">//</span>
01793     <span class="comment">// Check if application specified CMM is present</span>
01794     <span class="comment">//</span>
01795 
01796     pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a15">GetPreferredCMM</a>();
01797     <span class="keywordflow">if</span> (!pCMMObj || (pCMMObj-&gt;dwFlags &amp; CMM_DONT_USE_PS2_FNS) ||
01798         !pCMMObj-&gt;fns.pCMGetPS2ColorSpaceArray)
01799     {
01800         <span class="keywordflow">if</span> (pCMMObj)
01801         {
01802             pCMMObj-&gt;dwFlags |= CMM_DONT_USE_PS2_FNS;
01803             <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
01804         }
01805 
01806         <span class="comment">//</span>
01807         <span class="comment">// Get CMM associated with profile. If it does not exist or does not</span>
01808         <span class="comment">// support the CMGetPS2ColorSpaceArray function, get default CMM.</span>
01809         <span class="comment">//</span>
01810 
01811         cmmID = HEADER(pProfObj)-&gt;phCMMType;
01812         cmmID = FIX_ENDIAN(cmmID);
01813 
01814         pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(cmmID);
01815 
01816         <span class="keywordflow">if</span> (!pCMMObj || (pCMMObj-&gt;dwFlags &amp; CMM_DONT_USE_PS2_FNS) ||
01817             !pCMMObj-&gt;fns.pCMGetPS2ColorSpaceArray)
01818         {
01819             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMM associated with profile could not be used"</span>)));
01820 
01821             <span class="keywordflow">if</span> (pCMMObj)
01822             {
01823                 pCMMObj-&gt;dwFlags |= CMM_DONT_USE_PS2_FNS;
01824                 <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
01825             }
01826 
01827             pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
01828 
01829             <span class="keywordflow">if</span> (!pCMMObj || !pCMMObj-&gt;fns.pCMGetPS2ColorSpaceArray)
01830             {
01831                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Default CMM doesn't support CMGetPS2ColorSpaceArray\n"</span>)));
01832                 <span class="keywordflow">if</span> (pCMMObj)
01833                 {
01834                     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
01835                     pCMMObj = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01836                 }
01837             }
01838         }
01839     }
01840 
01841     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj-&gt;pView != NULL);
01842 
01843     <span class="keywordflow">if</span> (pCMMObj)
01844     {
01845         rc = pCMMObj-&gt;fns.pCMGetPS2ColorSpaceArray(hProfile, dwIntent, dwCSAType,
01846             pBuffer, pcbSize, pbBinary);
01847     }
01848     <span class="keywordflow">else</span>
01849     {
01850         rc = <a class="code" href="../../d2/d9/ps2_8c.html#a254">InternalGetPS2ColorSpaceArray</a>(pProfObj-&gt;pView, dwIntent,
01851             dwCSAType, pBuffer, pcbSize, pbBinary);
01852     }
01853 
01854     <span class="keywordflow">if</span> (pCMMObj)
01855     {
01856         <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
01857     }
01858 
01859     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a2">VERBOSE</a>((__TEXT(<span class="stringliteral">"GetPS2ColorSpaceArray returning %s\n"</span>),
01860         rc ? <span class="stringliteral">"TRUE"</span> : <span class="stringliteral">"FALSE"</span>));
01861 
01862     <span class="keywordflow">return</span> rc;
01863 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="w32/ntgdi/icm/mscms/profile.c::GrowProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL GrowProfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFOBJ&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03135">3135</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00234">MemReAlloc()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00020">PROFILE_GROWTHCUSHION</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03334">AddTaggedElement()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01422">SetColorProfileElementReference()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00986">SetColorProfileElementSize()</a>.
<p>
<pre class="fragment"><div>03139 {
03140     <span class="keywordflow">if</span> (pProfObj-&gt;dwMapSize &gt;= dwNewSize)
03141         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03142 
03143     <span class="comment">//</span>
03144     <span class="comment">// Add cushion for future growth</span>
03145     <span class="comment">//</span>
03146 
03147     dwNewSize += <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a0">PROFILE_GROWTHCUSHION</a>;
03148 
03149     <span class="keywordflow">if</span> (pProfObj-&gt;dwFlags &amp; MEMORY_MAPPED)
03150     {
03151         <span class="comment">//</span>
03152         <span class="comment">// Profile is a memory mapped file</span>
03153         <span class="comment">//</span>
03154 
03155         <span class="comment">//</span>
03156         <span class="comment">// Close previous view and map</span>
03157         <span class="comment">//</span>
03158 
03159         UnmapViewOfFile(pProfObj-&gt;pView);
03160         CloseHandle(pProfObj-&gt;hMap);
03161 
03162         pProfObj-&gt;hMap = CreateFileMapping(pProfObj-&gt;hFile, 0,
03163             PAGE_READWRITE, 0, dwNewSize, 0);
03164 
03165         <span class="keywordflow">if</span> (!pProfObj-&gt;hMap)
03166         {
03167             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Err %ld, could not recreate map of profile %s\n"</span>),
03168                 GetLastError(), pProfObj-&gt;pProfileData));
03169             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03170         }
03171 
03172         pProfObj-&gt;pView = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) MapViewOfFile(pProfObj-&gt;hMap, FILE_MAP_ALL_ACCESS, 0, 0, 0);
03173         <span class="keywordflow">if</span> (!pProfObj-&gt;pView)
03174         {
03175             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Err %ld, could not recreate view of profile %s\n"</span>),
03176                 GetLastError(), pProfObj-&gt;pProfileData));
03177             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03178         }
03179 
03180 
03181         <span class="comment">//</span>
03182         <span class="comment">// Set new size</span>
03183         <span class="comment">//</span>
03184 
03185         pProfObj-&gt;dwMapSize = dwNewSize;
03186     }
03187     <span class="keywordflow">else</span>
03188     {
03189         <span class="comment">//</span>
03190         <span class="comment">// Profile is an in-memory buffer</span>
03191         <span class="comment">//</span>
03192 
03193         PVOID pTemp = <a class="code" href="../../d2/d1/object_8c.html#a8">MemReAlloc</a>(pProfObj-&gt;pView, dwNewSize);
03194 
03195         <span class="keywordflow">if</span> (!pTemp)
03196         {
03197             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Error reallocating memory\n"</span>)));
03198             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03199         }
03200 
03201         pProfObj-&gt;pView = pProfObj-&gt;pProfileData = pTemp;
03202         pProfObj-&gt;cbDataSize = pProfObj-&gt;dwMapSize = dwNewSize;
03203     }
03204 
03205     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03206 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="w32/ntgdi/icm/mscms/profile.c::InternalCreateProfileFromLCS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InternalCreateProfileFromLCS           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d6/jul98_2test_2icm_8h.html#a39">LPLOGCOLORSPACE</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> *&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02992">2992</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00149">RIP</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00511">CreateProfileFromLogColorSpaceA()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00523">CreateProfileFromLogColorSpaceW()</a>.
<p>
<pre class="fragment"><div>02997 {
02998     PCMMOBJ  pCMMObj = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02999     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc;
03000 
03001     <span class="comment">//</span>
03002     <span class="comment">// Validate parameters</span>
03003     <span class="comment">//</span>
03004 
03005     <span class="keywordflow">if</span> (bValidateParams &amp;&amp;
03006         (! pLogColorSpace ||
03007          IsBadReadPtr(pLogColorSpace, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d0/structtagLOGCOLORSPACE.html">LOGCOLORSPACE</a>)) ||
03008          pLogColorSpace-&gt;lcsFilename[0] != <span class="charliteral">'\0'</span>))
03009     {
03010         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to CreateProfileFromLogColorSpace\n"</span>)));
03011         SetLastError(ERROR_INVALID_PARAMETER);
03012         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03013     }
03014 
03015     <span class="comment">//</span>
03016     <span class="comment">// We use the default CMM for this</span>
03017     <span class="comment">//</span>
03018 
03019     pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
03020     <span class="keywordflow">if</span> (!pCMMObj)
03021     {
03022         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a9">RIP</a>((__TEXT(<span class="stringliteral">"Default CMM not found\n"</span>)));
03023         SetLastError(ERROR_INVALID_CMM);
03024         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03025     }
03026 
03027 
03028     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pCMMObj-&gt;fns.pCMCreateProfile != NULL);
03029 
03030     rc = pCMMObj-&gt;fns.pCMCreateProfile(pLogColorSpace, pBuffer);
03031 
03032     <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
03033 
03034     <span class="keywordflow">return</span> rc;
03035 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="w32/ntgdi/icm/mscms/profile.c::InternalOpenColorProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HPROFILE InternalOpenColorProfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFILE&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02694">2694</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d3/d0/object_8c-source.html#l00046">AllocateHeapObject()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03053">FreeProfileObject()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l04165">GetFilenameFromPath()</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00121">gszBackslash</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00212">INVALID_HANDLE_VALUE</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00205">MemAlloc()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00260">MemFree()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d8/ntfsexp_8h.html#a141a69">OPEN_EXISTING</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00020">PROFILE_GROWTHCUSHION</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00153">OpenColorProfileA()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00168">OpenColorProfileW()</a>.
<p>
<pre class="fragment"><div>02700 {
02701     SECURITY_ATTRIBUTES sa;
02702     PPROFOBJ  pProfObj;
02703     HPROFILE  hProfile;
02704     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     dwMapSize;
02705     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>      bNewFile = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02706     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>      bError = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;      <span class="comment">// Assume failure</span>
02707 
02708     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"OpenColorProfile\n"</span>)));
02709 
02710     <span class="comment">//</span>
02711     <span class="comment">// Validate parameters</span>
02712     <span class="comment">//</span>
02713 
02714     <span class="keywordflow">if</span> (!pProfile ||
02715         IsBadReadPtr(pProfile, <span class="keyword">sizeof</span>(PROFILE)) ||
02716         (pProfile-&gt;pProfileData &amp;&amp;
02717          IsBadReadPtr(pProfile-&gt;pProfileData, pProfile-&gt;cbDataSize)) ||
02718         (!pProfile-&gt;pProfileData &amp;&amp;
02719          (pProfile-&gt;cbDataSize != 0)) ||
02720         (pProfile-&gt;dwType != PROFILE_FILENAME &amp;&amp;
02721          pProfile-&gt;dwType != PROFILE_MEMBUFFER
02722         ) ||
02723         (dwDesiredAccess != PROFILE_READ &amp;&amp;
02724          dwDesiredAccess != PROFILE_READWRITE
02725         )
02726        )
02727     {
02728         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to OpenColorProfile\n"</span>)));
02729         SetLastError(ERROR_INVALID_PARAMETER);
02730         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02731     }
02732 
02733     <span class="comment">//</span>
02734     <span class="comment">// Allocate an object on the heap for the profile</span>
02735     <span class="comment">//</span>
02736 
02737     hProfile = <a class="code" href="../../d2/d1/object_8c.html#a3">AllocateHeapObject</a>(OBJ_PROFILE);
02738     <span class="keywordflow">if</span> (!hProfile)
02739     {
02740         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not allocate profile object\n"</span>)));
02741         SetLastError(ERROR_NOT_ENOUGH_MEMORY);
02742         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02743     }
02744 
02745     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
02746 
02747     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
02748 
02749     <span class="comment">//</span>
02750     <span class="comment">// Copy profile information to our object</span>
02751     <span class="comment">//</span>
02752 
02753     pProfObj-&gt;objHdr.dwUseCount = 1;
02754     pProfObj-&gt;dwType       = pProfile-&gt;dwType;
02755     pProfObj-&gt;cbDataSize   = pProfile-&gt;cbDataSize;
02756     pProfObj-&gt;pProfileData = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)<a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(pProfile-&gt;cbDataSize + <span class="keyword">sizeof</span>(TCHAR));
02757     <span class="keywordflow">if</span> (!pProfObj-&gt;pProfileData)
02758     {
02759         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not allocate memory for profile data\n"</span>)));
02760         SetLastError(ERROR_NOT_ENOUGH_MEMORY);
02761         <span class="keywordflow">goto</span> EndOpenColorProfile;
02762     }
02763 
02764     CopyMemory((PVOID)pProfObj-&gt;pProfileData,
02765         (PVOID)pProfile-&gt;pProfileData,
02766         pProfile-&gt;cbDataSize);
02767 
02768     <span class="keywordflow">if</span> (pProfObj-&gt;dwType == PROFILE_FILENAME)
02769     {
02770         LPTSTR lpFilename;
02771 
02772         <span class="keywordflow">if</span> (!pProfile-&gt;pProfileData ||
02773              pProfile-&gt;cbDataSize == 0 ||
02774              lstrlen((LPCTSTR)pProfile-&gt;pProfileData) &gt; <a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a> ||
02775              pProfile-&gt;cbDataSize &gt; (<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a> * <span class="keyword">sizeof</span>(TCHAR)))
02776         {
02777             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to OpenColorProfile\n"</span>)));
02778             SetLastError(ERROR_INVALID_PARAMETER);
02779             <span class="keywordflow">goto</span> EndOpenColorProfile;
02780         }
02781 
02782         <span class="comment">//</span>
02783         <span class="comment">// If only filename is given, it is wrt color directory</span>
02784         <span class="comment">//</span>
02785 
02786         lpFilename = <a class="code" href="../../d9/d7/profman_8c.html#a96">GetFilenameFromPath</a>((LPTSTR)pProfObj-&gt;pProfileData);
02787         <span class="keywordflow">if</span> (lpFilename == pProfObj-&gt;pProfileData)
02788         {
02789             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLen = <a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>;
02790             lpFilename = <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(dwLen);
02791             <span class="keywordflow">if</span> (!lpFilename)
02792             {
02793                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not allocate memory for file name\n"</span>)));
02794                 SetLastError(ERROR_NOT_ENOUGH_MEMORY);
02795                 <span class="keywordflow">goto</span> EndOpenColorProfile;
02796             }
02797             (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)GetColorDirectory(NULL, lpFilename, &amp;dwLen);
02798             lstrcat(lpFilename, gszBackslash);
02799             lstrcat(lpFilename, (LPTSTR)pProfObj-&gt;pProfileData);
02800             <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(pProfObj-&gt;pProfileData);
02801             pProfObj-&gt;pProfileData = (PVOID)lpFilename;
02802             pProfObj-&gt;cbDataSize = <a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>;
02803         }
02804 
02805         <span class="comment">//</span>
02806         <span class="comment">// File name already null terminates as we used GHND flag which</span>
02807         <span class="comment">// zero initializes the allocated memory</span>
02808         <span class="comment">//</span>
02809         <span class="comment">// Create file mapping</span>
02810         <span class="comment">//</span>
02811 
02812         pProfObj-&gt;dwFlags |= MEMORY_MAPPED;
02813 
02814         <span class="keywordflow">if</span> (dwCreationMode == OPEN_ALWAYS)
02815         {
02816             <span class="comment">//</span>
02817             <span class="comment">// If we find a zero length profile, we should error out</span>
02818             <span class="comment">// saying it is a bad profile. If we create a zero length</span>
02819             <span class="comment">// profile, it is fine. To distinguish these two cases, we</span>
02820             <span class="comment">// check for file's existence and if present, change the</span>
02821             <span class="comment">// creation mode to OPEN_EXISTING</span>
02822             <span class="comment">//</span>
02823 
02824             <span class="keywordflow">if</span> (GetFileAttributes(pProfObj-&gt;pProfileData) != (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1)
02825             {
02826                 dwCreationMode = <a class="code" href="../../d4/d8/ntfsexp_8h.html#a141a69">OPEN_EXISTING</a>;
02827             }
02828         }
02829 
02830         <span class="comment">//</span>
02831         <span class="comment">// Set security attribute structure</span>
02832         <span class="comment">//</span>
02833 
02834         sa.nLength = <span class="keyword">sizeof</span>(SECURITY_ATTRIBUTES);
02835         sa.lpSecurityDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;         <span class="comment">// default security</span>
02836         sa.bInheritHandle = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02837 
02838         pProfObj-&gt;hFile = CreateFile(pProfObj-&gt;pProfileData,
02839             (dwDesiredAccess == PROFILE_READWRITE) ? GENERIC_READ | GENERIC_WRITE : GENERIC_READ,
02840             dwShareMode, &amp;sa, dwCreationMode, FILE_FLAG_RANDOM_ACCESS, 0);
02841 
02842         <span class="keywordflow">if</span> (pProfObj-&gt;hFile == <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>)
02843         {
02844             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Err %ld, could not open profile %s\n"</span>),
02845                 GetLastError(), pProfObj-&gt;pProfileData));
02846             <span class="keywordflow">goto</span> EndOpenColorProfile;
02847         }
02848 
02849         <span class="comment">//</span>
02850         <span class="comment">// Get size of file mapping. Add a cushion so that profile can</span>
02851         <span class="comment">// be grown. When closing the profile, the file size is truncated</span>
02852         <span class="comment">// to the size of the actual data. If the profile size grows beyond</span>
02853         <span class="comment">// the cushion, it is continually grown in chunks.</span>
02854         <span class="comment">//</span>
02855 
02856         dwMapSize = GetFileSize(pProfObj-&gt;hFile, NULL);
02857         <span class="keywordflow">if</span> (dwMapSize == 0)
02858         {
02859             <span class="keywordflow">if</span> (dwCreationMode == <a class="code" href="../../d4/d8/ntfsexp_8h.html#a141a69">OPEN_EXISTING</a>)
02860             {
02861                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile  - zero length\n"</span>)));
02862                 SetLastError(ERROR_INVALID_PROFILE);
02863                 <span class="keywordflow">goto</span> EndOpenColorProfile;
02864 
02865             }
02866             <span class="keywordflow">else</span>
02867             {
02868                 dwMapSize = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a0">PROFILE_GROWTHCUSHION</a>;
02869                 bNewFile = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02870             }
02871         }
02872 
02873         pProfObj-&gt;hMap = CreateFileMapping(pProfObj-&gt;hFile, 0,
02874             (dwDesiredAccess == PROFILE_READWRITE) ? PAGE_READWRITE : PAGE_READONLY,
02875             0, dwMapSize, 0);
02876 
02877         <span class="keywordflow">if</span> (!pProfObj-&gt;hMap)
02878         {
02879             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Err %ld, could not create map of profile %s\n"</span>),
02880                 GetLastError(), pProfObj-&gt;pProfileData));
02881             <span class="keywordflow">goto</span> EndOpenColorProfile;
02882         }
02883 
02884         pProfObj-&gt;dwMapSize = dwMapSize;
02885 
02886         pProfObj-&gt;pView = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)MapViewOfFile(pProfObj-&gt;hMap,
02887             (dwDesiredAccess == PROFILE_READWRITE) ? FILE_MAP_ALL_ACCESS : FILE_MAP_READ,
02888             0, 0, 0);
02889 
02890         <span class="keywordflow">if</span> (!pProfObj-&gt;pView)
02891         {
02892             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Err %ld, could not create view of profile %s\n"</span>),
02893                 GetLastError(), pProfObj-&gt;pProfileData));
02894             <span class="keywordflow">goto</span> EndOpenColorProfile;
02895         }
02896 
02897         <span class="comment">//</span>
02898         <span class="comment">// If a new profile has been created, initialize size</span>
02899         <span class="comment">// and tag table count</span>
02900         <span class="comment">//</span>
02901         <span class="keywordflow">if</span> (bNewFile &amp;&amp; dwDesiredAccess == PROFILE_READWRITE)
02902         {
02903             HEADER(pProfObj)-&gt;phSize = FIX_ENDIAN(<span class="keyword">sizeof</span>(PROFILEHEADER) +
02904                                                   <span class="keyword">sizeof</span>(DWORD));
02905             HEADER(pProfObj)-&gt;phVersion = 0x02000000;
02906             HEADER(pProfObj)-&gt;phSignature = PROFILE_SIGNATURE;
02907             TAG_COUNT(pProfObj) = 0;
02908         }
02909     }
02910     <span class="keywordflow">else</span>
02911     {
02912         <span class="keywordflow">if</span> (pProfile-&gt;cbDataSize == 0)
02913         {
02914             <span class="comment">//</span>
02915             <span class="comment">// Allocate a small buffer and create a new profile in it</span>
02916             <span class="comment">//</span>
02917 
02918             pProfObj-&gt;cbDataSize = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a0">PROFILE_GROWTHCUSHION</a>;
02919             <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(pProfObj-&gt;pProfileData);
02920             pProfObj-&gt;pView = pProfObj-&gt;pProfileData = <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(pProfObj-&gt;cbDataSize);
02921             <span class="keywordflow">if</span> (!pProfObj-&gt;pView)
02922             {
02923                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not allocate memory for profile data\n"</span>)));
02924                 SetLastError(ERROR_NOT_ENOUGH_MEMORY);
02925                 <span class="keywordflow">goto</span> EndOpenColorProfile;
02926             }
02927 
02928             HEADER(pProfObj)-&gt;phSize = FIX_ENDIAN(<span class="keyword">sizeof</span>(PROFILEHEADER) +
02929                                                   <span class="keyword">sizeof</span>(DWORD));
02930             HEADER(pProfObj)-&gt;phVersion = 0x02000000;
02931             HEADER(pProfObj)-&gt;phSignature = PROFILE_SIGNATURE;
02932             TAG_COUNT(pProfObj) = 0;
02933             pProfObj-&gt;dwMapSize = pProfObj-&gt;cbDataSize;
02934         }
02935         <span class="keywordflow">else</span>
02936         {
02937             <span class="comment">//</span>
02938             <span class="comment">// Treat buffer as view of file</span>
02939             <span class="comment">//</span>
02940 
02941             pProfObj-&gt;pView = pProfObj-&gt;pProfileData;
02942             pProfObj-&gt;dwMapSize = pProfObj-&gt;cbDataSize;
02943 
02944             <span class="comment">//</span>
02945             <span class="comment">// Do a sanity check on the profile</span>
02946             <span class="comment">//</span>
02947 
02948             <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
02949             {
02950                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to OpenColorProfile\n"</span>)));
02951                 SetLastError(ERROR_INVALID_PROFILE);
02952                 <span class="keywordflow">goto</span> EndOpenColorProfile;
02953             }
02954         }
02955     }
02956 
02957     <span class="keywordflow">if</span> (dwDesiredAccess == PROFILE_READWRITE)
02958         pProfObj-&gt;dwFlags |= READWRITE_ACCESS;
02959 
02960     bError = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;          <span class="comment">// Success!</span>
02961 
02962 EndOpenColorProfile:
02963 
02964     <span class="keywordflow">if</span> (bError)
02965     {
02966         <span class="keywordflow">if</span> (hProfile)
02967             <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a34">FreeProfileObject</a>(hProfile);
02968         hProfile = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02969     }
02970 
02971     <span class="keywordflow">return</span> hProfile;
02972 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="w32/ntgdi/icm/mscms/profile.c::IsColorProfileTagPresent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI IsColorProfileTagPresent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TAGTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>tagType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PBOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>pbPresent</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00569">569</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00140">VERBOSE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/ntgdi_2icm_2mscmm_2mscmm_2access_8c-source.html#l00123">CMProfileElementExists()</a>.
<p>
<pre class="fragment"><div>00574 {
00575     PPROFOBJ pProfObj;
00576     PTAGDATA pTagData;
00577     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    nCount, i;
00578 
00579     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"IsColorProfileTagPresent\n"</span>)));
00580 
00581     <span class="comment">//</span>
00582     <span class="comment">// Validate parameters</span>
00583     <span class="comment">//</span>
00584 
00585     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE) ||
00586         !pbPresent ||
00587         IsBadWritePtr(pbPresent, <span class="keyword">sizeof</span>(BOOL)))
00588     {
00589         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to IsColorProfileTagPresent\n"</span>)));
00590         SetLastError(ERROR_INVALID_PARAMETER);
00591         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00592     }
00593 
00594     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
00595 
00596     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
00597 
00598     <span class="comment">//</span>
00599     <span class="comment">// Check the integrity of the profile</span>
00600     <span class="comment">//</span>
00601 
00602     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
00603     {
00604         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to IsColorProfileTagPresent\n"</span>)));
00605         SetLastError(ERROR_INVALID_PROFILE);
00606         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00607     }
00608 
00609     <span class="comment">//</span>
00610     <span class="comment">// Get count of tag items - it is right after the profile header</span>
00611     <span class="comment">//</span>
00612 
00613     nCount = TAG_COUNT(pProfObj);
00614     nCount = FIX_ENDIAN(nCount);
00615 
00616     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a2">VERBOSE</a>((__TEXT(<span class="stringliteral">"Profile 0x%x has 0x%x(%d) tags\n"</span>), hProfile, nCount, nCount));
00617 
00618     <span class="comment">//</span>
00619     <span class="comment">// Tag data records follow the count.</span>
00620     <span class="comment">//</span>
00621 
00622     pTagData = TAG_DATA(pProfObj);
00623 
00624     <span class="comment">//</span>
00625     <span class="comment">// Check if any of these records match the tag passed in.</span>
00626     <span class="comment">//</span>
00627 
00628     *pbPresent = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00629     tagType = FIX_ENDIAN(tagType);      <span class="comment">// to match tags in profile</span>
00630     <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
00631     {
00632         <span class="keywordflow">if</span> (pTagData-&gt;tagType == tagType)
00633         {
00634             *pbPresent = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00635             <span class="keywordflow">break</span>;
00636         }
00637         pTagData++;                     <span class="comment">// Next record</span>
00638     }
00639 
00640     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00641 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="w32/ntgdi/icm/mscms/profile.c::IsColorProfileValid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI IsColorProfileValid           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PBOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>pbValid</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00375">375</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00149">RIP</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00141">TERSE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d0/d7/profman_8c-source.html#l04083">GetProfileClassString()</a>, and <a class="el" href="../../d4/d6/icmui_2profile_8h-source.html#l00194">CProfile::IsValid()</a>.
<p>
<pre class="fragment"><div>00379 {
00380     PPROFOBJ pProfObj;
00381     PCMMOBJ  pCMMObj;
00382     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    cmmID;
00383     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00384 
00385     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"IsColorProfileValid\n"</span>)));
00386 
00387     <span class="comment">//</span>
00388     <span class="comment">// Validate parameters</span>
00389     <span class="comment">//</span>
00390 
00391     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE) ||
00392         !pbValid ||
00393         IsBadWritePtr(pbValid, <span class="keyword">sizeof</span>(BOOL)))
00394     {
00395         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to IsColorProfileValid\n"</span>)));
00396         SetLastError(ERROR_INVALID_PARAMETER);
00397         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00398     }
00399 
00400     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
00401 
00402     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
00403 
00404     <span class="comment">//</span>
00405     <span class="comment">// Quick check on the integrity of the profile before calling the CMM</span>
00406     <span class="comment">//</span>
00407 
00408     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
00409     {
00410         *pbValid = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00411         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00412     }
00413 
00414     <span class="comment">//</span>
00415     <span class="comment">// Get CMM associated with profile. If it does not exist or does not</span>
00416     <span class="comment">// support the CMValidate function, get default CMM.</span>
00417     <span class="comment">//</span>
00418 
00419     cmmID = HEADER(pProfObj)-&gt;phCMMType;
00420     cmmID = FIX_ENDIAN(cmmID);
00421 
00422     pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(cmmID);
00423     <span class="keywordflow">if</span> (!pCMMObj || !pCMMObj-&gt;fns.pCMIsProfileValid)
00424     {
00425         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMM associated with profile could not be used"</span>)));
00426 
00427         <span class="keywordflow">if</span> (pCMMObj)
00428         {
00429             <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
00430         }
00431 
00432         pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
00433         <span class="keywordflow">if</span> (!pCMMObj || !pCMMObj-&gt;fns.pCMIsProfileValid)
00434         {
00435             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a9">RIP</a>((__TEXT(<span class="stringliteral">"Default CMM doesn't support CMValidateProfile"</span>)));
00436             SetLastError(ERROR_INVALID_CMM);
00437             <span class="keywordflow">goto</span> EndIsColorProfileValid;
00438         }
00439     }
00440 
00441     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj-&gt;pView != NULL);
00442     rc = pCMMObj-&gt;fns.pCMIsProfileValid(hProfile, pbValid);
00443 
00444 EndIsColorProfileValid:
00445 
00446     <span class="keywordflow">if</span> (pCMMObj)
00447     {
00448         <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
00449     }
00450 
00451     <span class="keywordflow">return</span> rc;
00452 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="w32/ntgdi/icm/mscms/profile.c::IsReferenceTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL IsReferenceTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFOBJ&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTAGDATA&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03646">3646</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00817">GetColorProfileElement()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01267">SetColorProfileElement()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00986">SetColorProfileElementSize()</a>.
<p>
<pre class="fragment"><div>03650 {
03651     PTAGDATA pTemp;
03652     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    nCount, i;
03653     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     bReference = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03654 
03655     pTemp = TAG_DATA(pProfObj);
03656     nCount = TAG_COUNT(pProfObj);
03657     nCount = FIX_ENDIAN(nCount);
03658 
03659     <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
03660     {
03661         <span class="keywordflow">if</span> ((pTagData-&gt;dwOffset == pTemp-&gt;dwOffset) &amp;&amp;
03662             (pTagData-&gt;tagType  != pTemp-&gt;tagType))
03663         {
03664             bReference = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03665             <span class="keywordflow">break</span>;
03666         }
03667         pTemp++;                     <span class="comment">// next record</span>
03668     }
03669 
03670     <span class="keywordflow">return</span> bReference;
03671 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="w32/ntgdi/icm/mscms/profile.c::MoveProfileData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MoveProfileData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFOBJ&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03586">3586</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d3/d2/parentinfo_8cpp-source.html#l00074">ABS</a>, and <a class="el" href="../../d3/d0/object_8c-source.html#l00300">MyCopyMemory()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03490">ChangeTaggedElementSize()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03400">DeleteTaggedElement()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00986">SetColorProfileElementSize()</a>.
<p>
<pre class="fragment"><div>03593 {
03594     <span class="comment">//</span>
03595     <span class="comment">// NOTE: CopyMemory() doesn't work for overlapped memory.</span>
03596     <span class="comment">// Use internal function instead.</span>
03597     <span class="comment">//</span>
03598 
03599     <a class="code" href="../../d2/d1/object_8c.html#a10">MyCopyMemory</a>((PVOID)dest, (PVOID)src, cnt);
03600 
03601     <span class="keywordflow">if</span> (bZeroMemory)
03602     {
03603         cnt = <a class="code" href="../../d2/d3/parentinfo_8cpp.html#a0">ABS</a>((LONG)(dest - src));
03604 
03605         <span class="keywordflow">if</span> (dest &lt; src)
03606         {
03607             <span class="comment">//</span>
03608             <span class="comment">// Size decreased, so zero out end of file</span>
03609             <span class="comment">//</span>
03610 
03611             dest = VIEW(pProfObj) + FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize) -
03612                    (src - dest);
03613         }
03614         <span class="keywordflow">else</span>
03615         {
03616             <span class="comment">//</span>
03617             <span class="comment">// Size increased, so zero out the increased tagdata</span>
03618             <span class="comment">//</span>
03619 
03620             dest = src;
03621         }
03622         ZeroMemory(dest, cnt);
03623     }
03624 
03625     <span class="keywordflow">return</span>;
03626 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="w32/ntgdi/icm/mscms/profile.c::OpenColorProfileA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HPROFILE WINAPI OpenColorProfileA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwDesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwShareMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwCreationMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00153">153</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02694">InternalOpenColorProfile()</a>.
<p>
<pre class="fragment"><div>00159 {
00160     <span class="comment">//</span>
00161     <span class="comment">// Internal function is ANSI in Windows 95, call it directly.</span>
00162     <span class="comment">//</span>
00163 
00164     <span class="keywordflow">return</span> <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a1">InternalOpenColorProfile</a>(pProfile, dwDesiredAccess,
00165             dwShareMode, dwCreationMode);
00166 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="w32/ntgdi/icm/mscms/profile.c::OpenColorProfileW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HPROFILE WINAPI OpenColorProfileW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>pProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwDesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwShareMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwCreationMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00168">168</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02694">InternalOpenColorProfile()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00205">MemAlloc()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00260">MemFree()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/mscmm_2icm32_8c-source.html#l00446">CMCreateTransformExtW()</a>, and <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html#l00066">MyNewDeviceLinkW()</a>.
<p>
<pre class="fragment"><div>00174 {
00175     PROFILE  aProfile;      <span class="comment">// ANSI version</span>
00176     HPROFILE rc = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00177     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     bUsedDefaultChar;
00178 
00179     <span class="comment">//</span>
00180     <span class="comment">// Validate parameters before touching them</span>
00181     <span class="comment">//</span>
00182 
00183     <span class="keywordflow">if</span> (!pProfile ||
00184         IsBadReadPtr(pProfile, <span class="keyword">sizeof</span>(PROFILE)) ||
00185         (pProfile-&gt;pProfileData &amp;&amp;
00186          IsBadReadPtr(pProfile-&gt;pProfileData, pProfile-&gt;cbDataSize)) ||
00187         (!pProfile-&gt;pProfileData &amp;&amp;
00188          (pProfile-&gt;cbDataSize != 0)) ||
00189         (pProfile-&gt;dwType != PROFILE_FILENAME &amp;&amp;
00190          pProfile-&gt;dwType != PROFILE_MEMBUFFER
00191         )
00192        )
00193     {
00194         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to OpenColorProfile\n"</span>)));
00195         SetLastError(ERROR_INVALID_PARAMETER);
00196         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00197     }
00198 
00199     <span class="keywordflow">if</span> (pProfile-&gt;dwType == PROFILE_FILENAME)
00200     {
00201         <span class="comment">//</span>
00202         <span class="comment">// Convert the profile name to ANSI and call the ANSI version</span>
00203         <span class="comment">//</span>
00204 
00205         aProfile.dwType = pProfile-&gt;dwType;
00206 
00207         <span class="keywordflow">if</span> (!pProfile-&gt;pProfileData || pProfile-&gt;cbDataSize == 0)
00208         {
00209             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to OpenColorProfile\n"</span>)));
00210             SetLastError(ERROR_INVALID_PARAMETER);
00211             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00212         }
00213 
00214         aProfile.pProfileData = (<span class="keywordtype">char</span>*)<a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(pProfile-&gt;cbDataSize * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
00215         <span class="keywordflow">if</span> (!aProfile.pProfileData)
00216         {
00217             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Error allocating memory for ANSI profile structure\n"</span>)));
00218             SetLastError(ERROR_NOT_ENOUGH_MEMORY);
00219             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00220         }
00221 
00222         <span class="keywordflow">if</span> (! WideCharToMultiByte(CP_ACP, 0, pProfile-&gt;pProfileData, pProfile-&gt;cbDataSize/<span class="keyword">sizeof</span>(WCHAR),
00223             aProfile.pProfileData, pProfile-&gt;cbDataSize,
00224             NULL, &amp;bUsedDefaultChar) || bUsedDefaultChar)
00225         {
00226             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Error converting profile structure to ANSI\n"</span>)));
00227             <span class="keywordflow">goto</span> EndOpenColorProfileW;
00228         }
00229 
00230         aProfile.cbDataSize = pProfile-&gt;cbDataSize * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>);
00231     }
00232     <span class="keywordflow">else</span>
00233     {
00234         <span class="comment">//</span>
00235         <span class="comment">// It is a memory based profile, so no ANSI/Unicode conversion</span>
00236         <span class="comment">//</span>
00237 
00238         aProfile = *pProfile;
00239     }
00240 
00241     rc = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a1">InternalOpenColorProfile</a>(&amp;aProfile, dwDesiredAccess,
00242             dwShareMode, dwCreationMode);
00243 
00244 EndOpenColorProfileW:
00245     <span class="keywordflow">if</span> (pProfile-&gt;dwType == PROFILE_FILENAME)
00246     {
00247         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(aProfile.pProfileData);
00248     }
00249 
00250     <span class="keywordflow">return</span> rc;
00251 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="w32/ntgdi/icm/mscms/profile.c::SetColorProfileElement" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI SetColorProfileElement           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TAGTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>tagType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwOffset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pcbSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>pBuffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01267">1267</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03646">IsReferenceTag()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00986">SetColorProfileElementSize()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html#l00085">MyNewDeviceLinkFill()</a>.
<p>
<pre class="fragment"><div>01274 {
01275     PPROFOBJ pProfObj;
01276     PTAGDATA pTagData;
01277     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    nCount, nBytes, i;
01278     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     found;
01279     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;            <span class="comment">// Assume failure</span>
01280 
01281     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"SetColorProfileElement\n"</span>)));
01282 
01283     <span class="comment">//</span>
01284     <span class="comment">// Validate parameters</span>
01285     <span class="comment">//</span>
01286 
01287     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE) ||
01288         !pcbSize ||
01289         IsBadWritePtr(pcbSize, <span class="keyword">sizeof</span>(DWORD)) ||
01290         !pBuffer ||
01291         IsBadReadPtr(pBuffer, *pcbSize)
01292        )
01293     {
01294         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to SetColorProfileElement\n"</span>)));
01295         SetLastError(ERROR_INVALID_PARAMETER);
01296         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01297     }
01298 
01299     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
01300 
01301     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
01302 
01303     <span class="comment">//</span>
01304     <span class="comment">// Check the integrity of the profile</span>
01305     <span class="comment">//</span>
01306 
01307     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
01308     {
01309         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to SetColorProfileElement\n"</span>)));
01310         SetLastError(ERROR_INVALID_PROFILE);
01311         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01312     }
01313 
01314     <span class="comment">//</span>
01315     <span class="comment">// Check if profile has write access</span>
01316     <span class="comment">//</span>
01317 
01318     <span class="keywordflow">if</span> (!(pProfObj-&gt;dwFlags &amp; READWRITE_ACCESS))
01319     {
01320         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Writing to a profile without read/write access\n"</span>)));
01321         SetLastError(ERROR_ACCESS_DENIED);
01322         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01323     }
01324 
01325     <span class="comment">//</span>
01326     <span class="comment">// Get count of tag items - it is right after the profile header</span>
01327     <span class="comment">//</span>
01328 
01329     nCount = TAG_COUNT(pProfObj);
01330     nCount = FIX_ENDIAN(nCount);
01331 
01332     <span class="comment">//</span>
01333     <span class="comment">// Tag data records follow the count.</span>
01334     <span class="comment">//</span>
01335 
01336     pTagData = TAG_DATA(pProfObj);
01337 
01338     <span class="comment">//</span>
01339     <span class="comment">// Check if any of these records match the tag passed in</span>
01340     <span class="comment">//</span>
01341 
01342     found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01343     tagType = FIX_ENDIAN(tagType);
01344     <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
01345     {
01346         <span class="keywordflow">if</span> (pTagData-&gt;tagType == tagType)
01347         {
01348             found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01349             <span class="keywordflow">break</span>;
01350         }
01351         pTagData++;                     <span class="comment">// Next record</span>
01352     }
01353 
01354     <span class="keywordflow">if</span> (found)
01355     {
01356         <span class="comment">//</span>
01357         <span class="comment">// If it is a reference tag, create new space for it</span>
01358         <span class="comment">//</span>
01359 
01360         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a10">IsReferenceTag</a>(pProfObj, pTagData))
01361         {
01362             <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a22">SetColorProfileElementSize</a>(hProfile, tagType, FIX_ENDIAN(pTagData-&gt;cbSize));
01363         }
01364 
01365         <span class="comment">//</span>
01366         <span class="comment">// Get number of bytes to set</span>
01367         <span class="comment">//</span>
01368 
01369         <span class="keywordflow">if</span> (dwOffset &gt;= FIX_ENDIAN(pTagData-&gt;cbSize))
01370         {
01371             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"dwOffset too large for SetColorProfileElement\n"</span>)));
01372             SetLastError(ERROR_INVALID_PARAMETER);
01373             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01374         }
01375         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwOffset + *pcbSize &gt; FIX_ENDIAN(pTagData-&gt;cbSize))
01376         {
01377             nBytes = FIX_ENDIAN(pTagData-&gt;cbSize) - dwOffset;
01378         }
01379         <span class="keywordflow">else</span>
01380         {
01381             nBytes = *pcbSize;
01382         }
01383 
01384         <span class="comment">//</span>
01385         <span class="comment">// Copy the data into the profile</span>
01386         <span class="comment">//</span>
01387 
01388         CopyMemory((PVOID)(pProfObj-&gt;pView + FIX_ENDIAN(pTagData-&gt;dwOffset)
01389             + dwOffset), (PVOID)pBuffer, nBytes);
01390         *pcbSize = nBytes;
01391 
01392         rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01393     }
01394     <span class="keywordflow">else</span>
01395     {
01396         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"SetColorProfileElement: Tag not found\n"</span>)));
01397         SetLastError(ERROR_TAG_NOT_FOUND);
01398     }
01399 
01400     <span class="keywordflow">return</span> rc;
01401 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="w32/ntgdi/icm/mscms/profile.c::SetColorProfileElementReference" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI SetColorProfileElementReference           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TAGTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>newTag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TAGTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>refTag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01422">1422</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03228">AddTagTableEntry()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03135">GrowProfile()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>01427 {
01428     PPROFOBJ pProfObj;
01429     PTAGDATA pTagData, pOrigTag;
01430     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    nCount, i;
01431     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     found;
01432     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;            <span class="comment">// Assume failure</span>
01433 
01434     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"SetColorProfileElementReference\n"</span>)));
01435 
01436     <span class="comment">//</span>
01437     <span class="comment">// Validate parameters</span>
01438     <span class="comment">//</span>
01439 
01440     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE))
01441     {
01442         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to SetColorProfileElementReference\n"</span>)));
01443         SetLastError(ERROR_INVALID_PARAMETER);
01444         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01445     }
01446 
01447     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
01448 
01449     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
01450 
01451     <span class="comment">//</span>
01452     <span class="comment">// Check the integrity of the profile</span>
01453     <span class="comment">//</span>
01454 
01455     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
01456     {
01457         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to SetColorProfileElementReference\n"</span>)));
01458         SetLastError(ERROR_INVALID_PROFILE);
01459         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01460     }
01461 
01462     <span class="comment">//</span>
01463     <span class="comment">// Check if profile has write access</span>
01464     <span class="comment">//</span>
01465 
01466     <span class="keywordflow">if</span> (!(pProfObj-&gt;dwFlags &amp; READWRITE_ACCESS))
01467     {
01468         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Writing to a profile without read/write access\n"</span>)));
01469         SetLastError(ERROR_ACCESS_DENIED);
01470         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01471     }
01472 
01473     <span class="comment">//</span>
01474     <span class="comment">// Get count of tag items - it is right after the profile header</span>
01475     <span class="comment">//</span>
01476     nCount = TAG_COUNT(pProfObj);
01477     nCount = FIX_ENDIAN(nCount);
01478 
01479     <span class="comment">//</span>
01480     <span class="comment">// Tag data records follow the count.</span>
01481     <span class="comment">//</span>
01482 
01483     pTagData = TAG_DATA(pProfObj);
01484 
01485     <span class="comment">//</span>
01486     <span class="comment">// Check if any of these records match the tag passed in</span>
01487     <span class="comment">//</span>
01488 
01489     found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01490     refTag = FIX_ENDIAN(refTag);
01491     <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
01492     {
01493         <span class="keywordflow">if</span> (pTagData-&gt;tagType == refTag)
01494         {
01495             pOrigTag = pTagData;
01496             found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01497         }
01498 
01499         <span class="keywordflow">if</span> (pTagData-&gt;tagType == FIX_ENDIAN(newTag))
01500         {
01501             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Duplicate tag present in SetColorProfileElementReference %x\n"</span>), newTag));
01502             SetLastError(ERROR_DUPLICATE_TAG);
01503             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01504         }
01505         pTagData++;                     <span class="comment">// Next record</span>
01506     }
01507 
01508     <span class="keywordflow">if</span> (found)
01509     {
01510         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> newSize;
01511 
01512         <span class="comment">//</span>
01513         <span class="comment">// Grow profile if needed</span>
01514         <span class="comment">//</span>
01515 
01516         newSize = FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize);
01517         newSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(newSize) + <span class="keyword">sizeof</span>(TAGDATA);
01518 
01519         <span class="comment">//</span>
01520         <span class="comment">// Check for overflow</span>
01521         <span class="comment">//</span>
01522 
01523         <span class="keywordflow">if</span> (newSize &lt; FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize))
01524         {
01525             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Overflow in adding element\n"</span>)));
01526             SetLastError(ERROR_ARITHMETIC_OVERFLOW);
01527             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01528         }
01529 
01530         <span class="keywordflow">if</span> (newSize &gt; pProfObj-&gt;dwMapSize)
01531         {
01532             <span class="comment">//Sundown: safe truncation</span>
01533             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOffset = (ULONG)(ULONG_PTR)(pOrigTag - TAG_DATA(pProfObj));
01534 
01535             <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a8">GrowProfile</a>(pProfObj, newSize))
01536             {
01537                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01538             }
01539             <span class="comment">//</span>
01540             <span class="comment">// Recalculate pointers as mapping or memory pointer</span>
01541             <span class="comment">// could have changed when growing profile</span>
01542             <span class="comment">//</span>
01543 
01544             pOrigTag = TAG_DATA(pProfObj) + dwOffset;
01545         }
01546 
01547         rc = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a4">AddTagTableEntry</a>(pProfObj, newTag, FIX_ENDIAN(pOrigTag-&gt;dwOffset),
01548             FIX_ENDIAN(pOrigTag-&gt;cbSize), FALSE);
01549     }
01550     <span class="keywordflow">else</span>
01551     {
01552         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"SetColorProfileElementReference: Tag 0x%x not found\n"</span>),
01553             FIX_ENDIAN(refTag)));       <span class="comment">// Re-fix it to reflect data passed in</span>
01554         SetLastError(ERROR_TAG_NOT_FOUND);
01555     }
01556 
01557     <span class="keywordflow">return</span> rc;
01558 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="w32/ntgdi/icm/mscms/profile.c::SetColorProfileElementSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI SetColorProfileElementSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TAGTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>tagType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cbSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l00986">986</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03334">AddTaggedElement()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03490">ChangeTaggedElementSize()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03400">DeleteTaggedElement()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00160">DWORD_ALIGN</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03135">GrowProfile()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03646">IsReferenceTag()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l03586">MoveProfileData()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html#l00085">MyNewDeviceLinkFill()</a>, and <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01267">SetColorProfileElement()</a>.
<p>
<pre class="fragment"><div>00991 {
00992     PTAGDATA pTagData;
00993     PPROFOBJ pProfObj;
00994     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    i, nCount, newSize;
00995     TAGTYPE  rawTag;
00996     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     found, rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00997 
00998     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"SetColorProfileElementSize\n"</span>)));
00999 
01000     <span class="comment">//</span>
01001     <span class="comment">// Validate parameters</span>
01002     <span class="comment">//</span>
01003 
01004     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE))
01005     {
01006         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to SetColorProfileElementSize\n"</span>)));
01007         SetLastError(ERROR_INVALID_PARAMETER);
01008         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01009     }
01010 
01011     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
01012 
01013     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
01014 
01015     <span class="comment">//</span>
01016     <span class="comment">// Check the integrity of the profile</span>
01017     <span class="comment">//</span>
01018 
01019     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
01020     {
01021         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to SetColorProfileElementSize\n"</span>)));
01022         SetLastError(ERROR_INVALID_PROFILE);
01023         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01024     }
01025 
01026     <span class="comment">//</span>
01027     <span class="comment">// Check if profile has write access</span>
01028     <span class="comment">//</span>
01029 
01030     <span class="keywordflow">if</span> (!(pProfObj-&gt;dwFlags &amp; READWRITE_ACCESS))
01031     {
01032         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Writing to a profile without read/write access\n"</span>)));
01033         SetLastError(ERROR_ACCESS_DENIED);
01034         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01035     }
01036 
01037     <span class="comment">//</span>
01038     <span class="comment">// Get count of tag items - it is right after the profile header</span>
01039     <span class="comment">//</span>
01040 
01041     nCount = TAG_COUNT(pProfObj);
01042     nCount = FIX_ENDIAN(nCount);
01043 
01044     <span class="comment">//</span>
01045     <span class="comment">// Tag data records follow the count.</span>
01046     <span class="comment">//</span>
01047 
01048     pTagData = TAG_DATA(pProfObj);
01049 
01050     <span class="comment">//</span>
01051     <span class="comment">// Check if any of these records match the tag passed in.</span>
01052     <span class="comment">//</span>
01053 
01054     found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01055     rawTag = FIX_ENDIAN(tagType);
01056     <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
01057     {
01058         <span class="keywordflow">if</span> (pTagData-&gt;tagType == rawTag)
01059         {
01060             found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01061             <span class="keywordflow">break</span>;
01062         }
01063         pTagData++;                     <span class="comment">// Next record</span>
01064     }
01065 
01066     <span class="keywordflow">if</span> (found)
01067     {
01068         <span class="comment">//</span>
01069         <span class="comment">// If it is a reference tag, create data area for it</span>
01070         <span class="comment">//</span>
01071 
01072         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a10">IsReferenceTag</a>(pProfObj, pTagData))
01073         {
01074             <span class="keywordflow">if</span> (cbSize == 0)
01075             {
01076                 PTAGDATA pTemp;
01077 
01078                 <span class="comment">//</span>
01079                 <span class="comment">// Move everything after the tag table entry up</span>
01080                 <span class="comment">// by size of one tag table entry.</span>
01081                 <span class="comment">//</span>
01082 
01083                 <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a9">MoveProfileData</a>(pProfObj, (PBYTE)(pTagData+1), (PBYTE)pTagData,
01084                     PROFILE_SIZE(pProfObj) - (LONG)((PBYTE)(pTagData+1) - VIEW(pProfObj)), TRUE);
01085 
01086                 <span class="comment">//</span>
01087                 <span class="comment">// Go through the tag table and update the pointers</span>
01088                 <span class="comment">//</span>
01089 
01090                 pTemp = TAG_DATA(pProfObj);
01091 
01092                 <span class="comment">//</span>
01093                 <span class="comment">// Get count of tag items - it is right after the profile header</span>
01094                 <span class="comment">//</span>
01095 
01096                 nCount = TAG_COUNT(pProfObj);
01097                 nCount = FIX_ENDIAN(nCount) - 1;
01098                 TAG_COUNT(pProfObj) = FIX_ENDIAN(nCount);
01099 
01100                 <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
01101                 {
01102                     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwTemp = FIX_ENDIAN(pTemp-&gt;dwOffset);
01103 
01104                     dwTemp -= <span class="keyword">sizeof</span>(TAGDATA);
01105                     pTemp-&gt;dwOffset = FIX_ENDIAN(dwTemp);
01106                     pTemp++;                     <span class="comment">// Next record</span>
01107                 }
01108 
01109                 <span class="comment">//</span>
01110                 <span class="comment">// Use nCount as a placeholder to calculate file size</span>
01111                 <span class="comment">//</span>
01112 
01113                 nCount = FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize) - <span class="keyword">sizeof</span>(TAGDATA);
01114                 HEADER(pProfObj)-&gt;phSize = FIX_ENDIAN(nCount);
01115             }
01116             <span class="keywordflow">else</span>
01117             {
01118                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOffset;
01119 
01120                 <span class="comment">//</span>
01121                 <span class="comment">// Resize the profile if needed. For memory buffers, we have to realloc,</span>
01122                 <span class="comment">// and for mapped objects, we have to close and reopen the view.</span>
01123                 <span class="comment">//</span>
01124 
01125                 newSize = FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize);
01126                 newSize = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(newSize) + cbSize;
01127 
01128                 <span class="comment">//</span>
01129                 <span class="comment">// Check for overflow</span>
01130                 <span class="comment">//</span>
01131 
01132                 <span class="keywordflow">if</span> (newSize &lt; FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize) ||
01133                     newSize &lt; cbSize)
01134                 {
01135                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Overflow in setting reference element size\n"</span>)));
01136                     SetLastError(ERROR_ARITHMETIC_OVERFLOW);
01137                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01138                 }
01139 
01140                 <span class="keywordflow">if</span> (newSize &gt; pProfObj-&gt;dwMapSize)
01141                 {
01142                     <span class="comment">//Sundown: dwOffset should not be over 4gb</span>
01143                     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOffset = (ULONG)(ULONG_PTR)(pTagData - TAG_DATA(pProfObj));
01144 
01145                     <span class="keywordflow">if</span> (! <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a8">GrowProfile</a>(pProfObj, newSize))
01146                     {
01147                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01148                     }
01149                     <span class="comment">//</span>
01150                     <span class="comment">// Recalculate pointers as mapping or memory pointer</span>
01151                     <span class="comment">// could have changed when growing profile</span>
01152                     <span class="comment">//</span>
01153 
01154                     pTagData = TAG_DATA(pProfObj) + dwOffset;
01155                 }
01156 
01157                 <span class="comment">//</span>
01158                 <span class="comment">// Calculate location of new data - should be DWORD aligned</span>
01159                 <span class="comment">//</span>
01160 
01161                 dwOffset = <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(FIX_ENDIAN(HEADER(pProfObj)-&gt;phSize));
01162                 pTagData-&gt;dwOffset = FIX_ENDIAN(dwOffset);
01163 
01164                 <span class="comment">//</span>
01165                 <span class="comment">// Set final file size</span>
01166                 <span class="comment">//</span>
01167 
01168                 HEADER(pProfObj)-&gt;phSize = FIX_ENDIAN(dwOffset+cbSize);
01169             }
01170 
01171             rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01172         }
01173         <span class="keywordflow">else</span>
01174         {
01175             <span class="keywordflow">if</span> (cbSize == 0)
01176             {
01177                 rc = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a6">DeleteTaggedElement</a>(pProfObj, pTagData);
01178             }
01179             <span class="keywordflow">else</span>
01180             {
01181                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOldSize;
01182 
01183                 <span class="comment">//</span>
01184                 <span class="comment">// Get current size of element</span>
01185                 <span class="comment">//</span>
01186 
01187                 cbOldSize = FIX_ENDIAN(pTagData-&gt;cbSize);
01188 
01189                 <span class="comment">//</span>
01190                 <span class="comment">// Compress or expand the file as the case may be.</span>
01191                 <span class="comment">//</span>
01192 
01193                 <span class="keywordflow">if</span> (cbSize &gt; cbOldSize)
01194                 {
01195                     <span class="comment">//Sundown: dwOffset should be safe to truncate</span>
01196                     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOffset = (ULONG)(ULONG_PTR)(pTagData - TAG_DATA(pProfObj));
01197 
01198                     <span class="comment">//</span>
01199                     <span class="comment">// Check for overflow</span>
01200                     <span class="comment">//</span>
01201 
01202                     newSize = PROFILE_SIZE(pProfObj) + <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbSize) -
01203                         <a class="code" href="../../d4/d0/immcli_8h.html#a18">DWORD_ALIGN</a>(cbOldSize);
01204 
01205                     <span class="keywordflow">if</span> (newSize &lt; PROFILE_SIZE(pProfObj))
01206                     {
01207                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Overflow in increasing element size\n"</span>)));
01208                         SetLastError(ERROR_ARITHMETIC_OVERFLOW);
01209                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01210                     }
01211 
01212                     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a8">GrowProfile</a>(pProfObj, newSize))
01213                     {
01214                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01215                     }
01216 
01217                     <span class="comment">//</span>
01218                     <span class="comment">// Recompute pointers</span>
01219                     <span class="comment">//</span>
01220 
01221                     pTagData = TAG_DATA(pProfObj) + dwOffset;
01222                 }
01223 
01224                 rc = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a7">ChangeTaggedElementSize</a>(pProfObj, pTagData, cbSize);
01225             }
01226         }
01227     }
01228     <span class="keywordflow">else</span>
01229     {
01230         <span class="keywordflow">if</span> (cbSize == 0)
01231         {
01232             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"SetColorProfileElementSize (deleting): Tag not found\n"</span>)));
01233             SetLastError(ERROR_TAG_NOT_FOUND);
01234         }
01235         <span class="keywordflow">else</span>
01236         {
01237             rc = <a class="code" href="../../d0/d7/w32_2ntgdi_2icm_2mscms_2profile_8c.html#a5">AddTaggedElement</a>(pProfObj, tagType, cbSize);
01238         }
01239     }
01240 
01241     <span class="keywordflow">return</span> rc;
01242 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="w32/ntgdi/icm/mscms/profile.c::SetColorProfileHeader" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI SetColorProfileHeader           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PPROFILEHEADER&nbsp;</td>
          <td class="mdname" nowrap> <em>pHeader</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l01652">1652</a> of file <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html">w32/ntgdi/icm/mscms/profile.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d8/d5/mscmm_2memprof_8c-source.html#l00085">MyNewDeviceLinkFill()</a>.
<p>
<pre class="fragment"><div>01656 {
01657     PPROFOBJ pProfObj;
01658     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    nCount, i, temp;
01659 
01660     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"SetColorProfileHeader\n"</span>)));
01661 
01662     <span class="comment">//</span>
01663     <span class="comment">// Validate parameters</span>
01664     <span class="comment">//</span>
01665 
01666     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hProfile, OBJ_PROFILE) ||
01667         IsBadReadPtr(pHeader, <span class="keyword">sizeof</span>(PROFILEHEADER)))
01668     {
01669         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to SetColorProfileHeader\n"</span>)));
01670         SetLastError(ERROR_INVALID_PARAMETER);
01671         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01672     }
01673 
01674     pProfObj = (PPROFOBJ)HDLTOPTR(hProfile);
01675 
01676     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
01677 
01678     <span class="comment">//</span>
01679     <span class="comment">// Check if profile has write access</span>
01680     <span class="comment">//</span>
01681 
01682     <span class="keywordflow">if</span> (!(pProfObj-&gt;dwFlags &amp; READWRITE_ACCESS))
01683     {
01684         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Writing to a profile without read/write access\n"</span>)));
01685         SetLastError(ERROR_ACCESS_DENIED);
01686         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01687     }
01688 
01689     <span class="comment">//</span>
01690     <span class="comment">// Fix up all fields to BIG-ENDIAN.</span>
01691     <span class="comment">// The following code assumes that the profile header is a</span>
01692     <span class="comment">// multiple of DWORDs which it is!</span>
01693     <span class="comment">//</span>
01694 
01695     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<span class="keyword">sizeof</span>(PROFILEHEADER) % <span class="keyword">sizeof</span>(DWORD) == 0);
01696 
01697     nCount = <span class="keyword">sizeof</span>(PROFILEHEADER)/<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
01698     <span class="keywordflow">for</span> (i=0; i&lt;nCount;i++)
01699     {
01700         temp = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)((PDWORD)pHeader)[i];
01701         ((PDWORD)pHeader)[i] = FIX_ENDIAN(temp);
01702     }
01703 
01704     CopyMemory((PVOID)pProfObj-&gt;pView, (PVOID)pHeader,
01705         <span class="keyword">sizeof</span>(PROFILEHEADER));
01706 
01707     <span class="comment">//</span>
01708     <span class="comment">// Put back app supplied buffer the way it came in</span>
01709     <span class="comment">//</span>
01710 
01711     <span class="keywordflow">for</span> (i=0; i&lt;nCount;i++)
01712     {
01713         temp = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)((PDWORD)pHeader)[i];
01714         ((PDWORD)pHeader)[i] = FIX_ENDIAN(temp);
01715     }
01716 
01717     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01718 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:20 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
