<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: server/server.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>server.c File Reference</h1><code>#include "<a class="el" href="../../d3/d3/w32_2ntuser_2server_2precomp_8h-source.html">precomp.h</a>"</code><br>
<code>#include "dbt.h"</code><br>
<code>#include "ntdddisk.h"</code><br>
<code>#include "<a class="el" href="../../d1/d9/ntuser_8h-source.html">ntuser.h</a>"</code><br>
<code>#include &lt;regstr.h&gt;</code><br>

<p>
<a href="../../d1/d6/server_2server_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a0">ID_NLS</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a1">ID_POWER</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a2">ID_MEDIACHANGE</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a3">ID_NETDEVCHANGE</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a4">ID_NUM_EVENTS</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a5">SC_BSM_EVENT_NAME</a>&nbsp;&nbsp;&nbsp;L"ScNetDrvMsg"</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOL(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a20">PFNPROCESSCREATE</a> )(<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, ULONG_PTR, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a23">CsrQueryApiPort</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a24">SrvExitWindowsEx</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a25">SrvEndTask</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a26">SrvLogon</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a27">SrvRegisterServicesProcess</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a28">SrvActivateDebugger</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a29">SrvGetThreadConsoleDesktop</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a30">SrvDeviceEvent</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a31">SrvRegisterLogonProcess</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a32">SrvWin32HeapFail</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a33">SrvWin32HeapStat</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a34">UserServerDllInitialization</a> (PCSR_SERVER_DLL psrvdll)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a35">UserClientConnect</a> (PCSR_PROCESS Process, PVOID ConnectionInformation, PULONG pulConnectionLen)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a36">UserHardError</a> (PCSR_THREAD pcsrt, PHARDERROR_MSG pmsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a37">UserClientShutdown</a> (PCSR_PROCESS Process, ULONG <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, BOOLEAN fFirstPass)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a38">GetTimeouts</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a39">StartRegReadRead</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a40">RegReadApcProcedure</a> (PVOID RegReadApcContext, PIO_STATUS_BLOCK IoStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a41">NotificationThread</a> (PVOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a42">InitializeConsoleAttributes</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a43">GetThreadConsoleDesktop</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwThreadId, HDESK *phdesk)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a44">MyRegOpenKey</a> (IN HANDLE hKey, IN LPWSTR lpSubKey, OUT PHANDLE phResult)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a45">BaseSetProcessCreateNotify</a> (<a class="el" href="../../d0/d7/server_2server_8c.html#a20">PFNPROCESSCREATE</a> pfn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a46">BaseSrvNlsUpdateRegistryCache</a> (PVOID ApcContext, PIO_STATUS_BLOCK pIoStatusBlock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a47">BaseSrvNlsLogon</a> (BOOL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a48">WinStationAPIInit</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a49">HandleMediaChangeEvent</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a50">GetNetworkDrives</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a51">HandleRemoteNetDeviceChangeEvent</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a52">CreateBSMEventSD</a> (PSECURITY_DESCRIPTOR *SecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a53">GetRegIntFromID</a> (HKEY hKey, int KeyID, UINT nDefault)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a54">FindWindowFromThread</a> (HWND hwnd, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a55">GetRipComponent</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a56">GetDbgTagFlags</a> (int tag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a57">GetRipPID</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a58">GetRipFlags</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a59">SetRipFlags</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRipFlags, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRipPID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a60">SetDbgTag</a> (int tag, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwBitFlags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a61">UserRtlRaiseStatus</a> (NTSTATUS <a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a6">hThreadNotification</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a7">hKeyPriority</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a8">PriorityValueName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>IO_STATUS_BLOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a9">IoStatusRegChange</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a10">RegChangeBuffer</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a11">ghNlsEvent</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a12">gfLogon</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>FARPROC&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a13">gpfnAttachRoutine</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a14">ghPowerRequestEvent</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a15">ghMediaRequestEvent</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a16">LastNetDrives</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a17">CsrApiPort</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PCSR_API_ROUTINE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a18">UserServerApiDispatchTable</a> [UserpMaxApiNumber-UserpExitWindowsEx]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a19">UserServerApiServerValidTable</a> [UserpMaxApiNumber-UserpExitWindowsEx]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WORD&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a21">gDispatchTableValues</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST <a class="el" href="../../d3/d8/uniontagALWAYSZERO.html">ALWAYSZERO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d7/server_2server_8c.html#a22">gZero</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a2" doxytag="server/server.c::ID_MEDIACHANGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ID_MEDIACHANGE&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00038">38</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="server/server.c::ID_NETDEVCHANGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ID_NETDEVCHANGE&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00039">39</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="server/server.c::ID_NLS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ID_NLS&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00036">36</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="server/server.c::ID_NUM_EVENTS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ID_NUM_EVENTS&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00041">41</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="server/server.c::ID_POWER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ID_POWER&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00037">37</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="server/server.c::SC_BSM_EVENT_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SC_BSM_EVENT_NAME&nbsp;&nbsp;&nbsp;L"ScNetDrvMsg"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00046">46</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a20" doxytag="server/server.c::PFNPROCESSCREATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOL(* <a class="el" href="../../d0/d7/server_2server_8c.html#a20">PFNPROCESSCREATE</a>)(<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, ULONG_PTR, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00162">162</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a45" doxytag="server/server.c::BaseSetProcessCreateNotify" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL BaseSetProcessCreateNotify           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d7/server_2server_8c.html#a20">PFNPROCESSCREATE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pfn</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="server/server.c::BaseSrvNlsLogon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS BaseSrvNlsLogon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BOOL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01121">SrvLogon()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="server/server.c::BaseSrvNlsUpdateRegistryCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID BaseSrvNlsUpdateRegistryCache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ApcContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PIO_STATUS_BLOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>pIoStatusBlock</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="server/server.c::CreateBSMEventSD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL CreateBSMEventSD           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SecurityDescriptor</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00705">705</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l01607">RtlAddAccessAllowedAce()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01062">RtlAllocateAndInitializeSid()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l00099">RtlCreateAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01945">RtlCreateSecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01218">RtlFreeSid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01350">RtlLengthSid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02543">RtlSetDaclSecurityDescriptor()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d0/rtdmpsec_8c-source.html#l00109">WorldSid</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.
<p>
<pre class="fragment"><div>00710                    :
00711 
00712     This function creates a security descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BSM request event.
00713     It grants EVENT_ALL_ACCESS to local system and EVENT_MODIFY_STATE access
00714     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rest of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> world.  This prevents principals other than local
00715     system from waiting <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> event.
00716 
00717 Arguments:
00718 
00719     SecurityDescriptor - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> security descriptor.
00720         Should be freed with LocalFree.
00721 
00722 Return Value:
00723 
00724     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - success
00725 
00726     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>, use GetLastError
00727 
00728 
00729 --*/
00730 {
00731     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00732     ULONG       AclLength;
00733     PACL        EventDacl;
00734     PSID        <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a8">WorldSid</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00735     PSID        SystemSid = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00736     SID_IDENTIFIER_AUTHORITY NtSidAuthority = SECURITY_NT_AUTHORITY;
00737     SID_IDENTIFIER_AUTHORITY WorldSidAuthority = SECURITY_WORLD_SID_AUTHORITY;
00738     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        retval = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00739 
00740     *SecurityDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00741 
00742     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a39">RtlAllocateAndInitializeSid</a>( &amp;NtSidAuthority,
00743                                           1,
00744                                           SECURITY_LOCAL_SYSTEM_RID,
00745                                           0, 0, 0, 0, 0, 0, 0,
00746                                           &amp;SystemSid );
00747 
00748     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00749         retval = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00750         <span class="keywordflow">goto</span> Cleanup;
00751     }
00752 
00753     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a39">RtlAllocateAndInitializeSid</a>( &amp;WorldSidAuthority,
00754                                           1,
00755                                           SECURITY_WORLD_RID,
00756                                           0, 0, 0, 0, 0, 0, 0,
00757                                           &amp;WorldSid );
00758 
00759     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00760         retval = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00761         <span class="keywordflow">goto</span> Cleanup;
00762     }
00763 
00764 
00765     <span class="comment">//</span>
00766     <span class="comment">// Allocate a buffer to contain the SD followed by the DACL</span>
00767     <span class="comment">// Note, the well-known SIDs are expected to have been created</span>
00768     <span class="comment">// by this time</span>
00769     <span class="comment">//</span>
00770 
00771     AclLength = (ULONG)<span class="keyword">sizeof</span>(ACL) +
00772                    (2*((ULONG)<span class="keyword">sizeof</span>(ACCESS_ALLOWED_ACE))) +
00773                    <a class="code" href="../../d8/d6/sertl_8c.html#a45">RtlLengthSid</a>( SystemSid ) +
00774                    <a class="code" href="../../d8/d6/sertl_8c.html#a45">RtlLengthSid</a>( WorldSid ) +
00775                    8;       <span class="comment">// 8 is for good measure</span>
00776 
00777     *SecurityDescriptor = (PSECURITY_DESCRIPTOR)
00778         LocalAlloc( 0, SECURITY_DESCRIPTOR_MIN_LENGTH + AclLength );
00779 
00780     <span class="keywordflow">if</span> (*SecurityDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00781         retval = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00782         <span class="keywordflow">goto</span> Cleanup;
00783     }
00784 
00785     EventDacl = (PACL) ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>*)(*SecurityDescriptor) + SECURITY_DESCRIPTOR_MIN_LENGTH);
00786 
00787 
00788     <span class="comment">//</span>
00789     <span class="comment">// Set up a default ACL</span>
00790     <span class="comment">//</span>
00791     <span class="comment">//    Public: WORLD:EVENT_MODIFY_STATE, SYSTEM:all</span>
00792 
00793     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d4/acledit_8c.html#a6">RtlCreateAcl</a>( EventDacl, AclLength, ACL_REVISION2);
00794     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00795         retval = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00796         <span class="keywordflow">goto</span> Cleanup;
00797     }
00798 
00799 
00800     <span class="comment">//</span>
00801     <span class="comment">// WORLD access</span>
00802     <span class="comment">//</span>
00803 
00804     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d4/acledit_8c.html#a16">RtlAddAccessAllowedAce</a> (
00805                  EventDacl,
00806                  ACL_REVISION2,
00807                  EVENT_MODIFY_STATE,
00808                  WorldSid
00809                  );
00810     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00811         retval = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00812         <span class="keywordflow">goto</span> Cleanup;
00813     }
00814 
00815 
00816     <span class="comment">//</span>
00817     <span class="comment">// SYSTEM access</span>
00818     <span class="comment">//</span>
00819 
00820     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d4/acledit_8c.html#a16">RtlAddAccessAllowedAce</a> (
00821                  EventDacl,
00822                  ACL_REVISION2,
00823                  EVENT_ALL_ACCESS,
00824                  SystemSid
00825                  );
00826     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00827         retval = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00828         <span class="keywordflow">goto</span> Cleanup;
00829     }
00830 
00831 
00832 
00833     <span class="comment">//</span>
00834     <span class="comment">// Now initialize security descriptors</span>
00835     <span class="comment">// that export this protection</span>
00836     <span class="comment">//</span>
00837 
00838     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a53">RtlCreateSecurityDescriptor</a>(
00839                  *SecurityDescriptor,
00840                  SECURITY_DESCRIPTOR_REVISION1
00841                  );
00842     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00843         retval = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00844         <span class="keywordflow">goto</span> Cleanup;
00845     }
00846 
00847     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a60">RtlSetDaclSecurityDescriptor</a>(
00848                  *SecurityDescriptor,
00849                  TRUE,                       <span class="comment">// DaclPresent</span>
00850                  EventDacl,
00851                  FALSE                       <span class="comment">// DaclDefaulted</span>
00852                  );
00853 
00854     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00855         retval = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00856         <span class="keywordflow">goto</span> Cleanup;
00857     }
00858 
00859 Cleanup:
00860 
00861     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtdmpsec_8c.html#a8">WorldSid</a>) {
00862         <a class="code" href="../../d8/d6/sertl_8c.html#a41">RtlFreeSid</a>(WorldSid);
00863     }
00864 
00865     <span class="keywordflow">if</span> (SystemSid) {
00866         <a class="code" href="../../d8/d6/sertl_8c.html#a41">RtlFreeSid</a>(SystemSid);
00867     }
00868 
00869     <span class="keywordflow">if</span> ((retval == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp; (*SecurityDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00870         LocalFree(*SecurityDescriptor);
00871         *SecurityDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00872     }
00873 
00874 
00875     <span class="keywordflow">return</span> retval;
00876 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="server/server.c::CsrQueryApiPort" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE CsrQueryApiPort           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="server/server.c::FindWindowFromThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL CALLBACK FindWindowFromThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01255">1255</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00305">GetWindow()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d7/w32_2ntuser_2server_2harderr_8c-source.html#l01906">BoostHardError()</a>, <a class="el" href="../../d8/d7/w32_2ntuser_2server_2harderr_8c-source.html#l00423">GetHardErrorText()</a>, and <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l00757">ThreadShutdownNotify()</a>.
<p>
<pre class="fragment"><div>01256 {
01257     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fTopLevelOwner;
01258 <span class="preprocessor">#ifdef FE_IME</span>
01259 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( IsImeWindow(hwnd) ) {
01260         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01261     }
01262 <span class="preprocessor">#endif</span>
01263 <span class="preprocessor"></span>
01264     fTopLevelOwner = (<a class="code" href="../../d3/d9/client_2wow_8c.html#a12">GetWindow</a>(hwnd, GW_OWNER) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01265     <span class="keywordflow">if</span> ((*((HWND *)lParam) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || fTopLevelOwner) {
01266         *((HWND *)lParam) = hwnd;
01267     }
01268     <span class="keywordflow">return</span> !fTopLevelOwner;
01269 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="server/server.c::GetDbgTagFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetDbgTagFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tag</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01273">1273</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
<pre class="fragment"><div>01274 {
01275     <span class="keywordflow">return</span> 0;
01276     UNREFERENCED_PARAMETER(tag);
01277 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="server/server.c::GetNetworkDrives" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetNetworkDrives           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00549">549</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00531">NtQueryInformationProcess()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00589">HandleRemoteNetDeviceChangeEvent()</a>.
<p>
<pre class="fragment"><div>00553                    :
00554 
00555     Returns a drive bitmask similar to GetLogicalDrives, but including
00556     <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> network drives.
00557 
00558 Arguments:
00559 
00560 Return Value:
00561 
00562 
00563 --*/
00564 {
00565     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Mask = 0;
00566     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> DriveNumber;
00567     PROCESS_DEVICEMAP_INFORMATION ProcessDeviceMapInfo;
00568 
00569     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d9/d1/psquery_8c.html#a18">NtQueryInformationProcess</a>( NtCurrentProcess(),
00570                                         ProcessDeviceMap,
00571                                         &amp;ProcessDeviceMapInfo.Query,
00572                                         <span class="keyword">sizeof</span>( ProcessDeviceMapInfo.Query ),
00573                                         NULL
00574                                       ))) {
00575         <span class="comment">// For all the drives from C to Z</span>
00576         <span class="keywordflow">for</span> (DriveNumber = 2; DriveNumber &lt; 26; DriveNumber++)
00577         {
00578             <span class="keywordflow">if</span> (ProcessDeviceMapInfo.Query.DriveType[DriveNumber] == DOSDEVICE_DRIVE_REMOTE)
00579             {
00580                 Mask |= (1 &lt;&lt; DriveNumber);
00581             }
00582         }
00583     }
00584 
00585     <span class="keywordflow">return</span> Mask;
00586 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="server/server.c::GetRegIntFromID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT GetRegIntFromID           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKEY&nbsp;</td>
          <td class="mdname" nowrap> <em>hKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>nDefault</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01029">1029</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00017">ghModuleWin</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d8/d7/w32_2ntuser_2server_2harderr_8c-source.html#l01499">RtlLoadStringOrError()</a>, <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00225">RtlUnicodeStringToInteger()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01068">GetTimeouts()</a>.
<p>
<pre class="fragment"><div>01033 {
01034     LPWSTR lpszValue;
01035     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAllocated;
01036     UNICODE_STRING Value;
01037     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbSize;
01038     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> Buf[<span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + 20 * <span class="keyword">sizeof</span>(WCHAR)];
01039     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01040     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> ReturnValue;
01041 
01042     lpszValue = (LPWSTR)<a class="code" href="../../d7/d1/usersrv_8h.html#a57">RtlLoadStringOrError</a>(ghModuleWin,
01043             KeyID, NULL, &amp;fAllocated, FALSE);
01044 
01045     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Value, lpszValue);
01046     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(hKey,
01047             &amp;Value,
01048             KeyValuePartialInformation,
01049             (PKEY_VALUE_PARTIAL_INFORMATION)Buf,
01050             <span class="keyword">sizeof</span>(Buf),
01051             &amp;cbSize);
01052     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01053 
01054         <span class="comment">/*</span>
01055 <span class="comment">         * Convert string to int.</span>
01056 <span class="comment">         */</span>
01057         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Value, (LPWSTR)((PKEY_VALUE_PARTIAL_INFORMATION)Buf)-&gt;Data);
01058         <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>(&amp;Value, 10, &amp;ReturnValue);
01059     } <span class="keywordflow">else</span> {
01060         ReturnValue = nDefault;
01061     }
01062 
01063     LocalFree(lpszValue);
01064 
01065     <span class="keywordflow">return</span>(ReturnValue);
01066 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="server/server.c::GetRipComponent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetRipComponent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01271">1271</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
<pre class="fragment"><div>01271 { <span class="keywordflow">return</span> RIP_USERSRV; }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="server/server.c::GetRipFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetRipFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01280">1280</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, and <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00025">gdwRIPFlags</a>.
<p>
<pre class="fragment"><div>01280 { <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a6">gdwRIPFlags</a>; }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="server/server.c::GetRipPID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetRipPID           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01279">1279</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
<pre class="fragment"><div>01279 { <span class="keywordflow">return</span> 0; }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="server/server.c::GetThreadConsoleDesktop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS GetThreadConsoleDesktop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwThreadId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDESK *&nbsp;</td>
          <td class="mdname" nowrap> <em>phdesk</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03139">3139</a> of file <a class="el" href="../../d8/d3/server_2private_8c-source.html">server/private.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00392">CONSOLE_FROMTHREADPERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00322">_CONSOLE_PER_PROCESS_DATA::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00136">_CONSOLE_INFORMATION::hDesk</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d7/server_8h.html#a115">PCONSOLE_PER_PROCESS_DATA</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01686">RevalidateConsole()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01235">SrvGetThreadConsoleDesktop()</a>.
<p>
<pre class="fragment"><div>03142 {
03143     PCSR_THREAD pcsrt;
03144     <a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html">PCONSOLE_PER_PROCESS_DATA</a> ProcessData;
03145     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
03146     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03147     HANDLE ConsoleHandle = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03148 
03149     *phdeskConsole = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03150     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = CsrLockThreadByClientId((HANDLE)dwThreadId, &amp;pcsrt);
03151     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03152         ProcessData = <a class="code" href="../../d1/d7/server_8h.html#a83">CONSOLE_FROMTHREADPERPROCESSDATA</a>(pcsrt);
03153         ConsoleHandle = ProcessData-&gt;<a class="code" href="../../d0/d4/struct__CONSOLE__PER__PROCESS__DATA.html#o0">ConsoleHandle</a>;
03154         CsrUnlockThread(pcsrt);
03155     }
03156 
03157     <span class="comment">//</span>
03158     <span class="comment">// If this process is a console app, return the</span>
03159     <span class="comment">// handle to its desktop.  Otherwise, return NULL.</span>
03160     <span class="comment">//</span>
03161 
03162     <span class="keywordflow">if</span> (ConsoleHandle != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03163         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a34">RevalidateConsole</a>(ConsoleHandle, &amp;Console);
03164         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03165             *phdeskConsole = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o7">hDesk</a>;
03166         }
03167         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
03168     }
03169 
03170     <span class="keywordflow">return</span> STATUS_SUCCESS;
03171 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="server/server.c::GetTimeouts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID GetTimeouts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01068">1068</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03506">CMSHUNGAPPTIMEOUT</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00020">gCmsHungAppTimeout</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00021">gCmsWaitToKillTimeout</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00022">gdwHungToKillCount</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00033">gdwProcessTerminateTimeout</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00032">gdwServicesWaitToKillTimeout</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01029">GetRegIntFromID()</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00023">gfAutoEndTask</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01635">MyRegOpenKey()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03659">PROCESSTERMINATETIMEOUT</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01564">RtlOpenCurrentUser()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01121">SrvLogon()</a>.
<p>
<pre class="fragment"><div>01069 {
01070     HANDLE hCurrentUserKey;
01071     HANDLE hKey;
01072     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01073 
01074     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a27">RtlOpenCurrentUser</a>(MAXIMUM_ALLOWED, &amp;hCurrentUserKey);
01075     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01076         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a44">MyRegOpenKey</a>(hCurrentUserKey,
01077                 L<span class="stringliteral">"Control Panel\\Desktop"</span>,
01078                 &amp;hKey);
01079         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01080             <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a2">gCmsHungAppTimeout</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a53">GetRegIntFromID</a>(
01081                     hKey,
01082                     STR_CMSHUNGAPPTIMEOUT,
01083                     gCmsHungAppTimeout);
01084             <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a3">gCmsWaitToKillTimeout</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a53">GetRegIntFromID</a>(
01085                     hKey,
01086                     STR_CMSWAITTOKILLTIMEOUT,
01087                     gCmsWaitToKillTimeout);
01088 
01089             <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a4">gdwHungToKillCount</a> = <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a3">gCmsWaitToKillTimeout</a> / <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a2">gCmsHungAppTimeout</a>;
01090 
01091             <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a5">gfAutoEndTask</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a53">GetRegIntFromID</a>(
01092                     hKey,
01093                     STR_AUTOENDTASK,
01094                     gfAutoEndTask);
01095             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hKey);
01096         }
01097         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hCurrentUserKey);
01098     }
01099 
01100     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a44">MyRegOpenKey</a>(NULL,
01101             L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control"</span>,
01102             &amp;hKey);
01103     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01104         <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a8">gdwServicesWaitToKillTimeout</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a53">GetRegIntFromID</a>(
01105                 hKey,
01106                 STR_WAITTOKILLSERVICETIMEOUT,
01107                 gCmsWaitToKillTimeout);
01108         <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a9">gdwProcessTerminateTimeout</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a53">GetRegIntFromID</a>(
01109                 hKey,
01110                 STR_PROCESSTERMINATETIMEOUT,
01111                 PROCESSTERMINATETIMEOUT);
01112                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a9">gdwProcessTerminateTimeout</a> &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a912">CMSHUNGAPPTIMEOUT</a>) {
01113                         <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a9">gdwProcessTerminateTimeout</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a912">CMSHUNGAPPTIMEOUT</a>;
01114                 }
01115 
01116         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hKey);
01117     }
01118 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="server/server.c::HandleMediaChangeEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID HandleMediaChangeEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00479">479</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01760">BroadcastSystemMessage()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.
<p>
<pre class="fragment"><div>00480 {
00481     <span class="comment">/*</span>
00482 <span class="comment">     * Local variables</span>
00483 <span class="comment">     */</span>
00484 
00485     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>                   dwRecipients;
00486     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                    bResult;
00487     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>                <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00488     DEV_BROADCAST_VOLUME    dbcvInfo;
00489     USERTHREAD_USEDESKTOPINFO utudi;
00490 
00491     ULONG cDrive;
00492 
00493     <span class="keywordflow">while</span> (cDrive = (ULONG)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_GETDEVICECHANGEINFO)) {
00494 
00495         <span class="comment">/*</span>
00496 <span class="comment">         * Determine if it's an arrival or removal</span>
00497 <span class="comment">         */</span>
00498         bResult = (cDrive &amp; 0x80000000);
00499 
00500         <span class="comment">/*</span>
00501 <span class="comment">         * Initialize the structures used for BroadcastSystemMessage</span>
00502 <span class="comment">         */</span>
00503         dbcvInfo.dbcv_size = <span class="keyword">sizeof</span>(dbcvInfo);
00504         dbcvInfo.dbcv_devicetype = DBT_DEVTYP_VOLUME;
00505         dbcvInfo.dbcv_reserved = 0;
00506         dbcvInfo.dbcv_flags = DBTF_MEDIA;
00507         dbcvInfo.dbcv_unitmask = cDrive;
00508 
00509         dwRecipients = BSM_ALLCOMPONENTS | BSM_ALLDESKTOPS;
00510 
00511         <span class="comment">/*</span>
00512 <span class="comment">         * Temporarily we must assign this thread to a desktop so we can</span>
00513 <span class="comment">         * call USER's BroascastSystemMessage() routine.  We call the</span>
00514 <span class="comment">         * private SetThreadDesktopToDefault() to assign ourselves to the</span>
00515 <span class="comment">         * desktop that is currently receiving input.</span>
00516 <span class="comment">         */</span>
00517         utudi.hThread = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00518         utudi.drdRestore.pdeskRestore = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00519         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00520                                             UserThreadUseActiveDesktop,
00521                                             &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00522         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00523             <span class="comment">/*</span>
00524 <span class="comment">             * Broadcast the message</span>
00525 <span class="comment">             */</span>
00526             <a class="code" href="../../d5/d9/cltxt_8h.html#a35">BroadcastSystemMessage</a>(BSF_FORCEIFHUNG | ((bResult) ? BSF_ALLOWSFW : 0),
00527                                    &amp;dwRecipients,
00528                                    WM_DEVICECHANGE,
00529 <span class="comment">// HACK: need to or 0x8000 in wParam</span>
00530 <span class="comment">//       because this is a flag to let</span>
00531 <span class="comment">//       BSM know that lParam is a pointer</span>
00532 <span class="comment">//       to a data structure.</span>
00533                                    0x8000 | ((bResult) ? DBT_DEVICEARRIVAL : DBT_DEVICEREMOVECOMPLETE),
00534                                    (LPARAM)&amp;dbcvInfo);
00535 
00536             <span class="comment">/*</span>
00537 <span class="comment">             * Set our thread's desktop back to NULL.  This will decrement</span>
00538 <span class="comment">             * the desktop's reference count.</span>
00539 <span class="comment">             */</span>
00540             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00541                                        UserThreadUseDesktop,
00542                                        &amp;utudi,
00543                                        <span class="keyword">sizeof</span>(utudi));
00544         }
00545     }
00546 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="server/server.c::HandleRemoteNetDeviceChangeEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID HandleRemoteNetDeviceChangeEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00589">589</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d6/d8/cltxt_8h-source.html#l01760">BroadcastSystemMessage()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00549">GetNetworkDrives()</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00051">LastNetDrives</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.
<p>
<pre class="fragment"><div>00593                    :
00594 
00595 
00596 Arguments:
00597 
00598 Return Value:
00599 
00600 --*/
00601 {
00602     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    NetDrives;
00603     DEV_BROADCAST_VOLUME dbv;
00604     LONG status;
00605     USERTHREAD_USEDESKTOPINFO utudi;
00606 
00607 
00608 
00609     <span class="comment">/*</span>
00610 <span class="comment">     * Temporarily we must assign this thread to a desktop so we can</span>
00611 <span class="comment">     * call USER's BroascastSystemMessage() routine.  We call the</span>
00612 <span class="comment">     * private SetThreadDesktopToDefault() to assign ourselves to the</span>
00613 <span class="comment">     * desktop that is currently receiving input.</span>
00614 <span class="comment">     */</span>
00615     utudi.hThread = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00616     utudi.drdRestore.pdeskRestore = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00617     status = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00618                                         UserThreadUseActiveDesktop,
00619                                         &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00620     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00621         <span class="keywordflow">return</span>;
00622     }
00623 
00624     <span class="comment">//</span>
00625     <span class="comment">// Keep broadcasting until the set of net drives stops changing</span>
00626     <span class="comment">//</span>
00627     <span class="keywordflow">for</span> (;;)
00628     {
00629 
00630         <span class="comment">//</span>
00631         <span class="comment">// Get the current net drive bitmask and compare against the net</span>
00632         <span class="comment">// drive bitmask when we last broadcast</span>
00633         <span class="comment">//</span>
00634         NetDrives = <a class="code" href="../../d0/d7/server_2server_8c.html#a50">GetNetworkDrives</a>();
00635 
00636         <span class="keywordflow">if</span> (NetDrives == <a class="code" href="../../d0/d7/server_2server_8c.html#a16">LastNetDrives</a>)
00637         {
00638             <span class="keywordflow">break</span>;
00639         }
00640 
00641         <span class="comment">//</span>
00642         <span class="comment">// Broadcast about deleted volumes</span>
00643         <span class="comment">//</span>
00644         dbv.dbcv_size       = <span class="keyword">sizeof</span>(dbv);
00645         dbv.dbcv_devicetype = DBT_DEVTYP_VOLUME;
00646         dbv.dbcv_reserved   = 0;
00647         dbv.dbcv_unitmask   = <a class="code" href="../../d0/d7/server_2server_8c.html#a16">LastNetDrives</a> &amp; ~NetDrives;
00648         dbv.dbcv_flags      = DBTF_NET;
00649         <span class="keywordflow">if</span> (dbv.dbcv_unitmask != 0)
00650         {
00651             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRec = BSM_APPLICATIONS | BSM_ALLDESKTOPS;
00652             status = <a class="code" href="../../d5/d9/cltxt_8h.html#a35">BroadcastSystemMessage</a>(
00653                         BSF_FORCEIFHUNG | BSF_NOHANG | BSF_NOTIMEOUTIFNOTHUNG,
00654                         &amp;dwRec,
00655                         WM_DEVICECHANGE,
00656                         (WPARAM) DBT_DEVICEREMOVECOMPLETE,
00657                         (LPARAM)(DEV_BROADCAST_HDR*)(&amp;dbv)
00658                         );
00659 
00660         }
00661 
00662         <span class="comment">//</span>
00663         <span class="comment">// Broadcast about added volumes</span>
00664         <span class="comment">//</span>
00665         dbv.dbcv_unitmask   = NetDrives &amp; ~<a class="code" href="../../d0/d7/server_2server_8c.html#a16">LastNetDrives</a>;
00666         <span class="keywordflow">if</span> (dbv.dbcv_unitmask != 0)
00667         {
00668             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRec = BSM_APPLICATIONS | BSM_ALLDESKTOPS;
00669 
00670             status = <a class="code" href="../../d5/d9/cltxt_8h.html#a35">BroadcastSystemMessage</a>(
00671                         BSF_FORCEIFHUNG | BSF_NOHANG | BSF_NOTIMEOUTIFNOTHUNG,
00672                         &amp;dwRec,
00673                         WM_DEVICECHANGE,
00674                         (WPARAM) DBT_DEVICEARRIVAL,
00675                         (LPARAM)(DEV_BROADCAST_HDR*)(&amp;dbv)
00676                         );
00677 
00678 
00679         }
00680 
00681         <span class="comment">//</span>
00682         <span class="comment">// Remember the drive set that we last broadcast about</span>
00683         <span class="comment">//</span>
00684         <a class="code" href="../../d0/d7/server_2server_8c.html#a16">LastNetDrives</a> = NetDrives;
00685 
00686         <span class="comment">//</span>
00687         <span class="comment">// Go around the loop again to detect changes that may have occurred</span>
00688         <span class="comment">// while we were broadcasting</span>
00689         <span class="comment">//</span>
00690     }
00691 
00692     <span class="comment">/*</span>
00693 <span class="comment">     * Set our thread's desktop back to NULL.  This will decrement</span>
00694 <span class="comment">     * the desktop's reference count.</span>
00695 <span class="comment">     */</span>
00696     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00697                                UserThreadUseDesktop,
00698                                &amp;utudi,
00699                                <span class="keyword">sizeof</span>(utudi));
00700 
00701     <span class="keywordflow">return</span>;
00702 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="server/server.c::InitializeConsoleAttributes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeConsoleAttributes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02132">2132</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
References <a class="el" href="../../d2/d6/server_8h-source.html#l00426">_CONSOLE_REGISTRY_INFO::AutoPosition</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00432">_CONSOLE_REGISTRY_INFO::ColorTable</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00250">CURSOR_SMALL_SIZE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00422">_CONSOLE_REGISTRY_INFO::CursorSize</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00083">DEFAULT_NUMBER_OF_BUFFERS</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00082">DEFAULT_NUMBER_OF_COMMANDS</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00022">DefaultRegInfo</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00421">_CONSOLE_REGISTRY_INFO::FaceName</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00419">_CONSOLE_REGISTRY_INFO::FontFamily</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00418">_CONSOLE_REGISTRY_INFO::FontSize</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00420">_CONSOLE_REGISTRY_INFO::FontWeight</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00423">_CONSOLE_REGISTRY_INFO::FullScreen</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00429">_CONSOLE_REGISTRY_INFO::HistoryBufferSize</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00431">_CONSOLE_REGISTRY_INFO::HistoryNoDup</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l00177">InitializeSystemMetrics()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00425">_CONSOLE_REGISTRY_INFO::InsertMode</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00433">_CONSOLE_REGISTRY_INFO::LastWriteTime</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00430">_CONSOLE_REGISTRY_INFO::NumberOfHistoryBuffers</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00428">_CONSOLE_REGISTRY_INFO::PopupFill</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00424">_CONSOLE_REGISTRY_INFO::QuickEdit</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00415">_CONSOLE_REGISTRY_INFO::ScreenBufferSize</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00427">_CONSOLE_REGISTRY_INFO::ScreenFill</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00417">_CONSOLE_REGISTRY_INFO::WindowOrigin</a>, and <a class="el" href="../../d2/d6/server_8h-source.html#l00416">_CONSOLE_REGISTRY_INFO::WindowSize</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01121">SrvLogon()</a>.
<p>
<pre class="fragment"><div>02136                    :
02137 
02138     This routine initializes <span class="keywordflow">default</span> attributes from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
02139     user's registry values. It gets called during logon/logoff.
02140 
02141 Arguments:
02142 
02143     none
02144 
02145 Return Value:
02146 
02147     none
02148 
02149 --*/
02150 
02151 {
02152     <span class="comment">//</span>
02153     <span class="comment">// Store default values in structure and mark it</span>
02154     <span class="comment">// as invalid (by resetting LastWriteTime).</span>
02155     <span class="comment">//</span>
02156 
02157     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o12">ScreenFill</a>.Attributes = 0x07;            <span class="comment">// white on black</span>
02158     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o12">ScreenFill</a>.Char.UnicodeChar = (WCHAR)<span class="charliteral">' '</span>;
02159     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o13">PopupFill</a>.Attributes = 0xf5;             <span class="comment">// purple on white</span>
02160     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o13">PopupFill</a>.Char.UnicodeChar = (WCHAR)<span class="charliteral">' '</span>;
02161     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o10">InsertMode</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02162     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o9">QuickEdit</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02163     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o11">AutoPosition</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02164     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o8">FullScreen</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02165     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o0">ScreenBufferSize</a>.X = 80;
02166     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o0">ScreenBufferSize</a>.Y = 25;
02167     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o1">WindowSize</a>.X = 80;
02168     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o1">WindowSize</a>.Y = 25;
02169     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o2">WindowOrigin</a>.X = 0;
02170     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o2">WindowOrigin</a>.Y = 0;
02171     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o3">FontSize</a>.X = 0;
02172     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o3">FontSize</a>.Y = 0;
02173     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o4">FontFamily</a> = 0;
02174     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o5">FontWeight</a> = 0;
02175     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o6">FaceName</a>[0] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
02176     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o7">CursorSize</a> = <a class="code" href="../../d7/d2/output_8h.html#a10">CURSOR_SMALL_SIZE</a>;
02177     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o14">HistoryBufferSize</a> = <a class="code" href="../../d4/d1/cmdline_8h.html#a6">DEFAULT_NUMBER_OF_COMMANDS</a>;
02178     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o15">NumberOfHistoryBuffers</a> = <a class="code" href="../../d4/d1/cmdline_8h.html#a7">DEFAULT_NUMBER_OF_BUFFERS</a>;
02179     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o16">HistoryNoDup</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02180     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 0] = RGB(0,   0,   0   );
02181     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 1] = RGB(0,   0,   0x80);
02182     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 2] = RGB(0,   0x80,0   );
02183     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 3] = RGB(0,   0x80,0x80);
02184     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 4] = RGB(0x80,0,   0   );
02185     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 5] = RGB(0x80,0,   0x80);
02186     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 6] = RGB(0x80,0x80,0   );
02187     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 7] = RGB(0xC0,0xC0,0xC0);
02188     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 8] = RGB(0x80,0x80,0x80);
02189     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[ 9] = RGB(0,   0,   0xFF);
02190     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[10] = RGB(0,   0xFF,0   );
02191     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[11] = RGB(0,   0xFF,0xFF);
02192     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[12] = RGB(0xFF,0,   0   );
02193     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[13] = RGB(0xFF,0,   0xFF);
02194     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[14] = RGB(0xFF,0xFF,0   );
02195     <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o17">ColorTable</a>[15] = RGB(0xFF,0xFF,0xFF);
02196 <span class="preprocessor">#if defined(FE_SB) // scotthsu</span>
02197 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.CodePage = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a>;
02198 <span class="preprocessor">#endif</span>
02199 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a0">DefaultRegInfo</a>.<a class="code" href="../../d7/d4/struct__CONSOLE__REGISTRY__INFO.html#o18">LastWriteTime</a> = 0;
02200 
02201     <span class="comment">//</span>
02202     <span class="comment">// Get system metrics for this user</span>
02203     <span class="comment">//</span>
02204 
02205     <a class="code" href="../../d6/d2/output_8c.html#a38">InitializeSystemMetrics</a>();
02206 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="server/server.c::MyRegOpenKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS MyRegOpenKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpSubKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>phResult</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01635">1635</a> of file <a class="el" href="../../d1/d4/srvinit_8c-source.html">srvinit.c</a>.
<p>
References <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02210">GetRegistryValues()</a>, and <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01068">GetTimeouts()</a>.
<p>
<pre class="fragment"><div>01640 {
01641     OBJECT_ATTRIBUTES   Obja;
01642     UNICODE_STRING      SubKey;
01643 
01644     <span class="comment">//</span>
01645     <span class="comment">// Convert the subkey to a counted Unicode string.</span>
01646     <span class="comment">//</span>
01647 
01648     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;SubKey, lpSubKey );
01649 
01650     <span class="comment">//</span>
01651     <span class="comment">// Initialize the OBJECT_ATTRIBUTES structure and open the key.</span>
01652     <span class="comment">//</span>
01653 
01654     InitializeObjectAttributes(
01655         &amp;Obja,
01656         &amp;SubKey,
01657         OBJ_CASE_INSENSITIVE,
01658         hKey,
01659         NULL
01660         );
01661 
01662     <span class="keywordflow">return</span> <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
01663               phResult,
01664               KEY_READ,
01665               &amp;Obja
01666               );
01667 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="server/server.c::NotificationThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NotificationThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">881</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d0/d7/server_2server_8c.html#a46">BaseSrvNlsUpdateRegistryCache()</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00705">CreateBSMEventSD()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00031">gfLogon</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00034">ghMediaRequestEvent</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00030">ghNlsEvent</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00033">ghPowerRequestEvent</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00931">gSessionId</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00479">HandleMediaChangeEvent()</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00589">HandleRemoteNetDeviceChangeEvent()</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00025">hThreadNotification</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00038">ID_MEDIACHANGE</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00039">ID_NETDEVCHANGE</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00036">ID_NLS</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00041">ID_NUM_EVENTS</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00037">ID_POWER</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00056">MAX_SESSION_PATH</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00180">NtCreateEvent()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00648">NtResetEvent()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00406">NtWaitForMultipleObjects()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00046">SC_BSM_EVENT_NAME</a>, <a class="el" href="../../d9/d8/dllinit_8c-source.html#l00057">SESSION_ROOT</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00431">StartRegReadRead()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.
<p>
<pre class="fragment"><div>00883 {
00884     KPRIORITY   Priority;
00885     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00886     HANDLE      hEvent[<a class="code" href="../../d0/d7/server_2server_8c.html#a4">ID_NUM_EVENTS</a>];
00887     WCHAR       szObjectStr[<a class="code" href="../../d8/d9/dllinit_8c.html#a1">MAX_SESSION_PATH</a>];
00888     OBJECT_ATTRIBUTES Attributes;
00889     UNICODE_STRING UnicodeString;
00890     PSECURITY_DESCRIPTOR pSD = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00891     ULONG       NumEvents = <a class="code" href="../../d0/d7/server_2server_8c.html#a4">ID_NUM_EVENTS</a>;
00892 
00893     UNREFERENCED_PARAMETER(pJunk);
00894 
00895     <span class="keywordflow">try</span> {
00896 
00897         <span class="comment">/*</span>
00898 <span class="comment">         * Set the priority of the RIT to 3.</span>
00899 <span class="comment">         */</span>
00900         Priority = LOW_PRIORITY + 3;
00901         <a class="code" href="../../d9/d1/psquery_8c.html#a21">NtSetInformationThread</a>(hThreadNotification, ThreadPriority, &amp;Priority,
00902                 <span class="keyword">sizeof</span>(KPRIORITY));
00903 
00904         <span class="comment">/*</span>
00905 <span class="comment">         * Setup the NLS event</span>
00906 <span class="comment">         */</span>
00907         <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;ghNlsEvent, EVENT_ALL_ACCESS, NULL, SynchronizationEvent, FALSE);
00908         UserAssert( ghNlsEvent != NULL );
00909         hEvent[<a class="code" href="../../d0/d7/server_2server_8c.html#a0">ID_NLS</a>] = <a class="code" href="../../d0/d7/server_2server_8c.html#a11">ghNlsEvent</a>;
00910 
00911         <span class="comment">/*</span>
00912 <span class="comment">         * Setup the power request event</span>
00913 <span class="comment">         */</span>
00914         hEvent[<a class="code" href="../../d0/d7/server_2server_8c.html#a1">ID_POWER</a>] = <a class="code" href="../../d0/d7/server_2server_8c.html#a14">ghPowerRequestEvent</a>;
00915 
00916         <span class="comment">/*</span>
00917 <span class="comment">         * Setup the MediaChangeEvent</span>
00918 <span class="comment">         */</span>
00919         hEvent[<a class="code" href="../../d0/d7/server_2server_8c.html#a2">ID_MEDIACHANGE</a>] = <a class="code" href="../../d0/d7/server_2server_8c.html#a15">ghMediaRequestEvent</a>;
00920 
00921 
00922         <span class="comment">/*</span>
00923 <span class="comment">         *  Setup the NetDeviceChange Event</span>
00924 <span class="comment">         */</span>
00925 
00926         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a327">gSessionId</a> != 0) {
00927            <span class="comment">//</span>
00928            <span class="comment">// Only on remote Session</span>
00929            <span class="comment">//</span>
00930 
00931 
00932             swprintf(szObjectStr,L<span class="stringliteral">"%ws\\%ld\\BaseNamedObjects\\%ws"</span>,
00933                                                      SESSION_ROOT,gSessionId,SC_BSM_EVENT_NAME);
00934 
00935             <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, szObjectStr);
00936 
00937             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/server_2server_8c.html#a52">CreateBSMEventSD</a>(&amp;pSD) ) {
00938 
00939                 InitializeObjectAttributes(&amp;Attributes,
00940                                            &amp;UnicodeString,
00941                                            OBJ_CASE_INSENSITIVE | OBJ_OPENIF,
00942                                            NULL,
00943                                            pSD);
00944 
00945                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;hEvent[ID_NETDEVCHANGE], EVENT_ALL_ACCESS, &amp;Attributes, SynchronizationEvent, FALSE))) {
00946 
00947                     NumEvents--;
00948 
00949                 }
00950 
00951                 LocalFree(pSD);
00952             } <span class="keywordflow">else</span> {
00953 
00954                 NumEvents--;
00955             }
00956 
00957         } <span class="keywordflow">else</span> {
00958             <span class="comment">//</span>
00959             <span class="comment">// On Console we don't wait for NetDeviceEvent</span>
00960             <span class="comment">//</span>
00961             NumEvents--;
00962         }
00963 
00964         <span class="comment">/*</span>
00965 <span class="comment">         * Only want media change events on the console.</span>
00966 <span class="comment">         */</span>
00967         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a327">gSessionId</a> == 0) {
00968         }
00969 
00970         <a class="code" href="../../d0/d7/server_2server_8c.html#a39">StartRegReadRead</a>();
00971 
00972         <span class="comment">/*</span>
00973 <span class="comment">         * Sit and wait forever.</span>
00974 <span class="comment">         */</span>
00975         <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00976             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/obwait_8c.html#a5">NtWaitForMultipleObjects</a>(NumEvents,
00977                                               hEvent,
00978                                               WaitAny,
00979                                               TRUE,
00980                                               NULL);
00981 
00982 
00983             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d0/d7/server_2server_8c.html#a0">ID_NLS</a> + WAIT_OBJECT_0) {
00984 
00985                 <span class="comment">/*</span>
00986 <span class="comment">                 * Handle the NLS event</span>
00987 <span class="comment">                 */</span>
00988                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/server_2server_8c.html#a12">gfLogon</a>) {
00989                     <a class="code" href="../../d0/d7/server_2server_8c.html#a12">gfLogon</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00990                     <a class="code" href="../../d0/d7/server_2server_8c.html#a46">BaseSrvNlsUpdateRegistryCache</a>(NULL, NULL);
00991                 }
00992 
00993             }
00994             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d0/d7/server_2server_8c.html#a1">ID_POWER</a> + WAIT_OBJECT_0) {
00995 
00996                 <span class="comment">/*</span>
00997 <span class="comment">                 * Handle the power request event</span>
00998 <span class="comment">                 */</span>
00999                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_XXXUSERPOWERCALLOUTWORKER);
01000 
01001             }
01002             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d0/d7/server_2server_8c.html#a2">ID_MEDIACHANGE</a> + WAIT_OBJECT_0) {
01003 
01004                 <span class="comment">/*</span>
01005 <span class="comment">                 * Handle the media change event</span>
01006 <span class="comment">                 */</span>
01007                 <a class="code" href="../../d0/d7/server_2server_8c.html#a49">HandleMediaChangeEvent</a>();
01008 
01009                 <a class="code" href="../../d0/d8/ex_2event_8c.html#a9">NtResetEvent</a>(hEvent[ID_MEDIACHANGE], NULL);
01010             }
01011             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == <a class="code" href="../../d0/d7/server_2server_8c.html#a3">ID_NETDEVCHANGE</a> + WAIT_OBJECT_0) {
01012 
01013                 <span class="comment">/*</span>
01014 <span class="comment">                 * Handle the NetDevice change event for remote sessions</span>
01015 <span class="comment">                 */</span>
01016                 <a class="code" href="../../d0/d7/server_2server_8c.html#a51">HandleRemoteNetDeviceChangeEvent</a>();
01017 
01018             }
01019 
01020 
01021         } <span class="comment">// While (TRUE)</span>
01022 
01023     } except (CsrUnhandledExceptionFilter(GetExceptionInformation())) {
01024         KdPrint((<span class="stringliteral">"Registry notification thread is dead, sorry.\n"</span>));
01025     }
01026 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="server/server.c::RegReadApcProcedure" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RegReadApcProcedure           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>RegReadApcContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PIO_STATUS_BLOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>IoStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00387">387</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00026">hKeyPriority</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00028">IoStatusRegChange</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01156">NtNotifyChangeKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00029">RegChangeBuffer</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00387">RegReadApcProcedure()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00387">RegReadApcProcedure()</a>, and <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00431">StartRegReadRead()</a>.
<p>
<pre class="fragment"><div>00391 {
00392     UNICODE_STRING ValueString;
00393     LONG <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00394     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> Buf[<span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)];
00395     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbSize;
00396     ULONG l;
00397 
00398     UNREFERENCED_PARAMETER(RegReadApcContext);
00399     UNREFERENCED_PARAMETER(IoStatus);
00400 
00401     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;ValueString, L<span class="stringliteral">"Win32PrioritySeparation"</span>);
00402     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(hKeyPriority,
00403             &amp;ValueString,
00404             KeyValuePartialInformation,
00405             (PKEY_VALUE_PARTIAL_INFORMATION)Buf,
00406             <span class="keyword">sizeof</span>(Buf),
00407             &amp;cbSize);
00408     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00409         l = *((PDWORD)((PKEY_VALUE_PARTIAL_INFORMATION)Buf)-&gt;Data);
00410     } <span class="keywordflow">else</span> {
00411         l = PROCESS_PRIORITY_SEPARATION_MAX;  <span class="comment">// last resort default</span>
00412     }
00413 
00414     <a class="code" href="../../d6/d8/sysinfo_8c.html#a50">NtSetSystemInformation</a>(SystemPrioritySeperation,&amp;l,<span class="keyword">sizeof</span>(ULONG));
00415 
00416     <a class="code" href="../../d7/d7/ntapi_8c.html#a21">NtNotifyChangeKey</a>(
00417         hKeyPriority,
00418         NULL,
00419         (PIO_APC_ROUTINE)RegReadApcProcedure,
00420         NULL,
00421         &amp;IoStatusRegChange,
00422         REG_NOTIFY_CHANGE_LAST_SET,
00423         FALSE,
00424         &amp;RegChangeBuffer,
00425         <span class="keyword">sizeof</span>(RegChangeBuffer),
00426         TRUE
00427         );
00428 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a60" doxytag="server/server.c::SetDbgTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetDbgTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwBitFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01290">1290</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>01291 {
01292     UNREFERENCED_PARAMETER(tag);
01293     UNREFERENCED_PARAMETER(dwBitFlags);
01294 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a59" doxytag="server/server.c::SetRipFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetRipFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwRipFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwRipPID</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01282">1282</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00025">gdwRIPFlags</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01174">RIPF_VALIDUSERFLAGS</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>01283 {
01284     <span class="keywordflow">if</span> ((dwRipFlags != (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1) &amp;&amp; !(dwRipFlags &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a398">RIPF_VALIDUSERFLAGS</a>)) {
01285         <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a6">gdwRIPFlags</a> = (WORD)((<a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a6">gdwRIPFlags</a> &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a398">RIPF_VALIDUSERFLAGS</a>) | dwRipFlags);
01286     }
01287     UNREFERENCED_PARAMETER(dwRipPID);
01288 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="server/server.c::SrvActivateDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvActivateDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/w32_2ntuser_2server_2debug_8c-source.html#l00028">28</a> of file <a class="el" href="../../d5/d4/w32_2ntuser_2server_2debug_8c-source.html">w32/ntuser/server/debug.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00061">_ACTIVATEDEBUGGERMSG::ClientId</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d4/w32_2ntuser_2server_2debug_8c-source.html#l00016">gpfnAttachRoutine</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00214">NtAlertThread()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/rtl_2ppc_2context_8c-source.html#l00114">RtlRemoteCall()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00031 {
00032     <a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html">PACTIVATEDEBUGGERMSG</a> a = (<a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html">PACTIVATEDEBUGGERMSG</a>)&amp;m-&gt;u.ApiMessageData;
00033     PCSR_THREAD Thread;
00034     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00035 
00036     UNREFERENCED_PARAMETER(ReplyStatus);
00037 
00038     <span class="comment">/*</span>
00039 <span class="comment">     * If the process is CSR, break</span>
00040 <span class="comment">     */</span>
00041     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html#o0">ClientId</a>.UniqueProcess == NtCurrentTeb()-&gt;ClientId.UniqueProcess) {
00042         DbgBreakPoint();
00043         <span class="keywordflow">return</span> STATUS_SUCCESS;
00044     }
00045 
00046     <span class="comment">/*</span>
00047 <span class="comment">     * Impersonate the client if this is a user mode request.</span>
00048 <span class="comment">     */</span>
00049     <span class="keywordflow">if</span> (m-&gt;h.u2.s2.Type == LPC_REQUEST) {
00050         <span class="keywordflow">if</span> (!CsrImpersonateClient(NULL)) {
00051             <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
00052         }
00053     }
00054 
00055     <span class="comment">/*</span>
00056 <span class="comment">     * Lock the client thread</span>
00057 <span class="comment">     */</span>
00058     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = CsrLockThreadByClientId(a-&gt;<a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html#o0">ClientId</a>.UniqueThread, &amp;Thread);
00059     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00060         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(a-&gt;<a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html#o0">ClientId</a>.UniqueProcess == Thread-&gt;ClientId.UniqueProcess);
00061 
00062         <span class="comment">/*</span>
00063 <span class="comment">         * Now that everything is set, rtlremote call to a debug breakpoint.</span>
00064 <span class="comment">         * This causes the process to enter the debugger with a breakpoint.</span>
00065 <span class="comment">         */</span>
00066         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/rtl_2ppc_2context_8c.html#a2">RtlRemoteCall</a>(
00067                     Thread-&gt;Process-&gt;ProcessHandle,
00068                     Thread-&gt;ThreadHandle,
00069                     (PVOID)gpfnAttachRoutine,
00070                     0,
00071                     NULL,
00072                     TRUE,
00073                     FALSE
00074                     );
00075         UserAssert(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00076         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d2/psspnd_8c.html#a2">NtAlertThread</a>(Thread-&gt;ThreadHandle);
00077         UserAssert(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00078         CsrUnlockThread(Thread);
00079     }
00080 
00081     <span class="comment">/*</span>
00082 <span class="comment">     * Stop impersonating the client.</span>
00083 <span class="comment">     */</span>
00084     <span class="keywordflow">if</span> (m-&gt;h.u2.s2.Type == LPC_REQUEST) {
00085         CsrRevertToSelf();
00086     }
00087 
00088     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00089 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="server/server.c::SrvDeviceEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvDeviceEvent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/instdev_8c-source.html#l00037">37</a> of file <a class="el" href="../../d2/d3/instdev_8c-source.html">instdev.c</a>.
<p>
References <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00084">_DEVICEEVENTMSG::dwFlags</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00085">_DEVICEEVENTMSG::dwResult</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00081">_DEVICEEVENTMSG::hWnd</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00083">_DEVICEEVENTMSG::lParam</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00697">SendMessageTimeout()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00082">_DEVICEEVENTMSG::wParam</a>.
<p>
<pre class="fragment"><div>00040 {
00041     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00042     <a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html">PDEVICEEVENTMSG</a> a = (<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html">PDEVICEEVENTMSG</a>)&amp;m-&gt;u.ApiMessageData;
00043     USERTHREAD_USEDESKTOPINFO utudi;
00044 
00045     UNREFERENCED_PARAMETER(ReplyStatus);
00046 
00047     <span class="keywordflow">try</span> {
00048 
00049         <span class="comment">//</span>
00050         <span class="comment">// Set the desktop to the active desktop before sending the</span>
00051         <span class="comment">// message.</span>
00052         <span class="comment">//</span>
00053 
00054         utudi.hThread = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00055         utudi.drdRestore.pdeskRestore = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00056         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00057                                             UserThreadUseActiveDesktop,
00058                                             &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00059         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00060 <span class="preprocessor">            #if DBG</span>
00061 <span class="preprocessor"></span>            KdPrint((<span class="stringliteral">"--&gt; SrvDeviceEvent: NtUserSetInformationThread failed %d\n"</span>, Status));
00062 <span class="preprocessor">            #endif</span>
00063 <span class="preprocessor"></span>            <span class="keywordflow">goto</span> Clean1;
00064         }
00065 
00066         <span class="comment">//</span>
00067         <span class="comment">// Verify the window handle is still valid, if not, let the caller know</span>
00068         <span class="comment">// so it can be purged from the notification window hand list that the</span>
00069         <span class="comment">// user-mode pnp manager keeps.</span>
00070         <span class="comment">//</span>
00071 
00072         <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o0">hWnd</a> != HWND_BROADCAST) &amp;&amp; !<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o0">hWnd</a>)) {
00073             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_HANDLE;
00074             <span class="keywordflow">goto</span> Clean0;
00075         }
00076 
00077         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o3">dwFlags</a>) {
00078 
00079             <span class="comment">//</span>
00080             <span class="comment">// This is a query so we have to send the message but use</span>
00081             <span class="comment">// timeouts so an app can't stall us forever.</span>
00082             <span class="comment">//</span>
00083 
00084             RIPMSG3(RIP_VERBOSE, <span class="stringliteral">"--&gt; SrvDeviceEvent: Sending WM_DEVICECHANGE to 0x%x, w 0x%x, l 0x%x"</span>,
00085                     (ULONG_PTR)a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o0">hWnd</a>,
00086                     a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o1">wParam</a>,
00087                     a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o2">lParam</a>);
00088 
00089             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d9/cltxt_8h.html#a17">SendMessageTimeout</a>(a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o0">hWnd</a>, WM_DEVICECHANGE, a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o1">wParam</a>, a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o2">lParam</a>,
00090                                     SMTO_ABORTIFHUNG | SMTO_NORMAL,
00091                                     PNP_NOTIFY_TIMEOUT, &amp;a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o4">dwResult</a>)) {
00092                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00093             }
00094 
00095         } <span class="keywordflow">else</span> {
00096 
00097             <span class="comment">//</span>
00098             <span class="comment">// It's not a query so just post it and return, we don't</span>
00099             <span class="comment">// care what the app returns.</span>
00100             <span class="comment">//</span>
00101 
00102             RIPMSG3(RIP_VERBOSE, <span class="stringliteral">"--&gt; SrvDeviceEvent: Posting WM_DEVICECHANGE to 0x%x, w 0x%x, l 0x%x"</span>,
00103                     (ULONG_PTR)a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o0">hWnd</a>,
00104                     a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o1">wParam</a>,
00105                     a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o2">lParam</a>);
00106 
00107             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o0">hWnd</a>, WM_DEVICECHANGE, a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o1">wParam</a>, a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o2">lParam</a>)) {
00108                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00109             }
00110         }
00111 
00112     Clean0:
00113 
00114         <span class="comment">//</span>
00115         <span class="comment">// Reset this thread's desktop back to NULL before returning. This</span>
00116         <span class="comment">// decrements the desktop's reference count.</span>
00117         <span class="comment">//</span>
00118 
00119         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(NtCurrentThread(),
00120                                    UserThreadUseDesktop,
00121                                    &amp;utudi, <span class="keyword">sizeof</span>(utudi));
00122 
00123     Clean1:
00124         ;
00125 
00126     } except (EXCEPTION_EXECUTE_HANDLER) {
00127         KdPrint((<span class="stringliteral">"SrvDeviceEvent generated an exception (%d)\n"</span>, GetExceptionCode()));
00128         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00129     }
00130 
00131     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00132 
00133 } <span class="comment">// SrvDeviceEvent</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="server/server.c::SrvEndTask" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvEndTask           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l01963">1963</a> of file <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html">server/exitwin.c</a>.
<p>
References <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l01601">_EndTask()</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00038">_ENDTASKMSG::dwLastError</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00041">_ENDTASKMSG::fForce</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00040">_ENDTASKMSG::fShutdown</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00042">_ENDTASKMSG::fSuccess</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00039">_ENDTASKMSG::hwnd</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00044">NtReplyPort()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01966 {
01967     <a class="code" href="../../d5/d3/struct__ENDTASKMSG.html">PENDTASKMSG</a> petm = (<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html">PENDTASKMSG</a>)&amp;m-&gt;u.ApiMessageData;
01968     PCSR_THREAD pcsrt;
01969     PTEB Teb = NtCurrentTeb();
01970 
01971     Teb-&gt;LastErrorValue = 0;
01972     pcsrt = CSR_SERVER_QUERYCLIENTTHREAD();
01973     <span class="comment">/*</span>
01974 <span class="comment">     * Don't block the client so it can respond to messages while we</span>
01975 <span class="comment">     *  process this request -- we might bring up the End Application</span>
01976 <span class="comment">     *  dialog or the hwnd being shutdown might request some user action.</span>
01977 <span class="comment">     */</span>
01978     <span class="keywordflow">if</span> (pcsrt-&gt;Process-&gt;ClientPort != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01979         m-&gt;ReturnValue = STATUS_SUCCESS;
01980         petm-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o0">dwLastError</a> = 0;
01981         petm-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o4">fSuccess</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01982         <a class="code" href="../../d5/d7/lpcreply_8c.html#a1">NtReplyPort</a>(pcsrt-&gt;Process-&gt;ClientPort, (PPORT_MESSAGE)m);
01983         *ReplyStatus = CsrServerReplied;
01984     }
01985 
01986     petm-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o4">fSuccess</a> = <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a17">_EndTask</a>(petm-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o1">hwnd</a>, petm-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o2">fShutdown</a>, petm-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o3">fForce</a>);
01987 
01988     petm-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o0">dwLastError</a> = Teb-&gt;LastErrorValue;
01989     <span class="keywordflow">return</span> STATUS_SUCCESS;
01990 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="server/server.c::SrvExitWindowsEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvExitWindowsEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l01950">1950</a> of file <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html">server/exitwin.c</a>.
<p>
References <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l00050">_ExitWindowsEx()</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l00016">BEGIN_LPC_RECV</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l00026">END_LPC_RECV</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01953 {
01954     <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a0">BEGIN_LPC_RECV</a>(EXITWINDOWSEX);
01955 
01956     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a10">_ExitWindowsEx</a>(pcsrt, a-&gt;uFlags, a-&gt;dwReserved);
01957     a-&gt;fSuccess = <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status);
01958 
01959     <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a1">END_LPC_RECV</a>();
01960 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="server/server.c::SrvGetThreadConsoleDesktop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetThreadConsoleDesktop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01235">1235</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00065">_GETTHREADCONSOLEDESKTOPMSG::dwThreadId</a>, <a class="el" href="../../d8/d3/server_2private_8c-source.html#l03139">GetThreadConsoleDesktop()</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00066">_GETTHREADCONSOLEDESKTOPMSG::hdeskConsole</a>, and <a class="el" href="../../d2/d0/csrmsg_8h.html#a15">PGETTHREADCONSOLEDESKTOPMSG</a>.
<p>
<pre class="fragment"><div>01238 {
01239     <a class="code" href="../../d2/d2/struct__GETTHREADCONSOLEDESKTOPMSG.html">PGETTHREADCONSOLEDESKTOPMSG</a> a = (<a class="code" href="../../d2/d2/struct__GETTHREADCONSOLEDESKTOPMSG.html">PGETTHREADCONSOLEDESKTOPMSG</a>)&amp;m-&gt;u.ApiMessageData;
01240 
01241     UNREFERENCED_PARAMETER(ReplyStatus);
01242 
01243     <span class="keywordflow">return</span> <a class="code" href="../../d0/d7/server_2server_8c.html#a43">GetThreadConsoleDesktop</a>(a-&gt;<a class="code" href="../../d2/d2/struct__GETTHREADCONSOLEDESKTOPMSG.html#o0">dwThreadId</a>, &amp;a-&gt;<a class="code" href="../../d2/d2/struct__GETTHREADCONSOLEDESKTOPMSG.html#o1">hdeskConsole</a>);
01244 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="server/server.c::SrvLogon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvLogon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01121">1121</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d7/server_2server_8c.html#a47">BaseSrvNlsLogon()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00046">_LOGONMSG::fLogon</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01068">GetTimeouts()</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00031">gfLogon</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00030">ghNlsEvent</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02132">InitializeConsoleAttributes()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l01989">LdrFlushAlternateResourceModules()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d0/csrmsg_8h.html#a7">PLOGONMSG</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01124 {
01125     <a class="code" href="../../d4/d3/struct__LOGONMSG.html">PLOGONMSG</a> a = (<a class="code" href="../../d4/d3/struct__LOGONMSG.html">PLOGONMSG</a>)&amp;m-&gt;u.ApiMessageData;
01126     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01127 
01128     UNREFERENCED_PARAMETER(ReplyStatus);
01129 
01130     <span class="keywordflow">if</span> (!CsrImpersonateClient(NULL))
01131         <span class="keywordflow">return</span> (ULONG)STATUS_UNSUCCESSFUL;
01132 
01133     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d3/struct__LOGONMSG.html#o0">fLogon</a>) {
01134 
01135         <span class="comment">/*</span>
01136 <span class="comment">         * Flush the MultiLingual UI (MUI) alternate</span>
01137 <span class="comment">         * resource modules from within NTDLL, so that the </span>
01138 <span class="comment">         * new user logging-on gets his chance to </span>
01139 <span class="comment">         * load his own.</span>
01140 <span class="comment">         */</span>
01141         <a class="code" href="../../d1/d3/ldrrsrc_8c.html#a23">LdrFlushAlternateResourceModules</a>();
01142 
01143         <span class="comment">/*</span>
01144 <span class="comment">         *  Take care of NLS cache for LogON.</span>
01145 <span class="comment">         */</span>
01146         <a class="code" href="../../d0/d7/server_2server_8c.html#a47">BaseSrvNlsLogon</a>(TRUE);
01147 
01148         <span class="comment">/*</span>
01149 <span class="comment">         *  Set the cleanup event so that the RIT can handle the NLS</span>
01150 <span class="comment">         *  registry notification.</span>
01151 <span class="comment">         */</span>
01152         <a class="code" href="../../d0/d7/server_2server_8c.html#a12">gfLogon</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01153         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>( ghNlsEvent, NULL );
01154         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
01155     } <span class="keywordflow">else</span> {
01156 
01157         <span class="comment">/*</span>
01158 <span class="comment">         *  Take care of NLS cache for LogOFF.</span>
01159 <span class="comment">         */</span>
01160         <a class="code" href="../../d0/d7/server_2server_8c.html#a47">BaseSrvNlsLogon</a>(FALSE);
01161     }
01162 
01163     <span class="comment">/*</span>
01164 <span class="comment">     * Get timeout values from registry</span>
01165 <span class="comment">     */</span>
01166     <a class="code" href="../../d0/d7/server_2server_8c.html#a38">GetTimeouts</a>();
01167 
01168     CsrRevertToSelf();
01169 
01170     <span class="comment">/*</span>
01171 <span class="comment">     * Initialize console attributes</span>
01172 <span class="comment">     */</span>
01173     <a class="code" href="../../d0/d7/server_2server_8c.html#a42">InitializeConsoleAttributes</a>();
01174 
01175     <span class="keywordflow">return</span> (ULONG)STATUS_SUCCESS;
01176 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="server/server.c::SrvRegisterLogonProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvRegisterLogonProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01179">1179</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, and <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00038">gIdLogon</a>.
<p>
<pre class="fragment"><div>01182 {
01183     <span class="comment">/*</span>
01184 <span class="comment">     * Fail if this is not the first call.</span>
01185 <span class="comment">     */</span>
01186     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a10">gIdLogon</a> != 0) {
01187         <span class="keywordflow">return</span> (ULONG)STATUS_UNSUCCESSFUL;
01188     }
01189 
01190     <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a10">gIdLogon</a> = *(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>*)m-&gt;u.ApiMessageData;
01191 
01192     UNREFERENCED_PARAMETER(ReplyStatus);
01193 
01194     <span class="keywordflow">return</span> (ULONG)STATUS_SUCCESS;
01195 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="server/server.c::SrvRegisterServicesProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvRegisterServicesProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l02053">2053</a> of file <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html">server/exitwin.c</a>.
<p>
References <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l00016">BEGIN_LPC_RECV</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l00026">END_LPC_RECV</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00201">EnterCrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00031">gdwServicesProcessId</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l02001">IsPrivileged()</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00202">LeaveCrit</a>, <a class="el" href="../../d0/d6/ntuser_2kernel_2globals_8h-source.html#l00512">psTcb</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>02056 {
02057     PRIVILEGE_SET <a class="code" href="../../d9/d6/ntuser_2kernel_2globals_8h.html#a248">psTcb</a> = { 1, PRIVILEGE_SET_ALL_NECESSARY,
02058         { SE_TCB_PRIVILEGE, 0 }
02059     };
02060 
02061     <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a0">BEGIN_LPC_RECV</a>(REGISTERSERVICESPROCESS);
02062 
02063     <span class="comment">/*</span>
02064 <span class="comment">     * Allow only one services process and then only if it has TCB</span>
02065 <span class="comment">     * privilege.</span>
02066 <span class="comment">     */</span>
02067     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
02068     <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a7">gdwServicesProcessId</a> != 0) || !<a class="code" href="../../d2/d0/server_2exitwin_8c.html#a22">IsPrivileged</a>(&amp;psTcb)) {
02069         SetLastError(ERROR_ACCESS_DENIED);
02070         a-&gt;fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02071     } <span class="keywordflow">else</span> {
02072         <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a7">gdwServicesProcessId</a> = a-&gt;dwProcessId;
02073         a-&gt;fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02074     }
02075     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
02076 
02077     <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a1">END_LPC_RECV</a>();
02078 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="server/server.c::SrvWin32HeapFail" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvWin32HeapFail           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01198">1198</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00071">_WIN32HEAPFAILMSG::bFail</a>, and <a class="el" href="../../d2/d0/csrmsg_8h.html#a17">PWIN32HEAPFAILMSG</a>.
<p>
<pre class="fragment"><div>01201 {
01202 <span class="preprocessor">#if DBG</span>
01203 <span class="preprocessor"></span>    <a class="code" href="../../d7/d8/struct__WIN32HEAPFAILMSG.html">PWIN32HEAPFAILMSG</a> a = (<a class="code" href="../../d7/d8/struct__WIN32HEAPFAILMSG.html">PWIN32HEAPFAILMSG</a>)&amp;m-&gt;u.ApiMessageData;
01204 
01205     Win32HeapFailAllocations(a-&gt;<a class="code" href="../../d7/d8/struct__WIN32HEAPFAILMSG.html#o1">bFail</a>);
01206 
01207 <span class="preprocessor">#endif</span>
01208 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (ULONG)STATUS_SUCCESS;
01209     UNREFERENCED_PARAMETER(m);
01210     UNREFERENCED_PARAMETER(ReplyStatus);
01211 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="server/server.c::SrvWin32HeapStat" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvWin32HeapStat           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01214">1214</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00076">_WIN32HEAPSTATMSG::dwLen</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00077">_WIN32HEAPSTATMSG::dwMaxTag</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00075">_WIN32HEAPSTATMSG::phs</a>, <a class="el" href="../../d2/d0/csrmsg_8h.html#a19">PWIN32HEAPSTATMSG</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01217 {
01218 <span class="preprocessor">#if DBG</span>
01219 <span class="preprocessor"></span>    <span class="keyword">extern</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Win32HeapStat(PDBGHEAPSTAT phs, DWORD dwLen, BOOL bNeedTagShift);
01220 
01221     <a class="code" href="../../d8/d8/struct__WIN32HEAPSTATMSG.html">PWIN32HEAPSTATMSG</a> a = (<a class="code" href="../../d8/d8/struct__WIN32HEAPSTATMSG.html">PWIN32HEAPSTATMSG</a>)&amp;m-&gt;u.ApiMessageData;
01222 
01223     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d8/d8/struct__WIN32HEAPSTATMSG.html#o0">phs</a>, a-&gt;<a class="code" href="../../d8/d8/struct__WIN32HEAPSTATMSG.html#o1">dwLen</a>, <span class="keyword">sizeof</span>(BYTE))) {
01224         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01225     }
01226     a-&gt;<a class="code" href="../../d8/d8/struct__WIN32HEAPSTATMSG.html#o2">dwMaxTag</a> = Win32HeapStat(a-&gt;<a class="code" href="../../d8/d8/struct__WIN32HEAPSTATMSG.html#o0">phs</a>, a-&gt;<a class="code" href="../../d8/d8/struct__WIN32HEAPSTATMSG.html#o1">dwLen</a>, TRUE);
01227 
01228 <span class="preprocessor">#endif</span>
01229 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (ULONG)STATUS_SUCCESS;
01230     UNREFERENCED_PARAMETER(m);
01231     UNREFERENCED_PARAMETER(ReplyStatus);
01232 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="server/server.c::StartRegReadRead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID StartRegReadRead           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00431">431</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00026">hKeyPriority</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00387">RegReadApcProcedure()</a>, and <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>.
<p>
<pre class="fragment"><div>00432 {
00433     UNICODE_STRING UnicodeString;
00434     OBJECT_ATTRIBUTES OA;
00435 
00436     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString,
00437             L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\PriorityControl"</span>);
00438     InitializeObjectAttributes(&amp;OA, &amp;UnicodeString, OBJ_CASE_INSENSITIVE, NULL, NULL);
00439 
00440     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(&amp;hKeyPriority, KEY_READ | KEY_NOTIFY, &amp;OA)))
00441         UserAssert(FALSE);
00442 
00443     <a class="code" href="../../d0/d7/server_2server_8c.html#a40">RegReadApcProcedure</a>(NULL, NULL);
00444 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="server/server.c::UserClientConnect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS UserClientConnect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCSR_PROCESS&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ConnectionInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>pulConnectionLen</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00357">357</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00655">CsrApiPort</a>, <a class="el" href="../../d2/d8/api_8c.html#a23">CsrQueryApiPort()</a>, <a class="el" href="../../d9/d5/ntuser_2client_2globals_8h-source.html#l00026">gDispatchTableValues</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02788">NtUserProcessConnect()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07575">NtUserSetInformationThread()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1005">USERCONNECT</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.
<p>
<pre class="fragment"><div>00361 {
00362     <span class="comment">/*</span>
00363 <span class="comment">     * Pass the api port to the kernel.  Do this early so the kernel</span>
00364 <span class="comment">     * can send a datagram to CSR to activate a debugger.</span>
00365 <span class="comment">     */</span>
00366     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a243">CsrApiPort</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00367         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a243">CsrApiPort</a> = <a class="code" href="../../d2/d8/api_8c.html#a23">CsrQueryApiPort</a>();
00368         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a277">NtUserSetInformationThread</a>(
00369                 NtCurrentThread(),
00370                 UserThreadCsrApiPort,
00371                 &amp;CsrApiPort,
00372                 <span class="keyword">sizeof</span>(HANDLE));
00373     }
00374 
00375     UserAssert(*pulConnectionLen == <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d4/struct__USERCONNECT.html">USERCONNECT</a>));
00376     <span class="keywordflow">if</span> (*pulConnectionLen != <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d4/struct__USERCONNECT.html">USERCONNECT</a>)) {
00377         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00378     }
00379 
00380     ((<a class="code" href="../../d6/d4/struct__USERCONNECT.html">PUSERCONNECT</a>)ConnectionInformation)-&gt;dwDispatchCount = <a class="code" href="../../d8/d6/ntuser_2client_2globals_8h.html#a11">gDispatchTableValues</a>;
00381     <span class="keywordflow">return</span> <a class="code" href="../../d9/d6/kernel_2server_8c.html#a84">NtUserProcessConnect</a>(Process-&gt;ProcessHandle,
00382             (<a class="code" href="../../d6/d4/struct__USERCONNECT.html">PUSERCONNECT</a>)ConnectionInformation, *pulConnectionLen);
00383 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="server/server.c::UserClientShutdown" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS UserClientShutdown           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCSR_PROCESS&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>fFirstPass</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="server/server.c::UserHardError" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UserHardError           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>pcsrt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PHARDERROR_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>pmsg</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d7/w32_2ntuser_2server_2harderr_8c-source.html#l01662">1662</a> of file <a class="el" href="../../d8/d7/w32_2ntuser_2server_2harderr_8c-source.html">w32/ntuser/server/harderr.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d7/w32_2ntuser_2server_2harderr_8c-source.html#l01686">UserHardErrorEx()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.
<p>
<pre class="fragment"><div>01665 {
01666     <a class="code" href="../../d7/d8/w32_2ntuser_2server_2harderr_8c.html#a11">UserHardErrorEx</a>(pt, pmsg, NULL);
01667 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a61" doxytag="server/server.c::UserRtlRaiseStatus" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UserRtlRaiseStatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">NTSTATUS&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Status</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01296">1296</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00563">RtlRaiseStatus()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>01297 {
01298     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a10">RtlRaiseStatus</a>(Status);
01299 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="server/server.c::UserServerDllInitialization" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS UserServerDllInitialization           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCSR_SERVER_DLL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>psrvdll</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">192</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
References <a class="el" href="../../d0/d7/server_2server_8c.html#a45">BaseSetProcessCreateNotify()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00201">EnterCrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00018">gcsUserSrv</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00025">gdwRIPFlags</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00056">gheventCancel</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00057">gheventCancelled</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00034">ghMediaRequestEvent</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00017">ghModuleWin</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00033">ghPowerRequestEvent</a>, <a class="el" href="../../d5/d4/w32_2ntuser_2server_2debug_8c-source.html#l00016">gpfnAttachRoutine</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00047">gpwszaSUCCESS</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00050">gpwszaSYSTEM_ERROR</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00048">gpwszaSYSTEM_INFORMATION</a>, <a class="el" href="../../d5/d5/ntuser_2server_2globals_8c-source.html#l00049">gpwszaSYSTEM_WARNING</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00025">hThreadNotification</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03600">ISTS</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00202">LeaveCrit</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00180">NtCreateEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02713">NtUserInitialize()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07631">NtUserNotifyProcessCreate()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01166">RIPF_DEFAULT</a>, <a class="el" href="../../d1/d1/rtlexec_8c-source.html#l01241">RtlCreateUserThread()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l01432">RtlGetNtGlobalFlags()</a>, <a class="el" href="../../d8/d7/dll_2resource_8c-source.html#l01210">RtlInitializeCriticalSection()</a>, <a class="el" href="../../d8/d7/w32_2ntuser_2server_2harderr_8c-source.html#l01499">RtlLoadStringOrError()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00357">UserClientConnect()</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l00219">UserClientShutdown()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01305">USERCURRENTVERSION</a>, <a class="el" href="../../d8/d7/w32_2ntuser_2server_2harderr_8c-source.html#l01662">UserHardError()</a>, <a class="el" href="../../d2/d0/csrmsg_8h.html#a35a34">UserpMaxApiNumber</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00107">UserServerApiDispatchTable</a>, <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00120">UserServerApiServerValidTable</a>, and <a class="el" href="../../d3/d7/api_8c-source.html#l00212">WinStationAPIInit()</a>.
<p>
<pre class="fragment"><div>00194 {
00195     CLIENT_ID ClientId;
00196     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bAllocated;
00197     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00198 
00199     <span class="comment">/*</span>
00200 <span class="comment">     * Initialize the RIP flags to default</span>
00201 <span class="comment">     */</span>
00202     <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a6">gdwRIPFlags</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a393">RIPF_DEFAULT</a>;
00203 
00204 <span class="preprocessor">#if DBG</span>
00205 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a25">RtlGetNtGlobalFlags</a>() &amp; FLG_SHOW_LDR_SNAPS) {
00206         RIPMSG0(RIP_WARNING,
00207                 <span class="stringliteral">"UserServerDllInitialization: entered"</span>);
00208     }
00209 <span class="preprocessor">#endif</span>
00210 <span class="preprocessor"></span>
00211     <span class="comment">/*</span>
00212 <span class="comment">     * Initialize a critical section structure that will be used to protect</span>
00213 <span class="comment">     * all of the User Server's critical sections (except a few special</span>
00214 <span class="comment">     * cases like the RIT -- see below).</span>
00215 <span class="comment">     */</span>
00216 
00217     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;gcsUserSrv);
00218     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status))
00219     {
00220         RIPMSG1(RIP_WARNING,
00221                 <span class="stringliteral">"UserServerDllInitialization: InitializeCriticalSection failed with Status %x"</span>,
00222                 Status);
00223         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00224     }
00225     <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
00226 
00227     <span class="comment">/*</span>
00228 <span class="comment">     * Remember WINSRV.DLL's hmodule so we can grab resources from it later.</span>
00229 <span class="comment">     */</span>
00230     <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a0">ghModuleWin</a> = psrvdll-&gt;ModuleHandle;
00231 
00232     psrvdll-&gt;ApiNumberBase = USERSRV_FIRST_API_NUMBER;
00233     psrvdll-&gt;MaxApiNumber = <a class="code" href="../../d2/d0/csrmsg_8h.html#a35a34">UserpMaxApiNumber</a>;
00234     psrvdll-&gt;ApiDispatchTable = <a class="code" href="../../d0/d7/server_2server_8c.html#a18">UserServerApiDispatchTable</a>;
00235 
00236     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/inc_2user_8h.html#a882">ISTS</a>()) {
00237         <a class="code" href="../../d0/d7/server_2server_8c.html#a19">UserServerApiServerValidTable</a>[0] = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; <span class="comment">// for ExitWindowsEx</span>
00238     }
00239 
00240     psrvdll-&gt;ApiServerValidTable = <a class="code" href="../../d0/d7/server_2server_8c.html#a19">UserServerApiServerValidTable</a>;
00241 <span class="preprocessor">#if DBG</span>
00242 <span class="preprocessor"></span>    psrvdll-&gt;ApiNameTable = UserServerApiNameTable;
00243 <span class="preprocessor">#else</span>
00244 <span class="preprocessor"></span>    psrvdll-&gt;ApiNameTable = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00245 <span class="preprocessor">#endif</span>
00246 <span class="preprocessor"></span>    psrvdll-&gt;ConnectRoutine         = <a class="code" href="../../d0/d7/server_2server_8c.html#a35">UserClientConnect</a>;
00247     psrvdll-&gt;HardErrorRoutine       = <a class="code" href="../../d7/d8/w32_2ntuser_2server_2harderr_8c.html#a28">UserHardError</a>;
00248     psrvdll-&gt;ShutdownProcessRoutine = <a class="code" href="../../d2/d0/server_2exitwin_8c.html#a9">UserClientShutdown</a>;
00249 
00250     <span class="comment">/*</span>
00251 <span class="comment">     * Create these events used by shutdown</span>
00252 <span class="comment">     */</span>
00253     <span class="comment">//BUGBUG we should test the return code of NtCreateEvent</span>
00254     <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;gheventCancel, EVENT_ALL_ACCESS, NULL,
00255                   NotificationEvent, FALSE);
00256     <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;gheventCancelled, EVENT_ALL_ACCESS, NULL,
00257                   NotificationEvent, FALSE);
00258 
00259     <span class="comment">/*</span>
00260 <span class="comment">     * Create the event used by the power request code.</span>
00261 <span class="comment">     */</span>
00262     <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;ghPowerRequestEvent, EVENT_ALL_ACCESS, NULL,
00263                   SynchronizationEvent, FALSE);
00264 
00265     <span class="comment">/*</span>
00266 <span class="comment">     * Create the event used by the media change code.</span>
00267 <span class="comment">     */</span>
00268     <a class="code" href="../../d0/d8/ex_2event_8c.html#a5">NtCreateEvent</a>(&amp;ghMediaRequestEvent, EVENT_ALL_ACCESS, NULL,
00269                   SynchronizationEvent, FALSE);
00270 
00271     <span class="comment">/*</span>
00272 <span class="comment">     * Tell the base what user address to call when it is creating a process</span>
00273 <span class="comment">     * (but before the process starts running).</span>
00274 <span class="comment">     */</span>
00275     <a class="code" href="../../d0/d7/server_2server_8c.html#a45">BaseSetProcessCreateNotify</a>(NtUserNotifyProcessCreate);
00276 
00277     <span class="comment">/*</span>
00278 <span class="comment">     * Load some strings.</span>
00279 <span class="comment">     */</span>
00280     <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a15">gpwszaSUCCESS</a>            = (PWSTR)<a class="code" href="../../d7/d1/usersrv_8h.html#a57">RtlLoadStringOrError</a>(ghModuleWin,
00281                                 STR_SUCCESS, NULL, &amp;bAllocated, FALSE);
00282     <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a16">gpwszaSYSTEM_INFORMATION</a> = (PWSTR)<a class="code" href="../../d7/d1/usersrv_8h.html#a57">RtlLoadStringOrError</a>(ghModuleWin,
00283                                 STR_SYSTEM_INFORMATION, NULL, &amp;bAllocated, FALSE);
00284     <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a17">gpwszaSYSTEM_WARNING</a>     = (PWSTR)<a class="code" href="../../d7/d1/usersrv_8h.html#a57">RtlLoadStringOrError</a>(ghModuleWin,
00285                                 STR_SYSTEM_WARNING, NULL, &amp;bAllocated, FALSE);
00286     <a class="code" href="../../d4/d6/ntuser_2server_2globals_8c.html#a18">gpwszaSYSTEM_ERROR</a>       = (PWSTR)<a class="code" href="../../d7/d1/usersrv_8h.html#a57">RtlLoadStringOrError</a>(ghModuleWin,
00287                                 STR_SYSTEM_ERROR, NULL, &amp;bAllocated, FALSE);
00288     <span class="comment">/*</span>
00289 <span class="comment">     * Initialize USER</span>
00290 <span class="comment">     */</span>
00291 
00292     {
00293         HANDLE hModBase;
00294 
00295         hModBase = GetModuleHandle(TEXT(<span class="stringliteral">"kernel32"</span>));
00296         UserAssert(hModBase);
00297         <a class="code" href="../../d4/d5/w32_2ntuser_2server_2debug_8c.html#a0">gpfnAttachRoutine</a> = GetProcAddress(hModBase,<span class="stringliteral">"BaseAttachCompleteThunk"</span>);
00298         UserAssert(gpfnAttachRoutine);
00299 
00300         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d6/kernel_2server_8c.html#a83">NtUserInitialize</a>(USERCURRENTVERSION, ghPowerRequestEvent, ghMediaRequestEvent);
00301         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00302             RIPMSG1(RIP_WARNING,
00303                     <span class="stringliteral">"UserServerDllInitialization: NtUserInitialize failed with Status %x"</span>,
00304                     Status);
00305             <span class="keywordflow">goto</span> ExitUserInit;
00306         }
00307     }
00308 
00309     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/inc_2user_8h.html#a882">ISTS</a>()) {
00310 
00311         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2server_8c.html#a48">WinStationAPIInit</a>();
00312         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00313             RIPMSG1(RIP_WARNING,
00314                     <span class="stringliteral">"UserServerDllInitialization: WinStationAPIInit failed with Status %x"</span>,
00315                     Status);
00316             <span class="keywordflow">goto</span> ExitUserInit;
00317         }
00318     }
00319 
00320     <span class="comment">/*</span>
00321 <span class="comment">     * Start registry notification thread</span>
00322 <span class="comment">     */</span>
00323     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d2/rtlexec_8c.html#a13">RtlCreateUserThread</a>(NtCurrentProcess(), NULL, FALSE, 0, 0, 4*0x1000,
00324             (PUSER_THREAD_START_ROUTINE)NotificationThread, NULL, &amp;hThreadNotification,
00325             &amp;ClientId);
00326     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00327         RIPMSG1(RIP_WARNING,
00328                 <span class="stringliteral">"UserServerDllInitialization: RtlCreateUserThread failed with Status %x"</span>,
00329                 Status);
00330     }
00331     CsrAddStaticServerThread(hThreadNotification, &amp;ClientId, 0);
00332 
00333 ExitUserInit:
00334     <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00335     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00336 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="server/server.c::WinStationAPIInit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS WinStationAPIInit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/api_8c-source.html#l00212">212</a> of file <a class="el" href="../../d3/d7/api_8c-source.html">api.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/ntuser_8h-source.html#l00029">DBGHYD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00931">gSessionId</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00138">NtResumeThread()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d1/rtlexec_8c-source.html#l01241">RtlCreateUserThread()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d8/api_8c.html#a42">TerminalServerRequestThread()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00138">ThreadHandle</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.
<p>
<pre class="fragment"><div>00214 {
00215     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00216     CLIENT_ID ClientId;
00217     HANDLE    <a class="code" href="../../d2/d1/cttoken_8c.html#a63">ThreadHandle</a>;
00218     KPRIORITY Priority;
00219 
00220 <span class="preprocessor">#if DBG</span>
00221 <span class="preprocessor"></span>    <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Inited = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00222 <span class="preprocessor">#endif</span>
00223 <span class="preprocessor"></span>
00224     UserAssert(Inited == FALSE);
00225 
00226     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a327">gSessionId</a> = NtCurrentPeb()-&gt;SessionId;
00227 
00228 <span class="preprocessor">#if DBG</span>
00229 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Inited)
00230         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"WinStationAPIInit called twice !!!\n"</span>));
00231 
00232     Inited = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00233 <span class="preprocessor">#endif</span>
00234 <span class="preprocessor"></span>
00235     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d2/rtlexec_8c.html#a13">RtlCreateUserThread</a>(NtCurrentProcess(),
00236                               NULL,
00237                               TRUE,
00238                               0L,
00239                               0L,
00240                               0L,
00241                               TerminalServerRequestThread,
00242                               NULL,
00243                               &amp;ThreadHandle,
00244                               &amp;ClientId);
00245 
00246     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00247         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"WinStationAPIInit: failed to create TerminalServerRequestThread\n"</span>));
00248         <span class="keywordflow">goto</span> Exit;
00249     }
00250     <span class="comment">/*</span>
00251 <span class="comment">     *  Add thread to server thread pool</span>
00252 <span class="comment">     */</span>
00253     CsrAddStaticServerThread(ThreadHandle, &amp;ClientId, 0);
00254 
00255     <span class="comment">/*</span>
00256 <span class="comment">     * Boost priority of ICA SRV Request thread</span>
00257 <span class="comment">     */</span>
00258     Priority = THREAD_BASE_PRIORITY_MAX;
00259 
00260     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d1/psquery_8c.html#a21">NtSetInformationThread</a>(ThreadHandle, ThreadBasePriority,
00261                                  &amp;Priority, <span class="keyword">sizeof</span>(Priority));
00262 
00263     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00264         <a class="code" href="../../d0/d0/ntuser_8h.html#a1">DBGHYD</a>((<span class="stringliteral">"WinStationAPIInit: failed to set thread priority\n"</span>));
00265         <span class="keywordflow">goto</span> Exit;
00266     }
00267 
00268     <span class="comment">/*</span>
00269 <span class="comment">     * Resume the thread now that we've initialized things.</span>
00270 <span class="comment">     */</span>
00271     <a class="code" href="../../d1/d2/psspnd_8c.html#a1">NtResumeThread</a>(ThreadHandle, NULL);
00272 
00273 
00274 Exit:
00275     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00276 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a17" doxytag="server/server.c::CsrApiPort" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d0/d7/server_2server_8c.html#a17">CsrApiPort</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00054">54</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="server/server.c::gDispatchTableValues" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WORD <a class="el" href="../../d0/d7/server_2server_8c.html#a21">gDispatchTableValues</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00355">355</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="server/server.c::gfLogon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL <a class="el" href="../../d0/d7/server_2server_8c.html#a12">gfLogon</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00031">31</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>, and <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01121">SrvLogon()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="server/server.c::ghMediaRequestEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d0/d7/server_2server_8c.html#a15">ghMediaRequestEvent</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00034">34</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>, and <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="server/server.c::ghNlsEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d0/d7/server_2server_8c.html#a11">ghNlsEvent</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00030">30</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>, and <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01121">SrvLogon()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="server/server.c::ghPowerRequestEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d0/d7/server_2server_8c.html#a14">ghPowerRequestEvent</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00033">33</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>, and <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="server/server.c::gpfnAttachRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> FARPROC <a class="el" href="../../d0/d7/server_2server_8c.html#a13">gpfnAttachRoutine</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00032">32</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/w32_2ntuser_2server_2debug_8c-source.html#l00028">SrvActivateDebugger()</a>, and <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="server/server.c::gZero" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST <a class="el" href="../../d3/d8/uniontagALWAYSZERO.html">ALWAYSZERO</a> <a class="el" href="../../d0/d7/server_2server_8c.html#a22">gZero</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l01310">1310</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="server/server.c::hKeyPriority" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d0/d7/server_2server_8c.html#a7">hKeyPriority</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00026">26</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00387">RegReadApcProcedure()</a>, and <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00431">StartRegReadRead()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="server/server.c::hThreadNotification" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE <a class="el" href="../../d0/d7/server_2server_8c.html#a6">hThreadNotification</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00025">25</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00881">NotificationThread()</a>, and <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="server/server.c::IoStatusRegChange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> IO_STATUS_BLOCK <a class="el" href="../../d0/d7/server_2server_8c.html#a9">IoStatusRegChange</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00028">28</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00387">RegReadApcProcedure()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="server/server.c::LastNetDrives" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d0/d7/server_2server_8c.html#a16">LastNetDrives</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00051">51</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00589">HandleRemoteNetDeviceChangeEvent()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="server/server.c::PriorityValueName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d0/d7/server_2server_8c.html#a8">PriorityValueName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00027">27</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="server/server.c::RegChangeBuffer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d7/server_2server_8c.html#a10">RegChangeBuffer</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00029">29</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00387">RegReadApcProcedure()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="server/server.c::UserServerApiDispatchTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PCSR_API_ROUTINE <a class="el" href="../../d0/d7/server_2server_8c.html#a18">UserServerApiDispatchTable</a>[UserpMaxApiNumber-UserpExitWindowsEx]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    (PCSR_API_ROUTINE)<a class="code" href="../../d2/d0/server_2exitwin_8c.html#a20">SrvExitWindowsEx</a>,
    (PCSR_API_ROUTINE)<a class="code" href="../../d2/d0/server_2exitwin_8c.html#a21">SrvEndTask</a>,
    (PCSR_API_ROUTINE)<a class="code" href="../../d0/d7/server_2server_8c.html#a26">SrvLogon</a>,
    (PCSR_API_ROUTINE)<a class="code" href="../../d2/d0/server_2exitwin_8c.html#a23">SrvRegisterServicesProcess</a>,
    (PCSR_API_ROUTINE)<a class="code" href="../../d4/d5/w32_2ntuser_2server_2debug_8c.html#a1">SrvActivateDebugger</a>,
    (PCSR_API_ROUTINE)<a class="code" href="../../d0/d7/server_2server_8c.html#a29">SrvGetThreadConsoleDesktop</a>,
    (PCSR_API_ROUTINE)<a class="code" href="../../d1/d4/instdev_8c.html#a0">SrvDeviceEvent</a>,
    (PCSR_API_ROUTINE)<a class="code" href="../../d0/d7/server_2server_8c.html#a31">SrvRegisterLogonProcess</a>,
    (PCSR_API_ROUTINE)<a class="code" href="../../d0/d7/server_2server_8c.html#a32">SrvWin32HeapFail</a>,
    (PCSR_API_ROUTINE)<a class="code" href="../../d0/d7/server_2server_8c.html#a33">SrvWin32HeapStat</a>,
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00107">107</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="server/server.c::UserServerApiServerValidTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d0/d7/server_2server_8c.html#a19">UserServerApiServerValidTable</a>[UserpMaxApiNumber-UserpExitWindowsEx]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,      
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,      
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,      
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,      
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,      
    <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,       
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,      
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,      
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,      
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,      
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00120">120</a> of file <a class="el" href="../../d1/d6/server_2server_8c-source.html">server/server.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2server_8c-source.html#l00192">UserServerDllInitialization()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:37 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
