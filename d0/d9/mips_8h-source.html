<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mips.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>mips.h</h1><a href="../../d9/d9/mips_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++ BUILD Version: 0018    // Increment this if a change has global effects</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1990  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    mips.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains the Mips hardware specific header file.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    David N. Cutler (davec) 31-Mar-1990</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#ifndef _MIPSH_</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define _MIPSH_</span>
00023 <span class="preprocessor"></span>
00024 <span class="comment">// begin_ntddk begin_wdm begin_nthal begin_ntndis</span>
00025 
00026 <span class="preprocessor">#if defined(_MIPS_)</span>
00027 <span class="preprocessor"></span>
00028 <span class="comment">//</span>
00029 <span class="comment">// Define maximum size of flush multple TB request.</span>
00030 <span class="comment">//</span>
00031 
00032 <span class="preprocessor">#define FLUSH_MULTIPLE_MAXIMUM 16</span>
00033 <span class="preprocessor"></span>
00034 <span class="comment">//</span>
00035 <span class="comment">// Indicate that the MIPS compiler supports the pragma textout construct.</span>
00036 <span class="comment">//</span>
00037 
00038 <span class="preprocessor">#define ALLOC_PRAGMA 1</span>
00039 <span class="preprocessor"></span>
00040 <span class="comment">//</span>
00041 <span class="comment">// Define function decoration depending on whether a driver, a file system,</span>
00042 <span class="comment">// or a kernel component is being built.</span>
00043 <span class="comment">//</span>
00044 
00045 <span class="comment">//  end_wdm</span>
00046 
00047 <span class="preprocessor">#if (defined(_NTDRIVER_) || defined(_NTDDK_) || defined(_NTIFS_) || defined(_NTHAL_)) &amp;&amp; !defined (_BLDR_)</span>
00048 <span class="preprocessor"></span>
00049 <span class="preprocessor">#define NTKERNELAPI DECLSPEC_IMPORT         // wdm</span>
00050 <span class="preprocessor"></span>
00051 <span class="preprocessor">#else</span>
00052 <span class="preprocessor"></span>
00053 <span class="preprocessor">#define NTKERNELAPI</span>
00054 <span class="preprocessor"></span>
00055 <span class="preprocessor">#endif</span>
00056 <span class="preprocessor"></span>
00057 <span class="comment">//</span>
00058 <span class="comment">// Define function decoration depending on whether the HAL or other kernel</span>
00059 <span class="comment">// component is being build.</span>
00060 <span class="comment">//</span>
00061 
00062 <span class="preprocessor">#if !defined(_NTHAL_) &amp;&amp; !defined(_BLDR_)</span>
00063 <span class="preprocessor"></span>
00064 <span class="preprocessor">#define NTHALAPI DECLSPEC_IMPORT        // wdm</span>
00065 <span class="preprocessor"></span>
00066 <span class="preprocessor">#else</span>
00067 <span class="preprocessor"></span>
00068 <span class="preprocessor">#define NTHALAPI</span>
00069 <span class="preprocessor"></span>
00070 <span class="preprocessor">#endif</span>
00071 <span class="preprocessor"></span>
00072 <span class="comment">// end_ntndis</span>
00073 <span class="comment">//</span>
00074 <span class="comment">// Define macro to generate import names.</span>
00075 <span class="comment">//</span>
00076 
00077 <span class="preprocessor">#define IMPORT_NAME(name) __imp_##name</span>
00078 <span class="preprocessor"></span>
00079 <span class="comment">//</span>
00080 <span class="comment">// MIPS specific interlocked operation result values.</span>
00081 <span class="comment">//</span>
00082 
00083 <span class="preprocessor">#define RESULT_ZERO 0</span>
00084 <span class="preprocessor"></span><span class="preprocessor">#define RESULT_NEGATIVE -2</span>
00085 <span class="preprocessor"></span><span class="preprocessor">#define RESULT_POSITIVE -1</span>
00086 <span class="preprocessor"></span>
00087 <span class="comment">//</span>
00088 <span class="comment">// Interlocked result type is portable, but its values are machine specific.</span>
00089 <span class="comment">// Constants for value are in i386.h, mips.h, etc.</span>
00090 <span class="comment">//</span>
00091 
00092 <span class="keyword">typedef</span> <span class="keyword">enum</span> _INTERLOCKED_RESULT {
00093     ResultNegative = RESULT_NEGATIVE,
00094     ResultZero     = RESULT_ZERO,
00095     ResultPositive = RESULT_POSITIVE
00096 } INTERLOCKED_RESULT;
00097 
00098 <span class="comment">//</span>
00099 <span class="comment">// Convert portable interlock interfaces to architecure specific interfaces.</span>
00100 <span class="comment">//</span>
00101 
00102 <span class="preprocessor">#define ExInterlockedIncrementLong(Addend, Lock) \</span>
00103 <span class="preprocessor">    ExMipsInterlockedIncrementLong(Addend)</span>
00104 <span class="preprocessor"></span>
00105 <span class="preprocessor">#define ExInterlockedDecrementLong(Addend, Lock) \</span>
00106 <span class="preprocessor">    ExMipsInterlockedDecrementLong(Addend)</span>
00107 <span class="preprocessor"></span>
00108 <span class="preprocessor">#define ExInterlockedExchangeAddLargeInteger(Target, Value, Lock) \</span>
00109 <span class="preprocessor">    ExpInterlockedExchangeAddLargeInteger(Target, Value)</span>
00110 <span class="preprocessor"></span>
00111 <span class="preprocessor">#define ExInterlockedExchangeUlong(Target, Value, Lock) \</span>
00112 <span class="preprocessor">    ExMipsInterlockedExchangeUlong(Target, Value)</span>
00113 <span class="preprocessor"></span>
00114 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00115 INTERLOCKED_RESULT
00116 ExMipsInterlockedIncrementLong (
00117     IN PLONG Addend
00118     );
00119 
00120 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00121 INTERLOCKED_RESULT
00122 ExMipsInterlockedDecrementLong (
00123     IN PLONG Addend
00124     );
00125 
00126 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00127 LARGE_INTEGER
00128 ExpInterlockedExchangeAddLargeInteger (
00129     IN PLARGE_INTEGER Addend,
00130     IN LARGE_INTEGER Increment
00131     );
00132 
00133 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00134 ULONG
00135 ExMipsInterlockedExchangeUlong (
00136     IN PULONG Target,
00137     IN ULONG Value
00138     );
00139 
00140 <span class="comment">//  begin_wdm</span>
00141 
00142 <span class="comment">//</span>
00143 <span class="comment">// Intrinsic interlocked functions.</span>
00144 <span class="comment">//</span>
00145 
00146 <span class="preprocessor">#if defined(_M_MRX000) &amp;&amp; !defined(RC_INVOKED)</span>
00147 <span class="preprocessor"></span>
00148 <span class="preprocessor">#define InterlockedIncrement _InterlockedIncrement</span>
00149 <span class="preprocessor"></span><span class="preprocessor">#define InterlockedDecrement _InterlockedDecrement</span>
00150 <span class="preprocessor"></span><span class="preprocessor">#define InterlockedExchange _InterlockedExchange</span>
00151 <span class="preprocessor"></span><span class="preprocessor">#define InterlockedExchangeAdd _InterlockedExchangeAdd</span>
00152 <span class="preprocessor"></span><span class="preprocessor">#define InterlockedCompareExchange _InterlockedCompareExchange</span>
00153 <span class="preprocessor"></span>
00154 LONG
00155 InterlockedIncrement(
00156     IN OUT PLONG Addend
00157     );
00158 
00159 LONG
00160 InterlockedDecrement(
00161     IN OUT PLONG Addend
00162     );
00163 
00164 LONG
00165 InterlockedExchange(
00166     IN OUT PLONG Target,
00167     IN LONG Increment
00168     );
00169 
00170 LONG
00171 InterlockedExchangeAdd(
00172     IN OUT PLONG Addend,
00173     IN LONG Value
00174     );
00175 
00176 PVOID
00177 InterlockedCompareExchange (
00178     IN OUT PVOID *Destination,
00179     IN PVOID Exchange,
00180     IN PVOID Comperand
00181     );
00182 
00183 <span class="preprocessor">#pragma intrinsic(_InterlockedIncrement)</span>
00184 <span class="preprocessor"></span><span class="preprocessor">#pragma intrinsic(_InterlockedDecrement)</span>
00185 <span class="preprocessor"></span><span class="preprocessor">#pragma intrinsic(_InterlockedExchange)</span>
00186 <span class="preprocessor"></span><span class="preprocessor">#pragma intrinsic(_InterlockedExchangeAdd)</span>
00187 <span class="preprocessor"></span><span class="preprocessor">#pragma intrinsic(_InterlockedCompareExchange)</span>
00188 <span class="preprocessor"></span>
00189 <span class="preprocessor">#if _MSC_VER &gt;= 1100</span>
00190 <span class="preprocessor"></span>
00191 <span class="preprocessor">#define InterlockedCompareExchange64 _InterlockedCompareExchange64</span>
00192 <span class="preprocessor"></span>
00193 ULONGLONG
00194 InterlockedCompareExchange64 (
00195     IN PULONGLONG Destination,
00196     IN PULONGLONG Exchange,
00197     IN PULONGLONG Comperand
00198     );
00199 
00200 <span class="preprocessor">#pragma intrinsic(_InterlockedCompareExchange64)</span>
00201 <span class="preprocessor"></span>
00202 <span class="preprocessor">#else</span>
00203 <span class="preprocessor"></span>
00204 <span class="preprocessor">#define InterlockedCompareExchange64 ExpInterlockedCompareExchange64</span>
00205 <span class="preprocessor"></span>
00206 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00207 ULONGLONG
00208 ExpInterlockedCompareExchange64 (
00209     IN PULONGLONG Destination,
00210     IN PULONGLONG Exchange,
00211     IN PULONGLONG Comperand
00212     );
00213 
00214 <span class="preprocessor">#endif</span>
00215 <span class="preprocessor"></span>
00216 <span class="preprocessor">#endif</span>
00217 <span class="preprocessor"></span>
00218 <span class="comment">//</span>
00219 <span class="comment">// MIPS Interrupt Definitions.</span>
00220 <span class="comment">//</span>
00221 <span class="comment">// Define length on interupt object dispatch code in longwords.</span>
00222 <span class="comment">//</span>
00223 
00224 <span class="preprocessor">#define DISPATCH_LENGTH 4               // Length of dispatch code in instructions</span>
00225 <span class="preprocessor"></span>
00226 <span class="comment">//</span>
00227 <span class="comment">// Define Interrupt Request Levels.</span>
00228 <span class="comment">//</span>
00229 
00230 <span class="preprocessor">#define PASSIVE_LEVEL 0                 // Passive release level</span>
00231 <span class="preprocessor"></span><span class="preprocessor">#define LOW_LEVEL 0                     // Lowest interrupt level</span>
00232 <span class="preprocessor"></span><span class="preprocessor">#define APC_LEVEL 1                     // APC interrupt level</span>
00233 <span class="preprocessor"></span><span class="preprocessor">#define DISPATCH_LEVEL 2                // Dispatcher level</span>
00234 <span class="preprocessor"></span><span class="preprocessor">#define IPI_LEVEL 7                     // Interprocessor interrupt level</span>
00235 <span class="preprocessor"></span><span class="preprocessor">#define POWER_LEVEL 7                   // Power failure level</span>
00236 <span class="preprocessor"></span><span class="preprocessor">#define PROFILE_LEVEL 8                 // Profiling level</span>
00237 <span class="preprocessor"></span><span class="preprocessor">#define HIGH_LEVEL 8                    // Highest interrupt level</span>
00238 <span class="preprocessor"></span><span class="preprocessor">#define SYNCH_LEVEL (IPI_LEVEL - 1)     // synchronization level</span>
00239 <span class="preprocessor"></span>
00240 <span class="comment">//</span>
00241 <span class="comment">// Define profile intervals.</span>
00242 <span class="comment">//</span>
00243 
00244 <span class="preprocessor">#define DEFAULT_PROFILE_COUNT 0x40000000 // ~= 20 seconds @50mhz</span>
00245 <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_PROFILE_INTERVAL (10 * 500) // 500 microseconds</span>
00246 <span class="preprocessor"></span><span class="preprocessor">#define MAXIMUM_PROFILE_INTERVAL (10 * 1000 * 1000) // 1 second</span>
00247 <span class="preprocessor"></span><span class="preprocessor">#define MINIMUM_PROFILE_INTERVAL (10 * 40) // 40 microseconds</span>
00248 <span class="preprocessor"></span>
00249 <span class="comment">// end_ntddk end_wdm end_nthal</span>
00250 
00251 <span class="preprocessor">#define KiProfileIrql PROFILE_LEVEL     // enable portable code</span>
00252 <span class="preprocessor"></span>
00253 <span class="comment">//</span>
00254 <span class="comment">// Define machine specific external references.</span>
00255 <span class="comment">//</span>
00256 
00257 <span class="keyword">extern</span> ULONG KiInterruptTemplate[];
00258 
00259 <span class="comment">//</span>
00260 <span class="comment">// Sanitize FSR and PSR based on processor mode.</span>
00261 <span class="comment">//</span>
00262 <span class="comment">// If kernel mode, then</span>
00263 <span class="comment">//      let caller specify all bits</span>
00264 <span class="comment">//</span>
00265 <span class="comment">// If user mode, then</span>
00266 <span class="comment">//      let the caller specify CC EV EZ EO EU EI SV SZ SO SU SI RM</span>
00267 <span class="comment">//</span>
00268 
00269 <span class="preprocessor">#define SANITIZE_FSR(fsr, mode) ( \</span>
00270 <span class="preprocessor">    ((mode) == KernelMode ? \</span>
00271 <span class="preprocessor">        ((0x00000000L) | ((fsr) &amp; 0xffffffff)) : \</span>
00272 <span class="preprocessor">        ((0x00000000L) | ((fsr) &amp; 0xfffc0fff))))</span>
00273 <span class="preprocessor"></span>
00274 <span class="comment">//</span>
00275 <span class="comment">// Define SANITIZE_PSR for R4000</span>
00276 <span class="comment">//</span>
00277 <span class="comment">// If kernel mode, then</span>
00278 <span class="comment">//      force clearing of ERL, SX, RP, FR, RE, and all diagnostic bits,</span>
00279 <span class="comment">//      force the setting of CU3, CU1, KX, and EXL</span>
00280 <span class="comment">//      let caller specify CU2, CU0, INTMASK, UX, KSU, and EXL</span>
00281 <span class="comment">//</span>
00282 <span class="comment">// If user mode, then</span>
00283 <span class="comment">//      force clearing of ERL, SX, RP, FR, RE, and all diagnostic bits,</span>
00284 <span class="comment">//      force the setting of CU3, CU1, INTMASK, KX, UX, KSU, EXL, IE, and</span>
00285 <span class="comment">//      let caller specify no bits.</span>
00286 <span class="comment">//</span>
00287 
00288 <span class="preprocessor">#define SANITIZE_PSR(psr, mode) ( \</span>
00289 <span class="preprocessor">    ((mode) == KernelMode ? \</span>
00290 <span class="preprocessor">        ((0xa0000082L) | ((psr) &amp; 0xd000ff33)) : \</span>
00291 <span class="preprocessor">        ((0xa00000b3L) | (PCR-&gt;IrqlTable[PASSIVE_LEVEL] &lt;&lt; 8))))</span>
00292 <span class="preprocessor"></span>
00293 <span class="comment">// begin_nthal</span>
00294 <span class="comment">//</span>
00295 <span class="comment">// Define Address of Processor Control Registers.</span>
00296 <span class="comment">//</span>
00297 
00298 <span class="preprocessor">#define KIPCR 0xfffff000            // kernel address of first PCR</span>
00299 <span class="preprocessor"></span><span class="preprocessor">#define KIPCR2 0xffffe000           // kernel address of second PCR</span>
00300 <span class="preprocessor"></span>
00301 <span class="comment">//</span>
00302 <span class="comment">// Define Pointer to Processor Control Registers.</span>
00303 <span class="comment">//</span>
00304 
00305 <span class="preprocessor">#define PCR ((volatile KPCR * const)KIPCR)</span>
00306 <span class="preprocessor"></span><span class="preprocessor">#define SharedUserData ((KUSER_SHARED_DATA * const)KIPCR2)</span>
00307 <span class="preprocessor"></span>
00308 <span class="comment">//</span>
00309 <span class="comment">// Get current IRQL.</span>
00310 <span class="comment">//</span>
00311 
00312 <span class="preprocessor">#define KeGetCurrentIrql() PCR-&gt;CurrentIrql</span>
00313 <span class="preprocessor"></span>
00314 <span class="comment">//</span>
00315 <span class="comment">// Get address of current processor block.</span>
00316 <span class="comment">//</span>
00317 
00318 <span class="preprocessor">#define KeGetCurrentPrcb() PCR-&gt;Prcb</span>
00319 <span class="preprocessor"></span>
00320 <span class="comment">//</span>
00321 <span class="comment">// Get address of processor control region.</span>
00322 <span class="comment">//</span>
00323 
00324 <span class="preprocessor">#define KeGetPcr() PCR</span>
00325 <span class="preprocessor"></span>
00326 <span class="comment">//</span>
00327 <span class="comment">// Get address of current kernel thread object.</span>
00328 <span class="comment">//</span>
00329 
00330 <span class="preprocessor">#define KeGetCurrentThread() PCR-&gt;CurrentThread</span>
00331 <span class="preprocessor"></span>
00332 <span class="comment">// begin_ntddk</span>
00333 
00334 <span class="comment">//</span>
00335 <span class="comment">// Get current processor number.</span>
00336 <span class="comment">//</span>
00337 
00338 <span class="preprocessor">#define KeGetCurrentProcessorNumber() PCR-&gt;Number</span>
00339 <span class="preprocessor"></span>
00340 <span class="comment">// begin_wdm</span>
00341 <span class="comment">//</span>
00342 <span class="comment">// Get data cache fill size.</span>
00343 <span class="comment">//</span>
00344 
00345 <span class="preprocessor">#define KeGetDcacheFillSize() PCR-&gt;DcacheFillSize</span>
00346 <span class="preprocessor"></span>
00347 <span class="comment">// end_ntddk end_wdm end_nthal</span>
00348 
00349 <span class="comment">//</span>
00350 <span class="comment">// Get previous processor mode.</span>
00351 <span class="comment">//</span>
00352 
00353 <span class="preprocessor">#define KeGetPreviousMode() (KPROCESSOR_MODE)PCR-&gt;CurrentThread-&gt;PreviousMode</span>
00354 <span class="preprocessor"></span>
00355 <span class="comment">//</span>
00356 <span class="comment">// Test if executing a DPC.</span>
00357 <span class="comment">//</span>
00358 
00359 <span class="preprocessor">#define KeIsExecutingDpc() (PCR-&gt;DpcRoutineActive != 0)</span>
00360 <span class="preprocessor"></span>
00361 <span class="comment">// begin_ntddk begin_wdm</span>
00362 <span class="comment">//</span>
00363 <span class="comment">// Save &amp; Restore floating point state</span>
00364 <span class="comment">//</span>
00365 
00366 <span class="preprocessor">#define KeSaveFloatingPointState(a)         STATUS_SUCCESS</span>
00367 <span class="preprocessor"></span><span class="preprocessor">#define KeRestoreFloatingPointState(a)      STATUS_SUCCESS</span>
00368 <span class="preprocessor"></span>
00369 <span class="comment">// end_ntddk end_wdm</span>
00370 <span class="comment">// begin_nthal</span>
00371 <span class="comment">//</span>
00372 <span class="comment">// Fill TB random entry</span>
00373 <span class="comment">//</span>
00374 
00375 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00376 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00377 KeFillEntryTb (
00378     IN HARDWARE_PTE Pte[2],
00379     IN PVOID Virtual,
00380     IN BOOLEAN Invalid
00381     );
00382 
00383 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00384 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00385 KeFillLargeEntryTb (
00386     IN HARDWARE_PTE Pte[2],
00387     IN PVOID Virtual,
00388     IN ULONG PageSize
00389     );
00390 
00391 <span class="comment">//</span>
00392 <span class="comment">// Fill TB fixed entry</span>
00393 <span class="comment">//</span>
00394 
00395 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00396 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00397 KeFillFixedEntryTb (
00398     IN HARDWARE_PTE Pte[2],
00399     IN PVOID Virtual,
00400     IN ULONG Index
00401     );
00402 
00403 <span class="comment">//</span>
00404 <span class="comment">// Data cache, instruction cache, I/O buffer, and write buffer flush routine</span>
00405 <span class="comment">// prototypes.</span>
00406 <span class="comment">//</span>
00407 
00408 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00409 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00410 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a5">KeChangeColorPage</a> (
00411     IN PVOID NewColor,
00412     IN PVOID OldColor,
00413     IN ULONG PageFrame
00414     );
00415 
00416 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00417 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00418 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a6">KeSweepDcache</a> (
00419     IN BOOLEAN AllProcessors
00420     );
00421 
00422 <span class="preprocessor">#define KeSweepCurrentDcache() \</span>
00423 <span class="preprocessor">    HalSweepDcache();</span>
00424 <span class="preprocessor"></span>
00425 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00426 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00427 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a7">KeSweepIcache</a> (
00428     IN BOOLEAN AllProcessors
00429     );
00430 
00431 <span class="preprocessor">#define KeSweepCurrentIcache() \</span>
00432 <span class="preprocessor">    HalSweepIcache();          \</span>
00433 <span class="preprocessor">    HalSweepDcache();</span>
00434 <span class="preprocessor"></span>
00435 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00436 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00437 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a8">KeSweepIcacheRange</a> (
00438     IN BOOLEAN AllProcessors,
00439     IN PVOID BaseAddress,
00440     IN ULONG Length
00441     );
00442 
00443 <span class="comment">// begin_ntddk begin_wdm begin_ntndis</span>
00444 <span class="comment">//</span>
00445 <span class="comment">// Cache and write buffer flush functions.</span>
00446 <span class="comment">//</span>
00447 
00448 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00449 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00450 <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a9">KeFlushIoBuffers</a> (
00451     IN <a class="code" href="../../d6/d7/struct__MDL.html">PMDL</a> Mdl,
00452     IN BOOLEAN ReadOperation,
00453     IN BOOLEAN DmaOperation
00454     );
00455 
00456 <span class="comment">// end_ntddk end_wdm end_ntndis</span>
00457 
00458 <span class="comment">//</span>
00459 <span class="comment">// Clock, profile, and interprocessor interrupt functions.</span>
00460 <span class="comment">//</span>
00461 
00462 <span class="keyword">struct </span>_KEXCEPTION_FRAME;
00463 <span class="keyword">struct </span>_KTRAP_FRAME;
00464 
00465 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00466 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00467 KeIpiInterrupt (
00468     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00469     );
00470 
00471 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00472 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00473 <a class="code" href="../../d1/d9/clock_8c.html#a5">KeProfileInterrupt</a> (
00474     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00475     );
00476 
00477 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00478 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00479 <a class="code" href="../../d1/d9/clock_8c.html#a6">KeProfileInterruptWithSource</a> (
00480     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame,
00481     IN KPROFILE_SOURCE ProfileSource
00482     );
00483 
00484 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00485 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00486 KeUpdateRuntime (
00487     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00488     );
00489 
00490 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00491 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00492 <a class="code" href="../../d1/d9/clock_8c.html#a2">KeUpdateSystemTime</a> (
00493     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00494     );
00495 
00496 <span class="comment">//</span>
00497 <span class="comment">// The following function prototypes are exported for use in MP HALs.</span>
00498 <span class="comment">//</span>
00499 
00500 <span class="preprocessor">#if defined(NT_UP)</span>
00501 <span class="preprocessor"></span>
00502 <span class="preprocessor">#define KiAcquireSpinLock(SpinLock)</span>
00503 <span class="preprocessor"></span>
00504 <span class="preprocessor">#else</span>
00505 <span class="preprocessor"></span>
00506 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00507 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00508 KiAcquireSpinLock (
00509     IN PKSPIN_LOCK SpinLock
00510     );
00511 
00512 <span class="preprocessor">#endif</span>
00513 <span class="preprocessor"></span>
00514 <span class="preprocessor">#if defined(NT_UP)</span>
00515 <span class="preprocessor"></span>
00516 <span class="preprocessor">#define KiReleaseSpinLock(SpinLock)</span>
00517 <span class="preprocessor"></span>
00518 <span class="preprocessor">#else</span>
00519 <span class="preprocessor"></span>
00520 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00521 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00522 KiReleaseSpinLock (
00523     IN PKSPIN_LOCK SpinLock
00524     );
00525 
00526 <span class="preprocessor">#endif</span>
00527 <span class="preprocessor"></span>
00528 <span class="comment">//</span>
00529 <span class="comment">// Define cache error routine type and prototype.</span>
00530 <span class="comment">//</span>
00531 
00532 <span class="keyword">typedef</span>
00533 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00534 (*PKCACHE_ERROR_ROUTINE) (
00535     <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00536     );
00537 
00538 <span class="preprocessor">#define CACHE_ERROR_VECTOR 0xa0000ffc   // address of cache error routine</span>
00539 <span class="preprocessor"></span>
00540 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00541 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00542 <a class="code" href="../../d1/d2/mips_2buserror_8c.html#a4">KeSetCacheErrorRoutine</a> (
00543     IN PKCACHE_ERROR_ROUTINE Routine
00544     );
00545 
00546 <span class="comment">// end_nthal</span>
00547 
00548 <span class="comment">//</span>
00549 <span class="comment">// Define executive macros for acquiring and releasing executive spinlocks.</span>
00550 <span class="comment">// These macros can ONLY be used by executive components and NOT by drivers.</span>
00551 <span class="comment">// Drivers MUST use the kernel interfaces since they must be MP enabled on</span>
00552 <span class="comment">// all systems.</span>
00553 <span class="comment">//</span>
00554 <span class="comment">// KeRaiseIrql is one instruction shorter than KeAcquireSpinLock on MIPS UP.</span>
00555 <span class="comment">// KeLowerIrql and KeReleaseSpinLock are the same.</span>
00556 <span class="comment">//</span>
00557 
00558 <span class="preprocessor">#if defined(NT_UP) &amp;&amp; !defined(_NTDDK_) &amp;&amp; !defined(_NTIFS_)</span>
00559 <span class="preprocessor"></span><span class="preprocessor">#define ExAcquireSpinLock(Lock, OldIrql) \</span>
00560 <span class="preprocessor">    *(OldIrql) = KeRaiseIrqlToDpcLevel()</span>
00561 <span class="preprocessor"></span>
00562 <span class="preprocessor">#define ExReleaseSpinLock(Lock, OldIrql) KeLowerIrql((OldIrql))</span>
00563 <span class="preprocessor"></span><span class="preprocessor">#define ExAcquireSpinLockAtDpcLevel(Lock)</span>
00564 <span class="preprocessor"></span><span class="preprocessor">#define ExReleaseSpinLockFromDpcLevel(Lock)</span>
00565 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00566 <span class="preprocessor"></span>
00567 <span class="comment">//  begin_wdm begin_ntddk</span>
00568 
00569 <span class="preprocessor">#define ExAcquireSpinLock(Lock, OldIrql) \</span>
00570 <span class="preprocessor">    *(OldIrql) = KeAcquireSpinLockRaiseToDpc((Lock))</span>
00571 <span class="preprocessor"></span>
00572 <span class="preprocessor">#define ExReleaseSpinLock(Lock, OldIrql) KeReleaseSpinLock((Lock), (OldIrql))</span>
00573 <span class="preprocessor"></span><span class="preprocessor">#define ExAcquireSpinLockAtDpcLevel(Lock) KeAcquireSpinLockAtDpcLevel(Lock)</span>
00574 <span class="preprocessor"></span><span class="preprocessor">#define ExReleaseSpinLockFromDpcLevel(Lock) KeReleaseSpinLockFromDpcLevel(Lock)</span>
00575 <span class="preprocessor"></span>
00576 <span class="comment">//  end_wdm end_ntddk</span>
00577 
00578 <span class="preprocessor">#endif</span>
00579 <span class="preprocessor"></span>
00580 <span class="comment">//</span>
00581 <span class="comment">// The acquire and release fast lock macros disable and enable interrupts</span>
00582 <span class="comment">// on UP nondebug systems. On MP or debug systems, the spinlock routines</span>
00583 <span class="comment">// are used.</span>
00584 <span class="comment">//</span>
00585 <span class="comment">// N.B. Extreme caution should be observed when using these routines.</span>
00586 <span class="comment">//</span>
00587 <span class="comment">// begin_nthal</span>
00588 
00589 <span class="preprocessor">#if defined(_M_MRX000)</span>
00590 <span class="preprocessor"></span>
00591 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00592 _disable (
00593     VOID
00594     );
00595 
00596 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00597 _enable (
00598     VOID
00599     );
00600 
00601 <span class="preprocessor">#pragma intrinsic(_disable)</span>
00602 <span class="preprocessor"></span><span class="preprocessor">#pragma intrinsic(_enable)</span>
00603 <span class="preprocessor"></span>
00604 <span class="preprocessor">#endif</span>
00605 <span class="preprocessor"></span>
00606 <span class="comment">// end_nthal</span>
00607 
00608 <span class="preprocessor">#if defined(NT_UP) &amp;&amp; !DBG</span>
00609 <span class="preprocessor"></span><span class="preprocessor">#define ExAcquireFastLock(Lock, OldIrql) _disable()</span>
00610 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00611 <span class="preprocessor"></span><span class="preprocessor">#define ExAcquireFastLock(Lock, OldIrql) \</span>
00612 <span class="preprocessor">    ExAcquireSpinLock(Lock, OldIrql)</span>
00613 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00614 <span class="preprocessor"></span>
00615 <span class="preprocessor">#if defined(NT_UP) &amp;&amp; !DBG</span>
00616 <span class="preprocessor"></span><span class="preprocessor">#define ExReleaseFastLock(Lock, OldIrql) _enable()</span>
00617 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00618 <span class="preprocessor"></span><span class="preprocessor">#define ExReleaseFastLock(Lock, OldIrql) \</span>
00619 <span class="preprocessor">    ExReleaseSpinLock(Lock, OldIrql)</span>
00620 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00621 <span class="preprocessor"></span>
00622 <span class="comment">//</span>
00623 <span class="comment">// Data and instruction bus error function prototypes.</span>
00624 <span class="comment">//</span>
00625 
00626 BOOLEAN
00627 <a class="code" href="../../d1/d2/mips_2buserror_8c.html#a0">KeBusError</a> (
00628     IN PEXCEPTION_RECORD ExceptionRecord,
00629     IN <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00630     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame,
00631     IN PVOID VirtualAddress,
00632     IN PHYSICAL_ADDRESS PhysicalAddress
00633     );
00634 
00635 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00636 <a class="code" href="../../d1/d2/mips_2buserror_8c.html#a2">KiDataBusError</a> (
00637     IN PEXCEPTION_RECORD ExceptionRecord,
00638     IN <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00639     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00640     );
00641 
00642 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00643 <a class="code" href="../../d1/d2/mips_2buserror_8c.html#a3">KiInstructionBusError</a> (
00644     IN PEXCEPTION_RECORD ExceptionRecord,
00645     IN <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00646     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00647     );
00648 
00649 <span class="comment">//</span>
00650 <span class="comment">// Define query system time macro.</span>
00651 <span class="comment">//</span>
00652 <span class="comment">// N.B. This macro can be changed when the compiler generates real double</span>
00653 <span class="comment">//      integer instructions.</span>
00654 <span class="comment">//</span>
00655 
00656 <span class="preprocessor">#define KiQuerySystemTime(CurrentTime) \</span>
00657 <span class="preprocessor">    (CurrentTime)-&gt;QuadPart = SharedUserData-&gt;SystemTime.Alignment</span>
00658 <span class="preprocessor"></span>
00659 <span class="comment">//</span>
00660 <span class="comment">// Define query tick count macro.</span>
00661 <span class="comment">//</span>
00662 
00663 <span class="preprocessor">#if defined(_NTDRIVER_) || defined(_NTDDK_) || defined(_NTIFS_)</span>
00664 <span class="preprocessor"></span>
00665 <span class="comment">//  begin_wdm begin_ntddk</span>
00666 
00667 <span class="preprocessor">#define KeQueryTickCount(CurrentCount) {                           \</span>
00668 <span class="preprocessor">    PKSYSTEM_TIME _TickCount = *((PKSYSTEM_TIME *)(&amp;KeTickCount)); \</span>
00669 <span class="preprocessor">    (CurrentCount)-&gt;QuadPart = _TickCount-&gt;Alignment;              \</span>
00670 <span class="preprocessor">}</span>
00671 <span class="preprocessor"></span>
00672 <span class="comment">//  end_wdm end_ntddk</span>
00673 
00674 <span class="preprocessor">#else</span>
00675 <span class="preprocessor"></span>
00676 <span class="comment">// begin_nthal</span>
00677 <span class="preprocessor">#define KiQueryTickCount(CurrentCount)                             \</span>
00678 <span class="preprocessor">    (CurrentCount)-&gt;QuadPart = KeTickCount.Alignment</span>
00679 <span class="preprocessor"></span>
00680 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00681 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00682 <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a4">KeQueryTickCount</a> (
00683     OUT PLARGE_INTEGER CurrentCount
00684     );
00685 
00686 <span class="comment">// end_nthal</span>
00687 <span class="preprocessor">#endif</span>
00688 <span class="preprocessor"></span>
00689 <span class="preprocessor">#define KiQueryLowTickCount() KeTickCount.LowPart</span>
00690 <span class="preprocessor"></span>
00691 <span class="comment">//</span>
00692 <span class="comment">// Define query interrupt time macro.</span>
00693 <span class="comment">//</span>
00694 
00695 <span class="preprocessor">#define KiQueryInterruptTime(CurrentTime) \</span>
00696 <span class="preprocessor">    (CurrentTime)-&gt;QuadPart = SharedUserData-&gt;InterruptTime.Alignment</span>
00697 <span class="preprocessor"></span>
00698 <span class="comment">//</span>
00699 <span class="comment">// The following function prototypes must be in the module since they are</span>
00700 <span class="comment">// machine dependent.</span>
00701 <span class="comment">//</span>
00702 
00703 ULONG
00704 <a class="code" href="../../d7/d1/branchem_8c.html#a0">KiEmulateBranch</a> (
00705     IN <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00706     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00707     );
00708 
00709 BOOLEAN
00710 <a class="code" href="../../d3/d4/mips_2floatem_8c.html#a32">KiEmulateFloating</a> (
00711     IN OUT PEXCEPTION_RECORD ExceptionRecord,
00712     IN OUT <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00713     IN OUT <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00714     );
00715 
00716 BOOLEAN
00717 <a class="code" href="../../d7/d5/ppc_2alignem_8c.html#a18">KiEmulateReference</a> (
00718     IN OUT PEXCEPTION_RECORD ExceptionRecord,
00719     IN OUT <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00720     IN OUT <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00721     );
00722 
00723 ULONG
00724 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a0">KiGetRegisterValue</a> (
00725     IN ULONG Register,
00726     IN <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00727     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00728     );
00729 
00730 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00731 <a class="code" href="../../d8/d5/ppc_2getsetrg_8c.html#a1">KiSetRegisterValue</a> (
00732     IN ULONG Register,
00733     IN ULONG Value,
00734     OUT <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00735     OUT <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00736     );
00737 
00738 ULONGLONG
00739 <a class="code" href="../../d7/d5/mips_2getsetrg_8c.html#a1">KiGetRegisterValue64</a> (
00740     IN ULONG Register,
00741     IN <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00742     IN <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00743     );
00744 
00745 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00746 <a class="code" href="../../d7/d5/mips_2getsetrg_8c.html#a3">KiSetRegisterValue64</a> (
00747     IN ULONG Register,
00748     IN ULONGLONG Value,
00749     OUT <span class="keyword">struct</span> _KEXCEPTION_FRAME *ExceptionFrame,
00750     OUT <span class="keyword">struct</span> _KTRAP_FRAME *TrapFrame
00751     );
00752 
00753 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00754 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00755 <a class="code" href="../../d9/d4/intsupc_8c.html#a3">KiRequestSoftwareInterrupt</a> (
00756     ULONG RequestIrql
00757     );
00758 
00759 <span class="comment">//</span>
00760 <span class="comment">// 64-bit Probe function definitions</span>
00761 <span class="comment">//</span>
00762 <span class="comment">// Probe for read function.</span>
00763 <span class="comment">//</span>
00764 <span class="comment">//++</span>
00765 <span class="comment">//</span>
00766 <span class="comment">// VOID</span>
00767 <span class="comment">// ProbeForRead64(</span>
00768 <span class="comment">//     IN PVOID64 Address,</span>
00769 <span class="comment">//     IN ULONG Length,</span>
00770 <span class="comment">//     IN ULONG Alignment</span>
00771 <span class="comment">//     )</span>
00772 <span class="comment">//</span>
00773 <span class="comment">//--</span>
00774 
00775 <span class="preprocessor">#define ProbeForRead64(Address, Length, Alignment)                           \</span>
00776 <span class="preprocessor">    ASSERT(((Alignment) == 1) || ((Alignment) == 2) ||                       \</span>
00777 <span class="preprocessor">           ((Alignment) == 4) || ((Alignment) == 8));                        \</span>
00778 <span class="preprocessor">                                                                             \</span>
00779 <span class="preprocessor">    if ((Length) != 0) {                                                     \</span>
00780 <span class="preprocessor">        if (((ULONGLONG)(Address) &amp; ((Alignment) - 1)) != 0) {               \</span>
00781 <span class="preprocessor">            ExRaiseDatatypeMisalignment();                                   \</span>
00782 <span class="preprocessor">                                                                             \</span>
00783 <span class="preprocessor">        } else if ((((ULONGLONG)(Address) + (Length)) &lt; (ULONGLONG)(Address)) || \</span>
00784 <span class="preprocessor">                   (((ULONGLONG)(Address) + (Length)) &gt; (ULONGLONG)MM_HIGHEST_USER_ADDRESS64)) { \</span>
00785 <span class="preprocessor">            ExRaiseAccessViolation();                                        \</span>
00786 <span class="preprocessor">        }                                                                    \</span>
00787 <span class="preprocessor">    }</span>
00788 <span class="preprocessor"></span>
00789 <span class="comment">//</span>
00790 <span class="comment">// Probe for write function.</span>
00791 <span class="comment">//</span>
00792 
00793 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00794 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00795 ProbeForWrite64 (
00796     IN PVOID64 Address,
00797     IN ULONG Length,
00798     IN ULONG Alignment
00799     );
00800 
00801 <span class="comment">// begin_ntddk begin_wdm begin_nthal begin_ntndis</span>
00802 <span class="comment">//</span>
00803 <span class="comment">// I/O space read and write macros.</span>
00804 <span class="comment">//</span>
00805 
00806 <span class="preprocessor">#define READ_REGISTER_UCHAR(x) \</span>
00807 <span class="preprocessor">    *(volatile UCHAR * const)(x)</span>
00808 <span class="preprocessor"></span>
00809 <span class="preprocessor">#define READ_REGISTER_USHORT(x) \</span>
00810 <span class="preprocessor">    *(volatile USHORT * const)(x)</span>
00811 <span class="preprocessor"></span>
00812 <span class="preprocessor">#define READ_REGISTER_ULONG(x) \</span>
00813 <span class="preprocessor">    *(volatile ULONG * const)(x)</span>
00814 <span class="preprocessor"></span>
00815 <span class="preprocessor">#define READ_REGISTER_BUFFER_UCHAR(x, y, z) {                           \</span>
00816 <span class="preprocessor">    PUCHAR registerBuffer = x;                                          \</span>
00817 <span class="preprocessor">    PUCHAR readBuffer = y;                                              \</span>
00818 <span class="preprocessor">    ULONG readCount;                                                    \</span>
00819 <span class="preprocessor">    for (readCount = z; readCount--; readBuffer++, registerBuffer++) {  \</span>
00820 <span class="preprocessor">        *readBuffer = *(volatile UCHAR * const)(registerBuffer);        \</span>
00821 <span class="preprocessor">    }                                                                   \</span>
00822 <span class="preprocessor">}</span>
00823 <span class="preprocessor"></span>
00824 <span class="preprocessor">#define READ_REGISTER_BUFFER_USHORT(x, y, z) {                          \</span>
00825 <span class="preprocessor">    PUSHORT registerBuffer = x;                                         \</span>
00826 <span class="preprocessor">    PUSHORT readBuffer = y;                                             \</span>
00827 <span class="preprocessor">    ULONG readCount;                                                    \</span>
00828 <span class="preprocessor">    for (readCount = z; readCount--; readBuffer++, registerBuffer++) {  \</span>
00829 <span class="preprocessor">        *readBuffer = *(volatile USHORT * const)(registerBuffer);       \</span>
00830 <span class="preprocessor">    }                                                                   \</span>
00831 <span class="preprocessor">}</span>
00832 <span class="preprocessor"></span>
00833 <span class="preprocessor">#define READ_REGISTER_BUFFER_ULONG(x, y, z) {                           \</span>
00834 <span class="preprocessor">    PULONG registerBuffer = x;                                          \</span>
00835 <span class="preprocessor">    PULONG readBuffer = y;                                              \</span>
00836 <span class="preprocessor">    ULONG readCount;                                                    \</span>
00837 <span class="preprocessor">    for (readCount = z; readCount--; readBuffer++, registerBuffer++) {  \</span>
00838 <span class="preprocessor">        *readBuffer = *(volatile ULONG * const)(registerBuffer);        \</span>
00839 <span class="preprocessor">    }                                                                   \</span>
00840 <span class="preprocessor">}</span>
00841 <span class="preprocessor"></span>
00842 <span class="preprocessor">#define WRITE_REGISTER_UCHAR(x, y) {    \</span>
00843 <span class="preprocessor">    *(volatile UCHAR * const)(x) = y;   \</span>
00844 <span class="preprocessor">    KeFlushWriteBuffer();               \</span>
00845 <span class="preprocessor">}</span>
00846 <span class="preprocessor"></span>
00847 <span class="preprocessor">#define WRITE_REGISTER_USHORT(x, y) {   \</span>
00848 <span class="preprocessor">    *(volatile USHORT * const)(x) = y;  \</span>
00849 <span class="preprocessor">    KeFlushWriteBuffer();               \</span>
00850 <span class="preprocessor">}</span>
00851 <span class="preprocessor"></span>
00852 <span class="preprocessor">#define WRITE_REGISTER_ULONG(x, y) {    \</span>
00853 <span class="preprocessor">    *(volatile ULONG * const)(x) = y;   \</span>
00854 <span class="preprocessor">    KeFlushWriteBuffer();               \</span>
00855 <span class="preprocessor">}</span>
00856 <span class="preprocessor"></span>
00857 <span class="preprocessor">#define WRITE_REGISTER_BUFFER_UCHAR(x, y, z) {                            \</span>
00858 <span class="preprocessor">    PUCHAR registerBuffer = x;                                            \</span>
00859 <span class="preprocessor">    PUCHAR writeBuffer = y;                                               \</span>
00860 <span class="preprocessor">    ULONG writeCount;                                                     \</span>
00861 <span class="preprocessor">    for (writeCount = z; writeCount--; writeBuffer++, registerBuffer++) { \</span>
00862 <span class="preprocessor">        *(volatile UCHAR * const)(registerBuffer) = *writeBuffer;         \</span>
00863 <span class="preprocessor">    }                                                                     \</span>
00864 <span class="preprocessor">    KeFlushWriteBuffer();                                                 \</span>
00865 <span class="preprocessor">}</span>
00866 <span class="preprocessor"></span>
00867 <span class="preprocessor">#define WRITE_REGISTER_BUFFER_USHORT(x, y, z) {                           \</span>
00868 <span class="preprocessor">    PUSHORT registerBuffer = x;                                           \</span>
00869 <span class="preprocessor">    PUSHORT writeBuffer = y;                                              \</span>
00870 <span class="preprocessor">    ULONG writeCount;                                                     \</span>
00871 <span class="preprocessor">    for (writeCount = z; writeCount--; writeBuffer++, registerBuffer++) { \</span>
00872 <span class="preprocessor">        *(volatile USHORT * const)(registerBuffer) = *writeBuffer;        \</span>
00873 <span class="preprocessor">    }                                                                     \</span>
00874 <span class="preprocessor">    KeFlushWriteBuffer();                                                 \</span>
00875 <span class="preprocessor">}</span>
00876 <span class="preprocessor"></span>
00877 <span class="preprocessor">#define WRITE_REGISTER_BUFFER_ULONG(x, y, z) {                            \</span>
00878 <span class="preprocessor">    PULONG registerBuffer = x;                                            \</span>
00879 <span class="preprocessor">    PULONG writeBuffer = y;                                               \</span>
00880 <span class="preprocessor">    ULONG writeCount;                                                     \</span>
00881 <span class="preprocessor">    for (writeCount = z; writeCount--; writeBuffer++, registerBuffer++) { \</span>
00882 <span class="preprocessor">        *(volatile ULONG * const)(registerBuffer) = *writeBuffer;         \</span>
00883 <span class="preprocessor">    }                                                                     \</span>
00884 <span class="preprocessor">    KeFlushWriteBuffer();                                                 \</span>
00885 <span class="preprocessor">}</span>
00886 <span class="preprocessor"></span>
00887 
00888 <span class="preprocessor">#define READ_PORT_UCHAR(x) \</span>
00889 <span class="preprocessor">    *(volatile UCHAR * const)(x)</span>
00890 <span class="preprocessor"></span>
00891 <span class="preprocessor">#define READ_PORT_USHORT(x) \</span>
00892 <span class="preprocessor">    *(volatile USHORT * const)(x)</span>
00893 <span class="preprocessor"></span>
00894 <span class="preprocessor">#define READ_PORT_ULONG(x) \</span>
00895 <span class="preprocessor">    *(volatile ULONG * const)(x)</span>
00896 <span class="preprocessor"></span>
00897 <span class="preprocessor">#define READ_PORT_BUFFER_UCHAR(x, y, z) {                             \</span>
00898 <span class="preprocessor">    PUCHAR readBuffer = y;                                            \</span>
00899 <span class="preprocessor">    ULONG readCount;                                                  \</span>
00900 <span class="preprocessor">    for (readCount = 0; readCount &lt; z; readCount++, readBuffer++) {   \</span>
00901 <span class="preprocessor">        *readBuffer = *(volatile UCHAR * const)(x);                   \</span>
00902 <span class="preprocessor">    }                                                                 \</span>
00903 <span class="preprocessor">}</span>
00904 <span class="preprocessor"></span>
00905 <span class="preprocessor">#define READ_PORT_BUFFER_USHORT(x, y, z) {                            \</span>
00906 <span class="preprocessor">    PUSHORT readBuffer = y;                                            \</span>
00907 <span class="preprocessor">    ULONG readCount;                                                  \</span>
00908 <span class="preprocessor">    for (readCount = 0; readCount &lt; z; readCount++, readBuffer++) {   \</span>
00909 <span class="preprocessor">        *readBuffer = *(volatile USHORT * const)(x);                  \</span>
00910 <span class="preprocessor">    }                                                                 \</span>
00911 <span class="preprocessor">}</span>
00912 <span class="preprocessor"></span>
00913 <span class="preprocessor">#define READ_PORT_BUFFER_ULONG(x, y, z) {                             \</span>
00914 <span class="preprocessor">    PULONG readBuffer = y;                                            \</span>
00915 <span class="preprocessor">    ULONG readCount;                                                  \</span>
00916 <span class="preprocessor">    for (readCount = 0; readCount &lt; z; readCount++, readBuffer++) {   \</span>
00917 <span class="preprocessor">        *readBuffer = *(volatile ULONG * const)(x);                   \</span>
00918 <span class="preprocessor">    }                                                                 \</span>
00919 <span class="preprocessor">}</span>
00920 <span class="preprocessor"></span>
00921 <span class="preprocessor">#define WRITE_PORT_UCHAR(x, y) {        \</span>
00922 <span class="preprocessor">    *(volatile UCHAR * const)(x) = y;   \</span>
00923 <span class="preprocessor">    KeFlushWriteBuffer();               \</span>
00924 <span class="preprocessor">}</span>
00925 <span class="preprocessor"></span>
00926 <span class="preprocessor">#define WRITE_PORT_USHORT(x, y) {       \</span>
00927 <span class="preprocessor">    *(volatile USHORT * const)(x) = y;  \</span>
00928 <span class="preprocessor">    KeFlushWriteBuffer();               \</span>
00929 <span class="preprocessor">}</span>
00930 <span class="preprocessor"></span>
00931 <span class="preprocessor">#define WRITE_PORT_ULONG(x, y) {        \</span>
00932 <span class="preprocessor">    *(volatile ULONG * const)(x) = y;   \</span>
00933 <span class="preprocessor">    KeFlushWriteBuffer();               \</span>
00934 <span class="preprocessor">}</span>
00935 <span class="preprocessor"></span>
00936 <span class="preprocessor">#define WRITE_PORT_BUFFER_UCHAR(x, y, z) {                                \</span>
00937 <span class="preprocessor">    PUCHAR writeBuffer = y;                                               \</span>
00938 <span class="preprocessor">    ULONG writeCount;                                                     \</span>
00939 <span class="preprocessor">    for (writeCount = 0; writeCount &lt; z; writeCount++, writeBuffer++) {   \</span>
00940 <span class="preprocessor">        *(volatile UCHAR * const)(x) = *writeBuffer;                      \</span>
00941 <span class="preprocessor">        KeFlushWriteBuffer();                                             \</span>
00942 <span class="preprocessor">    }                                                                     \</span>
00943 <span class="preprocessor">}</span>
00944 <span class="preprocessor"></span>
00945 <span class="preprocessor">#define WRITE_PORT_BUFFER_USHORT(x, y, z) {                               \</span>
00946 <span class="preprocessor">    PUSHORT writeBuffer = y;                                              \</span>
00947 <span class="preprocessor">    ULONG writeCount;                                                     \</span>
00948 <span class="preprocessor">    for (writeCount = 0; writeCount &lt; z; writeCount++, writeBuffer++) {   \</span>
00949 <span class="preprocessor">        *(volatile USHORT * const)(x) = *writeBuffer;                     \</span>
00950 <span class="preprocessor">        KeFlushWriteBuffer();                                             \</span>
00951 <span class="preprocessor">    }                                                                     \</span>
00952 <span class="preprocessor">}</span>
00953 <span class="preprocessor"></span>
00954 <span class="preprocessor">#define WRITE_PORT_BUFFER_ULONG(x, y, z) {                                \</span>
00955 <span class="preprocessor">    PULONG writeBuffer = y;                                               \</span>
00956 <span class="preprocessor">    ULONG writeCount;                                                     \</span>
00957 <span class="preprocessor">    for (writeCount = 0; writeCount &lt; z; writeCount++, writeBuffer++) {   \</span>
00958 <span class="preprocessor">        *(volatile ULONG * const)(x) = *writeBuffer;                      \</span>
00959 <span class="preprocessor">        KeFlushWriteBuffer();                                             \</span>
00960 <span class="preprocessor">    }                                                                     \</span>
00961 <span class="preprocessor">}</span>
00962 <span class="preprocessor"></span>
00963 <span class="comment">// end_ntddk end_wdm end_ntndis</span>
00964 
00965 <span class="comment">//</span>
00966 <span class="comment">// Exception frame</span>
00967 <span class="comment">//</span>
00968 <span class="comment">//  N.B. This frame must be an exact multiple of 8 bytes in length.</span>
00969 <span class="comment">//</span>
00970 
00971 <span class="keyword">typedef</span> <span class="keyword">struct </span>_KEXCEPTION_FRAME {
00972     <span class="keyword">union </span>{
00973         ULONG Argument[8];
00974         DOUBLE Alignment;
00975     };
00976 
00977     <span class="comment">//</span>
00978     <span class="comment">// Floating nonvolatile context.</span>
00979     <span class="comment">//</span>
00980 
00981     <span class="keyword">union </span>{
00982 
00983         <span class="comment">//</span>
00984         <span class="comment">// 16 double floating register nonvolatile context.</span>
00985         <span class="comment">//</span>
00986 
00987         <span class="keyword">struct </span>{
00988             ULONG FltF20;
00989             ULONG FltF21;
00990             ULONG FltF22;
00991             ULONG FltF23;
00992             ULONG FltF24;
00993             ULONG FltF25;
00994             ULONG FltF26;
00995             ULONG FltF27;
00996             ULONG FltF28;
00997             ULONG FltF29;
00998             ULONG FltF30;
00999             ULONG FltF31;
01000         };
01001 
01002         <span class="comment">//</span>
01003         <span class="comment">// 32 double floating register nonvolatile context.</span>
01004         <span class="comment">//</span>
01005 
01006         <span class="keyword">struct </span>{
01007             ULONGLONG XFltF20;
01008             ULONGLONG XFltF22;
01009             ULONGLONG XFltF24;
01010             ULONGLONG XFltF26;
01011             ULONGLONG XFltF28;
01012             ULONGLONG XFltF30;
01013         };
01014     };
01015 
01016     <span class="comment">//</span>
01017     <span class="comment">// Integer nonvolatile context.</span>
01018     <span class="comment">//</span>
01019 
01020     ULONG IntS0;
01021     ULONG IntS1;
01022     ULONG IntS2;
01023     ULONG IntS3;
01024     ULONG IntS4;
01025     ULONG IntS5;
01026     ULONG IntS6;
01027     ULONG IntS7;
01028     ULONG IntS8;
01029     ULONG SwapReturn;
01030     ULONG IntRa;
01031 } KEXCEPTION_FRAME, *PKEXCEPTION_FRAME;
01032 
01033 <span class="comment">//</span>
01034 <span class="comment">// Trap frame</span>
01035 <span class="comment">//</span>
01036 <span class="comment">//  N.B. This frame must be EXACTLY a multiple of 16 bytes in length.</span>
01037 <span class="comment">//</span>
01038 
01039 <span class="keyword">typedef</span> <span class="keyword">struct </span>_KTRAP_FRAME {
01040     <span class="keyword">union </span>{
01041         ULONG Argument[4];
01042         ULONGLONG Alignment;
01043     };
01044 
01045     <span class="comment">//</span>
01046     <span class="comment">// Volatile floating state.</span>
01047     <span class="comment">//</span>
01048 
01049     <span class="keyword">union </span>{
01050 
01051         <span class="comment">//</span>
01052         <span class="comment">// 32-bit floating state.</span>
01053         <span class="comment">//</span>
01054 
01055         <span class="keyword">struct </span>{
01056             ULONG FltF0;
01057             ULONG FltF1;
01058             ULONG FltF2;
01059             ULONG FltF3;
01060             ULONG FltF4;
01061             ULONG FltF5;
01062             ULONG FltF6;
01063             ULONG FltF7;
01064             ULONG FltF8;
01065             ULONG FltF9;
01066             ULONG FltF10;
01067             ULONG FltF11;
01068             ULONG FltF12;
01069             ULONG FltF13;
01070             ULONG FltF14;
01071             ULONG FltF15;
01072             ULONG FltF16;
01073             ULONG FltF17;
01074             ULONG FltF18;
01075             ULONG FltF19;
01076         };
01077 
01078         <span class="comment">//</span>
01079         <span class="comment">// 64-bit floating state.</span>
01080         <span class="comment">//</span>
01081 
01082         <span class="keyword">struct </span>{
01083             ULONGLONG XFltF0;
01084             ULONGLONG XFltF1;
01085             ULONGLONG XFltF2;
01086             ULONGLONG XFltF3;
01087             ULONGLONG XFltF4;
01088             ULONGLONG XFltF5;
01089             ULONGLONG XFltF6;
01090             ULONGLONG XFltF7;
01091             ULONGLONG XFltF8;
01092             ULONGLONG XFltF9;
01093             ULONGLONG XFltF10;
01094             ULONGLONG XFltF11;
01095             ULONGLONG XFltF12;
01096             ULONGLONG XFltF13;
01097             ULONGLONG XFltF14;
01098             ULONGLONG XFltF15;
01099             ULONGLONG XFltF16;
01100             ULONGLONG XFltF17;
01101             ULONGLONG XFltF18;
01102             ULONGLONG XFltF19;
01103             ULONGLONG XFltF21;
01104             ULONGLONG XFltF23;
01105             ULONGLONG XFltF25;
01106             ULONGLONG XFltF27;
01107             ULONGLONG XFltF29;
01108             ULONGLONG XFltF31;
01109         };
01110     };
01111 
01112     <span class="comment">//</span>
01113     <span class="comment">// Volatile 64-bit integer state.</span>
01114     <span class="comment">//</span>
01115     <span class="comment">//</span>
01116 
01117     <span class="keyword">struct </span>{
01118         ULONGLONG XIntZero;
01119         ULONGLONG XIntAt;
01120         ULONGLONG XIntV0;
01121         ULONGLONG XIntV1;
01122         ULONGLONG XIntA0;
01123         ULONGLONG XIntA1;
01124         ULONGLONG XIntA2;
01125         ULONGLONG XIntA3;
01126         ULONGLONG XIntT0;
01127         ULONGLONG XIntT1;
01128         ULONGLONG XIntT2;
01129         ULONGLONG XIntT3;
01130         ULONGLONG XIntT4;
01131         ULONGLONG XIntT5;
01132         ULONGLONG XIntT6;
01133         ULONGLONG XIntT7;
01134         ULONGLONG XIntS0;
01135         ULONGLONG XIntS1;
01136         ULONGLONG XIntS2;
01137         ULONGLONG XIntS3;
01138         ULONGLONG XIntS4;
01139         ULONGLONG XIntS5;
01140         ULONGLONG XIntS6;
01141         ULONGLONG XIntS7;
01142         ULONGLONG XIntT8;
01143         ULONGLONG XIntT9;
01144         ULONGLONG XIntK0;
01145         ULONGLONG XIntK1;
01146         ULONGLONG XIntGp;
01147         ULONGLONG XIntSp;
01148         ULONGLONG XIntS8;
01149         ULONGLONG XIntRa;
01150         ULONGLONG XIntLo;
01151         ULONGLONG XIntHi;
01152     };
01153 
01154     ULONG Fsr;
01155     ULONG Fir;
01156     ULONG Psr;
01157     UCHAR ExceptionRecord[(<span class="keyword">sizeof</span>(EXCEPTION_RECORD) + 7) &amp; (~7)];
01158     UCHAR OldIrql;
01159     UCHAR PreviousMode;
01160     UCHAR SavedFlag;
01161     <span class="keyword">union </span>{
01162         ULONG OnInterruptStack;
01163         ULONG TrapFrame;
01164     } u;
01165 
01166 } KTRAP_FRAME, *PKTRAP_FRAME;
01167 
01168 <span class="preprocessor">#define KTRAP_FRAME_ARGUMENTS (4 * 16)</span>
01169 <span class="preprocessor"></span><span class="preprocessor">#define KTRAP_FRAME_LENGTH (sizeof(KTRAP_FRAME))</span>
01170 <span class="preprocessor"></span><span class="preprocessor">#define KTRAP_FRAME_ALIGN (sizeof(DOUBLE))</span>
01171 <span class="preprocessor"></span><span class="preprocessor">#define KTRAP_FRAME_ROUND (KTRAP_FRAME_ALIGN - 1)</span>
01172 <span class="preprocessor"></span>
01173 <span class="comment">//</span>
01174 <span class="comment">// Define the kernel mode and user mode callback frame structures.</span>
01175 <span class="comment">//</span>
01176 
01177 <span class="keyword">typedef</span> <span class="keyword">struct </span>_KCALLOUT_FRAME {
01178     ULONG   SaveArgs[4];            <span class="comment">// argument register save area</span>
01179     ULONG   F20;                    <span class="comment">// saved floating registers f20 - f31</span>
01180     ULONG   F21;                    <span class="comment">//</span>
01181     ULONG   F22;                    <span class="comment">//</span>
01182     ULONG   F23;                    <span class="comment">//</span>
01183     ULONG   F24;                    <span class="comment">//</span>
01184     ULONG   F25;                    <span class="comment">//</span>
01185     ULONG   F26;                    <span class="comment">//</span>
01186     ULONG   F27;                    <span class="comment">//</span>
01187     ULONG   F28;                    <span class="comment">//</span>
01188     ULONG   F29;                    <span class="comment">//</span>
01189     ULONG   F30;                    <span class="comment">//</span>
01190     ULONG   F31;                    <span class="comment">//</span>
01191     ULONG   S0;                     <span class="comment">// saved integer registers s0 - s8</span>
01192     ULONG   S1;                     <span class="comment">//</span>
01193     ULONG   S2;                     <span class="comment">//</span>
01194     ULONG   S3;                     <span class="comment">//</span>
01195     ULONG   S4;                     <span class="comment">//</span>
01196     ULONG   S5;                     <span class="comment">//</span>
01197     ULONG   S6;                     <span class="comment">//</span>
01198     ULONG   S7;                     <span class="comment">//</span>
01199     ULONG   S8;                     <span class="comment">//</span>
01200     ULONG   CbStk;                  <span class="comment">// saved callback stack address</span>
01201     ULONG   TrFr;                   <span class="comment">// saved callback trap frame address</span>
01202     ULONG   Fsr;                    <span class="comment">// saved floating status</span>
01203     ULONG   InStk;                  <span class="comment">// save initial stack address</span>
01204     ULONG   Ra;                     <span class="comment">// saved return address</span>
01205     ULONG   A0;                     <span class="comment">// saved argument registers a0-a1</span>
01206     ULONG   <a class="code" href="../../d1/d1/bench_8c.html#a6">A1</a>;                     <span class="comment">//</span>
01207 } KCALLOUT_FRAME, *PKCALLOUT_FRAME;
01208 
01209 <span class="keyword">typedef</span> <span class="keyword">struct </span>_UCALLOUT_FRAME {
01210     ULONG SaveArgs[4];
01211     PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
01212     ULONG Length;
01213     ULONG ApiNumber;
01214     ULONG Pad;
01215     LONGLONG Sp;
01216     LONGLONG Ra;
01217 } UCALLOUT_FRAME, *PUCALLOUT_FRAME;
01218 
01219 <span class="comment">// begin_ntddk begin_wdm</span>
01220 <span class="comment">//</span>
01221 <span class="comment">// Non-volatile floating point state</span>
01222 <span class="comment">//</span>
01223 
01224 <span class="keyword">typedef</span> <span class="keyword">struct </span>_KFLOATING_SAVE {
01225     ULONG   Reserved;
01226 } KFLOATING_SAVE, *PKFLOATING_SAVE;
01227 
01228 <span class="comment">// end_ntddk end_wdm</span>
01229 <span class="comment">//</span>
01230 <span class="comment">// Processor State structure.</span>
01231 <span class="comment">//</span>
01232 
01233 <span class="keyword">typedef</span> <span class="keyword">struct </span>_TB_ENTRY {
01234     ENTRYLO Entrylo0;
01235     ENTRYLO Entrylo1;
01236     ENTRYHI Entryhi;
01237     PAGEMASK Pagemask;
01238 } TB_ENTRY, *PTB_ENTRY;
01239 
01240 <span class="keyword">typedef</span> <span class="keyword">struct </span>_KPROCESSOR_STATE {
01241     <span class="keyword">struct </span>_CONTEXT ContextFrame;
01242     TB_ENTRY TbEntry[64];
01243 } KPROCESSOR_STATE, *PKPROCESSOR_STATE;
01244 
01245 <span class="comment">//</span>
01246 <span class="comment">// Processor Control Block (PRCB)</span>
01247 <span class="comment">//</span>
01248 
01249 <span class="preprocessor">#define PRCB_MINOR_VERSION 1</span>
01250 <span class="preprocessor"></span><span class="preprocessor">#define PRCB_MAJOR_VERSION 1</span>
01251 <span class="preprocessor"></span><span class="preprocessor">#define PRCB_BUILD_DEBUG        0x0001</span>
01252 <span class="preprocessor"></span><span class="preprocessor">#define PRCB_BUILD_UNIPROCESSOR 0x0002</span>
01253 <span class="preprocessor"></span>
01254 <span class="keyword">struct </span><a class="code" href="../../d5/d4/struct__RESTART__BLOCK.html">_RESTART_BLOCK</a>;
01255 
01256 <span class="keyword">typedef</span> <span class="keyword">struct </span>_KPRCB {
01257 
01258 <span class="comment">//</span>
01259 <span class="comment">// Major and minor version numbers of the PCR.</span>
01260 <span class="comment">//</span>
01261 
01262     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> MinorVersion;
01263     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> MajorVersion;
01264 
01265 <span class="comment">//</span>
01266 <span class="comment">// Start of the architecturally defined section of the PRCB. This section</span>
01267 <span class="comment">// may be directly addressed by vendor/platform specific HAL code and will</span>
01268 <span class="comment">// not change from version to version of NT.</span>
01269 <span class="comment">//</span>
01270 <span class="comment">//</span>
01271 
01272     <span class="keyword">struct </span><a class="code" href="../../d1/d8/struct__KTHREAD.html">_KTHREAD</a> *CurrentThread;
01273     <span class="keyword">struct </span><a class="code" href="../../d1/d8/struct__KTHREAD.html">_KTHREAD</a> *RESTRICTED_POINTER NextThread;
01274     <span class="keyword">struct </span><a class="code" href="../../d1/d8/struct__KTHREAD.html">_KTHREAD</a> *IdleThread;
01275     CCHAR Number;
01276     CCHAR Reserved;
01277     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> BuildType;
01278     KAFFINITY <a class="code" href="../../d0/d0/ki_8h.html#a7">SetMember</a>;
01279     <span class="keyword">struct </span><a class="code" href="../../d5/d4/struct__RESTART__BLOCK.html">_RESTART_BLOCK</a> *RestartBlock;
01280     ULONG PcrPage;
01281 
01282 <span class="comment">//</span>
01283 <span class="comment">// Space reserved for the system.</span>
01284 <span class="comment">//</span>
01285 
01286     ULONG SystemReserved[16];
01287 
01288 <span class="comment">//</span>
01289 <span class="comment">// Space reserved for the HAL.</span>
01290 <span class="comment">//</span>
01291 
01292     ULONG HalReserved[16];
01293 
01294 <span class="comment">// End of the architecturally defined section of the PRCB.</span>
01295 <span class="comment">// end_nthal</span>
01296 <span class="comment">//</span>
01297 
01298     ULONG DpcTime;
01299     ULONG InterruptTime;
01300     ULONG KernelTime;
01301     ULONG UserTime;
01302     ULONG AdjustDpcThreshold;
01303     ULONG InterruptCount;
01304     ULONG ApcBypassCount;
01305     ULONG DpcBypassCount;
01306     ULONG <a class="code" href="../../d4/d9/ke_8h.html#a407a223">Spare6</a>[5];
01307 
01308 <span class="comment">//</span>
01309 <span class="comment">// MP information.</span>
01310 <span class="comment">//</span>
01311 
01312     PVOID Spare1;
01313     PVOID <a class="code" href="../../d4/d9/ke_8h.html#a407a219">Spare2</a>;
01314     <span class="keyword">volatile</span> ULONG IpiFrozen;
01315     <span class="keyword">struct </span>_KPROCESSOR_STATE ProcessorState;
01316     PVOID <a class="code" href="../../d4/d9/ke_8h.html#a407a220">Spare3</a>[3];
01317 
01318 <span class="comment">//</span>
01319 <span class="comment">//  Per-processor data for various hot code which resides in the</span>
01320 <span class="comment">//  kernel image. Each processor is given it's own copy of the data</span>
01321 <span class="comment">//  to lessen the cache impact of sharing the data between multiple</span>
01322 <span class="comment">//  processors.</span>
01323 <span class="comment">//</span>
01324 
01325 <span class="comment">//</span>
01326 <span class="comment">//  Cache manager performance counters.</span>
01327 <span class="comment">//</span>
01328 
01329     ULONG <a class="code" href="../../d5/d2/cachedat_8c.html#a44">CcFastReadNoWait</a>;
01330     ULONG <a class="code" href="../../d5/d2/cachedat_8c.html#a45">CcFastReadWait</a>;
01331     ULONG <a class="code" href="../../d5/d2/cachedat_8c.html#a47">CcFastReadNotPossible</a>;
01332     ULONG <a class="code" href="../../d5/d2/cachedat_8c.html#a61">CcCopyReadNoWait</a>;
01333     ULONG <a class="code" href="../../d5/d2/cachedat_8c.html#a62">CcCopyReadWait</a>;
01334     ULONG <a class="code" href="../../d5/d2/cachedat_8c.html#a63">CcCopyReadNoWaitMiss</a>;
01335 
01336 <span class="comment">//</span>
01337 <span class="comment">// Kernel performance counters.</span>
01338 <span class="comment">//</span>
01339 
01340     ULONG KeAlignmentFixupCount;
01341     ULONG KeContextSwitches;
01342     ULONG <a class="code" href="../../d5/d9/kernldat_8c.html#a13">KeDcacheFlushCount</a>;
01343     ULONG KeExceptionDispatchCount;
01344     ULONG KeFirstLevelTbFills;
01345     ULONG KeFloatingEmulationCount;
01346     ULONG <a class="code" href="../../d5/d9/kernldat_8c.html#a14">KeIcacheFlushCount</a>;
01347     ULONG KeSecondLevelTbFills;
01348     ULONG KeSystemCalls;
01349 
01350 <span class="comment">//</span>
01351 <span class="comment">//  Reserved for future counters.</span>
01352 <span class="comment">//</span>
01353 
01354     ULONG ReservedCounter[8];
01355 
01356 <span class="comment">//</span>
01357 <span class="comment">// Reserved pad.</span>
01358 <span class="comment">//</span>
01359 
01360     ULONG ReservedPad[16 * 8];
01361 
01362 <span class="comment">//</span>
01363 <span class="comment">// MP interprocessor request packet and summary.</span>
01364 <span class="comment">//</span>
01365 <span class="comment">// N.B. This is carefully aligned to be on a cache line boundary.</span>
01366 <span class="comment">//</span>
01367 
01368     <span class="keyword">volatile</span> PVOID CurrentPacket[3];
01369     <span class="keyword">volatile</span> KAFFINITY TargetSet;
01370     <span class="keyword">volatile</span> <a class="code" href="../../d0/d9/ntosdef_8h.html#a55">PKIPI_WORKER</a> WorkerRoutine;
01371     ULONG CachePad1[3];
01372 
01373 <span class="comment">//</span>
01374 <span class="comment">// N.B. These two longwords must be on a quadword boundary and adjacent.</span>
01375 <span class="comment">//</span>
01376 
01377     <span class="keyword">volatile</span> ULONG RequestSummary;
01378     <span class="keyword">volatile</span> <span class="keyword">struct </span>_KPRCB *SignalDone;
01379     ULONG CachePad2[6];
01380 
01381 <span class="comment">//</span>
01382 <span class="comment">// DPC interrupt requested.</span>
01383 <span class="comment">//</span>
01384 
01385     ULONG DpcInterruptRequested;
01386     ULONG CachePad3[7];
01387 
01388 <span class="comment">//</span>
01389 <span class="comment">// DPC batching parameters.</span>
01390 <span class="comment">//</span>
01391 
01392     ULONG MaximumDpcQueueDepth;
01393     ULONG MinimumDpcRate;
01394 
01395 <span class="comment">//</span>
01396 <span class="comment">// Spare counters.</span>
01397 <span class="comment">//</span>
01398 
01399     ULONG <a class="code" href="../../d4/d9/ke_8h.html#a407a221">Spare4</a>[2];
01400 
01401 <span class="comment">//</span>
01402 <span class="comment">// I/O system per processor single entry lookaside lists.</span>
01403 <span class="comment">//</span>
01404 
01405     PVOID SmallIrpFreeEntry;
01406     PVOID LargeIrpFreeEntry;
01407     PVOID MdlFreeEntry;
01408 
01409 <span class="comment">//</span>
01410 <span class="comment">// Object manager per processor single entry lookaside lists.</span>
01411 <span class="comment">//</span>
01412 
01413     PVOID CreateInfoFreeEntry;
01414     PVOID NameBufferFreeEntry;
01415 
01416 <span class="comment">//</span>
01417 <span class="comment">// Cache manager per processor single entry lookaside lists.</span>
01418 <span class="comment">//</span>
01419 
01420     PVOID SharedCacheMapEntry;
01421 
01422 <span class="comment">//</span>
01423 <span class="comment">// Spares.</span>
01424 <span class="comment">//</span>
01425 
01426     ULONG <a class="code" href="../../d4/d9/ke_8h.html#a407a222">Spare5</a>[2];
01427 
01428 <span class="comment">//</span>
01429 <span class="comment">// Address of MP interprocessor operation counters.</span>
01430 <span class="comment">//</span>
01431 
01432     <a class="code" href="../../d1/d7/struct__KIPI__COUNTS.html">PKIPI_COUNTS</a> IpiCounts;
01433     LARGE_INTEGER StartCount;
01434 
01435 <span class="comment">//</span>
01436 <span class="comment">// DPC list head, spinlock, and count.</span>
01437 <span class="comment">//</span>
01438 
01439     KSPIN_LOCK DpcLock;
01440     LIST_ENTRY DpcListHead;
01441     ULONG DpcQueueDepth;
01442     ULONG DpcCount;
01443     ULONG DpcLastCount;
01444     ULONG DpcRequestRate;
01445     ULONG DpcRoutineActive;
01446     BOOLEAN SkipTick;
01447     ULONG CachePad4[5];
01448 
01449 <span class="comment">//</span>
01450 <span class="comment">// Processors power state</span>
01451 <span class="comment">//</span>
01452     PROCESSOR_POWER_STATE PowerState;
01453 
01454 } KPRCB, *PKPRCB, *RESTRICTED_POINTER PRKPRCB;  <span class="comment">// nthal</span>
01455 
01456 
01457 <span class="comment">// begin_ntddk begin_wdm begin_nthal begin_ntndis</span>
01458 <span class="comment">//</span>
01459 <span class="comment">// Define the page size for the MIPS R4000 as 4096 (0x1000).</span>
01460 <span class="comment">//</span>
01461 
01462 <span class="preprocessor">#define PAGE_SIZE (ULONG)0x1000</span>
01463 <span class="preprocessor"></span>
01464 <span class="comment">//</span>
01465 <span class="comment">// Define the number of trailing zeroes in a page aligned virtual address.</span>
01466 <span class="comment">// This is used as the shift count when shifting virtual addresses to</span>
01467 <span class="comment">// virtual page numbers.</span>
01468 <span class="comment">//</span>
01469 
01470 <span class="preprocessor">#define PAGE_SHIFT 12L</span>
01471 <span class="preprocessor"></span>
01472 <span class="comment">// end_ntddk end_wdm end_ntndis</span>
01473 <span class="comment">//</span>
01474 <span class="comment">// Define the number of bits to shift to right justify the Page Directory Index</span>
01475 <span class="comment">// field of a PTE.</span>
01476 <span class="comment">//</span>
01477 
01478 <span class="preprocessor">#define PDI_SHIFT 22</span>
01479 <span class="preprocessor"></span>
01480 <span class="comment">//</span>
01481 <span class="comment">// Define the number of bits to shift to right justify the Page Table Index</span>
01482 <span class="comment">// field of a PTE.</span>
01483 <span class="comment">//</span>
01484 
01485 <span class="preprocessor">#define PTI_SHIFT 12</span>
01486 <span class="preprocessor"></span>
01487 <span class="comment">// begin_ntddk</span>
01488 <span class="comment">//</span>
01489 <span class="comment">// The highest user address reserves 64K bytes for a guard page. This</span>
01490 <span class="comment">// the probing of address from kernel mode to only have to check the</span>
01491 <span class="comment">// starting address for structures of 64k bytes or less.</span>
01492 <span class="comment">//</span>
01493 
01494 <span class="preprocessor">#define MM_HIGHEST_USER_ADDRESS (PVOID)0x7FFEFFFF // highest user address</span>
01495 <span class="preprocessor"></span><span class="preprocessor">#define MM_SYSTEM_RANGE_START (PVOID)KSEG0_BASE // start of system space</span>
01496 <span class="preprocessor"></span><span class="preprocessor">#define MM_USER_PROBE_ADDRESS 0x7FFF0000 // starting address of guard page</span>
01497 <span class="preprocessor"></span>
01498 <span class="comment">//</span>
01499 <span class="comment">// The following definitions are required for the debugger data block.</span>
01500 <span class="comment">//</span>
01501 
01502 <span class="keyword">extern</span> PVOID <a class="code" href="../../d0/d9/miglobal_8c.html#a0">MmHighestUserAddress</a>;
01503 <span class="keyword">extern</span> PVOID <a class="code" href="../../d0/d9/miglobal_8c.html#a1">MmSystemRangeStart</a>;
01504 <span class="keyword">extern</span> ULONG <a class="code" href="../../d0/d9/miglobal_8c.html#a2">MmUserProbeAddress</a>;
01505 
01506 <span class="comment">//</span>
01507 <span class="comment">// The lowest user address reserves the low 64k.</span>
01508 <span class="comment">//</span>
01509 
01510 <span class="preprocessor">#define MM_LOWEST_USER_ADDRESS  (PVOID)0x00010000</span>
01511 <span class="preprocessor"></span>
01512 <span class="comment">// begin_wdm</span>
01513 
01514 <span class="preprocessor">#define MmGetProcedureAddress(Address) (Address)</span>
01515 <span class="preprocessor"></span><span class="preprocessor">#define MmLockPagableCodeSection(Address) MmLockPagableDataSection(Address)</span>
01516 <span class="preprocessor"></span>
01517 <span class="comment">// end_ntddk end_wdm</span>
01518 <span class="comment">//</span>
01519 <span class="comment">// Define the page table base and the page directory base for</span>
01520 <span class="comment">// the TB miss routines and memory management.</span>
01521 <span class="comment">//</span>
01522 
01523 <span class="preprocessor">#define PDE_BASE (ULONG)0xC0300000</span>
01524 <span class="preprocessor"></span><span class="preprocessor">#define PTE_BASE (ULONG)0xC0000000</span>
01525 <span class="preprocessor"></span><span class="preprocessor">#define PDE64_BASE (ULONG)0xC0302000</span>
01526 <span class="preprocessor"></span><span class="preprocessor">#define PTE64_BASE (ULONG)0xC0800000</span>
01527 <span class="preprocessor"></span>
01528 <span class="comment">// begin_ntddk begin_wdm</span>
01529 <span class="comment">//</span>
01530 <span class="comment">// The lowest address for system space.</span>
01531 <span class="comment">//</span>
01532 
01533 <span class="preprocessor">#define MM_LOWEST_SYSTEM_ADDRESS (PVOID)0xC0800000</span>
01534 <span class="preprocessor"></span><span class="preprocessor">#define SYSTEM_BASE 0xc0800000          // start of system space (no typecast)</span>
01535 <span class="preprocessor"></span>
01536 <span class="comment">// begin_ntndis</span>
01537 <span class="preprocessor">#endif // defined(_MIPS_)</span>
01538 <span class="preprocessor"></span><span class="comment">// end_nthal end_ntddk end_wdm end_ntndis</span>
01539 <span class="comment">// begin_nthal</span>
01540 <span class="comment">//</span>
01541 <span class="comment">// Define uncached policy for the r4000.</span>
01542 <span class="comment">//</span>
01543 
<a name="l01544"></a><a class="code" href="../../d9/d9/mips_8h.html#a0">01544</a> <span class="preprocessor">#define UNCACHED_POLICY 2               // uncached</span>
01545 <span class="preprocessor"></span>
01546 <span class="comment">// end_nthal</span>
01547 
01548 <span class="comment">//</span>
01549 <span class="comment">// MIPS function definitions</span>
01550 <span class="comment">//</span>
01551 
01552 <span class="comment">//++</span>
01553 <span class="comment">//</span>
01554 <span class="comment">// BOOLEAN</span>
01555 <span class="comment">// KiIsThreadNumericStateSaved(</span>
01556 <span class="comment">//     IN PKTHREAD Address</span>
01557 <span class="comment">//     )</span>
01558 <span class="comment">//</span>
01559 <span class="comment">//  This call is used on a not running thread to see if it's numeric</span>
01560 <span class="comment">//  state has been saved in it's context information.  On mips the</span>
01561 <span class="comment">//  numeric state is always saved.</span>
01562 <span class="comment">//</span>
01563 <span class="comment">//--</span>
01564 
<a name="l01565"></a><a class="code" href="../../d9/d9/mips_8h.html#a1">01565</a> <span class="preprocessor">#define KiIsThreadNumericStateSaved(a) TRUE</span>
01566 <span class="preprocessor"></span>
01567 <span class="comment">//++</span>
01568 <span class="comment">//</span>
01569 <span class="comment">// VOID</span>
01570 <span class="comment">// KiRundownThread(</span>
01571 <span class="comment">//     IN PKTHREAD Address</span>
01572 <span class="comment">//     )</span>
01573 <span class="comment">//</span>
01574 <span class="comment">//--</span>
01575 
<a name="l01576"></a><a class="code" href="../../d9/d9/mips_8h.html#a2">01576</a> <span class="preprocessor">#define KiRundownThread(a)</span>
01577 <span class="preprocessor"></span>
01578 <span class="comment">//</span>
01579 <span class="comment">// Define macro to test if x86 feature is present.</span>
01580 <span class="comment">//</span>
01581 <span class="comment">// N.B. All x86 features test TRUE on MIPS systems.</span>
01582 <span class="comment">//</span>
01583 
<a name="l01584"></a><a class="code" href="../../d9/d9/mips_8h.html#a3">01584</a> <span class="preprocessor">#define Isx86FeaturePresent(_f_) TRUE</span>
01585 <span class="preprocessor"></span>
01586 <span class="preprocessor">#endif // _MIPSH_</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:48 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
