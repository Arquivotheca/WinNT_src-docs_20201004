<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: heappriv.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>heappriv.h</h1><a href="../../d9/d9/heappriv_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1992  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    heappriv.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Private include file used by heap allocator (heap.c, heapdll.c and</span>
00012 <span class="comment">    heapdbg.c)</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Steve Wood (stevewo) 25-Oct-1994</span>
00017 <span class="comment"></span>
00018 <span class="comment">Revision History:</span>
00019 <span class="comment"></span>
00020 <span class="comment">--*/</span>
00021 
00022 <span class="preprocessor">#ifndef _RTL_HEAP_PRIVATE_</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define _RTL_HEAP_PRIVATE_</span>
00024 <span class="preprocessor"></span>
00025 <span class="preprocessor">#include "<a class="code" href="../../d7/d9/heappage_8h.html">heappage.h</a>"</span>
00026 
00027 <span class="comment">//</span>
00028 <span class="comment">//  Disable FPO optimization so even retail builds get somewhat reasonable</span>
00029 <span class="comment">//  stack backtraces</span>
00030 <span class="comment">//</span>
00031 
00032 <span class="preprocessor">#if i386</span>
00033 <span class="preprocessor"></span><span class="comment">// #pragma optimize("y",off)</span>
00034 <span class="preprocessor">#endif</span>
00035 <span class="preprocessor"></span>
00036 <span class="preprocessor">#if DBG</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#define HEAPASSERT(exp) if (!(exp)) RtlAssert( #exp, __FILE__, __LINE__, NULL )</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00039"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a0">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define HEAPASSERT(exp)</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00041 <span class="preprocessor"></span>
00042 <span class="comment">//</span>
00043 <span class="comment">//  This variable contains the fill pattern used for heap tail checking</span>
00044 <span class="comment">//</span>
00045 
<a name="l00046"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a23">00046</a> UCHAR <a class="code" href="../../d1/d9/rtl_2heap_8c.html#a3">CheckHeapFillPattern</a>[ <a class="code" href="../../d3/d9/heap_8h.html#a25">CHECK_HEAP_TAIL_SIZE</a> ];
00047 
00048 
00049 <span class="comment">//</span>
00050 <span class="comment">//  Here are the locking routines for the heap (kernel and user)</span>
00051 <span class="comment">//</span>
00052 
00053 <span class="preprocessor">#ifdef NTOS_KERNEL_RUNTIME</span>
00054 <span class="preprocessor"></span>
00055 <span class="comment">//</span>
00056 <span class="comment">//  Kernel mode heap uses the kernel resource package for locking</span>
00057 <span class="comment">//</span>
00058 
00059 <span class="preprocessor">#define RtlInitializeLockRoutine(L) ExInitializeResource((PERESOURCE)(L))</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#define RtlAcquireLockRoutine(L)    ExAcquireResourceExclusive((PERESOURCE)(L),TRUE)</span>
00061 <span class="preprocessor"></span><span class="preprocessor">#define RtlReleaseLockRoutine(L)    ExReleaseResource((PERESOURCE)(L))</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#define RtlDeleteLockRoutine(L)     ExDeleteResource((PERESOURCE)(L))</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#define RtlOkayToLockRoutine(L)     ExOkayToLockRoutine((PERESOURCE)(L))</span>
00064 <span class="preprocessor"></span>
00065 <span class="preprocessor">#else // #ifdef NTOS_KERNEL_ROUTINE</span>
00066 <span class="preprocessor"></span>
00067 <span class="comment">//</span>
00068 <span class="comment">//  User mode heap uses the critical section package for locking</span>
00069 <span class="comment">//</span>
00070 
00071 <span class="preprocessor">#ifndef PREALLOCATE_EVENT_MASK</span>
00072 <span class="preprocessor"></span>
<a name="l00073"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a1">00073</a> <span class="preprocessor">#define PREALLOCATE_EVENT_MASK  0x80000000  // **** defined only in dll\resource.c</span>
00074 <span class="preprocessor"></span>
00075 <span class="preprocessor">#endif // PREALLOCATE_EVENT_MASK</span>
00076 <span class="preprocessor"></span>
<a name="l00077"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a2">00077</a> <span class="preprocessor">#define RtlInitializeLockRoutine(L) RtlInitializeCriticalSectionAndSpinCount((PRTL_CRITICAL_SECTION)(L),(PREALLOCATE_EVENT_MASK | 4000))</span>
<a name="l00078"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a3">00078</a> <span class="preprocessor"></span><span class="preprocessor">#define RtlAcquireLockRoutine(L)    RtlEnterCriticalSection((PRTL_CRITICAL_SECTION)(L))</span>
<a name="l00079"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a4">00079</a> <span class="preprocessor"></span><span class="preprocessor">#define RtlReleaseLockRoutine(L)    RtlLeaveCriticalSection((PRTL_CRITICAL_SECTION)(L))</span>
<a name="l00080"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a5">00080</a> <span class="preprocessor"></span><span class="preprocessor">#define RtlDeleteLockRoutine(L)     RtlDeleteCriticalSection((PRTL_CRITICAL_SECTION)(L))</span>
<a name="l00081"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a6">00081</a> <span class="preprocessor"></span><span class="preprocessor">#define RtlOkayToLockRoutine(L)     NtdllOkayToLockRoutine((PVOID)(L))</span>
00082 <span class="preprocessor"></span>
00083 <span class="preprocessor">#endif // #ifdef NTOS_KERNEL_RUNTIME</span>
00084 <span class="preprocessor"></span>
00085 
00086 <span class="comment">//</span>
00087 <span class="comment">//  Here are some debugging macros for the heap</span>
00088 <span class="comment">//</span>
00089 
00090 <span class="preprocessor">#ifdef NTOS_KERNEL_RUNTIME</span>
00091 <span class="preprocessor"></span>
00092 <span class="preprocessor">#define HEAP_DEBUG_FLAGS   0</span>
00093 <span class="preprocessor"></span><span class="preprocessor">#define DEBUG_HEAP(F)      FALSE</span>
00094 <span class="preprocessor"></span><span class="preprocessor">#define SET_LAST_STATUS(S) NOTHING;</span>
00095 <span class="preprocessor"></span>
00096 <span class="preprocessor">#else // #ifdef NTOS_KERNEL_ROUTINE</span>
00097 <span class="preprocessor"></span>
<a name="l00098"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a7">00098</a> <span class="preprocessor">#define HEAP_DEBUG_FLAGS   (HEAP_VALIDATE_PARAMETERS_ENABLED | \</span>
00099 <span class="preprocessor">                            HEAP_VALIDATE_ALL_ENABLED        | \</span>
00100 <span class="preprocessor">                            HEAP_CAPTURE_STACK_BACKTRACES    | \</span>
00101 <span class="preprocessor">                            HEAP_CREATE_ENABLE_TRACING       | \</span>
00102 <span class="preprocessor">                            HEAP_FLAG_PAGE_ALLOCS)</span>
<a name="l00103"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a8">00103</a> <span class="preprocessor"></span><span class="preprocessor">#define DEBUG_HEAP(F)      ((F &amp; HEAP_DEBUG_FLAGS) &amp;&amp; !(F &amp; HEAP_SKIP_VALIDATION_CHECKS))</span>
<a name="l00104"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a9">00104</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_LAST_STATUS(S) {NtCurrentTeb()-&gt;LastErrorValue = RtlNtStatusToDosError( NtCurrentTeb()-&gt;LastStatusValue = (ULONG)(S) );}</span>
00105 <span class="preprocessor"></span>
00106 <span class="preprocessor">#endif // #ifdef NTOS_KERNEL_RUNTIME</span>
00107 <span class="preprocessor"></span>
00108 
00109 <span class="comment">//</span>
00110 <span class="comment">//  Here are the macros used for debug printing and breakpoints</span>
00111 <span class="comment">//</span>
00112 
00113 <span class="preprocessor">#ifdef NTOS_KERNEL_RUNTIME</span>
00114 <span class="preprocessor"></span>
00115 <span class="preprocessor">#define HeapDebugPrint( _x_ ) {DbgPrint _x_;}</span>
00116 <span class="preprocessor"></span>
00117 <span class="preprocessor">#define HeapDebugBreak( _x_ ) {if (KdDebuggerEnabled) DbgBreakPoint();}</span>
00118 <span class="preprocessor"></span>
00119 <span class="preprocessor">#else // #ifdef NTOS_KERNEL_ROUTINE</span>
00120 <span class="preprocessor"></span>
<a name="l00121"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a10">00121</a> <span class="preprocessor">#define HeapDebugPrint( _x_ )                                   \</span>
00122 <span class="preprocessor">{                                                               \</span>
00123 <span class="preprocessor">    PLIST_ENTRY _Module;                                        \</span>
00124 <span class="preprocessor">    PLDR_DATA_TABLE_ENTRY _Entry;                               \</span>
00125 <span class="preprocessor">                                                                \</span>
00126 <span class="preprocessor">    _Module = NtCurrentPeb()-&gt;Ldr-&gt;InLoadOrderModuleList.Flink; \</span>
00127 <span class="preprocessor">    _Entry = CONTAINING_RECORD( _Module,                        \</span>
00128 <span class="preprocessor">                                LDR_DATA_TABLE_ENTRY,           \</span>
00129 <span class="preprocessor">                                InLoadOrderLinks);              \</span>
00130 <span class="preprocessor">    DbgPrint("HEAP[%wZ]: ", &amp;_Entry-&gt;BaseDllName);              \</span>
00131 <span class="preprocessor">    DbgPrint _x_;                                               \</span>
00132 <span class="preprocessor">}</span>
00133 <span class="preprocessor"></span>
<a name="l00134"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a11">00134</a> <span class="preprocessor">#define HeapDebugBreak( _x_ )                    \</span>
00135 <span class="preprocessor">{                                                \</span>
00136 <span class="preprocessor">    VOID RtlpBreakPointHeap( PVOID BadAddress ); \</span>
00137 <span class="preprocessor">                                                 \</span>
00138 <span class="preprocessor">    RtlpBreakPointHeap( (_x_) );                 \</span>
00139 <span class="preprocessor">}</span>
00140 <span class="preprocessor"></span>
00141 <span class="preprocessor">#endif // #ifdef NTOS_KERNEL_RUNTIME</span>
00142 <span class="preprocessor"></span>
00143 
00144 <span class="comment">//</span>
00145 <span class="comment">//  Implemented in heap.c</span>
00146 <span class="comment">//</span>
00147 
00148 BOOLEAN
00149 <a class="code" href="../../d9/d9/heappriv_8h.html#a33">RtlpInitializeHeapSegment</a> (
00150     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00151     IN <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html">PHEAP_SEGMENT</a> Segment,
00152     IN UCHAR SegmentIndex,
00153     IN ULONG Flags,
00154     IN PVOID BaseAddress,
00155     IN PVOID UnCommittedAddress,
00156     IN PVOID CommitLimitAddress
00157     );
00158 
00159 <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html">PHEAP_FREE_ENTRY</a>
00160 <a class="code" href="../../d9/d9/heappriv_8h.html#a34">RtlpCoalesceFreeBlocks</a> (
00161     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00162     IN <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html">PHEAP_FREE_ENTRY</a> FreeBlock,
00163     IN OUT PSIZE_T FreeSize,
00164     IN BOOLEAN RemoveFromFreeList
00165     );
00166 
00167 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00168 <a class="code" href="../../d9/d9/heappriv_8h.html#a35">RtlpDeCommitFreeBlock</a> (
00169     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00170     IN <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html">PHEAP_FREE_ENTRY</a> FreeBlock,
00171     IN SIZE_T FreeSize
00172     );
00173 
00174 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00175 <a class="code" href="../../d9/d9/heappriv_8h.html#a36">RtlpInsertFreeBlock</a> (
00176     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00177     IN <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html">PHEAP_FREE_ENTRY</a> FreeBlock,
00178     IN SIZE_T FreeSize
00179     );
00180 
00181 <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html">PHEAP_FREE_ENTRY</a>
00182 <a class="code" href="../../d9/d9/heappriv_8h.html#a37">RtlpFindAndCommitPages</a> (
00183     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00184     IN <a class="code" href="../../d8/d6/struct__HEAP__SEGMENT.html">PHEAP_SEGMENT</a> Segment,
00185     IN OUT PSIZE_T Size,
00186     IN PVOID AddressWanted OPTIONAL
00187     );
00188 
00189 PVOID
00190 <a class="code" href="../../d9/d9/heappriv_8h.html#a38">RtlAllocateHeapSlowly</a> (
00191     IN PVOID HeapHandle,
00192     IN ULONG Flags,
00193     IN SIZE_T Size
00194     );
00195 
00196 BOOLEAN
00197 <a class="code" href="../../d9/d9/heappriv_8h.html#a39">RtlFreeHeapSlowly</a> (
00198     IN PVOID HeapHandle,
00199     IN ULONG Flags,
00200     IN PVOID BaseAddress
00201     );
00202 
00203 SIZE_T
00204 <a class="code" href="../../d9/d9/heappriv_8h.html#a40">RtlpGetSizeOfBigBlock</a> (
00205     IN <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">PHEAP_ENTRY</a> BusyBlock
00206     );
00207 
00208 <a class="code" href="../../d8/d5/struct__HEAP__ENTRY__EXTRA.html">PHEAP_ENTRY_EXTRA</a>
00209 <a class="code" href="../../d9/d9/heappriv_8h.html#a41">RtlpGetExtraStuffPointer</a> (
00210     <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">PHEAP_ENTRY</a> BusyBlock
00211     );
00212 
00213 BOOLEAN
00214 <a class="code" href="../../d9/d9/heappriv_8h.html#a42">RtlpCheckBusyBlockTail</a> (
00215     IN <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">PHEAP_ENTRY</a> BusyBlock
00216     );
00217 
00218 
00219 <span class="comment">//</span>
00220 <span class="comment">//  Implemented in heapdll.c</span>
00221 <span class="comment">//</span>
00222 
00223 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00224 <a class="code" href="../../d9/d9/heappriv_8h.html#a43">RtlpAddHeapToProcessList</a> (
00225     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap
00226     );
00227 
00228 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00229 <a class="code" href="../../d9/d9/heappriv_8h.html#a44">RtlpRemoveHeapFromProcessList</a> (
00230     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap
00231     );
00232 
00233 <a class="code" href="../../d1/d6/struct__HEAP__FREE__ENTRY.html">PHEAP_FREE_ENTRY</a>
00234 <a class="code" href="../../d9/d9/heappriv_8h.html#a45">RtlpCoalesceHeap</a> (
00235     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap
00236     );
00237 
00238 BOOLEAN
00239 <a class="code" href="../../d9/d9/heappriv_8h.html#a46">RtlpCheckHeapSignature</a> (
00240     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00241     IN PCHAR Caller
00242     );
00243 
00244 
00245 <span class="comment">//</span>
00246 <span class="comment">//  Implemented in heapdbg.c</span>
00247 <span class="comment">//</span>
00248 
00249 BOOLEAN
00250 <a class="code" href="../../d9/d9/heappriv_8h.html#a47">RtlpValidateHeapEntry</a> (
00251     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00252     IN <a class="code" href="../../d7/d5/struct__HEAP__ENTRY.html">PHEAP_ENTRY</a> BusyBlock,
00253     IN PCHAR Reason
00254     );
00255 
00256 BOOLEAN
00257 <a class="code" href="../../d9/d9/heappriv_8h.html#a48">RtlpValidateHeap</a> (
00258     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00259     IN BOOLEAN AlwaysValidate
00260     );
00261 
00262 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00263 <a class="code" href="../../d9/d9/heappriv_8h.html#a49">RtlpUpdateHeapListIndex</a> (
00264     USHORT OldIndex,
00265     USHORT NewIndex
00266     );
00267 
00268 BOOLEAN
00269 <a class="code" href="../../d9/d9/heappriv_8h.html#a50">RtlpValidateHeapHeaders</a>(
00270     IN <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00271     IN BOOLEAN Recompute
00272     );
00273 
00274 
00275 <span class="comment">//</span>
00276 <span class="comment">//  Macro for setting a bit in the freelist vector to indicate entries are</span>
00277 <span class="comment">//  present.</span>
00278 <span class="comment">//</span>
00279 
<a name="l00280"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a12">00280</a> <span class="preprocessor">#define SET_FREELIST_BIT( H, FB )                                     \</span>
00281 <span class="preprocessor">{                                                                     \</span>
00282 <span class="preprocessor">    ULONG _Index_;                                                    \</span>
00283 <span class="preprocessor">    ULONG _Bit_;                                                      \</span>
00284 <span class="preprocessor">                                                                      \</span>
00285 <span class="preprocessor">    HEAPASSERT((FB)-&gt;Size &lt; HEAP_MAXIMUM_FREELISTS);                  \</span>
00286 <span class="preprocessor">                                                                      \</span>
00287 <span class="preprocessor">    _Index_ = (FB)-&gt;Size &gt;&gt; 3;                                        \</span>
00288 <span class="preprocessor">    _Bit_ = (1 &lt;&lt; ((FB)-&gt;Size &amp; 7));                                  \</span>
00289 <span class="preprocessor">                                                                      \</span>
00290 <span class="preprocessor">    HEAPASSERT(((H)-&gt;u.FreeListsInUseBytes[ _Index_ ] &amp; _Bit_) == 0); \</span>
00291 <span class="preprocessor">                                                                      \</span>
00292 <span class="preprocessor">    (H)-&gt;u.FreeListsInUseBytes[ _Index_ ] |= _Bit_;                   \</span>
00293 <span class="preprocessor">}</span>
00294 <span class="preprocessor"></span>
00295 <span class="comment">//</span>
00296 <span class="comment">//  Macro for clearing a bit in the freelist vector to indicate entries are</span>
00297 <span class="comment">//  not present.</span>
00298 <span class="comment">//</span>
00299 
<a name="l00300"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a13">00300</a> <span class="preprocessor">#define CLEAR_FREELIST_BIT( H, FB )                            \</span>
00301 <span class="preprocessor">{                                                              \</span>
00302 <span class="preprocessor">    ULONG _Index_;                                             \</span>
00303 <span class="preprocessor">    ULONG _Bit_;                                               \</span>
00304 <span class="preprocessor">                                                               \</span>
00305 <span class="preprocessor">    HEAPASSERT((FB)-&gt;Size &lt; HEAP_MAXIMUM_FREELISTS);           \</span>
00306 <span class="preprocessor">                                                               \</span>
00307 <span class="preprocessor">    _Index_ = (FB)-&gt;Size &gt;&gt; 3;                                 \</span>
00308 <span class="preprocessor">    _Bit_ = (1 &lt;&lt; ((FB)-&gt;Size &amp; 7));                           \</span>
00309 <span class="preprocessor">                                                               \</span>
00310 <span class="preprocessor">    HEAPASSERT((H)-&gt;u.FreeListsInUseBytes[ _Index_ ] &amp; _Bit_); \</span>
00311 <span class="preprocessor">    HEAPASSERT(IsListEmpty(&amp;(H)-&gt;FreeLists[ (FB)-&gt;Size ]));    \</span>
00312 <span class="preprocessor">                                                               \</span>
00313 <span class="preprocessor">    (H)-&gt;u.FreeListsInUseBytes[ _Index_ ] ^= _Bit_;            \</span>
00314 <span class="preprocessor">}</span>
00315 <span class="preprocessor"></span>
00316 
00317 <span class="comment">//</span>
00318 <span class="comment">//  This macro inserts a free block into the appropriate free list including</span>
00319 <span class="comment">//  the [0] index list with entry filling if necessary</span>
00320 <span class="comment">//</span>
00321 
<a name="l00322"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a14">00322</a> <span class="preprocessor">#define RtlpInsertFreeBlockDirect( H, FB, SIZE )                          \</span>
00323 <span class="preprocessor">{                                                                         \</span>
00324 <span class="preprocessor">    PLIST_ENTRY _HEAD, _NEXT;                                             \</span>
00325 <span class="preprocessor">    PHEAP_FREE_ENTRY _FB1;                                                \</span>
00326 <span class="preprocessor">                                                                          \</span>
00327 <span class="preprocessor">    HEAPASSERT((FB)-&gt;Size == (SIZE));                                     \</span>
00328 <span class="preprocessor">    (FB)-&gt;Flags &amp;= ~(HEAP_ENTRY_FILL_PATTERN |                            \</span>
00329 <span class="preprocessor">                     HEAP_ENTRY_EXTRA_PRESENT |                           \</span>
00330 <span class="preprocessor">                     HEAP_ENTRY_BUSY);                                    \</span>
00331 <span class="preprocessor">                                                                          \</span>
00332 <span class="preprocessor">    if ((H)-&gt;Flags &amp; HEAP_FREE_CHECKING_ENABLED) {                        \</span>
00333 <span class="preprocessor">                                                                          \</span>
00334 <span class="preprocessor">        RtlFillMemoryUlong( (PCHAR)((FB) + 1),                            \</span>
00335 <span class="preprocessor">                            ((SIZE) &lt;&lt; HEAP_GRANULARITY_SHIFT) -          \</span>
00336 <span class="preprocessor">                                sizeof( *(FB) ),                          \</span>
00337 <span class="preprocessor">                            FREE_HEAP_FILL );                             \</span>
00338 <span class="preprocessor">                                                                          \</span>
00339 <span class="preprocessor">        (FB)-&gt;Flags |= HEAP_ENTRY_FILL_PATTERN;                           \</span>
00340 <span class="preprocessor">    }                                                                     \</span>
00341 <span class="preprocessor">                                                                          \</span>
00342 <span class="preprocessor">    if ((SIZE) &lt; HEAP_MAXIMUM_FREELISTS) {                                \</span>
00343 <span class="preprocessor">                                                                          \</span>
00344 <span class="preprocessor">        _HEAD = &amp;(H)-&gt;FreeLists[ (SIZE) ];                                \</span>
00345 <span class="preprocessor">                                                                          \</span>
00346 <span class="preprocessor">        if (IsListEmpty(_HEAD)) {                                         \</span>
00347 <span class="preprocessor">                                                                          \</span>
00348 <span class="preprocessor">            SET_FREELIST_BIT( H, FB );                                    \</span>
00349 <span class="preprocessor">        }                                                                 \</span>
00350 <span class="preprocessor">                                                                          \</span>
00351 <span class="preprocessor">    } else {                                                              \</span>
00352 <span class="preprocessor">                                                                          \</span>
00353 <span class="preprocessor">        _HEAD = &amp;(H)-&gt;FreeLists[ 0 ];                                     \</span>
00354 <span class="preprocessor">        _NEXT = _HEAD-&gt;Flink;                                             \</span>
00355 <span class="preprocessor">                                                                          \</span>
00356 <span class="preprocessor">        while (_HEAD != _NEXT) {                                          \</span>
00357 <span class="preprocessor">                                                                          \</span>
00358 <span class="preprocessor">            _FB1 = CONTAINING_RECORD( _NEXT, HEAP_FREE_ENTRY, FreeList ); \</span>
00359 <span class="preprocessor">                                                                          \</span>
00360 <span class="preprocessor">            if ((SIZE) &lt;= _FB1-&gt;Size) {                                   \</span>
00361 <span class="preprocessor">                                                                          \</span>
00362 <span class="preprocessor">                break;                                                    \</span>
00363 <span class="preprocessor">                                                                          \</span>
00364 <span class="preprocessor">            } else {                                                      \</span>
00365 <span class="preprocessor">                                                                          \</span>
00366 <span class="preprocessor">                _NEXT = _NEXT-&gt;Flink;                                     \</span>
00367 <span class="preprocessor">            }                                                             \</span>
00368 <span class="preprocessor">        }                                                                 \</span>
00369 <span class="preprocessor">                                                                          \</span>
00370 <span class="preprocessor">        _HEAD = _NEXT;                                                    \</span>
00371 <span class="preprocessor">    }                                                                     \</span>
00372 <span class="preprocessor">                                                                          \</span>
00373 <span class="preprocessor">    InsertTailList( _HEAD, &amp;(FB)-&gt;FreeList );                             \</span>
00374 <span class="preprocessor">}</span>
00375 <span class="preprocessor"></span>
00376 <span class="comment">//</span>
00377 <span class="comment">//  This version of RtlpInsertFreeBlockDirect does no filling.</span>
00378 <span class="comment">//</span>
00379 
<a name="l00380"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a15">00380</a> <span class="preprocessor">#define RtlpFastInsertFreeBlockDirect( H, FB, SIZE )              \</span>
00381 <span class="preprocessor">{                                                                 \</span>
00382 <span class="preprocessor">    if ((SIZE) &lt; HEAP_MAXIMUM_FREELISTS) {                        \</span>
00383 <span class="preprocessor">                                                                  \</span>
00384 <span class="preprocessor">        RtlpFastInsertDedicatedFreeBlockDirect( H, FB, SIZE );    \</span>
00385 <span class="preprocessor">                                                                  \</span>
00386 <span class="preprocessor">    } else {                                                      \</span>
00387 <span class="preprocessor">                                                                  \</span>
00388 <span class="preprocessor">        RtlpFastInsertNonDedicatedFreeBlockDirect( H, FB, SIZE ); \</span>
00389 <span class="preprocessor">    }                                                             \</span>
00390 <span class="preprocessor">}</span>
00391 <span class="preprocessor"></span>
00392 <span class="comment">//</span>
00393 <span class="comment">//  This version of RtlpInsertFreeBlockDirect only works for dedicated free</span>
00394 <span class="comment">//  lists and doesn't do any filling.</span>
00395 <span class="comment">//</span>
00396 
<a name="l00397"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a16">00397</a> <span class="preprocessor">#define RtlpFastInsertDedicatedFreeBlockDirect( H, FB, SIZE )             \</span>
00398 <span class="preprocessor">{                                                                         \</span>
00399 <span class="preprocessor">    PLIST_ENTRY _HEAD;                                                    \</span>
00400 <span class="preprocessor">                                                                          \</span>
00401 <span class="preprocessor">    HEAPASSERT((FB)-&gt;Size == (SIZE));                                     \</span>
00402 <span class="preprocessor">                                                                          \</span>
00403 <span class="preprocessor">    if (!((FB)-&gt;Flags &amp; HEAP_ENTRY_LAST_ENTRY)) {                         \</span>
00404 <span class="preprocessor">                                                                          \</span>
00405 <span class="preprocessor">        HEAPASSERT(((PHEAP_ENTRY)(FB) + (SIZE))-&gt;PreviousSize == (SIZE)); \</span>
00406 <span class="preprocessor">    }                                                                     \</span>
00407 <span class="preprocessor">                                                                          \</span>
00408 <span class="preprocessor">    (FB)-&gt;Flags &amp;= HEAP_ENTRY_LAST_ENTRY;                                 \</span>
00409 <span class="preprocessor">                                                                          \</span>
00410 <span class="preprocessor">    _HEAD = &amp;(H)-&gt;FreeLists[ (SIZE) ];                                    \</span>
00411 <span class="preprocessor">                                                                          \</span>
00412 <span class="preprocessor">    if (IsListEmpty(_HEAD)) {                                             \</span>
00413 <span class="preprocessor">                                                                          \</span>
00414 <span class="preprocessor">        SET_FREELIST_BIT( H, FB );                                        \</span>
00415 <span class="preprocessor">    }                                                                     \</span>
00416 <span class="preprocessor">                                                                          \</span>
00417 <span class="preprocessor">    InsertTailList( _HEAD, &amp;(FB)-&gt;FreeList );                             \</span>
00418 <span class="preprocessor">}</span>
00419 <span class="preprocessor"></span>
00420 <span class="comment">//</span>
00421 <span class="comment">//  This version of RtlpInsertFreeBlockDirect only works for nondedicated free</span>
00422 <span class="comment">//  lists and doesn't do any filling.</span>
00423 <span class="comment">//</span>
00424 
<a name="l00425"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a17">00425</a> <span class="preprocessor">#define RtlpFastInsertNonDedicatedFreeBlockDirect( H, FB, SIZE )          \</span>
00426 <span class="preprocessor">{                                                                         \</span>
00427 <span class="preprocessor">    PLIST_ENTRY _HEAD, _NEXT;                                             \</span>
00428 <span class="preprocessor">    PHEAP_FREE_ENTRY _FB1;                                                \</span>
00429 <span class="preprocessor">                                                                          \</span>
00430 <span class="preprocessor">    HEAPASSERT((FB)-&gt;Size == (SIZE));                                     \</span>
00431 <span class="preprocessor">                                                                          \</span>
00432 <span class="preprocessor">    if (!((FB)-&gt;Flags &amp; HEAP_ENTRY_LAST_ENTRY)) {                         \</span>
00433 <span class="preprocessor">                                                                          \</span>
00434 <span class="preprocessor">        HEAPASSERT(((PHEAP_ENTRY)(FB) + (SIZE))-&gt;PreviousSize == (SIZE)); \</span>
00435 <span class="preprocessor">    }                                                                     \</span>
00436 <span class="preprocessor">                                                                          \</span>
00437 <span class="preprocessor">    (FB)-&gt;Flags &amp;= (HEAP_ENTRY_LAST_ENTRY);                               \</span>
00438 <span class="preprocessor">                                                                          \</span>
00439 <span class="preprocessor">    _HEAD = &amp;(H)-&gt;FreeLists[ 0 ];                                         \</span>
00440 <span class="preprocessor">    _NEXT = _HEAD-&gt;Flink;                                                 \</span>
00441 <span class="preprocessor">                                                                          \</span>
00442 <span class="preprocessor">    while (_HEAD != _NEXT) {                                              \</span>
00443 <span class="preprocessor">                                                                          \</span>
00444 <span class="preprocessor">        _FB1 = CONTAINING_RECORD( _NEXT, HEAP_FREE_ENTRY, FreeList );     \</span>
00445 <span class="preprocessor">                                                                          \</span>
00446 <span class="preprocessor">        if ((SIZE) &lt;= _FB1-&gt;Size) {                                       \</span>
00447 <span class="preprocessor">                                                                          \</span>
00448 <span class="preprocessor">            break;                                                        \</span>
00449 <span class="preprocessor">                                                                          \</span>
00450 <span class="preprocessor">        } else {                                                          \</span>
00451 <span class="preprocessor">                                                                          \</span>
00452 <span class="preprocessor">            _NEXT = _NEXT-&gt;Flink;                                         \</span>
00453 <span class="preprocessor">        }                                                                 \</span>
00454 <span class="preprocessor">    }                                                                     \</span>
00455 <span class="preprocessor">                                                                          \</span>
00456 <span class="preprocessor">    InsertTailList( _NEXT, &amp;(FB)-&gt;FreeList );                             \</span>
00457 <span class="preprocessor">}</span>
00458 <span class="preprocessor"></span>
00459 
00460 <span class="comment">//</span>
00461 <span class="comment">//  This macro removes a block from its free list with fill checking if</span>
00462 <span class="comment">//  necessary</span>
00463 <span class="comment">//</span>
00464 
<a name="l00465"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a18">00465</a> <span class="preprocessor">#define RtlpRemoveFreeBlock( H, FB )                                              \</span>
00466 <span class="preprocessor">{                                                                                 \</span>
00467 <span class="preprocessor">    RtlpFastRemoveFreeBlock( H, FB )                                              \</span>
00468 <span class="preprocessor">                                                                                  \</span>
00469 <span class="preprocessor">    if ((FB)-&gt;Flags &amp; HEAP_ENTRY_FILL_PATTERN) {                                  \</span>
00470 <span class="preprocessor">                                                                                  \</span>
00471 <span class="preprocessor">        SIZE_T cb, cbEqual;                                                       \</span>
00472 <span class="preprocessor">        PVOID p;                                                                  \</span>
00473 <span class="preprocessor">                                                                                  \</span>
00474 <span class="preprocessor">        cb = ((FB)-&gt;Size &lt;&lt; HEAP_GRANULARITY_SHIFT) - sizeof( *(FB) );            \</span>
00475 <span class="preprocessor">                                                                                  \</span>
00476 <span class="preprocessor">        if ((FB)-&gt;Flags &amp; HEAP_ENTRY_EXTRA_PRESENT &amp;&amp;                             \</span>
00477 <span class="preprocessor">            cb &gt; sizeof( HEAP_FREE_ENTRY_EXTRA )) {                               \</span>
00478 <span class="preprocessor">                                                                                  \</span>
00479 <span class="preprocessor">            cb -= sizeof( HEAP_FREE_ENTRY_EXTRA );                                \</span>
00480 <span class="preprocessor">        }                                                                         \</span>
00481 <span class="preprocessor">                                                                                  \</span>
00482 <span class="preprocessor">        cbEqual = RtlCompareMemoryUlong( (PCHAR)((FB) + 1),                       \</span>
00483 <span class="preprocessor">                                                 cb,                              \</span>
00484 <span class="preprocessor">                                                 FREE_HEAP_FILL );                \</span>
00485 <span class="preprocessor">                                                                                  \</span>
00486 <span class="preprocessor">        if (cbEqual != cb) {                                                      \</span>
00487 <span class="preprocessor">                                                                                  \</span>
00488 <span class="preprocessor">            HeapDebugPrint((                                                      \</span>
00489 <span class="preprocessor">                "HEAP: Free Heap block %lx modified at %lx after it was freed\n", \</span>
00490 <span class="preprocessor">                (FB),                                                             \</span>
00491 <span class="preprocessor">                (PCHAR)((FB) + 1) + cbEqual ));                                   \</span>
00492 <span class="preprocessor">                                                                                  \</span>
00493 <span class="preprocessor">            HeapDebugBreak((FB));                                                 \</span>
00494 <span class="preprocessor">        }                                                                         \</span>
00495 <span class="preprocessor">    }                                                                             \</span>
00496 <span class="preprocessor">}</span>
00497 <span class="preprocessor"></span>
00498 <span class="comment">//</span>
00499 <span class="comment">//  This version of RtlpRemoveFreeBlock does no fill checking</span>
00500 <span class="comment">//</span>
00501 
<a name="l00502"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a19">00502</a> <span class="preprocessor">#define RtlpFastRemoveFreeBlock( H, FB )         \</span>
00503 <span class="preprocessor">{                                                \</span>
00504 <span class="preprocessor">    PLIST_ENTRY _EX_Blink;                       \</span>
00505 <span class="preprocessor">    PLIST_ENTRY _EX_Flink;                       \</span>
00506 <span class="preprocessor">                                                 \</span>
00507 <span class="preprocessor">    _EX_Flink = (FB)-&gt;FreeList.Flink;            \</span>
00508 <span class="preprocessor">    _EX_Blink = (FB)-&gt;FreeList.Blink;            \</span>
00509 <span class="preprocessor">                                                 \</span>
00510 <span class="preprocessor">    _EX_Blink-&gt;Flink = _EX_Flink;                \</span>
00511 <span class="preprocessor">    _EX_Flink-&gt;Blink = _EX_Blink;                \</span>
00512 <span class="preprocessor">                                                 \</span>
00513 <span class="preprocessor">    if ((_EX_Flink == _EX_Blink) &amp;&amp;              \</span>
00514 <span class="preprocessor">        ((FB)-&gt;Size &lt; HEAP_MAXIMUM_FREELISTS)) { \</span>
00515 <span class="preprocessor">                                                 \</span>
00516 <span class="preprocessor">        CLEAR_FREELIST_BIT( H, FB );             \</span>
00517 <span class="preprocessor">    }                                            \</span>
00518 <span class="preprocessor">}</span>
00519 <span class="preprocessor"></span>
00520 <span class="comment">//</span>
00521 <span class="comment">//  This version of RtlpRemoveFreeBlock only works for dedicated free lists</span>
00522 <span class="comment">//  (where we know that (FB)-&gt;Mask != 0) and doesn't do any fill checking</span>
00523 <span class="comment">//</span>
00524 
<a name="l00525"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a20">00525</a> <span class="preprocessor">#define RtlpFastRemoveDedicatedFreeBlock( H, FB ) \</span>
00526 <span class="preprocessor">{                                                 \</span>
00527 <span class="preprocessor">    PLIST_ENTRY _EX_Blink;                        \</span>
00528 <span class="preprocessor">    PLIST_ENTRY _EX_Flink;                        \</span>
00529 <span class="preprocessor">                                                  \</span>
00530 <span class="preprocessor">    _EX_Flink = (FB)-&gt;FreeList.Flink;             \</span>
00531 <span class="preprocessor">    _EX_Blink = (FB)-&gt;FreeList.Blink;             \</span>
00532 <span class="preprocessor">                                                  \</span>
00533 <span class="preprocessor">    _EX_Blink-&gt;Flink = _EX_Flink;                 \</span>
00534 <span class="preprocessor">    _EX_Flink-&gt;Blink = _EX_Blink;                 \</span>
00535 <span class="preprocessor">                                                  \</span>
00536 <span class="preprocessor">    if (_EX_Flink == _EX_Blink) {                 \</span>
00537 <span class="preprocessor">                                                  \</span>
00538 <span class="preprocessor">        CLEAR_FREELIST_BIT( H, FB );              \</span>
00539 <span class="preprocessor">    }                                             \</span>
00540 <span class="preprocessor">}</span>
00541 <span class="preprocessor"></span>
00542 <span class="comment">//</span>
00543 <span class="comment">//  This version of RtlpRemoveFreeBlock only works for dedicated free lists</span>
00544 <span class="comment">//  (where we know that (FB)-&gt;Mask == 0) and doesn't do any fill checking</span>
00545 <span class="comment">//</span>
00546 
<a name="l00547"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a21">00547</a> <span class="preprocessor">#define RtlpFastRemoveNonDedicatedFreeBlock( H, FB ) \</span>
00548 <span class="preprocessor">{                                                    \</span>
00549 <span class="preprocessor">    RemoveEntryList(&amp;(FB)-&gt;FreeList)                 \</span>
00550 <span class="preprocessor">}</span>
00551 <span class="preprocessor"></span>
00552 
00553 <span class="comment">//</span>
00554 <span class="comment">//  Heap tagging routines implemented in heapdll.c</span>
00555 <span class="comment">//</span>
00556 
00557 <span class="preprocessor">#if DBG</span>
00558 <span class="preprocessor"></span>
00559 <span class="preprocessor">#define IS_HEAP_TAGGING_ENABLED() (TRUE)</span>
00560 <span class="preprocessor"></span>
00561 <span class="preprocessor">#else</span>
00562 <span class="preprocessor"></span>
<a name="l00563"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a22">00563</a> <span class="preprocessor">#define IS_HEAP_TAGGING_ENABLED() (RtlGetNtGlobalFlags() &amp; FLG_HEAP_ENABLE_TAGGING)</span>
00564 <span class="preprocessor"></span>
00565 <span class="preprocessor">#endif // DBG</span>
00566 <span class="preprocessor"></span>
00567 <span class="comment">//</span>
00568 <span class="comment">//  ORDER IS IMPORTANT HERE...SEE RtlpUpdateTagEntry sources</span>
00569 <span class="comment">//</span>
00570 
<a name="l00571"></a><a class="code" href="../../d9/d9/heappriv_8h.html#a60">00571</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d9/d9/heappriv_8h.html#a60">_HEAP_TAG_ACTION</a> {
00572 
00573     <a class="code" href="../../d9/d9/heappriv_8h.html#a60a27">AllocationAction</a>,
00574     <a class="code" href="../../d9/d9/heappriv_8h.html#a60a28">VirtualAllocationAction</a>,
00575     <a class="code" href="../../d9/d9/heappriv_8h.html#a60a29">FreeAction</a>,
00576     <a class="code" href="../../d9/d9/heappriv_8h.html#a60a30">VirtualFreeAction</a>,
00577     <a class="code" href="../../d9/d9/heappriv_8h.html#a60a31">ReAllocationAction</a>,
00578     <a class="code" href="../../d9/d9/heappriv_8h.html#a60a32">VirtualReAllocationAction</a>
00579 
00580 } <a class="code" href="../../d9/d9/heappriv_8h.html#a24">HEAP_TAG_ACTION</a>;
00581 
00582 PWSTR
00583 <a class="code" href="../../d9/d9/heappriv_8h.html#a51">RtlpGetTagName</a> (
00584     <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00585     USHORT TagIndex
00586     );
00587 
00588 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>
00589 <a class="code" href="../../d9/d9/heappriv_8h.html#a52">RtlpUpdateTagEntry</a> (
00590     <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap,
00591     USHORT TagIndex,
00592     SIZE_T OldSize,      <span class="comment">// Only valid for ReAllocation and Free actions</span>
00593     SIZE_T NewSize,      <span class="comment">// Only valid for ReAllocation and Allocation actions</span>
00594     HEAP_TAG_ACTION Action
00595     );
00596 
00597 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00598 <a class="code" href="../../d9/d9/heappriv_8h.html#a53">RtlpResetTags</a> (
00599     <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap
00600     );
00601 
00602 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00603 <a class="code" href="../../d9/d9/heappriv_8h.html#a54">RtlpDestroyTags</a> (
00604     <a class="code" href="../../d5/d5/struct__HEAP.html">PHEAP</a> Heap
00605     );
00606 
00607 
00608 <span class="comment">//</span>
00609 <span class="comment">// Define heap lookaside list allocation functions.</span>
00610 <span class="comment">//</span>
00611 
<a name="l00612"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html">00612</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html">_HEAP_LOOKASIDE</a> {
<a name="l00613"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o0">00613</a>     <a class="code" href="../../d9/d3/union__SLIST__HEADER.html">SLIST_HEADER</a> <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o0">ListHead</a>;
00614 
<a name="l00615"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o1">00615</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o1">Depth</a>;
<a name="l00616"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o2">00616</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o2">MaximumDepth</a>;
00617 
<a name="l00618"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o3">00618</a>     ULONG <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o3">TotalAllocates</a>;
<a name="l00619"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o4">00619</a>     ULONG <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o4">AllocateMisses</a>;
<a name="l00620"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o5">00620</a>     ULONG <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o5">TotalFrees</a>;
<a name="l00621"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o6">00621</a>     ULONG <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o6">FreeMisses</a>;
00622 
<a name="l00623"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o7">00623</a>     ULONG <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o7">LastTotalAllocates</a>;
<a name="l00624"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o8">00624</a>     ULONG <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o8">LastAllocateMisses</a>;
00625 
<a name="l00626"></a><a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o9">00626</a>     ULONG <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html#o9">Future</a>[2];
00627 
00628 } <a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html">HEAP_LOOKASIDE</a>, *<a class="code" href="../../d6/d6/struct__HEAP__LOOKASIDE.html">PHEAP_LOOKASIDE</a>;
00629 
00630 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00631 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00632 <a class="code" href="../../d0/d6/rtl_2lookasid_8c.html#a2">RtlpInitializeHeapLookaside</a> (
00633     IN PHEAP_LOOKASIDE Lookaside,
00634     IN USHORT Depth
00635     );
00636 
00637 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00638 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00639 <a class="code" href="../../d0/d6/rtl_2lookasid_8c.html#a3">RtlpDeleteHeapLookaside</a> (
00640     IN PHEAP_LOOKASIDE Lookaside
00641     );
00642 
00643 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00644 <a class="code" href="../../d0/d6/rtl_2lookasid_8c.html#a4">RtlpAdjustHeapLookasideDepth</a> (
00645     IN PHEAP_LOOKASIDE Lookaside
00646     );
00647 
00648 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00649 PVOID
00650 <a class="code" href="../../d0/d6/rtl_2lookasid_8c.html#a5">RtlpAllocateFromHeapLookaside</a> (
00651     IN PHEAP_LOOKASIDE Lookaside
00652     );
00653 
00654 <a class="code" href="../../d0/d9/ntosdef_8h.html#a29">NTKERNELAPI</a>
00655 BOOLEAN
00656 <a class="code" href="../../d0/d6/rtl_2lookasid_8c.html#a6">RtlpFreeToHeapLookaside</a> (
00657     IN PHEAP_LOOKASIDE Lookaside,
00658     IN PVOID Entry
00659     );
00660 
00661 <span class="preprocessor">#endif // _RTL_HEAP_PRIVATE_</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:16 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
