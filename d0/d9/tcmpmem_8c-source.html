<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: tcmpmem.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>tcmpmem.c</h1><a href="../../d9/d9/tcmpmem_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1993  Digital Equipment Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    tcmpmem.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implements a test of the operation of the RtlCompareMemory</span>
00012 <span class="comment">    function by running an exhaustive test of every case of string offset,</span>
00013 <span class="comment">    compare length, and return value up to and a little beyond one 32-byte</span>
00014 <span class="comment">    cache line. This represents over one million test cases. It is assumed</span>
00015 <span class="comment">    any bugs that exist will be found within this range. If only the error</span>
00016 <span class="comment">    count summary is desired, type "tcmpmem &gt; nul" instead.</span>
00017 <span class="comment"></span>
00018 <span class="comment">Author:</span>
00019 <span class="comment"></span>
00020 <span class="comment">    Thomas Van Baak (tvb) 11-Jan-1993</span>
00021 <span class="comment"></span>
00022 <span class="comment">Environment:</span>
00023 <span class="comment"></span>
00024 <span class="comment">    User mode.</span>
00025 <span class="comment"></span>
00026 <span class="comment">Revision History:</span>
00027 <span class="comment"></span>
00028 <span class="comment">--*/</span>
00029 
00030 <span class="preprocessor">#include &lt;nt.h&gt;</span>
00031 <span class="preprocessor">#include &lt;ntrtl.h&gt;</span>
00032 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00033 <span class="preprocessor">#include "<a class="code" href="../../d0/d5/localrtl_8h.html">localrtl.h</a>"</span>
00034 
<a name="l00035"></a><a class="code" href="../../d9/d9/tcmpmem_8c.html#a0">00035</a> <span class="preprocessor">#define BUFFER_SIZE (MAX_OFFSET + MAX_LENGTH)</span>
00036 <span class="preprocessor"></span>
<a name="l00037"></a><a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">00037</a> UCHAR <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>[<a class="code" href="../../d9/d9/tcmpmem_8c.html#a0">BUFFER_SIZE</a>];
<a name="l00038"></a><a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">00038</a> UCHAR <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>[<a class="code" href="../../d9/d9/tcmpmem_8c.html#a0">BUFFER_SIZE</a>];
00039 
00040 <span class="keywordtype">void</span>
00041 __cdecl
<a name="l00042"></a><a class="code" href="../../d9/d9/tcmpmem_8c.html#a3">00042</a> <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>()
00043 {
00044     ULONG ErrorCount;
00045     ULONG Expected;
00046     ULONG Length;
00047     ULONG Offset1;
00048     ULONG Offset2;
00049     ULONG Result;
00050     ULONG TestCases;
00051 
00052     fprintf(stderr, <span class="stringliteral">"Testing RtlCompareMemory\n"</span>);
00053     ErrorCount = 0;
00054     TestCases = 0;
00055 
00056     <span class="keywordflow">for</span> (Offset1 = 0; Offset1 &lt;= <a class="code" href="../../d0/d5/localrtl_8h.html#a1">MAX_OFFSET</a>; Offset1 += 1) {
00057 
00058         <span class="comment">//</span>
00059         <span class="comment">// Copy the test pattern to Offset1 in String1 and then for each</span>
00060         <span class="comment">// possible offset of String1, for each possible offset of String2,</span>
00061         <span class="comment">// for each possible string compare length, and for each expected</span>
00062         <span class="comment">// return value, make a call RtlCompareMemory.</span>
00063         <span class="comment">//</span>
00064 
00065         <a class="code" href="../../d0/d5/localrtl_8h.html#a9">FillPattern</a>(&amp;<a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>[Offset1], <a class="code" href="../../d0/d5/localrtl_8h.html#a2">MAX_LENGTH</a>);
00066         <span class="keywordflow">for</span> (Offset2 = 0; Offset2 &lt;= <a class="code" href="../../d0/d5/localrtl_8h.html#a1">MAX_OFFSET</a>; Offset2 += 1) {
00067             <span class="keywordflow">for</span> (Length = 0; Length &lt;= <a class="code" href="../../d0/d5/localrtl_8h.html#a2">MAX_LENGTH</a>; Length += 1) {
00068                 <span class="keywordflow">for</span> (Expected = 0; Expected &lt;= Length; Expected += 1) {
00069 
00070                     <span class="comment">//</span>
00071                     <span class="comment">// Copy the test pattern starting at Offset2 in String2,</span>
00072                     <span class="comment">// change one byte at location `Expected', call</span>
00073                     <span class="comment">// RtlCompareMemory, and check that the function value</span>
00074                     <span class="comment">// is in fact the expected value.</span>
00075                     <span class="comment">//</span>
00076 
00077                     <a class="code" href="../../d0/d5/localrtl_8h.html#a9">FillPattern</a>(&amp;<a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>[Offset2], <a class="code" href="../../d0/d5/localrtl_8h.html#a2">MAX_LENGTH</a>);
00078                     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>[Offset2 + Expected] = <span class="charliteral">' '</span>;
00079                     Result = RtlCompareMemory(&amp;<a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>[Offset1],
00080                                               &amp;<a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>[Offset2],
00081                                               Length);
00082                     TestCases += 1;
00083                     <span class="keywordflow">if</span> (Result != Expected) {
00084                         ErrorCount += 1;
00085 
00086                         <span class="comment">//</span>
00087                         <span class="comment">// The function failed to return the proper value.</span>
00088                         <span class="comment">//</span>
00089 
00090                         printf(<span class="stringliteral">"ERROR: Offset1 = %d, Offset2 = %d, Length = %d, Expected = %d, Result = %d\n"</span>,
00091                                Offset1, Offset2, Length, Expected, Result);
00092                         printf(<span class="stringliteral">"  String1[Offset1] = %lx: &lt;%.*s&gt;\n"</span>,
00093                                &amp;<a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>[Offset1], Length, &amp;<a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>[Offset1]);
00094                         printf(<span class="stringliteral">"  String2[Offset2] = %lx: &lt;%.*s&gt;\n"</span>,
00095                                &amp;<a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>[Offset2], Length, &amp;<a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>[Offset2]);
00096                         printf(<span class="stringliteral">"\n"</span>);
00097                     }
00098                 }
00099             }
00100         }
00101     }
00102 
00103     fprintf(stderr, <span class="stringliteral">"Test of RtlCompareMemory completed: "</span>);
00104     fprintf(stderr, <span class="stringliteral">"%d test cases, %d errors found.\n"</span>, TestCases, ErrorCount);
00105 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:57 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
