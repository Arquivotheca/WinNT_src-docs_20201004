<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: urtl.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>urtl.c</h1><a href="../../d9/d9/urtl_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    urtl.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Usermode test program for rtl</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Mark Lucovsky (markl) 22-Aug-1989</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#include &lt;nt.h&gt;</span>
00022 <span class="preprocessor">#include &lt;ntrtl.h&gt;</span>
00023 <span class="preprocessor">#include &lt;nturtl.h&gt;</span>
00024 
<a name="l00025"></a><a class="code" href="../../d9/d9/urtl_8c.html#a0">00025</a> PVOID <a class="code" href="../../d7/d8/uexec_8c.html#a0">MyHeap</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00026 
<a name="l00027"></a><a class="code" href="../../d9/d9/urtl_8c.html#a1">00027</a> <a class="code" href="../../d9/d9/urtl_8c.html#a1">DumpIt</a>(
00028     IN PRTL_USER_PROCESS_PARAMETERS ArgBase
00029     )
00030 {
00031     ULONG Base;
00032     PSTRING Vector;
00033     PCH *ParmVector;
00034     ULONG i;
00035 
00036     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) RtlNormalizeProcessParameters( ArgBase );
00037     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) RtlDeNormalizeProcessParameters( ArgBase );
00038 
00039     Base = (ULONG) ArgBase;
00040 
00041     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: ArgBase       %lx\n"</span>,ArgBase);
00042     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: MaximumLength %lx\n"</span>,ArgBase-&gt;MaximumLength);
00043     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: Length        %lx\n"</span>,ArgBase-&gt;Length);
00044     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: ArgumentCount %lx\n"</span>,ArgBase-&gt;ArgumentCount);
00045     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: Arguments     %lx\n"</span>,ArgBase-&gt;Arguments    );
00046     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: VariableCount %lx\n"</span>,ArgBase-&gt;VariableCount);
00047     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: Variables     %lx\n"</span>,ArgBase-&gt;Variables    );
00048     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: ParameterCount%lx\n"</span>,ArgBase-&gt;ParameterCount);
00049     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: Parameters    %lx\n"</span>,ArgBase-&gt;Parameters    );
00050 
00051     <span class="keywordflow">if</span> ( ArgBase-&gt;ArgumentCount ) {
00052         Vector = (PSTRING)((PCH)ArgBase-&gt;Arguments + Base);
00053         i = ArgBase-&gt;ArgumentCount;
00054         <span class="keywordflow">while</span>(i--){
00055             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: Argument %s\n"</span>,Vector-&gt;Buffer + Base);
00056             Vector++;
00057         }
00058     }
00059 
00060     <span class="keywordflow">if</span> ( ArgBase-&gt;VariableCount ) {
00061         Vector = (PSTRING)((PCH)ArgBase-&gt;Variables + Base);
00062         i = ArgBase-&gt;VariableCount;
00063         <span class="keywordflow">while</span>(i--){
00064             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: Variable %s\n"</span>,Vector-&gt;Buffer + Base);
00065             Vector++;
00066         }
00067     }
00068 
00069     <span class="keywordflow">if</span> ( ArgBase-&gt;ParameterCount ) {
00070         ParmVector = (PCH *)((PCH)ArgBase-&gt;Parameters + Base);
00071         i = ArgBase-&gt;ParameterCount;
00072         <span class="keywordflow">while</span>(i--) {
00073             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DumpIt: Parameter %s\n"</span>,*ParmVector + Base);
00074             ParmVector++;
00075         }
00076     }
00077 }
00078 
00079 BOOLEAN
<a name="l00080"></a><a class="code" href="../../d9/d9/urtl_8c.html#a2">00080</a> <a class="code" href="../../d9/d9/urtl_8c.html#a2">VectorTest</a>(
00081     IN PCH Arguments[],
00082     IN PCH Variables[],
00083     IN PCH Parameters[]
00084     )
00085 {
00086 
00087     PRTL_USER_PROCESS_PARAMETERS ProcessParameters;
00088     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00089 
00090     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"VectorTest:++\n"</span>);
00091 
00092     ProcessParameters = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>(<a class="code" href="../../d7/d8/uexec_8c.html#a0">MyHeap</a>, 0, 2048);
00093     ProcessParameters-&gt;MaximumLength = 2048;
00094 
00095     st = RtlVectorsToProcessParameters(
00096             Arguments,
00097             Variables,
00098             Parameters,
00099             ProcessParameters
00100             );
00101 
00102     <a class="code" href="../../d9/d9/urtl_8c.html#a1">DumpIt</a>(ProcessParameters);
00103 
00104     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"VectorTest:--\n"</span>);
00105 
00106     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00107 }
00108 
00109 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00110"></a><a class="code" href="../../d9/d9/urtl_8c.html#a3">00110</a> <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(
00111     IN ULONG argc,
00112     IN PCH argv[],
00113     IN PCH envp[],
00114     IN ULONG DebugParameter OPTIONAL
00115     )
00116 
00117 {
00118     ULONG i;
00119     <span class="keywordtype">char</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>, *s;
00120     PCH *Arguments;
00121     PCH *Variables;
00122     PCH Parameters[ RTL_USER_PROC_PARAMS_DEBUGFLAG+2 ];
00123 
00124     ULONG TestVector = 0;
00125 
00126     Arguments = argv;
00127     Variables = envp;
00128     Parameters[ RTL_USER_PROC_PARAMS_IMAGEFILE ] =
00129          <span class="stringliteral">"Full Path Specification of Image File goes here"</span>;
00130 
00131     Parameters[ RTL_USER_PROC_PARAMS_CMDLINE ] =
00132          <span class="stringliteral">"Complete Command Line goes here"</span>;
00133 
00134     Parameters[ RTL_USER_PROC_PARAMS_DEBUGFLAG ] =
00135          <span class="stringliteral">"Debugging String goes here"</span>;
00136 
00137     Parameters[ RTL_USER_PROC_PARAMS_DEBUGFLAG+1 ] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00138 
00139     <a class="code" href="../../d7/d8/uexec_8c.html#a0">MyHeap</a> = RtlProcessHeap();
00140 
00141 
00142 <span class="preprocessor">#if DBG</span>
00143 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Entering URTL User Mode Test Program\n"</span> );
00144     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"argc = %ld\n"</span>, argc );
00145     <span class="keywordflow">for</span> (i=0; i&lt;=argc; i++) {
00146         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"argv[ %ld ]: %s\n"</span>,
00147                   i,
00148                   argv[ i ] ? argv[ i ] : <span class="stringliteral">"&lt;NULL&gt;"</span>
00149                 );
00150         }
00151     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"\n"</span> );
00152     <span class="keywordflow">for</span> (i=0; envp[i]; i++) {
00153         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"envp[ %ld ]: %s\n"</span>, i, envp[ i ] );
00154         }
00155 <span class="preprocessor">#endif</span>
00156 <span class="preprocessor"></span>    i = 1;
00157     <span class="keywordflow">if</span> (argc &gt; 1 ) {
00158         <span class="keywordflow">while</span> (--argc) {
00159             s = *++argv;
00160             <span class="keywordflow">while</span> ((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = *s++) != <span class="charliteral">'\0'</span>) {
00161                 <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>) {
00162 
00163                 <span class="keywordflow">case</span> <span class="charliteral">'V'</span>:
00164                 <span class="keywordflow">case</span> <span class="charliteral">'v'</span>:
00165                     TestVector = i++;
00166                     <span class="keywordflow">break</span>;
00167                 <span class="keywordflow">default</span>:
00168                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"urtl: invalid test code - '%s'"</span>, *argv );
00169                     <span class="keywordflow">break</span>;
00170                 }
00171             }
00172         }
00173     }
00174 
00175     <span class="keywordflow">if</span> ( TestVector ) {
00176         <a class="code" href="../../d9/d9/urtl_8c.html#a2">VectorTest</a>(Arguments,Variables,Parameters);
00177     }
00178 
00179     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00180 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:11 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
