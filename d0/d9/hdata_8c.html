<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: hdata.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>hdata.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d1/d8/hdata_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a0">DDEMLDB</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HDDEDATA&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a1">DdeCreateDataHandle</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idInst, LPBYTE pSrc, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOff, HSZ hszItem, UINT wFmt, UINT afCmd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HDDEDATA&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a2">InternalCreateDataHandle</a> (<a class="el" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii, LPBYTE pSrc, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOff, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> flags, WORD wStatus, WORD wFmt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HDDEDATA&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a3">DdeAddData</a> (HDDEDATA hData, LPBYTE pSrc, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOff)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a4">DdeGetData</a> (HDDEDATA hData, LPBYTE pDst, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbMax, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOff)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LPBYTE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a5">DdeAccessData</a> (HDDEDATA hData, LPDWORD pcbDataSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a6">DdeUnaccessData</a> (HDDEDATA hData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a7">DdeFreeDataHandle</a> (HDDEDATA hData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a8">InternalFreeDataHandle</a> (HDDEDATA hData, BOOL fIgnorefRelease)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a9">ApplyFreeDataHandle</a> (HANDLE hData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a> (HANDLE hDDE, BOOL fIgnorefRelease, BOOL fFreeTruelyGlobalObjects)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HBITMAP&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a11">CopyBitmap</a> (HBITMAP hbm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HPALETTE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a12">CopyPalette</a> (HPALETTE hpal)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/hdata_8c.html#a13">CopyDDEData</a> (HANDLE hDDE, BOOL fIsExecute)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="hdata.c::DDEMLDB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DDEMLDB          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00012">12</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a9" doxytag="hdata.c::ApplyFreeDataHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ApplyFreeDataHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hData</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00451">451</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00059">CheckDDECritOut</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00416">InternalFreeDataHandle()</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ddemlcli_8c-source.html#l00196">DdeUninitialize()</a>.
<p>
<pre class="fragment"><div>00453 {
00454     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet;
00455 
00456     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a9">CheckDDECritOut</a>;
00457     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00458     fRet = <a class="code" href="../../d0/d9/hdata_8c.html#a8">InternalFreeDataHandle</a>((HDDEDATA)hData, FALSE);
00459     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00460     <span class="keywordflow">return</span>(fRet);
00461 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="hdata.c::CopyBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HBITMAP CopyBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HBITMAP&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hbm</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00579">579</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06624">NtUserGetDC()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01556">NtUserReleaseDC</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d8/hdata_8c-source.html#l00660">CopyDDEData()</a>.
<p>
<pre class="fragment"><div>00581 {
00582     BITMAP bm;
00583     HBITMAP hbm2, hbmOld1, hbmOld2;
00584     HDC hdc, hdcMem1, hdcMem2;
00585 
00586     <span class="keywordflow">if</span> (!GetObject(hbm, <span class="keyword">sizeof</span>(BITMAP), &amp;bm)) {
00587         <span class="keywordflow">return</span>(0);
00588     }
00589     hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a250">NtUserGetDC</a>(NULL);  <span class="comment">// screen DC</span>
00590     <span class="keywordflow">if</span> (!hdc) {
00591         <span class="keywordflow">return</span>(0);
00592     }
00593     hdcMem1 = CreateCompatibleDC(hdc);
00594     <span class="keywordflow">if</span> (!hdcMem1) {
00595         <span class="keywordflow">goto</span> Cleanup3;
00596     }
00597     hdcMem2 = CreateCompatibleDC(hdc);
00598     <span class="keywordflow">if</span> (!hdcMem2) {
00599         <span class="keywordflow">goto</span> Cleanup2;
00600     }
00601     hbmOld1 = SelectObject(hdcMem1, hbm);
00602     hbm2 = CreateCompatibleBitmap(hdcMem1, bm.bmWidth, bm.bmHeight);
00603     <span class="keywordflow">if</span> (!hbm2) {
00604         <span class="keywordflow">goto</span> Cleanup1;
00605     }
00606     hbmOld2 = SelectObject(hdcMem2, hbm2);
00607     BitBlt(hdcMem2, 0, 0, bm.bmWidth, bm.bmHeight, hdcMem1, 0, 0, SRCCOPY);
00608     SelectObject(hdcMem1, hbmOld1);
00609     SelectObject(hdcMem2, hbmOld2);
00610 Cleanup1:
00611     DeleteDC(hdcMem2);
00612 Cleanup2:
00613     DeleteDC(hdcMem1);
00614 Cleanup3:
00615     <a class="code" href="../../d6/d0/usercli_8h.html#a211">NtUserReleaseDC</a>(NULL, hdc);
00616     <span class="keywordflow">return</span>(hbm2);
00617 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="hdata.c::CopyDDEData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE CopyDDEData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hDDE</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fIsExecute</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00660">660</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d1/d8/hdata_8c-source.html#l00579">CopyBitmap()</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00620">CopyPalette()</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00020">tagDDE_DATA::Data</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00125">UserGlobalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00124">UserGlobalFree</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00130">UserGlobalSize</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00019">tagDDE_DATA::wFmt</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/xact_8c-source.html#l00024">DdeClientTransaction()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01207">SvSpontRequest()</a>.
<p>
<pre class="fragment"><div>00663 {
00664     HANDLE hDDENew;
00665     <a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a> pdde, pddeNew;
00666     LPMETAFILEPICT pmfPict;
00667     HANDLE hmfPict;
00668 
00669     hDDENew = <a class="code" href="../../d6/d0/usercli_8h.html#a3">UserGlobalAlloc</a>(GMEM_DDESHARE | GMEM_MOVEABLE,
00670             <a class="code" href="../../d6/d0/usercli_8h.html#a6">UserGlobalSize</a>(hDDE));
00671     <span class="keywordflow">if</span> (!hDDENew) {
00672         <span class="keywordflow">return</span> (0);
00673     }
00674     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDE, pdde);
00675     <span class="keywordflow">if</span> (pdde == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00676         <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>(hDDENew);
00677         <span class="keywordflow">return</span> (0);
00678     }
00679     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDENew, pddeNew);
00680     UserAssert(pddeNew);
00681     RtlCopyMemory(pddeNew, pdde, <a class="code" href="../../d6/d0/usercli_8h.html#a6">UserGlobalSize</a>(hDDE));
00682 
00683     <span class="keywordflow">if</span> (!fIsExecute) {
00684         <span class="keywordflow">switch</span> (pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o1">wFmt</a>) {
00685         <span class="keywordflow">case</span> CF_BITMAP:
00686         <span class="keywordflow">case</span> CF_DSPBITMAP:
00687             pddeNew-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> = (ULONG_PTR)<a class="code" href="../../d0/d9/hdata_8c.html#a11">CopyBitmap</a>((HBITMAP)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>);
00688             <span class="keywordflow">break</span>;
00689 
00690         <span class="keywordflow">case</span> CF_PALETTE:
00691             pddeNew-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> = (ULONG_PTR)<a class="code" href="../../d0/d9/hdata_8c.html#a12">CopyPalette</a>((HPALETTE)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>);
00692             <span class="keywordflow">break</span>;
00693 
00694         <span class="keywordflow">case</span> CF_DIB:
00695             pddeNew-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> = (ULONG_PTR)<a class="code" href="../../d0/d9/hdata_8c.html#a13">CopyDDEData</a>((HANDLE)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>, TRUE);
00696             <span class="keywordflow">break</span>;
00697 
00698         <span class="keywordflow">case</span> CF_METAFILEPICT:
00699         <span class="keywordflow">case</span> CF_DSPMETAFILEPICT:
00700             hmfPict = <a class="code" href="../../d0/d9/hdata_8c.html#a13">CopyDDEData</a>((HANDLE)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>, TRUE);
00701             <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hmfPict, pmfPict);
00702             <span class="keywordflow">if</span> (pmfPict == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00703                 <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(hmfPict);
00704                 <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDENew);
00705                 <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(hDDENew);
00706                 <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
00707                 <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00708             }
00709             pmfPict-&gt;hMF = CopyMetaFile(pmfPict-&gt;hMF, NULL);
00710             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hmfPict);
00711             pddeNew-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> = (ULONG_PTR)hmfPict;
00712             <span class="keywordflow">break</span>;
00713 
00714         <span class="keywordflow">case</span> CF_ENHMETAFILE:
00715         <span class="keywordflow">case</span> CF_DSPENHMETAFILE:
00716             pddeNew-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> = (ULONG_PTR)CopyEnhMetaFile((HANDLE)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>, NULL);
00717             <span class="keywordflow">break</span>;
00718         }
00719     }
00720     <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDENew);
00721     <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
00722     <span class="keywordflow">return</span> (hDDENew);
00723 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="hdata.c::CopyPalette" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HPALETTE CopyPalette           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HPALETTE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hpal</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00620">620</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00016">DDEMLAlloc</a>, and <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>.
<p>
Referenced by <a class="el" href="../../d1/d8/hdata_8c-source.html#l00660">CopyDDEData()</a>.
<p>
<pre class="fragment"><div>00622 {
00623     <span class="keywordtype">int</span> cPalEntries;
00624     LOGPALETTE *plp;
00625 
00626     <span class="keywordflow">if</span> (!GetObject(hpal, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), &amp;cPalEntries)) {
00627         <span class="keywordflow">return</span>(0);
00628     }
00629     plp = (LOGPALETTE *)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a0">DDEMLAlloc</a>(<span class="keyword">sizeof</span>(LOGPALETTE) +
00630             (cPalEntries - 1) * <span class="keyword">sizeof</span>(PALETTEENTRY));
00631     <span class="keywordflow">if</span> (!plp) {
00632         <span class="keywordflow">return</span>(0);
00633     }
00634     <span class="keywordflow">if</span> (!GetPaletteEntries(hpal, 0, cPalEntries, plp-&gt;palPalEntry)) {
00635         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(plp);
00636         <span class="keywordflow">return</span>(0);
00637     }
00638     plp-&gt;palVersion = 0x300;
00639     plp-&gt;palNumEntries = (WORD)cPalEntries;
00640     hpal = CreatePalette(plp);
00641     <span class="keywordflow">if</span> (hpal  &amp;&amp;
00642             !SetPaletteEntries(hpal, 0, cPalEntries, plp-&gt;palPalEntry)) {
00643         hpal = 0;
00644     }
00645     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(plp);
00646     <span class="keywordflow">return</span>(hpal);
00647 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="hdata.c::DdeAccessData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LPBYTE DdeAccessData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDDEDATA&nbsp;</td>
          <td class="mdname" nowrap> <em>hData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pcbDataSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00304">304</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00257">tagDDEMLDATA::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00256">tagDDEMLDATA::hDDE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00112">HINST_ANY</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00108">HTYPE_DATA_HANDLE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00226">PciiFromHandle()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00130">UserGlobalSize</a>, and <a class="el" href="../../d4/d7/handles_8c-source.html#l00204">ValidateCHandle()</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00059">ProcessDDEMLInitiate()</a>.
<p>
<pre class="fragment"><div>00307 {
00308     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00309     <a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a> pdd;
00310     LPBYTE pRet = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00311     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOff;
00312 
00313     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00314 
00315     pdd = (<a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)hData,
00316             HTYPE_DATA_HANDLE, HINST_ANY);
00317     <span class="keywordflow">if</span> (pdd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00318         <span class="keywordflow">goto</span> Exit;
00319     }
00320     pcii = <a class="code" href="../../d3/d8/handles_8c.html#a11">PciiFromHandle</a>((HANDLE)hData);
00321     cbOff = pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; HDATA_EXECUTE ? 0 : 4;
00322     <span class="keywordflow">if</span> (pcbDataSize != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00323         *pcbDataSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a6">UserGlobalSize</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>) - cbOff;
00324     }
00325     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>, pRet);
00326     UserAssert(pRet);
00327     pRet = (LPBYTE)pRet + cbOff;
00328 
00329 Exit:
00330     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00331     <span class="keywordflow">return</span> (pRet);
00332 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="hdata.c::DdeAddData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HDDEDATA DdeAddData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDDEDATA&nbsp;</td>
          <td class="mdname" nowrap> <em>hData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>pSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cbOff</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00166">166</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d4/d7/handles_8c-source.html#l00336">BestSetLastDDEMLError()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00257">tagDDEMLDATA::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00256">tagDDEMLDATA::hDDE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00112">HINST_ANY</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00108">HTYPE_DATA_HANDLE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00226">PciiFromHandle()</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00129">UserGlobalReAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00130">UserGlobalSize</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, and <a class="el" href="../../d4/d7/handles_8c-source.html#l00204">ValidateCHandle()</a>.
<p>
<pre class="fragment"><div>00171 {
00172     LPSTR pMem;
00173     <a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a> pdd;
00174     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00175     HDDEDATA hRet = 0;
00176 
00177     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00178 
00179     pdd = (<a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)hData, HTYPE_DATA_HANDLE, HINST_ANY);
00180     <span class="keywordflow">if</span> (pdd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00181         <span class="keywordflow">goto</span> Exit;
00182     }
00183     pcii = <a class="code" href="../../d3/d8/handles_8c.html#a11">PciiFromHandle</a>((HANDLE)hData);
00184     <span class="keywordflow">if</span> (pcii == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00185         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00186         <span class="keywordflow">goto</span> Exit;
00187     }
00188     <span class="keywordflow">if</span> (!(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; HDATA_EXECUTE)) {
00189         cbOff += 4;
00190     }
00191     <span class="keywordflow">if</span> (cb + cbOff &gt; <a class="code" href="../../d6/d0/usercli_8h.html#a6">UserGlobalSize</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>)) {
00192         pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a5">UserGlobalReAlloc</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>, cb + cbOff,
00193                 GMEM_MOVEABLE | GMEM_ZEROINIT);
00194     }
00195 
00196     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>, pMem);
00197 
00198     <span class="keywordflow">if</span> (pMem == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00199         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_MEMORY_ERROR);
00200         <span class="keywordflow">goto</span> Exit;
00201     }
00202 
00203     hRet = hData;
00204 
00205     <span class="keywordflow">if</span> (pSrc != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00206         <span class="keywordflow">try</span> {
00207             RtlCopyMemory(pMem + cbOff, pSrc, cb);
00208             pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> |= HDATA_INITIALIZED;
00209         } except(W32ExceptionHandler(FALSE, RIP_WARNING)) {
00210             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00211             hRet = 0;
00212         }
00213     }
00214 
00215     <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>);
00216 
00217 Exit:
00218     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00219     <span class="keywordflow">return</span> (hRet);
00220 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="hdata.c::DdeCreateDataHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HDDEDATA DdeCreateDataHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>idInst</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>pSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cbOff</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HSZ&nbsp;</td>
          <td class="mdname" nowrap> <em>hszItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wFmt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>afCmd</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00025">25</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d4/d7/handles_8c-source.html#l00336">BestSetLastDDEMLError()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00094">InternalCreateDataHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, and <a class="el" href="../../d1/d3/instance_8c-source.html#l00111">ValidateInstance()</a>.
<p>
<pre class="fragment"><div>00033 {
00034     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00035     HDDEDATA hRet = 0;
00036 
00037     <span class="keywordflow">if</span> (cb == -1) {
00038         RIPMSG0(RIP_ERROR, <span class="stringliteral">"DdeCreateDataHandle called with cb == -1\n"</span>);
00039         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00040     }
00041 
00042     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00043 
00044     pcii = <a class="code" href="../../d0/d4/instance_8c.html#a7">ValidateInstance</a>((HANDLE)LongToHandle( idInst ));
00045     <span class="keywordflow">if</span> (pcii == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00046         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00047         <span class="keywordflow">goto</span> Exit;
00048     }
00049     <span class="keywordflow">if</span> (afCmd &amp; ~HDATA_APPOWNED) {
00050         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00051         <span class="keywordflow">goto</span> Exit;
00052     }
00053 
00054     <span class="keywordflow">if</span> (cb + cbOff &lt; <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) &amp;&amp; pSrc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
00055             (wFmt == CF_METAFILEPICT ||
00056              wFmt == CF_DSPMETAFILEPICT ||
00057              wFmt == CF_DIB ||
00058              wFmt == CF_BITMAP ||
00059              wFmt == CF_DSPBITMAP ||
00060              wFmt == CF_PALETTE ||
00061              wFmt == CF_ENHMETAFILE ||
00062              wFmt == CF_DSPENHMETAFILE)) {
00063         <span class="comment">/*</span>
00064 <span class="comment">         * We have the nasty possibility of blowing up in FreeDDEData if we</span>
00065 <span class="comment">         * don't initialize the data for formats with indirect data to 0.</span>
00066 <span class="comment">         * This is because GlobalLock/GlobalSize do not adequately validate</span>
00067 <span class="comment">         * random numbers given to them.</span>
00068 <span class="comment">         */</span>
00069         cb += 4;
00070     }
00071     hRet = <a class="code" href="../../d0/d9/hdata_8c.html#a2">InternalCreateDataHandle</a>(pcii, pSrc, cb, cbOff,
00072             hszItem ? afCmd : (afCmd | HDATA_EXECUTE),
00073             (WORD)((afCmd &amp; HDATA_APPOWNED) ? 0 : DDE_FRELEASE), (WORD)wFmt);
00074 
00075     <span class="keywordflow">if</span> (!hRet) {
00076         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_MEMORY_ERROR);
00077     }
00078 Exit:
00079     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00080     <span class="keywordflow">return</span> (hRet);
00081 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="hdata.c::DdeFreeDataHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DdeFreeDataHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDDEDATA&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hData</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00378">378</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00257">tagDDEMLDATA::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00112">HINST_ANY</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00108">HTYPE_DATA_HANDLE</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00416">InternalFreeDataHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d7/handles_8c-source.html#l00204">ValidateCHandle()</a>.
<p>
<pre class="fragment"><div>00380 {
00381     <a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a> pdd;
00382     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00383 
00384     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00385 
00386     pdd = (<a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)hData,
00387             HTYPE_DATA_HANDLE, HINST_ANY);
00388     <span class="keywordflow">if</span> (pdd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00389         <span class="keywordflow">goto</span> Exit;
00390     }
00391     <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; HDATA_NOAPPFREE) {
00392         fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00393         <span class="keywordflow">goto</span> Exit;
00394     }
00395 
00396     fSuccess = <a class="code" href="../../d0/d9/hdata_8c.html#a8">InternalFreeDataHandle</a>(hData, TRUE);
00397 
00398 Exit:
00399     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00400     <span class="keywordflow">return</span> (fSuccess);
00401 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="hdata.c::DdeGetData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> DdeGetData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDDEDATA&nbsp;</td>
          <td class="mdname" nowrap> <em>hData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>pDst</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cbMax</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cbOff</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00234">234</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d4/d7/handles_8c-source.html#l00336">BestSetLastDDEMLError()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00257">tagDDEMLDATA::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00256">tagDDEMLDATA::hDDE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00112">HINST_ANY</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00108">HTYPE_DATA_HANDLE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00226">PciiFromHandle()</a>, <a class="el" href="../../d1/d3/instance_8c-source.html#l00137">SetLastDDEMLError()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00130">UserGlobalSize</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, and <a class="el" href="../../d4/d7/handles_8c-source.html#l00204">ValidateCHandle()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00024">DoCallback()</a>.
<p>
<pre class="fragment"><div>00239 {
00240     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbCopied = 0;
00241     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbSize;
00242     <a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a> pdd;
00243     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00244 
00245     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00246 
00247     pdd = (<a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)hData,
00248             HTYPE_DATA_HANDLE, HINST_ANY);
00249     <span class="keywordflow">if</span> (pdd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00250         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00251         <span class="keywordflow">goto</span> Exit;
00252     }
00253     pcii = <a class="code" href="../../d3/d8/handles_8c.html#a11">PciiFromHandle</a>((HANDLE)hData);
00254     <span class="keywordflow">if</span> (pcii == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00255         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00256         <span class="keywordflow">goto</span> Exit;
00257     }
00258     <span class="keywordflow">if</span> (!(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; HDATA_EXECUTE)) {
00259         cbOff += 4;
00260     }
00261     cbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a6">UserGlobalSize</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>);
00262     <span class="keywordflow">if</span> (cbOff &gt;= cbSize) {
00263         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00264         <span class="keywordflow">goto</span> Exit;
00265     }
00266     <span class="keywordflow">if</span> (pDst == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00267         cbCopied = cbSize - cbOff;
00268         <span class="keywordflow">goto</span> Exit;
00269     } <span class="keywordflow">else</span> {
00270         LPSTR pMem;
00271 
00272         cbCopied = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cbMax, cbSize - cbOff);
00273         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>, pMem);
00274         UserAssert(pMem);
00275         <span class="keywordflow">try</span> {
00276             RtlCopyMemory(pDst, pMem + cbOff, cbCopied);
00277         } except(W32ExceptionHandler(FALSE, RIP_WARNING)) {
00278             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00279             cbCopied = 0;
00280         }
00281         <span class="keywordflow">if</span> (pMem != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00282             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>);
00283         }
00284     }
00285 
00286 Exit:
00287     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00288     <span class="keywordflow">return</span> (cbCopied);
00289 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="hdata.c::DdeUnaccessData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL DdeUnaccessData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDDEDATA&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hData</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00346">346</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00048">EnterDDECrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00256">tagDDEMLDATA::hDDE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00112">HINST_ANY</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00108">HTYPE_DATA_HANDLE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00049">LeaveDDECrit</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, and <a class="el" href="../../d4/d7/handles_8c-source.html#l00204">ValidateCHandle()</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00059">ProcessDDEMLInitiate()</a>.
<p>
<pre class="fragment"><div>00348 {
00349     <a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a> pdd;
00350     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00351 
00352     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00353 
00354     pdd = (<a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)hData,
00355             HTYPE_DATA_HANDLE, HINST_ANY);
00356     <span class="keywordflow">if</span> (pdd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00357         <span class="keywordflow">goto</span> Exit;
00358     }
00359     <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>);
00360     fSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00361 
00362 Exit:
00363     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00364     <span class="keywordflow">return</span> (fSuccess);
00365 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="hdata.c::FreeDDEData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeDDEData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hDDE</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fIgnorefRelease</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fFreeTruelyGlobalObjects</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00491">491</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00020">tagDDE_DATA::Data</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00019">tagDDE_DATA::wFmt</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00018">tagDDE_DATA::wStatus</a>.
<p>
Referenced by <a class="el" href="../../d5/d3/client_2ddetrack_8c-source.html#l00456">_ClientFreeDDEHandle()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01116">ClRespPokeAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01294">ClRespRequestData()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00362">ClSpontAdviseData()</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00024">DdeClientTransaction()</a>, <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00714">DumpDDEMessage()</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00416">InternalFreeDataHandle()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00470">SvRespAdviseDataAck()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01042">SvSpontPoke()</a>, and <a class="el" href="../../d4/d7/client_8c-source.html#l02696">UserRegisterWowHandlers()</a>.
<p>
<pre class="fragment"><div>00495 {
00496     <a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a> pdde;
00497     LPMETAFILEPICT pmfPict;
00498     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb;
00499 
00500     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hDDE, pdde);
00501     <span class="keywordflow">if</span> (pdde == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00502         <span class="keywordflow">return</span> ;
00503     }
00504 
00505     <span class="keywordflow">if</span> ((pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o0">wStatus</a> &amp; DDE_FRELEASE) || fIgnorefRelease) {
00506         cb = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)GlobalSize(hDDE);
00507         <span class="comment">/*</span>
00508 <span class="comment">         * Because there is the possibility that the data never got</span>
00509 <span class="comment">         * initialized we need to do this in a try-except so we</span>
00510 <span class="comment">         * behave nicely.</span>
00511 <span class="comment">         */</span>
00512         <span class="keywordflow">switch</span> (pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o1">wFmt</a>) {
00513         <span class="keywordflow">case</span> CF_BITMAP:
00514         <span class="keywordflow">case</span> CF_DSPBITMAP:
00515         <span class="keywordflow">case</span> CF_PALETTE:
00516             <span class="keywordflow">if</span> (cb &gt;= <span class="keyword">sizeof</span>(HANDLE)) {
00517                 <span class="keywordflow">if</span> (fFreeTruelyGlobalObjects) {
00518                     <span class="keywordflow">if</span> (pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> != 0) {
00519                         DeleteObject((HANDLE)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>);
00520                     }
00521                 } <span class="keywordflow">else</span> {
00522                     <span class="comment">/*</span>
00523 <span class="comment">                     * !fFreeTruelyGlobalObject implies we are only freeing</span>
00524 <span class="comment">                     * the Gdi proxy.  (another process may still have this</span>
00525 <span class="comment">                     * object in use.)</span>
00526 <span class="comment">                     *</span>
00527 <span class="comment">                     * ChrisWil: removed this call.  No longer</span>
00528 <span class="comment">                     *           applicable in KMode.</span>
00529 <span class="comment">                     *</span>
00530 <span class="comment">                     * GdiDeleteLocalObject((ULONG)pdde-&gt;Data);</span>
00531 <span class="comment">                     *</span>
00532 <span class="comment">                     */</span>
00533                 }
00534             }
00535             <span class="keywordflow">break</span>;
00536 
00537         <span class="keywordflow">case</span> CF_DIB:
00538             <span class="keywordflow">if</span> (cb &gt;= <span class="keyword">sizeof</span>(HANDLE)) {
00539                 <span class="keywordflow">if</span> (pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> != 0) {
00540                     <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>((HANDLE)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>);
00541                 }
00542             }
00543             <span class="keywordflow">break</span>;
00544 
00545         <span class="keywordflow">case</span> CF_METAFILEPICT:
00546         <span class="keywordflow">case</span> CF_DSPMETAFILEPICT:
00547             <span class="keywordflow">if</span> (cb &gt;= <span class="keyword">sizeof</span>(HANDLE)) {
00548                 <span class="keywordflow">if</span> (pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> != 0) {
00549                     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>, pmfPict);
00550                     <span class="keywordflow">if</span> (pmfPict != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00551                         <span class="keywordflow">if</span> (GlobalSize((HANDLE)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>) &gt;= <span class="keyword">sizeof</span>(METAFILEPICT)) {
00552                             DeleteMetaFile(pmfPict-&gt;hMF);
00553                         }
00554                         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>((HANDLE)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>);
00555                         <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>((HANDLE)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>);
00556                     }
00557                 }
00558             }
00559             <span class="keywordflow">break</span>;
00560 
00561         <span class="keywordflow">case</span> CF_ENHMETAFILE:
00562         <span class="keywordflow">case</span> CF_DSPENHMETAFILE:
00563             <span class="keywordflow">if</span> (cb &gt;= <span class="keyword">sizeof</span>(HANDLE)) {
00564                 <span class="keywordflow">if</span> (pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a> != 0) {
00565                     DeleteEnhMetaFile((HANDLE)pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o2">Data</a>);
00566                 }
00567             }
00568             <span class="keywordflow">break</span>;
00569         }
00570         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
00571         <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(hDDE);
00572     } <span class="keywordflow">else</span> {
00573         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hDDE);
00574     }
00575 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="hdata.c::InternalCreateDataHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HDDEDATA InternalCreateDataHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pcii</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>pSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cbOff</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>wStatus</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>wFmt</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00094">94</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00058">CheckDDECritIn</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00075">CreateHandle()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00016">DDEMLAlloc</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00257">tagDDEMLDATA::flags</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00256">tagDDEMLDATA::hDDE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00186">tagCL_INSTANCE_INFO::hInstClient</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00108">HTYPE_DATA_HANDLE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00095">InstFromHandle</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00125">UserGlobalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>, <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00019">tagDDE_DATA::wFmt</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>, and <a class="el" href="../../d7/d3/ddetrack_8h-source.html#l00018">tagDDE_DATA::wStatus</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00129">_ClientEventCallback()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00362">ClSpontAdviseData()</a>, <a class="el" href="../../d1/d0/xact_8c-source.html#l00024">DdeClientTransaction()</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00025">DdeCreateDataHandle()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00885">SvSpontExecute()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01042">SvSpontPoke()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01624">TransactionComplete()</a>.
<p>
<pre class="fragment"><div>00102 {
00103     <a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a> pdd;
00104     HDDEDATA hRet;
00105     LPBYTE p;
00106     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbOff2;
00107 
00108     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a8">CheckDDECritIn</a>;
00109 
00110     pdd = (<a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a>)<a class="code" href="../../d0/d4/ddemlcli_8h.html#a0">DDEMLAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d2/structtagDDEMLDATA.html">DDEMLDATA</a>));
00111     <span class="keywordflow">if</span> (pdd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00112         <span class="keywordflow">return</span> (0);
00113     }
00114     <span class="keywordflow">if</span> (cb == -1) {
00115         pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a> = (HANDLE)pSrc;
00116     } <span class="keywordflow">else</span> {
00117         <span class="keywordflow">if</span> (flags &amp; HDATA_EXECUTE) {
00118             cbOff2 = 0;
00119         } <span class="keywordflow">else</span> {
00120             cbOff2 = <span class="keyword">sizeof</span>(WORD) + <span class="keyword">sizeof</span>(WORD); <span class="comment">// skip wStatus, wFmt</span>
00121         }
00122         pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a3">UserGlobalAlloc</a>(GMEM_DDESHARE | GMEM_MOVEABLE | GMEM_ZEROINIT,
00123                 cb + cbOff + cbOff2);
00124         <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00125             <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pdd);
00126             <span class="keywordflow">return</span> (0);
00127         }
00128 
00129         <span class="keywordflow">if</span> (!(flags &amp; HDATA_EXECUTE)) {
00130             <a class="code" href="../../d4/d2/structtagDDE__DATA.html">PDDE_DATA</a> pdde;
00131 
00132             <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>, pdde);
00133             UserAssert(pdde);
00134             pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o0">wStatus</a> = wStatus;
00135             pdde-&gt;<a class="code" href="../../d4/d2/structtagDDE__DATA.html#o1">wFmt</a> = wFmt;
00136             <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>);
00137         }
00138     }
00139     pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> = (WORD)flags;
00140     hRet = (HDDEDATA)<a class="code" href="../../d3/d8/handles_8c.html#a6">CreateHandle</a>((ULONG_PTR)pdd, HTYPE_DATA_HANDLE,
00141             <a class="code" href="../../d0/d4/ddemlcli_8h.html#a28">InstFromHandle</a>(pcii-&gt;<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o2">hInstClient</a>));
00142     <span class="keywordflow">if</span> (!hRet) {
00143         <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(pdd-&gt;hDDE);
00144         <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pdd);
00145         <span class="keywordflow">return</span> (0);
00146     }
00147     <span class="keywordflow">if</span> (cb != -1 &amp;&amp; pSrc != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00148         <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(pdd-&gt;hDDE, p);
00149         UserAssert(p);
00150         RtlCopyMemory(p + cbOff + cbOff2, pSrc, cb);
00151         <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(pdd-&gt;hDDE);
00152         pdd-&gt;flags |= HDATA_INITIALIZED;
00153     }
00154     <span class="keywordflow">return</span> (hRet);
00155 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="hdata.c::InternalFreeDataHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InternalFreeDataHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDDEDATA&nbsp;</td>
          <td class="mdname" nowrap> <em>hData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fIgnorefRelease</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d8/hdata_8c-source.html#l00416">416</a> of file <a class="el" href="../../d1/d8/hdata_8c-source.html">hdata.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00058">CheckDDECritIn</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00018">DDEMLFree</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00137">DestroyHandle()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00257">tagDDEMLDATA::flags</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00491">FreeDDEData()</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00256">tagDDEMLDATA::hDDE</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00112">HINST_ANY</a>, <a class="el" href="../../d1/d3/ddemlcli_8h-source.html#l00108">HTYPE_DATA_HANDLE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00204">ValidateCHandle()</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00131">WOWGLOBALFREE</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/w32_2ntuser_2client_2callback_8c-source.html#l00129">_ClientEventCallback()</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00451">ApplyFreeDataHandle()</a>, <a class="el" href="../../d1/d8/hdata_8c-source.html#l00378">DdeFreeDataHandle()</a>, <a class="el" href="../../d4/d3/ddemlwp_8c-source.html#l00059">ProcessDDEMLInitiate()</a>, <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l00263">SvStartAdviseUpdate()</a>, and <a class="el" href="../../d3/d5/stdptcl_8c-source.html#l01624">TransactionComplete()</a>.
<p>
<pre class="fragment"><div>00419 {
00420     <a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a> pdd;
00421 
00422     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a8">CheckDDECritIn</a>;
00423 
00424     pdd = (<a class="code" href="../../d8/d2/structtagDDEMLDATA.html">PDDEMLDATA</a>)<a class="code" href="../../d3/d8/handles_8c.html#a10">ValidateCHandle</a>((HANDLE)hData,
00425             HTYPE_DATA_HANDLE, HINST_ANY);
00426     <span class="keywordflow">if</span> (pdd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00427         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00428     }
00429     <span class="keywordflow">if</span> (pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; HDATA_EXECUTE) {
00430         <span class="keywordflow">if</span> (!(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a> &amp; HDATA_APPOWNED) || fIgnorefRelease) {
00431             <a class="code" href="../../d6/d0/usercli_8h.html#a7">WOWGLOBALFREE</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>);
00432         }
00433     } <span class="keywordflow">else</span> {
00434         <a class="code" href="../../d0/d9/hdata_8c.html#a10">FreeDDEData</a>(pdd-&gt;<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>, fIgnorefRelease, TRUE);
00435     }
00436     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a2">DDEMLFree</a>(pdd);
00437     <a class="code" href="../../d3/d8/handles_8c.html#a7">DestroyHandle</a>((HANDLE)hData);
00438     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00439 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:02 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
