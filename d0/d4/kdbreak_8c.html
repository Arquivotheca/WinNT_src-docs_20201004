<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: kdbreak.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>kdbreak.c File Reference</h1><code>#include "<a class="el" href="../../d1/d6/kdp_8h-source.html">kdp.h</a>"</code><br>

<p>
<a href="../../d1/d3/kdbreak_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a0">KdSetOwedBreakpoints</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a1">KdpLowWriteContent</a> (ULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a2">KdpLowRestoreBreakpoint</a> (ULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a3">KdpAddBreakpoint</a> (IN PVOID Address)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a4">KdpLowWriteContent</a> (IN ULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a5">KdpDeleteBreakpoint</a> (IN ULONG <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a6">KdpDeleteBreakpointRange</a> (IN PVOID Lower, IN PVOID Upper)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a7">KdpSuspendBreakpoint</a> (ULONG <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a8">KdpSuspendAllBreakpoints</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a9">KdpLowRestoreBreakpoint</a> (IN ULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a10">KdpRestoreAllBreakpoints</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/kdbreak_8c.html#a11">KdDeleteAllBreakpoints</a> (VOID)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="kdbreak.c::KdDeleteAllBreakpoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdDeleteAllBreakpoints           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l01332">1332</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
References <a class="el" href="../../d9/d4/kddata_8c-source.html#l00248">BreakpointsSuspended</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d8/d2/kd_8h-source.html#l00134">KdDebuggerEnabled</a>, <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00826">KdpDeleteBreakpoint()</a>, and <a class="el" href="../../d8/d2/kd_8h-source.html#l00066">KdPitchDebugger</a>.
<p>
<pre class="fragment"><div>01335 {
01336     ULONG <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
01337 
01338     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d3/kd_8h.html#a13">KdDebuggerEnabled</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> || <a class="code" href="../../d7/d3/kd_8h.html#a7">KdPitchDebugger</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01339         <span class="keywordflow">return</span>;
01340     }
01341 
01342     <a class="code" href="../../d8/d5/kddata_8c.html#a86">BreakpointsSuspended</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01343 
01344     <span class="keywordflow">for</span> ( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = 1; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> &lt;= BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>++ ) {
01345         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a105">KdpDeleteBreakpoint</a>(Handle);
01346     }
01347 
01348     <span class="keywordflow">return</span>;
01349 } <span class="comment">// KdDeleteAllBreakpoints</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="kdbreak.c::KdpAddBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KdpAddBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Address</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00060">60</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
<pre class="fragment"><div>00066                    :
00067 
00068     This routine adds an entry to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table and returns a handle
00069     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table entry.
00070 
00071 Arguments:
00072 
00073     Address - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address where to set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint.
00074 
00075 Return Value:
00076 
00077     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of zero <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00078     breakpoint table, there are no free entries in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00079     specified address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not correctly aligned, or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00080     not valid. Otherwise, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> assigned breakpoint table entry
00081     plus one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00082 
00083 --*/
00084 
00085 {
00086 
00087     <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> Content;
00088     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00089     BOOLEAN Accessible;
00090     ULONG_PTR Opaque;
00091 
00092     <span class="comment">//DPRINT(("KD: Setting breakpoint at 0x%08x\n", Address));</span>
00093 
00094     <span class="comment">//</span>
00095     <span class="comment">// If the specified address is not properly aligned, then return zero.</span>
00096     <span class="comment">//</span>
00097 
00098     <span class="keywordflow">if</span> (((ULONG_PTR)Address &amp; <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a5">KDP_BREAKPOINT_ALIGN</a>) != 0) {
00099         <span class="keywordflow">return</span> 0;
00100     }
00101 
00102 
00103     <span class="comment">//</span>
00104     <span class="comment">// Don't allow setting the same breakpoint twice.</span>
00105     <span class="comment">//</span>
00106 
00107     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00108         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>) != 0 &amp;&amp;
00109             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> == Address) {
00110 
00111             <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>) != 0) {
00112 
00113                 <span class="comment">//</span>
00114                 <span class="comment">// Breakpoint was set, the page was written out and was not</span>
00115                 <span class="comment">// accessible when the breakpoint was cleared.  Now the breakpoint</span>
00116                 <span class="comment">// is being set again.  Just clear the defer flag:</span>
00117                 <span class="comment">//</span>
00118                 <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~<a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00119                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> + 1;
00120 
00121             } <span class="keywordflow">else</span> {
00122 
00123                 <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: Attempt to set breakpoint %08x twice!\n"</span>, Address));
00124                 <span class="keywordflow">return</span> 0;
00125 
00126             }
00127         }
00128     }
00129 
00130     <span class="comment">//</span>
00131     <span class="comment">// Search the breakpoint table for a free entry.</span>
00132     <span class="comment">//</span>
00133 
00134     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00135         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> == 0) {
00136             <span class="keywordflow">break</span>;
00137         }
00138     }
00139 
00140     <span class="comment">//</span>
00141     <span class="comment">// If a free entry was found, then write breakpoint and return the handle</span>
00142     <span class="comment">// value plus one. Otherwise, return zero.</span>
00143     <span class="comment">//</span>
00144 
00145     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> == BREAKPOINT_TABLE_SIZE) {
00146         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: ran out of breakpoints!\n"</span>));
00147         <span class="keywordflow">return</span> 0;
00148     }
00149 
00150 
00151     <span class="comment">//DPRINT(("KD: using Index %d\n", Index));</span>
00152 
00153     <span class="comment">//</span>
00154     <span class="comment">// Get the instruction to be replaced. If the instruction cannot be read,</span>
00155     <span class="comment">// then mark breakpoint as not accessible.</span>
00156     <span class="comment">//</span>
00157 
00158     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00159             (PCHAR)&amp;Content,
00160             (PCHAR)Address,
00161             <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE) ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00162         Accessible = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00163         <span class="comment">//DPRINT(("KD: memory inaccessible\n"));</span>
00164     } <span class="keywordflow">else</span> {
00165         <span class="comment">//DPRINT(("KD: memory readable...\n"));</span>
00166         Accessible = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00167     }
00168 
00169     <span class="comment">//</span>
00170     <span class="comment">// If the specified address is not write accessible, then return zero.</span>
00171     <span class="comment">//</span>
00172 
00173     <span class="keywordflow">if</span> (Accessible) {
00174         <span class="keywordflow">if</span>  (<a class="code" href="../../d4/d6/ppc_2debugsup_8c.html#a1">MmDbgWriteCheck</a>((PVOID)Address, &amp;Opaque) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00175             <a class="code" href="../../d2/d6/ia64_2debugsup_8c.html#a2">MmDbgReleaseAddress</a>((PVOID)Address, Opaque);
00176         } <span class="keywordflow">else</span> {
00177             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: memory not writable!\n"</span>));
00178             <span class="keywordflow">return</span> 0;
00179         }
00180     }
00181 
00182 <span class="preprocessor">#if defined(_IA64_)</span>
00183 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( Accessible ) {
00184         <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> mBuf;
00185         PVOID BundleAddress;
00186 
00187         <span class="comment">// change template to type 0 if current instruction is MLI</span>
00188 
00189         <span class="comment">// read in intruction template if current instruction is NOT slot 0.</span>
00190         <span class="comment">// check for two-slot MOVL instruction. Reject request if attempt to</span>
00191         <span class="comment">// set break in slot 2 of MLI template.</span>
00192 
00193         <span class="keywordflow">if</span> (((ULONG_PTR)Address &amp; 0xf) != 0) {
00194             (ULONG_PTR)BundleAddress = (ULONG_PTR)Address &amp; ~(0xf);
00195             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00196                     (PCHAR)&amp;mBuf,
00197                     (PCHAR)BundleAddress,
00198                     <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00199                     ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00200                 <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: read 0x%08x template failed\n"</span>, BundleAddress));
00201                 <span class="keywordflow">return</span> 0;
00202             } <span class="keywordflow">else</span> {
00203                 <span class="keywordflow">if</span> (((mBuf &amp; INST_TEMPL_MASK) &gt;&gt; 1) == 0x2) {
00204                     <span class="keywordflow">if</span> (((ULONG_PTR)Address &amp; 0xf) == 4) {
00205                         <span class="comment">// if template= type 2 MLI, change to type 0</span>
00206                         mBuf &amp;= ~((INST_TEMPL_MASK &gt;&gt; 1) &lt;&lt; 1);
00207                         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a8">KD_BREAKPOINT_IA64_MOVL</a>;
00208                         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00209                                 (PCHAR)BundleAddress,
00210                                 (PCHAR)&amp;mBuf,
00211                                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00212                                 ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00213                             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write to 0x%08x template failed\n"</span>, BundleAddress));
00214                             <span class="keywordflow">return</span> 0;
00215                          }
00216                          <span class="keywordflow">else</span> {
00217                              <span class="comment">//DPRINT(("KD: change MLI template to type 0 at 0x%08x set\n", Address));</span>
00218                          }
00219                     } <span class="keywordflow">else</span> {
00220                          <span class="comment">// set breakpoint at slot 2 of MOVL is illegal</span>
00221                          <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: illegal to set BP at slot 2 of MOVL at 0x%08x\n"</span>, BundleAddress));
00222                          <span class="keywordflow">return</span> 0;
00223                     }
00224                 }
00225             }
00226         }
00227 
00228         <span class="comment">// insert break instruction</span>
00229 
00230         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> = Address;
00231         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> = Content;
00232         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~(<a class="code" href="../../d0/d7/kdp_8h.html#a5">KD_BREAKPOINT_STATE_MASK</a>);
00233         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>;
00234         <span class="keywordflow">if</span> (Address &lt; (PVOID)<a class="code" href="../../d0/d7/kdp_8h.html#a0">GLOBAL_BREAKPOINT_LIMIT</a>) {
00235             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o1">DirectoryTableBase</a> =
00236                 <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;DirectoryTableBase[0];
00237             }
00238             <span class="keywordflow">switch</span> ((ULONG_PTR)Address &amp; 0xf) {
00239             <span class="keywordflow">case</span> 0:
00240                 Content = (Content &amp; ~(INST_SLOT0_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 5);
00241                 <span class="keywordflow">break</span>;
00242 
00243             <span class="keywordflow">case</span> 4:
00244                 Content = (Content &amp; ~(INST_SLOT1_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 14);
00245                 <span class="keywordflow">break</span>;
00246 
00247             <span class="keywordflow">case</span> 8:
00248                 Content = (Content &amp; ~(INST_SLOT2_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 23);
00249                 <span class="keywordflow">break</span>;
00250 
00251             <span class="keywordflow">default</span>:
00252                 <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: KdpAddBreakpoint bad instruction slot#\n"</span>));
00253                 <span class="keywordflow">return</span> 0;
00254             }
00255             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00256                     (PCHAR)Address,
00257                     (PCHAR)&amp;Content,
00258                     <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00259                     ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00260 
00261                 <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: KdpMoveMemory failed writing BP!\n"</span>));
00262                 <span class="keywordflow">return</span> 0;
00263             }
00264             <span class="keywordflow">else</span> {
00265                 <span class="comment">//DPRINT(("KD: breakpoint at 0x%08x set\n", Address));</span>
00266             }
00267 
00268     } <span class="keywordflow">else</span> {  <span class="comment">// memory not accessible</span>
00269         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> = Address;
00270         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~(<a class="code" href="../../d0/d7/kdp_8h.html#a5">KD_BREAKPOINT_STATE_MASK</a>);
00271         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>;
00272         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
00273         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00274         <span class="comment">//DPRINT(("KD: breakpoint write deferred\n"));</span>
00275         <span class="keywordflow">if</span> (Address &lt; (PVOID)<a class="code" href="../../d0/d7/kdp_8h.html#a0">GLOBAL_BREAKPOINT_LIMIT</a>) {
00276             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o1">DirectoryTableBase</a> =
00277                 <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;DirectoryTableBase[0];
00278         }
00279     }
00280 <span class="preprocessor">#else</span>
00281 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( Accessible ) {
00282         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> = Address;
00283         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> = Content;
00284         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>;
00285         <span class="keywordflow">if</span> (Address &lt; (PVOID)<a class="code" href="../../d0/d7/kdp_8h.html#a0">GLOBAL_BREAKPOINT_LIMIT</a>) {
00286             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o1">DirectoryTableBase</a> =
00287                 <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;DirectoryTableBase[0];
00288         }
00289         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00290                 (PCHAR)Address,
00291                 (PCHAR)&amp;KdpBreakpointInstruction,
00292                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00293                 ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00294 
00295             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: KdpMoveMemory failed writing BP!\n"</span>));
00296         }
00297     } <span class="keywordflow">else</span> {
00298         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> = Address;
00299         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a> | <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
00300         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00301         <span class="comment">//DPRINT(("KD: breakpoint write deferred\n"));</span>
00302         <span class="keywordflow">if</span> (Address &lt; (PVOID)<a class="code" href="../../d0/d7/kdp_8h.html#a0">GLOBAL_BREAKPOINT_LIMIT</a>) {
00303             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o1">DirectoryTableBase</a> =
00304                 <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;DirectoryTableBase[0];
00305         }
00306     }
00307 <span class="preprocessor">#endif  // IA64</span>
00308 <span class="preprocessor"></span>
00309     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> + 1;
00310 
00311 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="kdbreak.c::KdpDeleteBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpDeleteBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Handle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00826">826</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
<pre class="fragment"><div>00832                    :
00833 
00834     This routine deletes an entry from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table.
00835 
00836 Arguments:
00837 
00838     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index plus one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table entry
00839         which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be deleted.
00840 
00841 Return Value:
00842 
00843     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified handle <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not a valid
00844     value or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint cannot be deleted because <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> old instruction
00845     cannot be replaced. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00846 
00847 --*/
00848 
00849 {
00850     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - 1;
00851 
00852     <span class="comment">//</span>
00853     <span class="comment">// If the specified handle is not valid, then return FALSE.</span>
00854     <span class="comment">//</span>
00855 
00856     <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> == 0) || (<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> &gt; BREAKPOINT_TABLE_SIZE)) {
00857         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: Breakpoint %d invalid.\n"</span>, Index));
00858         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00859     }
00860 
00861     <span class="comment">//</span>
00862     <span class="comment">// If the specified breakpoint table entry is not valid, then return FALSE.</span>
00863     <span class="comment">//</span>
00864 
00865     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> == 0) {
00866         <span class="comment">//DPRINT(("KD: Breakpoint %d already clear.\n", Index));</span>
00867         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00868     }
00869 
00870     <span class="comment">//</span>
00871     <span class="comment">// If the breakpoint is already suspended, just delete it from the table.</span>
00872     <span class="comment">//</span>
00873 
00874     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>) {
00875         <span class="comment">//DPRINT(("KD: Deleting suspended breakpoint %d \n", Index));</span>
00876         <span class="keywordflow">if</span> ( !(<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>) ) {
00877             <span class="comment">//DPRINT(("KD: already clear.\n"));</span>
00878             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = 0;
00879             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00880         }
00881     }
00882 
00883     <span class="comment">//</span>
00884     <span class="comment">// Replace the instruction contents.</span>
00885     <span class="comment">//</span>
00886 
00887     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d4/4_2kdbreak_8c.html#a4">KdpLowWriteContent</a>(Index)) {
00888 
00889         <span class="comment">//</span>
00890         <span class="comment">// Delete breakpoint table entry</span>
00891         <span class="comment">//</span>
00892 
00893         <span class="comment">//DPRINT(("KD: Breakpoint %d deleted successfully.\n", Index));</span>
00894         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> = 0;
00895     }
00896 
00897     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00898 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="kdbreak.c::KdpDeleteBreakpointRange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpDeleteBreakpointRange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Lower</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Upper</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00902">902</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
<pre class="fragment"><div>00909                    :
00910 
00911     This routine deletes all breakpoints falling in a given range
00912     from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table.
00913 
00914 Arguments:
00915 
00916     Lower - inclusive lower address of range from which to remove BPs.
00917 
00918     Upper - include upper address of range from which to remove BPs.
00919 
00920 Return Value:
00921 
00922     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> any breakpoints removed, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise.
00923 
00924 --*/
00925 
00926 {
00927     ULONG   <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00928     BOOLEAN ReturnStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00929 
00930     <span class="comment">//</span>
00931     <span class="comment">// Examine each entry in the table in turn</span>
00932     <span class="comment">//</span>
00933 
00934     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++) {
00935 
00936         <span class="keywordflow">if</span> ( (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>) &amp;&amp;
00937              ((<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &gt;= Lower) &amp;&amp;
00938               (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &lt;= Upper))
00939            ) {
00940 
00941             <span class="comment">//</span>
00942             <span class="comment">// Breakpoint is in use and falls in range, clear it.</span>
00943             <span class="comment">//</span>
00944 
00945             ReturnStatus = ReturnStatus || <a class="code" href="../../d1/d7/4_2kdp_8h.html#a105">KdpDeleteBreakpoint</a>(Index+1);
00946         }
00947     }
00948 
00949     <span class="keywordflow">return</span> ReturnStatus;
00950 
00951 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="kdbreak.c::KdpLowRestoreBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpLowRestoreBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Index</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l01121">1121</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
References <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00173">_BREAKPOINT_ENTRY::Address</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00174">_BREAKPOINT_ENTRY::Content</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00573">DPRINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00056">KD_BREAKPOINT_IA64_MOVL</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00051">KD_BREAKPOINT_NEEDS_REPLACE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00049">KD_BREAKPOINT_NEEDS_WRITE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00076">KDP_BREAKPOINT_TYPE</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00263">KdpBreakpointInstruction</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00300">KdpOweBreakpoint</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01127                    :
01128 
01129     This routine attempts to write a breakpoint instruction.
01130     The old contents must have already been stored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01131     breakpoint record.
01132 
01133 Arguments:
01134 
01135     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table entry
01136         which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be written.
01137 
01138 Return Value:
01139 
01140     Returns <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint was written, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> was
01141     not and has been marked <span class="keywordflow">for</span> writing later.
01142 
01143 --*/
01144 
01145 {
01146     <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> Content;
01147 
01148 <span class="preprocessor">#if defined(_IA64_)</span>
01149 <span class="preprocessor"></span>    <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> mBuf;
01150     PVOID BundleAddress;
01151 <span class="preprocessor">#endif</span>
01152 <span class="preprocessor"></span>    <span class="comment">//</span>
01153     <span class="comment">// Does the breakpoint need to be written at all?</span>
01154     <span class="comment">//</span>
01155 
01156     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>) {
01157 
01158         <span class="comment">//</span>
01159         <span class="comment">// The breakpoint was never removed.  Clear the flag</span>
01160         <span class="comment">// and we are done.</span>
01161         <span class="comment">//</span>
01162 
01163         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~<a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
01164         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01165     }
01166 
01167     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> == <a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a>) {
01168 
01169         <span class="comment">//</span>
01170         <span class="comment">// The instruction is a breakpoint anyway.</span>
01171         <span class="comment">//</span>
01172 
01173         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01174     }
01175 
01176     <span class="comment">//</span>
01177     <span class="comment">// Replace the instruction contents.</span>
01178     <span class="comment">//</span>
01179 
01180 <span class="preprocessor">#if !defined(_IA64_)</span>
01181 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> == <a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a>) {
01182 
01183         <span class="comment">//</span>
01184         <span class="comment">// The instruction is a breakpoint anyway.</span>
01185         <span class="comment">//</span>
01186 
01187         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01188     }
01189 <span class="preprocessor">#endif</span>
01190 <span class="preprocessor"></span>
01191     <span class="comment">//</span>
01192     <span class="comment">// Replace the instruction contents.</span>
01193     <span class="comment">//</span>
01194 
01195 <span class="preprocessor">#if defined(_IA64_)</span>
01196 <span class="preprocessor"></span>
01197     <span class="comment">// read in intruction in case the adjacent instruction has been modified.</span>
01198 
01199     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
01200             (PCHAR)&amp;mBuf,
01201             (PCHAR)KdpBreakpointTable[Index].Address,
01202             <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
01203             ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
01204         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: read 0x%p template failed\n"</span>, KdpBreakpointTable[Index].Address));
01205         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01206         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01207         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01208     }
01209 
01210     <span class="keywordflow">switch</span> ((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) {
01211         <span class="keywordflow">case</span> 0:
01212             mBuf = (mBuf &amp; ~(INST_SLOT0_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 5);
01213             <span class="keywordflow">break</span>;
01214 
01215         <span class="keywordflow">case</span> 4:
01216             mBuf = (mBuf &amp; ~(INST_SLOT1_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 14);
01217             <span class="keywordflow">break</span>;
01218 
01219         <span class="keywordflow">case</span> 8:
01220             mBuf = (mBuf &amp; ~(INST_SLOT2_MASK)) | (<a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a> &lt;&lt; 23);
01221             <span class="keywordflow">break</span>;
01222 
01223         <span class="keywordflow">default</span>:
01224             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: KdpAddBreakpoint bad instruction slot#\n"</span>));
01225             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01226     }
01227     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
01228             (PCHAR)KdpBreakpointTable[Index].Address,
01229             (PCHAR)&amp;mBuf,
01230             <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
01231             ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
01232 
01233         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: KdpMoveMemory failed writing BP!\n"</span>));
01234         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01235         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01236         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01237     }
01238     <span class="keywordflow">else</span> {
01239 
01240         <span class="comment">// check for two-slot MOVL instruction. Reject request if attempt to</span>
01241         <span class="comment">// set break in slot 2 of MLI template.</span>
01242         <span class="comment">// change template to type 0 if current instruction is MLI</span>
01243 
01244         <span class="keywordflow">if</span> (((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) != 0) {
01245             (ULONG_PTR)BundleAddress = (ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; ~(0xf);
01246             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
01247                     (PCHAR)&amp;mBuf,
01248                     (PCHAR)BundleAddress,
01249                     <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
01250                     ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
01251                 <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: read template failed at 0x%08x\n"</span>, BundleAddress));
01252                 <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01253                 <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01254                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01255             }
01256             <span class="keywordflow">else</span> {
01257                 <span class="keywordflow">if</span> (((mBuf &amp; INST_TEMPL_MASK) &gt;&gt; 1) == 0x2) {
01258                     <span class="keywordflow">if</span> (((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) == 4) {
01259                         <span class="comment">// if template= type 2 MLI, change to type 0</span>
01260                         mBuf &amp;= ~((INST_TEMPL_MASK &gt;&gt; 1) &lt;&lt; 1);
01261                         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a8">KD_BREAKPOINT_IA64_MOVL</a>;
01262                         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
01263                                 (PCHAR)BundleAddress,
01264                                 (PCHAR)&amp;mBuf,
01265                                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
01266                                 ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
01267                             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write to 0x%08x template failed\n"</span>, BundleAddress));
01268                             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01269                             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01270                             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01271                         }
01272                         <span class="keywordflow">else</span> {
01273                              <span class="comment">//DPRINT(("KD: change MLI template to type 0 at 0x%08x set\n", Address));</span>
01274                         }
01275                     } <span class="keywordflow">else</span> {
01276                          <span class="comment">// set breakpoint at slot 2 of MOVL is illegal</span>
01277                          <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: illegal to set BP at slot 2 of MOVL at 0x%08x\n"</span>, BundleAddress));
01278                          <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01279                          <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01280                          <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01281                     }
01282                 }
01283             }
01284         }
01285         <span class="comment">//DPRINT(("KD: breakpoint at 0x%08x set\n", Address));</span>
01286         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01287     }
01288 
01289 <span class="preprocessor">#else</span>
01290 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>( (PCHAR)KdpBreakpointTable[Index].Address,
01291                        (PCHAR)&amp;KdpBreakpointInstruction,
01292                        <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE) ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
01293 
01294         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01295         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01296         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01297 
01298     } <span class="keywordflow">else</span> {
01299 
01300         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~<a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
01301         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01302     }
01303 <span class="preprocessor">#endif</span>
01304 <span class="preprocessor"></span>
01305 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="kdbreak.c::KdpLowRestoreBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpLowRestoreBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Index</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="kdbreak.c::KdpLowWriteContent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpLowWriteContent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Index</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00635">635</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
References <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00173">_BREAKPOINT_ENTRY::Address</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00174">_BREAKPOINT_ENTRY::Content</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00573">DPRINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/4_2kdp_8h-source.html#l00171">_BREAKPOINT_ENTRY::Flags</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00056">KD_BREAKPOINT_IA64_MOVL</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00051">KD_BREAKPOINT_NEEDS_REPLACE</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00049">KD_BREAKPOINT_NEEDS_WRITE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00076">KDP_BREAKPOINT_TYPE</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00263">KdpBreakpointInstruction</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00201">KdpBreakpointTable</a>, <a class="el" href="../../d9/d5/kdmove_8c-source.html#l00031">KdpMoveMemory()</a>, <a class="el" href="../../d9/d4/kddata_8c-source.html#l00300">KdpOweBreakpoint</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00641                    :
00642 
00643     This routine attempts to replace <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> code that a breakpoint <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00644     written over.  This routine, <a class="code" href="../../d0/d4/kdbreak_8c.html#a3">KdpAddBreakpoint</a>,
00645     <a class="code" href="../../d0/d4/kdbreak_8c.html#a2">KdpLowRestoreBreakpoint</a> and <a class="code" href="../../d7/d3/kd_8h.html#a21">KdSetOwedBreakpoints</a> are responsible
00646     <span class="keywordflow">for</span> getting data written as requested.  Callers should not
00647     examine or use KdpOweBreakpoints, and they should not set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00648     NEEDS_WRITE or NEEDS_REPLACE flags.
00649 
00650     Callers must still look at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">return</span> value from <span class="keyword">this</span> function,
00651     however: <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> returns <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint record must not be
00652     reused until <a class="code" href="../../d7/d3/kd_8h.html#a21">KdSetOwedBreakpoints</a> has finished with <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
00653 
00654 Arguments:
00655 
00656     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint table entry
00657         which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be deleted.
00658 
00659 Return Value:
00660 
00661     Returns <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> breakpoint was removed, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> was deferred.
00662 
00663 --*/
00664 
00665 {
00666 <span class="preprocessor">#if defined(_IA64_)</span>
00667 <span class="preprocessor"></span>    <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a> mBuf;
00668     PVOID BundleAddress;
00669 <span class="preprocessor">#endif</span>
00670 <span class="preprocessor"></span>
00671     <span class="comment">//</span>
00672     <span class="comment">// Do the contents need to be replaced at all?</span>
00673     <span class="comment">//</span>
00674 
00675     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>) {
00676 
00677         <span class="comment">//</span>
00678         <span class="comment">// The breakpoint was never written out.  Clear the flag</span>
00679         <span class="comment">// and we are done.</span>
00680         <span class="comment">//</span>
00681 
00682         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~<a class="code" href="../../d0/d7/kdp_8h.html#a2">KD_BREAKPOINT_NEEDS_WRITE</a>;
00683         <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x never written; flag cleared.\n",</span>
00684         <span class="comment">//    KdpBreakpointTable[Index].Address));</span>
00685         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00686     }
00687 
00688 <span class="preprocessor">#if !defined(_IA64_)</span>
00689 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> == <a class="code" href="../../d8/d5/kddata_8c.html#a91">KdpBreakpointInstruction</a>) {
00690 
00691         <span class="comment">//</span>
00692         <span class="comment">// The instruction is a breakpoint anyway.</span>
00693         <span class="comment">//</span>
00694 
00695         <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x; instr is really BP; flag cleared.\n",</span>
00696         <span class="comment">//    KdpBreakpointTable[Index].Address));</span>
00697 
00698         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00699     }
00700 <span class="preprocessor">#endif</span>
00701 <span class="preprocessor"></span>
00702 
00703     <span class="comment">//</span>
00704     <span class="comment">// Restore the instruction contents.</span>
00705     <span class="comment">//</span>
00706 
00707 <span class="preprocessor">#if defined(_IA64_)</span>
00708 <span class="preprocessor"></span>    <span class="comment">// Read in memory since adjancent instructions in the same bundle may have</span>
00709     <span class="comment">// been modified after we save them.</span>
00710     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00711             (PCHAR)&amp;mBuf,
00712             (PCHAR)KdpBreakpointTable[Index].Address,
00713             <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00714         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00715         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: read 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00716         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00717         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00718     }
00719     <span class="keywordflow">else</span> {
00720 
00721         <span class="keywordflow">switch</span> ((ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; 0xf) {
00722         <span class="keywordflow">case</span> 0:
00723             mBuf = (mBuf &amp; ~(INST_SLOT0_MASK))
00724                          | (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> &amp; INST_SLOT0_MASK);
00725             <span class="keywordflow">break</span>;
00726 
00727         <span class="keywordflow">case</span> 4:
00728             mBuf = (mBuf &amp; ~(INST_SLOT1_MASK))
00729                          | (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> &amp; INST_SLOT1_MASK);
00730             <span class="keywordflow">break</span>;
00731 
00732         <span class="keywordflow">case</span> 8:
00733             mBuf = (mBuf &amp; ~(INST_SLOT2_MASK))
00734                          | (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o3">Content</a> &amp; INST_SLOT2_MASK);
00735             <span class="keywordflow">break</span>;
00736 
00737         <span class="keywordflow">default</span>:
00738             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00739             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: illegal instruction address 0x%08x\n"</span>, KdpBreakpointTable[Index].Address));
00740             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00741         }
00742 
00743         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00744                 (PCHAR)KdpBreakpointTable[Index].Address,
00745                 (PCHAR)&amp;mBuf,
00746                 <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00747             <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00748             <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write to 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00749             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00750             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00751         }
00752         <span class="keywordflow">else</span> {
00753 <span class="preprocessor">#ifdef _GAMBIT_</span>
00754 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00755                     (PCHAR)&amp;mBuf,
00756                     (PCHAR)KdpBreakpointTable[Index].Address,
00757                     <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)) == <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00758                 <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"\tcontent after memory move = 0x%08x 0x%08x\n"</span>, (ULONG)(mBuf &gt;&gt; 32), (ULONG)mBuf));
00759             }
00760 <span class="preprocessor">#endif // _GAMBIT_</span>
00761 <span class="preprocessor"></span>
00762 
00763              <span class="comment">// restore template to MLI if displaced instruction was MOVL</span>
00764 
00765             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a8">KD_BREAKPOINT_IA64_MOVL</a>) {
00766                 (ULONG_PTR)BundleAddress = (ULONG_PTR)<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o2">Address</a> &amp; ~(0xf);
00767                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00768                         (PCHAR)&amp;mBuf,
00769                         (PCHAR)BundleAddress,
00770                         <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00771                         ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00772                     <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00773                     <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: read template 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00774                     <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00775                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00776                 }
00777                 <span class="keywordflow">else</span> {
00778                     mBuf &amp;= ~((INST_TEMPL_MASK &gt;&gt; 1) &lt;&lt; 1); <span class="comment">// set template to MLI</span>
00779                     mBuf |= 0x4;
00780 
00781                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>(
00782                           (PCHAR)BundleAddress,
00783                           (PCHAR)&amp;mBuf,
00784                           <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE)
00785                           ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00786                         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00787                         <a class="code" href="../../d0/d7/kdp_8h.html#a16">DPRINT</a>((<span class="stringliteral">"KD: write template to 0x%08x failed\n"</span>, KdpBreakpointTable[Index].Address));
00788                         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00789                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00790                     } <span class="keywordflow">else</span> {
00791                         <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x cleared.\n",</span>
00792                          <span class="comment">//   KdpBreakpointTable[Index].Address));</span>
00793                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00794                     }
00795                 }
00796             }
00797             <span class="keywordflow">else</span> {   <span class="comment">// not MOVL</span>
00798                 <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x cleared.\n",</span>
00799                  <span class="comment">//  KdpBreakpointTable[Index].Address));</span>
00800                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00801             }
00802         }
00803     }
00804 <span class="preprocessor">#else</span>
00805 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d1/d7/4_2kdp_8h.html#a110">KdpMoveMemory</a>( (PCHAR)KdpBreakpointTable[Index].Address,
00806                         (PCHAR)&amp;KdpBreakpointTable[Index].Content,
00807                         <span class="keyword">sizeof</span>(KDP_BREAKPOINT_TYPE) ) != <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a4">KDP_BREAKPOINT_TYPE</a>)) {
00808 
00809         <a class="code" href="../../d8/d5/kddata_8c.html#a108">KdpOweBreakpoint</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00810         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a4">KD_BREAKPOINT_NEEDS_REPLACE</a>;
00811         <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x; unable to clear, flag set.\n",</span>
00812             <span class="comment">//KdpBreakpointTable[Index].Address));</span>
00813         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00814     } <span class="keywordflow">else</span> {
00815         <span class="comment">//DPRINT(("KD: Breakpoint at 0x%08x cleared.\n",</span>
00816             <span class="comment">//KdpBreakpointTable[Index].Address));</span>
00817         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00818     }
00819 <span class="preprocessor">#endif</span>
00820 <span class="preprocessor"></span>
00821 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="kdbreak.c::KdpLowWriteContent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KdpLowWriteContent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Index</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="kdbreak.c::KdpRestoreAllBreakpoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpRestoreAllBreakpoints           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l01309">1309</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
<pre class="fragment"><div>01312 {
01313     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01314 
01315     <a class="code" href="../../d8/d5/kddata_8c.html#a86">BreakpointsSuspended</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01316 
01317     <span class="keywordflow">for</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++ ) {
01318 
01319         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>) &amp;&amp;
01320             (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>) ) {
01321 
01322             <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp;= ~<a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>;
01323             <a class="code" href="../../d1/d4/4_2kdbreak_8c.html#a9">KdpLowRestoreBreakpoint</a>(Index);
01324         }
01325     }
01326 
01327     <span class="keywordflow">return</span>;
01328 
01329 } <span class="comment">// KdpRestoreAllBreakpoints</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="kdbreak.c::KdpSuspendAllBreakpoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpSuspendAllBreakpoints           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00972">972</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
<pre class="fragment"><div>00975 {
00976     ULONG <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00977 
00978     <a class="code" href="../../d8/d5/kddata_8c.html#a86">BreakpointsSuspended</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00979 
00980     <span class="keywordflow">for</span> ( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = 1; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> &lt;= BREAKPOINT_TABLE_SIZE; <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>++ ) {
00981         <a class="code" href="../../d1/d7/4_2kdp_8h.html#a138">KdpSuspendBreakpoint</a>(Handle);
00982     }
00983 
00984     <span class="keywordflow">return</span>;
00985 
00986 } <span class="comment">// KdpSuspendAllBreakpoints</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="kdbreak.c::KdpSuspendBreakpoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdpSuspendBreakpoint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Handle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/kdbreak_8c-source.html#l00954">954</a> of file <a class="el" href="../../d1/d3/kdbreak_8c-source.html">kdbreak.c</a>.
<p>
<pre class="fragment"><div>00957 {
00958     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - 1;
00959 
00960     <span class="keywordflow">if</span> ( (<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a1">KD_BREAKPOINT_IN_USE</a>) &amp;&amp;
00961         !(<a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> &amp; <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>) ) {
00962 
00963         <a class="code" href="../../d8/d5/kddata_8c.html#a51">KdpBreakpointTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d3/d5/struct__BREAKPOINT__ENTRY.html#o0">Flags</a> |= <a class="code" href="../../d0/d7/kdp_8h.html#a3">KD_BREAKPOINT_SUSPENDED</a>;
00964         <a class="code" href="../../d1/d4/4_2kdbreak_8c.html#a4">KdpLowWriteContent</a>(Index);
00965     }
00966 
00967     <span class="keywordflow">return</span>;
00968 
00969 } <span class="comment">// KdpSuspendBreakpoint</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="kdbreak.c::KdSetOwedBreakpoints" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KdSetOwedBreakpoints           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
