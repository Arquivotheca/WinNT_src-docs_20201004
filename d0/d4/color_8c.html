<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: color.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>color.c File Reference</h1><code>#include "<a class="el" href="../../d4/d3/mscms_8h-source.html">mscms.h</a>"</code><br>
<code>#include "wingdip.h"</code><br>

<p>
<a href="../../d1/d3/color_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>HTRANSFORM&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a0">InternalCreateColorTransform</a> (<a class="el" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a39">LPLOGCOLORSPACE</a>, HPROFILE, HPROFILE, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a1">InternalRegisterCMM</a> (PTSTR, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, PTSTR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a2">InternalUnregisterCMM</a> (PTSTR, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a3">GetBitmapBytes</a> (BMFORMAT, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HTRANSFORM WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a4">CreateColorTransformA</a> (LPLOGCOLORSPACEA pLogColorSpace, HPROFILE hDestProfile, HPROFILE hTargetProfile, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HTRANSFORM WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a5">CreateColorTransformW</a> (LPLOGCOLORSPACEW pLogColorSpace, HPROFILE hDestProfile, HPROFILE hTargetProfile, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HTRANSFORM WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a6">CreateMultiProfileTransform</a> (PHPROFILE pahProfiles, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nProfiles, PDWORD padwIntent, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nIntents, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> indexPreferredCMM)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a7">DeleteColorTransform</a> (HTRANSFORM hxform)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a8">TranslateColors</a> (HTRANSFORM hxform, PCOLOR paInputColors, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nColors, COLORTYPE ctInput, PCOLOR paOutputColors, COLORTYPE ctOutput)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a9">CheckColors</a> (HTRANSFORM hxform, PCOLOR paInputColors, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nColors, COLORTYPE ctInput, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> paResult)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a10">TranslateBitmapBits</a> (HTRANSFORM hxform, PVOID pSrcBits, BMFORMAT bmInput, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwWidth, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwHeight, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwInputStride, PVOID pDestBits, BMFORMAT bmOutput, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOutputStride, PBMCALLBACKFN pfnCallback, LPARAM ulCallbackData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a11">CheckBitmapBits</a> (HTRANSFORM hxform, PVOID pSrcBits, BMFORMAT bmInput, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwWidth, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwHeight, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwStride, <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> paResult, PBMCALLBACKFN pfnCallback, LPARAM ulCallbackData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a12">GetCMMInfo</a> (HTRANSFORM hxform, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a13">RegisterCMMA</a> (PCSTR pMachineName, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cmmID, PCSTR pCMMdll)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a14">RegisterCMMW</a> (PCWSTR pMachineName, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cmmID, PCWSTR pCMMdll)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a15">UnregisterCMMA</a> (PCSTR pMachineName, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cmmID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a16">UnregisterCMMW</a> (PCWSTR pMachineName, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cmmID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/color_8c.html#a17">SelectCMM</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCMMType)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="color.c::CheckBitmapBits" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI CheckBitmapBits           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HTRANSFORM&nbsp;</td>
          <td class="mdname" nowrap> <em>hxform</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>pSrcBits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BMFORMAT&nbsp;</td>
          <td class="mdname" nowrap> <em>bmInput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwWidth</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwHeight</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwStride</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>paResult</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PBMCALLBACKFN&nbsp;</td>
          <td class="mdname" nowrap> <em>pfnCallback</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>ulCallbackData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00687">687</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01571">GetBitmapBytes()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00698 {
00699     PTRANSFORMOBJ pxformObj;
00700     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>         cbSize;
00701     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>          rc;
00702 
00703     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"CheckBitmapBits\n"</span>)));
00704 
00705     <span class="comment">//</span>
00706     <span class="comment">// Calculate number of bytes input bitmap should be</span>
00707     <span class="comment">//</span>
00708 
00709     <span class="keywordflow">if</span> (dwStride)
00710         cbSize = dwStride*dwHeight;
00711     <span class="keywordflow">else</span>
00712         cbSize = <a class="code" href="../../d0/d4/color_8c.html#a3">GetBitmapBytes</a>(bmInput, dwWidth, dwHeight);
00713 
00714     <span class="comment">//</span>
00715     <span class="comment">// Validate parameters</span>
00716     <span class="comment">//</span>
00717 
00718     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hxform, OBJ_TRANSFORM) ||
00719         cbSize == 0 ||
00720         IsBadReadPtr(pSrcBits, cbSize) ||
00721         IsBadWritePtr(paResult, dwWidth*dwHeight) ||
00722         (pfnCallback &amp;&amp; IsBadCodePtr((FARPROC)pfnCallback)))
00723     {
00724         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to CheckBitmapBits\n"</span>)));
00725         SetLastError(ERROR_INVALID_PARAMETER);
00726         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00727     }
00728 
00729     pxformObj = (PTRANSFORMOBJ)HDLTOPTR(hxform);
00730 
00731     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj != NULL);
00732 
00733     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj-&gt;pCMMObj != NULL);
00734 
00735     rc = pxformObj-&gt;pCMMObj-&gt;fns.pCMCheckRGBs(
00736             pxformObj-&gt;hcmxform,
00737             pSrcBits,
00738             bmInput,
00739             dwWidth,
00740             dwHeight,
00741             dwStride,
00742             paResult,
00743             pfnCallback,
00744             ulCallbackData);
00745 
00746     <span class="keywordflow">return</span> rc;
00747 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="color.c::CheckColors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI CheckColors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HTRANSFORM&nbsp;</td>
          <td class="mdname" nowrap> <em>hxform</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCOLOR&nbsp;</td>
          <td class="mdname" nowrap> <em>paInputColors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nColors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COLORTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>ctInput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>paResult</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00508">508</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00515 {
00516     PTRANSFORMOBJ pxformObj;
00517     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>          rc;
00518 
00519     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"CheckColors\n"</span>)));
00520 
00521     <span class="comment">//</span>
00522     <span class="comment">// Validate parameters</span>
00523     <span class="comment">//</span>
00524 
00525     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hxform, OBJ_TRANSFORM) ||
00526         (nColors == 0) ||
00527         IsBadReadPtr(paInputColors, nColors * <span class="keyword">sizeof</span>(COLOR)) ||
00528         IsBadWritePtr(paResult, nColors * <span class="keyword">sizeof</span>(BYTE)))
00529     {
00530         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to CheckColors\n"</span>)));
00531         SetLastError(ERROR_INVALID_PARAMETER);
00532         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00533     }
00534 
00535     pxformObj = (PTRANSFORMOBJ)HDLTOPTR(hxform);
00536 
00537     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj != NULL);
00538 
00539     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj-&gt;pCMMObj != NULL);
00540 
00541     rc = pxformObj-&gt;pCMMObj-&gt;fns.pCMCheckColors(
00542             pxformObj-&gt;hcmxform,
00543             paInputColors,
00544             nColors,
00545             ctInput,
00546             paResult);
00547 
00548     <span class="keywordflow">return</span> rc;
00549 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="color.c::CreateColorTransformA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HTRANSFORM WINAPI CreateColorTransformA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPLOGCOLORSPACEA&nbsp;</td>
          <td class="mdname" nowrap> <em>pLogColorSpace</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hDestProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hTargetProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00112">112</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>.
<p>
<pre class="fragment"><div>00118 {
00119     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"CreateColorTransformA\n"</span>)));
00120 
00121     <span class="comment">//</span>
00122     <span class="comment">// Internal version is ANSI in Windows 95, call it directly</span>
00123     <span class="comment">//</span>
00124 
00125     <span class="keywordflow">return</span> <a class="code" href="../../d0/d4/color_8c.html#a0">InternalCreateColorTransform</a>(pLogColorSpace, hDestProfile, hTargetProfile, dwFlags);
00126 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="color.c::CreateColorTransformW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HTRANSFORM WINAPI CreateColorTransformW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPLOGCOLORSPACEW&nbsp;</td>
          <td class="mdname" nowrap> <em>pLogColorSpace</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hDestProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>hTargetProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00129">129</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01176">InternalCreateColorTransform()</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00135 {
00136     LOGCOLORSPACEA  aLCS;
00137     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            bUsedDefaultChar;
00138 
00139     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"CreateColorTransformW\n"</span>)));
00140 
00141     <span class="comment">//</span>
00142     <span class="comment">// Validate parameter before we touch it</span>
00143     <span class="comment">//</span>
00144 
00145     <span class="keywordflow">if</span> (IsBadReadPtr(pLogColorSpace, <span class="keyword">sizeof</span>(LOGCOLORSPACEW)))
00146     {
00147         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to CreateColorTransform\n"</span>)));
00148         SetLastError(ERROR_INVALID_PARAMETER);
00149         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00150     }
00151 
00152     CopyMemory(&amp;aLCS, pLogColorSpace, <span class="keyword">sizeof</span>(LOGCOLORSPACEA));
00153     aLCS.lcsSize = <span class="keyword">sizeof</span>(LOGCOLORSPACEA);
00154 
00155     <span class="comment">//</span>
00156     <span class="comment">// Convert filename to ANSI and call the internal version</span>
00157     <span class="comment">//</span>
00158 
00159     <span class="keywordflow">if</span> (! WideCharToMultiByte(CP_ACP, 0, pLogColorSpace-&gt;lcsFilename, -1,
00160         aLCS.lcsFilename, MAX_PATH, NULL, &amp;bUsedDefaultChar) ||
00161         bUsedDefaultChar)
00162     {
00163         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Error converting LogColorSpace filename to ANSI\n"</span>)));
00164         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00165     }
00166 
00167     <span class="keywordflow">return</span> <a class="code" href="../../d0/d4/color_8c.html#a0">InternalCreateColorTransform</a>(&amp;aLCS, hDestProfile, hTargetProfile, dwFlags);
00168 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="color.c::CreateMultiProfileTransform" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HTRANSFORM WINAPI CreateMultiProfileTransform           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PHPROFILE&nbsp;</td>
          <td class="mdname" nowrap> <em>pahProfiles</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nProfiles</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>padwIntent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nIntents</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>indexPreferredCMM</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00194">194</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d3/d0/object_8c-source.html#l00046">AllocateHeapObject()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00102">FreeHeapObject()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00826">GetPreferredCMM()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00149">RIP</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00141">TERSE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00202 {
00203     PPROFOBJ      pProfObj;
00204     PCMMOBJ       pCMMObj = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00205     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>         cmmID;
00206     HTRANSFORM    hxform = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00207     PTRANSFORMOBJ pxformObj;
00208     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>         i;
00209 
00210     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"CreateMultiProfileTransform\n"</span>)));
00211 
00212     <span class="comment">//</span>
00213     <span class="comment">// Validate parameters</span>
00214     <span class="comment">//</span>
00215 
00216     <span class="keywordflow">if</span> (nProfiles &lt; 1 ||
00217         indexPreferredCMM &gt; nProfiles ||
00218         IsBadReadPtr(pahProfiles, nProfiles * <span class="keyword">sizeof</span>(HANDLE)) ||
00219         padwIntent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00220         ((nIntents != nProfiles) &amp;&amp; (nIntents != 1)) ||
00221         IsBadReadPtr(padwIntent, nIntents * <span class="keyword">sizeof</span>(DWORD)))
00222     {
00223         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to CreateMultiProfileTransform\n"</span>)));
00224         SetLastError(ERROR_INVALID_PARAMETER);
00225         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00226     }
00227 
00228     <span class="keywordflow">for</span> (i=0; i&lt;nProfiles; i++)
00229     {
00230         <span class="keywordflow">if</span> (pahProfiles[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00231             ! <a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(pahProfiles[i], OBJ_PROFILE))
00232         {
00233             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to CreateMultiProfileTransform\n"</span>)));
00234             SetLastError(ERROR_INVALID_PARAMETER);
00235             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00236         }
00237 
00238         pProfObj = (PPROFOBJ)HDLTOPTR(pahProfiles[i]);
00239 
00240         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj != NULL);
00241 
00242         <span class="comment">//</span>
00243         <span class="comment">// Quick check on the integrity of the profile</span>
00244         <span class="comment">//</span>
00245 
00246         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pProfObj))
00247         {
00248             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile passed to CreateMultiProfileTransform\n"</span>)));
00249             SetLastError(ERROR_INVALID_PROFILE);
00250             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00251         }
00252 
00253         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pProfObj-&gt;pView != NULL);
00254 
00255         <span class="keywordflow">if</span> (i+1 == indexPreferredCMM)
00256         {
00257             <span class="comment">//</span>
00258             <span class="comment">// Get ID of preferred CMM</span>
00259             <span class="comment">//</span>
00260 
00261             cmmID = HEADER(pProfObj)-&gt;phCMMType;
00262             cmmID = FIX_ENDIAN(cmmID);
00263         }
00264     }
00265 
00266     <span class="keywordflow">if</span> (indexPreferredCMM == INDEX_DONT_CARE)
00267     {
00268         pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a15">GetPreferredCMM</a>();
00269     }
00270     <span class="keywordflow">else</span>
00271     {
00272         <span class="comment">//</span>
00273         <span class="comment">// Get CMM associated with preferred profile</span>
00274         <span class="comment">//</span>
00275 
00276         pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(cmmID);
00277     }
00278 
00279     <span class="comment">//</span>
00280     <span class="comment">// Finally try Windows default CMM</span>
00281     <span class="comment">//</span>
00282 
00283     <span class="keywordflow">if</span> (!pCMMObj)
00284     {
00285         pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
00286         <span class="keywordflow">if</span> (!pCMMObj)
00287         {
00288             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a9">RIP</a>((__TEXT(<span class="stringliteral">"Default CMM not found\n"</span>)));
00289             SetLastError(ERROR_INVALID_CMM);
00290             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00291         }
00292     }
00293 
00294     <span class="comment">//</span>
00295     <span class="comment">// Allocate an object on the heap for the transform</span>
00296     <span class="comment">//</span>
00297 
00298     hxform = <a class="code" href="../../d2/d1/object_8c.html#a3">AllocateHeapObject</a>(OBJ_TRANSFORM);
00299     <span class="keywordflow">if</span> (!hxform)
00300     {
00301         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not allocate transform object\n"</span>)));
00302         SetLastError(ERROR_NOT_ENOUGH_MEMORY);
00303         <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
00304         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00305     }
00306 
00307     pxformObj = (PTRANSFORMOBJ)HDLTOPTR(hxform);
00308 
00309     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj != NULL);
00310 
00311     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pCMMObj-&gt;fns.pCMCreateMultiProfileTransform != NULL);
00312 
00313     pxformObj-&gt;pCMMObj = pCMMObj;
00314     pxformObj-&gt;objHdr.dwUseCount = 1;
00315 
00316     pxformObj-&gt;hcmxform = pCMMObj-&gt;fns.pCMCreateMultiProfileTransform(
00317                             pahProfiles,
00318                             nProfiles,
00319                             padwIntent,
00320                             nIntents,
00321                             dwFlags);
00322 
00323     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMCreateMultiProfileTransform returned 0x%x\n"</span>), pxformObj-&gt;hcmxform));
00324 
00325     <span class="comment">//</span>
00326     <span class="comment">// If return value from CMM is less than 256, then it is an error code</span>
00327     <span class="comment">//</span>
00328 
00329     <span class="keywordflow">if</span> (pxformObj-&gt;hcmxform &lt;= TRANSFORM_ERROR)
00330     {
00331         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"CMCreateMultiProfileTransform failed\n"</span>)));
00332         <span class="keywordflow">if</span> (GetLastError() == ERROR_SUCCESS)
00333         {
00334             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"CMM did not set error code\n"</span>)));
00335             SetLastError(ERROR_INVALID_PROFILE);
00336         }
00337         <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pxformObj-&gt;pCMMObj);
00338         pxformObj-&gt;objHdr.dwUseCount--;        <span class="comment">// decrement before freeing</span>
00339         <a class="code" href="../../d2/d1/object_8c.html#a4">FreeHeapObject</a>(hxform);
00340         hxform = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00341     }
00342 
00343     <span class="keywordflow">return</span> hxform;
00344 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="color.c::DeleteColorTransform" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI DeleteColorTransform           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HTRANSFORM&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hxform</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00363">363</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00102">FreeHeapObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00366 {
00367     PTRANSFORMOBJ pxformObj;
00368     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>          rc;
00369 
00370     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"DeleteColorTransform\n"</span>)));
00371 
00372     <span class="comment">//</span>
00373     <span class="comment">// Validate parameters</span>
00374     <span class="comment">//</span>
00375 
00376     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hxform, OBJ_TRANSFORM))
00377     {
00378         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to DeleteColorTransform\n"</span>)));
00379         SetLastError(ERROR_INVALID_PARAMETER);
00380         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00381     }
00382 
00383     pxformObj = (PTRANSFORMOBJ)HDLTOPTR(hxform);
00384 
00385     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj != NULL);
00386 
00387     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj-&gt;objHdr.dwUseCount &gt; 0);
00388 
00389     <span class="comment">//</span>
00390     <span class="comment">// Decrease  object count, and delete if it goes to zero.</span>
00391     <span class="comment">// The following code retains the object and returns failure if the CMM</span>
00392     <span class="comment">// fails the delete transform operation.</span>
00393     <span class="comment">//</span>
00394 
00395     pxformObj-&gt;objHdr.dwUseCount--;
00396 
00397     <span class="keywordflow">if</span> (pxformObj-&gt;objHdr.dwUseCount == 0)
00398     {
00399         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj-&gt;pCMMObj != NULL);
00400 
00401         rc = pxformObj-&gt;pCMMObj-&gt;fns.pCMDeleteTransform(pxformObj-&gt;hcmxform);
00402         <span class="keywordflow">if</span> (!rc)
00403         {
00404             pxformObj-&gt;objHdr.dwUseCount++;     <span class="comment">// set count back</span>
00405             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00406         }
00407         <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pxformObj-&gt;pCMMObj);
00408         <a class="code" href="../../d2/d1/object_8c.html#a4">FreeHeapObject</a>(hxform);
00409     }
00410 
00411     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00412 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="color.c::GetBitmapBytes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetBitmapBytes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BMFORMAT&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l01571">1571</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/color_8c-source.html#l00687">CheckBitmapBits()</a>, and <a class="el" href="../../d1/d3/color_8c-source.html#l00583">TranslateBitmapBits()</a>.
<p>
<pre class="fragment"><div>01576 {
01577     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nBytes;
01578 
01579     <span class="keywordflow">switch</span> (bmFmt)
01580     {
01581     <span class="comment">//</span>
01582     <span class="comment">// 1 byte per pixel</span>
01583     <span class="comment">//</span>
01584 
01585     <span class="keywordflow">case</span> BM_GRAY:
01586         nBytes = dwWidth;
01587         <span class="keywordflow">break</span>;
01588 
01589     <span class="comment">//</span>
01590     <span class="comment">// 2 bytes per pixel</span>
01591     <span class="comment">//</span>
01592 
01593     <span class="keywordflow">case</span> BM_x555RGB:
01594     <span class="keywordflow">case</span> BM_x555XYZ:
01595     <span class="keywordflow">case</span> BM_x555Yxy:
01596     <span class="keywordflow">case</span> BM_x555Lab:
01597     <span class="keywordflow">case</span> BM_x555G3CH:
01598     <span class="keywordflow">case</span> BM_16b_GRAY:
01599     <span class="keywordflow">case</span> BM_565RGB:
01600         nBytes = dwWidth*2;
01601         <span class="keywordflow">break</span>;
01602 
01603     <span class="comment">//</span>
01604     <span class="comment">// 3 bytes per pixel</span>
01605     <span class="comment">//</span>
01606 
01607     <span class="keywordflow">case</span> BM_BGRTRIPLETS:
01608     <span class="keywordflow">case</span> BM_RGBTRIPLETS:
01609     <span class="keywordflow">case</span> BM_XYZTRIPLETS:
01610     <span class="keywordflow">case</span> BM_YxyTRIPLETS:
01611     <span class="keywordflow">case</span> BM_LabTRIPLETS:
01612     <span class="keywordflow">case</span> BM_G3CHTRIPLETS:
01613         nBytes = dwWidth*3;
01614         <span class="keywordflow">break</span>;
01615 
01616     <span class="comment">//</span>
01617     <span class="comment">// 4 bytes per pixel</span>
01618     <span class="comment">//</span>
01619 
01620     <span class="keywordflow">case</span> BM_xRGBQUADS:
01621     <span class="keywordflow">case</span> BM_xBGRQUADS:
01622 <span class="preprocessor">    #if 0</span>
01623 <span class="preprocessor"></span>    <span class="keywordflow">case</span> BM_xXYZQUADS:
01624     <span class="keywordflow">case</span> BM_xYxyQUADS:
01625     <span class="keywordflow">case</span> BM_xLabQUADS:
01626 <span class="preprocessor">    #endif</span>
01627 <span class="preprocessor"></span>    <span class="keywordflow">case</span> BM_xG3CHQUADS:
01628     <span class="keywordflow">case</span> BM_KYMCQUADS:
01629     <span class="keywordflow">case</span> BM_CMYKQUADS:
01630     <span class="keywordflow">case</span> BM_10b_RGB:
01631     <span class="keywordflow">case</span> BM_10b_XYZ:
01632     <span class="keywordflow">case</span> BM_10b_Yxy:
01633     <span class="keywordflow">case</span> BM_10b_Lab:
01634     <span class="keywordflow">case</span> BM_10b_G3CH:
01635     <span class="keywordflow">case</span> BM_NAMED_INDEX:
01636         nBytes = dwWidth*4;
01637         <span class="keywordflow">break</span>;
01638 
01639     <span class="comment">//</span>
01640     <span class="comment">// 5 bytes per pixel</span>
01641     <span class="comment">//</span>
01642 
01643     <span class="keywordflow">case</span> BM_5CHANNEL:
01644         nBytes = dwWidth*5;
01645         <span class="keywordflow">break</span>;
01646 
01647     <span class="comment">//</span>
01648     <span class="comment">// 6 bytes per pixel</span>
01649     <span class="comment">//</span>
01650 
01651     <span class="keywordflow">case</span> BM_16b_RGB:
01652     <span class="keywordflow">case</span> BM_16b_XYZ:
01653     <span class="keywordflow">case</span> BM_16b_Yxy:
01654     <span class="keywordflow">case</span> BM_16b_Lab:
01655     <span class="keywordflow">case</span> BM_16b_G3CH:
01656     <span class="keywordflow">case</span> BM_6CHANNEL:
01657         nBytes = dwWidth*6;
01658         <span class="keywordflow">break</span>;
01659 
01660     <span class="comment">//</span>
01661     <span class="comment">// 7 bytes per pixel</span>
01662     <span class="comment">//</span>
01663 
01664     <span class="keywordflow">case</span> BM_7CHANNEL:
01665         nBytes = dwWidth*7;
01666         <span class="keywordflow">break</span>;
01667 
01668     <span class="comment">//</span>
01669     <span class="comment">// 8 bytes per pixel</span>
01670     <span class="comment">//</span>
01671 
01672     <span class="keywordflow">case</span> BM_8CHANNEL:
01673         nBytes = dwWidth*8;
01674         <span class="keywordflow">break</span>;
01675 
01676     <span class="comment">//</span>
01677     <span class="comment">// Error case</span>
01678     <span class="comment">//</span>
01679 
01680     <span class="keywordflow">default</span>:
01681         nBytes = 0;
01682         <span class="keywordflow">break</span>;
01683     }
01684 
01685     <span class="comment">//</span>
01686     <span class="comment">// Align to DWORD boundary</span>
01687     <span class="comment">//</span>
01688 
01689     nBytes = (nBytes + 3) &amp; ~3;
01690 
01691     <span class="keywordflow">return</span> nBytes*dwHeight;
01692 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="color.c::GetCMMInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> WINAPI GetCMMInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HTRANSFORM&nbsp;</td>
          <td class="mdname" nowrap> <em>hxform</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00773">773</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d5/mscmm_2icm32_8c-source.html#l00031">CMM_DLL_VERSION</a>, <a class="el" href="../../d9/d5/mscmm_2icm32_8c-source.html#l00029">CMM_IDENT</a>, <a class="el" href="../../d9/d5/mscmm_2icm32_8c-source.html#l00028">CMM_WIN_VERSION</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00777 {
00778     PTRANSFORMOBJ pxformObj;
00779     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>          rc;
00780 
00781     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"GetCMMInfo\n"</span>)));
00782 
00783     <span class="comment">//</span>
00784     <span class="comment">// Validate parameters</span>
00785     <span class="comment">//</span>
00786 
00787     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hxform, OBJ_TRANSFORM) ||
00788         (dwInfo != <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a0">CMM_WIN_VERSION</a> &amp;&amp;
00789          dwInfo != <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a3">CMM_DLL_VERSION</a> &amp;&amp;
00790          dwInfo != <a class="code" href="../../d8/d6/mscmm_2icm32_8c.html#a1">CMM_IDENT</a>
00791          )
00792         )
00793     {
00794         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to GetCMMInfo\n"</span>)));
00795         SetLastError(ERROR_INVALID_PARAMETER);
00796         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00797     }
00798 
00799     pxformObj = (PTRANSFORMOBJ)HDLTOPTR(hxform);
00800 
00801     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj != NULL);
00802 
00803     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj-&gt;pCMMObj != NULL);
00804 
00805     rc = pxformObj-&gt;pCMMObj-&gt;fns.pCMGetInfo(dwInfo);
00806 
00807     <span class="keywordflow">return</span> rc;
00808 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="color.c::InternalCreateColorTransform" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HTRANSFORM InternalCreateColorTransform           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d6/jul98_2test_2icm_8h.html#a39">LPLOGCOLORSPACE</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HPROFILE&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HPROFILE&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l01176">1176</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d3/d0/object_8c-source.html#l00046">AllocateHeapObject()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00102">FreeHeapObject()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00826">GetPreferredCMM()</a>, <a class="el" href="../../d2/d5/aug98_2dll32_2icm_8h-source.html#l00033">LCS_DEVICE_CMYK</a>, <a class="el" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a38">LOGCOLORSPACE</a>, <a class="el" href="../../d2/d5/aug98_2dll32_2icm_8h-source.html#l00077">LPLOGCOLORSPACE</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00205">MemAlloc()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00260">MemFree()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00865">ReleaseColorMatchingModule()</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00149">RIP</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00141">TERSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00176">ValidProfile()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/color_8c-source.html#l00112">CreateColorTransformA()</a>, and <a class="el" href="../../d1/d3/color_8c-source.html#l00129">CreateColorTransformW()</a>.
<p>
<pre class="fragment"><div>01182 {
01183     PPROFOBJ         pDestProfObj, pTargetProfObj = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01184     PCMMOBJ          pCMMObj;
01185     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>            cmmID;
01186     HTRANSFORM       hxform = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01187     PTRANSFORMOBJ    pxformObj;
01188     <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a39">LPLOGCOLORSPACE</a>  pLCS;
01189 
01190     <span class="comment">//</span>
01191     <span class="comment">// Validate parameters</span>
01192     <span class="comment">//</span>
01193 
01194     <span class="keywordflow">if</span> (!pLogColorSpace ||
01195         IsBadReadPtr(pLogColorSpace, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d0/structtagLOGCOLORSPACE.html">LOGCOLORSPACE</a>)) ||
01196         pLogColorSpace-&gt;lcsSignature !=  LCS_SIGNATURE ||
01197         pLogColorSpace-&gt;lcsVersion &lt; 0x00000400 ||
01198         !hDestProfile ||
01199         !<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hDestProfile, OBJ_PROFILE) ||
01200         ((hTargetProfile != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
01201          !<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hTargetProfile, OBJ_PROFILE)
01202         )
01203        )
01204     {
01205         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to CreateColorTransform\n"</span>)));
01206         SetLastError(ERROR_INVALID_PARAMETER);
01207         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01208     }
01209 
01210     <span class="comment">//</span>
01211     <span class="comment">// Allocate LogColorSpace and copy incoming data.</span>
01212     <span class="comment">// Leave space for passing in two handles below it</span>
01213     <span class="comment">//</span>
01214 
01215     pLCS = (<a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a39">LPLOGCOLORSPACE</a>)<a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d0/structtagLOGCOLORSPACE.html">LOGCOLORSPACE</a>) + 2*<span class="keyword">sizeof</span>(HPROFILE));
01216     <span class="keywordflow">if</span> (!pLCS)
01217     {
01218         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not allocate LogColorSpace"</span>)));
01219         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01220     }
01221     CopyMemory((PVOID)pLCS, (PVOID)pLogColorSpace, <span class="keyword">sizeof</span>(LOGCOLORSPACE));
01222 
01223     <span class="comment">//</span>
01224     <span class="comment">// Copy handles below this structure</span>
01225     <span class="comment">//</span>
01226 
01227     *((PHPROFILE)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLCS+<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a38">LOGCOLORSPACE</a>))) = hDestProfile;
01228     *((PHPROFILE)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLCS+<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a38">LOGCOLORSPACE</a>)+<span class="keyword">sizeof</span>(HPROFILE))) = hTargetProfile;
01229 
01230     <span class="comment">//</span>
01231     <span class="comment">// If input color space is a predefined color space,</span>
01232     <span class="comment">// find the right profile to use</span>
01233     <span class="comment">//</span>
01234 
01235     <span class="keywordflow">if</span> (pLCS-&gt;lcsCSType &gt; <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a19">LCS_DEVICE_CMYK</a>)
01236     {
01237         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbSize = <a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>;
01238 
01239         <span class="keywordflow">if</span> (! GetStandardColorSpaceProfile(NULL, pLCS-&gt;lcsCSType,
01240                 pLCS-&gt;lcsFilename, &amp;cbSize))
01241         {
01242             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not get profile for predefined color space 0x%x\n"</span>), pLCS-&gt;lcsCSType));
01243             <span class="keywordflow">goto</span> EndCreateColorTransform;
01244         }
01245     }
01246 
01247     pDestProfObj = (PPROFOBJ)HDLTOPTR(hDestProfile);
01248 
01249     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pDestProfObj != NULL);
01250 
01251     <span class="comment">//</span>
01252     <span class="comment">// Quick check on the integrity of the profile before calling the CMM</span>
01253     <span class="comment">//</span>
01254 
01255     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pDestProfObj))
01256     {
01257         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid dest profile passed to CreateColorTransform\n"</span>)));
01258         SetLastError(ERROR_INVALID_PROFILE);
01259         <span class="keywordflow">goto</span> EndCreateColorTransform;
01260     }
01261 
01262     <span class="comment">//</span>
01263     <span class="comment">// If target profile is given, get the profile object and check integrity</span>
01264     <span class="comment">//</span>
01265 
01266     <span class="keywordflow">if</span> (hTargetProfile)
01267     {
01268         pTargetProfObj = (PPROFOBJ)HDLTOPTR(hTargetProfile);
01269 
01270         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pTargetProfObj != NULL);
01271 
01272         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a6">ValidProfile</a>(pTargetProfObj))
01273         {
01274             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid target profile passed to CreateColorTransform\n"</span>)));
01275             SetLastError(ERROR_INVALID_PROFILE);
01276             <span class="keywordflow">goto</span> EndCreateColorTransform;
01277         }
01278     }
01279 
01280     <span class="comment">//</span>
01281     <span class="comment">// Check if application specified CMM is present</span>
01282     <span class="comment">//</span>
01283 
01284     pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a15">GetPreferredCMM</a>();
01285     <span class="keywordflow">if</span> (!pCMMObj)
01286     {
01287         <span class="comment">//</span>
01288         <span class="comment">// Get CMM associated with destination profile. If it does not exist,</span>
01289         <span class="comment">// get default CMM.</span>
01290         <span class="comment">//</span>
01291 
01292         cmmID = HEADER(pDestProfObj)-&gt;phCMMType;
01293         cmmID = FIX_ENDIAN(cmmID);
01294 
01295         pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(cmmID);
01296         <span class="keywordflow">if</span> (!pCMMObj)
01297         {
01298             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMM associated with profile could not be found"</span>)));
01299 
01300             pCMMObj = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(CMM_WINDOWS_DEFAULT);
01301             <span class="keywordflow">if</span> (!pCMMObj)
01302             {
01303                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a9">RIP</a>((__TEXT(<span class="stringliteral">"Default CMM not found\n"</span>)));
01304                 SetLastError(ERROR_INVALID_CMM);
01305                 <span class="keywordflow">goto</span> EndCreateColorTransform;
01306             }
01307         }
01308     }
01309 
01310     <span class="comment">//</span>
01311     <span class="comment">// Allocate an object on the heap for the transform</span>
01312     <span class="comment">//</span>
01313 
01314     hxform = <a class="code" href="../../d2/d1/object_8c.html#a3">AllocateHeapObject</a>(OBJ_TRANSFORM);
01315     <span class="keywordflow">if</span> (!hxform)
01316     {
01317         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not allocate transform object\n"</span>)));
01318         SetLastError(ERROR_NOT_ENOUGH_MEMORY);
01319         <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pCMMObj);
01320         <span class="keywordflow">goto</span> EndCreateColorTransform;
01321     }
01322 
01323     pxformObj = (PTRANSFORMOBJ)HDLTOPTR(hxform);
01324 
01325     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj != NULL);
01326 
01327     <span class="comment">//</span>
01328     <span class="comment">// Call into CMM to create a color transform</span>
01329     <span class="comment">//</span>
01330 
01331     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pCMMObj-&gt;fns.pCMCreateTransformExt != NULL);
01332 
01333     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pDestProfObj-&gt;pView != NULL);
01334 
01335     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!pTargetProfObj || pTargetProfObj-&gt;pView);
01336 
01337     pxformObj-&gt;pCMMObj = pCMMObj;
01338     pxformObj-&gt;objHdr.dwUseCount = 1;
01339 
01340     pxformObj-&gt;hcmxform = pCMMObj-&gt;fns.pCMCreateTransformExt(
01341                             pLCS,
01342                             pDestProfObj-&gt;pView,
01343                             pTargetProfObj ? pTargetProfObj-&gt;pView : NULL,
01344                             dwFlags);
01345 
01346     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a3">TERSE</a>((__TEXT(<span class="stringliteral">"CMCreateTransform returned 0x%x\n"</span>), pxformObj-&gt;hcmxform));
01347 
01348     <span class="comment">//</span>
01349     <span class="comment">// If return value from CMM is less than 256, then it is an error code</span>
01350     <span class="comment">//</span>
01351 
01352     <span class="keywordflow">if</span> (pxformObj-&gt;hcmxform &lt;= TRANSFORM_ERROR)
01353     {
01354         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"CMCreateTransform failed\n"</span>)));
01355         <span class="keywordflow">if</span> (GetLastError() == ERROR_SUCCESS)
01356         {
01357             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"CMM did not set error code\n"</span>)));
01358             SetLastError(ERROR_INVALID_PROFILE);
01359         }
01360         <a class="code" href="../../d2/d1/object_8c.html#a16">ReleaseColorMatchingModule</a>(pxformObj-&gt;pCMMObj);
01361         pxformObj-&gt;objHdr.dwUseCount--;        <span class="comment">// decrement before freeing</span>
01362         <a class="code" href="../../d2/d1/object_8c.html#a4">FreeHeapObject</a>(hxform);
01363         hxform = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01364     }
01365 
01366 EndCreateColorTransform:
01367     <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(pLCS);
01368 
01369     <span class="keywordflow">return</span> hxform;
01370 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="color.c::InternalRegisterCMM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InternalRegisterCMM           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PTSTR&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTSTR&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l01391">1391</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00143">ERR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00083">gszICMatcher</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00477">ValidColorMatchingModule()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/color_8c-source.html#l00903">RegisterCMMA()</a>, and <a class="el" href="../../d1/d3/color_8c-source.html#l00919">RegisterCMMW()</a>.
<p>
<pre class="fragment"><div>01396 {
01397     PCMMOBJ   pCMMObj;
01398     HKEY      hkCMM;
01399     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     dwErr;
01400     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>      rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01401     <span class="keywordtype">int</span>       i;
01402     TCHAR     szCMMID[5];
01403 
01404     <span class="comment">//</span>
01405     <span class="comment">// Validate parameters</span>
01406     <span class="comment">//</span>
01407 
01408     <span class="keywordflow">if</span> (!pCMMdll || IsBadReadPtr(pCMMdll, lstrlen(pCMMdll)*<span class="keyword">sizeof</span>(TCHAR)))
01409     {
01410         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to RegisterCMM\n"</span>)));
01411         SetLastError(ERROR_INVALID_PARAMETER);
01412         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01413     }
01414 
01415 
01416     <span class="comment">//</span>
01417     <span class="comment">// Only local installs are allowed now</span>
01418     <span class="comment">//</span>
01419 
01420     <span class="keywordflow">if</span> (pMachineName)
01421     {
01422         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Remote CMM registration attempted, failing...\n"</span>)));
01423         SetLastError(ERROR_INVALID_PARAMETER);
01424         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01425     }
01426 
01427     <span class="comment">//</span>
01428     <span class="comment">// Check if the CMM actually exists, and it's valid CMM</span>
01429     <span class="comment">//</span>
01430 
01431     rc = <a class="code" href="../../d2/d1/object_8c.html#a13">ValidColorMatchingModule</a>(cmmID,pCMMdll);
01432 
01433     <span class="keywordflow">if</span> (rc)
01434     {
01435         <span class="comment">//</span>
01436         <span class="comment">// Open the registry key for ICMatchers</span>
01437         <span class="comment">//</span>
01438 
01439         <span class="keywordflow">if</span> ((dwErr = RegCreateKey(HKEY_LOCAL_MACHINE, gszICMatcher, &amp;hkCMM)) != ERROR_SUCCESS)
01440         {
01441             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a5">ERR</a>((__TEXT(<span class="stringliteral">"Could not open ICMatcher registry key: %d\n"</span>), dwErr));
01442             SetLastError(dwErr);
01443             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01444         }
01445 
01446         <span class="comment">//</span>
01447         <span class="comment">// Make a string with the CMM ID</span>
01448         <span class="comment">//</span>
01449 
01450         <span class="keywordflow">for</span> (i=0; i&lt;4; i++)
01451         {
01452             szCMMID[i]  = (TCHAR)(((<span class="keywordtype">char</span>*)&amp;cmmID)[3-i]);
01453         }
01454         szCMMID[4] = <span class="charliteral">'\0'</span>;
01455 
01456         <span class="comment">//</span>
01457         <span class="comment">// Set the file name of the CMM dll in the registry</span>
01458         <span class="comment">//</span>
01459 
01460         <span class="keywordflow">if</span> ((dwErr = RegSetValueEx(hkCMM, (PTSTR)szCMMID, 0, REG_SZ, (BYTE *)pCMMdll,
01461             (lstrlen(pCMMdll)+1)*<span class="keyword">sizeof</span>(TCHAR))) != ERROR_SUCCESS)
01462         {
01463             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not set CMM dll in the registry %s: %d\n"</span>), szCMMID, dwErr));
01464             SetLastError(dwErr);
01465             rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01466         }
01467 
01468         RegCloseKey(hkCMM);
01469     }
01470 
01471     <span class="keywordflow">return</span> rc;
01472 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="color.c::InternalUnregisterCMM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL InternalUnregisterCMM           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PTSTR&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l01494">1494</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00143">ERR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00083">gszICMatcher</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/color_8c-source.html#l01050">UnregisterCMMA()</a>, and <a class="el" href="../../d1/d3/color_8c-source.html#l01065">UnregisterCMMW()</a>.
<p>
<pre class="fragment"><div>01498 {
01499     HKEY      hkCMM;
01500     TCHAR     szCMMID[5];
01501     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     dwErr;
01502     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>      rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01503 
01504     <span class="comment">//</span>
01505     <span class="comment">// Only local installs are allowed now</span>
01506     <span class="comment">//</span>
01507 
01508     <span class="keywordflow">if</span> (pMachineName)
01509     {
01510         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Remote CMM unregistration attempted, failing...\n"</span>)));
01511         SetLastError(ERROR_INVALID_PARAMETER);
01512         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01513     }
01514 
01515     <span class="comment">//</span>
01516     <span class="comment">// Open the registry key for ICMatchers</span>
01517     <span class="comment">//</span>
01518 
01519     <span class="keywordflow">if</span> ((dwErr = RegOpenKey(HKEY_LOCAL_MACHINE, gszICMatcher, &amp;hkCMM)) != ERROR_SUCCESS)
01520     {
01521         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a5">ERR</a>((__TEXT(<span class="stringliteral">"Could not open ICMatcher registry key: %d\n"</span>), dwErr));
01522         SetLastError(dwErr);
01523         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01524     }
01525 
01526     <span class="comment">//</span>
01527     <span class="comment">// Make a string with the CMM ID</span>
01528     <span class="comment">//</span>
01529 
01530     szCMMID[0] = ((<span class="keywordtype">char</span> *)&amp;cmmID)[3];
01531     szCMMID[1] = ((<span class="keywordtype">char</span> *)&amp;cmmID)[2];
01532     szCMMID[2] = ((<span class="keywordtype">char</span> *)&amp;cmmID)[1];
01533     szCMMID[3] = ((<span class="keywordtype">char</span> *)&amp;cmmID)[0];
01534     szCMMID[4] = <span class="charliteral">'\0'</span>;
01535 
01536     <span class="comment">//</span>
01537     <span class="comment">// Delete the file name of the CMM dll from the registry</span>
01538     <span class="comment">//</span>
01539 
01540     <span class="keywordflow">if</span> ((dwErr = RegDeleteValue(hkCMM, (PTSTR)szCMMID)) != ERROR_SUCCESS)
01541     {
01542         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Could not delete CMM dll from the registry %s: %d\n"</span>), szCMMID, dwErr));
01543         SetLastError(dwErr);
01544         rc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01545     }
01546 
01547     RegCloseKey(hkCMM);
01548 
01549     <span class="keywordflow">return</span> rc;
01550 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="color.c::RegisterCMMA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI RegisterCMMA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pMachineName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cmmID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pCMMdll</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00903">903</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01391">InternalRegisterCMM()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>.
<p>
<pre class="fragment"><div>00908 {
00909     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"RegisterCMMA\n"</span>)));
00910 
00911     <span class="comment">//</span>
00912     <span class="comment">// Internal version is ANSI in Windows 95, call it directly</span>
00913     <span class="comment">//</span>
00914 
00915     <span class="keywordflow">return</span> <a class="code" href="../../d0/d4/color_8c.html#a1">InternalRegisterCMM</a>((PSTR)pMachineName, cmmID, (PSTR)pCMMdll);
00916 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="color.c::RegisterCMMW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI RegisterCMMW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pMachineName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cmmID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pCMMdll</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00919">919</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00419">ConvertToAnsi()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01391">InternalRegisterCMM()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00260">MemFree()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00924 {
00925     PSTR  pszMachineName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;    <span class="comment">// Ansi machine name</span>
00926     PSTR  pszCMMdll = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;         <span class="comment">// Ansi CMM dll path</span>
00927     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;                <span class="comment">// return code</span>
00928 
00929     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"RegisterCMMW\n"</span>)));
00930 
00931     <span class="comment">//</span>
00932     <span class="comment">// Convert machine name to Ansi</span>
00933     <span class="comment">//</span>
00934 
00935     <span class="keywordflow">if</span> (pMachineName)
00936     {
00937         rc = <a class="code" href="../../d2/d1/object_8c.html#a12">ConvertToAnsi</a>(pMachineName, &amp;pszMachineName, TRUE);
00938     }
00939     <span class="keywordflow">else</span>
00940         pszMachineName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00941 
00942     <span class="comment">//</span>
00943     <span class="comment">// Convert pCMMdll to Ansi</span>
00944     <span class="comment">//</span>
00945 
00946     rc = rc &amp;&amp; <a class="code" href="../../d2/d1/object_8c.html#a12">ConvertToAnsi</a>(pCMMdll, &amp;pszCMMdll, TRUE);
00947 
00948     <span class="comment">//</span>
00949     <span class="comment">// Call the internal Ansi function</span>
00950     <span class="comment">//</span>
00951 
00952     rc = rc &amp;&amp; <a class="code" href="../../d0/d4/color_8c.html#a1">InternalRegisterCMM</a>(pszMachineName, cmmID, pszCMMdll);
00953 
00954     <span class="comment">//</span>
00955     <span class="comment">// Free memory before leaving</span>
00956     <span class="comment">//</span>
00957 
00958     <span class="keywordflow">if</span> (pszMachineName)
00959     {
00960         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(pszMachineName);
00961     }
00962 
00963     <span class="keywordflow">if</span> (pszCMMdll)
00964     {
00965         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(pszCMMdll);
00966     }
00967 
00968     <span class="keywordflow">return</span> rc;
00969 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="color.c::SelectCMM" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI SelectCMM           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dwCMMType</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l01122">1122</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00114">critsec</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00564">GetColorMatchingModule()</a>, <a class="el" href="../../d2/d5/ntgdi_2icm_2mscms_2globals_8c-source.html#l00037">gpPreferredCMM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01125 {
01126     PCMMOBJ pCMMObj = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01127 
01128     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"SelectCMM\n"</span>)));
01129 
01130     <span class="keywordflow">if</span> (dwCMMType)
01131     {
01132         pCMMObj  = <a class="code" href="../../d2/d1/object_8c.html#a14">GetColorMatchingModule</a>(dwCMMType);
01133         <span class="keywordflow">if</span> (!pCMMObj)
01134         {
01135             SetLastError(ERROR_INVALID_CMM);
01136             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01137         }
01138     }
01139 
01140     <span class="comment">//</span>
01141     <span class="comment">// Update Preferred CMM</span>
01142     <span class="comment">//</span>
01143     EnterCriticalSection(&amp;critsec);         <span class="comment">// Critical Section</span>
01144     <a class="code" href="../../d1/d6/ntgdi_2icm_2mscms_2globals_8c.html#a1">gpPreferredCMM</a> = pCMMObj;
01145     LeaveCriticalSection(&amp;critsec);         <span class="comment">// Critical Section</span>
01146 
01147     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01148 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="color.c::TranslateBitmapBits" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI TranslateBitmapBits           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HTRANSFORM&nbsp;</td>
          <td class="mdname" nowrap> <em>hxform</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>pSrcBits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BMFORMAT&nbsp;</td>
          <td class="mdname" nowrap> <em>bmInput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwWidth</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwHeight</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwInputStride</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>pDestBits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BMFORMAT&nbsp;</td>
          <td class="mdname" nowrap> <em>bmOutput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwOutputStride</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PBMCALLBACKFN&nbsp;</td>
          <td class="mdname" nowrap> <em>pfnCallback</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>ulCallbackData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00583">583</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01571">GetBitmapBytes()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00596 {
00597     PTRANSFORMOBJ pxformObj;
00598     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>         nBytes, cbSize;
00599     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>          rc;
00600 
00601     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"TranslateBitmapBits\n"</span>)));
00602 
00603     <span class="comment">//</span>
00604     <span class="comment">// Calculate number of bytes input bitmap should be</span>
00605     <span class="comment">//</span>
00606 
00607     <span class="keywordflow">if</span> (dwInputStride)
00608         cbSize = dwInputStride * dwHeight;
00609     <span class="keywordflow">else</span>
00610         cbSize = <a class="code" href="../../d0/d4/color_8c.html#a3">GetBitmapBytes</a>(bmInput, dwWidth, dwHeight);
00611 
00612     <span class="comment">//</span>
00613     <span class="comment">// Calculate number of bytes output bitmap should be</span>
00614     <span class="comment">//</span>
00615 
00616     <span class="keywordflow">if</span> (dwOutputStride)
00617         nBytes = dwOutputStride * dwHeight;
00618     <span class="keywordflow">else</span>
00619         nBytes = <a class="code" href="../../d0/d4/color_8c.html#a3">GetBitmapBytes</a>(bmOutput, dwWidth, dwHeight);
00620 
00621     <span class="comment">//</span>
00622     <span class="comment">// Validate parameters</span>
00623     <span class="comment">//</span>
00624 
00625     <span class="keywordflow">if</span> (nBytes == 0 ||
00626         cbSize == 0 ||
00627         !<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hxform, OBJ_TRANSFORM) ||
00628         IsBadReadPtr(pSrcBits, cbSize) ||
00629         IsBadWritePtr(pDestBits, nBytes) ||
00630         (pfnCallback &amp;&amp; IsBadCodePtr((FARPROC)pfnCallback)))
00631     {
00632         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to TranslateBitmapBits\n"</span>)));
00633         SetLastError(ERROR_INVALID_PARAMETER);
00634         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00635     }
00636 
00637     pxformObj = (PTRANSFORMOBJ)HDLTOPTR(hxform);
00638 
00639     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj != NULL);
00640 
00641     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj-&gt;pCMMObj != NULL);
00642 
00643     rc = pxformObj-&gt;pCMMObj-&gt;fns.pCMTranslateRGBsExt(
00644             pxformObj-&gt;hcmxform,
00645             pSrcBits,
00646             bmInput,
00647             dwWidth,
00648             dwHeight,
00649             dwInputStride,
00650             pDestBits,
00651             bmOutput,
00652             dwOutputStride,
00653             pfnCallback,
00654             ulCallbackData);
00655 
00656     <span class="keywordflow">return</span> rc;
00657 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="color.c::TranslateColors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI TranslateColors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HTRANSFORM&nbsp;</td>
          <td class="mdname" nowrap> <em>hxform</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCOLOR&nbsp;</td>
          <td class="mdname" nowrap> <em>paInputColors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nColors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COLORTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>ctInput</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PCOLOR&nbsp;</td>
          <td class="mdname" nowrap> <em>paOutputColors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COLORTYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>ctOutput</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l00439">439</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00138">ValidHandle()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00142">WARNING</a>.
<p>
<pre class="fragment"><div>00447 {
00448     PTRANSFORMOBJ pxformObj;
00449     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>          rc;
00450 
00451     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"TranslateColors\n"</span>)));
00452 
00453     <span class="comment">//</span>
00454     <span class="comment">// Validate parameters</span>
00455     <span class="comment">//</span>
00456 
00457     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/object_8c.html#a5">ValidHandle</a>(hxform, OBJ_TRANSFORM) ||
00458         (nColors == 0) ||
00459         IsBadReadPtr(paInputColors, nColors*<span class="keyword">sizeof</span>(COLOR)) ||
00460         IsBadWritePtr(paOutputColors, nColors*<span class="keyword">sizeof</span>(COLOR)))
00461     {
00462         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid parameter to TranslateColors\n"</span>)));
00463         SetLastError(ERROR_INVALID_PARAMETER);
00464         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00465     }
00466 
00467     pxformObj = (PTRANSFORMOBJ)HDLTOPTR(hxform);
00468 
00469     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj != NULL);
00470 
00471     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pxformObj-&gt;pCMMObj != NULL);
00472 
00473     rc = pxformObj-&gt;pCMMObj-&gt;fns.pCMTranslateColors(
00474             pxformObj-&gt;hcmxform,
00475             paInputColors,
00476             nColors,
00477             ctInput,
00478             paOutputColors,
00479             ctOutput);
00480 
00481     <span class="keywordflow">return</span> rc;
00482 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="color.c::UnregisterCMMA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI UnregisterCMMA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pMachineName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cmmID</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l01050">1050</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01494">InternalUnregisterCMM()</a>, and <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>.
<p>
<pre class="fragment"><div>01054 {
01055     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"UnregisterCMMA\n"</span>)));
01056 
01057     <span class="comment">//</span>
01058     <span class="comment">// Internal version is ANSI in Windows 95, call it directly</span>
01059     <span class="comment">//</span>
01060 
01061     <span class="keywordflow">return</span> <a class="code" href="../../d0/d4/color_8c.html#a2">InternalUnregisterCMM</a>((PSTR)pMachineName, cmmID);
01062 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="color.c::UnregisterCMMW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI UnregisterCMMW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pMachineName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cmmID</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/color_8c-source.html#l01065">1065</a> of file <a class="el" href="../../d1/d3/color_8c-source.html">color.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00419">ConvertToAnsi()</a>, <a class="el" href="../../d1/d3/color_8c-source.html#l01494">InternalUnregisterCMM()</a>, <a class="el" href="../../d3/d0/object_8c-source.html#l00260">MemFree()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00138">TRACEAPI</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01069 {
01070     PSTR  pszMachineName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;    <span class="comment">// Ansi machine name</span>
01071     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  rc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;                <span class="comment">// return code</span>
01072 
01073     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a0">TRACEAPI</a>((__TEXT(<span class="stringliteral">"UnregisterCMMW\n"</span>)));
01074 
01075     <span class="comment">//</span>
01076     <span class="comment">// Convert machine name to Ansi</span>
01077     <span class="comment">//</span>
01078 
01079     <span class="keywordflow">if</span> (pMachineName)
01080     {
01081         rc = <a class="code" href="../../d2/d1/object_8c.html#a12">ConvertToAnsi</a>(pMachineName, &amp;pszMachineName, TRUE);
01082     }
01083     <span class="keywordflow">else</span>
01084         pszMachineName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01085 
01086     <span class="comment">//</span>
01087     <span class="comment">// Call the internal Ansi function</span>
01088     <span class="comment">//</span>
01089 
01090     rc = rc &amp;&amp; <a class="code" href="../../d0/d4/color_8c.html#a2">InternalUnregisterCMM</a>(pszMachineName, cmmID);
01091 
01092     <span class="comment">//</span>
01093     <span class="comment">// Free memory before leaving</span>
01094     <span class="comment">//</span>
01095 
01096     <span class="keywordflow">if</span> (pszMachineName)
01097     {
01098         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(pszMachineName);
01099     }
01100 
01101     <span class="keywordflow">return</span> rc;
01102 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:12 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
