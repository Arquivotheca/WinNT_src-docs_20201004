<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ia32trap.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ia32trap.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>
<code>#include "<a class="el" href="../../d9/d2/ia32def_8h-source.html">ia32def.h</a>"</code><br>

<p>
<a href="../../d1/d3/ia32trap_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a0">IADBG</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a3">KiUnalignedFault</a> (IN PKTRAP_FRAME TrapFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a4">KiIA32CommonArgs</a> (IN PKTRAP_FRAME Frame, IN ULONG ExceptionCode, IN PVOID ExceptionAddress, IN ULONG_PTR Argument0, IN ULONG_PTR Argument1, IN ULONG_PTR Argument2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a5">KiIA32ExceptionDivide</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a6">KiIA32ExceptionDebug</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a7">KiIA32ExceptionBreak</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a8">KiIA32ExceptionOverflow</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a9">KiIA32ExceptionBound</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a10">IA32CheckOpcode</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a11">KiIA32InterceptInstruction</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a12">KiIA32ExceptionNoDevice</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a13">KiIA32ExceptionSegmentNotPresent</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a14">KiIA32ExceptionStack</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a15">KiIA32ExceptionInvalidOp</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a16">KiIA32ExceptionGPFault</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a17">KiIA32ExceptionKNI</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a18">KiIA32ExceptionFPFault</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a19">KiIA32ExceptionAlignmentFault</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a20">KiIA32InterruptVector</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a21">KiIA32InterceptGate</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a22">KiIA32InterceptSystemFlag</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a23">KiIA32InterceptLock</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a24">KiIA32ExceptionPanic</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a25">KiIA32InterceptionVectorHandler</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a26">KiIA32ExceptionVectorHandler</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a27">KiIA32InterruptionVectorHandler</a> (IN PKTRAP_FRAME Frame)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a1">KiIA32ExceptionDispatchTable</a> [])(PKTRAP_FRAME)=</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/ia32trap_8c.html#a2">KiIA32InterceptionDispatchTable</a> [])(PKTRAP_FRAME)=</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="ia32trap.c::IADBG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IADBG&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00027">27</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a10" doxytag="ia32trap.c::IA32CheckOpcode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG IA32CheckOpcode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00282">282</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00154">MI_HLT</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00156">MI_LGDT_LIDT_LMSW</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00160">MI_LGDT_MASK</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00161">MI_LIDT_MASK</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00158">MI_LLDT_MASK</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00162">MI_LMSW_MASK</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00155">MI_LTR_LLDT</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00159">MI_LTR_MASK</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00157">MI_MODRM_MASK</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00163">MI_SPECIAL_MOV_MASK</a>, and <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00153">MI_TWO_BYTE</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00355">KiIA32InterceptInstruction()</a>.
<p>
<pre class="fragment"><div>00287                    :
00288     
00289     To identify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Opcode violation state
00290     
00291 Arguments:
00292 
00293     Frame:  Pointer to iA32 TrapFrame in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> stack
00294 
00295 Return Value:
00296     Exception code
00297 
00298 --*/
00299 {
00300     ULONG i;
00301     UCHAR OpCodeByte0;
00302     UCHAR OpCodeByte1;
00303     UCHAR OpCodeByte2;
00304         
00305         
00306     OpCodeByte0 = (UCHAR) Frame-&gt;StIIM &amp; 0xff;
00307     OpCodeByte1 = (UCHAR) (Frame-&gt;StIIM &gt;&gt; 8) &amp; 0xff;
00308     OpCodeByte2 = (UCHAR) (Frame-&gt;StIIM &gt;&gt; 16) &amp; 0xff;
00309 
00310     <span class="keywordflow">switch</span> (OpCodeByte0) {
00311        <span class="keywordflow">case</span> <a class="code" href="../../d8/d3/ia32def_8h.html#a73">MI_HLT</a>:
00312            <span class="keywordflow">return</span> (STATUS_PRIVILEGED_INSTRUCTION);
00313            <span class="keywordflow">break</span>;
00314 
00315        <span class="keywordflow">case</span> <a class="code" href="../../d8/d3/ia32def_8h.html#a72">MI_TWO_BYTE</a>:
00316            <span class="keywordflow">if</span> (OpCodeByte1 == <a class="code" href="../../d8/d3/ia32def_8h.html#a74">MI_LTR_LLDT</a> || 
00317                OpCodeByte2 == <a class="code" href="../../d8/d3/ia32def_8h.html#a75">MI_LGDT_LIDT_LMSW</a>) {
00318 
00319                OpCodeByte2 &amp;= <a class="code" href="../../d8/d3/ia32def_8h.html#a76">MI_MODRM_MASK</a>;      <span class="comment">// get bit 3-5 of ModRM byte</span>
00320 
00321                <span class="keywordflow">if</span> (OpCodeByte2==<a class="code" href="../../d8/d3/ia32def_8h.html#a77">MI_LLDT_MASK</a> || OpCodeByte2==<a class="code" href="../../d8/d3/ia32def_8h.html#a78">MI_LTR_MASK</a> ||
00322                    OpCodeByte2==<a class="code" href="../../d8/d3/ia32def_8h.html#a79">MI_LGDT_MASK</a> || OpCodeByte2==<a class="code" href="../../d8/d3/ia32def_8h.html#a80">MI_LIDT_MASK</a> || 
00323                    OpCodeByte2==<a class="code" href="../../d8/d3/ia32def_8h.html#a81">MI_LMSW_MASK</a>) {
00324                    <span class="keywordflow">return</span> (STATUS_PRIVILEGED_INSTRUCTION);
00325                } <span class="keywordflow">else</span>  {
00326                    <span class="keywordflow">return</span> (STATUS_ACCESS_VIOLATION);
00327                }
00328 
00329             } <span class="keywordflow">else</span> {
00330                 <span class="keywordflow">if</span> (OpCodeByte1 &amp; <a class="code" href="../../d8/d3/ia32def_8h.html#a82">MI_SPECIAL_MOV_MASK</a>) {
00331                     <span class="comment">//</span>
00332                     <span class="comment">// mov may have special_mov_mask</span>
00333                     <span class="comment">// but they are not 2 bytes OpCode</span>
00334                     <span class="comment">//</span>
00335                     <span class="keywordflow">return</span> (STATUS_PRIVILEGED_INSTRUCTION);
00336                 } <span class="keywordflow">else</span> {
00337                     <span class="comment">//</span>
00338                     <span class="comment">// Do we need to further check if it is INVD, INVLPG ... ?</span>
00339                     <span class="comment">//</span>
00340                     <span class="keywordflow">return</span> (STATUS_ACCESS_VIOLATION);
00341                 }
00342             }
00343             <span class="keywordflow">break</span>;
00344 
00345         <span class="keywordflow">default</span>:
00346             <span class="comment">//</span>
00347             <span class="comment">// All other </span>
00348             <span class="comment">//</span>
00349             <span class="keywordflow">return</span> (STATUS_ILLEGAL_INSTRUCTION);
00350             <span class="keywordflow">break</span>;
00351         }
00352 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ia32trap.c::KiIA32CommonArgs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiIA32CommonArgs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>Frame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Argument0</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Argument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Argument2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">36</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00242">KiIA32ExceptionBound()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00164">KiIA32ExceptionBreak()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00120">KiIA32ExceptionDebug()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00081">KiIA32ExceptionDivide()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00667">KiIA32ExceptionGPFault()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00631">KiIA32ExceptionInvalidOp()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00417">KiIA32ExceptionNoDevice()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00202">KiIA32ExceptionOverflow()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00532">KiIA32ExceptionSegmentNotPresent()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00575">KiIA32ExceptionStack()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00815">KiIA32InterceptGate()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00355">KiIA32InterceptInstruction()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00901">KiIA32InterceptLock()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00882">KiIA32InterceptSystemFlag()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l01064">KiIA32InterruptionVectorHandler()</a>, and <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00788">KiIA32InterruptVector()</a>.
<p>
<pre class="fragment"><div>00049          :
00050     Frame - Supply a pointer to an iA32 TrapFrame
00051 
00052     ExceptionCode - Supplies a Exception Code
00053 
00054     ExceptionAddress - Supplies a pointer to user exception address
00055 
00056     Argument0, Argument1, Argument2 - Possible ExceptionInformation
00057 
00058 Return:
00059     Nothing
00060 --*/
00061 {
00062     PEXCEPTION_RECORD ExceptionRecord;
00063 
00064     ExceptionRecord = (PEXCEPTION_RECORD)&amp;Frame-&gt;ExceptionRecord;
00065 
00066     ExceptionRecord-&gt;ExceptionRecord = (PEXCEPTION_RECORD)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00067 
00068     ExceptionRecord-&gt;ExceptionCode = ExceptionCode;
00069     ExceptionRecord-&gt;ExceptionFlags = 0;
00070     ExceptionRecord-&gt;ExceptionAddress = ExceptionAddress;
00071     ExceptionRecord-&gt;NumberParameters = 5;
00072        
00073     ExceptionRecord-&gt;ExceptionInformation[0] = Argument0;
00074     ExceptionRecord-&gt;ExceptionInformation[1] = Argument1;
00075     ExceptionRecord-&gt;ExceptionInformation[2] = Argument2;
00076     ExceptionRecord-&gt;ExceptionInformation[3] = (ULONG_PTR)Frame-&gt;StIIPA;
00077     ExceptionRecord-&gt;ExceptionInformation[4] = (ULONG_PTR)Frame-&gt;StISR;
00078 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="ia32trap.c::KiIA32ExceptionAlignmentFault" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionAlignmentFault           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00755">755</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, and <a class="el" href="../../d5/d4/ia64_2trapc_8c-source.html#l01079">KiUnalignedFault()</a>.
<p>
<pre class="fragment"><div>00774 {
00775 <span class="preprocessor">#if defined(IADBG)</span>
00776 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( ALIGNMENT )
00777        DbgPrint( "IA32 Alignment: Eip %x\n", EIP(Frame) );
00778 #endif <span class="comment">// IADBG</span>
00779 
00780     <span class="comment">//</span>
00781     <span class="comment">// BUGBUG: We should really turn off psr.ac for an ia32 process...</span>
00782     <span class="comment">//</span>
00783     return KiUnalignedFault(Frame);
00784 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ia32trap.c::KiIA32ExceptionBound" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionBound           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00242">242</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00247                    :
00248     iA-32_Exception(Bound) - Fault
00249     
00250     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> Bound check fault
00251     ISR.Vector = 5
00252     Eip - point to BOUND instruction
00253 
00254     The bound check fault occurs <span class="keywordflow">if</span> a BOUND instruction finds that
00255     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tested value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> outside <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified range.
00256 
00257     For bound check fault, an ARRAY BOUND EXCEEDED exception will be raised.
00258 
00259 Arguments:
00260     Frame - Supply a pointer to an iA32 TrapFrame
00261 
00262 Return Value:
00263 
00264 --*/
00265 {
00266 <span class="preprocessor">#if defined(IADBG)</span>
00267 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( BOUND )
00268        DbgPrint( "IA32 Bound: Eip %x\n", EIP(Frame) );
00269 #endif <span class="comment">// IADBG</span>
00270     <span class="comment">//</span>
00271     <span class="comment">// All error, generate exception with Eip point to BOUND instruction</span>
00272     <span class="comment">//</span>
00273     KiIA32CommonArgs(Frame,
00274                      STATUS_ARRAY_BOUNDS_EXCEEDED,
00275                      (PVOID) EIP(Frame),
00276                      0, 0, 0);
00277     return TRUE;
00278 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ia32trap.c::KiIA32ExceptionBreak" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionBreak           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00164">164</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00051">BREAKPOINT_BREAK</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00219">ECX</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00220">EDX</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00075">EFLAGS_TF_BIT</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00169                    :
00170     iA-32_Exception(Break) - Trap
00171 
00172     BreakPoint instruction (INT 3) trigged a trap.
00173     Note: EFlag isn't saved yet, so write directly to ar.24
00174 Arguments:
00175     Frame - Supply a pointer to an iA32 TrapFrame
00176 
00177 Return Value:
00178 
00179 --*/
00180 {
00181     ULONGLONG EFlag;
00182 
00183 <span class="preprocessor">#if defined(IADBG)</span>
00184 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( BREAK )
00185        DbgPrint( "IA32 Break: Eip %x\n", EIP(Frame) );
00186 #endif <span class="comment">// IADBG</span>
00187     <span class="comment">// Turn off the TF bit</span>
00188     EFlag = __getReg(CV_IA64_AR24);
00189     EFlag &amp;= ~EFLAGS_TF_BIT;
00190     __setReg(CV_IA64_AR24, EFlag);
00191 
00192     KiIA32CommonArgs(Frame,
00193                      STATUS_WX86_BREAKPOINT,
00194                      (PVOID) EIP(Frame),
00195                      BREAKPOINT_BREAK,
00196                      ECX(Frame),
00197                      EDX(Frame));
00198     return TRUE;
00199 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ia32trap.c::KiIA32ExceptionDebug" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionDebug           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00120">120</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00075">EFLAGS_TF_BIT</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00124                    :
00125     iA-32_Exception(Debug)
00126 
00127     Called from iA32_Exception() with
00128         ISR.Vector = 1
00129 
00130     Depend on ISR.Code
00131        0:  It is Code BreakPoint Trap
00132        TrapCode:  Can be Concurrent Single Step | 
00133                   Taken Branch | Data BreakPoint Trap
00134        Handler needs to decode ISR.Code to distinguish
00135     Note: EFlag isn't saved yet, so write directly to ar.24
00136 
00137 Arguments:
00138     Frame - Supply a pointer to an iA32 TrapFrame
00139 
00140 Return Value:
00141     No return
00142 
00143 --*/
00144 {
00145     ULONGLONG EFlag;
00146 
00147 <span class="preprocessor">#if defined(IADBG)</span>
00148 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( DEBUG )
00149        DbgPrint( "IA32 Debug: Eip %x\n", EIP(Frame) );
00150 #endif <span class="comment">// IADBG</span>
00151     <span class="comment">// Turn off the TF bit</span>
00152     EFlag = __getReg(CV_IA64_AR24);
00153     EFlag &amp;= ~EFLAGS_TF_BIT;
00154     __setReg(CV_IA64_AR24, EFlag);
00155 
00156     KiIA32CommonArgs(Frame,
00157                      STATUS_WX86_SINGLE_STEP,
00158                      (PVOID) EIP(Frame),
00159                      0, 0, 0);
00160     return TRUE;
00161 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ia32trap.c::KiIA32ExceptionDivide" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionDivide           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00081">81</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d4/d4/iafptrap_8c.html#a11">Ki386CheckDivideByZeroTrap()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00086                    :
00087     iA-32_Exception(Divide) - fault
00088 
00089     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> divide error fault.
00090 
00091     Called from iA32_Exception() with 
00092         ISR.vector : 0
00093 
00094     The divide error fault occurs if a DIV or IDIV instructions is
00095     executed with a divisor of 0, or if the quotient is too big to
00096     fit in the result operand.
00097 
00098     An INTEGER DIVIDED BY ZERO exception will be raised for the fault.
00099     The Faults can only come from user mode.
00100 
00101 Arguments:
00102     Frame - Supply a pointer to an iA32 TrapFrame
00103 
00104 Return value:
00105 
00106 --*/
00107 {
00108     <span class="comment">// </span>
00109     <span class="comment">// Setup exception and back to caller</span>
00110     <span class="comment">//</span>
00111 
00112     <a class="code" href="../../d0/d4/ia32trap_8c.html#a4">KiIA32CommonArgs</a>(Frame,
00113                      <a class="code" href="../../d4/d4/iafptrap_8c.html#a11">Ki386CheckDivideByZeroTrap</a>(Frame),
00114                      (PVOID) <a class="code" href="../../d8/d3/ia32def_8h.html#a123">EIP</a>(Frame),
00115                      0, 0, 0);
00116     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00117 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ia32trap.c::KiIA32ExceptionFPFault" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionFPFault           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00728">728</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, and <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00417">KiIA32ExceptionNoDevice()</a>.
<p>
<pre class="fragment"><div>00745 {
00746 <span class="preprocessor">#if defined(IADBG)</span>
00747 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( FPFAULT )
00748        DbgPrint( "IA32 FpFault: Eip %x\n", EIP(Frame) );
00749 #endif <span class="comment">// IADBG</span>
00750     return(KiIA32ExceptionNoDevice(Frame));
00751 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ia32trap.c::KiIA32ExceptionGPFault" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionGPFault           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00667">667</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00672                    :
00673     iA-32_Exception(General Protection) - fault
00674 
00675     PKTRAP_FRAME Frame
00676            Eip  : <span class="keyword">virtual</span> iA-32 instruction address
00677            ISR.vector : 13
00678            ISR.code   : ErrorCode
00679 
00680     Note: 
00681         Previlidged instructions are intercepted, 
00682            see <a class="code" href="../../d0/d4/ia32trap_8c.html#a11">KiIA32InterceptInstruction</a>
00683 
00684 Arguments:
00685 
00686     Frame - iA32 TrapFrame that was saved in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory stack
00687 
00688 Return Value:
00689 
00690 --*/
00691 {
00692 <span class="preprocessor">#if defined(IADBG)</span>
00693 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( GPFAULT )
00694        DbgPrint( "IA32 GpFault: Eip %x\n", EIP(Frame) );
00695 #endif <span class="comment">// IADBG</span>
00696 
00697     KiIA32CommonArgs(Frame,
00698                      STATUS_ACCESS_VIOLATION,
00699                      (PVOID) EIP(Frame),
00700                      0, 0, 0);
00701     return TRUE;
00702 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ia32trap.c::KiIA32ExceptionInvalidOp" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionInvalidOp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00631">631</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00636                    :
00637     iA-32_Exception(Invalid Opcode) - fault
00638 
00639     PKTRAP_FRAME Frame
00640            Eip  : <span class="keyword">virtual</span> iA-32 instruction address
00641            ISR.vector : 6
00642 
00643     Note: 
00644         Only MMX and KNI instructions can cause <span class="keyword">this</span> fault based
00645         on values in CR0 and CR4
00646 
00647 Arguments:
00648 
00649     Frame - iA32 TrapFrame that was saved in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory stack
00650 
00651 Return Value:
00652 --*/
00653 {
00654 <span class="preprocessor">#if defined(IADBG)</span>
00655 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( INSTRUCTION )
00656        DbgPrint( "IA32 Invalid Opcode: Eip %x\n", EIP(Frame) );
00657 #endif <span class="comment">// IADBG</span>
00658 
00659     KiIA32CommonArgs(Frame,
00660         STATUS_ILLEGAL_INSTRUCTION,
00661         (PVOID) EIP(Frame),
00662         0, 0, 0);
00663     return TRUE;
00664 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ia32trap.c::KiIA32ExceptionKNI" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionKNI           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00707">707</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, and <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00417">KiIA32ExceptionNoDevice()</a>.
<p>
<pre class="fragment"><div>00718 {
00719 <span class="preprocessor">#if defined(IADBG)</span>
00720 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( FPFAULT )
00721        DbgPrint( "IA32 KNI Fault: Eip %x\n", EIP(Frame) );
00722 #endif <span class="comment">// IADBG</span>
00723     return(KiIA32ExceptionNoDevice(Frame));
00724 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ia32trap.c::KiIA32ExceptionNoDevice" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionNoDevice           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00417">417</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00200">FSW_DENORMAL</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00211">FSW_ERR_MASK</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00199">FSW_INVALID_OPERATION</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00202">FSW_OVERFLOW</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00204">FSW_PRECISION</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00205">FSW_STACK_FAULT</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00203">FSW_UNDERFLOW</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00201">FSW_ZERO_DIVIDE</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00034">TRAP_CAUSE_UNKNOWN</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00728">KiIA32ExceptionFPFault()</a>, and <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00707">KiIA32ExceptionKNI()</a>.
<p>
<pre class="fragment"><div>00422                    :
00423 
00424     iA-32_Exception(Coprocessor Not Available) - fault
00425 
00426     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called from iA32_Exception() with
00427          ISR.Vector = 7
00428 
00429     Note:
00430         At this time, the AR registers have not been saved. This
00431         includes, CFLAGS (AR.27), EFLAGS (AR.24), FCR (AR.21),
00432         FSR (AR.28), FIR (AR.29) and FDR (AR.30).
00433 
00434         Not handling MMX and KNI exceptions yet.
00435 
00436 Arguments:
00437 
00438     Frame - iA32 TrapFrame that was saved in the memory stack
00439 
00440 Return Value:
00441 
00442 --*/
00443 {
00444     ULONG ErrorCode;
00445     ULONG FirOffset, FdrOffset;
00446     ULONG FpState;
00447     <span class="comment">// For these 2 registers, we only care about the lower 32-bits</span>
00448     ULONG FcrRegister, FsrRegister;
00449         
00450 <span class="preprocessor">#if defined(IADBG)</span>
00451 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( NODEVICE )
00452        DbgPrint( "IA32 NoDevice: Eip %x\n", EIP(Frame) );
00453 #endif <span class="comment">// IADBG</span>
00454 
00455     FcrRegister = (ULONG) (__getReg(CV_IA64_AR21) &amp; 0xFFFFFFFF);
00456     FsrRegister = (ULONG) (__getReg(CV_IA64_AR28) &amp; 0xFFFFFFFF);
00457     FirOffset = (ULONG) (__getReg(CV_IA64_AR29) &amp; 0xFFFFFFFF);
00458     FdrOffset = (ULONG) (__getReg(CV_IA64_AR30) &amp; 0xFFFFFFFF);
00459 
00460     <span class="comment">//</span>
00461     <span class="comment">// According to the floating error priority, </span>
00462     <span class="comment">// we test what is the cause of the NPX error </span>
00463     <span class="comment">// and raise an appropriate exception</span>
00464     <span class="comment">//</span>
00465     FpState = ~(FcrRegister &amp;
00466                 (FSW_INVALID_OPERATION | FSW_DENORMAL | 
00467                  FSW_ZERO_DIVIDE | FSW_OVERFLOW | 
00468                  FSW_UNDERFLOW | FSW_PRECISION)) &amp; (FsrRegister &amp; FSW_ERR_MASK);
00469 
00470 
00471     <span class="comment">//</span>
00472     <span class="comment">// Was an invalid operation fault?</span>
00473     <span class="comment">//</span>
00474 
00475     if (FpState &amp; FSW_INVALID_OPERATION) {
00476 
00477         <span class="keywordflow">if</span> (FpState &amp; <a class="code" href="../../d8/d3/ia32def_8h.html#a116">FSW_STACK_FAULT</a>) {
00478             <a class="code" href="../../d0/d4/ia32trap_8c.html#a4">KiIA32CommonArgs</a>(Frame,
00479                              STATUS_FLOAT_STACK_CHECK,
00480                              (PVOID) FirOffset,
00481                              0, FdrOffset, 0);
00482             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00483         } <span class="keywordflow">else</span> {
00484             <a class="code" href="../../d0/d4/ia32trap_8c.html#a4">KiIA32CommonArgs</a>(Frame,
00485                              STATUS_FLOAT_INVALID_OPERATION,
00486                              (PVOID) FirOffset,
00487                              0, 0, 0);
00488             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00489         }
00490 
00491     } <span class="keywordflow">else</span> {
00492 
00493         <span class="keywordflow">if</span> (FpState &amp; <a class="code" href="../../d8/d3/ia32def_8h.html#a112">FSW_ZERO_DIVIDE</a>)
00494             ErrorCode = STATUS_FLOAT_DIVIDE_BY_ZERO; 
00495         <span class="keywordflow">else</span> { <span class="keywordflow">if</span> (FpState &amp; <a class="code" href="../../d8/d3/ia32def_8h.html#a111">FSW_DENORMAL</a>) 
00496                    ErrorCode = STATUS_FLOAT_INVALID_OPERATION; 
00497                <span class="keywordflow">else</span> { <span class="keywordflow">if</span> (FpState &amp; <a class="code" href="../../d8/d3/ia32def_8h.html#a113">FSW_OVERFLOW</a>)
00498                           ErrorCode = STATUS_FLOAT_OVERFLOW; 
00499                       <span class="keywordflow">else</span> { <span class="keywordflow">if</span> (FpState &amp; <a class="code" href="../../d8/d3/ia32def_8h.html#a114">FSW_UNDERFLOW</a>)
00500                                  ErrorCode = STATUS_FLOAT_UNDERFLOW; 
00501                              <span class="keywordflow">else</span> { <span class="keywordflow">if</span> (FpState &amp; <a class="code" href="../../d8/d3/ia32def_8h.html#a115">FSW_PRECISION</a>)
00502                                         ErrorCode = STATUS_FLOAT_INEXACT_RESULT; 
00503                                     <span class="keywordflow">else</span>
00504                                         ErrorCode = 0;
00505                              }
00506                       }
00507                }
00508         }
00509     }
00510                     
00511     <span class="keywordflow">if</span> (ErrorCode) {
00512             <a class="code" href="../../d0/d4/ia32trap_8c.html#a4">KiIA32CommonArgs</a>(Frame,
00513                              STATUS_FLOAT_INEXACT_RESULT,
00514                              (PVOID) FirOffset,
00515                              0, 0, 0);
00516             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00517     } <span class="keywordflow">else</span> {  
00518 
00519         <span class="comment">//</span>
00520         <span class="comment">// FpState indicates no error, then something is wrong</span>
00521         <span class="comment">// Panic the system !!!</span>
00522         <span class="comment">//</span>
00523 
00524         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(TRAP_CAUSE_UNKNOWN, (ULONG_PTR)Frame, 0, 0, 2);
00525     }
00526 
00527     <span class="comment">// Should never get here...</span>
00528     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00529 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ia32trap.c::KiIA32ExceptionOverflow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionOverflow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00202">202</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00206                    :
00207     iA-32_Exception(Overflow) - Trap
00208        ISR.Vector = 4
00209 
00210     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> INTO overflow
00211 
00212     Eip - point to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address that next to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> one causing INTO 
00213 
00214     Occurres when INTO instruction as well as EFlags.OF <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ON
00215     Trap <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> initiated from user mode
00216 
00217 Arguments:
00218     Frame - Supply a pointer to an iA32 TrapFrame
00219 
00220 Return Value:
00221 
00222 --*/
00223 {
00224 <span class="preprocessor">#if defined(IADBG)</span>
00225 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( OVERFLOW )
00226        DbgPrint( "IA32 OverFlow: Eip %x\n", EIP(Frame) );
00227 #endif <span class="comment">// IADBG</span>
00228 
00229     <span class="comment">//</span>
00230     <span class="comment">// All error, generate exception and Eip point to INTO instruction</span>
00231     <span class="comment">//</span>
00232 
00233     KiIA32CommonArgs(Frame,
00234                      STATUS_INTEGER_OVERFLOW,
00235                      (PVOID) (EIP(Frame) - 1),
00236                      0, 0, 0);
00237     return TRUE;
00238 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="ia32trap.c::KiIA32ExceptionPanic" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionPanic           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00938">938</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00223">ISRVector</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00034">TRAP_CAUSE_UNKNOWN</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l01026">KiIA32ExceptionVectorHandler()</a>, and <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00987">KiIA32InterceptionVectorHandler()</a>.
<p>
<pre class="fragment"><div>00941 {
00942     <span class="comment">//</span>
00943     <span class="comment">// Panic the system </span>
00944     <span class="comment">//</span>
00945 
00946     <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(TRAP_CAUSE_UNKNOWN, 
00947                  (ULONG_PTR)Frame, 
00948                  <a class="code" href="../../d8/d3/ia32def_8h.html#a128">ISRVector</a>(Frame), 
00949                  0, 0);
00950     <span class="comment">// Should never get here...</span>
00951     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00952 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ia32trap.c::KiIA32ExceptionSegmentNotPresent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionSegmentNotPresent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00532">532</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00222">ISRCode</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00537                    :
00538     iA-32_Exception(Not Present) - fault
00539 
00540     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> Segment Not Present fault.
00541         ISR.Vector = 11
00542 
00543     This exception occurs when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor finds <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> P bit 0
00544     when accessing an otherwise valid descriptor that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not to
00545     be loaded in SS <span class="keyword">register</span>.
00546 
00547 Arguments:
00548 
00549     Frame - iA32 TrapFrame that was saved in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory stack
00550 
00551 Return Value:
00552 
00553 --*/
00554 {
00555     KIRQL OldIrql;
00556     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ErrorCode;
00557 
00558 <span class="preprocessor">#if defined(IADBG)</span>
00559 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( NOTPRESENT )
00560        DbgPrint( "IA32 NotPresent: Eip %x\n", EIP(Frame) );
00561 #endif <span class="comment">// IADBG</span>
00562 
00563     <span class="comment">//</span>
00564     <span class="comment">// Generate Exception for all other errors</span>
00565     <span class="comment">//</span>
00566 
00567     KiIA32CommonArgs(Frame,
00568                      STATUS_ACCESS_VIOLATION,
00569                      (PVOID) EIP(Frame),
00570                      0, ISRCode(Frame) | RPL_MASK, 0);
00571     return TRUE;
00572 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ia32trap.c::KiIA32ExceptionStack" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionStack           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00575">575</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00218">ESP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00057">EXCEPT_LIMIT_ACCESS</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00056">EXCEPT_UNKNOWN_ACCESS</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00222">ISRCode</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00580                    :
00581     iA-32_Exception(Stack) - fault
00582 
00583     ISR.Vector = 12
00584 
00585     This exception occurs when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor detects certain problem
00586     with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> segment addressed by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SS segment <span class="keyword">register</span>:
00587 
00588     1. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> limit violation in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> segment addressed by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SS (error
00589        code = 0)
00590     2. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> limit vioalation in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inner stack during an interlevel
00591        call or interrupt (error code = selector <span class="keywordflow">for</span> the inner stack)
00592     3. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> descriptor to be loaded into SS has its present bit 0
00593        (error code = selector <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> not-present segment)
00594 
00595     The exception <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> occurred from user mode
00596 
00597 Arguments:
00598 
00599     Frame - iA32 TrapFrame that was saved in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory stack
00600 
00601 Return Value:
00602 
00603 --*/
00604 {
00605     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> Code;
00606 
00607 <span class="preprocessor">#if defined(IADBG)</span>
00608 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( STACK )
00609        DbgPrint( "IA32 Stack: Eip %x\n", EIP(Frame) );
00610 #endif <span class="comment">// IADBG</span>
00611 
00612     <span class="comment">//</span>
00613     <span class="comment">// Dispatch Exception to user</span>
00614     <span class="comment">//</span>
00615    
00616     Code = ISRCode(Frame);
00617 
00618     <span class="comment">//</span>
00619     <span class="comment">// Code may contain the faulting selector</span>
00620     <span class="comment">//</span>
00621     KiIA32CommonArgs(Frame,
00622                      STATUS_ACCESS_VIOLATION,
00623                      (PVOID) EIP(Frame),
00624                       Code ? (Code | RPL_MASK) :  ESP(Frame),
00625                       Code ? EXCEPT_UNKNOWN_ACCESS : EXCEPT_LIMIT_ACCESS,
00626                       0);
00627     return TRUE;
00628 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="ia32trap.c::KiIA32ExceptionVectorHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32ExceptionVectorHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l01026">1026</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00223">ISRVector</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00956">KiIA32ExceptionDispatchTable</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00938">KiIA32ExceptionPanic()</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
<pre class="fragment"><div>01031                    :
01032 
01033     <a class="code" href="../../d0/d4/ia32trap_8c.html#a26">KiIA32ExceptionVectorHandler</a>
01034 
01035     Called by first label KiIA32ExceptionVector() to handle further iA32 
01036     interception processing.
01037    
01038 Arguments:
01039 
01040     Frame - iA32 TrapFrame that was saved in the memory stack
01041 
01042 Return Value:
01043     TRUE - go to dispatch exception
01044     FALSE - Exception was handled, do an RFI
01045 
01046 --*/
01047 {
01048 <span class="preprocessor">#if defined(IADBG)</span>
01049 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( EXCEPTION )
01050        DbgPrint("IA32 Exception: ISRVector %x Frame %x\n", ISRVector(Frame), Frame);
01051 #endif <span class="comment">// IADBG</span>
01052 
01053     ASSERT(UserMode == Frame-&gt;PreviousMode);
01054     <span class="comment">//</span>
01055     <span class="comment">// Make sure we have an entry in the table for this exception</span>
01056     <span class="comment">//</span>
01057     if (ISRVector(Frame) &lt;= sizeof(KiIA32ExceptionDispatchTable)&gt;&gt;2) 
01058         return (*KiIA32ExceptionDispatchTable[ISRVector(Frame)])(Frame);
01059     else
01060         return(KiIA32ExceptionPanic(Frame));
01061 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="ia32trap.c::KiIA32InterceptGate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32InterceptGate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00815">815</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00222">ISRCode</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00820                    :
00821 
00822     iA32_Intercept(Gate) - trap
00823 
00824     If an iA32 <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> transfer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> initiated through a GDT or LDT descriptor
00825     that results in an either a promotion of privilege level (interlevel Call
00826     or Jump Gate and IRET) or an iA32 task <span class="keywordflow">switch</span> (TSS segment or Gate), 
00827     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> intercept trap <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> generated.
00828 
00829     Possible instructions intercepted:
00830         CALL, <a class="code" href="../../d6/d9/kernlini_8c.html#a1">RET</a>, IRET, IRETD and JMP
00831 
00832     Handling
00833         No CaLL, <a class="code" href="../../d6/d9/kernlini_8c.html#a1">RET</a>, JMP, IRET, IRETD are allowed in any mode, 
00834            STATUS_ACCESS_VIOLATION <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned
00835 
00836 Arguments:
00837     Frame - iA32 TrapFrame that was saved in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory stack
00838 
00839 Return Value:
00840 
00841 --*/
00842 {
00843 <span class="preprocessor">#if defined(IADBG)</span>
00844 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( GATE )
00845        DbgPrint( "IA32 Gate: Eip %x GateSelector %x OpcodeId %x\n",
00846                  EIP(Frame),
00847                  (ULONG) (Frame-&gt;IFA &amp; 0xff),
00848                  (ULONG) (ISRCode(Frame) &gt;&gt; 14));
00849 #endif <span class="comment">// IADBG</span>
00850 
00851     <span class="comment">//</span>
00852     <span class="comment">// all error fall through here</span>
00853     <span class="comment">//</span>
00854     KiIA32CommonArgs(Frame,
00855         STATUS_ILLEGAL_INSTRUCTION,
00856         (PVOID) EIP(Frame),
00857         0, 0, 0);
00858     return TRUE;
00859 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ia32trap.c::KiIA32InterceptInstruction" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32InterceptInstruction           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00355">355</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00282">IA32CheckOpcode()</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00034">TRAP_CAUSE_UNKNOWN</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00360                    :
00361     iA-32_Exception(InstructionIntercept Opcode)
00362 
00363     Program entry <span class="keywordflow">for</span> either
00364        1. IA-32 Invalid Opcode Fault #6, or
00365        2. IA-32 interceptions(Inst)
00366 
00367     Execution of unimplemented IA-32 opcodes, illegal opcodes or sensitive 
00368     privileged IA32 operating system instructions results this interception.
00369 
00370     Possible Opcodes:
00371         Privileged Opcodes: CLTS, HLT, INVD, INVLPG, LIDT, LMSW, LTR, 
00372                             mov to/from CRs, DRs
00373                             RDMSR, RSM, SMSW, WBINVD, WRMSR
00374 
00375 Arguments:
00376 
00377     Frame - Supply a pointer to an iA32 TrapFrame
00378 
00379 Return Value:
00380 
00381 --*/
00382 {
00383 <span class="preprocessor">#if defined(IADBG)</span>
00384 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( INSTRUCTION )
00385        DbgPrint( "IA32 Instruction: Eip %x\n", EIP(Frame) );
00386 #endif <span class="comment">// IADBG</span>
00387 
00388     switch ( IA32CheckOpcode(Frame) ) {
00389         <span class="keywordflow">case</span> STATUS_PRIVILEGED_INSTRUCTION:
00390             <a class="code" href="../../d0/d4/ia32trap_8c.html#a4">KiIA32CommonArgs</a>(Frame,
00391                              STATUS_PRIVILEGED_INSTRUCTION,
00392                              (PVOID) <a class="code" href="../../d8/d3/ia32def_8h.html#a123">EIP</a>(Frame),
00393                              0, 0, 0);
00394             <span class="keywordflow">break</span>;
00395         <span class="keywordflow">case</span> STATUS_ACCESS_VIOLATION:    
00396             <a class="code" href="../../d0/d4/ia32trap_8c.html#a4">KiIA32CommonArgs</a>(Frame,
00397                              STATUS_ACCESS_VIOLATION,
00398                              (PVOID) <a class="code" href="../../d8/d3/ia32def_8h.html#a123">EIP</a>(Frame),
00399                              0, -1, 0);
00400             <span class="keywordflow">break</span>; 
00401         <span class="keywordflow">case</span> STATUS_ILLEGAL_INSTRUCTION:
00402             <a class="code" href="../../d0/d4/ia32trap_8c.html#a4">KiIA32CommonArgs</a>(Frame,
00403                              STATUS_ILLEGAL_INSTRUCTION,
00404                              (PVOID) <a class="code" href="../../d8/d3/ia32def_8h.html#a123">EIP</a>(Frame),
00405                              0, -1, 0);
00406             <span class="keywordflow">break</span>;
00407         <span class="keywordflow">default</span>:
00408             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(TRAP_CAUSE_UNKNOWN, (ULONG_PTR)Frame, <a class="code" href="../../d0/d4/ia32trap_8c.html#a10">IA32CheckOpcode</a>(Frame), 0, 1);
00409             <span class="comment">// Should never get here...</span>
00410             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00411             <span class="keywordflow">break</span>;
00412     }
00413     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00414 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="ia32trap.c::KiIA32InterceptionVectorHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32InterceptionVectorHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00987">987</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00223">ISRVector</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00938">KiIA32ExceptionPanic()</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00979">KiIA32InterceptionDispatchTable</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
<pre class="fragment"><div>00992                    :
00993 
00994     <a class="code" href="../../d0/d4/ia32trap_8c.html#a25">KiIA32InterceptionVectorHandler</a>
00995 
00996     Called by first label KiIA32InterceptionVector() to handle further iA32 
00997     interception processing.
00998    
00999 Arguments:
01000 
01001     Frame - iA32 TrapFrame that was saved in the memory stack
01002 
01003 Return Value:
01004     TRUE - go to dispatch exception
01005     FALSE - Exception was handled, do an RFI
01006 
01007 --*/
01008 {
01009 <span class="preprocessor">#if defined(IADBG)</span>
01010 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( INTERCEPTION )
01011        DbgPrint("IA32 Interception: ISRVector %x Frame %x\n", ISRVector(Frame), Frame);
01012 #endif <span class="comment">// IADBG</span>
01013 
01014     ASSERT(UserMode == Frame-&gt;PreviousMode);
01015 
01016     <span class="comment">//</span>
01017     <span class="comment">// Make sure we have an entry in the table for this interception</span>
01018     <span class="comment">//</span>
01019     if (ISRVector(Frame) &lt;= sizeof(KiIA32InterceptionDispatchTable)&gt;&gt;2) 
01020         return (*KiIA32InterceptionDispatchTable[ISRVector(Frame)])(Frame);
01021     else
01022         return (KiIA32ExceptionPanic(Frame));
01023 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="ia32trap.c::KiIA32InterceptLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32InterceptLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00901">901</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a818">LOCK</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00906                    :
00907     iA32_Intercept(Lock) - trap
00908 
00909     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a> intercepts occurred <span class="keywordflow">if</span> platform or firmware code has disabled locked
00910     transactions and atomic memory update requires a processor external 
00911     indication
00912 
00913 Arguments:
00914     Frame - <a class="code" href="../../d7/d5/structPoint.html">Point</a> to iA32 TrapFrame
00915 
00916 Return:
00917 
00918 --*/
00919 {
00920 <span class="preprocessor">#if defined(IADBG)</span>
00921 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( <a class="code" href="../../d4/d2/struct__LOCK.html">LOCK</a> )
00922        DbgPrint( "IA32 <a class="code" href="../../d4/d2/struct__LOCK.html">LOCK</a>: Eip %x\n", EIP(Frame) );
00923 #endif <span class="comment">// IADBG</span>
00924 
00925     <span class="comment">//</span>
00926     <span class="comment">// BUGBUG: Delay implementation of this handler</span>
00927     <span class="comment">// Should we bug check instead so we know when we're running</span>
00928     <span class="comment">// on a platform that needs this?</span>
00929     <span class="comment">//</span>
00930     KiIA32CommonArgs(Frame,
00931         STATUS_PRIVILEGED_INSTRUCTION,
00932         (PVOID) EIP(Frame),
00933         0, 0, 0);
00934     return TRUE;
00935 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="ia32trap.c::KiIA32InterceptSystemFlag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32InterceptSystemFlag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00882">882</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00222">ISRCode</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00885 {
00886 <span class="preprocessor">#if defined(IADBG)</span>
00887 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( FLAG )
00888        DbgPrint( "IA32 FLAG: Eip %x Old EFlag: %x OpcodeId %x\n", 
00889                  EIP(Frame),
00890                  (ULONG) (Frame-&gt;IIM &amp; 0xff),
00891                  (ULONG) (ISRCode(Frame) &gt;&gt; 14));
00892 #endif <span class="comment">// IADBG</span>
00893     KiIA32CommonArgs(Frame,
00894         STATUS_ILLEGAL_INSTRUCTION,
00895         (PVOID) EIP(Frame),
00896         0, 0, 0);
00897     return TRUE;
00898 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="ia32trap.c::KiIA32InterruptionVectorHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32InterruptionVectorHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l01064">1064</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00223">ISRVector</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
<pre class="fragment"><div>01069                    :
01070 
01071     <a class="code" href="../../d0/d4/ia32trap_8c.html#a27">KiIA32InterruptionVectorHandler</a>
01072 
01073     Called by first label KiIA32InterruptionVector() to handle further iA32 
01074     interruption processing. Only get here on INT xx instructions
01075    
01076 Arguments:
01077 
01078     Frame - iA32 TrapFrame that was saved in the memory stack
01079 
01080 Return Value:
01081     TRUE - go to dispatch exception
01082     FALSE - Exception was handled, do an RFI
01083 
01084 --*/
01085 {
01086 <span class="preprocessor">#if defined(IADBG)</span>
01087 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( INTERRUPTION )
01088        DbgPrint("IA32 Interruption: ISRVector %x Frame %x\n", ISRVector(Frame), Frame);
01089 #endif <span class="comment">// IADBG</span>
01090 
01091     ASSERT(UserMode == Frame-&gt;PreviousMode);
01092 
01093     <span class="comment">//</span>
01094     <span class="comment">// Follow the ia32 way of INT xx as an Access Violation</span>
01095     <span class="comment">//</span>
01096     <span class="comment">// INT 3 should be handled via a debug exception and should</span>
01097     <span class="comment">// never get here...</span>
01098     <span class="comment">//</span>
01099     ASSERT(3 != ISRVector(Frame));
01100     
01101     KiIA32CommonArgs(Frame,
01102                      STATUS_ACCESS_VIOLATION,
01103                      (PVOID) EIP(Frame),
01104                      0, 0, 0);
01105     return TRUE;
01106 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="ia32trap.c::KiIA32InterruptVector" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIA32InterruptVector           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Frame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00788">788</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00217">EIP</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00256">IF_IA32TRAP_DEBUG</a>, <a class="el" href="../../d9/d2/ia32def_8h-source.html#l00223">ISRVector</a>, <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00036">KiIA32CommonArgs()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00801 {
00802 <span class="preprocessor">#if defined(IADBG)</span>
00803 <span class="preprocessor"></span>    <a class="code" href="../../d8/d3/ia32def_8h.html#a129">IF_IA32TRAP_DEBUG</a>( INTNN )
00804        DbgPrint( "IA32 Intnn: Eip %x INT 0x%xH\n", EIP(Frame), ISRVector(Frame));
00805 #endif <span class="comment">// IADBG</span>
00806     KiIA32CommonArgs(Frame,
00807         STATUS_PRIVILEGED_INSTRUCTION,
00808         (PVOID) EIP(Frame),
00809         0, 0, 0);
00810     return TRUE;
00811 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ia32trap.c::KiUnalignedFault" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiUnalignedFault           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TrapFrame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/ia64_2trapc_8c-source.html#l01079">1079</a> of file <a class="el" href="../../d5/d4/ia64_2trapc_8c-source.html">ia64/trapc.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00755">KiIA32ExceptionAlignmentFault()</a>.
<p>
<pre class="fragment"><div>01084                    :
01085 
01086     Handler <span class="keywordflow">for</span> unaligned data reference. 
01087 
01088 Arguments:
01089 
01090     TrapFrame - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trap frame.
01091 
01092 Return Value:
01093 
01094     None.
01095 
01096 Notes:
01097 
01098     ISR.ei bits indicate which instruction caused <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception.
01099 
01100 --*/
01101 
01102 {
01103     PEXCEPTION_RECORD ExceptionRecord;
01104     PVOID VirtualAddress;
01105 
01106     VirtualAddress = (PVOID)TrapFrame-&gt;StIFA;
01107     
01108     ExceptionRecord = (PEXCEPTION_RECORD)&amp;TrapFrame-&gt;ExceptionRecord;
01109     ExceptionRecord-&gt;ExceptionAddress =
01110         (PVOID)RtlIa64InsertIPSlotNumber(TrapFrame-&gt;StIIP,
01111                    ((TrapFrame-&gt;StISR &amp; ISR_EI_MASK) &gt;&gt; ISR_EI));
01112     
01113     ExceptionRecord-&gt;ExceptionFlags = 0;
01114     ExceptionRecord-&gt;ExceptionRecord = (PEXCEPTION_RECORD)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01115     
01116     ExceptionRecord-&gt;NumberParameters = 5;
01117     ExceptionRecord-&gt;ExceptionInformation[0] = (ULONG_PTR)0;
01118     ExceptionRecord-&gt;ExceptionInformation[1] = (ULONG_PTR)VirtualAddress;
01119     ExceptionRecord-&gt;ExceptionInformation[2] = (ULONG_PTR)0;
01120     ExceptionRecord-&gt;ExceptionInformation[3] = (ULONG_PTR)TrapFrame-&gt;StIIPA;
01121     ExceptionRecord-&gt;ExceptionInformation[4] = (ULONG_PTR)TrapFrame-&gt;StISR;
01122 
01123     ExceptionRecord-&gt;ExceptionCode = STATUS_DATATYPE_MISALIGNMENT;
01124 
01125     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01126 }       

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a1" doxytag="ia32trap.c::KiIA32ExceptionDispatchTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN(* <a class="el" href="../../d0/d4/ia32trap_8c.html#a1">KiIA32ExceptionDispatchTable</a>[])(PKTRAP_FRAME)=          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00956">956</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l01026">KiIA32ExceptionVectorHandler()</a>.
<p>
<pre class="fragment"><div>00956                                                           {
00957     <a class="code" href="../../d0/d4/ia32trap_8c.html#a5">KiIA32ExceptionDivide</a>,
00958     <a class="code" href="../../d0/d4/ia32trap_8c.html#a6">KiIA32ExceptionDebug</a>,
00959     <a class="code" href="../../d0/d4/ia32trap_8c.html#a24">KiIA32ExceptionPanic</a>,
00960     <a class="code" href="../../d0/d4/ia32trap_8c.html#a7">KiIA32ExceptionBreak</a>,
00961     <a class="code" href="../../d0/d4/ia32trap_8c.html#a8">KiIA32ExceptionOverflow</a>,
00962     <a class="code" href="../../d0/d4/ia32trap_8c.html#a9">KiIA32ExceptionBound</a>,
00963     <a class="code" href="../../d0/d4/ia32trap_8c.html#a15">KiIA32ExceptionInvalidOp</a>,
00964     <a class="code" href="../../d0/d4/ia32trap_8c.html#a12">KiIA32ExceptionNoDevice</a>,
00965     <a class="code" href="../../d0/d4/ia32trap_8c.html#a24">KiIA32ExceptionPanic</a>,
00966     <a class="code" href="../../d0/d4/ia32trap_8c.html#a24">KiIA32ExceptionPanic</a>,
00967     <a class="code" href="../../d0/d4/ia32trap_8c.html#a24">KiIA32ExceptionPanic</a>,
00968     <a class="code" href="../../d0/d4/ia32trap_8c.html#a13">KiIA32ExceptionSegmentNotPresent</a>,
00969     <a class="code" href="../../d0/d4/ia32trap_8c.html#a14">KiIA32ExceptionStack</a>,
00970     <a class="code" href="../../d0/d4/ia32trap_8c.html#a16">KiIA32ExceptionGPFault</a>,
00971     <a class="code" href="../../d0/d4/ia32trap_8c.html#a24">KiIA32ExceptionPanic</a>,
00972     <a class="code" href="../../d0/d4/ia32trap_8c.html#a24">KiIA32ExceptionPanic</a>,
00973     <a class="code" href="../../d0/d4/ia32trap_8c.html#a18">KiIA32ExceptionFPFault</a>,
00974     <a class="code" href="../../d0/d4/ia32trap_8c.html#a19">KiIA32ExceptionAlignmentFault</a>,
00975     <a class="code" href="../../d0/d4/ia32trap_8c.html#a24">KiIA32ExceptionPanic</a>,
00976     <a class="code" href="../../d0/d4/ia32trap_8c.html#a17">KiIA32ExceptionKNI</a>
00977 };
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ia32trap.c::KiIA32InterceptionDispatchTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN(* <a class="el" href="../../d0/d4/ia32trap_8c.html#a2">KiIA32InterceptionDispatchTable</a>[])(PKTRAP_FRAME)=          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00979">979</a> of file <a class="el" href="../../d1/d3/ia32trap_8c-source.html">ia32trap.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/ia32trap_8c-source.html#l00987">KiIA32InterceptionVectorHandler()</a>.
<p>
<pre class="fragment"><div>00979                                                              {
00980     <a class="code" href="../../d0/d4/ia32trap_8c.html#a11">KiIA32InterceptInstruction</a>,
00981     <a class="code" href="../../d0/d4/ia32trap_8c.html#a21">KiIA32InterceptGate</a>,
00982     <a class="code" href="../../d0/d4/ia32trap_8c.html#a22">KiIA32InterceptSystemFlag</a>,
00983     <a class="code" href="../../d0/d4/ia32trap_8c.html#a23">KiIA32InterceptLock</a>
00984 };
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:07 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
