<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: config.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>config.c</h1><a href="../../d9/d4/config_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    config.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implements the code to find an ARC configuration tree</span>
00012 <span class="comment">    entry as constructed by the OS Loader.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    David N. Cutler (davec) 9-Sep-1991</span>
00017 <span class="comment"></span>
00018 <span class="comment">Environment:</span>
00019 <span class="comment"></span>
00020 <span class="comment">    User mode only.</span>
00021 <span class="comment"></span>
00022 <span class="comment">Revision History:</span>
00023 <span class="comment"></span>
00024 <span class="comment">--*/</span>
00025 
00026 <span class="preprocessor">#include "<a class="code" href="../../d0/d0/ki_8h.html">ki.h</a>"</span>
00027 
00028 <span class="preprocessor">#ifdef ALLOC_PRAGMA</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(INIT,KeFindConfigurationEntry)</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(INIT,KeFindConfigurationNextEntry)</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span>
00033 <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a>
<a name="l00034"></a><a class="code" href="../../d9/d4/config_8c.html#a0">00034</a> <a class="code" href="../../d9/d4/config_8c.html#a0">KeFindConfigurationEntry</a> (
00035     IN <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> Child,
00036     IN CONFIGURATION_CLASS Class,
00037     IN CONFIGURATION_TYPE Type,
00038     IN PULONG Key OPTIONAL
00039     )
00040 <span class="comment">/*++</span>
00041 <span class="comment"></span>
00042 <span class="comment">Routine Description:</span>
00043 <span class="comment"></span>
00044 <span class="comment">    This function search the specified configuration tree and returns a</span>
00045 <span class="comment">    pointer to an entry that matches the specified class, type, and key</span>
00046 <span class="comment">    parameters.</span>
00047 <span class="comment"></span>
00048 <span class="comment">    This routine is the same as KeFindConfurationEntryNext expect</span>
00049 <span class="comment">    that the search is performed from the first entry</span>
00050 <span class="comment"></span>
00051 <span class="comment">    N.B. This routine can only be called during system initialization.</span>
00052 <span class="comment"></span>
00053 <span class="comment">--*/</span>
00054 {
00055     <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> Resume;
00056 
00057     Resume = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00058     <span class="keywordflow">return</span> <a class="code" href="../../d9/d4/config_8c.html#a1">KeFindConfigurationNextEntry</a> (Child, Class, Type, <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>, &amp;Resume);
00059 }
00060 
00061 <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a>
<a name="l00062"></a><a class="code" href="../../d9/d4/config_8c.html#a1">00062</a> <a class="code" href="../../d9/d4/config_8c.html#a1">KeFindConfigurationNextEntry</a> (
00063     IN <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> Child,
00064     IN CONFIGURATION_CLASS Class,
00065     IN CONFIGURATION_TYPE Type,
00066     IN PULONG Key OPTIONAL,
00067     IN <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> *Resume
00068     )
00069 
00070 <span class="comment">/*++</span>
00071 <span class="comment"></span>
00072 <span class="comment">Routine Description:</span>
00073 <span class="comment"></span>
00074 <span class="comment">    This function search the specified configuration tree and returns a</span>
00075 <span class="comment">    pointer to an entry that matches the specified class, type, and key</span>
00076 <span class="comment">    parameters.</span>
00077 <span class="comment"></span>
00078 <span class="comment">    N.B. This routine can only be called during system initialization.</span>
00079 <span class="comment"></span>
00080 <span class="comment">Arguments:</span>
00081 <span class="comment"></span>
00082 <span class="comment">    Child - Supplies an optional pointer to an NT configuration component.</span>
00083 <span class="comment"></span>
00084 <span class="comment">    Class - Supplies the configuration class of the entry to locate.</span>
00085 <span class="comment"></span>
00086 <span class="comment">    Type - Supplies the configuration type of the entry to locate.</span>
00087 <span class="comment"></span>
00088 <span class="comment">    Key - Supplies a pointer to an optional key value to use in locating</span>
00089 <span class="comment">        the specified entry.</span>
00090 <span class="comment"></span>
00091 <span class="comment">    Resume - Supplies the last returned entry for which the search</span>
00092 <span class="comment">        should resume from.</span>
00093 <span class="comment"></span>
00094 <span class="comment">Return Value:</span>
00095 <span class="comment"></span>
00096 <span class="comment">    If the specified entry is located, then a pointer to the configuration</span>
00097 <span class="comment">    entry is returned as the function value. Otherwise, NULL is returned.</span>
00098 <span class="comment"></span>
00099 <span class="comment">--*/</span>
00100 
00101 {
00102 
00103     <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> Entry;
00104     ULONG MatchKey;
00105     ULONG MatchMask;
00106     <a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html">PCONFIGURATION_COMPONENT_DATA</a> Sibling;
00107 
00108     <span class="comment">//</span>
00109     <span class="comment">// Initialize the match key and mask based on whether the optional key</span>
00110     <span class="comment">// value is specified.</span>
00111     <span class="comment">//</span>
00112 
00113     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>)) {
00114         MatchMask = 0xffffffff;
00115         MatchKey = *<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
00116 
00117     } <span class="keywordflow">else</span> {
00118         MatchMask = 0;
00119         MatchKey = 0;
00120     }
00121 
00122     <span class="comment">//</span>
00123     <span class="comment">// Search specified configuration tree for an entry that matches the</span>
00124     <span class="comment">// the specified class, type, and key.</span>
00125     <span class="comment">//</span>
00126 
00127     <span class="keywordflow">while</span> (Child != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00128         <span class="keywordflow">if</span> (*Resume) {
00129             <span class="comment">//</span>
00130             <span class="comment">// If resume location found, clear resume location and continue</span>
00131             <span class="comment">// search with next entry</span>
00132             <span class="comment">//</span>
00133 
00134             <span class="keywordflow">if</span> (Child == *Resume) {
00135                 *Resume = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00136             }
00137         } <span class="keywordflow">else</span> {
00138 
00139             <span class="comment">//</span>
00140             <span class="comment">// If the class, type, and key match, then return a pointer to</span>
00141             <span class="comment">// the child entry.</span>
00142             <span class="comment">//</span>
00143 
00144             <span class="keywordflow">if</span> ((Child-&gt;ComponentEntry.Class == Class) &amp;&amp;
00145                 (Child-&gt;ComponentEntry.Type == Type) &amp;&amp;
00146                 ((Child-&gt;ComponentEntry.Key &amp; MatchMask) == MatchKey)) {
00147                 <span class="keywordflow">return</span> Child;
00148             }
00149         }
00150 
00151         <span class="comment">//</span>
00152         <span class="comment">// If the child has a sibling list, then search the sibling list</span>
00153         <span class="comment">// for an entry that matches the specified class, type, and key.</span>
00154         <span class="comment">//</span>
00155 
00156         Sibling = Child-&gt;<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html#o2">Sibling</a>;
00157         <span class="keywordflow">while</span> (Sibling != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00158             <span class="keywordflow">if</span> (*Resume) {
00159                 <span class="comment">//</span>
00160                 <span class="comment">// If resume location found, clear resume location and continue</span>
00161                 <span class="comment">// search with next entry</span>
00162                 <span class="comment">//</span>
00163 
00164                 <span class="keywordflow">if</span> (Sibling == *Resume) {
00165                     *Resume = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00166                 }
00167             } <span class="keywordflow">else</span> {
00168 
00169                 <span class="comment">//</span>
00170                 <span class="comment">// If the class, type, and key match, then return a pointer to</span>
00171                 <span class="comment">// the child entry.</span>
00172                 <span class="comment">//</span>
00173 
00174                 <span class="keywordflow">if</span> ((Sibling-&gt;<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html#o3">ComponentEntry</a>.<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o0">Class</a> == Class) &amp;&amp;
00175                     (Sibling-&gt;<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html#o3">ComponentEntry</a>.<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o1">Type</a> == Type) &amp;&amp;
00176                     ((Sibling-&gt;<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html#o3">ComponentEntry</a>.<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o5">Key</a> &amp; MatchMask) == MatchKey)) {
00177                     <span class="keywordflow">return</span> Sibling;
00178                 }
00179             }
00180 
00181             <span class="comment">//</span>
00182             <span class="comment">// If the sibling has a child tree, then search the child tree</span>
00183             <span class="comment">// for an entry that matches the specified class, type, and key.</span>
00184             <span class="comment">//</span>
00185 
00186             <span class="keywordflow">if</span> (Sibling-&gt;<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html#o1">Child</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00187                Entry = <a class="code" href="../../d9/d4/config_8c.html#a1">KeFindConfigurationNextEntry</a> (
00188                                 Sibling-&gt;<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html#o1">Child</a>,
00189                                 Class,
00190                                 Type,
00191                                 <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>,
00192                                 Resume
00193                                 );
00194 
00195                <span class="keywordflow">if</span> (Entry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00196                    <span class="keywordflow">return</span> Entry;
00197                }
00198             }
00199 
00200             Sibling = Sibling-&gt;<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html#o2">Sibling</a>;
00201         }
00202 
00203         Child = Child-&gt;<a class="code" href="../../d5/d8/struct__CONFIGURATION__COMPONENT__DATA.html#o1">Child</a>;
00204     }
00205 
00206     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00207 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:32 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
