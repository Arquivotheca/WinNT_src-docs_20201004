<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: getset.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>getset.c</h1><a href="../../d9/d4/ntcon_2server_2getset_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    getset.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">        This file implements the NT console server console state API</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Therese Stowell (thereses) 5-Dec-1990</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#include "<a class="code" href="../../d6/d3/w32_2ntcon_2server_2precomp_8h.html">precomp.h</a>"</span>
00022 <span class="preprocessor">#pragma hdrstop</span>
00023 <span class="preprocessor"></span>
00024 <span class="preprocessor">#ifdef i386</span>
00025 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00026 ReverseMousePointer(
00027     IN <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
00028     IN PSMALL_RECT Region
00029     );
00030 <span class="preprocessor">#endif</span>
00031 <span class="preprocessor"></span>
00032 ULONG
<a name="l00033"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a0">00033</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a0">SrvGetConsoleMode</a>(
00034     IN OUT PCSR_API_MSG m,
00035     IN OUT PCSR_REPLY_STATUS ReplyStatus
00036     )
00037 {
00038     <a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html">PCONSOLE_MODE_MSG</a> a = (<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html">PCONSOLE_MODE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00039     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00040     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00041     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00042 
00043     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o0">ConsoleHandle</a>,
00044                          &amp;Console
00045                         );
00046     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00047         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00048     }
00049     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00050                                  a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o1">Handle</a>,
00051                                  <a class="code" href="../../d1/d7/server_8h.html#a50">CONSOLE_ANY_HANDLE</a>,
00052                                  GENERIC_READ,
00053                                  &amp;HandleData
00054                                 );
00055     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00056 
00057         <span class="comment">//</span>
00058         <span class="comment">// check handle type and access</span>
00059         <span class="comment">//</span>
00060 
00061         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>) {
00062             a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;InputMode;
00063             <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a19">CONSOLE_USE_PRIVATE_FLAGS</a>) {
00064                 a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> |= ENABLE_PRIVATE_FLAGS;
00065                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o43">InsertMode</a>) {
00066                     a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> |= ENABLE_INSERT_MODE;
00067                 }
00068                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>) {
00069                     a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> |= ENABLE_QUICK_EDIT_MODE;
00070                 }
00071             }
00072         } <span class="keywordflow">else</span> {
00073             a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;OutputMode;
00074         }
00075     }
00076     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00077     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00078     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00079 }
00080 
00081 ULONG
<a name="l00082"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a1">00082</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a1">SrvGetConsoleNumberOfFonts</a>(
00083     IN OUT PCSR_API_MSG m,
00084     IN OUT PCSR_REPLY_STATUS ReplyStatus
00085     )
00086 {
00087     <a class="code" href="../../d6/d2/struct__CONSOLE__GETNUMBEROFFONTS__MSG.html">PCONSOLE_GETNUMBEROFFONTS_MSG</a> a = (<a class="code" href="../../d6/d2/struct__CONSOLE__GETNUMBEROFFONTS__MSG.html">PCONSOLE_GETNUMBEROFFONTS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00088     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00089     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00090 
00091     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d2/struct__CONSOLE__GETNUMBEROFFONTS__MSG.html#o0">ConsoleHandle</a>,
00092                          &amp;Console
00093                         );
00094     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00095         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00096     }
00097     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) {
00098         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_FULLSCREEN_MODE;
00099     } <span class="keywordflow">else</span> {
00100         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a29">GetNumFonts</a>(&amp;a-&gt;<a class="code" href="../../d6/d2/struct__CONSOLE__GETNUMBEROFFONTS__MSG.html#o1">NumberOfFonts</a>);
00101     }
00102     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00103     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00104     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00105 }
00106 
00107 ULONG
<a name="l00108"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a2">00108</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a2">SrvGetConsoleNumberOfInputEvents</a>(
00109     IN OUT PCSR_API_MSG m,
00110     IN OUT PCSR_REPLY_STATUS ReplyStatus
00111     )
00112 {
00113     <a class="code" href="../../d7/d2/struct__CONSOLE__GETNUMBEROFINPUTEVENTS__MSG.html">PCONSOLE_GETNUMBEROFINPUTEVENTS_MSG</a> a = (<a class="code" href="../../d7/d2/struct__CONSOLE__GETNUMBEROFINPUTEVENTS__MSG.html">PCONSOLE_GETNUMBEROFINPUTEVENTS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00114     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00115     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00116     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00117 
00118     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d2/struct__CONSOLE__GETNUMBEROFINPUTEVENTS__MSG.html#o0">ConsoleHandle</a>,
00119                          &amp;Console
00120                         );
00121     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00122         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00123     }
00124     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00125                                  a-&gt;<a class="code" href="../../d7/d2/struct__CONSOLE__GETNUMBEROFINPUTEVENTS__MSG.html#o1">InputHandle</a>,
00126                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>,
00127                                  GENERIC_READ,
00128                                  &amp;HandleData
00129                                 );
00130     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00131         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a21">GetNumberOfReadyEvents</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer,
00132                                       &amp;a-&gt;<a class="code" href="../../d7/d2/struct__CONSOLE__GETNUMBEROFINPUTEVENTS__MSG.html#o2">ReadyEvents</a>
00133                                      );
00134     }
00135     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00136     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00137     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00138 }
00139 
00140 ULONG
<a name="l00141"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a3">00141</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a3">SrvGetConsoleScreenBufferInfo</a>(
00142     IN OUT PCSR_API_MSG m,
00143     IN OUT PCSR_REPLY_STATUS ReplyStatus
00144     )
00145 {
00146     <a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html">PCONSOLE_GETSCREENBUFFERINFO_MSG</a> a = (<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html">PCONSOLE_GETSCREENBUFFERINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00147     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00148     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00149     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00150 
00151     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o0">ConsoleHandle</a>,
00152                          &amp;Console
00153                         );
00154     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00155         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00156     }
00157     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00158                                  a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o1">OutputHandle</a>,
00159                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00160                                  GENERIC_READ,
00161                                  &amp;HandleData
00162                                 );
00163     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00164         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a55">GetScreenBufferInformation</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
00165                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o2">Size</a>,
00166                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o3">CursorPosition</a>,
00167                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o4">ScrollPosition</a>,
00168                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o5">Attributes</a>,
00169                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o6">CurrentWindowSize</a>,
00170                                           &amp;a-&gt;<a class="code" href="../../d8/d2/struct__CONSOLE__GETSCREENBUFFERINFO__MSG.html#o7">MaximumWindowSize</a>
00171                                          );
00172     }
00173     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00174     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00175     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00176 }
00177 
00178 ULONG
<a name="l00179"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a4">00179</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a4">SrvGetConsoleCursorInfo</a>(
00180     IN OUT PCSR_API_MSG m,
00181     IN OUT PCSR_REPLY_STATUS ReplyStatus
00182     )
00183 {
00184     <a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html">PCONSOLE_GETCURSORINFO_MSG</a> a = (<a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html">PCONSOLE_GETCURSORINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00185     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00186     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00187     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00188 
00189     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html#o0">ConsoleHandle</a>,
00190                          &amp;Console
00191                         );
00192     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00193         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00194     }
00195     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00196                                  a-&gt;<a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html#o1">OutputHandle</a>,
00197                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00198                                  GENERIC_READ,
00199                                  &amp;HandleData
00200                                 );
00201     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00202         a-&gt;<a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html#o2">CursorSize</a> = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;BufferInfo.TextInfo.CursorSize;
00203         a-&gt;<a class="code" href="../../d6/d1/struct__CONSOLE__GETCURSORINFO__MSG.html#o3">Visible</a> = (BOOLEAN) HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;BufferInfo.TextInfo.CursorVisible;
00204     }
00205     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00206     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00207     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00208 }
00209 
00210 ULONG
<a name="l00211"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a5">00211</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a5">SrvGetConsoleMouseInfo</a>(
00212     IN OUT PCSR_API_MSG m,
00213     IN OUT PCSR_REPLY_STATUS ReplyStatus
00214     )
00215 {
00216     <a class="code" href="../../d5/d2/struct__CONSOLE__GETMOUSEINFO__MSG.html">PCONSOLE_GETMOUSEINFO_MSG</a> a = (<a class="code" href="../../d5/d2/struct__CONSOLE__GETMOUSEINFO__MSG.html">PCONSOLE_GETMOUSEINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00217     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00218     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00219 
00220     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d2/struct__CONSOLE__GETMOUSEINFO__MSG.html#o0">ConsoleHandle</a>,
00221                          &amp;Console
00222                         );
00223     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00224         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00225     }
00226     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a18">GetMouseButtons</a>(&amp;a-&gt;<a class="code" href="../../d5/d2/struct__CONSOLE__GETMOUSEINFO__MSG.html#o1">NumButtons</a>);
00227     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00228     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00229     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00230 }
00231 
00232 ULONG
<a name="l00233"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a6">00233</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a6">SrvGetConsoleFontInfo</a>(
00234     IN OUT PCSR_API_MSG m,
00235     IN OUT PCSR_REPLY_STATUS ReplyStatus
00236     )
00237 {
00238     <a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html">PCONSOLE_GETFONTINFO_MSG</a> a = (<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html">PCONSOLE_GETFONTINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00239     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00240     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00241     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00242 
00243     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o0">ConsoleHandle</a>,
00244                          &amp;Console
00245                         );
00246     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00247         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00248     }
00249 
00250     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o3">BufPtr</a>, a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o4">NumFonts</a>, <span class="keyword">sizeof</span>(*a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o3">BufPtr</a>))) {
00251         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00252         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00253     }
00254 
00255     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00256                                  a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o1">OutputHandle</a>,
00257                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00258                                  GENERIC_READ,
00259                                  &amp;HandleData
00260                                 );
00261     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00262         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) {
00263             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_FULLSCREEN_MODE;
00264         } <span class="keywordflow">else</span> {
00265             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a30">GetAvailableFonts</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
00266                                      a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o2">MaximumWindow</a>,
00267                                      a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o3">BufPtr</a>,
00268                                      &amp;a-&gt;<a class="code" href="../../d8/d1/struct__CONSOLE__GETFONTINFO__MSG.html#o4">NumFonts</a>
00269                                     );
00270         }
00271     }
00272     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00273     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00274     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00275 }
00276 
00277 ULONG
<a name="l00278"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a7">00278</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a7">SrvGetConsoleFontSize</a>(
00279     IN OUT PCSR_API_MSG m,
00280     IN OUT PCSR_REPLY_STATUS ReplyStatus
00281     )
00282 {
00283     <a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html">PCONSOLE_GETFONTSIZE_MSG</a> a = (<a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html">PCONSOLE_GETFONTSIZE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00284     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00285     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00286     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00287 
00288     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html#o0">ConsoleHandle</a>,
00289                          &amp;Console
00290                         );
00291     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00292         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00293     }
00294     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00295                                  a-&gt;<a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html#o1">OutputHandle</a>,
00296                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00297                                  GENERIC_READ,
00298                                  &amp;HandleData
00299                                 );
00300     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00301         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) {
00302             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_FULLSCREEN_MODE;
00303         } <span class="keywordflow">else</span> {
00304             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a31">GetFontSize</a>(a-&gt;<a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html#o2">FontIndex</a>,
00305                                &amp;a-&gt;<a class="code" href="../../d9/d1/struct__CONSOLE__GETFONTSIZE__MSG.html#o3">FontSize</a>
00306                               );
00307         }
00308     }
00309     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00310     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00311     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00312 }
00313 
00314 ULONG
<a name="l00315"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a8">00315</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a8">SrvGetConsoleCurrentFont</a>(
00316     IN OUT PCSR_API_MSG m,
00317     IN OUT PCSR_REPLY_STATUS ReplyStatus
00318     )
00319 {
00320     <a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html">PCONSOLE_GETCURRENTFONT_MSG</a> a = (<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html">PCONSOLE_GETCURRENTFONT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00321     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00322     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00323     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00324 
00325     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html#o0">ConsoleHandle</a>,
00326                          &amp;Console
00327                         );
00328     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00329         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00330     }
00331     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00332                                  a-&gt;<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html#o1">OutputHandle</a>,
00333                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00334                                  GENERIC_READ,
00335                                  &amp;HandleData
00336                                 );
00337     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00338         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN) {
00339             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_FULLSCREEN_MODE;
00340         } <span class="keywordflow">else</span> {
00341             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a32">GetCurrentFont</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
00342                                   a-&gt;<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html#o2">MaximumWindow</a>,
00343                                   &amp;a-&gt;<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html#o3">FontIndex</a>,
00344                                   &amp;a-&gt;<a class="code" href="../../d5/d1/struct__CONSOLE__GETCURRENTFONT__MSG.html#o4">FontSize</a>
00345                                  );
00346         }
00347     }
00348     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00349     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00350     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00351 }
00352 
00353 ULONG
<a name="l00354"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a9">00354</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a9">SrvSetConsoleMode</a>(
00355     IN OUT PCSR_API_MSG m,
00356     IN OUT PCSR_REPLY_STATUS ReplyStatus
00357     )
00358 {
00359     <a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html">PCONSOLE_MODE_MSG</a> a = (<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html">PCONSOLE_MODE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00360     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00361     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00362     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00363 
00364     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o0">ConsoleHandle</a>,
00365                          &amp;Console
00366                         );
00367     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00368         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00369     }
00370     <span class="keywordflow">try</span> {
00371         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00372                                      a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o1">Handle</a>,
00373                                      <a class="code" href="../../d1/d7/server_8h.html#a50">CONSOLE_ANY_HANDLE</a>,
00374                                      GENERIC_WRITE,
00375                                      &amp;HandleData
00376                                     );
00377         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00378             leave;
00379         }
00380 
00381         <span class="keywordflow">if</span> (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o0">HandleType</a> &amp; <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>) {
00382             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ~(<a class="code" href="../../d1/d7/server_8h.html#a59">INPUT_MODES</a> | <a class="code" href="../../d1/d7/server_8h.html#a61">PRIVATE_MODES</a>)) {
00383                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00384                 leave;
00385             }
00386             <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; (ENABLE_LINE_INPUT | ENABLE_ECHO_INPUT)) == ENABLE_ECHO_INPUT) {
00387                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00388                 leave;
00389             }
00390             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a61">PRIVATE_MODES</a>) {
00391                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a19">CONSOLE_USE_PRIVATE_FLAGS</a>;
00392                 <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ENABLE_QUICK_EDIT_MODE) {
00393                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>;
00394                 } <span class="keywordflow">else</span> {
00395                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a11">CONSOLE_QUICK_EDIT_MODE</a>;
00396                 }
00397                 <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ENABLE_INSERT_MODE) {
00398                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o43">InsertMode</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00399                 } <span class="keywordflow">else</span> {
00400                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o43">InsertMode</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00401                 }
00402             } <span class="keywordflow">else</span> {
00403                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~<a class="code" href="../../d1/d7/server_8h.html#a19">CONSOLE_USE_PRIVATE_FLAGS</a>;
00404             }
00405 
00406 <span class="preprocessor">#ifdef i386</span>
00407 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE &amp;&amp;
00408                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a> &amp;&amp;
00409                 (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ENABLE_MOUSE_INPUT) != (HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;InputMode &amp; ENABLE_MOUSE_INPUT)) {
00410                 <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ENABLE_MOUSE_INPUT) {
00411                     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;InputMode |= ENABLE_MOUSE_INPUT;
00412                 }
00413 <span class="preprocessor">#if defined(FE_SB)</span>
00414 <span class="preprocessor"></span>                <span class="comment">// Korean HBIOS doesn't like to reverse mouse pointer.</span>
00415                 <span class="comment">// Because HBIOS will initialize full screen mode again.</span>
00416                 <span class="comment">// 949 = Korea WanSung Code Page.</span>
00417                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a> != 949) {
00418                     ReverseMousePointer(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
00419                                         &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
00420                 }
00421 <span class="preprocessor">#else</span>
00422 <span class="preprocessor"></span>                ReverseMousePointer(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
00423                                     &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
00424 <span class="preprocessor">#endif</span>
00425 <span class="preprocessor"></span>            }
00426 <span class="preprocessor">#endif</span>
00427 <span class="preprocessor"></span>            HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer-&gt;InputMode = a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ~<a class="code" href="../../d1/d7/server_8h.html#a61">PRIVATE_MODES</a>;
00428         }
00429         <span class="keywordflow">else</span> {
00430             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a> &amp; ~<a class="code" href="../../d1/d7/server_8h.html#a60">OUTPUT_MODES</a>) {
00431                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00432                 leave;
00433             }
00434             HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;OutputMode = a-&gt;<a class="code" href="../../d6/d3/struct__CONSOLE__MODE__MSG.html#o2">Mode</a>;
00435         }
00436     } finally {
00437         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00438     }
00439     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00440     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00441 }
00442 
00443 ULONG
<a name="l00444"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a10">00444</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a10">SrvGenerateConsoleCtrlEvent</a>(
00445     IN OUT PCSR_API_MSG m,
00446     IN OUT PCSR_REPLY_STATUS ReplyStatus
00447     )
00448 {
00449     <a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html">PCONSOLE_CTRLEVENT_MSG</a> a = (<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html">PCONSOLE_CTRLEVENT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00450     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00451     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00452 
00453     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html#o0">ConsoleHandle</a>,
00454                          &amp;Console
00455                         );
00456     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00457         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00458     }
00459     <span class="keywordflow">try</span> {
00460         <span class="comment">//</span>
00461         <span class="comment">// Make sure the process group id is valid</span>
00462         <span class="comment">//</span>
00463         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html#o2">ProcessGroupId</a>) {
00464             <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">PCONSOLE_PROCESS_HANDLE</a> ProcessHandleRecord;
00465             PLIST_ENTRY ListHead, ListNext;
00466 
00467             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00468             ListHead = &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o19">ProcessHandleList</a>;
00469             ListNext = ListHead-&gt;Flink;
00470             <span class="keywordflow">while</span> (ListNext != ListHead) {
00471                 ProcessHandleRecord = CONTAINING_RECORD( ListNext, <a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html">CONSOLE_PROCESS_HANDLE</a>, ListLink );
00472                 ListNext = ListNext-&gt;Flink;
00473                 <span class="keywordflow">if</span> (ProcessHandleRecord-&gt;<a class="code" href="../../d1/d4/struct__CONSOLE__PROCESS__HANDLE.html#o2">Process</a>-&gt;ProcessGroupId == a-&gt;<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html#o2">ProcessGroupId</a>) {
00474                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00475                     <span class="keywordflow">break</span>;
00476                 }
00477             }
00478         }
00479         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00480             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o67">LimitingProcessId</a> = a-&gt;<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html#o2">ProcessGroupId</a>;
00481             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a50">HandleCtrlEvent</a>(Console, a-&gt;<a class="code" href="../../d9/d9/struct__CONSOLE__CTRLEVENT__MSG.html#o1">CtrlEvent</a>);
00482         }
00483 
00484     } finally {
00485         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00486     }
00487     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00488     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00489 }
00490 
00491 ULONG
<a name="l00492"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a11">00492</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a11">SrvSetConsoleActiveScreenBuffer</a>(
00493     IN OUT PCSR_API_MSG m,
00494     IN OUT PCSR_REPLY_STATUS ReplyStatus
00495     )
00496 {
00497     <a class="code" href="../../d9/d4/struct__CONSOLE__SETACTIVESCREENBUFFER__MSG.html">PCONSOLE_SETACTIVESCREENBUFFER_MSG</a> a = (<a class="code" href="../../d9/d4/struct__CONSOLE__SETACTIVESCREENBUFFER__MSG.html">PCONSOLE_SETACTIVESCREENBUFFER_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00498     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00499     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00500     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00501 
00502     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d4/struct__CONSOLE__SETACTIVESCREENBUFFER__MSG.html#o0">ConsoleHandle</a>,
00503                          &amp;Console
00504                         );
00505     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00506         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00507     }
00508     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00509                                  a-&gt;<a class="code" href="../../d9/d4/struct__CONSOLE__SETACTIVESCREENBUFFER__MSG.html#o1">OutputHandle</a>,
00510                                  <a class="code" href="../../d1/d7/server_8h.html#a48">CONSOLE_GRAPHICS_OUTPUT_HANDLE</a> | <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00511                                  GENERIC_WRITE,
00512                                  &amp;HandleData
00513                                 );
00514     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00515         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a71">SetActiveScreenBuffer</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer);
00516     }
00517     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00518     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00519     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00520 }
00521 
00522 
00523 ULONG
<a name="l00524"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a12">00524</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a12">SrvFlushConsoleInputBuffer</a>(
00525     IN OUT PCSR_API_MSG m,
00526     IN OUT PCSR_REPLY_STATUS ReplyStatus
00527     )
00528 {
00529     <a class="code" href="../../d3/d0/struct__CONSOLE__FLUSHINPUTBUFFER__MSG.html">PCONSOLE_FLUSHINPUTBUFFER_MSG</a> a = (<a class="code" href="../../d3/d0/struct__CONSOLE__FLUSHINPUTBUFFER__MSG.html">PCONSOLE_FLUSHINPUTBUFFER_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00530     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00531     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00532     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00533 
00534     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d3/d0/struct__CONSOLE__FLUSHINPUTBUFFER__MSG.html#o0">ConsoleHandle</a>,
00535                          &amp;Console
00536                         );
00537     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00538         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00539     }
00540     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00541                                  a-&gt;<a class="code" href="../../d3/d0/struct__CONSOLE__FLUSHINPUTBUFFER__MSG.html#o1">InputHandle</a>,
00542                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a0">CONSOLE_INPUT_HANDLE</a>,
00543                                  GENERIC_WRITE,
00544                                  &amp;HandleData
00545                                 );
00546     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00547         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a23">FlushInputBuffer</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.InputBuffer);
00548     }
00549     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00550     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00551     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00552 }
00553 
00554 ULONG
<a name="l00555"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a13">00555</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a13">SrvGetLargestConsoleWindowSize</a>(
00556     IN OUT PCSR_API_MSG m,
00557     IN OUT PCSR_REPLY_STATUS ReplyStatus
00558     )
00559 {
00560     <a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html">PCONSOLE_GETLARGESTWINDOWSIZE_MSG</a> a = (<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html">PCONSOLE_GETLARGESTWINDOWSIZE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00561     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00562     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00563     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00564     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00565     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
00566 
00567     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o0">ConsoleHandle</a>,
00568                          &amp;Console
00569                         );
00570     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00571         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00572     }
00573     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00574                                  a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o1">OutputHandle</a>,
00575                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00576                                  GENERIC_WRITE,
00577                                  &amp;HandleData
00578                                 );
00579     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00580         COORD FontSize;
00581 
00582         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
00583         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE) {
00584             a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o2">Size</a>.X = 80;
00585 <span class="preprocessor">#if defined(FE_SB)</span>
00586 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o2">Size</a>.Y = CONSOLE_IS_DBCS_OUTPUTCP(Console)?25:50;
00587 <span class="preprocessor">#else</span>
00588 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o2">Size</a>.Y = 50;
00589 <span class="preprocessor">#endif</span>
00590 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> {
00591             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
00592                 FontSize = <a class="code" href="../../d8/d5/consrv_8h.html#a66">SCR_FONTSIZE</a>(ScreenInfo);
00593             } <span class="keywordflow">else</span> {
00594                 FontSize.X = 1;
00595                 FontSize.Y = 1;
00596             }
00597             <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
00598             a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o2">Size</a>.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o3">FullScreenSize</a>.X / FontSize.X);
00599             a-&gt;<a class="code" href="../../d4/d2/struct__CONSOLE__GETLARGESTWINDOWSIZE__MSG.html#o2">Size</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o3">FullScreenSize</a>.Y / FontSize.Y);
00600         }
00601     }
00602     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00603     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00604     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00605 }
00606 
00607 ULONG
<a name="l00608"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a14">00608</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a14">SrvSetConsoleScreenBufferSize</a>(
00609     IN OUT PCSR_API_MSG m,
00610     IN OUT PCSR_REPLY_STATUS ReplyStatus
00611     )
00612 {
00613     <a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html">PCONSOLE_SETSCREENBUFFERSIZE_MSG</a> a = (<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html">PCONSOLE_SETSCREENBUFFERSIZE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00614     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00615     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00616     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00617     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00618     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
00619 
00620     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o0">ConsoleHandle</a>,
00621                          &amp;Console
00622                         );
00623     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00624         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00625     }
00626     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00627                                  a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o1">OutputHandle</a>,
00628                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00629                                  GENERIC_WRITE,
00630                                  &amp;HandleData
00631                                 );
00632     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00633 
00634         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
00635 
00636         <span class="comment">//</span>
00637         <span class="comment">// make sure requested screen buffer size isn't smaller than the window</span>
00638         <span class="comment">//</span>
00639 
00640         <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
00641         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.X &lt; <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo) ||
00642             a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.Y &lt; <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo) ||
00643             a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.Y &lt; WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.Y ||
00644             a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.X &lt; WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o0">MinimumWindowSize</a>.X) {
00645             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00646         }
00647         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.X == ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X &amp;&amp;
00648                  a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>.Y == ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
00649             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00650         } <span class="keywordflow">else</span> {
00651             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a58">ResizeScreenBuffer</a>(ScreenInfo,
00652                                   a-&gt;<a class="code" href="../../d4/d6/struct__CONSOLE__SETSCREENBUFFERSIZE__MSG.html#o2">Size</a>,
00653                                   <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00654         }
00655     }
00656     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00657     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00658     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00659 }
00660 
00661 ULONG
<a name="l00662"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a15">00662</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a15">SrvSetConsoleCursorPosition</a>(
00663     IN OUT PCSR_API_MSG m,
00664     IN OUT PCSR_REPLY_STATUS ReplyStatus
00665     )
00666 {
00667     <a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html">PCONSOLE_SETCURSORPOSITION_MSG</a> a = (<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html">PCONSOLE_SETCURSORPOSITION_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00668     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00669     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00670     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00671     COORD WindowOrigin;
00672     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00673 
00674     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o0">ConsoleHandle</a>,
00675                          &amp;Console
00676                         );
00677     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00678         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00679     }
00680     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00681                                  a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o1">OutputHandle</a>,
00682                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00683                                  GENERIC_WRITE,
00684                                  &amp;HandleData
00685                                 );
00686     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00687 
00688         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
00689 
00690         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X ||
00691             a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y &gt;= ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y ||
00692             a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X &lt; 0 ||
00693             a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y &lt; 0) {
00694             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00695         } <span class="keywordflow">else</span> {
00696             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a7">SetCursorPosition</a>(ScreenInfo,
00697                                        a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>,
00698                                        <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00699                                       );
00700         }
00701         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00702 <span class="preprocessor">#if defined(FE_IME)</span>
00703 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; CONSOLE_JUST_VDM_UNREGISTERED){
00704                 <span class="keywordflow">if</span>( ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o3">InputBuffer</a>.ImeMode.Open ){
00705                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> ScrollY = 0;
00706                     <a class="code" href="../../d6/d8/dispatch_8h.html#a10">AdjustCursorPosition</a>(ScreenInfo,a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,&amp;ScrollY);
00707                     a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y += ScrollY;
00708                 }
00709                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp;= ~CONSOLE_JUST_VDM_UNREGISTERED;
00710             }
00711 <span class="preprocessor">#endif</span>
00712 <span class="preprocessor"></span>            WindowOrigin.X = 0;
00713             WindowOrigin.Y = 0;
00714             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left &gt; a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X) {
00715                 WindowOrigin.X = a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X - ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00716             }
00717             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Right &lt; a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X) {
00718                 WindowOrigin.X = a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.X - ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Right;
00719             }
00720             <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top &gt; a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y) {
00721                 WindowOrigin.Y = a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y - ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00722             }
00723             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Bottom &lt; a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y) {
00724                 WindowOrigin.Y = a-&gt;<a class="code" href="../../d4/d5/struct__CONSOLE__SETCURSORPOSITION__MSG.html#o2">CursorPosition</a>.Y - ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Bottom;
00725             }
00726             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo,
00727                                      <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00728                                      WindowOrigin
00729                                     );
00730         }
00731     }
00732     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00733     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00734     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00735 }
00736 
00737 ULONG
<a name="l00738"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a16">00738</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a16">SrvSetConsoleCursorInfo</a>(
00739     IN OUT PCSR_API_MSG m,
00740     IN OUT PCSR_REPLY_STATUS ReplyStatus
00741     )
00742 {
00743     <a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html">PCONSOLE_SETCURSORINFO_MSG</a> a = (<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html">PCONSOLE_SETCURSORINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00744     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00745     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00746     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00747 
00748     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o0">ConsoleHandle</a>,
00749                          &amp;Console
00750                         );
00751     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00752         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00753     }
00754     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00755                                  a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o1">OutputHandle</a>,
00756                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00757                                  GENERIC_WRITE,
00758                                  &amp;HandleData
00759                                 );
00760     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00761         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o2">CursorSize</a> &gt; 100 || a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o2">CursorSize</a> == 0) {
00762             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00763         } <span class="keywordflow">else</span> {
00764             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a4">SetCursorInformation</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o2">CursorSize</a>,a-&gt;<a class="code" href="../../d3/d5/struct__CONSOLE__SETCURSORINFO__MSG.html#o3">Visible</a>);
00765         }
00766     }
00767     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00768     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00769     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00770 }
00771 
00772 ULONG
<a name="l00773"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a17">00773</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a17">SrvSetConsoleWindowInfo</a>(
00774     IN OUT PCSR_API_MSG m,
00775     IN OUT PCSR_REPLY_STATUS ReplyStatus
00776     )
00777 {
00778     <a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html">PCONSOLE_SETWINDOWINFO_MSG</a> a = (<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html">PCONSOLE_SETWINDOWINFO_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00779     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00780     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00781     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00782     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00783     COORD NewWindowSize;
00784     <a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html">WINDOW_LIMITS</a> WindowLimits;
00785 
00786     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o0">ConsoleHandle</a>,
00787                          &amp;Console
00788                         );
00789     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00790         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00791     }
00792     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00793                                  a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o1">OutputHandle</a>,
00794                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00795                                  GENERIC_WRITE,
00796                                  &amp;HandleData
00797                                 );
00798     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00799         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
00800         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o2">Absolute</a>) {
00801             a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Left += ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00802             a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Right += ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Right;
00803             a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Top += ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00804             a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Bottom += ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Bottom;
00805         }
00806         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Right &lt; a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Left ||
00807             a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Bottom &lt; a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Top) {
00808             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00809         } <span class="keywordflow">else</span> {
00810             NewWindowSize.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a15">WINDOW_SIZE_X</a>(&amp;a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>));
00811             NewWindowSize.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a16">WINDOW_SIZE_Y</a>(&amp;a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>));
00812             <a class="code" href="../../d6/d2/output_8c.html#a39">GetWindowLimits</a>(ScreenInfo, &amp;WindowLimits);
00813             <span class="keywordflow">if</span> ((NewWindowSize.X &gt; WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>.X ||
00814                  NewWindowSize.Y &gt; WindowLimits.<a class="code" href="../../d0/d9/struct__WINDOW__LIMITS.html#o1">MaximumWindowSize</a>.Y) &amp;&amp;
00815                  !(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN)) {
00816                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00817             } <span class="keywordflow">else</span> {
00818 <span class="preprocessor">#ifdef i386</span>
00819 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) {
00820                     COORD NewOrigin;
00821 
00822                     <span class="keywordflow">if</span> (NewWindowSize.X != (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a15">WINDOW_SIZE_X</a>(&amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>)) ||
00823                         NewWindowSize.Y != (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a16">WINDOW_SIZE_Y</a>(&amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>))) {
00824                         COORD WindowSize;
00825                         ULONG ModeIndex;
00826 
00827 <span class="preprocessor">#if defined(FE_SB)</span>
00828 <span class="preprocessor"></span>                        ModeIndex = MatchWindowSize(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>,NewWindowSize,&amp;WindowSize);
00829 <span class="preprocessor">#else</span>
00830 <span class="preprocessor"></span>                        ModeIndex = MatchWindowSize(NewWindowSize,&amp;WindowSize);
00831 <span class="preprocessor">#endif</span>
00832 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (NewWindowSize.X != WindowSize.X ||
00833                             NewWindowSize.Y != WindowSize.Y ||
00834                             WindowSize.X &gt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X ||
00835                             WindowSize.Y &gt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.Y) {
00836                             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00837                             <span class="keywordflow">return</span> (ULONG) STATUS_FULLSCREEN_MODE;
00838                         }
00839                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex = ModeIndex;
00840                         <a class="code" href="../../d6/d2/output_8c.html#a67">ResizeWindow</a>(ScreenInfo,
00841                                      &amp;a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>,
00842                                      <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00843                                     );
00844                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.WindowedWindowSize.X =
00845                                 <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo);
00846                         ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.WindowedWindowSize.Y =
00847                                 <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo);
00848                         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE &amp;&amp;
00849                             (!(ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a9">CONSOLE_VDM_REGISTERED</a>)) ) {
00850                             SetVideoMode(ScreenInfo);
00851                             <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
00852                         }
00853                     } <span class="keywordflow">else</span> {
00854                         NewOrigin.X = a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Left;
00855                         NewOrigin.Y = a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>.Top;
00856                         <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo,
00857                                         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00858                                         NewOrigin
00859                                        );
00860                     }
00861                 } <span class="keywordflow">else</span>
00862 <span class="preprocessor">#endif</span>
00863 <span class="preprocessor"></span>                {
00864                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a67">ResizeWindow</a>(ScreenInfo,
00865                                           &amp;a-&gt;<a class="code" href="../../d7/d6/struct__CONSOLE__SETWINDOWINFO__MSG.html#o3">Window</a>,
00866                                           <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00867                                          );
00868                     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/output_8h.html#a12">ACTIVE_SCREEN_BUFFER</a>(ScreenInfo)) {
00869                         <a class="code" href="../../d6/d2/output_8c.html#a68">SetWindowSize</a>(ScreenInfo);
00870                         <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
00871                     }
00872                 }
00873             }
00874         }
00875     }
00876     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00877     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00878     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00879 }
00880 
00881 ULONG
<a name="l00882"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a18">00882</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a18">SrvScrollConsoleScreenBuffer</a>(
00883     IN OUT PCSR_API_MSG m,
00884     IN OUT PCSR_REPLY_STATUS ReplyStatus
00885     )
00886 {
00887     <a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html">PCONSOLE_SCROLLSCREENBUFFER_MSG</a> a = (<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html">PCONSOLE_SCROLLSCREENBUFFER_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00888     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00889     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00890     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
00891     PSMALL_RECT ClipRect;
00892 
00893     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o0">ConsoleHandle</a>,
00894                          &amp;Console
00895                         );
00896     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00897         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00898     }
00899     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
00900                                  a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o1">OutputHandle</a>,
00901                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
00902                                  GENERIC_WRITE,
00903                                  &amp;HandleData
00904                                 );
00905     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00906 
00907         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o4">Clip</a>) {
00908             ClipRect = &amp;a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o3">ClipRectangle</a>;
00909         }
00910         <span class="keywordflow">else</span> {
00911             ClipRect = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00912         }
00913         <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o7">Unicode</a>) {
00914 <span class="preprocessor">#if defined(FE_SB)</span>
00915 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>.Char.UnicodeChar = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a39">CharToWchar</a>(Console,
00916                                                    Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>,
00917                                                    &amp;a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>.Char.AsciiChar);
00918 <span class="preprocessor">#else</span>
00919 <span class="preprocessor"></span>            a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>.Char.UnicodeChar = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a39">CharToWchar</a>(
00920                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>, a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>.Char.AsciiChar);
00921 <span class="preprocessor">#endif</span>
00922 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o1">Flags</a> &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
00923                 !(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN)) {
00924             <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a42">RealUnicodeToFalseUnicode</a>(&amp;a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>.Char.UnicodeChar,
00925                                     1,
00926                                     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>
00927                                     );
00928         }
00929         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a65">ScrollRegion</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
00930                             &amp;a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o2">ScrollRectangle</a>,
00931                             ClipRect,
00932                             a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o5">DestinationOrigin</a>,
00933                             a-&gt;<a class="code" href="../../d8/d4/struct__CONSOLE__SCROLLSCREENBUFFER__MSG.html#o6">Fill</a>
00934                            );
00935     }
00936     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00937     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00938     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
00939 }
00940 
00941 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00942"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a19">00942</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a19">UpdatePopups</a>(
00943     IN <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console,
00944     IN WORD NewAttributes,
00945     IN WORD NewPopupAttributes,
00946     IN WORD OldAttributes,
00947     IN WORD OldPopupAttributes
00948     )
00949 
00950 <span class="comment">/*</span>
00951 <span class="comment"></span>
00952 <span class="comment">    this routine is called when the user changes the screen/popup</span>
00953 <span class="comment">    colors.  it goes through the popup structures and changes</span>
00954 <span class="comment">    the saved contents to reflect the new screen/popup colors.</span>
00955 <span class="comment"></span>
00956 <span class="comment">*/</span>
00957 
00958 {
00959     PLIST_ENTRY HistoryListHead, HistoryListNext;
00960     PLIST_ENTRY PopupListHead, PopupListNext;
00961     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
00962     <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup;
00963     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
00964     PCHAR_INFO OldContents;
00965     WORD InvertedOldPopupAttributes,InvertedNewPopupAttributes;
00966 
00967     InvertedOldPopupAttributes = (WORD)(((OldPopupAttributes &lt;&lt; 4) &amp; 0xf0) |
00968                                 ((OldPopupAttributes &gt;&gt; 4) &amp; 0x0f));
00969     InvertedNewPopupAttributes = (WORD)(((NewPopupAttributes &lt;&lt; 4) &amp; 0xf0) |
00970                                 ((NewPopupAttributes &gt;&gt; 4) &amp; 0x0f));
00971     HistoryListHead = &amp;Console-&gt;CommandHistoryList;
00972     HistoryListNext = HistoryListHead-&gt;Blink;
00973     <span class="keywordflow">while</span> (HistoryListNext != HistoryListHead) {
00974         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = CONTAINING_RECORD( HistoryListNext, <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>, ListLink );
00975         HistoryListNext = HistoryListNext-&gt;Blink;
00976         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a> &amp;&amp; !<a class="code" href="../../d4/d1/cmdline_8h.html#a14">CLE_NO_POPUPS</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>)) {
00977             PopupListHead = &amp;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;PopupList;
00978             PopupListNext = PopupListHead-&gt;Blink;
00979             <span class="keywordflow">while</span> (PopupListNext != PopupListHead) {
00980                 Popup = CONTAINING_RECORD( PopupListNext, <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">CLE_POPUP</a>, ListLink );
00981                 PopupListNext = PopupListNext-&gt;Blink;
00982                 OldContents = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a>;
00983                 <span class="keywordflow">for</span> (i=Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Left;i&lt;=Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Right;i++) {
00984                     <span class="keywordflow">for</span> (j=Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Top;j&lt;=Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Bottom;j++) {
00985                         <span class="keywordflow">if</span> (OldContents-&gt;Attributes == OldAttributes) {
00986                             OldContents-&gt;Attributes = NewAttributes;
00987                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (OldContents-&gt;Attributes == OldPopupAttributes) {
00988                             OldContents-&gt;Attributes = NewPopupAttributes;
00989                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (OldContents-&gt;Attributes == InvertedOldPopupAttributes) {
00990                             OldContents-&gt;Attributes = InvertedNewPopupAttributes;
00991                         }
00992                         OldContents++;
00993                     }
00994                 }
00995             }
00996         }
00997     }
00998 }
00999 
01000 
01001 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l01002"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a20">01002</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a20">SetScreenColors</a>(
01003     IN <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo,
01004     IN WORD Attributes,
01005     IN WORD PopupAttributes,
01006     IN BOOL UpdateWholeScreen
01007     )
01008 {
01009     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,j;
01010     <a class="code" href="../../d9/d4/struct__ROW.html">PROW</a> Row;
01011     WORD DefaultAttributes,DefaultPopupAttributes;
01012     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01013     COLORREF rgbBk;
01014     COLORREF rgbText;
01015 
01016     Console = ScreenInfo-&gt;Console;
01017     rgbBk = <a class="code" href="../../d8/d5/consrv_8h.html#a43">ConvertAttrToRGB</a>(Console, <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(Attributes &gt;&gt; 4));
01018     rgbBk = GetNearestColor(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, rgbBk);
01019     rgbText = <a class="code" href="../../d8/d5/consrv_8h.html#a43">ConvertAttrToRGB</a>(Console, <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(Attributes));
01020     rgbText = GetNearestColor(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, rgbText);
01021     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d2/output_8h.html#a12">ACTIVE_SCREEN_BUFFER</a>(ScreenInfo)) {
01022         SetDCBrushColor(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, rgbBk);
01023         SetTextColor(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, rgbText);
01024         SetBkColor(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, rgbBk);
01025         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o33">LastAttributes</a> = Attributes;
01026         <a class="code" href="../../d8/d5/consrv_8h.html#a22">SetConsoleBkColor</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, rgbBk);
01027     }
01028 
01029     DefaultAttributes = ScreenInfo-&gt;Attributes;
01030     DefaultPopupAttributes = ScreenInfo-&gt;PopupAttributes;
01031     ScreenInfo-&gt;Attributes = Attributes;
01032     ScreenInfo-&gt;PopupAttributes = PopupAttributes;
01033 <span class="preprocessor">#if defined(FE_IME)</span>
01034 <span class="preprocessor"></span>    SetUndetermineAttribute( Console );
01035 <span class="preprocessor">#endif</span>
01036 <span class="preprocessor"></span>
01037     <span class="keywordflow">if</span> (UpdateWholeScreen &amp;&amp; ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a0">CONSOLE_TEXTMODE_BUFFER</a>) {
01038         WORD InvertedOldPopupAttributes,InvertedNewPopupAttributes;
01039 
01040         InvertedOldPopupAttributes = (WORD)(((DefaultPopupAttributes &lt;&lt; 4) &amp; 0xf0) |
01041                                     ((DefaultPopupAttributes &gt;&gt; 4) &amp; 0x0f));
01042         InvertedNewPopupAttributes = (WORD)(((PopupAttributes &lt;&lt; 4) &amp; 0xf0) |
01043                                     ((PopupAttributes &gt;&gt; 4) &amp; 0x0f));
01044         <span class="comment">//</span>
01045         <span class="comment">// change all chars with default color</span>
01046         <span class="comment">//</span>
01047 
01048         <span class="keywordflow">for</span> (i=0;i&lt;ScreenInfo-&gt;ScreenBufferSize.Y;i++) {
01049             Row = &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[i];
01050             <span class="keywordflow">for</span> (j=0;j&lt;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o0">Length</a>;j++) {
01051                 <span class="keywordflow">if</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> == DefaultAttributes) {
01052                     Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> = Attributes;
01053                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> == DefaultPopupAttributes) {
01054                     Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> = PopupAttributes;
01055                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> == InvertedOldPopupAttributes) {
01056                     Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o1">AttrRow</a>.<a class="code" href="../../d4/d2/struct__ATTR__ROW.html#o2">Attrs</a>[j].<a class="code" href="../../d3/d2/struct__ATTR__PAIR.html#o1">Attr</a> = InvertedNewPopupAttributes;
01057                 }
01058             }
01059         }
01060 
01061         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o48">PopupCount</a>)
01062             <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a19">UpdatePopups</a>(Console,
01063                          Attributes,
01064                          PopupAttributes,
01065                          DefaultAttributes,
01066                          DefaultPopupAttributes
01067                          );
01068         <span class="comment">// force repaint of entire line</span>
01069         ScreenInfo-&gt;BufferInfo.TextInfo.Flags &amp;= ~<a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
01070         <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,&amp;ScreenInfo-&gt;Window);
01071         ScreenInfo-&gt;BufferInfo.TextInfo.Flags |= <a class="code" href="../../d7/d2/output_8h.html#a3">TEXT_VALID_HINT</a>;
01072     }
01073 
01074     <span class="keywordflow">return</span> STATUS_SUCCESS;
01075 }
01076 
01077 ULONG
<a name="l01078"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a21">01078</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a21">SrvSetConsoleTextAttribute</a>(
01079     IN OUT PCSR_API_MSG m,
01080     IN OUT PCSR_REPLY_STATUS ReplyStatus
01081     )
01082 {
01083     <a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html">PCONSOLE_SETTEXTATTRIBUTE_MSG</a> a = (<a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html">PCONSOLE_SETTEXTATTRIBUTE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01084     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01085     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01086     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01087 
01088     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html#o0">ConsoleHandle</a>,
01089                          &amp;Console
01090                         );
01091     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01092         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01093     }
01094     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01095                                  a-&gt;<a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html#o1">OutputHandle</a>,
01096                                  <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
01097                                  GENERIC_WRITE,
01098                                  &amp;HandleData
01099                                 );
01100     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01101 
01102         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html#o2">Attributes</a> &amp; ~<a class="code" href="../../d7/d2/output_8h.html#a6">VALID_TEXT_ATTRIBUTES</a>) {
01103             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01104         } <span class="keywordflow">else</span> {
01105             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a20">SetScreenColors</a>(HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer,
01106                                      a-&gt;<a class="code" href="../../d5/d6/struct__CONSOLE__SETTEXTATTRIBUTE__MSG.html#o2">Attributes</a>,
01107                                      HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer-&gt;PopupAttributes,
01108                                      <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
01109                                     );
01110         }
01111     }
01112     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01113     <span class="keywordflow">return</span>((ULONG) <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01114     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01115 }
01116 
01117 ULONG
<a name="l01118"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a22">01118</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a22">SrvSetConsoleFont</a>(
01119     IN OUT PCSR_API_MSG m,
01120     IN OUT PCSR_REPLY_STATUS ReplyStatus
01121     )
01122 {
01123     <a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html">PCONSOLE_SETFONT_MSG</a> a = (<a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html">PCONSOLE_SETFONT_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01124     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01125     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01126     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
01127     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
01128 
01129     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html#o0">ConsoleHandle</a>,
01130                          &amp;Console
01131                         );
01132     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01133         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01134     }
01135     <span class="keywordflow">try</span> {
01136         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a31">DereferenceIoHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a84">CONSOLE_PERPROCESSDATA</a>(),
01137                                      a-&gt;<a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html#o1">OutputHandle</a>,
01138                                      <a class="code" href="../../d5/d5/conmsg_8h.html#a1">CONSOLE_OUTPUT_HANDLE</a>,
01139                                      GENERIC_WRITE,
01140                                      &amp;HandleData
01141                                     );
01142         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01143             leave;
01144         }
01145 
01146         ScreenInfo = HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o5">Buffer</a>.ScreenBuffer;
01147         <span class="keywordflow">if</span> (ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN) {
01148             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_FULLSCREEN_MODE;
01149         } <span class="keywordflow">else</span> {
01150 <span class="preprocessor">#if defined(FE_SB)</span>
01151 <span class="preprocessor"></span>            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a33">SetScreenBufferFont</a>(ScreenInfo,a-&gt;<a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html#o2">FontIndex</a>,ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o0">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>);
01152 <span class="preprocessor">#else</span>
01153 <span class="preprocessor"></span>            <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a33">SetScreenBufferFont</a>(ScreenInfo,a-&gt;<a class="code" href="../../d6/d5/struct__CONSOLE__SETFONT__MSG.html#o2">FontIndex</a>);
01154 <span class="preprocessor">#endif</span>
01155 <span class="preprocessor"></span>        }
01156     } finally {
01157         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01158     }
01159     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01160     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01161 }
01162 
01163 ULONG
<a name="l01164"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a23">01164</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a23">SrvSetConsoleIcon</a>(
01165     IN OUT PCSR_API_MSG m,
01166     IN OUT PCSR_REPLY_STATUS ReplyStatus
01167     )
01168 {
01169     <a class="code" href="../../d9/d5/struct__CONSOLE__SETICON__MSG.html">PCONSOLE_SETICON_MSG</a> a = (<a class="code" href="../../d9/d5/struct__CONSOLE__SETICON__MSG.html">PCONSOLE_SETICON_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01170     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01171     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01172     HANDLE hIcon;
01173 
01174     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d5/struct__CONSOLE__SETICON__MSG.html#o0">ConsoleHandle</a>,
01175                          &amp;Console
01176                         );
01177     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01178         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01179     }
01180 
01181     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d5/struct__CONSOLE__SETICON__MSG.html#o1">hIcon</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01182         hIcon = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a5">ghDefaultIcon</a>;
01183     } <span class="keywordflow">else</span> {
01184         hIcon = <a class="code" href="../../d3/d8/client_8c.html#a36">CopyIcon</a>(a-&gt;<a class="code" href="../../d9/d5/struct__CONSOLE__SETICON__MSG.html#o1">hIcon</a>);
01185     }
01186 
01187     <span class="keywordflow">if</span> (hIcon == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01188         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01189     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hIcon != Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a>) {
01190         <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, WM_SETICON, ICON_BIG, (LPARAM)hIcon);
01191         <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a> != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a5">ghDefaultIcon</a>) {
01192             <a class="code" href="../../d3/d0/user32_8def.html#a64">DestroyIcon</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a>);
01193         }
01194         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o30">hIcon</a> = hIcon;
01195 
01196         <span class="comment">/*</span>
01197 <span class="comment">         * Small icon now</span>
01198 <span class="comment">         */</span>
01199         <span class="keywordflow">if</span> (hIcon != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a5">ghDefaultIcon</a>) {
01200             <span class="comment">/*</span>
01201 <span class="comment">             * The new one is not the default, clean-up</span>
01202 <span class="comment">             */</span>
01203             <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a6">ghDefaultSmIcon</a>) {
01204                 <a class="code" href="../../d3/d0/user32_8def.html#a64">DestroyIcon</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a>);
01205             }
01206             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01207             <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, WM_SETICON, ICON_SMALL, (LPARAM)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01208         } <span class="keywordflow">else</span> {
01209             <span class="comment">/*</span>
01210 <span class="comment">             * Change to default, so we can use the default small icon</span>
01211 <span class="comment">             */</span>
01212             <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> != <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a6">ghDefaultSmIcon</a>) {
01213                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01214                     <a class="code" href="../../d3/d0/user32_8def.html#a64">DestroyIcon</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a>);
01215                 }
01216                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o31">hSmIcon</a> = <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a6">ghDefaultSmIcon</a>;
01217                 <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, WM_SETICON, ICON_SMALL, (LPARAM)<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a6">ghDefaultSmIcon</a>);
01218             }
01219         }
01220     }
01221     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01222 
01223     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01224     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01225 }
01226 
01227 
01228 ULONG
<a name="l01229"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a24">01229</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a24">SrvSetConsoleCP</a>(
01230     IN OUT PCSR_API_MSG m,
01231     IN OUT PCSR_REPLY_STATUS ReplyStatus
01232     )
01233 {
01234     <a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html">PCONSOLE_SETCP_MSG</a> a = (<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html">PCONSOLE_SETCP_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01235     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01236     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01237     HANDLE hEvent = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01238 
01239     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o0">ConsoleHandle</a>,
01240                          &amp;Console
01241                         );
01242     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01243         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01244     }
01245     <span class="keywordflow">if</span> (a-&gt;hEvent) {
01246         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d0/obhandle_8c.html#a4">NtDuplicateObject</a>(<a class="code" href="../../d1/d7/server_8h.html#a79">CONSOLE_CLIENTPROCESSHANDLE</a>(),
01247                        a-&gt;hEvent,
01248                        NtCurrentProcess(),
01249                        &amp;hEvent,
01250                        0,
01251                        <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
01252                        DUPLICATE_SAME_ACCESS
01253                        );
01254         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01255             <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01256         }
01257     }
01258 
01259     <span class="keywordflow">if</span> (!IsValidCodePage(a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a>)) {
01260         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01261         <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01262     }
01263     <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>( a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a> ) &amp;&amp;
01264          <a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a2">OEMCP</a> != a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a> )
01265     {
01266         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
01267         <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01268     }
01269 
01270     <span class="keywordflow">if</span> ( (a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a> &amp;&amp; Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a> != a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a>) ||
01271          (!a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a> &amp;&amp; Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a> != a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a>)         ) {
01272 
01273         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> CodePage;
01274 
01275         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a>) {
01276 
01277             <span class="comment">// Backup old code page</span>
01278             CodePage = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>;
01279 
01280             <span class="comment">// Set new code page</span>
01281             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a> = a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a>;
01282 
01283             Console-&gt;fIsDBCSOutputCP = <a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>);
01284 
01285             <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d2/output_8c.html#a89">ReCreateDbcsScreenBuffer</a>(Console, CodePage) ) {
01286                 RIPMSG1(RIP_WARNING, <span class="stringliteral">"SrvSetConsoleCP: ReCreateDbcsScreenBuffer failed. Restoring to CP=%d"</span>,
01287                         CodePage);
01288                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a> = CodePage;
01289                 Console-&gt;fIsDBCSOutputCP = <a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(CodePage);
01290                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
01291                 <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01292             }
01293             SetConsoleCPInfo(Console,a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a>);
01294             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a76">QueueConsoleMessage</a>(Console,
01295                         CM_SET_IME_CODEPAGE,
01296                         (WPARAM)hEvent,
01297                         MAKELPARAM(a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a>,CodePage)
01298                        );
01299             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01300                 <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01301             }
01302 
01303             <span class="comment">// load special ROM font, if necessary</span>
01304 
01305 <span class="preprocessor">#ifdef i386</span>
01306 <span class="preprocessor"></span>
01307             <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o47">FullScreenFlags</a> &amp; CONSOLE_FULLSCREEN_HARDWARE) {
01308                 SetROMFontCodePage(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>,
01309                                    Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.ModeIndex);
01310                 WriteRegionToScreenHW(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>,
01311                         &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>);
01312             }
01313 <span class="preprocessor">#endif</span>
01314 <span class="preprocessor"></span>
01315 
01316         } <span class="keywordflow">else</span> {
01317 
01318             <span class="comment">// Backup old code page</span>
01319             CodePage = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>;
01320 
01321             <span class="comment">// Set new code page</span>
01322             Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a> = a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o1">wCodePageID</a>;
01323 
01324             Console-&gt;fIsDBCSCP = <a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp; <a class="code" href="../../d0/d3/dbcs_8h.html#a46">IsAvailableFarEastCodePage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>);
01325 
01326             SetConsoleCPInfo(Console,a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a>);
01327             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/output_8c.html#a76">QueueConsoleMessage</a>(Console,
01328                         CM_SET_IME_CODEPAGE,
01329                         (WPARAM)hEvent,
01330                         MAKELPARAM(a-&gt;<a class="code" href="../../d1/d5/struct__CONSOLE__SETCP__MSG.html#o2">Output</a>,CodePage)
01331                        );
01332             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01333                 <span class="keywordflow">goto</span> SrvSetConsoleCPFailure;
01334             }
01335         }
01336     }
01337     <span class="keywordflow">else</span> {
01338         <span class="keywordflow">if</span> (hEvent) {
01339             <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(hEvent, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01340             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hEvent);
01341         }
01342     }
01343 
01344     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01345     <span class="keywordflow">return</span> STATUS_SUCCESS;
01346 
01347 SrvSetConsoleCPFailure:
01348     <span class="keywordflow">if</span> (hEvent) {
01349         <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(hEvent, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01350         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hEvent);
01351     }
01352     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01353     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01354 
01355     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01356 }
01357 
01358 ULONG
<a name="l01359"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a25">01359</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a25">SrvGetConsoleCP</a>(
01360     IN OUT PCSR_API_MSG m,
01361     IN OUT PCSR_REPLY_STATUS ReplyStatus
01362     )
01363 {
01364     <a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html">PCONSOLE_GETCP_MSG</a> a = (<a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html">PCONSOLE_GETCP_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01365     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01366     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01367 
01368     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html#o0">ConsoleHandle</a>,
01369                          &amp;Console
01370                         );
01371     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01372         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01373     }
01374     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html#o2">Output</a>) {
01375         a-&gt;<a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html#o1">wCodePageID</a> = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o62">OutputCP</a>;
01376     } <span class="keywordflow">else</span> {
01377         a-&gt;<a class="code" href="../../d4/d1/struct__CONSOLE__GETCP__MSG.html#o1">wCodePageID</a> = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>;
01378     }
01379     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01380     <span class="keywordflow">return</span> STATUS_SUCCESS;
01381     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01382 }
01383 
01384 ULONG
<a name="l01385"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a26">01385</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a26">SrvGetConsoleKeyboardLayoutName</a>(
01386     IN OUT PCSR_API_MSG m,
01387     IN OUT PCSR_REPLY_STATUS ReplyStatus
01388     )
01389 {
01390     <a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html">PCONSOLE_GETKEYBOARDLAYOUTNAME_MSG</a> a = (<a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html">PCONSOLE_GETKEYBOARDLAYOUTNAME_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01391     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01392     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01393 
01394     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html#o0">ConsoleHandle</a>,
01395                          &amp;Console
01396                         );
01397     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01398         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01399     }
01400     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01401         <span class="comment">//</span>
01402         <span class="comment">// hklActive is not set yet. Let's initialize it here.</span>
01403         <span class="comment">//</span>
01404         <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="../../d6/d2/output_8c.html#a31">GetNonBiDiKeyboardLayout</a>(HKL * phklActive);
01405 
01406         RIPMSG1(RIP_WARNING, <span class="stringliteral">"SrvGetConsoleKeyboardLayoutName: hklActive is not initialized. pCon=%p"</span>, Console);
01407 
01408         <a class="code" href="../../d5/d9/cltxt_8h.html#a26">SystemParametersInfo</a>(SPI_GETDEFAULTINPUTLANG, 0, &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01409         <a class="code" href="../../d6/d2/output_8c.html#a31">GetNonBiDiKeyboardLayout</a>(&amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>);
01410     }
01411     <a class="code" href="../../d3/d0/user32_8def.html#a45">ActivateKeyboardLayout</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o9">hklActive</a>, 0);
01412     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html#o3">bAnsi</a>) {
01413         GetKeyboardLayoutNameA(a-&gt;<a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html#o2">achLayout</a>);
01414     } <span class="keywordflow">else</span> {
01415         GetKeyboardLayoutNameW(a-&gt;<a class="code" href="../../d2/d2/struct__CONSOLE__GETKEYBOARDLAYOUTNAME__MSG.html#o1">awchLayout</a>);
01416     }
01417     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01418     <span class="keywordflow">return</span> STATUS_SUCCESS;
01419     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01420 }
01421 
01422 
01423 ULONG
<a name="l01424"></a><a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a27">01424</a> <a class="code" href="../../d9/d4/ntcon_2server_2getset_8c.html#a27">SrvGetConsoleWindow</a>(
01425     IN OUT PCSR_API_MSG m,
01426     IN OUT PCSR_REPLY_STATUS ReplyStatus
01427     )
01428 {
01429     <a class="code" href="../../d3/d1/struct__CONSOLE__GETCONSOLEWINDOW__MSG.html">PCONSOLE_GETCONSOLEWINDOW_MSG</a> a = (<a class="code" href="../../d3/d1/struct__CONSOLE__GETCONSOLEWINDOW__MSG.html">PCONSOLE_GETCONSOLEWINDOW_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01430     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01431     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01432 
01433     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d3/d1/struct__CONSOLE__GETCONSOLEWINDOW__MSG.html#o0">ConsoleHandle</a>,
01434                          &amp;Console
01435                         );
01436     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01437         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01438     }
01439 
01440     a-&gt;<a class="code" href="../../d3/d1/struct__CONSOLE__GETCONSOLEWINDOW__MSG.html#o1">hwnd</a> = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>;
01441 
01442     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01443     <span class="keywordflow">return</span> STATUS_SUCCESS;
01444     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
01445 }
01446 
01447 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:13 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
