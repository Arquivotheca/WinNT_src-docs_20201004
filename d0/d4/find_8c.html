<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: find.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>find.c File Reference</h1><code>#include "<a class="el" href="../../d7/d2/w32_2ntcon_2server_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d1/d3/find_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/find_8c.html#a0">SEARCH_STRING_LENGTH</a>&nbsp;&nbsp;&nbsp;(80)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/find_8c.html#a1">SearchForString</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN PWSTR SearchString, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> StringLength, IN BOOLEAN IgnoreCase, IN BOOLEAN Reverse, OUT PCOORD StringPosition)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>INT_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/find_8c.html#a2">FindDialogProc</a> (HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, UINT Message, WPARAM wParam, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/find_8c.html#a3">DoFind</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="find.c::SEARCH_STRING_LENGTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEARCH_STRING_LENGTH&nbsp;&nbsp;&nbsp;(80)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/find_8c-source.html#l00025">25</a> of file <a class="el" href="../../d1/d3/find_8c-source.html">find.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/find_8c-source.html#l00171">FindDialogProc()</a>, and <a class="el" href="../../d1/d3/find_8c-source.html#l00028">SearchForString()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3" doxytag="find.c::DoFind" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DoFind           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/find_8c-source.html#l00268">268</a> of file <a class="el" href="../../d1/d3/find_8c-source.html">find.c</a>.
<p>
References <a class="el" href="../../d1/d3/find_8c-source.html#l00171">FindDialogProc()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00027">ghInstance</a>, and <a class="el" href="../../d7/d6/menu_8h-source.html#l00055">ID_FINDDLG</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04700">ConsoleWindowProc()</a>.
<p>
<pre class="fragment"><div>00271 {
00272     DialogBoxParam(ghInstance,
00273                    MAKEINTRESOURCE(ID_FINDDLG),
00274                    Console-&gt;hWnd,
00275                    FindDialogProc,
00276                    (LPARAM)Console);
00277 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="find.c::FindDialogProc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT_PTR FindDialogProc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>Message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/find_8c-source.html#l00171">171</a> of file <a class="el" href="../../d1/d3/find_8c-source.html">find.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d5/d8/nt6_2dlgmgr_8c-source.html#l00402">CheckRadioButton()</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00437">ClearSelection()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00124">CONSOLE_MOUSE_SELECTION</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00123">CONSOLE_SELECTION_NOT_EMPTY</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00133">_CONSOLE_INFORMATION::CurrentScreenBuffer</a>, <a class="el" href="../../d3/d8/dlgend_8c-source.html#l00024">EndDialog()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00740">GetDlgItemText()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00388">GetWindowLongPtr()</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00057">ID_FINDCASE</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00059">ID_FINDDOWN</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00056">ID_FINDSTR</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00058">ID_FINDUP</a>, <a class="el" href="../../d5/d8/nt6_2dlgmgr_8c-source.html#l00435">IsDlgButtonChecked()</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00031">msgSelectMode</a>, <a class="el" href="../../d8/d7/ntcon_2server_2clipbrd_8c-source.html#l00070">MyInvert()</a>, <a class="el" href="../../d1/d3/find_8c-source.html#l00025">SEARCH_STRING_LENGTH</a>, <a class="el" href="../../d1/d3/find_8c-source.html#l00028">SearchForString()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00175">_CONSOLE_INFORMATION::SelectionAnchor</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00173">_CONSOLE_INFORMATION::SelectionFlags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00174">_CONSOLE_INFORMATION::SelectionRect</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00717">SendDlgItemMessage()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00408">SetWindowLongPtr()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l03626">SetWindowOrigin()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00236">SetWinText()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00449">StringLength()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d8/d1/output_8h-source.html#l00159">_SCREEN_INFORMATION::Window</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/find_8c-source.html#l00268">DoFind()</a>.
<p>
<pre class="fragment"><div>00177 {
00178     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00179     <a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo;
00180     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a>;
00181     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ColumnWidth;
00182     WCHAR szBuf[<a class="code" href="../../d0/d4/find_8c.html#a0">SEARCH_STRING_LENGTH</a> + 1];
00183     COORD Position;
00184     BOOLEAN IgnoreCase;
00185     BOOLEAN Reverse;
00186 
00187     <span class="keywordflow">switch</span> (Message) {
00188     <span class="keywordflow">case</span> WM_INITDIALOG:
00189         <a class="code" href="../../d5/d9/cltxt_8h.html#a12">SetWindowLongPtr</a>(hWnd, DWLP_USER, lParam);
00190         <a class="code" href="../../d5/d9/cltxt_8h.html#a18">SendDlgItemMessage</a>(hWnd, ID_FINDSTR, EM_LIMITTEXT, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szBuf)-1, 0);
00191         <a class="code" href="../../d4/d9/nt6_2dlgmgr_8c.html#a17">CheckRadioButton</a>(hWnd, ID_FINDUP, ID_FINDDOWN, ID_FINDDOWN);
00192         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00193     <span class="keywordflow">case</span> WM_COMMAND:
00194         <span class="keywordflow">switch</span> (LOWORD(wParam)) {
00195         <span class="keywordflow">case</span> IDOK:
00196             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a19">GetDlgItemText</a>(hWnd, ID_FINDSTR, szBuf, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szBuf));
00197             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a> == 0) {
00198                 <span class="keywordflow">break</span>;
00199             }
00200             IgnoreCase = <a class="code" href="../../d4/d9/nt6_2dlgmgr_8c.html#a18">IsDlgButtonChecked</a>(hWnd, ID_FINDCASE) == 0;
00201             Reverse = <a class="code" href="../../d4/d9/nt6_2dlgmgr_8c.html#a18">IsDlgButtonChecked</a>(hWnd, ID_FINDDOWN) == 0;
00202             Console = (<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hWnd, DWLP_USER);
00203             ScreenInfo = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o4">CurrentScreenBuffer</a>;
00204             <span class="keywordflow">if</span> ((ColumnWidth = <a class="code" href="../../d0/d4/find_8c.html#a1">SearchForString</a>(ScreenInfo, szBuf, StringLength, IgnoreCase, Reverse, &amp;Position)) != 0) {
00205 
00206                 <span class="comment">//</span>
00207                 <span class="comment">// Clear any old selections</span>
00208                 <span class="comment">//</span>
00209 
00210                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>) {
00211                     <a class="code" href="../../d8/d5/consrv_8h.html#a306">ClearSelection</a>(Console);
00212                 }
00213 
00214                 <span class="comment">//</span>
00215                 <span class="comment">// Make the new selection</span>
00216                 <span class="comment">//</span>
00217 
00218                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>;
00219                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o37">SelectionFlags</a> = <a class="code" href="../../d1/d7/server_8h.html#a28">CONSOLE_MOUSE_SELECTION</a> | <a class="code" href="../../d1/d7/server_8h.html#a27">CONSOLE_SELECTION_NOT_EMPTY</a>;
00220                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o39">SelectionAnchor</a> = Position;
00221                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Left = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o39">SelectionAnchor</a>.X;
00222                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Right = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Left + ColumnWidth - 1;
00223                 Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Top = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Bottom = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o39">SelectionAnchor</a>.Y;
00224                 <a class="code" href="../../d8/d5/consrv_8h.html#a309">MyInvert</a>(Console,&amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>);
00225                 <a class="code" href="../../d1/d7/ntcon_2server_2menu_8c.html#a3">SetWinText</a>(Console,msgSelectMode,TRUE);
00226 
00227                 <span class="comment">//</span>
00228                 <span class="comment">// Make sure the hilited text will be visible</span>
00229                 <span class="comment">//</span>
00230 
00231                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Left &lt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left) {
00232                     Position.X = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Left;
00233                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Right &gt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Right) {
00234                     Position.X = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Right - <a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo) + 1;
00235                 } <span class="keywordflow">else</span> {
00236                     Position.X = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Left;
00237                 }
00238                 <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Top &lt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top) {
00239                     Position.Y = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Top;
00240                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Bottom &gt; ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Bottom) {
00241                     Position.Y = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o38">SelectionRect</a>.Bottom - <a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo) + 1;
00242                 } <span class="keywordflow">else</span> {
00243                     Position.Y = ScreenInfo-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o6">Window</a>.Top;
00244                 }
00245                 <a class="code" href="../../d6/d2/output_8c.html#a66">SetWindowOrigin</a>(ScreenInfo, TRUE, Position);
00246                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00247             } <span class="keywordflow">else</span> {
00248 
00249                 <span class="comment">//</span>
00250                 <span class="comment">// The string wasn't found</span>
00251                 <span class="comment">//</span>
00252 
00253                 Beep(800, 200);
00254             }
00255             <span class="keywordflow">break</span>;
00256         <span class="keywordflow">case</span> IDCANCEL:
00257             <a class="code" href="../../d2/d9/dlgend_8c.html#a0">EndDialog</a>(hWnd, 0);
00258             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00259         }
00260         <span class="keywordflow">break</span>;
00261     <span class="keywordflow">default</span>:
00262         <span class="keywordflow">break</span>;
00263     }
00264     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00265 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="find.c::SearchForString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> SearchForString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>SearchString</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>StringLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>IgnoreCase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Reverse</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCOORD&nbsp;</td>
          <td class="mdname" nowrap> <em>StringPosition</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/find_8c-source.html#l00028">28</a> of file <a class="el" href="../../d1/d3/find_8c-source.html">find.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00067">_ROW::CharRow</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00038">_CHAR_ROW::Chars</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00089">CONSOLE_SELECTING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00164">_CONSOLE_INFORMATION::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00139">_CONSOLE_INFORMATION::hDC</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00369">MyStringCompareW()</a>, <a class="el" href="../../d1/d3/find_8c-source.html#l00025">SEARCH_STRING_LENGTH</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00175">_CONSOLE_INFORMATION::SelectionAnchor</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00449">StringLength()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/find_8c-source.html#l00171">FindDialogProc()</a>.
<p>
<pre class="fragment"><div>00036 {
00037     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00038     COORD MaxPosition;
00039     COORD EndPosition;
00040     COORD Position;
00041     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> RecomputeRow;
00042     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> RowIndex;
00043     <a class="code" href="../../d9/d4/struct__ROW.html">PROW</a> Row;
00044     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ColumnWidth;
00045     WCHAR SearchString2[<a class="code" href="../../d0/d4/find_8c.html#a0">SEARCH_STRING_LENGTH</a> * 2 + 1];    <span class="comment">// search string buffer</span>
00046     PWSTR pStr;
00047 
00048     Console = ScreenInfo-&gt;Console;
00049 
00050     MaxPosition.X = ScreenInfo-&gt;ScreenBufferSize.X - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a>;
00051     MaxPosition.Y = ScreenInfo-&gt;ScreenBufferSize.Y - 1;
00052 
00053     <span class="comment">//</span>
00054     <span class="comment">// calculate starting position</span>
00055     <span class="comment">//</span>
00056 
00057     <span class="keywordflow">if</span> (Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o35">Flags</a> &amp; <a class="code" href="../../d1/d7/server_8h.html#a4">CONSOLE_SELECTING</a>) {
00058         Position.X = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o39">SelectionAnchor</a>.X;
00059         Position.Y = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o39">SelectionAnchor</a>.Y;
00060     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Reverse) {
00061         Position.X = 0;
00062         Position.Y = 0;
00063     } <span class="keywordflow">else</span> {
00064         Position.X = MaxPosition.X;
00065         Position.Y = MaxPosition.Y;
00066     }
00067 
00068     <span class="comment">//</span>
00069     <span class="comment">// prepare search string</span>
00070     <span class="comment">//</span>
00071     <span class="comment">// Raid #113599 CMD:Find(Japanese strings) does not work correctly</span>
00072     <span class="comment">//</span>
00073 
00074     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(StringLength == wcslen(SearchString) &amp;&amp; StringLength &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(SearchString2));
00075 
00076     pStr = SearchString2;
00077     <span class="keywordflow">while</span> (*SearchString) {
00078         *pStr++ = *SearchString;
00079 <span class="preprocessor">#if defined(CON_TB_MARK)</span>
00080 <span class="preprocessor"></span>        <span class="comment">//</span>
00081         <span class="comment">// On the screen, one FarEast "FullWidth" character occupies two columns (double width),</span>
00082         <span class="comment">// so we have to share two screen buffer elements for one DBCS character.</span>
00083         <span class="comment">// For example, if the screen shows "AB[DBC]CD", the screen buffer will be,</span>
00084         <span class="comment">//   [L'A'] [L'B'] [DBC(Unicode)] [CON_TB_MARK] [L'C'] [L'D']</span>
00085         <span class="comment">//   (DBC:: Double Byte Character)</span>
00086         <span class="comment">// CON_TB_MARK is used to indicate that the column is the trainling byte.</span>
00087         <span class="comment">//</span>
00088         <span class="comment">// Before comparing the string with the screen buffer, we need to modify the search</span>
00089         <span class="comment">// string to match the format of the screen buffer.</span>
00090         <span class="comment">// If we find a FullWidth character in the search string, put CON_TB_MARK</span>
00091         <span class="comment">// right after it so that we're able to use NLS functions.</span>
00092         <span class="comment">//</span>
00093 <span class="preprocessor">#else</span>
00094 <span class="preprocessor"></span>        <span class="comment">//</span>
00095         <span class="comment">// If KAttribute is used, the above example will look like:</span>
00096         <span class="comment">// CharRow.Chars: [L'A'] [L'B'] [DBC(Unicode)] [DBC(Unicode)] [L'C'] [L'D']</span>
00097         <span class="comment">// CharRow.KAttrs:    0      0   LEADING_BYTE  TRAILING_BYTE       0      0</span>
00098         <span class="comment">//</span>
00099 <span class="preprocessor">#endif</span>
00100 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (IsConsoleFullWidth(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o10">hDC</a>, Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>, *SearchString)) {
00101 <span class="preprocessor">#if defined(CON_TB_MARK)</span>
00102 <span class="preprocessor"></span>            *pStr++ = CON_TB_MARK;
00103 <span class="preprocessor">#else</span>
00104 <span class="preprocessor"></span>            *pStr++ = *SearchString;
00105 <span class="preprocessor">#endif</span>
00106 <span class="preprocessor"></span>        }
00107         ++SearchString;
00108     }
00109 
00110     *pStr = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00111     ColumnWidth = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(pStr - SearchString2);
00112     SearchString = SearchString2;
00113 
00114     <span class="comment">//</span>
00115     <span class="comment">// set the string length in byte</span>
00116     <span class="comment">//</span>
00117 
00118     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1158">StringLength</a> = ColumnWidth * <span class="keyword">sizeof</span>(WCHAR);
00119 
00120     <span class="comment">//</span>
00121     <span class="comment">// search for the string</span>
00122     <span class="comment">//</span>
00123 
00124     RecomputeRow = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00125     EndPosition = Position;
00126     <span class="keywordflow">do</span> {
00127 <span class="preprocessor">#if !defined(CON_TB_MARK)</span>
00128 <span class="preprocessor"></span><span class="preprocessor">#if DBG</span>
00129 <span class="preprocessor"></span>        <span class="keywordtype">int</span> nLoop = 0;
00130 <span class="preprocessor">#endif</span>
00131 <span class="preprocessor"></span>recalc:
00132 <span class="preprocessor">#endif</span>
00133 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (Reverse) {
00134             <span class="keywordflow">if</span> (--Position.X &lt; 0) {
00135                 Position.X = MaxPosition.X;
00136                 <span class="keywordflow">if</span> (--Position.Y &lt; 0) {
00137                     Position.Y = MaxPosition.Y;
00138                 }
00139                 RecomputeRow = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00140             }
00141         } <span class="keywordflow">else</span> {
00142             <span class="keywordflow">if</span> (++Position.X &gt; MaxPosition.X) {
00143                 Position.X = 0;
00144                 <span class="keywordflow">if</span> (++Position.Y &gt; MaxPosition.Y) {
00145                     Position.Y = 0;
00146                 }
00147                 RecomputeRow = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00148             }
00149         }
00150         <span class="keywordflow">if</span> (RecomputeRow) {
00151             RowIndex = (ScreenInfo-&gt;BufferInfo.TextInfo.FirstRow + Position.Y) % ScreenInfo-&gt;ScreenBufferSize.Y;
00152             Row = &amp;ScreenInfo-&gt;BufferInfo.TextInfo.Rows[RowIndex];
00153             RecomputeRow = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00154         }
00155 <span class="preprocessor">#if !defined(CON_TB_MARK)</span>
00156 <span class="preprocessor"></span>        <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(nLoop++ &lt; 2);
00157         <span class="keywordflow">if</span> (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.KAttrs &amp;&amp; (Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.KAttrs[Position.X] &amp; ATTR_TRAILING_BYTE)) {
00158             <span class="keywordflow">goto</span> recalc;
00159         }
00160 <span class="preprocessor">#endif</span>
00161 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d5/consrv_8h.html#a262">MyStringCompareW</a>(SearchString, &amp;Row-&gt;<a class="code" href="../../d9/d4/struct__ROW.html#o0">CharRow</a>.<a class="code" href="../../d6/d9/struct__CHAR__ROW.html#o4">Chars</a>[Position.X], StringLength, IgnoreCase)) {
00162             *StringPosition = Position;
00163             <span class="keywordflow">return</span> ColumnWidth;
00164         }
00165     } <span class="keywordflow">while</span> (!(Position.X == EndPosition.X &amp;&amp; Position.Y == EndPosition.Y));
00166 
00167     <span class="keywordflow">return</span> 0;   <span class="comment">// the string was not found</span>
00168 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:40 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
