<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: palette.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>palette.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d1/d2/palette_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/palette_8c.html#a0">IsTopmostRealApp</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HPALETTE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/palette_8c.html#a1">_SelectPalette</a> (HDC hdc, HPALETTE hpal, BOOL fForceBackground)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/palette_8c.html#a2">xxxRealizePalette</a> (HDC hdc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/palette_8c.html#a3">xxxFlushPalette</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/palette_8c.html#a4">xxxBroadcastPaletteChanged</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, BOOL fForceDesktop)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1" doxytag="palette.c::_SelectPalette" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HPALETTE _SelectPalette           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HPALETTE&nbsp;</td>
          <td class="mdname" nowrap> <em>hpal</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fForceBackground</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/palette_8c-source.html#l00051">51</a> of file <a class="el" href="../../d1/d2/palette_8c-source.html">palette.c</a>.
<p>
References <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00107">_GetDesktopWindow()</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00826">_IsChild()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00817">GetTopLevelWindow()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00099">gpqForeground</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d1/d2/palette_8c-source.html#l00025">IsTopmostRealApp()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01071">PUSIF_PALETTEDISPLAY</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03111">tagQ::spwndActive</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01076">TEST_PUSIF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02837">TIF_PALETTEAWARE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02364">WEFTOOLWINDOW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02288">WFHASPALETTE</a>, and <a class="el" href="../../d9/d2/dc_8c-source.html#l01574">WindowFromCacheDC()</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/ntuser_2kernel_2clipbrd_8c-source.html#l01286">BMPtoDIB()</a>, <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l00463">ConvertToDDB()</a>, <a class="el" href="../../d9/d7/ntuser_2kernel_2clipbrd_8c-source.html#l01189">DIBtoBMP()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09788">NtUserSelectPalette()</a>, <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l00829">xxxDrawWallpaper()</a>, and <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l01615">xxxInternalPaintDesktop()</a>.
<p>
<pre class="fragment"><div>00055 {
00056     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndTop;
00057     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fBackgroundPalette = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00058     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00059     <span class="comment">/*</span>
00060 <span class="comment">     * If we are not forcing palette into background, find out where it does</span>
00061 <span class="comment">     * actually belong. Don't ever select the default palette in as a</span>
00062 <span class="comment">     * foreground palette because this confuses gdi. Many apps do a</span>
00063 <span class="comment">     * (oldPal = SelectPalette) (myPal); Draw; SelectObject(oldPal).</span>
00064 <span class="comment">     * and we don't want to allow this to go through.</span>
00065 <span class="comment">     */</span>
00066     <span class="keywordflow">if</span> (!fForceBackground     &amp;&amp;
00067         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a368">TEST_PUSIF</a>(PUSIF_PALETTEDISPLAY) &amp;&amp;
00068         (hpal != GreGetStockObject(DEFAULT_PALETTE))) {
00069 
00070         <span class="keywordflow">if</span> (pwnd = <a class="code" href="../../d4/d1/userk_8h.html#a1703">WindowFromCacheDC</a>(hdc)) {
00071 
00072             <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndActive;
00073 
00074             <span class="comment">/*</span>
00075 <span class="comment">             * don't "select" palette unless on a palette device</span>
00076 <span class="comment">             */</span>
00077             pwndTop = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a11">GetTopLevelWindow</a>(pwnd);
00078 
00079             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndTop, WFHASPALETTE)) {
00080 
00081                 <span class="keywordflow">if</span> (pwndTop != <a class="code" href="../../d3/d9/client_2wow_8c.html#a3">_GetDesktopWindow</a>())
00082                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwndTop)-&gt;TIF_flags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a805">TIF_PALETTEAWARE</a>;
00083 
00084                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwndTop, WFHASPALETTE);
00085             }
00086 
00087             <span class="comment">/*</span>
00088 <span class="comment">             * Hack-o-rama:</span>
00089 <span class="comment">             * Windows get foreground use of the palette if</span>
00090 <span class="comment">             *      * They are the foreground's active window</span>
00091 <span class="comment">             *      * The current process is the shell and they are the</span>
00092 <span class="comment">             * topmost valid non-toolwindow in the zorder.</span>
00093 <span class="comment">             *</span>
00094 <span class="comment">             * This makes our tray friendly on palettized displays.</span>
00095 <span class="comment">             * Currently, if you run a palette app and click on the tray,</span>
00096 <span class="comment">             * the palette app goes all weird.  Broderbund apps go</span>
00097 <span class="comment">             * completely black.  This is because they get forced to be</span>
00098 <span class="comment">             * background always, even though the shell isn't really</span>
00099 <span class="comment">             * palettized.</span>
00100 <span class="comment">             *</span>
00101 <span class="comment">             * Note: this palette architecture sucks.  Apps get forced to</span>
00102 <span class="comment">             * be background palette users even if the foreground thread</span>
00103 <span class="comment">             * couldn't care less about the palette.  Should go by zorder</span>
00104 <span class="comment">             * if so, but in a more clean way than this.</span>
00105 <span class="comment">             *</span>
00106 <span class="comment">             * We really only care about the tray &amp;&amp; the background.</span>
00107 <span class="comment">             * Cabinet dudes don't matter so much.</span>
00108 <span class="comment">             */</span>
00109             pwndActive = (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a> ? <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a> : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00110 
00111 <span class="preprocessor">#if 0</span>
00112 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (pwndActive                                            &amp;&amp;
00113                 (pwndTop != pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndShell) &amp;&amp;
00114                 ((pwndActive == pwnd) || <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a16">_IsChild</a>(pwndActive, pwnd) || <a class="code" href="../../d0/d3/palette_8c.html#a0">IsTopmostRealApp</a>(pwnd)) &amp;&amp;
00115                 !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTOOLWINDOW)) {
00116 
00117                 fBackgroundPalette = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00118             }
00119 <span class="preprocessor">#else</span>
00120 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ((pwndTop != pwndTop-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwnd)      &amp;&amp;
00121                 (pwndTop != pwndTop-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndShell) &amp;&amp;
00122                 (pwndActive != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)                                     &amp;&amp;
00123                 ((pwndActive == pwnd)          ||
00124                     <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a16">_IsChild</a>(pwndActive, pwnd) ||
00125                     <a class="code" href="../../d0/d3/palette_8c.html#a0">IsTopmostRealApp</a>(pwnd))                              &amp;&amp;
00126                 !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTOOLWINDOW)) {
00127 
00128                 fBackgroundPalette = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00129             }
00130 <span class="preprocessor">#endif</span>
00131 <span class="preprocessor"></span>        }
00132     }
00133 
00134     <span class="keywordflow">return</span> GreSelectPalette(hdc, hpal, fBackgroundPalette);
00135 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="palette.c::IsTopmostRealApp" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL IsTopmostRealApp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/palette_8c-source.html#l00025">25</a> of file <a class="el" href="../../d1/d2/palette_8c-source.html">palette.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00099">gpqForeground</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d4/d5/focusact_8c-source.html#l02431">NextTopWindow()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04454">NTW_IGNORETOOLWINDOW</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02159">tagDESKTOPINFO::spwndShell</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/palette_8c-source.html#l00051">_SelectPalette()</a>.
<p>
<pre class="fragment"><div>00027 {
00028     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>  ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00029     <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> pdeskinfo = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo;
00030     <span class="keywordflow">if</span> ((pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o5">spwndShell</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00031         (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o5">spwndShell</a>)-&gt;pq != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>)) {
00032 
00033         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00034     }
00035 
00036     <span class="keywordflow">return</span> (pwnd == <a class="code" href="../../d4/d1/userk_8h.html#a1231">NextTopWindow</a>(ptiCurrent,
00037                                   NULL,
00038                                   NULL,
00039                                   NTW_IGNORETOOLWINDOW));
00040 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="palette.c::xxxBroadcastPaletteChanged" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxBroadcastPaletteChanged           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fForceDesktop</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/palette_8c-source.html#l00243">243</a> of file <a class="el" href="../../d1/d2/palette_8c-source.html">palette.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03833">PWND_BROADCAST</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02790">PWNDDESKTOP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00863">xxxRealizeDesktop()</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l01069">xxxSendNotifyMessage()</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/palette_8c-source.html#l00220">xxxFlushPalette()</a>, and <a class="el" href="../../d1/d2/palette_8c-source.html#l00146">xxxRealizePalette()</a>.
<p>
<pre class="fragment"><div>00244 {
00245     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndDesk;
00246     HWND hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00247 
00248     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00249 
00250     pwndDesk = <a class="code" href="../../d4/d1/userk_8h.html#a322">PWNDDESKTOP</a>(pwnd);
00251     <span class="keywordflow">if</span> (fForceDesktop || pwnd != pwndDesk) {
00252         <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndDesk;
00253         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pwndDesk, &amp;tlpwndDesk);
00254         <a class="code" href="../../d4/d1/userk_8h.html#a1806">xxxRealizeDesktop</a>(pwndDesk);
00255         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndDesk);
00256     }
00257 
00258     <a class="code" href="../../d4/d1/userk_8h.html#a1581">xxxSendNotifyMessage</a>(PWND_BROADCAST, WM_PALETTECHANGED, (WPARAM)hwnd, 0L);
00259 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="palette.c::xxxFlushPalette" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxFlushPalette           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/palette_8c-source.html#l00220">220</a> of file <a class="el" href="../../d1/d2/palette_8c-source.html">palette.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00464">gpDispInfo</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02099">tagDISPLAYINFO::hdcScreen</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d1/d2/palette_8c-source.html#l00243">xxxBroadcastPaletteChanged()</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/queue_8c-source.html#l02552">xxxDestroyThreadInfo()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">xxxDestroyWindow()</a>, and <a class="el" href="../../d5/d8/minmax_8c-source.html#l01329">xxxMinMaximize()</a>.
<p>
<pre class="fragment"><div>00222 {
00223     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00224     <span class="comment">/*</span>
00225 <span class="comment">     * Broadcast the palette changed messages.</span>
00226 <span class="comment">     */</span>
00227     GreRealizeDefaultPalette(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a179">gpDispInfo</a>-&gt;<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html#o3">hdcScreen</a>, TRUE);
00228     <a class="code" href="../../d4/d1/userk_8h.html#a1106">xxxBroadcastPaletteChanged</a>(pwnd, TRUE);
00229 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="palette.c::xxxRealizePalette" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int xxxRealizePalette           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hdc</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/palette_8c-source.html#l00146">146</a> of file <a class="el" href="../../d1/d2/palette_8c-source.html">palette.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02140">DTF_NEEDSPALETTECHANGED</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02650">tagDESKTOP::dwDTFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d3/spb_8c-source.html#l01252">FreeAllSpbs()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00648">grpWinStaList</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02712">tagWINDOWSTATION::rpdeskList</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02647">tagDESKTOP::rpdeskNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02711">tagWINDOWSTATION::rpwinstaNext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l01574">WindowFromCacheDC()</a>, and <a class="el" href="../../d1/d2/palette_8c-source.html#l00243">xxxBroadcastPaletteChanged()</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/ntuser_2kernel_2clipbrd_8c-source.html#l01286">BMPtoDIB()</a>, <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l00463">ConvertToDDB()</a>, <a class="el" href="../../d9/d7/ntuser_2kernel_2clipbrd_8c-source.html#l01189">DIBtoBMP()</a>, <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l00829">xxxDrawWallpaper()</a>, and <a class="el" href="../../d2/d2/dtbitmap_8c-source.html#l01615">xxxInternalPaintDesktop()</a>.
<p>
<pre class="fragment"><div>00148 {
00149     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>           pwnd;
00150     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          dwNumChanged;
00151     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta;
00152     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>       pdesk;
00153     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>             tlpwnd;
00154 
00155     dwNumChanged = GreRealizePalette(hdc);
00156 
00157     <span class="keywordflow">if</span> (HIWORD(dwNumChanged) &amp;&amp; IsDCCurrentPalette(hdc)) {
00158 
00159         pwnd = <a class="code" href="../../d4/d1/userk_8h.html#a1703">WindowFromCacheDC</a>(hdc);
00160 
00161         <span class="comment">/*</span>
00162 <span class="comment">         * if there is no associated window, don't send the palette change</span>
00163 <span class="comment">         * messages since this is a memory hdc.</span>
00164 <span class="comment">         */</span>
00165         <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00166             <span class="comment">/*</span>
00167 <span class="comment">             * Ok, send WM_PALETTECHANGED message to everyone. The wParam</span>
00168 <span class="comment">             * contains a handle to the currently active window.  Send</span>
00169 <span class="comment">             * message to the desktop also, so things on the desktop bitmap</span>
00170 <span class="comment">             * will paint ok.</span>
00171 <span class="comment">             */</span>
00172              <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwnd, &amp;tlpwnd);
00173              <a class="code" href="../../d4/d1/userk_8h.html#a1106">xxxBroadcastPaletteChanged</a>(pwnd, FALSE);
00174              <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00175 
00176             <span class="comment">/*</span>
00177 <span class="comment">             * Mark all other desktops as needing to send out</span>
00178 <span class="comment">             * WM_PALETTECHANGED messages.</span>
00179 <span class="comment">             */</span>
00180 
00181             pwinsta = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a241">grpWinStaList</a>;
00182 
00183             <span class="keywordflow">while</span> (pwinsta != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00184                 pdesk = pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o1">rpdeskList</a>;
00185                 <span class="keywordflow">while</span> (pdesk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00186                     <span class="keywordflow">if</span> (pdesk != pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk) {
00187                         pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o4">dwDTFlags</a> |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a528">DTF_NEEDSPALETTECHANGED</a>;
00188                     }
00189                     pdesk = pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o2">rpdeskNext</a>;
00190                 }
00191                 pwinsta = pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o0">rpwinstaNext</a>;
00192             }
00193 
00194             GreRealizePalette(hdc);
00195         }
00196     }
00197 
00198     <span class="comment">/*</span>
00199 <span class="comment">     * Walk through the SPB list (the saved bitmaps under windows with the</span>
00200 <span class="comment">     * CS_SAVEBITS style) discarding all bitmaps</span>
00201 <span class="comment">     */</span>
00202     <span class="keywordflow">if</span> (HIWORD(dwNumChanged)) {
00203         <a class="code" href="../../d1/d4/spb_8c.html#a12">FreeAllSpbs</a>();
00204     }
00205 
00206     <span class="keywordflow">return</span> LOWORD(dwNumChanged);
00207 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:01 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
