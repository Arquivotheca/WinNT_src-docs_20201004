<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: utxcpt2.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>utxcpt2.c File Reference</h1><code>#include &lt;<a class="el" href="../../d0/d8/ntos_8h-source.html">ntos.h</a>&gt;</code><br>

<p>
<a href="../../d1/d2/utxcpt2_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/utxcpt2_8c.html#a0">ExceptionTest</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/utxcpt2_8c.html#a1">main</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/utxcpt2_8c.html#a2">ZwLastChance</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PCONTEXT ContextRecord)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/utxcpt2_8c.html#a3">fret</a> (IN PULONG Counter)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/utxcpt2_8c.html#a4">eret</a> (IN NTSTATUS <a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>, IN PULONG Counter)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/utxcpt2_8c.html#a5">bar</a> (IN NTSTATUS <a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>, IN PULONG Counter)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/utxcpt2_8c.html#a6">foo</a> (IN NTSTATUS <a class="el" href="../../d2/d1/cttoken_8c.html#a18">Status</a>)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="utxcpt2.c::bar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID bar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NTSTATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>Status</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Counter</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00360">360</a> of file <a class="el" href="../../d1/d2/utxcpt2_8c-source.html">utxcpt2.c</a>.
<p>
References <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00382">foo()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00009">ExceptionTest()</a>, and <a class="el" href="../../d3/d2/utxcpt4_8c-source.html#l00047">Tkm()</a>.
<p>
<pre class="fragment"><div>00364 {
00365 
00366     EXCEPTION_RECORD ExceptionRecord;
00367 
00368     <span class="keywordflow">try</span> {
00369         <a class="code" href="../../d2/d3/utxcpt4_8c.html#a3">foo</a>(Status);
00370     }
00371 
00372     finally {
00373         <span class="keywordflow">if</span> (abnormal_termination() != 0) {
00374             *Counter = 99;
00375         } <span class="keywordflow">else</span> {
00376             *Counter = 100;
00377         }
00378     }
00379 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="utxcpt2.c::eret" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID eret           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NTSTATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>Status</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Counter</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00339">339</a> of file <a class="el" href="../../d1/d2/utxcpt2_8c-source.html">utxcpt2.c</a>.
<p>
References <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00382">foo()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00009">ExceptionTest()</a>, <a class="el" href="../../d2/d0/xcpt4_8c-source.html#l00143">main()</a>, and <a class="el" href="../../d3/d2/utxcpt4_8c-source.html#l00047">Tkm()</a>.
<p>
<pre class="fragment"><div>00343 {
00344 
00345     EXCEPTION_RECORD ExceptionRecord;
00346 
00347     <span class="keywordflow">try</span> {
00348 
00349         <span class="keywordflow">try</span> {
00350             <a class="code" href="../../d2/d3/utxcpt4_8c.html#a3">foo</a>(Status);
00351         } except (exception_code() == Status) {
00352             *Counter += 1;
00353             <span class="keywordflow">return</span> 0xDEADBEEF;
00354         }
00355     } finally {
00356         *Counter += 1;
00357     }
00358 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="utxcpt2.c::ExceptionTest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExceptionTest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00009">9</a> of file <a class="el" href="../../d1/d2/utxcpt2_8c-source.html">utxcpt2.c</a>.
<p>
References <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00360">bar()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00339">eret()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00047">EXCEPTION_NONCONTINUABLE</a>, <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00382">foo()</a>, <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00321">fret()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00466">RtlRaiseException()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00304">main()</a>.
<p>
<pre class="fragment"><div>00017 {
00018 
00019     EXCEPTION_RECORD ExceptionRecord;
00020     LONG Counter;
00021     ULONG rv;
00022 
00023     <span class="comment">//</span>
00024     <span class="comment">// Announce start of exception test.</span>
00025     <span class="comment">//</span>
00026 
00027     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Start of exception test\n"</span>);
00028 
00029     <span class="comment">//</span>
00030     <span class="comment">// Initialize exception record.</span>
00031     <span class="comment">//</span>
00032 
00033     ExceptionRecord.ExceptionCode = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)49;
00034     ExceptionRecord.ExceptionRecord = (PEXCEPTION_RECORD)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00035     ExceptionRecord.NumberParameters = 1;
00036     ExceptionRecord.ExceptionInformation[0] = 9;
00037 
00038     <span class="comment">//</span>
00039     <span class="comment">// Simply try statement with a finally clause that is entered sequentially.</span>
00040     <span class="comment">//</span>
00041     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t1..."</span>);
00042     Counter = 0;
00043     <span class="keywordflow">try</span> {
00044         Counter += 1;
00045     } finally {
00046         <span class="keywordflow">if</span> (abnormal_termination() == 0) {
00047             Counter += 1;
00048         }
00049     }
00050     <span class="keywordflow">if</span> (Counter != 2) {
00051         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG  Finally clause executed as result of unwind\n"</span>);
00052     }
00053     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00054 
00055     <span class="comment">//</span>
00056     <span class="comment">// Simple try statement with an exception clause that is never executed</span>
00057     <span class="comment">// because there is no exception raised in the try clause.</span>
00058     <span class="comment">//</span>
00059 <span class="comment">//  goto a;</span>
00060     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t2..."</span>);
00061     Counter = 0;
00062     <span class="keywordflow">try</span> {
00063 <span class="comment">//a:        Counter += 1;</span>
00064           Counter += 1;
00065     } except (Counter) {
00066         Counter += 1;
00067     }
00068     <span class="keywordflow">if</span> (Counter != 1) {
00069         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG  Exception clause executed when it shouldn't be\n"</span>);
00070     }
00071     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00072 
00073     <span class="comment">//</span>
00074     <span class="comment">// Simple try statement with an exception handler that is never executed</span>
00075     <span class="comment">// because the exception expression continues execution.</span>
00076     <span class="comment">//</span>
00077     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t3..."</span>);
00078     Counter = 0;
00079     ExceptionRecord.ExceptionFlags = 0;
00080     <span class="keywordflow">try</span> {
00081         Counter -= 1;
00082         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord);
00083     } except (Counter) {
00084         Counter -= 1;
00085     }
00086     <span class="keywordflow">if</span> (Counter != - 1) {
00087         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG  Exception clause executed when it shouldn't be\n"</span>);
00088     }
00089     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00090 
00091     <span class="comment">//</span>
00092     <span class="comment">// Simple try statement with an exception clause that is always executed.</span>
00093     <span class="comment">//</span>
00094     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t4..."</span>);
00095     Counter = 0;
00096     ExceptionRecord.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00097     <span class="keywordflow">try</span> {
00098         Counter += 1;
00099         <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord);
00100     } except (Counter) {
00101         Counter += 1;
00102     }
00103     <span class="keywordflow">if</span> (Counter != 2) {
00104         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG  Exception clause not executed when it should be\n"</span>);
00105     }
00106     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00107 
00108     <span class="comment">//</span>
00109     <span class="comment">// Simply try statement with a finally clause that is entered as the</span>
00110     <span class="comment">// result of an exception.</span>
00111     <span class="comment">//</span>
00112 
00113     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t5..."</span>);
00114     Counter = 0;
00115     ExceptionRecord.ExceptionFlags = 0;
00116     <span class="keywordflow">try</span> {
00117         <span class="keywordflow">try</span> {
00118             Counter += 1;
00119             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord);
00120         } finally {
00121             <span class="keywordflow">if</span> (abnormal_termination() != 0) {
00122                 Counter += 1;
00123             }
00124         }
00125     } except (Counter) {
00126         <span class="keywordflow">if</span> (Counter == 2) {
00127             Counter += 1;
00128         }
00129     }
00130     <span class="keywordflow">if</span> (Counter != 3) {
00131         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG  Finally clause executed as result of sequential exit\n"</span>);
00132     }
00133     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00134 
00135     <span class="comment">//</span>
00136     <span class="comment">// Simple try that calls a function which raises an exception.</span>
00137     <span class="comment">//</span>
00138     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t6..."</span>);
00139     Counter = 0;
00140     ExceptionRecord.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00141     <span class="keywordflow">try</span> {
00142         <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d2/d3/utxcpt4_8c.html#a3">foo</a>(IN NTSTATUS Status);
00143 
00144         Counter += 1;
00145         <a class="code" href="../../d2/d3/utxcpt4_8c.html#a3">foo</a>(STATUS_ACCESS_VIOLATION);
00146     } except (exception_code() == STATUS_ACCESS_VIOLATION) {
00147         Counter += 1;
00148     }
00149     <span class="keywordflow">if</span> (Counter != 2) {
00150         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG  Exception clause not executed when it should be\n"</span>);
00151     }
00152     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00153 
00154     <span class="comment">//</span>
00155     <span class="comment">// Simple try that calls a function which calls a function that</span>
00156     <span class="comment">// raises an exception. The first function has a finally clause</span>
00157     <span class="comment">// that must be executed for this test to work.</span>
00158     <span class="comment">//</span>
00159     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t7..."</span>);
00160     Counter = 0;
00161     ExceptionRecord.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00162     <span class="keywordflow">try</span> {
00163         <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d2/d3/utxcpt4_8c.html#a1">bar</a>(IN NTSTATUS Status, IN PULONG Counter);
00164 
00165         <a class="code" href="../../d2/d3/utxcpt4_8c.html#a1">bar</a>(STATUS_ACCESS_VIOLATION, &amp;Counter);
00166 
00167     } except (exception_code() == STATUS_ACCESS_VIOLATION) {
00168         <span class="keywordflow">if</span> (Counter != 99) {
00169             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG  finally in called procedure not executed\n"</span>);
00170         }
00171     }
00172     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00173 
00174     <span class="comment">//</span>
00175     <span class="comment">// A try within an except</span>
00176     <span class="comment">//</span>
00177     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t8..."</span>);
00178     Counter = 0;
00179     ExceptionRecord.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00180     <span class="keywordflow">try</span> {
00181 
00182         <a class="code" href="../../d2/d3/utxcpt4_8c.html#a3">foo</a>(STATUS_ACCESS_VIOLATION);
00183 
00184     } except (exception_code() == STATUS_ACCESS_VIOLATION) {
00185 
00186         Counter++;
00187 
00188         <span class="keywordflow">try</span> {
00189 
00190             <a class="code" href="../../d2/d3/utxcpt4_8c.html#a3">foo</a>(STATUS_SUCCESS);
00191 
00192         } except (exception_code() == STATUS_SUCCESS) {
00193             <span class="keywordflow">if</span> ( Counter != 1 ) {
00194                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG  Previous Handler not Entered\n"</span>);
00195             }
00196             Counter++;
00197 
00198         }
00199     }
00200     <span class="keywordflow">if</span> (Counter != 2) {
00201         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG Both Handlers not entered\n"</span>);
00202     }
00203     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00204 
00205     <span class="comment">//</span>
00206     <span class="comment">// A goto from an exception clause that needs to pass</span>
00207     <span class="comment">// through a finally</span>
00208     <span class="comment">//</span>
00209     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t9..."</span>);
00210     Counter = 0;
00211     ExceptionRecord.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00212     <span class="keywordflow">try</span> {
00213         <span class="keywordflow">try</span> {
00214             <a class="code" href="../../d2/d3/utxcpt4_8c.html#a3">foo</a>(STATUS_ACCESS_VIOLATION);
00215         } except (exception_code() == STATUS_ACCESS_VIOLATION) {
00216             Counter++;
00217             <span class="keywordflow">goto</span> t9;
00218         }
00219     } finally {
00220         Counter++;
00221     }
00222 t9:
00223     <span class="keywordflow">if</span> (Counter != 2) {
00224         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG Finally and Exception Handlers not entered\n"</span>);
00225     }
00226     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00227 
00228     <span class="comment">//</span>
00229     <span class="comment">// A goto from an exception clause that needs to pass</span>
00230     <span class="comment">// through a finally</span>
00231     <span class="comment">//</span>
00232     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t10..."</span>);
00233     Counter = 0;
00234     ExceptionRecord.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00235     <span class="keywordflow">try</span> {
00236         <span class="keywordflow">try</span> {
00237             Counter++;
00238         } finally {
00239             Counter++;
00240             <span class="keywordflow">goto</span> t10;
00241         }
00242     } finally {
00243         Counter++;
00244     }
00245 t10:
00246     <span class="keywordflow">if</span> (Counter != 3) {
00247         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG Both Finally Handlers not entered\n"</span>);
00248     }
00249     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00250 
00251     <span class="comment">//</span>
00252     <span class="comment">// A return from an except clause</span>
00253     <span class="comment">//</span>
00254     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t11..."</span>);
00255     Counter = 0;
00256     ExceptionRecord.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00257 
00258     <span class="keywordflow">try</span> {
00259         ULONG <a class="code" href="../../d2/d3/utxcpt4_8c.html#a2">eret</a>(IN NTSTATUS Status, IN PULONG Counter);
00260 
00261         Counter++;
00262         rv = <a class="code" href="../../d2/d3/utxcpt4_8c.html#a2">eret</a>(STATUS_ACCESS_VIOLATION, &amp;Counter);
00263     } finally {
00264         Counter++;
00265     }
00266 
00267     <span class="keywordflow">if</span> (Counter != 4) {
00268         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG Both Finally Handlers and Exception Handler not entered\n"</span>);
00269     }
00270     <span class="keywordflow">if</span> (rv != 0xDEADBEEF) {
00271         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG rv is wrong\n"</span>);
00272     }
00273     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00274 
00275     <span class="comment">//</span>
00276     <span class="comment">// A return from a finally clause</span>
00277     <span class="comment">//</span>
00278     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"t12..."</span>);
00279     Counter = 0;
00280     ExceptionRecord.ExceptionFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a25">EXCEPTION_NONCONTINUABLE</a>;
00281 
00282     <span class="keywordflow">try</span> {
00283         <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d2/d3/utxcpt4_8c.html#a4">fret</a>(IN PULONG Counter);
00284 
00285         Counter++;
00286         <a class="code" href="../../d2/d3/utxcpt4_8c.html#a4">fret</a>(&amp;Counter);
00287     } finally {
00288         Counter++;
00289     }
00290 
00291     <span class="keywordflow">if</span> (Counter != 5) {
00292         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"BUG All three Finally Handlers not entered\n"</span>);
00293     }
00294     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"done\n"</span>);
00295     <span class="comment">//</span>
00296     <span class="comment">// Announce end of exception test.</span>
00297     <span class="comment">//</span>
00298 
00299     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"End of exception test\n"</span>);
00300 
00301     <span class="keywordflow">return</span>;
00302 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="utxcpt2.c::foo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID foo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NTSTATUS&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Status</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00382">382</a> of file <a class="el" href="../../d1/d2/utxcpt2_8c-source.html">utxcpt2.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00466">RtlRaiseException()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00360">bar()</a>, <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00339">eret()</a>, <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00009">ExceptionTest()</a>, <a class="el" href="../../d9/d6/udbgk_8c-source.html#l00049">ThreadThatExcepts()</a>, and <a class="el" href="../../d3/d2/utxcpt4_8c-source.html#l00047">Tkm()</a>.
<p>
<pre class="fragment"><div>00385 {
00386     EXCEPTION_RECORD ExceptionRecord;
00387     LONG Counter;
00388 
00389     <span class="comment">//</span>
00390     <span class="comment">// Initialize exception record.</span>
00391     <span class="comment">//</span>
00392 
00393     ExceptionRecord.ExceptionFlags = 0;
00394     ExceptionRecord.ExceptionCode = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00395     ExceptionRecord.ExceptionRecord = (PEXCEPTION_RECORD)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00396     ExceptionRecord.NumberParameters = 0;
00397     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a9">RtlRaiseException</a>(&amp;ExceptionRecord);
00398 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="utxcpt2.c::fret" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID fret           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Counter</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00321">321</a> of file <a class="el" href="../../d1/d2/utxcpt2_8c-source.html">utxcpt2.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00009">ExceptionTest()</a>, <a class="el" href="../../d2/d0/xcpt4_8c-source.html#l00143">main()</a>, and <a class="el" href="../../d3/d2/utxcpt4_8c-source.html#l00047">Tkm()</a>.
<p>
<pre class="fragment"><div>00324 {
00325 
00326     <span class="keywordflow">try</span> {
00327 
00328         <span class="keywordflow">try</span> {
00329             *Counter += 1;
00330         } finally {
00331             *Counter += 1;
00332             <span class="keywordflow">return</span>;
00333         }
00334     } finally {
00335         *Counter += 1;
00336     }
00337 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="utxcpt2.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00304">304</a> of file <a class="el" href="../../d1/d2/utxcpt2_8c-source.html">utxcpt2.c</a>.
<p>
References <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00009">ExceptionTest()</a>.
<p>
<pre class="fragment"><div>00305 {
00306     <a class="code" href="../../d0/d3/utxcpt2_8c.html#a0">ExceptionTest</a> ();
00307 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="utxcpt2.c::ZwLastChance" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ZwLastChance           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/utxcpt2_8c-source.html#l00311">311</a> of file <a class="el" href="../../d1/d2/utxcpt2_8c-source.html">utxcpt2.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>.
<p>
<pre class="fragment"><div>00315 {
00316     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"ZwLastChance Entered\n"</span>);;
00317 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:46:06 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
