<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: lfsdisk.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>lfsdisk.h</h1><a href="../../d9/d3/lfsdisk_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++ BUILD Version: 0000    // Increment this if a change has global effects</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    LfsDisk.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module defines the on-disk structures present in the log file.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Brian Andrew    [BrianAn]   13-June-1991</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">IMPORTANT NOTE:</span>
00020 <span class="comment"></span>
00021 <span class="comment">    The Log File Service will by used on systems that require that on-disk</span>
00022 <span class="comment">    structures guarantee the natural alignment of all arithmetic quantities</span>
00023 <span class="comment">    up to and including quad-word (64-bit) numbers.  Therefore, all Lfs</span>
00024 <span class="comment">    on-disk structures are quad-word aligned, etc.</span>
00025 <span class="comment"></span>
00026 <span class="comment">--*/</span>
00027 
00028 <span class="preprocessor">#ifndef _LFSDISK_</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#define _LFSDISK_</span>
00030 <span class="preprocessor"></span>
<a name="l00031"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a0">00031</a> <span class="preprocessor">#define MINIMUM_LFS_PAGES               0x00000030</span>
<a name="l00032"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a1">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define MINIMUM_LFS_CLIENTS             1</span>
00033 <span class="preprocessor"></span>
00034 <span class="comment">//</span>
00035 <span class="comment">//  The following macros are used to set and query with respect to the</span>
00036 <span class="comment">//  update sequence arrays.</span>
00037 <span class="comment">//</span>
00038 
<a name="l00039"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a2">00039</a> <span class="preprocessor">#define UpdateSequenceStructureSize( MSH )              \</span>
00040 <span class="preprocessor">    ((((PMULTI_SECTOR_HEADER) (MSH))-&gt;UpdateSequenceArraySize - 1) * SEQUENCE_NUMBER_STRIDE)</span>
00041 <span class="preprocessor"></span>
<a name="l00042"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a3">00042</a> <span class="preprocessor">#define UpdateSequenceArraySize( STRUCT_SIZE )          \</span>
00043 <span class="preprocessor">    ((STRUCT_SIZE) / SEQUENCE_NUMBER_STRIDE + 1)</span>
00044 <span class="preprocessor"></span>
<a name="l00045"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a4">00045</a> <span class="preprocessor">#define FIRST_STRIDE                                    \</span>
00046 <span class="preprocessor">    (SEQUENCE_NUMBER_STRIDE - sizeof( UPDATE_SEQUENCE_NUMBER ))</span>
00047 <span class="preprocessor"></span>
00048 
00049 <span class="comment">//</span>
00050 <span class="comment">//  Log client ID.  This is used to uniquely identify a client for a</span>
00051 <span class="comment">//  particular log file.</span>
00052 <span class="comment">//</span>
00053 
<a name="l00054"></a><a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html">00054</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html">_LFS_CLIENT_ID</a> {
00055 
<a name="l00056"></a><a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html#o0">00056</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html#o0">SeqNumber</a>;
<a name="l00057"></a><a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html#o1">00057</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html#o1">ClientIndex</a>;
00058 
00059 } <a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html">LFS_CLIENT_ID</a>, *<a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html">PLFS_CLIENT_ID</a>;
00060 
00061 
00062 <span class="comment">//</span>
00063 <span class="comment">//  Log Record Header.  This is the header that begins every Log Record in</span>
00064 <span class="comment">//  the log file.</span>
00065 <span class="comment">//</span>
00066 
<a name="l00067"></a><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html">00067</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html">_LFS_RECORD_HEADER</a> {
00068 
00069     <span class="comment">//</span>
00070     <span class="comment">//  Log File Sequence Number of this log record.</span>
00071     <span class="comment">//</span>
00072 
<a name="l00073"></a><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o0">00073</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o0">ThisLsn</a>;
00074 
00075     <span class="comment">//</span>
00076     <span class="comment">//  The following fields are used to back link Lsn's.  The ClientPrevious</span>
00077     <span class="comment">//  and ClientUndoNextLsn fields are used by a client to link his log</span>
00078     <span class="comment">//  records.</span>
00079     <span class="comment">//</span>
00080 
<a name="l00081"></a><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o1">00081</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o1">ClientPreviousLsn</a>;
<a name="l00082"></a><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o2">00082</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o2">ClientUndoNextLsn</a>;
00083 
00084     <span class="comment">//</span>
00085     <span class="comment">//  The following field is the size of data area for this record.  The</span>
00086     <span class="comment">//  log record header will be padded if necessary to fill to a 64-bit</span>
00087     <span class="comment">//  boundary, so the client data will begin on a 64-bit boundary to</span>
00088     <span class="comment">//  insure that all of his data is 64-bit aligned.  The below value</span>
00089     <span class="comment">//  has not been padded to 64 bits however.</span>
00090     <span class="comment">//</span>
00091 
<a name="l00092"></a><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o3">00092</a>     ULONG <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o3">ClientDataLength</a>;
00093 
00094     <span class="comment">//</span>
00095     <span class="comment">//  Client ID.  This identifies the owner of this log record.  The owner</span>
00096     <span class="comment">//  is uniquely identified by his offset in the client array and the</span>
00097     <span class="comment">//  sequence number associated with that client record.</span>
00098     <span class="comment">//</span>
00099 
<a name="l00100"></a><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o4">00100</a>     <a class="code" href="../../d3/d0/struct__LFS__CLIENT__ID.html">LFS_CLIENT_ID</a> <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o4">ClientId</a>;
00101 
00102     <span class="comment">//</span>
00103     <span class="comment">//  This the Log Record type.  This could be a commit protocol record,</span>
00104     <span class="comment">//  a client restart area or a client update record.</span>
00105     <span class="comment">//</span>
00106 
<a name="l00107"></a><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o5">00107</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a13">LFS_RECORD_TYPE</a> <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o5">RecordType</a>;
00108 
00109     <span class="comment">//</span>
00110     <span class="comment">//  Transaction ID.  This is used externally by a client (Transaction</span>
00111     <span class="comment">//  Manager) to group log file entries.</span>
00112     <span class="comment">//</span>
00113 
<a name="l00114"></a><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o6">00114</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a17">TRANSACTION_ID</a> <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o6">TransactionId</a>;
00115 
00116     <span class="comment">//</span>
00117     <span class="comment">//  Log record flags.</span>
00118     <span class="comment">//</span>
00119 
<a name="l00120"></a><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o7">00120</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o7">Flags</a>;
00121 
00122     <span class="comment">//</span>
00123     <span class="comment">//  Alignment field.</span>
00124     <span class="comment">//</span>
00125 
<a name="l00126"></a><a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o8">00126</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html#o8">AlignWord</a>;
00127 
00128 } <a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html">LFS_RECORD_HEADER</a>, *<a class="code" href="../../d8/d0/struct__LFS__RECORD__HEADER.html">PLFS_RECORD_HEADER</a>;
00129 
<a name="l00130"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a5">00130</a> <span class="preprocessor">#define LOG_RECORD_MULTI_PAGE           (0x0001)</span>
00131 <span class="preprocessor"></span>
<a name="l00132"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a6">00132</a> <span class="preprocessor">#define LFS_RECORD_HEADER_SIZE          QuadAlign( sizeof( LFS_RECORD_HEADER ))</span>
00133 <span class="preprocessor"></span>
00134 
00135 <span class="comment">//</span>
00136 <span class="comment">//  Following are the version specific fields in the record page header.</span>
00137 <span class="comment">//</span>
00138 
<a name="l00139"></a><a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html">00139</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html">_LFS_UNPACKED_RECORD_PAGE</a> {
00140 
00141     <span class="comment">//</span>
00142     <span class="comment">//  This gives us the offset of the free space in the page.</span>
00143     <span class="comment">//</span>
00144 
<a name="l00145"></a><a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html#o0">00145</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html#o0">NextRecordOffset</a>;
00146 
<a name="l00147"></a><a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html#o1">00147</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html#o1">WordAlign</a>;
00148 
00149     <span class="comment">//</span>
00150     <span class="comment">//  Reserved.  The following array is reserved for possible future use.</span>
00151     <span class="comment">//</span>
00152 
<a name="l00153"></a><a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html#o2">00153</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html#o2">Reserved</a>;
00154 
00155     <span class="comment">//</span>
00156     <span class="comment">//  Update Sequence Array.  Used to protect the page block.</span>
00157     <span class="comment">//</span>
00158 
<a name="l00159"></a><a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html#o3">00159</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a6">UPDATE_SEQUENCE_ARRAY</a> <a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html#o3">UpdateSequenceArray</a>;
00160 
00161 } <a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html">LFS_UNPACKED_RECORD_PAGE</a>, *<a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html">PLFS_UNPACKED_RECORD_PAGE</a>;
00162 
<a name="l00163"></a><a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html">00163</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html">_LFS_PACKED_RECORD_PAGE</a> {
00164 
00165     <span class="comment">//</span>
00166     <span class="comment">//  This gives us the offset of the free space in the page.</span>
00167     <span class="comment">//</span>
00168 
<a name="l00169"></a><a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html#o0">00169</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html#o0">NextRecordOffset</a>;
00170 
<a name="l00171"></a><a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html#o1">00171</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html#o1">WordAlign</a>;
00172 
<a name="l00173"></a><a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html#o2">00173</a>     ULONG <a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html#o2">DWordAlign</a>;
00174 
00175     <span class="comment">//</span>
00176     <span class="comment">//  The following is the Lsn for the last log record which ends on the page.</span>
00177     <span class="comment">//</span>
00178 
<a name="l00179"></a><a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html#o3">00179</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html#o3">LastEndLsn</a>;
00180 
00181     <span class="comment">//</span>
00182     <span class="comment">//  Update Sequence Array.  Used to protect the page block.</span>
00183     <span class="comment">//</span>
00184 
<a name="l00185"></a><a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html#o4">00185</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a6">UPDATE_SEQUENCE_ARRAY</a> <a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html#o4">UpdateSequenceArray</a>;
00186 
00187 } <a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html">LFS_PACKED_RECORD_PAGE</a>, *<a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html">PLFS_PACKED_RECORD_PAGE</a>;
00188 
00189 
00190 <span class="comment">//</span>
00191 <span class="comment">//  Log Record Page Header.  This structure is present at the beginning of each</span>
00192 <span class="comment">//  log file page in the client record section.</span>
00193 <span class="comment">//</span>
00194 
<a name="l00195"></a><a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html">00195</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html">_LFS_RECORD_PAGE_HEADER</a> {
00196 
00197     <span class="comment">//</span>
00198     <span class="comment">//  Cache multisector protection header.</span>
00199     <span class="comment">//</span>
00200 
<a name="l00201"></a><a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o0">00201</a>     <a class="code" href="../../d2/d1/struct__MULTI__SECTOR__HEADER.html">MULTI_SECTOR_HEADER</a> <a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o0">MultiSectorHeader</a>;
00202 
00203     <span class="keyword">union </span>{
00204 
00205         <span class="comment">//</span>
00206         <span class="comment">//  Highest Lsn in this log file page.  This field is only for</span>
00207         <span class="comment">//  regular log pages.</span>
00208         <span class="comment">//</span>
00209 
<a name="l00210"></a><a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o1">00210</a>         <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o1">LastLsn</a>;
00211 
00212         <span class="comment">//</span>
00213         <span class="comment">//  Log file offset.  This is for the tail copies and indicates the</span>
00214         <span class="comment">//  location in the file where the original lays.  In this case the</span>
00215         <span class="comment">//  LastLsn field above can be obtained from the last ending Lsn</span>
00216         <span class="comment">//  field in the PACKED_RECORD_PAGE structure.</span>
00217         <span class="comment">//</span>
00218 
<a name="l00219"></a><a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o2">00219</a>         LONGLONG <a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o2">FileOffset</a>;
00220 
00221     } Copy;
00222 
00223     <span class="comment">//</span>
00224     <span class="comment">//  Page Header Flags.  These are the same flags that are stored in the</span>
00225     <span class="comment">//  Lbcb-&gt;Flags field.</span>
00226     <span class="comment">//</span>
00227     <span class="comment">//      LOG_PAGE_LOG_RECORD_END     -   Page contains the end of a log record</span>
00228     <span class="comment">//</span>
00229 
<a name="l00230"></a><a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o4">00230</a>     ULONG <a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o4">Flags</a>;
00231 
00232     <span class="comment">//</span>
00233     <span class="comment">//  I/O Page Position.  The following fields are used to determine</span>
00234     <span class="comment">//  where this log page resides within a Lfs I/O transfer.</span>
00235     <span class="comment">//</span>
00236 
<a name="l00237"></a><a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o5">00237</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o5">PageCount</a>;
<a name="l00238"></a><a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o6">00238</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o6">PagePosition</a>;
00239 
00240     <span class="comment">//</span>
00241     <span class="comment">//  The following is the difference between version 1.1 and earlier.</span>
00242     <span class="comment">//</span>
00243 
00244     <span class="keyword">union </span>{
00245 
<a name="l00246"></a><a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o7">00246</a>         <a class="code" href="../../d4/d1/struct__LFS__UNPACKED__RECORD__PAGE.html">LFS_UNPACKED_RECORD_PAGE</a> <a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o7">Unpacked</a>;
<a name="l00247"></a><a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o8">00247</a>         <a class="code" href="../../d7/d0/struct__LFS__PACKED__RECORD__PAGE.html">LFS_PACKED_RECORD_PAGE</a> <a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html#o8">Packed</a>;
00248 
00249     } Header;
00250 
00251 } <a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html">LFS_RECORD_PAGE_HEADER</a>, *<a class="code" href="../../d9/d0/struct__LFS__RECORD__PAGE__HEADER.html">PLFS_RECORD_PAGE_HEADER</a>;
00252 
<a name="l00253"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a7">00253</a> <span class="preprocessor">#define LOG_PAGE_LOG_RECORD_END             (0x00000001)</span>
00254 <span class="preprocessor"></span>
<a name="l00255"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a8">00255</a> <span class="preprocessor">#define LFS_UNPACKED_RECORD_PAGE_HEADER_SIZE        (                               \</span>
00256 <span class="preprocessor">    FIELD_OFFSET( LFS_RECORD_PAGE_HEADER, Header.Unpacked.UpdateSequenceArray )     \</span>
00257 <span class="preprocessor">)</span>
00258 <span class="preprocessor"></span>
<a name="l00259"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a9">00259</a> <span class="preprocessor">#define LFS_PACKED_RECORD_PAGE_HEADER_SIZE          (                               \</span>
00260 <span class="preprocessor">    FIELD_OFFSET( LFS_RECORD_PAGE_HEADER, Header.Packed.UpdateSequenceArray )       \</span>
00261 <span class="preprocessor">)</span>
00262 <span class="preprocessor"></span>
00263 
00264 <span class="comment">//</span>
00265 <span class="comment">//  Log Restart Page Header.  This structure is at the head of the restart</span>
00266 <span class="comment">//  areas in a log file.</span>
00267 <span class="comment">//</span>
00268 
<a name="l00269"></a><a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html">00269</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html">_LFS_RESTART_PAGE_HEADER</a> {
00270 
00271     <span class="comment">//</span>
00272     <span class="comment">//  Cache multisector protection header.</span>
00273     <span class="comment">//</span>
00274 
<a name="l00275"></a><a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o0">00275</a>     <a class="code" href="../../d2/d1/struct__MULTI__SECTOR__HEADER.html">MULTI_SECTOR_HEADER</a> <a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o0">MultiSectorHeader</a>;
00276 
00277     <span class="comment">//</span>
00278     <span class="comment">//  This is the last Lsn found by checkdisk for this volume.</span>
00279     <span class="comment">//</span>
00280 
<a name="l00281"></a><a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o1">00281</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o1">ChkDskLsn</a>;
00282 
00283     <span class="comment">//</span>
00284     <span class="comment">//  System page size.  This is the page size of the system which</span>
00285     <span class="comment">//  initialized the log file.  Unless the log file has been gracefully</span>
00286     <span class="comment">//  shutdown (there are no clients with restart areas), it is a fatal</span>
00287     <span class="comment">//  error to attempt to write to a log file on a system with a differen</span>
00288     <span class="comment">//  page size.</span>
00289     <span class="comment">//</span>
00290 
<a name="l00291"></a><a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o2">00291</a>     ULONG <a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o2">SystemPageSize</a>;
00292 
00293     <span class="comment">//</span>
00294     <span class="comment">//  Log Page Size.  This is the log page size used for this log file.</span>
00295     <span class="comment">//  The entire Lfs restart area must fit on a single log page.</span>
00296     <span class="comment">//</span>
00297 
<a name="l00298"></a><a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o3">00298</a>     ULONG <a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o3">LogPageSize</a>;
00299 
00300     <span class="comment">//</span>
00301     <span class="comment">//  Lfs restart area offset.  This is the offset from the start of this</span>
00302     <span class="comment">//  structure to the Lfs restart area.</span>
00303     <span class="comment">//</span>
00304 
<a name="l00305"></a><a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o4">00305</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o4">RestartOffset</a>;
00306 
00307     <span class="comment">//</span>
00308     <span class="comment">//  The indicates major and minor versions.  Note that the pre-release versions</span>
00309     <span class="comment">//  have -1 in both positions.  Major version 0 indicates the transition</span>
00310     <span class="comment">//  from Beta to USA support.</span>
00311     <span class="comment">//</span>
00312     <span class="comment">//      Major Version</span>
00313     <span class="comment">//</span>
00314     <span class="comment">//          -1      Beta Version</span>
00315     <span class="comment">//           0      Transition</span>
00316     <span class="comment">//           1      Update sequence support.</span>
00317     <span class="comment">//</span>
00318 
<a name="l00319"></a><a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o5">00319</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o5">MinorVersion</a>;
<a name="l00320"></a><a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o6">00320</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o6">MajorVersion</a>;
00321 
00322     <span class="comment">//</span>
00323     <span class="comment">//  Update Sequence Array.  Used to protect the page block.</span>
00324     <span class="comment">//</span>
00325 
<a name="l00326"></a><a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o7">00326</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a6">UPDATE_SEQUENCE_ARRAY</a> <a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html#o7">UpdateSequenceArray</a>;
00327 
00328 } <a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html">LFS_RESTART_PAGE_HEADER</a>, *<a class="code" href="../../d3/d1/struct__LFS__RESTART__PAGE__HEADER.html">PLFS_RESTART_PAGE_HEADER</a>;
00329 
<a name="l00330"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a10">00330</a> <span class="preprocessor">#define LFS_RESTART_PAGE_HEADER_SIZE    (                           \</span>
00331 <span class="preprocessor">    FIELD_OFFSET( LFS_RESTART_PAGE_HEADER, UpdateSequenceArray )    \</span>
00332 <span class="preprocessor">)</span>
00333 <span class="preprocessor"></span>
00334 <span class="comment">//</span>
00335 <span class="comment">//  Id strings for the page headers.</span>
00336 <span class="comment">//</span>
00337 
<a name="l00338"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a11">00338</a> <span class="preprocessor">#define LFS_SIGNATURE_RESTART_PAGE          "RSTR"</span>
<a name="l00339"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a12">00339</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_SIGNATURE_RESTART_PAGE_ULONG    0x52545352</span>
<a name="l00340"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a13">00340</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_SIGNATURE_RECORD_PAGE           "RCRD"</span>
<a name="l00341"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a14">00341</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_SIGNATURE_RECORD_PAGE_ULONG     0x44524352</span>
<a name="l00342"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a15">00342</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_SIGNATURE_BAD_USA               "BAAD"</span>
<a name="l00343"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a16">00343</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_SIGNATURE_BAD_USA_ULONG         0x44414142</span>
<a name="l00344"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a17">00344</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_SIGNATURE_MODIFIED              "CHKD"</span>
<a name="l00345"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a18">00345</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_SIGNATURE_MODIFIED_ULONG        0x444b4843</span>
<a name="l00346"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a19">00346</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_SIGNATURE_UNINITIALIZED         "\377\377\377\377"</span>
<a name="l00347"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a20">00347</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_SIGNATURE_UNINITIALIZED_ULONG   0xffffffff</span>
00348 <span class="preprocessor"></span>
00349 
00350 <span class="comment">//</span>
00351 <span class="comment">//  Log Client Record.  A log client record exists for each client user of</span>
00352 <span class="comment">//  the log file.  One of these is in each Lfs restart area.</span>
00353 <span class="comment">//</span>
00354 
<a name="l00355"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a21">00355</a> <span class="preprocessor">#define LFS_NO_CLIENT                           0xffff</span>
<a name="l00356"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a22">00356</a> <span class="preprocessor"></span><span class="preprocessor">#define LFS_CLIENT_NAME_MAX                     64</span>
00357 <span class="preprocessor"></span>
<a name="l00358"></a><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html">00358</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html">_LFS_CLIENT_RECORD</a> {
00359 
00360     <span class="comment">//</span>
00361     <span class="comment">//  Oldest Lsn.  This is the oldest Lsn that this client requires to</span>
00362     <span class="comment">//  be in the log file.</span>
00363     <span class="comment">//</span>
00364 
<a name="l00365"></a><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o0">00365</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o0">OldestLsn</a>;
00366 
00367     <span class="comment">//</span>
00368     <span class="comment">//  Client Restart Lsn.  This is the Lsn of the latest client restart</span>
00369     <span class="comment">//  area written to the disk.  A reserved Lsn will indicate that no</span>
00370     <span class="comment">//  restart area exists for this client.</span>
00371     <span class="comment">//</span>
00372 
<a name="l00373"></a><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o1">00373</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o1">ClientRestartLsn</a>;
00374 
00375     <span class="comment">//</span>
00376     <span class="comment">//</span>
00377     <span class="comment">//  Previous/Next client area.  These are the indexes into an array of</span>
00378     <span class="comment">//  Log Client Records for the previous and next client records.</span>
00379     <span class="comment">//</span>
00380 
<a name="l00381"></a><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o2">00381</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o2">PrevClient</a>;
<a name="l00382"></a><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o3">00382</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o3">NextClient</a>;
00383 
00384     <span class="comment">//</span>
00385     <span class="comment">//  Sequence Number.  Incremented whenever this record is reused.  This</span>
00386     <span class="comment">//  will happen whenever a client opens (reopens) the log file and has</span>
00387     <span class="comment">//  no current restart area.</span>
00388 
<a name="l00389"></a><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o4">00389</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o4">SeqNumber</a>;
00390 
00391     <span class="comment">//</span>
00392     <span class="comment">//  Alignment field.</span>
00393     <span class="comment">//</span>
00394 
<a name="l00395"></a><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o5">00395</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o5">AlignWord</a>;
00396 
00397     <span class="comment">//</span>
00398     <span class="comment">//  Align the entire record.</span>
00399     <span class="comment">//</span>
00400 
<a name="l00401"></a><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o6">00401</a>     ULONG <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o6">AlignDWord</a>;
00402 
00403     <span class="comment">//</span>
00404     <span class="comment">//  The following fields are used to describe the client name.  A client</span>
00405     <span class="comment">//  name consists of at most 32 Unicode character (64 bytes).  The Log</span>
00406     <span class="comment">//  file service will treat client names as case sensitive.</span>
00407     <span class="comment">//</span>
00408 
<a name="l00409"></a><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o7">00409</a>     ULONG <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o7">ClientNameLength</a>;
00410 
<a name="l00411"></a><a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o8">00411</a>     WCHAR <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html#o8">ClientName</a>[<a class="code" href="../../d9/d3/lfsdisk_8h.html#a22">LFS_CLIENT_NAME_MAX</a>];
00412 
00413 } <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html">LFS_CLIENT_RECORD</a>, *<a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html">PLFS_CLIENT_RECORD</a>;
00414 
00415 
00416 <span class="comment">//</span>
00417 <span class="comment">//  Lfs Restart Area.  Two copies of these will exist at the beginning of the</span>
00418 <span class="comment">//  log file.</span>
00419 <span class="comment">//</span>
00420 
<a name="l00421"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html">00421</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html">_LFS_RESTART_AREA</a> {
00422 
00423     <span class="comment">//</span>
00424     <span class="comment">//  Current Lsn.  This is periodic snapshot of the current logical end of</span>
00425     <span class="comment">//  log file to facilitate restart.</span>
00426     <span class="comment">//</span>
00427 
<a name="l00428"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o0">00428</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o0">CurrentLsn</a>;
00429 
00430     <span class="comment">//</span>
00431     <span class="comment">//  Number of Clients.  This is the maximum number of clients supported</span>
00432     <span class="comment">//  for this log file.</span>
00433     <span class="comment">//</span>
00434 
<a name="l00435"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o1">00435</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o1">LogClients</a>;
00436 
00437     <span class="comment">//</span>
00438     <span class="comment">//  The following are indexes into the client record arrays.  The client</span>
00439     <span class="comment">//  records are linked into two lists.  A free list of client records and</span>
00440     <span class="comment">//  an in-use list of records.</span>
00441     <span class="comment">//</span>
00442 
<a name="l00443"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o2">00443</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o2">ClientFreeList</a>;
<a name="l00444"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o3">00444</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o3">ClientInUseList</a>;
00445 
00446     <span class="comment">//</span>
00447     <span class="comment">//  Flag field.</span>
00448     <span class="comment">//</span>
00449     <span class="comment">//      RESTART_SINGLE_PAGE_IO      All log pages written 1 by 1</span>
00450     <span class="comment">//</span>
00451 
<a name="l00452"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o4">00452</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o4">Flags</a>;
00453 
00454     <span class="comment">//</span>
00455     <span class="comment">//  The following is the number of bits to use for the sequence number.</span>
00456     <span class="comment">//</span>
00457 
<a name="l00458"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o5">00458</a>     ULONG <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o5">SeqNumberBits</a>;
00459 
00460     <span class="comment">//</span>
00461     <span class="comment">//  Length of this restart area.</span>
00462     <span class="comment">//</span>
00463 
<a name="l00464"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o6">00464</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o6">RestartAreaLength</a>;
00465 
00466     <span class="comment">//</span>
00467     <span class="comment">//  Offset from the start of this structure to the client array.</span>
00468     <span class="comment">//  Ignored in versions prior to 1.1</span>
00469     <span class="comment">//</span>
00470 
<a name="l00471"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o7">00471</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o7">ClientArrayOffset</a>;
00472 
00473     <span class="comment">//</span>
00474     <span class="comment">//  Usable log file size.  We will stop sharing the value in the page header.</span>
00475     <span class="comment">//</span>
00476 
<a name="l00477"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o8">00477</a>     LONGLONG <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o8">FileSize</a>;
00478 
00479     <span class="comment">//</span>
00480     <span class="comment">//  DataLength of last Lsn.  This doesn't include the length of</span>
00481     <span class="comment">//  the Lfs header.</span>
00482     <span class="comment">//</span>
00483 
<a name="l00484"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o9">00484</a>     ULONG <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o9">LastLsnDataLength</a>;
00485 
00486     <span class="comment">//</span>
00487     <span class="comment">//  The following apply to log pages.  This is the log page data offset and</span>
00488     <span class="comment">//  the length of the log record header.  Ignored in versions prior to 1.1</span>
00489     <span class="comment">//</span>
00490 
<a name="l00491"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o10">00491</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o10">RecordHeaderLength</a>;
<a name="l00492"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o11">00492</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o11">LogPageDataOffset</a>;
00493 
00494     <span class="comment">//</span>
00495     <span class="comment">//  Log file open count.  Used to determine if there has been a change to the disk.</span>
00496     <span class="comment">//</span>
00497 
<a name="l00498"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o12">00498</a>     ULONG <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o12">RestartOpenLogCount</a>;
00499 
00500     <span class="comment">//</span>
00501     <span class="comment">//  Keep this structure quadword aligned.</span>
00502     <span class="comment">//</span>
00503 
<a name="l00504"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o13">00504</a>     ULONG <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o13">AlignDWord</a>;
00505 
00506     <span class="comment">//</span>
00507     <span class="comment">//  Client data.</span>
00508     <span class="comment">//</span>
00509 
<a name="l00510"></a><a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o14">00510</a>     <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html">LFS_CLIENT_RECORD</a> <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html#o14">LogClientArray</a>[1];
00511 
00512 } <a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html">LFS_RESTART_AREA</a>, *<a class="code" href="../../d2/d1/struct__LFS__RESTART__AREA.html">PLFS_RESTART_AREA</a>;
00513 
<a name="l00514"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a23">00514</a> <span class="preprocessor">#define RESTART_SINGLE_PAGE_IO              (0x0001)</span>
00515 <span class="preprocessor"></span>
<a name="l00516"></a><a class="code" href="../../d9/d3/lfsdisk_8h.html#a24">00516</a> <span class="preprocessor">#define LFS_RESTART_AREA_SIZE       (FIELD_OFFSET( LFS_RESTART_AREA, LogClientArray ))</span>
00517 <span class="preprocessor"></span>
00518 <span class="comment">//</span>
00519 <span class="comment">//  Remember the old size of the restart area when accessing older disks.</span>
00520 <span class="comment">//</span>
00521 
<a name="l00522"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html">00522</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html">_LFS_OLD_RESTART_AREA</a> {
00523 
00524     <span class="comment">//</span>
00525     <span class="comment">//  Current Lsn.  This is periodic snapshot of the current logical end of</span>
00526     <span class="comment">//  log file to facilitate restart.</span>
00527     <span class="comment">//</span>
00528 
<a name="l00529"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o0">00529</a>     <a class="code" href="../../d6/d3/lfs_8h.html#a10">LSN</a> <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o0">CurrentLsn</a>;
00530 
00531     <span class="comment">//</span>
00532     <span class="comment">//  Number of Clients.  This is the maximum number of clients supported</span>
00533     <span class="comment">//  for this log file.</span>
00534     <span class="comment">//</span>
00535 
<a name="l00536"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o1">00536</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o1">LogClients</a>;
00537 
00538     <span class="comment">//</span>
00539     <span class="comment">//  The following are indexes into the client record arrays.  The client</span>
00540     <span class="comment">//  records are linked into two lists.  A free list of client records and</span>
00541     <span class="comment">//  an in-use list of records.</span>
00542     <span class="comment">//</span>
00543 
<a name="l00544"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o2">00544</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o2">ClientFreeList</a>;
<a name="l00545"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o3">00545</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o3">ClientInUseList</a>;
00546 
00547     <span class="comment">//</span>
00548     <span class="comment">//  Flag field.</span>
00549     <span class="comment">//</span>
00550     <span class="comment">//      RESTART_SINGLE_PAGE_IO      All log pages written 1 by 1</span>
00551     <span class="comment">//</span>
00552 
<a name="l00553"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o4">00553</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o4">Flags</a>;
00554 
00555     <span class="comment">//</span>
00556     <span class="comment">//  The following is the number of bits to use for the sequence number.</span>
00557     <span class="comment">//</span>
00558 
<a name="l00559"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o5">00559</a>     ULONG <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o5">SeqNumberBits</a>;
00560 
00561     <span class="comment">//</span>
00562     <span class="comment">//  Length of this restart area.</span>
00563     <span class="comment">//</span>
00564 
<a name="l00565"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o6">00565</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o6">RestartAreaLength</a>;
00566 
00567     <span class="comment">//</span>
00568     <span class="comment">//  Offset from the start of this structure to the client array.</span>
00569     <span class="comment">//  Ignored in versions prior to 1.1</span>
00570     <span class="comment">//</span>
00571 
<a name="l00572"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o7">00572</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o7">ClientArrayOffset</a>;
00573 
00574     <span class="comment">//</span>
00575     <span class="comment">//  Usable log file size.  We will stop sharing the value in the page header.</span>
00576     <span class="comment">//</span>
00577 
<a name="l00578"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o8">00578</a>     LONGLONG <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o8">FileSize</a>;
00579 
00580     <span class="comment">//</span>
00581     <span class="comment">//  DataLength of last Lsn.  This doesn't include the length of</span>
00582     <span class="comment">//  the Lfs header.</span>
00583     <span class="comment">//</span>
00584 
<a name="l00585"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o9">00585</a>     ULONG <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o9">LastLsnDataLength</a>;
00586 
00587     <span class="comment">//</span>
00588     <span class="comment">//  The following apply to log pages.  This is the log page data offset and</span>
00589     <span class="comment">//  the length of the log record header.  Ignored in versions prior to 1.1</span>
00590     <span class="comment">//</span>
00591 
<a name="l00592"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o10">00592</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o10">RecordHeaderLength</a>;
<a name="l00593"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o11">00593</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o11">LogPageDataOffset</a>;
00594 
00595     <span class="comment">//</span>
00596     <span class="comment">//  Client data.</span>
00597     <span class="comment">//</span>
00598 
<a name="l00599"></a><a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o12">00599</a>     <a class="code" href="../../d4/d0/struct__LFS__CLIENT__RECORD.html">LFS_CLIENT_RECORD</a> <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html#o12">LogClientArray</a>[1];
00600 
00601 } <a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html">LFS_OLD_RESTART_AREA</a>, *<a class="code" href="../../d6/d0/struct__LFS__OLD__RESTART__AREA.html">PLFS_OLD_RESTART_AREA</a>;
00602 <span class="preprocessor">#endif // _LFSDISK_</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:38 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
