<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: cnvint.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cnvint.c</h1><a href="../../d9/d3/cnvint_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1990  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    cnvint.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Text to integer and integer to text converion routines.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Steve Wood (stevewo) 23-Aug-1990</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#include &lt;<a class="code" href="../../d5/d9/ntrtlp_8h.html">ntrtlp.h</a>&gt;</span>
00022 
00023 <span class="preprocessor">#if defined(ALLOC_PRAGMA) &amp;&amp; defined(NTOS_KERNEL_RUNTIME)</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,RtlIntegerToChar)</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,RtlCharToInteger)</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,RtlUnicodeStringToInteger)</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,RtlIntegerToUnicodeString)</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,RtlLargeIntegerToChar)</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,RtlInt64ToUnicodeString)</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00031 <span class="preprocessor"></span>
<a name="l00032"></a><a class="code" href="../../d9/d3/cnvint_8c.html#a0">00032</a> <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> <a class="code" href="../../d9/d3/cnvint_8c.html#a0">RtlpIntegerChars</a>[] = {<span class="charliteral">'0'</span>, <span class="charliteral">'1'</span>, <span class="charliteral">'2'</span>, <span class="charliteral">'3'</span>, <span class="charliteral">'4'</span>, <span class="charliteral">'5'</span>, <span class="charliteral">'6'</span>, <span class="charliteral">'7'</span>,
00033                            <span class="charliteral">'8'</span>, <span class="charliteral">'9'</span>, <span class="charliteral">'A'</span>, <span class="charliteral">'B'</span>, <span class="charliteral">'C'</span>, <span class="charliteral">'D'</span>, <span class="charliteral">'E'</span>, <span class="charliteral">'F'</span>};
00034 
<a name="l00035"></a><a class="code" href="../../d9/d3/cnvint_8c.html#a1">00035</a> WCHAR <a class="code" href="../../d9/d3/cnvint_8c.html#a1">RtlpIntegerWChars</a>[] = { <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'0'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'1'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'2'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'3'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'4'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'5'</span>,
00036                               <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'6'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'7'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'8'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'9'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'A'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'B'</span>,
00037                               <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'C'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'D'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'E'</span>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'F'</span> };
00038 
00039 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00040"></a><a class="code" href="../../d9/d3/cnvint_8c.html#a2">00040</a> <a class="code" href="../../d9/d3/cnvint_8c.html#a2">RtlIntegerToChar</a> (
00041     IN ULONG Value,
00042     IN ULONG Base OPTIONAL,
00043     IN LONG OutputLength,
00044     OUT PSZ String
00045     )
00046 
00047 <span class="comment">/*++</span>
00048 <span class="comment"></span>
00049 <span class="comment">Routine Description:</span>
00050 <span class="comment"></span>
00051 <span class="comment">Arguments:</span>
00052 <span class="comment"></span>
00053 <span class="comment">Return Value:</span>
00054 <span class="comment"></span>
00055 <span class="comment">--*/</span>
00056 
00057 {
00058     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> Result[ 33 ], *s;
00059     ULONG Shift, Mask, Digit, Length;
00060 
00061     Shift = 0;
00062     <span class="keywordflow">switch</span>( Base ) {
00063         <span class="keywordflow">case</span> 16:    Shift = 4;  <span class="keywordflow">break</span>;
00064         <span class="keywordflow">case</span>  8:    Shift = 3;  <span class="keywordflow">break</span>;
00065         <span class="keywordflow">case</span>  2:    Shift = 1;  <span class="keywordflow">break</span>;
00066 
00067         <span class="keywordflow">case</span>  0:    Base = 10;
00068         <span class="keywordflow">case</span> 10:    Shift = 0;  <span class="keywordflow">break</span>;
00069         <span class="keywordflow">default</span>:    <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00070         }
00071 
00072     <span class="keywordflow">if</span> (Shift != 0) {
00073         Mask = 0xF &gt;&gt; (4 - Shift);
00074         }
00075 
00076     s = &amp;Result[ 32 ];
00077     *s = <span class="charliteral">'\0'</span>;
00078     <span class="keywordflow">do</span> {
00079         <span class="keywordflow">if</span> (Shift != 0) {
00080             Digit = Value &amp; Mask;
00081             Value &gt;&gt;= Shift;
00082             }
00083         <span class="keywordflow">else</span> {
00084             Digit = Value % Base;
00085             Value = Value / Base;
00086             }
00087 
00088         *--s = <a class="code" href="../../d9/d3/cnvint_8c.html#a0">RtlpIntegerChars</a>[ Digit ];
00089     } <span class="keywordflow">while</span> (Value != 0);
00090 
00091     Length = (ULONG) (&amp;Result[ 32 ] - s);
00092     <span class="keywordflow">if</span> (OutputLength &lt; 0) {
00093         OutputLength = -OutputLength;
00094         <span class="keywordflow">while</span> ((LONG)Length &lt; OutputLength) {
00095             *--s = <span class="charliteral">'0'</span>;
00096             Length++;
00097             }
00098         }
00099 
00100     <span class="keywordflow">if</span> ((LONG)Length &gt; OutputLength) {
00101         <span class="keywordflow">return</span>( STATUS_BUFFER_OVERFLOW );
00102         }
00103     <span class="keywordflow">else</span> {
00104         <span class="keywordflow">try</span> {
00105             RtlMoveMemory( <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>, s, Length );
00106 
00107             <span class="keywordflow">if</span> ((LONG)Length &lt; OutputLength) {
00108                 <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>[ Length ] = <span class="charliteral">'\0'</span>;
00109                 }
00110             }
00111         except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00112             <span class="keywordflow">return</span>( GetExceptionCode() );
00113             }
00114 
00115         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00116         }
00117 }
00118 
00119 
00120 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00121"></a><a class="code" href="../../d9/d3/cnvint_8c.html#a3">00121</a> <a class="code" href="../../d9/d3/cnvint_8c.html#a3">RtlCharToInteger</a> (
00122     IN PCSZ String,
00123     IN ULONG Base OPTIONAL,
00124     OUT PULONG Value
00125     )
00126 {
00127     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>, Sign;
00128     ULONG Result, Digit, Shift;
00129 
00130     <span class="keywordflow">while</span> ((Sign = *<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>++) &lt;= <span class="charliteral">' '</span>) {
00131         <span class="keywordflow">if</span> (!*<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>) {
00132             <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>--;
00133             <span class="keywordflow">break</span>;
00134             }
00135         }
00136 
00137     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = Sign;
00138     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'-'</span> || <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'+'</span>) {
00139         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = *<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>++;
00140         }
00141 
00142     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT( (ULONG_PTR)(Base) )) {
00143         Base = 10;
00144         Shift = 0;
00145         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'0'</span>) {
00146             <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = *<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>++;
00147             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'x'</span>) {
00148                 Base = 16;
00149                 Shift = 4;
00150                 }
00151             <span class="keywordflow">else</span>
00152             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'o'</span>) {
00153                 Base = 8;
00154                 Shift = 3;
00155                 }
00156             <span class="keywordflow">else</span>
00157             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'b'</span>) {
00158                 Base = 2;
00159                 Shift = 1;
00160                 }
00161             <span class="keywordflow">else</span> {
00162                 <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>--;
00163                 }
00164 
00165             <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = *<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>++;
00166             }
00167         }
00168     <span class="keywordflow">else</span> {
00169         <span class="keywordflow">switch</span>( Base ) {
00170             <span class="keywordflow">case</span> 16:    Shift = 4;  <span class="keywordflow">break</span>;
00171             <span class="keywordflow">case</span>  8:    Shift = 3;  <span class="keywordflow">break</span>;
00172             <span class="keywordflow">case</span>  2:    Shift = 1;  <span class="keywordflow">break</span>;
00173             <span class="keywordflow">case</span> 10:    Shift = 0;  <span class="keywordflow">break</span>;
00174             <span class="keywordflow">default</span>:    <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00175             }
00176         }
00177 
00178     Result = 0;
00179     <span class="keywordflow">while</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>) {
00180         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &gt;= <span class="charliteral">'0'</span> &amp;&amp; <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &lt;= <span class="charliteral">'9'</span>) {
00181             Digit = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> - <span class="charliteral">'0'</span>;
00182             }
00183         <span class="keywordflow">else</span>
00184         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &gt;= <span class="charliteral">'A'</span> &amp;&amp; <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &lt;= <span class="charliteral">'F'</span>) {
00185             Digit = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> - <span class="charliteral">'A'</span> + 10;
00186             }
00187         <span class="keywordflow">else</span>
00188         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &gt;= <span class="charliteral">'a'</span> &amp;&amp; <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &lt;= <span class="charliteral">'f'</span>) {
00189             Digit = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> - <span class="charliteral">'a'</span> + 10;
00190             }
00191         <span class="keywordflow">else</span> {
00192             <span class="keywordflow">break</span>;
00193             }
00194 
00195         <span class="keywordflow">if</span> (Digit &gt;= Base) {
00196             <span class="keywordflow">break</span>;
00197             }
00198 
00199         <span class="keywordflow">if</span> (Shift == 0) {
00200             Result = (Base * Result) + Digit;
00201             }
00202         <span class="keywordflow">else</span> {
00203             Result = (Result &lt;&lt; Shift) | Digit;
00204             }
00205 
00206         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = *<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>++;
00207         }
00208 
00209     <span class="keywordflow">if</span> (Sign == <span class="charliteral">'-'</span>) {
00210         Result = (ULONG)(-(LONG)Result);
00211         }
00212 
00213     <span class="keywordflow">try</span> {
00214         *Value = Result;
00215         }
00216     except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00217         <span class="keywordflow">return</span>( GetExceptionCode() );
00218         }
00219 
00220     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00221 }
00222 
00223 
00224 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00225"></a><a class="code" href="../../d9/d3/cnvint_8c.html#a4">00225</a> <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a> (
00226     IN PUNICODE_STRING String,
00227     IN ULONG Base OPTIONAL,
00228     OUT PULONG Value
00229     )
00230 {
00231     PCWSTR s;
00232     WCHAR <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>, Sign;
00233     ULONG nChars, Result, Digit, Shift;
00234 
00235     s = <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Buffer;
00236     nChars = <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>-&gt;Length / <span class="keyword">sizeof</span>( WCHAR );
00237     <span class="keywordflow">while</span> (nChars-- &amp;&amp; (Sign = *s++) &lt;= <span class="charliteral">' '</span>) {
00238         <span class="keywordflow">if</span> (!nChars) {
00239             Sign = UNICODE_NULL;
00240             <span class="keywordflow">break</span>;
00241             }
00242         }
00243 
00244     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = Sign;
00245     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'-'</span> || <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'+'</span>) {
00246         <span class="keywordflow">if</span> (nChars) {
00247             nChars--;
00248             <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = *s++;
00249             }
00250         <span class="keywordflow">else</span> {
00251             <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = UNICODE_NULL;
00252             }
00253         }
00254 
00255     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT( (ULONG_PTR)Base )) {
00256         Base = 10;
00257         Shift = 0;
00258         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'0'</span>) {
00259             <span class="keywordflow">if</span> (nChars) {
00260                 nChars--;
00261                 <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = *s++;
00262                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'x'</span>) {
00263                     Base = 16;
00264                     Shift = 4;
00265                     }
00266                 <span class="keywordflow">else</span>
00267                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'o'</span>) {
00268                     Base = 8;
00269                     Shift = 3;
00270                     }
00271                 <span class="keywordflow">else</span>
00272                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'b'</span>) {
00273                     Base = 2;
00274                     Shift = 1;
00275                     }
00276                 <span class="keywordflow">else</span> {
00277                     nChars++;
00278                     s--;
00279                     }
00280                 }
00281 
00282             <span class="keywordflow">if</span> (nChars) {
00283                 nChars--;
00284                 <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = *s++;
00285                 }
00286             <span class="keywordflow">else</span> {
00287                 <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = UNICODE_NULL;
00288                 }
00289             }
00290         }
00291     <span class="keywordflow">else</span> {
00292         <span class="keywordflow">switch</span>( Base ) {
00293             <span class="keywordflow">case</span> 16:    Shift = 4;  <span class="keywordflow">break</span>;
00294             <span class="keywordflow">case</span>  8:    Shift = 3;  <span class="keywordflow">break</span>;
00295             <span class="keywordflow">case</span>  2:    Shift = 1;  <span class="keywordflow">break</span>;
00296             <span class="keywordflow">case</span> 10:    Shift = 0;  <span class="keywordflow">break</span>;
00297             <span class="keywordflow">default</span>:    <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00298             }
00299         }
00300 
00301     Result = 0;
00302     <span class="keywordflow">while</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> != UNICODE_NULL) {
00303         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &gt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'0'</span> &amp;&amp; <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'9'</span>) {
00304             Digit = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> - <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'0'</span>;
00305             }
00306         <span class="keywordflow">else</span>
00307         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &gt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'A'</span> &amp;&amp; <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'F'</span>) {
00308             Digit = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> - <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'A'</span> + 10;
00309             }
00310         <span class="keywordflow">else</span>
00311         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &gt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'a'</span> &amp;&amp; <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'f'</span>) {
00312             Digit = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> - <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'a'</span> + 10;
00313             }
00314         <span class="keywordflow">else</span> {
00315             <span class="keywordflow">break</span>;
00316             }
00317 
00318         <span class="keywordflow">if</span> (Digit &gt;= Base) {
00319             <span class="keywordflow">break</span>;
00320             }
00321 
00322         <span class="keywordflow">if</span> (Shift == 0) {
00323             Result = (Base * Result) + Digit;
00324             }
00325         <span class="keywordflow">else</span> {
00326             Result = (Result &lt;&lt; Shift) | Digit;
00327             }
00328 
00329         <span class="keywordflow">if</span> (!nChars) {
00330             <span class="keywordflow">break</span>;
00331             }
00332         nChars--;
00333         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = *s++;
00334         }
00335 
00336     <span class="keywordflow">if</span> (Sign == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'-'</span>) {
00337         Result = (ULONG)(-(LONG)Result);
00338         }
00339 
00340     <span class="keywordflow">try</span> {
00341         *Value = Result;
00342         }
00343     except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00344         <span class="keywordflow">return</span>( GetExceptionCode() );
00345         }
00346 
00347     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00348 }
00349 
00350 
00351 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00352"></a><a class="code" href="../../d9/d3/cnvint_8c.html#a5">00352</a> <a class="code" href="../../d9/d3/cnvint_8c.html#a5">RtlIntegerToUnicode</a> (
00353     IN ULONG Value,
00354     IN ULONG Base OPTIONAL,
00355     IN LONG OutputLength,
00356     OUT PWSTR String
00357     )
00358 
00359 <span class="comment">/*++</span>
00360 <span class="comment"></span>
00361 <span class="comment">Routine Description:</span>
00362 <span class="comment"></span>
00363 <span class="comment">Arguments:</span>
00364 <span class="comment"></span>
00365 <span class="comment">Return Value:</span>
00366 <span class="comment"></span>
00367 <span class="comment">--*/</span>
00368 
00369 {
00370     WCHAR Result[ 33 ], *s;
00371     ULONG Shift, Mask, Digit, Length;
00372 
00373     Shift = 0;
00374     <span class="keywordflow">switch</span>( Base ) {
00375         <span class="keywordflow">case</span> 16:    Shift = 4;  <span class="keywordflow">break</span>;
00376         <span class="keywordflow">case</span>  8:    Shift = 3;  <span class="keywordflow">break</span>;
00377         <span class="keywordflow">case</span>  2:    Shift = 1;  <span class="keywordflow">break</span>;
00378 
00379         <span class="keywordflow">case</span>  0:    Base = 10;
00380         <span class="keywordflow">case</span> 10:    Shift = 0;  <span class="keywordflow">break</span>;
00381         <span class="keywordflow">default</span>:    <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00382         }
00383 
00384     <span class="keywordflow">if</span> (Shift != 0) {
00385         Mask = 0xF &gt;&gt; (4 - Shift);
00386         }
00387 
00388     s = &amp;Result[ 32 ];
00389     *s = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00390     <span class="keywordflow">do</span> {
00391         <span class="keywordflow">if</span> (Shift != 0) {
00392             Digit = Value &amp; Mask;
00393             Value &gt;&gt;= Shift;
00394             }
00395         <span class="keywordflow">else</span> {
00396             Digit = Value % Base;
00397             Value = Value / Base;
00398             }
00399 
00400         *--s = <a class="code" href="../../d9/d3/cnvint_8c.html#a1">RtlpIntegerWChars</a>[ Digit ];
00401     } <span class="keywordflow">while</span> (Value != 0);
00402 
00403     Length = (ULONG) (&amp;Result[ 32 ] - s);
00404     <span class="keywordflow">if</span> (OutputLength &lt; 0) {
00405         OutputLength = -OutputLength;
00406         <span class="keywordflow">while</span> ((LONG)Length &lt; OutputLength) {
00407             *--s = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'0'</span>;
00408             Length++;
00409             }
00410         }
00411 
00412     <span class="keywordflow">if</span> ((LONG)Length &gt; OutputLength) {
00413         <span class="keywordflow">return</span>( STATUS_BUFFER_OVERFLOW );
00414         }
00415     <span class="keywordflow">else</span> {
00416         <span class="keywordflow">try</span> {
00417             RtlMoveMemory( <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>, s, Length * <span class="keyword">sizeof</span>( WCHAR ));
00418 
00419             <span class="keywordflow">if</span> ((LONG)Length &lt; OutputLength) {
00420                 <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>[ Length ] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00421                 }
00422             }
00423         except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00424             <span class="keywordflow">return</span>( GetExceptionCode() );
00425             }
00426 
00427         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00428         }
00429 }
00430 
00431 
00432 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00433"></a><a class="code" href="../../d9/d3/cnvint_8c.html#a6">00433</a> <a class="code" href="../../d9/d3/cnvint_8c.html#a6">RtlIntegerToUnicodeString</a> (
00434     IN ULONG Value,
00435     IN ULONG Base OPTIONAL,
00436     IN OUT PUNICODE_STRING String
00437     )
00438 {
00439     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00440     UCHAR ResultBuffer[ 16 ];
00441     ANSI_STRING AnsiString;
00442 
00443     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a2">RtlIntegerToChar</a>( Value, Base, <span class="keyword">sizeof</span>( ResultBuffer ), ResultBuffer );
00444     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00445         AnsiString.Buffer = ResultBuffer;
00446         AnsiString.MaximumLength = <span class="keyword">sizeof</span>( ResultBuffer );
00447         AnsiString.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>( ResultBuffer );
00448         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>( <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>, &amp;AnsiString, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00449         }
00450 
00451     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00452 }
00453 
00454 
00455 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00456"></a><a class="code" href="../../d9/d3/cnvint_8c.html#a7">00456</a> <a class="code" href="../../d9/d3/cnvint_8c.html#a7">RtlLargeIntegerToChar</a> (
00457     IN PLARGE_INTEGER Value,
00458     IN ULONG Base OPTIONAL,
00459     IN LONG OutputLength,
00460     OUT PSZ String
00461     )
00462 
00463 <span class="comment">/*++</span>
00464 <span class="comment"></span>
00465 <span class="comment">Routine Description:</span>
00466 <span class="comment"></span>
00467 <span class="comment">Arguments:</span>
00468 <span class="comment"></span>
00469 <span class="comment">Return Value:</span>
00470 <span class="comment"></span>
00471 <span class="comment">--*/</span>
00472 
00473 {
00474     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> Result[ 100 ], *s;
00475     ULONG Shift, Mask, Digit, Length;
00476 
00477     Shift = 0;
00478     <span class="keywordflow">switch</span>( Base ) {
00479         <span class="keywordflow">case</span> 16:    Shift = 4;  <span class="keywordflow">break</span>;
00480         <span class="keywordflow">case</span>  8:    Shift = 3;  <span class="keywordflow">break</span>;
00481         <span class="keywordflow">case</span>  2:    Shift = 1;  <span class="keywordflow">break</span>;
00482 
00483         <span class="keywordflow">case</span>  0:
00484         <span class="keywordflow">case</span> 10:    Shift = 0;  <span class="keywordflow">break</span>;
00485         <span class="keywordflow">default</span>:    <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00486         }
00487 
00488     <span class="keywordflow">if</span> (Shift != 0) {
00489         Mask = 0xF &gt;&gt; (4 - Shift);
00490         }
00491 
00492     s = &amp;Result[ 99 ];
00493     *s = <span class="charliteral">'\0'</span>;
00494     <span class="keywordflow">if</span> (Shift != 0) {
00495         ULONG LowValue,HighValue,HighShift,HighMask;
00496 
00497         LowValue = Value-&gt;LowPart;
00498         HighValue = Value-&gt;HighPart;
00499         HighShift = Shift - (<span class="keyword">sizeof</span>(ULONG) % Shift);
00500         HighMask = 0xF &gt;&gt; (4 - HighShift);
00501         <span class="keywordflow">do</span> {
00502             Digit = LowValue &amp; Mask;
00503             LowValue = (LowValue &gt;&gt; Shift) | ((HighValue &amp; HighMask) &lt;&lt; (<span class="keyword">sizeof</span>(ULONG) - HighShift));
00504             HighValue = HighValue &gt;&gt; HighShift;
00505             *--s = <a class="code" href="../../d9/d3/cnvint_8c.html#a0">RtlpIntegerChars</a>[ Digit ];
00506         } <span class="keywordflow">while</span> ((LowValue | HighValue) != 0);
00507     } <span class="keywordflow">else</span> {
00508         LARGE_INTEGER TempValue=*Value;
00509         <span class="keywordflow">do</span> {
00510             TempValue = <a class="code" href="../../d0/d1/largeic_8c.html#a0">RtlExtendedLargeIntegerDivide</a>(TempValue,Base,&amp;Digit);
00511             *--s = <a class="code" href="../../d9/d3/cnvint_8c.html#a0">RtlpIntegerChars</a>[ Digit ];
00512         } <span class="keywordflow">while</span> (TempValue.HighPart != 0 || TempValue.LowPart != 0);
00513     }
00514 
00515     Length = (ULONG)(&amp;Result[ 99 ] - s);
00516     <span class="keywordflow">if</span> (OutputLength &lt; 0) {
00517         OutputLength = -OutputLength;
00518         <span class="keywordflow">while</span> ((LONG)Length &lt; OutputLength) {
00519             *--s = <span class="charliteral">'0'</span>;
00520             Length++;
00521             }
00522         }
00523 
00524     <span class="keywordflow">if</span> ((LONG)Length &gt; OutputLength) {
00525         <span class="keywordflow">return</span>( STATUS_BUFFER_OVERFLOW );
00526         }
00527     <span class="keywordflow">else</span> {
00528         <span class="keywordflow">try</span> {
00529             RtlMoveMemory( <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>, s, Length );
00530 
00531             <span class="keywordflow">if</span> ((LONG)Length &lt; OutputLength) {
00532                 <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>[ Length ] = <span class="charliteral">'\0'</span>;
00533                 }
00534             }
00535         except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00536             <span class="keywordflow">return</span>( GetExceptionCode() );
00537             }
00538 
00539         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00540         }
00541 }
00542 
00543 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00544"></a><a class="code" href="../../d9/d3/cnvint_8c.html#a8">00544</a> <a class="code" href="../../d9/d3/cnvint_8c.html#a8">RtlLargeIntegerToUnicode</a> (
00545     IN PLARGE_INTEGER Value,
00546     IN ULONG Base OPTIONAL,
00547     IN LONG OutputLength,
00548     OUT PWSTR String
00549     )
00550 
00551 <span class="comment">/*++</span>
00552 <span class="comment"></span>
00553 <span class="comment">Routine Description:</span>
00554 <span class="comment"></span>
00555 <span class="comment">Arguments:</span>
00556 <span class="comment"></span>
00557 <span class="comment">Return Value:</span>
00558 <span class="comment"></span>
00559 <span class="comment">--*/</span>
00560 
00561 {
00562     WCHAR Result[ 100 ], *s;
00563     ULONG Shift, Mask, Digit, Length;
00564 
00565     Shift = 0;
00566     <span class="keywordflow">switch</span>( Base ) {
00567         <span class="keywordflow">case</span> 16:    Shift = 4;  <span class="keywordflow">break</span>;
00568         <span class="keywordflow">case</span>  8:    Shift = 3;  <span class="keywordflow">break</span>;
00569         <span class="keywordflow">case</span>  2:    Shift = 1;  <span class="keywordflow">break</span>;
00570 
00571         <span class="keywordflow">case</span>  0:
00572         <span class="keywordflow">case</span> 10:    Shift = 0;  <span class="keywordflow">break</span>;
00573         <span class="keywordflow">default</span>:    <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00574         }
00575 
00576     <span class="keywordflow">if</span> (Shift != 0) {
00577         Mask = 0xF &gt;&gt; (4 - Shift);
00578         }
00579 
00580     s = &amp;Result[ 99 ];
00581     *s = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00582     <span class="keywordflow">if</span> (Shift != 0) {
00583         ULONG LowValue,HighValue,HighShift,HighMask;
00584 
00585         LowValue = Value-&gt;LowPart;
00586         HighValue = Value-&gt;HighPart;
00587         HighShift = Shift - (<span class="keyword">sizeof</span>(ULONG) % Shift);
00588         HighMask = 0xF &gt;&gt; (4 - HighShift);
00589         <span class="keywordflow">do</span> {
00590             Digit = LowValue &amp; Mask;
00591             LowValue = (LowValue &gt;&gt; Shift) | ((HighValue &amp; HighMask) &lt;&lt; (<span class="keyword">sizeof</span>(ULONG) - HighShift));
00592             HighValue = HighValue &gt;&gt; HighShift;
00593             *--s = <a class="code" href="../../d9/d3/cnvint_8c.html#a1">RtlpIntegerWChars</a>[ Digit ];
00594         } <span class="keywordflow">while</span> ((LowValue | HighValue) != 0);
00595     } <span class="keywordflow">else</span> {
00596         LARGE_INTEGER TempValue=*Value;
00597         <span class="keywordflow">do</span> {
00598             TempValue = <a class="code" href="../../d0/d1/largeic_8c.html#a0">RtlExtendedLargeIntegerDivide</a>(TempValue,Base,&amp;Digit);
00599             *--s = <a class="code" href="../../d9/d3/cnvint_8c.html#a1">RtlpIntegerWChars</a>[ Digit ];
00600         } <span class="keywordflow">while</span> (TempValue.HighPart != 0 || TempValue.LowPart != 0);
00601     }
00602 
00603     Length = (ULONG)(&amp;Result[ 99 ] - s);
00604     <span class="keywordflow">if</span> (OutputLength &lt; 0) {
00605         OutputLength = -OutputLength;
00606         <span class="keywordflow">while</span> ((LONG)Length &lt; OutputLength) {
00607             *--s = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'0'</span>;
00608             Length++;
00609             }
00610         }
00611 
00612     <span class="keywordflow">if</span> ((LONG)Length &gt; OutputLength) {
00613         <span class="keywordflow">return</span>( STATUS_BUFFER_OVERFLOW );
00614         }
00615     <span class="keywordflow">else</span> {
00616         <span class="keywordflow">try</span> {
00617             RtlMoveMemory( <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>, s, Length * <span class="keyword">sizeof</span>( WCHAR ));
00618 
00619             <span class="keywordflow">if</span> ((LONG)Length &lt; OutputLength) {
00620                 <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>[ Length ] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00621                 }
00622             }
00623         except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00624             <span class="keywordflow">return</span>( GetExceptionCode() );
00625             }
00626 
00627         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00628         }
00629 }
00630 
00631 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00632"></a><a class="code" href="../../d9/d3/cnvint_8c.html#a9">00632</a> <a class="code" href="../../d9/d3/cnvint_8c.html#a9">RtlInt64ToUnicodeString</a> (
00633     IN ULONGLONG Value,
00634     IN ULONG Base OPTIONAL,
00635     IN OUT PUNICODE_STRING String
00636     )
00637 
00638 {
00639 
00640     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00641     UCHAR ResultBuffer[32];
00642     ANSI_STRING AnsiString;
00643     LARGE_INTEGER Temp;
00644 
00645     Temp.QuadPart = Value;
00646     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a7">RtlLargeIntegerToChar</a>(&amp;Temp,
00647                                    Base,
00648                                    <span class="keyword">sizeof</span>(ResultBuffer),
00649                                    ResultBuffer);
00650 
00651     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00652         AnsiString.Buffer = ResultBuffer;
00653         AnsiString.MaximumLength = <span class="keyword">sizeof</span>(ResultBuffer);
00654         AnsiString.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(ResultBuffer);
00655         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>, &amp;AnsiString, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00656     }
00657 
00658     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00659 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:29 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
