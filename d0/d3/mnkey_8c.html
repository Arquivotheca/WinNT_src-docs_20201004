<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mnkey.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>mnkey.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d1/d2/mnkey_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/mnkey_8c.html#a0">CMDSWITCH</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/mnkey_8c.html#a1">CMDQUERY</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/mnkey_8c.html#a2">xxxClientFindMnemChar</a> (PUNICODE_STRING pstrSrc, WCHAR ch, BOOL fFirst, BOOL fPrefix)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/mnkey_8c.html#a3">MNFindNextValidItem</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, int i, int dir, UINT flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/mnkey_8c.html#a4">MNFindItemInColumn</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, UINT idxB, int dir, BOOL fRoot)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/mnkey_8c.html#a5">xxxMNFindChar</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, UINT ch, int idxC, LPINT lpr)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/mnkey_8c.html#a6">xxxMNKeyFilter</a> (<a class="el" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a> ppopupMenu, <a class="el" href="../../d4/d1/structtagMENUSTATE.html">PMENUSTATE</a> pMenuState, UINT ch)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="mnkey.c::CMDQUERY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CMDQUERY&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00024">24</a> of file <a class="el" href="../../d1/d2/mnkey_8c-source.html">mnkey.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="mnkey.c::CMDSWITCH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CMDSWITCH&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00023">23</a> of file <a class="el" href="../../d1/d2/mnkey_8c-source.html">mnkey.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a4" doxytag="mnkey.c::MNFindItemInColumn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT MNFindItemInColumn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>idxB</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fRoot</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00124">124</a> of file <a class="el" href="../../d1/d2/mnkey_8c-source.html">mnkey.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d8/d3/conexts_8c-source.html#l01041">dir()</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00050">End</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02763">MFMWFP_NOITEM</a>, <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00034">MNFindNextValidItem()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02797">tagMENU::rgItems</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02752">tagITEM::xItem</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02753">tagITEM::yItem</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l01251">xxxMNKeyDown()</a>.
<p>
<pre class="fragment"><div>00129 {
00130     <span class="keywordtype">int</span> dxMin;
00131     <span class="keywordtype">int</span> dyMin;
00132     <span class="keywordtype">int</span> dxMax;
00133     <span class="keywordtype">int</span> dyMax;
00134     <span class="keywordtype">int</span> xB;
00135     <span class="keywordtype">int</span> yB;
00136     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> idxE;
00137     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> idxR;
00138     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cItems;
00139     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
00140 
00141     cItems = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>;
00142     idxR = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>;
00143     idxE = <a class="code" href="../../d4/d1/userk_8h.html#a1384">MNFindNextValidItem</a>(pMenu, MFMWFP_NOITEM, dir, 0);
00144     <span class="keywordflow">if</span> (idxE == -1)
00145         <span class="keywordflow">goto</span> <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>;
00146 
00147     dxMin = dyMin = 20000;
00148 
00149     <span class="keywordflow">if</span> (idxB &gt;= pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>)
00150         <span class="keywordflow">return</span> idxR;
00151 
00152     pItem = &amp;pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>[idxB];
00153     xB = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>;
00154     yB = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00155 
00156     <span class="keywordflow">while</span> (cItems-- &gt; 0 &amp;&amp;
00157             (idxB = <a class="code" href="../../d4/d1/userk_8h.html#a1384">MNFindNextValidItem</a>(pMenu, idxB, dir, 0)) != idxE) {
00158         pItem = &amp;pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>[idxB];
00159         dxMax = xB - pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>;
00160         dyMax = yB - pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>;
00161 
00162         <span class="keywordflow">if</span> (dxMax &lt; 0)
00163             dxMax = (-dxMax);
00164         <span class="keywordflow">if</span> (dyMax &lt; 0)
00165             dyMax = (-dyMax);
00166 
00167         <span class="comment">// See if this item is nearer than the last item found</span>
00168         <span class="comment">// --------------------------------------------------------</span>
00169         <span class="comment">// (fRoot || dxMax) -- this condition means that if it's</span>
00170         <span class="comment">// not the actual menu bar menu that we're dealing with,</span>
00171         <span class="comment">// then the item below/above (same X value as) the selected</span>
00172         <span class="comment">// item is not a valid one to move to</span>
00173         <span class="keywordflow">if</span> ((dyMax &lt; dyMin) &amp;&amp; (fRoot || dxMax) &amp;&amp; dxMax &lt;= dxMin) {
00174             dxMin = dxMax;
00175             dyMin = dyMax;
00176             idxR = idxB;
00177         }
00178     }
00179 
00180 <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>:
00181     <span class="keywordflow">return</span> idxR;
00182 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mnkey.c::MNFindNextValidItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT MNFindNextValidItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>i</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>dir</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00034">34</a> of file <a class="el" href="../../d1/d2/mnkey_8c-source.html">mnkey.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d8/d3/conexts_8c-source.html#l01041">dir()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02619">tagITEM::hbmp</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02763">MFMWFP_NOITEM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02682">MNF_DONTSKIPSEPARATORS</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02797">tagMENU::rgItems</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02783">TestMFT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00124">MNFindItemInColumn()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l04022">xxxMenuWindowProc()</a>, <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00193">xxxMNFindChar()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l01251">xxxMNKeyDown()</a>.
<p>
<pre class="fragment"><div>00039 {
00040     <span class="keywordtype">int</span> iStart;
00041     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> cont = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00042     <span class="keywordtype">int</span> cItems = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>;
00043     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
00044 
00045     <span class="keywordflow">if</span> ((i &lt; 0) &amp;&amp; (dir &gt; 0))
00046         <span class="comment">// going forward from beginning -- stop after last menu item</span>
00047         i = iStart = cItems;
00048     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i &gt;= cItems) &amp;&amp; (<a class="code" href="../../d7/d4/conexts_8c.html#a29">dir</a> &lt; 0))
00049         <span class="comment">// going backward from end -- stop after first menu item</span>
00050         i = iStart = -1;
00051     <span class="keywordflow">else</span>
00052         iStart = i;
00053 
00054     <span class="keywordflow">if</span> (!cItems)
00055         <span class="keywordflow">return</span>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>);
00056 
00057     <span class="comment">// b#8997 - if we have these conditions and enter</span>
00058     <span class="comment">// loop will go blistic ( infin )</span>
00059     <span class="comment">// fix: jump over code and come loop to i == iStart will now stop us</span>
00060     <span class="keywordflow">if</span> ( ( i == 0 ) &amp;&amp; ( cItems == 1 ) &amp;&amp; ( <a class="code" href="../../d7/d4/conexts_8c.html#a29">dir</a> &gt; 0 ) )
00061     {
00062         <a class="code" href="../../d7/d4/conexts_8c.html#a29">dir</a> = 0;
00063         <span class="keywordflow">goto</span> artsquickndirtybugfix;
00064     }
00065 
00066     <span class="comment">//</span>
00067     <span class="comment">// Loop thru menu items til (1) we find a valid item</span>
00068     <span class="comment">//                       or (2) we make it back to the start item (iStart)</span>
00069     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00070         i += <a class="code" href="../../d7/d4/conexts_8c.html#a29">dir</a>;
00071 
00072         <span class="keywordflow">if</span> ((i == iStart) || (<a class="code" href="../../d7/d4/conexts_8c.html#a29">dir</a> == 0))
00073             <span class="comment">// we made it back to start item -- return NOT FOUND</span>
00074             <span class="keywordflow">return</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>;
00075 
00076         <span class="comment">// keep 'i' in the range: 0 &lt;= i &lt; cItems</span>
00077         <span class="keywordflow">if</span> (i &gt;= cItems) {
00078             i = -1;
00079             <span class="keywordflow">continue</span>;
00080         }
00081         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt; 0) {
00082             i = cItems;
00083             <span class="keywordflow">continue</span>;
00084         }
00085 
00086 artsquickndirtybugfix:
00087         pItem = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a> + i;
00088 
00089         <span class="comment">// skip ownerdraw - seperators even though there not NULL</span>
00090         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItem, MFT_SEPARATOR)) {
00091             <span class="comment">//</span>
00092             <span class="comment">// Skip non-separator (if asked) empty items.  With hot-tracking,</span>
00093             <span class="comment">// it is acceptable for them to be selected.  In truth, it was possible</span>
00094             <span class="comment">// in Win3.1 too, but less likely.</span>
00095             <span class="comment">//</span>
00096             <span class="keywordflow">if</span> (!(flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a764">MNF_DONTSKIPSEPARATORS</a>)) {
00097                 <span class="keywordflow">continue</span>;
00098             }
00099         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> &gt;= HBMMENU_MBARFIRST) &amp;&amp; (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a> &lt;= HBMMENU_MBARLAST)) {
00100             <span class="comment">/*</span>
00101 <span class="comment">             * Skip close &amp; minimize &amp; restore buttons</span>
00102 <span class="comment">             */</span>
00103             <span class="keywordflow">continue</span>;
00104         }
00105 
00106         <span class="comment">// return index of found item</span>
00107         <span class="keywordflow">return</span>(i);
00108     }
00109 
00110     <span class="comment">//</span>
00111     <span class="comment">// We should never get here!</span>
00112     <span class="comment">//</span>
00113     UserAssert(FALSE);
00114 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mnkey.c::xxxClientFindMnemChar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int xxxClientFindMnemChar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pstrSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>ch</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fFirst</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fPrefix</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00193">xxxMNFindChar()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="mnkey.c::xxxMNFindChar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT xxxMNFindChar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>ch</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>idxC</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPINT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpr</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00193">193</a> of file <a class="el" href="../../d1/d2/mnkey_8c-source.html">mnkey.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02750">tagITEM::cch</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03855">CH_HELPPREFIX</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02609">tagITEM::lpstr</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02763">MFMWFP_NOITEM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02682">MNF_DONTSKIPSEPARATORS</a>, <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00034">MNFindNextValidItem()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02797">tagMENU::rgItems</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03454">TextPointer</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d0/d3/mnkey_8c.html#a2">xxxClientFindMnemChar()</a>.
<p>
<pre class="fragment"><div>00198 {
00199     <span class="keywordtype">int</span> idxFirst = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>;
00200     <span class="keywordtype">int</span> idxB;
00201     <span class="keywordtype">int</span> idxF;
00202     <span class="keywordtype">int</span> rT;
00203     LPWSTR lpstr;
00204     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
00205 
00206     <span class="keywordflow">if</span> (ch == 0)
00207         <span class="keywordflow">return</span> 0;
00208 
00209     <span class="comment">/*</span>
00210 <span class="comment">     * First time thru go for the very first menu.</span>
00211 <span class="comment">     */</span>
00212     idxF = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>;
00213     rT = 0;
00214     idxB = idxC;
00215 
00216     <span class="keywordflow">if</span> (idxB &lt; 0)
00217 <span class="comment">//    if (idxB &amp; 0x8000)</span>
00218         idxB = <a class="code" href="../../d4/d1/userk_8h.html#a1384">MNFindNextValidItem</a>(pMenu, pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>, MFMWFP_NOITEM, MNF_DONTSKIPSEPARATORS);
00219 
00220     <span class="keywordflow">do</span> {
00221         <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> idxPrev;
00222 
00223         idxPrev = idxC;
00224         idxC = <a class="code" href="../../d4/d1/userk_8h.html#a1384">MNFindNextValidItem</a>(pMenu, idxC, 1, MNF_DONTSKIPSEPARATORS);
00225         <span class="keywordflow">if</span> (idxC == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a> || idxC == idxFirst)
00226             <span class="keywordflow">break</span>;
00227         <span class="keywordflow">if</span> (idxFirst == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>)
00228             idxFirst = idxC;
00229 
00230         pItem = &amp;pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>[idxC];
00231 
00232         <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00233             <span class="keywordflow">if</span> (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a> != 0) {
00234                 UNICODE_STRING strMnem;
00235 
00236                 lpstr = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a909">TextPointer</a>(pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a>);
00237                 <span class="keywordflow">if</span> (*lpstr == <a class="code" href="../../d4/d1/userk_8h.html#a469">CH_HELPPREFIX</a>) {
00238 
00239                     <span class="comment">/*</span>
00240 <span class="comment">                     * Skip help prefix if it is there so that we can mnemonic</span>
00241 <span class="comment">                     * to the first character of a right justified string.</span>
00242 <span class="comment">                     */</span>
00243                     lpstr++;
00244                 }
00245 
00246                 <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;strMnem, lpstr);
00247                 <span class="keywordflow">if</span> (((rT = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d0/d3/mnkey_8c.html#a2">xxxClientFindMnemChar</a>(&amp;strMnem,
00248                         (WCHAR)ch, TRUE, TRUE)) == 0x0080) &amp;&amp;
00249                         (idxF == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>))
00250                     idxF = idxC;
00251             }
00252         }
00253         <span class="keywordflow">if</span> (idxC == idxPrev) {
00254             <span class="keywordflow">break</span>;  <span class="comment">// no progress - break inf. loop</span>
00255         }
00256     } <span class="keywordflow">while</span> (rT != 1 &amp;&amp; idxB != idxC);
00257 
00258     *lpr = rT;
00259 
00260     <span class="keywordflow">if</span> (rT == 1)
00261         <span class="keywordflow">return</span> idxC;
00262 
00263     <span class="keywordflow">return</span> idxF;
00264 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="mnkey.c::xxxMNKeyFilter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxMNKeyFilter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ppopupMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d4/d1/structtagMENUSTATE.html">PMENUSTATE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenuState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>ch</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d2/mnkey_8c-source.html#l00290">290</a> of file <a class="el" href="../../d1/d2/mnkey_8c-source.html">mnkey.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03205">tagMENUSTATE::fButtonDown</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02854">tagPOPUPMENU::fInCancel</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03204">tagMENUSTATE::fInsideMenuLoop</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02816">tagPOPUPMENU::fIsSysMenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03202">tagMENUSTATE::fMenuStarted</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03210">tagMENUSTATE::fModelessMenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02821">tagPOPUPMENU::fToggle</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02970">KEYBDHOLD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02757">MENUCHILDSYSMENU</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02756">MENUSYSMENU</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02763">MFMWFP_NOITEM</a>, <a class="el" href="../../d5/d2/mnstate_8c-source.html#l00025">MNPositionSysMenu()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02901">tagPOPUPMENU::posSelectedItem</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02881">tagPOPUPMENU::spmenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02883">tagPOPUPMENU::spmenuAlternate</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02863">tagPOPUPMENU::spwndNotify</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02868">tagPOPUPMENU::spwndPopupMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02405">WFSYSMENU</a>, <a class="el" href="../../d5/d3/kernel_2msgbeep_8c-source.html#l00052">xxxMessageBeep()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l01011">xxxMNChar()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l02517">xxxMNCloseHierarchy()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00036">xxxMNDismiss()</a>, <a class="el" href="../../d2/d2/mnloop_8c-source.html#l00635">xxxMNLoop()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l01934">xxxMNOpenHierarchy()</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l02818">xxxMNSelectItem()</a>, <a class="el" href="../../d5/d2/mnstate_8c-source.html#l00677">xxxMNStartMenu()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00795">xxxMNSwitchToAlternateMenu()</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/syscmd_8c-source.html#l00193">xxxSysCommand()</a>.
<p>
<pre class="fragment"><div>00294 {
00295     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fLocalInsideMenuLoop = pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o3">fInsideMenuLoop</a>;
00296 
00297     <span class="keywordflow">if</span> (pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o4">fButtonDown</a>) {
00298 
00299         <span class="comment">/*</span>
00300 <span class="comment">         * Ignore keystrokes while the mouse is pressed (except ESC).</span>
00301 <span class="comment">         */</span>
00302         <span class="keywordflow">return</span>;
00303     }
00304 
00305     <span class="keywordflow">if</span> (!pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o3">fInsideMenuLoop</a>) {
00306 
00307         <span class="comment">/*</span>
00308 <span class="comment">         * Need to send the WM_INITMENU message before we pull down the menu.</span>
00309 <span class="comment">         */</span>
00310         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1386">xxxMNStartMenu</a>(ppopupMenu, KEYBDHOLD)) {
00311             <span class="keywordflow">return</span>;
00312         }
00313         pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o3">fInsideMenuLoop</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00314     }
00315 
00316 
00317     <span class="keywordflow">switch</span> (ch) {
00318     <span class="keywordflow">case</span> 0:
00319 
00320         <span class="comment">/*</span>
00321 <span class="comment">         * If we get a WM_KEYDOWN alt key and then a KEYUP alt key, we need to</span>
00322 <span class="comment">         * activate the first item on the menu.  ie.  user hits and releases alt</span>
00323 <span class="comment">         * key so just select first item.  USER sends us a SC_KEYMENU with</span>
00324 <span class="comment">         * lParam 0 when the user does this.</span>
00325 <span class="comment">         */</span>
00326         <a class="code" href="../../d4/d1/userk_8h.html#a1369">xxxMNSelectItem</a>(ppopupMenu, pMenuState, 0);
00327         <span class="keywordflow">break</span>;
00328 
00329     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a773">MENUCHILDSYSMENU</a>:
00330         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(ppopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o25">spwndNotify</a>)) {
00331 
00332             <span class="comment">/*</span>
00333 <span class="comment">             * Change made to fix MDI problem: child window gets a keymenu,</span>
00334 <span class="comment">             * and pops up sysmenu of frame when maximized.  Need to act like</span>
00335 <span class="comment">             * MENUCHAR if hwndMenu is a top-level.</span>
00336 <span class="comment">             */</span>
00337             <span class="keywordflow">goto</span> MenuCharHandler;
00338         }
00339 
00340         <span class="comment">/*</span>
00341 <span class="comment">         * else fall through.</span>
00342 <span class="comment">         */</span>
00343 
00344     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a772">MENUSYSMENU</a>:
00345         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(ppopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o25">spwndNotify</a>, WFSYSMENU)) {
00346             <a class="code" href="../../d4/d1/userk_8h.html#a1730">xxxMessageBeep</a>(0);
00347             <span class="keywordflow">goto</span> MenuCancel;
00348         }
00349 
00350         <span class="comment">/*</span>
00351 <span class="comment">         * Popup any hierarchies we have.</span>
00352 <span class="comment">         */</span>
00353         <a class="code" href="../../d4/d1/userk_8h.html#a1374">xxxMNCloseHierarchy</a>(ppopupMenu, pMenuState);
00354         <span class="keywordflow">if</span> (!ppopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o2">fIsSysMenu</a> &amp;&amp; ppopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o30">spmenuAlternate</a>)
00355             <a class="code" href="../../d4/d1/userk_8h.html#a1370">xxxMNSwitchToAlternateMenu</a>(ppopupMenu);
00356         <span class="keywordflow">if</span> (!ppopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o2">fIsSysMenu</a>) {
00357             <span class="comment">/*</span>
00358 <span class="comment">             * If no system menu, get out.</span>
00359 <span class="comment">             */</span>
00360             <span class="keywordflow">goto</span> MenuCancel;
00361         }
00362 
00363         <a class="code" href="../../d4/d1/userk_8h.html#a1387">MNPositionSysMenu</a>(ppopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o26">spwndPopupMenu</a>, ppopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o29">spmenu</a>);
00364         <a class="code" href="../../d4/d1/userk_8h.html#a1369">xxxMNSelectItem</a>(ppopupMenu, pMenuState, 0);
00365         <a class="code" href="../../d4/d1/userk_8h.html#a1375">xxxMNOpenHierarchy</a>(ppopupMenu, pMenuState);
00366         ppopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o7">fToggle</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00367         <span class="keywordflow">break</span>;
00368 
00369 
00370     <span class="keywordflow">default</span>:
00371 
00372         <span class="comment">/*</span>
00373 <span class="comment">         * Handle ALT-Character sequences for items on top level menu bar.</span>
00374 <span class="comment">         * Note that fInsideMenuLoop may be set to false on return from this</span>
00375 <span class="comment">         * function if the app decides to return 1 to the WM_MENUCHAR message.</span>
00376 <span class="comment">         * We detect this and not enter MenuLoop if fInsideMenuLoop is reset</span>
00377 <span class="comment">         * to false.</span>
00378 <span class="comment">         */</span>
00379 MenuCharHandler:
00380         <a class="code" href="../../d4/d1/userk_8h.html#a1392">xxxMNChar</a>(ppopupMenu, pMenuState, ch);
00381         <span class="keywordflow">if</span> (ppopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o34">posSelectedItem</a> == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>) {
00382             <span class="comment">/*</span>
00383 <span class="comment">             * No selection found.</span>
00384 <span class="comment">             */</span>
00385             <span class="keywordflow">goto</span> MenuCancel;
00386         }
00387         <span class="keywordflow">break</span>;
00388     }
00389 
00390     <span class="keywordflow">if</span> (!fLocalInsideMenuLoop &amp;&amp; pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o3">fInsideMenuLoop</a>) {
00391         <a class="code" href="../../d4/d1/userk_8h.html#a1401">xxxMNLoop</a>(ppopupMenu, pMenuState, 0, FALSE);
00392     }
00393 
00394     <span class="keywordflow">return</span>;
00395 
00396 
00397 MenuCancel:
00398     pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o9">fModelessMenu</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00399     <span class="keywordflow">if</span> (!ppopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o19">fInCancel</a>) {
00400         <a class="code" href="../../d4/d1/userk_8h.html#a1354">xxxMNDismiss</a>(pMenuState);
00401     }
00402     UserAssert(!pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o3">fInsideMenuLoop</a> &amp;&amp; !pMenuState-&gt;<a class="code" href="../../d4/d1/structtagMENUSTATE.html#o1">fMenuStarted</a>);
00403     <span class="keywordflow">return</span>;
00404 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:47 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
